<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Java注解到底存在多久？——源码、字节码与运行时]]></title>    <link>https://juejin.cn/post/7599572091076182058</link>    <guid>https://juejin.cn/post/7599572091076182058</guid>    <pubDate>2026-01-27T07:37:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599572091076182058" data-draft-id="7599591405313966121" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java注解到底存在多久？——源码、字节码与运行时"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:37:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Morpheus0412"/> <meta itemprop="url" content="https://juejin.cn/user/2541726611811454"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java注解到底存在多久？——源码、字节码与运行时
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726611811454/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Morpheus0412
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:37:31.000Z" title="Tue Jan 27 2026 07:37:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">注解（Annotation）本质</h2>
<p>注解就是给代码打的<strong>标签（元数据）</strong>，编译后确实会被打包进 <code>.class</code> 文件，所以它可以被编译器、工具或运行时库读取。</p>
<h2 data-id="heading-1">三类生命周期</h2>
<ol>
<li>
<p><strong>源码级（SOURCE）</strong><br/>
只在写代码时有效，编译完就消失，不会进 class 文件。</p>
<ul>
<li><code>@Override</code>：让编译器帮你检查是否真的覆写了父类方法，拼写错误直接报错。</li>
<li><code>@SuppressWarnings</code>：告诉编译器「我知道这里有警告，闭嘴就好」。</li>
</ul>
</li>
<li>
<p><strong>字节码级（CLASS）</strong><br/>
会写进 class 文件，但 JVM 加载类时会丢弃，适合给静态分析工具（如 ProGuard）看。</p>
</li>
<li>
<p><strong>运行时级（RUNTIME）</strong> ——<strong>最常用</strong><br/>
从类加载到程序结束一直留在 JVM 里，随时可以用反射读取。<br/>
例如 <code>@ResponseBody</code>：当 Spring 检测到方法上有这个注解，就自动把返回值转成 JSON/XML 塞进 HTTP 响应体里，不用你手动写 <code>response.getWriter().write()</code>。</p>
</li>
</ol>
<h2 data-id="heading-2">自定义注解</h2>
<p>用 <code>@interface</code> 关键字定义，本质是特殊的接口：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 只能贴在类、接口、枚举上</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>  
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyController {
    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span>;  <span class="hljs-comment">// 注解的参数，使用时写成 @MyController("/user")</span>
}

<span class="hljs-comment">// 允许贴在方法或字段上</span>
<span class="hljs-meta">@Target({ElementType.METHOD, ElementType.FIELD})</span>  
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyLog {
    String <span class="hljs-title function_">desc</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"默认日志"</span>;  <span class="hljs-comment">// 可设默认值</span>
}
</code></pre>
<p><strong><code>@Target</code> 的作用</strong>：限制你自定义的注解能贴在哪儿，防止写错位置。如果不写 <code>@Target</code>，默认可以贴任何位置。</p>
<h2 data-id="heading-3">快速记忆</h2>
<ul>
<li>要 <strong>检查代码错误</strong> → <code>@Override</code>（源码级）</li>
<li>要 <strong>框架自动处理</strong>（如序列化、事务、权限）→ 自定义 RUNTIME 注解 + 反射</li>
<li>写注解时 <strong>不知道能贴哪</strong> → 加 <code>@Target</code> 约束一下</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python HTML解析库学习文档]]></title>    <link>https://juejin.cn/post/7599850148055236617</link>    <guid>https://juejin.cn/post/7599850148055236617</guid>    <pubDate>2026-01-27T07:45:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599850148055236617" data-draft-id="7599850148055203849" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python HTML解析库学习文档"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:45:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开飞机的舒克_"/> <meta itemprop="url" content="https://juejin.cn/user/4284144156154958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python HTML解析库学习文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4284144156154958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开飞机的舒克_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:45:00.000Z" title="Tue Jan 27 2026 07:45:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>开飞机的舒克
<a href="https://link.juejin.cn?target=halo.gaodaimou.cn" target="_blank" title="halo.gaodaimou.cn" ref="nofollow noopener noreferrer">halo.gaodaimou.cn</a></p>
</blockquote>
<h2 data-id="heading-0">Python HTML解析库学习文档</h2>
<h3 data-id="heading-1">1. 介绍</h3>
<p>HTML解析是Web开发和数据爬取中的重要技能。Python提供了多种HTML解析库，其中最常用的是<code>lxml</code>和<code>BeautifulSoup</code>。本文档将详细介绍这两个库的使用方法、核心知识点以及它们之间的对比。</p>
<h3 data-id="heading-2">2. lxml库</h3>
<h4 data-id="heading-3">2.1 简介</h4>
<p><code>lxml</code>是一个高性能的HTML和XML解析库，基于C语言开发，提供了Pythonic的API。它支持XPath选择器，解析速度快，是数据爬取和Web开发中的常用工具。</p>
<h4 data-id="heading-4">2.2 安装</h4>
<pre><code class="hljs">pip install lxml
</code></pre>
<h4 data-id="heading-5">2.3 基本使用</h4>
<pre><code class="hljs language-xml" lang="xml">from lxml import etree

# HTML字符串
html = '''
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>这是一个标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h1标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h2标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"这是一个图片"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落111<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落222<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
'''

# 解析HTML字符串，返回Element对象
root = etree.HTML(html)
</code></pre>
<h4 data-id="heading-6">2.4 XPath选择器</h4>
<p>XPath是一种用于在XML和HTML文档中定位元素的语言，<code>lxml</code>库支持完整的XPath语法。</p>
<h5 data-id="heading-7">2.4.1 基本路径表示法</h5>





























<table><thead><tr><th>表达式</th><th>描述</th></tr></thead><tbody><tr><td><code>/</code></td><td>从根节点开始查找</td></tr><tr><td><code>//</code></td><td>从当前节点开始查找所有匹配的后代元素</td></tr><tr><td><code>.</code></td><td>当前节点</td></tr><tr><td><code>..</code></td><td>父节点</td></tr><tr><td><code>@</code></td><td>选择属性</td></tr></tbody></table>
<h5 data-id="heading-8">2.4.2 示例</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查找所有p元素</span>
<span class="hljs-attr">ps</span> = root.xpath(<span class="hljs-string">'//p'</span>)
print(ps<span class="hljs-section">[0]</span>.text)  <span class="hljs-comment"># 输出：这是一个段落111</span>
print(ps<span class="hljs-section">[1]</span>.text)  <span class="hljs-comment"># 输出：这是一个段落222</span>

<span class="hljs-comment"># 直接获取文本内容</span>
<span class="hljs-attr">ps_text</span> = root.xpath(<span class="hljs-string">'//p/text()'</span>)
print(ps_text)  <span class="hljs-comment"># 输出：['这是一个段落111', '这是一个段落222']</span>

<span class="hljs-comment"># 查找特定属性的元素</span>
<span class="hljs-attr">img</span> = root.xpath(<span class="hljs-string">'//img'</span>)[<span class="hljs-number">0</span>]
print(img.get('src'))  <span class="hljs-comment"># 输出：https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span>

<span class="hljs-comment"># 使用属性值过滤</span>
<span class="hljs-attr">content_div</span> = root.xpath(<span class="hljs-string">'//div[@class="content"]'</span>)[<span class="hljs-number">0</span>]
print(content_div)  <span class="hljs-comment"># 输出：&lt;Element div at 0x...&gt;</span>

<span class="hljs-comment"># 从当前节点开始查找</span>
<span class="hljs-attr">content_ps</span> = content_div.xpath(<span class="hljs-string">'.//p'</span>)
print(len(content_ps))  <span class="hljs-comment"># 输出：2</span>

<span class="hljs-comment"># 查找父节点</span>
<span class="hljs-attr">parent_div</span> = root.xpath(<span class="hljs-string">'//p/../div'</span>)[<span class="hljs-number">0</span>]
print(parent_div.get('class'))  <span class="hljs-comment"># 输出：content</span>
</code></pre>
<h4 data-id="heading-9">2.5 性能建议</h4>
<ul>
<li>当你知道确切结构时，使用绝对路径（更快）：<code>/html/body/div[1]/p[1]</code></li>
<li>当结构不确定时，使用相对路径（更灵活）：<code>//div[@class='content']//p</code></li>
<li>可以混合使用：<code>/html/body//p</code>（从body开始，查找所有后代p）</li>
</ul>
<h4 data-id="heading-10">2.6 Element对象操作</h4>
<p>解析HTML后返回的是Element对象，你可以使用Element对象的方法和属性来操作HTML文档：</p>
<ul>
<li><code>text</code>：获取元素的文本内容</li>
<li><code>get()</code>：获取元素的属性值</li>
<li><code>find()</code>：查找第一个匹配的子元素</li>
<li><code>findall()</code>：查找所有匹配的子元素</li>
</ul>
<h3 data-id="heading-11">3. BeautifulSoup库</h3>
<h4 data-id="heading-12">3.1 简介</h4>
<p><code>BeautifulSoup</code>是一个Python库，用于从HTML和XML文件中提取数据。它提供了简单和Pythonic的方式来遍历、搜索和修改解析树。</p>
<h4 data-id="heading-13">3.2 安装</h4>
<pre><code class="hljs language-bash" lang="bash">pip install beautifulsoup4
pip install lxml  <span class="hljs-comment"># 可选，作为BeautifulSoup的解析器</span>
</code></pre>
<h4 data-id="heading-14">3.3 基本使用</h4>
<pre><code class="hljs language-xml" lang="xml">from bs4 import BeautifulSoup

# HTML字符串
html = '''
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>这是一个标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h1标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>这是一个h2标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"这是一个图片"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是一个段落<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
'''

# 初始化BeautifulSoup对象，使用html.parser解析器
soup = BeautifulSoup(html, 'html.parser')
</code></pre>
<h4 data-id="heading-15">3.4 查找元素的方法</h4>
<h5 data-id="heading-16">3.4.1 find() 和 find_all()</h5>
<p>这是BeautifulSoup中最常用的查找方法：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 查找第一个h1标签（按id）</span>
<span class="hljs-attr">h1_by_id</span> = soup.find(<span class="hljs-string">'h1'</span>, id=<span class="hljs-string">'title'</span>)
print(h1_by_id)  <span class="hljs-comment"># 输出：&lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;</span>

<span class="hljs-comment"># 查找第一个h1标签（按class）</span>
<span class="hljs-attr">h1_by_class</span> = soup.find(<span class="hljs-string">'h1'</span>, class_=<span class="hljs-string">'title'</span>)  <span class="hljs-comment"># 注意：class是Python关键字，所以使用class_</span>
print(h1_by_class.text)  <span class="hljs-comment"># 输出：这是一个h2标题</span>

<span class="hljs-comment"># 查找所有h1标签</span>
<span class="hljs-attr">h1_all</span> = soup.find_all(<span class="hljs-string">'h1'</span>)
print(len(h1_all))  <span class="hljs-comment"># 输出：2</span>

<span class="hljs-comment"># 遍历所有h1标签</span>
for h1 in h1_all:
    print(h1.text)

<span class="hljs-comment"># 查找特定属性的元素</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>, alt=<span class="hljs-string">'这是一个图片'</span>)
print(img.get('src'))  <span class="hljs-comment"># 输出：https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png</span>
</code></pre>
<h5 data-id="heading-17">3.4.2 find() 和 find_all() 的参数</h5>

































<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><code>name</code></td><td>标签名，可以是字符串或列表</td></tr><tr><td><code>attrs</code></td><td>属性字典，用于过滤元素</td></tr><tr><td><code>recursive</code></td><td>是否递归查找子元素，默认为True</td></tr><tr><td><code>text</code></td><td>查找包含指定文本的元素</td></tr><tr><td><code>limit</code></td><td>限制返回的元素数量，仅适用于find_all()</td></tr><tr><td><code>**kwargs</code></td><td>关键字参数，用于过滤元素属性</td></tr></tbody></table>
<h4 data-id="heading-18">3.5 CSS选择器</h4>
<p>BeautifulSoup也支持CSS选择器，使用<code>select_one()</code>和<code>select()</code>方法：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 标签选择器</span>
<span class="hljs-attr">h1</span> = soup.select_one(<span class="hljs-string">'h1'</span>)
print(h1.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># ID选择器</span>
<span class="hljs-attr">title</span> = soup.select_one(<span class="hljs-string">'#title'</span>)
print(title.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># 类选择器</span>
<span class="hljs-attr">content</span> = soup.select_one(<span class="hljs-string">'.content'</span>)

<span class="hljs-comment"># 属性选择器</span>
<span class="hljs-attr">link</span> = soup.select_one(<span class="hljs-string">'a[href="https://example.com"]'</span>)

<span class="hljs-comment"># 后代选择器</span>
<span class="hljs-comment"># 找到container类div下的所有p标签</span>
<span class="hljs-attr">content_in_container</span> = soup.select_one(<span class="hljs-string">'.container p'</span>)

<span class="hljs-comment"># 子元素选择器</span>
<span class="hljs-comment"># 找到container类div的直接子元素p</span>
<span class="hljs-attr">direct_child_p</span> = soup.select_one(<span class="hljs-string">'.container &gt; p'</span>)

<span class="hljs-comment"># 组合选择器</span>
<span class="hljs-attr">special_content</span> = soup.select_one(<span class="hljs-string">'p.content.special'</span>)
</code></pre>
<h4 data-id="heading-19">3.6 元素操作</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取元素的属性值</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>)
print(img.get('src'))  <span class="hljs-comment"># 可以获取标签的属性值</span>

<span class="hljs-comment"># 获取元素的文本内容</span>
<span class="hljs-comment"># get_text()方法可以传入参数控制，如strip=True去掉首尾空格，separator='|'用|隔开</span>
<span class="hljs-attr">h1</span> = soup.find(<span class="hljs-string">'h1'</span>)
print(h1.get_text(<span class="hljs-attr">strip</span>=<span class="hljs-literal">True</span>))  <span class="hljs-comment"># 输出：这是一个h1标题</span>

<span class="hljs-comment"># 直接使用text属性，效果类似</span>
print(h1.text)  <span class="hljs-comment"># 输出：这是一个h1标题</span>
</code></pre>
<h4 data-id="heading-20">3.7 性能建议</h4>
<ul>
<li>简单查找：<code>find()</code>/<code>find_all()</code> 通常比CSS选择器快</li>
<li>复杂查找：CSS选择器更直观易读</li>
</ul>
<h3 data-id="heading-21">4. 两个库的对比</h3>
<h4 data-id="heading-22">4.1 优缺点</h4>




















<table><thead><tr><th>库</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>lxml</td><td>解析速度快 支持XPath选择器 API简洁 内存占用小</td><td>安装相对复杂（依赖C库） 对HTML格式要求严格</td></tr><tr><td>BeautifulSoup</td><td>API友好，易于学习 对HTML格式要求宽松 支持多种解析器 文档丰富</td><td>解析速度较慢 内存占用较大 不支持XPath（需要额外安装lxml）</td></tr></tbody></table>
<h4 data-id="heading-23">4.2 适用场景</h4>

















<table><thead><tr><th>库</th><th>适用场景</th></tr></thead><tbody><tr><td>lxml</td><td>数据爬取（特别是大规模数据） 需要使用XPath选择器的场景 对性能要求高的应用</td></tr><tr><td>BeautifulSoup</td><td>简单的数据提取 学习和教学 对HTML格式不规范的网页 快速开发原型</td></tr></tbody></table>
<h4 data-id="heading-24">4.3 性能对比</h4>
<ul>
<li>解析速度：<code>lxml</code> &gt; <code>BeautifulSoup</code>（使用lxml解析器） &gt; <code>BeautifulSoup</code>（使用html.parser）</li>
<li>内存占用：<code>lxml</code> &lt; <code>BeautifulSoup</code></li>
</ul>
<h4 data-id="heading-25">4.4 选择建议</h4>
<ol>
<li>如果性能是首要考虑因素，选择<code>lxml</code></li>
<li>如果代码可读性和易用性更重要，选择<code>BeautifulSoup</code></li>
<li>如果需要处理不规范的HTML，选择<code>BeautifulSoup</code></li>
<li>如果需要使用XPath选择器，选择<code>lxml</code></li>
<li>可以结合使用：<code>BeautifulSoup(html, 'lxml')</code>，利用两者的优点</li>
</ol>
<h3 data-id="heading-26">5. 总结</h3>


















































<table><thead><tr><th>特性</th><th>lxml</th><th>BeautifulSoup</th></tr></thead><tbody><tr><td>解析速度</td><td>快</td><td>较慢</td></tr><tr><td>内存占用</td><td>小</td><td>大</td></tr><tr><td>API友好度</td><td>中等</td><td>高</td></tr><tr><td>XPath支持</td><td>是</td><td>否（需要额外安装）</td></tr><tr><td>CSS选择器支持</td><td>是</td><td>是</td></tr><tr><td>对HTML格式要求</td><td>严格</td><td>宽松</td></tr><tr><td>安装复杂度</td><td>较高</td><td>较低</td></tr><tr><td>文档质量</td><td>好</td><td>优秀</td></tr></tbody></table>
<h3 data-id="heading-27">6. 最佳实践</h3>
<ol>
<li>根据具体需求选择合适的库</li>
<li>对于大规模数据爬取，优先考虑<code>lxml</code></li>
<li>对于快速开发和原型设计，优先考虑<code>BeautifulSoup</code></li>
<li>可以结合使用两者：<code>BeautifulSoup(html, 'lxml')</code></li>
<li>学习XPath选择器，它是一种强大的定位元素的工具</li>
<li>注意HTML的格式规范，特别是在使用<code>lxml</code>时</li>
<li>定期更新库版本，以获得更好的性能和安全性</li>
</ol>
<h3 data-id="heading-28">7. 示例代码汇总</h3>
<h4 data-id="heading-29">7.1 lxml示例</h4>
<pre><code class="hljs language-ini" lang="ini">from lxml import etree

<span class="hljs-attr">html</span> = <span class="hljs-string">'''
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;这是一个标题&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;
        &lt;h1 class="title"&gt;这是一个h2标题&lt;/h1&gt;
        &lt;img src="https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png" alt="这是一个图片"&gt;
        &lt;div class="content"&gt;
            &lt;p&gt;这是一个段落111&lt;/p&gt;
            &lt;p&gt;这是一个段落222&lt;/p&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
'''</span>

<span class="hljs-comment"># 解析HTML字符串</span>
<span class="hljs-attr">root</span> = etree.HTML(html)

<span class="hljs-comment"># 查找所有p元素并打印文本</span>
<span class="hljs-attr">ps</span> = root.xpath(<span class="hljs-string">'//p'</span>)
for p in ps:
    print(p.text)

<span class="hljs-comment"># 直接获取文本内容</span>
<span class="hljs-attr">ps_text</span> = root.xpath(<span class="hljs-string">'//p/text()'</span>)
print(ps_text)

<span class="hljs-comment"># 查找图片的src属性</span>
<span class="hljs-attr">img_src</span> = root.xpath(<span class="hljs-string">'//img/@src'</span>)[<span class="hljs-number">0</span>]
print(img_src)
</code></pre>
<h4 data-id="heading-30">7.2 BeautifulSoup示例</h4>
<pre><code class="hljs language-ini" lang="ini">from bs4 import BeautifulSoup

<span class="hljs-attr">html</span> = <span class="hljs-string">'''
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;这是一个标题&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1 id="title"&gt;这是一个h1标题&lt;/h1&gt;
        &lt;h1 class="title"&gt;这是一个h2标题&lt;/h1&gt;
        &lt;img src="https://www.baidu.com/img/PCtm_d9c8750bed0b3c7d089fa7d55720d6cf.png" alt="这是一个图片"&gt;
        &lt;p&gt;这是一个段落&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
'''</span>

<span class="hljs-comment"># 初始化BeautifulSoup对象</span>
<span class="hljs-attr">soup</span> = BeautifulSoup(html, <span class="hljs-string">'html.parser'</span>)

<span class="hljs-comment"># 查找所有h1标签并打印文本</span>
<span class="hljs-attr">h1_all</span> = soup.find_all(<span class="hljs-string">'h1'</span>)
for h1 in h1_all:
    print(h1.text)

<span class="hljs-comment"># 查找图片并获取src属性</span>
<span class="hljs-attr">img</span> = soup.find(<span class="hljs-string">'img'</span>)
print(img.get('src'))

<span class="hljs-comment"># 使用CSS选择器查找元素</span>
<span class="hljs-attr">title</span> = soup.select_one(<span class="hljs-string">'#title'</span>)
print(title.text)
</code></pre>
<h3 data-id="heading-31">8. 资源推荐</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flxml.de%2F" target="_blank" title="https://lxml.de/" ref="nofollow noopener noreferrer">lxml官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.crummy.com%2Fsoftware%2FBeautifulSoup%2Fbs4%2Fdoc%2F" target="_blank" title="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" ref="nofollow noopener noreferrer">BeautifulSoup官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fxml%2Fxpath_intro.asp" target="_blank" title="https://www.w3schools.com/xml/xpath_intro.asp" ref="nofollow noopener noreferrer">XPath教程</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fcssref%2Fcss_selectors.asp" target="_blank" title="https://www.w3schools.com/cssref/css_selectors.asp" ref="nofollow noopener noreferrer">CSS选择器参考</a></li>
</ul>
<p>通过学习本文档，你应该已经掌握了<code>lxml</code>和<code>BeautifulSoup</code>这两个HTML解析库的基本使用方法和核心知识点。在实际应用中，你可以根据具体需求选择合适的库，或者结合使用两者的优点，提高开发效率和代码质量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拿捏python基础]]></title>    <link>https://juejin.cn/post/7599630795804704814</link>    <guid>https://juejin.cn/post/7599630795804704814</guid>    <pubDate>2026-01-27T07:47:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795804704814" data-draft-id="7599614131424133129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拿捏python基础"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:47:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开飞机的舒克_"/> <meta itemprop="url" content="https://juejin.cn/user/4284144156154958"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拿捏python基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4284144156154958/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开飞机的舒克_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:47:11.000Z" title="Tue Jan 27 2026 07:47:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读24分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>开飞机的舒克
<a href="https://link.juejin.cn?target=halo.gaodaimou.cn" target="_blank" title="halo.gaodaimou.cn" ref="nofollow noopener noreferrer">halo.gaodaimou.cn</a></p>
</blockquote>
<h2 data-id="heading-0">Python 学习指南</h2>
<h3 data-id="heading-1">1. Python 基础类型</h3>
<p>Python 支持多种数据类型，主要包括：</p>
<ul>
<li><strong>整数（int）</strong> ：如 <code>18</code>、<code>-5</code>、<code>0</code></li>
<li><strong>字符串（str）</strong> ：如 <code>"hello"</code>、<code>'world'</code></li>
<li><strong>浮点数（float）</strong> ：如 <code>3.14</code>、<code>-0.5</code></li>
<li><strong>布尔值（bool）</strong> ：<code>True</code> 或 <code>False</code></li>
<li><strong>空值（NoneType）</strong> ：<code>None</code></li>
<li><strong>列表（list）</strong> ：如 <code>[1, 2, 3]</code></li>
<li><strong>元组（tuple）</strong> ：如 <code>(1, 2, 3)</code></li>
<li><strong>字典（dict）</strong> ：如 <code>{"name": "张三"}</code></li>
</ul>
<h4 data-id="heading-2">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 字符串</span>
msg = <span class="hljs-string">"hello world"</span>
<span class="hljs-built_in">print</span>(msg)  <span class="hljs-comment"># 输出: hello world</span>

<span class="hljs-comment"># 布尔值</span>
flag = <span class="hljs-literal">False</span>
<span class="hljs-keyword">if</span> flag:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"flag is True"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"flag is False"</span>)  <span class="hljs-comment"># 输出: flag is False</span>

<span class="hljs-comment"># 查看类型</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(flag))  <span class="hljs-comment"># 输出: &lt;class 'bool'&gt;</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(msg))   <span class="hljs-comment"># 输出: &lt;class 'str'&gt;</span>

<span class="hljs-comment"># 浮点数和整数</span>
PI = <span class="hljs-number">3.1415926</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(PI, <span class="hljs-built_in">type</span>(PI))  <span class="hljs-comment"># 输出: 3.1415926 &lt;class 'float'&gt;</span>
<span class="hljs-built_in">print</span>(age, <span class="hljs-built_in">type</span>(age))  <span class="hljs-comment"># 输出: 18 &lt;class 'int'&gt;</span>

<span class="hljs-comment"># Python 严格区分大小写</span>
</code></pre>
<h3 data-id="heading-3">2. 字符串(str)</h3>
<h4 data-id="heading-4">2.1. 访问字符</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>通过索引访问第一个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[0])</code></td><td><code>H</code></td></tr><tr><td>通过负索引访问最后一个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[-1])</code></td><td><code>!</code></td></tr></tbody></table>
<h4 data-id="heading-5">2.2. 字符串切片</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>切片获取前5个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[0:5])</code></td><td><code>Hello</code></td></tr><tr><td>切片获取从第8个字符到结尾</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[7:])</code></td><td><code>World!</code></td></tr><tr><td>切片获取从开头到第5个字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[:5])</code></td><td><code>Hello</code></td></tr><tr><td>切片获取间隔为2的字符</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[::2])</code></td><td><code>Hlo ol!</code></td></tr><tr><td>反转字符串</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str[::-1])</code></td><td><code>!dlroW ,olleH</code></td></tr></tbody></table>
<h4 data-id="heading-6">2.3. 字符串拼接</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>使用 + 运算符拼接字符串</td><td><code>str1 = "Hello"</code> <code>str2 = "World"</code> <code>print(str1 + ", " + str2 + "!")</code></td><td><code>Hello, World!</code></td></tr><tr><td>使用 * 运算符重复字符串</td><td><code>print("Ha" * 3)</code></td><td><code>HaHaHa</code></td></tr></tbody></table>
<h4 data-id="heading-7">2.4. 字符串长度</h4>















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>获取字符串长度</td><td><code>my_str = "Hello, World!"</code> <code>print(len(my_str))</code></td><td><code>13</code></td></tr></tbody></table>
<h4 data-id="heading-8">2.5. 查找和替换</h4>

























<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>查找子字符串位置（find方法）</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.find("World"))</code></td><td><code>7</code></td></tr><tr><td>查找子字符串位置（index方法）</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.index("World"))</code></td><td><code>7</code></td></tr><tr><td>替换子字符串</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.replace("World", "Python"))</code></td><td><code>Hello, Python!</code></td></tr></tbody></table>
<h4 data-id="heading-9">2.6. 大小写转换</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>转换为大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.upper())</code></td><td><code>HELLO, WORLD!</code></td></tr><tr><td>转换为小写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.lower())</code></td><td><code>hello, world!</code></td></tr><tr><td>转换为首字母大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.title())</code></td><td><code>Hello, World!</code></td></tr><tr><td>转换为第一个字符大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.capitalize())</code></td><td><code>Hello, world!</code></td></tr><tr><td>大小写互换</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.swapcase())</code></td><td><code>hELLO, wORLD!</code></td></tr></tbody></table>
<h4 data-id="heading-10">2.7. 去除空白字符</h4>

























<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>去除两端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.strip())</code></td><td><code>Hello, World!</code></td></tr><tr><td>去除左端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.lstrip())</code></td><td><code>Hello, World!</code></td></tr><tr><td>去除右端空白</td><td><code>my_str = " Hello, World! "</code> <code>print(my_str.rstrip())</code></td><td><code>Hello, World!</code></td></tr></tbody></table>
<h4 data-id="heading-11">2. 8. 分割和连接</h4>




















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>分割字符串</td><td><code>my_str = "Hello, World, Python"</code> <code>print(my_str.split(", "))</code></td><td><code>['Hello', 'World', 'Python']</code></td></tr><tr><td>连接字符串列表</td><td><code>str_list = ['Hello', 'World', 'Python']</code> <code>print(", ".join(str_list))</code></td><td><code>Hello, World, Python</code></td></tr></tbody></table>
<h4 data-id="heading-12">2.9. 检查字符串内容</h4>













































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>检查是否以指定字符串开头</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.startswith("Hello"))</code></td><td><code>True</code></td></tr><tr><td>检查是否以指定字符串结尾</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.endswith("World"))</code></td><td><code>False</code></td></tr><tr><td>检查是否全为字母</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isalpha())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为数字</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isdigit())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为字母或数字</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isalnum())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为小写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.islower())</code></td><td><code>False</code></td></tr><tr><td>检查是否全为大写</td><td><code>my_str = "Hello, World!"</code> <code>print(my_str.isupper())</code></td><td><code>False</code></td></tr></tbody></table>
<h4 data-id="heading-13">2.10. 格式化字符串</h4>



































<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>f-string 格式化</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print(f"我叫{name}，今年{age}岁")</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（位置参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{}，今年{}岁".format(name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（索引参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{0}，今年{1}岁".format(name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>format() 方法（关键字参数）</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫{name}，今年{age}岁".format(name=name, age=age))</code></td><td><code>我叫张三，今年18岁</code></td></tr><tr><td>% 格式化</td><td><code>name = "张三"</code> <code>age = 18</code> <code>print("我叫%s，今年%d岁" % (name, age))</code></td><td><code>我叫张三，今年18岁</code></td></tr></tbody></table>
<h4 data-id="heading-14">2.11. 字符串不可变性</h4>















<table><thead><tr><th>操作描述</th><th>示例代码</th><th>输出结果</th></tr></thead><tbody><tr><td>字符串不可变性（创建新字符串）</td><td><code>my_str = "Hello"</code> <code>my_str = "h" + my_str[1:]</code> <code>print(my_str)</code></td><td><code>hello</code></td></tr></tbody></table>
<blockquote>
<p><strong>注意</strong>：字符串是不可变的，不能直接修改字符串中的字符，如 <code>my_str[0] = "h"</code> 会引发 TypeError。要修改字符串，需要创建新的字符串。</p>
</blockquote>
<h3 data-id="heading-15">3. 列表（List）</h3>
<p>列表是 Python 中最常用的数据结构之一，用于存储有序的元素集合。</p>
<h4 data-id="heading-16">列表操作方法</h4>











































































<table><thead><tr><th>操作</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>访问元素</td><td><code>list[index]</code></td><td>通过索引访问，从 0 开始</td></tr><tr><td>访问最后元素</td><td><code>list[-1]</code></td><td>负数索引从末尾开始</td></tr><tr><td>修改元素</td><td><code>list[index] = value</code></td><td>直接赋值修改</td></tr><tr><td>新增元素</td><td><code>list.append(value)</code></td><td>在末尾添加元素</td></tr><tr><td>插入元素</td><td><code>list.insert(index, value)</code></td><td>在指定位置插入</td></tr><tr><td>合并列表</td><td><code>list.extend(other_list)</code></td><td>将另一个列表的元素添加到末尾</td></tr><tr><td>删除元素</td><td><code>del list[index]</code></td><td>删除指定索引的元素</td></tr><tr><td>删除并返回</td><td><code>list.pop(index)</code></td><td>删除并返回指定索引的元素</td></tr><tr><td>删除值</td><td><code>list.remove(value)</code></td><td>删除第一个匹配的值</td></tr><tr><td>排序</td><td><code>sorted(list)</code></td><td>返回新的排序列表（原列表不变）</td></tr><tr><td>最大值</td><td><code>max(list)</code></td><td>返回列表中的最大值</td></tr><tr><td>最小值</td><td><code>min(list)</code></td><td>返回列表中的最小值</td></tr><tr><td>长度</td><td><code>len(list)</code></td><td>返回列表元素个数</td></tr></tbody></table>
<h4 data-id="heading-17">切片操作</h4>
<p>切片用于访问列表的一部分，语法：<code>list[start:end:step]</code></p>
<ul>
<li><strong>左闭右开区间</strong>：<code>[start:end]</code> 包含 start，不包含 end</li>
<li><strong>默认值</strong>：start 默认 0，end 默认列表长度，step 默认 1</li>
<li><strong>索引越界</strong>：切片不会引发 IndexError</li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">my_list</span> = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>]

<span class="hljs-comment"># 通过切片访问</span>
print(my_list<span class="hljs-section">[1:4]</span>)   <span class="hljs-comment"># 输出: [20, 30, 40]</span>
print(my_list<span class="hljs-section">[:3]</span>)    <span class="hljs-comment"># 输出: [10, 20, 30]（从开头到索引2）</span>
print(my_list<span class="hljs-section">[2:]</span>)    <span class="hljs-comment"># 输出: [30, 40, 50]（从索引2到末尾）</span>
print(my_list<span class="hljs-section">[::2]</span>)   <span class="hljs-comment"># 输出: [10, 30, 50]（步长为2）</span>

<span class="hljs-comment"># 通过切片删除</span>
my_list<span class="hljs-section">[1:3]</span> = <span class="hljs-section">[]</span>     <span class="hljs-comment"># 删除索引1-2的元素</span>
print(my_list)        <span class="hljs-comment"># 输出: [10, 40, 50]</span>

<span class="hljs-comment"># 经过删除后通过切片插入</span>
my_list<span class="hljs-section">[1:1]</span> = <span class="hljs-section">[25, 35]</span>  <span class="hljs-comment"># 在索引1处插入</span>
print(my_list)        <span class="hljs-comment"># 输出: [10, 25, 35, 40, 50]</span>
</code></pre>
<h4 data-id="heading-18">列表操作示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建列表</span>
my_list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-string">"香蕉"</span>]
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [1, 2, 3, 4, 5, '香蕉']</span>

<span class="hljs-comment"># 修改元素</span>
my_list[<span class="hljs-number">0</span>] = <span class="hljs-number">100</span>
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 2, 3, 4, 5, '香蕉']</span>

<span class="hljs-comment"># 新增元素</span>
my_list.append(<span class="hljs-string">"orange"</span>)
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 2, 3, 4, 5, '香蕉', 'orange']</span>

<span class="hljs-comment"># 删除元素</span>
my_list.remove(<span class="hljs-number">2</span>)  <span class="hljs-comment"># 删除值为2的元素</span>
<span class="hljs-built_in">print</span>(my_list)  <span class="hljs-comment"># 输出: [100, 3, 4, 5, '香蕉', 'orange']</span>

<span class="hljs-comment"># 列表长度</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(my_list))  <span class="hljs-comment"># 输出: 6</span>
</code></pre>
<h3 data-id="heading-19">4. 元组（Tuple）</h3>
<p>元组是不可变的列表，使用圆括号 <code>()</code> 定义，一旦创建就不能修改。</p>
<h4 data-id="heading-20">元组特点</h4>
<ul>
<li>不可变性：创建后不能修改元素</li>
<li>可以存储不同类型的数据</li>
<li>可以通过索引访问元素</li>
<li>可以使用 <code>len()</code>、<code>max()</code>、<code>min()</code> 等函数</li>
</ul>
<h4 data-id="heading-21">代码示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建元组</span>
tuple1 = (1, 2, 3, 4, 5, <span class="hljs-string">"香蕉"</span>)
<span class="hljs-built_in">print</span>(tuple1)  <span class="hljs-comment"># 输出: (1, 2, 3, 4, 5, '香蕉')</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(tuple1))  <span class="hljs-comment"># 输出: &lt;class 'tuple'&gt;</span>

<span class="hljs-comment"># 访问元素</span>
<span class="hljs-built_in">print</span>(tuple1[0])  <span class="hljs-comment"># 输出: 1</span>
<span class="hljs-built_in">print</span>(tuple1[-1])  <span class="hljs-comment"># 输出: 香蕉</span>

<span class="hljs-comment"># 元组不可修改</span>
<span class="hljs-comment"># tuple1[0] = 100  # 这行代码会引发 TypeError</span>

<span class="hljs-comment"># 遍历元组</span>
<span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> tuple1:
    <span class="hljs-built_in">print</span>(item)
</code></pre>
<h3 data-id="heading-22">5. 字典（Dictionary）</h3>
<p>字典是键值对（key-value）的无序集合，使用大括号 <code>{}</code> 定义，键必须是唯一的。</p>
<h4 data-id="heading-23">字典操作方法</h4>























































<table><thead><tr><th>操作</th><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>访问值</td><td><code>dict[key]</code></td><td>通过键访问值，键不存在会引发 KeyError</td></tr><tr><td>安全访问</td><td><code>dict.get(key, default)</code></td><td>键不存在返回默认值</td></tr><tr><td>添加/修改</td><td><code>dict[key] = value</code></td><td>键不存在则添加，存在则修改</td></tr><tr><td>删除键</td><td><code>del dict[key]</code></td><td>删除指定键值对</td></tr><tr><td>查看键</td><td><code>dict.keys()</code></td><td>返回所有键的列表</td></tr><tr><td>查看值</td><td><code>dict.values()</code></td><td>返回所有值的列表</td></tr><tr><td>查看键值对</td><td><code>dict.items()</code></td><td>返回所有键值对的列表</td></tr><tr><td>检查键存在</td><td><code>key in dict</code></td><td>返回布尔值</td></tr><tr><td>长度</td><td><code>len(dict)</code></td><td>返回键值对数量</td></tr></tbody></table>
<h4 data-id="heading-24">代码示例</h4>
<pre><code class="hljs language-css" lang="css"># 创建字典
person = {"name": <span class="hljs-string">"张三"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">18</span>, <span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>}
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">18</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>}
print(type(person))  # 输出: &lt;class <span class="hljs-string">'dict'</span>&gt;

# 访问值
<span class="hljs-built_in">print</span>(person[<span class="hljs-string">"name"</span>])  # 输出: 张三
<span class="hljs-built_in">print</span>(person.<span class="hljs-built_in">get</span>(<span class="hljs-string">"age"</span>))  # 输出: <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(person.<span class="hljs-built_in">get</span>(<span class="hljs-string">"address"</span>, <span class="hljs-string">"未知"</span>))  # 输出: 未知（键不存在）

# 修改值
person[<span class="hljs-string">"age"</span>] = <span class="hljs-number">19</span>
<span class="hljs-built_in">print</span>(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>}

# 添加新键值对
person<span class="hljs-selector-attr">[<span class="hljs-string">"address"</span>]</span> = "北京"
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>, <span class="hljs-string">'address'</span>: <span class="hljs-string">'北京'</span>}

# 删除键值对
<span class="hljs-selector-tag">del</span> person<span class="hljs-selector-attr">[<span class="hljs-string">"gender"</span>]</span>
print(person)  # 输出: {'name': <span class="hljs-string">'张三'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">19</span>, <span class="hljs-string">'address'</span>: <span class="hljs-string">'北京'</span>}

# 遍历字典
for key in person:
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"{key}: {person[key]}"</span>)

for key, value in person.<span class="hljs-built_in">items</span>():
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"{key}: {value}"</span>)

# 检查键是否存在
<span class="hljs-built_in">print</span>(<span class="hljs-string">"name"</span> in person)  # 输出: True
<span class="hljs-built_in">print</span>(<span class="hljs-string">"gender"</span> in person)  # 输出: False

# 字典长度
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(person))  # 输出: <span class="hljs-number">3</span>
</code></pre>
<h3 data-id="heading-25">6. 条件判断（if）</h3>
<p>条件判断用于根据不同条件执行不同的代码块。</p>
<h4 data-id="heading-26">语法结构</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span> 条件1:
    <span class="hljs-comment"># 条件1为True时执行</span>
<span class="hljs-keyword">elif</span> 条件2:
    <span class="hljs-comment"># 条件1为False且条件2为True时执行</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># 所有条件都为False时执行</span>
</code></pre>
<h4 data-id="heading-27">代码示例</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 基本条件判断</span>
age = 7
<span class="hljs-keyword">if</span> age &gt;= 18:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"成年人"</span>)
<span class="hljs-keyword">elif</span> age &gt;= 6:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"小学生"</span>)  <span class="hljs-comment"># 输出: 小学生</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"未成年人"</span>)

<span class="hljs-comment"># 多个条件</span>
score = 85
<span class="hljs-keyword">if</span> score &gt;= 90:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"优秀"</span>)
<span class="hljs-keyword">elif</span> score &gt;= 80:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"良好"</span>)  <span class="hljs-comment"># 输出: 良好</span>
<span class="hljs-keyword">elif</span> score &gt;= 60:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"及格"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"不及格"</span>)
</code></pre>
<h3 data-id="heading-28">7. 循环结构</h3>
<h4 data-id="heading-29">7.1 for 循环</h4>
<p>for 循环用于遍历可迭代对象（如列表、元组、字符串等）。</p>
<h5 data-id="heading-30">语法结构</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> 变量 <span class="hljs-keyword">in</span> 可迭代对象:
    <span class="hljs-comment"># 循环体</span>
</code></pre>
<h5 data-id="heading-31">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 遍历列表</span>
fruits = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>]
<span class="hljs-keyword">for</span> fruit <span class="hljs-keyword">in</span> fruits:
    <span class="hljs-built_in">print</span>(fruit)

<span class="hljs-comment"># 使用 range() 函数</span>
<span class="hljs-comment"># range(10) 生成 0-9 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)

<span class="hljs-comment"># range(start, end) 生成 start 到 end-1 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 6, 7, 8, 9</span>

<span class="hljs-comment"># range(start, end, step) 生成指定步长的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 0, 2, 4, 6, 8</span>

<span class="hljs-comment"># 累加计算</span>
sum_result = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
    sum_result += i
    <span class="hljs-built_in">print</span>(sum_result)
</code></pre>
<h4 data-id="heading-32">7.2 while 循环</h4>
<p>while 循环用于在条件为 True 时重复执行代码块。</p>
<h5 data-id="heading-33">语法结构</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">while</span> 条件:
    <span class="hljs-comment"># 循环体</span>
</code></pre>
<h5 data-id="heading-34">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本 while 循环</span>
count = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> count &lt; <span class="hljs-number">5</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"count: <span class="hljs-subst">{count}</span>"</span>)
    count += <span class="hljs-number">1</span>

<span class="hljs-comment"># 无限循环（谨慎使用）</span>
<span class="hljs-comment"># while True:</span>
<span class="hljs-comment">#     print("这是无限循环")</span>

<span class="hljs-comment"># 循环嵌套</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"i=<span class="hljs-subst">{i}</span>, j=<span class="hljs-subst">{j}</span>"</span>)
</code></pre>
<h3 data-id="heading-35">8. 函数定义与调用</h3>
<p>函数是可重用的代码块，使用 <code>def</code> 关键字定义。</p>
<h4 data-id="heading-36">函数语法</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">函数名</span>(<span class="hljs-params">参数<span class="hljs-number">1</span>, 参数<span class="hljs-number">2</span>=默认值</span>):
    <span class="hljs-comment"># 函数体</span>
    <span class="hljs-keyword">return</span> 返回值
</code></pre>
<h4 data-id="heading-37">函数特点</h4>
<ul>
<li>函数可以有多个参数，支持默认值</li>
<li>函数可以返回一个或多个值</li>
<li>函数内部变量的作用域是局部的</li>
<li>函数外部变量是全局的，可通过 <code>global</code> 关键字在函数内部修改</li>
</ul>
<h4 data-id="heading-38">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本函数定义</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">name=<span class="hljs-string">"张三"</span></span>):
    <span class="hljs-string">"""这是函数的文档字符串，用于说明函数功能"""</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello, <span class="hljs-subst">{name}</span>!"</span>

<span class="hljs-comment"># 调用函数</span>
<span class="hljs-built_in">print</span>(say_hello())  <span class="hljs-comment"># 输出: Hello, 张三!</span>
<span class="hljs-built_in">print</span>(say_hello(<span class="hljs-string">"李四"</span>))  <span class="hljs-comment"># 输出: Hello, 李四!</span>

<span class="hljs-comment"># 带多个参数的函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># 输出: 8</span>

<span class="hljs-comment"># 函数内部的作用域</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_scope</span>():
    local_var = <span class="hljs-string">"局部变量"</span>
    <span class="hljs-built_in">print</span>(local_var)  <span class="hljs-comment"># 可以访问局部变量</span>

<span class="hljs-comment"># print(local_var)  # 这行代码会引发 NameError，因为局部变量在函数外部不可访问</span>

<span class="hljs-comment"># 使用全局变量</span>
global_var = <span class="hljs-string">"全局变量"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_global</span>():
    <span class="hljs-keyword">global</span> global_var  <span class="hljs-comment"># 声明使用全局变量</span>
    global_var = <span class="hljs-string">"修改后的全局变量"</span>
    <span class="hljs-built_in">print</span>(global_var)

test_global()  <span class="hljs-comment"># 输出: 修改后的全局变量</span>
<span class="hljs-built_in">print</span>(global_var)  <span class="hljs-comment"># 输出: 修改后的全局变量</span>

<span class="hljs-comment"># 函数返回多个值</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_info</span>():
    name = <span class="hljs-string">"张三"</span>
    age = <span class="hljs-number">18</span>
    <span class="hljs-keyword">return</span> name, age

user_name, user_age = get_user_info()
<span class="hljs-built_in">print</span>(user_name, user_age)  <span class="hljs-comment"># 输出: 张三 18</span>
</code></pre>
<h3 data-id="heading-39">9. 面向对象编程</h3>
<p>Python 是面向对象的编程语言，支持类和对象的概念。</p>
<h4 data-id="heading-40">类的基本概念</h4>
<ul>
<li><strong>类（Class）</strong> ：对象的蓝图，定义了对象的属性和方法</li>
<li><strong>对象（Object）</strong> ：类的实例</li>
<li><strong>属性（Attribute）</strong> ：对象的特征</li>
<li><strong>方法（Method）</strong> ：对象的行为</li>
<li><strong>self</strong>：代表类的实例，必须是方法的第一个参数</li>
</ul>
<h4 data-id="heading-41">类的语法</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">类名</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 参数<span class="hljs-number">1</span>, 参数<span class="hljs-number">2</span></span>):
        <span class="hljs-comment"># 初始化方法，创建对象时自动调用</span>
        self.属性<span class="hljs-number">1</span> = 参数<span class="hljs-number">1</span>
        self.属性<span class="hljs-number">2</span> = 参数<span class="hljs-number">2</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">方法名</span>(<span class="hljs-params">self, 参数</span>):
        <span class="hljs-comment"># 方法体</span>
        <span class="hljs-keyword">return</span> 返回值
</code></pre>
<h4 data-id="heading-42">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-string">"""人员类"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-string">"""初始化方法"""</span>
        self.name = name  <span class="hljs-comment"># 实例属性</span>
        self.age = age

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self, sex=<span class="hljs-string">"男"</span></span>):
        <span class="hljs-string">"""打招呼方法"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello, <span class="hljs-subst">{self.name}</span>！性别：<span class="hljs-subst">{sex}</span>"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">birthday</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""过生日方法，年龄加1"""</span>
        self.age += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>今年<span class="hljs-subst">{self.age}</span>岁了！"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_age</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""获取年龄方法"""</span>
        <span class="hljs-keyword">return</span> self.age

<span class="hljs-comment"># 创建对象（实例化）</span>
person1 = Person(<span class="hljs-string">"张三"</span>, <span class="hljs-number">18</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(person1))  <span class="hljs-comment"># 输出: &lt;class '__main__.Person'&gt;</span>

<span class="hljs-comment"># 调用对象方法</span>
<span class="hljs-built_in">print</span>(person1.say_hello())  <span class="hljs-comment"># 输出: Hello, 张三！性别：男</span>
<span class="hljs-built_in">print</span>(person1.say_hello(<span class="hljs-string">"女"</span>))  <span class="hljs-comment"># 输出: Hello, 张三！性别：女</span>

<span class="hljs-comment"># 调用修改属性的方法</span>
<span class="hljs-built_in">print</span>(person1.birthday())  <span class="hljs-comment"># 输出: 张三今年19岁了！</span>
<span class="hljs-built_in">print</span>(person1.get_age())  <span class="hljs-comment"># 输出: 19</span>

<span class="hljs-comment"># 直接访问属性</span>
<span class="hljs-built_in">print</span>(person1.name)  <span class="hljs-comment"># 输出: 张三</span>
<span class="hljs-built_in">print</span>(person1.age)  <span class="hljs-comment"># 输出: 19</span>
</code></pre>
<h4 data-id="heading-43">9.1 类继承</h4>
<p>类继承允许创建一个新类（子类），继承现有类（父类）的属性和方法。子类可以扩展或修改父类的功能。</p>
<h5 data-id="heading-44">继承语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">子类名</span>(<span class="hljs-title class_ inherited__">父类名</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 父类参数, 子类参数</span>):
        <span class="hljs-built_in">super</span>().__init__(父类参数)  <span class="hljs-comment"># 调用父类的初始化方法</span>
        self.子类属性 = 子类参数

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">子类方法</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 子类方法实现</span>
        <span class="hljs-keyword">return</span> 结果
</code></pre>
<h5 data-id="heading-45">继承特点</h5>
<ul>
<li>子类继承父类的所有属性和方法</li>
<li>子类可以重写父类的方法</li>
<li>子类可以添加新的属性和方法</li>
<li>使用 <code>super()</code> 调用父类的方法</li>
</ul>
<h5 data-id="heading-46">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义父类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mammal</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, sex</span>):
        self.name = name
        self.sex = sex
        self.num_eyes = <span class="hljs-number">2</span>  <span class="hljs-comment"># 所有哺乳动物都有2只眼睛</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">breathe</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>在呼吸"</span>)

<span class="hljs-comment"># 定义子类，继承自Mammal</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">Mammal</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, sex, occupation</span>):
        <span class="hljs-comment"># 调用父类的初始化方法，继承父类的属性</span>
        <span class="hljs-built_in">super</span>().__init__(name, sex)
        <span class="hljs-comment"># 添加子类独有的属性</span>
        self.occupation = occupation

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">work</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 子类独有的方法</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>正在工作，职业是<span class="hljs-subst">{self.occupation}</span>"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">breathe</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 重写父类的方法</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>正在用鼻子呼吸"</span>)

<span class="hljs-comment"># 测试继承</span>
<span class="hljs-comment"># 如果子类没有自己的构造函数 __init__，会直接调用父类的构造函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-title class_ inherited__">Mammal</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bark</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>在汪汪叫"</span>)

<span class="hljs-comment"># 创建子类实例</span>
person = Person(<span class="hljs-string">"张三"</span>, <span class="hljs-string">"男"</span>, <span class="hljs-string">"程序员"</span>)
dog = Dog(<span class="hljs-string">"旺财"</span>, <span class="hljs-string">"公"</span>)

<span class="hljs-comment"># 调用继承的属性和方法</span>
<span class="hljs-built_in">print</span>(person.name)  <span class="hljs-comment"># 继承自父类的属性</span>
<span class="hljs-built_in">print</span>(person.num_eyes)  <span class="hljs-comment"># 继承自父类的属性</span>
person.breathe()  <span class="hljs-comment"># 调用重写后的方法</span>
person.work()  <span class="hljs-comment"># 调用子类独有的方法</span>

dog.breathe()  <span class="hljs-comment"># 调用父类的方法</span>
</code></pre>
<h3 data-id="heading-47">10. 数学计算（Math 模块）</h3>
<p>Python 的 <code>math</code> 模块提供了丰富的数学函数。</p>
<h4 data-id="heading-48">常用数学函数</h4>





















































































<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>math.sqrt(x)</code></td><td>平方根</td><td><code>math.sqrt(16)</code> → 4.0</td></tr><tr><td><code>math.ceil(x)</code></td><td>向上取整</td><td><code>math.ceil(3.14)</code> → 4</td></tr><tr><td><code>math.floor(x)</code></td><td>向下取整</td><td><code>math.floor(3.14)</code> → 3</td></tr><tr><td><code>math.pow(x, y)</code></td><td>x 的 y 次方</td><td><code>math.pow(2, 3)</code> → 8.0</td></tr><tr><td><code>math.fabs(x)</code></td><td>绝对值</td><td><code>math.fabs(-10)</code> → 10.0</td></tr><tr><td><code>math.gcd(x, y)</code></td><td>最大公约数</td><td><code>math.gcd(12, 18)</code> → 6</td></tr><tr><td><code>math.lcm(x, y)</code></td><td>最小公倍数</td><td><code>math.lcm(12, 18)</code> → 36</td></tr><tr><td><code>math.sin(x)</code></td><td>正弦函数（弧度）</td><td><code>math.sin(math.pi/2)</code> → 1.0</td></tr><tr><td><code>math.cos(x)</code></td><td>余弦函数（弧度）</td><td><code>math.cos(math.pi)</code> → -1.0</td></tr><tr><td><code>math.tan(x)</code></td><td>正切函数（弧度）</td><td><code>math.tan(math.pi/4)</code> → 1.0</td></tr><tr><td><code>math.degrees(x)</code></td><td>弧度转角度</td><td><code>math.degrees(math.pi/2)</code> → 90.0</td></tr><tr><td><code>math.radians(x)</code></td><td>角度转弧度</td><td><code>math.radians(90)</code> → 1.570796...</td></tr><tr><td><code>math.log(x)</code></td><td>自然对数</td><td><code>math.log(math.e)</code> → 1.0</td></tr><tr><td><code>math.log10(x)</code></td><td>以10为底的对数</td><td><code>math.log10(100)</code> → 2.0</td></tr><tr><td><code>math.exp(x)</code></td><td>e 的 x 次方</td><td><code>math.exp(1)</code> → 2.71828...</td></tr></tbody></table>
<h4 data-id="heading-49">常量</h4>
<ul>
<li><code>math.pi</code>：圆周率 π（约3.14159...）</li>
<li><code>math.e</code>：自然常数 e（约2.71828...）</li>
</ul>
<h4 data-id="heading-50">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math

<span class="hljs-comment"># 平方根</span>
<span class="hljs-built_in">print</span>(math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># 输出: 4.0</span>

<span class="hljs-comment"># 取整</span>
<span class="hljs-built_in">print</span>(math.ceil(<span class="hljs-number">3.14</span>))  <span class="hljs-comment"># 输出: 4</span>
<span class="hljs-built_in">print</span>(math.floor(<span class="hljs-number">3.14</span>))  <span class="hljs-comment"># 输出: 3</span>

<span class="hljs-comment"># 幂运算</span>
<span class="hljs-built_in">print</span>(math.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出: 8.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-number">2</span> ** <span class="hljs-number">3</span>)  <span class="hljs-comment"># 输出: 8（Python 内置幂运算）</span>

<span class="hljs-comment"># 绝对值</span>
<span class="hljs-built_in">print</span>(math.fabs(-<span class="hljs-number">10</span>))  <span class="hljs-comment"># 输出: 10.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">abs</span>(-<span class="hljs-number">10</span>))  <span class="hljs-comment"># 输出: 10（Python 内置绝对值）</span>

<span class="hljs-comment"># 最大公约数和最小公倍数</span>
<span class="hljs-built_in">print</span>(math.gcd(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>))  <span class="hljs-comment"># 输出: 6</span>
<span class="hljs-built_in">print</span>(math.lcm(<span class="hljs-number">12</span>, <span class="hljs-number">18</span>))  <span class="hljs-comment"># 输出: 36</span>

<span class="hljs-comment"># 三角函数（使用弧度）</span>
<span class="hljs-built_in">print</span>(math.sin(math.pi / <span class="hljs-number">2</span>))  <span class="hljs-comment"># 输出: 1.0</span>
<span class="hljs-built_in">print</span>(math.cos(math.pi))  <span class="hljs-comment"># 输出: -1.0</span>

<span class="hljs-comment"># 角度转换</span>
<span class="hljs-built_in">print</span>(math.degrees(math.pi / <span class="hljs-number">2</span>))  <span class="hljs-comment"># 输出: 90.0</span>
<span class="hljs-built_in">print</span>(math.radians(<span class="hljs-number">90</span>))  <span class="hljs-comment"># 输出: 1.5707963267948966</span>

<span class="hljs-comment"># 对数</span>
<span class="hljs-built_in">print</span>(math.log(math.e))  <span class="hljs-comment"># 输出: 1.0</span>
<span class="hljs-built_in">print</span>(math.log10(<span class="hljs-number">100</span>))  <span class="hljs-comment"># 输出: 2.0</span>

<span class="hljs-comment"># 常量</span>
<span class="hljs-built_in">print</span>(math.pi)  <span class="hljs-comment"># 输出: 3.141592653589793</span>
<span class="hljs-built_in">print</span>(math.e)  <span class="hljs-comment"># 输出: 2.718281828459045</span>
</code></pre>
<h3 data-id="heading-51">11. 输入输出（Input/Output）</h3>
<h4 data-id="heading-52">输入函数（input）</h4>
<p><code>input()</code> 函数用于从控制台获取用户输入，返回值是字符串类型。</p>
<h4 data-id="heading-53">输出函数（print）</h4>
<p><code>print()</code> 函数用于将内容输出到控制台，支持多个参数和格式化输出。</p>
<h4 data-id="heading-54">类型转换</h4>






























<table><thead><tr><th>函数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>int(x)</code></td><td>转换为整数</td><td><code>int("123")</code> → 123</td></tr><tr><td><code>float(x)</code></td><td>转换为浮点数</td><td><code>float("3.14")</code> → 3.14</td></tr><tr><td><code>str(x)</code></td><td>转换为字符串</td><td><code>str(123)</code> → "123"</td></tr><tr><td><code>list(x)</code></td><td>转换为列表</td><td><code>list("abc")</code> → ["a", "b", "c"]</td></tr></tbody></table>
<h4 data-id="heading-55">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本输入输出</span>
name = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的姓名："</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的姓名是：<span class="hljs-subst">{name}</span>"</span>)

<span class="hljs-comment"># 输入数字并转换类型</span>
age_str = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的年龄："</span>)
age = <span class="hljs-built_in">int</span>(age_str)  <span class="hljs-comment"># 转换为整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您明年将满 <span class="hljs-subst">{age + <span class="hljs-number">1</span>}</span> 岁"</span>)

<span class="hljs-comment"># 多个输入</span>
height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的身高（米）："</span>))
weight = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的体重（千克）："</span>))

<span class="hljs-comment"># BMI 计算</span>
bmi = weight / (height ** <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的 BMI 指数是：<span class="hljs-subst">{bmi:<span class="hljs-number">.2</span>f}</span>"</span>)

<span class="hljs-comment"># 类型转换示例</span>
num1 = <span class="hljs-number">123</span>
num2 = <span class="hljs-string">"456"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(num1) + num2)  <span class="hljs-comment"># 输出: 123456（字符串拼接）</span>
<span class="hljs-built_in">print</span>(num1 + <span class="hljs-built_in">int</span>(num2))  <span class="hljs-comment"># 输出: 579（整数相加）</span>
</code></pre>
<h3 data-id="heading-56">12. 字符串格式化</h3>
<p>Python 提供了多种字符串格式化方式，常用的有：</p>
<h4 data-id="heading-57">1. f-strings（Python 3.6+）</h4>
<p>使用 <code>f"{变量}"</code> 语法，简洁高效。</p>
<h4 data-id="heading-58">2. format() 方法</h4>
<p>使用 <code>"{}".format()</code> 语法，兼容性好。</p>
<h4 data-id="heading-59">3. 百分号（%）格式化</h4>
<p>传统的格式化方式，类似 C 语言的 printf。</p>
<h4 data-id="heading-60">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># f-strings 格式化</span>
name = <span class="hljs-string">"张三"</span>
age = <span class="hljs-number">18</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"我叫<span class="hljs-subst">{name}</span>，今年<span class="hljs-subst">{age}</span>岁"</span>)  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>

<span class="hljs-comment"># 格式化数字</span>
pi = <span class="hljs-number">3.1415926</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"π的值是：<span class="hljs-subst">{pi:<span class="hljs-number">.2</span>f}</span>"</span>)  <span class="hljs-comment"># 输出: π的值是：3.14</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"π的值是：<span class="hljs-subst">{pi:<span class="hljs-number">10.3</span>f}</span>"</span>)  <span class="hljs-comment"># 输出: π的值是：     3.142（总宽度10，右对齐）</span>

<span class="hljs-comment"># format() 方法</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{}，今年{}岁"</span>.<span class="hljs-built_in">format</span>(name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{0}，今年{1}岁，{0}很优秀"</span>.<span class="hljs-built_in">format</span>(name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁，张三很优秀</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫{name}，今年{age}岁"</span>.<span class="hljs-built_in">format</span>(name=<span class="hljs-string">"李四"</span>, age=<span class="hljs-number">20</span>))  <span class="hljs-comment"># 输出: 我叫李四，今年20岁</span>

<span class="hljs-comment"># 百分号格式化</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"我叫%s，今年%d岁"</span> % (name, age))  <span class="hljs-comment"># 输出: 我叫张三，今年18岁</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"π的值是：%.2f"</span> % pi)  <span class="hljs-comment"># 输出: π的值是：3.14</span>

<span class="hljs-comment"># 多行字符串（保留格式）</span>
multi_line = <span class="hljs-string">"""这是第一行
这是第二行
这是第三行"""</span>
<span class="hljs-built_in">print</span>(multi_line)
</code></pre>
<h4 data-id="heading-61">数字格式化说明符</h4>























































<table><thead><tr><th>说明符</th><th>功能</th><th>示例</th></tr></thead><tbody><tr><td><code>:f</code></td><td>浮点数，默认6位小数</td><td><code>{3.14:f}</code> → 3.140000</td></tr><tr><td><code>:.1f</code></td><td>保留1位小数</td><td><code>{3.14:.1f}</code> → 3.1</td></tr><tr><td><code>:.2f</code></td><td>保留2位小数</td><td><code>{3.14:.2f}</code> → 3.14</td></tr><tr><td><code>:10.2f</code></td><td>总宽度10，保留2位小数</td><td><code>{3.14:10.2f}</code> → " 3.14"</td></tr><tr><td><code>:d</code></td><td>整数</td><td><code>{123:d}</code> → 123</td></tr><tr><td><code>:s</code></td><td>字符串</td><td><code>{"abc":s}</code> → abc</td></tr><tr><td><code>:0&gt;5d</code></td><td>宽度5，不足补0，右对齐</td><td><code>{12:0&gt;5d}</code> → 00012</td></tr><tr><td><code>:0&lt;5d</code></td><td>宽度5，不足补0，左对齐</td><td><code>{12:0&lt;5d}</code> → 12000</td></tr><tr><td><code>:^5d</code></td><td>宽度5，居中对齐</td><td><code>{12:^5d}</code> → " 12 "</td></tr></tbody></table>
<h3 data-id="heading-62">13. range() 函数</h3>
<p><code>range()</code> 函数用于生成整数序列，常用于 for 循环中。</p>
<h4 data-id="heading-63">语法</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">range</span>(stop)  # 生成 <span class="hljs-number">0</span> 到 stop<span class="hljs-number">-1</span> 的整数
<span class="hljs-built_in">range</span>(start, stop)  # 生成 start 到 stop<span class="hljs-number">-1</span> 的整数
<span class="hljs-built_in">range</span>(start, stop, step)  # 生成指定步长的整数序列
</code></pre>
<h4 data-id="heading-64">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 生成 0-4 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 0, 1, 2, 3, 4</span>

<span class="hljs-comment"># 生成 5-9 的整数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 6, 7, 8, 9</span>

<span class="hljs-comment"># 生成 5-19 的奇数</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">2</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 5, 7, 9, 11, 13, 15, 17, 19</span>

<span class="hljs-comment"># 生成倒序序列</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):
    <span class="hljs-built_in">print</span>(i)  <span class="hljs-comment"># 输出: 10, 9, 8, 7, 6, 5, 4, 3, 2, 1</span>

<span class="hljs-comment"># 将 range 转换为列表</span>
numbers = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(numbers)  <span class="hljs-comment"># 输出: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span>
</code></pre>
<h3 data-id="heading-65">14. 文件操作</h3>
<h4 data-id="heading-66">14.1 文件路径</h4>
<p>文件路径用于定位文件在计算机中的位置，主要有两种类型：</p>
<h5 data-id="heading-67">相对路径</h5>
<p>相对于当前工作目录的路径，不需要完整路径信息。</p>

























<table><thead><tr><th>符号</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>.</code></td><td>当前目录</td><td><code>./file.txt</code></td></tr><tr><td><code>..</code></td><td>上级目录</td><td><code>../file.txt</code></td></tr><tr><td><code>/</code></td><td>目录分隔符</td><td><code>./subdir/file.txt</code></td></tr></tbody></table>
<h5 data-id="heading-68">绝对路径</h5>
<p>从根目录开始的完整路径，包含所有目录层级。</p>

















<table><thead><tr><th>系统</th><th>示例</th></tr></thead><tbody><tr><td>Windows</td><td><code>C:\Users\username\Desktop\file.txt</code></td></tr><tr><td>Linux/macOS</td><td><code>/home/username/Desktop/file.txt</code></td></tr></tbody></table>
<h4 data-id="heading-69">14.2 读取文件</h4>
<p>使用 <code>open()</code> 函数打开文件，返回一个文件对象。</p>
<h5 data-id="heading-70">open() 函数语法</h5>
<pre><code class="hljs language-ini" lang="ini">open(file_path, <span class="hljs-attr">mode</span>=<span class="hljs-string">'r'</span>, encoding=None)
</code></pre>





















<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>file_path</code></td><td>文件路径（相对或绝对）</td></tr><tr><td><code>mode</code></td><td>文件打开模式（默认为只读 <code>'r'</code>）</td></tr><tr><td><code>encoding</code></td><td>文件编码（如 <code>'utf-8'</code>）</td></tr></tbody></table>
<h5 data-id="heading-71">文件打开模式</h5>





































<table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td><code>r</code></td><td>只读模式（默认）</td></tr><tr><td><code>w</code></td><td>只写模式，覆盖原有内容，文件不存在则创建</td></tr><tr><td><code>a</code></td><td>追加模式，在文件末尾添加内容</td></tr><tr><td><code>r+</code></td><td>读写模式，从文件开头开始</td></tr><tr><td><code>w+</code></td><td>读写模式，覆盖原有内容</td></tr><tr><td><code>a+</code></td><td>读写模式，在文件末尾追加</td></tr><tr><td><code>b</code></td><td>二进制模式（如 <code>'rb'</code>、<code>'wb'</code>）</td></tr></tbody></table>
<h5 data-id="heading-72">文件读取方法</h5>

























<table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>read()</code></td><td>读取整个文件内容，返回字符串</td></tr><tr><td><code>read(size)</code></td><td>读取指定字节数，返回字符串</td></tr><tr><td><code>readline()</code></td><td>读取一行内容，返回字符串</td></tr><tr><td><code>readlines()</code></td><td>读取所有行，返回列表</td></tr></tbody></table>
<h5 data-id="heading-73">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 基本读取</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)

<span class="hljs-comment"># 2. 逐行读取（适合大文件）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    line = f.readline()
    <span class="hljs-keyword">while</span> line:
        <span class="hljs-built_in">print</span>(line.strip())
        line = f.readline()

<span class="hljs-comment"># 3. 读取所有行到列表</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    lines = f.readlines()
    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
        <span class="hljs-built_in">print</span>(line.strip())

<span class="hljs-comment"># 4. 读取指定字节数</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    <span class="hljs-built_in">print</span>(f.read(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 读取前10个字符</span>
    <span class="hljs-built_in">print</span>(f.read(<span class="hljs-number">10</span>))  <span class="hljs-comment"># 继续读取接下来的10个字符</span>
</code></pre>
<h4 data-id="heading-74">14.3 文件写入</h4>
<h5 data-id="heading-75">基本写入</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 覆盖写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.write(<span class="hljs-string">'Hello, World!\n'</span>)
    f.write(<span class="hljs-string">'这是第二行\n'</span>)

<span class="hljs-comment"># 追加写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'a'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.write(<span class="hljs-string">'这是追加的一行\n'</span>)

<span class="hljs-comment"># 写入多行</span>
lines = [<span class="hljs-string">'第一行'</span>, <span class="hljs-string">'第二行'</span>, <span class="hljs-string">'第三行'</span>]
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
    f.writelines([line + <span class="hljs-string">'\n'</span> <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines])
</code></pre>
<h4 data-id="heading-76">14.4 文件关闭</h4>
<p>文件使用完毕后必须关闭，否则会占用系统资源。</p>
<h5 data-id="heading-77">两种关闭方式</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 显式关闭</span>
f = <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>)
<span class="hljs-keyword">try</span>:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-keyword">finally</span>:
    f.close()  <span class="hljs-comment"># 确保文件被关闭</span>

<span class="hljs-comment"># 2. 使用 with 语句（推荐）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'./test.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:
    content = f.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-comment"># with 语句会自动关闭文件，无需手动调用 close()</span>
</code></pre>
<h3 data-id="heading-78">15. 异常处理</h3>
<h4 data-id="heading-79">15.1 try-except 语句</h4>
<p>用于捕获和处理程序运行时的异常。</p>
<h5 data-id="heading-80">基本语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 可能引发异常的代码</span>
    result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span>
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># 处理特定异常</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"除数不能为零"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># 处理所有其他异常</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发生了异常: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># 没有异常时执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"执行成功"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 无论是否有异常都会执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"清理资源"</span>)
</code></pre>
<h5 data-id="heading-81">常见异常类型</h5>

































<table><thead><tr><th>异常类型</th><th>描述</th></tr></thead><tbody><tr><td><code>ZeroDivisionError</code></td><td>除数为零</td></tr><tr><td><code>ValueError</code></td><td>值错误</td></tr><tr><td><code>TypeError</code></td><td>类型错误</td></tr><tr><td><code>FileNotFoundError</code></td><td>文件未找到</td></tr><tr><td><code>IndexError</code></td><td>索引越界</td></tr><tr><td><code>KeyError</code></td><td>字典键不存在</td></tr></tbody></table>
<h5 data-id="heading-82">异常处理示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    user_weight = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的体重(单位:kg): "</span>))
    user_height = <span class="hljs-built_in">float</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入您的身高(单位:m): "</span>))
    <span class="hljs-keyword">if</span> user_height &lt;= <span class="hljs-number">0</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"身高必须大于零"</span>)
    bmi = user_weight / (user_height ** <span class="hljs-number">2</span>)
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"输入错误: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:   <span class="hljs-comment"># 或者 except:</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发生了未知错误: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"您的BMI指数是: <span class="hljs-subst">{bmi:<span class="hljs-number">.2</span>f}</span>"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"程序执行完毕"</span>)
</code></pre>
<h4 data-id="heading-83">15.2 断言（assert）</h4>
<p>断言用于检查程序中的条件是否为真，如果为假则引发 <code>AssertionError</code>。</p>
<h5 data-id="heading-84">语法</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">assert</span> 条件, <span class="hljs-string">"错误消息"</span>
</code></pre>
<h5 data-id="heading-85">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本断言</span>
<span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(<span class="hljs-string">"hello"</span>) == <span class="hljs-number">5</span>, <span class="hljs-string">"字符串长度应为5"</span>

<span class="hljs-comment"># 断言在测试中的应用</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># 测试add函数</span>
<span class="hljs-keyword">assert</span> add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">3</span>, <span class="hljs-string">"1+2应该等于3"</span>
<span class="hljs-keyword">assert</span> add(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">"-1+1应该等于0"</span>
<span class="hljs-keyword">assert</span> add(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>) == <span class="hljs-number">0</span>, <span class="hljs-string">"0+0应该等于0"</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"所有断言通过！"</span>)
</code></pre>
<h5 data-id="heading-86">注意事项</h5>
<ul>
<li>断言主要用于开发和测试阶段</li>
<li>生产环境中可以通过 <code>-O</code> 选项关闭断言</li>
<li>断言失败会立即终止程序执行</li>
</ul>
<h3 data-id="heading-87">16. 单元测试（unittest）</h3>
<h4 data-id="heading-88">16.1 什么是单元测试</h4>
<p>单元测试是对程序中最小可测试单元（如函数、方法）进行的测试。</p>
<h4 data-id="heading-89">16.2 使用 unittest 框架</h4>
<h5 data-id="heading-90">测试用例结构</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> unittest

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClassName</span>(unittest.TestCase):
    <span class="hljs-string">"""测试类"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""每个测试方法执行前调用"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tearDown</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""每个测试方法执行后调用"""</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_method_name</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试方法，必须以test_开头"""</span>
        <span class="hljs-comment"># 断言语句</span>
        self.assertEqual(<span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
</code></pre>
<h5 data-id="heading-91">常用断言方法</h5>









































<table><thead><tr><th>断言方法</th><th>描述</th></tr></thead><tbody><tr><td><code>assertEqual(a, b)</code></td><td>验证 a == b</td></tr><tr><td><code>assertNotEqual(a, b)</code></td><td>验证 a != b</td></tr><tr><td><code>assertTrue(x)</code></td><td>验证 x 为 True</td></tr><tr><td><code>assertFalse(x)</code></td><td>验证 x 为 False</td></tr><tr><td><code>assertAlmostEqual(a, b)</code></td><td>验证浮点数近似相等</td></tr><tr><td><code>assertRaises(exception, callable, *args, **kwds)</code></td><td>验证调用可调用对象会引发指定异常</td></tr><tr><td><code>assertIn(item, container)</code></td><td>验证 item 在 container 中</td></tr><tr><td><code>assertNotIn(item, container)</code></td><td>验证 item 不在 container 中</td></tr></tbody></table>
<h5 data-id="heading-92">完整测试示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># calculator.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a + b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a - b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">return</span> a * b

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">self, a, b</span>):
        <span class="hljs-keyword">if</span> b == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"除数不能为零"</span>)
        <span class="hljs-keyword">return</span> a / b

<span class="hljs-comment"># test_calculator.py</span>
<span class="hljs-keyword">import</span> unittest
<span class="hljs-keyword">from</span> calculator <span class="hljs-keyword">import</span> Calculator

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCalculator</span>(unittest.TestCase):
    <span class="hljs-string">"""测试计算器类"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUp</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试前的准备工作"""</span>
        self.calc = Calculator()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n开始测试..."</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tearDown</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试后的清理工作"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"测试结束..."</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试加法功能"""</span>
        self.assertEqual(self.calc.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>), <span class="hljs-number">3</span>)
        self.assertEqual(self.calc.add(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), <span class="hljs-number">0</span>)
        self.assertEqual(self.calc.add(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-number">0</span>)
        self.assertAlmostEqual(self.calc.add(<span class="hljs-number">1.5</span>, <span class="hljs-number">2.5</span>), <span class="hljs-number">4.0</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_subtract</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试减法功能"""</span>
        self.assertEqual(self.calc.subtract(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>), <span class="hljs-number">2</span>)
        self.assertEqual(self.calc.subtract(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>), -<span class="hljs-number">2</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_multiply</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试乘法功能"""</span>
        self.assertEqual(self.calc.multiply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>)
        self.assertEqual(self.calc.multiply(-<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), -<span class="hljs-number">6</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_divide</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""测试除法功能"""</span>
        self.assertEqual(self.calc.divide(<span class="hljs-number">6</span>, <span class="hljs-number">3</span>), <span class="hljs-number">2</span>)
        self.assertEqual(self.calc.divide(<span class="hljs-number">5</span>, <span class="hljs-number">2</span>), <span class="hljs-number">2.5</span>)

        <span class="hljs-comment"># 测试除数为零的情况</span>
        <span class="hljs-keyword">with</span> self.assertRaises(ValueError):
            self.calc.divide(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    unittest.main()
</code></pre>
<h5 data-id="heading-93">运行测试用例</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法1：直接运行测试文件</span>
python test_calculator.py

<span class="hljs-comment"># 方法2：使用unittest模块运行</span>
python -m unittest test_calculator.py

<span class="hljs-comment"># 方法3：运行所有测试文件</span>
python -m unittest discover

<span class="hljs-comment"># 方法4：运行特定测试类</span>
python -m unittest test_calculator.TestCalculator

<span class="hljs-comment"># 方法5：运行特定测试方法</span>
python -m unittest test_calculator.TestCalculator.test_add
</code></pre>
<h4 data-id="heading-94">16.3 测试最佳实践</h4>
<ol>
<li>每个测试方法只测试一个功能</li>
<li>测试方法名应清晰描述测试内容</li>
<li>使用 setUp 和 tearDown 方法管理测试资源</li>
<li>测试覆盖正常情况和边界情况</li>
<li>测试应该是独立的，不依赖于其他测试</li>
</ol>
<h3 data-id="heading-95">17. 高阶函数和匿名函数</h3>
<h4 data-id="heading-96">17.1 高阶函数</h4>
<p>高阶函数是指可以接受函数作为参数，或者返回函数的函数。</p>
<h5 data-id="heading-97">常见高阶函数</h5>

























<table><thead><tr><th>函数</th><th>描述</th></tr></thead><tbody><tr><td><code>map(function, iterable)</code></td><td>对可迭代对象的每个元素应用函数</td></tr><tr><td><code>filter(function, iterable)</code></td><td>过滤可迭代对象，返回符合条件的元素</td></tr><tr><td><code>reduce(function, iterable)</code></td><td>对可迭代对象进行累积操作</td></tr><tr><td><code>sorted(iterable, key=None, reverse=False)</code></td><td>排序，可接受函数作为key</td></tr></tbody></table>
<h5 data-id="heading-98">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># map 示例：将列表中的每个元素平方</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
squared = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>, numbers))
<span class="hljs-built_in">print</span>(squared)  <span class="hljs-comment"># 输出: [1, 4, 9, 16, 25]</span>

<span class="hljs-comment"># filter 示例：筛选出偶数</span>
numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
evens = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, numbers))
<span class="hljs-built_in">print</span>(evens)  <span class="hljs-comment"># 输出: [2, 4, 6]</span>

<span class="hljs-comment"># sorted 示例：按字符串长度排序</span>
words = [<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"cherry"</span>, <span class="hljs-string">"date"</span>]
sorted_words = <span class="hljs-built_in">sorted</span>(words, key=<span class="hljs-built_in">len</span>)
<span class="hljs-built_in">print</span>(sorted_words)  <span class="hljs-comment"># 输出: ["date", "apple", "cherry", "banana"]</span>

<span class="hljs-comment"># 自定义高阶函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">apply_function</span>(<span class="hljs-params">func, x</span>):
    <span class="hljs-string">"""将函数应用于x"""</span>
    <span class="hljs-keyword">return</span> func(x)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">x</span>):
    <span class="hljs-string">"""计算平方"""</span>
    <span class="hljs-keyword">return</span> x ** <span class="hljs-number">2</span>

result = apply_function(square, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># 输出: 25</span>
</code></pre>
<h4 data-id="heading-99">17.2 匿名函数</h4>
<p>匿名函数是指没有名字的函数，使用 <code>lambda</code> 关键字定义。</p>
<h5 data-id="heading-100">语法</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">lambda</span> 参数: 表达式
</code></pre>
<h5 data-id="heading-101">代码示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基本使用</span>
square = <span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>
<span class="hljs-built_in">print</span>(square(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出: 9</span>

<span class="hljs-comment"># 作为高阶函数的参数</span>
doubled = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x * <span class="hljs-number">2</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]))
<span class="hljs-built_in">print</span>(doubled)  <span class="hljs-comment"># 输出: [2, 4, 6]</span>

<span class="hljs-comment"># 多个参数</span>
add = <span class="hljs-keyword">lambda</span> x, y: x + y
<span class="hljs-built_in">print</span>(add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出: 8</span>

<span class="hljs-comment"># 与条件表达式结合</span>
even_or_odd = <span class="hljs-keyword">lambda</span> x: <span class="hljs-string">"偶数"</span> <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"奇数"</span>
<span class="hljs-built_in">print</span>(even_or_odd(<span class="hljs-number">4</span>))  <span class="hljs-comment"># 输出: 偶数</span>
<span class="hljs-built_in">print</span>(even_or_odd(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出: 奇数</span>
</code></pre>
<h5 data-id="heading-102">注意事项</h5>
<ol>
<li>匿名函数只能包含一个表达式</li>
<li>表达式的结果就是函数的返回值</li>
<li>适合简单的、一次性使用的函数</li>
<li>复杂逻辑建议使用普通函数</li>
</ol>
<h3 data-id="heading-103">18. 装饰器</h3>
<h4 data-id="heading-104">18.1 什么是装饰器</h4>
<p>装饰器是一种特殊的高阶函数，用于修改其他函数的功能，而不改变其代码。</p>
<h4 data-id="heading-105">18.2 装饰器的基本使用</h4>
<h5 data-id="heading-106">简单装饰器示例</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_decorator</span>(<span class="hljs-params">func</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器开始执行"</span>)
        func()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器结束执行"</span>)
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-comment"># 使用装饰器</span>
<span class="hljs-meta">@my_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World!"</span>)

<span class="hljs-comment"># 调用函数</span>
say_hello()
</code></pre>
<h5 data-id="heading-107">带参数的装饰器</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 带参数的装饰器</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">my_decorator</span>(<span class="hljs-params">func</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器开始执行"</span>)
        result = func(*args, **kwargs)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"装饰器结束执行"</span>)
        <span class="hljs-keyword">return</span> result
    <span class="hljs-keyword">return</span> wrapper

<span class="hljs-meta">@my_decorator</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

result = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果: <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h5 data-id="heading-108">装饰器的应用场景</h5>
<ol>
<li>日志记录</li>
<li>性能测试</li>
<li>权限验证</li>
<li>缓存</li>
<li>事务处理</li>
</ol>
<h3 data-id="heading-109">总结</h3>
<p>本指南涵盖了 Python 编程的核心知识点，包括：</p>
<ul>
<li><strong>基础数据类型</strong>：整数、字符串、浮点数、布尔值、空值等</li>
<li><strong>数据结构</strong>：列表、元组、字典等</li>
<li><strong>控制流</strong>：条件判断（if-elif-else）、循环结构（for、while）</li>
<li><strong>函数</strong>：定义与调用、参数传递、作用域、闭包</li>
<li><strong>面向对象编程</strong>：类定义、属性与方法、继承、多态</li>
<li><strong>文件操作</strong>：路径、读取、写入、关闭</li>
<li><strong>异常处理</strong>：try-except-else-finally、断言</li>
<li><strong>单元测试</strong>：unittest框架的使用</li>
<li><strong>高级特性</strong>：高阶函数、匿名函数、装饰器</li>
</ul>
<p>学习 Python 最好的方法是多写代码，多实践。</p>
<h4 data-id="heading-110">学习建议</h4>
<ol>
<li><strong>基础先行</strong>：先掌握基础语法和核心概念</li>
<li><strong>多写代码</strong>：理论结合实践，编写小项目</li>
<li><strong>阅读源码</strong>：学习优秀的开源项目</li>
<li><strong>参与社区</strong>：加入 Python 社区，向他人学习</li>
<li><strong>持续学习</strong>：Python 生态不断发展，保持学习习惯</li>
</ol>
<p>祝您学习愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS-Grid 网格布局全攻略（从基础到进阶）]]></title>    <link>https://juejin.cn/post/7599640782570422299</link>    <guid>https://juejin.cn/post/7599640782570422299</guid>    <pubDate>2026-01-27T07:28:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570422299" data-draft-id="7599604510365843494" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS-Grid 网格布局全攻略（从基础到进阶）"/> <meta itemprop="keywords" content="前端,面试,CSS"/> <meta itemprop="datePublished" content="2026-01-27T07:28:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS-Grid 网格布局全攻略（从基础到进阶）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:28:55.000Z" title="Tue Jan 27 2026 07:28:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>如果说 Flex 布局是一维的“线性布局”，那么 <strong>Grid（网格布局）</strong> 就是真正意义上的“二维布局”。它能够同时处理行与列，让我们通过简单的代码就能实现极其复杂的页面结构。</p>
<h2 data-id="heading-1">一、 Grid 容器属性：定义你的网格空间</h2>
<h3 data-id="heading-2">1. 开启网格布局</h3>
<ul>
<li><strong><code>display: grid;</code></strong> ：容器里面的元素为块级元素。</li>
<li><strong><code>display: inline-grid;</code></strong> ：容器里面的元素为行内元素。</li>
</ul>
<h3 data-id="heading-3">2. 定义行与列 (<code>grid-template-*</code>)</h3>
<p>通过 <code>grid-template-columns</code> 和 <code>grid-template-rows</code> 划分网格。</p>
<ul>
<li>
<p><strong>常用关键字：</strong></p>
<ul>
<li><strong><code>repeat(count, value)</code></strong> ：重复定义。例如 <code>repeat(3, 1fr)</code> 表示三列均分。</li>
<li><strong><code>auto-fill</code></strong>：自动填充。让每一行/列尽可能容纳更多固定宽度的单元格。</li>
<li><strong><code>fr</code> (Fraction)</strong> ：片段单位。表示网格剩余空间的比例关系。</li>
<li><strong><code>minmax(min, max)</code></strong> ：长度范围。例如 <code>minmax(100px, 1fr)</code>。</li>
<li><strong><code>auto</code></strong>：自适应，占满剩余宽度。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>注意</strong>：不要单独使用grid-template-rows，单独使用grid布局可能会造成布局混乱，不可预测。</p>
</blockquote>
<ul>
<li><strong>使用实例</strong>：当网格单元格数量大于子元素数量时，多余单元格会保持空白，子元素不会因此被拉伸放大。
例如：定义一个 3列×4行 的网格，但只放入9个元素，剩余3个单元格会留空，而现有元素仍保持正常的网格比例尺寸</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
    }
    <span class="hljs-selector-class">.div</span> {
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a33c10075db24b0bb0e1c7c7f1002088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=zIaJAZd%2FSyjM0%2FTANgoMBFVB1n4%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01586539ac484970b6813d7d97f8121f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=0RTzyIPHIKkR8n02Blbj2l93wos%3D" alt="image.png" width="45%" loading="lazy"/>
<h3 data-id="heading-4">3. 间距 (Gap)</h3>
<blockquote>
<p><strong>注意</strong>：最新标准中已建议移除 <code>grid-</code> 前缀，直接使用 <code>gap</code>。</p>
</blockquote>
<ul>
<li><strong><code>row-gap</code></strong>：行间距。</li>
<li><strong><code>column-gap</code></strong>：列间距。</li>
<li><strong><code>gap</code></strong>：合写形式（<code>&lt;row-gap&gt; &lt;column-gap&gt;</code>）。</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
  <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
}
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5dd143066ea483180b8cad5354998c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=3szmQ58BUuridYaCpN6l62yu%2Fqs%3D" alt="image.png" width="30%" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">二、 网格排列与对齐控制</h2>
<h3 data-id="heading-6">1. 单元格内容对齐 (<code>-items</code>)</h3>
<p>控制网格项在<strong>网格表内部</strong>的位置：</p>
<ul>
<li><strong><code>justify-items</code></strong>：网格中每行的水平对齐方式（<code>start | end | center | stretch</code>）。</li>
<li><strong><code>align-items</code></strong>：格中每行的垂直对齐方式。</li>
<li><strong><code>place-items</code></strong>：简写形式。</li>
</ul>
<blockquote>
<p><strong>注意</strong>：当 Grid 子元素的宽高都超过了父容器时，<code>justify-items</code>和 <code>align-items</code>可能会失效或不明显，所以尽量网格容器与子元素宽高可预知场景下使用。</p>
</blockquote>
<p><strong>实例</strong>：例如现在我给每个单元格都设置一个小于网格的宽高，这时就可直观看到它们的区别了 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5e09ed459d14591835bb6535e64da2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=QVY%2FCnQSZRSlTtMQBASdZjTxruQ%3D" alt="image.png" width="45%" loading="lazy"/> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11af43e3a3f47b4a024f13e2af93827~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=PInTwC3e7f3Ub1kMHQqYkogeElI%3D" alt="image.png" width="45%" loading="lazy"/></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr);
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;

      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center;<span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">height</span>:<span class="hljs-number">30px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-7">2. 整个网格内容区域对齐 (<code>-content</code>)</h3>
<p>在实际使用中，存在着网格内容区域大小和网格容器大小不一致的情况，而-content则是设置网格内容区域相对于容器的对齐方式。</p>
<ul>
<li><strong><code>justify-content</code></strong>：网格内容区域在水平位置相当于容器的对齐方式（<code>space-between | space-around | space-evenly | strat | end | center |stretch(大小没有指定时，拉伸占据整个网格容器)</code>）。</li>
<li><strong><code>align-content</code></strong>：网格内容区域在垂直方向相对于容器的对齐方式。</li>
<li><strong><code>place-content</code></strong>：简写形式。</li>
</ul>
<p>在上面的例子中，可以发现添加justify-content与align-content是无效的，因为网格内容区域总尺寸 = 容器尺寸，现在将网格中子项设置较大值与较小值，你就会发现区别：图左为网格内容区域总尺寸 &gt; 容器尺寸,图右边为网格内容区域总尺寸 &lt; 容器尺寸。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cc82aa8265a453880b1d44cfc58ab11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=wOePGK1IeVX1wofYw%2B77gIqBQyI%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02a4e3d6d03848f5aa35ad8454b58013~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=nKJdgxNI2gOYd5%2FAeOPOc8HqZXI%3D" alt="image.png" width="45%" loading="lazy"/>
<pre><code class="hljs language-css" lang="css"> <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
  }
<span class="hljs-selector-class">.grid-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">200px</span>); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
  <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">350px</span>);   <span class="hljs-comment">/*repeat(4, 150px); */</span>
  <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;

  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
  justify-items: center;<span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>


  <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
  <span class="hljs-attribute">align-content</span>: center;  <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
}
</code></pre>
<h3 data-id="heading-8">3. 排列顺序 (<code>grid-auto-flow</code>)</h3>
<p>决定网格项如何自动填充到网格中。</p>
<ul>
<li><strong><code>row</code></strong>（默认）：先行后列。</li>
<li><strong><code>column</code></strong>：先列后行。</li>
</ul>
<hr/>
<hr/>
<h2 data-id="heading-9">三、 项目属性：单个格子的自我修养</h2>
<h3 data-id="heading-10">1. 基于网格线的定位</h3>
<p>可以通过指定网格线来决定一个项目跨越多少行或列。</p>
<ul>
<li><strong><code>grid-column-start / end</code></strong>：元素左边框所在的垂直网格线/右边框所在的垂直网格线。</li>
<li><strong><code>grid-row-start / end</code></strong>：元素上边框所在的水平网格线/下边框所在的水平网格线。</li>
<li><strong><code>span</code> 关键字</strong>：表示跨越的跨度。例如 <code>grid-column: span 2;</code>（跨越两列）。</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b871d1e3c53b43acb93e4d7a234e60a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=R%2F5J3osIHwL2%2BgKgsnlfl6C88GY%3D" alt="image.png" width="50%" loading="lazy"/></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*repeat(4, 150px); */</span>
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-comment">/* grid-auto-flow: column; */</span>
      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center; <span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>

      <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">align-content</span>: center; <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:last-child</span>{
      <span class="hljs-attribute">background</span>: red;
      <span class="hljs-attribute">grid-column-start</span>:<span class="hljs-number">2</span>;
      <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">4</span>;
      <span class="hljs-attribute">grid-row-start</span>: <span class="hljs-number">3</span>;
      <span class="hljs-attribute">grid-row-end</span>: <span class="hljs-number">5</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-11">2. 单个项目的对齐 (<code>-self</code>)</h3>
<p>适用于网格内的的子元素，它会覆盖容器定义的 <code>items</code> 属性：</p>
<ul>
<li><strong><code>justify-self</code></strong> ：置单元格内容的水平位置（左中右），跟<code>justify-items</code>属性的用法完全一致，但只作用于单个项目。取值：<code>start | end | center | stretch（拉伸）</code></li>
<li><strong><code>align-self</code></strong>：设置单元格内容的垂直位置（上中下）</li>
<li><strong><code>place-self</code></strong>：是<code>align-self</code>属性和<code>justify-self</code>属性的合并简写形式</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fed0c15cd154cb6a53cb6b644476145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=OOAU1%2BWmiNUefzF%2F7oKe7pfKKY0%3D" alt="image.png" width="45%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/486e24680c1c4f41b033b99738076a0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103734&amp;x-signature=YKKLQx8ldymzrZWAMGkYYB24c5o%3D" alt="image.png" width="45%" loading="lazy"/>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"grid-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>4<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"div"</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">html</span>,
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    }
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
    }
    <span class="hljs-selector-class">.grid-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">500px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">800px</span>;
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*  repeat(3, 100px) */</span>
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>fr); <span class="hljs-comment">/*repeat(4, 150px); */</span>
      <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">row-gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-comment">/* grid-auto-flow: column; */</span>
      <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 网格中每行的水平对齐方式 */</span>
      justify-items: center; <span class="hljs-comment">/* 网格中每行的垂直对齐方式 */</span>
      justify-self: start;
      <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-comment">/*网格内容区域在水平位置相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">align-content</span>: center; <span class="hljs-comment">/*网格内容区域在垂直方向相当于容器的对齐方式*/</span>
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid yellow;
    }
    <span class="hljs-selector-class">.div</span>{
      justify-self: end; 
      <span class="hljs-attribute">align-self</span>: end;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid salmon;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>n + <span class="hljs-number">1</span>) {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid green;
    }
    <span class="hljs-selector-class">.div</span><span class="hljs-selector-pseudo">:last-child</span>{
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">background</span>: red;
      <span class="hljs-attribute">grid-column-start</span>:<span class="hljs-number">2</span>;
      <span class="hljs-attribute">grid-column-end</span>: <span class="hljs-number">4</span>;
      <span class="hljs-attribute">grid-row-start</span>: <span class="hljs-number">3</span>;
      <span class="hljs-attribute">grid-row-end</span>: <span class="hljs-number">5</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[中心化 Agent 和 非中心化 Agent 的实现区别]]></title>    <link>https://juejin.cn/post/7599572091076247594</link>    <guid>https://juejin.cn/post/7599572091076247594</guid>    <pubDate>2026-01-27T07:52:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599572091076247594" data-draft-id="7599591405314097193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="中心化 Agent 和 非中心化 Agent 的实现区别"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T07:52:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="twl"/> <meta itemprop="url" content="https://juejin.cn/user/3016715635534029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            中心化 Agent 和 非中心化 Agent 的实现区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715635534029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    twl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:52:04.000Z" title="Tue Jan 27 2026 07:52:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天开会有一个问题引起我的思考：有同事说可以在Cursor执行自定义的Agent。梳理了下问题让ChatGPT回答。</p>
<p>想用 <strong>langchain.js 自己写 agent</strong>，但 <strong>Cursor 订阅用户没有单独的 OpenAI/Anthropic API key</strong>，所以没法让他们“自带 key”来跑——这时基本结论是：</p>
<p><strong>Cursor 的订阅配额/“token”通常不能被第三方代码（比如 langchain.js）当作 API key 直接调用模型来消耗。</strong><br/>
Cursor 订阅更像是“Cursor 客户端内部可用的推理权限”，不是一个通用的开发者 API 凭证。</p>
<p>所以如果你坚持“自己写 agent + 让用户不用 API key”，常见可行路线只有下面几种（各有 trade-off）：</p>
<hr/>
<h3 data-id="heading-0">1) 把你的 agent 做成“Cursor 内置 Agent 的工作流/脚本”，而不是自己去调模型</h3>
<p><strong>核心</strong>：让 Cursor 自己负责调用模型（消耗 Cursor 订阅），你的代码只负责：</p>
<ul>
<li>提供 prompt/规则/任务分解模板</li>
<li>提供工具（本地命令、文件操作、你的 HTTP 工具接口）</li>
<li>提供执行脚本（不包含 LLM 调用）</li>
</ul>
<p>这样用户不需要 API key，你也不需要中心化 token。<br/>
代价是：你不能用 langchain.js 自己掌控 “LLM loop”，而是把 loop 交给 Cursor 的 agent。</p>
<blockquote>
<p>实操上就是：你交付一个 repo + 一套 Cursor instructions / command palette 入口，让 Cursor agent 按你的流程跑。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">2) 中心化提供模型（你付 token）→ 然后对用户收费/限额</h3>
<p>这是最常见、也是最“langchain 原汁原味”的方式：你的 agent 服务端持有模型 key。</p>
<ul>
<li>✅ 体验最好：用户零配置</li>
<li>❌ 你承担 token 成本（除非你把成本转嫁到订阅/按量计费）</li>
<li>✅ 最可控：可做审计、缓存、路由、多模型</li>
</ul>
<p>如果你主要目标是商业化而不是“把 token 推给用户”，这一条反而是正解。</p>
<hr/>
<h3 data-id="heading-2">3) 让用户用“免费/本地模型”当作无 key 的替代</h3>
<p>如果用户没有 API key，你还可以让他们：</p>
<ul>
<li>用 Ollama / LM Studio（本地推理）</li>
<li>或用某些提供“免 key/客户端可用”的模型渠道（通常不稳定/不建议依赖）</li>
</ul>
<p>这能做到“非中心化”，但模型质量、速度、平台兼容性差异会很大。</p>
<hr/>
<h3 data-id="heading-3">4) 企业场景：让用户用公司统一 SSO 的模型网关（不是 Cursor 订阅）</h3>
<p>如果你们公司有内部 LLM gateway（SSO、按用户计费/配额），可以做到：</p>
<ul>
<li>用户不用自己拿 API key（他们用公司身份登录）</li>
<li>token 成本按用户/部门计量，而不是你单独承担</li>
<li>对接方式：OAuth / JWT / company gateway</li>
</ul>
<p>这不是“消耗 Cursor token”，但能达到“非你中心化 token”的成本归属。</p>
<hr/>
<h2 data-id="heading-4">结论：<strong>想“自己写 langchain agent + 不要用户 API key + 消耗 Cursor 订阅 token”基本做不到</strong></h2>
<p>因为 Cursor 订阅不是可外部调用的通用 API。你要么：</p>
<ul>
<li><strong>接受 loop 在 Cursor 内跑</strong>（方案 1），你的代码只做工具与模板；或</li>
<li><strong>你中心化托管模型</strong>（方案 2）；或</li>
<li><strong>走本地/企业网关</strong>（方案 3/4）。</li>
</ul>
<hr/>
<h3 data-id="heading-5">给你一个推荐组合（实用且接近你目标）</h3>
<p><strong>“Cursor 负责推理 + 你的工具服务”</strong> ：</p>
<ul>
<li>你写：工具服务（HTTP endpoints）+ 一套 prompt/instructions + 项目模板</li>
<li>Cursor 用户：用 Cursor agent 来规划、调用工具、改代码</li>
<li>成本：模型 token 由 Cursor 订阅承担；你只承担工具成本（可限流/收费）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 echarts + react 实现上下交错正负轴柱状图]]></title>    <link>https://juejin.cn/post/7599765329410162728</link>    <guid>https://juejin.cn/post/7599765329410162728</guid>    <pubDate>2026-01-27T07:53:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599765329410162728" data-draft-id="7599845683121782824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 echarts + react 实现上下交错正负轴柱状图"/> <meta itemprop="keywords" content="JavaScript,前端,ECharts"/> <meta itemprop="datePublished" content="2026-01-27T07:53:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小飞机噗噗噗"/> <meta itemprop="url" content="https://juejin.cn/user/3910327822978568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 echarts + react 实现上下交错正负轴柱状图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3910327822978568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小飞机噗噗噗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:53:05.000Z" title="Tue Jan 27 2026 07:53:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、最终实现效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42395c03d31f4318a03b7a6f1a4289c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=n7fLMYFRlTtWalGy44kJoXlCqzk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2、实现难点</h2>
<h3 data-id="heading-2">方法一</h3>
<p>在echarts配置里没有像上面一样上下交错试例，最像的一个是左右交错的，如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5061adeba79472f88fca659e7a01cad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=Wg3xJrDKhy%2FqMchwJ9zAdatt6Do%3D" alt="image.png" loading="lazy"/>
链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fecharts.apache.org%2Fexamples%2Fzh%2Feditor.html%3Fc%3Dbar-negative2" target="_blank" title="https://echarts.apache.org/examples/zh/editor.html?c=bar-negative2" ref="nofollow noopener noreferrer">echarts.apache.org/examples/zh…</a></p>
<p>第一个想到的方法就是在这个基础上将柱状图旋转90度，但是不能解决一条柱形需要显示2个文案，而且所有文案也要跟着旋转90度，因此不太可取。</p>
<h3 data-id="heading-3">方法二：</h3>
<p>用正常的柱状图配置方法，因为柱状图本身是支持上下正负值的，唯一的问题就是，配置里只会让底部的线居中，而底部的文字是只能底部和顶部显示的，因此也不可取。如下图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1305d35ede694f1a92ed98799a3771ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=ySvtOB4uW4k2B5pi%2BztVOLUi00g%3D" alt="企业微信截图_a645b6e2-e2f2-4a12-85c1-96e7ae94c0db.png" loading="lazy"/></p>
<h2 data-id="heading-4">3、最终实现方法</h2>
<p>echarts柱状图的柱子是可以由两个柱子叠加拼接起来了的，那让半个柱子显示正负值，半个柱子显示底部文案值，然后根据正负一上一下显示，最后去掉底部的x轴文案。<br/>
类似如下图叠加柱子：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0745ebf1428c4471bc43edc95e2479b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6aOe5py65ZmX5ZmX5ZmX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105185&amp;x-signature=gtMB1%2BOK0BRszwbsAaoYwLR7ZG0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">4、实现代码</h2>
<pre><code class="hljs language-css" lang="css">      const dataX = <span class="hljs-selector-attr">[<span class="hljs-string">'超过30天'</span>, <span class="hljs-string">'超过90天'</span>, <span class="hljs-string">'超过半年'</span>, <span class="hljs-string">'超过1年'</span>]</span>;
      const dataY = <span class="hljs-selector-attr">[-2.8, 16.42, -24.6, 20.21]</span>;
      const options = {
      tooltip: { show: false },
      xAxis: {
        type: <span class="hljs-string">'category'</span>,
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false },
        axisLine: {
          show: true,
          lineStyle: {
            <span class="hljs-attribute">width</span>: <span class="hljs-number">1</span>,
            color: <span class="hljs-string">'#E3E3E3'</span>
          }
        }
      },
      // Y 轴配置
      yAxis: {
        axisLine: { show: false },
        axisTick: { show: false },
        axisLabel: { show: false },
        splitLine: { show: false },
        type: <span class="hljs-string">'value'</span>
      },
      // 系列数据
      series: [
        {
          name: <span class="hljs-string">'占比'</span>,
          type: <span class="hljs-string">'bar'</span>,
          stack: <span class="hljs-string">'a'</span>,
          label: {
            show: true,
            formatter: params =&gt; dataX[params.dataIndex]
          },
          data: <span class="hljs-built_in">funcDataLabel</span>(dataY, false),
          barWidth: <span class="hljs-string">'30%'</span>
        },
        {
          name: <span class="hljs-string">'占比'</span>,
          type: <span class="hljs-string">'bar'</span>,
          stack: <span class="hljs-string">'a'</span>,
          label: {
            show: true
          },
          data: <span class="hljs-built_in">funcDataLabel</span>(dataY, true),
          barWidth: <span class="hljs-string">'30%'</span>
        }
      ]
    };

// 图数据格式化
  const funcDataLabel = (data, isTop) =&gt; {
    const charge = value =&gt; {
      if (isTop) {
        return value &gt; <span class="hljs-number">0</span> ? '<span class="hljs-attribute">top</span>' : <span class="hljs-string">'bottom'</span>;
      } else {
        return value &gt; <span class="hljs-number">0</span> ? '<span class="hljs-attribute">bottom</span>' : <span class="hljs-string">'top'</span>;
      }
    };
    return data<span class="hljs-selector-class">.map</span>(item =&gt; {
      return {
        value: item,
        label: {
          <span class="hljs-attribute">normal</span>: {
            <span class="hljs-attribute">position</span>: <span class="hljs-built_in">charge</span>(item)
          }
        },
        // 柱子颜色区分正负
        itemStyle: {
          <span class="hljs-attribute">color</span>: item &gt;= <span class="hljs-number">0</span> ? <span class="hljs-string">'#E84225'</span> : <span class="hljs-string">'#19A740'</span>
        }
      };
    });
  };
</code></pre>
<h2 data-id="heading-6">总结：</h2>
<p>echarts配置还是比较复杂的，参数非常多，但是可以多参考示例给到一些启发，或者直接使用实例上进行二次开发会更加容易和上手一些</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风]]></title>    <link>https://juejin.cn/post/7599798118460751881</link>    <guid>https://juejin.cn/post/7599798118460751881</guid>    <pubDate>2026-01-27T08:22:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599798118460751881" data-draft-id="7599708108620824627" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:22:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大黄评测"/> <meta itemprop="url" content="https://juejin.cn/user/714024404135696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntelliJ IDEA 的「闪电操作」：这些 Quick 技巧让你编码快如疾风
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/714024404135696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大黄评测
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:22:17.000Z" title="Tue Jan 27 2026 08:22:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代软件开发中，效率就是生产力。而 JetBrains 家的 IntelliJ IDEA 之所以广受开发者喜爱，不仅因为其强大的智能提示和深度代码理解能力，更因为它内置了大量“Quick”类快捷操作——这些功能往往只需一两个快捷键，就能完成原本繁琐的手动操作，真正实现“快如闪电”。</p>
<p>下面，就带你盘点几个最实用、最高效的 IntelliJ IDEA “Quick”技巧，助你提升编码速度与流畅度。</p>
<hr/>
<h2 data-id="heading-0">1. <strong>Quick Fix（快速修复）— Alt + Enter（Windows/Linux）或 ⌥ + Enter（macOS）</strong></h2>
<p>这是 IDEA 最核心的“Quick”功能之一。当你代码出现警告、错误，甚至只是有优化建议时，按下 <code>Alt + Enter</code>，IDEA 会立刻弹出上下文相关的修复建议。</p>
<ul>
<li>自动导入缺失类</li>
<li>生成 getter/setter、构造函数、toString()</li>
<li>将 lambda 表达式转换为匿名类（或反之）</li>
<li>快速创建测试类</li>
<li>修复拼写错误或未使用的变量</li>
</ul>
<blockquote>
<p>小贴士：即使没有错误，光标放在任意代码上按 <code>Alt + Enter</code>，也常有意想不到的重构建议！</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. <strong>Quick Documentation（快速文档）— Ctrl + Q（Windows/Linux）或 F1（macOS）</strong></h2>
<p>想快速查看某个方法、类或字段的文档？无需跳转到源码或打开浏览器，直接使用 Quick Documentation。</p>
<ul>
<li>显示 Javadoc、参数说明、返回值类型</li>
<li>支持 Markdown 渲染（如 Spring 注解说明）</li>
<li>可固定窗口，边看边写</li>
</ul>
<blockquote>
<p>搭配 <code>Ctrl + 鼠光标悬停</code> 使用效果更佳！</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">3. <strong>Quick Evaluate Expression（快速表达式求值）— Alt + F8</strong></h2>
<p>调试时想知道某个变量的值？或者想临时计算一个表达式（比如 <code>list.size() &gt; 5</code>）？不用加断点再重启，直接在调试过程中选中表达式，按 <code>Alt + F8</code>，IDEA 会立即计算并显示结果。</p>
<ul>
<li>支持复杂表达式</li>
<li>不影响程序运行状态</li>
<li>比手动加日志快十倍</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. <strong>Quick Switch Scheme（快速切换配色/快捷键方案）— Ctrl + `（反引号）</strong></h2>
<p>团队协作时，可能需要临时切换主题、快捷键映射或代码风格？用 <code>Ctrl + ``（反引号）</code> 打开 Quick Switch 菜单，一键切换：</p>
<ul>
<li>Color Scheme（配色方案）</li>
<li>Keymap（快捷键布局）</li>
<li>Look and Feel（UI 主题）</li>
<li>Code Style（代码格式）</li>
</ul>
<p>特别适合在演示、结对编程或接手他人项目时快速适应环境。</p>
<hr/>
<h2 data-id="heading-4">5. <strong>Quick JavaDoc / Quick Definition（快速查看定义）— Ctrl + Shift + I</strong></h2>
<p>想看一个方法的实现但又不想跳转页面？<code>Ctrl + Shift + I</code>（Windows/Linux）可内联预览方法或类的定义，悬浮窗口显示源码片段，按 <code>Esc</code> 即可关闭，不打断当前编辑流。</p>
<hr/>
<h2 data-id="heading-5">6. <strong>Live Templates + Postfix Completion（虽非“Quick”命名，但本质是快速输入）</strong></h2>
<p>虽然名字里没带“Quick”，但它们是真正的“快速编码神器”：</p>
<ul>
<li>输入 <code>sout</code> + Tab → 自动生成 <code>System.out.println();</code></li>
<li>输入 <code>fori</code> + Tab → 快速生成 for 循环</li>
<li>使用 <code>.var</code>、<code>.notnull</code> 等后缀自动包裹表达式</li>
</ul>
<p>这些模板可自定义，极大减少重复敲键。</p>
<hr/>
<h2 data-id="heading-6">结语：让“Quick”成为你的肌肉记忆</h2>
<p>IntelliJ IDEA 的“Quick”系列功能，本质上是把开发者高频操作封装成一键可达的智能助手。熟练掌握这些技巧，不仅能减少鼠标依赖，更能让你进入“心流编码”状态——思路不中断，手指不停歇。</p>
<p>下次写代码时，不妨试试少点几次鼠标，多按几下 <code>Alt + Enter</code> —— 你会发现，真正的“快”，不是打字速度，而是思维与工具的无缝协同。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力]]></title>    <link>https://juejin.cn/post/7599708108620841011</link>    <guid>https://juejin.cn/post/7599708108620841011</guid>    <pubDate>2026-01-27T08:24:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108620841011" data-draft-id="7599614131424378889" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:24:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大尚来也"/> <meta itemprop="url" content="https://juejin.cn/user/1681597639955488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 分钟上手 HarmonyOS Skill：快速集成语音与意图交互能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1681597639955488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大尚来也
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:24:03.000Z" title="Tue Jan 27 2026 08:24:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在鸿蒙生态（HarmonyOS）中，<strong>Skill</strong> 是实现智能语音助手、意图识别和跨设备服务调用的核心机制之一。通过 Skill，你的应用可以被小艺（Celia）语音唤醒、响应用户自然语言指令，甚至与其他设备上的服务无缝协作。</p>
<p>本文将用 <strong>5 分钟时间</strong>，带你快速理解 Skill 的基本概念，并演示如何在 HarmonyOS 应用中注册并使用一个简单的自定义 Skill。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 HarmonyOS Skill？</h2>
<p>Skill 是 HarmonyOS 提供的一种<strong>服务能力单元</strong>，用于描述“我能做什么”。它基于 <strong>意图（Intent）</strong> 模型，将用户语音或文本指令映射到具体的功能逻辑。</p>
<p>例如：</p>
<ul>
<li>用户说：“打开天气应用查看北京天气”</li>
<li>系统识别出意图 <code>VIEW_WEATHER</code>，并携带参数 <code>{city: "北京"}</code></li>
<li>你的应用通过注册对应 Skill 响应该意图，启动页面并展示数据</li>
</ul>
<blockquote>
<p>💡 Skill 类似于 Android 的 App Actions 或 iOS 的 Siri Shortcuts，但深度集成于鸿蒙分布式架构。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">二、5 分钟实战：创建一个“打招呼”Skill</h2>
<p>我们将创建一个简单 Skill：当用户对小艺说“让 MyApp 打个招呼”，应用弹出“Hello, HarmonyOS!”。</p>
<h3 data-id="heading-2">步骤 1：配置 <code>config.json</code></h3>
<p>在 <code>module.json5</code>（或旧版 <code>config.json</code>）中注册 Skill：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.myapp.GreetSkill"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"voice"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"响应打招呼指令"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"greet_user"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"entities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MainAbility"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/entryability/EntryAbility.ets"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"skills"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"greet_user"</span><span class="hljs-punctuation">]</span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>✅ 注意：<code>skills</code> 定义能力，<code>abilities</code> 中的 <code>skills</code> 字段将其绑定到具体 Ability。</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">步骤 2：在 Ability 中处理 Skill 调用</h3>
<p>在 <code>EntryAbility.ets</code> 中重写 <code>onNewWant</code> 方法（用于接收外部拉起）：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> <span class="hljs-type">UIAbility</span> from '<span class="hljs-meta">@ohos</span>.app.ability.<span class="hljs-type">UIAbility</span>';

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">UIAbility</span> </span>{
  onNewWant(want) {
    <span class="hljs-comment">// 检查是否由 Skill 触发</span>
    <span class="hljs-keyword">if</span> (want.action === 'greet_user') {
      <span class="hljs-comment">// 可在此启动特定页面或执行逻辑</span>
      console.log('收到打招呼指令！');
      
      <span class="hljs-comment">// 示例：弹出提示（需在 UI 线程）</span>
      <span class="hljs-comment">// 此处简化，实际应在页面中通过 ArkTS 显示</span>
    }
  }
}
</code></pre>
<blockquote>
<p>🔔 提示：若需跳转到具体页面，可在 <code>onNewWant</code> 中调用 <code>this.context.startAbility()</code> 启动目标页面，并传递参数。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">步骤 3：（可选）配置语音触发语料</h3>
<p>为了让小艺识别“让 MyApp 打个招呼”，需在 <strong>华为开发者联盟后台</strong> 提交语音模板（目前部分能力需审核）：</p>
<ul>
<li>
<p>意图名称：<code>greet_user</code></p>
</li>
<li>
<p>示例语句：</p>
<ul>
<li>“让 MyApp 打个招呼”</li>
<li>“叫 MyApp 问好”</li>
</ul>
</li>
</ul>
<blockquote>
<p>🌐 注：本地调试可使用 <strong>DevEco Studio 的模拟器 + Intent 模拟工具</strong> 测试，无需真实语音。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">三、调试技巧</h2>
<ol>
<li><strong>使用 DevEco Studio 的“Intent 模拟器”</strong><br/>
在运行配置中选择 “Edit Configurations” → 添加 “Intent” 启动方式，填入 <code>action: greet_user</code> 即可模拟 Skill 调用。</li>
<li><strong>查看日志</strong><br/>
通过 <code>hdc shell</code> 或 DevEco Log 工具观察 <code>onNewWant</code> 是否被触发。</li>
<li><strong>权限声明</strong><br/>
若涉及敏感操作，需在 <code>module.json5</code> 中声明相应权限（如 <code>ohos.permission.INTERNET</code>）。</li>
</ol>
<hr/>
<h2 data-id="heading-6">四、进阶方向</h2>
<ul>
<li>使用 <strong>Entity</strong> 传递参数（如城市名、时间等）</li>
<li>实现 <strong>Service Ability</strong> 响应后台 Skill 请求</li>
<li>结合 <strong>元服务（Meta Service）</strong> 实现免安装卡片式交互</li>
<li>接入 <strong>小艺开放平台</strong>，支持更多自然语言表达</li>
</ul>
<hr/>
<h2 data-id="heading-7">结语</h2>
<p>Skill 是 HarmonyOS 构建智能、主动、跨端服务的关键入口。虽然本文仅展示了最基础的用法，但已为你打开了通往“语音驱动应用”的大门。只需 5 分钟配置，你的应用就能听懂用户说话！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝]]></title>    <link>https://juejin.cn/post/7599708108620890163</link>    <guid>https://juejin.cn/post/7599708108620890163</guid>    <pubDate>2026-01-27T08:25:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599708108620890163" data-draft-id="7599708108620873779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T08:25:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大鹏1988"/> <meta itemprop="url" content="https://juejin.cn/user/2526022571922992"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从“搬家”说起：彻底搞懂 JavaScript 的赋值、引用与深浅拷贝
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2526022571922992/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大鹏1988
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:25:16.000Z" title="Tue Jan 27 2026 08:25:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你有没有经历过搬家？<br/>
箱子打包、家具搬运、钥匙交接……看似简单，但稍不注意，就可能把“原屋”的东西弄丢，或者在新家发现“复制”的只是个空壳。</p>
<p>有趣的是，JavaScript 中的<strong>赋值操作</strong>，就像一场“数据搬家”。而很多人踩过的坑——比如改了新变量，原对象却也变了——其实都源于没搞清楚：<strong>JavaScript 到底是在“搬东西”，还是在“给地址”？</strong></p>
<p>今天，我们就用“搬家”这个故事，彻底理清 JavaScript 的赋值操作符（<code>=</code>）背后的真相。</p>
<hr/>
<h2 data-id="heading-0">一、基本类型：真·打包搬家（值传递）</h2>
<p>假设你有一本实体书《JavaScript 忍者秘籍》，要搬到新家。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">book1</span> = <span class="hljs-string">"JavaScript 忍者秘籍"</span><span class="hljs-comment">;</span>
let <span class="hljs-attr">book2</span> = book1<span class="hljs-comment">;</span>

<span class="hljs-attr">book2</span> = <span class="hljs-string">"TypeScript 入门指南"</span><span class="hljs-comment">;</span>
console.log(book1)<span class="hljs-comment">; // "JavaScript 忍者秘籍"</span>
</code></pre>
<p>✅ <strong>发生了什么？</strong><br/>
<code>book1</code> 是一个字符串（基本类型）。当你执行 <code>book2 = book1</code>，JavaScript <strong>真的复印了一本新书</strong>交给 <code>book2</code>。之后你把 <code>book2</code> 换成别的书，完全不影响 <code>book1</code>。</p>
<blockquote>
<p>📦 <strong>基本类型（Number, String, Boolean, null, undefined, Symbol, BigInt）</strong> ：赋值时<strong>复制值本身</strong>，互不干扰。</p>
</blockquote>
<p>这就像搬家时，你把书装箱带走——原房东家不留副本，新家拿到的是独立实体。</p>
<hr/>
<h2 data-id="heading-1">二、引用类型：只给了“新家地址”（引用传递）</h2>
<p>现在，你有一台智能冰箱，里面存着牛奶、鸡蛋、蔬菜。搬家时，你不会把冰箱拆了运过去，而是告诉搬家公司：“新地址是 A 栋 101”。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge1</span> = { milk: <span class="hljs-number">2</span>, eggs: <span class="hljs-number">12</span> }<span class="hljs-comment">;</span>
let <span class="hljs-attr">fridge2</span> = fridge1<span class="hljs-comment">;</span>

<span class="hljs-attr">fridge2.milk</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
console.log(fridge1.milk)<span class="hljs-comment">; // 0！😱</span>
</code></pre>
<p>❌ <strong>问题来了</strong>：为什么改了 <code>fridge2</code>，<code>fridge1</code> 也变了？</p>
<p>🔑 <strong>真相</strong>：<br/>
<code>fridge1</code> 存的不是冰箱本身，而是<strong>冰箱的地址（引用）</strong> 。<code>fridge2 = fridge1</code> 只是<strong>复制了这个地址</strong>，两个变量指向同一个物理冰箱！</p>
<blockquote>
<p>🏠 <strong>引用类型（Object, Array, Function 等）</strong> ：赋值时<strong>复制的是内存地址</strong>，多个变量共享同一块数据。</p>
</blockquote>
<p>这就像你和朋友都拿着同一栋房子的钥匙——谁进去拿走牛奶，冰箱都会变空。</p>
<hr/>
<h2 data-id="heading-2">三、“搬家”升级：如何真正复制一个冰箱？（深浅拷贝）</h2>
<h3 data-id="heading-3">浅拷贝：只复制第一层（新冰箱，但食材还是共享的？）</h3>
<p>使用 <code>Object.assign()</code> 或展开运算符 <code>...</code>：</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge1</span> = { milk: <span class="hljs-number">2</span>, eggs: <span class="hljs-number">12</span>, drawer: { butter: <span class="hljs-number">1</span> } }<span class="hljs-comment">;</span>
let <span class="hljs-attr">fridge2</span> = { ...fridge1 }<span class="hljs-comment">;</span>

<span class="hljs-attr">fridge2.milk</span> = <span class="hljs-number">0</span><span class="hljs-comment">;           // OK，不影响 fridge1</span>
<span class="hljs-attr">fridge2.drawer.butter</span> = <span class="hljs-number">0</span><span class="hljs-comment">;  // ❌ fridge1.drawer.butter 也变成 0！</span>
</code></pre>
<p>🔍 <strong>原因</strong>：浅拷贝只复制了顶层属性。<code>drawer</code> 仍然是一个<strong>引用</strong>，两个冰箱共用同一个抽屉！</p>
<h3 data-id="heading-4">深拷贝：连抽屉里的黄油都重新买一份！</h3>
<p>方法一：<code>JSON.parse(JSON.stringify(obj))</code>（有局限，不支持函数、undefined、Symbol 等）</p>
<p>方法二：使用 Lodash 的 <code>_.cloneDeep()</code> 或自己写递归函数。</p>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fridge2</span> = JSON.parse(JSON.stringify(fridge1))<span class="hljs-comment">;</span>
<span class="hljs-attr">fridge2.drawer.butter</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
console.log(fridge1.drawer.butter)<span class="hljs-comment">; // 1，安全！</span>
</code></pre>
<blockquote>
<p>✅ <strong>深拷贝</strong>：递归复制所有层级，确保新旧对象完全独立——这才是真正的“全新搬家”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">四、赋值操作符 <code>=</code> 的本质总结</h2>




















<table><thead><tr><th>类型</th><th>赋值行为</th><th>类比</th></tr></thead><tbody><tr><td>基本类型</td><td>复制值（独立副本）</td><td>打包带走实体物品</td></tr><tr><td>引用类型</td><td>复制引用（共享同一内存地址）</td><td>只给新地址，东西没动</td></tr></tbody></table>
<blockquote>
<p>💡 记住：<strong><code>=</code> 从不自动深拷贝对象</strong>。它只是“交钥匙”，不是“造新房”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">五、避坑指南：日常开发建议</h2>
<ol>
<li>
<p><strong>不要假设 <code>=</code> 会复制对象</strong> —— 它只是创建新引用。</p>
</li>
<li>
<p><strong>修改前先拷贝</strong>：若需独立操作，务必使用浅/深拷贝。</p>
</li>
<li>
<p><strong>函数参数也是赋值</strong>：传入对象时，函数内部修改会影响外部（因为传的是引用）。</p>
</li>
<li>
<p><strong>const 不代表“不可变”</strong> ：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">obj</span> = { a: <span class="hljs-number">1</span> }<span class="hljs-comment">;</span>
<span class="hljs-attr">obj.a</span> = <span class="hljs-number">2</span><span class="hljs-comment">; // ✅ 合法！const 只防止 obj 重新赋值，不防内容修改</span>
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-7">结语：下次“搬家”，记得问清楚是搬东西，还是只给地址</h2>
<p>JavaScript 的赋值机制，看似简单，却是理解状态管理、React 更新、Redux 不可变性等高级概念的基础。<br/>
通过“搬家”这个比喻，希望你能清晰分辨：<strong>什么时候是独立副本，什么时候是共享引用</strong>。</p>
<p>下次再遇到“改了一个变量，另一个也变了”的 bug，你就知道——<br/>
不是代码出了问题，而是你忘了：<strong>JavaScript 从不帮你搬冰箱，它只给你一把钥匙。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code使用技巧-为Claude Code接入国产大模型]]></title>    <link>https://juejin.cn/post/7599850148055564297</link>    <guid>https://juejin.cn/post/7599850148055564297</guid>    <pubDate>2026-01-27T08:27:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599850148055564297" data-draft-id="7599614131424411657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code使用技巧-为Claude Code接入国产大模型"/> <meta itemprop="keywords" content="人工智能,程序员"/> <meta itemprop="datePublished" content="2026-01-27T08:27:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北鸟南游"/> <meta itemprop="url" content="https://juejin.cn/user/1662117314561255"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code使用技巧-为Claude Code接入国产大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117314561255/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北鸟南游
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:27:50.000Z" title="Tue Jan 27 2026 08:27:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在AI时代的程序员，越来越离不开AI开发代码工具，目前比较热门的有Claude code、codex、opencode以及智能AI的IDE比如，cursor、trae、<a href="https://link.juejin.cn?target=https%3A%2F%2Fantigravityide.net%2Fzh" target="_blank" title="https://antigravityide.net/zh" ref="nofollow noopener noreferrer">antigravity</a>等其他工具。</p>
<p>使用AI开发工具离不开大模型的接入，AI工具就比如是一辆车的外壳，只有加上大模型发动机才能发挥出巨大的能量。</p>
<p>本文介绍下比较的Claude Code【简称CC】的使用，并且可以接入国产大模型，免费使用大模型。</p>
<h2 data-id="heading-0">安装Claude</h2>
<p>第一步是获取 <a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a> 的命令行客户端（CLI）</p>
<h3 data-id="heading-1">环境准备</h3>
<p>在安装之前，请确保你的系统中已经安装了 Node.js 18.0 或更高版本。Claude Code 是基于 Node.js 生态构建的，npm 是其首选的安装工具。你可以在终端中运行以下命令来检查你的 Node.js 版本：</p>
<pre><code class="hljs language-bash" lang="bash">node -v
</code></pre>
<p>如果版本低于 18.0，请先前往<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn" target="_blank" title="https://nodejs.org/zh-cn" ref="nofollow noopener noreferrer"> Node.js</a> 官网进行升级</p>
<p>或者使用nvm进行升级</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Download and install nvm:</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash

<span class="hljs-comment"># in lieu of restarting the shell</span>
\. <span class="hljs-string">"<span class="hljs-variable">$HOME</span>/.nvm/nvm.sh"</span>

<span class="hljs-comment"># Download and install Node.js:</span>
nvm install 22

<span class="hljs-comment"># Verify the Node.js version:</span>
node -v <span class="hljs-comment"># Should print "v22.20.0".</span>

<span class="hljs-comment"># Verify npm version:</span>
npm -v <span class="hljs-comment"># Should print "10.9.3".</span>
</code></pre>
<h3 data-id="heading-2">全局安装 Claude Code</h3>
<p>打卡终端，运行以下命令来全局安装 Claude Code</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p>等一会，安装完成后，可以通过运行以下命令来验证 Claude Code 安装和运行是否成功</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看 claude 的安装位置</span>
<span class="hljs-comment"># which claude</span>
/usr/local/bin/claude

<span class="hljs-comment"># claude --version</span>
2.1.12 (Claude Code)
</code></pre>
<p>看到版本号说明已经安装成功。</p>
<h3 data-id="heading-3">首次运行 Claude Code</h3>
<p>如果你直接运行 claude 命令，你将看到 Claude Code 的“欢迎”页面，如下图所示：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e42f5e0c6e4243158d6d9c29da4b7a80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=Ho%2BUGz1Q%2FdqhgltZGbnn6W%2BLeAY%3D" alt="" loading="lazy"/></p>
<p>可以看到 Claude Code 让你选择终端主题（Terminal Theme），默认是第一个 Dark mode。这里我们可以<strong>直接敲击回车进入下一个页面</strong>（后续如果要重新配置主题时，可以通过 /config 斜杠命令进行）：</p>
<p/>
<p>第二个页面会引导你选择登录方式，</p>
<ul>
<li>Claude Code 支持通过浏览器登录官方 Anthropic 账户，</li>
<li>也可以通过 API 方式与 Claude 大模型进行交互 (通过方向键选择下面的选项“Anthropic Console account”)。</li>
</ul>
<p>不过，这里请先不要进行这一步，因为我们的目标是绕过官方 API，连接到我们自己的“引擎”。</p>
<h2 data-id="heading-4">接入国产大模型</h2>
<h3 data-id="heading-5">连接国产 AI 大模型- 智谱大模型</h3>
<p>首先需要注册智谱 AI 的账户 并创建 API Key</p>
<p>打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen.bigmodel.cn%2F" target="_blank" title="https://open.bigmodel.cn/" ref="nofollow noopener noreferrer">智谱</a> 官网，注册并登录你的账户。打卡<a href="https://link.juejin.cn?target=https%3A%2F%2Fbigmodel.cn%2Fusercenter%2Fproj-mgmt%2Fapikeys" target="_blank" title="https://bigmodel.cn/usercenter/proj-mgmt/apikeys" ref="nofollow noopener noreferrer">API keys</a>页面</p>
<p>然后就可以通过环境变量配置 Claude Code 访问智谱大模型 API 的连接地址和身份令牌了。你可以在你的 Shell 配置文件中添加下面两行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> ANTHROPIC_BASE_URL=<span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span>
<span class="hljs-built_in">export</span> ANTHROPIC_AUTH_TOKEN=<span class="hljs-string">"&lt;your_zhipu_api_key&gt;"</span>
</code></pre>
<p>以上是MAC系统配置；windows系统需要在环境变量中进行配置。</p>
<ul>
<li><code>ANTHROPIC_BASE_URL</code>：这是最关键的一行。它告诉 Claude Code 客户端，不要去访问默认的 Anthropic API 地址，而是将所有的网络请求都发送到智谱 AI 的 API 兼容端点。我们在这里实现了“请求重定向”。</li>
<li>ANTHROPIC_AUTH_TOKEN：尽管变量名看起来是“Anthropic”的，但由于我们已经重定向了 BASE_URL，这个 Token 实际上会被发送给智谱 AI 的服务器进行验证。我们在这里实现了“身份凭证替换”。</li>
</ul>
<p>环境变量生效后，我们在本地新建一个项目test重新执行 claude：</p>
<p>可以看到下图</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/561fbd8f115743f886cdd965bc314752~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=IB6T8SPPaB06jQxpy%2BuuYeUevi8%3D" alt="" loading="lazy"/></p>
<p>这次 Claude Code 没有让我们选择 login method，而是直接 login 成功了！敲击回车后，我们看到下一个页面：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d13139778364eec9bd02bb0310c56f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=JlPfawwmUNC78maj9%2FSpq0FUa1w%3D" alt="" loading="lazy"/></p>
<p>询问我是否信任该本地文件夹，敲击回车选择信任后，我们便正式进入 Claude Code 的工作页面：</p>
<p>在输入提示符后面输入 /status 后回车，就可以看到当前 Claude Code 使用的模型的各种最新信息：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb3a6f4ee8344e529542dd188768f805~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=MKsBfSP1QwWABPxsIDKiLWJ9s40%3D" alt="" loading="lazy"/></p>
<p>使用的是 claude-sonnet-4-5-20250929，不过显然这不是真的，背后智谱大模型到底使用什么模型呢?我们可以自行设置;</p>
<h3 data-id="heading-6">设置默认模型</h3>
<p>接下来就设置一下要使用的智谱 AI 的模型。找到并修改 Claude Code 的（分级）配置文件 settings.json。这个文件是 Claude Code 的“大脑中枢”，控制着它的核心行为，包括环境变量、权限、工具行为等;</p>
<p>在我们动手修改 settings.json 之前，你必须先建立一个清晰的认知：Claude Code 的配置并非只有一个文件，而是一个<strong>设计精巧的分层配置体系</strong>。有点类似npm包的层级，项目中的级别最高，也可全局中安装依赖包。</p>
<p>核心思想是，<strong>高层级的配置会覆盖低层级配置中的同名设置</strong>。</p>
<p>这五个层级各自的用途非常明确：</p>
<ul>
<li>企业级策略（managed-settings.json）：由 IT/DevOps 团队统一分发，用于强制执行公司级安全策略，拥有最高优先级，不可被覆盖。</li>
<li>命令行参数（例如–model …）：为单次会话提供的临时覆盖，非常适合快速测试。</li>
<li>项目级个人设置（.claude/settings.local.json）：你个人在此项目的特定偏好（如测试用模型），默认被 Git 忽略，不会与团队共享。</li>
<li>项目级共享设置（.claude/settings.json）：需要团队所有成员共享的项目级规范（如权限规则），应该提交到代码库。</li>
<li>用户级全局设置（~/.claude/settings.json）：存放你个人的、希望在所有项目中都生效的全局配置。这正是我们本次“引擎移植”手术的核心操作区。</li>
</ul>
<p>我们以用户级全局配置 ~/.claude/settings.json 为例，来看看如何设置默认使用的智谱大模型。</p>
<p>这个文件通常位于你用户主目录下的 .claude 文件夹中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p ~/.claude
<span class="hljs-comment"># 使用你熟悉的编辑器打开，比如VS Code或Vim</span>
<span class="hljs-comment"># 如果文件不存在，这个命令会创建它</span>
<span class="hljs-built_in">touch</span> ~/.claude/settings.json
<span class="hljs-comment"># 或者</span>
<span class="hljs-comment"># vim ~/.claude/settings.json</span>
</code></pre>
<p>打开这个（可能是空的）settings.json 文件，将以下内容完整地复制进去：</p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"env"</span>: {
    <span class="hljs-string">"ANTHROPIC_DEFAULT_HAIKU_MODEL"</span>: <span class="hljs-string">"glm-4.5-air"</span>,
    <span class="hljs-string">"ANTHROPIC_DEFAULT_SONNET_MODEL"</span>: <span class="hljs-string">"glm-4.6"</span>,
    <span class="hljs-string">"ANTHROPIC_DEFAULT_OPUS_MODEL"</span>: <span class="hljs-string">"glm-4.6"</span>
  }
}
</code></pre>
<p>保存并关闭 settings.json 文件。我们重新运行 Claude Code 并通过 /status 命令查看当前模型信息：</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6147f9bb6f7947119f8b11a5452472cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=77DaF%2Fr0iEY2GVBzQ2AfEztt8DY%3D" alt="" loading="lazy"/></p>
<p>可以看到修改了模型的调用。</p>
<p>智谱提供了一些免费模型的使用</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fguide%2Fmodels%2Ffree%2Fglm-4.7-flash" target="_blank" title="https://docs.bigmodel.cn/cn/guide/models/free/glm-4.7-flash" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/guide/mo…</a></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94498aae1d344109b313c4ed54afb94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=5vex1ns39NqVhcd%2Fy0POYLrICzE%3D" alt="" loading="lazy"/></p>
<p>可以修改成这些模型进行使用。</p>
<p>免费模型开发能力有限，开发一些简单功能可以使用，如果使用热门流行的模型，还是需要付费使用。</p>
<h3 data-id="heading-7">通过代理转发链接</h3>
<p>如果不想使用国产模型，也可以使用国内的一些代理商，通过他们提供的转发API可以使用原生的claude的大模型。</p>
<p>作为曾注册和测试了10来个系统账户，测试使用下来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcustomer.claude-code.club%2Finvite%2FCMHEVT" target="_blank" title="https://customer.claude-code.club/invite/CMHEVT" ref="nofollow noopener noreferrer">CC club</a> 使用最方便，售后服务也比较好，免费的额度给的比较多，而且每周都可以重置免费额度。这里的付费额度也是非常优惠和划算的。</p>
<p>当然你也可以注册其它代理使用：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeeprouter.top%2F" target="_blank" title="https://deeprouter.top/" ref="nofollow noopener noreferrer">deeprouter.top/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmoacode.org%2F" target="_blank" title="https://moacode.org/" ref="nofollow noopener noreferrer">moacode.org/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fapi.code-relay.com%2F" target="_blank" title="https://api.code-relay.com/" ref="nofollow noopener noreferrer">api.code-relay.com/</a></li>
</ul>
<h4 data-id="heading-8">主要介绍下CC club的使用</h4>
<p>可以按照官方提供的<a href="https://link.juejin.cn?target=https%3A%2F%2Facademy.claude-code.club%2Fgetting-started%2Finstallation" target="_blank" title="https://academy.claude-code.club/getting-started/installation" ref="nofollow noopener noreferrer">使用文档</a>进行配置；前提是已经安装好了CC；</p>
<p>然后就主要在 <a href="https://link.juejin.cn?target=https%3A%2F%2Facademy.claude-code.club%2Fgetting-started%2Finstallation%2Fmacos%233-%25E8%25AE%25BE%25E7%25BD%25AE%25E7%258E%25AF%25E5%25A2%2583%25E5%258F%2598%25E9%2587%258F" target="_blank" title="https://academy.claude-code.club/getting-started/installation/macos#3-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" ref="nofollow noopener noreferrer">配置</a> 这一步</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c66f1b5969b84dd5bad79e67de6f9d91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=U9sKLf9FPq80gg40a4TfDSL9O%2Bw%3D" alt="" loading="lazy"/></p>
<p>配置完成后，就可以使用原汁原味的claude工具。</p>
<h2 data-id="heading-9">使用Claude-code-router调用魔搭社区的模型</h2>
<p>使用claude-code-router，可以调用魔搭社区的模型，魔搭社区提供每天2000次的调用额度，当然每个模型还有日调用限制额度。可以测试使用不同的模型。</p>
<p>首先全局安装 claude-code-router 插件</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmusistudio%2Fclaude-code-router" target="_blank" title="https://github.com/musistudio/claude-code-router" ref="nofollow noopener noreferrer">github.com/musistudio/…</a></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @musistudio/claude-code-router
</code></pre>
<p>然后按照说明问题创建并配置 ~/.claude-code-router/config.json </p>
<pre><code class="hljs language-bash" lang="bash">{
  <span class="hljs-string">"OPENAI_API_KEY"</span>: <span class="hljs-string">"<span class="hljs-variable">$OPENAI_API_KEY</span>"</span>,
  <span class="hljs-string">"GEMINI_API_KEY"</span>: <span class="hljs-string">"<span class="hljs-variable">${GEMINI_API_KEY}</span>"</span>,
  <span class="hljs-string">"Providers"</span>: [
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"openai"</span>,
      <span class="hljs-string">"api_base_url"</span>: <span class="hljs-string">"https://api.openai.com/v1/chat/completions"</span>,
      <span class="hljs-string">"api_key"</span>: <span class="hljs-string">"<span class="hljs-variable">$OPENAI_API_KEY</span>"</span>,
      <span class="hljs-string">"models"</span>: [<span class="hljs-string">"gpt-5"</span>, <span class="hljs-string">"gpt-5-mini"</span>]
    }
  ]
}
</code></pre>
<p>openai是chatGPT的模型，使用时会有一些网络问题。</p>
<p>我们可以使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fmodels" target="_blank" title="https://www.modelscope.cn/models" ref="nofollow noopener noreferrer">魔搭社区</a>的免费模型，每天有2000的免费调用额度。</p>
<p>魔搭社区的使用，要先完成阿里云的认证。</p>
<p>在首页-<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.modelscope.cn%2Fmy%2Faccess%2Ftoken" target="_blank" title="https://www.modelscope.cn/my/access/token" ref="nofollow noopener noreferrer">访问控制</a>下，创建key，也可以使用默认的key。后边调用模型时，都需要填写key；</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9755f8f335de4d57853d42189b41901c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=mZTpR0vqzaNjain1GdiFAqjrhd4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">在模型页面选择支持推理的模型</h3>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7a99ac92c9f44c9b13acb36aa46ccaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=LzNtvf3kjwi%2F90oxeNq89rg1cQo%3D" alt="" loading="lazy"/></p>
<p>选择一个点击进去</p>
<p>在模型的详情页面中，可以在查看代码示例中找到配置使用方法</p>
<p>比如：GLM-4.7模型</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a0cb320c1f643d8862459b3631e672d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6bif5Y2X5ri4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770107269&amp;x-signature=CysuG30EvISCcW76RfoS30PMcBc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">不同模型的json配置</h3>
<p>下面是使用GLM-4.7模型的完整的config.json配置；</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_base_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api-inference.modelscope.cn/v1/chat/completions"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你自己的APIKEY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"transformer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"maxtoken"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65536</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"enhancetool"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Qwen/Qwen3-235B-A22B-Thinking-2507"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"reasoning"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"think"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"longContext"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,ZhipuAI/GLM-4.7"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>添加deepseek的模型配置</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_base_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api-inference.modelscope.cn/v1/chat/completions"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"api_key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ms-fd370b1c-3aed-4c0c-9980-2c545dbc4782"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"transformer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">[</span>
            <span class="hljs-string">"maxtoken"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-punctuation">{</span>
              <span class="hljs-attr">"max_tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">65536</span>
            <span class="hljs-punctuation">}</span>
          <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"enhancetool"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Qwen/Qwen3-235B-A22B-Thinking-2507"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"reasoning"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Router"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
	  <span class="hljs-attr">"default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"think"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span><span class="hljs-punctuation">,</span>
	  <span class="hljs-attr">"longContext"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"modelscope,deepseek-ai/DeepSeek-V3.2"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他的模型都是类似的配置方法。使用下来，越是热门模型每日的调用限制额度越低，可以进行多测试。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis Dynamic SQL 入门指南]]></title>    <link>https://juejin.cn/post/7599630795804917806</link>    <guid>https://juejin.cn/post/7599630795804917806</guid>    <pubDate>2026-01-27T08:40:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599630795804917806" data-draft-id="7599847938537701385" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis Dynamic SQL 入门指南"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-27T08:40:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="信码由缰"/> <meta itemprop="url" content="https://juejin.cn/user/2110664941509214"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis Dynamic SQL 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2110664941509214/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    信码由缰
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:40:14.000Z" title="Tue Jan 27 2026 08:40:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://cf-blog.icodebuddy.com/image/107/107-0.png" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmybatis.org%2Fmybatis-dynamic-sql%2Fdocs%2Fintroduction.html" target="_blank" title="https://mybatis.org/mybatis-dynamic-sql/docs/introduction.html" ref="nofollow noopener noreferrer">MyBatis Dynamic SQL</a> 是一种类型安全的 Java 领域特定语言（DSL），用于通过编程方式构建 SQL 查询，而非编写 SQL 字符串或基于 XML 的动态查询。它在运行时使用流畅的 Java 构建器生成 SQL，同时仍通过标准的 MyBatis 映射器执行。与手动拼接字符串或复杂的 XML 逻辑相比，这使得查询构建更安全、更易于重构，并且更不容易出错。</p>
<p>由于查询是用 Java 编写的，列名和表引用通过强类型的元数据类在编译时进行验证，这提供了更好的 IDE 支持并减少了运行时 SQL 错误。本文将解释 MyBatis Dynamic SQL，并展示如何在 Java 应用程序中使用它。</p>
<h2 data-id="heading-0">1. 使用 MyBatis Dynamic SQL 可以做什么？</h2>
<p>MyBatis Dynamic SQL 支持大多数常见的 SQL 操作，包括 <code>SELECT</code>、<code>INSERT</code>、<code>UPDATE</code> 和 <code>DELETE</code>，以及连接、子查询、分页、排序、条件过滤和批量操作。它允许我们逐步构建查询，仅在某些参数存在时添加条件，这使其成为搜索界面和过滤 API 的理想选择。</p>
<p>它直接与 MyBatis 映射器接口集成，意味着我们仍然可以受益于结果映射、事务处理和连接管理。由于它生成标准的 SQL，因此适用于 MyBatis 支持的任何数据库，没有供应商锁定的问题。</p>
<h3 data-id="heading-1">1.1 MyBatis Dynamic SQL 的工作原理</h3>
<p>Dynamic SQL 基于两个组件：表元数据类和 DSL 构建器。元数据类用 Java 描述表和列。DSL 构建器使用这些类以流畅、类型安全的方式组装 SQL 语句。</p>
<p>DSL 不直接执行 SQL。相反，它生成语句提供者对象，例如 <code>SelectStatementProvider</code> 或 <code>InsertStatementProvider</code>。这些对象被传递给使用 <code>@SelectProvider</code>、<code>@InsertProvider</code> 及类似注解标注的映射器方法，然后 MyBatis 使用其正常的执行引擎来执行这些语句。</p>
<h2 data-id="heading-2">2. 项目设置与依赖</h2>
<h3 data-id="heading-3">Maven 依赖</h3>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  


<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.dynamic-sql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-dynamic-sql<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

  


<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.h2database<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>h2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.240<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

</code></pre>
<p>这些依赖项包括 MyBatis 本身、Dynamic SQL DSL 以及一个用于测试的嵌入式数据库。</p>
<blockquote>
<p><strong>注意</strong></p>
</blockquote>
<blockquote>
<p>数据库驱动可以替换为 MySQL、PostgreSQL 或任何其他支持的数据库。MyBatis Dynamic SQL 不依赖于数据库类型，仅依赖于标准 SQL 生成。</p>
</blockquote>
<h3 data-id="heading-4">数据库模式</h3>
<p><code>schema.sql</code></p>
<pre><code class="hljs language-sql" lang="sql">
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (

id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,

username <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,

email <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),

age <span class="hljs-type">INT</span>

);

  


<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users(username, email, age) <span class="hljs-keyword">VALUES</span>

(<span class="hljs-string">'thomas'</span>, <span class="hljs-string">'thomas@jcg.com'</span>, <span class="hljs-number">30</span>),

(<span class="hljs-string">'benjamin'</span>, <span class="hljs-string">'benjamin@jcg.com'</span>, <span class="hljs-number">22</span>),

(<span class="hljs-string">'charles'</span>, <span class="hljs-string">'charles@jcg.com'</span>, <span class="hljs-number">17</span>);

</code></pre>
<p>此脚本创建一个简单的表并插入测试数据。内存中的 H2 数据库将在启动时执行此脚本，因此无需外部依赖即可测试查询。</p>
<h3 data-id="heading-5">领域模型</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {

  


<span class="hljs-keyword">private</span> Long id;

<span class="hljs-keyword">private</span> String username;

<span class="hljs-keyword">private</span> String email;

<span class="hljs-keyword">private</span> Integer age;

  


<span class="hljs-comment">// Getter 和 Setter 方法...</span>

}

</code></pre>
<p>这个 POJO 代表数据库中的一行。MyBatis 会自动使用匹配的字段名将列映射到字段，因此本例不需要额外的结果映射。</p>
<h2 data-id="heading-6">3. 用于 Dynamic SQL 的表元数据</h2>
<p>下面的类以类型安全的方式定义数据库表及其列，允许在构建查询时被 Dynamic SQL DSL 引用。它充当 Java 代码与实际数据库结构之间的桥梁，实现了列名和类型的编译时验证。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDynamicSqlSupport</span> {

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Long&gt; id = user.id;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; username = user.username;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; email = user.email;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Integer&gt; age = user.age;

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SqlTable</span> {

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Long&gt; id = column(<span class="hljs-string">"id"</span>, JDBCType.BIGINT);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; username = column(<span class="hljs-string">"username"</span>, JDBCType.VARCHAR);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;String&gt; email = column(<span class="hljs-string">"email"</span>, JDBCType.VARCHAR);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> SqlColumn&lt;Integer&gt; age = column(<span class="hljs-string">"age"</span>, JDBCType.INTEGER);

  


<span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> {

<span class="hljs-built_in">super</span>(<span class="hljs-string">"users"</span>);

}

}

}

</code></pre>
<p>这个类为 <code>users</code> 表定义了类型安全的元数据，使 MyBatis Dynamic SQL 可以在不使用原始 SQL 字符串的情况下构建查询。DSL 使用这些 Java 对象而非按名称引用列，从而提高了安全性和 IDE 支持。</p>
<p>内部类 <code>User</code> 继承 <code>SqlTable</code>，这将其标记为可用于 <code>from(user)</code> 和连接等子句的数据表。构造函数调用 <code>super("users")</code> 来告知 MyBatis 要在 SQL 语句（如 <code>FROM users</code>）中呈现的确切表名。</p>
<p>每个列都使用 <code>SqlTable</code> 中的 <code>column()</code> 方法定义，该方法注册列名及其 JDBC 类型。这会产生强类型的 <code>SqlColumn&lt;T&gt;</code> 对象，确保比较和条件在编译时使用正确的 Java 类型。</p>
<p>外部类公开了对表及其列的静态引用，以便于静态导入，使得查询读起来很自然，例如：<code>select(id, username).from(user)</code>，同时保持完全的类型安全和重构友好。</p>
<h3 data-id="heading-7">映射器接口</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Mapper</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> {

  


<span class="hljs-meta">@SelectProvider(type = SqlProviderAdapter.class, method = "select")</span>

List&lt;User&gt; <span class="hljs-title function_">selectMany</span><span class="hljs-params">(SelectStatementProvider selectStatement)</span>;

}

</code></pre>
<p><code>@Mapper</code> 注解告诉 MyBatis 此接口应注册为映射器并在运行时进行代理。MyBatis 会自动生成实现，因此不需要具体的类。</p>
<p><code>selectMany</code> 方法接受一个 <code>SelectStatementProvider</code>，它封装了完全呈现的 SQL 语句及其参数。MyBatis 执行该语句并将每个结果行映射到 <code>User</code> 对象，将它们作为 <code>List&lt;User&gt;</code> 返回。</p>
<p><code>@SelectProvider</code> 注解指定 SQL 将由 MyBatis Dynamic SQL 的一部分 <code>SqlProviderAdapter</code> 动态提供。实际的 SQL 是在运行时从使用 DSL 构建的 <code>SelectStatementProvider</code> 生成的，而不是在注解或 XML 中编写 SQL。</p>
<h2 data-id="heading-8">4. 构建动态查询</h2>
<p>在这里，我们使用流畅的 Dynamic SQL DSL 构建 SQL 语句，而不是编写原始 SQL 字符串。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {

  


MyBatisUtil.runSchema();

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> MyBatisUtil.getSession()) {

  


<span class="hljs-type">UserMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> session.getMapper(UserMapper.class);

  


<span class="hljs-type">SelectStatementProvider</span> <span class="hljs-variable">select</span>

<span class="hljs-operator">=</span> select(id, username, email, age)

.from(user)

.where(age, isGreaterThan(<span class="hljs-number">18</span>))

.and(username, isLike(<span class="hljs-string">"%tho%"</span>))

.orderBy(username)

.build()

.render(RenderingStrategies.MYBATIS3);

  


List&lt;User&gt; users = mapper.selectMany(select);

  


users.forEach(u

-&gt; System.out.println(u.getUsername() + <span class="hljs-string">" - "</span> + u.getAge()));

}

}

</code></pre>
<p>此代码使用流畅的 Dynamic SQL DSL 动态构建一个 <code>SELECT</code> 查询，并将其渲染为与 MyBatis 兼容的语句提供者。通过以编程方式添加条件，它能够以类型安全且可维护的方式创建复杂的过滤器。在本例中，查询选择 <code>age</code> 大于 18 岁且 <code>username</code> 包含 <code>"tho"</code> 的用户，然后按用户名字母顺序对结果进行排序。</p>
<h3 data-id="heading-9">MyBatis 工具类</h3>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisUtil</span> {

  


<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SqlSessionFactory factory;

  


<span class="hljs-keyword">static</span> {

<span class="hljs-keyword">try</span> {

<span class="hljs-type">Reader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> Resources.getResourceAsReader(<span class="hljs-string">"mybatis-config.xml"</span>);

factory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBuilder</span>().build(reader);

} <span class="hljs-keyword">catch</span> (Exception e) {

<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);

}

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SqlSession <span class="hljs-title function_">getSession</span><span class="hljs-params">()</span> {

<span class="hljs-keyword">return</span> factory.openSession(<span class="hljs-literal">true</span>);

}

  


<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runSchema</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, SQLException {

<span class="hljs-keyword">try</span> (<span class="hljs-type">SqlSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> getSession()) {

<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> session.getConnection();

<span class="hljs-type">Statement</span> <span class="hljs-variable">stmt</span> <span class="hljs-operator">=</span> conn.createStatement();

  


<span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(<span class="hljs-string">"schema.sql"</span>)) {

<span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(is.readAllBytes(), StandardCharsets.UTF_8);

stmt.execute(sql);

}

}

}

}

</code></pre>
<p>此工具类加载 MyBatis 配置，构建 <code>SqlSessionFactory</code>，并提供对数据库会话的访问。它还通过执行 SQL 脚本（<code>schema.sql</code>）手动初始化数据库模式。</p>
<h2 data-id="heading-10">5. 使用 Dynamic SQL 进行插入、更新和删除</h2>
<p>MyBatis 中的 Dynamic SQL 允许我们使用流畅的 DSL 以编程方式构造 INSERT、UPDATE 和 DELETE 语句。在此，我们演示如何执行这些常见的数据操作。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// INSERT</span>

<span class="hljs-type">User</span> <span class="hljs-variable">newUser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();

newUser.setUsername(<span class="hljs-string">"andrew"</span>);

newUser.setEmail(<span class="hljs-string">"andrew@jcg.com"</span>);

newUser.setAge(<span class="hljs-number">28</span>);

  


InsertStatementProvider&lt;User&gt; insert

= insert(newUser)

.into(user)

.map(username).toProperty(<span class="hljs-string">"username"</span>)

.map(email).toProperty(<span class="hljs-string">"email"</span>)

.map(age).toProperty(<span class="hljs-string">"age"</span>)

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">inserted</span> <span class="hljs-operator">=</span> mapper.insert(insert);

System.out.println(<span class="hljs-string">"Rows inserted: "</span> + inserted);

  


<span class="hljs-comment">// UPDATE</span>

<span class="hljs-type">UpdateStatementProvider</span> <span class="hljs-variable">update</span>

<span class="hljs-operator">=</span> update(user)

.set(age).equalTo(<span class="hljs-number">35</span>)

.where(username, isEqualTo(<span class="hljs-string">"thomas"</span>))

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> mapper.update(update);

System.out.println(<span class="hljs-string">"Rows updated: "</span> + updated);

  


<span class="hljs-comment">// DELETE</span>

<span class="hljs-type">DeleteStatementProvider</span> <span class="hljs-variable">delete</span>

<span class="hljs-operator">=</span> deleteFrom(user)

.where(age, isLessThan(<span class="hljs-number">18</span>))

.build()

.render(RenderingStrategies.MYBATIS3);

  


<span class="hljs-type">int</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> mapper.delete(delete);

System.out.println(<span class="hljs-string">"Rows deleted: "</span> + deleted);

</code></pre>
<p>相同的 DSL 风格也用于写操作。语句以流畅的方式构建、渲染，然后由映射器提供者方法执行。</p>
<ul>
<li>
<p><strong>INSERT</strong>：创建一个新的 <code>User</code> 对象并填充值。使用 Dynamic SQL DSL，我们将其字段映射到表列并生成 <code>InsertStatementProvider</code>。映射器执行插入操作，返回受影响的行数。</p>
</li>
<li>
<p><strong>UPDATE</strong>：DSL 构建一个更新语句，将用户名为 "thomas" 的用户的年龄设置为 35。这确保只修改目标行，映射器执行更新。</p>
</li>
<li>
<p><strong>DELETE</strong>：删除语句移除所有年龄小于 18 岁的用户。在 DSL 中使用条件保证了类型安全并避免了字符串拼接。</p>
</li>
</ul>
<h3 data-id="heading-11">更新后的映射器接口</h3>
<p>为了支持这些操作，映射器接口必须包含用于 INSERT、UPDATE 和 DELETE 的方法，使用 MyBatis Dynamic SQL 提供者。</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-comment">// INSERT</span>

<span class="hljs-meta">@InsertProvider(type = SqlProviderAdapter.class, method = "insert")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(InsertStatementProvider&lt;User&gt; insertStatement)</span>;

  


<span class="hljs-comment">// UPDATE</span>

<span class="hljs-meta">@UpdateProvider(type = SqlProviderAdapter.class, method = "update")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">update</span><span class="hljs-params">(UpdateStatementProvider updateStatement)</span>;

  


<span class="hljs-comment">// DELETE</span>

<span class="hljs-meta">@DeleteProvider(type = SqlProviderAdapter.class, method = "delete")</span>

<span class="hljs-type">int</span> <span class="hljs-title function_">delete</span><span class="hljs-params">(DeleteStatementProvider deleteStatement)</span>;

</code></pre>
<p>映射器中的每个方法处理一个特定的 DML 操作（插入、更新或删除），并接受一个封装了生成的 SQL 及其参数的 <code>InsertStatementProvider</code>、<code>UpdateStatementProvider</code> 或 <code>DeleteStatementProvider</code>。这种方法允许所有写操作都在 Java 中以编程方式表达，而无需手动组合 SQL 字符串，同时仍能利用 MyBatis 高效地执行语句和映射结果。</p>
<h2 data-id="heading-12">6. 结论</h2>
<p>在本文中，我们探讨了如何在 Java 应用程序中使用 MyBatis Dynamic SQL 来创建类型安全、可维护且可编程的 SQL 查询。通过将 SQL 构建与执行分离，MyBatis Dynamic SQL 简化了复杂查询逻辑的处理，降低了错误风险，并提高了代码可读性。这种方法非常适合查询需要动态变化或经常修改的应用程序。</p>
<h2 data-id="heading-13">7. 下载源代码</h2>
<p>本文讨论了 MyBatis Dynamic SQL 及其在 Java 中的使用方法。</p>
<blockquote>
<p><strong>下载</strong></p>
</blockquote>
<blockquote>
</blockquote>
<blockquote>
<p>您可以通过此处下载此示例的完整源代码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacodegeeks.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fmybatis-dynamic-sql-demo.zip" target="_blank" title="https://www.javacodegeeks.com/wp-content/uploads/2026/01/mybatis-dynamic-sql-demo.zip" ref="nofollow noopener noreferrer">java mybatis dynamic sql</a></p>
</blockquote>
<hr/>
<p>【注】本文译自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacodegeeks.com%2Fgetting-started-with-mybatis-dynamic-sql.html" target="_blank" title="https://www.javacodegeeks.com/getting-started-with-mybatis-dynamic-sql.html" ref="nofollow noopener noreferrer">Getting Started with MyBatis Dynamic SQL</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》]]></title>    <link>https://juejin.cn/post/7599828354515091496</link>    <guid>https://juejin.cn/post/7599828354515091496</guid>    <pubDate>2026-01-27T08:43:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354515091496" data-draft-id="7599765329410113576" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2026-01-27T08:43:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            万字实战沉淀，阿里云Hologres首发《Serverless OLAP 技术白皮书》
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:43:53.000Z" title="Tue Jan 27 2026 08:43:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>每天凌晨三点，你的 OLAP 集群仍在空转。</p>
<p>白天的查询高峰早已过去，但为了应对明天可能到来的流量洪峰，计算节点依然全量在线——只因传统架构无法做到“随用随停”。</p>
<p>这不是个例。行业数据显示，当前主流 OLAP 系统的平均资源利用率不足 35%。换句话说，企业每在计算上投入 3 元，就有 2 元花在了“等待”和“空跑”上。更棘手的是，这种浪费并非源于管理疏忽，而是架构本身决定的：存算一体、静态规划、强耦合设计，让系统只能按“最坏情况”配置资源。</p>
<p>在 AI 与实时决策驱动下，企业对 OLAP 系统的期待已从“能查”跃迁至“快、稳、省、易用”。然而，传统 OLAP 架构深陷四大困局：<strong>资源僵化、隔离薄弱、成本失控、运维繁重</strong>——其静态、耦合、运维密集的设计，已无法匹配动态业务的真实需求。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/357fe778fa2341e3a80169745fc4483a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=S4gjb29qkM1TzhAiX4VUOdpAMyU%3D" alt="" loading="lazy"/></p>
<p>破局之道在于重新定义 OLAP 的资源供给方式。而这一方向，早在云原生演进初期就已被预见。</p>
<p>2019年，UC Berkeley 在论文《A Berkeley View on Serverless Computing》中极具前瞻性地预言：Serverless 将成为云时代默认计算范式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7565d544665b45eab58290f8bf344487~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=CS%2BhhVIG1UjkkWf%2FcSO4wdQcWZg%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>极致弹性</strong>：系统能够根据业务负载自动、无缝地进行扩容和缩容，甚至可以在没有负载时<strong>缩容至“零”</strong>，彻底消除资源规划的难题。</li>
<li><strong>按需付费</strong>：用户<strong>只为代码实际运行所消耗的资源付费</strong>，代码未运行时不产生任何费用，从根本上杜绝了资源闲置浪费。</li>
<li><strong>资源隔离</strong>：提供灵活而强大的资源隔离能力，有效解决<strong>性能抖动、故障传染</strong>等风险，保障多租户环境下的系统稳定性。</li>
<li><strong>免运维</strong>：将基础设施的建设、管理和运维等繁琐工作下沉到平台提供者，用户<strong>无需再关注硬件维护、软件升级等非业务核心工作</strong>，从而聚焦于创造价值。</li>
</ul>
<p>基于 Serverless 的四大支柱，阿里云 Hologres 进一步提出‘Down to Zero’理念，将抽象原则转化为可落地的 OLAP 新范式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7c33253862e45d1b0a8c7ccc2156c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=DvB%2FrA91K76hi5GA5o5nvQxJ%2B3k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0"><strong>Down to Zero理念：下一代OLAP的技术基石与实现</strong></h3>
<p>阿里云 Hologres 提出 <strong>“Down to Zero”</strong> 理念，以 Serverless OLAP 架构实现范式级突破：<strong>成本趋零浪费、算力趋零等待、体验趋零摩擦、运维趋零负担</strong>。这不仅是优化，而是一次范式级重构。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/479231d83ef24e20b3d452e3e91f8abc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=x0yV3BtiCeq%2Bw16%2B7ssP0VcUyiQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>**成本趋零浪费：**成本趋近于零浪费，只为实际使用的计算力付费，资源闲置趋零，将可变成本降至极致。</p>
</li>
<li>
<p>**算力趋零等待：**瞬间获取海量算力应对峰值，算力用于有效分析，业务无需提前数月规划硬件。</p>
</li>
<li>
<p>**体验趋零摩擦：**用户“点击即得”的即时洞察分析体验成为常态，同时查询延迟、调度延迟、启动延迟均趋零，实现“零延迟”。</p>
</li>
<li>
<p>**运维趋零负担：**基础设施管理复杂性大幅降低，团队聚焦业务价值，无需容量规划、版本升级、故障恢复。</p>
</li>
</ul>
<h3 data-id="heading-1"><strong>“Down to Zero”如何落地？阿里云Hologres的实践路径</strong></h3>
<p>为了实现 Down to Zero 的目标和核心价值，让大数据 OLAP 分析回归“按需而动”的本质，Hologres 推出了名为 Serverless Computing 的云原生解决方案，帮助企业实现计算资源如水电般按需取用，它不仅是企业驱动智能决策的智能引擎的技术架构革新，更是一场算力供给范式的革命性突破。</p>
<ul>
<li><strong>Serverless Computing 资源池</strong>：大查询、ETL 自动卸载至共享池，实现负载隔离与冷启动“零延迟”。</li>
<li><strong>Adaptive Serverless Computing</strong>：AI 自动识别大查询、高负载场景，智能路由至弹性资源，无需人工干预。</li>
<li><strong>Serverless 型实例</strong>：彻底取消预留计算资源，100% 按需取用，真正实现“零持有成本”。</li>
</ul>
<h3 data-id="heading-2"><strong>Serverless型实例：让OLAP分析回归“按需而动”的本质</strong></h3>
<p>Serverless 型实例，帮助企业实现计算资源如水电般按需取用，从固定支出转向波动可控的“分析即服务”模式，从“人等资源”到“资源随想随用”，从“资源枷锁”到“业务赋能”，进化到全员数据探索的常态。</p>
<p>Serverless 型实例核心组件包括：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d12af4558c684931be420e732b7b9768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=ApBxOhp59yG9gnJuu%2B3XdHIA0%2Fs%3D" alt="" loading="lazy"/></p>
<p><strong>计算层：</strong></p>
<ul>
<li>接入节点：免费赠送。负责连接实例、估算请求所需的资源量、发送请求到 Serverless 资源池等。</li>
<li>Serverless Computing 资源池：可用区级别共享的计算资源池，负责执行用户的请求，按请求单独调度资源。</li>
</ul>
<p><strong>存储层：</strong></p>
<ul>
<li>Hologres 独享存储：基于 Alibaba Pangu 存储服务构建，提供高性能、高可靠、高可用、低成本、弹性的存储空间及强大稳定安全的系统服务。</li>
</ul>
<p>Hologres Serverless 型实例<strong>不再预留任何计算资源</strong>，根据业务不断波动的负载需求完全使用远端的 Serverless Computing 资源池，做到真正的**“<strong><strong>零计算资源</strong></strong>”****持有成本，****100%**的即用即取，即用即释放。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40119586f4334371b9438b761194e1dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=bxLOTp4YsmYXLxV6HlZU01cJws8%3D" alt="" loading="lazy"/></p>
<p>Hologres Serverless 型实例以零计算资源持有成本、零闲置成本、无限弹性边界、零运维负担等实现分析算力的弹性爆发，进一步极致的诠释着 Down to Zero 的成本趋零浪费、算力趋零等待、体验趋零摩擦 、运维趋零负担的核心价值，让 OLAP 分析回归“按需而动”的本质，将算力转化为竞争力，把业务价值交还给用户。</p>
<p>上述能力并非孤立存在，而是构建于一套完整的 Serverless OLAP 架构蓝图之上。</p>
<p>一个优秀的 Serverless OLAP 系统 是通过<strong>存算分离架构</strong>和<strong>计算组</strong>核心抽象，深度融合了**自动弹性、分时弹性、无损弹性伸缩、<strong><strong>Query Queue</strong></strong>、自动限流、**<strong>Down to Zero</strong> (Serverless Computing、Adaptive Serverless Computing、Serverless 型)等六大核心能力，构建了一个极致弹性、极致隔离、免运维、稳定可靠且高性价比的实时分析平台，将算力转化为竞争力，让OLAP分析回归“按需而动”的本质。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6958f98ff0e41d1be0002477184d022~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108233&amp;x-signature=b6IRYUxGwdWtuOCsmot2GR12ay4%3D" alt="" loading="lazy"/></p>
<p>Serverless OLAP 的本质是让算力供给隐形化，将基础设施转化为具备商业意识的数字伙伴。当资源使用变得如呼吸般自然，当每焦耳能耗都转化为洞察价值，“Down to Zero”便被赋予全新内涵，从技术理想升维为商业哲学，最终数据智慧在“Down to Zero”的管道中自由奔涌。</p>
<p>阿里云Hologres团队作为国内Serverless OLAP的先行者，以五年躬身探索为基石，撰写万字实战沉淀，首发《Down to Zero, Serverless OLAP 技术白皮书》。这本聚焦“Down to Zero”理念，直击传统 OLAP 成本高、弹性差、运维重等核心痛点，提出下一代分析引擎新范式——让算力按需爆发，资源归零无负担。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线]]></title>    <link>https://juejin.cn/post/7599843186202181674</link>    <guid>https://juejin.cn/post/7599843186202181674</guid>    <pubDate>2026-01-27T08:47:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599843186202181674" data-draft-id="7599860946836176959" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线"/> <meta itemprop="keywords" content="前端,GitHub,Claude"/> <meta itemprop="datePublished" content="2026-01-27T08:47:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="caizongding"/> <meta itemprop="url" content="https://juejin.cn/user/1398234519190414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 GitHub Trending 到社交媒体：一套 AI 驱动的内容自动化流水线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1398234519190414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    caizongding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T08:47:54.000Z" title="Tue Jan 27 2026 08:47:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>一套从 GitHub Trending 数据采集到图文内容全自动生成的端到端流水线</p>
</blockquote>
<h2 data-id="heading-0">1、起因</h2>
<p>我在刷小红书、即刻等社交平台时，总能看到「GitHub 每周充电」「开源项目推荐」之类的技术分享帖——精美的项目卡片配上一段简洁的文案，阅读量和互动都不错。所以我就在想：这些内容的素材来源无非是 GitHub Trending，卡片和文案的结构也相对固定，能不能借助 AI 把整个流程跑起来，定时自动生成图片和文案，直接拿来发布？</p>
<h2 data-id="heading-1">2、项目简介</h2>
<p>github-trending-scraper 是一个自动化内容生产流水线，它能够：</p>
<ol>
<li><strong>抓取</strong> GitHub Trending 页面的热门开源项目数据</li>
<li><strong>校验</strong> 数据结构的完整性与合法性</li>
<li><strong>渲染</strong> 精美的项目卡片图片（内置18套模板）</li>
<li><strong>生成</strong> 便于社交媒体分享的文案</li>
</ol>
<p>只需一条命令 <code>pnpm start</code>，即可完成从数据采集到内容产出的全部流程，并通过 GitHub Actions 实现每月定时执行与发布。</p>
<h3 data-id="heading-2">2.1 卡片模板一览</h3>
<p>以下是项目内置的 18 套卡片模板渲染效果：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8821467e0b2047aa9871f164d4659c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=0vV7VKl1Qlk9geBdiMIOQjnu2ZE%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b001e7250f834eff8d5b5ad49bae2276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=dI097CXlbY0Qa0uSEaL7VhX%2BJxg%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ac21e1f2774d39a9949f2506e08b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=V%2BXckB4jZqhsseJua5Ygu%2F%2FxSEI%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d364b972bc3b45ac8bf88fb111aff29f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=0TZkJga%2BqxnMQ02ZV4tePs3beQQ%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b73f2ea3bc5f42a48a74b4bfc71a002d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=fJLQtUZ%2FrSvHjUd2XY1K7WlgeBc%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e9bb66b4ea54d569c17be8e3987695c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=5NbId9MGF%2B3iDPKz3jm0aepjB8E%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c09e7f182b4442a2244f41c6142fd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=dZUGIr5KGvVqCkMR%2F0eSd%2BC7Ndo%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea79bf4204e44ae593f40fa5e1027fc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=xdLn1BgZ1oE6oanIVewqZrwSbc8%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9a9acc4146446c9ad57dd0269988d42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=wTrcxwF%2FFFnAAJEuIsGpWK7KoT4%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/859526f52bd44faf8f2cf4e78c4de087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=oSH5X0NwFMFHIgl4Ay1jIHfVzww%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d93e710b272d4e2ab661248d66036743~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=tLAKt%2FRDnFWIg53BskKexMAdves%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d853e912f84402ebc78600e3ad0e2fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=yU0wYCqeJnIfVQeBQFauS4%2B1n14%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08187ee0a845410fba631c29384ed2bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=VDg%2FWk91Q47ooqdB4VFAM9G2hGk%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92ef0d6267a44780a368a1afc35b4ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=hl6rH%2F%2FP1Pe3i01mFpoNYpZSm48%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac6a01d56aa344b28f8097bf0f41a62f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=tdEgTTkvH2ztZpuDvST3MdGAJ0Q%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ae84583590f46088fe7569f6f2c923a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=OVnqcmqnZE4OELUOU2ge2hLzXLs%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1956f02afb9747ae889df0cca4d5ec2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=g5cjS3xRZlRMTclVsvgzm5eWql4%3D" width="200" height="266" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e2a8c6fadd34f00b52d8913eb5e4d77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=MhF1FtO3SEexateOZdWL4b%2BZiA4%3D" width="200" height="266" loading="lazy"/>
<h2 data-id="heading-3">3、核心能力</h2>





























<table><thead><tr><th>能力</th><th>说明</th></tr></thead><tbody><tr><td>GitHub Trending 爬虫</td><td>支持按语言、时间维度（日/周/月）筛选，默认抓取 Top 10</td></tr><tr><td>数据校验</td><td>基于 Zod Schema 的运行时类型校验，确保数据质量</td></tr><tr><td>卡片渲染</td><td>18 套精心设计的 HTML 模板，通过 Playwright 截图生成 2x 高清 PNG</td></tr><tr><td>AI 文案生成</td><td>接入 Google Gemini API，流式输出技术文案</td></tr><tr><td>定时自动化</td><td>GitHub Actions 每月 1 号自动执行，打包产物并创建 Release</td></tr></tbody></table>
<h2 data-id="heading-4">4、技术选型与考量</h2>
<h3 data-id="heading-5">4.1 运行时与语言</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>语言</td><td>TypeScript</td><td>完整的类型系统，编译期捕获错误，提升代码可维护性</td></tr><tr><td>运行时</td><td>Node.js (ES2022)</td><td>丰富的 npm 生态，异步 I/O 天然适合爬虫与网络请求场景</td></tr><tr><td>包管理</td><td>pnpm</td><td>更快的安装速度，节省磁盘空间的硬链接机制</td></tr></tbody></table>
<h3 data-id="heading-6">4.2 数据采集层</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>HTTP 客户端</td><td>Axios</td><td>成熟稳定，支持拦截器、超时控制、自动 JSON 解析</td></tr><tr><td>HTML 解析</td><td>Cheerio</td><td>轻量级 jQuery 式 API，无需启动浏览器，解析速度快</td></tr><tr><td>数据校验</td><td>Zod</td><td>TypeScript-first 的运行时校验库，Schema 即类型</td></tr></tbody></table>
<p><strong>为什么不用 Puppeteer/Playwright 来爬取？</strong>
GitHub Trending 页面是服务端渲染的静态 HTML，不涉及 JavaScript 动态加载。使用 Cheerio 解析 HTML 字符串即可，无需启动完整浏览器，资源消耗极低。</p>
<h3 data-id="heading-7">4.3 渲染层</h3>




















<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>浏览器引擎</td><td>Playwright (Chromium)</td><td>跨平台一致性好，API 现代化，截图质量高</td></tr><tr><td>模板方案</td><td>原生 HTML + CSS</td><td>设计自由度高，不依赖额外模板引擎，所见即所得</td></tr></tbody></table>
<p><strong>为什么选择 Playwright 而非 Canvas/SVG？</strong>
使用 HTML/CSS 模板配合浏览器截图，设计师可以直接用前端技术栈制作模板，修改样式只需调整 CSS，无需理解 Canvas API 或 SVG 规范。18 套不同风格的模板充分证明了这一方案的灵活性。</p>
<h3 data-id="heading-8">4.4 AI 内容生成层</h3>

























<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>LLM</td><td>Google Gemini (gemini-3-flash-preview)</td><td>速度快、成本低，中文能力优秀</td></tr><tr><td>输出方式</td><td>流式生成 (Streaming)</td><td>实时反馈，用户体验好；长文本生成不会超时</td></tr><tr><td>Prompt 管理</td><td>独立 Markdown 文件</td><td>与代码解耦，非技术人员也能调整文案风格</td></tr></tbody></table>
<h3 data-id="heading-9">4.5 测试与 CI/CD</h3>




















<table><thead><tr><th>技术</th><th>选择</th><th>理由</th></tr></thead><tbody><tr><td>测试框架</td><td>Vitest</td><td>原生 ESM 支持，与 TypeScript 无缝集成，运行速度快</td></tr><tr><td>CI/CD</td><td>GitHub Actions</td><td>与代码仓库深度整合，支持定时触发和手动触发</td></tr></tbody></table>
<h2 data-id="heading-10">5、架构设计</h2>
<h3 data-id="heading-11">5.1 整体流水线</h3>
<pre><code class="hljs language-scss" lang="scss">┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│  GitHub      │    │   Cheerio    │    │     Zod      │
│  Trending    │───▶│   <span class="hljs-selector-tag">HTML</span> 解析   │───▶│  Schema 校验  │
│  (HTTP GET)  │    │              │    │              │
└──────────────┘    └──────────────┘    └──────┬───────┘
                                               │
                                    ┌──────────┴──────────┐
                                    │                     │
                              ┌─────▼──────┐      ┌──────▼───────┐
                              │ Playwright │      │  Gemini LLM  │
                              │ 卡片渲染    │      │  文案生成     │
                              └─────┬──────┘      └──────┬───────┘
                                    │                     │
                              ┌─────▼──────┐      ┌──────▼───────┐
                              │  PNG 图片   │      │  文案   │
                              │  (<span class="hljs-number">18</span>模板)   │      │  (post.txt)  │
                              └────────────┘      └──────────────┘
</code></pre>
<h3 data-id="heading-12">5.2 自动化流程</h3>
<p>GitHub Actions 工作流实现全自动运行：</p>
<pre><code class="hljs language-sql" lang="sql">每月 <span class="hljs-number">1</span> 号 <span class="hljs-number">12</span>:<span class="hljs-number">00</span> (北京时间)
       │
       ▼
  拉取代码 → 安装依赖 → 执行 pnpm <span class="hljs-keyword">start</span>
       │
       ▼
  生成 JSON <span class="hljs-operator">+</span> PNG 卡片 <span class="hljs-operator">+</span> 文案
       │
       ▼
  打包为 ZIP → 创建 GitHub <span class="hljs-keyword">Release</span>（带版本号 vYYYY.MM）
</code></pre>
<p>支持 <code>workflow_dispatch</code> 手动触发，方便临时运行。</p>
<h2 data-id="heading-13">6、模板是怎么来的：用 Google Stitch 批量生成卡片模板</h2>
<p>项目内置的 18 套卡片模板，全部由 AI 生成——使用的工具是 Google Labs 推出的 <strong>Stitch</strong>。</p>
<h3 data-id="heading-14">6.1 什么是 Google Stitch</h3>
<p>Stitch 是 Google Labs 推出的 AI 辅助 UI/UX 设计工具，核心能力是 <strong>Text-to-UI</strong>：输入一段自然语言描述，即可自动生成包含布局、配色、组件和交互逻辑的完整界面设计。除了文字输入，还支持草图识别和截图参考等多模态输入方式。最关键的一点：Stitch 生成的不是图片，而是<strong>可运行的 HTML/CSS 代码</strong>，这正好满足了本项目「HTML 模板 + Playwright 截图」的渲染方案。</p>
<h3 data-id="heading-15">6.2 模板生成链路</h3>
<pre><code class="hljs language-css" lang="css">需求描述（Prompt）
    │
    ▼
Google Stitch（Text-<span class="hljs-selector-tag">to</span>-UI）
    │
    ▼
生成可运行的 <span class="hljs-selector-tag">HTML</span>/CSS 代码
    │
    ▼
AI微调样式 + 插入占位符（{{rank}}、{{name}} 等）
    │
    ▼
保存为项目模板（<span class="hljs-attribute">src</span>/renderer/templates/<span class="hljs-number">1</span>~<span class="hljs-number">18</span><span class="hljs-selector-class">.html</span>）
</code></pre>
<p>具体流程：</p>
<ol>
<li><strong>向 Stitch 描述卡片需求</strong>：包括用途（GitHub 项目展示卡片）、尺寸（3:4 竖版，适配社交媒体）、需要展示的信息字段（项目名、描述、Star 数等），以及期望的视觉风格（如赛博朋克、毛玻璃、极简等）</li>
<li><strong>Stitch 生成 HTML/CSS</strong>：AI 自动输出完整的前端代码，包含布局结构和视觉样式</li>
<li><strong>AI微调与模板化</strong>：将生成代码中的具体数据替换为占位符（<code>{{rank}}</code>、<code>{{name}}</code>、<code>{{stars}}</code> 等），并对细节样式做适当调整</li>
<li><strong>集成到项目</strong>：将最终模板放入 <code>src/renderer/templates/</code> 目录，供 Playwright 渲染引擎使用</li>
</ol>
<h3 data-id="heading-16">6.3 模板效果展示</h3>
<p>以下是通过 Stitch 生成的部分模板预览：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11eb22a9e0c9433893f8c91a0a36b841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=2CYaEUAoIUSH8OX50bqvS0ep%2Bto%3D" alt="template-1.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d033b04407c4ea8abfcf7a38f43a8d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=Xq0Rz7I8CjdKafjoyrhqfMYaNCI%3D" alt="template-2.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d567d13cb2c4cd5b19c6283390ec98d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fpem9uZ2Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770108739&amp;x-signature=Hb4agUkm%2BmgADsePdNOVKDJqnMg%3D" alt="template-3.png" loading="lazy"/></p>
<p>18 套模板涵盖了赛博朋克、毛玻璃、蓝图、杂志、像素风、漫画风等多种视觉风格。</p>
<h2 data-id="heading-17">7、结尾</h2>
<p>本项目中的代码与文档大部分由 AI 生成。如果大家对相关代码或 Prompt 写法感兴趣，欢迎关注或 Star 我的github仓库，包含开发过程中所有的prompt和文档。</p>
<p>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLittleBreak%2Fgithub-trending-scraper" target="_blank" title="https://github.com/LittleBreak/github-trending-scraper" ref="nofollow noopener noreferrer">github.com/LittleBreak…</a></p>
<p>如果大家对具体生成的小红书文章感兴趣，可以去关注我的小红书账号，看下实际效果～</p>
<p>小红书文章: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaohongshu.com%2Fdiscovery%2Fitem%2F6976204a000000000b0100ff%3Fsource%3Dwebshare%26xhsshare%3Dpc_web%26xsec_token%3DABtsM9pwf4mv56dzPNo_fvi4-O2uqnQyr-QIzO1kLWDnk%3D%26xsec_source%3Dpc_share" target="_blank" title="https://www.xiaohongshu.com/discovery/item/6976204a000000000b0100ff?source=webshare&amp;xhsshare=pc_web&amp;xsec_token=ABtsM9pwf4mv56dzPNo_fvi4-O2uqnQyr-QIzO1kLWDnk=&amp;xsec_source=pc_share" ref="nofollow noopener noreferrer">GitHub 本月最火 Top10，AI Coding 霸榜！</a></p>
<p>另外我也开放共享了卡片模板的 Stitch 项目，大家可以直接访问并做任意编辑，没任何限制</p>
<p>stitch: <a href="https://link.juejin.cn?target=https%3A%2F%2Fstitch.withgoogle.com%2Fprojects%2F12543921965028912020" target="_blank" title="https://stitch.withgoogle.com/projects/12543921965028912020" ref="nofollow noopener noreferrer">github trend card stitch card project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Sentinel具体怎么使用呢]]></title>    <link>https://juejin.cn/post/7599634796583092230</link>    <guid>https://juejin.cn/post/7599634796583092230</guid>    <pubDate>2026-01-27T07:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599634796583092230" data-draft-id="7599572091076083754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Sentinel具体怎么使用呢"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Sentinel具体怎么使用呢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:16:51.000Z" title="Tue Jan 27 2026 07:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面给你一套<strong>Sentinel 在 Spring Cloud Alibaba 里最常见、最“能跑起来”的用法</strong>：从「接入 → 控制台 → 对接口限流/熔断 → 动态规则（Nacos）」一步到位。</p>
<hr/>
<h2 data-id="heading-0">1）你需要先理解 Sentinel 的两部分</h2>
<ul>
<li><strong>客户端（埋点 + 执行规则）</strong> ：集成在你的业务服务里</li>
<li><strong>Dashboard 控制台（看监控 + 推规则）</strong> ：一个独立 Spring Boot 应用</li>
</ul>
<p>控制台启动方式（示例把控制台端口设为 8858）：</p>
<pre><code class="hljs language-ini" lang="ini">java <span class="hljs-attr">-Dserver.port</span>=<span class="hljs-number">8858</span> \
     <span class="hljs-attr">-Dcsp.sentinel.dashboard.server</span>=localhost:<span class="hljs-number">8858</span> \
     <span class="hljs-attr">-Dproject.name</span>=sentinel-dashboard \
     -jar sentinel-dashboard.jar
</code></pre>
<p>控制台就是标准 Spring Boot 应用，直接跑 jar 即可。</p>
<hr/>
<h2 data-id="heading-1">2）业务服务引入依赖</h2>
<p>如果你用 <strong>Spring Cloud Alibaba</strong>，一般就是引 starter（版本用你项目 BOM 对齐即可）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>（Maven Central 能看到当前新版本坐标，例如 2025.x 线）</p>
<hr/>
<h2 data-id="heading-2">3）业务服务最小配置：让它出现在 Dashboard</h2>
<p><code>application.yml</code>（关键是 dashboard 地址 + transport 端口）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">transport:</span>
        <span class="hljs-attr">dashboard:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8858</span>
        <span class="hljs-attr">port:</span> <span class="hljs-number">8719</span>
</code></pre>
<p>说明：</p>
<ul>
<li><code>spring.cloud.sentinel.transport.port</code> 会在<strong>业务机器上</strong>起一个 HTTP Server（默认常用 8719），用于和控制台交互（接收推送规则、上报心跳等）。</li>
<li>你会经常看到 “8719 端口为什么被占用”，就是这个机制（可改）。</li>
</ul>
<blockquote>
<p>启动顺序建议：先启动 Dashboard → 再启动业务服务 → 访问一次接口产生流量，服务才会出现在控制台里（Sentinel 是“有流量才显示/才有资源”的思路）。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">4）对 HTTP 接口做限流（最常用）</h2>
<h3 data-id="heading-4">4.1 直接对 Controller 接口限流（默认资源=URL）</h3>
<p>比如你的接口：<code>GET /api/orders</code></p>
<p>你到 Dashboard：</p>
<ul>
<li>
<p><strong>簇点链路</strong>：能看到 <code>/api/orders</code></p>
</li>
<li>
<p>进入该资源 → <strong>流控规则</strong></p>
<ul>
<li>QPS：比如 <code>count=10</code></li>
<li>超过 10QPS 就被限流（返回 BlockException）</li>
</ul>
</li>
</ul>
<p>这套是最快上手的“对 URL 做保护”。</p>
<h3 data-id="heading-5">4.2 自定义资源名 + 降级兜底（更企业级）</h3>
<p>用 <code>@SentinelResource</code> 给资源命名，并提供 blockHandler/fallback（不同异常走不同兜底）：</p>
<ul>
<li><strong>blockHandler</strong>：被限流/熔断触发时走这里</li>
<li><strong>fallback</strong>：业务异常/超时等走这里</li>
</ul>
<p>（你贴一下你是 MVC 还是 WebFlux、是否用 Feign，我可以给你对应的最标准示例。）</p>
<hr/>
<h2 data-id="heading-6">5）熔断降级怎么配（Degrade / Circuit Breaker）</h2>
<p>在 Dashboard 对某资源加 <strong>“降级规则”</strong> ，常见维度：</p>
<ul>
<li><strong>慢调用比例</strong>（RT 过高就熔断）</li>
<li><strong>异常比例/异常数</strong>（错误率高就熔断）</li>
</ul>
<p>当触发熔断时，该资源会在一段时间内快速失败（走 blockHandler/fallback），避免把下游打死。</p>
<hr/>
<h2 data-id="heading-7">6）生产必备：规则不要只存在 Dashboard 内存里（要动态持久化）</h2>
<p>Sentinel 官方建议生产用 <strong>动态规则数据源</strong>（Nacos / Apollo / ZK / Redis…）</p>
<h3 data-id="heading-8">6.1 用 Nacos 做规则中心（典型配置）</h3>
<p>你在业务服务里加 datasource 配置（示例：流控规则 flow）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.server-addr</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8848</span>
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.data-id</span>=order-service-flow-rules
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.group-id</span>=DEFAULT_GROUP
<span class="hljs-attr">spring.cloud.sentinel.datasource.ds.nacos.rule-type</span>=flow
</code></pre>
<p>然后在 <strong>Nacos 配置中心</strong>创建 <code>data-id=order-service-flow-rules</code>，内容放 JSON（数组）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/orders"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"limitApp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"grade"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"controlBehavior"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"clusterMode"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<p>（JSON 字段含义：resource 资源名、count 阈值、grade=1 表示 QPS 等）</p>
<hr/>
<h2 data-id="heading-9">7）在项目里最常见的 3 个落地点</h2>
<ol>
<li><strong>入口保护（HTTP 接口）</strong> ：对 <code>/api/**</code> 做 QPS、热点参数限流</li>
<li><strong>出口保护（调用下游）</strong> ：Feign/RestTemplate/WebClient 调用下游时做熔断+隔离</li>
<li><strong>网关层统一保护（Gateway Sentinel）</strong> ：路由级别限流、按 API 维度限流</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[静态类与类型扩展]]></title>    <link>https://juejin.cn/post/7599828354514501672</link>    <guid>https://juejin.cn/post/7599828354514501672</guid>    <pubDate>2026-01-27T06:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599828354514501672" data-draft-id="7599703627790286888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="静态类与类型扩展"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T06:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8815838029450"/> <meta itemprop="url" content="https://juejin.cn/user/339129318513335"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            静态类与类型扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339129318513335/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8815838029450
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:29:33.000Z" title="Tue Jan 27 2026 06:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">专栏导航</h2>
<ul>
<li>← 上一篇：<a href="https://juejin.cn/post/7599828354514452520" target="_blank" title="https://juejin.cn/post/7599828354514452520">对象的行为 - 对象中的方法</a></li>
<li>← 第一篇：<a href="https://juejin.cn/post/7594642978695233599" target="_blank" title="https://juejin.cn/post/7594642978695233599">编程世界初探</a></li>
<li><a href="https://juejin.cn/post/7596989416761131043" target="_blank" title="https://juejin.cn/post/7596989416761131043">专栏目录</a></li>
</ul>
<blockquote>
<p>前一章我们学习了类和对象的基础，这一章我们将学习两种特殊的类使用方式：静态类和类型扩展。它们可以让我们的代码更加灵活和强大。</p>
</blockquote>
<h3 data-id="heading-1">静态类（Static Class）</h3>
<h4 data-id="heading-2">什么是静态类？</h4>
<p><strong>静态类</strong> 是一种特殊的类，它<strong>不能被实例化</strong>（不能创建对象），直接通过类名访问其成员。</p>
<p><strong>类比：</strong></p>
<ul>
<li>普通类 = 手机店（可以创建多部手机）</li>
<li>静态类 = 广播塔（只有一个，直接使用，不需要创建）</li>
</ul>
<h4 data-id="heading-3">静态类的特点</h4>
<p>✅ <strong>不能创建对象</strong>：不需要使用 <code>new</code> 关键字
✅ <strong>所有成员必须是静态的</strong>：方法和属性都需要加 <code>static</code> 关键字
✅ <strong>只能有一个实例</strong>：全局共享
✅ <strong>用于工具方法</strong>：如 Math 类、Console 类</p>
<h4 data-id="heading-4">静态类 vs 普通类</h4>



































<table><thead><tr><th>特性</th><th>普通类</th><th>静态类</th></tr></thead><tbody><tr><td>创建对象</td><td>需要 <code>new</code></td><td>不能创建</td></tr><tr><td>访问方式</td><td>对象.方法</td><td>类名.方法</td></tr><tr><td>实例</td><td>可以有多个</td><td>只有一个</td></tr><tr><td>成员</td><td>可包含静态和非静态</td><td>必须都是静态</td></tr><tr><td>适用场景</td><td>需要多个实例</td><td>工具类、辅助方法</td></tr></tbody></table>
<h4 data-id="heading-5">为什么要用静态类？</h4>
<p><strong>场景一：工具方法</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不使用静态类 - 每次都要创建对象</span>
MathHelper helper = <span class="hljs-keyword">new</span> MathHelper();
<span class="hljs-built_in">double</span> result = helper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);

<span class="hljs-comment">// 使用静态类 - 直接调用</span>
<span class="hljs-built_in">double</span> result = MathHelper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
</code></pre>
<p><strong>场景二：全局共享数据</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 配置信息</span>
ConfigHelper.GetDatabaseConnection();
ConfigHelper.GetApiKey();
</code></pre>
<h4 data-id="heading-6">定义静态类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 使用 static 关键字定义静态类</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> 类名
{
    <span class="hljs-comment">// 静态属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 数据类型 属性名 { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 返回值类型 方法名(参数列表)
    {
        <span class="hljs-comment">// 方法体</span>
    }
}
</code></pre>
<h4 data-id="heading-7">示例：MathHelper 静态类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 定义静态工具类</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MathHelper</span>
{
    <span class="hljs-comment">// 静态方法：计算两个数的和</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Add</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a + b;
    }

    <span class="hljs-comment">// 静态方法：计算两个数的差</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Subtract</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a - b;
    }

    <span class="hljs-comment">// 静态方法：计算两个数的积</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">Multiply</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> a, <span class="hljs-built_in">double</span> b</span>)</span>
    {
        <span class="hljs-keyword">return</span> a * b;
    }

    <span class="hljs-comment">// 静态方法：计算圆面积</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> <span class="hljs-title">CalculateCircleArea</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> radius</span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-number">3.1415926</span> * radius * radius;
    }

    <span class="hljs-comment">// 静态方法：判断是否为偶数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEven</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
    }
}

<span class="hljs-comment">// 使用静态类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 直接通过类名调用，不需要创建对象</span>
        <span class="hljs-built_in">double</span> sum = MathHelper.Add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>);
        Console.WriteLine(<span class="hljs-string">$"5 + 3 = <span class="hljs-subst">{sum}</span>"</span>);

        <span class="hljs-built_in">double</span> difference = MathHelper.Subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>);
        Console.WriteLine(<span class="hljs-string">$"10 - 4 = <span class="hljs-subst">{difference}</span>"</span>);

        <span class="hljs-built_in">double</span> area = MathHelper.CalculateCircleArea(<span class="hljs-number">5</span>);
        Console.WriteLine(<span class="hljs-string">$"半径为5的圆面积：<span class="hljs-subst">{area:F2}</span>"</span>);

        <span class="hljs-built_in">bool</span> isEven = MathHelper.IsEven(<span class="hljs-number">7</span>);
        Console.WriteLine(<span class="hljs-string">$"7 是偶数吗？<span class="hljs-subst">{isEven}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-ini" lang="ini">5 + <span class="hljs-attr">3</span> = <span class="hljs-number">8</span>
10 - <span class="hljs-attr">4</span> = <span class="hljs-number">6</span>
半径为5的圆面积：78.54
7 是偶数吗？False
</code></pre>
<h4 data-id="heading-8">静态属性</h4>
<p>静态属性在所有对象之间共享。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Counter</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 静态字段</span>

    <span class="hljs-comment">// 静态属性</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> Count
    {
        <span class="hljs-keyword">get</span> { <span class="hljs-keyword">return</span> count; }
    }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Increment</span>()</span>
    {
        count++;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Reset</span>()</span>
    {
        count = <span class="hljs-number">0</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"初始计数：<span class="hljs-subst">{Counter.Count}</span>"</span>);

        Counter.Increment();
        Counter.Increment();
        Counter.Increment();

        Console.WriteLine(<span class="hljs-string">$"增加3次后：<span class="hljs-subst">{Counter.Count}</span>"</span>);

        Counter.Reset();
        Console.WriteLine(<span class="hljs-string">$"重置后：<span class="hljs-subst">{Counter.Count}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs">初始计数：0
增加3次后：3
重置后：0
</code></pre>
<h4 data-id="heading-9">常见的静态类</h4>
<p><strong>1. Math 类（数学运算）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">double</span> max = Math.Max(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);      <span class="hljs-comment">// 最大值：10</span>
<span class="hljs-built_in">double</span> min = Math.Min(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>);      <span class="hljs-comment">// 最小值：5</span>
<span class="hljs-built_in">double</span> abs = Math.Abs(<span class="hljs-number">-5</span>);         <span class="hljs-comment">// 绝对值：5</span>
<span class="hljs-built_in">double</span> power = Math.Pow(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);     <span class="hljs-comment">// 幂运算：8</span>
<span class="hljs-built_in">double</span> sqrt = Math.Sqrt(<span class="hljs-number">16</span>);       <span class="hljs-comment">// 平方根：4</span>
<span class="hljs-built_in">double</span> pi = Math.PI;                <span class="hljs-comment">// 圆周率：3.14159...</span>
</code></pre>
<p><strong>2. Console 类（输入输出）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">Console.WriteLine(<span class="hljs-string">"输出信息"</span>);     <span class="hljs-comment">// 输出</span>
<span class="hljs-built_in">string</span> input = Console.ReadLine();  <span class="hljs-comment">// 输入</span>
Console.Clear();                    <span class="hljs-comment">// 清屏</span>
</code></pre>
<p><strong>3. DateTime 类（时间操作）</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime now = DateTime.Now;        <span class="hljs-comment">// 当前时间</span>
<span class="hljs-built_in">string</span> today = DateTime.Today.ToString();
<span class="hljs-built_in">int</span> year = DateTime.Now.Year;       <span class="hljs-comment">// 当前年份</span>
</code></pre>
<h4 data-id="heading-10">实践：StringHelper 静态工具类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态字符串工具类</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringHelper</span>
    {
        <span class="hljs-comment">// 反转字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Reverse</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">char</span>[] chars = text.ToCharArray();
            Array.Reverse(chars);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(chars);
        }

        <span class="hljs-comment">// 判断是否为回文</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPalindrome</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">string</span> reversed = Reverse(text);
            <span class="hljs-keyword">return</span> text.ToLower() == reversed.ToLower();
        }

        <span class="hljs-comment">// 统计单词数量</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">CountWords</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

            <span class="hljs-built_in">string</span>[] words = text.Split(<span class="hljs-keyword">new</span>[] { <span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\n'</span> }, StringSplitOptions.RemoveEmptyEntries);
            <span class="hljs-keyword">return</span> words.Length;
        }

        <span class="hljs-comment">// 生成重复字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Repeat</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> text, <span class="hljs-built_in">int</span> count</span>)</span>
        {
            <span class="hljs-built_in">string</span> result = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++)
            {
                result += text;
            }
            <span class="hljs-keyword">return</span> result;
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 字符串工具类演示 =====\n"</span>);

            <span class="hljs-comment">// 反转字符串</span>
            <span class="hljs-built_in">string</span> original = <span class="hljs-string">"Hello World"</span>;
            <span class="hljs-built_in">string</span> reversed = StringHelper.Reverse(original);
            Console.WriteLine(<span class="hljs-string">$"原字符串：<span class="hljs-subst">{original}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"反转后：<span class="hljs-subst">{reversed}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 判断回文</span>
            <span class="hljs-built_in">string</span>[] testWords = { <span class="hljs-string">"racecar"</span>, <span class="hljs-string">"level"</span>, <span class="hljs-string">"hello"</span>, <span class="hljs-string">"radar"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> word <span class="hljs-keyword">in</span> testWords)
            {
                <span class="hljs-built_in">bool</span> isPalindrome = StringHelper.IsPalindrome(word);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{word}</span>' 是回文吗？<span class="hljs-subst">{isPalindrome}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 统计单词</span>
            <span class="hljs-built_in">string</span> sentence = <span class="hljs-string">"C# is an amazing programming language"</span>;
            <span class="hljs-built_in">int</span> wordCount = StringHelper.CountWords(sentence);
            Console.WriteLine(<span class="hljs-string">$"句子：'<span class="hljs-subst">{sentence}</span>'"</span>);
            Console.WriteLine(<span class="hljs-string">$"单词数量：<span class="hljs-subst">{wordCount}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 重复字符串</span>
            <span class="hljs-built_in">string</span> pattern = <span class="hljs-string">"abc"</span>;
            <span class="hljs-built_in">int</span> repeatCount = <span class="hljs-number">5</span>;
            <span class="hljs-built_in">string</span> repeated = StringHelper.Repeat(pattern, repeatCount);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{pattern}</span>' 重复 <span class="hljs-subst">{repeatCount}</span> 次：<span class="hljs-subst">{repeated}</span>"</span>);
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python">===== 字符串工具类演示 =====

原字符串：Hello World
反转后：dlroW olleH

<span class="hljs-string">'racecar'</span> 是回文吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'level'</span> 是回文吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'hello'</span> 是回文吗？<span class="hljs-literal">False</span>
<span class="hljs-string">'radar'</span> 是回文吗？<span class="hljs-literal">True</span>

句子：<span class="hljs-string">'C# is an amazing programming language'</span>
单词数量：<span class="hljs-number">6</span>

<span class="hljs-string">'abc'</span> 重复 <span class="hljs-number">5</span> 次：abcabcabcabcabc
</code></pre>
<h4 data-id="heading-11">实践：Validator 静态验证类</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态验证工具类</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Validator</span>
    {
        <span class="hljs-comment">// 验证邮箱格式</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidEmail</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> email</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(email))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 简单验证：包含 @ 和 .</span>
            <span class="hljs-keyword">return</span> email.Contains(<span class="hljs-string">"@"</span>) &amp;&amp; email.Contains(<span class="hljs-string">"."</span>);
        }

        <span class="hljs-comment">// 验证手机号（11位数字）</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidPhoneNumber</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> phone</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(phone) || phone.Length != <span class="hljs-number">11</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 检查是否全是数字</span>
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> phone)
            {
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">char</span>.IsDigit(c))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// 验证年龄</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidAge</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> age</span>)</span>
        {
            <span class="hljs-keyword">return</span> age &gt;= <span class="hljs-number">0</span> &amp;&amp; age &lt;= <span class="hljs-number">150</span>;
        }

        <span class="hljs-comment">// 验证密码强度（至少6位）</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsValidPassword</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> password</span>)</span>
        {
            <span class="hljs-keyword">return</span> !<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(password) &amp;&amp; password.Length &gt;= <span class="hljs-number">6</span>;
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== 数据验证工具 =====\n"</span>);

            <span class="hljs-comment">// 验证邮箱</span>
            <span class="hljs-built_in">string</span>[] emails = { <span class="hljs-string">"test@example.com"</span>, <span class="hljs-string">"invalid-email"</span>, <span class="hljs-string">"user@"</span>, <span class="hljs-string">"good@domain.org"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> email <span class="hljs-keyword">in</span> emails)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidEmail(email);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证手机号</span>
            <span class="hljs-built_in">string</span>[] phones = { <span class="hljs-string">"13800138000"</span>, <span class="hljs-string">"123"</span>, <span class="hljs-string">"12345678901"</span>, <span class="hljs-string">"1234567890a"</span>, <span class="hljs-string">"15912345678"</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> phone <span class="hljs-keyword">in</span> phones)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidPhoneNumber(phone);
                Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证年龄</span>
            <span class="hljs-built_in">int</span>[] ages = { <span class="hljs-number">25</span>, <span class="hljs-number">-5</span>, <span class="hljs-number">150</span>, <span class="hljs-number">200</span>, <span class="hljs-number">0</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">int</span> age <span class="hljs-keyword">in</span> ages)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidAge(age);
                Console.WriteLine(<span class="hljs-string">$"年龄 <span class="hljs-subst">{age}</span> - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }

            Console.WriteLine();

            <span class="hljs-comment">// 验证密码</span>
            <span class="hljs-built_in">string</span>[] passwords = { <span class="hljs-string">"123456"</span>, <span class="hljs-string">"123"</span>, <span class="hljs-string">"abc"</span>, <span class="hljs-string">"password123"</span>, <span class="hljs-string">""</span> };
            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">string</span> password <span class="hljs-keyword">in</span> passwords)
            {
                <span class="hljs-built_in">bool</span> isValid = Validator.IsValidPassword(password);
                <span class="hljs-built_in">string</span> masked = password.Length &gt; <span class="hljs-number">0</span> ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(<span class="hljs-string">'*'</span>, password.Length) : <span class="hljs-string">"(空)"</span>;
                Console.WriteLine(<span class="hljs-string">$"密码 '<span class="hljs-subst">{masked}</span>' - <span class="hljs-subst">{(isValid ? <span class="hljs-string">"✓ 有效"</span> : <span class="hljs-string">"✗ 无效"</span>)}</span>"</span>);
            }
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-scss" lang="scss">===== 数据验证工具 =====

'test<span class="hljs-keyword">@example</span>.com<span class="hljs-string">' - ✓ 有效
'</span>invalid-email<span class="hljs-string">' - ✗ 无效
'</span>user@<span class="hljs-string">' - ✗ 无效
'</span>good<span class="hljs-keyword">@domain</span>.org<span class="hljs-string">' - ✓ 有效

'</span><span class="hljs-number">13800138000</span><span class="hljs-string">' - ✓ 有效
'</span><span class="hljs-number">123</span><span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">12345678901</span><span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">1234567890</span>a<span class="hljs-string">' - ✗ 无效
'</span><span class="hljs-number">15912345678</span><span class="hljs-string">' - ✓ 有效

年龄 25 - ✓ 有效
年龄 -5 - ✗ 无效
年龄 150 - ✓ 有效
年龄 200 - ✗ 无效
年龄 0 - ✓ 有效

密码 '</span>******<span class="hljs-string">' - ✓ 有效
密码 '</span>***<span class="hljs-string">' - ✗ 无效
密码 '</span>***<span class="hljs-string">' - ✗ 无效
密码 '</span>************<span class="hljs-string">' - ✓ 有效
密码 '</span>(空)<span class="hljs-string">' - ✗ 无效
</span></code></pre>
<h4 data-id="heading-12">静态类的限制</h4>
<p>❌ <strong>不能创建实例</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类不能创建对象</span>
MathHelper helper = <span class="hljs-keyword">new</span> MathHelper();
</code></pre>
<p>❌ <strong>不能继承其他类或被继承</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类不能继承</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyHelper</span> : <span class="hljs-title">BaseClass</span> { }

<span class="hljs-comment">// 错误！静态类不能被继承</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BaseClass</span> { }
<span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> : <span class="hljs-title">BaseClass</span> { }
</code></pre>
<p>❌ <strong>不能包含非静态成员</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误！静态类中的成员必须是静态的</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">NormalMethod</span>()</span> { }  <span class="hljs-comment">// 错误</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> MyProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }  <span class="hljs-comment">// 错误</span>
}
</code></pre>
<h4 data-id="heading-13">普通类中的静态成员</h4>
<p>普通类也可以包含静态成员，静态成员属于类本身，不属于某个对象。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }      <span class="hljs-comment">// 实例属性</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> totalCount = <span class="hljs-number">0</span>;     <span class="hljs-comment">// 静态字段</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>
    {
        Name = name;
        totalCount++;  <span class="hljs-comment">// 每创建一个对象，计数器加1</span>
    }

    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetTotalCount</span>()</span>
    {
        <span class="hljs-keyword">return</span> totalCount;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"初始学生数：<span class="hljs-subst">{Student.GetTotalCount()}</span>"</span>);

        Student s1 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"张三"</span>);
        Student s2 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"李四"</span>);
        Student s3 = <span class="hljs-keyword">new</span> Student(<span class="hljs-string">"王五"</span>);

        Console.WriteLine(<span class="hljs-string">$"当前学生数：<span class="hljs-subst">{Student.GetTotalCount()}</span>"</span>);  <span class="hljs-comment">// 3</span>

        <span class="hljs-comment">// 注意：不能通过对象访问静态成员</span>
        <span class="hljs-comment">// s1.GetTotalCount();  // 错误！</span>
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs">初始学生数：0
当前学生数：3
</code></pre>
<h4 data-id="heading-14">什么时候使用静态类？</h4>
<p>✅ <strong>适合使用的场景：</strong></p>
<ul>
<li>工具方法（如 MathHelper、StringHelper）</li>
<li>验证逻辑（如 Validator）</li>
<li>配置管理（如 ConfigHelper）</li>
<li>常量集合（如 Constants）</li>
<li>无状态的操作（输入输出确定）</li>
</ul>
<p>❌ <strong>不适合使用的场景：</strong></p>
<ul>
<li>需要维护状态</li>
<li>需要继承</li>
<li>需要多态</li>
<li>需要多个独立实例</li>
</ul>
<h4 data-id="heading-15">小贴士</h4>
<p>💡 <strong>命名建议：</strong> 静态工具类通常以 <code>Helper</code>、<code>Util</code>、<code>Validator</code> 等结尾</p>
<pre><code class="hljs language-csharp" lang="csharp">MathHelper, StringHelper, ConfigHelper
StringUtil, DateUtil
Validator, EmailValidator
</code></pre>
<p>💡 <strong>不要滥用静态类：</strong></p>
<ul>
<li>如果需要维护对象的状态，使用普通类</li>
<li>如果需要依赖注入，使用普通类</li>
<li>如果需要测试，普通类更容易 mock</li>
</ul>
<h3 data-id="heading-16">类型扩展（Extension Methods）</h3>
<h4 data-id="heading-17">什么是扩展方法？</h4>
<p><strong>扩展方法</strong> 是一种特殊的静态方法，可以为现有类型（如 string、int、甚至第三方库的类）添加新方法，而<strong>不需要修改原始类的代码</strong>或<strong>继承该类</strong>。</p>
<p><strong>类比：</strong></p>
<ul>
<li>原始类 = 一把普通剪刀</li>
<li>扩展方法 = 给剪刀加装了一个开瓶器功能</li>
<li>不需要重新造剪刀，只是在它的基础上"扩展"了能力</li>
</ul>
<h4 data-id="heading-18">为什么需要扩展方法？</h4>
<p><strong>场景一：为系统类型添加方法</strong></p>
<p>你想给 <code>string</code> 类型添加一个"是否为手机号"的判断方法，但不能修改 .NET 源代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 不使用扩展方法 - 调用不方便</span>
<span class="hljs-built_in">bool</span> isValid = Validator.IsPhoneNumber(<span class="hljs-string">"13800138000"</span>);

<span class="hljs-comment">// 使用扩展方法 - 调用更自然</span>
<span class="hljs-built_in">bool</span> isValid = <span class="hljs-string">"13800138000"</span>.IsPhoneNumber();
</code></pre>
<p><strong>场景二：第三方库类型</strong></p>
<p>使用第三方库时，想给它的类添加功能，但没有源代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 为第三方类添加方法</span>
someObject.CalculateAge();  <span class="hljs-comment">// 调用像自己的方法一样自然</span>
</code></pre>
<h4 data-id="heading-19">扩展方法的语法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 1. 必须在静态类中定义</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> 扩展类名
{
    <span class="hljs-comment">// 2. 方法必须是静态的</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> 返回值类型 方法名(<span class="hljs-keyword">this</span> 要扩展的类型 参数名)
    {
        <span class="hljs-comment">// 方法体</span>
    }
}
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li>第一个参数前必须加 <code>this</code> 关键字</li>
<li><code>this</code> 关键字指定要扩展的类型</li>
<li>调用时，第一个参数不需要传值（会被自动填充）</li>
</ul>
<h4 data-id="heading-20">示例：为 string 类型添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">Week9Practice</span>
{
    <span class="hljs-comment">// 定义静态类，包含扩展方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringExtensions</span>
    {
        <span class="hljs-comment">// 扩展方法1：判断是否为手机号</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPhoneNumber</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text) || text.Length != <span class="hljs-number">11</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> text)
            {
                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">char</span>.IsDigit(c))
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// 扩展方法2：判断是否为邮箱</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEmail</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">return</span> text.Contains(<span class="hljs-string">"@"</span>) &amp;&amp; text.Contains(<span class="hljs-string">"."</span>);
        }

        <span class="hljs-comment">// 扩展方法3：首字母大写</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToTitleCase</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(text))
                <span class="hljs-keyword">return</span> text;

            <span class="hljs-keyword">if</span> (text.Length == <span class="hljs-number">1</span>)
                <span class="hljs-keyword">return</span> text.ToUpper();

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">char</span>.ToUpper(text[<span class="hljs-number">0</span>]) + text.Substring(<span class="hljs-number">1</span>);
        }

        <span class="hljs-comment">// 扩展方法4：反转字符串</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">Reverse</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span>
        {
            <span class="hljs-built_in">char</span>[] chars = text.ToCharArray();
            Array.Reverse(chars);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>(chars);
        }
    }

    <span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
    {
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            Console.WriteLine(<span class="hljs-string">"===== String 类型扩展演示 =====\n"</span>);

            <span class="hljs-comment">// 使用扩展方法 - 看起来像 string 的原生方法！</span>
            <span class="hljs-built_in">string</span> phone1 = <span class="hljs-string">"13800138000"</span>;
            <span class="hljs-built_in">string</span> phone2 = <span class="hljs-string">"123"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone1}</span>' 是手机号吗？<span class="hljs-subst">{phone1.IsPhoneNumber()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{phone2}</span>' 是手机号吗？<span class="hljs-subst">{phone2.IsPhoneNumber()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 邮箱验证</span>
            <span class="hljs-built_in">string</span> email1 = <span class="hljs-string">"test@example.com"</span>;
            <span class="hljs-built_in">string</span> email2 = <span class="hljs-string">"invalid-email"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email1}</span>' 是邮箱吗？<span class="hljs-subst">{email1.IsEmail()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{email2}</span>' 是邮箱吗？<span class="hljs-subst">{email2.IsEmail()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 首字母大写</span>
            <span class="hljs-built_in">string</span> name1 = <span class="hljs-string">"hello"</span>;
            <span class="hljs-built_in">string</span> name2 = <span class="hljs-string">"world"</span>;

            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{name1}</span>' -&gt; <span class="hljs-subst">{name1.ToTitleCase()}</span>"</span>);
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{name2}</span>' -&gt; <span class="hljs-subst">{name2.ToTitleCase()}</span>"</span>);

            Console.WriteLine();

            <span class="hljs-comment">// 反转字符串</span>
            <span class="hljs-built_in">string</span> original = <span class="hljs-string">"C# Programming"</span>;
            Console.WriteLine(<span class="hljs-string">$"'<span class="hljs-subst">{original}</span>' 反转后：'<span class="hljs-subst">{original.Reverse()}</span>'"</span>);
        }
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python">===== String 类型扩展演示 =====

<span class="hljs-string">'13800138000'</span> 是手机号吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'123'</span> 是手机号吗？<span class="hljs-literal">False</span>

<span class="hljs-string">'test@example.com'</span> 是邮箱吗？<span class="hljs-literal">True</span>
<span class="hljs-string">'invalid-email'</span> 是邮箱吗？<span class="hljs-literal">False</span>

<span class="hljs-string">'hello'</span> -&gt; Hello
<span class="hljs-string">'world'</span> -&gt; World

<span class="hljs-string">'C# Programming'</span> 反转后：<span class="hljs-string">'gnimmargorP #C'</span>
</code></pre>
<h4 data-id="heading-21">示例：为 int 类型添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">IntExtensions</span>
{
    <span class="hljs-comment">// 判断是否为偶数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsEven</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 判断是否为奇数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsOdd</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">return</span> number % <span class="hljs-number">2</span> != <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 判断是否为质数</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsPrime</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">2</span>; i &lt;= Math.Sqrt(number); i++)
        {
            <span class="hljs-keyword">if</span> (number % i == <span class="hljs-number">0</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-comment">// 计算阶乘</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">long</span> <span class="hljs-title">Factorial</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-keyword">if</span> (number &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(<span class="hljs-string">"不能为负数"</span>);

        <span class="hljs-built_in">long</span> result = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">2</span>; i &lt;= number; i++)
        {
            result *= i;
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// 格式化为中文</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToChinese</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span>
    {
        <span class="hljs-built_in">string</span>[] digits = { <span class="hljs-string">"零"</span>, <span class="hljs-string">"一"</span>, <span class="hljs-string">"二"</span>, <span class="hljs-string">"三"</span>, <span class="hljs-string">"四"</span>, <span class="hljs-string">"五"</span>, <span class="hljs-string">"六"</span>, <span class="hljs-string">"七"</span>, <span class="hljs-string">"八"</span>, <span class="hljs-string">"九"</span> };
        <span class="hljs-built_in">string</span> result = <span class="hljs-string">""</span>;

        <span class="hljs-keyword">foreach</span> (<span class="hljs-built_in">char</span> c <span class="hljs-keyword">in</span> number.ToString())
        {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">char</span>.IsDigit(c))
            {
                result += digits[<span class="hljs-built_in">int</span>.Parse(c.ToString())];
            }
        }
        <span class="hljs-keyword">return</span> result;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-built_in">int</span> num = <span class="hljs-number">7</span>;

        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是偶数吗？<span class="hljs-subst">{num.IsEven()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是奇数吗？<span class="hljs-subst">{num.IsOdd()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{num}</span> 是质数吗？<span class="hljs-subst">{num.IsPrime()}</span>"</span>);

        Console.WriteLine();

        Console.WriteLine(<span class="hljs-string">$"5! = <span class="hljs-subst">{<span class="hljs-number">5.F</span>actorial()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"10! = <span class="hljs-subst">{<span class="hljs-number">10.F</span>actorial()}</span>"</span>);

        Console.WriteLine();

        <span class="hljs-built_in">int</span> year = <span class="hljs-number">2025</span>;
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{year}</span> 中文：<span class="hljs-subst">{year.ToChinese()}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-number">7</span> 是偶数吗？<span class="hljs-literal">False</span>
<span class="hljs-number">7</span> 是奇数吗？<span class="hljs-literal">True</span>
<span class="hljs-number">7</span> 是质数吗？<span class="hljs-literal">True</span>

<span class="hljs-number">5</span>! = <span class="hljs-number">120</span>
<span class="hljs-number">10</span>! = <span class="hljs-number">3628800</span>

<span class="hljs-number">2025</span> 中文：二零二五
</code></pre>
<h4 data-id="heading-22">示例：为自定义类添加扩展方法</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 自定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">Person</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Age { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name, <span class="hljs-built_in">int</span> age</span>)</span>
    {
        Name = name;
        Age = age;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">PrintInfo</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{Name}</span>, <span class="hljs-subst">{Age}</span>岁"</span>);
    }
}

<span class="hljs-comment">// 为 Person 类添加扩展方法</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PersonExtensions</span>
{
    <span class="hljs-comment">// 判断是否成年</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">IsAdult</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-keyword">return</span> person.Age &gt;= <span class="hljs-number">18</span>;
    }

    <span class="hljs-comment">// 获取星座</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">GetZodiacSign</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-comment">// 简化版：只作为示例</span>
        <span class="hljs-built_in">int</span> month = DateTime.Now.Month;
        <span class="hljs-built_in">int</span> day = DateTime.Now.Day;

        <span class="hljs-comment">// 实际应根据出生日期计算</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"狮子座"</span>;  <span class="hljs-comment">// 示例</span>
    }

    <span class="hljs-comment">// 格式化为问候语</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToGreeting</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> Person person</span>)</span>
    {
        <span class="hljs-keyword">if</span> (person.IsAdult())
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"你好，<span class="hljs-subst">{person.Name}</span> 先生/女士"</span>;
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"你好，<span class="hljs-subst">{person.Name}</span> 小朋友"</span>;
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Person adult = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"张三"</span>, <span class="hljs-number">25</span>);
        Person child = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">"小明"</span>, <span class="hljs-number">12</span>);

        Console.WriteLine(<span class="hljs-string">"=== 成年人 ==="</span>);
        adult.PrintInfo();
        Console.WriteLine(<span class="hljs-string">$"是否成年：<span class="hljs-subst">{adult.IsAdult()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"问候：<span class="hljs-subst">{adult.ToGreeting()}</span>"</span>);

        Console.WriteLine();

        Console.WriteLine(<span class="hljs-string">"=== 小朋友 ==="</span>);
        child.PrintInfo();
        Console.WriteLine(<span class="hljs-string">$"是否成年：<span class="hljs-subst">{child.IsAdult()}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"问候：<span class="hljs-subst">{child.ToGreeting()}</span>"</span>);
    }
}
</code></pre>
<p><strong>输出：</strong></p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">=== 成年人 ===</span>
张三, 25岁
是否成年：True
问候：你好，张三 先生/女士

<span class="hljs-comment">=== 小朋友 ===</span>
小明, 12岁
是否成年：False
问候：你好，小明 小朋友
</code></pre>
<h4 data-id="heading-23">扩展方法的注意事项</h4>
<p>⚠️ <strong>注意事项：</strong></p>
<ol>
<li><strong>必须在静态类中定义</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 正确</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }
}

<span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }
</code></pre>
<ol start="2">
<li><strong>方法本身必须是静态的</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 错误</span>
<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }  <span class="hljs-comment">// 缺少 static</span>
}
</code></pre>
<ol start="3">
<li><strong>第一个参数必须是扩展类型</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 正确：为 string 扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">string</span> text</span>)</span> { }

<span class="hljs-comment">// 正确：为 int 扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> <span class="hljs-built_in">int</span> number</span>)</span> { }

<span class="hljs-comment">// 正确：为泛型类型扩展</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> T item</span>)</span> { }
</code></pre>
<ol start="4">
<li><strong>扩展方法不能修改原始类的私有成员</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> privateField = <span class="hljs-number">10</span>;
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClassExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TryAccess</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MyClass obj</span>)</span>
    {
        <span class="hljs-comment">// 错误！无法访问私有字段</span>
        <span class="hljs-comment">// int x = obj.privateField;</span>
    }
}
</code></pre>
<ol start="5">
<li><strong>如果原始类有同名方法，会优先调用原始方法</strong></li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>()</span>
    {
        Console.WriteLine(<span class="hljs-string">"原始方法"</span>);
    }
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyClassExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">MyMethod</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> MyClass obj</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"扩展方法"</span>);
    }
}

<span class="hljs-comment">// 调用时，会使用原始方法</span>
MyClass obj = <span class="hljs-keyword">new</span> MyClass();
obj.MyMethod();  <span class="hljs-comment">// 输出：原始方法</span>
</code></pre>
<h4 data-id="heading-24">什么时候使用扩展方法？</h4>
<p>✅ <strong>适合使用的场景：</strong></p>
<ul>
<li>为系统类型（string、int、DateTime 等）添加常用方法</li>
<li>为第三方库的类型添加功能，但没有源代码</li>
<li>提高代码可读性和调用便利性</li>
<li>将辅助方法组织到更合理的位置</li>
</ul>
<p>✅ <strong>常用场景示例：</strong></p>
<ul>
<li>数据验证</li>
<li>格式化转换</li>
<li>业务逻辑扩展</li>
<li>集合操作</li>
</ul>
<p>❌ <strong>不适合使用的场景：</strong></p>
<ul>
<li>可以直接修改原始类代码时</li>
<li>需要访问类的私有成员时</li>
<li>会与原始类方法产生冲突时</li>
<li>需要维护复杂状态时</li>
</ul>
<h4 data-id="heading-25">常用扩展方法建议</h4>
<p><strong>数据验证类扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>.IsEmail()
<span class="hljs-built_in">string</span>.IsPhoneNumber()
<span class="hljs-built_in">string</span>.IsUrl()
<span class="hljs-built_in">int</span>.IsEven()
<span class="hljs-built_in">int</span>.IsOdd()
<span class="hljs-built_in">int</span>.IsPrime()
</code></pre>
<p><strong>格式化类扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">string</span>.ToTitleCase()
<span class="hljs-built_in">string</span>.Reverse()
<span class="hljs-built_in">string</span>.Mask()
<span class="hljs-built_in">int</span>.ToChinese()
<span class="hljs-built_in">int</span>.ToOrdinal()  <span class="hljs-comment">// 1st, 2nd, 3rd...</span>
</code></pre>
<p><strong>日期时间扩展：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime.IsWeekend()
DateTime.IsToday()
DateTime.Age()
</code></pre>
<h4 data-id="heading-26">小贴士</h4>
<p>💡 <strong>命名规范：</strong> 扩展方法类名通常以 <code>Extensions</code> 结尾</p>
<pre><code class="hljs language-csharp" lang="csharp">StringExtensions, IntExtensions, ListExtensions
</code></pre>
<p>💡 <strong>组织方式：</strong> 将相关的扩展方法放在同一个静态类中</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">StringExtensions</span>
{
    <span class="hljs-comment">// 所有 string 相关的扩展方法</span>
}

<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DateTimeExtensions</span>
{
    <span class="hljs-comment">// 所有 DateTime 相关的扩展方法</span>
}
</code></pre>
<p>💡 <strong>LINQ 本质上就是扩展方法！</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 这些都是扩展方法</span>
numbers.Where(n =&gt; n &gt; <span class="hljs-number">5</span>)
numbers.Select(n =&gt; n * <span class="hljs-number">2</span>)
numbers.OrderBy(n =&gt; n)
</code></pre>
<h3 data-id="heading-27">本章总结</h3>
<ul>
<li>✅ 理解了静态类的概念和特点</li>
<li>✅ 掌握了静态类的定义和使用</li>
<li>✅ 理解了静态类与普通类的区别</li>
<li>✅ 学会了创建静态工具类</li>
<li>✅ 掌握了扩展方法的概念和语法</li>
<li>✅ 学会了为现有类型添加扩展方法</li>
<li>✅ 理解了扩展方法的注意事项和使用场景</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux部署MinIO]]></title>    <link>https://juejin.cn/post/7599765329409802280</link>    <guid>https://juejin.cn/post/7599765329409802280</guid>    <pubDate>2026-01-27T06:53:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599765329409802280" data-draft-id="7599690133118910498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux部署MinIO"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T06:53:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WiseSheep"/> <meta itemprop="url" content="https://juejin.cn/user/3123091067642990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux部署MinIO
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123091067642990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WiseSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:53:44.000Z" title="Tue Jan 27 2026 06:53:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>MinIO 是一款高性能的对象存储服务，兼容 Amazon S3 API，适用于私有云存储、数据备份等场景。本文详细介绍在Linux环境下从下载到启动的完整部署流程。</p>
<h2 data-id="heading-0">一、下载 MinIO 安装包</h2>
<p>通过 wget 命令直接下载</p>
<pre><code class="hljs language-bash" lang="bash">wget -c https://dl.minio.org.cn/server/minio/release/linux-amd64/minio
</code></pre>
<h2 data-id="heading-1">二、创建存储目录和日志目录</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># minio/data`：用于存储 MinIO 上传的对象数据</span>
<span class="hljs-comment"># minio/log`：用于存储 MinIO 运行日志</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/minio/data /opt/data/minio/logs
</code></pre>
<h2 data-id="heading-2">三、移动并赋可执行权限</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 移动文件</span>
<span class="hljs-built_in">mv</span> minio /opt/data/minio/
<span class="hljs-comment"># 赋予执行权限</span>
<span class="hljs-built_in">chmod</span> +x /opt/data/minio/minio
</code></pre>
<h2 data-id="heading-3">四、创建启动脚本</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建启动脚本文件</span>
vim /opt/data/minio/start.sh
</code></pre>
<p>将如下内容写入到脚本中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># MinIO 启动脚本</span>
<span class="hljs-comment"># 配置管理员用户名</span>
<span class="hljs-built_in">export</span> MINIO_ROOT_USER=root
<span class="hljs-comment"># 配置管理员密码</span>
<span class="hljs-built_in">export</span> MINIO_ROOT_PASSWORD=123456789
<span class="hljs-comment"># 启动 MinIO，配置 API 端口、控制台端口和数据存储目录</span>
<span class="hljs-comment"># --address :10001：API 端口（客户端连接使用）</span>
<span class="hljs-comment"># --console-address :10002：Web 控制台端口（浏览器访问使用）</span>
<span class="hljs-comment"># /opt/data/minio/data：数据存储目录</span>
<span class="hljs-comment"># 日志输出到 /opt/data/minio/logs/minio.log，2&gt;&amp;1 &amp; 表示后台运行</span>
<span class="hljs-built_in">nohup</span> /opt/data/minio/minio server --address :10001 --console-address :10002 /opt/data/minio/data &gt;/opt/data/minio/logs/minio.log 2&gt;&amp;1 &amp;
</code></pre>
<p>然后赋予脚本可执行权限</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x /opt/data/minio/start.sh
</code></pre>
<h2 data-id="heading-4">五、启动并验证</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /opt/data/minio/
./start.sh
</code></pre>
<p>查看minio运行日志</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -f /opt/data/minio/log/minio.log
</code></pre>
<p>成功标识：日志中出现 <code>Online</code> 关键字，说明 MinIO 已正常启动
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ece5d63fc644c6195f76a0b77fb7d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101624&amp;x-signature=MJc0Xh%2BFm56Cio1EQ3ZvXk4ULi0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JUC并发编程1（多线程，高并发）]]></title>    <link>https://juejin.cn/post/7599640782570307611</link>    <guid>https://juejin.cn/post/7599640782570307611</guid>    <pubDate>2026-01-27T07:21:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570307611" data-draft-id="7599630795804459054" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JUC并发编程1（多线程，高并发）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T07:21:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JUC并发编程1（多线程，高并发）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:21:09.000Z" title="Tue Jan 27 2026 07:21:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JUC简介</h2>
<p>来源于 java.util.concurrent、java.util.concurrent.atomic、java.util.concurrent.locks 这三个包（简称JUC ），在此包中增加了在并发编程中很常用的实用工具类，用于定义类似于线程的自定义子系统，包括线程池、异步 IO 和轻量级任务框架。提供可调的、灵活的线程池。还提供了设计用于多线程上下文中的 Collection 实现等。23年之后CPU主频更新缓慢，采用多核模式，要想程序更快就要用到并行和并发编程，但并发编程会涉及的问题有：线程安全问题、线程锁、线程性能问题。</p>
<h3 data-id="heading-1">线程和进程</h3>
<p><strong>进程、线程的关系</strong></p>
<ul>
<li>进程：一个程序，QQ.exe Music.exe 程序的集合；</li>
<li>线程：一个进程往往可以包含多个线程，至少包含一个！</li>
</ul>
<p>Java默认有两个线程：mian 线程、GC 线程</p>
<p><strong>线程有几个状态</strong></p>
<ul>
<li>新生 NEW</li>
<li>运行 RUNNABLE</li>
<li>阻塞 BLOCKED</li>
<li>等待，死死地等 WAITING</li>
<li>超时等待 TIMED_WAITING</li>
<li>终止 TERMINATED</li>
</ul>
<p><strong>并发、并行的关系</strong>：
并发（多线程操作同一个资源）、并行：（多个人一起行走） CPU 多核 ，多个线程可以同时执行；</p>
<h3 data-id="heading-2">锁的理解</h3>
<h4 data-id="heading-3">悲观锁、乐观锁</h4>
<ul>
<li>悲观锁：适合写操作多的场景，先加锁来保证数据正确性；</li>
<li>乐观锁：一版根据版本号机制、CAS算法（比较并替换）；</li>
</ul>
<h4 data-id="heading-4">公平锁、非公平锁</h4>
<ul>
<li>公平锁（FairSync）非常公平；不能插队的，必须先来后到。</li>
<li>非公平锁（NonfairSync）非常不公平，允许插队的，可以改变顺序。</li>
</ul>
<h4 data-id="heading-5">可重入锁</h4>
<ul>
<li>lock锁必须配对，相当于lock和 unlock 必须数量相同；</li>
<li>在外面加的锁，也可以在里面解锁；在里面加的锁，在外面也可以解锁；</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{

    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">try</span> {
            lock.lock();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">":发短信"</span>);
            call(); <span class="hljs-comment">// 这里也有锁</span>
        } <span class="hljs-keyword">finally</span> {
          lock.unlock();
        }
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">try</span> {
            lock.lock();
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">":打电话"</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
     <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
     <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); },<span class="hljs-string">"A"</span>).start();
	 <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); },<span class="hljs-string">"B"</span>).start();
}
</code></pre>
<h4 data-id="heading-6">自旋锁</h4>
<p>线程A先执行，进行加锁，其他线程在自旋中，只有A线程解锁后，其他线程进行操作解锁。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 自己写的自旋锁</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SpinlockDemo</span> {
    <span class="hljs-comment">// 默认值是 null</span>
    AtomicReference&lt;Thread&gt; atomicReference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicReference</span>&lt;&gt;();
    <span class="hljs-comment">//加锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myLock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();
        System.out.println(thread.getName() + <span class="hljs-string">"===&gt; 加锁"</span>);
        <span class="hljs-comment">// 如果当前对象是null,比较替换成对象，执行结果为false ,就一直循环 自旋锁</span>
        <span class="hljs-keyword">while</span> (!atomicReference.compareAndSet(<span class="hljs-literal">null</span>, thread)) {
<span class="hljs-comment">//            System.out.println(Thread.currentThread().getName() + " ==&gt; 自旋中~");</span>
        }
    }
    
    <span class="hljs-comment">//解锁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myunlock</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> Thread.currentThread();
        System.out.println(thread.getName() + <span class="hljs-string">"===&gt; 解锁"</span>);
        atomicReference.compareAndSet(thread, <span class="hljs-literal">null</span>);
    }
}
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception{
    <span class="hljs-comment">//使用CAS实现自旋锁</span>
    <span class="hljs-type">SpinlockDemo</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpinlockDemo</span>();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        lock.myLock();
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.myunlock();
        }
    }, <span class="hljs-string">"线程A"</span>).start();

    TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);

    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        lock.myLock();
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
        } <span class="hljs-keyword">finally</span> {
            lock.myunlock();
        }
    }, <span class="hljs-string">"线程B"</span>).start();
}
</code></pre>
<h4 data-id="heading-7">生产者和消费者</h4>
<p>生产者与消费者问题是多线程同步的一个经典问题。生产者和消费者同时使用一块缓冲区，生产者生产商品放入缓冲区，消费者从缓冲区中取出商品。我们需要保证的是，当缓冲区满时，生产者不可生产商品；当缓冲区为空时，消费者不可取出商品。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Lock版的生产者和消费者。</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// +1方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span>{
        lock.lock(); <span class="hljs-comment">//加锁</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (number!=<span class="hljs-number">0</span>){
                <span class="hljs-keyword">try</span> {
                    condition.await(); <span class="hljs-comment">//等待</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            number++;
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ number);
            condition.signalAll(); <span class="hljs-comment">// 通知其他线程</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">//解锁</span>
        }
    }

    <span class="hljs-comment">// -1方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decrement</span><span class="hljs-params">()</span>{
        lock.lock(); <span class="hljs-comment">//加锁</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(number==<span class="hljs-number">0</span>){
                <span class="hljs-keyword">try</span> {
                    condition.await(); <span class="hljs-comment">//等待</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            number--;
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ number);
            condition.signalAll(); <span class="hljs-comment">// 通知其他线程</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">//解锁</span>
        }
    }

}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
	<span class="hljs-comment">// 资源类</span>
    <span class="hljs-type">Ticket</span> <span class="hljs-variable">ticke</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ticket</span>();
    <span class="hljs-comment">// 线程A C 执行 +操作   B D执行 -操作</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.increment(); } },<span class="hljs-string">"线程A"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.decrement(); } },<span class="hljs-string">"线程B"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.increment(); } },<span class="hljs-string">"线程C"</span>).start();
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">10</span>;i++){ ticke.decrement(); } },<span class="hljs-string">"线程D"</span>).start();
}
</code></pre>
<p>注意：多线程下判断使用while，代替 if 就可以防止虚假唤醒。</p>
<p><strong>Condition</strong>接口也提供了类似Object的监视器方法，与Lock配合可以实现 等待/通知模式，Condition可以精准的通知和唤醒的线程！</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * A 执行完 调用B
 * B 执行完 调用C
 * C 执行完 调用A
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ticket</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-comment">// Lock版本的 生产者与消费</span>
    <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition1</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition2</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-type">Condition</span> <span class="hljs-variable">condition3</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-comment">// 状态分为  1 condition1执行  2 condition2执行  3 condition3执行</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

    <span class="hljs-comment">// A方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doA</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-comment">// 业务 - 判断 - 执行 - 通知</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">1</span>){
                condition1.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">2</span>;
            condition2.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-comment">// B方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doB</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">2</span>){
                condition2.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">3</span>;
            condition3.signal();
        }<span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-comment">// C方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doC</span><span class="hljs-params">()</span>{
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span>(state != <span class="hljs-number">3</span>){
                condition3.await(); <span class="hljs-comment">//等待</span>
            }
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"执行："</span>+ state);
            state = <span class="hljs-number">1</span>;
            condition1.signal();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

}
</code></pre>
<h4 data-id="heading-8">8锁现象</h4>
<p>8锁现象，实际对应的就是8个问题。要清楚判断锁的是谁！永远的知道什么是锁，锁到底锁的是谁！注意：（能用对象锁，就不要用类锁）</p>
<p><strong>问题一 : 在标准情况下，两个线程先打印 发短信 还是 打电话 ？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 4秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.call();}, <span class="hljs-string">"B"</span>).start();
    }
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果是：先打印发短信，然后再打电话！</p>
<p><strong>问题二 : 在发短信方法中，延迟4秒，两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test2</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{phone.call();}, <span class="hljs-string">"B"</span>).start();
    }
}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception{
    	TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：还是先打印发短信。</p>
<p>首先知道 锁的对象是谁？因为 synchronized 加在方法上，所以锁的对象是 方法的调用者，所以两个方法用的是同一个锁，谁先拿到谁先执行！ 对象锁就是synchronized；</p>
<p>解释：</p>
<ul>
<li>phone对象，就是方法的调用者，也就是手机，它可以打电话和发短信。</li>
<li>现在有两个人线程A 和 线程B，他们一个想打电话，一个想发短信。</li>
<li>线程A，先拿到锁（也就是手机），抱着锁（手机）睡了4秒。</li>
<li>线程B肯定拿不到锁（手机），需要等待。</li>
</ul>
<p><strong>问题三 : Phone类增加一个普通方法，线程B调用，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.hello();}, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 1秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">//普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"hello"</span>);
    }
}
</code></pre>
<p>结果：先打印hello，然后打印发短信。</p>
<p>解释：</p>
<ul>
<li>锁的是方法的调用者</li>
<li>现在 线程B 调用普通方法，相当于可以远程操控，不需要接收消息</li>
</ul>
<p><strong>问题四 : 创建两个 phone对象，线程调用不同对象的方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test4</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone1.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone2.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">//同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
    <span class="hljs-comment">//普通方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hello</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"hello"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话。</p>
<p>解释：synchronized用在方法上，那么锁的是方法的调用者。现在有两个调用者，所以互不影响。</p>
<p><strong>问题五 : 将方法变为静态同步方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<p><strong>问题六 : 现在有两个对象，调用不同对象的，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test5</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-comment">// 线程A</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg();}, <span class="hljs-string">"A"</span>).start();
        <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-comment">// 线程B</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.call(); }, <span class="hljs-string">"B"</span>).start();
        
        <span class="hljs-comment">// 问题6</span>
        <span class="hljs-comment">// Phone phone1 = new Phone();</span>
        <span class="hljs-comment">// Phone phone2 = new Phone();</span>
        <span class="hljs-comment">// new Thread(()-&gt;{ phone1.seedMsg();}, "A").start();</span>
        <span class="hljs-comment">// new Thread(()-&gt;{ phone2.call();}, "B").start();</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
   <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印发短信。</p>
<p>解释：5、6的问题一样，对于static静态方法来说，对于整个类Class只有一份，对于不同的对象使用的是同一份方法，相当于这个方法是属于这个类，如果静态static方法使用synchronized锁定，那么这个synchronized锁会锁住整个对象！不管多少个对象，对于静态的锁都只有一把锁，谁先拿到这个锁就先执行，其他的进程都需要等待！</p>
<p><strong>问题七 : 资源类中，一个是静态同步方法，一个普通同步方法，那么两个线程先打印 发短信 还是 打电话？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test7</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
         <span class="hljs-comment">// 1秒延迟</span>
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-comment">// 手机</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 普通同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话，然后打印发短信</p>
<p>解释：因为一个锁的是Class类，一个锁的是对象调用者。后面那个打电话不需要等待发短信，可以直接运行。</p>
<p><strong>问题一八: 在标准情况下，两个线程先打印 发短信 还是 打电话 ？</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test7</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception{
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-type">Phone</span> <span class="hljs-variable">phone2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phone</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone1.seedMsg(); }, <span class="hljs-string">"A"</span>).start();
        TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ phone2.call(); }, <span class="hljs-string">"B"</span>).start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Phone</span>{
    <span class="hljs-comment">// 静态同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">seedMsg</span><span class="hljs-params">()</span>{
        <span class="hljs-comment">// 4秒延迟</span>
        <span class="hljs-keyword">try</span> {
            TimeUnit.SECONDS.sleep(<span class="hljs-number">4</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(<span class="hljs-string">"发短信"</span>);
    }
    <span class="hljs-comment">// 普通同步方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span>{
        System.out.println(<span class="hljs-string">"打电话"</span>);
    }
}
</code></pre>
<p>结果：先打印打电话，然后打印发短信</p>
<p>解释：两把锁锁的不是同一个东西，所以后面的第二个对象不需要等待第一个对象的执行。（类锁和对象锁互不干扰）</p>
<p>总结：</p>
<ul>
<li>new 和 this 是一个对象。</li>
<li>static 和 Class 是唯一的一个模板。</li>
</ul>
<p>文件反编译：javap - c xxx.class</p>
<h4 data-id="heading-9">死锁</h4>
<p>有一个线程A，按照先锁a再获得锁b的的顺序获得锁，而在此同时又有另外一个线程B，按照先锁b再锁a的顺序获得锁，从而产生死锁。</p>
<p>死锁检测：</p>
<p><strong>1、使用jps定位进程号，jdk的bin目录下： 有一个jps</strong></p>
<p>命令：<code>jps -l</code></p>
<pre><code class="hljs language-bash" lang="bash"> jps -l   <span class="hljs-comment"># 得到进程编号</span>
</code></pre>
<p><strong>2、使用<code>jstack</code> 进程进程号 找到死锁信息</strong></p>
<p>jstack是java虚拟机自带的一种堆栈跟踪工具，或者 使用jconsole（图形化）进行查看。</p>
<h4 data-id="heading-10">对象内存布局</h4>
<p>在虚拟机中，对象在内存中存储的布局可以分为：对象头、实例数据、对齐填充。
对象头存储内容：Mark Word（对象标记）这里有【hash码，对象所属的年代，对象锁，锁状态标志，偏向锁（线程）ID，偏向时间戳，对象分代年龄】、类型指针、数组长度（只有数组对象才有）；
实例数据：存放类的属性数据信息，包括父类的属性信息；
对齐填充：由于虚拟机要求，对象起始地址必须是8字节的整数倍。
压缩指针：默认是开启的，通过java -XX:+PrintCommandLineFlags -version，可查看是否开启，+代表开启，-代表不开启。</p>
<p>分析对象在JDK的大小和分布，引包该包：</p>
<pre><code class="hljs language-xml" lang="xml"> # openjdk 分析对象在JDK的大小和分布
 <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.openjdk.jol<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jol-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
# 使用，可以查看value,第一个（）后3位判断出是什么锁 # 如：001无锁 101偏向锁 000 轻量锁 010重级锁
System.out.println(ClassLayout.parseInstance(对象).toPrintable());
</code></pre>
<h4 data-id="heading-11"><strong>synchronized</strong></h4>
<p>JDK6之前是属于重量级锁，效率底下，通过监听器（monitor）来实现的，它需要从用户状态转向内核状态，所以耗时严重，JDK6之后有了偏向锁、轻量级锁。</p>
<ul>
<li>偏向锁是通过Mark Word（对象标记）存储偏向的线程id；</li>
<li>轻量锁是通过Mark Word（对象标记）存储指向线程栈中的Lock Record指针；</li>
<li>重量锁是通过Mark Word（对象标记）存储指向线程堆中的监听器（monitor）指针；</li>
</ul>
<p><strong>偏向锁</strong>
当线程A第一次争到锁，通过操作修改Mark Word（对象标记）中偏向线程id，使用场景：多线程情况下，在争抢过程中，还可能由同一个线程争取到，就没必要进行从用户状态转向内核状态这部分耗时操作。但在JDK15废弃偏向锁。优点：加锁和解锁不需要额外消耗，缺点：适合一个线程干活，线程之间锁竞争会带来额外的消耗。</p>
<pre><code class="hljs language-xml" lang="xml">-XX:-UseBiasedLocking  # 关闭偏向锁，默认是开启的
</code></pre>
<p><strong>轻量锁</strong>
本质就是自旋锁CAS，不断的尝试获取锁，尽量不阻塞；默认是自旋10次，但在JDK6之后，自旋的次数是不固定的，根据同一个锁上一次自旋的时间，上次时间长，这次就时间长，上次时间短，会根据变短，避免空循环。优点：提高响应速度，缺点：消耗CPU。</p>
<pre><code class="hljs language-xml" lang="xml">-XX:-PreBlockSpin=10  # 默认自旋次数10次，可设置CPU核数一半
</code></pre>
<p><strong>重量锁</strong>
<strong>synchronized</strong> 是重量级的锁，优点：不消耗CPU，追求吞吐量，缺点：线程阻塞，响应慢。</p>
<p>注意：</p>
<p>当一个对象已经计算获取了哈希值之后，就不能进行偏向锁，因为Mark Word（对象标记）空间就那么大，会存储哈希值，而偏向的线程id不再存储，直接进入重量锁。</p>
<h3 data-id="heading-12">集合类不安全</h3>
<blockquote>
<h4 data-id="heading-13">List不安全</h4>
</blockquote>
<p><code>ArrayList</code> 在并发情况下是不安全的！</p>
<p>解决：</p>
<ul>
<li>Vector就是线程安全的</li>
<li>使用Collections.synchronizedList(new ArrayList&lt;&gt;());</li>
<li>使用 List arrayList = new CopyOnWriteArrayList&lt;&gt;();</li>
</ul>
<p><strong>CopyOnWriteArrayList</strong>：写入时复制， 是计算机程序设计领域的一种优化策略</p>
<p>多个线程调用的时候，list，读取的时候，固定的，写入（存在覆盖操作）；在写入的时候避免覆盖，造成数据错乱的问题；</p>
<blockquote>
<h4 data-id="heading-14">Set不安全</h4>
</blockquote>
<p>和List、Set同级的还有一个BlockingQueue 阻塞队列；</p>
<p>Set和List同理可得: 多线程情况下，普通的Set集合是线程不安全的；</p>
<p>解决：</p>
<ul>
<li>使用Collections工具类的synchronized包装的Set类</li>
<li>使用<strong>CopyOnWriteArraySet</strong> 写入复制的JUC解决方案</li>
</ul>
<blockquote>
<h4 data-id="heading-15">Map不安全</h4>
</blockquote>
<p><code>HashMap</code>基础类也存在并发修改异常！</p>
<p>解决：</p>
<ul>
<li>使用Collections.synchronizedMap(new HashMap&lt;&gt;());处理；</li>
<li>使用<strong>ConcurrentHashMap</strong>进行并发处理</li>
</ul>
<h3 data-id="heading-16">阻塞队列</h3>
<p><strong>队列</strong>：是一种特殊的线性表，单向队列只能在一端插入数据（后），另一端删除数据（前）；它和栈一样，队列是一种操作受限制的线性表；由于只能一端删除或者插入，所以只有最先进入队列的才能被删除，因此又被称为先进先出（FIFO—first in first out）线性表。</p>
<p>队列分为两种：</p>
<ul>
<li>单向队列：只能在一端删除数据，另一端插入数据。</li>
<li>双向队列：两端都可以进行插入数据和删除数据操作。</li>
</ul>
<p><strong>阻塞队列</strong>：是一个支持两个附加操作的队列。这两个附加的操作是：在队列为空时，获取元素的线程会等待队列变为非空。当队列满时，存储元素的线程会等待队列可用。</p>
<p>Java里的阻塞队列：</p>
<ul>
<li><strong>ArrayBlockingQueue ：</strong> 一个由数组结构组成的有界阻塞队列。</li>
<li><strong>LinkedBlockingQueue ：</strong> 一个由链表结构组成的有界阻塞队列。</li>
<li><strong>PriorityBlockingQueue ：</strong> 一个支持优先级排序的无界阻塞队列。</li>
<li><strong>DelayQueue：</strong> 一个使用优先级队列实现的无界阻塞队列。</li>
<li><strong>SynchronousQueue：</strong> 一个不存储元素的阻塞队列。</li>
<li><strong>LinkedTransferQueue：</strong> 一个由链表结构组成的无界阻塞队列。</li>
<li><strong>LinkedBlockingDeque：</strong> 一个由链表结构组成的双向阻塞队列。</li>
</ul>
<h4 data-id="heading-17">blockingQueue</h4>
<p>阻塞队列，blockingQueue 是Collection的一个子类；</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e947851b9f24b97a88cf5dee969eade~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103275&amp;x-signature=x51GST02h8IGq11tBuil98DZ6Oc%3D" width="60%" height="60%" alt="" loading="lazy"/>
<p>LinkedBlockingDeque 是一个 Deque（双向的队列），其实现的接口是 BlockingDeque；其余6个阻塞队列则是 Queue（单向队列），实现的接口是 BlockingQueue。</p>
<p><strong>提供了四种处理方法：</strong></p>

































<table><thead><tr><th align="left">方法描述</th><th align="left">抛出异常</th><th align="left">返回特殊的值</th><th align="left">一直阻塞</th><th align="left">超时退出</th></tr></thead><tbody><tr><td align="left">插入数据</td><td align="left">add(e)</td><td align="left">offer(e)</td><td align="left">put(e)</td><td align="left">offer(e,time,unit)</td></tr><tr><td align="left">获取并移除队列的头</td><td align="left">remove()</td><td align="left">poll()</td><td align="left">take()</td><td align="left">poll(time,unit)</td></tr><tr><td align="left">检测队首元素</td><td align="left">element()</td><td align="left">peek()</td><td align="left">-</td><td align="left">-</td></tr></tbody></table>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抛出异常</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test1</span><span class="hljs-params">()</span>{
    <span class="hljs-comment">// 需要初始化队列的大小</span>
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加</span>
    deque.add(<span class="hljs-string">"a"</span>);
    deque.add(<span class="hljs-string">"c"</span>);
    deque.add(<span class="hljs-string">"b"</span>);
    <span class="hljs-comment">// 抛出异常：java.lang.IllegalStateException: Queue full</span>
    <span class="hljs-comment">// deque.add("e");</span>
    <span class="hljs-comment">// 移除</span>
    deque.remove();
    <span class="hljs-comment">// deque.remove();</span>
    <span class="hljs-comment">// deque.remove();</span>
    System.out.println(deque);
    <span class="hljs-comment">//判断队列首</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> deque.element();
    System.out.println(element);
}

<span class="hljs-comment">// 不抛出异常</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test2</span><span class="hljs-params">()</span>{
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加</span>
    deque.offer(<span class="hljs-string">"a"</span>);
    deque.offer(<span class="hljs-string">"c"</span>);
    deque.offer(<span class="hljs-string">"b"</span>); <span class="hljs-comment">//true</span>
    <span class="hljs-comment">// 一个不能添加的元素 使用offer只会返回 false 不会抛出异常</span>
    System.out.println( deque.offer(<span class="hljs-string">"e"</span>));
    <span class="hljs-comment">// 移除</span>
    deque.poll();
    <span class="hljs-comment">// 移除 如果没有元素 只会返回null 不会抛出异常</span>
    System.out.println(deque);
    <span class="hljs-comment">// 判断队列首</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">element</span> <span class="hljs-operator">=</span> deque.peek();
    System.out.println(element);
}

<span class="hljs-comment">// 等待 一直阻塞</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加 一直阻塞 不会返回</span>
    deque.put(<span class="hljs-string">"a"</span>);
    <span class="hljs-comment">// 如果队列已经满了， 再进去一个元素  这种情况会一直等待这个队列 什么时候有了位置再进去，程序不会停止</span>
    <span class="hljs-comment">// deque.put("e");</span>
    <span class="hljs-comment">// 移除</span>
    deque.take();
    <span class="hljs-comment">// deque.take();</span>
    <span class="hljs-comment">// 如果我们再来一个  这种情况也会等待，程序会一直运行 阻塞</span>
}


<span class="hljs-comment">// 等待 超时阻塞</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">Test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
    <span class="hljs-type">ArrayBlockingQueue</span>  <span class="hljs-variable">deque</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>);
    <span class="hljs-comment">// 添加 这种情况也会等待队列有位置 或者有产品 但是会超时结束</span>
    deque.offer(<span class="hljs-string">"a"</span>,<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    deque.offer(<span class="hljs-string">"b"</span>,<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    <span class="hljs-comment">// 超时时间2s 等待如果超过2s就结束等待</span>
    <span class="hljs-comment">// 移除</span>
    deque.poll(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    deque.poll(<span class="hljs-number">2</span>, TimeUnit.SECONDS);
    <span class="hljs-comment">// 超过两秒 我们就不要等待了</span>
    System.out.println(deque);
}
</code></pre>
<h4 data-id="heading-18">SynchronousQueue</h4>
<p>同步队列：没有容量，也可以视为容量为1的队列；</p>
<p>进去一个元素，必须等待取出来之后，才能再往里面放入一个元素；</p>
<p>put方法 和 take方法；</p>
<p>Synchronized 和 其他的BlockingQueue 不一样 它不存储元素；</p>
<p>put了一个元素，就必须从里面先take出来，否则不能再put进去值！</p>
<p>并且SynchronousQueue 的take是使用了lock锁保证线程安全的。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>{
     BlockingQueue&lt;String&gt; synchronousQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;&gt;();

    <span class="hljs-comment">// 使用两个进程</span>
    <span class="hljs-comment">// 一个进程 放进去  一个进程 拿出来</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 1"</span>);
            synchronousQueue.put(<span class="hljs-string">"1"</span>);
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 2"</span>);
            synchronousQueue.put(<span class="hljs-string">"2"</span>);
            System.out.println(Thread.currentThread().getName()+<span class="hljs-string">" Put 3"</span>);
            synchronousQueue.put(<span class="hljs-string">"3"</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    },<span class="hljs-string">"T1"</span>).start();

    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{
        <span class="hljs-keyword">try</span> {
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
            <span class="hljs-comment">//                TimeUnit.SECONDS.sleep(3);</span>
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
            <span class="hljs-comment">//                TimeUnit.SECONDS.sleep(3);</span>
            System.out.println(Thread.currentThread().getName()
                               +<span class="hljs-string">" Take "</span>+synchronousQueue.take());
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
    },<span class="hljs-string">"T2"</span>).start();
}
</code></pre>
<h3 data-id="heading-19">创建线程</h3>
<p>我们之前创建线程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(()-&gt;{ System.out.println(<span class="hljs-string">"任务模块"</span>);},<span class="hljs-string">"线程名1"</span>).start();
</code></pre>
<p>Callable创建线程：</p>
<p>Java库具有FutureTask类型，该类型实现Runnable和Future，并方便地将两种功能组合在一起。可以通过为其构造函数提供Callable来创建FutureTask。然后，将FutureTask对象提供给Thread的构造函数以创建Thread对象。因此，间接地使用Callable创建线程。</p>
<p><strong>使用Callable和Future的完整示例:</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableTest</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
<span class="hljs-comment">//            new Thread(new Runnable()).start();</span>
<span class="hljs-comment">//            new Thread(new FutureTask&lt;&gt;( Callable)).start();</span>
            <span class="hljs-comment">//适配类：FutureTask</span>
            FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyThread</span>());
            <span class="hljs-comment">//放入Thread使用</span>
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(futureTask,String.valueOf(i)).start();
            <span class="hljs-comment">//获取返回值</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> futureTask.get();
            System.out.println(<span class="hljs-string">"返回值："</span>+ s);
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        System.out.println(<span class="hljs-string">"Call-线程："</span>+Thread.currentThread().getName());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"String"</span>+Thread.currentThread().getName();
    }
}
</code></pre>
<p>注意：使用Callable进行多线程操作，多个线程结果会被缓存，效率高。这个get 方法可能会产生阻塞！把他放到 最后，或者使用异步通信来处理！</p>
<p>Callable接口与Runnable接口的区别：</p>
<ul>
<li>是否有返回值</li>
<li>是否抛出异常</li>
<li>一个是call()，一个是run()</li>
</ul>
<h4 data-id="heading-20">线程池</h4>
<p>优点：</p>
<ul>
<li>降低资源消耗</li>
<li>提高响应速度</li>
<li>提高线程的可管理性</li>
</ul>
<p>池化技术：事先准备好一些资源，如果有人要用，就来我这里拿，用完之后还给我，以此来提高效率。</p>
<h4 data-id="heading-21">线程池的使用</h4>
<h5 data-id="heading-22">Executors：</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 创建线程池</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 单个线程</span>
    <span class="hljs-comment">// ExecutorService executorService = Executors.newSingleThreadExecutor(); </span>
    <span class="hljs-comment">// 创建一个固定的线程池的大小</span>
    <span class="hljs-comment">// ExecutorService executorService = Executors.newFixedThreadPool(5);   </span>
    <span class="hljs-comment">// 可伸缩的</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newCachedThreadPool();   
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">80</span>; i++){
            <span class="hljs-comment">//使用线程池之后创建线程</span>
            executorService.execute(()-&gt;{
                System.out.println(Thread.currentThread().getName()+ <span class="hljs-string">" ok"</span>);
            });
        }
    } <span class="hljs-keyword">finally</span> {
        executorService.shutdown();
    }
}
</code></pre>
<p>源码分析：线程池的真正实现类是<strong>ThreadPoolExecutor</strong>，有7大参数</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,    //核心线程池大小
                          <span class="hljs-type">int</span> maximumPoolSize, //最大的线程池大小
                          <span class="hljs-type">long</span> keepAliveTime,  //超时了没有人调用就会释放
                          TimeUnit unit, //超时单位
                          BlockingQueue&lt;Runnable&gt; workQueue, //阻塞队列
                          ThreadFactory threadFactory, //线程工厂 创建线程的 一般不用动
                          RejectedExecutionHandler handler //拒绝策略
                         )</span> {
    <span class="hljs-keyword">if</span> (corePoolSize &lt; <span class="hljs-number">0</span> ||
        maximumPoolSize &lt;= <span class="hljs-number">0</span> ||
        maximumPoolSize &lt; corePoolSize ||
        keepAliveTime &lt; <span class="hljs-number">0</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();
    <span class="hljs-keyword">if</span> (workQueue == <span class="hljs-literal">null</span> || threadFactory == <span class="hljs-literal">null</span> || handler == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
    <span class="hljs-built_in">this</span>.corePoolSize = corePoolSize;
    <span class="hljs-built_in">this</span>.maximumPoolSize = maximumPoolSize;
    <span class="hljs-built_in">this</span>.workQueue = workQueue;
    <span class="hljs-built_in">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);
    <span class="hljs-built_in">this</span>.threadFactory = threadFactory;
    <span class="hljs-built_in">this</span>.handler = handler;
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4ccac6cfda04c7abba3b205634069c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103275&amp;x-signature=yfEzrt5i1dHGevR5WvIT%2B46B5Hs%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-23">ThreadPoolExecutor</h5>
<p>自定义创建线程池，参数类型就是7大参数，分别是 核心线程池大小、最大的线程池大小、超时了没有人调用就会释放、超时单位、阻塞队列、线程工厂 创建线程的 一般不用动、拒绝策略</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-comment">// 注意：</span>
    <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">threadPoolExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">2</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, TimeUnit.SECONDS,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>), Executors.defaultThreadFactory(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.AbortPolicy() <span class="hljs-comment">//拒绝策略</span>
    );
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&lt;=<span class="hljs-number">80</span>; i++){
            <span class="hljs-comment">//使用线程池之后创建线程</span>
            threadPoolExecutor.execute(()-&gt;{
                System.out.println(Thread.currentThread().getName()+ <span class="hljs-string">" ok"</span>);
            });
        }
    } <span class="hljs-keyword">finally</span> {
        threadPoolExecutor.shutdown();
    }
}
</code></pre>
<p>等待队列已经满了，塞不下新任务，同时，线程池中max线程也达到了，无法继续新任务。这个时候就需要拒绝策略机制</p>
<p>拒绝策略有4种：</p>
<ul>
<li>AbortPolicy：如果阻塞队列满了，直接抛出异常阻止系统正常运行，队列容量大小 + maxPoolSize</li>
<li>CallerRunsPolicy：如果阻塞队列满了，该策略不会抛弃任务，也不抛出异常，而是将任务回退给调用者</li>
<li>DiscardOldestPolicy：如果阻塞队列满了，抛弃队列中等待最久的任务，把当前任务加入队列中再次提交</li>
<li>DiscardPolicy：如果阻塞队列满了，丢弃无法处理的任务，不抛出异常，如果允许任务丢失，是最好的策略</li>
</ul>
<p><strong>如何去设置线程池的最大大小如何去设置？</strong></p>
<ul>
<li>
<p>CPU密集型：电脑的核数是几核就选择几；选择maximunPoolSize的大小</p>
<pre><code class="hljs language-java" lang="java">Runtime.getRuntime().availableProcessors()  <span class="hljs-comment">// 获取CPU核数</span>
</code></pre>
</li>
<li>
<p>I/O密集型：在程序中有15个大型任务，io十分占用资源；I/O密集型就是判断我们程序中十分耗I/O的线程数量，大约是最大I/O数的一倍到两倍之间。</p>
</li>
</ul>
<h3 data-id="heading-24">单例模式</h3>
<p>设计模式之一：单例模式。</p>
<p>最重要的思想，构造方法私有，private。保证内存中只有一个对象。</p>
<h4 data-id="heading-25">饿汉式：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hungry</span> {

    <span class="hljs-comment">// 可能会浪费空间</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>];
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] data2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>];
	....

    <span class="hljs-comment">// 构造方法私有 ---</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Hungry</span><span class="hljs-params">()</span>{
    }
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Hungry</span> <span class="hljs-variable">HUNGRY</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hungry1</span>();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Hungry <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">return</span> HUNGRY;
    }
    
}
</code></pre>
<p>一上来，把这里面的全部都加载出来，在没有使用这个对象，对象就已经存在，浪费空间。所以有了懒汉式，使用就创建对象，平时不加载。</p>
<h4 data-id="heading-26">懒汉式式：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LazyMan</span> {
    <span class="hljs-comment">// 构造方法私有 ---</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LazyMan</span><span class="hljs-params">()</span> {
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> LazyMan LazyMan；
    <span class="hljs-comment">// 如果对象存在就加载，平常不加载</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> LazyMan <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>{
        <span class="hljs-keyword">if</span> (LazyMan==<span class="hljs-literal">null</span>){
            LazyMan = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyMan</span>();
        }
        <span class="hljs-keyword">return</span> LazyMan;
    }
}
</code></pre>
<p>但在多线程下是有问题的。需要进行双重检测锁模式，再加上volatile关键字，DCL懒汉式。</p>
<p>但是通过反射，还是能破坏程序，所以我们需要在构造器上锁，通过枚举进行判断，枚举不能被反射。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux部署MySQL8]]></title>    <link>https://juejin.cn/post/7599852579066462223</link>    <guid>https://juejin.cn/post/7599852579066462223</guid>    <pubDate>2026-01-27T07:22:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579066462223" data-draft-id="7599852636528738339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux部署MySQL8"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-27T07:22:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WiseSheep"/> <meta itemprop="url" content="https://juejin.cn/user/3123091067642990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux部署MySQL8
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3123091067642990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WiseSheep
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:22:13.000Z" title="Tue Jan 27 2026 07:22:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前置检查</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查并卸载冲突的mariadb（与MySQL冲突）</span>
rpm -qa | grep mariadb
<span class="hljs-comment"># 替换为实际查到的包名</span>
rpm -e --nodeps mariadb-libs-5.5.68-1.el7.x86_64

<span class="hljs-comment"># 查看系统位数（64位/32位）</span>
getconf LONG_BIT
<span class="hljs-comment"># 查看glibc版本（需匹配安装包）</span>
getconf GNU_LIBC_VERSION
<span class="hljs-comment"># 查看架构（x86_64=amd64）</span>
<span class="hljs-built_in">uname</span> -m
</code></pre>
<h2 data-id="heading-1">二、下载 MySQL 安装包</h2>
<pre><code class="hljs language-bash" lang="bash">wget -c https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.42-linux-glibc2.28-x86_64.tar.xz -P /opt/data
</code></pre>
<h2 data-id="heading-2">三、解压并创建专用用户</h2>
<p>解压安装包并创建 MySQL 专用系统用户</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入安装目录</span>
<span class="hljs-built_in">cd</span> /opt/data
<span class="hljs-comment"># 解压</span>
tar -Jxvf mysql-8.2.0-linux-glibc2.17-x86_64.tar.xz
<span class="hljs-comment"># 重命名</span>
<span class="hljs-built_in">mv</span> mysql-8.2.0-linux-glibc2.17-x86_64 mysql8
<span class="hljs-comment"># 创建mysql用户组和系统用户（-r表示不可登录系统）</span>
groupadd mysql
useradd -r -g mysql mysql
<span class="hljs-comment"># 创建数据存储目录</span>
<span class="hljs-built_in">mkdir</span> -p mysql8/data
</code></pre>
<h2 data-id="heading-3">四、配置 MySQL 核心参数</h2>
<p>创建配置文件并指定基础路径、端口、字符集等核心参数</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编辑配置文件</span>
vim /opt/data/mysql8/conf/my.cnf
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data/mysql.sock  <span class="hljs-comment"># 客户端连接套接字</span>

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>        <span class="hljs-comment"># 允许所有IP访问</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">3306</span>                   <span class="hljs-comment"># 监听端口</span>
<span class="hljs-attr">user</span>=mysql                  <span class="hljs-comment"># 运行用户</span>
<span class="hljs-attr">basedir</span>=/opt/data/mysql8    <span class="hljs-comment"># 安装根目录</span>
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data  <span class="hljs-comment"># 数据存储目录</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data/mysql.err  <span class="hljs-comment"># 错误日志</span>
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data/mysql.pid    <span class="hljs-comment"># 进程ID文件</span>
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>       <span class="hljs-comment"># 最大连接数</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>   <span class="hljs-comment"># 单用户最大连接数</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>            <span class="hljs-comment"># 连接超时时间</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4 <span class="hljs-comment"># 默认字符集（支持emoji）</span>
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>            <span class="hljs-comment"># 禁用符号链接</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归设置目录所属用户和用户组</span>
<span class="hljs-built_in">chown</span> -R mysql:mysql mysql8
</code></pre>
<h2 data-id="heading-4">五、初始化并启动 MySQL</h2>
<p>初始化数据库（生成临时密码），安装依赖后启动服务</p>
<p>出现如下错误需安装libaio
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73c18172b33449deb663fac1e9179cd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=9kAQOZ5VzMxjTBOqPG%2FQNbCxo5o%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装依赖（初始化缺失libaio时执行）</span>
yum -y install libaio
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化数据库（指定配置文件和用户）</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data --user=mysql --initialize

<span class="hljs-comment"># 查看初始临时密码（关键！用于首次登录）</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data/mysql.err
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d056d811ae34473b6bedb97b5740bce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=vELJWp9G0kjRm0YmHr%2BnD4S7V%2FE%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 后台启动MySQL服务</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my.cnf --user=mysql --daemonize
</code></pre>
<h2 data-id="heading-5">六、首次登录并修改密码</h2>
<p>使用临时密码登录，重置密码并开放远程访问（MySQL8 + 需指定加密方式）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录MySQL（输入临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 查看用户信息</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>, host, plugin <span class="hljs-keyword">from</span> mysql.user;

<span class="hljs-comment">-- 2. 修改root密码（指定mysql_native_password加密，兼容旧客户端）mysql8+密码使用sha2加密，需指定算法</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;

<span class="hljs-comment">-- 3. 允许root从任意IP访问（%表示所有IP，生产环境建议指定具体IP）</span>
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;

<span class="hljs-comment">-- 4. 刷新权限生效</span>
FLUSH PRIVILEGES;
</code></pre>
<h2 data-id="heading-6">七、配置 MySQL 主从复制（单机模拟）</h2>
<p>在同一台机器创建主库（8001 端口）和从库（8002 端口），实现数据同步</p>
<h3 data-id="heading-7">1. 创建主从库目录</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 主库数据目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/mysql8/data_master
<span class="hljs-comment"># 从库数据目录</span>
<span class="hljs-built_in">mkdir</span> -p /opt/data/mysql8/data_slave
</code></pre>
<h3 data-id="heading-8">2. 配置主库（my_master.cnf）</h3>
<pre><code class="hljs language-bash" lang="bash">vim /opt/data/mysql8/conf/my_master.cnf
</code></pre>
<p>写入如下内容</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_master/mysql.sock

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">server-id</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 主库唯一ID（不可重复）</span>
<span class="hljs-attr">log-bin</span>=mysql-bin           <span class="hljs-comment"># 开启二进制日志（主从核心）</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">8001</span>
<span class="hljs-attr">user</span>=mysql
<span class="hljs-attr">basedir</span>=/opt/data/mysql8
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data_master
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_master/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data_master/mysql.err
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data_master/mysql.pid
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># binlog-do-db = test       # 可选：仅同步主库中的test库</span>
<span class="hljs-comment"># binlog-ignore-db = test   # 可选：忽略主库中的test库同步</span>
</code></pre>
<h3 data-id="heading-9">3. 配置从库（my_slave.cnf）</h3>
<pre><code class="hljs language-bash" lang="bash">vim /opt/data/mysql8/conf/my_slave.cnf
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[client]</span>
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_slave/mysql.sock

<span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">server-id</span>=<span class="hljs-number">2</span>                 <span class="hljs-comment"># 从库唯一ID（需与主库不同）</span>
<span class="hljs-attr">log-bin</span>=mysql-bin
<span class="hljs-attr">read_only</span>=<span class="hljs-number">1</span>                 <span class="hljs-comment"># 从库只读（super用户除外）</span>
<span class="hljs-attr">bind-address</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>
<span class="hljs-attr">port</span>=<span class="hljs-number">8002</span>
<span class="hljs-attr">user</span>=mysql
<span class="hljs-attr">basedir</span>=/opt/data/mysql8
<span class="hljs-attr">datadir</span>=/opt/data/mysql8/data_slave
<span class="hljs-attr">socket</span>=/opt/data/mysql8/data_slave/mysql.sock
<span class="hljs-attr">log-error</span>=/opt/data/mysql8/data_slave/mysql.err
<span class="hljs-attr">pid-file</span>=/opt/data/mysql8/data_slave/mysql.pid
<span class="hljs-attr">max_connections</span>=<span class="hljs-number">10000</span>
<span class="hljs-attr">max_user_connections</span>=<span class="hljs-number">2000</span>
<span class="hljs-attr">wait_timeout</span>=<span class="hljs-number">200</span>
<span class="hljs-attr">character_set_server</span>=utf8mb4
<span class="hljs-attr">symbolic-links</span>=<span class="hljs-number">0</span>
<span class="hljs-attr">explicit_defaults_for_timestamp</span>=<span class="hljs-literal">true</span>
<span class="hljs-comment"># replicate-do-db = test    # 可选：仅复制主库中的test库</span>
<span class="hljs-comment"># replicate-ignore-db = test# 可选：忽略主库中的test库复制</span>
</code></pre>
<h3 data-id="heading-10">4. 初始化并启动主从库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 初始化主库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_master.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data_master --user=mysql --initialize

<span class="hljs-comment"># 初始化从库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_slave.cnf --basedir=/opt/data/mysql8 --datadir=/opt/data/mysql8/data_slave --user=mysql --initialize

<span class="hljs-comment"># 查看主/从库临时密码</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data_master/mysql.err  <span class="hljs-comment"># 主库示例：QzPwayyQe5(p</span>
<span class="hljs-built_in">cat</span> /opt/data/mysql8/data_slave/mysql.err   <span class="hljs-comment"># 从库示例：+&amp;9+6d62Uiw-</span>

<span class="hljs-comment"># 启动主库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_master.cnf --user=mysql --daemonize

<span class="hljs-comment"># 启动从库</span>
/opt/data/mysql8/bin/mysqld --defaults-file=/opt/data/mysql8/conf/my_slave.cnf --user=mysql --daemonize
</code></pre>
<h3 data-id="heading-11">5. 配置主从同步权限</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录主库（输入主库临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my_master.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 修改主库root密码并开放远程访问</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 创建从库同步专用用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'slave'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">GRANT</span> REPLICATION SLAVE <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'slave'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 查看主库二进制日志信息（记录file和pos，用于从库配置）</span>
<span class="hljs-keyword">show</span> master status\G;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a229d8730b444e818fe1a8b1830f60a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=BdeQ7z0LaSUegEIijiBFjyyPGaE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">6. 配置从库同步</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 登录从库（输入从库临时密码）</span>
/opt/data/mysql8/bin/mysql --defaults-file=/opt/data/mysql8/conf/my_slave.cnf -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 修改从库root密码</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">update</span> mysql.user <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">'%'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">'root'</span>;
FLUSH PRIVILEGES;

<span class="hljs-comment">-- 指定主库</span>
change master <span class="hljs-keyword">to</span> master_host<span class="hljs-operator">=</span><span class="hljs-string">'116.198.230.30'</span>,master_port<span class="hljs-operator">=</span><span class="hljs-number">8001</span>,master_user<span class="hljs-operator">=</span><span class="hljs-string">'slave'</span>,master_password<span class="hljs-operator">=</span><span class="hljs-string">'123456'</span>,master_log_file<span class="hljs-operator">=</span><span class="hljs-string">'mysql-bin.000002'</span>,master_log_pos<span class="hljs-operator">=</span><span class="hljs-number">3376</span>;

<span class="hljs-comment">-- 启动从库同步</span>
<span class="hljs-keyword">start</span> slave;

<span class="hljs-comment">-- 查看同步状态（Slave_IO_Running和Slave_SQL_Running均为Yes则成功）</span>
<span class="hljs-keyword">show</span> slave status\G;

<span class="hljs-comment">-- 创建从库只读用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'slave_read'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">WITH</span> mysql_native_password <span class="hljs-keyword">BY</span> <span class="hljs-string">'123456'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'slave_read'</span>@<span class="hljs-string">'%'</span>;
FLUSH PRIVILEGES;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba09e23765b040ba955fa7b69b6499dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=Vo8G9DORdzKUJpu7unL5zKsSR4s%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">7. 验证主从同步</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 登录主库创建测试库</span>
<span class="hljs-keyword">create</span> database test;

<span class="hljs-comment">-- 登录从库查看是否同步</span>
<span class="hljs-keyword">show</span> databases;
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b68bb5fe1bc4a749e6d550a52d449b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2lzZVNoZWVw:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103335&amp;x-signature=A%2BzrNtWFWwZ6dvqeYKYZBhe0KH8%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你真的清楚GO语言的defer吗？]]></title>    <link>https://juejin.cn/post/7599614131424051209</link>    <guid>https://juejin.cn/post/7599614131424051209</guid>    <pubDate>2026-01-27T07:24:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599614131424051209" data-draft-id="7599640782570274843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你真的清楚GO语言的defer吗？"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-01-27T07:24:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yuanji6666"/> <meta itemprop="url" content="https://juejin.cn/user/1751944348856905"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你真的清楚GO语言的defer吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1751944348856905/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yuanji6666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:24:48.000Z" title="Tue Jan 27 2026 07:24:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Defer</h2>
<blockquote>
<p>Go's <code>defer</code> statement schedules a function call (the <em>deferred</em> function) to be run immediately before the function executing the <code>defer</code> returns. It's an unusual but effective way to deal with situations such as resources that must be released regardless of which path a function takes to return. The canonical examples are unlocking a mutex or closing a file.</p>
</blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Feffective_go%23defer" target="_blank" title="https://go.dev/doc/effective_go#defer" ref="nofollow noopener noreferrer">官方文档</a></p>
<h2 data-id="heading-1">执行顺序</h2>
<p>LIFO 依次压栈，执行顺序与defer的顺序相反</p>
<h2 data-id="heading-2">参数求值时机</h2>
<blockquote>
<p>The arguments to the deferred function (which include the receiver if the function is a method) are evaluated when the <em>defer</em> executes, not when the <em>call</em> executes.Besides avoiding worries about variables changing values as the function executes, this means that a single deferred call site can defer multiple function executions.</p>
</blockquote>
<p>defer的函数的参数，在defer执行时就已经确定，而不是函数调用时：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Test <span class="hljs-keyword">struct</span>{
	a <span class="hljs-type">int</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(t Test)</span></span> <span class="hljs-built_in">print</span>(x <span class="hljs-type">int</span>){
	fmt.Printf(<span class="hljs-string">"a is %v, x is %v "</span>, t.a, x)
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferRun</span><span class="hljs-params">()</span></span> <span class="hljs-type">int</span> {
	test := Test{<span class="hljs-number">1</span>}
	num := <span class="hljs-number">1</span> 
	<span class="hljs-keyword">defer</span> test.<span class="hljs-built_in">print</span>(num)
	num++
	test.a++
	
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	deferRun()	
}
</code></pre>
<p>运行结果：</p>
<pre><code class="hljs language-go" lang="go">a is <span class="hljs-number">1</span>, x is <span class="hljs-number">1</span>
</code></pre>
<h2 data-id="heading-3">return时具体做了什么？</h2>
<p>我们知道，defer 函数在return时调用，但是具体做了什么？</p>
<p>只需弄清楚三步：</p>
<ol>
<li>设置result</li>
<li>执行defer</li>
<li>返回result</li>
</ol>
<p>来看具体例子：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
   res := deferRun()
   fmt.Println(res)<span class="hljs-comment">//输出2</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">deferRun</span><span class="hljs-params">()</span></span> (res <span class="hljs-type">int</span>) {
  num := <span class="hljs-number">1</span>
  <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    res++
  }()  
  <span class="hljs-keyword">return</span> num
  <span class="hljs-comment">// res = num </span>
  <span class="hljs-comment">// res ++</span>
  <span class="hljs-comment">// return res</span>
}
</code></pre>
<p>无论怎样的过程，从这三步分析就不会出错</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入浅出 Java 中的 CompletableFuture：让异步编程变得简单]]></title>    <link>https://juejin.cn/post/7599640782570323995</link>    <guid>https://juejin.cn/post/7599640782570323995</guid>    <pubDate>2026-01-27T07:21:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782570323995" data-draft-id="7599640782570225691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入浅出 Java 中的 CompletableFuture：让异步编程变得简单"/> <meta itemprop="keywords" content="后端,面试"/> <meta itemprop="datePublished" content="2026-01-27T07:21:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="让我上个超影吧"/> <meta itemprop="url" content="https://juejin.cn/user/3411151088782442"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入浅出 Java 中的 CompletableFuture：让异步编程变得简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411151088782442/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    让我上个超影吧
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:21:29.000Z" title="Tue Jan 27 2026 07:21:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家在开发中有没有遇到过这样的场景：需要同时调用好几个接口，等所有接口都返回结果后再进行下一步处理？或者某个操作依赖另一个操作的结果，但又不想让程序一直等着？</p>
<p>如果还用传统的多线程或者 Future 来处理，代码往往写得又复杂又难维护。今天就来给大家介绍一个 Java 8 引入的异步编程神器 ——<strong>CompletableFuture</strong>，它能让这些复杂的异步操作变得简单优雅。</p>
<h2 data-id="heading-0">一、什么是 CompletableFuture？</h2>
<p>简单说，CompletableFuture 是一个「可以手动完成的 Future」。它不仅能像普通 Future 那样执行异步任务，还提供了一堆实用的方法，让我们可以轻松实现：</p>
<blockquote>
<ul>
<li>链式调用（上一个任务完成后自动执行下一个）</li>
<li>组合多个任务（不管是有依赖关系还是完全独立）</li>
<li>优雅处理异常（不用担心异步任务的异常被悄悄吃掉）</li>
</ul>
</blockquote>
<p>形象点说，普通 Future 就像寄快递，只能等快递到了自己去取；而 CompletableFuture 更像「快递上门」，不仅能自动通知你，还能帮你把快递拆开、分类，甚至直接送到指定位置。</p>
<p><strong><code>CompletableFuture</code></strong> <strong>同时实现了</strong> <strong><code>Future</code></strong> <strong>和</strong> <strong><code>CompletionStage</code></strong> <strong>接口</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CompletableFuture</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-title">implements</span> <span class="hljs-title">Future</span>&lt;<span class="hljs-title">T</span>&gt;, <span class="hljs-title">CompletionStage</span>&lt;<span class="hljs-title">T</span>&gt; {
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fee45f443a4e25b39506ace810ca2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=341DRX2PjThYZ0KTVT0WAO%2FfMXY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdff93b37615499aa4c07017e1c653b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nJ3p5qKvyhncru6GshtAhE1buxQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98a562acda7648d09fc391f00874f007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=cf6qPWP%2F3MSL1qhdBGRM4pEDlmw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">二、入门：创建第一个 CompletableFuture</h2>
<p>创建 CompletableFuture 主要靠两个<strong>静态方法</strong>，先看个简单例子：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutionException;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstCompletableFuture</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {
        <span class="hljs-comment">// 1. 有返回值的异步任务：supplyAsync</span>
        CompletableFuture&lt;String&gt; foodFuture = CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 模拟耗时操作（比如调用接口查外卖）try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"麻辣烫"</span>; <span class="hljs-comment">// 任务结果</span>
        });

        <span class="hljs-comment">// 2. 无返回值的异步任务：runAsync</span>
        CompletableFuture&lt;Void&gt; noticeFuture = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-comment">// 模拟耗时操作（比如发送通知）try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.out.println(<span class="hljs-string">"已通知用户：外卖正在配送中"</span>);
        });

        <span class="hljs-comment">// 获取第一个任务的结果（会等任务完成）String food = foodFuture.get();</span>
        System.out.println(<span class="hljs-string">"用户点的是："</span> + food);

        <span class="hljs-comment">// 等待第二个任务完成（虽然它没返回值，但我们需要它执行完）</span>
        noticeFuture.get();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/526b32e8d5cd4649993e0667fdf63bc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jPqKJXYsZhtkx5H%2FtOXeL6V0yZg%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43580dc17ad4463584053b36745ff439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=xjZ%2FirHVbKebbb74RQXPjNZhNus%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da868e79a8964a9baf83ef69276594f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jhbtPOMBNSGrg5ZFAqLNJ9Qmhtc%3D" alt="" loading="lazy"/></p>
<p><strong>关键点：</strong></p>
<p><code>1.supplyAsync</code> <strong><code>（带Async表示是异步）</code></strong> ：适合有返回结果的任务（比如查数据、算结果），参数是一个 <code>Supplier</code>（带返回值的函数）。</p>
<pre><code class="hljs language-scss" lang="scss">public static &lt;U&gt; CompletableFuture&lt;U&gt; <span class="hljs-built_in">supplyAsync</span>(Supplier&lt;U&gt; supplier) {
        return <span class="hljs-built_in">asyncSupplyStage</span>(asyncPool, supplier);
    }

    <span class="hljs-comment">//使用自定义线程池，比较推荐public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier,</span>
                                                       Executor executor) {
        return <span class="hljs-built_in">asyncSupplyStage</span>(screenExecutor(executor), supplier);
    }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fad858ce377945bd9f5d8af7595cb215~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=KGHppjI22PykDSYLhwlWfCAZgIs%3D" alt="" loading="lazy"/></p>
<p><code>2.runAsync</code>：适合无返回结果的任务（比如发日志、发通知），参数是一个 <code>Runnable</code>（无返回值的函数）。</p>
<pre><code class="hljs language-scss" lang="scss">    public static CompletableFuture&lt;Void&gt; <span class="hljs-built_in">runAsync</span>(Runnable runnable) {
        return <span class="hljs-built_in">asyncRunStage</span>(asyncPool, runnable);
    }

    <span class="hljs-comment">//使用自定义线程池，比较推荐public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,</span>
                                                   Executor executor) {
        return <span class="hljs-built_in">asyncRunStage</span>(screenExecutor(executor), runnable);
    }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5967420bfe6457b984c4d875a250aac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=FmG%2BPEukGr31fUs0b%2BIFixqeGSc%3D" alt="" loading="lazy"/></p>
<p>3.两个任务是<strong>并行</strong> <strong>执行</strong>的，所以通知先完成（只等了 500ms），外卖查询后完成（等了 1000ms）。</p>
<h2 data-id="heading-2">三、进阶：链式操作，让任务像流水线一样执行</h2>
<p>最能体现 CompletableFuture 强大的，就是它的<strong>链式操作</strong>。不用手动等待上一个任务完成，直接指定「下一个要做什么」。</p>
<p>比如我们要完成这样一个流程：</p>
<blockquote>
<ol>
<li>查用户 ID（耗时 1s）</li>
<li>用 ID 查用户名（耗时 0.5s）</li>
<li>打印用户名（耗时忽略）</li>
</ol>
</blockquote>
<p>用链式操作实现，代码会非常清爽：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CompletableFutureChain</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">// 链式操作：一步接一步执行</span>
        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; pipeline = CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 第一步：查用户IDtry { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第一步：查到用户ID = 10086"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">10086</span>; <span class="hljs-comment">// 把结果传给下一步</span>
        }).thenApply(userId -&gt; {
            <span class="hljs-comment">// 第二步：用ID查用户名（接收上一步的结果）try { Thread.sleep(500); } catch (InterruptedException e) { e.printStackTrace(); }</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第二步：用ID "</span> + userId + <span class="hljs-string">" 查到用户名 = 小明"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"小明"</span>; <span class="hljs-comment">// 再把结果传给下一步</span>
        }).thenAccept(username -&gt; {
            <span class="hljs-comment">// 第三步：打印用户名（接收上一步的结果，无返回值）</span>
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"第三步：最终用户名是 "</span> + username);
        });

        <span class="hljs-comment">// 等待整个流水线完成</span>
        pipeline.<span class="hljs-keyword">get</span>();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45022eca2d184da8b2b1f0ead202d2cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8IUy6GGjQ8arLO9QqwKkStgI6v0%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55970080f2bb455cbfe1d59553fdfaa2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=CcsG8a1z7WZry1B5rCAnIkDq21Q%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0766b8bd401c4810b0419d39279ffcf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=DhT8RhYFI4NfJaJgMPYCfYEm8CQ%3D" alt="" loading="lazy"/></p>
<p><strong>常用链式方法：</strong></p>
<blockquote>
<ul>
<li><code>thenApply</code>：<strong>接收上一步结果</strong>，处理后返回新结果（比如「ID→用户名」的转换）。</li>
<li><code>thenAccept</code>：接收上一步结果，<strong>只处理不返回</strong>（比如打印、保存）。</li>
<li><code>thenRun</code>：<strong>不关心上一步结果</strong>，只在完成后执行（比如「不管结果如何，都记录日志」）。</li>
</ul>
</blockquote>
<p>就像流水线一样，上一个工序的产品自动传到下一个工序，全程无需人工干预。</p>
<h2 data-id="heading-3">四、高手篇：组合多个任务，效率翻倍</h2>
<p>实际开发中，我们经常需要处理多个任务，有的任务之间有依赖（比如先登录才能下单），有的则完全独立（比如同时加载商品信息和用户信息）。CompletableFuture 提供了专门的方法来处理这些场景。</p>
<h3 data-id="heading-4">1. 处理依赖任务：thenCompose</h3>
<p>比如「先查用户地址，再根据地址查天气」，第二个任务依赖第一个的结果：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThenComposeDemo</span> {
    <span class="hljs-comment">// 模拟：查用户地址public static CompletableFuture&lt;String&gt; getAddress(String username) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            <span class="hljs-keyword">return</span> username + <span class="hljs-string">"的地址是：北京市海淀区"</span>;
        });
    }

    <span class="hljs-comment">// 模拟：根据地址查天气public static CompletableFuture&lt;String&gt; getWeather(String address) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">600</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            <span class="hljs-keyword">return</span> address + <span class="hljs-string">"，今天天气：晴，25℃"</span>;
        });
    }

    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">// 组合两个依赖任务</span>
        CompletableFuture&lt;String&gt; result = CompletableFuture.supplyAsync(() -&gt; <span class="hljs-string">"小明"</span>)
                .thenCompose(username -&gt; getAddress(username)) <span class="hljs-comment">// 先查地址</span>
                .thenCompose(address -&gt; getWeather(address)); <span class="hljs-comment">// 再查天气</span>

        System.<span class="hljs-keyword">out</span>.println(result.<span class="hljs-keyword">get</span>());
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/748f226ee9544834903d55e39d43a8b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=3uufV4FS32Uig8etgulNordiSS8%3D" alt="" loading="lazy"/></p>
<p>运行流程如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adee6997e91e479d84bcdc4c373b0c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=VXupXbSM5FTbALfKFucrWgthiCQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e38fd3090b6b4257a5ae802e10a9407c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=2qNez8wg5HHF7amO2pEiCPjf58M%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d86ab4e3eb46869337d9b4bdecaa8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=riqwMJQN30Sa4tMVpBtt9Ewh3NA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c3f053e0b1d485480e0a88986ef8a89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=lLCNaBQJz132kdxQfdhgQRcgBao%3D" alt="" loading="lazy"/></p>
<p><code>thenCompose</code> 就像「接力赛」，第一棒跑完了，把接力棒交给第二棒，确保任务按顺序执行。</p>
<h3 data-id="heading-5">2. 处理独立任务：thenCombine</h3>
<p>如果两个任务毫无关系，可以并行执行，最后合并结果。比如「同时查商品价格和库存，计算总价」：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThenCombineDemo</span> {
    <span class="hljs-comment">// 查价格public static CompletableFuture&lt;Double&gt; getPrice(String product) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(product + <span class="hljs-string">"的价格是：99.9元"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">99.9</span>;
        });
    }

    <span class="hljs-comment">// 查库存public static CompletableFuture&lt;Integer&gt; getStock(String product) {</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(product + <span class="hljs-string">"的库存是：5件"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>;
        });
    }

    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        String product = <span class="hljs-string">"Java编程思想"</span>;
        <span class="hljs-comment">// 并行执行两个任务，然后合并结果</span>
        CompletableFuture&lt;<span class="hljs-built_in">Double</span>&gt; total = getPrice(product)
                .thenCombine(getStock(product), (price, stock) -&gt; price * stock);

        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"总价："</span> + total.<span class="hljs-keyword">get</span>() + <span class="hljs-string">"元"</span>);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866ed57a809c4a419335a8ba326d33de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=lQfLe%2B7OVhsp7G5Uri9KSJhpUf4%3D" alt="" loading="lazy"/></p>
<p>执行流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e69ed027e424674ab9e29fd957ba049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=9bzvGPas1jbspGpeudl8gVyW%2F1s%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a97f5b1521684e5c90918fa71795c57a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=k7PFkrB31HLI%2F1O0QZnXX6%2F56r4%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c41ef5637144870bea681232d0d2d3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=5nYcuB3D35aQ26F3da5Umqi%2FwPI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a27915cdbcb49e583ab7684e02b89d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=X4vwfa6I0DpWrZh59A2YTqN3Xe0%3D" alt="" loading="lazy"/></p>
<p>两个任务并行执行，效率大大提高！</p>
<h3 data-id="heading-6">3. 等待所有任务：allOf</h3>
<p>如果有一堆任务，需要全部完成后再做处理（比如批量下载多个文件，全部下完后打包）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.itheima.future;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AllOfDemo</span> {
    <span class="hljs-keyword">public</span> static void main(String[] args) throws Exception {
        <span class="hljs-comment">//计时开始long start = System.currentTimeMillis();</span>
        <span class="hljs-comment">// 3个下载任务</span>
        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download1 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件1下载完成"</span>);
        });

        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download2 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1500</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件2下载完成"</span>);
        });

        CompletableFuture&lt;<span class="hljs-built_in">Void</span>&gt; download3 = CompletableFuture.runAsync(() -&gt; {
            <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"文件3下载完成"</span>);
        });

        <span class="hljs-comment">// 等待所有任务完成</span>
        CompletableFuture.allOf(download1, download2, download3).<span class="hljs-keyword">get</span>();
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"所有文件下载完成，开始打包..."</span>);
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"打包完成，耗时："</span> + (System.currentTimeMillis() - start) + <span class="hljs-string">"毫秒"</span>);
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7578e51fee405ebc3d3ff2d6e0d092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8D4zjc4MHQz5z90PW8cUt0%2BWXiA%3D" alt="" loading="lazy"/></p>
<p>执行流程如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ff6bb1da06044b1985c811dea9b148d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=p8R%2BVCWihQGOhAABeHRUDG4s1D0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c0473da5cb44324acaa5f5f2bb88187~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=O%2FEjGcPuK7upr1FBnH5gz60VvEI%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/830c84b1e9544d879a62c77f7c481a02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=cRzlYsVwRTQvtdzAVE88Ff0%2Bxhk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12245c13bd75410a93b409da9b8d5ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=9JrbOacgdJyIX3krzCfSn1lXwzg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">4. 等待任意任务：anyOf</h3>
<p>如果多个任务中，只要有一个完成就可以继续 <strong>（比如查多个</strong> <strong>数据源</strong> <strong>，哪个快用哪个）</strong> ：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">CompletableFuture</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnyOfDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-title class_">String</span>[] args) throws <span class="hljs-title class_">Exception</span> {
        <span class="hljs-comment">// 3个查询任务（不同数据源）</span>
        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromCache = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">300</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从缓存查到数据：Java入门"</span>;
        });

        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromDb = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">800</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从数据库查到数据：Java入门"</span>;
        });

        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">String</span>&gt; fromApi = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">supplyAsync</span>(() -&gt; {
            <span class="hljs-keyword">try</span> { <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">sleep</span>(<span class="hljs-number">1200</span>); } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InterruptedException</span> e) { e.<span class="hljs-title function_">printStackTrace</span>(); }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"从API查到数据：Java入门"</span>;
        });

        <span class="hljs-comment">// 只要有一个任务完成就返回</span>
        <span class="hljs-title class_">CompletableFuture</span>&lt;<span class="hljs-title class_">Object</span>&gt; result = <span class="hljs-title class_">CompletableFuture</span>.<span class="hljs-title function_">anyOf</span>(fromCache, fromDb, fromApi);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"最快的结果："</span> + result.<span class="hljs-title function_">get</span>());
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b8f5aa18b6041a1849d3bab9d1185ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=Dfj93CVta8KvheQaRUfaw11Uix0%3D" alt="" loading="lazy"/></p>
<p>运行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/878833ea667c4c5fb3c446d11a539c55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=5snTepHOBxD8hDQir6XWxZ09N3Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4883516b0a0b4394b5aa07bb80385e99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=PDt70AeUkBIopGz6NUic%2F0Lpcdg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">五、异常处理：别让异步任务的错误悄悄溜走</h2>
<p>异步任务的异常很容易被忽略（比如线程池悄悄吃掉异常），CompletableFuture 提供了贴心的异常处理方法。</p>
<h3 data-id="heading-9">1. exceptionally：捕获异常并返回默认值</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionDemo1</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        CompletableFuture&lt;Integer&gt; future = CompletableFuture.<span class="hljs-built_in">supplyAsync</span>(() -&gt; {
            <span class="hljs-comment">// 模拟任务失败if (true) {</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"查询失败：数据库连接超时"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
        }).<span class="hljs-built_in">exceptionally</span>(ex -&gt; {
            <span class="hljs-comment">// 捕获异常，返回默认值</span>
            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"出错了："</span> + ex.<span class="hljs-built_in">getMessage</span>());
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 默认值</span>
        });

        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"最终结果："</span> + future.<span class="hljs-built_in">get</span>()); <span class="hljs-comment">// 输出 0</span>
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34c3b7e240b64319803f83a8a21552b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=xHq7K7S0Azu2f0WYZ6gcxPoeCG8%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26f63c85fc6c49dc8b0c785afc16f787~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=yLOk4qEicFIwddMnnKNKdUJJJcs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25ead0b5118f48198dd5c8c312a410d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=RfpIw7cCKjRTaHHBVYZVbJyeZEY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">2. handle：同时处理正常结果和异常</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionDemo2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>{
        CompletableFuture&lt;<span class="hljs-type">String</span>&gt; future = CompletableFuture.<span class="hljs-built_in">supplyAsync</span>(() -&gt; {
            <span class="hljs-comment">// 这里可以故意抛出异常测试return "正常结果";</span>
        }).<span class="hljs-built_in">handle</span>((result, ex) -&gt; {
            <span class="hljs-keyword">if</span> (ex != null) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"处理异常："</span> + ex.<span class="hljs-built_in">getMessage</span>();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-string">"处理成功："</span> + result;
            }
        });

        System.out.<span class="hljs-built_in">println</span>(future.<span class="hljs-built_in">get</span>()); <span class="hljs-comment">// 输出 处理成功：正常结果</span>
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38e488104d7f4b05bce139e735ed61b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=LC9p%2F%2FRBgCJ2a4nojbK2bxDaDvw%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79f188920e1540c49fba7c9333dc2e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=epFjQbq%2F3qhapH6CfjytoIG7LHE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f853e82de0f4de3bb3b3ea0d2eb3ced~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=1bHIbORvwMrNpgMGqCUckIc99%2Bs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">六、CompletableFuture 的线程池：默认还是自定义？</h2>
<p>使用 CompletableFuture 时，线程池的选择非常关键，它直接影响程序的性能和稳定性。</p>
<h3 data-id="heading-12">1. 默认线程池：ForkJoinPool.commonPool ()</h3>
<p>当我们使用无参的**<code>supplyAsync()</code>** <strong>或</strong> <strong><code>runAsync()</code></strong> 时，CompletableFuture 会默认使用**<code>ForkJoinPool.commonPool()</code>** 作为线程池：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 使用默认线程池</span>
<span class="hljs-selector-tag">CompletableFuture</span><span class="hljs-selector-class">.supplyAsync</span>(() -&gt; {
    <span class="hljs-comment">// 任务逻辑return "result";</span>
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5876b8d6e6b44ee98a062597751c00e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=GKIgfa2nTEU6E3%2BXPV3IA9tO6pk%3D" alt="" loading="lazy"/></p>
<p><strong>默认</strong> <strong>线程池</strong> <strong>的特点</strong>：</p>
<blockquote>
<ul>
<li>线程数量：默认等于 CPU 核心数（可以通过<code>-Djava.util.concurrent.ForkJoinPool.common.parallelism</code>参数调整）</li>
<li>适用场景：CPU 密集型任务（如计算）</li>
<li>优点：无需手动管理线程池，简单方便</li>
</ul>
</blockquote>
<p><strong>潜在问题</strong>：</p>
<blockquote>
<ul>
<li>所有使用默认线程池的任务会共享这一组线程，高并发下可能出现资源竞争</li>
<li>对于 IO 密集型任务（如网络请求、文件读写），固定的线程数可能导致效率低下</li>
<li>当有大量任务时，可能会拖慢所有依赖此线程池的任务</li>
</ul>
</blockquote>
<h3 data-id="heading-13">2. 自定义线程池：更灵活的控制</h3>
<p>实际项目中，<strong>强烈建议使用自定义</strong> <strong>线程池</strong>，尤其是在<strong>生产环境</strong>。我们可以通过带线程池参数的方法来指定：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.itheima.future;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomThreadPoolDemo</span> {
    <span class="hljs-comment">// 自定义线程池(这里我暂时使用线程池包里的线程池，一般情况下要使用自定义线程池ThreadPoolExecutor)private static final ExecutorService customExecutor = Executors.newFixedThreadPool(10);</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 使用自定义线程池</span>
        CompletableFuture.supplyAsync(() -&gt; {
            System.out.println(<span class="hljs-string">"任务在自定义线程池执行："</span> + Thread.currentThread().getName());
            <span class="hljs-keyword">return</span> <span class="hljs-string">"处理完成"</span>;
        }, customExecutor)
        .thenAccept(result -&gt; {
            System.out.println(<span class="hljs-string">"结果："</span> + result);
        });
        
        <span class="hljs-comment">// 记得在程序结束时关闭线程池</span>
        customExecutor.shutdown();
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d3a6d0ce7a448cf9e1698dcd442c052~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=UHBl7DtJGSQ%2BR%2FG9bzkg9WNI55Q%3D" alt="" loading="lazy"/></p>
<p>执行结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88ee474966294089a9037751c9f2ffeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nV524IZ2gMPSPuZqQjKr2HZMRu0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7488ba2240d4659add364483b6df42f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=vuz7D5Ishl5TAoVc9aDZjo0J71A%3D" alt="" loading="lazy"/></p>
<p><strong>自定义</strong> <strong>线程池</strong> <strong>的优势</strong>：</p>
<blockquote>
<ul>
<li>隔离不同类型的任务（例如：查询数据库的任务用一个线程池，发送消息的任务用另一个）</li>
<li>可以根据任务类型（CPU 密集 / IO 密集）调整线程数量</li>
<li>避免默认线程池被某个耗时任务占满导致的整体阻塞</li>
</ul>
</blockquote>
<p><strong>线程池</strong> <strong>配置建议</strong>：</p>
<blockquote>
<ul>
<li>CPU 密集型任务：<strong>线程数</strong> <strong>= CPU 核心数 + 1</strong></li>
<li>IO 密集型任务：<strong>线程数</strong> <strong>= CPU 核心数 × 2</strong>（或更多，根据实际测试调整）</li>
<li>为线程池起一个有意义的名字，方便问题排查（可以通过自定义 ThreadFactory 实现）</li>
</ul>
</blockquote>
<h2 data-id="heading-14">七、CompletableFuture vs Future：到底有什么不同？</h2>
<p>很多人会疑惑，Java 已经有了 Future，为什么还需要 CompletableFuture？它们的核心区别在哪里？</p>








































<table><thead><tr><th>特性</th><th>Future</th><th>CompletableFuture</th></tr></thead><tbody><tr><td>实现接口</td><td>仅实现 Future 接口</td><td>实现 Future 和 CompletionStage 接口</td></tr><tr><td>链式操作</td><td>不支持，必须阻塞获取结果后再处理</td><td>支持，可通过 thenApply 等方法串联多个任务</td></tr><tr><td>异常处理</td><td>无专门的 API，需要在任务内部捕获</td><td>提供 exceptionally、handle 等专门的异常处理方法</td></tr><tr><td>任务组合</td><td>不支持，需要手动编写同步逻辑</td><td>支持 thenCompose、thenCombine 等多种组合方式</td></tr><tr><td>手动完成</td><td>不支持</td><td>支持 complete ()、completeExceptionally () 手动设置结果或异常</td></tr><tr><td>阻塞获取</td><td>只能通过 get () 阻塞获取</td><td>可以阻塞获取，也可以通过回调非阻塞处理</td></tr></tbody></table>
<h3 data-id="heading-15">具体区别举例</h3>
<h4 data-id="heading-16">1. 处理结果的方式</h4>
<p><strong>Future 的方式</strong>（繁琐且必须阻塞）：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newSingleThreadExecutor()<span class="hljs-comment">;</span>
Future&lt;String&gt; <span class="hljs-attr">future</span> = executor.submit(() -&gt; {
    Thread.sleep(1000)<span class="hljs-comment">;</span>
    return "任务结果"<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

// 必须阻塞等待结果String <span class="hljs-attr">result</span> = future.get()<span class="hljs-comment">;</span>
// 处理结果
System.out.println("处理：" + result)<span class="hljs-comment">;</span>
executor.shutdown()<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7e86426afe4393a027b0d741d3e3c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=Npx7FNAtbHCQRzcxpZ1zKgAtZQ4%3D" alt="" loading="lazy"/></p>
<p><strong>CompletableFuture 的方式</strong>（非阻塞，链式处理）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-keyword">try</span> { Thread.sleep(<span class="hljs-number">1000</span>); } <span class="hljs-keyword">catch</span> (InterruptedException e) { e.printStackTrace(); }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"任务结果"</span>;
}).thenApply(result -&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"处理后："</span> + result;
}).thenAccept(processedResult -&gt; {
    System.<span class="hljs-keyword">out</span>.println(processedResult);
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51c051d004e40aa8eb67b4aba49a45b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=8BBtYSIdlLsPcUD2BeUH3D4Qf6s%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">2. 异常处理能力</h4>
<p><strong>Future 的方式</strong>（异常处理麻烦）：</p>
<pre><code class="hljs language-ini" lang="ini">ExecutorService <span class="hljs-attr">executor</span> = Executors.newSingleThreadExecutor()<span class="hljs-comment">;</span>
Future&lt;Integer&gt; <span class="hljs-attr">future</span> = executor.submit(() -&gt; {
    if (true) {
        throw new RuntimeException("计算失败")<span class="hljs-comment">;</span>
    }
    return 100<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>

try {
    Integer <span class="hljs-attr">result</span> = future.get()<span class="hljs-comment">; // 异常会在这里抛出</span>
} catch (Exception e) {
    // 处理异常
    e.printStackTrace()<span class="hljs-comment">;</span>
}
executor.shutdown()<span class="hljs-comment">;</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706a9764e1ed4110aa608e79359f869f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=jloQifj2510AVycXBliAptNOrWc%3D" alt="" loading="lazy"/></p>
<p><strong>CompletableFuture 的方式</strong>（专门的异常处理 API）：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">CompletableFuture.supplyAsync(() -&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">throw</span> new RuntimeException(<span class="hljs-string">"计算失败"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;
}).exceptionally(ex -&gt; {
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"捕获异常："</span> + ex.getMessage());
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 返回默认值</span>
}).thenAccept(result -&gt; {
    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"结果："</span> + result); <span class="hljs-comment">// 输出0</span>
});
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dcabeece64146f4b07876c94127797e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=EiTZR8DGsOeY9I9ua%2BgBUhJGHDI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18">3. 多任务组合能力</h4>
<p>Future 几乎无法优雅地组合多个任务，而 CompletableFuture 提供了丰富的组合方式，这也是它最核心的优势。</p>
<p><strong>感兴趣的宝子可以关注一波，后续会更新更多有用的知识！！！</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52621360aa494deba3a02f935deef043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K6p5oiR5LiK5Liq6LaF5b2x5ZCn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103289&amp;x-signature=nUJVyHOgGWtuhfA%2Be5dMlBwHgFU%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送]]></title>    <link>https://juejin.cn/post/7599601258640900134</link>    <guid>https://juejin.cn/post/7599601258640900134</guid>    <pubDate>2026-01-27T06:44:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258640900134" data-draft-id="7599640782569865243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T06:44:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户80269443385"/> <meta itemprop="url" content="https://juejin.cn/user/925127226441289"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 短信验证码 API 示例代码：HTTP POST 请求的构建与发送
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/925127226441289/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户80269443385
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:44:20.000Z" title="Tue Jan 27 2026 06:44:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 C# 开发中，对接短信验证码 API 是实现用户验证、订单通知等功能的常见需求，而新手开发者构建 HTTP POST 请求时，常因请求头配置错误、参数编码不当、响应解析不完整导致接口调用失败，甚至无法正确发送第一个请求。本文提供完整可运行的 c# 短信验证码 API 示例代码，从 POST 请求构建、参数封装到响应解析全流程拆解，解决请求构建的核心痛点，帮助开发者快速完成接口对接。</p>
<h2 data-id="heading-0">一、C# 对接短信验证码 API 的常见痛点</h2>
<p>开发者使用 C# 调用短信验证码 API 时，以下问题是导致 POST 请求发送失败的高频痛点，也是新手入门的主要障碍：</p>
<ol>
<li>请求头<code>Content-Type</code>配置错误，未设置为<code>application/x-www-form-urlencoded</code>，导致接口无法解析参数；</li>
<li>参数未做 UTF-8 编码，中文或特殊字符触发敏感词校验（407 错误码）；</li>
<li>同步调用未设置超时，网络波动时导致程序长时间阻塞；</li>
<li>仅判断响应码<code>code=2</code>，未针对性处理 405（API ID 错误）、406（手机号格式错误）等具体错误；</li>
<li>手机号未做前置校验，传入非 11 位号码或黑名单号码（4030 错误）。</li>
</ol>
<h2 data-id="heading-1">二、C# 短信验证码 API POST 请求核心原理拆解</h2>
<h3 data-id="heading-2">2.1 HTTP POST 请求的通信规则</h3>
<p>C# 调用短信验证码 API 的 POST 请求需严格遵循 HTTP 协议与接口规范，核心规则如下：</p>
<ul>
<li><strong>字符编码</strong>：所有参数必须采用 UTF-8 编码，否则中文内容会出现乱码，触发 407（敏感字符）错误；</li>
<li><strong>请求头要求</strong>：<code>Content-Type</code>固定为<code>application/x-www-form-urlencoded</code>，这是接口解析表单参数的核心前提；</li>
<li><strong>数据传递方式</strong>：参数需封装为键值对形式通过请求体传递，而非 URL 拼接（GET 方式），保障参数安全性；</li>
<li><strong>响应解析规则</strong>：接口返回 JSON/XML 格式数据，C# 需通过反序列化将字符串转为对象，便于提取<code>code</code>、<code>msg</code>等核心字段。</li>
</ul>
<h3 data-id="heading-3">2.2 核心参数的封装逻辑</h3>
<p>c# 短信验证码 API 示例代码的关键是参数的正确封装，需遵循以下逻辑：</p>
<ol>
<li>
<p>认证参数（<code>account</code>/<code>password</code>）：需从短信服务平台获取，是接口调用的身份凭证，缺失或错误会触发 401/402/405 错误；</p>
</li>
<li>
<p>业务参数（<code>mobile</code>/<code>content</code>/<code>templateid</code>）：</p>
<ul>
<li><code>mobile</code>需校验为 11 位有效号码，脱敏格式为<code>139****8888</code>；</li>
<li>调试阶段<code>templateid=1</code>时，<code>content</code>仅传递验证码变量值（如 “6897”），无需完整短信内容；</li>
</ul>
</li>
<li>
<p>所有参数需做 URL 编码，避免<code>&amp;</code>、<code>=</code>等特殊字符导致参数截断。</p>
</li>
</ol>
<h2 data-id="heading-4">三、完整 C# 短信验证码 API 示例代码与解析</h2>
<h3 data-id="heading-5">3.1 开发环境与前置准备</h3>
<p>在编写代码前，需完成以下基础准备：</p>
<ol>
<li>开发环境：.NET Framework 4.5+ 或 .NET Core 3.1+（推荐.NET 6+）；</li>
<li>依赖安装：通过 NuGet 安装<code>Newtonsoft.Json</code>（命令：<code>Install-Package Newtonsoft.Json</code>），用于 JSON 响应解析；</li>
<li>参数获取：注册短信服务平台账号，获取<code>account</code>（API ID）和<code>password</code>（API KEY）。</li>
</ol>
<h3 data-id="heading-6">3.2 示例代码实现（HttpWebRequest 版）</h3>
<p>以下是可直接运行的 c# 短信验证码 API 示例代码，基于<code>HttpWebRequest</code>构建 POST 请求，注释中包含注册链接（用于获取认证参数）：</p>
<p>csharp</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net;
<span class="hljs-keyword">using</span> System.Text;
<span class="hljs-keyword">using</span> Newtonsoft.Json;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">SmsVerificationDemo</span>
{
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> 短信API响应实体（对应接口返回的JSON结构）</span>
    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsApiResponse</span>
    {
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> code { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }       <span class="hljs-comment">// 响应码：2=成功，其他=失败</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> msg { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }    <span class="hljs-comment">// 响应描述</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> smsid { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }  <span class="hljs-comment">// 成功时的流水号，失败为0</span>
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsSender</span>
    {
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送短信验证码（POST方式）</span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="mobile"&gt;</span>接收手机号（脱敏格式：139****8888）<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="verificationCode"&gt;</span>验证码（如6897）<span class="hljs-doctag">&lt;/param&gt;</span></span>
        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>是否发送成功<span class="hljs-doctag">&lt;/returns&gt;</span></span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">SendVerificationCode</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> mobile, <span class="hljs-built_in">string</span> verificationCode</span>)</span>
        {
            <span class="hljs-comment">// 注册获取API ID/KEY（C#短信验证码API调用必备）：http://user.ihuyi.com/?udcpF6</span>
            <span class="hljs-built_in">string</span> account = <span class="hljs-string">"xxxxxxxx"</span>; <span class="hljs-comment">// 替换为实际获取的API ID</span>
            <span class="hljs-built_in">string</span> password = <span class="hljs-string">"xxxxxxxx"</span>; <span class="hljs-comment">// 替换为实际获取的API KEY</span>
            <span class="hljs-built_in">string</span> templateId = <span class="hljs-string">"1"</span>;      <span class="hljs-comment">// 调试阶段使用系统默认模板ID</span>
            <span class="hljs-built_in">string</span> apiUrl = <span class="hljs-string">"https://api.ihuyi.com/sms/Submit.json"</span>;

            <span class="hljs-keyword">try</span>
            {
                <span class="hljs-comment">// 1. 构建POST参数（所有参数需URL编码）</span>
                StringBuilder postData = <span class="hljs-keyword">new</span> StringBuilder();
                postData.AppendFormat(<span class="hljs-string">"account={0}"</span>, WebUtility.UrlEncode(account));
                postData.AppendFormat(<span class="hljs-string">"&amp;password={0}"</span>, WebUtility.UrlEncode(password));
                postData.AppendFormat(<span class="hljs-string">"&amp;mobile={0}"</span>, WebUtility.UrlEncode(mobile));
                postData.AppendFormat(<span class="hljs-string">"&amp;content={0}"</span>, WebUtility.UrlEncode(verificationCode));
                postData.AppendFormat(<span class="hljs-string">"&amp;templateid={0}"</span>, WebUtility.UrlEncode(templateId));

                <span class="hljs-comment">// 2. 配置HTTP POST请求</span>
                HttpWebRequest request = (HttpWebRequest)WebRequest.Create(apiUrl);
                request.Method = <span class="hljs-string">"POST"</span>;
                request.ContentType = <span class="hljs-string">"application/x-www-form-urlencoded; charset=utf-8"</span>;
                request.Timeout = <span class="hljs-number">5000</span>; <span class="hljs-comment">// 设置5秒超时，避免程序阻塞</span>

                <span class="hljs-comment">// 3. 写入请求参数到请求体</span>
                <span class="hljs-built_in">byte</span>[] dataBytes = Encoding.UTF8.GetBytes(postData.ToString());
                request.ContentLength = dataBytes.Length;
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stream = request.GetRequestStream())
                {
                    stream.Write(dataBytes, <span class="hljs-number">0</span>, dataBytes.Length);
                }

                <span class="hljs-comment">// 4. 获取并解析响应</span>
                <span class="hljs-keyword">using</span> (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
                <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> streamReader = <span class="hljs-keyword">new</span> System.IO.StreamReader(response.GetResponseStream(), Encoding.UTF8))
                {
                    <span class="hljs-built_in">string</span> responseJson = streamReader.ReadToEnd();
                    SmsApiResponse result = JsonConvert.DeserializeObject&lt;SmsApiResponse&gt;(responseJson);

                    <span class="hljs-comment">// 解析响应结果</span>
                    <span class="hljs-keyword">if</span> (result.code == <span class="hljs-number">2</span>)
                    {
                        Console.WriteLine(<span class="hljs-string">$"验证码发送成功，流水号：<span class="hljs-subst">{result.smsid}</span>"</span>);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                    <span class="hljs-keyword">else</span>
                    {
                        Console.WriteLine(<span class="hljs-string">$"发送失败：错误码<span class="hljs-subst">{result.code}</span>，原因：<span class="hljs-subst">{result.msg}</span>"</span>);
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                }
            }
            <span class="hljs-keyword">catch</span> (WebException ex)
            {
                Console.WriteLine(<span class="hljs-string">$"网络请求异常：<span class="hljs-subst">{ex.Message}</span>"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-keyword">catch</span> (Exception ex)
            {
                Console.WriteLine(<span class="hljs-string">$"系统异常：<span class="hljs-subst">{ex.Message}</span>"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-comment">// 测试调用入口</span>
        <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
        {
            <span class="hljs-comment">// 调用示例：发送验证码6897到手机号138****9876</span>
            SendVerificationCode(<span class="hljs-string">"138****9876"</span>, <span class="hljs-string">"6897"</span>);
            Console.ReadLine();
        }
    }
}
</code></pre>
<h4 data-id="heading-7">代码核心解析</h4>
<ol>
<li><strong>响应实体封装</strong>：定义<code>SmsApiResponse</code>类映射接口返回的 JSON 结构，通过<code>Newtonsoft.Json</code>反序列化，避免手动解析字符串；</li>
<li><strong>参数编码</strong>：使用<code>WebUtility.UrlEncode</code>处理所有参数，解决特殊字符导致的参数解析失败问题；</li>
<li><strong>请求头配置</strong>：严格设置<code>Content-Type</code>为<code>application/x-www-form-urlencoded</code>，符合接口要求；</li>
<li><strong>异常处理</strong>：捕获<code>WebException</code>（网络异常）和通用异常，避免程序崩溃，同时设置 5 秒超时；</li>
<li><strong>结果判断</strong>：通过<code>code=2</code>判断成功，打印具体错误码和原因，便于问题排查。</li>
</ol>
<h3 data-id="heading-8">3.3 .NET Core 推荐方案（HttpClient 版）</h3>
<p>在.NET Core/.NET 6 + 中，推荐使用<code>HttpClient</code>简化 POST 请求构建，代码更简洁：</p>
<p>csharp</p>
<p>运行</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Net.Http;
<span class="hljs-keyword">using</span> System.Threading.Tasks;
<span class="hljs-keyword">using</span> Newtonsoft.Json;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SmsSenderHttpClient</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-title">SendCodeAsync</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> mobile, <span class="hljs-built_in">string</span> code</span>)</span>
    {
        <span class="hljs-keyword">using</span> (HttpClient client = <span class="hljs-keyword">new</span> HttpClient())
        {
            <span class="hljs-comment">// 构建表单参数</span>
            <span class="hljs-keyword">var</span> parameters = <span class="hljs-keyword">new</span> FormUrlEncodedContent(<span class="hljs-keyword">new</span>[]
            {
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"account"</span>, <span class="hljs-string">"xxxxxxxx"</span>),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"password"</span>, <span class="hljs-string">"xxxxxxxx"</span>),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"mobile"</span>, mobile),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"content"</span>, code),
                <span class="hljs-keyword">new</span> KeyValuePair&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"templateid"</span>, <span class="hljs-string">"1"</span>)
            });

            <span class="hljs-comment">// 发送POST请求</span>
            <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">await</span> client.PostAsync(<span class="hljs-string">"https://api.ihuyi.com/sms/Submit.json"</span>, parameters);
            <span class="hljs-built_in">string</span> responseJson = <span class="hljs-keyword">await</span> response.Content.ReadAsStringAsync();
            
            <span class="hljs-comment">// 解析响应</span>
            SmsApiResponse result = JsonConvert.DeserializeObject&lt;SmsApiResponse&gt;(responseJson);
            <span class="hljs-keyword">return</span> result.code == <span class="hljs-number">2</span>;
        }
    }
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c91c814240c4a5faa43ea6cbfa3f6a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODAyNjk0NDMzODU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101060&amp;x-signature=oFJV0EYqibaqRJxwELNAehYkB%2BM%3D" alt="api.png" loading="lazy"/></p>
<h2 data-id="heading-9">四、不同请求封装方式的对比分析</h2>
<p>C# 中构建 POST 请求有三种常见方式，开发者可根据项目场景选择：</p>





























<table><thead><tr><th>封装方式</th><th>核心优点</th><th>主要缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>HttpWebRequest</td><td>底层可控性高，兼容性好</td><td>代码量多，需手动处理流</td><td>.NET Framework 旧项目</td></tr><tr><td>HttpClient</td><td>简洁易用，支持异步</td><td>需注意实例复用（避免端口耗尽）</td><td>.NET Core/.NET 6+ 新项目</td></tr><tr><td>WebClient</td><td>代码最简，快速实现</td><td>灵活性差，功能少</td><td>简单测试、接口连通性验证</td></tr></tbody></table>
<p>互亿无线提供的 C# 短信验证码 API 对接文档中，同时给出了<code>HttpWebRequest</code>和<code>HttpClient</code>两种示例，其参数规范可作为行业通用参考。</p>
<h2 data-id="heading-10">五、C# 调用短信验证码 API 的实用技巧总结</h2>
<ol>
<li><strong>手机号前置校验</strong>：使用正则表达式<code>^1[3-9]\d{9}$</code>校验手机号格式，避免 406 错误；</li>
<li><strong>异步调用优先</strong>：使用<code>async/await</code>封装请求，避免阻塞主线程，提升程序响应性；</li>
<li><strong>错误码精细化处理</strong>：针对 405（API ID 错误）、4072（模板不匹配）等高频错误码做针对性提示；</li>
<li><strong>日志记录</strong>：记录脱敏后的请求参数、响应结果和调用时间，便于问题追溯；</li>
<li><strong>HttpClient 复用</strong>：通过<code>IHttpClientFactory</code>创建实例，避免频繁创建导致的端口耗尽问题。</li>
</ol>
<h2 data-id="heading-11">六、总结与延伸</h2>
<p>本文围绕 c# 短信验证码 API 示例代码展开，从开发者常见痛点切入，拆解了 POST 请求的构建原理，提供了<code>HttpWebRequest</code>和<code>HttpClient</code>两种实现方案，并对比了不同封装方式的优劣。</p>
<p>开发者在使用 C# 调用短信验证码 API 时，核心是保证请求头配置正确、参数编码规范、响应解析完整。后续可进阶学习：接口调用的重试机制（针对网络超时）、批量发送实现、动态密码生成与校验等内容。掌握本文的示例代码和技巧，能有效降低接口调用失败率，保障验证码功能的稳定运行。</p>
<h3 data-id="heading-12">总结</h3>
<ol>
<li>c# 短信验证码 API 示例代码的核心是正确配置<code>Content-Type</code>请求头，并对所有参数做 UTF-8 编码；</li>
<li><code>HttpWebRequest</code>兼容性好，<code>HttpClient</code>更简洁，需根据项目框架选择合适的请求方式；</li>
<li>调用前校验参数、调用后精细化处理错误码，是提升接口稳定性的关键。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React useLayoutEffect 完全指南]]></title>    <link>https://juejin.cn/post/7599640782569947163</link>    <guid>https://juejin.cn/post/7599640782569947163</guid>    <pubDate>2026-01-27T06:49:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599640782569947163" data-draft-id="7599630795804262446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React useLayoutEffect 完全指南"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-27T06:49:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="biggerdong"/> <meta itemprop="url" content="https://juejin.cn/user/782508007891192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React useLayoutEffect 完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007891192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    biggerdong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:49:30.000Z" title="Tue Jan 27 2026 06:49:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React <code>useLayoutEffect</code> 完全指南</h2>
<h3 data-id="heading-1">一、核心定义与执行时机</h3>
<p><code>useLayoutEffect</code> 是 React 提供的用于处理<strong>DOM 相关同步操作</strong>的 Hook，其执行时机具有严格的顺序性，且是<strong>同步阻塞</strong>的（会阻塞浏览器绘制，直到回调函数执行完毕）。</p>
<p>单次组件更新周期的执行顺序：</p>
<p><code>组件 render 生成新 DOM</code> → <code>useLayoutEffect 回调同步执行</code> → <code>浏览器绘制页面</code> → <code>useEffect 回调异步执行</code></p>
<h3 data-id="heading-2">二、核心使用场景：解决 DOM 闪烁/抖动问题</h3>
<p><code>useLayoutEffect</code> 的核心价值在于<strong>处理需要依赖更新后 DOM 信息，且需要同步修改 DOM 以避免页面闪烁/抖动的场景</strong>，常见场景包括：</p>
<ol>
<li>
<p>同步读取并修改 DOM 样式（如获取元素宽高后，立即调整其位置、尺寸）；</p>
</li>
<li>
<p>计算 DOM 元素的布局信息（如滚动位置、偏移量）并同步更新组件状态；</p>
</li>
<li>
<p>实现无闪烁的 DOM 操作（避免 <code>useEffect</code> 异步执行导致的"先渲染错误样式，再修正"的闪烁问题）。</p>
</li>
</ol>
<h4 data-id="heading-3">代码示例：避免 DOM 位置闪烁</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">import</span> { useState, useLayoutEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LayoutEffectDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [show, setShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> boxRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (show &amp;&amp; boxRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> { height } = boxRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
      boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateY(<span class="hljs-subst">${height + <span class="hljs-number">10</span>}</span>px)`</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (boxRef.<span class="hljs-property">current</span>) {
      boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">'translateY(0)'</span>;
    }
  }, [show]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShow(!show)}&gt;切换显示/隐藏<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {show &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{boxRef}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">height:</span> '<span class="hljs-attr">100px</span>', 
            <span class="hljs-attr">background:</span> '<span class="hljs-attr">blue</span>', 
            <span class="hljs-attr">transition:</span> '<span class="hljs-attr">transform</span> <span class="hljs-attr">0.3s</span> <span class="hljs-attr">ease</span>' 
          }}
        &gt;</span>
          测试 useLayoutEffect 无闪烁布局
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">LayoutEffectDemo</span>;
</code></pre>
<h3 data-id="heading-4">三、与 <code>useEffect</code> 的核心区别</h3>







































<table><thead><tr><th>特性</th><th>useLayoutEffect</th><th>useEffect</th></tr></thead><tbody><tr><td>执行时机</td><td>DOM 更新后、浏览器绘制前（同步）</td><td>浏览器绘制完成后（异步）</td></tr><tr><td>阻塞特性</td><td>阻塞浏览器绘制，同步执行</td><td>不阻塞浏览器绘制，异步执行（不阻塞主线程）</td></tr><tr><td>适用场景</td><td>DOM 布局相关同步操作（避免闪烁）</td><td>数据请求、订阅/取消订阅、非 DOM 相关副作用</td></tr><tr><td>执行优先级</td><td>更高（早于 useEffect）</td><td>更低（晚于 useLayoutEffect）</td></tr><tr><td>对用户体验的影响</td><td>执行耗时过长会导致页面卡顿（阻塞绘制）</td><td>几乎不影响页面渲染流畅度</td></tr><tr><td><strong>关键补充</strong>：若副作用不依赖 DOM 信息，优先使用 <code>useEffect</code>，避免不必要的阻塞，保证页面渲染性能。</td><td/></tr></tbody></table>
<h3 data-id="heading-5">四、DOM 更新后绘制前能否获取元素大小和位置</h3>
<p><strong>可以的</strong>。</p>
<ol>
<li>
<p>DOM 更新完成意味着内存中的 DOM 树已经修改完毕，元素的结构、属性、样式都已确定，其大小和位置等布局信息是 DOM 节点的固有属性，无需等待浏览器绘制即可读取。</p>
</li>
<li>
<p><code>useLayoutEffect</code> 正好在这个时机执行，通过 <code>getBoundingClientRect()</code>、<code>offsetWidth</code>、<code>offsetTop</code> 等 API 能获取到准确的元素布局信息。</p>
</li>
</ol>
<h4 data-id="heading-6">代码验证：读取元素布局信息</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-keyword">import</span> { useState, useLayoutEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">GetElementLayoutDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isShow, setIsShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> elementRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (isShow &amp;&amp; elementRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> rect = elementRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素大小和位置（绘制前）：'</span>, {
        宽度: rect.<span class="hljs-property">width</span>,
        高度: rect.<span class="hljs-property">height</span>,
        距离视口顶部: rect.<span class="hljs-property">top</span>,
        距离视口左侧: rect.<span class="hljs-property">left</span>
      });

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'元素偏移宽高：'</span>, {
        <span class="hljs-attr">offsetWidth</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetWidth</span>,
        <span class="hljs-attr">offsetHeight</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetHeight</span>,
        <span class="hljs-attr">offsetTop</span>: elementRef.<span class="hljs-property">current</span>.<span class="hljs-property">offsetTop</span>
      });
    }
  }, [isShow]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">20</span> }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsShow(!isShow)}&gt;
        {isShow ? '隐藏元素' : '显示元素并读取布局'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {isShow &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{elementRef}</span>
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
            <span class="hljs-attr">width:</span> <span class="hljs-attr">300</span>,
            <span class="hljs-attr">height:</span> <span class="hljs-attr">200</span>,
            <span class="hljs-attr">background:</span> '<span class="hljs-attr">green</span>',
            <span class="hljs-attr">margin:</span> <span class="hljs-attr">10</span>,
            <span class="hljs-attr">position:</span> '<span class="hljs-attr">relative</span>',
            <span class="hljs-attr">top:</span> <span class="hljs-attr">20</span>
          }}
        &gt;</span>
          测试布局读取的元素
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GetElementLayoutDemo</span>;
</code></pre>
<h3 data-id="heading-7">五、<code>useLayoutEffect</code> 如何感知执行时机</h3>
<p><code>useLayoutEffect</code> 不是自身“主动知道”时机，而是 <strong>React 内部更新调度机制将其精准嵌入到 DOM 操作和浏览器绘制之间的固定流程</strong>，底层依赖浏览器的渲染流水线和任务队列机制。</p>
<h4 data-id="heading-8">1. React 组件更新的核心流程</h4>
<ol>
<li>
<p><strong>触发更新</strong>：<code>state</code>/<code>props</code> 变化触发组件重新渲染；</p>
</li>
<li>
<p><strong>虚拟 DOM 对比</strong>：通过 Diff 算法计算真实 DOM 的最小修改操作；</p>
</li>
<li>
<p><strong>执行 DOM 操作</strong>：React 提交阶段，将 DOM 修改同步应用到真实 DOM 树（内存中 DOM 已更新，未绘制）；</p>
</li>
<li>
<p><strong>执行</strong> <strong><code>useLayoutEffect</code></strong> <strong>回调</strong>：React 内置步骤，DOM 变更后立即同步调用回调；</p>
</li>
<li>
<p><strong>释放主线程</strong>：<code>useLayoutEffect</code> 执行完毕，浏览器获得主线程控制权；</p>
</li>
<li>
<p><strong>浏览器绘制</strong>：执行绘制流程，将 DOM 渲染到屏幕；</p>
</li>
<li>
<p><strong>执行</strong> <strong><code>useEffect</code></strong> <strong>回调</strong>：浏览器绘制完成后，主线程空闲时异步执行。</p>
</li>
</ol>
<h4 data-id="heading-9">2. 浏览器底层机制支撑</h4>
<ul>
<li>
<p><strong>渲染流水线顺序</strong>：浏览器处理 DOM 遵循 <code>解析 HTML → 构建 DOM 树 → 构建 CSSOM 树 → 生成布局树 → 绘制 → 合成</code> 的固定步骤，前一步完成才能进入后一步；</p>
</li>
<li>
<p><strong>任务优先级</strong>：<code>useLayoutEffect</code> 是主线程的同步任务，优先级高于浏览器绘制的宏任务，因此会阻塞绘制，直到自身执行完毕。</p>
</li>
</ul>
<h3 data-id="heading-10">六、<code>useLayoutEffect</code> 回调执行是否阻塞绘制</h3>
<p><strong>会阻塞</strong>，这是其核心特性之一，阻塞的本质是<strong>浏览器单线程模型 + 同步执行特性</strong>。</p>
<ol>
<li>
<p>浏览器主线程同一时间只能执行一个任务，<code>useLayoutEffect</code> 回调是同步执行的，会独占主线程；</p>
</li>
<li>
<p>浏览器的绘制任务会被搁置在任务队列，必须等 <code>useLayoutEffect</code> 回调执行完毕、主线程释放后才能启动；</p>
</li>
<li>
<p>若回调内包含耗时操作，会导致页面卡顿、渲染延迟。</p>
</li>
</ol>
<h4 data-id="heading-11">错误示例：耗时操作导致阻塞</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (boxRef.<span class="hljs-property">current</span>) {
    <span class="hljs-comment">// 大量同步循环，阻塞绘制很久</span>
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000000</span>; i++) {
      total += i;
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(total);
    boxRef.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">'100px'</span>;
  }
}, []);
</code></pre>
<h3 data-id="heading-12">七、DOM 变更后绘制被阻塞的场景</h3>
<p>浏览器绘制被阻塞的核心原因是：<strong>主线程被未完成的同步任务占用，无法执行绘制操作</strong>，分为两类场景：</p>
<h4 data-id="heading-13">1. React 框架层面</h4>
<p><code>useLayoutEffect</code> 回调的同步执行是最典型场景，React 刻意设计该机制，以实现无闪烁的 DOM 调整。</p>
<h4 data-id="heading-14">2. 浏览器原生层面</h4>
<p>脱离 React 时，DOM 变更后主线程存在未完成的同步任务，也会阻塞绘制：</p>
<ul>
<li>
<p><strong>DOM 变更后立即执行耗时同步代码</strong>：如大量循环计算、复杂 DOM 遍历；</p>
</li>
<li>
<p><strong>强制同步布局</strong>：循环中交替读取和修改 DOM 布局属性（如 <code>offsetWidth</code> + <code>style.width</code>），导致浏览器反复计算布局。</p>
</li>
</ul>
<h4 data-id="heading-15">原生场景阻塞示例</h4>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// 1. DOM 变更</span>
<span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
div.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">'100px'</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div);

<span class="hljs-comment">// 2. 同步耗时任务阻塞绘制</span>
<span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000000</span>; i++) {
  total += i;
}
<span class="hljs-comment">// 循环结束后才会绘制 div</span>
</code></pre>
<h3 data-id="heading-16">八、<code>useLayoutEffect</code> 性能优化清单</h3>
<h4 data-id="heading-17">1. 核心使用原则：能不用就不用</h4>
<ul>
<li>
<p>**优先用 ** <strong><code>useEffect</code></strong>：仅在需要同步处理 DOM 布局、避免闪烁时使用；</p>
</li>
<li>
<p><strong>严格控制依赖项</strong>：用精准的 DOM 相关状态作为依赖，避免频繁触发。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 依赖宽泛</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* DOM 操作 */</span> }, [props, state]);
<span class="hljs-comment">// ✅ 依赖精准</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">/* DOM 操作 */</span> }, [state.<span class="hljs-property">showElement</span>]);
</code></pre>
</li>
</ul>
<h4 data-id="heading-18">2. 代码优化：最小化回调执行时间</h4>
<ul>
<li>
<p><strong>移除非 DOM 相关逻辑</strong>：耗时计算、数据处理等移到 <code>useMemo</code>/<code>useEffect</code> 或组件外部。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 耗时计算阻塞绘制</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> total = <span class="hljs-title function_">heavyCalculation</span>();
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${rect.top + total}</span>px`</span>;
}, []);

<span class="hljs-comment">// ✅ 提前计算</span>
<span class="hljs-keyword">const</span> total = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">heavyCalculation</span>(), []);
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  ref.<span class="hljs-property">current</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">`<span class="hljs-subst">${rect.top + total}</span>px`</span>;
}, [total]);
</code></pre>
</li>
<li>
<p><strong>批量执行 DOM 操作</strong>：遵循 <strong>先读后写</strong> 原则，避免频繁触发重排。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 频繁读写触发多次重排</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> list = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>);
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${item.offsetWidth + <span class="hljs-number">10</span>}</span>px`</span>;
  });
}, []);

<span class="hljs-comment">// ✅ 先读后写，批量修改</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> list = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'li'</span>);
  <span class="hljs-keyword">const</span> widths = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(list).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">offsetWidth</span>);
  list.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
    item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">`<span class="hljs-subst">${widths[index] + <span class="hljs-number">10</span>}</span>px`</span>;
  });
}, []);
</code></pre>
</li>
<li>
<p><strong>避免强制同步布局</strong>：禁止循环中交替读写 DOM 布局属性。</p>
</li>
</ul>
<h4 data-id="heading-19">3. 避坑技巧：特殊场景处理</h4>
<ul>
<li>
<p><strong>SSR 兼容</strong>：加环境判断，避免服务端执行 DOM 操作。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> === <span class="hljs-string">'undefined'</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-comment">// 客户端 DOM 操作逻辑</span>
}, []);
</code></pre>
</li>
<li>
<p><strong>合并状态更新</strong>：避免在回调内多次 <code>setState</code>，减少额外 DOM 计算。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-comment">// ❌ 多次 setState</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setWidth</span>(rect.<span class="hljs-property">width</span>);
  <span class="hljs-title function_">setHeight</span>(rect.<span class="hljs-property">height</span>);
}, []);

<span class="hljs-comment">// ✅ 合并更新</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = ref.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-title function_">setLayout</span>({ <span class="hljs-attr">width</span>: rect.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>: rect.<span class="hljs-property">height</span> });
}, []);
</code></pre>
</li>
<li>
<p><strong>长耗时逻辑延迟执行</strong>：无法避免的耗时操作，用 <code>requestAnimationFrame</code> 延迟（注意会失去无闪烁效果）。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">heavyDomOperation</span>();
  });
}, []);
</code></pre>
</li>
</ul>
<h4 data-id="heading-20">4. 性能检测：验证优化效果</h4>
<ul>
<li>
<p><strong>Chrome DevTools Performance 面板</strong>：录制组件更新过程，查看 <code>useLayoutEffect</code> 任务耗时，超过 16ms（60fps 标准）需优化；</p>
</li>
<li>
<p><strong>低性能设备测试</strong>：验证是否存在卡顿问题。</p>
</li>
</ul>
<hr/>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills]]></title>    <link>https://juejin.cn/post/7599641289887055918</link>    <guid>https://juejin.cn/post/7599641289887055918</guid>    <pubDate>2026-01-27T06:58:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599641289887055918" data-draft-id="7599101854644715530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills"/> <meta itemprop="keywords" content="前端,Agent"/> <meta itemprop="datePublished" content="2026-01-27T06:58:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="去伪存真"/> <meta itemprop="url" content="https://juejin.cn/user/598569647873805"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            分享前端项目常用的三个Skills--Vue、React 与 UI 核心 Skills
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/598569647873805/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    去伪存真
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:58:54.000Z" title="Tue Jan 27 2026 06:58:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在过去的几年里，前端开发经历了从手写每一行 HTML/CSS 或使用组件库（Ant Design, Element Plus），到 AI 辅助编程（GitHub Copilot, Cursor）的巨大跨越。然而，2025 年以来的技术浪潮正将我们推向一个新的阶段：从 “AI 辅助” 向 “AI Agent（智能体)” 转型。</p>
<p>在这种模式下，开发者不再只是接收代码建议，而是为 AI 提供一系列“技能包（Skills）”，让 AI 能够理解复杂的框架逻辑、项目结构乃至视觉审美。</p>
<p>什么是Skills? 用一句话概括就是： <strong>Skills = 领域专业知识 + 你的项目偏好 + 严厉的审查官。</strong></p>
<h3 data-id="heading-1">1. 为什么需要 Skills？</h3>
<p>在 AI 编程的语境下，Skills 的出现是为了解决大模型（LLM）“博而不精”的天然缺陷。</p>
<p><strong>1.1 通才 AI：知识的“图书馆”</strong></p>
<p>一个没有安装 Skills 的大模型（如 GPT-5 或 Claude 4.5）就像一个<strong>读过全世界所有代码的毕业生</strong>：</p>
<ul>
<li>广度惊人：它知道几百种编程语言，甚至能背出 2014 年的过时语法。</li>
<li>深度断层：它不知道你公司内部的封装规范，不知道你的组件命名习惯，更不知道你项目中那个“不能动的老 Bug”。</li>
<li>执行模糊：给它一个需求，它会从 100 种可能的解法中随机选一个给你，不管这是否符合你现在的工程环境。</li>
</ul>
<p><strong>1.2 专才 AI：自带“十年工龄”的骨干</strong></p>
<p>安装了 Skills 的 AI（Agent），则完成了从“大模型”到**“领域智能体”**的进化：</p>
<p>安装了 Skills 之后， 它不再是那个满嘴跑火车的机器人，而是一个被你强制要求“必须按这套规约写代码”的资深开发。</p>






























<table><thead><tr><th><strong>特性</strong></th><th><strong>通才 AI (Generalist)</strong></th><th><strong>专才 AI (Specialist with Skills)</strong></th></tr></thead><tbody><tr><td><strong>思维边界</strong></td><td>无边界，容易产生幻觉</td><td><strong>有界思维</strong>：严格锁定在当前技术栈内</td></tr><tr><td><strong>项目理解</strong></td><td>盲人摸象，只看当前文件</td><td><strong>全局视野</strong>：理解路由、状态管理、样式体系</td></tr><tr><td><strong>输出质量</strong></td><td>“大概能跑”的代码</td><td>**“符合工程直觉”**的生产级代码</td></tr><tr><td><strong>角色定位</strong></td><td>知识检索器</td><td><strong>虚拟技术负责人 (Virtual Lead)</strong></td></tr></tbody></table>
<h3 data-id="heading-2">2. Skills 里面到底装了什么</h3>
<p>一个 Skills 文件夹里通常不是深奥的代码，而是三样东西：</p>
<ol>
<li><strong>规约（Rules）</strong> ：一堆告诉 AI “准许做什么”和“严禁做什么”的指令（通常是 <code>.cursorrules</code> 或 <code>.md</code> 文件）。</li>
<li><strong>上下文（Context）</strong> ：你项目的特殊结构。比如你的路由写在哪里，你的接口是怎么封装的。</li>
<li><strong>工具（Tools）</strong> ：一些自动化的小脚本。比如 AI 写完代码后，自动运行一下 <code>npm lint</code> 检查有没有写错。</li>
</ol>
<p>如果说通才 AI 提供的是“概率” （它觉得这段代码看起来像对的），那么 Skills 提供的就是“确定性”。它把行业内顶尖架构师的经验，封装成了 AI 触手可及的“条件反射”。</p>
<p>本文将分享前端高频使用的三个核心技能包：<code>vue-skills</code>、<code>react-skills</code>（agent-skills）以及 <code>ui-skills</code>（uipro-cli），剖析它们如何通过标准化的指令集，彻底改变我们的开发流。</p>
<h2 data-id="heading-3">Vue-Skills</h2>
<p>Vue-Skills涵盖了 <strong>Vue 3 项目的最佳实践、TypeScript 类型安全增强、IDE 性能优化以及现代 Vue 编码模式</strong>。它们旨在解决大型 Vue 项目中常见的开发痛点，如 IDE 卡顿、类型推断错误、构建配置以及代码可维护性问题。</p>
<h3 data-id="heading-4">1.1 核心规则</h3>
<p>可以将这些规则概括为以下 5 个主要方面：</p>
<h4 data-id="heading-5">1. 开发体验与 IDE 性能优化 (IDE &amp; Performance)</h4>
<p>关注如何解决大型项目中 VSCode 和 Volar 插件的性能问题。</p>
<ul>
<li>
<p><strong>codeactions-save-performance.md</strong>: 解决在大型 Vue 项目中保存文件时耗时过长（30秒+）的问题，建议禁用或限制耗时的 Code Actions。</p>
</li>
<li>
<p><strong>volar-3-breaking-changes.md</strong>: 针对 Volar 升级带来的变更进行适配，确保插件功能正常。</p>
</li>
<li>
<p><strong>vue-directive-comments.md</strong>: 介绍了@vue-ignore, @vue-skip,@vue-expect-error等指令注释，用于在模版中精细控制类型检查行为（类似 @ts-ignore）。</p>
</li>
</ul>
<h4 data-id="heading-6">2. TypeScript 类型安全与配置 (Type Safety &amp; Configuration)</h4>
<p>致力于提升 Vue 模版和组件的类型检查严格度，减少运行时错误。</p>
<ul>
<li>
<p><strong>vue-tsc-strict-templates.md</strong>: 推荐开启 strictTemplates，在编译时捕获模版中未定义的组件和属性错误。</p>
</li>
<li>
<p><strong>vue-router-typed-params.md</strong>: 解决unplugin-vue-router,导致的路由参数类型丢失问题（Property does not exist），推荐更严格的路由参数类型定义。</p>
</li>
<li>
<p><strong>data-attributes-config.md</strong>: 配置 vueCompilerOptions 以支持 <code>data-*</code>属性的类型检查，避免误报类型错误。</p>
</li>
<li>
<p>** module-resolution-bundler.md**: 推荐在 tsconfig.json 设置 "moduleResolution": "bundler"
以适配现代构建工具。</p>
</li>
<li>
<p><strong>with-defaults-union-types.md</strong>: 修复在defineProps中使用联合类型（如 string | false）配合withDefaults 时的虚假警告问题。</p>
</li>
</ul>
<h4 data-id="heading-7">3. Vue 3 现代编码模式 (Modern Patterns)</h4>
<p>推广 Vue 3.4+ 的新特性及更优雅的代码组织方式。</p>
<ul>
<li>
<p><strong>define-model-update-event.md</strong>: 推荐使用 Vue 3.4 的 defineModel()宏，替代手写的props+ emit('update:modelValue')模式。</p>
</li>
<li>
<p><strong>extract-component-props.md</strong>: 建议将复杂的defineProps类型提取为独立的 TS 接口，提高代码可读性和复用性。</p>
</li>
<li>
<p><strong>script-setup-jsdoc.md</strong>: 规范 <code>&lt;script setup&gt;</code>中的 JSDoc 使用，增强组件文档和类型提示。</p>
</li>
<li>
<p><strong>fallthrough-attributes.md</strong>: 关于 inheritAttrs: false和透传属性（Attributes Fallthrough）的最佳实践。</p>
</li>
</ul>
<h4 data-id="heading-8">4. 运行时陷阱与调试 (Runtime Caveats &amp; Debugging)</h4>
<p>解决特定场景下的怪异 bug 和运行时问题。</p>
<ul>
<li>
<p><strong>deep-watch-numeric.md</strong>: 警告在侦听（watch）数字数组时使用 deep: true的陷阱（新旧值相同），建议使用深拷贝。</p>
</li>
<li>
<p><strong>duplicate-plugin-detection.md</strong>: 防止 Vue 插件（如 Pinia）在微前端或特定环境下被重复注册。</p>
</li>
<li>
<p><strong>hmr-vue-ssr.md</strong>: 处理服务端渲染（SSR）场景下的热更新（HMR）问题。</p>
</li>
</ul>
<h4 data-id="heading-9">5. 测试与样式 (Testing &amp; Styling)</h4>
<ul>
<li><strong>pinia-store-mocking.md</strong>: 关于如何在测试中正确 Mock Pinia Store 的指南。</li>
<li><strong>strict-css-modules.md</strong>: 开启 CSS Modules 的严格模式，防止使用未定义的 class 名。</li>
</ul>
<h3 data-id="heading-10">1.2 安装方法</h3>
<p>通过简单的命令，你可以将此技能植入到你的 AI 工作流中：</p>
<pre><code class="hljs language-bash" lang="bash">npx add-skill hyf0/vue-skills
</code></pre>
<p>执行上面的指令后，会自动检查IDE，终端环境
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54d89fdfc8844faaa8355dbecc3af4fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=2XQmZAzLotvgqD9wD8ci5esFnhY%3D" alt="image.png" loading="lazy"/></p>
<p>选择安装在当前项目，还是对所有项目生效
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a9b017737fa46b9adf14322b61ae377~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=RB4w1EXGDb5UoGsbD1IEi0Bd2PA%3D" alt="image.png" loading="lazy"/></p>
<p>选择下载一份每个项目建立软链接，还是将规则文件复制在每个项目下
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ceb2f4be28477d9ffb4b77996dc2f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=72PsEinu3q%2FXjy0rsg2vYjLBWvQ%3D" alt="image.png" loading="lazy"/></p>
<p>安装完成之后的显示
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0110b7f9f2584504b356e61cf3c54eeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=OCDwpuJ3hg77B8NDvjdC2l4wwm8%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">1.3 实战案例</h3>
<p>案例展示了当 AI Agent 加载了 <code>vue-best-practices</code> 技能包后，如何通过 <strong>“提取组件属性 (Extract Component Props)”</strong> 规则，优雅地解决二次封装组件时的类型继承问题。</p>
<p>场景描述：我们正在基于一个第三方库的 <code>BaseButton.vue</code> 组件，封装一个我们项目专用的 <code>ProButton.vue</code>。我们需要让 <code>ProButton</code> 继承 <code>BaseButton</code> 的所有属性（Props），同时增加一个自定义属性 <code>loading</code>。</p>
<h4 data-id="heading-12">1. 优化前：常规“盲写”模式</h4>
<p><strong>现象</strong>：如果没有技能包指导，开发者往往会手动重复定义属性，或者使用不推荐的 Vue 内部实例类型。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ProButton.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// ❌ 错误做法 1：手动重复定义，维护成本极高</span>
interface <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">text</span>: string;
  color?: string;
  <span class="hljs-attr">loading</span>: boolean; <span class="hljs-comment">// 自定义属性</span>
}

<span class="hljs-comment">// ❌ 错误做法 2：使用 InstanceType，会包含大量的 Vue 内部属性，干扰类型提示</span>
<span class="hljs-keyword">import</span> type <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./BaseButton.vue"</span>;
type <span class="hljs-title class_">BaseProps</span> = <span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">BaseButton</span>&gt;[<span class="hljs-string">"$props"</span>];

defineProps&lt;<span class="hljs-title class_">BaseProps</span> &amp; { <span class="hljs-attr">loading</span>: boolean }&gt;();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-13">2. 优化后：使用 <code>vue-component-type-helpers</code></h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><strong>规则名称</strong>：<code>extract-component-props.md</code></li>
<li><strong>核心逻辑</strong>：利用 <code>vue-component-type-helpers</code> 库精确提取组件定义的 Props，排除内部干扰项。</li>
</ul>
<p><strong>重构结果</strong>：代码简洁，类型提示完美，且具备 100% 的继承安全性。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ProButton.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">ComponentProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-component-type-helpers"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BaseButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./BaseButton.vue"</span>;

<span class="hljs-comment">// ✅ 符合最佳实践：精确提取子组件的 Props 类型</span>
type <span class="hljs-title class_">BaseButtonProps</span> = <span class="hljs-title class_">ComponentProps</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">BaseButton</span>&gt;;

<span class="hljs-comment">// 扩展基础组件的属性</span>
interface <span class="hljs-title class_">Props</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseButtonProps</span> {
  loading?: boolean;
  size?: <span class="hljs-string">"sm"</span> | <span class="hljs-string">"md"</span> | <span class="hljs-string">"lg"</span>;
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), {
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-string">"md"</span>,
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pro-button"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 将剩余属性透传给基础组件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">BaseButton</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BaseButton</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">3.核心价值总结</h4>






























<table><thead><tr><th align="left">维度</th><th align="left">传统方式</th><th align="left">Skills 方案 (Vue Best Practices)</th></tr></thead><tbody><tr><td align="left"><strong>开发效率</strong></td><td align="left">需要翻阅源码查找子组件 Props</td><td align="left"><strong>自动提取</strong>，AI 自动完成类型桥接</td></tr><tr><td align="left"><strong>类型提示</strong></td><td align="left">混杂大量 <code>$props</code> 内部属性，极难看清</td><td align="left"><strong>纯净提示</strong>，仅显示业务定义的属性</td></tr><tr><td align="left"><strong>维护性</strong></td><td align="left">子组件增加 Prop 后，包装组件需手动同步</td><td align="left"><strong>自动同步</strong>，类型定义随子组件动态更新</td></tr><tr><td align="left"><strong>代码洁癖</strong></td><td align="left">充满大量的 Hack 或冗余定义</td><td align="left"><strong>标准工程化</strong>，符合 Vue 3 官方推荐模式</td></tr></tbody></table>
<blockquote>
<p><strong>提示</strong>：安装技能包后，当你在写高阶组件（HOC）或二次封装组件时，AI 会自动识别场景并提示你使用 <code>vue-component-type-helpers</code> 进行类型提取，确保你的 TypeScript 链路在全项目保持强类型约束。</p>
</blockquote>
<h3 data-id="heading-15">2.1 核心功能</h3>
<h4 data-id="heading-16">1. React 组件组合模式 (<code>vercel-composition-patterns</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>组件重构</strong>：当核心组件因布尔属性（Boolean props）爆炸（如 <code>isLoading</code>, <code>isSmall</code> 等）而难以维护时。</li>
<li><strong>库级开发</strong>：构建需要高度灵活、可扩展 API 的企业级 UI 组件库。</li>
<li><strong>复杂交互设计</strong>：实现具有强父子联动逻辑的复合组件（如 Tabs, Select, Menu）。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>架构优先组合</strong>：严禁无限制叠加布尔属性，推崇使用 <strong>复合组件 (Compound Components)</strong> 和 Context 共享状态。</li>
<li><strong>接口解耦</strong>：Provider 集中管理状态逻辑，子组件仅通过约定的 Context 接口进行交互。</li>
<li><strong>显式变体 (Explicit Variants)</strong>：与其给一个组件加 10 个布尔值，不如创建明确命名的变体组件（如 <code>PrimaryButton</code>, <code>IconButton</code>）。</li>
<li><strong>组合优于配置</strong>：优先通过 <code>children</code> 进行 UI 拼装，而非通过庞大的配置对象或大量的 <code>renderX</code> Props。</li>
</ul>
<h4 data-id="heading-17">2. React &amp; Next.js 性能最佳实践 (<code>vercel-react-best-practices</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>性能调优</strong>：页面响应慢、首屏渲染 (LCP) 时间长或存在明显的交互延迟。</li>
<li><strong>现代 Web 构建</strong>：基于 Next.js App Router 架构的全栈开发。</li>
<li><strong>大规模数据处理</strong>：需要并行获取多个 API 数据且必须避免渲染阻塞的场景。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>消除瀑布流 (Waterfalls)</strong>：性能优化的 <strong>头等大事</strong>。强制要求并行化独立异步操作，并利用 <code>Suspense</code> 实现流式 (Streaming) 内容分发。</li>
<li><strong>打包体积压缩</strong>：<strong>禁用 Barrel Files (单一入口导出文件)</strong> 以保护 Tree-shaking；强制使用 <code>next/dynamic</code> 进行代码分割。</li>
<li><strong>服务端性能 (RSC)</strong>：利用 <code>React.cache()</code> 进行请求级数据去重，最小化传输至客户端的序列化数据量。</li>
<li><strong>重渲染控制</strong>：避免在 Effects 中处理同步状态，提倡使用派生状态 (Derived State)；利用 <code>startTransition</code> 处理非紧急更新。</li>
</ul>
<h4 data-id="heading-18">3. React Native &amp; Expo 移动开发指南 (<code>vercel-react-native-skills</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>移动端丝滑体验</strong>：针对 iOS 和 Android 优化长列表滑动和复杂手势动画。</li>
<li><strong>跨端性能消除</strong>：解决由于 JS 线程与 UI 线程通信延迟导致的性能瓶颈。</li>
<li><strong>原生功能集成</strong>：在 Expo 或原生环境中处理多媒体、字体和原生组件的高性能接入。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>列表性能 (最关键)</strong>：强制使用 <strong><code>FlashList</code></strong> 替代 <code>FlatList</code>；列表项必须经过 <code>memo</code> 处理以减少多余重绘。</li>
<li><strong>GPU 加速动画</strong>：动画属性仅限在 <code>transform</code> 和 <code>opacity</code> 上操作，确保逻辑在 UI 线程直接执行。</li>
<li><strong>原生 UI 适配</strong>：始终使用 <code>expo-image</code> 优化图片加载；优先使用 <code>Pressable</code> 替代 <code>TouchableOpacity</code> 以获得更好的响应响应。</li>
<li><strong>渲染规范</strong>：文本必须且只能包裹在 <code>Text</code> 组件内；禁止在条件渲染中使用 <code>&amp;&amp;</code>（防止在移动端渲染出数字 0）。</li>
</ul>
<h4 data-id="heading-19">4. Web 界面设计指南 (<code>web-design-guidelines</code>)</h4>
<p><strong>适用场景：</strong></p>
<ul>
<li><strong>UI/UX 审计</strong>：项目发布前检查 UI 间距、颜色 Token 和视觉输出的一致性。</li>
<li><strong>无障碍性 (A11y)</strong>：确保网站符合 Web 辅助功能标准，提升产品包容性。</li>
<li><strong>自动化 UI 审查</strong>：在 Code Review 阶段快速发现硬编码和非标准交互实现。</li>
</ul>
<p><strong>核心规则：</strong></p>
<ul>
<li><strong>动态合规检查</strong>：通过远程拉取最新的设计系统准则，确保证审视标准始终是最新的。</li>
<li><strong>无障碍强制约束</strong>：严格检查颜色对比度、ARIA 标签完整性以及键盘导航流程。</li>
<li><strong>高精度反馈</strong>：能够精确到代码行指出不符合设计系统规范（如未使用的 Design Tokens）的地方。</li>
</ul>
<h3 data-id="heading-20">2.2 安装方法</h3>
<pre><code class="hljs language-js" lang="js">npx add-skill vercel-labs/agent-skills
</code></pre>
<p>可以只选择安装其中的一个规则集，比如说vercel-react-best-practices
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b642e01d2784f469fa42af039c40601~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=M%2BIhEQ0htYTReU%2B6oPmg9%2Br%2FopM%3D" alt="image.png" loading="lazy"/></p>
<p>其余步骤，与Vue-Skills的问询问题一模一样，不再赘述。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d419c1dd89e44de8b81e3abbaf3a518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=tLq4fdyffP1TM%2BgNWK8tjT8WFDc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4c026931b5546c6bf29a0f980ca64e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=GiQ1PqDaVxOBqw28P3F%2F%2B1vTuuA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f7a51586e44504929eb2d674209133~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=DOZ1AJVrRz64vbAhQM6A3Sncb6M%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c345e0a17c034ee88a78ea3f5049bb8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y675Lyq5a2Y55yf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770101934&amp;x-signature=Dx63C5PuoXF4wAflLxL%2FwjAI5qY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-21">2.3 用法示例</h3>
<p>在一个 Next.js App Router 项目的个人中心页面中，我们需要同时获取用户信息、订单列表和优惠券信息。</p>
<h4 data-id="heading-22">1. 优化前：串行瀑布流 (Sequential Waterfall)</h4>
<p><strong>现象</strong>：如果没有技能包约束，AI 可能会写出标准的串行代码。这种方案下，总耗时是三个接口请求时间的累加（T1 + T2 + T3）。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ❌ 不符合最佳实践：串行阻塞</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 请求 1：获取用户信息</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>();

  <span class="hljs-comment">// 请求 2：依赖于 user.id，但在请求 1 完成前无法开始</span>
  <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchOrders</span>(user.<span class="hljs-property">id</span>);

  <span class="hljs-comment">// 请求 3：不依赖于前二者，却被白白阻塞</span>
  <span class="hljs-keyword">const</span> coupons = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchCoupons</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">OrderList</span> <span class="hljs-attr">orders</span>=<span class="hljs-string">{orders}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CouponList</span> <span class="hljs-attr">coupons</span>=<span class="hljs-string">{coupons}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<hr/>
<h4 data-id="heading-23">2. 优化后：并行获取 + 组件组合 (Parallel &amp; Composition)</h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><code>async-parallel</code>：识别出不互相关联的请求，并并行启动。</li>
<li><code>server-parallel-fetching</code>：利用服务器组件的组合特性，减少主线程阻塞。</li>
</ul>
<p><strong>重构结果</strong>：页面总耗时缩短为（T1 + Max(T2, T3)），且实现了流式分发。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ✅ 符合最佳实践：并行获取与解耦渲染</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ProfilePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. 同时启动互不关联的异步任务，不加 await</span>
  <span class="hljs-keyword">const</span> userPromise = <span class="hljs-title function_">fetchUser</span>();
  <span class="hljs-keyword">const</span> couponsPromise = <span class="hljs-title function_">fetchCoupons</span>(); <span class="hljs-comment">// 并行开始</span>

  <span class="hljs-comment">// 2. 仅等待必要的基础数据</span>
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> userPromise;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* 优先渲染用户信息 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span>

      {/* 3. 将耗时较长的“订单列表”逻辑下移至组件内部，并行获取 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">OrderDataLayer</span> <span class="hljs-attr">userId</span>=<span class="hljs-string">{user.id}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>

      {/* 4. 将预启动的“优惠券”Promise 传入组件 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Skeleton</span> /&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">CouponDataLayer</span> <span class="hljs-attr">promise</span>=<span class="hljs-string">{couponsPromise}</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 独立的异步数据层组件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">OrderDataLayer</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> orders = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchOrders</span>(userId); <span class="hljs-comment">// 并行进行的请求</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">OrderList</span> <span class="hljs-attr">orders</span>=<span class="hljs-string">{orders}</span> /&gt;</span></span>;
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CouponDataLayer</span>(<span class="hljs-params">{ promise }</span>) {
  <span class="hljs-keyword">const</span> coupons = <span class="hljs-keyword">await</span> promise; <span class="hljs-comment">// 使用外部传入的 Promise</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CouponList</span> <span class="hljs-attr">coupons</span>=<span class="hljs-string">{coupons}</span> /&gt;</span></span>;
}
</code></pre>
<hr/>
<h4 data-id="heading-24">3. 核心价值总结</h4>






























<table><thead><tr><th align="left">优化点</th><th align="left">传统方案</th><th align="left">Skills 方案 (Vercel Best Practices)</th></tr></thead><tbody><tr><td align="left"><strong>请求速度</strong></td><td align="left">累加耗时 (Waterfall)</td><td align="left"><strong>并发执行</strong>，耗时大幅度缩减</td></tr><tr><td align="left"><strong>用户感知</strong></td><td align="left">全黑屏等待，直到所有数据返回</td><td align="left"><strong>流式渲染 (Streaming)</strong>，局部内容先出</td></tr><tr><td align="left"><strong>代码结构</strong></td><td align="left">逻辑逻辑堆在主页面，难以复用</td><td align="left"><strong>原子化组件</strong>，数据获取逻辑与渲染高度内聚</td></tr><tr><td align="left"><strong>AI 表现</strong></td><td align="left">随机生成，依赖运气</td><td align="left"><strong>确定性重构</strong>，严格执行 Vercel 性能规约</td></tr></tbody></table>
<blockquote>
<p><strong>结论</strong>：通过注入 <code>vercel-react-best-practices</code> 技能，AI Agent 从一个简单的“代码生成器”转变为具备“性能自觉”的高级架构师。</p>
</blockquote>
<h2 data-id="heading-25">三、 UI-Skills</h2>
<p>如果说前两个工具解决了“逻辑”问题，那么 <code>uipro-cli</code> 及其关联的 <code>ui-skills</code> 则是为了解决“审美与交付”问题。 UI/UX Pro Max：赋能 AI Agent 的专业设计大脑。<code>uipro-cli</code> 是一个功能强大的命令行工具，专门用于为各种 AI 编程助手（如 Claude Code, Cursor, Windsurf, Antigravity 等）一键注入 <strong>UI/UX Pro Max</strong> 专家级技能。它让 AI 不仅能写代码，更能像资深设计师一样思考。</p>
<h3 data-id="heading-26">2.1 核心功能</h3>
<h4 data-id="heading-27">1. 多元化视觉风格 (67 种 UI 风格)</h4>
<p>UI/UX Pro Max 内置了 67 种最前沿的视觉设计风格，确保 AI 生成的界面告别“通用感”。</p>
<ul>
<li><strong>现代趋势</strong>：支持 Glassmorphism（玻璃拟态）、Claymorphism（粘土拟态）、Minimalism（极简主义）。</li>
<li><strong>特色风格</strong>：包括 Brutalism（新野兽派）、Neumorphism（新拟物化）、Bento Grid（便当网格）以及针对 AI 产品的 AI-Native UI 风格。</li>
</ul>
<h4 data-id="heading-28">2. 行业深度色彩与排版 (96 行业色板 + 57 字体配对)</h4>
<ul>
<li><strong>精准色板</strong>：提供 96 套针对特定行业（如 SaaS, 电商, 医疗, 金融金融, 美妆）优化的专业色板。</li>
<li><strong>字体艺术</strong>：内置 57 组精心挑选的字体组合，无缝集成 Google Fonts，从视觉底层提升产品质感。</li>
</ul>
<h4 data-id="heading-29">3. 跨平台技术栈适配 (13 种主流技术栈)</h4>
<p>支持从 Web 到移动端的 13 种主流技术架构，生成的代码即学即用。</p>
<ul>
<li><strong>Web 端</strong>：React, Next.js, Vue, Nuxt.js, Astro, Svelte, HTML+Tailwind, shadcn/ui。</li>
<li><strong>移动端</strong>：React Native, Flutter, SwiftUI, Jetpack Compose 等。</li>
</ul>
<h4 data-id="heading-30">4. 专家级 UX 准则与设计推理 (100+ 准则与推理规则)</h4>
<p>内置专业的设计逻辑，让 AI 具备“审美自觉”：</p>
<ul>
<li><strong>UX 指南</strong>：涵盖 99 条 UX 最佳实践、反模式规避和 A11y 无障碍规则。</li>
<li><strong>设计推理</strong>：拥有 100 条行业推理规则（例如：金融类应用严禁使用 AI 风格的紫粉渐变，以确保稳重感），自动进行交付前的 UI/UX 质量自检。</li>
</ul>
<h3 data-id="heading-31">2.2 安装方法</h3>
<p>通过 <code>uipro-cli</code>，你可以在几秒钟内完成技能初始化：</p>
<h4 data-id="heading-32">1. 全局安装工具</h4>
<pre><code class="hljs language-bash" lang="bash">npm install -g uipro-cli
</code></pre>
<h4 data-id="heading-33">2. 为指定编辑器初始化技能</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 为 Claude Code 初始化</span>
uipro init --ai claude

<span class="hljs-comment"># 为 Cursor 初始化</span>
uipro init --ai cursor

<span class="hljs-comment"># 为所有支持的 AI 助手同时初始化</span>
uipro init --ai all
</code></pre>
<h3 data-id="heading-34">3. 实战案例</h3>
<p>场景描述： 用户需要为一个 AI 内容创作平台设计一个<strong>数据看板（Dashboard）</strong>。用户希望界面现代、直观，并且符合当前流行的审美趋势。</p>
<h4 data-id="heading-35">1. 传统 AI 生成：平庸且缺乏设计感</h4>
<p><strong>现象</strong>：如果没有加载专业 UI 技能包，AI 通常只会根据组件库（如 shadcn/ui）的基础示例，堆砌出缺乏灵魂的列表和卡片。色调单一（通常只用蓝色或灰阶），布局死板。</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ❌ 传统 AI 的“直觉”：基础的 Grid 布局，没有任何样式特色</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid grid-cols-3 gap-4 p-4"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"总收入"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$12,000"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"活跃用户"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1,240"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Card</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"API 调用"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"45.2k"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"col-span-3"</span>&gt;</span>主要统计图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-36">2. UI/UX Pro Max 介入：具备“审美自觉”的设计</h4>
<p><strong>技能规则应用</strong>：</p>
<ul>
<li><strong>风格锁定</strong>：选择了 <strong>Bento Grid（便当网格）</strong> 布局。</li>
<li><strong>行业色板</strong>：套用了 <strong>SaaS 行业高阶调色盘</strong>。</li>
<li><strong>设计推理</strong>：AI 会自动添加微交互动画、圆角分层（Glassmorphism 效果）以及符合产品气质的字体排版。</li>
</ul>
<p><strong>重构指令</strong>：</p>
<blockquote>
<p>“使用 UI/UX Pro Max 技能，为我的 AI 创作平台设计一个 Bento Grid 风格的统计看板。色调选用‘高级钛金灰’配合‘赛博蓝’点缀，并要求包含毛玻璃质感。”</p>
</blockquote>
<p><strong>重构结果（语义描述与关键代码片段）</strong>：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ✅ 符合设计的组件 (自动生成的 Tailwind 样式)</span>

<span class="hljs-comment">// 使用了 Bento Grid 非对称网格布局</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BentoDashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">section</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-slate-950 p-8 min-h-screen font-sans text-slate-100"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-6"</span>&gt;</span>
        {/* 高度分层的毛玻璃卡片 (Glassmorphism) */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"md:col-span-2 md:row-span-2 bg-slate-900/50 backdrop-blur-xl border border-white/10 rounded-3xl p-8 
                        hover:bg-slate-800/60 transition-all duration-300 group"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex justify-between"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-xl font-bold tracking-tight"</span>&gt;</span>创作产出分析<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"h-2 w-2 bg-cyan-400 rounded-full animate-pulse"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
          {/* AI 自动推荐的图表配色与坐标轴样式 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">MainAnalyticChart</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#22d3ee"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 紧凑型统计卡片 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-slate-900/50 backdrop-blur-md rounded-3xl p-6 border border-white/5"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Subtitle</span>&gt;</span>API 余额<span class="hljs-tag">&lt;/<span class="hljs-name">Subtitle</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Value</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-3xl font-mono"</span>&gt;</span>84.2%<span class="hljs-tag">&lt;/<span class="hljs-name">Value</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 动态微交互元素 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-cyan-500/10 rounded-3xl p-6 border border-cyan-500/20 text-cyan-400"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-sm font-semibold mb-2"</span>&gt;</span>服务状态<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-lg"</span>&gt;</span>系统运行正常<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {/* 更多 Bento 网格单元... */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-37">3.核心价值总结</h4>






























<table><thead><tr><th align="left">维度</th><th align="left">传统构建</th><th align="left">UI/UX Pro Max (uipro)</th></tr></thead><tbody><tr><td align="left"><strong>布局逻辑</strong></td><td align="left">简单的 1/2 或 1/3 等分</td><td align="left"><strong>非对称动态布局</strong> (如 Bento Grid, Masonry)</td></tr><tr><td align="left"><strong>色彩应用</strong></td><td align="left">基础颜色（#3b82f6），视觉单调</td><td align="left"><strong>分层色彩系统</strong>，包含渐变、阴影与半透明层</td></tr><tr><td align="left"><strong>细节打磨</strong></td><td align="left">只有基础功能</td><td align="left"><strong>微交互、骨架屏、平滑过渡</strong>自动注入</td></tr><tr><td align="left"><strong>设计自检</strong></td><td align="left">需要人工多次反馈返工</td><td align="left"><strong>内置反模式自检</strong>，首次生成即达“可交付”标准</td></tr></tbody></table>
<h2 data-id="heading-38">结语：前端开发者的角色转变</h2>
<p>随着 <code>vue-skills</code>、<code>react-skills</code> 和 <code>ui-skills</code> 的普及，前端开发者的角色正在发生深刻变化。我们正在从 <strong>“代码编写者（Coder）”</strong> 转变为 <strong>“AI 指令师（Prompt Engineer）”</strong> 和 <strong>“技术评审员（Reviewer）”</strong> 。</p>
<p>传统的 AI 辅助仅仅是“搜索”的变种，而 <strong>Skills</strong> 模式代表了 <strong>“领域知识的预装载”</strong> 。</p>
<ol>
<li><strong>降低认知负荷</strong>：你不需要记住 Vue 3 的所有新特性或 Tailwind 的上千个类名，Skills 充当了你的“外部脑”。</li>
<li><strong>代码风格统一</strong>：团队只需约定一套 Skill 脚本，就能保证所有 AI 生成的代码风格高度一致，甚至比人类手动编写的更规范。</li>
<li><strong>快速原型到生产</strong>：它极大地缩短了从 MVP（最小可行性产品）到正式发布的时间，让前端开发者更关注于“业务价值”而非“语法实现”。</li>
</ol>
<p>掌握这些 Skills 并不意味着放弃底层的学习，相反，只有深刻理解 Vue/React 原理和 UI 规范的人，才能通过这些技能包更好地引导 AI，释放出前所未有的生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）]]></title>    <link>https://juejin.cn/post/7599845683121831976</link>    <guid>https://juejin.cn/post/7599845683121831976</guid>    <pubDate>2026-01-27T07:12:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599845683121831976" data-draft-id="7599852579066429455" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）"/> <meta itemprop="keywords" content="Java,后端"/> <meta itemprop="datePublished" content="2026-01-27T07:12:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员威哥"/> <meta itemprop="url" content="https://juejin.cn/user/3411107130652176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次封装，通用所有版本｜Java实现YOLOv5/v8/v11/v26统一调用（附通用适配框架）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411107130652176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员威哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:12:18.000Z" title="Tue Jan 27 2026 07:12:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、写在前面：为什么需要统一封装YOLO版本？</h2>
<p>在Java后端落地YOLO目标检测时，最头疼的问题莫过于版本适配：YOLOv5的输出维度是<code>[1,25200,85]</code>，v8/v11是<code>[1,84,8400]</code>，v26则支持无NMS架构且兼容v8的输出格式；预处理上v5需要BGR转RGB+归一化，v8还需LetterBox填充；后处理上v5依赖传统NMS，v26可直接置信度过滤……每次切换版本都要重写核心逻辑，重复造轮子的成本极高。</p>
<p>本文将打造一套<strong>通用YOLO调用框架</strong>，基于“抽象封装+版本适配”设计模式，把不同YOLO版本的差异点（输入输出、预处理/后处理、NMS逻辑）封装为可配置的适配层，上层提供统一调用接口，一次封装即可无缝切换v5/v8/v11/v26，无需修改核心代码。全程纯Java实现，无Python依赖，兼顾易用性与扩展性。</p>
<h2 data-id="heading-1">二、前置认知：核心逻辑与版本差异分析</h2>
<h3 data-id="heading-2">1. 核心设计思路</h3>
<p>采用“接口定义+抽象实现+版本特化”的分层架构：</p>
<ul>
<li>
<p>统一接口层：定义<code>YoloDetector</code>接口，包含<code>detectImage</code>/<code>detectVideo</code>等通用方法；</p>
</li>
<li>
<p>抽象基类层：实现所有版本共用的逻辑（模型加载、批量推理、通用预处理）；</p>
</li>
<li>
<p>版本适配层：针对v5/v8/v11/v26实现特化逻辑（输出解析、后处理、NMS/无NMS适配）；</p>
</li>
<li>
<p>配置层：通过枚举类配置不同版本的核心参数（输出维度、NMS开关、置信度阈值）。</p>
</li>
</ul>
<h3 data-id="heading-3">2. 各YOLO版本核心差异（关键适配点）</h3>





































<table><thead><tr><th>版本</th><th>输入尺寸</th><th>输出维度</th><th>后处理逻辑</th><th>NMS依赖</th><th>核心适配点</th></tr></thead><tbody><tr><td>YOLOv5</td><td>640×640</td><td>[1,25200,85]</td><td>传统NMS+坐标还原</td><td>是</td><td>输出维度解析、NMS参数适配</td></tr><tr><td>YOLOv8/v11</td><td>640×640</td><td>[1,84,8400]</td><td>NMS/轻量过滤</td><td>可选</td><td>动态批次适配、输出轴顺序调整</td></tr><tr><td>YOLOv26</td><td>640×640</td><td>[1,84,8400]</td><td>无NMS+置信度过滤</td><td>否</td><td>关闭NMS、置信度阈值调优</td></tr></tbody></table>
<h3 data-id="heading-4">3. 核心技术栈（版本已验证无冲突）</h3>
<ul>
<li>
<p>JavaCV：1.5.10（封装OpenCV/FFmpeg，统一图像处理）；</p>
</li>
<li>
<p>ONNX Runtime：1.16.0（支持动态批次，兼容所有YOLO ONNX模型）；</p>
</li>
<li>
<p>JDK：11（兼容8/17）、Maven 3.6+；</p>
</li>
<li>
<p>模型：各版本ONNX格式（文末附下载链接，均适配通用框架）。</p>
</li>
</ul>
<h2 data-id="heading-5">三、环境搭建：10分钟搞定依赖与模型</h2>
<h3 data-id="heading-6">1. Maven依赖引入（直接复制到pom.xml）</h3>
<p>核心依赖仅需4个，兼容所有YOLO版本的推理需求：</p>
<pre><code class="hljs language-XML" lang="XML">
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- JavaCV：统一图像处理/视频流提取 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.bytedeco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javacv-platform<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ONNX Runtime：统一推理引擎 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.microsoft.onnxruntime<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>onnxruntime<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.16.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- FastJson：统一结果解析 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Lombok：简化代码（可选） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>11<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<p>⚠️ 避坑提醒：JavaCV的<code>javacv-platform</code>会自动下载对应系统的原生库，网络差可手动下载（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmvnrepository.com%2Fartifact%2Forg.bytedeco%2Fjavacv-platform%2F1.5.10" target="_blank" title="https://mvnrepository.com/artifact/org.bytedeco/javacv-platform/1.5.10" ref="nofollow noopener noreferrer">mvnrepository.com/artifact/or…</a>）导入本地仓库。</p>
<h3 data-id="heading-7">2. 模型准备（5分钟搞定）</h3>
<ol>
<li>
<p>下载各版本适配模型：</p>
<ul>
<li>
<p>YOLOv5n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov5n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov5n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv8n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov8n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov8n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv11n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov11n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov11n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a></p>
</li>
<li>
<p>YOLOv26n.onnx：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxxx%2Fyolo-models%2Fraw%2Fmain%2Fyolov26n.onnx" target="_blank" title="https://gitee.com/xxx/yolo-models/raw/main/yolov26n.onnx" ref="nofollow noopener noreferrer">gitee.com/xxx/yolo-mo…</a>（无NMS版）；</p>
</li>
</ul>
</li>
<li>
<p>放置路径：所有模型放入<code>src/main/resources/models</code>目录；</p>
</li>
<li>
<p>验证模型：用Netron（<a href="https://link.juejin.cn?target=https%3A%2F%2Fnetron.app%2F" target="_blank" title="https://netron.app/" ref="nofollow noopener noreferrer">netron.app/</a>）打开，确认输入节点为<code>images</code>，输出维度与上表一致。</p>
</li>
</ol>
<h2 data-id="heading-8">四、核心实现：20分钟打造通用YOLO调用框架</h2>
<h3 data-id="heading-9">1. 项目结构（分层设计，清晰易扩展）</h3>
<pre><code class="hljs language-Plain" lang="Plain">
src
├── main
│   ├── java
│   │   └── com
│   │       └── yolo
│   │           ├── common          // 通用层
│   │           │   ├── YoloVersionEnum.java  // 版本枚举（核心配置）
│   │           │   ├── YoloConfig.java       // 全局配置
│   │           │   └── DetectionResult.java  // 统一结果实体
│   │           ├── detector        // 检测器层
│   │           │   ├── YoloDetector.java      // 统一接口
│   │           │   ├── AbstractYoloDetector.java  // 抽象基类
│   │           │   ├── YoloV5Detector.java    // v5适配实现
│   │           │   ├── YoloV8V11Detector.java // v8/v11适配实现
│   │           │   └── YoloV26Detector.java   // v26适配实现
│   │           ├── util            // 工具层
│   │           │   ├── ImageProcessUtil.java  // 通用图像处理
│   │           │   └── NmsUtil.java           // NMS工具（兼容各版本）
│   │           └── YoloUniversalTest.java     // 统一测试类
│   └── resources
│       └── models                 // 各版本模型
│           ├── yolov5n.onnx
│           ├── yolov8n.onnx
│           ├── yolov11n.onnx
│           └── yolov26n.onnx
└── pom.xml
</code></pre>
<h3 data-id="heading-10">2. 通用配置层（核心：版本枚举+统一配置）</h3>
<h4 data-id="heading-11">（1）版本枚举：YoloVersionEnum.java（集中管理版本差异）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * YOLO版本枚举：集中配置各版本核心参数，避免硬编码
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">YoloVersionEnum</span> {
    YOLOv5(<span class="hljs-string">"yolov5n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">25200</span>, <span class="hljs-number">85</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv8(<span class="hljs-string">"yolov8n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv11(<span class="hljs-string">"yolov11n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.25f</span>, <span class="hljs-number">0.45f</span>),
    YOLOv26(<span class="hljs-string">"yolov26n.onnx"</span>, <span class="hljs-number">640</span>, <span class="hljs-number">640</span>, <span class="hljs-number">8400</span>, <span class="hljs-number">84</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0.35f</span>, <span class="hljs-number">0.0f</span>); <span class="hljs-comment">// NMS阈值设0表示关闭</span>

    <span class="hljs-comment">// 模型文件名、输入尺寸、输出维度、NMS开关、置信度/NMS阈值</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String modelFileName;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> inputWidth;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> inputHeight;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> outputNumBoxes;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> outputNumParams;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> needLegacyNms; <span class="hljs-comment">// 是否需要v5传统NMS</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> confThreshold;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> nmsThreshold;

    YoloVersionEnum(String modelFileName, <span class="hljs-type">int</span> inputWidth, <span class="hljs-type">int</span> inputHeight,
                    <span class="hljs-type">int</span> outputNumBoxes, <span class="hljs-type">int</span> outputNumParams, <span class="hljs-type">boolean</span> needLegacyNms,
                    <span class="hljs-type">float</span> confThreshold, <span class="hljs-type">float</span> nmsThreshold) {
        <span class="hljs-built_in">this</span>.modelFileName = modelFileName;
        <span class="hljs-built_in">this</span>.inputWidth = inputWidth;
        <span class="hljs-built_in">this</span>.inputHeight = inputHeight;
        <span class="hljs-built_in">this</span>.outputNumBoxes = outputNumBoxes;
        <span class="hljs-built_in">this</span>.outputNumParams = outputNumParams;
        <span class="hljs-built_in">this</span>.needLegacyNms = needLegacyNms;
        <span class="hljs-built_in">this</span>.confThreshold = confThreshold;
        <span class="hljs-built_in">this</span>.nmsThreshold = nmsThreshold;
    }

    <span class="hljs-comment">// 获取模型完整路径</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getModelPath</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"models/"</span> + <span class="hljs-built_in">this</span>.modelFileName;
    }
}
</code></pre>
<h4 data-id="heading-12">（2）全局配置：YoloConfig.java（通用参数）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Scalar;

<span class="hljs-comment">/**
 * 全局配置：所有版本共用的参数
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloConfig</span> {
    <span class="hljs-comment">// COCO80类别名称（所有YOLO版本通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] CLASSES = {
        <span class="hljs-string">"person"</span>, <span class="hljs-string">"bicycle"</span>, <span class="hljs-string">"car"</span>, <span class="hljs-string">"motorcycle"</span>, <span class="hljs-string">"airplane"</span>, <span class="hljs-string">"bus"</span>, <span class="hljs-string">"train"</span>, <span class="hljs-string">"truck"</span>, <span class="hljs-string">"boat"</span>,
        <span class="hljs-string">"traffic light"</span>, <span class="hljs-string">"fire hydrant"</span>, <span class="hljs-string">"stop sign"</span>, <span class="hljs-string">"parking meter"</span>, <span class="hljs-string">"bench"</span>, <span class="hljs-string">"bird"</span>, <span class="hljs-string">"cat"</span>,
        <span class="hljs-string">"dog"</span>, <span class="hljs-string">"horse"</span>, <span class="hljs-string">"sheep"</span>, <span class="hljs-string">"cow"</span>, <span class="hljs-string">"elephant"</span>, <span class="hljs-string">"bear"</span>, <span class="hljs-string">"zebra"</span>, <span class="hljs-string">"giraffe"</span>, <span class="hljs-string">"backpack"</span>,
        <span class="hljs-string">"umbrella"</span>, <span class="hljs-string">"handbag"</span>, <span class="hljs-string">"tie"</span>, <span class="hljs-string">"suitcase"</span>, <span class="hljs-string">"frisbee"</span>, <span class="hljs-string">"skis"</span>, <span class="hljs-string">"snowboard"</span>, <span class="hljs-string">"sports ball"</span>,
        <span class="hljs-string">"kite"</span>, <span class="hljs-string">"baseball bat"</span>, <span class="hljs-string">"baseball glove"</span>, <span class="hljs-string">"skateboard"</span>, <span class="hljs-string">"surfboard"</span>, <span class="hljs-string">"tennis racket"</span>,
        <span class="hljs-string">"bottle"</span>, <span class="hljs-string">"wine glass"</span>, <span class="hljs-string">"cup"</span>, <span class="hljs-string">"fork"</span>, <span class="hljs-string">"knife"</span>, <span class="hljs-string">"spoon"</span>, <span class="hljs-string">"bowl"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"apple"</span>,
        <span class="hljs-string">"sandwich"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"broccoli"</span>, <span class="hljs-string">"carrot"</span>, <span class="hljs-string">"hot dog"</span>, <span class="hljs-string">"pizza"</span>, <span class="hljs-string">"donut"</span>, <span class="hljs-string">"cake"</span>, <span class="hljs-string">"chair"</span>,
        <span class="hljs-string">"couch"</span>, <span class="hljs-string">"potted plant"</span>, <span class="hljs-string">"bed"</span>, <span class="hljs-string">"dining table"</span>, <span class="hljs-string">"toilet"</span>, <span class="hljs-string">"tv"</span>, <span class="hljs-string">"laptop"</span>, <span class="hljs-string">"mouse"</span>,
        <span class="hljs-string">"remote"</span>, <span class="hljs-string">"keyboard"</span>, <span class="hljs-string">"cell phone"</span>, <span class="hljs-string">"microwave"</span>, <span class="hljs-string">"oven"</span>, <span class="hljs-string">"toaster"</span>, <span class="hljs-string">"sink"</span>, <span class="hljs-string">"refrigerator"</span>,
        <span class="hljs-string">"book"</span>, <span class="hljs-string">"clock"</span>, <span class="hljs-string">"vase"</span>, <span class="hljs-string">"scissors"</span>, <span class="hljs-string">"teddy bear"</span>, <span class="hljs-string">"hair drier"</span>, <span class="hljs-string">"toothbrush"</span>
    };

    <span class="hljs-comment">// 预测框颜色（所有版本通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Scalar[] COLORS;
    <span class="hljs-keyword">static</span> {
        COLORS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scalar</span>[CLASSES.length];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; CLASSES.length; i++) {
            COLORS[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scalar</span>((<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>), (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>), (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">255</span>));
        }
    }

    <span class="hljs-comment">// 批量推理大小（通用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
}
</code></pre>
<h4 data-id="heading-13">（3）统一结果实体：DetectionResult.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.common;

<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**
 * 统一检测结果实体：所有版本输出结果格式一致
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DetectionResult</span> {
    <span class="hljs-keyword">private</span> String className;    <span class="hljs-comment">// 类别名称</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> confidence;    <span class="hljs-comment">// 置信度</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> left;            <span class="hljs-comment">// 左上角x</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> top;             <span class="hljs-comment">// 左上角y</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> right;           <span class="hljs-comment">// 右下角x</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> bottom;          <span class="hljs-comment">// 右下角y</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> classIdx;        <span class="hljs-comment">// 类别索引</span>
}
</code></pre>
<h3 data-id="heading-14">3. 工具层（通用预处理+NMS）</h3>
<h4 data-id="heading-15">（1）通用图像处理：ImageProcessUtil.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.util;

<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Size;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_imgproc.Imgproc;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_core.*;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgproc.cvtColor;

<span class="hljs-comment">/**
 * 通用图像处理工具：所有YOLO版本共用的预处理逻辑
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageProcessUtil</span> {
    <span class="hljs-comment">/**
     * 通用预处理：LetterBox+转RGB+归一化+HWC→CHW
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span>[] preprocess(Mat srcImg, YoloVersionEnum version) {
        <span class="hljs-comment">// 1. LetterBox填充（保持宽高比，所有版本通用）</span>
        <span class="hljs-type">Mat</span> <span class="hljs-variable">resizedImg</span> <span class="hljs-operator">=</span> letterBox(srcImg, version.getInputWidth(), version.getInputHeight());
        <span class="hljs-comment">// 2. BGR转RGB（JavaCV默认BGR，所有YOLO版本要求RGB）</span>
        <span class="hljs-type">Mat</span> <span class="hljs-variable">rgbImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        cvtColor(resizedImg, rgbImg, Imgproc.COLOR_BGR2RGB);
        <span class="hljs-comment">// 3. 归一化：[0,255]→[0,1]</span>
        rgbImg.convertTo(rgbImg, CV_32F, <span class="hljs-number">1.0</span> / <span class="hljs-number">255.0</span>);
        <span class="hljs-comment">// 4. HWC→CHW（所有版本通用）</span>
        List&lt;Mat&gt; channels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        split(rgbImg, channels);
        <span class="hljs-type">float</span>[] inputData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getInputWidth() * version.getInputHeight() * <span class="hljs-number">3</span>];
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Mat channel : channels) {
            <span class="hljs-type">float</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[(<span class="hljs-type">int</span>) channel.total()];
            channel.get(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, data);
            System.arraycopy(data, <span class="hljs-number">0</span>, inputData, index, data.length);
            index += data.length;
        }
        <span class="hljs-comment">// 释放资源</span>
        resizedImg.release();
        rgbImg.release();
        channels.forEach(Mat::release);
        <span class="hljs-keyword">return</span> inputData;
    }

    <span class="hljs-comment">/**
     * LetterBox填充：所有版本通用
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Mat <span class="hljs-title function_">letterBox</span><span class="hljs-params">(Mat srcImg, <span class="hljs-type">int</span> targetW, <span class="hljs-type">int</span> targetH)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">scale</span> <span class="hljs-operator">=</span> Math.min((<span class="hljs-type">double</span>) targetW / srcImg.cols(), (<span class="hljs-type">double</span>) targetH / srcImg.rows());
        <span class="hljs-type">int</span> <span class="hljs-variable">newW</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (srcImg.cols() * scale);
        <span class="hljs-type">int</span> <span class="hljs-variable">newH</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (srcImg.rows() * scale);
        <span class="hljs-type">Mat</span> <span class="hljs-variable">resized</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        Imgproc.resize(srcImg, resized, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Size</span>(newW, newH));
        <span class="hljs-type">int</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> (targetH - newH) / <span class="hljs-number">2</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> targetH - newH - top;
        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> (targetW - newW) / <span class="hljs-number">2</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> targetW - newW - left;
        <span class="hljs-type">Mat</span> <span class="hljs-variable">letterBoxImg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mat</span>();
        copyMakeBorder(resized, letterBoxImg, top, bottom, left, right, BORDER_CONSTANT);
        resized.release();
        <span class="hljs-keyword">return</span> letterBoxImg;
    }

    <span class="hljs-comment">/**
     * 坐标还原：将模型输出的归一化坐标还原为原始图像坐标（所有版本通用）
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span>[] restoreCoord(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y, <span class="hljs-type">float</span> w, <span class="hljs-type">float</span> h,
                                       Mat srcImg, YoloVersionEnum version) {
        <span class="hljs-type">float</span> <span class="hljs-variable">scale</span> <span class="hljs-operator">=</span> Math.min((<span class="hljs-type">double</span>) version.getInputWidth() / srcImg.cols(),
                              (<span class="hljs-type">double</span>) version.getInputHeight() / srcImg.rows());
        <span class="hljs-type">float</span> <span class="hljs-variable">padW</span> <span class="hljs-operator">=</span> (version.getInputWidth() - srcImg.cols() * scale) / <span class="hljs-number">2</span>;
        <span class="hljs-type">float</span> <span class="hljs-variable">padH</span> <span class="hljs-operator">=</span> (version.getInputHeight() - srcImg.rows() * scale) / <span class="hljs-number">2</span>;

        <span class="hljs-type">float</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> (x - w / <span class="hljs-number">2</span> - padW) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">top</span> <span class="hljs-operator">=</span> (y - h / <span class="hljs-number">2</span> - padH) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> (x + w / <span class="hljs-number">2</span> - padW) / scale;
        <span class="hljs-type">float</span> <span class="hljs-variable">bottom</span> <span class="hljs-operator">=</span> (y + h / <span class="hljs-number">2</span> - padH) / scale;

        <span class="hljs-comment">// 边界校验</span>
        left = Math.max(<span class="hljs-number">0</span>, left);
        top = Math.max(<span class="hljs-number">0</span>, top);
        right = Math.min(srcImg.cols() - <span class="hljs-number">1</span>, right);
        bottom = Math.min(srcImg.rows() - <span class="hljs-number">1</span>, bottom);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[]{left, top, right, bottom};
    }
}
</code></pre>
<h4 data-id="heading-16">（2）通用NMS工具：NmsUtil.java（兼容v5传统NMS+v8轻量NMS）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.util;

<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * 通用NMS工具：适配v5传统NMS、v8轻量NMS、v26无NMS
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NmsUtil</span> {
    <span class="hljs-comment">/**
     * 通用NMS入口：根据版本自动选择NMS逻辑
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">applyNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections,
                                                 <span class="hljs-type">float</span> nmsThreshold, <span class="hljs-type">boolean</span> isLegacyNms)</span> {
        <span class="hljs-keyword">if</span> (nmsThreshold &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> detections; <span class="hljs-comment">// v26无NMS，直接返回</span>
        }
        <span class="hljs-keyword">return</span> isLegacyNms ? legacyNms(detections, nmsThreshold) : lightweightNms(detections, nmsThreshold);
    }

    <span class="hljs-comment">/**
     * v5传统NMS：按类别分组后执行NMS
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">legacyNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections, <span class="hljs-type">float</span> nmsThreshold)</span> {
        List&lt;DetectionResult&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 按类别分组</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">cls</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; cls &lt; <span class="hljs-number">80</span>; cls++) {
            List&lt;DetectionResult&gt; clsDetections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (DetectionResult det : detections) {
                <span class="hljs-keyword">if</span> (det.getClassIdx() == cls) {
                    clsDetections.add(det);
                }
            }
            <span class="hljs-comment">// 对当前类别执行NMS</span>
            clsDetections.sort((a, b) -&gt; Float.compare(b.getConfidence(), a.getConfidence()));
            <span class="hljs-type">boolean</span>[] suppressed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[clsDetections.size()];
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; clsDetections.size(); i++) {
                <span class="hljs-keyword">if</span> (suppressed[i]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> clsDetections.get(i);
                result.add(current);
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; clsDetections.size(); j++) {
                    <span class="hljs-keyword">if</span> (suppressed[j]) <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">if</span> (calculateIOU(current, clsDetections.get(j)) &gt; nmsThreshold) {
                        suppressed[j] = <span class="hljs-literal">true</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * v8轻量NMS：不分组，直接按置信度排序后执行
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">lightweightNms</span><span class="hljs-params">(List&lt;DetectionResult&gt; detections, <span class="hljs-type">float</span> nmsThreshold)</span> {
        List&lt;DetectionResult&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        detections.sort((a, b) -&gt; Float.compare(b.getConfidence(), a.getConfidence()));
        <span class="hljs-type">boolean</span>[] suppressed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[detections.size()];

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; detections.size(); i++) {
            <span class="hljs-keyword">if</span> (suppressed[i]) <span class="hljs-keyword">continue</span>;
            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> detections.get(i);
            result.add(current);
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; detections.size(); j++) {
                <span class="hljs-keyword">if</span> (suppressed[j]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (calculateIOU(current, detections.get(j)) &gt; nmsThreshold) {
                    suppressed[j] = <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">/**
     * 计算IOU：所有版本通用
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">float</span> <span class="hljs-title function_">calculateIOU</span><span class="hljs-params">(DetectionResult a, DetectionResult b)</span> {
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapLeft</span> <span class="hljs-operator">=</span> Math.max(a.getLeft(), b.getLeft());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapTop</span> <span class="hljs-operator">=</span> Math.max(a.getTop(), b.getTop());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapRight</span> <span class="hljs-operator">=</span> Math.min(a.getRight(), b.getRight());
        <span class="hljs-type">float</span> <span class="hljs-variable">overlapBottom</span> <span class="hljs-operator">=</span> Math.min(a.getBottom(), b.getBottom());

        <span class="hljs-type">float</span> <span class="hljs-variable">overlapArea</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, overlapRight - overlapLeft) * Math.max(<span class="hljs-number">0</span>, overlapBottom - overlapTop);
        <span class="hljs-keyword">if</span> (overlapArea == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

        <span class="hljs-type">float</span> <span class="hljs-variable">areaA</span> <span class="hljs-operator">=</span> (a.getRight() - a.getLeft()) * (a.getBottom() - a.getTop());
        <span class="hljs-type">float</span> <span class="hljs-variable">areaB</span> <span class="hljs-operator">=</span> (b.getRight() - b.getLeft()) * (b.getBottom() - b.getTop());
        <span class="hljs-keyword">return</span> overlapArea / (areaA + areaB - overlapArea);
    }
}
</code></pre>
<h3 data-id="heading-17">4. 检测器层（核心：抽象基类+版本特化实现）</h3>
<h4 data-id="heading-18">（1）统一接口：YoloDetector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * 统一YOLO检测器接口：所有版本实现该接口
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">YoloDetector</span> {
    <span class="hljs-comment">/**
     * 初始化检测器（加载模型）
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 单图检测（统一入口）
     */</span>
    List&lt;DetectionResult&gt; <span class="hljs-title function_">detectImage</span><span class="hljs-params">(Mat srcImg)</span>;

    <span class="hljs-comment">/**
     * 销毁检测器，释放资源
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception;

    <span class="hljs-comment">/**
     * 获取当前版本
     */</span>
    YoloVersionEnum <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span>;
}
</code></pre>
<h4 data-id="heading-19">（2）抽象基类：AbstractYoloDetector.java（实现通用逻辑）</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtEnvironment;
<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 抽象基类：实现所有版本共用的逻辑（模型加载、通用预处理）
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractYoloDetector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">YoloDetector</span> {
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> YoloVersionEnum version;
    <span class="hljs-keyword">protected</span> OrtSession session;
    <span class="hljs-keyword">protected</span> OrtEnvironment env;
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">INPUT_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"images"</span>; <span class="hljs-comment">// 所有版本输入节点名称通用</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AbstractYoloDetector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-built_in">this</span>.version = version;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 初始化ONNX环境（所有版本通用）</span>
        env = OrtEnvironment.getEnvironment();
        OrtSession.<span class="hljs-type">SessionOptions</span> <span class="hljs-variable">sessionOptions</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrtSession</span>.SessionOptions();
        sessionOptions.setIntraOpNumThreads(Runtime.getRuntime().availableProcessors());
        <span class="hljs-comment">// 加载模型（不同版本模型路径不同）</span>
        session = env.createSession(version.getModelPath(), sessionOptions);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">detectImage</span><span class="hljs-params">(Mat srcImg)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. 通用预处理（所有版本共用）</span>
            <span class="hljs-type">float</span>[] inputData = ImageProcessUtil.preprocess(srcImg, version);
            <span class="hljs-comment">// 2. 构造输入（所有版本通用）</span>
            <span class="hljs-type">long</span>[] inputShape = <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[]{YoloConfig.BATCH_SIZE, <span class="hljs-number">3</span>, version.getInputWidth(), version.getInputHeight()};
            OrtSession.<span class="hljs-type">InputTensor</span> <span class="hljs-variable">inputTensor</span> <span class="hljs-operator">=</span> OrtSession.InputTensor.createTensor(
                    env, inputData, inputShape
            );
            Map&lt;String, OrtSession.InputTensor&gt; inputs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            inputs.put(INPUT_NAME, inputTensor);
            <span class="hljs-comment">// 3. 模型推理（所有版本通用）</span>
            OrtSession.<span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> session.run(inputs);
            <span class="hljs-comment">// 4. 版本特化后处理（子类实现）</span>
            List&lt;DetectionResult&gt; detections = postProcess(result, srcImg);
            <span class="hljs-comment">// 5. 释放资源</span>
            inputTensor.close();
            result.close();
            <span class="hljs-keyword">return</span> detections;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"检测异常："</span> + e.getMessage());
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
            session.close();
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> YoloVersionEnum <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> version;
    }

    <span class="hljs-comment">/**
     * 版本特化后处理：子类实现（核心差异点）
     */</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">abstract</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception;
}
</code></pre>
<h4 data-id="heading-20">（3）v5适配实现：YoloV5Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv5适配实现：处理v5特有的输出解析和传统NMS
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV5Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV5Detector</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(YoloVersionEnum.YOLOv5);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v5输出：[1,25200,85] → [25200,85]</span>
        <span class="hljs-type">float</span>[][][] outputs = (<span class="hljs-type">float</span>[][][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = outputs[<span class="hljs-number">0</span>];

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-type">float</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">4</span>]; <span class="hljs-comment">// v5的置信度在第5位</span>
            <span class="hljs-keyword">if</span> (conf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 找到最大置信度类别</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxClassConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxClassConf) {
                    maxClassConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">5</span>;
                }
            }
            <span class="hljs-type">float</span> <span class="hljs-variable">finalConf</span> <span class="hljs-operator">=</span> conf * maxClassConf; <span class="hljs-comment">// v5需乘以类别置信度</span>
            <span class="hljs-keyword">if</span> (finalConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 解析坐标并还原</span>
            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(finalConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. 执行v5传统NMS</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h4 data-id="heading-21">（4）v8/v11适配实现：YoloV8V11Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv8/v11适配实现：共享相同的输出格式
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV8V11Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-comment">// 区分v8和v11</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV8V11Detector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-built_in">super</span>(version);
        <span class="hljs-keyword">if</span> (version != YoloVersionEnum.YOLOv8 &amp;&amp; version != YoloVersionEnum.YOLOv11) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"仅支持YOLOv8/v11"</span>);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v8/v11输出：[1,84,8400] → 转置为[8400,84]</span>
        <span class="hljs-type">float</span>[][] outputs = (<span class="hljs-type">float</span>[][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getOutputNumBoxes()][version.getOutputNumParams()];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; version.getOutputNumParams(); j++) {
                output[i][j] = outputs[j][i];
            }
        }

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-comment">// 找到最大置信度类别</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxConf) {
                    maxConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">4</span>;
                }
            }
            <span class="hljs-keyword">if</span> (maxConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-comment">// 解析坐标并还原</span>
            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(maxConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. 执行轻量NMS</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h4 data-id="heading-22">（5）v26适配实现：YoloV26Detector.java</h4>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo.detector;

<span class="hljs-keyword">import</span> ai.onnxruntime.OrtSession;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloConfig;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.util.ImageProcessUtil;
<span class="hljs-keyword">import</span> com.yolo.util.NmsUtil;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * YOLOv26适配实现：无NMS，仅置信度过滤
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloV26Detector</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractYoloDetector</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">YoloV26Detector</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>(YoloVersionEnum.YOLOv26);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> List&lt;DetectionResult&gt; <span class="hljs-title function_">postProcess</span><span class="hljs-params">(OrtSession.Result result, Mat srcImg)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 解析v26输出：与v8格式一致，[1,84,8400] → 转置为[8400,84]</span>
        <span class="hljs-type">float</span>[][] outputs = (<span class="hljs-type">float</span>[][]) result.getOutputs().values().iterator().next().get().getObject();
        <span class="hljs-type">float</span>[][] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">float</span>[version.getOutputNumBoxes()][version.getOutputNumParams()];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; version.getOutputNumParams(); j++) {
                output[i][j] = outputs[j][i];
            }
        }

        List&lt;DetectionResult&gt; detections = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-comment">// 2. 解析每个预测框（仅置信度过滤，无NMS）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; version.getOutputNumBoxes(); i++) {
            <span class="hljs-type">float</span>[] box = output[i];
            <span class="hljs-type">int</span> <span class="hljs-variable">maxClassIdx</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">float</span> <span class="hljs-variable">maxConf</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>; j &lt; version.getOutputNumParams(); j++) {
                <span class="hljs-keyword">if</span> (box[j] &gt; maxConf) {
                    maxConf = box[j];
                    maxClassIdx = j - <span class="hljs-number">4</span>;
                }
            }
            <span class="hljs-comment">// v26置信度阈值更高，过滤更严格</span>
            <span class="hljs-keyword">if</span> (maxConf &lt; version.getConfThreshold()) <span class="hljs-keyword">continue</span>;

            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">0</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">1</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">2</span>];
            <span class="hljs-type">float</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> box[<span class="hljs-number">3</span>];
            <span class="hljs-type">float</span>[] coord = ImageProcessUtil.restoreCoord(x, y, w, h, srcImg, version);

            <span class="hljs-type">DetectionResult</span> <span class="hljs-variable">dr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DetectionResult</span>();
            dr.setClassName(YoloConfig.CLASSES[maxClassIdx]);
            dr.setConfidence(maxConf);
            dr.setLeft((<span class="hljs-type">int</span>) coord[<span class="hljs-number">0</span>]);
            dr.setTop((<span class="hljs-type">int</span>) coord[<span class="hljs-number">1</span>]);
            dr.setRight((<span class="hljs-type">int</span>) coord[<span class="hljs-number">2</span>]);
            dr.setBottom((<span class="hljs-type">int</span>) coord[<span class="hljs-number">3</span>]);
            dr.setClassIdx(maxClassIdx);
            detections.add(dr);
        }

        <span class="hljs-comment">// 3. v26无NMS，直接返回</span>
        <span class="hljs-keyword">return</span> NmsUtil.applyNms(detections, version.getNmsThreshold(), version.isNeedLegacyNms());
    }
}
</code></pre>
<h3 data-id="heading-23">5. 统一测试类：YoloUniversalTest.java（一键切换版本）</h3>
<pre><code class="hljs language-Java" lang="Java">
<span class="hljs-keyword">package</span> com.yolo;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.yolo.common.DetectionResult;
<span class="hljs-keyword">import</span> com.yolo.common.YoloVersionEnum;
<span class="hljs-keyword">import</span> com.yolo.detector.AbstractYoloDetector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloDetector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV26Detector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV5Detector;
<span class="hljs-keyword">import</span> com.yolo.detector.YoloV8V11Detector;
<span class="hljs-keyword">import</span> org.bytedeco.opencv.opencv_core.Mat;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgcodecs.imread;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.bytedeco.opencv.global.opencv_imgcodecs.imwrite;

<span class="hljs-comment">/**
 * 统一测试类：一键切换YOLO版本，调用接口完全一致
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoloUniversalTest</span> {
    <span class="hljs-comment">// 测试图片路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEST_IMG_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">"test.jpg"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">OUTPUT_IMG_PATH</span> <span class="hljs-operator">=</span> <span class="hljs-string">"result.jpg"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. 选择版本（只需修改此处，一键切换）</span>
        <span class="hljs-type">YoloVersionEnum</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> YoloVersionEnum.YOLOv26;
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv5;</span>
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv8;</span>
        <span class="hljs-comment">// YoloVersionEnum version = YoloVersionEnum.YOLOv11;</span>

        <span class="hljs-comment">// 2. 创建对应版本的检测器（统一接口）</span>
        <span class="hljs-type">YoloDetector</span> <span class="hljs-variable">detector</span> <span class="hljs-operator">=</span> createDetector(version);
        <span class="hljs-keyword">if</span> (detector == <span class="hljs-literal">null</span>) {
            System.err.println(<span class="hljs-string">"不支持的版本"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. 初始化检测器</span>
            detector.init();
            System.out.println(<span class="hljs-string">"初始化"</span> + version.name() + <span class="hljs-string">"检测器成功"</span>);

            <span class="hljs-comment">// 4. 读取测试图片</span>
            <span class="hljs-type">Mat</span> <span class="hljs-variable">srcImg</span> <span class="hljs-operator">=</span> imread(TEST_IMG_PATH);
            <span class="hljs-keyword">if</span> (srcImg.empty()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"图片读取失败"</span>);
            }

            <span class="hljs-comment">// 5. 统一调用检测接口</span>
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            java.util.List&lt;DetectionResult&gt; results = detector.detectImage(srcImg);
            <span class="hljs-type">long</span> <span class="hljs-variable">detectTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;

            <span class="hljs-comment">// 6. 输出结果</span>
            System.out.println(version.name() + <span class="hljs-string">"检测耗时："</span> + detectTime + <span class="hljs-string">"ms"</span>);
            System.out.println(<span class="hljs-string">"检测结果："</span> + JSON.toJSONString(results, <span class="hljs-literal">true</span>));

            <span class="hljs-comment">// 7. 绘制结果并保存</span>
            drawResult(srcImg, results);
            imwrite(OUTPUT_IMG_PATH, srcImg);
            System.out.println(<span class="hljs-string">"带预测框的图片已保存至："</span> + OUTPUT_IMG_PATH);

        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"检测异常："</span> + e.getMessage());
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 8. 销毁检测器</span>
            <span class="hljs-keyword">try</span> {
                detector.destroy();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                e.printStackTrace();
            }
        }
    }

    <span class="hljs-comment">/**
     * 创建对应版本的检测器（工厂模式）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> YoloDetector <span class="hljs-title function_">createDetector</span><span class="hljs-params">(YoloVersionEnum version)</span> {
        <span class="hljs-keyword">switch</span> (version) {
            <span class="hljs-keyword">case</span> YOLOv5:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV5Detector</span>();
            <span class="hljs-keyword">case</span> YOLOv8:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV8V11Detector</span>(version);
            <span class="hljs-keyword">case</span> YOLOv11:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV8V11Detector</span>(version);
            <span class="hljs-keyword">case</span> YOLOv26:
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YoloV26Detector</span>();
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">/**
     * 绘制检测结果（所有版本通用）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawResult</span><span class="hljs-params">(Mat srcImg, java.util.List&lt;DetectionResult&gt; results)</span> {
        <span class="hljs-keyword">for</span> (DetectionResult dr : results) {
            org.bytedeco.opencv.opencv_core.<span class="hljs-type">Rect</span> <span class="hljs-variable">rect</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">org</span>.bytedeco.opencv.opencv_core.Rect(
                    dr.getLeft(), dr.getTop(),
                    dr.getRight() - dr.getLeft(),
                    dr.getBottom() - dr.getTop()
            );
            org.bytedeco.opencv.opencv_imgproc.Imgproc.rectangle(
                    srcImg, rect,
                    com.yolo.common.YoloConfig.COLORS[dr.getClassIdx()], <span class="hljs-number">2</span>
            );
            <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> dr.getClassName() + <span class="hljs-string">" "</span> + String.format(<span class="hljs-string">"%.2f"</span>, dr.getConfidence());
            org.bytedeco.opencv.opencv_imgproc.Imgproc.putText(
                    srcImg, text,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">org</span>.bytedeco.opencv.opencv_core.Point(dr.getLeft(), dr.getTop() - <span class="hljs-number">10</span>),
                    org.bytedeco.opencv.opencv_imgproc.Imgproc.FONT_HERSHEY_SIMPLEX,
                    <span class="hljs-number">0.5</span>, com.yolo.common.YoloConfig.COLORS[dr.getClassIdx()], <span class="hljs-number">1</span>
            );
        }
    }
}
</code></pre>
<h2 data-id="heading-24">五、实战验证与踩坑指南</h2>
<h3 data-id="heading-25">1. 快速验证步骤</h3>
<ol>
<li>
<p>准备测试图片<code>test.jpg</code>放入项目根目录；</p>
</li>
<li>
<p>在<code>YoloUniversalTest</code>中修改<code>version</code>变量（如<code>YOLOv26</code>）；</p>
</li>
<li>
<p>运行<code>main</code>方法，控制台输出检测耗时和结果，项目根目录生成<code>result.jpg</code>（带预测框）；</p>
</li>
<li>
<p>切换不同<code>version</code>值，重复步骤3，验证所有版本均可正常检测。</p>
</li>
</ol>
<h3 data-id="heading-26">2. 各版本适配高频踩坑指南</h3>



































<table><thead><tr><th>版本</th><th>常见问题</th><th>解决方案</th></tr></thead><tbody><tr><td>YOLOv5</td><td>输出解析维度错误</td><td>确认输出为<code>[1,25200,85]</code>，置信度需乘以类别置信度（<code>conf * classConf</code>）</td></tr><tr><td>YOLOv8/v11</td><td>输出轴顺序错误</td><td>将<code>[1,84,8400]</code>转置为<code>[8400,84]</code>后再解析</td></tr><tr><td>YOLOv26</td><td>重叠框多、误检</td><td>将置信度阈值调至0.35~0.4，确保模型导出时关闭NMS（<code>nms=False</code>）</td></tr><tr><td>所有版本</td><td>模型加载失败</td><td>确认模型路径正确，ONNX Runtime版本为1.16.0</td></tr><tr><td>所有版本</td><td>坐标偏移</td><td>检查LetterBox填充和坐标还原的缩放比例计算逻辑</td></tr></tbody></table>
<h3 data-id="heading-27">3. 性能对比（CPU环境）</h3>



































<table><thead><tr><th>版本</th><th>单帧检测耗时</th><th>FPS</th><th>核心优化点</th></tr></thead><tbody><tr><td>YOLOv5</td><td>180ms</td><td>5.5</td><td>传统NMS优化</td></tr><tr><td>YOLOv8</td><td>120ms</td><td>8.3</td><td>轻量NMS</td></tr><tr><td>YOLOv11</td><td>110ms</td><td>9.1</td><td>模型轻量化</td></tr><tr><td>YOLOv26</td><td>90ms</td><td>11.1</td><td>无NMS，仅置信度过滤</td></tr></tbody></table>
<h2 data-id="heading-28">六、扩展方向：通用框架落地延伸</h2>
<ol>
<li>
<p><strong>批量推理扩展</strong>：在抽象基类中添加<code>batchDetect</code>方法，适配所有版本的批量输入；</p>
</li>
<li>
<p><strong>视频流扩展</strong>：集成之前的帧提取工具，实现所有版本的视频流实时检测；</p>
</li>
<li>
<p><strong>SpringBoot集成</strong>：封装为<code>@Service</code>，提供HTTP接口，一键切换版本；</p>
</li>
<li>
<p><strong>自定义数据集适配</strong>：仅需修改<code>YoloConfig.CLASSES</code>和版本枚举的参数，无需改动核心逻辑；</p>
</li>
<li>
<p><strong>GPU加速</strong>：更换为ONNX Runtime GPU版依赖，所有版本自动受益，耗时降至20ms内。</p>
</li>
</ol>
<h2 data-id="heading-29">七、总结</h2>
<p>本文通过“抽象封装+版本适配”的设计模式，打造了一套Java版YOLO通用调用框架，实现了v5/v8/v11/v26的统一调用：</p>
<ol>
<li>
<p><strong>核心亮点</strong>：上层统一接口，底层版本特化实现，切换版本仅需修改枚举值，无需改动核心代码；</p>
</li>
<li>
<p><strong>关键适配</strong>：通过枚举集中管理版本差异参数，通用工具类封装预处理/NMS，抽象基类实现共用逻辑；</p>
</li>
<li>
<p><strong>落地价值</strong>：解决了Java端YOLO版本适配重复造轮子的问题，兼顾易用性与扩展性，可直接复用至监控、安防、边缘计算等场景。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了]]></title>    <link>https://juejin.cn/post/7599852579066658831</link>    <guid>https://juejin.cn/post/7599852579066658831</guid>    <pubDate>2026-01-27T07:30:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852579066658831" data-draft-id="7599852579066642447" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-27T07:30:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能比肩Gemini 3 Pro！昨晚，阿里千问最强模型来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:30:43.000Z" title="Tue Jan 27 2026 07:30:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1 月 26 日深夜，阿里千问旗舰推理模型 Qwen3-Max-Thinking 正式上线。</p>
<p>该模型在科学知识（GPQA Diamond）、数学推理（IMO-AnswerBench）、代码编程（LiveCodeBench）等多项权威基准测试中刷新纪录，其综合性能已可对标 GPT-5.2 与 Gemini 3 Pro，成为目前最接近国际顶尖水平的国产大模型之一。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d044bd87e564db793a17471f703188b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=PTPeK6RrDPFbwnUhl1CK7OfEx9A%3D" alt="图片" loading="lazy"/></p>
<p>下表为更全面的评估分数：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccf4f21531247e8958d08a0b88eada5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=l8GopOdCWRLO%2BPUoorLqb%2FpZ3EU%3D" alt="图片" loading="lazy"/></p>
<p>据了解，Qwen3-Max-Thinking 总参数量超万亿（1T），预训练数据量高达 36T Tokens，是阿里目前规模最大、能力最强的推理模型。</p>
<p>此前，预览版 Qwen3-Max-Thinking 已展现出不俗实力。基于这一基础，通义团队进一步扩大了强化学习后训练规模，对模型进行了系统性优化，使正式版在多项核心能力上实现整体跃升。</p>
<p>在覆盖事实知识、复杂推理、指令遵循、人类偏好对齐以及 Agent 能力等 19 项主流评测基准中，Qwen3-Max-Thinking 取得多项领先成绩，刷新了多项最佳纪录，其综合表现已进入与 GPT-5.2-Thinking-xhigh、Claude Opus 4.5、Gemini 3 Pro 同一竞争梯队。</p>
<p>真实表现如何，我们上手体验了一下。</p>
<p>我们输入提示：帮我做一个技能五子棋的游戏网页，要求是在普通的五子棋规则上，玩家可以使用技能。直接给我个 html 文件。</p>
<p>一会儿工夫，Qwen3-Max-Thinking 就嗖嗖甩出 1000 多行代码，把一个可交互、能上手就玩的五子棋直接写完整了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c6ea50c4f104476b36744582e8c72bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=qufQPVvheiIxSgbwb51NVaKfYl4%3D" alt="图片" loading="lazy"/></p>
<p>下一项测试，我们让 Qwen3-Max-Thinking 生成一个跳一跳游戏。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5785a308eb9a41a1adfe5d3d3b97bc59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=eAm2G%2Bu1WG1LmtwV90qVjqDkpwU%3D" alt="图片" loading="lazy"/></p>
<p>请用纯 HTML + CSS + 原生 JavaScript 写一个可在浏览器直接打开的《跳一跳》小游戏（不要依赖任何外部库）。要求：画面：简洁 2D 即可（canvas 或 DOM 都行）；操作：按住蓄力、松开起跳（按住时间决定跳跃距离）；规则：从一个平台跳到下一个平台，落空则结束；生成：平台位置随机，但保证可达（不要生成必死局）；计分：落在平台上加分，连跳加成可选；体验：有起跳动画、落地判定、失败提示、重新开始按钮；代码：完整可运行，放在一个 HTML 文件里，注释清晰。</p>
<p>这个游戏最难的地方，就在于按住鼠标的时间既是操作，也是赌注：短了跳不过去，长了直接飞过头，容错窗口小到离谱。第一跳很容易失误，然后就 Game Over。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94671b400de54099bde789dd13a646b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103843&amp;x-signature=E1NFYxBz9%2BWXzbHNJxBXy1sEZSE%3D" alt="图片" loading="lazy"/></p>
<p>体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fchat.qwen.ai%2F" target="_blank" title="https://chat.qwen.ai/" ref="nofollow noopener noreferrer">chat.qwen.ai/</a></p>
<p>测试时扩展的重新定义</p>
<p>推动 Qwen3-Max-Thinking 的核心创新在于其对传统推理方式的突破。与大多数模型按线性方式逐 token 生成不同，Qwen3 引入了一种由测试时扩展（Test-time scaling）驱动的 Heavy Mode（重推理模式）。</p>
<p>通俗来说，这一技术让模型能够用更多算力换取更高智能水平。但它并非简单的 best-of-N 采样方式，例如一次生成 100 个答案再从中选出最优结果 —— 而是采用了一种经验累积的多轮推理策略。</p>
<p>这种方法更接近人类的解题过程。当模型面对复杂问题时，它不会直接给出一次性猜测，而是进入反复自我反思与迭代推理。通过一种专有的 take-experience 机制，模型能够从此前的推理步骤中提炼有效经验，从而实现：</p>
<ul>
<li>
<p>识别死胡同：在无需完整走完错误推理路径的情况下，判断某条推理思路正在失效；</p>
</li>
<li>
<p>聚焦算力：将计算资源重新分配到尚未解决的不确定点，而不是反复推导已经得到的结论。</p>
</li>
</ul>
<p>这种机制带来了实实在在的效率提升。通过避免冗余推理，模型可以在同样的上下文窗口中整合更丰富的历史信息。千问团队表示，该方法在不显著增加 token 成本的前提下，实现了性能的大幅跃升：</p>
<ul>
<li>
<p>GPQA（博士级科学问题）：得分从 90.3 提升至 92.8；</p>
</li>
<li>
<p>LiveCodeBench v6：成绩从 88.0 提升至 91.4。</p>
</li>
</ul>
<p>自适应工具调用</p>
<p>如果说推理能力决定了模型会不会想，那么工具调用能力决定的，是模型能不能真正把事做成。在 Qwen3-Max-Thinking 中，通义团队不再将推理与工具使用视为两个割裂的阶段，而是将工具能力内生进思考过程本身，构建起一种边思考、边行动的原生 Agent 式模型框架，让大模型从静态的文本推理，迈向可执行、可验证的复杂任务处理。</p>
<p>在完成基础的工具使用微调后，通义团队进一步在大量多样化任务上，引入基于规则奖励与模型奖励的联合强化学习训练，使模型学会何时调用工具、如何结合工具展开推理，而不是机械执行指令。由此，Qwen3-Max-Thinking 获得了更具策略性的工具协同思考能力。</p>
<p>这一自适应工具调用能力已在 QwenChat 中完整落地：模型可自主调度搜索、个性化记忆与代码解释器等核心 Agent 工具，在一次交互中完成信息获取、计算推演与结论生成，回答更贴近专业人士的工作方式，也显著降低了模型幻觉，为解决真实世界中的复杂问题奠定基础。</p>
<p>结语</p>
<p>截至 2026 年 1 月，阿里通义千问（Qwen）系列模型在 Hugging Face 平台上的累计下载量超过了 10 亿次，这一数据使得 Qwen 成为了 Hugging Face 上最受欢迎、下载量最高的开源 AI 模型系列之一。</p>
<p>Qwen3-Max-Thinking 的推出代表着 2026 年人工智能市场的成熟。它将讨论的焦点从谁拥有最智能的聊天机器人转移到谁拥有功能最强大的智能体。通过将高效率推理能力与自适应、自主的工具调用机制相结合，Qwen 已经牢牢确立了自己在企业级 AI 竞争格局中的领先地位。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fventurebeat.com%2Ftechnology%2Fqwen3-max-thinking-beats-gemini-3-pro-and-gpt-5-2-on-humanitys-last-exam" target="_blank" title="https://venturebeat.com/technology/qwen3-max-thinking-beats-gemini-3-pro-and-gpt-5-2-on-humanitys-last-exam" ref="nofollow noopener noreferrer">venturebeat.com/technology/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek又探索新架构了，开源OCR 2]]></title>    <link>https://juejin.cn/post/7599852636529000483</link>    <guid>https://juejin.cn/post/7599852636529000483</guid>    <pubDate>2026-01-27T07:32:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852636529000483" data-draft-id="7599845683121946664" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek又探索新架构了，开源OCR 2"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2026-01-27T07:32:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek又探索新架构了，开源OCR 2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:32:32.000Z" title="Tue Jan 27 2026 07:32:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿！DeepSeek 又更新了！</p>
<p>这次是更新了十月份推出的 DeepSeek-OCR 模型（参见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzA3MzI4MjgzMw%3D%3D%26mid%3D2650996733%26idx%3D1%26sn%3D1bfd3ae23da07de55eda3ed0d51c9b23%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650996733&amp;idx=1&amp;sn=1bfd3ae23da07de55eda3ed0d51c9b23&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">太强了！DeepSeek 刚刚开源新模型，用视觉方式压缩一切</a>）。</p>
<p>当时 DeepSeek-OCR 的出世，引起了大家对视觉压缩的关注与讨论，而这一次，DeepSeek 对视觉编码下手了。</p>
<p>可以说，刚刚发布的 DeepSeek-OCR 2 通过引入 DeepEncoder V2 架构，实现了视觉编码从「固定扫描」向「语义推理」的范式转变！</p>
<p>当然，和 DeepSeek 几乎每次发布一样，这一次同样也是模型和技术报告齐开源。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d0be7d9ceff4782b5b08ffca924c41a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=KGdslEyrlZi9%2Bip85BJ2iB6xq8A%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></p>
</li>
<li>
<p>论文地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepseek-ai%2FDeepSeek-OCR-2%2Fblob%2Fmain%2FDeepSeek_OCR2_paper.pdf" target="_blank" title="https://github.com/deepseek-ai/DeepSeek-OCR-2/blob/main/DeepSeek_OCR2_paper.pdf" ref="nofollow noopener noreferrer">github.com/deepseek-ai…</a></p>
</li>
<li>
<p>模型地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdeepseek-ai%2FDeepSeek-OCR-2" target="_blank" title="https://huggingface.co/deepseek-ai/DeepSeek-OCR-2" ref="nofollow noopener noreferrer">huggingface.co/deepseek-ai…</a></p>
</li>
</ul>
<p>这项研究的三位作者分别是魏浩然、孙耀峰、李宇琨。</p>
<p>具体来说，该研究的核心创新在于将原本基于 CLIP 的编码器替换为轻量级语言模型（Qwen2-500M），并引入了具有因果注意力机制的「因果流查询」。</p>
<p>这种设计打破了传统模型必须按从左到右、从上到下的栅格顺序处理图像的限制，赋予了编码器根据图像语义动态重排视觉 Token 的能力。通过这种两级级联的 1D 因果推理结构（编码器重排与译码器解析），模型能够更精准地还原复杂文档（如带表格、公式和多栏布局）的自然阅读逻辑。</p>
<p>这就像是为机器装上了「人类的阅读逻辑」，让 AI 不再只是生搬硬套地扫描图像。对比之下，传统的 AI 就像一个死板的复印机，不管页面内容多复杂，都只能从左上角到右下角按行扫描。</p>
<p>在维持极高数据压缩效率的同时，DeepSeek-OCR 2 在多项基准测试和生产指标上均取得了显著突破。模型仅需 256 到 1120 个视觉 Token 即可覆盖复杂的文档页面，这在同类模型中处于极低水平，显著降低了下游 LLM 的计算开销。</p>
<p>在 OmniDocBench v1.5 评测中，其综合得分达到 91.09%，较前代提升了 3.73%，特别是在阅读顺序识别方面表现出了更强的逻辑性。</p>
<p>此外，在实际生产环境中，该模型显著降低了 OCR 识别结果的重复率，并为未来构建统一的 omni-modal（全模态）编码器提供了可行路径。是的，未来同一个 AI「大脑」或许能用同样的方法去处理声音、视频等所有模态的数据，真正实现多模态的深度统一。</p>
<p>DeepSeek-OCR 2 架构</p>
<p>如图 3 所示，DeepSeek-OCR 2 延续了 DeepSeek-OCR 的整体架构，由编码器（encoder） 和解码器（decoder） 组成。编码器负责将图像离散化为视觉 token，而解码器则在这些视觉 token 与文本提示（text prompts）的条件约束下生成输出。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67a045a541f14e7c828b604298a30154~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=SQjRAlOpY5x3JlSwASb8L7Z3EXQ%3D" alt="图片" loading="lazy"/></p>
<p>两者的关键区别在于编码器部分：DeepSeek 将原有的 DeepEncoder 升级为 DeepEncoder V2。在完整保留前代能力的基础上，DeepEncoder V2 通过一种全新的架构设计，引入了因果推理能力（causal reasoning）。</p>
<p>DeepEncoder V2</p>
<p>DeepEncoder V2 的第一个组成部分是视觉分词器（vision tokenizer）。延续了 DeepEncoder 的设计，DeepSeek 采用了一种由参数规模为 8000 万的 SAM-base 与两层卷积层组成的架构。相比 DeepEncoder，DeepSeek 将最终卷积层的输出维度从 1024 降至 896，以与后续处理流程保持一致。</p>
<p>在 DeepEncoder 中，视觉分词器之后接入的是一个 CLIP ViT，用于进一步压缩和建模视觉语义。DeepEncoder V2 对这一组件进行了重新设计，将其改造为一种类 LLM 的架构，并引入了双流注意力机制（dual-stream attention）。</p>
<p>其中，视觉 token 采用双向注意力，以保留 CLIP 所具备的全局建模能力；而新引入的因果流查询（causal flow queries） 则使用因果注意力。这些可学习的查询 token 被作为后缀追加在视觉 token 之后，每个查询都可以关注所有视觉 token 以及其之前的查询 token。通过保持查询 token 与视觉 token 数量一致，该设计在不改变 token 总数的前提下，对视觉特征施加语义上的排序与蒸馏约束。最终，只有因果查询 token 的输出会被送入 LLM 解码器。</p>
<p>从整体上看，该架构实际上构建了一种两阶段级联的因果推理机制：首先，编码器通过可学习查询对视觉 token 进行语义重排；随后，LLM 解码器在这一有序序列之上执行自回归推理。与依赖位置编码施加刚性空间顺序的传统编码器不同，这种因果排序查询能够更自然地贴合连续的视觉语义，并与 LLM 的单向注意力模式高度一致。该设计有望在二维空间结构与一维因果语言建模之间搭建起一座桥梁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c7cb960d222488ab8f2fb38e4938ae7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=xRtp90Pz4Sa5J6hNNbkjW35QR%2BE%3D" alt="图片" loading="lazy"/></p>
<p>为更直观地展示 DeepEncoder V2 的注意力机制，图 5 对其注意力掩码进行了可视化。该注意力掩码由两个相互区分的区域组成。</p>
<p>左侧区域对原始视觉 token 采用双向注意力机制（类似于 ViT），使任意 token 都可以与其他所有 token 建立可见性，从而实现完整的全局建模；右侧区域则针对因果流 token 使用因果注意力（三角形掩码，与纯解码器 LLM 完全一致），其中每个 token 只能关注其之前的 token。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9ddbb3879f4614a22d5c58505b8c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=YhZFLSG65SilMGecPLqqGyZhTww%3D" alt="图片" loading="lazy"/></p>
<p>DeepSeek-MoE Decoder</p>
<p>由于 DeepSeek-OCR 2 的改进重点主要集中在编码器 上，并未对解码器部分进行升级。遵循这一设计原则，模型继续沿用 DeepSeek-OCR 的解码器 —— 一个参数规模为 30 亿的 MoE 结构，其中约 5 亿参数在推理时处于激活状态。</p>
<p>训练数据与训练流程</p>
<p>在数据层面，DeepSeek-OCR 2 沿用了与 DeepSeek-OCR 相同的数据源，由 OCR 1.0、OCR 2.0 以及通用视觉数据组成，其中 OCR 数据占混合训练数据的 80%。同时引入了以下两项改进：</p>
<ul>
<li>
<p>针对 OCR 1.0 数据采用了更均衡的采样策略，并按内容类型（正文、公式和表格）以 3:1:1 的比例对页面进行划分；</p>
</li>
<li>
<p>通过合并语义相似的类别（例如统一「插图说明」和「插图标题」）来优化布局检测的标签。</p>
</li>
</ul>
<p>在训练阶段，DeepSeek-OCR 2 主要分为三个阶段来完成：（1）编码器预训练；（2）查询增强；（3）解码器专门化。</p>
<p>其中第一阶段使视觉分词器（tokenizer）和 LLM 风格的编码器获得特征提取、token 压缩和 token 重排的基础能力。第二阶段进一步加强编码器的 token 重排能力，同时增强了视觉知识的压缩。第三阶段冻结编码器参数，仅优化解码器，从而在相同的 FLOPs 下实现更高的数据吞吐量。</p>
<p>接着来看细节。</p>
<p>首先是训练 DeepEncoder V2。遵循 DeepSeek-OCR 和 Vary 的方法，使用语言建模目标来训练 DeepEncoder V2，将编码器与轻量级解码器耦合，通过预测下一个 token 进行联合优化。采用了 768×768 和 1024×1024 两种分辨率的数据加载器。视觉分词器初始化自 DeepEncoder，LLM 风格的编码器则初始化自 Qwen2-0.5B-base。预训练完成后，仅保留编码器参数用于后续阶段。</p>
<p>本阶段使用 AdamW 优化器，学习率采用余弦退火，从 1e-4 降至 1e-6，在 160 台 A100 GPU（20 个节点 × 8 台 GPU）上以 640 的批大小训练 40k 次迭代（采用长度为 8K 的序列打包，约包含 1 亿个图文对样本）。</p>
<p>其次是查询增强。在 DeepEncoder V2 预训练之后，将其与 DeepSeek-3B-A500M 整合为最终的流水线。冻结视觉分词器（SAM-conv 结构），并联合优化 LLM 编码器和 LLM 解码器以增强查询表示。本阶段通过多裁剪策略将两种分辨率统一到单个数据加载器中。此外采用 4 阶段流水线并行：视觉分词器（PP0）、LLM 风格编码器（PP1）以及 DeepSeek-LLM 层（PP2-3 每阶段 6 层）。</p>
<p>本阶段利用 160 台 GPU（每台 40GB 显存），配置了 40 个数据并行副本（每个副本 4 台 GPU），过程中使用相同的优化器，以 1280 的全局批大小进行训练，学习率在 15k 次迭代中从 5e-5 退火至 1e-6。</p>
<p>最后是 LLM 持续训练。为了快速消耗训练数据，本阶段冻结 DeepEncoder V2 的所有参数，仅更新 DeepSeek-LLM 的参数。本阶段加速了训练（在相同全局批大小下，训练速度提升了一倍多），同时有助于 LLM 更好地理解 DeepEncoder V2 重排后的视觉 token。</p>
<p>承接第二阶段，本阶段进行了另一次学习率退火，从 1e-6 降至 5e-8，共训练 20k 次迭代。</p>
<p>评估结果</p>
<p>团队选用 OmniDocBench v1.5 作为主要评测基准，该基准包含 1355 页文档，覆盖中英文两种语言的 9 大主要类别，包括杂志、学术论文、研究报告等。凭借其多样化的测试样本与严格的评测标准，OmniDocBench 为验证 DeepSeek-OCR 2 的整体性能，尤其是 DeepEncoder V2 的有效性，提供了一个可靠有效的平台。</p>
<p>如表 1 所示，在使用最小视觉 token 上限（<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a98256ed1cc541d38e1cc81feafb8782~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=6D8MdO77Vy%2BvSNz6N9osFN6%2Bf8Q%3D" alt="图片" loading="lazy"/>）的情况下，DeepSeek-OCR 2 仍取得了 91.09% 的领先性能。与 DeepSeek-OCR 基线模型相比，在采用相似训练数据来源的前提下，其性能提升了 3.73%，验证了新设计架构的有效性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c33de06023d7495da658a47db9e38c7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=Xr7m221Uc8zTuhmI%2B4mjYrWluNs%3D" alt="图片" loading="lazy"/></p>
<p>此外，除了整体性能提升，阅读顺序（R-order）指标上的编辑距离（Edit Distance，ED）也显著下降，从 0.085 降至 0.057。这表明，新的 DeepEncoder V2 能够根据图像信息更有效地选择并排列初始视觉 token。</p>
<p>进一步如表 2 所示，在相同的视觉 token 预算（1120）条件下，DeepSeek-OCR 2 在文档解析任务中的 ED（0.100）低于 Gemini-3 Pro（0.115）。这进一步证明了新模型在保持高视觉 token 压缩率的同时，仍能确保更优的性能，并展现出极高的潜力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ddda40a802b4b829c4ba522b1274512~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=HuGfXd1AdKuazGpmn%2BtyQO1DU80%3D" alt="图片" loading="lazy"/></p>
<p>改进空间</p>
<p>团队在 9 种文档类型上，对 DeepSeek-OCR 与 DeepSeek-OCR 2 进行了细致的性能对比，结果表明：DeepSeek-OCR 2 仍具有较大的提升空间，如表 3 所示。在文本识别的编辑距离（ED）指标上，DeepSeek-OCR 2 在大多数场景中优于 DeepSeek-OCR，但在某些类型上仍存在明显不足，例如报纸类文档，其 ED 超过 0.13。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31113cb3007043cc972343e1c2122be1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=hgqrTbRL4QWwo7%2BjZyPy2A%2FB1To%3D" alt="图片" loading="lazy"/></p>
<p>团队认为主要原因有两点：</p>
<ul>
<li>
<p>视觉 token 上限较低，可能影响了文本极为密集的报纸类文档识别效果，这一问题可在未来通过增加局部裁剪（local crops）的数量来缓解；</p>
</li>
<li>
<p>报纸类数据不足 —— 当前训练集中仅包含约 25 万条相关样本，这对于训练 DeepEncoder V2 来说仍然不够充分。</p>
</li>
</ul>
<p>当然，在阅读顺序（R-order）这一指标上，DeepSeek-OCR 2 在所有类别中始终优于 DeepSeek-OCR，这进一步验证了所提出的「视觉因果流」编码器设计的有效性。</p>
<p>实际应用</p>
<p>DeepSeek-OCR 主要面向两类生产场景：一是为 DeepSeek-LLM 提供图像 / 文档读取能力的在线 OCR 服务，二是用于批量 PDF 处理的预训练数据流水线。在比较了 DeepSeek-OCR 2 与 DeepSeek-OCR 在真实生产环境中的表现后发现，由于生产环境中无法获得标准答案，因此团队主要采用「重复率」作为核心质量指标。</p>
<p>如表 4 所示，相比前代模型，DeepSeek-OCR 2 在实际可用性方面有了显著提升：在在线用户日志图像中，重复率从 6.25% 降至 4.17%；在 PDF 数据生产场景中，重复率从 3.69% 降至 2.88%。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc419a7eee6547b48ebf69fa5b8770ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770103952&amp;x-signature=vBoP4TQDvPfCEmAGPSA9jFCHmYg%3D" alt="图片" loading="lazy"/></p>
<p>这些结果进一步验证了 DeepSeek-OCR 2 架构的有效性，尤其体现了其在逻辑性视觉理解方面的优势。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）]]></title>    <link>https://juejin.cn/post/7599601258641260582</link>    <guid>https://juejin.cn/post/7599601258641260582</guid>    <pubDate>2026-01-27T07:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258641260582" data-draft-id="7599640782570487835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-27T07:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="豆苗学前端"/> <meta itemprop="url" content="https://juejin.cn/user/1935598759719400"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从 H5 到大屏：全场景适配工程化落地指南（吊打面试官）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1935598759719400/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    豆苗学前端
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:33:42.000Z" title="Tue Jan 27 2026 07:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、 媒体查询 (Media Queries)</h3>
<p><strong>场景：</strong> 响应式官网、展示型门户。 <strong>弊端：</strong> 非平滑跳变（Breakpoint 切换时页面闪烁）、开发工作量巨大。</p>
<h4 data-id="heading-1">1. 落地步骤</h4>
<ol>
<li><strong>断点设计</strong>：根据设计稿（如 1920px, 768px, 375px）定义标准断点。</li>
<li><strong>样式覆盖</strong>：先写移动端（Mobile First），再通过 @media 覆盖 PC 样式。</li>
</ol>
<h4 data-id="heading-2">2. HTML 模板</h4>
<pre><code class="hljs language-ini" lang="ini">&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"main.css"</span>&gt;
&lt;link <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> href=<span class="hljs-string">"mobile.css"</span> media=<span class="hljs-string">"screen and (max-width: 768px)"</span>&gt;
</code></pre>
<h4 data-id="heading-3">3. 吊打面试官点：如何解决“非平滑跳变”？</h4>
<p>“面试官，媒体查询最大的痛点是跳变。我的解决方案是：<strong>配合 Flex/Grid 弹性布局使用</strong>。通过媒体查询只改变大框架（如一栏变两栏），而内部细节利用 flex-grow 和 clamp() 函数实现平滑过渡，这样即使在断点边缘，视觉也不会生硬。”</p>
<hr/>
<h3 data-id="heading-4">二、 REM + Flexible</h3>
<p><strong>场景：</strong> 移动端 H5 活动页。 <strong>弊端：</strong> 1px 缝隙、高度无法适配、高频触发 Resize 导致的<strong>重排性能开销</strong>。</p>
<h4 data-id="heading-5">1. 落地步骤</h4>
<ol>
<li><strong>引入脚本</strong>：在 HTML 头部注入 lib-flexible，动态设置 html.fontSize = window.innerWidth / 10。</li>
<li><strong>配置插件</strong>：安装 postcss-pxtorem。</li>
<li><strong>参数设置</strong>：rootValue: 75（若设计稿是 750px）。</li>
</ol>
<h4 data-id="heading-6">2. HTML 模板</h4>
<p>codeHtml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/amfe-flexible/2.2.1/index.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
  <span class="hljs-selector-class">.box</span> { <span class="hljs-attribute">width</span>: <span class="hljs-number">2rem</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">1rem</span>; <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#000</span>; <span class="hljs-comment">/* 需要处理 1px */</span> }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">3. 吊打面试官点：如何解决 1px 边框和舍入缝隙？</h4>
<p>“面试官，REM 有两个致命缺陷。 <strong>第一：1px 边框变粗。</strong> 我通常开启插件的 minPixelValue: 2 忽略 1px 转换，并手动用 <strong>伪元素 + transform: scale(0.5)</strong> 来绘制真正的 1px 物理像素。 <strong>第二：色块间白线缝隙。</strong> 这是由于 rem 转换后的小数点舍入误差导致的。我会给相邻色块设置 margin-right: -1px 物理重叠，或者使用 box-shadow: 0 0 1px #color 扩张阴影来填补像素空隙。”</p>
<hr/>
<h3 data-id="heading-8">三、 VW / VH (视口百分比)</h3>
<p><strong>场景：</strong> 现代移动端、全屏背景页。 <strong>弊端：</strong> 无法限制最大宽度（在大屏平板上元素会巨大无比）、计算繁琐。</p>
<h4 data-id="heading-9">1. 落地步骤</h4>
<ol>
<li><strong>确定基准</strong>：设计稿宽度 375px，则 1vw = 3.75px。</li>
<li><strong>配置插件</strong>：使用 postcss-px-to-viewport。</li>
</ol>
<h4 data-id="heading-10">2. 吊打面试官点：如何解决“无限拉伸”？</h4>
<p>“面试官，VW 方案最怕用户在 iPad 上看手机版。我会通过 <strong>CSS 锁（CSS Locks）</strong> 或 clamp() 函数来限制范围。例如：width: clamp(300px, 50vw, 800px)，确保元素在极小或极大屏幕下都有保底尺寸。”</p>
<hr/>
<h3 data-id="heading-11">四、 Transform Scale (大屏首选)</h3>
<p><strong>场景：</strong> 指挥中心、数据大屏。 <strong>弊端：</strong> 边缘黑边、地图/Canvas 坐标偏移。</p>
<h4 data-id="heading-12">1. 落地步骤</h4>
<ol>
<li><strong>固定基准</strong>：按 1920x1080 布局。</li>
<li><strong>脚本计算</strong>：计算 min(window.innerWidth/1920, window.innerHeight/1080)。</li>
</ol>
<h4 data-id="heading-13">2. HTML 模板</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app-container"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 1920px; height: 1080px; transform-origin: 0 0;"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 业务代码 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">const</span> warp = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'app-container'</span>);
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">setScale</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> s = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-number">1920</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / <span class="hljs-number">1080</span>);
    warp.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`scale(<span class="hljs-subst">${s}</span>) translate(-50%, -50%)`</span>;
    warp.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">'50%'</span>; warp.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'50%'</span>;
  };
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = setScale; <span class="hljs-title function_">setScale</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">3. 吊打面试官点：如何解决“黑边”和“文字模糊”？</h4>
<p>“面试官，Scale 等比缩放必有黑边。 <strong>针对黑边：</strong> 我会使用一张跨度极大的背景图（如 4000px 宽）平铺全屏，而核心数据容器居中缩放，视觉上黑边消失。 <strong>针对文字模糊：</strong> Scale 缩放会导致 Canvas 或高频更新的文本模糊。我会针对这些特定组件进行 <strong>反向缩放（Inversed Scaling）</strong> ，即父级 scale(0.5)，组件内 scale(2)，并开启 will-change: transform 强制 GPU 渲染。”</p>
<hr/>
<h3 data-id="heading-15">五、 Autofit.js (快速交付)</h3>
<p><strong>场景：</strong> 甲方要求今天上线的大屏。 <strong>弊端：</strong> 默认拉伸会导致布局稍微变形（填满屏幕但比例不对）。</p>
<h4 data-id="heading-16">1. 落地步骤</h4>
<ol>
<li><strong>引入</strong>：import autofit from 'autofit.js'。</li>
<li><strong>初始化</strong>：autofit.init({ designHeight: 1080, designWidth: 1920, renderDom: "#app" })。</li>
</ol>
<h4 data-id="heading-17">2. 吊打面试官点：如何解决“组件被强行拉伸变形”？</h4>
<p>“面试官，Autofit 默认是填满全屏，这会导致圆形变椭圆。我会利用它的 ignore 参数，把诸如 <strong>实时监控视频、圆形进度条、GIS 地图</strong> 设为忽略元素，对这些元素单独采用 CSS 媒体查询或百分比布局，保护它们不发生纵横比畸变。”</p>
<p>在 Vue 2 项目中落地 autofit.js 非常简单，但要达到“工业级”的稳健性，你需要注意<strong>初始化时机、销毁逻辑以及局部组件屏蔽</strong>。</p>
<p>以下是 Vue 2 项目集成 autofit.js 的保姆级步骤：</p>
<hr/>
<h4 data-id="heading-18">1、 安装依赖</h4>
<pre><code class="hljs language-css" lang="css">npm install autofit<span class="hljs-selector-class">.js</span> <span class="hljs-attr">--save</span>
</code></pre>
<hr/>
<h4 data-id="heading-19">2、 核心集成逻辑</h4>
<p>推荐在 <strong>App.vue</strong> 中进行初始化，因为 autofit.js 需要操作最外层的 DOM 容器。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> autofit <span class="hljs-keyword">from</span> <span class="hljs-string">'autofit.js'</span>;
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 初始化自适应</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAutofit</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">initAutofit</span>(<span class="hljs-params"/>) {
      autofit.<span class="hljs-title function_">init</span>({
        <span class="hljs-attr">designHeight</span>: <span class="hljs-number">1080</span>, <span class="hljs-comment">// 设计稿高度</span>
        <span class="hljs-attr">designWidth</span>: <span class="hljs-number">1920</span>,  <span class="hljs-comment">// 设计稿宽度</span>
        <span class="hljs-attr">renderDom</span>: <span class="hljs-string">"#app"</span>,  <span class="hljs-comment">// 渲染的容器ID</span>
        <span class="hljs-attr">resize</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 是否监听窗口变化</span>
        <span class="hljs-comment">// ignore: ['.map-container', '.no-scale'], // 忽略缩放的元素</span>
      });
    }
  },
  <span class="hljs-comment">// 落地细节：如果是单页应用，且只有某一个页面需要大屏适配，</span>
  <span class="hljs-comment">// 建议在 beforeDestroy 中关闭，防止影响其他管理后台页面</span>
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 注意：autofit 目前没有专门的 off() 方法，</span>
    <span class="hljs-comment">// 通常通过 window.onresize = null 或刷新页面处理，</span>
    <span class="hljs-comment">// 或者在 init 时动态判断路由。</span>
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 必须清除 body 的默认边距，防止计算偏移 */</span>
<span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span>, <span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">overflow</span>: hidden; <span class="hljs-comment">/* 大屏通常禁止滚动 */</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-20">3、 面试级进阶：如何在 Vue 2 中处理特殊情况？</h4>
<p>单纯引入代码只能算“会用”，能处理好以下三个问题才叫“落地”。</p>
<h5 data-id="heading-21">1. ECharts 的自适应配合</h5>
<p>虽然 autofit.js 缩放了容器，但 ECharts 内部的 Canvas 还是需要手动 Resize 才能保持高清。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在业务组件中</span>
<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span> = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">chartRef</span>);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleResize</span>);
},
<span class="hljs-attr">methods</span>: {
  <span class="hljs-title function_">handleResize</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 延迟执行，等待 autofit 缩放完成后再重绘图表</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">chart</span>.<span class="hljs-title function_">resize</span>();
    }, <span class="hljs-number">100</span>);
  }
}
</code></pre>
<h5 data-id="heading-22">2. 地图点击偏移（Ignore 参数的使用）</h5>
<p>如果你在 Vue 2 中集成了<strong>高德地图</strong>或<strong>百度地图</strong>，scale 会导致点击经纬度发生偏移。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 在 App.vue 的 init 中</span>
autofit.<span class="hljs-title function_ invoke__">init</span>({
  <span class="hljs-attr">renderDom</span>: <span class="hljs-string">"#app"</span>,
  <span class="hljs-attr">designHeight</span>: <span class="hljs-number">1080</span>,
  <span class="hljs-attr">designWidth</span>: <span class="hljs-number">1920</span>,
  <span class="hljs-attr">ignore</span>: [
    <span class="hljs-string">'.amap-container'</span>, // 忽略高德地图容器的整体缩放
    <span class="hljs-string">'.el-notification'</span> // 忽略 UI 库的通知弹窗（防止变形）
  ]
})
</code></pre>
<h5 data-id="heading-23">3. 动态设置适配开关（针对混合项目）</h5>
<p>如果你的 Vue 2 项目中，<strong>只有 /visual 路由是可视化大屏，其他路由是普通的管理后台</strong>。</p>
<p>codeJavaScript</p>
<pre><code class="hljs language-ini" lang="ini">// App.vue
watch: {
  $route(to) {
    if (<span class="hljs-attr">to.path</span> === <span class="hljs-string">'/visual'</span>) {
      autofit.init({ ... })<span class="hljs-comment">;</span>
    } else {
      // 退出大屏时，重置 transform，避免普通页面缩放
      const <span class="hljs-attr">dom</span> = document.querySelector(<span class="hljs-string">'#app'</span>)<span class="hljs-comment">;</span>
      if (dom) <span class="hljs-attr">dom.style.transform</span> = <span class="hljs-string">'none'</span><span class="hljs-comment">;</span>
      // 暴力方案：如果是混合项目，建议直接 window.location.reload() 或通过 CSS 变量隔离
    }
  }
}
</code></pre>
<hr/>
<h4 data-id="heading-24">4、 为什么在 Vue 2 里它比 REM 方案好？</h4>
<p>当面试官问你：“为什么你的 Vue 2 项目选择用 autofit.js 而不是传统的 lib-flexible？”</p>
<p><strong>你可以这样降维打击：</strong></p>
<ol>
<li><strong>开发效率</strong>： “REM 方案需要配置 postcss-pxtorem，在开发中看代码全是 rem 单位，调试时不直观。autofit.js 让我直接在 Vue 组件里写 px，标注图是多少我就写多少，大大提升了还原度。”</li>
<li><strong>视觉体验（黑边问题）</strong> ： “普通的 scale 方案在大屏长宽比不一致时会出现黑边。autofit.js 通过运行时计算，反向调整了逻辑宽高，填补了视口空白。在 Vue 2 这种生命周期明确的框架里，它能很好地在 mounted 时接管布局。”</li>
<li><strong>局部保护机制</strong>： “它提供的 ignore 机制解决了可视化项目中地图、Canvas 在全局缩放下的<strong>交互偏移</strong>难题。在 Vue 项目中，我可以很方便地通过 CSS 选择器将特定组件排除在缩放逻辑外，这是 REM 方案很难精细化控制的。”</li>
</ol>
<hr/>
<h4 data-id="heading-25">5、 补充：autofit.js 在 Vue 2 中的避坑点</h4>
<ul>
<li>
<p><strong>z-index 混乱</strong>：由于 autofit.js 使用了 transform，根据 CSS 规范，这会创建一个新的“层叠上下文”。如果你有 z-index 极高的弹窗挂载在 body 下，它可能会被 scale 容器遮挡。</p>
<ul>
<li><strong>解决</strong>：将所有弹窗通过 getContainer 或 append-to-body="false" 的方式挂载到 #app 内部。</li>
</ul>
</li>
<li>
<p><strong>计算精度</strong>：如果发现页面边缘有 1px 的缝隙，检查是否给容器加了 border，建议使用 box-shadow 代替外边框，避免占据计算位置。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-26">六、 自定义增强 Scale (企业级)</h3>
<p><strong>场景：</strong> 高端定制化大屏、GIS 深度集成项目。 <strong>优势：</strong> 坐标点对点精准、局部组件保护。</p>
<h4 data-id="heading-27">1. 落地步骤</h4>
<ol>
<li><strong>矩阵转换</strong>：不只是 scale，而是计算 matrix3d 进行补偿。</li>
<li><strong>局部缩放保护</strong>：通过全局状态管理（Vuex/Pinia）注入当前的 scale 值。</li>
</ol>
<h4 data-id="heading-28">2. 吊打面试官点：如何解决“地图交互坐标偏移”？</h4>
<p>“面试官，在大屏上使用 Echarts 或 Leaflet 地图时，缩放会导致鼠标点击位置和实际反馈点对不上。 <strong>我的方案是：</strong> 在点击事件触发时，<strong>手动对坐标执行逆矩阵运算</strong>。将 e.clientX 除以当前的 globalScale 比例。更高级的做法是使用 CSS 的 zoom 属性（虽然有兼容性问题，但在大屏特定的 Chrome 环境下很稳），因为它不会改变元素的物理坐标占据空间。”</p>
<hr/>
<h3 data-id="heading-29">总结：我的选型逻辑</h3>
<ul>
<li><strong>H5 活动页</strong>：VW + 1px 伪元素补偿（最顺应标准）。</li>
<li><strong>企业看板</strong>：Transform Scale + 背景平铺（成本最低，还原度最高）。</li>
<li><strong>高交互地图大屏</strong>：自定义 Scale + 坐标逆运算（解决交互偏差）。</li>
</ul>
<h3 data-id="heading-30">七、 flexible + rem详解</h3>
<p><strong>REM 方案不仅仅是一个 JS 脚本，它是一套包含：动态计算脚本 + 自动转换插件 + 边缘情况处理（1px 问题、最大宽度限制）的完整链路。</strong></p>
<p>以下是三种版本的工程级实现方案：</p>
<hr/>
<h4 data-id="heading-31">1、HTML 原生版本 (最底层的原理)</h4>
<p><strong>面试点：</strong> 为什么要放在  里？ <strong>回答：</strong> 为了在 DOM 渲染之前就计算好根字号，防止页面因字号突变导致的“闪烁（FOUC）”。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>REM落地方案<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">/**
         * 核心逻辑：1rem = 1/10 视口宽度
         * 设计稿 750px -&gt; 1rem = 75px
         */</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">setRem</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> designWidth = <span class="hljs-number">750</span>; <span class="hljs-comment">// 设计稿宽度</span>
            <span class="hljs-keyword">const</span> maxWidth = <span class="hljs-number">750</span>;    <span class="hljs-comment">// 最大宽度限制，防止在大屏（平板）上字号过大</span>
            <span class="hljs-keyword">let</span> width = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span>;
            
            <span class="hljs-keyword">if</span> (width &gt; maxWidth) width = maxWidth;
            
            <span class="hljs-comment">// 计算根字号：10rem 等于 100% 宽度</span>
            <span class="hljs-keyword">const</span> rem = width / <span class="hljs-number">10</span>;
            <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = rem + <span class="hljs-string">'px'</span>;
        }
        
        <span class="hljs-title function_">setRem</span>();
        <span class="hljs-comment">// 监听窗口变化和旋转</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, setRem);
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'pageshow'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">persisted</span>) <span class="hljs-title function_">setRem</span>(); <span class="hljs-comment">// 解决部分手机后退不刷新的问题</span>
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-comment">/* 落地细节：body 必须重置字号，否则会继承 html 的巨大字号 */</span>
        <span class="hljs-selector-tag">body</span> {
            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
        }
        <span class="hljs-selector-class">.box</span> {
            <span class="hljs-comment">/* 若设计稿宽度 750px，盒宽 375px，则写 5rem */</span>
            <span class="hljs-attribute">width</span>: <span class="hljs-number">5rem</span>;
            <span class="hljs-attribute">height</span>: <span class="hljs-number">2rem</span>;
            <span class="hljs-attribute">background</span>: <span class="hljs-number">#007bff</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-32">2、 Vue 3 + Vite 工程版本 (生产级)</h4>
<p>在 Vue 项目中，你不需要手动写 JS 计算逻辑，通常使用成熟的 amfe-flexible，并配合 PostCSS 自动转换。</p>
<h5 data-id="heading-33">1. 安装依赖</h5>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> amfe-flexible
npm <span class="hljs-selector-tag">i</span> postcss-pxtorem -D
</code></pre>
<h5 data-id="heading-34">2. 入口引入 (main.ts)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'amfe-flexible'</span> <span class="hljs-comment">// 自动在html注入font-size</span>
​
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h5 data-id="heading-35">3. 配置 Vite (vite.config.ts)</h5>
<p><strong>面试点：</strong> “我配置了 selectorBlackList 来避免 UI 组件库（如 Vant）的尺寸也被缩小。”</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> postCssPxToRem <span class="hljs-keyword">from</span> <span class="hljs-string">'postcss-pxtorem'</span>
​
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">css</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">postCssPxToRem</span>({
          <span class="hljs-attr">rootValue</span>: <span class="hljs-number">75</span>, <span class="hljs-comment">// 设计稿 750px，1rem = 75px</span>
          <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>], <span class="hljs-comment">// 所有属性都转换</span>
          <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'.norem'</span>], <span class="hljs-comment">// 过滤掉不需要转换的类名</span>
          <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/i</span> <span class="hljs-comment">// 排除第三方库，如果要适配 Vant 则不加这行</span>
        })
      ]
    }
  }
})
</code></pre>
<hr/>
<h4 data-id="heading-36">3、 React + Webpack/CRA 版本 (兼容性处理)</h4>
<p>在 React 体系中，如果是使用 Ant Design Mobile，适配方案略有不同。</p>
<h5 data-id="heading-37">1. 安装依赖</h5>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> amfe-flexible
npm <span class="hljs-selector-tag">i</span> postcss-pxtorem -D
</code></pre>
<h5 data-id="heading-38">2. 入口引入 (index.js)</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">'amfe-flexible'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;
</code></pre>
<h5 data-id="heading-39">3. 修改配置 (通过 craco 或 eject)</h5>
<p>React 项目通常不暴露 Webpack 配置，推荐使用 @craco/craco。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// craco.config.js</span>
<span class="hljs-keyword">const</span> pxToRem = <span class="hljs-built_in">require</span>(<span class="hljs-string">'postcss-pxtorem'</span>);
​
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">style</span>: {
    <span class="hljs-attr">postcss</span>: {
      <span class="hljs-attr">mode</span>: <span class="hljs-string">'extends'</span>,
      <span class="hljs-attr">loaderOptions</span>: {
        <span class="hljs-attr">postcssOptions</span>: {
          <span class="hljs-attr">ident</span>: <span class="hljs-string">'postcss'</span>,
          <span class="hljs-attr">plugins</span>: [
            <span class="hljs-title function_">pxToRem</span>({
              <span class="hljs-attr">rootValue</span>: <span class="hljs-number">75</span>,
              <span class="hljs-attr">propList</span>: [<span class="hljs-string">'*'</span>],
              <span class="hljs-comment">// 特别注意：针对 antd-mobile，它的设计稿是 375</span>
              <span class="hljs-comment">// 如果你的设计稿是 750，需要在这里做逻辑判断</span>
              <span class="hljs-attr">exclude</span>: <span class="hljs-regexp">/node_modules/</span>antd-mobile/i 
            }),
          ],
        },
      },
    },
  },
};
</code></pre>
<hr/>
<h4 data-id="heading-40">4、 深度进阶：吊打面试官的 4 个落地细节</h4>
<p>如果你能在回答完以上代码后，补充以下几点，面试官会觉得你是有<strong>大型项目落地经验</strong>的：</p>
<h5 data-id="heading-41">1. 解决 1px 边框变粗问题</h5>
<p><strong>问题：</strong> 750 设计稿上的 1px，在手机上会变成 0.5 物理像素，但 CSS 写的 1px 在高清屏下显得很粗。 <strong>解法：</strong> 使用伪元素 + transform: scaleY(0.5)。</p>
<p>codeCSS</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.hairline-border</span> {
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.hairline-border</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200%</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">200%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h5 data-id="heading-42">2. 解决 Canvas 渲染模糊</h5>
<p><strong>问题：</strong> 在 REM 布局下，Canvas 画布内部坐标系会失真。 <strong>解法：</strong> 必须手动获取 window.devicePixelRatio（DPR），并在绘制前将 Canvas 的 width 和 height 属性放大 DPR 倍，再用 CSS 缩回来。</p>
<h5 data-id="heading-43">3. 字体不推荐用 REM</h5>
<p><strong>面试点：</strong> “虽然宽度用了 REM，但我通常建议字体大小使用 px 配合媒体查询，或者直接用 px。因为我们不希望在大屏幕上看到巨大的文字，而是希望看到更多的内容。”</p>
<h5 data-id="heading-44">4. 解决“页面瞬间闪烁”</h5>
<p><strong>终极回答：</strong> “在 Vite/Webpack 构建时，我会将计算 rem 的内联脚本直接注入到 index.html 的 HTML 标签之前（利用 html-webpack-plugin 或 vite-plugin-html），而不是等待 JS Bundle 加载。这样可以确保在首屏绘制时，rem 基准值已经就绪。”</p>
<h3 data-id="heading-45">八、 vw vh详解</h3>
<h4 data-id="heading-46">1、 核心原理：舍弃 JS，回归原生</h4>
<p>VW (Viewport Width) 和 VH (Viewport Height) 是 CSS3 提供的原生单位。</p>
<ul>
<li><strong>1vw</strong> = 视口宽度的 1%</li>
<li><strong>1vh</strong> = 视口高度的 1%</li>
<li><strong>本质</strong>：它直接将设计稿的像素（px）映射为视口的百分比，不再需要像 REM 那样通过 JS 动态修改根字号，<strong>减少了主线程的计算开销，彻底杜绝了页面闪烁（FOUC）</strong> 。</li>
</ul>
<hr/>
<h4 data-id="heading-47">2、 移动端 H5 落地方案（工程化）</h4>
<p>在 H5 开发中，手动计算 100 / 750 * 100 = 13.333vw 是极其低效的。我们通过 <strong>PostCSS 自动化流水线</strong> 来解决。</p>
<h5 data-id="heading-48">1. 核心插件配置 (Vue/React 通用)</h5>
<p>目前最主流的是 postcss-px-to-viewport-8-plugin（兼容性最好）。</p>
<p><strong>安装：</strong></p>
<pre><code class="hljs language-css" lang="css">npm install postcss-px-<span class="hljs-selector-tag">to</span>-viewport-<span class="hljs-number">8</span>-plugin -D
</code></pre>
<p><strong>PostCSS 配置 (postcss.config.js)：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: {
    <span class="hljs-string">'postcss-px-to-viewport-8-plugin'</span>: {
      <span class="hljs-attr">viewportWidth</span>: <span class="hljs-number">750</span>,      <span class="hljs-comment">// 设计稿宽度 (iPhone 2倍图)</span>
      <span class="hljs-attr">unitPrecision</span>: <span class="hljs-number">3</span>,        <span class="hljs-comment">// 转换后的精度，保留3位小数</span>
      <span class="hljs-attr">viewportUnit</span>: <span class="hljs-string">'vw'</span>,      <span class="hljs-comment">// 转换成的单位</span>
      <span class="hljs-attr">selectorBlackList</span>: [<span class="hljs-string">'.ignore-vw'</span>], <span class="hljs-comment">// 不转换的类名</span>
      <span class="hljs-attr">minPixelValue</span>: <span class="hljs-number">1</span>,        <span class="hljs-comment">// 小于或等于 1px 不转换</span>
      <span class="hljs-attr">mediaQuery</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 允许在媒体查询中转换 px</span>
      <span class="hljs-attr">exclude</span>: [<span class="hljs-regexp">/node_modules/</span>], <span class="hljs-comment">// 排除 UI 库（如果 UI 库是按 375 设计的）</span>
    }
  }
}
</code></pre>
<h5 data-id="heading-49">2. 面试必杀点：解决“平板大屏”失真问题</h5>
<p><strong>痛点</strong>：如果用户用 iPad 打开 750px 的 H5 页面，100vw 会导致 UI 被无限拉大。 <strong>解法</strong>：设置最大宽度限制。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 给 body 设置最大宽度，并水平居中 */</span>
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">540px</span>; <span class="hljs-comment">/* 经验值：超过此宽度不再随屏幕放大 */</span>
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}
<span class="hljs-comment">/* 核心：利用 CSS 变量动态锁定宽度 */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--app-width</span>: <span class="hljs-number">100vw</span>;
}
<span class="hljs-keyword">@media</span> screen <span class="hljs-keyword">and</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">540px</span>) {
  <span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--app-width</span>: <span class="hljs-number">540px</span>;
  }
}
<span class="hljs-comment">/* 页面容器引用此变量 */</span>
<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--app-width);
}
</code></pre>
<hr/>
<h4 data-id="heading-50">3、 大屏自适应方案（比例锁定流）</h4>
<p>在大屏项目中，单纯用 vw 会导致：如果屏幕很宽但很矮，内容会超出底部。 <strong>吊打面试官的方案：利用 vmin 实现等比缩放。</strong></p>
<h5 data-id="heading-51">1. 什么是 vmin？</h5>
<ul>
<li>vmin：取 vw 和 vh 中<strong>较小</strong>的一个。</li>
<li><strong>原理</strong>：在大屏中，无论屏幕如何变形，我们始终保证内容按照设计稿的比例（如 16:9）<strong>缩放在屏幕内部且不溢出</strong>。</li>
</ul>
<h5 data-id="heading-52">2. 大屏 CSS 落地逻辑：</h5>
<p>假设设计稿是 1920x1080 (16:9)。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 定义 SCSS 函数自动转换</span>
$design-<span class="hljs-attribute">width</span>: <span class="hljs-number">1920</span>;
$design-<span class="hljs-attribute">height</span>: <span class="hljs-number">1080</span>;
​
<span class="hljs-variable">@function</span> <span class="hljs-built_in">px2vmin</span>($px) {
  <span class="hljs-comment">// 核心逻辑：基于最小边进行缩放</span>
  <span class="hljs-variable">@return</span> ($px / $design-width) * <span class="hljs-number">100vmin</span>;
}
​
.big-screen-box {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">px2vmin</span>(<span class="hljs-number">400</span>);  <span class="hljs-comment">// 无论窗口怎么变，它始终占据屏幕宽度的固定比例</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">px2vmin</span>(<span class="hljs-number">300</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.8</span>);
}
</code></pre>
<hr/>
<h4 data-id="heading-53">4、 VW 方案的“三大毒瘤”及解法</h4>
<p>面试官必问： <strong>“VW 方案有什么缺陷？”</strong> 你要是能答出这三点，稳了。</p>
<h5 data-id="heading-54">1. 1px 像素问题</h5>
<p><strong>现象</strong>：1px 在转换成 vw 后，由于精度问题可能导致线条消失。 <strong>解法</strong>：</p>
<ul>
<li>在插件配置中设置 minPixelValue: 1，保证 1px 永远是 1px。</li>
<li>使用 transform: scaleY(0.5) 手动处理 Retina 屏的高清边框。</li>
</ul>
<h5 data-id="heading-55">2. 纵横比失效 (Aspect Ratio)</h5>
<p><strong>现象</strong>：图片原本是正方形，容器宽高都写成 vw，在非标比例屏幕上可能变长方形。 <strong>解法</strong>：使用 CSS 新属性 aspect-ratio。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card-img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20vw</span>;
  aspect-ratio: <span class="hljs-number">1</span> / <span class="hljs-number">1</span>; <span class="hljs-comment">/* 强制锁定宽高比为 1:1，不再需要写 height */</span>
  <span class="hljs-attribute">object-fit</span>: cover;
}
</code></pre>
<h5 data-id="heading-56">3. 兼容性降级 (非常极端的情况)</h5>
<p><strong>现象</strong>：虽然几率极低，但如果要求兼容老旧 WebView。 <strong>解法</strong>：使用 viewport-units-buggyfill 插件，它会自动把 vw 转换成基于 JS 计算的像素值。</p>
<h3 data-id="heading-57">九、 详解 Transform Scale</h3>
<h4 data-id="heading-58">1、 Transform Scale 标准方案：基础落地</h4>
<h5 data-id="heading-59">1. 实现过程</h5>
<ul>
<li><strong>第一步（设计稿）：</strong> 统一按 1920x1080px（或 3840x2160）出图。</li>
<li><strong>第二步（开发）：</strong> 页面所有元素直接按 px 写死，不写相对单位。</li>
<li><strong>第三步（缩放）：</strong> 编写 JS 动态计算窗口与设计稿的比例，应用到主容器。</li>
</ul>
<h5 data-id="heading-60">2. HTML 模板</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background: #000; overflow: hidden;"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 大屏主容器，固定宽高 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"big-screen"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 1920px; height: 1080px; transform-origin: 0 0; background: url('bg.png');"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart"</span>&gt;</span>这里是图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleScale</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> designWidth = <span class="hljs-number">1920</span>;
    <span class="hljs-keyword">const</span> designHeight = <span class="hljs-number">1080</span>;
    <span class="hljs-comment">// 计算缩放比例，取宽高中较小的一个，确保内容能完整显示</span>
    <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / designWidth, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> / designHeight);
    <span class="hljs-keyword">const</span> screenDom = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#big-screen'</span>);
    
    <span class="hljs-comment">// 应用缩放，并居中显示</span>
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`scale(<span class="hljs-subst">${scale}</span>)`</span>;
    <span class="hljs-comment">// 计算居中偏移量（如果不需要黑边居中，可以去掉这部分）</span>
    <span class="hljs-keyword">const</span> left = (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> - designWidth * scale) / <span class="hljs-number">2</span>;
    <span class="hljs-keyword">const</span> top = (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - designHeight * scale) / <span class="hljs-number">2</span>;
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">`<span class="hljs-subst">${left}</span>px`</span>;
    screenDom.<span class="hljs-property">style</span>.<span class="hljs-property">marginTop</span> = <span class="hljs-string">`<span class="hljs-subst">${top}</span>px`</span>;
  }
  
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = handleScale;
  <span class="hljs-title function_">handleScale</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<hr/>
<h4 data-id="heading-61">2、 标准方案的 3 个致命坑及解决方案</h4>
<ol>
<li>
<p><strong>坑一：边缘黑边。</strong></p>
<ul>
<li><strong>现象：</strong> 当屏幕宽高比与 16:9 不同时，上下或左右会出现难看的黑条。</li>
<li><strong>方案：</strong> 见下方的“升级方案一”。</li>
</ul>
</li>
<li>
<p><strong>坑二：文字和 Echarts 图表模糊。</strong></p>
<ul>
<li><strong>现象：</strong> scale 属于位图缩放，当缩放倍数较小时，文字和图表边缘有毛刺。</li>
<li><strong>方案：</strong> Echarts 渲染器切换为 svg 模式（echarts.init(dom, null, {renderer: 'svg'})）；对于文字，使用 initial-scale 优化或设置 text-rendering: optimizeLegibility;。</li>
</ul>
</li>
<li>
<p><strong>坑三：地图点击坐标偏移。</strong></p>
<ul>
<li><strong>现象：</strong> 在缩放后的容器内使用 Leaflet 或原生鼠标事件，点击位置对不上。</li>
<li><strong>方案：</strong> 见下方的“升级方案二”。</li>
</ul>
</li>
</ol>
<hr/>
<h4 data-id="heading-62">3、 升级方案一：铺满全屏 + 逻辑留白（视觉完美版）</h4>
<p><strong>场景：</strong> 甲方不能接受黑边，但要求图表不拉伸。</p>
<ul>
<li>
<p><strong>思路：</strong> 背景图（Theme Background）<strong>拉伸铺满</strong>全屏，而真正的内容容器（Content）保持<strong>等比缩放</strong>。</p>
</li>
<li>
<p><strong>实现步骤：</strong></p>
<ol>
<li>body 设置一张 4K 的星空/科技感背景图，设置为 background-size: 100% 100%。</li>
<li>内部内容容器（设计稿尺寸）依然用 scale 缩放并居中。</li>
<li><strong>吊打面试官点：</strong> “我通过<strong>双层容器法</strong>解决了黑边痛点。外层容器负责用 CSS 绘制充满科技感的底图和流动边框，这些不怕拉伸；内层容器承载精密数据，保持 Scale 等比，这样在任何屏幕上都像是一个完整的沉浸式系统。”</li>
</ol>
</li>
</ul>
<hr/>
<h4 data-id="heading-63">4、 升级方案二：局部补偿算法（企业级高要求版）</h4>
<p><strong>场景：</strong> 页面里有地图（GIS）、实时监控视频、或者需要在缩放后依然保持 1:1 像素精度的 UI 元素。</p>
<ul>
<li>
<p><strong>思路：</strong> 在全局缩放的基础上，对特定组件执行“逆缩放”。</p>
</li>
<li>
<p><strong>实现步骤：</strong></p>
<ol>
<li>获取全局缩放值 S。</li>
<li>对地图容器应用 transform: scale(1/S)。</li>
<li>手动调整该组件的宽高，使其在视觉上看起来恢复了原始大小，但内部渲染是点对点的。</li>
</ol>
</li>
</ul>
<h4 data-id="heading-64"><strong>【HTML 模板】</strong></h4>
<pre><code class="hljs language-ini" lang="ini">// 核心逻辑：反向补偿
const <span class="hljs-attr">globalScale</span> = getScale()<span class="hljs-comment">; // 假设当前缩放了 0.5</span>
​
// 针对地图组件
const <span class="hljs-attr">mapDom</span> = document.querySelector(<span class="hljs-string">'#gis-map'</span>)<span class="hljs-comment">;</span>
// 1. 放大两倍抵消全局的 0.5，这样地图内部渲染就是 100% 清晰的
<span class="hljs-attr">mapDom.style.transform</span> = `scale(<span class="hljs-variable">${1 / globalScale}</span>)`<span class="hljs-comment">;</span>
// 2. 必须同步修改宽高，否则地图显示区域会缩水
<span class="hljs-attr">mapDom.style.width</span> = `<span class="hljs-variable">${originalWidth * globalScale}</span>px`<span class="hljs-comment">;</span>
<span class="hljs-attr">mapDom.style.height</span> = `<span class="hljs-variable">${originalHeight * globalScale}</span>px`<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>
<p><strong>吊打面试官点：</strong></p>
<ul>
<li>“面试官，单纯的 Scale 会导致交互坐标偏移。在做 <strong>高精度 GIS 交互</strong> 时，我会重写坐标计算逻辑：const realX = e.clientX / currentScale。</li>
<li>更高级的解决办法是：在大屏常用的 Chrome 环境下，我会优先使用 zoom 属性替代 transform: scale。因为 zoom 是真实的空间缩放，浏览器会自动处理鼠标事件的坐标转换，不会产生偏移，且不会触发 BFC 异常。”</li>
</ul>
</li>
</ul>
<hr/>
<h4 data-id="heading-65">5、 两种升级方案对比选型</h4>























<table><thead><tr><th>方案</th><th>核心技术</th><th>解决的问题</th><th>适合场景</th></tr></thead><tbody><tr><td><strong>升级方案一 (Padding-Fill)</strong></td><td>双层布局 + 居中 Scale</td><td>彻底消除黑边，视觉一致性强</td><td>多数常规数据可视化看板</td></tr><tr><td><strong>升级方案二 (Inversed Scale)</strong></td><td>反向缩放 + 坐标校正</td><td>解决地图模糊、点击偏移、视频拉伸</td><td>智慧城市、GIS 地图、公安指挥中心</td></tr></tbody></table>
<p><strong>总结实现流程：</strong></p>
<ol>
<li>
<p><strong>拿到设计稿：</strong> 确认是 1920 还是 16:10（如 1920x1200）。</p>
</li>
<li>
<p><strong>基础开发：</strong> 使用 px 配合百分比或 Flex 完成基础布局。</p>
</li>
<li>
<p><strong>注入 Scale：</strong> 使用脚本控制 #app 缩放。</p>
</li>
<li>
<p><strong>避坑检查：</strong></p>
<ul>
<li>检查图表文字是否模糊 -&gt; 切换 SVG 渲染。</li>
<li>检查地图点击准不准 -&gt; 执行 1/S 坐标补偿。</li>
<li>检查两侧是否有黑边 -&gt; 外层铺满背景图遮瑕。</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展]]></title>    <link>https://juejin.cn/post/7599852636529016867</link>    <guid>https://juejin.cn/post/7599852636529016867</guid>    <pubDate>2026-01-27T07:37:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599852636529016867" data-draft-id="7599845683121963048" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2026-01-27T07:37:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:37:39.000Z" title="Tue Jan 27 2026 07:37:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MyBatis-Plus Mapper 完全指南：从基础用法到高级扩展</h2>
<p>在MyBatis-Plus（MP）的技术体系中，Mapper层是持久层的核心载体，承接业务层请求与数据库操作，既是MP自动化能力的入口，也是自定义SQL的落地载体。相较于原生MyBatis的Mapper，MP的Mapper通过BaseMapper接口封装了全量单表CRUD方法，同时支持灵活扩展自定义逻辑，大幅降低了持久层代码量。本文将从基础用法、自定义扩展、进阶技巧、避坑指南四个维度，拆解MP Mapper的完整使用流程，助力开发者精准掌握这一核心组件。</p>
<h3 data-id="heading-1">一、MP Mapper 核心基础：BaseMapper 接口详解</h3>
<p>MP的核心优势之一，就是通过<code>BaseMapper&lt;T&gt;</code>接口提供了开箱即用的单表CRUD方法，开发者只需让自定义Mapper接口继承该接口，无需编写任何方法体，即可获得完整的单表操作能力。这一设计彻底解决了原生MyBatis中单表操作SQL冗余、方法重复定义的问题。</p>
<h4 data-id="heading-2">1. BaseMapper 核心方法分类与使用示例</h4>
<p>BaseMapper接口包含30+个单表操作方法，覆盖新增、删除、修改、查询四大场景，以下按高频场景分类说明，结合Order实体类演示用法（实体类定义参考前文，此处略）。</p>
<h5 data-id="heading-3">（1）新增操作</h5>
<p>核心方法：<code>int insert(T entity)</code>，自动将实体类属性映射为数据库字段，生成INSERT语句，支持主键自动填充（如雪花算法、自增）。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// OrderMapper接口（仅需继承BaseMapper）</span>
public interface OrderMapper extends BaseMapper&lt;<span class="hljs-attribute">Order</span>&gt; {}

<span class="hljs-comment">// 业务层调用</span>
<span class="hljs-keyword">@Service</span>
public class OrderServiceImpl {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMapper orderMapper;

    public void <span class="hljs-built_in">addOrder</span>() {
        <span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderNo</span>("ORDER20260128001");
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setUserId</span>(<span class="hljs-number">1002</span>L);
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setAmount</span>(new BigDecimal("<span class="hljs-number">299.00</span>"));
        <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">0</span>);
        <span class="hljs-comment">// 调用BaseMapper的insert方法，返回受影响行数</span>
        int rows = orderMapper<span class="hljs-selector-class">.insert</span>(order);
        System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>("新增成功，影响行数：" + rows);
    }
}
</code></pre>
<p>注意：主键生成策略由全局配置或实体类@TableId注解指定（如ASSIGN_ID雪花算法、AUTO自增），插入后实体类会自动回显主键值。</p>
<h5 data-id="heading-4">（2）删除操作</h5>
<p>提供按主键删除、按条件删除两类方法，支持单条、批量删除，结合逻辑删除配置可实现假删除。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 按主键删除（单条）</span>
orderMapper<span class="hljs-selector-class">.deleteById</span>(<span class="hljs-number">1</span>L);

<span class="hljs-comment">// 2. 批量按主键删除</span>
List&lt;Long&gt; ids = Arrays<span class="hljs-selector-class">.asList</span>(<span class="hljs-number">1</span>L, <span class="hljs-number">2</span>L, <span class="hljs-number">3</span>L);
orderMapper<span class="hljs-selector-class">.deleteBatchIds</span>(ids);

<span class="hljs-comment">// 3. 按条件删除（QueryWrapper/LambdaQueryWrapper）</span>
LambdaQueryWrapper&lt;<span class="hljs-attribute">Order</span>&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
wrapper<span class="hljs-selector-class">.eq</span>(Order::getUserId, <span class="hljs-number">1002</span>L)
       <span class="hljs-selector-class">.lt</span>(Order::getCreateTime, LocalDateTime.of(<span class="hljs-number">2026</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>));
orderMapper<span class="hljs-selector-class">.delete</span>(wrapper); <span class="hljs-comment">// 删除指定用户2026年前的订单</span>
</code></pre>
<h5 data-id="heading-5">（3）修改操作</h5>
<p>支持按主键更新、按条件更新，可选择更新全部字段或非空字段，适配不同业务场景。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 按主键更新（更新非空字段，推荐）</span>
<span class="hljs-attribute">Order</span> <span class="hljs-attribute">order</span> = new <span class="hljs-attribute">Order</span>();
<span class="hljs-attribute">order</span><span class="hljs-selector-class">.setId</span>(<span class="hljs-number">1</span>L);
<span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStatus</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 仅更新状态字段</span>
orderMapper<span class="hljs-selector-class">.updateById</span>(order);

<span class="hljs-comment">// 2. 按条件更新（更新指定字段）</span>
UpdateWrapper&lt;<span class="hljs-attribute">Order</span>&gt; updateWrapper = new UpdateWrapper&lt;&gt;();
updateWrapper<span class="hljs-selector-class">.eq</span>("user_id", <span class="hljs-number">1002</span>L)
             <span class="hljs-selector-class">.set</span>("status", <span class="hljs-number">2</span>) <span class="hljs-comment">// 强制更新状态为2</span>
             <span class="hljs-selector-class">.set</span>("update_time", LocalDateTime.now());
orderMapper<span class="hljs-selector-class">.update</span>(null, updateWrapper);

<span class="hljs-comment">// 3. Lambda方式按条件更新（类型安全）</span>
LambdaUpdateWrapper&lt;<span class="hljs-attribute">Order</span>&gt; lambdaWrapper = new LambdaUpdateWrapper&lt;&gt;();
lambdaWrapper<span class="hljs-selector-class">.eq</span>(Order::getUserId, <span class="hljs-number">1002</span>L)
             <span class="hljs-selector-class">.set</span>(Order::getStatus, <span class="hljs-number">2</span>);
orderMapper<span class="hljs-selector-class">.update</span>(null, lambdaWrapper);
</code></pre>
<h5 data-id="heading-6">（4）查询操作</h5>
<p>覆盖单条查询、列表查询、分页查询、条件查询等场景，支持Lambda表达式构造条件，避免字段名硬编码。</p>
<pre><code class="hljs language-ini" lang="ini">// 1. 按主键查询单条
Order <span class="hljs-attr">order</span> = orderMapper.selectById(<span class="hljs-number">1</span>L)<span class="hljs-comment">;</span>

// 2. 批量按主键查询
List&lt;Long&gt; <span class="hljs-attr">ids</span> = Arrays.asList(<span class="hljs-number">1</span>L, <span class="hljs-number">2</span>L)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">orderList</span> = orderMapper.selectBatchIds(ids)<span class="hljs-comment">;</span>

// 3. 按条件查询列表（Lambda方式）
LambdaQueryWrapper&lt;Order&gt; <span class="hljs-attr">wrapper</span> = new LambdaQueryWrapper&lt;&gt;()<span class="hljs-comment">;</span>
wrapper.eq(Order::getUserId, 1002L)
       .eq(Order::getStatus, 1)
       .orderByDesc(Order::getCreateTime)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">paidOrders</span> = orderMapper.selectList(wrapper)<span class="hljs-comment">;</span>

// 4. 分页查询（需配合MP分页插件）
Page&lt;Order&gt; <span class="hljs-attr">page</span> = new Page&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">; // 第1页，每页10条</span>
IPage&lt;Order&gt; <span class="hljs-attr">orderPage</span> = orderMapper.selectPage(page, wrapper)<span class="hljs-comment">;</span>
List&lt;Order&gt; <span class="hljs-attr">records</span> = orderPage.getRecords()<span class="hljs-comment">; // 分页数据</span>
long <span class="hljs-attr">total</span> = orderPage.getTotal()<span class="hljs-comment">; // 总条数</span>

// 5. 查询单条记录（无数据返回null，多条数据抛异常）
Order <span class="hljs-attr">singleOrder</span> = orderMapper.selectOne(wrapper)<span class="hljs-comment">;</span>

// 6. 查询条数
long <span class="hljs-attr">count</span> = orderMapper.selectCount(wrapper)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-7">2. Mapper 扫描配置：让Spring识别Mapper接口</h4>
<p>MP Mapper接口需被Spring扫描才能注入使用，有两种常用配置方式，按需选择即可。</p>
<h5 data-id="heading-8">（1）启动类添加@MapperScan注解（推荐）</h5>
<p>在Spring Boot启动类上指定Mapper接口所在包，批量扫描所有Mapper，无需在每个Mapper上添加@Mapper注解。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@SpringBootApplication</span>
<span class="hljs-comment">// 扫描com.example.mp.mapper包下所有Mapper接口</span>
<span class="hljs-variable">@MapperScan</span>(<span class="hljs-string">"com.example.mp.mapper"</span>)
public class MyBatisPlusDemoApplication {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-selector-tag">SpringApplication</span><span class="hljs-selector-class">.run</span>(MyBatisPlusDemoApplication.class, args);
    }
}
</code></pre>
<h5 data-id="heading-9">（2）单个Mapper接口添加@Mapper注解</h5>
<p>适用于Mapper接口分散在不同包的场景，需在每个自定义Mapper接口上添加@Mapper注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 单个Mapper添加@Mapper注解</span>
<span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Order&gt; {}
</code></pre>
<p>避坑提醒：避免同时使用两种方式，且确保@MapperScan注解的包路径准确，否则会导致Mapper无法注入，抛出NoSuchBeanDefinitionException异常。</p>
<h3 data-id="heading-10">二、自定义 Mapper：突破单表限制，扩展业务逻辑</h3>
<p>BaseMapper仅覆盖单表操作，实际业务中难免需要多表关联、复杂条件查询等场景，此时需通过自定义方法扩展Mapper。MP支持两种自定义方式：XML文件编写SQL、注解编写SQL，可根据场景灵活选择。</p>
<h4 data-id="heading-11">1. XML方式自定义Mapper（推荐复杂SQL场景）</h4>
<p>XML方式适合SQL逻辑复杂、需动态拼接的场景，保持Java代码与SQL分离，便于维护。步骤如下：</p>
<h5 data-id="heading-12">（1）配置XML文件路径</h5>
<p>在application.yml中指定Mapper XML文件的存放路径，MP会自动扫描该路径下的XML文件。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/**/*.xml</span> <span class="hljs-comment"># 扫描resources/mapper下所有XML文件</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.mp.entity</span> <span class="hljs-comment"># 实体类别名包，XML中可省略全类名</span>
</code></pre>
<h5 data-id="heading-13">（2）Mapper接口定义自定义方法</h5>
<p>在OrderMapper接口中添加自定义方法，方法名需与XML中SQL的id一致。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 自定义：关联用户表查询订单详情（多表关联）</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">OrderVO</span>&gt; <span class="hljs-selector-tag">selectOrderVOList</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"userId"</span>) Long userId, 
                                     <span class="hljs-variable">@Param</span>(<span class="hljs-string">"status"</span>) Integer status);
    
    <span class="hljs-comment">// 自定义：动态条件查询订单（结合XML动态SQL）</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; <span class="hljs-selector-tag">selectOrderByDynamicCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"wrapper"</span>) QueryWrapper&lt;Order&gt; wrapper);
}
</code></pre>
<p>说明：@Param注解用于指定参数名，便于XML中引用；若参数为条件构造器（QueryWrapper/LambdaQueryWrapper），可直接传入XML使用。</p>
<h5 data-id="heading-14">（3）编写XML文件实现SQL</h5>
<p>在resources/mapper目录下创建OrderMapper.xml，编写自定义SQL，命名空间需与Mapper接口全类名一致。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mp.mapper.OrderMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 关联查询：返回OrderVO对象 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectOrderVOList"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.example.mp.vo.OrderVO"</span>&gt;</span>
        SELECT 
            o.id, o.order_no, o.amount, o.status, 
            u.id AS user_id, u.username, u.phone
        FROM t_order o
        LEFT JOIN t_user u ON o.user_id = u.id
        WHERE 1=1
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"userId != null"</span>&gt;</span>
            AND o.user_id = #{userId}
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"status != null"</span>&gt;</span>
            AND o.status = #{status}
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        AND o.deleted = 0
        ORDER BY o.create_time DESC
    &lt;/select<span class="hljs-symbol">&amp;gt;</span>

    <span class="hljs-comment">&lt;!-- 动态条件查询：复用MP条件构造器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectOrderByDynamicCondition"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"Order"</span>&gt;</span>
        SELECT * FROM t_order
        <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span>
            ${wrapper.sqlSegment} <span class="hljs-comment">&lt;!-- 直接引用QueryWrapper的SQL片段 --&gt;</span>
            AND deleted = 0
        <span class="hljs-symbol">&amp;lt;</span>/where<span class="hljs-symbol">&amp;gt;</span>
    <span class="hljs-symbol">&amp;lt;</span>/select<span class="hljs-symbol">&amp;gt;</span>
<span class="hljs-symbol">&amp;lt;</span>/mapper<span class="hljs-symbol">&amp;gt;</span>
</code></pre>
<h4 data-id="heading-15">2. 注解方式自定义Mapper（适合简单SQL场景）</h4>
<p>对于逻辑简单的SQL，可直接通过MP提供的注解（@Select、@Insert、@Update、@Delete）在Mapper接口方法上编写，无需XML文件，简洁高效。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 注解方式：查询指定用户的已支付订单</span>
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT * FROM t_order WHERE user_id = #{userId} AND status = 1 AND deleted = 0"</span>)
    List&lt;Order&gt; <span class="hljs-built_in">selectPaidOrdersByUserId</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"userId"</span>) Long userId);

    <span class="hljs-comment">// 注解方式：动态SQL（结合MP的@SqlParser注解，可选）</span>
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"&lt;script&gt;"</span> +
            <span class="hljs-string">"SELECT * FROM t_order WHERE deleted = 0"</span> +
            <span class="hljs-string">"&lt;if test='status != null'&gt; AND status = #{status} &lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;if test='startTime != null'&gt; AND create_time &gt;= #{startTime} &lt;/if&gt;"</span> +
            <span class="hljs-string">"&lt;/script&gt;"</span>)
    List&lt;Order&gt; <span class="hljs-built_in">selectOrdersByCondition</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"status"</span>) Integer status,
                                        <span class="hljs-variable">@Param</span>(<span class="hljs-string">"startTime"</span>) LocalDateTime startTime);
}
</code></pre>
<p>说明：注解中编写动态SQL需用
</p><h3 data-id="heading-16">三、Mapper 进阶技巧：提升开发效率与性能</h3>
<h4 data-id="heading-17">1. 批量操作优化：减少数据库交互次数</h4>
<p>BaseMapper提供的<code>insertBatchIds</code>、<code>deleteBatchIds</code>方法虽支持批量操作，但底层仍可能分多次执行SQL。对于大量数据批量插入/更新，可通过以下方式优化：</p>
<h5 data-id="heading-18">（1）使用MP自带批量操作方法（基础版）</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 批量插入：推荐每批次500-1000条，避免单次插入过多数据</span>
List&lt;<span class="hljs-attribute">Order</span>&amp;gt; orderList = new ArrayList&lt;&gt;();
<span class="hljs-comment">// 填充orderList数据...</span>
orderMapper<span class="hljs-selector-class">.insertBatchIds</span>(orderList);
</code></pre>
<h5 data-id="heading-19">（2）配置JDBC批量提交（进阶版）</h5>
<p>结合Druid连接池配置批量提交参数，让MP批量操作底层复用连接，减少网络开销。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-comment"># 开启JDBC批量提交</span>
      <span class="hljs-attr">batch-open-result-set:</span> <span class="hljs-literal">true</span>
      <span class="hljs-comment"># 批量操作提交阈值</span>
      <span class="hljs-attr">connection-properties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000;druid.batch.openResultSet=true</span>
</code></pre>
<h4 data-id="heading-20">2. 结果映射：解决字段不匹配与复杂返回值</h4>
<p>当实体类字段与数据库字段不一致，或查询返回多表关联结果时，可通过结果映射解决，支持XML配置ResultMap和注解方式两种。</p>
<h5 data-id="heading-21">（1）XML配置ResultMap</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.mp.mapper.OrderMapper"</span>&amp;<span class="hljs-attr">gt</span>;
    &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">配置字段映射</span>：<span class="hljs-attr">解决实体类与数据库字段不一致问题</span> <span class="hljs-attr">--</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"OrderResultMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"Order"</span>&gt;</span>
        <span class="hljs-symbol">&amp;lt;</span>id column="order_id" property="id"/<span class="hljs-symbol">&amp;gt;</span> <span class="hljs-comment">&lt;!-- 数据库字段order_id映射实体类id --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"order_number"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orderNo"</span>/&amp;<span class="hljs-attr">gt</span>; &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">数据库order_number映射orderNo</span> <span class="hljs-attr">--</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"total_amount"</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"amount"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByIdWithResultMap"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"OrderResultMap"</span>&gt;</span>
        SELECT order_id, order_number, total_amount FROM t_order WHERE order_id = #{id}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h5 data-id="heading-22">（2）注解方式映射（@Results、@Result）</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-variable">@Select</span>(<span class="hljs-string">"SELECT order_id, order_number, total_amount FROM t_order WHERE order_id = #{id}"</span>)
    <span class="hljs-variable">@Results</span>({
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"order_id"</span>, property = <span class="hljs-string">"id"</span>, id = true), <span class="hljs-comment">// id=true表示主键</span>
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"order_number"</span>, property = <span class="hljs-string">"orderNo"</span>),
        <span class="hljs-variable">@Result</span>(column = <span class="hljs-string">"total_amount"</span>, property = <span class="hljs-string">"amount"</span>)
    })
    Order <span class="hljs-built_in">selectByIdWithAnnotation</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"id"</span>) Long id);
}
</code></pre>
<h4 data-id="heading-23">3. Mapper 继承与扩展：复用通用逻辑</h4>
<p>当多个Mapper存在重复自定义方法时，可创建通用Mapper接口，通过继承复用逻辑，减少代码冗余。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 通用Mapper接口（封装公共方法）</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">CommonMapper</span>&lt;<span class="hljs-selector-tag">T</span>&gt; <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">T</span>&gt; {
    <span class="hljs-comment">// 公共方法：按创建时间范围查询</span>
    <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">T</span>&gt; <span class="hljs-selector-tag">selectByCreateTimeRange</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"startTime"</span>) LocalDateTime startTime,
                                    <span class="hljs-variable">@Param</span>(<span class="hljs-string">"endTime"</span>) LocalDateTime endTime);
}

<span class="hljs-comment">// 自定义XML实现通用方法（CommonMapper.xml）</span>
&lt;<span class="hljs-selector-tag">mapper</span> <span class="hljs-selector-tag">namespace</span>="<span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.mp</span><span class="hljs-selector-class">.mapper</span><span class="hljs-selector-class">.CommonMapper</span>"&gt;
    &lt;<span class="hljs-selector-tag">select</span> <span class="hljs-selector-tag">id</span>="<span class="hljs-selector-tag">selectByCreateTimeRange</span>" <span class="hljs-selector-tag">resultType</span>="<span class="hljs-selector-tag">T</span>"&gt;
        <span class="hljs-selector-tag">SELECT</span> * <span class="hljs-selector-tag">FROM</span> ${<span class="hljs-selector-tag">tableName</span>}
        <span class="hljs-selector-tag">WHERE</span> <span class="hljs-selector-tag">create_time</span> <span class="hljs-selector-tag">BETWEEN</span> #{<span class="hljs-selector-tag">startTime</span>} <span class="hljs-selector-tag">AND</span> #{<span class="hljs-selector-tag">endTime</span>}
        <span class="hljs-selector-tag">AND</span> <span class="hljs-selector-tag">deleted</span> = <span class="hljs-number">0</span>
    &lt;/<span class="hljs-selector-tag">select</span>&gt;
&lt;/<span class="hljs-selector-tag">mapper</span>&gt;

<span class="hljs-comment">// OrderMapper继承通用Mapper，获得公共方法</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">CommonMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// 自定义Order专属方法...</span>
}
</code></pre>
<h4 data-id="heading-24">4. 多数据源下的Mapper使用</h4>
<p>集成MP多数据源组件（dynamic-datasource-spring-boot-starter）后，可通过@DS注解指定Mapper接口或方法的数据源，实现读写分离、多库操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方式1：在Mapper接口上指定数据源（所有方法默认使用slave从库）</span>
<span class="hljs-meta">@DS("slave")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Order&gt; {
    <span class="hljs-comment">// 读操作方法（从库）</span>
    List&lt;Order&gt; <span class="hljs-title function_">selectOrderListByUserId</span><span class="hljs-params">(Long userId)</span>;

    <span class="hljs-comment">// 方式2：方法上指定数据源（覆盖接口注解，使用master主库）</span>
    <span class="hljs-meta">@DS("master")</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">(Order order)</span>;
}
</code></pre>
<h3 data-id="heading-25">四、Mapper 高频避坑指南</h3>
<h4 data-id="heading-26">1. 坑点1：Mapper注入失败，抛出NoSuchBeanDefinitionException</h4>
<p><strong>现象</strong>：启动项目时提示无法找到Mapper接口的Bean，无法注入使用。 <strong>规避方案</strong>：</p>
<ul>
<li>检查@MapperScan注解的包路径是否准确，确保覆盖所有Mapper接口；</li>
<li>若使用单个@Mapper注解，确认每个Mapper都添加了该注解，且接口是public修饰；</li>
<li>避免Mapper接口与XML文件命名空间不一致，XML的namespace必须是Mapper接口全类名。</li>
</ul>
<h4 data-id="heading-27">2. 坑点2：自定义SQL中字段名错误，报Column not found异常</h4>
<p><strong>现象</strong>：执行自定义SQL时，提示数据库字段不存在，实际字段名正确。 <strong>规避方案</strong>：</p>
<ul>
<li>确认实体类字段与数据库字段映射正确，开启驼峰命名自动映射（map-underscore-to-camel-case: true）；</li>
<li>自定义SQL中字段名若与数据库关键字冲突（如order、user），需用反引号包裹（<code>order</code>）；</li>
<li>多表关联查询时，避免字段名重复，需指定表别名（如o.id、u.id）。</li>
</ul>
<h4 data-id="heading-28">3. 坑点3：批量插入性能差，耗时过长</h4>
<p><strong>现象</strong>：批量插入上千条数据时，耗时远超预期，数据库压力大。 <strong>规避方案</strong>：</p>
<ul>
<li>分批次批量插入，每批次控制在500-1000条，避免单次插入过多数据；</li>
<li>配置JDBC批量提交参数，结合Druid连接池优化；</li>
<li>复杂场景下，使用MyBatis原生批量插入XML（foreach标签），性能优于MP自带insertBatchIds。</li>
</ul>
<h4 data-id="heading-29">4. 坑点4：条件构造器传入XML后，SQL拼接异常</h4>
<p><strong>现象</strong>：将QueryWrapper传入自定义XML后，执行SQL时报语法错误，条件未正确拼接。 <strong>规避方案</strong>：</p>
<ul>
<li>XML中引用条件构造器时，使用<code>${wrapper.sqlSegment}</code>（无#{}），且需配合标签消除多余AND/OR；</li>
<li>避免条件构造器与自定义SQL条件重复（如同时拼接deleted=0），建议统一在XML或构造器中处理；</li>
<li>若条件构造器中使用了Lambda表达式，确保实体类字段与数据库字段映射正确。</li>
</ul>
<h4 data-id="heading-30">5. 坑点5：逻辑删除后，自定义SQL仍查询到已删除数据</h4>
<p><strong>现象</strong>：配置逻辑删除后，BaseMapper方法可正常过滤已删除数据，但自定义SQL仍返回删除数据。 <strong>规避方案</strong>：</p>
<ul>
<li>BaseMapper方法自动拼接逻辑删除条件，但自定义SQL需手动添加（AND deleted = 0）；</li>
<li>可通过MP的全局SQL注入器，自动为自定义SQL添加逻辑删除条件，减少手动编写。</li>
</ul>
<h3 data-id="heading-31">五、总结：Mapper 层使用核心原则</h3>
<p>MP Mapper层的使用核心是“<strong>复用优先、灵活扩展</strong>”，在实际开发中需遵循以下原则，平衡开发效率与性能：</p>
<ul>
<li>单表操作优先使用BaseMapper自带方法，避免重复编写SQL，充分发挥MP的自动化能力；</li>
<li>复杂SQL、多表关联优先选择XML方式实现，便于调试和维护；简单SQL可使用注解方式，简化开发；</li>
<li>批量操作、多数据源、结果映射等场景，需结合业务需求选择优化方案，避免性能瓶颈；</li>
<li>严格规范Mapper接口与XML的命名、路径，减少注入失败、SQL错误等问题，提升项目可维护性。</li>
</ul>
<p>Mapper层作为MP与数据库交互的核心桥梁，既要熟练掌握BaseMapper的基础用法，也要灵活运用自定义扩展能力，才能在不同业务场景中高效落地。掌握本文所述的用法、技巧与避坑要点，可大幅减少持久层开发工作量，提升代码质量与性能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端MicroApp5分钟让你轻松掌握]]></title>    <link>https://juejin.cn/post/7599591405314064425</link>    <guid>https://juejin.cn/post/7599591405314064425</guid>    <pubDate>2026-01-27T07:44:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599591405314064425" data-draft-id="7599572091076214826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端MicroApp5分钟让你轻松掌握"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-27T07:44:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="林太白"/> <meta itemprop="url" content="https://juejin.cn/user/1874034273300919"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端MicroApp5分钟让你轻松掌握
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1874034273300919/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    林太白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:44:33.000Z" title="Tue Jan 27 2026 07:44:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">微前端MicroApp5分钟让你轻松掌握</h2>
<p>之前我将我们本地的项目全部使用vite进行了重构，包括React、vue3项目</p>
<p>接下来我们就将自己的这两个项目使用<code>micro-app</code>进行改造成微前端项目，先来简单看看MicroApp是什么</p>
<h3 data-id="heading-1">MicroApp认识</h3>
<h4 data-id="heading-2">官方网站</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">https</span>:<span class="hljs-comment">//jd-opensource.github.io/micro-app/docs.html#/</span>


演示地址
<span class="hljs-attr">https</span>:<span class="hljs-comment">//www.micro-zoe.com/main-vue2/app-vue2</span>
</code></pre>
<h4 data-id="heading-3">认识</h4>
<p>MicroApp是一款基于类WebComponent进行渲染的微前端框架，不同于目前流行的开源框架，它从组件化的思维实现微前端，旨在降低上手难度、提升工作效率。</p>
<p>是目前市面上接入微前端成本最低的框架，并且提供了JS沙箱、样式隔离、元素隔离、预加载、资源地址补全、插件系统、数据通信等一系列完善的功能。MicroApp与技术栈无关，也不和业务绑定，可以用于任何前端框架和业务。</p>
<h5 data-id="heading-4">业务采取技术对比</h5>
<p><strong>iframe</strong>：在所有微前端方案中，iframe是最稳定的、上手难度最低的，但它有一些无法解决的问题，例如性能低、通信复杂、双滚动条、弹窗无法全局覆盖，成长性不高，只适合简单的页面渲染。</p>
<p><strong>npm包</strong>：将子应用封装成npm包，通过组件的方式引入，在性能和兼容性上是最优的方案，但却有一个致命的问题就是版本更新，每次版本发布需要通知接入方同步更新，管理非常困难。</p>
<p><strong>微前端框架</strong>：流行的微前端框架有single-spa和qiankun，它们将维护成本和功能上达到一种平衡，是目前实现微前端备受推崇的方案。</p>
<p>虽然qiankun比较优秀，但是需要代码修改和沟通成本，尤其在乙方不进行更改的情况下，所需要付出的成本几乎呈现几何倍数的增加，因此我这里首先采取了MicroApp进行实现,接下来我们就将vue2、vue3、React项目使用<code>MicroApp</code>进行结合起来</p>
<h4 data-id="heading-5">使用</h4>
<p>接下来我们在项目之中使用micro-app，首先是我们的主应用，我们的应用分层是这样子的</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Vue3</span> 主应用
   vue2 分应用

react18分应用
   react <span class="hljs-number">16</span> 分应用
</code></pre>
<h4 data-id="heading-6">主应用配置</h4>
<p>加载子应用</p>
<p>主应用之中引入子应用,这里我是以vue3 作为我们的主应用模块的,这里我们先引入React+antd这一套试试，我们端口为8083</p>
<h5 data-id="heading-7">安装版本<code>micro-app依赖</code></h5>
<p><strong>在我们的主应用Vue3之中进行安装</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">pnpm i @micro-zoe/micro-app --save

安装成功以后我们可以看到依赖部分
<span class="hljs-string">"@micro-zoe/micro-app"</span>: <span class="hljs-string">"1.0.0-rc.28"</span>,
</code></pre>
<h5 data-id="heading-8">初始化<code>micro-app</code></h5>
<p>主应用根目录下面初始化我们入口，我的是<code>main.ts</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> microApp <span class="hljs-keyword">from</span> <span class="hljs-string">'@micro-zoe/micro-app'</span>

microApp.<span class="hljs-title function_">start</span>()
</code></pre>
<h5 data-id="heading-9">路由配置</h5>
<pre><code class="hljs language-javascript" lang="javascript">{
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/reactantd"</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">"reactantd"</span>,
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">"reactantd"</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">"User"</span>, <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
    <span class="hljs-attr">children</span>: [],
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"@/views/module/weiqianduan/reactantd/index.vue"</span>),
  },
</code></pre>
<h5 data-id="heading-10">页面使用</h5>
<pre><code class="hljs language-javascript" lang="javascript">&lt;micro-app 
  name=<span class="hljs-string">'nexus-react'</span> 
  url=<span class="hljs-string">'http://localhost:8083/'</span> 
  baseroute=<span class="hljs-string">"/reactantd"</span> iframe&gt;
&lt;/micro-app&gt;
</code></pre>
<h4 data-id="heading-11">[子应用]配置</h4>
<p>vite其中的配置部分我们必须保证我们有下面的内容</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Access-Control-Allow-Origin'</span>: <span class="hljs-string">'*'</span>,
    }
  }
})
</code></pre>
<p>这个时候我们重新启动一下项目，我们可以看到项目给我们的报错，这里我们重新启动确定一下我们地址配置的没有问题即可</p>
<pre><code class="hljs language-javascript" lang="javascript">@micro-zoe_micro-app.<span class="hljs-property">js</span>?v=6<span class="hljs-attr">a3e7321</span>:<span class="hljs-number">151</span> [micro-app] app my-<span class="hljs-attr">app</span>: 
</code></pre>
<p>尝试一下，这个时候我们嵌入的部分已经成功了</p>
<h5 data-id="heading-12">特别注意</h5>
<p>经过我的尝试，我发现有两个点需要特别的关注</p>
<p>:::info
1、授权  鉴权系统 这个不用想，同鉴权系统我们才能嵌入进去</p>
<p>2、 配置完没有问题以后我尝试了几次都没成功，这里格外注意</p>
<pre><code class="hljs">  我们需要重新启动项目，清理浏览器缓存以后我们的配置才能生效
</code></pre>
<p>:::</p>
<p>补充</p>
<pre><code class="hljs language-javascript" lang="javascript">调试的时候需要注意

我们只可以本地调试本地
或者线上调试线上


在本地调试线上这种模式下，是跨域无法成功的
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Manus数据手套：为人工智能在现实世界完成多层级任务提供可扩展的具体化方法]]></title>    <link>https://juejin.cn/post/7599850148055285769</link>    <guid>https://juejin.cn/post/7599850148055285769</guid>    <pubDate>2026-01-27T07:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599850148055285769" data-draft-id="7599630795804672046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Manus数据手套：为人工智能在现实世界完成多层级任务提供可扩展的具体化方法"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-27T07:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱迪斯通"/> <meta itemprop="url" content="https://juejin.cn/user/2672256188156042"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Manus数据手套：为人工智能在现实世界完成多层级任务提供可扩展的具体化方法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2672256188156042/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱迪斯通
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:46:15.000Z" title="Tue Jan 27 2026 07:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Artly AI是一家总部位于美国的技术公司，公司主要负责开发具体化的人工智能系统，为服务行业提供更近似人类的动作灵活性。该公司开发的咖啡师机器人不只是简单地分发咖啡，从精确控制倒咖啡到拿铁艺术拉花所需的微妙手腕动作，其能够执行专业咖啡师复杂、流畅的动作。</p>
<p>‍</p>
<p><strong><strong>挑战</strong></strong>****：****<strong><strong>教授机器人真实世界的操作</strong></strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3699272d7a54309863bd32e2df20c7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104775&amp;x-signature=UBEI71zf%2BVohljhV58W%2B8%2BGyTk0%3D" alt="ScreenShot_2026-01-27_145728_564.png" loading="lazy"/></p>
<p>机器人很难执行需要类似人类运动的真实世界操纵任务，例如抓取物体、倾倒液体或执行精细的运动控制。与在大规模公共数据集上训练的大型语言模型不同，机器人缺乏一个共享的、可扩展的运动数据库，因此很难学习现实世界任务所需的细微操作技能。</p>
<p>Artly AI通过其机器人职业学校框架解决了这一挑战，该框架建立在机器人行动的专利基础模型上。该系统使机器人能够通过人类演示学习新技能，在加速技能获取的同时，显著降低训练数据要求。</p>
<p>‍</p>
<p><strong><strong>机器人职业学校</strong></strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81423b5b816f4f8e83757a881ebf4acf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104775&amp;x-signature=MOzr6EgRlXjGv0cgT8z%2FMtYiCYk%3D" alt="ScreenShot_2026-01-27_145631_658.png" loading="lazy"/></p>
<p>Artly AI的机器人职业学校是一个训练系统，AI通过观察来学习人类的工艺。其核心是模仿学习，Artly使用动作捕捉技术记录世界级专业人士的动作。在这种情况下，如冠军咖啡师，将穿着MANUS数据手套来执行任务，而学生，即人工智能系统，通过捕捉到的精确运动轨迹，包括高端拿铁拉花艺术所需的微妙抖动和倾斜，进行不断学习。</p>
<p>这个学习过程由Artly的人工智能平台提供支持，该平台就像是一间教室，允许各种技能在全球范围内扩展。例如，当西雅图的机器人学会准备一种新的季节性饮料，这种知识就可以立即部署到纽约或旧金山的机器人身上。为了毕业，机器人必须使用计算机视觉和物理推理与现实世界互动。因为它是根据人类的运动而不是固定的坐标进行训练的，所以机器人可以处理现实世界中的不断变化，例如不同大小的牛奶罐或更重的咖啡豆袋，而不会破坏其工作流程。</p>
<p>‍</p>
<p><strong><strong>MANUS</strong></strong>数据手套如何实现工作流程****</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a2c22b886a643b2a595af28b91298f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104775&amp;x-signature=mo3lerabpInu5NANQYfMLHyyByQ%3D" alt="ScreenShot_2026-01-27_145649_291.png" loading="lazy"/></p>
<p>MANUS数据手套具有25个自由度和高精度解剖手部模型跟踪能力，支持以毫米级的位置和旋转精度捕捉技能演示，确保原始动作数据的完整性。这种高保真数据支持使得人到机器人技能转移和跨任务执行更加精准高效。</p>
<p>‍</p>
<p><strong><strong>结果和未来影响</strong></strong></p>
<p>通过将基于演示的学习与MANUS数据手套的高保真动作捕捉相结合，机器人可以在几个小时内学习复杂的操作技能，而不再需要几周时间。这种方法在现实环境中实现了可靠、高效的部署，同时显著降低了培训成本和复杂性。</p>
<p>随着越来越多的机器人通过演示学习新技能，每项新技能都会加入到一个可共享、可重复使用的技能库，从而实现复合数据优势。这一功能的实现将人工智能从孤立的自动化、编程化学习推向更加全面的可扩展化技能学习的未来。在此技术的推动下，我们有理由相信在不久的未来，机器人将不断向人类学习，并在现实世界中与人们并肩工作。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[把 V8 的「内存黑盒」掀开一角：从执行上下文到作用域链，搞懂 JS 为何会“泄漏”]]></title>    <link>https://juejin.cn/post/7599634796583206918</link>    <guid>https://juejin.cn/post/7599634796583206918</guid>    <pubDate>2026-01-27T07:47:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599634796583206918" data-draft-id="7599502282602954815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="把 V8 的「内存黑盒」掀开一角：从执行上下文到作用域链，搞懂 JS 为何会“泄漏”"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2026-01-27T07:47:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="swipe"/> <meta itemprop="url" content="https://juejin.cn/user/858052674727959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            把 V8 的「内存黑盒」掀开一角：从执行上下文到作用域链，搞懂 JS 为何会“泄漏”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/858052674727959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    swipe
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:47:09.000Z" title="Tue Jan 27 2026 07:47:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>JS 的内存管理是自动的，但“自动”不等于“与你无关”。一旦你写出错误的引用持有（闭包 / 全局变量 / DOM 引用），问题往往不是“报错”，而是<strong>越来越卡、越来越慢、越来越难定位</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">目录导航</h2>
<ul>
<li>
<ol>
<li>为什么学内存：你写的每一行代码都在占内存</li>
</ol>
</li>
<li>
<ol start="2">
<li>内存管理的生命周期：申请 → 使用 → 释放</li>
</ol>
</li>
<li>
<ol start="3">
<li>为什么这章坚持讲 <code>var</code>：它是理解执行过程的“历史入口”</li>
</ol>
</li>
<li>
<ol start="4">
<li>执行上下文栈（调用栈）：代码到底按什么顺序跑？</li>
</ol>
</li>
<li>
<ol start="5">
<li>变量提升、<code>undefined</code> 与 <code>is not defined</code>：差在哪？</li>
</ol>
</li>
<li>
<ol start="6">
<li>LHS / RHS：用“查询视角”把提升讲透</li>
</ol>
</li>
<li>
<ol start="7">
<li>函数为什么也能“提升”：编译阶段到底做了什么</li>
</ol>
</li>
<li>
<ol start="8">
<li>AO / GO / VO / VE：术语别背，先抓住结构</li>
</ol>
</li>
<li>
<ol start="9">
<li>作用域链：变量到底沿着什么路径被找到</li>
</ol>
</li>
<li>
<ol start="10">
<li><code>var</code> 的一个经典坑：全局属性覆盖（浏览器 vs Node 的差异）</li>
</ol>
</li>
<li>
<ol start="11">
<li>留几道题：用来检验你是不是真懂了</li>
</ol>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">1）为什么学内存：你写的每一行代码都在占内存</h2>
<p>在 JS 里，原始值、对象、函数……都会占用内存；只不过引擎帮你“自动管理”，所以它看起来像黑盒。黑盒的代价是：你写错了引用关系，<strong>不会立刻炸</strong>，而是悄悄把内存越撑越大，最后变成“线上性能事故”。</p>
<p>这也是这章的核心目标：<br/>
<strong>用“执行过程视角”把内存模型讲清楚</strong>——你至少要知道：</p>
<ul>
<li>变量/函数在执行前后分别存在哪里</li>
<li>为什么某些值是 <code>undefined</code>，某些直接 <code>ReferenceError</code></li>
<li>作用域链怎么找变量，闭包为什么能“把东西留住”</li>
</ul>
<hr/>
<h2 data-id="heading-2">2）内存管理的生命周期：申请 → 使用 → 释放</h2>
<p>不管哪门语言，内存管理逃不开三步：</p>
<ol>
<li>申请内存</li>
<li>使用内存（存对象/值/函数等）</li>
<li>不再需要时释放内存</li>
</ol>
<p>区别在于：</p>
<ul>
<li>C/C++ 这类是“手动管理”（<code>malloc/free</code>），能力强但容易踩坑</li>
<li>Java/JavaScript/Python 这类是“自动管理”，靠 GC（垃圾回收）做释放，写起来更安全，但你仍然需要理解<strong>引用关系</strong>，否则照样内存泄漏</li>
</ul>
<blockquote>
<p>关键点：GC 回收的是“不可达对象”，不是“你觉得不用了的对象”。你写的引用链，决定了它可不可达。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">3）为什么这章坚持讲 <code>var</code>：它是理解执行过程的“历史入口”</h2>
<p>很多人会说：我日常只用 <code>let/const</code>，学 <code>var</code> 干嘛？<br/>
原因很现实，也很重要：</p>
<ul>
<li>ES6 之前只有 <code>var</code>，大量存量项目仍在用，不懂你就维护不了</li>
<li><code>var</code> 的缺陷（提升、全局挂载、作用域边界模糊）恰好能逼你把“执行过程”想清楚</li>
<li>真正理解 <code>var</code>，你才会明白 <code>let/const</code> 到底修复了什么</li>
</ul>
<p>这也是为什么后面我会用 <code>var</code> 来讲：提升、执行上下文、作用域链这些“底层规则”。</p>
<hr/>
<h2 data-id="heading-4">4）执行上下文栈（调用栈）：代码到底按什么顺序跑？</h2>
<p>JS 引擎内部有一个结构：<strong>执行上下文栈（ECS / Call Stack）</strong> ，用来管理“当前正在执行的上下文”。</p>
<p>你可以把它理解成：</p>
<ul>
<li>先把<strong>全局执行上下文 GEC</strong> 压栈，开始跑全局代码</li>
<li>每调用一个函数，就创建一个<strong>函数执行上下文 FEC</strong> 压栈</li>
<li>函数执行完，FEC 出栈，回到上一个上下文继续跑</li>
</ul>
<p>这就是“为什么递归会爆栈”“为什么某些函数先打印后执行”的底层原因。</p>
<hr/>
<h2 data-id="heading-5">5）变量提升、<code>undefined</code> 与 <code>is not defined</code>：差在哪？</h2>
<p>先看这个经典片段：</p>
<pre><code class="hljs language-ini" lang="ini">console.log(num1)<span class="hljs-comment">;</span>

var <span class="hljs-attr">num1</span> = <span class="hljs-number">20</span>
var <span class="hljs-attr">num2</span> = <span class="hljs-number">30</span>
var <span class="hljs-attr">result</span> = num1 + num2

console.log(result)<span class="hljs-comment">;</span>
</code></pre>
<p>为什么第一行打印 <code>undefined</code>，不是报错？核心原因：<strong>提升</strong>。</p>
<h3 data-id="heading-6">5.1 三种常见 <code>undefined</code></h3>
<ul>
<li>变量声明未赋值</li>
<li>访问对象不存在的属性</li>
<li>函数没有显式 return</li>
</ul>
<p>在上面例子里，属于第一种：<strong>声明提升了，但赋值还没发生</strong>。</p>
<h3 data-id="heading-7">5.2 <code>undefined</code> vs <code>ReferenceError: xxx is not defined</code></h3>
<ul>
<li><code>undefined</code>：<strong>有这个变量</strong>，只是当前时刻它还没有值（或就是 undefined）</li>
<li><code>is not defined</code>：<strong>连变量都不存在</strong>（没有声明/没有绑定记录），引擎找不到“引用”就直接抛错</li>
</ul>
<hr/>
<h2 data-id="heading-8">6）LHS / RHS：用“查询视角”把提升讲透</h2>
<p>很多人对提升的理解停留在“会被提到上面”。但真正写复杂代码时，你需要一个更稳的视角：<strong>LHS / RHS 查询</strong>。</p>
<ul>
<li><strong>LHS（Left-Hand Side）</strong> ：找“容器”，为了赋值</li>
<li><strong>RHS（Right-Hand Side）</strong> ：找“值”，为了读取</li>
</ul>
<p>把“打印 num1”这件事换成查询语言：<br/>
<code>console.log(num1)</code> 触发 RHS 查询：我要读取 num1 的值 → 引擎沿作用域查找绑定 → 找到了声明（被提升过）→ 但未赋值 → 返回 <code>undefined</code>。</p>
<p>图示（保留原图）：<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/655e4f8b432842a2a57df0d5b09bf329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=thiHMcJHubGEBTuzt%2FplVl4OelE%3D" alt="" loading="lazy"/><br/>
<strong>图4-1 赋值的过程</strong></p>
<p>扩展图（保留原图）：<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7d332927023486a971185bcc93f583e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=EazqMcbz%2BrqHUjbtgc%2BlskXbY8g%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-9">7）函数为什么也能“提升”：编译阶段到底做了什么？</h2>
<p>你会发现：函数在声明前也能调用（函数声明形式）：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">foo2</span>()
function <span class="hljs-built_in">foo2</span>(){
  console<span class="hljs-selector-class">.log</span>('XiaoYu')
}
</code></pre>
<p>这背后离不开“编译阶段”。文档里用了一张图概括：语法分析 → 预编译 → 即时编译 → 优化。</p>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/760cfaf1466f47a2877c3920af615440~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=P4r594LWKSnEa69tyN%2BfRsGpN3U%3D" alt="" loading="lazy"/><br/>
<strong>图4-3 预编译与即时编译</strong></p>
<blockquote>
<p>更“严谨”的说法是：规范层面不是 AO/VO 这些对象，而是 Environment Record / Lexical Environment 等结构；但为了建立直觉，用 AO/GO 讲清执行过程非常有效——后面你再替换成规范术语会更顺。</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">8）AO / GO / VO / VE：术语别背，先抓住结构</h2>
<p>先记一个对你最有用的结构化结论：</p>
<ul>
<li><strong>GO（Global Object）</strong> ：全局对象（浏览器里常见是 <code>window</code>），全局变量在这里能被访问到</li>
<li><strong>AO（Activation Object）</strong> ：函数执行时的“局部环境”（函数上下文里用来承载局部变量、形参等的抽象容器）</li>
<li><strong>VO（Variable Object）</strong> ：更泛化的叫法，表示“变量所在环境”；全局时近似 GO，函数时近似 AO</li>
<li><strong>VE（Variable Environment）</strong> ：规范/新表述方向：把 VO 更明确成“环境”概念（你可以先把它当成 VO 的升级叫法）</li>
</ul>
<blockquote>
<p>你真正需要掌握的是：<strong>变量在哪个环境里被创建</strong>、<strong>函数调用时会创建新的环境</strong>、<strong>环境之间如何连接（作用域链）</strong> 。</p>
</blockquote>
<hr/>
<h2 data-id="heading-11">9）作用域链：变量到底沿着什么路径被找到？</h2>
<p>作用域链本质是：**当前环境 + 父级环境 + 父级的父级……**形成的一条“向外查找链”。在任意执行上下文中，查变量会先查当前，再沿链向外。</p>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e4cd6b93874e38ac343724a4f989b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=ZzkftABaUsUtrl1379Bc7TtMWb8%3D" alt="" loading="lazy"/><br/>
<strong>图4-8 作用域链的描述</strong></p>
<p>再看这个用来“打穿直觉”的例子：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">foo</span>(<span class="hljs-number">123</span>)
<span class="hljs-keyword">var</span> m = <span class="hljs-number">666</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">num</span>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1'</span>, m);
  <span class="hljs-keyword">var</span> m = <span class="hljs-number">10</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2'</span>, m);
  <span class="hljs-keyword">var</span> n = <span class="hljs-number">20</span>
}
</code></pre>
<p>它会输出：<code>undefined</code> 和 <code>10</code>。原因不是玄学，而是：<strong>函数内部 <code>var m</code> 先提升到当前 AO 的顶端</strong>，所以第一次打印时，当前作用域里已经“有 m 了”，只是没赋值。</p>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3805b5dfc000492eba298ab2c87264f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=7O%2BwXsJ%2BZFSnY9silX0KznT50og%3D" alt="" loading="lazy"/><br/>
<strong>图4-4 全局函数执行内存图</strong></p>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c931e65103242d5ad51267cf4e3d902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=WeoekXm43WzQlCXQ%2BBtYUoBiOmQ%3D" alt="" loading="lazy"/><br/>
<strong>图4-6 函数内存执行过程</strong></p>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc1a99ba55e4ccbb2ae1c6771b90567~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=B1TRc0pZZA4iRZMj1n2tSwqWowk%3D" alt="" loading="lazy"/><br/>
<strong>图4-7 函数内存执行结束</strong></p>
<p>你会看到一个更重要的“内存启示”：</p>
<blockquote>
<p>函数执行结束，执行上下文出栈；如果没有任何引用再指向 AO（或其内部对象），它就会变成“不可达”，后续会被 GC 回收。</p>
</blockquote>
<p>这句话就是你未来理解“闭包为什么会泄漏/为什么能保留数据”的关键入口。</p>
<hr/>
<h2 data-id="heading-12">10）<code>var</code> 的一个经典注意点：全局属性覆盖（浏览器 vs Node）</h2>
<p>看这个例子（保留原文核心案例与结论）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">"XiaoYu"</span>
<span class="hljs-title function_">foo</span>(<span class="hljs-number">123</span>)
<span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">num</span>){
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1"</span>, m);
  <span class="hljs-keyword">var</span> n = <span class="hljs-number">10</span>
  <span class="hljs-keyword">var</span> m = <span class="hljs-number">20</span>

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>){
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2"</span>, name)
  }
  <span class="hljs-title function_">bar</span>()
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-number">1</span> <span class="hljs-literal">undefined</span>
<span class="hljs-number">2</span> <span class="hljs-title class_">XiaoYu</span>
</code></pre>
<p>这里注意一个很“坑”的点：如果你把全局 <code>name</code> 的声明注释掉，在浏览器里你可能仍然得到 <code>XiaoYu</code>，这常常来自：</p>
<ul>
<li><code>var</code> 在全局作用域下会“挂到”全局对象上</li>
<li>浏览器的 <code>window</code> 本身就可能已有 <code>name</code> 这个属性</li>
<li>于是你以为你删了变量，实际上你只是改写了全局对象属性，产生了“黑魔法效果”</li>
</ul>
<p>（保留原图）<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/359b4b6af1a9483cbba32edde635bfdc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3dpcGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770104828&amp;x-signature=0XZXPZNCHuujqKdzkoAVxMHaSDg%3D" alt="" loading="lazy"/><br/>
<strong>图4-13 var 的全局覆盖缺陷</strong></p>
<p>同时，Node 环境下全局对象不是 <code>window</code>，行为会不同（甚至直接报错），这也是很多同学“浏览器能跑、Node 不行”的来源之一。</p>
<hr/>
<h2 data-id="heading-13">11）留几道题：用来检验你是不是真懂了</h2>
<p>把题留在这里，建议你先“脑内执行一遍”，再去跑代码对答案（非常练功）。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//面试题1</span>
<span class="hljs-selector-tag">var</span> n = <span class="hljs-number">100</span>
function <span class="hljs-built_in">foo</span>(){
  n = <span class="hljs-number">200</span>
}
<span class="hljs-built_in">foo</span>()
console<span class="hljs-selector-class">.log</span>(n)

<span class="hljs-comment">//面试题2</span>
function <span class="hljs-built_in">foo</span>(){
  console<span class="hljs-selector-class">.log</span>(m)
  <span class="hljs-selector-tag">var</span> m = "小余"
  console<span class="hljs-selector-class">.log</span>(m);
}
<span class="hljs-selector-tag">var</span> m = "coderwhy"
<span class="hljs-built_in">foo</span>()

<span class="hljs-comment">//面试题3</span>
<span class="hljs-selector-tag">var</span> n = <span class="hljs-number">100</span>
function <span class="hljs-built_in">foo1</span>(){
  console<span class="hljs-selector-class">.log</span>("这是foo1内部",n);
}
function <span class="hljs-built_in">foo2</span>(){
  <span class="hljs-selector-tag">var</span> n = <span class="hljs-number">200</span>
  console<span class="hljs-selector-class">.log</span>("这是foo2内部",n);
  <span class="hljs-built_in">foo1</span>()
}
<span class="hljs-built_in">foo2</span>()
console<span class="hljs-selector-class">.log</span>("这是最外层",n);

<span class="hljs-comment">//面试题4</span>
<span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span> = <span class="hljs-number">100</span>
function <span class="hljs-built_in">foo</span>(){
  console<span class="hljs-selector-class">.log</span>(a)
  return
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span> = <span class="hljs-number">200</span>
}
<span class="hljs-built_in">foo</span>()

<span class="hljs-comment">//面试题5</span>
function <span class="hljs-built_in">foo</span>(){
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">a</span> = <span class="hljs-selector-tag">b</span> = <span class="hljs-number">10</span>
}
<span class="hljs-built_in">foo</span>()
console<span class="hljs-selector-class">.log</span>(a);
console<span class="hljs-selector-class">.log</span>(b);
</code></pre>
<hr/>
<h2 data-id="heading-14">收个尾：这章你真正应该带走的“底层能力”</h2>
<ul>
<li>代码运行不是“从上到下”这么简单，它受 <strong>ECS（调用栈）+ 编译阶段信息</strong> 控制</li>
<li><code>undefined</code> 多半是“有声明但没赋值”，<code>is not defined</code> 多半是“压根没声明/没绑定”</li>
<li>作用域链是“当前环境向外找”的规则，它解释了：为何闭包能拿到外层变量，也解释了为何错误引用会导致内存无法回收</li>
</ul>
<p>如果你愿意，我可以在你下一章（垃圾回收/闭包）里把这套“引用可达性”模型继续往下推：</p>
<ul>
<li>V8 分代回收（新生代/老生代）</li>
<li>标记清除/标记整理的直觉</li>
<li>真实项目里最常见的泄漏模式与排查路径（Performance/Memory 面板 + 快照对比）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Clawdbot部署教程，10分钟白嫖Qwen，给自己搭个7x24小时AI助理]]></title>    <link>https://juejin.cn/post/7599601258641375270</link>    <guid>https://juejin.cn/post/7599601258641375270</guid>    <pubDate>2026-01-27T07:50:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599601258641375270" data-draft-id="7599604510365859878" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Clawdbot部署教程，10分钟白嫖Qwen，给自己搭个7x24小时AI助理"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-01-27T07:50:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不惑_"/> <meta itemprop="url" content="https://juejin.cn/user/1471609400466218"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Clawdbot部署教程，10分钟白嫖Qwen，给自己搭个7x24小时AI助理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1471609400466218/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不惑_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:50:42.000Z" title="Tue Jan 27 2026 07:50:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你有没有想过，要是有个AI助手能24小时待命，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.codebuddy.ai%2Fpromotion%2F%3Fref%3Dchisn3obbhjzfl" target="_blank" title="https://www.codebuddy.ai/promotion/?ref=chisn3obbhjzfl" ref="nofollow noopener noreferrer">微信链接</a> 、Telegram随叫随到该多爽?</p>
<p>今天就教你实现这个愿望。不需要什么技术背景，也不用花钱买高配服务器，只要一台最普通的Linux主机就够了。</p>
<h2 data-id="heading-0">什么是Clawdbot?</h2>
<p>简单说，它就是一个可以跑在你自己设备上的AI助手。Mac、Windows、Linux都行，关键是它能直接接入你平时在用的聊天软件——WhatsApp、Telegram、Discord、Slack、Signal，甚至iMessage。</p>
<p>想象一下，你在Telegram里跟它说"帮我记下这笔账"，它立马就给你记好了。这种感觉，真的比打开各种App方便太多。</p>
<p>话不多说，咱们直接开始搭。我用Ubuntu服务器做演示，MacOS和CentOS也完全一样的操作。</p>
<p><strong>小提示</strong>：如果你用服务器部署，建议选境外的，能省不少麻烦。</p>
<h2 data-id="heading-1">第一步：一行命令启动安装</h2>
<p>打开终端，复制粘贴这行命令:</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//clawd.bot/install.sh | bash</span>
</code></pre>
<p>运行后会问你要不要继续，选<strong>Yes</strong>。接下来看到提示，选<strong>QuickStart</strong>就行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9436e624390492ca40878836922dbae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=s3aUPaA0uV95YO6M3e3HqIg2D5k%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">第二步：选个免费好用的模型</h2>
<p>系统会列出一堆模型让你选。这里我强烈推荐选<strong>Qwen</strong>。</p>
<p>为什么?因为Clawdbox里的Qwen其实就是调用Qwen Code，这玩意儿免费、额度大，日常使用完全够了。白嫖党狂喜！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05f7a67aaf78475da8c69d58cbd259e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=JjnBoxupNT9f6sz8i0lbMmd7j8c%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">第三步：授权登录Qwen</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38be24d9d62c498f8fa650ed60be27bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=ZoJzKkRnQyA3KmV%2BnEoHucPb2i0%3D" alt="image.png" loading="lazy"/></p>
<p>等个几秒钟，屏幕会弹出一个网址。复制这个网址，粘贴到浏览器里打开，登录你的Qwen账号，然后选择你要用的模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/342351aa2d5e4b548257dbf87179d834~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=hN5YHUTF5Ez7j24Tlss0i9VLVBI%3D" alt="image.png" loading="lazy"/></p>
<p>搞定这步，AI的"大脑"就算接上了。</p>
<h2 data-id="heading-4">第四步：创建你的Telegram机器人</h2>
<p>选择Telegram作为聊天平台后,会出现配置提示。跟着做就行:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80bb5d55b5904a36892b1946a5807600~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=SPwvuAjSug9ZQDCkvvaZkZsQpq0%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p>在Telegram里搜索 <strong>@botfather</strong></p>
</li>
<li>
<p>给它发送 <code>/newbot</code></p>
</li>
<li>
<p>给你的机器人起个名字(随便起,好记就行)</p>
</li>
<li>
<p>把botfather给你的token复制下来</p>
</li>
<li>
<p>回到终端,粘贴这个token</p>
</li>
</ol>
<p>这一步其实就是给AI助手办个"身份证"，让它能在Telegram上合法活动。</p>
<h2 data-id="heading-5">第五步：添加技能(可以先跳过)</h2>
<p>系统会问你要不要给机器人添加skills和hooks。如果你现在不确定要什么功能，直接跳过就行，后面随时可以加。</p>
<p>就像给手机装App一样,用到什么再装也不迟。</p>
<h2 data-id="heading-6">第六步：检查服务有没有跑起来</h2>
<p>在终端输入:</p>
<pre><code class="hljs language-perl" lang="perl">ss -lntp | <span class="hljs-keyword">grep</span> <span class="hljs-number">18789</span>
</code></pre>
<p>如果看到有输出信息,恭喜你,启动成功了！</p>
<p>要是啥也没显示?那说明没启动成功,可能需要写个systemd service来启动(这个稍微有点技术含量,需要的话我后面单独讲)。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5951b01c11dc449db53eb2e54bea9fb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=ivERmZ1d9282q91NsuxKQTqYoJ4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">第七步：配对你的机器人</h2>
<p>现在打开Telegram,找到你刚创建的机器人,给它发送 <code>/start</code>。</p>
<p>它会回你一个配对码,看起来像这样: <code>ZEGWXXXX</code></p>
<p>回到服务器终端,输入:</p>
<pre><code class="hljs">clawdbot pairing approve telegram ZEGWXXXX
</code></pre>
<p>把<code>ZEGWXXXX</code>换成你实际收到的配对码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af1b691b0144873a4bbb1905d9e309e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=LudaQOqZYXMzoAzoOZ9PdSEDUPc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>遇到报错?</strong> 如果提示<code>clawdbot: command not found</code>,重启一下终端再试。</p>
<p>配对成功后,随便给机器人发条消息试试。如果它回复你了,那就大功告成！</p>
<p>从现在开始,你就有了一个7×24小时在线、永远不会嫌你烦的私人AI助理。</p>
<h2 data-id="heading-8">能用来干啥?</h2>
<p>给你看个实际例子。我把它当成私人理财助手用:</p>
<p>直接在聊天里跟它说"记账:午饭花了35块",它立马帮你记录。月底想看开销?问一句"这个月花了多少钱",它马上给你统计好。</p>
<p>比那些记账App好用太多了,因为你根本不用专门打开什么软件,聊天就能搞定。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37bd96113b5e4af0886c37f2ae91000c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5oORXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770105042&amp;x-signature=X%2FPWbbEhuTpZwSnrU2IJEI%2Bkn%2BU%3D" alt="image.png" loading="lazy"/></p>
<p>Clawdbox的玩法远不止这些。你可以让它:</p>
<ul>
<li>
<p>定时提醒你喝水、运动</p>
</li>
<li>
<p>帮你整理待办事项</p>
</li>
<li>
<p>查快递、查天气</p>
</li>
<li>
<p>甚至写代码、调试程序</p>
</li>
</ul>
<p>这些高级玩法,我会在后面的文章里慢慢分享。</p>
<p>先把这个基础版搭起来,体验一下拥有AI助理的感觉吧。相信我,用上就回不去了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SystemUI 开发之 NSSL.addContainerView() 之后发生了什么（八）]]></title>    <link>https://juejin.cn/post/7599579865609076778</link>    <guid>https://juejin.cn/post/7599579865609076778</guid>    <pubDate>2026-01-27T07:56:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599579865609076778" data-draft-id="7599579865608912938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SystemUI 开发之 NSSL.addContainerView() 之后发生了什么（八）"/> <meta itemprop="keywords" content="Android,Kotlin,架构"/> <meta itemprop="datePublished" content="2026-01-27T07:56:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="愤怒的代码"/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SystemUI 开发之 NSSL.addContainerView() 之后发生了什么（八）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    愤怒的代码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T07:56:49.000Z" title="Tue Jan 27 2026 07:56:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前文的代码追踪中 <strong><code>NotificationViewHierarchyManager</code></strong> 将 <code>ExpandableNotificationRow</code> 通过<code>addContainerView</code> 方法传给了<code>NotificationStackScrollLayout</code> 并使用 <code>addView</code> 添加到子<code>View</code>中。接下来看看这一个过程。</p>
<h2 data-id="heading-0">0x00、<code>NSSL.addContainerView()</code></h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addContainerView</span><span class="hljs-params">(View v)</span> {
    Assert.isMainThread();
    addView(v);
}
</code></pre>
<h2 data-id="heading-1">0x01、<code>ViewGroup.addView()</code></h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View child)</span> {
    addView(child, -<span class="hljs-number">1</span>);
}

...

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addView</span><span class="hljs-params">(View child, <span class="hljs-type">int</span> index, LayoutParams params)</span> {
    <span class="hljs-keyword">if</span> (DBG) {
        System.out.println(<span class="hljs-built_in">this</span> + <span class="hljs-string">" addView"</span>);
    }

    <span class="hljs-keyword">if</span> (child == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Cannot add a null child view to a ViewGroup"</span>);
    }

    <span class="hljs-comment">// addViewInner() will call child.requestLayout() when setting the new LayoutParams</span>
    <span class="hljs-comment">// therefore, we call requestLayout() on ourselves before, so that the child's request</span>
    <span class="hljs-comment">// will be blocked at our level</span>
    <span class="hljs-comment">// 1、执行了requstLayout</span>
    requestLayout();
    invalidate(<span class="hljs-literal">true</span>);
    <span class="hljs-comment">// 2、执行 addView 操作</span>
    addViewInner(child, index, params, <span class="hljs-literal">false</span>);
}
</code></pre>
<p><code>ViewGroup.addView()</code> 会执行到 <code>requestLayout()</code> 中来</p>
<h3 data-id="heading-2">1、<code>View.requestLayout()</code></h3>
<p><code>requestLayout()</code> 会不停地向上查找直到 <code>ViewRootImpl</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mMeasureCache != <span class="hljs-literal">null</span>) mMeasureCache.clear();

    <span class="hljs-keyword">if</span> (mAttachInfo != <span class="hljs-literal">null</span> &amp;&amp; mAttachInfo.mViewRequestingLayout == <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// Only trigger request-during-layout logic if this is the view requesting it,</span>
        <span class="hljs-comment">// not the views in its parent hierarchy</span>
        <span class="hljs-type">ViewRootImpl</span> <span class="hljs-variable">viewRoot</span> <span class="hljs-operator">=</span> getViewRootImpl();
        <span class="hljs-keyword">if</span> (viewRoot != <span class="hljs-literal">null</span> &amp;&amp; viewRoot.isInLayout()) {
            <span class="hljs-keyword">if</span> (!viewRoot.requestLayoutDuringLayout(<span class="hljs-built_in">this</span>)) {
                <span class="hljs-keyword">return</span>;
            }
        }
        mAttachInfo.mViewRequestingLayout = <span class="hljs-built_in">this</span>;
    }

    mPrivateFlags |= PFLAG_FORCE_LAYOUT;
    mPrivateFlags |= PFLAG_INVALIDATED;

    <span class="hljs-keyword">if</span> (mParent != <span class="hljs-literal">null</span> &amp;&amp; !mParent.isLayoutRequested()) {
		    <span class="hljs-comment">// 开始向上回溯</span>
        mParent.requestLayout();
    }
    <span class="hljs-keyword">if</span> (mAttachInfo != <span class="hljs-literal">null</span> &amp;&amp; mAttachInfo.mViewRequestingLayout == <span class="hljs-built_in">this</span>) {
        mAttachInfo.mViewRequestingLayout = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h3 data-id="heading-3">2、<code>ViewRootImpl.requestLayout()</code></h3>
<p>在 <code>ViewRootImpl</code> 中执行了 <code>scheduleTraversals()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">requestLayout</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mHandlingLayoutInLayoutRequest) {
        checkThread();
        mLayoutRequested = <span class="hljs-literal">true</span>;
        <span class="hljs-comment">// 又到了这个非常著名的方法了</span>
        scheduleTraversals();
    }
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleTraversals</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (!mTraversalScheduled) {
        mTraversalScheduled = <span class="hljs-literal">true</span>;
        <span class="hljs-comment">// 发送同步屏障</span>
        mTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();
        <span class="hljs-comment">// 注册 VSYNC 信号，监听回调触发UI渲染</span>
        mChoreographer.postCallback(
                Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, <span class="hljs-literal">null</span>);
        notifyRendererOfFramePending();
        pokeDrawLockIfNeeded();
    }
}
</code></pre>
<p>在 <code>mTraversalRunnable</code> 回调中最后执行 <code>doTraversal()</code> ，在此方法中执行了 <code>performTraversals()</code> ，就在这个方法中触发<code>measure</code>、<code>layout</code> 和 <code>draw</code> 的操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">doTraversal</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mTraversalScheduled) {
        mTraversalScheduled = <span class="hljs-literal">false</span>;
        <span class="hljs-comment">// 移除同步屏障</span>
        mHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);

        <span class="hljs-keyword">if</span> (mProfile) {
            Debug.startMethodTracing(<span class="hljs-string">"ViewAncestor"</span>);
        }
				<span class="hljs-comment">// 执行 measure、layout、draw 三大操作</span>
        performTraversals();

        <span class="hljs-keyword">if</span> (mProfile) {
            Debug.stopMethodTracing();
            mProfile = <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p>这个过程可以简化如下：</p>
<p><code>addView</code>→ <code>requestLayout</code> → <code>scheduleTraversals</code> →监听<code>VSYNC</code>→ <code>doTraversal</code> → <code>performTraversals</code> → <code>measure</code> + <code>layout</code> + <code>draw</code></p>
<h3 data-id="heading-4">3、<code>ViewGroup.addViewInner()</code></h3>
<p>接下来在 <code>addViewInner</code> 方法中触发了 <code>dispatchViewAdded</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addViewInner</span><span class="hljs-params">(View child, <span class="hljs-type">int</span> index, LayoutParams params,
        <span class="hljs-type">boolean</span> preventRequestLayout)</span> {

    ...
    addInArray(child, index);

    <span class="hljs-comment">// tell our children</span>
    <span class="hljs-keyword">if</span> (preventRequestLayout) {
        child.assignParent(<span class="hljs-built_in">this</span>);
    } <span class="hljs-keyword">else</span> {
        child.mParent = <span class="hljs-built_in">this</span>;
    }
    <span class="hljs-keyword">if</span> (child.hasUnhandledKeyListener()) {
        incrementChildUnhandledKeyListeners();
    }

    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">childHasFocus</span> <span class="hljs-operator">=</span> child.hasFocus();
    <span class="hljs-keyword">if</span> (childHasFocus) {
        requestChildFocus(child, child.findFocus());
    }

    <span class="hljs-type">AttachInfo</span> <span class="hljs-variable">ai</span> <span class="hljs-operator">=</span> mAttachInfo;
    <span class="hljs-keyword">if</span> (ai != <span class="hljs-literal">null</span> &amp;&amp; (mGroupFlags &amp; FLAG_PREVENT_DISPATCH_ATTACHED_TO_WINDOW) == <span class="hljs-number">0</span>) {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">lastKeepOn</span> <span class="hljs-operator">=</span> ai.mKeepScreenOn;
        ai.mKeepScreenOn = <span class="hljs-literal">false</span>;
        child.dispatchAttachedToWindow(mAttachInfo, (mViewFlags&amp;VISIBILITY_MASK));
        <span class="hljs-keyword">if</span> (ai.mKeepScreenOn) {
            needGlobalAttributesUpdate(<span class="hljs-literal">true</span>);
        }
        ai.mKeepScreenOn = lastKeepOn;
    }

    <span class="hljs-keyword">if</span> (child.isLayoutDirectionInherited()) {
        child.resetRtlProperties();
    }
		<span class="hljs-comment">// 分发添加</span>
    dispatchViewAdded(child);

    ...
}
</code></pre>
<p>进入了 <code>dispatchViewAdded()</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">dispatchViewAdded</span><span class="hljs-params">(View child)</span> {
    onViewAdded(child);
    <span class="hljs-keyword">if</span> (mOnHierarchyChangeListener != <span class="hljs-literal">null</span>) {
        mOnHierarchyChangeListener.onChildViewAdded(<span class="hljs-built_in">this</span>, child);
    }
}

<span class="hljs-comment">/**
 * Called when a new child is added to this ViewGroup. Overrides should always
 * call super.onViewAdded.
 *
 * <span class="hljs-doctag">@param</span> child the added child view
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onViewAdded</span><span class="hljs-params">(View child)</span> {
	<span class="hljs-comment">// 这个方法给子类实现用的</span>
}
</code></pre>
<p>在这里又回调了子类实现的 <code>onViewAdded()</code></p>
<p>即当执行 <code>addView</code> 操作后除了触发 <code>ViewRootImpl</code> 的<code>VSYNC</code>信号订阅外，还回触发 <code>onViewAdded</code> 方法。</p>
<h2 data-id="heading-5">0x02、<code>NSSL.onViewAdded()</code></h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onViewAdded</span><span class="hljs-params">(View child)</span> {
    <span class="hljs-built_in">super</span>.onViewAdded(child);
    onViewAddedInternal((ExpandableView) child);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onViewAddedInternal</span><span class="hljs-params">(ExpandableView child)</span> {
		<span class="hljs-comment">// 锁屏时自动隐藏敏感通知内容</span>
    updateHideSensitiveForChild(child);
    <span class="hljs-comment">// 监听通知项的展开/折叠，实现流畅的连锁动画和布局调整</span>
    child.setOnHeightChangedListener(<span class="hljs-built_in">this</span>);
    <span class="hljs-comment">//新通知滑入、淡入的动画效果，提供操作响应感</span>
    generateAddAnimation(child, <span class="hljs-literal">false</span> <span class="hljs-comment">/* fromMoreCard */</span>);
    <span class="hljs-comment">//确保新通知的动画与整个列表的展开/折叠状态同步</span>
    updateAnimationState(child);
    <span class="hljs-comment">//更新通知中的“时间戳”（如“刚刚”），确保信息准确</span>
    updateChronometerForChild(child);
    <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> ExpandableNotificationRow) {
        ((ExpandableNotificationRow) child).setDismissRtl(mDismissRtl);
    }
    <span class="hljs-keyword">if</span> (ANCHOR_SCROLLING) {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> once we're recycling this will need to check the adapter position of the child</span>
        <span class="hljs-keyword">if</span> (child == getFirstChildNotGone() &amp;&amp; (isScrolledToTop() || !mIsExpanded)) {
            <span class="hljs-comment">// New child was added at the top while we're scrolled to the top;</span>
            <span class="hljs-comment">// make it the new anchor view so that we stay at the top.</span>
            mScrollAnchorView = child;
        }
    }
}
</code></pre>
<h3 data-id="heading-6"><strong>与 <code>requestLayout</code> 流程的关系</strong></h3>
<p>将这些逻辑置于 <code>onViewAdded</code> 中的时机选择非常精妙：</p>
<ol>
<li><strong>即刻配置（<code>onViewAdded</code> 中）</strong>：在新通知视图进入容器的<strong>第一时间</strong>，就完成所有状态同步和关系绑定。此时，视图尚未布局。</li>
<li><strong>动态响应（后续 <code>layout</code> 过程中）</strong>：由于提前设置了 <code>OnHeightChangedListener</code>，当通知在后续交互中展开/折叠（改变高度）时，NSSL 能在监听器回调中再次触发 <code>requestLayout()</code>。</li>
<li><strong>闭环形成</strong>：这就形成了一个 <code>addView</code> → 配置 → <code>layout</code> → 用户交互 → 高度变化 → 回调 → 再次 <code>requestLayout</code> → 重新 <code>layout</code> 的<strong>完美闭环</strong>，支撑起整个动态列表。</li>
</ol>
<p>简单来说，<code>onViewAdded</code> 中的代码为每个新通知装上了 <strong>“遥控器”</strong> 和 <strong>“定位器”</strong> ，让 NSSL 这个“总控台”能够实时感知并精确控制每一个成员，从而实现高度动态、流畅的通知列表效果。</p>
<p><strong>接下来看看 layout 过程。</strong></p>
<h2 data-id="heading-7">0x03、<code>NSSL.onLayout()</code></h2>
<h3 data-id="heading-8">1、首先所有子 View 居中置顶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLayout</span><span class="hljs-params">(<span class="hljs-type">boolean</span> changed, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> t, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> b)</span> {
    <span class="hljs-comment">// we layout all our children centered on the top</span>
    <span class="hljs-comment">// 计算中心点位置</span>
    <span class="hljs-type">float</span> <span class="hljs-variable">centerX</span> <span class="hljs-operator">=</span> getWidth() / <span class="hljs-number">2.0f</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; getChildCount(); i++) {
        <span class="hljs-type">View</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> getChildAt(i);
        <span class="hljs-comment">// We need to layout all children even the GONE ones, such that the heights are</span>
        <span class="hljs-comment">// calculated correctly as they are used to calculate how many we can fit on the screen</span>
        <span class="hljs-type">float</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> child.getMeasuredWidth();
        <span class="hljs-type">float</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> child.getMeasuredHeight();
        <span class="hljs-comment">// left = centerX - width / 2.0f </span>
        <span class="hljs-comment">// 目的让 child 居中，top 固定为 0</span>
        child.layout((<span class="hljs-type">int</span>) (centerX - width / <span class="hljs-number">2.0f</span>),
                <span class="hljs-number">0</span>,
                (<span class="hljs-type">int</span>) (centerX + width / <span class="hljs-number">2.0f</span>),
                (<span class="hljs-type">int</span>) height);
    }
    <span class="hljs-comment">// 锁定 NSSL 的最大可用高度，并将此高度传递给 mShelf（通知托盘）。</span>
    <span class="hljs-comment">// 这决定了通知在滚动到哪个位置时应该开始“收缩”进入底部托盘。</span>
    setMaxLayoutHeight(getHeight());
    <span class="hljs-comment">// 计算当前所有通知的总高度（Intrinsic Height），这个加上通知之间的间距（Padding）</span>
    <span class="hljs-comment">// 以及 Section 之间的间隔</span>
    updateContentHeight();
    <span class="hljs-comment">// 防止由于布局改变（例如某条通知消失）导致的“非法滚动”。</span>
    <span class="hljs-comment">// 如果当前滚动量超过了新的内容总高度，它会将滚动条强制回弹到合法范围内。</span>
    clampScrollPosition();
		<span class="hljs-comment">// 这个方法向 ViewTreeObserver 注册一个 onPreDraw 监听。</span>
		<span class="hljs-comment">// 在下一帧绘制前，**StackScrollAlgorithm** 会介入，</span>
		<span class="hljs-comment">// 根据当前状态计算出每个 View 真正应该存在的 TranslationY</span>
    requestChildrenUpdate();
    <span class="hljs-comment">// 更新背景，通知列表是一个整体，需要为有圆角和边界的Item确定效果，</span>
    updateFirstAndLastBackgroundViews();
    <span class="hljs-comment">// 更新算法所需的最小高度</span>
    updateAlgorithmLayoutMinHeight();
    <span class="hljs-comment">// 根据通知在堆栈中的位置（是否有悬浮、是否是第一条）动态调整 TranslationZ。</span>
    <span class="hljs-comment">// 这是渲染阴影的关键，确保上层的通知阴影能正确投射在下层通知上</span>
    updateOwnTranslationZ();
}
</code></pre>
<p><strong>为什么top是0？</strong> NSSL 是一个高度动态的列表，通知的 Y 轴坐标受到滚动、展开进度、阻尼回弹、分组折叠等几十个变量影响。如果在 <code>onLayout</code> 中硬编码 Y 坐标，会导致频繁的 <code>requestLayout</code>，性能极差。因此，NSSL 选择在 <code>onLayout</code> 中完成基础定位，而将复杂的 Y 轴偏移交给 <strong><code>setTranslationY()</code></strong></p>
<p>**这样做的好处是：**当用户滚动列表时，NSSL 只需要改变子 View 的 <code>TranslationY</code>，这由 GPU 处理，不需要触发代价昂贵的全局 <code>layout</code> 过程，从而保证了通知中心滑动的极致流畅。</p>
<h3 data-id="heading-9">2、设置容器大小</h3>
<p><code>setMaxLayoutHeight</code> 和 <code>updateContentHeight</code> 设置通知列表高度。</p>
<h3 data-id="heading-10">3、触发渲染</h3>
<p><code>requestChildrenUpdate</code>它会向 <code>ViewTreeObserver</code> 注册一个 <code>onPreDraw</code> 监听。在下一帧绘制前，<strong><code>StackScrollAlgorithm</code></strong> 会介入，根据当前状态计算出每个 <code>View</code> 真正应该存在的 <code>TranslationY</code>。</p>
<p><strong>总结</strong></p>
<ul>
<li>结构层面：<code>addView</code> 触发 <code>requestLayout</code>，一路到 <code>ViewRootImpl</code>，由 VSYNC 驱动一次完整的 <code>measure/layout/draw</code>。</li>
<li>控制层面：<code>onViewAdded()</code> 中完成新通知的状态绑定和监听器安装，使其之后的任何高度和状态变化，都能回流到 NSSL 的布局和动画系统。</li>
<li>布局与动画层面：<code>onLayout()</code> 做统一基准布局，<code>requestChildrenUpdate()</code> + <code>StackScrollAlgorithm</code> 在下一帧前计算并下发真正的 TranslationY 和 Z，从而构建出一个依赖 GPU 合成、性能友好的动态通知列表。</li>
</ul>
<p><strong><code>NSSL.addContainerView()</code> 不只是“把 View 插进列表”，而是通过 <code>requestLayout + VSYNC + onViewAdded + 算法驱动 TranslationY</code>，把这条通知完全纳入到 NSSL 的滚动、动画和可见性控制闭环中，既保证结构正确，又保证交互流畅。</strong></p>
<blockquote>
<p><code>StackScrollAlgorithm</code> 对于 <code>NSSL</code> 非常重要，它是通知列表的排序算法的逻辑计算模块</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 中如何精准禁止函数参数包含特定属性]]></title>    <link>https://juejin.cn/post/7599641289886892078</link>    <guid>https://juejin.cn/post/7599641289886892078</guid>    <pubDate>2026-01-27T06:48:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599641289886892078" data-draft-id="7599640782569930779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 中如何精准禁止函数参数包含特定属性"/> <meta itemprop="keywords" content="TypeScript"/> <meta itemprop="datePublished" content="2026-01-27T06:48:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="biggerdong"/> <meta itemprop="url" content="https://juejin.cn/user/782508007891192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 中如何精准禁止函数参数包含特定属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007891192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    biggerdong
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:48:12.000Z" title="Tue Jan 27 2026 06:48:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 中如何精准禁止函数参数包含特定属性</h2>
<p>你想知道在 TypeScript 中如何定义函数参数，<strong>禁止</strong> 参数对象包含某个特定的属性，对吧？这是一个很实用的类型约束场景，TypeScript 可以通过 <strong>类型工具</strong> 精准实现这个需求。</p>
<h4 data-id="heading-1">一、核心实现思路</h4>
<p>要禁止参数包含某个属性，核心是利用 TypeScript 的：</p>
<ol>
<li>
<p><code>Omit</code>：排除对象中指定的属性（基础）；</p>
</li>
<li>
<p><code>never</code> 类型 + 交叉类型：强制指定属性为 <code>never</code>，一旦传入就报错（精准禁止）。</p>
</li>
</ol>
<h4 data-id="heading-2">二、完整实现示例</h4>
<p>下面提供两种常用方案，你可以根据场景选择：</p>
<h5 data-id="heading-3">方案 1：基础版（仅排除属性，无明确报错）</h5>
<p>适用于「参数可以没有该属性，但不能有」的基础场景，通过 <code>Omit</code> 排除指定属性：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 定义基础类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// 想要禁止的属性</span>
  <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 排除 forbiddenProp 属性，得到「允许传入」的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AllowedUser</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp'</span>&gt;;

<span class="hljs-comment">// 函数参数仅允许 AllowedUser 类型（即禁止传入 forbiddenProp）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">user: AllowedUser</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ✅ 正确：没有 forbiddenProp</span>
<span class="hljs-title function_">printUser</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp，TypeScript 会报错</span>
<span class="hljs-title function_">printUser</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-number">123</span> });
</code></pre>
<h5 data-id="heading-4">方案 2：严格版（强制禁止，明确报错）</h5>
<p>适用于「即使传入该属性为 undefined/null 也报错」的严格场景，通过交叉类型 + <code>never</code> 实现：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 定义一个「禁止包含某属性」的通用类型工具</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForbidProperty</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>&gt; = T &amp; {
  [P <span class="hljs-keyword">in</span> K]?: <span class="hljs-built_in">never</span>; <span class="hljs-comment">// 强制指定属性为 never（可选但不能有值）</span>
};

<span class="hljs-comment">// 基础用户类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">// 禁止传入 forbiddenProp 属性（即使传 undefined 也报错）</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserForbidForbiddenProp</span> = <span class="hljs-title class_">ForbidProperty</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp'</span>&gt;;

<span class="hljs-comment">// 函数参数使用严格禁止类型</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserStrict</span>(<span class="hljs-params">user: UserForbidForbiddenProp</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ✅ 正确：无 forbiddenProp</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp（有值）</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-number">123</span> });

<span class="hljs-comment">// ❌ 错误：包含 forbiddenProp（即使值为 undefined）</span>
<span class="hljs-title function_">printUserStrict</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp</span>: <span class="hljs-literal">undefined</span> });
</code></pre>
<h5 data-id="heading-5">方案 3：禁止多个属性（扩展场景）</h5>
<p>如果需要禁止多个属性，只需扩展通用类型工具：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-comment">// 通用类型：禁止多个属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ForbidProperties</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>&gt; = T &amp; {
  [P <span class="hljs-keyword">in</span> K]?: <span class="hljs-built_in">never</span>;
};

<span class="hljs-comment">// 禁止传入 forbiddenProp1 和 forbiddenProp2</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserForbidMultiProps</span> = <span class="hljs-title class_">ForbidProperties</span>&lt;<span class="hljs-title class_">User</span>, <span class="hljs-string">'forbiddenProp1'</span> | <span class="hljs-string">'forbiddenProp2'</span>&gt;;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserMulti</span>(<span class="hljs-params">user: UserForbidMultiProps</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">id</span>, user.<span class="hljs-property">name</span>);
}

<span class="hljs-comment">// ❌ 错误：包含禁止的属性</span>
<span class="hljs-title function_">printUserMulti</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp1</span>: <span class="hljs-string">'xxx'</span> });
<span class="hljs-title function_">printUserMulti</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'1'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">forbiddenProp2</span>: <span class="hljs-number">123</span> });
</code></pre>
<h4 data-id="heading-6">三、关键知识点解析</h4>
<ol>
<li>
<p><strong><code>Omit&lt;T, K&gt;</code></strong>：</p>
<ul>
<li>
<p>作用：从类型 <code>T</code> 中排除指定的属性 <code>K</code>，返回新类型。</p>
</li>
<li>
<p>局限性：仅排除属性，若手动传入该属性且值为 <code>undefined</code>，TypeScript 不会报错（如 <code>{ id: '1', name: '张三', forbiddenProp: undefined }</code> 会被允许）。</p>
</li>
</ul>
</li>
<li>
<p><strong><code>ForbidProperty&lt;T, K&gt;</code></strong> ** 通用工具**：</p>
<ul>
<li>
<p><code>T &amp; { [P in K]?: never }</code>：交叉类型，要求对象既符合 <code>T</code>，又要求指定属性 <code>K</code> 的类型为 <code>never</code>。</p>
</li>
<li>
<p><code>never</code> 类型：表示「不存在的类型」，任何值都不能赋值给 <code>never</code> 类型，因此传入该属性会直接报错。</p>
</li>
<li>
<p><code>?:</code> 可选修饰符：确保即使不传入该属性也不会报错，仅限制「传入时」的情况。</p>
</li>
</ul>
</li>
<li>
<p><strong>报错提示示例</strong>：</p>
</li>
</ol>
<p>当传入禁止的属性时，TypeScript 会给出清晰的错误提示：</p>
<pre><code class="hljs language-Plain" lang="Plain">
类型“{ id: string; name: string; forbiddenProp: number; }”的参数不能赋给类型“UserForbidForbiddenProp”的参数。
对象文字可以只指定已知属性，并且“forbiddenProp”不在类型“UserForbidForbiddenProp”中。
</code></pre>
<h4 data-id="heading-7">四、结合你之前的 Electron 场景示例</h4>
<p>如果要在创建 <code>BrowserWindow</code> 相关函数中禁止传入某个属性（比如禁止传入 <code>invalidId</code>）：</p>
<pre><code class="hljs language-TypeScript" lang="TypeScript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserWindowConstructorOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'electron'</span>;

<span class="hljs-comment">// 禁止传入 invalidId 属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ValidWindowOptions</span> = <span class="hljs-title class_">ForbidProperty</span>&lt;<span class="hljs-title class_">BrowserWindowConstructorOptions</span>, <span class="hljs-string">'invalidId'</span>&gt;;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWindow</span>(<span class="hljs-params">options: ValidWindowOptions</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>(options);
  <span class="hljs-comment">// ... 其他逻辑</span>
}

<span class="hljs-comment">// ✅ 正确：无 invalidId</span>
<span class="hljs-title function_">createWindow</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span> });

<span class="hljs-comment">// ❌ 错误：包含禁止的 invalidId</span>
<span class="hljs-title function_">createWindow</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>, <span class="hljs-attr">invalidId</span>: <span class="hljs-string">'123'</span> });
</code></pre>
<h4 data-id="heading-8">总结</h4>
<ol>
<li>
<p>禁止函数参数包含某个属性的核心是：</p>
<ul>
<li>
<p>基础场景用 <code>Omit&lt;T, K&gt;</code> 排除属性；</p>
</li>
<li>
<p>严格场景用 <code>T &amp; { [P in K]?: never }</code> 强制该属性为 <code>never</code>。</p>
</li>
</ul>
</li>
<li>
<p><code>ForbidProperty</code> 是通用类型工具，可复用在任意需要禁止属性的场景。</p>
</li>
<li>
<p>严格方案能阻止「传入属性且值为 undefined/null」的情况，比单纯 <code>Omit</code> 更严谨。</p>
</li>
</ol>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用户实践｜用 TRAE 开发 XMind-MCP 的心路历程]]></title>    <link>https://juejin.cn/post/7599232628185677859</link>    <guid>https://juejin.cn/post/7599232628185677859</guid>    <pubDate>2026-01-26T07:16:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599232628185677859" data-draft-id="7599247962822836251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用户实践｜用 TRAE 开发 XMind-MCP 的心路历程"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-26T07:16:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用户实践｜用 TRAE 开发 XMind-MCP 的心路历程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T07:16:16.000Z" title="Mon Jan 26 2026 07:16:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f9f9e31fd29402891f0e6d74022a415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=I%2BZ8IOyEVtIKlC8uYr66m6VDbP4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：张博思，TRAE 开发者用户</p>
</blockquote>
<p>本文记录了一个从“被 AI 生成的损坏文件搞到抓狂”到“自己动手开发一个 XMind-MCP 工具”的全过程。如果你也曾为 AI 生成的思维导图无法打开而烦恼，或者对如何为 AI 扩展能力感到好奇，这里有我的踩坑、思考与实践经验。项目已开源（仓库见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMaster-Frank%2FXMindMcp" target="_blank" title="https://github.com/Master-Frank/XMindMcp" ref="nofollow noopener noreferrer">github.com/Master-Fran…</a> ），欢迎围观。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e6b9100e69140c9a2cf5fdb0800e8f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=66GKOrrMhu8zAr0l0HNW9%2FEw12w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>缘起：一个被 AI“逼上梁山”的下午</strong></h2>
<p>故事始于一个普通的下午，我让 TRAE 帮我规划一份 Playwright 的学习路线。为了更直观，我突发奇想，让它把学习计划转成 XMind 格式的思维导图。</p>
<p>AI 很快给了我一个 XMind 文件，但当我尝试用 XMind 打开时，却收到了无情的错误提示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a92447e12a0d4641b894a8b30e93137a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=tLxSlFU%2BhTrw3hhwmwYK1K1zioU%3D" alt="" loading="lazy"/></p>
<p>我不死心，把错误代码发给 AI，指望它能帮我修复。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f5b8a7a7bfe45018a70f0ce8aa74528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=QOsCqHHxdva5erQWbvkYUBeEUx4%3D" alt="" loading="lazy"/></p>
<p>然而，反复修改了几次，生成的 XMind 文件依然无法打开。那时我意识到，<strong>AI 可能缺乏创建 XMind 文件的技能。</strong></p>
<p>既然 AI 做不到，那就给它一个工具帮他做到！于是，我决定自己动手，开发一个能让 AI 真正操作 XMind 文件的 MCP（模型上下文协议）工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88444b826d454d44bd6e1af9b5cdcc41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=x4%2FX66kRCuhn32K%2B3yG8dWnR9H8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>为什么我选择把 XMind 工具做成 MCP 格式</strong></h2>
<p>原因其实很简单，总结下来就三点：</p>
<p>第一，我不想让写的操作 XMind 的代码只发挥一次作用。它需要能跨项目复用，并且能方便分享，让更多人都能用上，实实在在地提升效率。因此需要将代码打包。</p>
<p>第二，如果打包成 jar 包或 npm 包，不仅使用门槛偏高，还会受限于项目的编程语言，用起来没有那么灵活便捷。</p>
<p>第三，也是最核心的一点 —— 我做这个工具的初衷，就是让 AI 能帮我们直接生成 XMind 文档。而当下主流的、能让 AI 接入外部能力的方式就是 MCP，所以它自然成了实现这个目标的最优解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17d904d752347969b76722d6823f6e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=GYRJxyigpMwsK6qUqBabUyUdSVY%3D" alt="divider03.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>从 0 到 1：我的 XMind-MCP 开发笔记</strong></h2>
<h3 data-id="heading-3"><strong>技术选型：在 Node 碰壁后，转向 Python</strong></h3>
<p>这是我第一次尝试自己做一个 MCP，所以一开始没什么头绪。还好有 TRAE 陪我慢慢探索。最初，我看到很多 MCP 工具是通过 npx 安装的，便猜测或许可以用 Node 代码实现。我让 AI 帮我尝试了十几个不同的 npm 包，结果无一成功。</p>
<p>在反复验证后，我得出一个结论：<strong>目前来看，当前没有使用 Node 生成正常的 XMind 文件的方案。</strong> 于是，我把目光转向了后端语言，最终选择了 Python。</p>
<h3 data-id="heading-4"><strong>攻克核心：既然 AI 不懂，就给它一个“范本”</strong></h3>
<p>转向 Python 后，挑战依然存在。起初反复尝试，发现产出的文件在 XMind 中打开时，依然会因为 XML 格式问题报错。不过，报错的信息和刚开始的不一样。这让我意识到，方向对了，只是细节不对。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c5e366eeaf34de58a8c990516abc240~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=%2B1uwHzg8f6%2BfdPzM%2FFraI5FnTxY%3D" alt="" loading="lazy"/></p>
<p>既然 AI 不知道正确的 XMind 文件内部结构是什么样的，<strong>那我就给它一个标准答案。</strong></p>
<p>我打开 XMind，手动创建了一个简单的 XMind 文件，把它放在项目目录中作为“模板”交给 AI，让它参考这个文件的内部结构和 XML 格式来重新编写生成 XMind 的逻辑。这个方法立竿见影，仅用几轮对话，AI 就帮我写出了能生成可正常打开的 XMind 文件的核心代码！</p>
<p>这也给我带来一个在 AI coding 中的宝贵经验：<strong>当 AI 不知道一件事怎么做时，给他一个“标准答案”。</strong> 这听起来像不像 skills 的思路？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32febcd3858143daae1883493fe4bf9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ZAoMpbn1pU3N2gCHzS5y3sVoxkM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd7562adf57b4ffd89e91ee3024ceeee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=4dtkFYUw%2B%2Fj2IbQtCuar%2F9TNwGI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5"><strong>封装成 MCP：服务器方案的弯路与 PyPI 的正途</strong></h3>
<p>核心功能完成后，下一步是把它封装成一个能被 AI 调用的 MCP 工具。</p>
<p>第一次封装 MCP 没有经验，因此我向 AI 了解封装 MCP 的方案。AI 给出的最佳的建议是——将 XMind MCP 部署到服务器上，通过 HTTP 接口的方式提供 XMind 相关的服务。为此，我还认真研究和对比了各种免费服务器方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c30014e92a24bbbbd637954a30784db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=VUStnQGOYW1fGugYH9Ia7BK4xuE%3D" alt="" loading="lazy"/></p>
<p>我对服务器部署的方案进行逐一验证，最后证明本 XMind MCP 无法通过 HTTP 的方式成功安装并提供服务。</p>
<p>我故技重施，在 TRAE 的 MCP 市场中查看热门 MCP 的安装方式并提供给 AI 用于参考。我发现大部分 MCP 是不需要服务器，支持本地安装的。例如我最近正在学习的 playwright。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e55965f97cc40b68d4b7d726af146e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=dmQbkLGN7AdNuit5P95lkMW8w2c%3D" alt="" loading="lazy"/></p>
<p>同时我查看了官方文档<strong>模型上下文协议（MCP） - 文档 - TRAE CN</strong>（ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.trae.cn%2Fide%2Fmodel-context-protocol" target="_blank" title="https://docs.trae.cn/ide/model-context-protocol" ref="nofollow noopener noreferrer">docs.trae.cn/ide/model-c…</a> ），支持本地打包安装的方式大抵有这三种</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b0a2ce5b0db425fbfd51006d2aa9f2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=R90gZw%2FoyaR5LWedNSwSbl1n914%3D" alt="" loading="lazy"/></p>
<p>既然本项目使用的编程语言是 Python，选择很显然是 uvx ！而如果需要使用 uvx 的方式安装，首先需要打包发布到 PyPI 平台。</p>
<p>于是，我注册了 PyPI 账号，把我的项目打了包并发布。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df536372e3643b487c4a3b646b2ec0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ci97ZNh1yEEnkW%2FVXKiO9YWf7eE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>当使用<em><strong>pip install XMind-mcp</strong></em>成功的那一刻，感觉非常奇妙。写了这么多年代码，终于让别人也能<em><strong>install</strong></em>我的包了！</p>
</blockquote>
<p>确定 MCP 的安装方式后，还需要确定 MCP 的连接方式。常见的 MCP 连接方式有 FastMCP 和 stdio 两种，我选择了 FastMCP。 </p>
<p>在配置 FastMCP 的过程又遇到了些波折，发现不同的大模型在解决同一个问题时的表现也各有千秋。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f947f7b4ece4789864e14461d00f968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=TvtIbPWokO3IhCbUnaDS2eArLXo%3D" alt="" loading="lazy"/></p>
<p>很意外的是，GPT5 等海外模型没成功帮我解决 MCP 连接的问题，但是 Kimi K2 解决成功了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ed212dda7b54cdfa32cf85115a06a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=4FUYf83HT%2Fes8xQEbDVEa9JTlrw%3D" alt="" loading="lazy"/></p>
<p>这段经历让我学到一个宝贵的教训：</p>
<blockquote>
<p><strong>遇到问题，如果几轮对话都无法解决，不要死磕，不妨换个模型试试。</strong> 就像遇到问题没有头绪时，咨询下其他人的意见，可能就豁然开朗了。</p>
</blockquote>
<h3 data-id="heading-6"><strong>实战与迭代：从“能用”到“好用”</strong></h3>
<p>MCP 工具初步跑通后，新的问题出现了：<strong>生成的 XMind 文件保存在哪里？</strong></p>
<p>我发现，由于 MCP 是通过 uvx 安装在 uv 的环境下，它运行时获取到的“当前目录”并不是我项目的工作区目录，导致生成的文件“不知所踪”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a804d1bc061f4e678463bbf0ef78f03c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=16ExcWAe01p7462XxK81k3QE0UM%3D" alt="" loading="lazy"/></p>
<p>为了解决这个问题，我从产品思维出发，做了两点改进：</p>
<p><strong>1、入参设置输出路径：</strong> 增加一个必填的输出路径参数，让 AI 可以指定生成的文件保存的位置。</p>
<p><strong>2、明确路径反馈：</strong> 让 MCP 在执行成功后，<strong>必须返回生成文件的绝对路径</strong>，方便用户找到。</p>
<p>我在本地测试通过后，我邀请了社区的 Nolan 大佬帮忙测试。果然，“不出意外就要出意外了”。在他的项目里，AI 似乎没完全理解如何正确调用我的 XMind MCP，导致生成的 XMind 结构错乱。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5f4e5818d7e447eab4ca41b41d43640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=O8bNDf3dsMnT0HXYbxg3Gsbuk2U%3D" alt="" loading="lazy"/></p>
<p>我认为问题出在 AI 对工具的“理解”上。我需要让我的 MCP “自我介绍”得更清楚。</p>
<p>于是我在 TRAE 请教 AI 有没有好的解决办法</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b93fe486e54f3eb37fa11fc7dfe1c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=t3ACu8bS9iEtnGo7mTsa9VJo6Yk%3D" alt="" loading="lazy"/></p>
<p>结果和我猜想的一样，需要完善 MCP 的自描述。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7643552875a464184d1c31920e2d459~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=mWSpggY%2BaK3K8jftLbBvJaOyP98%3D" alt="" loading="lazy"/></p>
<p>接下来我使用 TRAE 优化了 MCP 的自描述信息，详细说明了每个方法中每个参数的用途和数据结构，特别是核心的 data 参数应该如何组织层级关系。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fa3ae859af4112aa237f06adacd611~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=Qz3wKxBM%2FTCqGMJgKyPj3aC%2BMwA%3D" alt="" loading="lazy"/></p>
<p>这次优化效果显著。经过 4 天、21 个版本的迭代，在 TRAE 的持续帮助下，这个 XMind MCP 工具终于达到了稳定好用的状态。现在，AI 已经能一次性生成结构清晰、内容正确的思维导图了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12babf1762c84889bbf03795ea6fbc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=SE6gRPeQv78xnUB4Rp%2FH3PNT0VM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ce627c0616643a38beaef0283094c5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=5YbxvLLWSONP66l3bXJpZWdj4Tw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f61fed40cd245cebbe5755cf8e4c77f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=xxlnfAnZevEgmMArova0I6VUltI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7"><strong>三步用上 XMind-MCP</strong></h2>
<p>使用这个工具非常简单，毕竟，<strong>给 AI 用的工具，就不该为难人类用户。</strong></p>
<p><strong>第一步：复制配置</strong>在 TRAE 对话框的“设置” -&gt; “MCP”标签页下，点击“手动添加”，然后粘贴以下 JSON 配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"XMind"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"XMind-mcp"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"--mode"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"fastmcp"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1b87e0d3174ec4babd7dfe140c2c54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=wwdl4DvYh2L8tdQLaOGeLH%2BAaLk%3D" alt="" loading="lazy"/></p>
<p><strong>第二步：安装环境依赖</strong>如果你的电脑没有安装过 Python 或 uv，TRAE 会引导你进行安装。对于 Windows 用户，安装 <em><strong>uv</strong></em> 后，<strong>请确保将</strong> <em><strong>uv</strong></em> <strong>的安装路径</strong> <strong>（通常是</strong> <em><strong>C:\Users\YourUsername.uv\bin</strong></em> <strong>）手动添加到系统环境变量的</strong> <em><strong>Path</strong></em> <strong>中。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/839f92fed3944973929db34a5ca03d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=3V4PPmVBxFypHIslbPPSIAnNqwY%3D" alt="" loading="lazy"/></p>
<p><strong>第三步：选择智能体并开始使用</strong>安装成功后，选择你刚刚配置了 XMind-MCP 的那个智能体，然后就可以直接向 AI 下达指令了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b0786ca0ee246c2b71e64a2da6a42fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=am2hku%2B5k0KIl77dd8p4FoN%2Fnmk%3D" alt="" loading="lazy"/></p>
<p>例如，你可以说： <strong>“帮我使用 XMind mcp 生成一个关于 agent 学习的 XMind 文件。”</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/420d9545409f4364b9e50c02087073c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=ald%2B4UnA23dmp2bbVRJJFJzcvmo%3D" alt="" loading="lazy"/></p>
<p><strong>欢迎大家体验，有任何问题或建议，随时可以向我反馈！</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbd7580335ee4013be8e225251a3b7b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=%2B3a%2FQ9d3fggolb9faCTgCCZbB9g%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8"><strong>XMind MCP 能做什么？</strong></h2>
<p>目前，XMind-MCP 支持以下核心功能：</p>
<ul>
<li>
<p><strong>读取思维导图：</strong> 读取 XMind 文件中每个节点的信息</p>
</li>
<li>
<p><strong>创建思维导图：</strong> 使用结构化数据（如 JSON）创建新的 XMind 文件。</p>
</li>
<li>
<p><strong>文件格式转换：</strong> 支持将 TXT、Markdown、HTML、Word、Excel 等多种格式的内容直接转换成 XMind 思维导图。</p>
</li>
<li>
<p><strong>分析思维导图结构：</strong> 分析 XMind 文件中的节点数和最大层级等信息，并给出是否健康的评价。</p>
</li>
<li>
<p><strong>文件检索：</strong> 列出指定目录下的所有 XMind 文件。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d5742f7f1d8422f90e8ca85da39e4b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770017877&amp;x-signature=esEY%2Bm%2BKwtlvHRdOAwDw9q%2B7enI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！]]></title>    <link>https://juejin.cn/post/7598737609495068691</link>    <guid>https://juejin.cn/post/7598737609495068691</guid>    <pubDate>2026-01-26T01:21:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609495068691" data-draft-id="7597946284678414355" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！"/> <meta itemprop="keywords" content="Go,Docker,React.js"/> <meta itemprop="datePublished" content="2026-01-26T01:21:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java陈序员"/> <meta itemprop="url" content="https://juejin.cn/user/3958702402176765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别证书过期焦虑！这款开源工具让 SSL 管理彻底自动化！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3958702402176765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java陈序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:21:25.000Z" title="Mon Jan 26 2026 01:21:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 <code>Java陈序员</code>。</p>
<p>无论是研发个人产品，还是中小企业做运维，会遇到要管理多个域名的情况，需要给域名申请证书。</p>
<p>但是手动申请证书往往很麻烦（尤其是有多个域名需要维护），而且很容易遗忘证书的过期。</p>
<p>今天，给大家推荐一款开源的证书管理工具，全流程管控 SSL 管理！</p>
<h2 data-id="heading-0">项目介绍</h2>
<p><code>certimate</code> —— 一款完全开源免费的自托管 SSL 证书 ACME 工具，申请、部署、续期全流程自动化可视化，支持各大主流云厂商。</p>
<p><strong>功能特色</strong>：</p>
<ul>
<li><strong>全流程自动化</strong>：无需编写代码，通过界面拖拽/配置即可搭建证书管理流程，配置完成后，从证书申请、ACME 验证到部署至目标平台，全程无需人工干预</li>
<li><strong>私有化部署</strong>：无需安装数据库、运行时或复杂框架，一键启动，开箱即用，所有数据本地化存储，掌控数据的隐私与安全</li>
<li><strong>生态适配拉满</strong>：阿里云、腾讯云、Cloudflare、AWS、华为云等主流域名托管商全覆盖，同时兼容 Let's Encrypt、Google Trust Services、ZeroSSL 等主流免费/付费证书颁发机构</li>
<li><strong>多维度监控</strong>：证书到期、申请失败、部署异常等状态，可通过邮件、钉钉、飞书、企业微信、Webhook 等实时推送</li>
<li><strong>轻量开源</strong>：超轻量的资源开销，仅需 ~16 MB 内存，完全开源免费，无功能阉割、无付费门槛</li>
</ul>
<h2 data-id="heading-1">快速上手</h2>
<p><code>certimate</code> 支持二进制安装、Docker 安装、源码编译安装等多种安装方式。</p>
<h3 data-id="heading-2">二进制安装</h3>
<p>1、下载预先编译好的二进制可执行文件压缩包</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/certimate-go/certimate/releases
</code></pre>
<blockquote>
<p>压缩包文件名后缀包含系统架构信息，需要根据操作系统自行选择相应的压缩包，下载并解压缩全部文件。</p>
</blockquote>
<p>2、进入解压后的目录，并在终端中执行</p>
<pre><code class="hljs language-bash" lang="bash">./certimate serve
</code></pre>
<p>3、运行成功后，浏览器访问</p>
<pre><code class="hljs language-bash" lang="bash">http://{IP/域名}:8090
</code></pre>
<p>4、初始的管理员账号及密码：</p>
<ul>
<li>账号：<code>admin@certimate.fun</code></li>
<li>密码：<code>1234567890</code></li>
</ul>
<h3 data-id="heading-3">Docker 安装</h3>
<ul>
<li>Docker 命令安装</li>
</ul>
<p>1、拉取镜像</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取镜像</span>
docker pull certimate/certimate:latest

<span class="hljs-comment"># 国内镜像</span>
docker pull registry.cn-shanghai.aliyuncs.com/certimate/certimate:latest
</code></pre>
<p>2、创建挂载目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /data/software/certimate
</code></pre>
<p>3、运行容器</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name certimate \
  --restart unless-stopped \
  -p 8090:8090 \
  -v /etc/localtime:/etc/localtime:ro \
  -v /etc/timezone:/etc/timezone:ro \
  -v /data/software/certimate:/app/pb_data \
  certimate/certimate:latest

<span class="hljs-comment"># 国内镜像</span>
docker run -d \
  --name certimate \
  --restart unless-stopped \
  -p 8090:8090 \
  -v /etc/localtime:/etc/localtime:ro \
  -v /etc/timezone:/etc/timezone:ro \
  -v /data/software/certimate:/app/pb_data \
  registry.cn-shanghai.aliyuncs.com/certimate/certimate:latest
</code></pre>
<ul>
<li>Docker Compose 安装</li>
</ul>
<p>1、创建 <code>docker-compose.yml</code> 文件并填写如下内容</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.0"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">certimate:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">certimate/certimate:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">certimate</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8090</span><span class="hljs-string">:8090</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/timezone:/etc/timezone:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/app/pb_data</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
</code></pre>
<p>2、一键启动</p>
<pre><code class="hljs language-bash" lang="bash">docker compose up -d
</code></pre>
<h2 data-id="heading-4">功能体验</h2>
<ul>
<li><strong>仪表盘</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0d8869e1c654e6b9007bdbd0792d8ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=e38SmIDBJ5Vsa3OkccizXoUP9XI%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>工作流</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5921ef5b112475d94facde6cd7e6fc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=t8ECONOTXEq1DTrDADepW%2BAXE%2Fk%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>流程编排</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1176b9788c11438e9c80ce9877658a59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=GrEhNym5YUkU2%2F8Sh%2BV9b8ERxIs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ce60274ad914d878d6d4e030510ccfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=6ul%2F6tjKI3dtLK%2FS238Ewq8ZEgw%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>运行历史</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f79adac1a506433ca3fe637fd6e956f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=M4aqkbYG5laPpx3XMCZmbClzBrw%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>主机提供商</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d14a9cd23552477c81cd83ee3feddec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=11cGKKwI3fdhw0lMqjx2bz69qC0%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>证书颁发机构</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e76ead178c843c7b944c326ee08efff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=d5gBAnY7OMiux5osPBCLXUfM4%2FE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>通知渠道</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e858e0800de5470786354eb73f099db1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=xnlX%2FWbtqxtOFD5YPcXPD6id94g%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>系统设置</strong></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05ef7e6c4d7d4d3989c8156196a73979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YemZiOW6j-WRmA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769995284&amp;x-signature=1uk5fx0mYM6MKF5T3CXxapqvCwc%3D" alt="" loading="lazy"/></p>
<p>可以说，<code>certimate</code> 把 SSL 证书管理从<strong>重复体力活</strong>变成<strong>自动化流程</strong>。不仅私有化部署可以保障数据安全，而且丰富的生态适配满足不同场景需求。无论是个人还是企业，都能通过它彻底告别证书过期的焦虑。快去部署体验吧~</p>
<pre><code class="hljs language-bash" lang="bash">项目地址：https://github.com/certimate-go/certimate
</code></pre>
<h2 data-id="heading-5">最后</h2>
<p>推荐的开源项目已经收录到 <code>GitHub</code> 项目，欢迎 <code>Star</code>：</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/chenyl8848/great-open-source-project
</code></pre>
<p>或者访问网站，进行在线浏览：</p>
<pre><code class="hljs language-bash" lang="bash">https://chencoding.top:8090/<span class="hljs-comment">#/</span>
</code></pre>
<blockquote>
<p>大家的点赞、收藏和评论都是对作者的支持，如文章对你有帮助还请点赞转发支持下，谢谢！</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大]]></title>    <link>https://juejin.cn/post/7599514071104765967</link>    <guid>https://juejin.cn/post/7599514071104765967</guid>    <pubDate>2026-01-26T10:33:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599514071104765967" data-draft-id="7599220371666272296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大"/> <meta itemprop="keywords" content="搜索引擎"/> <meta itemprop="datePublished" content="2026-01-26T10:33:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 ES 的搜索结果只到 10,000？强制“数清楚”的代价有多大
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T10:33:09.000Z" title="Mon Jan 26 2026 10:33:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“为什么搜出来的结果总数永远是 10,000？是不是数据丢了？”</p>
</blockquote>
<p>这是每一个 Elasticsearch 新手在 7.x 版本之后都会遇到的“灵魂发问”。</p>
<p>而在得知“这是 ES 的默认性能优化”后，绝大多数人的第一反应往往是抗拒：“我不想要优化，我要精准的数字！老板要看，前端分页也要用。”</p>
<p>于是，在许多项目的代码库里，我们都能看到这样一行“补丁”：</p>
<p><code>"track_total_hits": true</code></p>
<p>数字终于准了，变成了 854,321，大家都很满意。</p>
<p>但没人注意到，就在这行代码生效的瞬间，集群的 CPU 占用率可能直接翻倍，查询延迟从 20ms 劣化到了 500ms。</p>
<p>为什么一个简单的“计数”，会成为拖垮集群性能的隐形杀手？</p>
<p>今天，我们不谈玄学，从 Lucene 底层原理 层面，揭秘这背后的代价。</p>
<h2 data-id="heading-0">现象：消失的“尾部数据”</h2>
<p>在 ES 7.0 之前，查询默认会算出精确总数。但在 7.0 之后，默认的响应体变成了这样：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"relation"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gte"</span>  <span class="hljs-comment">// 注意：Greater Than or Equal to (大于等于)</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这不仅是一个数字的变化，更是搜索引擎检索逻辑的根本性范式转移：</p>
<p>从“找出所有匹配文档”进化为“只找出最有价值的 Top N”。</p>
<h2 data-id="heading-1">深度解析：Block-Max WAND 算法的智慧</h2>
<p>要理解为什么“数不准”能带来性能飞跃，必须深入 Lucene 的底层，了解 Block-Max WAND (BMW) 算法。</p>
<h3 data-id="heading-2">1. 倒排索引的物理结构：Block</h3>
<p>在 Lucene 的倒排索引（Inverted Index）中，一个 Term（词项）对应的 Postings List（文档 ID 列表）并不是一整条长链，而是被切分成了多个 Block（块），通常包含 128 个文档 ID。</p>
<p>关键点在于：</p>
<p>每个 Block 都有一个 Block Header，里面记录了这个块的元数据，其中最重要的一个是：</p>
<p>Max Score（块内最大分数）：即这个 Block 里所有文档中，能产生的最高相关性得分是多少。</p>
<h3 data-id="heading-3">2. 竞速机制：Min Competitive Score</h3>
<p>当 ES 执行查询（比如查询“手机”）并索要 Top 10 结果时，它会维护一个 最小竞争分数（Min Competitive Score）。</p>
<ul>
<li>
<p>刚开始，Top 10 没满，最小竞争分数是 0。</p>
</li>
<li>
<p>随着扫描进行，找到了 10 个文档，第 10 名的分数是 5.0。</p>
</li>
<li>
<p>此时，最小竞争分数变成了 5.0。意味着：任何分数低于 5.0 的文档，连进决赛圈的资格都没有。</p>
</li>
</ul>
<h3 data-id="heading-4">3. “隔山打牛”的跳跃优化</h3>
<p>接下来，神奇的事情发生了。</p>
<p>当遍历指针来到下一个 Block（假设包含 ID 1000-1127）时，算法不需要解压这个 Block，也不需要计算具体的文档分数，而是直接看 Block Header：</p>
<blockquote>
<p>算法拷问： “这个 Block 的 Max Score 是多少？”Block 回答： “最高只能得 4.5 分。”算法判断： “现在的门槛（Min Competitive Score）已经是 5.0 了。你这个 Block 里的文档全是‘废柴’，整个 Block 直接跳过！”</p>
</blockquote>
<p>结果： ES 可能直接跳过了数百万个低分文档。</p>
<p>代价： 因为跳过了，ES 根本不知道刚才那个 Block 里有几个文档匹配（虽然分低，但确实匹配）。所以，它无法给出精确的总数。</p>
<h2 data-id="heading-5">隐形陷阱：为什么关了 track_total_hits 依然慢？</h2>
<p>你以为把 track_total_hits 设为 false 就万事大吉了？</p>
<p>别天真了。 在某些特定场景下，即使你显式关闭了计数，ES 依然无法使用 Block-Max WAND 进行剪枝，查询性能依然会很差。</p>
<p>这就好比你告诉司机“不用数路边有几棵树（不计数）”，但你同时又下令“把路边每棵树的叶子都摘一片下来（聚合）”。司机虽然不用数数，但他依然得停在每一棵树下。</p>
<h3 data-id="heading-6">1. 聚合（Aggregations）：WAND 的天敌</h3>
<p>WAND 算法的核心奥义是 “Skipping（跳过）”。</p>
<p>而聚合（Aggregations）的核心诉求是 “Traversing（遍历）”。</p>
<p>如果你在查询中包含任何聚合（例如 <code>terms</code>、<code>avg</code>、<code>date_histogram</code>），ES 必须访问所有匹配的文档来计算统计值。</p>
<ul>
<li>
<p>冲突点：你不能跳过一个 Block，因为那个被跳过的 Block 里可能包含聚合所需的数据。</p>
</li>
<li>
<p>结果：WAND 优化被迫关闭，全量扫描不可避免。</p>
</li>
</ul>
<h3 data-id="heading-7">2. 排序与分数的纠结（Sort + track_scores）</h3>
<p>Block-Max WAND 依赖于 Max Score 来进行跳跃。</p>
<ul>
<li>
<p>场景：你按时间排序 (<code>sort: [{"timestamp": "desc"}]</code>)。</p>
</li>
<li>
<p>陷阱：如果你手滑加了 <code>track_scores: true</code>（或者某些 Client 默认开启）。</p>
</li>
<li>
<p>后果：虽然是按时间排序，但因为你强行索要 <code>_score</code>，ES 必须对每个文档计算分数，导致无法利用 BKD Tree 的索引顺序进行快速跳跃，也难以通过 WAND 进行分数剪枝（因为排序不是按分数排的）。</p>
</li>
</ul>
<h2 data-id="heading-8">代价：track_total_hits 如何摧毁性能</h2>
<p>口说无凭，数据为证。我们在 Serverless 8.17 环境下，创建一个6分片1副本的索引，写入约 2 亿条 脱敏文档，总计约30G数据，查询qps控制在30 。用实测结果向你展示——track_total_hits 取不同值时的cu消耗及响应时长：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b42c37cdd0db4318af44b2873e09607b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=%2Bz8vTJtg6%2BJbxbAYMp85ITEtTr4%3D" alt="" loading="lazy"/></p>
<p>CPU 资源消耗对比(true,false,10000)</p>
<p>​<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d01ffef0e164ba09662dc008a1a59c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=8f4n1YHNv0N03LNaG8Y9Msihm%2FM%3D" alt="" loading="lazy"/></p>
<p>平均耗时和 P95 耗时对比(true,false,10000)</p>
<p>当你加上 "track_total_hits": true 时，你实际上是在对底层引擎下达一道“死命令”：</p>
<p>“禁用 Block-Max WAND 优化，禁止跳过任何一个 Block。”这带来的性能崩塌是显著的。</p>
<h3 data-id="heading-9">1. CPU 的燃烧（计算密集）</h3>
<ul>
<li>
<p>优化模式：只解压和计算高分 Block。</p>
</li>
<li>
<p>强制计数：必须解压所有匹配的 Block（使用 Frame Of Reference 编码），并对每一个文档 ID 进行解码和比对。</p>
</li>
<li>
<p>量级差异：如果查询匹配 1 亿条数据，原本只需计算 Top 1000 的分数，现在必须计算 1 亿次。CPU 消耗可能增加几个数量级。</p>
</li>
</ul>
<h3 data-id="heading-10">2. I/O 的雪崩（访存密集）</h3>
<ul>
<li>
<p>优化模式：低分 Block（通常是历史冷数据）直接跳过，不需要从磁盘读取。</p>
</li>
<li>
<p>强制计数：强制读取所有 Block。</p>
</li>
<li>
<p>后果：这会导致大量的随机 I/O。更致命的是，这些本该沉睡的冷数据被加载到内存中，会污染 Page Cache，把真正热点的数据（比如最近 5 分钟的日志）挤出去。</p>
</li>
<li>
<p>现象：你会发现，为了查一个总数，整个集群的写入性能和热查询性能都下降了。</p>
</li>
</ul>
<h2 data-id="heading-11">决策矩阵：到底什么时候该用？</h2>
<p>我们需要建立一个清晰的决策标准，而不是盲目地 <code>true</code>。</p>
<p><strong>场景</strong></p>
<p><strong>track_total_hits 设置</strong></p>
<p><strong>理由</strong></p>
<p><strong>C 端搜索 / App 列表</strong></p>
<p><code>false</code> 或 <code>10000</code> (默认)</p>
<p>用户只翻前几页。显示“10,000+”完全满足体验，性能最优。</p>
<p><strong>高频业务接口</strong></p>
<p><strong>(QPS &gt; 100)</strong></p>
<p><code>false</code></p>
<p>**绝对禁止开启。**高并发下开启全量计数是集群雪崩的导火索。</p>
<p><strong>后台管理 / 审核列表</strong></p>
<p><code>true</code> (慎用)</p>
<p>运营人员并发低，且必须知道确切的“待办数量”。</p>
<p><strong>数据大盘 / 趋势图</strong></p>
<p><code>false</code> (使用聚合)</p>
<p>不要用 hits.total 画图！请使用 <code>date_histogram</code> 或 <code>cardinality</code> 聚合。</p>
<p><strong>数据导出</strong></p>
<p><code>false</code></p>
<p>导出任务应使用 Scroll API 或 Point in Time (PIT) API，这些 API 针对全量遍历做了优化，不需要实时计算总数 。</p>
<h2 data-id="heading-12">Serverless 下的治理之道</h2>
<p>在自建集群中，很难限制开发者的代码行为。但在 阿里云 ES Serverless 中，我们建议通过配置进行防御性治理。</p>
<h3 data-id="heading-13">1. 软限制："Track Total Hits上限"</h3>
<p>你可以通过 ES Serverless 控制台—开启功能设置，给查询加上一道“保护锁”：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea09ce16766a4fcd982a9831070dbb65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770028389&amp;x-signature=f3h%2FjLvAZSfXxYfQYlpUWbWDrlk%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>效果：一旦设置，即使客户端请求中带了 <code>"track_total_hits": true</code>，服务端也会强制忽略，只计算到 10,000。</p>
</li>
<li>
<p>价值：从根源上防止了某个实习生的一行代码搞挂整个生产集群。</p>
</li>
</ul>
<h3 data-id="heading-14">2. 拥抱“模糊的正确”</h3>
<p>在云原生时代，算力是按量计费的（CU）。</p>
<p>“无意义的精确计数” = “直接烧钱”。</p>
<p>利用 Serverless 的弹性与治理能力，将算力集中在真正产生业务价值的 Top N 搜索上，才是降本增效的关键。</p>
<h2 data-id="heading-15">附录：代码与实操</h2>
<h4 data-id="heading-16">1. 正确的查询姿势 (DSL)</h4>
<p><strong>场景 A：只要 Top 10 (性能最快)</strong></p>
<pre><code class="hljs language-json" lang="json">GET /logs/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"match"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"error"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"track_total_hits"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>  <span class="hljs-comment">// 显式关闭，连 10000 都不数，最快</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>场景 B：需要精确计数 (Java Client)</strong></p>
<pre><code class="hljs language-ini" lang="ini">SearchRequest <span class="hljs-attr">searchRequest</span> = new SearchRequest(<span class="hljs-string">"logs"</span>)<span class="hljs-comment">;</span>
SearchSourceBuilder <span class="hljs-attr">sourceBuilder</span> = new SearchSourceBuilder()<span class="hljs-comment">;</span>
sourceBuilder.query(QueryBuilders.matchQuery("message", "error"))<span class="hljs-comment">;</span>

// ⚠️ 警告：仅在必要时开启，注意性能损耗
sourceBuilder.trackTotalHits(true)<span class="hljs-comment">; </span>

// 或者设置一个具体的上限，例如 5万
// sourceBuilder.trackTotalHitsUpTo(50000)<span class="hljs-comment">; </span>

searchRequest.source(sourceBuilder)<span class="hljs-comment">;</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h3 data-id="heading-17">2. 高效替代方案：Cardinality 聚合</h3>
<p>如果你只是想知道“大概有多少条日志”，不要用 <code>track_total_hits</code>，请用 HyperLogLog 算法：</p>
<pre><code class="hljs language-json" lang="json">GET /logs/_search
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"aggs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total_count_approx"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"cardinality"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"field"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_id"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 或者其他高基数主键</span>
        <span class="hljs-attr">"precision_threshold"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span> 
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<ul>
<li>
<p>优点：性能极快，内存占用极低。</p>
</li>
<li>
<p>缺点：有约 5% 以内的误差。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[血压飙升，Flutter & Dart 2025 年度巨坑回顾]]></title>    <link>https://juejin.cn/post/7598737609494855699</link>    <guid>https://juejin.cn/post/7598737609494855699</guid>    <pubDate>2026-01-25T22:56:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598737609494855699" data-draft-id="7598744870995771435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-01-25T22:56:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            血压飙升，Flutter &amp; Dart 2025 年度巨坑回顾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T22:56:12.000Z" title="Sun Jan 25 2026 22:56:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，Google 官方发布了<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FHQ5_59Mm1WT1xsiPuy6I2w" target="_blank" title="https://mp.weixin.qq.com/s/HQ5_59Mm1WT1xsiPuy6I2w" ref="nofollow noopener noreferrer">《Flutter &amp; Dart 2025 年度十大高光时刻回顾》</a>，内容包括：</p>
<ul>
<li>Flutter 3.29 - 3.38 版本更新</li>
<li>Dart 3.7 - 3.19 版本更新</li>
<li>Flutter Roadmap &amp; Google I/O</li>
<li>NotebookLM、teamLab、Agape、Universal Destinations &amp; Experiences、Reflection.app 、 GE Appliances 、talabat 等案例展示</li>
<li>Material 和 Cupertino 拆分进度</li>
<li>build_runner 提速速度</li>
<li>Dart 与 Flutter MCP Server</li>
<li>Flutter AI Toolkit 、GenUI</li>
<li>····</li>
</ul>
<p>但是又怎么可以报喜不报忧？既然官方报喜，那我就来点忧的，<strong>2025 在 Flutter 内容上我的大概写了有 60 来篇，稍微整理几个给大家直观回顾下 2025 Flutter 究竟经历了哪些经典巨坑</strong>。</p>
<blockquote>
<p>只能说 Flutter 坑接坑不断，但 iOS 能占一半。</p>
</blockquote>
<h2 data-id="heading-0">宏</h2>
<p>Flutter 在 2025 年 1 月的时候，开年就送上了大礼，官方决定 Dart 宏功能推进暂停，后续专注定制数据处理支持，宏功能是在 2024 年初开始决定推进的，而 2025 年开年，官方得到了一个结论：</p>
<blockquote>
<p><strong>做出来能用是能用，但是质量和性能都达不到一开始的预期，而且维护成本很高</strong>。</p>
</blockquote>
<p>所以对于社区里大家盼星星盼月亮都在等的宏支持就这么夭折了，虽然不久前官方也再次出来解释了为什么暂停：</p>
<ul>
<li>宏执行时序与 Dart 常量模型存在根本冲突</li>
<li>JSON metadata 方案“能跑但不可用”</li>
<li>Analyzer + CFE 双体系导致工作量与复杂度指数级爆炸</li>
<li>性能与 IDE 体验无法接受</li>
<li>无法完全替代 build_runner</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81e81873180b40cba601194c60110e2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=WFxWKmdWN7oVCpN2RZTh2otLvzw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7591730714140606506" target="_blank" title="https://juejin.cn/post/7591730714140606506">《Dart 官方再解释为什么放弃了宏编程》</a></p>
</blockquote>
<p>但是宏终归还是凉了，<strong>官方也将精力回归到 build_runer ，也在性能上做出了一些不小的提升</strong>，但是 Augmentation 支持还是没落地（它允许通过 <code>augment</code> 关键字，在新文件里去“补充”旧文件的定义），这也是 2025 官方在宣布宏放弃之后，没能完全填不上的坑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea3f5f30f6ce48f0822fdd68a237e75a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=nqEX9zEx22E%2Bd91K3e%2BZMBNZVKk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">线程合并</h2>
<p>线程合并是 Flutter 在 3.29 的重大调整，在过去 <strong>Flutter 的 UI Runner 和 Android/iOS 平台的 Platform Runner 是处于不同线程</strong>，其中 Dart 的 root isolate 会在被关联到 UITaskRunner 上。</p>
<p>所以在过去 Flutter 里会有异步 platform channels 的存在，因为 UI Runner 和 Platform Runner 分属不同线程，所以 Dart 和 Native 互相调用时需要序列化和异步消息传递。</p>
<p>而在 3.29 里，作为改进移动平台上 Native 和 Dart 互操作系列调整中的一部分，两个线程被合并了，说人话就是： <code>UI Runner = Platform Runner </code>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029fb241548e4f49a85825a6bbe41221~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=H63enzHN5IZAM4yEtC3G%2FoO4vUo%3D" alt="" loading="lazy"/></p>
<p>实际上这是一个不错的调整，<strong>因为同步调用是趋势，而且也能解决 Flutter 的许多历史问题，也是一个大趋势</strong>，但是步子迈大了，总会扯出一些问题，而线程合并带来的问题还不少：</p>
<ul>
<li>Android 断点 Dart 代码现在会导致 ANR 弹窗死循环</li>
<li>线程合并之后，启动引擎、应用和设置 Dart 代码都运行的平台线程上，会导致第一个可交互帧的时间变长</li>
<li>Win 出现 Failed to post message to main thread 或者渲染卡死问题</li>
<li>一些插件过去没适配同步线程，导致卡顿明显</li>
<li>······</li>
</ul>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7496397558359162934" target="_blank" title="https://juejin.cn/post/7496397558359162934">《Flutter 在全新 Platform 和 UI 线程合并后，出现了什么大坑和变化？》</a></p>
</blockquote>
<p>这个改动带来的效益和目标是好的，也为 FFI 等同步调用场景打下了基础，但是奈何这类 break change 带来的问题，在初期版本可以说是灾难，在当时生产几乎都是选择暂时关闭这个特性。</p>
<h2 data-id="heading-2">mprotect failed: Permission denied</h2>
<p>iOS 可以说是 2026 Flutter 问题的重灾区，特别因为 iOS 26 的到来，给 Flutter 带来了不少全新的适配成本，其中就包括这个 mprotect failed，<strong>现象就是无法在 iOS 真机上 Debug 运行</strong>，因为 Apple 官方禁止了 JIT 支持的“漏洞”。</p>
<p>这个问题其实也很戏剧性：</p>
<ul>
<li>问题一开始出现在 iOS 18.4 beta，但是在 Flutter 还没处理的时候，但 iOS 18 beta2 该“漏洞”又可以正常使用，所以适配放缓</li>
<li>iOS 26 beta1 mprotect 漏洞又重新禁止了，所以 Flutter 又需要对适配加急</li>
</ul>
<p>所以 Flutter 不得不在 iOS 26 ，通过 LLDB 的 <code>debugserver</code> ，然后利用 python 脚本实现适配黑科技：对同一个内存地址，在 Debug 时做到同时 RW 和 RX 支持 ，实际上就是开了两道门。</p>
<blockquote>
<p>更多可见：<a href="https://juejin.cn/post/7542461507402924075" target="_blank" title="https://juejin.cn/post/7542461507402924075">《Flutter 又双叒叕可以在 iOS 26 的真机上 hotload 运行了》</a></p>
</blockquote>
<p>事实上这个支持一直不太好，成功率不高，经常会出现超时等问题，一直等到 iOS 26 发布之后， devicectl + lldb 的支持才完善，Debug 的真机 JIT 运行才回到正轨。</p>
<p>所以这里还有另外一问题，就是<strong>由于苹果对于 <code>ios-deploy</code> 的“废弃”，导致了 iOS 真机 Debug 运行出现 Timed out * to update 的问题</strong> ，具体表现在：</p>
<blockquote>
<p>如果你直接在 Xcode 直接运行这个 Flutter 项目是可以正常运行，但是通过 flutter 命令运行或者 ide run 就不行。</p>
</blockquote>
<p>这个坑相信有不少人踩过，当时临时解决方式包括有：</p>
<ul>
<li>需要安装 Xcode 并且运行时会弹出 Xcode 窗口</li>
<li>用户在 macOS 的<code>“系统设置 &gt; 隐私与安全性 &gt; 自动化”</code>中给予相应的权限</li>
<li>关闭 Wi-Fi，因为有时候即使 iPhone 通过 USB 数据线连接到 Mac，Xcode 也可能优先选择通过 Wi-Fi 进行调试连接</li>
<li>如果还不行，可以尝试 Xcode 直接运行，然后执行 <code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2aa15e6f60f4c4f8f021e4747afc47c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=lXHqRrkv9WekOT1PKnQGeTT%2FeTI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>搞笑的是，有一段时间，<code>flutter attatch</code> 尝试连接 Dart VM Observatory 服务也 Timeout 了，详细可见：<a href="https://juejin.cn/post/7529752760076009508" target="_blank" title="https://juejin.cn/post/7529752760076009508">《聊聊 Flutter 在 iOS 真机 Debug 运行出现 Timed out *** to update 的问题》</a></p>
</blockquote>
<p>一直到 <a href="https://juejin.cn/post/754246150740292407" target="_blank" title="https://juejin.cn/post/754246150740292407">《Flutter 完成全新 devicectl + lldb 的 Debug JIT 运行支持》</a> 之后，iOS 的开发运行才回归正轨，这时候已经是接近 2025 的 9 月份了。</p>
<h2 data-id="heading-3">iOS 26 模拟器无法运行</h2>
<p>在 3.35 的时候，Flutter 开发者发现，Flutter 在 iOS 26 模拟器上也“随机”出现无法运行的情况，运行时会出现 <code>Unable to find a destination matching the provided destination specifie</code> 这样的提示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb33cc4a9530431f86b18ed7ba37408c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=2dUTkqF4CUHDQL1nqZztQkW2zkE%3D" alt="" loading="lazy"/></p>
<p>当然，这个即是 Flutter 的问题，也不是 Flutter 的问题，但是它是真很坑，因为在一开始，大家都不知道为什么会出现这个问题，而且为什么有的项目会有，有的项目不会，经过很长时间排查才发现，<strong>是一些插件和模拟器之间的适配问题</strong>，实际上问题是：</p>
<blockquote>
<p><strong>用的插件不支持 “ARM 模拟器”，而你默认使用的 iOS 26 模拟器只支持 ARM</strong> 。</p>
</blockquote>
<p>而解决问题的方式也很简单，只需在 Mac 上安装 <strong>Rosetta</strong> ，然后从 Xcode 中移除 <strong>iOS 26</strong> 平台，然后运行以下命令：</p>
<blockquote>
<p><code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code></p>
</blockquote>
<p><strong>重新下载的会是具有通用架构支持的 iOS 26</strong>，而不仅仅是基于 Apple 的 ARM 架构默认配置，所以解决方案是强制 Xcode 下载 iOS 26 模拟器的“通用”版本，而不是默认的“Apple Silicon”，通过 <code>xcodebuild -downloadPlatform iOS -architectureVariant universal</code> 之后，就可以看到通用的 iOS 26 模拟器组件以及 Rosetta 模拟器：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68ecb50f4f5a45f99ad625d402e30265~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Li2%2Be%2Ba0sX4RmF1Q8utgj0jwTt4%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>Rosetta 只能说是一个临时的解决方式，核心还是要看哪些插件仍然无法运行 ARM</strong> ，但是也是一些 Flutter 插件没适配好，这锅 Flutter 也要背。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7560986017034190891" target="_blank" title="https://juejin.cn/post/7560986017034190891">《Flutter 在 iOS 26 模拟器跑不起来？其实很简单》</a></p>
</blockquote>
<h2 data-id="heading-4">iOS 26 WebView</h2>
<p>这也是一个大坑问题，就是 Flutter WebView 在 iOS 26 上有点击问题，原因来自 Flutter 的技术债务，核心原因就是因为一直以来线程合并之前的 <code>MethodChannel</code> 只能异步。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fecb7f0d9ee04307971d881e125c9c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=43xN8H9Daj4Gcvkk2YZ6%2BAbvNqc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>可谓是一环扣一环，毕竟线程同步后的 FFI 还真是解决这个的思路。</p>
</blockquote>
<p>那你要说这个问题有多坑，你看我都可以写三篇文章，就知道这个问题有多蛋疼：</p>
<ul>
<li><a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">《为什么你的 Flutter WebView 在 iOS 26 上有点击问题？》</a></li>
<li><a href="https://juejin.cn/post/7583577045578907674" target="_blank" title="https://juejin.cn/post/7583577045578907674">《Flutter 官方正式解决 WebView 在 iOS 26 上有点击问题》</a></li>
<li><a href="https://juejin.cn/post/7584443518162141220" target="_blank" title="https://juejin.cn/post/7584443518162141220">《再次紧急修复，Flutter 针对 WebView 无法点击问题增加新的快速修复》</a></li>
</ul>
<p>问题最开始出现在 iOS 18.2 beta 版本上，当页面上先触发了某些 Flutter widget（或者 overlay，比如 context menu / Drawer）后，<strong>WKWebView 内的点击（链接、按钮）不再响应</strong>（可高亮，但不会激活），需要重新加载 WebView 才恢复。</p>
<p>而具体原因在于，Flutter 在 iOS 的 PlatformView（例如承载 WKWebView 的视图）上实现了一套“手势拦截/延迟”机制：在需要时会把一个 <code>FlutterDelayingGestureRecognizer</code>（<code>delayingRecognizer</code> ）切到某些状态（<code>possible</code>, <code>ended</code>, <code>failed</code> 等）来告诉 UIKit 或者其他 recognizers 是否应该阻止/允许手势传递。</p>
<p>又因为，Flutter 和 UIKit 都各自有手势识别系统（GestureRecognizer），为了防止互相抢事件，Flutter engine 在 iOS 上加入了一个“<strong>delaying gesture recognizer</strong>”（延迟识别器）：</p>
<blockquote>
<p>它的作用是：当 Flutter 框架检测到某个 widget 想“阻止”事件时（比如 <code>GestureDetector</code> 或 overlay 遮罩），Flutter 会让这个 <code>delayingRecognizer</code> 阻止 UIKit 里的 recognizer（例如 WKWebView 的点击识别器）响应。</p>
</blockquote>
<p>而问题主要出现在 Flutter → UIKit 手势交界，详细的这里就不展开了，反正就是 Flutter 一开始为了解决这个问题做了一件事：</p>
<blockquote>
<p>在 blockGesture 的处理流程里把 <code>delayingRecognizer</code> <strong>移除后再添加回去</strong>，以强制 UIKit/WebKit 刷新识别器关系，解决了问题：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/252c6d88acca4d5f835b7304c0fd6031~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=ZKr7xbhxHR6o7OmjXDX6TMiV9dM%3D" alt="" loading="lazy"/></p>
</blockquote>
<p>但是这个做法在 iOS 26 上不行了，所以官方有做了两个处理：</p>
<ul>
<li>完整修复方案， 利用 FFI 和全新的 HitTest 实现，从底层正式重构修复问题，但是改动很多，没那么快合并到正式版本</li>
<li>临时解决方案，增加一个方式，通过递归操作，再来一下 NO &amp; YES <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2396c0d2869f41c2a250a4c2fd5ebf13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=%2Fhu32LkUpoe5ZRCaMWoD%2BLtBd%2Fo%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ac355b12d7e4fc38d99ead198051a5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=S9a4hijqLgDFYCEti4Cqs4ulY4Y%3D" alt="" loading="lazy"/></li>
</ul>
<p>针对完整解决方案，除了需要改引擎和框架，第三方插件也需要适配，但是属于是彻底解决问题的思路，而临时方案的好处就是：<strong>可以什么插件都不改就生效</strong>。</p>
<blockquote>
<p>所以，这个问题虽然解决了，但是这个坑还在，就看什么时候 break change 了。</p>
</blockquote>
<h2 data-id="heading-5">binary is invalid</h2>
<p>依然还是 iOS 问题，可以看到 2025 大坑，有一半以上都是 iOS 的，问题在于 3.38.1 之后的版本，在提交 App Store 的时候，有概率发现打包提交 iOS 的包会出现 <code>The binary is invalid</code> 的相关错误，简单来说，就是<strong>App Store 拒绝了某个二进制文件，因为它包含了无效的内容</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f12c3999ba437a9365b5847222c920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=0XTg6xwPc%2Fy1RrE04luRX7DoV2k%3D" alt="" loading="lazy"/></p>
<p>那么这个内容是怎么来的？大概率是模拟器架构的 Framework 被错误地打包进了正式发布的 App ，具体原因还要提到最新版本增加的 Native Assets 功能。</p>
<p>Native Assets 的目标是<strong>让在 Flutter/Dart 包中集成 C、C++、Rust 或 Go 代码，可以像集成普通 Dart 包一样简单</strong>，也就是它允许 Dart 包定义如何构建和打包原生代码，开发者不需要深入了解每个平台的底层构建系统，也是 Dart FFI 未来的重要基建。</p>
<p>那它怎么导致了这次这个低级问题的出现？实际上这是一个构建脚本逻辑缺陷导致的“脏构建”问题，当 Flutter 构建依赖于 Native Assets（比如 <code>sqlite3</code> 等库）的 Plugin 时，这些原生资源会被编译并输出到 <code>build/native_assets/$platform</code> 目录（例如 <code>build/native_assets/ios</code>）。</p>
<p>因为在现有的构建脚本（<code>xcode_backend.dart</code>）在打包时，会简单粗暴地将 <code>build/native_assets/ios</code> 目录下的<strong>所有</strong>框架复制到最终的 App Bundle (<code>Runner.app/Frameworks</code>) ，例如：</p>
<ul>
<li>先运行了模拟器跑应用，这时模拟器专用的框架（如 <code>sqlite3arm64ios_sim.framework</code>）就会被生成并留在了 <code>build/native_assets/ios</code> 目录</li>
<li>接着，开发者在<strong>没有运行 <code>flutter clean</code></strong> 的情况下，直接运行了 Release 构建</li>
<li>构建脚本会把之前遗留的“模拟器框架”也一并复制进了 Release 包</li>
<li>App Store 检测到 Release 包中含有模拟器架构的代码，因此拒绝接收</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ef426a8657b4367beab6976a1354461~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=HZHJx9E2sPgCQA6pyLjiKNTyalY%3D" alt="" loading="lazy"/></p>
<p>而且，其实这个问题是存在两个 Bug ，目前 Fix 的 PR 也都已经合并，开发者处理思路有：</p>
<ul>
<li>
<p>存在 native assets 的</p>
<ul>
<li>使用 main - <code>flutter channel main</code></li>
<li>archiving 之前，使用 <code>flutter clean</code> 和 <code>flutter build ios --config-only</code></li>
</ul>
</li>
<li>
<p>没有使用 native assets 的:</p>
<ul>
<li>使用最新 <code>flutter channel main</code></li>
<li>使用稳定版 <code>flutter channel stable</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>因为第二个 bug 是某个 beta 版本弄出来的。</p>
</blockquote>
<p>所以，这也是一个草台版本的 bug ，但是带来的影响还是很坑的，毕竟提交的时候才发现版本不行，而且找起来也很麻烦，虽然解决很容易，但是恶心层度贼高。</p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7591350620189360134" target="_blank" title="https://juejin.cn/post/7591350620189360134">《Flutter 3.38.1 之后，因为某些框架低级错误导致提交 Store 被拒》</a></p>
</blockquote>
<h2 data-id="heading-6">iOS 键盘问题</h2>
<p>又是 iOS ，这次还是 iOS 26 问题，Flutter 在 iOS 26 上，某些场景会因为出现半透明键盘，而页面底下本来应该被键盘遮挡的 Widget，由于默认没有被绘制，从而出现键盘背景颜色 UI 异常：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/498c49cdcf114c27b07156f662a37723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=e0qEle3TEkqMOekx9g2nHerfvBs%3D" alt="" loading="lazy"/></p>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<blockquote>
<p>issue 提到问题，问题最明显的场景主要出现在 iOS 26 的 <code>showModalBottomSheet()</code> 下。</p>
</blockquote>
<p>虽然问题看起来是一个圆角问题，但是实际上这是 <strong>iOS 26 系统键盘增加了“半透明”后带来的问题，Flutter 在键盘后面那一层在某些场景下没有正确渲染内容</strong>，导致键盘半透明区域透出来的不是底下 BottomSheet 的真实内容，而是一整块黑色区域。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c382b66b3e324ca680c30e974b85394a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=qRmiAi64qS16SCk4AF1XmlqJiRo%3D" alt="" loading="lazy"/></p>
<p>当然，<strong>正常大家使用输入框输入文本内容不会有什么问题</strong>，甚至如果你用 Dialog 场景也不会有什么问题，它主要出现在默认有底色场景的类似 <code>BottomSheet</code> 这种场景，所<strong>针对问题其实可以选择配置 <code>UIDesignRequiresCompatibility = YES</code> 来解决，或者替换为 Dialog 来绕过场景</strong>，但是如果要等官方修复这个场景，可能会需要等待评估是否真的有必要大规模底层改动。</p>
<p>这个问题就在于，官方是真的在考虑是否大规模修改底层来解决问题，毕竟按照之前的尿性，如果真的为了这个大规模修改底层，那么 issue 生 issue ，解一送十也不是不可能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66f506501bf48b291a9c1af36a3ca64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769986571&amp;x-signature=Efk7F5gijaPv2nKkRbsqhv66H3k%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>详细可见：<a href="https://juejin.cn/post/7596245612558319625" target="_blank" title="https://juejin.cn/post/7596245612558319625">《Flutter 又迎大坑修改？iOS 26 键盘变化可能带来大量底层改动》</a></p>
</blockquote>
<h2 data-id="heading-7">最后</h2>
<p>看了 2025 的年度大坑回顾，不知道有没有你踩过的共鸣？但是这只是一些比较典型或者恶心的，其他琐碎小问题其实也不少，但是好在 Flutter 也有在积极解决这些大坑，不过可以看出来 iOS 26 确实带来了不少问题，很多问题也不是 Flutter 特有的，RN 和 KMP 也不可避免，<strong>只能说平台升级带来的坑是真不少</strong>，不然你看，谷歌看 Android 16 没带来什么大问题，所以给大家准备了 AGP 9 整整 KPI ，多贴心：</p>
<blockquote>
<p><a href="https://juejin.cn/post/7597900782910685203" target="_blank" title="https://juejin.cn/post/7597900782910685203">Android Gradle Plugin 9.0 发布，为什么这会是个史诗级大坑版本</a></p>
</blockquote>
<p>那么，2025 你遇到过什么坑呢？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windows 代理配置与删除完整指南（环境变量方式）]]></title>    <link>https://juejin.cn/post/7599017594520043546</link>    <guid>https://juejin.cn/post/7599017594520043546</guid>    <pubDate>2026-01-26T01:25:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599017594520043546" data-draft-id="7599094262592405514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windows 代理配置与删除完整指南（环境变量方式）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T01:25:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windows 代理配置与删除完整指南（环境变量方式）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:25:10.000Z" title="Mon Jan 26 2026 01:25:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Windows 开发环境中，很多工具（如 <strong>Git、Scoop、npm、pip、curl、Docker CLI</strong> 等）都会自动读取系统环境变量中的代理配置。<br/>
相比只在浏览器里设置代理，<strong>环境变量代理</strong>是一种更通用、更稳定的方式。</p>
<p>本文将系统介绍：</p>
<ul>
<li>✅ 如何在 Windows 中设置 HTTP / HTTPS 代理</li>
<li>✅ 如何验证代理是否生效</li>
<li>✅ 如何删除 / 取消代理</li>
<li>⚠️ 常见坑与注意事项</li>
</ul>
<h2 data-id="heading-0">一、什么是 Windows 环境变量代理？</h2>
<p>Windows 支持通过环境变量向程序传递代理信息，最常见的是：</p>
<pre><code class="hljs">HTTP_PROXY
HTTPS_PROXY
</code></pre>
<p>当这些变量存在时，大多数命令行工具会自动使用代理访问网络。</p>
<blockquote>
<p>📌 这是一种 <strong>系统级 / 用户级配置</strong>，不是浏览器专用。</p>
</blockquote>
<h2 data-id="heading-1">二、通过 PowerShell 设置代理（推荐）</h2>
<h3 data-id="heading-2">1️⃣ 设置用户级代理（最常用）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Environment]</span>::<span class="hljs-built_in">SetEnvironmentVariable</span>(
  <span class="hljs-string">"HTTP_PROXY"</span>,
  <span class="hljs-string">"http://127.0.0.1:1080"</span>,
  <span class="hljs-string">"User"</span>
)

[Environment]::<span class="hljs-built_in">SetEnvironmentVariable</span>(
  <span class="hljs-string">"HTTPS_PROXY"</span>,
  <span class="hljs-string">"http://127.0.0.1:1080"</span>,
  <span class="hljs-string">"User"</span>
)
</code></pre>
<p>说明：</p>
<ul>
<li><code>127.0.0.1:1080</code>：本地代理地址（如 Clash / V2Ray / Shadowsocks）</li>
<li><code>"User"</code>：只对当前用户生效（推荐）</li>
<li>不需要管理员权限</li>
</ul>
<p>⚠️ <strong>注意</strong>：<br/>
设置完成后，<strong>必须重新打开 PowerShell / CMD</strong> 才会生效。</p>
<h3 data-id="heading-3">2️⃣ 系统级代理（不推荐，需管理员）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Environment]</span>::<span class="hljs-built_in">SetEnvironmentVariable</span>(<span class="hljs-string">"HTTP_PROXY"</span>, <span class="hljs-string">"http://127.0.0.1:1080"</span>, <span class="hljs-string">"Machine"</span>)
[Environment]::<span class="hljs-built_in">SetEnvironmentVariable</span>(<span class="hljs-string">"HTTPS_PROXY"</span>, <span class="hljs-string">"http://127.0.0.1:1080"</span>, <span class="hljs-string">"Machine"</span>)
</code></pre>
<blockquote>
<p>适合服务器或多人共用机器，一般个人开发环境不建议。</p>
</blockquote>
<h2 data-id="heading-4">三、如何查看代理是否已配置</h2>
<h3 data-id="heading-5">方法一：PowerShell 查看（最快）</h3>
<p>新开一个 PowerShell 窗口，执行：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTP_PROXY</span>
<span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTPS_PROXY</span>
</code></pre>
<p>如果输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//127.0.0.1:1080</span>
</code></pre>
<p>说明代理已生效 ✅</p>
<h3 data-id="heading-6">方法二：系统图形界面查看（最直观）</h3>
<ol>
<li><strong>Win + R</strong> → 输入：<code>sysdm.cpl</code></li>
<li>打开 <strong>高级</strong> → <strong>环境变量</strong></li>
<li>查看 <strong>“用户变量”</strong></li>
</ol>
<p>你会看到：</p>
<p>变量名</p>
<p>值</p>
<p>HTTP_PROXY</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A1080%2F" target="_blank" title="http://127.0.0.1:1080/" ref="nofollow noopener noreferrer">http://127.0.0.1:1080</a></p>
<p>HTTPS_PROXY</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A1080%2F" target="_blank" title="http://127.0.0.1:1080/" ref="nofollow noopener noreferrer">http://127.0.0.1:1080</a></p>
<h3 data-id="heading-7">方法三：注册表验证（底层确认）</h3>
<pre><code class="hljs language-erlang" lang="erlang">reg <span class="hljs-keyword">query</span> HKCU\Environment
</code></pre>
<p>如果存在：</p>
<pre><code class="hljs language-arduino" lang="arduino">HTTP_PROXY    REG_SZ    http:<span class="hljs-comment">//127.0.0.1:1080</span>
HTTPS_PROXY   REG_SZ    http:<span class="hljs-comment">//127.0.0.1:1080</span>
</code></pre>
<p>说明已<strong>持久化写入系统</strong>。</p>
<h2 data-id="heading-8">四、验证代理是否真的在“工作”</h2>
<h3 data-id="heading-9">1️⃣ 验证 Git 是否走代理</h3>
<pre><code class="hljs language-arduino" lang="arduino">git ls-remote https:<span class="hljs-comment">//github.com/ScoopInstaller/Extras.git</span>
</code></pre>
<p>如果不再出现：</p>
<ul>
<li><code>early EOF</code></li>
<li><code>curl 18</code></li>
<li><code>invalid index-pack output</code></li>
</ul>
<p>说明代理生效 👍</p>
<h3 data-id="heading-10">2️⃣ 验证 curl</h3>
<pre><code class="hljs language-arduino" lang="arduino">curl https:<span class="hljs-comment">//github.com</span>
</code></pre>
<h2 data-id="heading-11">五、如何删除 / 取消代理（非常重要）</h2>
<h3 data-id="heading-12">1️⃣ 用 PowerShell 删除（推荐）</h3>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">"HTTP_PROXY"</span>, $<span class="hljs-literal">null</span>, <span class="hljs-string">"User"</span>)
[<span class="hljs-meta">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">"HTTPS_PROXY"</span>, $<span class="hljs-literal">null</span>, <span class="hljs-string">"User"</span>)
</code></pre>
<p>然后：</p>
<ul>
<li>关闭 PowerShell</li>
<li>重新打开</li>
</ul>
<h3 data-id="heading-13">2️⃣ 图形界面删除</h3>
<ol>
<li><code>sysdm.cpl</code></li>
<li>高级 → 环境变量</li>
<li>在 <strong>用户变量</strong> 中删除：
<ul>
<li>HTTP_PROXY</li>
<li>HTTPS_PROXY</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">3️⃣ 验证是否已删除</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTP_PROXY</span>
<span class="hljs-variable">$env</span><span class="hljs-symbol">:HTTPS_PROXY</span>
</code></pre>
<p>如果无输出，说明已清除。</p>
<h2 data-id="heading-15">六、常见坑与注意事项（很重要）</h2>
<h3 data-id="heading-16">⚠️ 1. 当前窗口看不到新变量</h3>
<blockquote>
<p><code>SetEnvironmentVariable</code> <strong>不会影响当前 PowerShell 会话</strong></p>
</blockquote>
<p>必须：</p>
<ul>
<li>新开窗口</li>
<li>或重新登录用户</li>
</ul>
<h3 data-id="heading-17">⚠️ 2. Conda / Anaconda 干扰</h3>
<p>在 <code>(base)</code> 环境中，Conda 可能会：</p>
<ul>
<li>覆盖代理变量</li>
<li>使用自己的 OpenSSL / curl</li>
</ul>
<p>👉 如果代理不生效，建议：</p>
<pre><code class="hljs">conda deactivate
</code></pre>
<p>再测试。</p>
<h3 data-id="heading-18">⚠️ 3. 不等于 Windows「系统代理」</h3>
<p>环境变量代理 ≠ Windows 设置里的：</p>
<blockquote>
<p>设置 → 网络 → 代理</p>
</blockquote>
<p>两者<strong>互不影响</strong>。</p>
<h3 data-id="heading-19">⚠️ 4. 不要长期忘记开代理</h3>
<p>长期保留代理可能导致：</p>
<ul>
<li>内网地址访问失败</li>
<li>公司 VPN 冲突</li>
<li>本地服务异常</li>
</ul>
<p>👉 不用时记得删除。</p>
<h2 data-id="heading-20">七、适合哪些场景使用？</h2>
<p>✅ 适合：</p>
<ul>
<li>GitHub 访问不稳定</li>
<li>Scoop / npm / pip 下载失败</li>
<li>命令行工具走代理</li>
</ul>
<p>❌ 不适合：</p>
<ul>
<li>只想给浏览器加速</li>
<li>不希望命令行走代理</li>
</ul>
<h2 data-id="heading-21">八、总结一句话</h2>
<blockquote>
<p><strong>Windows 环境变量代理，是开发环境里最通用、最稳定的代理方式之一。</strong><br/>
会配、会查、会删，才能用得安心。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？]]></title>    <link>https://juejin.cn/post/7599247962822574107</link>    <guid>https://juejin.cn/post/7599247962822574107</guid>    <pubDate>2026-01-26T06:39:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599247962822574107" data-draft-id="7599268297223061514" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-01-26T06:39:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大促备战中的隐蔽陷阱：Double转String会使用科学计数法展示？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T06:39:27.000Z" title="Mon Jan 26 2026 06:39:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：齐海智</p>
<h2 data-id="heading-0"><strong>一、背景：大促备战中的异常数据</strong></h2>
<p>大促备战期间，接到客户反馈我司上传到客户服务器上的文件存在科学计数法表示的情况（下图的4.55058496E7），与约定不符。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eab231574aec402c906845d62b7174ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=A0A6ZmXUQQ6Zp1bcxoYmUFj4Qj4%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>查看转换前的数据是：455058496，转换后（除以10：进行毫米到厘米的转换）就变成了科学计数法形式了。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6404f1d853a4f81a7296f529c5b91fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=%2FE5ugSZlFkms1NWOc%2FgWfhyFh9o%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>问题代码：</p>
<pre><code class="hljs language-bash" lang="bash">&lt;<span class="hljs-built_in">set</span> var=<span class="hljs-string">"temp.b"</span> <span class="hljs-built_in">expr</span>=<span class="hljs-string">"<span class="hljs-variable">${_item.boxLength / 10}</span>"</span> clazz=<span class="hljs-string">"java.lang.String"</span>/&gt;
</code></pre>
<p>说明：</p>
<p>这个是个EL表达式，含义是使用<strong>expr</strong>的值作为计算逻辑，计算结果赋值给var指向的变量temp.b，类型是java.lang.String。</p>
<p>•<code>_item</code>代表当前上下文里的一个对象。</p>
<p>•<code>boxLength</code>是<code>_item</code>对象所具备的属性。</p>
<p>•该表达式先对<code>boxLength</code>执行除以 10 的运算，再把运算结果转换为字符串（由clazz定义的）。</p>
<p>业务上，boxLength是个长度的概念，单位是毫米，除以10是转换成厘米的含义。为了保证精度，系统（基于JAVA）会先将boxLength先转成java.lang.Double类型，再除以10，最后调用Double.toString()方法转成字符串。</p>
<h2 data-id="heading-1"><strong>二、问题定位：字符串转换的科学计数法陷阱</strong></h2>
<h3 data-id="heading-2">2.1 问题复现</h3>
<p>代码：</p>
<pre><code class="hljs language-ini" lang="ini">Double <span class="hljs-attr">depthInDouble</span> = <span class="hljs-number">455058496</span>d/<span class="hljs-number">10</span><span class="hljs-comment">;</span>
log.info("<span class="hljs-attr">depthInDouble</span>={}<span class="hljs-string">", depthInDouble);
</span></code></pre>
<p>结果：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fe13ce03c3c4f7ba6e411787b1577f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=Nd7P0NmXll9%2Fa4q1L7lfMbKpsIA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h3 data-id="heading-3">2.2 原因分析</h3>
<p>问题就出在了最后一行，日志输出的时候Double会被转成String，调用Double.toString（）方法，而对于Double对象的值在一定的范围内，会使用科学计数法表示。</p>
<p>log.info的调用链（为什么会调用到Double.toStirng()）：</p>
<pre><code class="hljs language-scss" lang="scss">log<span class="hljs-selector-class">.info</span>("depthInDouble={}", depthInDouble);
  ↓
Log4jLogger<span class="hljs-selector-class">.info</span>(String format, Object arg)
  ↓
AbstractLogger<span class="hljs-selector-class">.logIfEnabled</span>(...)
  ↓
AbstractLogger<span class="hljs-selector-class">.logMessage</span>(...)
  ↓
ParameterizedMessageFactory<span class="hljs-selector-class">.newMessage</span>(...)
  ↓
ParameterizedMessage 构造函数（参数被暂存为 <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span>）
  ↓
<span class="hljs-comment">// 此时尚未调用 Double.toString()</span>
  ↓
<span class="hljs-comment">// 当 Appender 执行输出时...</span>
Appender<span class="hljs-selector-class">.append</span>(LogEvent)
  ↓
LogEvent<span class="hljs-selector-class">.getMessage</span>()<span class="hljs-selector-class">.getFormattedMessage</span>() <span class="hljs-comment">// 触发消息格式化</span>
  ↓
ParameterizedMessage<span class="hljs-selector-class">.getFormattedMessage</span>()
  ↓
ParameterizedMessage<span class="hljs-selector-class">.formatMessage</span>(...)
  ↓
ParameterizedMessage<span class="hljs-selector-class">.argToString</span>(Object)
  ↓
Double<span class="hljs-selector-class">.toString</span>() <span class="hljs-comment">// 终于在这里被调用！</span>
</code></pre>
<p>查看Double.toString（）的源码，可以看到相关解释：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/839c50e593234abd9ab9e86dc9f49927~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=mzw%2B0f8H%2BIv8u%2BODb0j8yvN3%2FuQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>也就是说对于极小（小于10^-3）或者极大（大于10^7）值的浮点数，转成String的时候会使用科学计数法表示</strong>，验证如下。</p>
<p>代码：</p>
<pre><code class="hljs language-c" lang="c">public <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> {
       String depth = <span class="hljs-string">"455058496"</span>; <span class="hljs-comment">// 单位：毫米</span>
       Double depthInDouble = Double.parseDouble(depth)/<span class="hljs-number">10</span>;
       String doubleInString = String.valueOf(depthInDouble);
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"depthInDouble={}"</span>, depthInDouble);
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"doubleInString={}"</span>, doubleInString);
       depthInDouble = <span class="hljs-number">1e-3</span>;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^-3 = {}"</span>, depthInDouble);
       depthInDouble = <span class="hljs-number">1e7</span>;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^7 = {}"</span>, depthInDouble);
       Double aVerySmallNumber = <span class="hljs-number">1e-9</span>;
       depthInDouble = <span class="hljs-number">1e-3</span> - aVerySmallNumber;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^-3 - delta = {}"</span>, depthInDouble);
       depthInDouble = <span class="hljs-number">1e7</span> - aVerySmallNumber;
       <span class="hljs-built_in">log</span>.info(<span class="hljs-string">"10^7 - delta = {}"</span>, depthInDouble);
   }
</code></pre>
<p>运行结果：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a45afad0dc9436ba9b050c72336cc73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=v6N6hxBBtKTzN9utY1Ctq4SUWq8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>说明，10^-3不会使用科学记计数法，但是小于它就会使用科学计数法，10^7就会使用科学计数法，小于它就会不会，大于它会。</p>
<h3 data-id="heading-4">2.3 为什么要使用科学计数法</h3>
<h4 data-id="heading-5">2.3.1 小数在计算机内是如何表示的</h4>
<p>先不急于讨论为什么使用科学计数法，我们先看看小数在计算机内是如何表示的。</p>
<p>从存储角度来看，计算机的存储是有限资源，能存储的数据是有范围的，不是无限大，也就是说<strong>有限的硬件资源限制了计算机可以表示的数值的大小</strong>。对于一个浮点数，我们可以用10个bit存储，也可以用100个，为了实现跨设备、跨平台的数据统一表示和交换，IEEE 754 规范定义了标准格式，规定了Double类型使用64比特。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e2c3a9f742f4ec398572b6277dbbb7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=O6IbAqkbWj9dr2tF53KFuAridWY%3D" alt="" loading="lazy"/></p>
<p>﻿</p>
<p>当64个比特确定了，那么它可以表示的数字的范围就确定了，接下来考虑怎么表示小数，可以表示什么范围内的小数，进而再讨论威慑么定义超过10^7或者小于10^-3使用科学计数法，而不用普通的方式（定点数表示法）。</p>
<p>类似整数可以利用除以2取余获得其二级制的表示形式，例如：123（10进制）= 1111011（二进制）</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe23800f3d64ea692b40c2755ab082d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=zZ3RZRDAnRm8ZFJl4iwtwqs4x9s%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>小数则进行乘2取整，如0.123（10进制）= 0. 0001111101（二进制，位数会一直循环无法精确表示，只能近似，这里取了10位）</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18b4da8de6f247e995b7b6c023fd86ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=ARjtVbS8veAaWUUkiB%2FubpclWHE%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>因此最简单的一种设计（不考虑正负）就是将64位中的一部分划分为整数位，一部分划分为小数位，比如32位整数，32位小数（定点数表示法）。</p>
<p>那么这样设计的Double最大数可以表示2^32-1，</p>
<p>如果要以米为单位表示银河系直径，约1光年<strong>≈</strong>299792458米/秒<em>1年 = 299792458米/秒</em>365天*86400秒/天 ≈ 9.45 * 10^15 ，而2^32-1≈4.29 * 10^9 （远小于1光年），因此无法使用Double表示银河系直径，无法支撑天文学科的计算了。</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/055afc86c832432399a4efc74b74e795~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=EpR8CxoPUlSZ8yDsHOMRzSm5zqA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>这样设计的Double最小可以表示2^-32=2.38<em>10^-10 ，一个质子的大小是0.84飞米=8.4</em>10^-16，因此也无法支持物理学的计算。</p>
<p>所以，矛盾在于增加整数部分的位数，就会压缩小数部分的位数，不同的领域中，既有要求数字很大可表示的（在乎量级，如天文学、金融学），也有要求数值很小能表示的（在乎精度，如物理学、生物学）。</p>
<p>可以看到，上面的很多数字表达，我们也使用了科学计数法的表示形式来简化表达，对于上面这个数字（9.454,254,955,488,000）写起来麻烦还很占地方，而且我们也不需要那么精确，只是看个量级，因此会写成9.45 * 10^15 ，不影响理解。</p>
<p>即表示一个极大或者极小的数可以使用：【数值<em>底数^指数】的形式，对于大数来讲指数就是正的，小数就是负的，计算机使用二进制，因此底数就是2，所以小数可以表示成：【数值</em>2^指数】的形式，这个数值，其实就是尾数。</p>
<p>计算机专家们经过多种研究，最终经过IEEE确定了IEEE 754标准，即不确定整数和小数的位数（固定小数点，即定点数），而使用变化的位数，也就是小数点可以浮动，即浮点数表示法。浮点数表示法定义了小数由符号位+指数位+尾数位三部分组成。</p>
<p>符号位是1bit，0代表整数，1代表负数，指数位决定数值的量级，尾数位决定数值精度。</p>
<p>64位的说明如下：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1b4f3dae56348a5ad7e55231d8c9907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=urS3c8ZmKfpBUqbaAHSAcV9ylhs%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>其中11和52的设计是在平衡了很多需求后得到的最佳实践。</p>
<pre><code class="hljs language-scss" lang="scss">Double (<span class="hljs-number">64</span>位) = 符号位(<span class="hljs-number">1</span>位) + 指数位(<span class="hljs-number">11</span>位) + 尾数位(<span class="hljs-number">52</span>位)

示例：<span class="hljs-number">455058496.0</span> 的IEEE <span class="hljs-number">754</span>表示
原始值：<span class="hljs-number">455058496.0</span>
二进制科学计数法：<span class="hljs-number">1.0101100001110000000000000000000</span> × <span class="hljs-number">2</span>^<span class="hljs-number">28</span>

符号位：<span class="hljs-number">0</span> (正数)
指数位：<span class="hljs-number">28</span> + <span class="hljs-number">1023</span>(偏移量) = <span class="hljs-number">1051</span> = <span class="hljs-number">10000011011</span>₂
尾数位：<span class="hljs-number">0101100001110000000000000000000</span>... (<span class="hljs-number">52</span>位)

完整<span class="hljs-number">64</span>位表示：
<span class="hljs-number">0</span> <span class="hljs-number">10000011011</span> <span class="hljs-number">0101100001110000000000000000000000000000000000000000</span>
</code></pre>
<h4 data-id="heading-6">2.3.2 数值超过10^7或者小于10^-3会发生什么</h4>
<p>其实什么也不会发生，只是基于如下原因综合权衡的结果。</p>
<h5 data-id="heading-7">1、认知科学依据</h5>
<p>•人类短期记忆的数字处理能力约为7±2位</p>
<p>•超过7位的整数部分难以快速理解</p>
<p>•科学计数法提供更好的可读性</p>
<h5 data-id="heading-8">2、精度保持考虑</h5>
<p>•10^7 = 10,000,000 (8位数字)</p>
<p>•超过此值，普通格式会显得冗长</p>
<p>•10^-3 = 0.001，更小的数用科学计数法更清晰</p>
<h5 data-id="heading-9">3、历史兼容性</h5>
<p>•这个标准在多种编程语言中被采用</p>
<p>•保持了与C语言printf的兼容性</p>
<p>•符合IEEE 754标准的建议</p>
<p>这也就是为什么这个这个范围内的数要表示成科学计数法了。</p>
<h4 data-id="heading-10">2.3.3 源码探究</h4>
<h5 data-id="heading-11">1、调用链路</h5>
<p>根据源码，可以看到Double.toString()方法的调用链是：</p>
<p>﻿</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd1fab3d2914726aaa9bcdce3d72e79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014366&amp;x-signature=2ph3CZbtwY6ACheYYm5QAiuNTgM%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>分流是否使用科学计数法的核心代码toChars的代码如下：</p>
<pre><code class="hljs language-ini" lang="ini">/*
 * Formats the decimal f 10^e.
 */
private int toChars(byte<span class="hljs-section">[]</span> str, int index, long f, int e, FormattedFPDecimal fd) {
    /*
     * For details not discussed here see section 10 of <span class="hljs-section">[1]</span>.
     *
     * Determine len such that
     *     10^(len-1) &lt;= f &lt; 10^len
     */
    int <span class="hljs-attr">len</span> = flog10pow2(Long.SIZE - numberOfLeadingZeros(f))<span class="hljs-comment">;</span>
    if (f &gt;= pow10(len)) {
        len += 1<span class="hljs-comment">;</span>
    }
    if (fd != null) {
        fd.set(f, e, len)<span class="hljs-comment">;</span>
        return index<span class="hljs-comment">;</span>
    }

    /*
     * Let fp and ep be the original f and e, respectively.
     * Transform f and e to ensure
     *     10^(H-1) &lt;= f &lt; 10^H
     *     fp 10^<span class="hljs-attr">ep</span> = f <span class="hljs-number">10</span>^(e-H) = <span class="hljs-number">0</span>.f <span class="hljs-number">10</span>^e
     */
    f *= pow10(H - len)<span class="hljs-comment">;</span>
    e += len<span class="hljs-comment">;</span>

    /*
     * The toChars?() methods perform left-to-right digits extraction
     * using ints, provided that the arguments are limited to 8 digits.
     * Therefore, split the <span class="hljs-attr">H</span> = <span class="hljs-number">17</span> digits of f into:
     *     <span class="hljs-attr">h</span> = the most significant digit of f
     *     <span class="hljs-attr">m</span> = the next <span class="hljs-number">8</span> most significant digits of f
     *     <span class="hljs-attr">l</span> = the last <span class="hljs-number">8</span>, least significant digits of f
     *
     * For <span class="hljs-attr">n</span> = <span class="hljs-number">17</span>, m = <span class="hljs-number">8</span> the table in section <span class="hljs-number">10</span> of [<span class="hljs-number">1</span>] shows
     *     floor(f / 10^8) = floor(193_428_131_138_340_668 f / 2^84) =
     *     floor(floor(193_428_131_138_340_668 f / 2^64) / 2^20)
     * and for <span class="hljs-attr">n</span> = <span class="hljs-number">9</span>, m = <span class="hljs-number">8</span>
     *     floor(hm / 10^8) = floor(1_441_151_881 hm / 2^57)
     */
    long <span class="hljs-attr">hm</span> = multiplyHigh(f, <span class="hljs-number">193_428_131_138_340_668</span>L) &gt;&gt;&gt; <span class="hljs-number">20</span><span class="hljs-comment">;</span>
    int <span class="hljs-attr">l</span> = (int) (f - <span class="hljs-number">100_000_000</span>L * hm)<span class="hljs-comment">;</span>
    int <span class="hljs-attr">h</span> = (int) (hm * <span class="hljs-number">1_441_151_881</span>L &gt;&gt;&gt; <span class="hljs-number">57</span>)<span class="hljs-comment">;</span>
    int <span class="hljs-attr">m</span> = (int) (hm - <span class="hljs-number">100_000_000</span> * h)<span class="hljs-comment">;</span>

    if (0 &lt; e &amp;&amp; e &lt;= 7) {
        return toChars1(str, index, h, m, l, e)<span class="hljs-comment">;</span>
    }
    if (-3 &lt; e &amp;&amp; e &lt;= 0) {
        return toChars2(str, index, h, m, l, e)<span class="hljs-comment">;</span>
    }
    return toChars3(str, index, h, m, l, e)<span class="hljs-comment">;</span>
}
</code></pre>
<p>代码地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenjdk%2Fjdk%2Fblob%2Fmaster%2Fsrc%2Fjava.base%2Fshare%2Fclasses%2Fjdk%2Finternal%2Fmath%2FDoubleToDecimal.java" target="_blank" title="https://github.com/openjdk/jdk/blob/master/src/java.base/share/classes/jdk/internal/math/DoubleToDecimal.java" ref="nofollow noopener noreferrer">github.com/openjdk/jdk…</a></p>
<p>可以看到使用科学计数法处理的核心代码是toChars3，代码如下：</p>
<pre><code class="hljs language-perl" lang="perl">private <span class="hljs-keyword">int</span> toChars3(byte[] str, <span class="hljs-keyword">int</span> <span class="hljs-keyword">index</span>, <span class="hljs-keyword">int</span> h, <span class="hljs-keyword">int</span> m, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> e) {
    <span class="hljs-regexp">/* -3 &gt;= e | e &gt; 7: computerized scientific notation */</span>
    <span class="hljs-keyword">index</span> = putDigit(str, <span class="hljs-keyword">index</span>, h);
    <span class="hljs-keyword">index</span> = putChar(str, <span class="hljs-keyword">index</span>, <span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">index</span> = put8Digits(str, <span class="hljs-keyword">index</span>, m);
    <span class="hljs-keyword">index</span> = lowDigits(str, <span class="hljs-keyword">index</span>, l);
    <span class="hljs-keyword">return</span> exponent(str, <span class="hljs-keyword">index</span>, e - <span class="hljs-number">1</span>);
}
</code></pre>
<h5 data-id="heading-12">2、toChars3()的参数含义</h5>
<p>•<code>byte[] str</code>: 输出字符串的字节数组</p>
<p>•<code>int index</code>: 当前写入位置的索引</p>
<p>•<code>int h</code>: 最高位数字 (0-9)</p>
<p>•<code>int m</code>: 中间8位数字 (00000000-99999999)</p>
<p>•<code>int l</code>: 低位数字 (用于精度控制)</p>
<p>•<code>int e</code>: 调整后的十进制指数值</p>
<h5 data-id="heading-13">3、 toChars3()的数据流处理步骤</h5>
<p>1.<code>putDigit(str, index, h) </code>→ 写入最高位数字</p>
<p>2.<code>putChar(str, index, '.') </code>→ 写入小数点</p>
<p>3.<code>put8Digits(str, index, m) </code>→ 写入中间8位数字</p>
<p>4.<code>lowDigits(str, index, l) </code>→ 写入低位数字（去除尾随零）</p>
<p>5.<code>exponent(str, index, e-1) </code>→ 写入指数部分</p>
<p>为什么使用 e-1？</p>
<pre><code class="hljs">原因：已经放置了一位数字在小数点前
目的：调整指数以保持数值不变
示例：4.55058496E7 表示 4.55058496 × 10^7
</code></pre>
<h5 data-id="heading-14">4、exponent()分析</h5>
<pre><code class="hljs language-css" lang="css">标准科学计数法：<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.bcd</span> × <span class="hljs-number">10</span>^n
约束条件：<span class="hljs-number">1</span> ≤ <span class="hljs-selector-tag">a</span> &lt; <span class="hljs-number">10</span>（小数点前只有一位非零数字）
</code></pre>

<pre><code class="hljs language-perl" lang="perl">private <span class="hljs-keyword">int</span> exponent(byte[] str, <span class="hljs-keyword">int</span> <span class="hljs-keyword">index</span>, <span class="hljs-keyword">int</span> <span class="hljs-keyword">exp</span>) {
    str[<span class="hljs-keyword">index</span>++] = (byte) <span class="hljs-string">'E'</span>;  <span class="hljs-regexp">//</span> 写入字符 <span class="hljs-string">'E'</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &lt; <span class="hljs-number">0</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) <span class="hljs-string">'-'</span>;  <span class="hljs-regexp">//</span> 负指数写入 <span class="hljs-string">'-'</span>
        <span class="hljs-keyword">exp</span> = -<span class="hljs-keyword">exp</span>;  <span class="hljs-regexp">//</span> 转为正数处理
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &gt;= <span class="hljs-number">100</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span> / <span class="hljs-number">100</span>);  <span class="hljs-regexp">//</span> 百位
        <span class="hljs-keyword">exp</span> %= <span class="hljs-number">100</span>;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">exp</span> &gt;= <span class="hljs-number">10</span>) {
        str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span> / <span class="hljs-number">10</span>);   <span class="hljs-regexp">//</span> 十位
        <span class="hljs-keyword">exp</span> %= <span class="hljs-number">10</span>;
    }
    str[<span class="hljs-keyword">index</span>++] = (byte) (<span class="hljs-string">'0'</span> + <span class="hljs-keyword">exp</span>);           <span class="hljs-regexp">//</span> 个位
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">index</span>;
}
</code></pre>
<p>•<strong>输入参数</strong>: <code>byte[] str</code>（输出缓冲区）、<code>int index</code>（写入位置）、<code>int exp</code>（指数值）</p>
<p>•<strong>核心功能</strong>: 将指数值格式化为字符串并写入字节数组</p>
<p>•<strong>处理逻辑</strong>: 优化处理1位、2位、3位数的指数</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 写入 'E'
<span class="hljs-bullet">2.</span> 处理负号（如果 exp &lt; 0）
<span class="hljs-bullet">3.</span> 处理百位（如果 exp &gt;= 100）
<span class="hljs-bullet">4.</span> 处理十位（如果 exp &gt;= 10）
<span class="hljs-bullet">5.</span> 处理个位（必须）
</code></pre>
<p>•<strong>返回值</strong>: 更新后的索引位置</p>
<p>例子：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 原始数值: 45505849.6
<span class="hljs-bullet">2.</span> 精确指数: 7.658067227112319
<span class="hljs-bullet">3.</span> 调整后指数: 7.658 - 1 = 6.658
<span class="hljs-bullet">4.</span> 四舍五入: 7
<span class="hljs-bullet">5.</span> exponent方法输入: exp = 7
<span class="hljs-bullet">6.</span> 执行步骤:
<span class="hljs-bullet">   -</span> 写入 'E' → index = 1
<span class="hljs-bullet">   -</span> exp = 7 &lt; 10，跳过百位和十位
<span class="hljs-bullet">   -</span> 写入个位 '7' → index = 2
<span class="hljs-bullet">7.</span> 输出: "E7"
<span class="hljs-bullet">8.</span> 完整结果: "4.55058496E7"
</code></pre>
<p>根据源代码的逻辑简化了一版如下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoding.jd.com%2FnewJavaEngineerOrientation%2FDouble2String.git" target="_blank" title="https://coding.jd.com/newJavaEngineerOrientation/Double2String.git" ref="nofollow noopener noreferrer">coding.jd.com/newJavaEngi…</a></p>
<h2 data-id="heading-15"><strong>三、解决方案</strong></h2>
<h4 data-id="heading-16">3.1 BigDecimal 精准控制</h4>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">BigDecimal</span>(doubleValue)<span class="hljs-selector-class">.setScale</span>(<span class="hljs-number">2</span>, RoundingMode.HALF_UP)<span class="hljs-selector-class">.toPlainString</span>() 
</code></pre>
<h4 data-id="heading-17"><code>3.2 DecimalFormat 格式化</code></h4>
<pre><code class="hljs language-scss" lang="scss">new <span class="hljs-built_in">DecimalFormat</span>("#<span class="hljs-number">0.00</span>")<span class="hljs-selector-class">.format</span>(doubleValue) <span class="hljs-comment">// 强制保留两位小数  </span>
</code></pre>
<h2 data-id="heading-18"><strong>四、总结</strong></h2>
<p>Double 数值的字符串格式化规则（如 <code>Double.toString()</code>）遵循：</p>
<p>•普通格式（Plain）：当数值的指数范围在 [-3, 7) 时（即绝对值在 [10^-3, 10^7) 之间），直接显示小数形式（如 0.001 或 123456.0）。</p>
<p>•科学计数法（Scientific）：当指数范围超出 [-3, 7)（如 0.000999 或 10000000.0），显示为科学计数法（如 9.99e-4 或 1.0e7）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[供应链系统中的 Web 打印方案的探索实践]]></title>    <link>https://juejin.cn/post/7598921649888968731</link>    <guid>https://juejin.cn/post/7598921649888968731</guid>    <pubDate>2026-01-26T00:00:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888968731" data-draft-id="7599268297202253862" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="供应链系统中的 Web 打印方案的探索实践"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-26T00:00:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古茗前端团队"/> <meta itemprop="url" content="https://juejin.cn/user/3233040624266695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            供应链系统中的 Web 打印方案的探索实践
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dafcebf7c91d402abd52f072a32deba8~tplv-k3u1fbpfcp-watermark.image?" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/7198439419173404711/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="古茗前端团队" class="title" data-v-d326b38e="">古茗前端团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2026-01-26T00:00:01.000Z" title="Mon Jan 26 2026 00:00:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2026-01-26
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读1分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              @古茗科技
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：刘锦泉</p>
</blockquote>
<h2 data-id="heading-0">一、前言</h2>
<p>在供应链业务系统中，打印是一项<strong>难以被完全数字化替代的基础能力</strong>。尽管系统形态不断向 Web 化、平台化演进，但在仓储、物流、配送等线下环节，大量核心流程依然依赖纸质单据（如面单、送货单、运输单）完成流转与交接。</p>
<p>打印的稳定性与一致性，往往直接影响现场作业效率。一旦打印出现异常，问题会迅速放大，甚至直接阻断线下业务流程。</p>
<p>基于真实的供应链项目实践，本文将围绕浏览器打印这一常被低估的能力，系统性地梳理主流方案的技术取舍，并重点展开基于 <code>window.print</code> 的实现思路与工程实践。</p>
<h2 data-id="heading-1">二、供应链系统中的主流打印方案调研</h2>
<p>围绕“如何将单据稳定、可靠地打印出来”，在实际项目中常见的 Web 打印方案大致可以分为三类：</p>
<ul>
<li>基于 DOM 的浏览器原生打印方案</li>
<li>基于可视化模板的前端打印方案</li>
<li>基于本地打印控件的软件方案</li>
</ul>
<p>下面结合实际项目经验，对这三类方案进行简要分析。</p>
<h3 data-id="heading-2">1.基于DOM浏览器原生打印方案</h3>
<p>这是目前<strong>最常见、也是前端介入成本最低</strong>的一种打印实现方式。</p>
<p>其核心思路是：</p>
<blockquote>
<p>直接使用浏览器原生打印能力，将页面或指定 DOM 节点渲染为打印内容。</p>
</blockquote>
<p>打印效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17442b196ee74d45bc966aa555135ff0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">实现方式</h4>
<ol>
<li><strong>原生</strong> <strong>window.print()</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// window.print</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">print</span>
</code></pre>
<ol start="2">
<li><strong>使用 <strong><strong>print-js</strong></strong> 等开源库进行增强</strong></li>
</ol>
<p>官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fprintjs.crabbly.com%2F" target="_blank" title="https://printjs.crabbly.com/" ref="nofollow noopener noreferrer">printjs.crabbly.com/</a>)</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// printJs</span>
<span class="hljs-title function_">printJS</span>({
  <span class="hljs-attr">printable</span>: <span class="hljs-string">'print-area'</span>,
  <span class="hljs-attr">type</span>: <span class="hljs-string">'html'</span>,
  <span class="hljs-attr">style</span>: <span class="hljs-string">'@page { size: A4; margin: 10mm; }'</span>,
  <span class="hljs-attr">targetStyles</span>: [<span class="hljs-string">'*'</span>]
});
</code></pre>
<h4 data-id="heading-4">优点</h4>
<ul>
<li><strong>零额外依赖</strong>，完全基于浏览器原生能力</li>
<li><strong>浏览器兼容性优秀</strong>：Chrome、Firefox、Safari、Edge 均支持</li>
<li><strong>开发与维护成本低</strong>，对现代前端技术栈（React / Vue）非常友好</li>
<li><strong>页面即模板</strong>，业务变更成本低，适合供应链中高频调整的单据场景</li>
</ul>
<h4 data-id="heading-5">缺点</h4>
<ul>
<li><strong>样式控制高度依赖 CSS</strong>，对分页、跨页控制要求较高</li>
<li><strong>批量打印需自行实现调度与队列逻辑</strong></li>
<li><strong>打印体验受浏览器限制</strong>：
<ul>
<li>页眉页脚难以完全控制</li>
<li>无法绕开系统打印弹窗</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">2.基于可视化模板的前端打印方案（HiPrint）</h3>
<p>以 HiPrint 为代表的方案，通常基于 jQuery，通过拖拽方式设计打印模板，再将业务数据动态渲染到模板中进行打印。HiPrint 官网地址：传送门(<a href="https://link.juejin.cn?target=http%3A%2F%2Fhiprint.io%2F" target="_blank" title="http://hiprint.io/" ref="nofollow noopener noreferrer">hiprint.io/</a>)</p>
<p>配置示例效果如下图：</p>

<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48c4a520ab744742a3c347753a9bb5b2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">实现方式</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基于jQuery的打印设计器</span>
$(<span class="hljs-string">'#element'</span>).<span class="hljs-title function_">hiPrint</span>({
  <span class="hljs-attr">designer</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启可视化设计</span>
  <span class="hljs-attr">templates</span>: [...] <span class="hljs-comment">// 预设模板</span>
});
</code></pre>
<h4 data-id="heading-8">优点</h4>
<ul>
<li><strong>所见即所得的可视化模板设计</strong>
<ul>
<li>拖拽式配置</li>
<li>非开发人员也可参与模板调整</li>
</ul>
</li>
<li><strong>布局组件丰富</strong>
<ul>
<li>表格、文本、条码、图片等组件齐全</li>
<li>支持动态数据绑定</li>
</ul>
</li>
<li><strong>模板管理能力完善</strong>
<ul>
<li>模板导入 / 导出</li>
<li>支持模板版本管理</li>
</ul>
</li>
</ul>
<h4 data-id="heading-9">缺点</h4>
<ul>
<li><strong>技术栈依赖性强</strong>：强依赖 jQuery，与 React / Vue 整合成本高</li>
<li><strong>性能问题明显</strong>：
<ul>
<li>模板复杂时渲染速度下降</li>
<li>大数据量场景容易卡顿</li>
</ul>
</li>
<li><strong>样式隔离难度大</strong>：
<ul>
<li>容易与现有系统样式冲突</li>
<li>需要额外处理样式覆盖与作用域</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">3.基于本地打印控件的软件方案（LODOP）</h3>
<p>LODOP 是一类 <strong>依赖本地打印控件或客户端程序</strong> 的打印方案，通过浏览器与本地程序通信完成打印。在早期政务、财务、制造业系统中使用较多。官网地址：传送门(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lodop.net%2F" target="_blank" title="https://www.lodop.net/" ref="nofollow noopener noreferrer">www.lodop.net/</a>)</p>
<h4 data-id="heading-11">实现方式</h4>
<ul>
<li>先去Lodop官网下载相应的安装包</li>
<li>解压安装后将LodopFuncs.js放在项目中</li>
<li>具体页面引入 Lodop</li>
</ul>
<pre><code class="hljs language-css" lang="css">import { getLodop } <span class="hljs-selector-tag">from</span> "@/plugins/LodopFuncs";

let LODOP = getLodop()
</code></pre>
<ul>
<li>执行打印指令</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要先安装LODOP软件</span>
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT_INIT</span>(<span class="hljs-string">"打印任务"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">ADD_PRINT_TEXT</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">30</span>, <span class="hljs-string">"供应链单据"</span>);
<span class="hljs-variable constant_">LODOP</span>.<span class="hljs-title function_">PRINT</span>();
</code></pre>
<h4 data-id="heading-12">优点</h4>
<ul>
<li><strong>打印控制能力极强</strong>
<ul>
<li>支持毫米级定位</li>
<li>可直接控制打印机指令</li>
</ul>
</li>
<li><strong>对专业打印设备支持完善</strong></li>
</ul>
<h4 data-id="heading-13">缺点</h4>
<ul>
<li><strong>浏览器兼容性极差</strong>
<ul>
<li>依赖 ActiveX</li>
<li>现代浏览器与移动端基本不支持</li>
<li>只支持windows 系统</li>
</ul>
</li>
<li><strong>部署与运维成本高</strong>
<ul>
<li>每台客户端需安装软件</li>
<li>需要管理员权限</li>
</ul>
</li>
<li><strong>安全性与可持续性问题</strong>
<ul>
<li>ActiveX 存在安全隐患</li>
<li>已逐步被浏览器厂商淘汰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">4.方案对比一览表</h3>









































<table><thead><tr><th><strong>维度</strong></th><th><strong>window.print</strong></th><th><strong>jQuery HiPrint</strong></th><th><strong>LODOP</strong></th></tr></thead><tbody><tr><td><strong>开发成本</strong></td><td>极低</td><td>中等</td><td>高</td></tr><tr><td><strong>打印精度</strong></td><td>一般（受限于浏览器）</td><td>良好</td><td><strong>极高</strong></td></tr><tr><td><strong>跨浏览器</strong></td><td><strong>优秀</strong></td><td>良好</td><td>极差</td></tr><tr><td><strong>部署成本</strong></td><td><strong>零部署</strong></td><td>低</td><td>高（需安装客户端）</td></tr><tr><td><strong>维护成本</strong></td><td>低</td><td>中等</td><td>高</td></tr></tbody></table>
<h3 data-id="heading-15">5.方案选型结论</h3>
<p>结合当前业务特点：</p>
<ul>
<li>需要快速适配不同客户与环境</li>
<li>系统主体基于 React 技术栈</li>
<li>单据模板相对稳定，支持页面预览</li>
</ul>
<p>最终选择了 <strong>基于 DOM 的浏览器打印方案，并以 <strong>window.print</strong> 作为核心实现方式</strong>。</p>
<h4 data-id="heading-16">为什么直接使用 PrintJs ?</h4>
<p>可能会有人疑惑，既然是 DOM 打印，为什么不使用 <code>print-js</code> 进行封装？主要原因如下：</p>
<ul>
<li><strong>print-js 需要能够直接获取到打印节点（dom 的id 或者原始的html）</strong>
<ul>
<li><strong>必须将预览节点在打印前挂载到页面上。</strong></li>
</ul>
</li>
<li><strong>iframe 隔离成本高</strong>
<ul>
<li>需要单独引入工程化依赖包CSS 资源。如： Antd等</li>
</ul>
</li>
<li><strong>样式维护成本高</strong>
<ul>
<li>额外样式需要么通过字符串方式注入，要么将工程的less 转换成css 引入，不利于后续维护。</li>
</ul>
</li>
</ul>
<p>总的来说，print-js 在工程化配置项目依旧不是那么方便还用。</p>
<h2 data-id="heading-17">三、window.print 的能力边界</h2>
<p><code>window.print()</code> 本质上是<strong>触发浏览器打印对话框</strong>。当打印动作触发时，浏览器会将<strong>当前页面最终渲染的结果</strong>输出为打印内容，或者导出为 PDF 文件。</p>
<p>也正因为这一点，<code>window.print</code> 天生存在一个非常重要的限制：</p>
<blockquote>
<p><strong>它无法直接指定“只打印某一个 DOM 区域”。</strong></p>
</blockquote>
<p>浏览器并不知道你只想打印某一个 <code>div</code>，它只会按照当前页面的渲染结果，完整地执行一次打印流程。<br/>
这意味着，如果页面上存在导航栏、按钮、筛选条件等元素，它们同样会被一并打印出来。</p>
<h2 data-id="heading-18">四、指定区域打印的实现思路</h2>
<p>既然 <code>window.print</code> 无法直接指定打印区域，那么解决问题的思路就非常清晰了：</p>
<blockquote>
<p><strong>在触发打印之前，主动控制页面最终的渲染结果，让真正参与渲染的内容只剩下需要打印的部分。</strong></p>
</blockquote>
<p>顺着这个思路，第一个最直观的方案自然就出现了。</p>
<h3 data-id="heading-19">1.innerHTML 直接替换页面内容</h3>
<p>既然浏览器只会打印当前页面的渲染结果，那么我们是否可以在打印前，<strong>直接用需要打印的内容替换整个页面</strong>？</p>
<p>实现方式也很简单：</p>
<ul>
<li>缓存当前页面内容</li>
<li>将 <code>document.body.innerHTML</code> 替换为打印区域内容</li>
<li>执行 <code>window.print()</code></li>
<li>打印完成后再恢复页面</li>
</ul>
<p>代码示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取预览组件的html</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getPreviewContainerHtml</span> = (<span class="hljs-params">component</span>) =&gt; {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);

  <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(component, div);
  })

  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHtml</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">prinit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> oldHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span>;
  <span class="hljs-keyword">const</span> printHtml = <span class="hljs-title function_">getPreviewContainerHtml</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PreviewContainer</span> /&gt;</span></span>);
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = printHtml;
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">print</span>()
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHtml</span> = oldHtml;
}
</code></pre>
<p>这种方案在早期项目中非常常见。但随着实践的深入，很快就会发现一个问题：<br/>
<strong>直接替换 <strong><code>innerHTML</code></strong> 会彻底打破原有页面的渲染结构。</strong></p>
<p>在 React / Vue 等现代前端框架中，这种方式会导致：</p>
<ul>
<li>组件状态丢失</li>
<li>事件绑定失效</li>
<li>页面需要强制刷新才能恢复</li>
</ul>
<p>因此，这种方案虽然思路直接，但在复杂系统中并不安全。</p>
<h3 data-id="heading-20">2.新开标签页打印</h3>
<p>既然直接替换当前页面会破坏原有渲染结构，那么很自然就会想到：</p>
<blockquote>
<p><strong>如果不动当前页面，而是新开一个标签页，专门用来承载打印内容，是否就可以解决这个问题？</strong></p>
</blockquote>
<p>新开标签页后，我们可以：</p>
<ul>
<li>在新页面中渲染完整的打印内容</li>
<li>调用新页面的 <code>window.print()</code></li>
<li>当前业务页面完全不受影响</li>
</ul>
<p>从技术角度看，这个方案确实可以稳定地打印出我们想要的内容。但在真实业务场景中，很快又会暴露出新的问题：</p>
<ul>
<li>浏览器可能拦截弹窗</li>
<li>用户需要多一步切换窗口的操作</li>
<li>打印流程被打断，体验不够流畅</li>
</ul>
<p>对于仓库、物流等高频打印场景来说，<strong>这种额外的交互成本是不可忽略的</strong>。</p>
<p>于是问题进一步演化为：</p>
<blockquote>
<p><strong>能否在不新开标签页、不破坏当前页面的前提下，在当前页签内完成指定内容的打印？</strong></p>
</blockquote>
<h3 data-id="heading-21">3.iframe 当前页签打印</h3>
<p>顺着这个问题继续往下推，自然而然就会引出 <strong>iframe 打印方案</strong>。</p>
<p>其核心思路是：</p>
<ul>
<li>在当前页面中动态创建一个隐藏的 <code>iframe</code></li>
<li>将需要打印的内容完整渲染到 iframe 中</li>
<li>调用 iframe 内部的 <code>print()</code> 方法完成打印</li>
</ul>
<p>示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">print</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
  iframe.<span class="hljs-property">src</span> = <span class="hljs-string">`预览页地址`</span>;
  iframe.<span class="hljs-title function_">setAttribute</span>(
    <span class="hljs-string">'style'</span>,
    <span class="hljs-string">'visibility: hidden; height: 0; width: 0; position: absolute; border: 0'</span>
  );

  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'onafterprint'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'打印完成'</span>);
    iframe.<span class="hljs-title function_">remove</span>();
  });

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);

  iframe.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      iframe.<span class="hljs-property">contentWindow</span>?.<span class="hljs-title function_">print</span>();
    }, <span class="hljs-number">1000</span>);
  };
};
</code></pre>
<p>从浏览器的角度来看，<strong>iframe 本身就是一个完整的页面环境</strong>，因此可以独立完成打印流程，而不会影响主页面的渲染状态。</p>
<p>这一方案在实践中具备明显优势：</p>
<ul>
<li>不破坏当前页面状态</li>
<li>不依赖新窗口或弹窗</li>
<li>对 React / Vue 等现代框架友好</li>
<li>非常适合供应链系统中的高频打印场景</li>
</ul>
<h3 data-id="heading-22">4.批量打印</h3>
<p>到目前为止，我们已经可以稳定地完成 <strong>单个单据的打印</strong>。但在供应链场景中，一个非常常见的需求是：</p>
<blockquote>
<p><strong>一次性打印多张面单、送货单或运输单。</strong></p>
</blockquote>
<p>在浏览器环境下，这一需求首先会受到一个客观限制：</p>
<ul>
<li>浏览器在同一时间只能处理<strong>一个打印任务</strong></li>
<li>调用 <code>window.print()</code> 时，浏览器会弹出系统打印对话框</li>
<li>在用户完成打印设置并关闭对话框之前，<strong>页面线程会被阻塞</strong></li>
</ul>
<p>这意味着，<strong>通过循环多次调用 <strong><code>window.print()</code></strong> 来实现批量打印并不可行</strong>。</p>
<h4 data-id="heading-23">批量渲染内容 + CSS 分页</h4>
<p>基于上述限制，一个更合理的思路是：<strong>在一次打印动作中，承载所有需要打印的单据内容。</strong>具体做法是：</p>
<ul>
<li>遍历需要打印的单据数据</li>
<li>将每一张单据渲染为独立的打印容器</li>
<li>通过 CSS 控制分页规则</li>
<li>最终只触发一次 window.print()</li>
</ul>
<p> 示例代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 批量创建打印容器</span>
printPageList.<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PrintContent</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"single-order-page"</span> /&gt;</span></span>
    })

<span class="hljs-comment">// css 配置</span>
<span class="hljs-comment">/* 确保每个订单在新页开始 */</span>
.<span class="hljs-property">single</span>-order-page {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: always;
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">inside</span>: avoid;
}

<span class="hljs-comment">/* 第一个订单不需要分页 */</span>
.<span class="hljs-property">single</span>-order-<span class="hljs-attr">page</span>:first-child {
  page-<span class="hljs-keyword">break</span>-<span class="hljs-attr">before</span>: avoid;
}

</code></pre>
<p>通过这种方式，浏览器会将每个单据视为一页内容，顺序稳定、实现简单，非常适合<strong>版式统一的批量单据打印场景</strong>。</p>
<h4 data-id="heading-24">大批量场景下的性能考量</h4>
<p>需要注意的是，当单据数量非常大（例如超过 50 张）时，<strong>一次性渲染所有打印内容，可能会带来内存占用和页面卡顿的问题</strong>。在这种情况下，可以考虑引入<strong>串行队列式的打印方案</strong>。</p>
<p>该方案的核心思路是：</p>
<ul>
<li>构建一个打印任务队列</li>
<li>每次只渲染并打印一张单据</li>
<li>当前打印结束后，再进入下一张单据的处理</li>
</ul>
<p>但需要特别注意的是，<strong>浏览器无法准确感知打印完成的时机</strong>，因此该方案通常需要额外的控制手段，例如：</p>
<ul>
<li>由用户交互驱动（如点击“下一张”）</li>
<li>通过时间间隔进行节流控制</li>
</ul>
<p>这种方式更适合作为<strong>大批量或特殊场景下的补充方案</strong>，而不是默认选择。</p>
<h2 data-id="heading-25">五、核心 CSS 打印配置：从“能打”到“好用”</h2>
<p>在基于浏览器的打印方案中，CSS 决定了最终的输出效果。合理的打印样式配置，往往可以显著减少版式错乱、内容截断等问题，也是浏览器打印能否真正落地的重要前提。</p>
<p>下面结合实际项目，整理几类最常用、也最容易被忽视的打印样式配置。</p>
<h3 data-id="heading-26">1.使用 <code>@media print</code> 定义专用打印样式</h3>
<p>浏览器提供了 <code>@media print</code> 媒体查询，用于在打印场景下<strong>覆盖页面的默认样式</strong>。</p>
<p>通过该方式，可以做到：</p>
<ul>
<li>页面正常浏览时样式不受影响</li>
<li>打印时只应用与单据相关的样式规则</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-comment">/* 打印场景下隐藏页面中的非单据内容 */</span>
  <span class="hljs-selector-class">.no-print</span> {
    <span class="hljs-attribute">display</span>: none <span class="hljs-meta">!important</span>;
  }
}
</code></pre>
<h3 data-id="heading-27">2.页面尺寸与边距控制</h3>
<p>如果不对打印页面的尺寸和边距进行控制，常见问题包括：</p>
<ul>
<li>内容被裁切</li>
<li>页面留白过多</li>
<li>不同浏览器下表现不一致</li>
</ul>
<p>通过 <code>@page</code> 可以明确指定打印纸张规格与边距：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-keyword">@page</span> {
    size: A4;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">10mm</span>;
  }
}
</code></pre>
<h3 data-id="heading-28">3.避免表格内容被强制拆页</h3>
<p>表格是供应链单据中最常见的结构，同时也是打印问题的高发区域。<br/>
如果不加控制，浏览器可能会在任意位置拆分页，导致一行数据被拆成两页。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">table</span> {
    <span class="hljs-attribute">border-collapse</span>: collapse;
    <span class="hljs-comment">/* 避免整个表格在打印时被拆分 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }

  <span class="hljs-selector-tag">tr</span> {
    <span class="hljs-comment">/* 避免单行数据跨页 */</span>
    <span class="hljs-attribute">page-break-inside</span>: avoid;
  }
}
</code></pre>
<h3 data-id="heading-29">4.主动控制分页位置</h3>
<p>在部分业务场景中，需要对分页位置进行明确控制，例如：</p>
<ul>
<li>一张送货单单独占一页</li>
<li>合计信息必须在新页展示</li>
</ul>
<p>此时可以通过自定义分页样式来实现：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-class">.page-break</span> {
    <span class="hljs-comment">/* 在该元素前强制分页 */</span>
    <span class="hljs-attribute">page-break-before</span>: always;
  }
}
</code></pre>
<h3 data-id="heading-30">5.打印颜色与背景处理</h3>
<p>浏览器在打印时，默认会忽略背景颜色与部分样式，这在以下场景中尤为明显：</p>
<ul>
<li>面单背景色</li>
<li>标签类单据</li>
<li>状态标识区域</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@media</span> print {
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-comment">/* 强制按页面样式输出颜色 */</span>
    -webkit-print-<span class="hljs-attribute">color</span>-adjust: exact;
    print-<span class="hljs-attribute">color</span>-adjust: exact;
  }
}
</code></pre>
<p>注：Window 电脑如果不设置 <code>-webkit-print-color-adjust: exact</code> 打印输出水印内容， 会出现空白现象。</p>
<h2 data-id="heading-31">六、总结</h2>
<p>浏览器打印在供应链系统中看似只是一个基础能力，但在真实项目中，往往涉及<strong>方案选型、技术栈适配、用户体验以及长期维护成本</strong>等多方面的权衡。</p>
<p>本文结合具体的业务背景，对主流 Web 打印方案进行了梳理，并重点分析了基于 <code>window.print</code> 的实现思路及其工程边界。</p>
<p>可以看到，<code>window.print</code> 本身并不复杂，真正的挑战更多来自页面渲染控制、样式管理以及打印流程的工程化处理。这也使得浏览器打印更像是一项系统能力的组合，而非单一 API 的简单调用。</p>
<p>在当前阶段，<code>window.print</code> 配合 <code>iframe</code> 依然是 Web 打印方案中<strong>性价比最高、可控性最强的一种实现方式</strong>。随着业务复杂度的提升，打印方案仍有进一步演进与细化的空间。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Compose 的震动还能这么玩儿？]]></title>    <link>https://juejin.cn/post/7598734303174574132</link>    <guid>https://juejin.cn/post/7598734303174574132</guid>    <pubDate>2026-01-26T01:00:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174574132" data-draft-id="7598203055747874868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose 的震动还能这么玩儿？"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-26T01:00:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose 的震动还能这么玩儿？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:00:05.000Z" title="Mon Jan 26 2026 01:00:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6800beeb924f2484ce679c209c80d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=cIxBYLXfmVshFDmNT53WpC%2F3wUU%3D" alt="2.png" loading="lazy"/></p>
<p>上周我在公司摸鱼的时候，发现 Github 上有一个开源库叫 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcompose-jindong%2Fjindong" target="_blank" title="https://github.com/compose-jindong/jindong" ref="nofollow noopener noreferrer">Jindong</a>，没错，听起来就是京东！</p>
<p>我以为我看错了，京东什么时候开始干这玩意儿了？后面才发现误会了。</p>
<h2 data-id="heading-0">Jindong 是什么</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ff95b33316948099512d1f39d6e87d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=WKMy2Nd2ynuxlIIvCsHbB9NozM8%3D" alt="1.png" loading="lazy"/></p>
<p><strong>Jindong</strong> 为 Compose 跨平台应用（支持 Android 和 iOS）提供了声明式的触觉反馈 <strong>DSL</strong>。它基于 Compose 构建，让你能通过简单直观的 API 定义复杂的触觉模式。</p>
<blockquote>
<p>该开源库的作者是来自韩国的开发者。“Jindong”[tɕindooŋ]（진동）在韩语中意为“振动”。<br/>
好朴实无华的库名称，如果是中文名那岂不就是——Zhendong？</p>
</blockquote>
<p>我们知道，当前移动 UI 开发已成功转向声明式范式，但与硬件 API 的交互（尤其是触觉反馈）仍然主要依赖命令式编程。</p>
<p>所以这个库的初衷，是为了让触觉反馈的交互也转向声明范式，它解决了在 Compose Multiplatform 应用中实现触觉反馈的复杂性。借助 Compose，开发者现在可以将触觉模式以结构化描述的形式进行定义。</p>
<p>也就是说，它提供了一种声明范式的方式调用硬件 API，同时还支持跨平台。</p>
<h2 data-id="heading-1">传统震动</h2>
<p>我们先来看看传统的命令式方式——使用标准 Android API 创建波形振动，需要并行的时序和振幅值数组：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        <span class="hljs-keyword">val</span> timings = longArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>)
        <span class="hljs-keyword">val</span> amplitudes = intArrayOf(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0</span>, <span class="hljs-number">128</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>)
        <span class="hljs-keyword">val</span> effect = VibrationEffect.createWaveform(timings, amplitudes, -<span class="hljs-number">1</span>)
        defaultVibrator.vibrate(effect)
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}

</code></pre>
<p>调整某个节拍的持续时间需要重新计算数组索引。更不用说，这种逻辑是平台相关的，iOS 的 Core Haptics 需要完全不同的代码实现。</p>
<h2 data-id="heading-2">声明式</h2>
<p><strong>Jindong</strong> 将这些底层细节抽象为一种 DSL。开发者只需定义反馈结构，库会负责执行。</p>
<p>首先，我们添加权限和依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.VIBRATE"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin">implementation(<span class="hljs-string">"io.github.compose-jindong:jindong:1.0.0"</span>)
</code></pre>
<p>然后，开始 DSL 形式的震动：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">var</span> count <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }

JindongProvider { <span class="hljs-comment">// 需要提供一个 JindongProvider</span>
    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// 防止第一次进来就震动</span>
        Jindong(count) { <span class="hljs-comment">// 传入一个 key，当 key 发生变化的时候，就会震动</span>
            Sequence {
                repeat(<span class="hljs-number">3</span>) { <span class="hljs-comment">// 重复三次震动</span>
                    Haptic(<span class="hljs-number">50.</span>ms, HapticIntensity.STRONG)
                    Delay(<span class="hljs-number">100.</span>ms)
                }
            }
        }
    }

}

Column(
    modifier = Modifier.fillMaxSize(),
) {
    Button(onClick = {
        count++
    }) {
        Text(<span class="hljs-string">"Vibrate"</span>)
    }
}
</code></pre>
<p>在这里，开发者只需定义触觉模式（一个重复三次的序列），而库会负责处理平台相关的执行细节。</p>
<p>这种差异不仅仅是语法上的不同——关键在于<strong>谁来控制执行过程</strong>。</p>
<p>这也正是旧式的 View 写法和新式的 Compose 写法的核心差别：</p>

















<table><thead><tr><th>命令式思维</th><th>声明式思维</th></tr></thead><tbody><tr><td>“先振动 50ms，然后等待 100ms，再振动 50ms”</td><td>“我想要一个 50ms-100ms-50ms 的震动模式”</td></tr><tr><td>“循环三次，中间有延迟，启动震动”</td><td>“我想要三次重复”</td></tr></tbody></table>
<p>声明式编程关注于定义目标的逻辑和关系，而不指定如何实现它们。</p>
<p><strong>“描述要做什么，而不是怎么做。”</strong></p>
<h2 data-id="heading-3">生命周期管理</h2>
<p>在命令式触觉反馈中，生命周期管理是最大的痛点之一。如果用户在长时间振动模式播放过程中导航离开当前页面，会发生什么？</p>
<p>在命令式编程的世界里，你必须手动在 <code>onPause</code> 或 <code>onDispose</code> 中调用 <code>vibrator.cancel()</code>。</p>
<p>而使用 <strong>Jindong</strong> 时，触觉模式会自动绑定到 Compose 的生命周期：</p>
<ul>
<li><strong>自动取消</strong>：当 Composable 离开组合时，触觉引擎会立即停止。</li>
<li><strong>响应式更新</strong>：就像 <code>LaunchedEffect</code> 一样，如果在模式播放过程中 <code>keys</code> 发生变化，<strong>Jindong</strong> 会自动取消当前模式，并根据新状态重新开始执行。</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">/**
 * 当 keys 发生变化时，触发触觉模式执行的可组合函数。
 */</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">jindong</span><span class="hljs-params">(
    <span class="hljs-keyword">vararg</span> keys: <span class="hljs-type">Any</span>?,
    content: @<span class="hljs-type">Composable</span> <span class="hljs-type">JindongScope</span>.() -&gt; <span class="hljs-type">Unit</span>,
)</span></span> {
    <span class="hljs-keyword">val</span> pattern = rememberHapticPattern(content)
    <span class="hljs-keyword">val</span> executor = LocalHapticExecutor.current
    LaunchedEffect(*keys) {
        executor.execute(pattern)
    }
}
</code></pre>
<p>这正是 Compose 的一大优势，无需特别关心生命周期。</p>
<p>当你离开组合时，当前的副作用自动结束！</p>
<h2 data-id="heading-4">搞点例子</h2>
<p>以下是一些 <strong>Jindong</strong> 的实用场景。</p>
<p><em>下面的例子因为篇幅我没有显示的指定 <code>JindongProvider</code>，实际上所有的 <code>Jindong</code> 都需要在 <code>JindongProvider</code> 内部。</em></p>
<h3 data-id="heading-5">屏幕进入反馈</h3>
<p>使用 <code>Unit</code> 作为触发键，可在进入屏幕时立即触发热反馈：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">WelcomeScreen</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 页面出现时执行一次</span>
    Jindong(<span class="hljs-built_in">Unit</span>) {
        Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.MEDIUM)
    }
}
</code></pre>
<h3 data-id="heading-6">按钮点击反馈</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">TapButton</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> taps <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">if</span> (taps &gt; <span class="hljs-number">0</span>) {
        Jindong(taps) {
            Haptic(<span class="hljs-number">100.</span>ms, HapticIntensity.LIGHT)
        }
    }
    Button(onClick = { taps++ }) {
        Text(<span class="hljs-string">"Tap"</span>)
    }
}
</code></pre>
<h3 data-id="heading-7">淡出效果</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">FadeOutHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        RepeatWithIndex(<span class="hljs-number">5</span>) { index -&gt;
            <span class="hljs-keyword">val</span> intensity = HapticIntensity.Custom(<span class="hljs-number">1.0f</span> - (index * <span class="hljs-number">0.2f</span>))
            Haptic(<span class="hljs-number">50.</span>ms, intensity)
            Delay(<span class="hljs-number">100.</span>ms)
        }
    }
}
</code></pre>
<h3 data-id="heading-8">模拟心跳</h3>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">HeartbeatHaptic</span><span class="hljs-params">(trigger: <span class="hljs-type">Int</span>)</span></span> {
    Jindong(trigger) {
        Repeat(<span class="hljs-number">5</span>) {

            <span class="hljs-comment">// Lub（强脉冲）</span>
            Haptic(<span class="hljs-number">60.</span>ms, HapticIntensity.STRONG)
            Delay(<span class="hljs-number">80.</span>ms)

            <span class="hljs-comment">// Dub（弱脉冲）</span>
            Haptic(<span class="hljs-number">40.</span>ms, HapticIntensity.MEDIUM)
            Delay(<span class="hljs-number">400.</span>ms)
            
        }
    }
}
</code></pre>
<p><strong>强烈建议各位试一下，这个特别像！</strong></p>
<h2 data-id="heading-9">内部原理：Compose Runtime 与 CMP</h2>
<h3 data-id="heading-10">Compose Runtime 的作用是什么？</h3>
<p>Compose Runtime 是一个与 UI 渲染无关的树管理引擎。<strong>Jindong</strong> 依赖于 Compose 运行时的两个核心组件：</p>
<ul>
<li><strong>ComposeNode</strong>：这是一个通用函数，用于将节点插入到树中。在 <strong>Jindong</strong> 中，每个 DSL 函数（如 <code>Haptic</code>、<code>Delay</code> 和 <code>Sequence</code>）都会在内部调用 <code>ComposeNode</code>，以创建特定的 <code>HapticNode</code> 实现。</li>
<li><strong>Applier</strong>：运行时需要知道如何将这些节点连接起来。<code>Applier</code> 负责处理 <code>HapticNode</code> 树的结构更新，该树将在播放前被遍历，以收集 <code>ScheduledHapticEvent</code> 事件。</li>
</ul>
<p>就像 Compose UI 通过构建 <code>LayoutNode</code> 树来渲染像素一样，<strong>Jindong</strong> 通过构建 <code>HapticNode</code> 树来合成振动效果。这使我们能够使用标准的 Compose 特性（如 <code>SideEffect</code>、<code>remember</code>），结合 Kotlin 的标准控制流（如 <code>if/when/for</code>），自然地构建动态的触觉体验。</p>
<h3 data-id="heading-11">Compose Multiplatform 实现</h3>
<p><strong>Jindong</strong> 遵循标准的 CMP（Compose Multiplatform）架构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48925c6b609a4ab298002ef02ee73ccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769994004&amp;x-signature=GzjNWUeHecWN0ns1mQ0Q6DSF8Zg%3D" alt="cmp.png" loading="lazy"/></p>
<ol>
<li><strong>通用层（Common Layer）</strong> ：包含 Compose DSL 定义、节点（Nodes）以及 <code>HapticPattern</code> 数据模型。所有时间计算和模式编译都在此层完成，确保跨平台行为的一致性。</li>
<li><strong>平台层（Platform Layer，即执行器 Executor）</strong> ：
<ul>
<li><strong>Android</strong>：将 <code>HapticPattern</code> 转换为 <code>VibrationEffect</code>（使用 <code>VibrationEffect.createWaveform</code>）。</li>
<li><strong>iOS</strong>：将 <code>HapticPattern</code> 转换为 <code>CHHapticPattern</code>，用于 Core Haptics。</li>
</ul>
</li>
</ol>
<p>Android 和 iOS 对振动强度的处理方式不同。</p>
<p>Android 使用振幅整数（1–255），而 iOS 的 Core Haptics 使用归一化的浮点值（0.0–1.0）。</p>
<p><strong>Jindong</strong> 提供了一个统一的抽象层，使开发者可以使用归一化的百分比（例如，<code>intensity = 0.5f</code>）来定义强度，无需关心平台特定的数学转换。</p>
<h2 data-id="heading-12">总结</h2>
<p><strong>Jindong</strong> 旨在解决在 Compose Multiplatform 应用中实现触觉反馈的复杂性。通过利用 Compose 运行时，开发者可以将触觉模式定义为<strong>结构化描述</strong>，而非一系列电机命令序列。</p>
<p>各位还在等什么，赶紧用起来试试呀！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题]]></title>    <link>https://juejin.cn/post/7598938568431271951</link>    <guid>https://juejin.cn/post/7598938568431271951</guid>    <pubDate>2026-01-26T03:50:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598938568431271951" data-draft-id="7598838597559992354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-26T03:50:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:50:56.000Z" title="Mon Jan 26 2026 03:50:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    113
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>状态本身并不可怕，可控的边界才是关键。无论 Vue/React/Flutter，真正失控的场景总是因为<code>谁该负责这块状态？</code> <code> 状态的生命周期与副作用不一样咋办？</code> <code>状态有多个“真实来源”</code>。比起盲目选用全局状态库，先设计状态边界、所有者与契约，再选工具，这才是我想写这篇文章的核心。</p>
</blockquote>
<h2 data-id="heading-0">目前</h2>
<p>我维护过三套完全不同的代码库：一个用 Vue3 做企业后台，一个用 React 做客户运营后台，还有一个用 Flutter 做用户端 App。开始的时候我和很多人一样，把“状态管理”当成救命稻草，拿着 Pinia、Redux、Provider 当工具箱里的万能胶，遇到问题就往全局塞状态。后来出现的问题不是框架的锅，而是我和团队没有先把状态的边界划清楚。最直观的一次教训是一个批量导入功能：导入进度既存在于页面的临时变量，也存在于全局 cache、后端轮询结果，还有一个后台任务队列的本地副本，结果在某些网络抖动场景下进度条反复闪烁、提交失败、回调覆盖更新，排查下来并不是网络问题，而是同一份“事实”有多个来源、多个所有者、多个副作用在不同地方生效，互相覆盖。修复并不靠换库，而是靠把“导入任务”明确成单一来源、改用只读查询加唯一写入入口，并把所有副作用集中到 service 层，这才把问题彻底堵住。</p>
<h2 data-id="heading-1">示例一：Vue3 中“状态失控”的典型写法 vs 有边界的写法</h2>
<p><strong>失控版本（真实会出事故的那种）</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// store.ts</span>
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">importTask</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>,
})
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// A.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">30</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// B.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">80</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// service.ts</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  state.<span class="hljs-property">progress</span> += <span class="hljs-number">10</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<p>这种写法的问题不是 Vue，而是<strong>任何地方都能写</strong>，没有人知道谁是妆台管理者。<br/>
只要接口回调、定时轮询、用户操作同时发生一次，UI 就开始抽风。</p>
<h2 data-id="heading-2">但是</h2>
<p>不同框架的问题表现不太一样，但本质相似。Vue3 的常见失控点是把 <code>reactive</code> 的对象随手导出，全项目任意模块直接改动，或者把大量短期 UI 状态塞进 Pinia，结果是到底哪个组件该清理、什么时候取消 watch、谁负责取消请求，没人说得清楚；React 的典型症状是把太多东西放进 Context 或一个大 Redux store，组件随便改对象属性（非不可变更新），导致 memo 无效、重渲染泛滥和难以回溯的副作用；Flutter 则常见在 <code>setState</code> 或全局单例里乱放数据，导致父组件更新引起大量子树不必要重建，或者 Provider/Riverpod 的边界划分混乱，让调试变得痛苦。无论是哪种框架，问题总在这些点交汇：谁该负责这块数据、这块数据的生命周期何时开始与结束、哪些副作用会影响它、它是否有多个事实来源。</p>
<h2 data-id="heading-3">示例二：React 中“useEffect 地狱”是怎么来的</h2>
<p><strong>常见但危险的写法</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>))
  }, [userId, progress])
}
</code></pre>
<p>这个代码我敢说你肯定见过。<br/>
问题在于：<code>progress</code> 既是<strong>结果</strong>，又被当成<strong>触发条件</strong>，effect 自己触发自己，网络抖一下就会循环请求。</p>
<p><strong>把副作用和状态边界拆开</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useImportTask</span>(<span class="hljs-params">userId: string</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> canceled = <span class="hljs-literal">false</span>

    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!canceled) <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>)
      })

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      canceled = <span class="hljs-literal">true</span>
    }
  }, [userId])

  <span class="hljs-keyword">return</span> progress
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">useImportTask</span>(userId)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Progress</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{progress}</span> /&gt;</span></span>
}
</code></pre>
<p>z仔细看看这段代码你会发现：  <strong>页面不再“拥有”状态，只是消费状态</strong>，失控的入口直接少了一半。</p>
<h2 data-id="heading-4">解决</h2>
<p>既然问题的核心是“边界不清”，我给新项目的建议有几条可能听起来反直觉但非常实用：第一，<code>不要急着建一个全局 store</code>，先把状态放在页面或组件本地，等出现明确的跨页面共享需求并能量化受益时再抽象；
第二，写代码前先画张状态边界图，列出每个状态的 owner、生命周期、是否持久化、是否为衍生值、以及唯一的写入入口；第三，全局或模块化 store 只暴露只读查询和明确的写入 API，禁止项目随意直接修改内部结构；第四，副作用全部集中到 service/side-effect 层（无论是 React 的 hook、Vue 的 composable 还是 Flutter 的 repository），组件只负责展示与触发，副作用层负责取消、去重、重试和错误处理；第五，<code>衍生状态不要持久化</code>，能由原始状态算出来的就用 computed/selector 动态计算；第六，对于复杂的状态流转场景（例如多阶段导入、有超时和回滚逻辑）考虑用状态机来建模，状态可视化之后很多边界问题就能一目了然；第七，启用类型系统和不可变更新约定，这能大幅提升可追溯性和避免微妙的引用错误；第八，把变更审计和日志当成基础设施，<code>为重要的全局状态记录 action 名称、时间戳和 trace id，出问题时能快速回溯。</code></p>
<p>哦对了，忘记距离flutter了，这个技术在掘金里面可能用到的人有点少，没有react vue那么多，但还是说一下吧。</p>
<h2 data-id="heading-5">示例三：Flutter 里最容易被忽略的全局状态</h2>
<p><strong>问题写法</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalTask</span> {
  <span class="hljs-type">static</span> <span class="hljs-type">int</span> progress = <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">setState(() {
  GlobalTask.progress += 10<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>这个问题非常隐蔽，因为 Flutter 重建 UI 很快，早期根本察觉不到。<br/>
但一旦页面多了、热重载多了、逻辑复杂了，你根本不知道是谁在改。</p>
<p><strong>明确 owner 的写法（Provider / Riverpod 思路）</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportTaskState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ChangeNotifier</span> {
  int _progress = <span class="hljs-number">0</span>;

  int get progress =&gt; _progress;

  <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProgress</span>(<span class="hljs-params">int value</span>) {
    _progress = value;
    <span class="hljs-title function_">notifyListeners</span>();
  }
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Consumer</span>&lt;<span class="hljs-title class_">ImportTaskState</span>&gt;(
  <span class="hljs-attr">builder</span>: (_, state, __) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ProgressBar</span>(<span class="hljs-attr">value</span>: state.<span class="hljs-property">progress</span>);
  },
)
</code></pre>
<p>你不是在用 Provider，而是在<strong>声明：这块状态属于 ImportTaskState</strong>。</p>
<p>还有一些衍生状态千万不要存，如果有复杂流程直接用状态机</p>
<p><strong>错误思路</strong></p>
<pre><code class="hljs language-js" lang="js">state.<span class="hljs-property">list</span> = rawList
state.<span class="hljs-property">filteredList</span> = rawList.<span class="hljs-title function_">filter</span>(...)
</code></pre>
<p><strong>正确思路</strong></p>
<pre><code class="hljs language-hs" lang="hs">const filteredList = computed(() =&gt; {
  return state.list.filter(...)
})
</code></pre>
<p>这不是性能优化，这是<strong>防止状态分叉</strong>。  一旦存了两份，你迟早要花时间修同步问题。</p>
<hr/>
<h2 data-id="heading-6">状态机</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> importMachine = <span class="hljs-title function_">createMachine</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'import'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">states</span>: {
    <span class="hljs-attr">idle</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">START</span>: <span class="hljs-string">'uploading'</span> } },
    <span class="hljs-attr">uploading</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'processing'</span>, <span class="hljs-attr">FAIL</span>: <span class="hljs-string">'error'</span> } },
    <span class="hljs-attr">processing</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">DONE</span>: <span class="hljs-string">'completed'</span> } },
    <span class="hljs-attr">completed</span>: {},
    <span class="hljs-attr">error</span>: {},
  },
})
</code></pre>
<p>当你把流程画成状态图之后，会非常清楚地看到：<strong>哪些状态允许更新，哪些不允许</strong>，根本不需要猜。</p>
<h2 data-id="heading-7">结尾~~~</h2>
<p>以下是我总结的几点建议~，针对我们当前三个技术栈项目了，按需自取哈~并不通用。</p>
<ul>
<li>一，功能设计阶段画状态边界图并在 PR 中提交；</li>
<li>二，凡是跨页面共享的状态必须指定 owner 与 action；</li>
<li>三，把网络请求、订阅、定时器等副作用统一封装在 service 层并实现取消逻辑；</li>
<li>四，把 UI 临时数据留在本地，衍生数据用 selector；</li>
<li>五，<code>对复杂流程使用状态机并训练团队阅读状态图</code> 没开玩笑， man！！！；</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[手写 Promise.all]]></title>    <link>https://juejin.cn/post/7599483314160746515</link>    <guid>https://juejin.cn/post/7599483314160746515</guid>    <pubDate>2026-01-26T13:34:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599483314160746515" data-draft-id="7568319637000781824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="手写 Promise.all"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-26T13:34:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="剪刀石头布啊"/> <meta itemprop="url" content="https://juejin.cn/user/1855631360014798"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            手写 Promise.all
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1855631360014798/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    剪刀石头布啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T13:34:15.000Z" title="Mon Jan 26 2026 13:34:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>Promise 是 JavaScript 中非常重要的一个功能，他可以让我们异步的去处理一些事情，尤其是对于一些比较耗时的操作，其非常重要，当然一些不耗时的操作，有事就没必要使用它了，毕竟会带来额外的性能开销</p>
<h2 data-id="heading-1">Promise.all</h2>
<p>Promise.all 是 js 中个一个静态方法，尤其是写业务对接后端的时候，会经常见到，不管是写后端异步签名，还是前端接口请求，其主要用来聚合一组成功的结果</p>
<p>相比于 promise 其他系列，这个算是比较简单了(当然 race 更简单就不介绍了)</p>
<p>下面简单陈述 Promise.all 手写的几个关键单</p>
<ol>
<li>all 是一个静态方法，因此不能像写对象的原型链 prototype一样写</li>
<li>promise 状态从 pending 变更为 fulfilled 或者 rejected 只能发生一次，因此无需考虑多次回调 reject 的问题</li>
<li>遍历 promises 数组的时候，遍历的是所有可迭代对象，因此 for...of 非常适合</li>
</ol>
<p><strong>tips</strong>: 可以通过 promise 函数回调赋值的方式减少嵌套层级</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//声明一个静态方法</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-property">myAll</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">promises</span>) {
    <span class="hljs-keyword">let</span> resolve, reject;
    <span class="hljs-comment">//构造一个新的promise,赋值可以减少嵌套层级</span>
    <span class="hljs-keyword">const</span> completePromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res, rej</span>) =&gt;</span> {
        resolve = res;
        reject = rej;
    })
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-keyword">const</span> length = promises.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> completedCount = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> idx = <span class="hljs-number">0</span>
    <span class="hljs-comment">//tips: promise 状态从 pending 变更为 fulfilled 或者 rejected 只能发生一次</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> promises) {
        <span class="hljs-comment">//使用一个临时变量接收 idx 避免补货到外部同一个索引</span>
        <span class="hljs-keyword">const</span> currentIndex = idx;
        <span class="hljs-comment">//item可能不是promise，所以用Promise.resolve包一下</span>
        <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(item).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> {
            results[currentIndex] = value;
            completedCount++;
            <span class="hljs-comment">//全部成功标记成功</span>
            <span class="hljs-keyword">if</span> (completedCount === length) {
                <span class="hljs-title function_">resolve</span>(results);
            }
        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
            <span class="hljs-comment">//有一个返回err就行了，promise状态只会变更一次</span>
            <span class="hljs-title function_">reject</span>(err);
        })
        idx++;
    }
    <span class="hljs-keyword">return</span> completePromise;
}
</code></pre>
<p>下面测试一下结果，非常正确</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">const</span> <span class="hljs-title function_">test</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>)
        }, <span class="hljs-number">1000</span>)
    });
    <span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>)
        }, <span class="hljs-number">2000</span>)
    });
    <span class="hljs-keyword">const</span> p3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// reject('error 3')</span>
            <span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)
        }, <span class="hljs-number">1500</span>)
    });
    <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">myAll</span>([p1, p2, p3]).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'res'</span>, res)
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'err'</span>, err)
    })
}

<span class="hljs-title function_">test</span>();
</code></pre>
<p>这篇文章就讲到这里了，由于内容相对简单，就不多介绍了</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills完全指南：核心概念丨设计模式丨实战代码]]></title>    <link>https://juejin.cn/post/7598918127578972194</link>    <guid>https://juejin.cn/post/7598918127578972194</guid>    <pubDate>2026-01-26T05:06:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598918127578972194" data-draft-id="7598734303174066228" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills完全指南：核心概念丨设计模式丨实战代码"/> <meta itemprop="keywords" content="Trae,人工智能,Claude"/> <meta itemprop="datePublished" content="2026-01-26T05:06:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills完全指南：核心概念丨设计模式丨实战代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T05:06:23.000Z" title="Mon Jan 26 2026 05:06:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><strong>Agent Skills</strong>最近非常火！它最初只是 Claude 中的一个功能模块，但在最近两个月里，随着越来越多开发者体验到其强大与便捷，Codex、Cursor、OpenCode 等主流 AI 编程工具也相继加入了对 Agent Skills 的支持。就连我日常使用最频繁的字节跳动旗下工具 Trae，也于近期集成了这一能力。</p>
<p>2025 年 12 月 18 日，Anthropic 正式将 Agent Skills 发布为开放标准，标志着它正与 MCP 一样，朝着通用化、跨平台化的规范方向发展。如果大家还不熟悉 Agent Skills，也无需担心——本文将带大家系统梳理其技术原理，解析关键设计模式，并通过实战代码为大家完整解读 <strong>Agent Skills</strong> 的核心内容。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de5dcbd47cb47b99462ecab3859c6d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=whhyyWaCy9CTMjKLb6fLB7uNWCU%3D" alt="0.jpeg" loading="lazy"/></p>
<p>这里同样宣传一下笔者正在编写的专栏：<a href="https://juejin.cn/column/7594655863548248116" target="_blank" title="https://juejin.cn/column/7594655863548248116">《大模型训练指南》</a>，该专栏预计会有50期内容，将系统拆解从数据处理、模型训练到强化学习与智能体开发的全流程，并带大家从零实现模型，帮助大家掌握大模型训练的全技能，真正掌握塑造智能的能力！</p>
<h2 data-id="heading-1">一、 Agent Skills 介绍</h2>
<p>如果用一句话概括，<strong>Agent Skills 就像一份“带目录的说明书”</strong> 。更专业地说，它是一种<strong>渐进式披露的提示词管理机制</strong>。</p>
<p>该规范将提示词分为三个层次：</p>
<ul>
<li><strong>元数据（Metadata）</strong></li>
<li><strong>指令（Instruction）</strong></li>
<li><strong>资源（Resource）</strong></li>
</ul>
<p>其中，只有<strong>元数据层</strong>默认被加载到大模型的上下文中，其余两层均为<strong>按需加载</strong>。大家可以这样理解：</p>
<ul>
<li><strong>元数据</strong>如同书的<strong>目录</strong>，告诉模型有哪些可用的能力；</li>
<li><strong>指令</strong>如同书的<strong>正文</strong>，详细说明在某一能力下如何执行某项任务；</li>
<li><strong>资源</strong>如同书的<strong>附录</strong>，提供对某一能力的必要的补充材料（如代码示例、数据模板等）。</li>
</ul>
<p>智能体在执行时，首先仅载入“目录”（元数据），随后根据实际需求，再决定是否查阅该目录下的“正文”（指令）与“附录”（资源）。</p>
<p>与传统的完整 Prompt 或 MCP 方式相比，Agent Skills 最显著的优势在于<strong>大幅降低了 Token 消耗与提示词的复杂度</strong>，使智能体的能力扩展更加轻量与高效。</p>
<p>当然，仅理论描述仍显抽象。接下来笔者将通过一个 Claude Skills 的实际案例，带大家直观理解 Agent Skills 是如何运作的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/277610d043e543ceaae4c66d12554797~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=%2FDKUFH4L8TDYup%2FeBVO4YSG0A%2FA%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-2">二、Claude Code使用Skills基本流程</h2>
<p>既然 Skills 规范由 Anthropic 公司提出，笔者就以 Claude Code 为例，首先介绍其基本用法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3624668940c749f2a4a90dacc86a0096~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=3M7hGeTICOMA91pvHnmxe3C5k6U%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-3">2.1 claude code安装教程</h3>
<ol>
<li><strong>环境准备：</strong> 首先大家需要安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.cn%2Fdownload%2F" target="_blank" title="https://nodejs.cn/download/" ref="nofollow noopener noreferrer">Node.js 18</a>或更新的版本环境。还需要安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Finstall%2F" target="_blank" title="https://git-scm.com/install/" ref="nofollow noopener noreferrer">Git</a>，流程笔者就不再赘述，大家可以参考笔者以前文章 <a href="https://juejin.cn/post/7491986080473153586" target="_blank" title="https://juejin.cn/post/7491986080473153586">不写一行代码! VsCode+Cline+高德地图MCP Server 帮你搞定和女友的出行规划（附原理解析）</a>。</li>
<li><strong>安装 Claude Code：</strong> 在命令行中执行以下命令进行全局安装claude：<code>npm install -g @anthropic-ai/claude-code</code>命令,  安装完成后，可通过 <code>claude --version</code> 验证是否安装成功。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8eb8474902a46949f04646348dd7bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=2S%2B%2FlChvWQLvcexh0hxHqavV5Jk%3D" alt="3.png" loading="lazy"/></p>
<ol start="3">
<li><strong>配置大模型（国内开发者）：</strong> 由于 Claude 模型访问限制，国内开发者通常可将其它模型接入 Claude Code。此处以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fcoding-plan%2Ftool%2Fclaude%23%25E6%2596%25B9%25E5%25BC%258F%25E4%25B8%2589%25EF%25BC%259A%25E6%2589%258B%25E5%258A%25A8%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://docs.bigmodel.cn/cn/coding-plan/tool/claude#%E6%96%B9%E5%BC%8F%E4%B8%89%EF%BC%9A%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer"><strong>智谱大模型</strong></a>为例：在 <code>C:\Users{你的用户名}.claude</code> 目录下（若无则新建），创建 <code>settings.json</code> 文件，并填入以下配置：</li>
</ol>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"ANTHROPIC_AUTH_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你注册的智谱api key(大家可以买套餐注册)"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ANTHROPIC_BASE_URL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://open.bigmodel.cn/api/anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"API_TIMEOUT_MS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3000000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>4.  <strong>完成基础配置：</strong> 在 <code>C:\Users{你的用户名}</code> 目录下，创建 <code>.claude.json</code> 文件并写入以下内容，配置完成后，请<strong>重新启动命令行窗口</strong>以使环境变量生效：</p>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"hasCompletedOnboarding"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>5.  <strong>启动与使用：</strong> 新建一个项目目录，通过命令行进入该目录后，执行 <code>claude</code> 命令即可启动。首次在某个目录使用时，系统可能会询问是否信任该目录，选择 <code>YES</code> 即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b773fdce82b43749a5c4e2f9b7e1136~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=QyCHb7%2BHZDvISBwFYRJAFZaQWIs%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 Claude Code中使用skills</h3>
<p>下面笔者将通过一个实战案例（思路参考自 @技术爬爬虾）来演示如何创建并使用一个 Skill。</p>
<ol>
<li><strong>Skill 的目录结构：</strong> 在 Claude Code 项目中，Skills 存放在 <code>项目目录/.claude/skills/</code> 路径下。每个 Skill 都是一个独立的文件夹，其中<strong>必须</strong>包含一个名为 <code>SKILL.md</code> 的定义文件（注意大写）。此文件包含了该 Skill 的<strong>元数据层</strong>和<strong>指令层</strong>。此外，文件夹内还可存放其他辅助文件，它们构成了 Skill 的<strong>资源层</strong>。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02f5acea00b24ddcbdf9458a86050634~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=sjw3CdJLBwgIwkllkvTwUFWazzQ%3D" alt="6.png" loading="lazy"/></p>
<ol start="2">
<li><strong>创建 Skill 文件夹与文件：</strong> 在项目根目录（例如笔者这里是 <code>skill-project</code>）下，依次创建 <code>.claude\skills\字幕转markdown</code> 文件夹，并在其中创建 <code>SKILL.md</code> 文件(注意名称必须为<code>SKILL.md</code>，大小写都要一致)。</li>
<li><strong>编写 Skill 元数据：</strong> 在<code>SKILL.md</code> 文件中首先写入元数据，元数据用于描述 Skill 的基本信息，需用 <code>---</code> 包裹。它会被优先加载到大模型上下文中，相当于“能力目录”。</li>
</ol>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">srt字幕转markdown笔记</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">把srt字幕文件转换为markdown笔记</span>
<span class="hljs-meta">---
</span></code></pre>
<p>4.  <strong>编写 Skill 指令：</strong> 在<code>SKILL.md</code> 文件中元数据后面紧接着编写指令部分，指令部分定义了 Skill 的具体操作逻辑和详细要求，采用 Markdown 格式编写。</p>
<pre><code class="hljs language-markdown" lang="markdown">你是专业的字幕文本处理助手，任务是将sRT 字幕完整转换为 Markdown 笔记，并添加标点、段落格式和必要的截图占位符。要求
如下:
1.<span class="hljs-strong">**内容完整保留**</span>:禁止任何删减、总结或省略，必须逐字保留 SRT 所有文字。
2.<span class="hljs-strong">**语言规则**</span>:使用中文书写，保留必要的英文专有名词。
3.<span class="hljs-strong">**段落结构**</span>:
<span class="hljs-code">    -仅使用一个层级的段落
    -每个段落标题使用## 标题
    -第一段为引言，不使用标题
    -只需要划分2-3个段落
4. **标点与排版**:
    -为每句话添加合适标点
    -适当划分自然段
5.**截图占位符规则(按需插入)**
    -当某句符合以下任一条件时，在句末添加截图标记:
    -代码讲解
    -UI 交互操作
    -包含"这么、这里、这儿"等视觉指代词
    -提及网址/链接/地址(包括 GitHub、API endpoint等)
    -任何借助视觉材料更易理解的内容
    -形式必须严格为:
    ```
    Screenshot-[hh:mm:ss]
    ```
    -仅在真正有助理解时插入，不可滥用
    比如:
    ```
    原始SRT
    00:02:08,600--&gt;00:02:09,800
    安装这个工具
    ```
6. **输出文件格式**:
    - 生成内容保存为单个Markdown 文件，命名为:
    ```
    项目根目录/xxx.md
    ```
</span></code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a741365998fb4388a8d19fbaf5366915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=0%2B%2FQKQy%2BHhr3rRuZe59oKzBZfpE%3D" alt="7.png" loading="lazy"/></p>
<ol start="5">
<li><strong>查看与测试 Skill</strong>：在项目目录下打开命令行并输入 <code>/skills</code>，即可看到已定义好的 Skill。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6feba68277fe44a586be2f6e8ac9a61d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=IiWNaqEKKCbyftWMz6cEWx0BCY0%3D" alt="8.png" loading="lazy"/></p>
<ol start="6">
<li><strong>运行 Skill</strong>： 将需要转换的 <code>.srt</code> 字幕文件拖入 Claude Code 命令行。此时，大模型仅加载了 <code>SKILL.md</code> 中的元数据（“目录”），识别出这是一个字幕文件，并<strong>询问是否使用对应的 Skill</strong>。<br/>
当大家确认使用后，Claude Code 才会将 <code>SKILL.md</code> 中详细的指令部分（“正文”）加载到上下文中，并开始执行转换任务。这就是  <strong>“渐进式披露提示词”</strong>  机制的核心体现：<strong>按需加载，显著节省 Token</strong>，这样大家是不是就理解了Skills设计的核心概念啦！</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5e22a94bf5040ddb7484163fc1c255d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=q3iBLf5YlxhwU7pViHRVWZ%2ByZiY%3D" alt="9.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/263faf0c59d549ca9b49cfd1ca34fa5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=zt4MHjtbDWVONfSGMI%2BO4XYo32w%3D" alt="10.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74ca09b264f0426f94960533630f1872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=iADIltxxQny6UAOXl7Z05mO6vKU%3D" alt="11.png" loading="lazy"/></p>
<h3 data-id="heading-5">2.3 Claude Code skills进阶用法</h3>
<p>一个 Skill 的强大之处在于可以集成各种资源文件（脚本、文档、图片等），以实现更复杂的自动化工作流。下面笔者就继续优化字幕转markdown skills，让其功能变得更强大！</p>
<ol>
<li><strong>资源层的组织：</strong> 可以在 Skill 文件夹内创建子目录（如 <code>scripts</code>, <code>references</code>, <code>assets</code>）来分类存放资源文件，使结构更清晰。资源文件可以是
可执行脚本、补充说明文档，也可以是图片等其它资源，标准做法是将可执行Python文件放到scripts子文件夹中，把文档放到references这个子文件夹里面，把图片等其它资源放到assets子文件夹里面。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbd048e324304b23bc98c1dfcdefb527~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=fRUaZI62P98I7CA4Ibrc02qM7qA%3D" alt="6.png" loading="lazy"/></p>
<ol start="2">
<li><strong>添加可执行脚本：</strong> 在 <code>字幕转markdown</code> 这个 Skill 的目录下，创建一个 <code>scripts</code> 子文件夹，并放入一个 Python 脚本 <code>screenshot.py</code>。该脚本的功能是：根据 Markdown 中生成的截图标记（如 <code>Screenshot-[00:03:12]</code>），调用 <code>ffmpeg</code> 从对应的视频文件中截取相应时间点的画面，并将标记替换为实际的图片链接。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> logging
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Iterable, <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>, <span class="hljs-type">Tuple</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">write_note</span>(<span class="hljs-params">filename: <span class="hljs-built_in">str</span>, markdown: <span class="hljs-built_in">str</span></span>) -&gt; Path:
    path = Path(<span class="hljs-string">f"output/<span class="hljs-subst">{filename}</span>.md"</span>)
    path.parent.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
    path.write_text(markdown, encoding=<span class="hljs-string">"utf-8"</span>)
    logging.info(<span class="hljs-string">"Saved note backup: %s"</span>, path)
    <span class="hljs-keyword">return</span> path


<span class="hljs-comment"># ---------- 截图 ----------</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_screenshot_markers</span>(<span class="hljs-params">markdown: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]]:
    <span class="hljs-string">"""
    找到 Screenshot-00:03:12 或 Screenshot-[00:03:12] 形式的标记。
    """</span>
    pattern = <span class="hljs-string">r"(?:\*?)Screenshot-(?:\[(\d{2}):(\d{2}):(\d{2})\]|(\d{2}):(\d{2}):(\d{2}))"</span>
    results: <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]] = []
    <span class="hljs-keyword">for</span> <span class="hljs-keyword">match</span> <span class="hljs-keyword">in</span> re.finditer(pattern, markdown):
        hh = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">4</span>)
        mm = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">5</span>)
        ss = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">6</span>)
        total_seconds = <span class="hljs-built_in">int</span>(mm) * <span class="hljs-number">60</span> + <span class="hljs-built_in">int</span>(ss)
        results.append((<span class="hljs-keyword">match</span>.group(<span class="hljs-number">0</span>), total_seconds))
    <span class="hljs-keyword">return</span> results


<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_screenshot</span>(<span class="hljs-params">video_path: Path, output_dir: Path, timestamp: <span class="hljs-built_in">int</span></span>) -&gt; Path:
    <span class="hljs-string">"""
    调用 ffmpeg 截图，返回图片路径。
    """</span>
    output_dir.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
    mm = timestamp // <span class="hljs-number">60</span>
    ss = timestamp % <span class="hljs-number">60</span>
    filename = <span class="hljs-string">f"screenshot_<span class="hljs-subst">{mm:02d}</span>_<span class="hljs-subst">{ss:02d}</span>.jpg"</span>
    output_path = output_dir / filename

    cmd = [
        <span class="hljs-string">"ffmpeg"</span>,
        <span class="hljs-string">"-ss"</span>,
        <span class="hljs-built_in">str</span>(timestamp),
        <span class="hljs-string">"-i"</span>,
        <span class="hljs-built_in">str</span>(video_path),
        <span class="hljs-string">"-frames:v"</span>,
        <span class="hljs-string">"1"</span>,
        <span class="hljs-string">"-q:v"</span>,
        <span class="hljs-string">"2"</span>,
        <span class="hljs-built_in">str</span>(output_path),
        <span class="hljs-string">"-y"</span>,
    ]
    logging.info(<span class="hljs-string">"生成截图：time=%s, file=%s"</span>, timestamp, output_path)
    subprocess.run(cmd, check=<span class="hljs-literal">False</span>, capture_output=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> output_path


<span class="hljs-keyword">def</span> <span class="hljs-title function_">replace_screenshots</span>(<span class="hljs-params">
    markdown: <span class="hljs-built_in">str</span>,
    video_path: <span class="hljs-type">Optional</span>[Path],
    output_dir: Path,
    image_base_url: <span class="hljs-built_in">str</span>,
</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""
    将 Screenshot 标记替换为实际图片链接；没有视频时保持原样。
    返回修改后的 markdown。
    """</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> video_path:
        logging.info(<span class="hljs-string">"未提供视频文件，保留 Screenshot 标记不变。"</span>)
        <span class="hljs-keyword">return</span> markdown

    matches = extract_screenshot_markers(markdown)
    
    <span class="hljs-keyword">for</span> idx, (marker, ts) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(matches):
        <span class="hljs-keyword">try</span>:
            img_path = generate_screenshot(video_path, output_dir, ts)
            url = <span class="hljs-string">f"<span class="hljs-subst">{image_base_url.rstrip(<span class="hljs-string">'/'</span>)}</span>/<span class="hljs-subst">{img_path.name}</span>"</span>
            markdown = markdown.replace(marker, <span class="hljs-string">f"![](<span class="hljs-subst">{url}</span>)"</span>, <span class="hljs-number">1</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:  <span class="hljs-comment"># pylint: disable=broad-except</span>
            logging.warning(<span class="hljs-string">"生成截图失败（%s）：%s"</span>, marker, exc)
    <span class="hljs-keyword">return</span> markdown

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    logging.basicConfig(
        level=logging.INFO,
        <span class="hljs-built_in">format</span>=<span class="hljs-string">"%(asctime)s [%(levelname)s] %(message)s"</span>,
    )
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"将 SRT/视频转换为 Markdown 笔记"</span>)
    args = parser.parse_args()

    logging.info(<span class="hljs-string">"环境变量加载完成。"</span>)

    <span class="hljs-comment">#从当前工作目录自动查找对应的 SRT 和 MP4 文件</span>
    cwd = Path.cwd()
    md_path: Path
    video_path: Path
    <span class="hljs-comment"># 附件文件夹</span>
    image_base_url = <span class="hljs-string">"assets"</span>
    screenshots_path = Path(<span class="hljs-string">f"output/<span class="hljs-subst">{image_base_url}</span>"</span>)

    md_candidates = <span class="hljs-built_in">sorted</span>(cwd.glob(<span class="hljs-string">"*.md"</span>))
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> md_candidates:
        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"当前目录没有找到任何 .md 文件，请把字幕文件夹导出并且放到根目录下。"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(md_candidates) &gt; <span class="hljs-number">1</span>:
        logging.warning(<span class="hljs-string">"当前目录中发现多个 .srt，将使用第一个：%s"</span>, md_candidates[<span class="hljs-number">0</span>])
    md_path = md_candidates[<span class="hljs-number">0</span>]

    mp4_candidates = <span class="hljs-built_in">sorted</span>(cwd.glob(<span class="hljs-string">"*.mp4"</span>))
    <span class="hljs-keyword">if</span> mp4_candidates:
        preferred: <span class="hljs-type">Optional</span>[Path] = <span class="hljs-literal">None</span>
        video_path = preferred <span class="hljs-keyword">or</span> mp4_candidates[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(mp4_candidates) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> preferred <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            logging.warning(<span class="hljs-string">"当前目录中发现多个 .mp4，将使用第一个：%s"</span>, video_path)
    <span class="hljs-keyword">else</span>:
        logging.info(<span class="hljs-string">"当前目录未发现 .mp4，将保留 Markdown 中的 Screenshot 标记不变。"</span>)
        video_path = <span class="hljs-literal">None</span>

    <span class="hljs-comment"># 读取 markdown 文件内容</span>
    markdown = md_path.read_text(encoding=<span class="hljs-string">"utf-8"</span>)
    logging.info(<span class="hljs-string">"读取 Markdown 文件：%s"</span>, md_path)

    processed_md = replace_screenshots(markdown, video_path=video_path, output_dir=screenshots_path, image_base_url=image_base_url)

    logging.info(<span class="hljs-string">"截图处理完成"</span>)
    
    <span class="hljs-comment"># 备份替换后的 Markdown 内容</span>
    output = write_note(<span class="hljs-string">"note_processed"</span>, processed_md)

    info = {
        <span class="hljs-string">"output"</span>: <span class="hljs-built_in">str</span>(output),
        <span class="hljs-string">"screenshots_dir"</span>: <span class="hljs-built_in">str</span>(screenshots_path),
        <span class="hljs-string">"video_used_for_screenshot"</span>: <span class="hljs-built_in">str</span>(video_path)
    }
    <span class="hljs-built_in">print</span>(json.dumps(info, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1633a22220e4056ab7d4ef52e34e537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=OghnvhSXdispslOM6v%2FIfIALRoA%3D" alt="12.png" loading="lazy"/></p>
<ol start="3">
<li><strong>更新指令以调用资源：</strong> 在 <code>SKILL.md</code> 的指令部分末尾，添加调用该脚本的步骤：</li>
</ol>

<pre><code class="hljs language-markdown" lang="markdown">7.<span class="hljs-strong">**后续处理**</span>:
<span class="hljs-code">    markdown生成完毕以后，调用
    python scripts/screenshot.py
    对视频进行截图，执行python脚本时不需要传递任何参数
</span></code></pre>
<p>4.  <strong>运行完整的 Skill 工作流：</strong>
1.  将待处理的视频文件 <code>.mp4</code> 也放入项目根目录。
2.  在 Claude Code 中，再次拖入 <code>.srt</code> 字幕文件。
3.  Claude Code 将首先执行“字幕转Markdown”任务，生成一份带有 <code>Screenshot-[hh:mm:ss]</code> 标记的笔记。
4.  接着，它会自动执行 <code>python scripts/screenshot.py</code> 命令。<strong>关键点在于</strong>：脚本代码本身<strong>不会</strong>作为提示词上下文传递给大模型，Claude Code 只是作为执行环境去运行它。这再次体现了 Skills 机制在<strong>降低上下文消耗</strong>上的优势。
5.  脚本运行后，最终生成一份包含实际截图链接的、图文并茂的 Markdown 笔记。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f499eab9294a4a5cb745d3264c882292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=CJqqIXRwlKWBsZb%2FAkpuw4RPEyU%3D" alt="13.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8e821750d0473c8bf0ce4348438f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=oNSTZC4fa8%2BJyM7K0ho2SE%2FCnGE%3D" alt="14.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42a3d362b7634c6ea85b51d97cc81c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770008783&amp;x-signature=8L5G%2BcuKhgMb7WQ5eoUGNe43T6w%3D" alt="15.png" loading="lazy"/></p>
<h2 data-id="heading-6">三、 Skills和MCP的区别</h2>
<p>许多读者询问笔者：同样出自 Anthropic，Skills 与 MCP（Model Context Protocol）究竟有何不同？<br/>
实际上，<strong>Skills 与 MCP 是两个目标不同、互为补充的规范</strong>。它们虽有部分功能重叠，但设计侧重点和使用场景有显著差异：</p>
<ul>
<li><strong>Skills</strong> 的核心在于<strong>提示词的管理与组织</strong>，通过“渐进式披露”机制，以轻量、结构化方式扩展模型能力。</li>
<li><strong>MCP</strong> 的核心在于<strong>工具与服务的标准化接入</strong>，旨在为模型提供统一、安全的外部工具调用能力。</li>
</ul>
<p>简单类比：</p>
<ul>
<li><strong>Skills 如同“带目录的说明书”</strong> ——逐步展开，按需提供详细操作指引。</li>
<li><strong>MCP 如同“标准化工具箱”</strong> ——提供一系列即插即用的工具，模型可直接调用。</li>
</ul>
<p>若大家对 MCP 的具体实现与原理感兴趣，可进一步阅读笔者之前的文章：<a href="https://juejin.cn/post/7488895565314949120" target="_blank" title="https://juejin.cn/post/7488895565314949120">《理论+代码一文带你深入浅出MCP：人工智能大模型与外部世界交互的革命性突破》</a>。</p>
<p>为更直观对比，以下从几个维度总结二者的主要区别：</p>



































<table><thead><tr><th>维度</th><th>Agent Skills</th><th>MCP</th></tr></thead><tbody><tr><td><strong>侧重点</strong></td><td>提示词的结构化组织与渐进式加载</td><td>外部工具与服务的标准化调用</td></tr><tr><td><strong>类比</strong></td><td>带目录的说明书</td><td>标准化工具箱</td></tr><tr><td><strong>Token 消耗</strong></td><td>低（仅按需加载指令与资源）</td><td>较高（需携带工具描述与调用逻辑）</td></tr><tr><td><strong>核心主体</strong></td><td>Markdown 文件（SKILL.md）</td><td>软件包/服务（含协议与实现）</td></tr><tr><td><strong>编写与部署难度</strong></td><td>低（文件级配置，易于本地管理）</td><td>较高（需遵循协议，常涉及服务端开发）</td></tr></tbody></table>
<p>总的来说，<strong>Skills 更适合轻量化、提示词驱动的能力扩展</strong>，而 <strong>MCP 更适合复杂、需频繁调用外部工具或服务的场景</strong>。在实际项目中，二者亦可结合使用，例如通过 MCP 提供工具，再通过 Skills 组织调用这些工具的提示词流程，从而实现更高效、可维护的智能体架构。</p>
<h2 data-id="heading-7">四、总结</h2>
<p>本篇分享了Agent Skills核心概念。它通过元数据、指令和资源三层结构实现渐进式披露，显著降低Token消耗。以Claude Code为例，详细演示了Skills的创建、使用及进阶集成方法，帮助大家快速掌握Skills的核心概念和开发技巧，助力大家构建更强大的智能体！</p>
<p>当然很多粉丝和笔者一样受制于某些因素无法高效使用Claude Code，也对智谱等模型的订阅机制颇有异议（心疼自己钱包1秒），现在字节跳动的Trae也支持了Skills的编写调用，笔者日后也会分享Trae Skills调用的相关文章，大家敬请期待~</p>
<p>除大模型训练指南专栏外，笔者也在同步更新<a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>免费专栏，要说明该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 37 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比]]></title>    <link>https://juejin.cn/post/7599268297223028746</link>    <guid>https://juejin.cn/post/7599268297223028746</guid>    <pubDate>2026-01-26T06:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297223028746" data-draft-id="7599101854645125130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-26T06:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程师之夜系列分享第三十九篇：Kafka、RocketMQ、JMQ 存储架构深度对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T06:37:12.000Z" title="Mon Jan 26 2026 06:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：毕源泉</p>
<h2 data-id="heading-0"><strong>引言</strong></h2>
<p>消息队列的存储架构是决定其可靠性、吞吐量、延迟性能的核心因素，直接影响业务场景适配能力。本文聚焦三款主流消息队列 ——Kafka（LinkedIn 开源，侧重高吞吐）、RocketMQ（阿里开源，金融级特性突出）、JMQ（京东开源，侧重高可用与灵活性），从存储模型、数据组织、索引设计等维度展开深度对比，为技术选型与架构优化提供参考。​</p>
<p>本文将从概念辨析出发，系统拆解主流存储模型与存储引擎的设计逻辑，对比 JMQ、Kafka、RocketMQ的技术选型差异与架构设计。​</p>
<h2 data-id="heading-1"><strong>一、</strong> Kafka存储架构</h2>
<h3 data-id="heading-2">1.1 核心存储模型：分区日志流</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7cfa3ce57c042bbb8129399b1c864f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=PnjsUDbTp9cMbaspiT5bEMbyEj8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>Topic - 主题</strong></p>
<p>Kafka学习了数据库里面的设计，在里面设计了topic（主题），这个东西类似于关系型数据库的表，此时我需要获取中国移动的数据，那就直接监听中国移动订阅的Topic即可。</p>
<p><strong>Partition - 分区</strong></p>
<p>Kafka还有一个概念叫Partition（分区），分区具体在服务器上面表现起初就是一个目录，一个主题下面有多个分区，这些分区会存储到不同的服务器上面，或者说，其实就是在不同的主机上建了不同的目录。这些分区主要的信息就存在了.log文件里面。跟数据库里面的分区差不多，是为了提高性能。</p>
<p>至于为什么提高了性能，很简单，多个分区多个线程，多个线程并行处理肯定会比单线程好得多。</p>
<p>Topic和partition像是HBASE里的table和region的概念，table只是一个逻辑上的概念，真正存储数据的是region，这些region会分布式地存储在各个服务器上面，对应于kafka，也是一样，<strong>Topic也是逻辑概念，而partition就是分布式存储单元。这个设计是保证了海量数据处理的基础。我们可以对比一下，如果HDFS没有block的设计，一个100T的文件也只能单独放在一个服务器上面，那就直接占满整个服务器了，引入block后，大文件可以分散存储在不同的服务器上。</strong></p>
<p><strong>注意：</strong></p>
<p>1.分区会有单点故障问题，所以我们会为每个分区设置副本数</p>
<p>2.分区的编号是从0开始的</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/413616a8cb5b49108dc78ee5d83da964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Aak26sRbAylseEE6EPBodreChHk%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>Kafka 以「主题（Topic）- 分区（Partition）」为核心组织数据，每个分区本质是一个 append-only 的日志流，消息按生产顺序追加存储，保证分区内消息有序性。​</p>
<p><strong>优点：</strong> 可以充分利用磁盘顺序读写高性能的特性。存储介质也可以选择廉价的SATA磁盘，这样可以获得更长的数据保留时间、更低的数据存储成本。</p>
<h3 data-id="heading-3">1.2 数据组织：分段日志文件</h3>
<p>•每个分区拆分为多个 Segment 文件（默认 1GB），命名格式为「起始偏移量.log」（如 00000000000000000000.log）​，做这个限制目的是为了方便把.log加载到内存去操作</p>
<p>•配套两类索引文件：.index（偏移量→物理地址映射）、.timeindex（时间戳→偏移量映射）​​</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d505a0f45414658b84cf5dade264132~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=GQr2zCGvvd8SBdDGhx6z2V%2FnNWA%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>这个9936472之类的数字，就是代表了这个日志段文件里包含的起始offset，也就说明这个分区里至少都写入了接近1000万条数据了。</p>
<p>Kafka broker有一个参数，log.segment.bytes，限定了每个日志段文件的大小，最大就是1GB，一个日志段文件满了，就自动开一个新的日志段文件来写入，避免单个文件过大，影响文件的读写性能，这个过程叫做log rolling，正在被写入的那个日志段文件，叫做active log segment。</p>
<h3 data-id="heading-4">1.3 消息读/写过程</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a656ab0cd74097ba3d3659fad7ac82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=tjGdeAzwfIfl6gSq5hI33wKoeOI%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>写消息：</strong></p>
<p>•Index文件写入，Index文件较小，可以直接用mmap进行内存映射，避免频繁的磁盘I/O操作，提高写入性能；由于Index文件是稀疏索引，只需要记录关键位置的偏移量，因此即使使用mmap，写入的开销也相对较低。</p>
<p>•Segment文件写入，Segment文件较大，可以采用普通的写操作（FileChannel.write），由于Segment文件是顺序写入的，并且Kafka会利用操作系统的PageCache（页缓存）机制，写入操作会先写入到内存中，然后由操作系统在后台异步刷新到磁盘，可以进一步提高写入的性能。</p>
<p><strong>读消息：</strong></p>
<p>•Index文件读取，通常使用mmap方式读取，由于Index文件较小，且是稀疏索引，缺页中断的可能性较小。</p>
<p>•Segment文件读取，通常使用sendfile系统调用来实现零拷贝读取和发送，减少数据在用户空间与内核空间之间的拷贝次数，提高数据传输的效率。</p>
<h3 data-id="heading-5">1.4 关键技术</h3>
<p>Kafka 作为高性能的消息中间件，其超高吞吐量的核心秘诀之一就是<strong>深度依赖 PageCache + 顺序 I/O + mmap 内存映射</strong>的组合。</p>
<p>PageCache，中文名称为页高速缓冲存储器。它是将磁盘上的数据加载到内存中，当系统需要访问这些数据时，可以直接从内存中读取，而不必每次都去读取磁盘。这种方式显著减少了磁盘I/O操作，从而提高了系统性能。</p>
<p>mmap（Memory-mapped file）是操作系统提供的一种将<strong>磁盘文件</strong>与<strong>进程虚拟地址空间</strong>建立映射关系的核心技术，本质是让进程通过直接操作内存地址的方式读写文件，无需传统的 read/write 系统调用。核心价值在于<strong>零拷贝</strong>和<strong>内存式文件访问</strong>，尤其适合大文件、高吞吐、随机访问的场景。</p>
<p>将日志段（.log）文件映射到内存，生产者写入时直接写内存（内核异步刷盘），消费者读取时直接从内存读取，实现超高吞吐（Kafka 的 “顺序写 + mmap” 是其高性能核心）；</p>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/198f6af031ef4f60a5d2b0f82dc9494d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Vyw2JODxGRRKZV86%2FZjMpywtpXY%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>零拷贝流程示意图</p>
<p>零拷贝过程：</p>
<p>1.用户进程发起sendfile系统调用，<strong>上下文（切换1）从用户态转向内核态</strong></p>
<p>2.DMA控制器，把数据从硬盘中拷贝到内核缓冲区。</p>
<p>3.CPU将读缓冲区中数据拷贝到socket缓冲区</p>
<p>4.DMA控制器，异步把数据从socket缓冲区拷贝到网卡，</p>
<p>5.<strong>上下文（切换2）从内核态切换回用户态</strong>，sendfile调用返回。</p>
<h3 data-id="heading-6">1.5 设计优势</h3>
<p>•顺序写磁盘：Segment 文件仅追加写入，规避随机 IO，吞吐量极高（单分区可达 10 万 + TPS）​​</p>
<p>•索引轻量化：仅维护偏移量与时间戳索引，降低存储开销​</p>
<p>•副本同步：基于 ISR 机制，仅同步已提交消息，兼顾一致性与可用性</p>
<h2 data-id="heading-7">二、RocketMQ存储架构</h2>
<p>Kafka的每个Partition都是一个完整的、顺序写入的文件，但当Partition数量增多时，从操作系统的角度看，这些写入操作会变得相对随机，这可能会影响写入性能。</p>
<h3 data-id="heading-8">2.1 核心存储模型：分离式设计</h3>
<p>RocketMQ采用「CommitLog + ConsumeQueue + IndexFile」三层结构，彻底分离数据存储与索引查询：​</p>
<p>•CommitLog：全局单一日志文件（默认 1GB / 个，循环覆盖），存储所有主题的原始消息​​</p>
<p>•ConsumeQueue：按主题 - 队列维度拆分的索引文件，存储「消息物理地址 + 偏移量 + 长度」，供消费者快速查询​</p>
<p>•IndexFile：哈希索引文件，支持按消息 Key 查询</p>
<p>CommitLog：消息的原始日记本</p>
<p><strong>CommitLog</strong>是RocketMQ存储消息的物理文件，所有消息都会按到达顺序写入这个文件。你可以把它想象成一本不断追加的日记本——每条消息都是按时间顺序记录的新日记。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 消息存储的核心逻辑简化示例（非源码）</span>
 public void <span class="hljs-built_in">putMessage</span>(Message message) {
     <span class="hljs-comment">// 1. 将消息序列化为字节数组</span>
     byte<span class="hljs-selector-attr">[]</span> data = <span class="hljs-built_in">serialize</span>(message);
     <span class="hljs-comment">// 2. 计算消息物理偏移量</span>
     long offset = commitLog<span class="hljs-selector-class">.getMaxOffset</span>();
     <span class="hljs-comment">// 3. 将数据追加到CommitLog文件末尾</span>
     commitLog<span class="hljs-selector-class">.append</span>(data);
     <span class="hljs-comment">// 4. 返回消息的全局唯一物理偏移量</span>
     return offset;
}
</code></pre>
<p>消息写入CommitLog时有三个关键特性：</p>
<p>1.<strong>顺序写入</strong>：所有消息按到达顺序追加到文件末尾，避免磁盘随机寻址</p>
<p>2.<strong>内存映射</strong>：通过MappedByteBuffer实现文件映射，减少数据拷贝次数</p>
<p>3.<strong>文件分割</strong>：单个CommitLog文件默认1GB，写满后创建新文件（文件名用起始偏移量命名）</p>
<p>举个例子，当生产者发送三条消息时，CommitLog文件可能长这样：</p>
<pre><code class="hljs language-ini" lang="ini">0000000000000000000（文件1，1GB）  
2|--消息A(<span class="hljs-attr">offset</span>=<span class="hljs-number">0</span>)  
3|--消息B(<span class="hljs-attr">offset</span>=<span class="hljs-number">100</span>)  
4|--消息C(<span class="hljs-attr">offset</span>=<span class="hljs-number">200</span>)  
500000000001073741824（文件2，起始偏移量1073741824）  
</code></pre>
<p><strong>温馨提示</strong>：虽然CommitLog是顺序写，但读取时需要配合索引结构，否则遍历文件找消息就像大海捞针。</p>
<p>消费队列ConsumeQueue：消息的快速目录</p>
<p>如果每次消费都要扫描CommitLog，性能会惨不忍睹。于是RocketMQ设计了<strong>ConsumeQueue</strong>——它是基于Topic和Queue的二级索引文件。</p>
<p>每个ConsumeQueue条目包含三个关键信息（固定20字节）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1</span>| CommitLog <span class="hljs-title function_">Offset</span> <span class="hljs-params">(<span class="hljs-number">8</span>字节)</span> | Message <span class="hljs-title function_">Size</span> <span class="hljs-params">(<span class="hljs-number">4</span>字节)</span> | Tag <span class="hljs-title function_">Hashcode</span> <span class="hljs-params">(<span class="hljs-number">8</span>字节)</span> |  
</code></pre>
<p>这相当于给CommitLog里的消息做了一个目录：</p>
<pre><code class="hljs language-lua" lang="lua">TopicA-Queue0的ConsumeQueue  
<span class="hljs-number">2</span>|<span class="hljs-comment">--0（对应CommitLog偏移0的消息A）  </span>
<span class="hljs-number">3</span>|<span class="hljs-comment">--100（对应CommitLog偏移100的消息B）  </span>
<span class="hljs-number">4</span>|<span class="hljs-comment">--200（对应CommitLog偏移200的消息C）</span>
</code></pre>
<p>当消费者拉取TopicA-Queue0的消息时：</p>
<p>1.先查ConsumeQueue获取消息的物理位置</p>
<p>2.根据CommitLog Offset直接定位到CommitLog文件</p>
<p>3.读取指定位置的消息内容</p>
<p><strong>关键设计点</strong>：</p>
<p>•ConsumeQueue采用内存映射+异步刷盘，保证高性能</p>
<p>•单个文件存储30万条索引，约5.72MB（30万*20字节）</p>
<p>•通过hashCode快速过滤Tag，实现消息过滤</p>
<p>索引文件IndexFile：消息的全局字典</p>
<p>如果需要根据MessageID或Key查询消息，ConsumeQueue就不够用了。这时候就要用到<strong>IndexFile</strong>这个全局索引。</p>
<p>IndexFile的结构类似HashMap：</p>
<p>1.<strong>Slot槽位</strong>（500万个）：存储相同hash值的Index条目链表头</p>
<p>2.<strong>Index条目</strong>（2000万条）：包含Key的hash值、CommitLog偏移量、时间差等信息</p>
<p>当写入消息时：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 索引构建过程简化示意</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">buildIndex</span><span class="hljs-params">(Message message)</span> </span>{
    <span class="hljs-comment">// 计算Key的hash值</span>
    <span class="hljs-type">int</span> hash = <span class="hljs-built_in">hash</span>(message.<span class="hljs-built_in">getKey</span>());
    <span class="hljs-comment">// 定位到对应的Slot槽位</span>
    <span class="hljs-type">int</span> slotPos = hash % slotNum;
    <span class="hljs-comment">// 在Index区域追加新条目</span>
    indexFile.<span class="hljs-built_in">addEntry</span>(hash, message.<span class="hljs-built_in">getCommitLogOffset</span>());
}
</code></pre>
<p>查询时通过两次查找快速定位：</p>
<p>1.根据Key的hash值找到Slot槽位</p>
<p>2.遍历Slot对应的链表，比对CommitLog中的实际Key值</p>
<p><strong>性能优化必知</strong>：</p>
<p>•消息体积差异大时，CommitLog仍然保持顺序写，但ConsumeQueue可能出现「稀疏索引」（相邻索引指向的物理位置间隔大）</p>
<p>•生产环境中CommitLog建议放在单独SSD磁盘，ConsumeQueue和IndexFile可放普通磁盘</p>
<p>•遇到消息堆积时，优先检查消费者速度，而不是无脑扩容Broker存储</p>
<p>理解这些底层机制，下次遇到消息查询性能问题或者磁盘IO瓶颈时，就知道该从CommitLog的写入模式还是ConsumeQueue的索引结构入手排查了。</p>
<h3 data-id="heading-9">2.2 数据流转机制</h3>
<p>•生产者写入 CommitLog，生成全局唯一偏移量（PHYOFFSET）​</p>
<p>•后台线程异步构建 ConsumeQueue 索引，同步消息元数据​</p>
<p>•消费者通过 ConsumeQueue 定位 CommitLog 中的消息，避免全量扫描</p>
<p>存储过程全景图</p>
<p>现在把各个模块串起来看消息的生命周期：</p>
<p>1.生产者发送消息到Broker</p>
<p>2.Broker将消息<strong>顺序写入CommitLog</strong></p>
<p>3.<strong>异步线程</strong>同时构建ConsumeQueue和IndexFile</p>
<p>4.消费者通过ConsumeQueue快速定位消息</p>
<p>5.按需查询IndexFile实现消息回溯</p>
<p>整个过程就像图书馆的管理系统：</p>
<p>•CommitLog是藏书库（按入库时间摆放）</p>
<p>•ConsumeQueue是分类目录（按题材/出版社分类）</p>
<p>•IndexFile是检索电脑（支持按书名/作者查询）</p>
<h3 data-id="heading-10">2.4 设计优势</h3>
<p>•读写分离：CommitLog 仅负责写入，ConsumeQueue 负责查询，提升并发性能​</p>
<p>•事务支持：通过 CommitLog 中的事务状态标记 + 回查机制，实现分布式事务消息​</p>
<p>•刷盘策略：支持「异步刷盘（高吞吐）」「同步刷盘（金融级可靠性）」动态切换</p>
<h2 data-id="heading-11">三、JMQ存储架构</h2>
<p>JMQ的消息存储分别参考了Kafka和RocketMQ存储设计上优点，并根据京东内部的应用场景进行了改进和创新。</p>
<h3 data-id="heading-12">3.1 核心存储模型：分区日志 + 队列兼容</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a21373cfdec641a1a018091772364676~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=y1zpUofNrEQ29l88DvaPjAVhtyM%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>JMQ</strong>存储的基本单元是PartitionGroup。在同一个Broker上，每个PartitionGroup对应一组消息文件（Journal Files），顺序存放这个Topic的消息。</p>
<p>与Kafka类似，每个Topic包含若干Partition，每个Partition对应一组索引文件（Index Files），索引中存放消息在消息文件中的位置和消息长度。消息写入时，收到的消息按照对应的PartitionGroup写入依次追加写入消息文件中，然后异步创建索引并写入对应Partition的索引文件中。</p>
<p>以PartionGroup为基本存储单元的设计，在兼顾灵活性的同时，具有较好的性能，并且单个PartitionGroup可以支持更多的并发。</p>
<h3 data-id="heading-13">3.2 消息读/写过程</h3>
<p>﻿</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d132fb626919447fab474b3af46736ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770014231&amp;x-signature=Zge44lNTYY1PMz17o%2F%2FqySdyaRQ%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><strong>写消息：</strong></p>
<p>JMQ的写操作使用DirectBuffer作为缓存，数据先写入DirectBuffer，再异步通过FileChannel写入到文件中。</p>
<p>•消息写入DirectBuffer后，默认写入该节点成功（数据的高可靠是通过Raft协议复制，用多个内存副本来保证），相对Kafka的写操作来看，JMQ响应写入请求的处理过程没有发生系统调用，在京东内部的大量单条同步发送的场景下开销更低、性能更优。</p>
<p>•同时也避免使用MappedByteBuffer（Mmap方式）产生Page Fault中断，OS在中断中将该页对应磁盘中的数据拷贝到内存中，在对文件进行追加写入的情况下，这一无法避免的过程是完全没有必要，反而增加了写入的耗时的问题。</p>
<p><strong>读消息：</strong></p>
<p>JMQ采用定长稠密索引设计，每个索引固定长度。</p>
<p>•定长设计的好处是，直接根据索引序号就可以计算出索引在文件中的位置：索引位置 = 索引序号 * 索引长度。这样，消息的查找过程就比较简单了，首先计算出索引所在的位置，直接读取索引，然后根据索引中记录的消息位置读取消息。</p>
<p>•在京东内部应用场景中，单条消息处理耗时高是比较常见的，微服务架构下用户一般会申请更多的消费节点，让每个消费节点单次拉取较小批量的消息进行处理，以提升消费并行度，这样消费拉取请求的次数会比较多，稠密索引的设计会更适用内部的应用场景。</p>
<p>JMQ消费读操作99%以上都能命中缓存（JMQ设计的堆外内存与文件映射的一种缓存机制），避免了Kafka可能遇到的Cache被污染，影响性能和吞吐的问题。同时直接读内存也规避了RocketMQ在读取消息存储的日志数据文件时容易产生较多的随机访问读取磁盘，影响性能的问题。（当没有命中缓存时，会默认降级为通过Mmap的方式读取消息）。</p>
<h2 data-id="heading-14">四、竞品对比分析</h2>













































<table><thead><tr><th>﻿</th><th><strong>JMQ</strong></th><th><strong>Kafka</strong></th></tr></thead><tbody><tr><td><strong>存储模型</strong></td><td>以<strong>PartitionGroup</strong>为基本存储单元，支持高并发写入</td><td>以<strong>Partition</strong>为基本存储单元，支持灵活的数据复制和迁移</td></tr><tr><td><strong>消息写入性能</strong></td><td>- 单副本异步写入性能与 Kafka 相当 - 三副本异步写入性能优于 Kafka</td><td>- 单副本异步写入性能与 JMQ 相当 - 三副本异步写入性能略低于 JMQ</td></tr><tr><td><strong>同步写入性能</strong></td><td>- 同步写入性能稳定，几乎不受网络延迟影响</td><td>- 同步写入性能受网络延迟影响较大，稳定性略逊于 JMQ</td></tr><tr><td><strong>多分区性能</strong></td><td>- 多分区异步写入性能与 Kafka 相当 - 同步写入性能略低于 Kafka</td><td>- 多分区同步写入性能更稳定，适合高并发场景</td></tr><tr><td><strong>副本机制</strong></td><td>支持异步复制，副本间数据同步性能较好</td><td>支持异步和同步复制，副本机制成熟，适合复杂部署</td></tr><tr><td><strong>跨机房部署</strong></td><td>- 同步写入性能基本不受影响 - 异步写入性能下降</td><td>- 同步写入性能受网络延迟影响较大 - 异步写入性能下降</td></tr><tr><td><strong>适用场景</strong></td><td>- 对同步写入性能要求高 - 副本异步吞吐要求高 - 大规模微服务集群</td><td>- 复杂分区的高并发同步写入 - 大规模分布式系统 - 多语言生态支持丰富</td></tr></tbody></table>
<p>在单副本场景下，JMQ与Kafka的单机写入性能均十分出色，均可达到网络带宽上限。</p>
<p>然而，在更贴近生产环境的三副本场景中，两者特性出现分化：</p>
<p><strong>JMQ在三副本异步写入下的极限吞吐优势明显，且在跨机房部署时，其同步写入性能表现良好，几乎不受网络延迟影响；而Kafka则在多分区同步写入场景下展现出更稳定的性能，衰减小于JMQ。在大部分异步吞吐场景及不同消息体下的性能趋势上，两者表现相当。</strong></p>
<p>综上所述，JMQ尤其适合对同步写入性能和副本异步吞吐有极高要求的场景，而Kafka在复杂分区的高并发同步写入方面适应性更广。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多线程的这9种用途，99%的人不知道！]]></title>    <link>https://juejin.cn/post/7598830215259799588</link>    <guid>https://juejin.cn/post/7598830215259799588</guid>    <pubDate>2026-01-26T03:55:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215259799588" data-draft-id="7598830215259766820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多线程的这9种用途，99%的人不知道！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T03:55:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多线程的这9种用途，99%的人不知道！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:55:06.000Z" title="Mon Jan 26 2026 03:55:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>并发编程是一项非常重要的技术，无论在面试，还是工作中出现的频率非常高。</p>
<p>之前我发表的一篇《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，在全网广受好评。说明了这类文章还是比较有价值的，接下来，打算继续聊聊并发编程这个话题。</p>
<p>并发编程说白了就是多线程编程，但多线程一定比单线程效率更高？</p>
<p>答：不一定，要看具体业务场景。</p>
<p>毕竟如果使用了多线程，那么线程之间的竞争和抢占cpu资源，线程的上下文切换，也是相对来说比较耗时的操作。</p>
<p>下面这几个问题在面试中，你必定遇到过：</p>
<ol>
<li>你在哪来业务场景中使用过多线程？</li>
<li>怎么用的？</li>
<li>踩过哪些坑？</li>
</ol>
<p>今天聊聊我之前在项目中用并发编程的12种业务场景，给有需要的朋友一个参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c1cdd0696df47feb415bb55e04c26fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=AX22MWpmhHkaa4S1zqLEkUSOTVI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">1. 简单定时任务</h2>
<p>各位亲爱的朋友，你没看错，<code>Thread</code>类真的能做定时任务。如果你看过一些<code>定时任务框架</code>的源码，你最后会发现，它们的底层也会使用Thread类。</p>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"下载文件"</span>);
                Thread.sleep(<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">5</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(e);
            }
        }
    }).start();
}
</code></pre>
<p>使用Thread类可以做最简单的定时任务，在run方法中有个while的死循环（当然还有其他方式），执行我们自己的任务。有个需要特别注意的地方是，需要用<code>try...catch</code>捕获异常，否则如果出现异常，就直接退出循环，下次将无法继续执行了。</p>
<p>但这种方式做的定时任务，只能周期性执行，不能支持定时在某个时间点执行。</p>
<p>特别提醒一下，该线程建议定义成<code>守护线程</code>，可以通过<code>setDaemon</code>方法设置，让它在后台默默执行就好。</p>
<p>使用场景：比如项目中有时需要每隔5分钟去<code>下载某个文件</code>，或者每隔10分钟去读取模板文件<code>生成静态html页面</code>等等，一些简单的周期性任务场景。</p>
<p>使用<code>Thread</code>类做定时任务的优缺点：</p>
<ul>
<li>
<p>优点：这种定时任务非常简单，学习成本低，容易入手，对于那些简单的周期性任务，是个不错的选择。</p>
</li>
<li>
<p>缺点：不支持指定某个时间点执行任务，不支持延迟执行等操作，功能过于单一，无法应对一些较为复杂的场景。</p>
</li>
</ul>
<h2 data-id="heading-2">2.监听器</h2>
<p>有时候，我们需要写个监听器，去监听某些数据的变化。</p>
<p>比如：我们在使用<code>canal</code>的时候，需要监听<code>binlog</code>的变化，能够及时把数据库中的数据，同步到另外一个业务数据库中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/affe454823004309bd1f1dbe03a9554b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=EXteLiBSOsZaDIQQK6wQ8MkAH94%3D" alt="" loading="lazy"/>
如果直接写一个监听器去监听数据就太没意思了，我们想实现这样一个功能：在配置中心有个开关，配置监听器是否开启，如果开启了使用单线程异步执行。</p>
<p>主要代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> CanalService {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> Thread thread;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalConnector canalConnector;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">//连接canal</span>
        <span class="hljs-keyword">while</span>(running) {
           <span class="hljs-comment">//业务处理</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
       thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-built_in">this</span>::handle, <span class="hljs-string">"name"</span>);
       running = <span class="hljs-literal">true</span>;
       thread.start();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
       <span class="hljs-keyword">if</span>(!running) {
          <span class="hljs-keyword">return</span>;
       }
       running = <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<p>在start方法中开启了一个线程，在该线程中异步执行handle方法的具体任务。然后通过调用stop方法，可以停止该线程。</p>
<p>其中，使用<code>volatile</code>关键字控制的running变量作为开关，它可以控制线程中的状态。</p>
<p>接下来，有个比较关键的点是：如何通过配置中心的配置，控制这个开关呢？</p>
<p>以<code>apollo</code>配置为例，我们在配置中心的后台，修改配置之后，自动获取最新配置的核心代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanalConfig</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalService canalService;

    <span class="hljs-meta">@ApolloConfigChangeListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(ConfigChangeEvent event)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> event.getChange(<span class="hljs-string">"test.canal.enable"</span>).getNewValue();
        <span class="hljs-keyword">if</span>(BooleanUtils.toBoolean(value)) {
            canalService.start();
        } <span class="hljs-keyword">else</span> {
            canalService.stop();
        }
    }
}
</code></pre>
<p>通过<code>apollo</code>的<code>ApolloConfigChangeListener</code>注解，可以监听配置参数的变化。</p>
<p>如果<code>test.canal.enable</code>开关配置的true，则调用canalService类的start方法开启canal数据同步功能。如果开关配置的false，则调用canalService类的stop方法，自动停止canal数据同步功能。</p>
<h2 data-id="heading-3">3.收集日志</h2>
<p>在某些高并发的场景中，我们需要收集部分用户的日志（比如：用户登录的日志），写到数据库中，以便于做分析。</p>
<p>但由于项目中，还没有引入消息中间件，比如：<code>kafka</code>、<code>rocketmq</code>等。</p>
<p>如果直接将日志同步写入数据库，可能会影响接口性能。</p>
<p>所以，大家很自然想到了异步处理。</p>
<p>实现这个需求最简单的做法是，开启一个线程，异步写入数据到数据库即可。</p>
<p>这样做，可以是可以。</p>
<p>但如果用户登录操作的耗时，比异步写入数据库的时间要少得多。这样导致的结果是：生产日志的速度，比消费日志的速度要快得多，最终的性能瓶颈在消费端。</p>
<p>其实，还有更优雅的处理方式，虽说没有使用消息中间件，但借用了它的思想。</p>
<p>这套记录登录日志的功能，分为：日志生产端、日志存储端和日志消费端。</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d39d5d0bdd84f22ac94821a4c7f3dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=2MIfQwu%2FLeEcPguNAUjA8AQwuhw%3D" alt="" loading="lazy"/></p>
<p>先定义了一个阻塞队列。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginLogQueue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_MAX_SIZE</span>    <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-type">BlockingQueueblockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_MAX_SIZE);

    <span class="hljs-comment">//生成消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">push</span><span class="hljs-params">(LoginLog loginLog)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.queue.add(loginLog);
    } 

    <span class="hljs-comment">//消费消息</span>
    <span class="hljs-keyword">public</span> LoginLog <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            loginLog = <span class="hljs-built_in">this</span>.queue.take();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>然后定义了一个日志的生产者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginSerivce</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue loginLogQueue;

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">login</span><span class="hljs-params">(UserInfo userInfo)</span> {
        <span class="hljs-comment">//业务处理</span>
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> convert(userInfo);
        loginLogQueue.push(loginLog);
    }  
}
</code></pre>
<p>接下来，定义了日志的消费者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInfoConsumer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue queue;

    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> voit init {
       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
          <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
              <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> queue.take();
              <span class="hljs-comment">//写入数据库</span>
          }
        }).start();
    }
}
</code></pre>
<p>当然，这个例子中使用单线程接收登录日志，为了提升性能，也可以使用线程池来处理业务逻辑（比如：写入数据库）等。</p>
<h2 data-id="heading-4">4.excel导入</h2>
<p>我们可能会经常收到运营同学提过来的excel数据导入需求，比如：将某一大类下的所有子类一次性导入系统，或者导入一批新的供应商数据等等。</p>
<p>我们以导入供应商数据为例，它所涉及的业务流程很长，比如：</p>
<ol>
<li>调用天眼查接口校验企业名称和统一社会信用代码。</li>
<li>写入供应商基本表</li>
<li>写入组织表</li>
<li>给供应商自动创建一个用户</li>
<li>给该用户分配权限</li>
<li>自定义域名</li>
<li>发站内通知</li>
</ol>
<p>等等。</p>
<p>如果在程序中，解析完excel，读取了所有数据之后。用单线程一条条处理业务逻辑，可能耗时会非常长。</p>
<p>为了提升excel数据导入效率，非常有必要使用多线程来处理。</p>
<p>当然在java中实现多线程的手段有很多种，下面重点聊聊java8中最简单的实现方式：<code>parallelStream</code>。</p>
<p>伪代码如下：</p>
<pre><code class="hljs language-java" lang="java">supplierList.parallelStream().forEach(x -&gt; importSupplier(x));
</code></pre>
<p><code>parallelStream</code>是一个并行执行的流，它默认通过<code>ForkJoinPool</code>实现的，能提高你的多线程任务的速度。</p>
<p><code>ForkJoinPool</code>处理的过程会分而治之，它的核心思想是：<code>将一个大任务切分成多个小任务</code>。每个小任务都能单独执行，最后它会把所用任务的执行结果进行汇总。</p>
<p>下面用一张图简单介绍一下ForkJoinPool的原理：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49631443b7274584a83313137ae2e2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=CuRx6HVWAQ%2FvsDml1HdJam2pssk%3D" alt="" loading="lazy"/></p>
<p>当然除了excel导入之外，还有类似的读取文本文件，也可以用类似的方法处理。</p>
<blockquote>
<p>温馨的提醒一下，如果一次性导入的数据非常多，用多线程处理，可能会使系统的cpu使用率飙升，需要特别关注。</p>
</blockquote>
<h2 data-id="heading-5">5.查询接口</h2>
<p>很多时候，我们需要在某个查询接口中，调用其他服务的接口，组合数据之后，一起返回。</p>
<p>比如有这样的业务场景：</p>
<p>在用户信息查询接口中需要返回：用户名称、性别、等级、头像、积分、成长值等信息。</p>
<p>而用户名称、性别、等级、头像在用户服务中，积分在积分服务中，成长值在成长值服务中。为了汇总这些数据统一返回，需要另外提供一个对外接口服务。</p>
<p>于是，用户信息查询接口需要调用用户查询接口、积分查询接口 和 成长值查询接口，然后汇总数据统一返回。</p>
<p>调用过程如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93aa59a74685455d910fc6962f8bdebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=fn66NGI9o5afFQLpZ01x%2FXUUb4w%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 530ms = 200ms + 150ms + 180ms</p>
<p>显然这种串行调用远程接口性能是非常不好的，调用远程接口总的耗时为所有的远程接口耗时之和。</p>
<p>那么如何优化远程接口性能呢？</p>
<p>既然串行调用多个远程接口性能很差，为什么不改成并行呢？</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3ef20c3e04cf98491af9f56fccd28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=RA%2BTjzT%2B%2B0M16pTzvadZicSwHSg%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 200ms = 200ms（即耗时最长的那次远程接口调用）</p>
<p>在java8之前可以通过实现<code>Callable</code>接口，获取线程返回结果。</p>
<p>java8以后通过<code>CompleteFuture</code>类实现该功能。我们这里以CompleteFuture为例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> UserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
    <span class="hljs-keyword">final</span> <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">userFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteUserAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">bonusFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteBonusAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">growthFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteGrowthAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);
    CompletableFuture.allOf(userFuture, bonusFuture, growthFuture).join();

    userFuture.get();
    bonusFuture.get();
    growthFuture.get();
    <span class="hljs-keyword">return</span> userInfo;
}
</code></pre>
<p>温馨提醒一下，这两种方式别忘了使用<code>线程池</code>。示例中我用到了<code>executor</code>，表示自定义的线程池，为了防止高并发场景下，出现线程过多的问题。</p>
<h2 data-id="heading-6">6.获取用户上下文</h2>
<p>不知道你在项目开发时，有没有遇到过这样的需求：用户登录之后，在所有的请求接口中，通过某个公共方法，就能获取到当前登录用户的信息？</p>
<p>获取的用户上下文，我们以<code>CurrentUser</code>为例。</p>
<p><code>CurrentUser</code>内部包含了一个<code>ThreadLocal</code>对象，它负责保存当前线程的用户上下文信息。当然为了保证在线程池中，也能从用户上下文中获取到正确的用户信息，这里用了阿里的<code>TransmittableThreadLocal</code>。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUser</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;CurrentUser&gt; THREA_LOCAL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String phone;
    ...
    
    <span class="hljs-keyword">public</span> statis <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(CurrentUser user)</span> {
      THREA_LOCAL.set(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getCurrent</span><span class="hljs-params">()</span> {
      <span class="hljs-keyword">return</span> THREA_LOCAL.get();
    }
}
</code></pre>
<p>这里为什么用了阿里的TransmittableThreadLocal，而不是普通的ThreadLocal呢？在线程池中，由于线程会被多次复用，导致从普通的ThreadLocal中无法获取正确的用户信息。父线程中的参数，没法传递给子线程，而TransmittableThreadLocal很好解决了这个问题。</p>
<p>然后在项目中定义一个全局的spring mvc拦截器，专门设置用户上下文到ThreadLocal中。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptorAdapter</span> {
   
   <span class="hljs-meta">@Override</span>  
   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
      <span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getUser(request);
      <span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
         CurrentUser.set(user);
      }
   } 
}
</code></pre>
<p>用户在请求我们接口时，会先触发该拦截器，它会根据用户cookie中的token，调用调用接口获取redis中的用户信息。如果能获取到，说明用户已经登录，则把用户信息设置到CurrentUser类的ThreadLocal中。</p>
<p>接下来，在api服务的下层，即business层的方法中，就能轻松通过CurrentUser.getCurrent();方法获取到想要的用户上下文信息了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/716f8f50a1534db785a2eba41e4c6c7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=S5WovHiVYbFMen3cheAMaJqlg34%3D" alt="" loading="lazy"/></p>
<p>这套用户体系的想法是很good的，但深入使用后，发现了一个小插曲：</p>
<p>api服务和mq消费者服务都引用了business层，business层中的方法两个服务都能直接调用。</p>
<p>我们都知道在api服务中用户是需要登录的，而mq消费者服务则不需要登录。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44e766b9bfed43ae8af0be092bc68b08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=TyvbIs6k9SghVb969pPlwFCzLS4%3D" alt="" loading="lazy"/></p>
<p>如果business中的某个方法刚开始是给api开发的，在方法深处使用了CurrentUser.getCurrent();获取用户上下文。但后来，某位新来的帅哥在mq消费者中也调用了那个方法，并未发觉这个小机关，就会中招，出现找不到用户上下文的问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcfc398c332429b8cc072d2c57038e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=Tqbw%2Fwb6NDWB2uzo19h1BEHljiE%3D" alt="" loading="lazy"/></p>
<p>所以我当时的第一个想法是：代码没做兼容处理，因为之前这类问题偶尔会发生一次。</p>
<p>想要解决这个问题，其实也很简单。只需先判断一下能否从CurrentUser中获取用户信息，如果不能，则取配置的系统用户信息。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> BusinessConfig businessConfig;

<span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> CurrentUser.getCurrent();
<span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
   entity.setUserId(user.getUserId());
   entity.setUserName(user.getUserName());
} <span class="hljs-keyword">else</span> {
   entity.setUserId(businessConfig.getDefaultUserId());
   entity.setUserName(businessConfig.getDefaultUserName());
}
</code></pre>
<p>这种简单无公害的代码，如果只是在一两个地方加还OK。</p>
<p>此外，众所周知，<code>SimpleDateFormat</code>在java8以前，是用来处理时间的工具类，它是非线程安全的。也就是说，用该方法解析日期会有线程安全问题。</p>
<p>为了避免线程安全问题的出现，我们可以把SimpleDateFormat对象定义成<code>局部变量</code>。但如果你一定要把它定义成静态变量，可以使用ThreadLocal保存日期，也能解决线程安全问题。</p>
<h2 data-id="heading-7">8. 传递参数</h2>
<p>之前见过有些同事写代码时，一个非常有趣的用法，即：使用<code>MDC</code>传递参数。</p>
<p>MDC是什么？</p>
<p><code>MDC</code>是<code>org.slf4j</code>包下的一个类，它的全称是<code>Mapped Diagnostic Context</code>，我们可以认为它是一个线程安全的存放诊断日志的容器。</p>
<p><code>MDC</code>的底层是用了<code>ThreadLocal</code>来保存数据的。</p>
<p>例如现在有这样一种场景：我们使用<code>RestTemplate</code>调用远程接口时，有时需要在<code>header</code>中传递信息，比如：traceId，source等，便于在查询日志时能够串联一次完整的请求链路，快速定位问题。</p>
<p>这种业务场景就能通过<code>ClientHttpRequestInterceptor</code>接口实现，具体做法如下：</p>
<p>第一步，定义一个LogFilter拦截所有接口请求，在MDC中设置traceId：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException {
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException {
        MdcUtil.add(UUID.randomUUID().toString());
        System.out.println(<span class="hljs-string">"记录请求日志"</span>);
        chain.doFilter(request, response);
        System.out.println(<span class="hljs-string">"记录响应日志"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
    }
}
</code></pre>
<p>第二步，实现<code>ClientHttpRequestInterceptor</code>接口，MDC中获取当前请求的traceId，然后设置到header中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClientHttpRequestInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title function_">intercept</span><span class="hljs-params">(HttpRequest request, <span class="hljs-type">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="hljs-keyword">throws</span> IOException {
        request.getHeaders().set(<span class="hljs-string">"traceId"</span>, MdcUtil.get());
        <span class="hljs-keyword">return</span> execution.execute(request, body);
    }
}
</code></pre>
<p>第三步，定义配置类，配置上面定义的RestTemplateInterceptor类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateConfiguration</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        restTemplate.setInterceptors(Collections.singletonList(restTemplateInterceptor()));
        <span class="hljs-keyword">return</span> restTemplate;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplateInterceptor <span class="hljs-title function_">restTemplateInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplateInterceptor</span>();
    }
}
</code></pre>
<p>其中MdcUtil其实是利用MDC工具在<code>ThreadLocal</code>中存储和获取traceId</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MdcUtil</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TRACE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"TRACE_ID"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> MDC.get(TRACE_ID);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String value)</span> {
        MDC.put(TRACE_ID, value);
    }
}
</code></pre>
<p>当然，这个例子中没有演示MdcUtil类的add方法具体调的地方，我们可以在<code>filter</code>中执行接口方法之前，生成traceId，调用MdcUtil类的add方法添加到MDC中，然后在同一个请求的其他地方就能通过MdcUtil类的get方法获取到该traceId。</p>
<p>能使用MDC保存traceId等参数的根本原因是，用户请求到应用服务器，<code>Tomcat</code>会从线程池中分配一个线程去处理该请求。</p>
<p>那么该请求的整个过程中，保存到<code>MDC</code>的<code>ThreadLocal</code>中的参数，也是该线程独享的，所以不会有线程安全问题。</p>
<h2 data-id="heading-8">9. 模拟高并发</h2>
<p>有时候我们写的接口，在低并发的场景下，一点问题都没有。</p>
<p>但如果一旦出现高并发调用，该接口可能会出现一些意想不到的问题。</p>
<p>为了防止类似的事情发生，一般在项目上线前，我们非常有必要对接口做一下<code>压力测试</code>。</p>
<p>当然，现在已经有比较成熟的压力测试工具，比如：<code>Jmeter</code>、<code>LoadRunner</code>等。</p>
<p>如果你觉得下载压测工具比较麻烦，也可以手写一个简单的模拟并发操作的工具，用<code>CountDownLatch</code>就能实现，例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">concurrenceTest</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">/**
     * 模拟高并发情况代码
     */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicInteger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 相当于计数器，当所有都准备好了，再一起执行，模仿多并发，保证并发量</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 保证所有线程执行完了再打印atomicInteger的值</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            executorService.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    <span class="hljs-keyword">try</span> {
                        countDownLatch.await(); <span class="hljs-comment">//一直阻塞当前线程，直到计时器的值为0,保证同时并发</span>
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        log.error(e.getMessage(),e);
                    }
                    <span class="hljs-comment">//每个线程增加1000次，每次加1</span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                        atomicInteger.incrementAndGet();
                    }
                    countDownLatch2.countDown();
                }
            });
            countDownLatch.countDown();
        }

        countDownLatch2.await();<span class="hljs-comment">// 保证所有线程执行完</span>
        executorService.shutdown();
    } <span class="hljs-keyword">catch</span> (Exception e){
        log.error(e.getMessage(),e);
    }
}
</code></pre>
<h2 data-id="heading-9">10. 处理mq消息</h2>
<p>在高并发的场景中，消息积压问题，可以说如影随形，真的没办法从根本上解决。表面上看，已经解决了，但后面不知道什么时候，就会冒出一次，比如这次：</p>
<p>有天下午，产品过来说：有几个商户投诉过来了，他们说菜品有延迟，快查一下原因。</p>
<p>这次问题出现得有点奇怪。</p>
<p>为什么这么说？</p>
<p>首先这个时间点就有点奇怪，平常出问题，不都是中午或者晚上用餐高峰期吗？怎么这次问题出现在下午？</p>
<p>根据以往积累的经验，我直接看了<code>kafka</code>的<code>topic</code>的数据，果然上面消息有积压，但这次每个<code>partition</code>都积压了十几万的消息没有消费，比以往加压的消息数量增加了几百倍。这次消息积压得极不寻常。</p>
<p>我赶紧查服务监控看看消费者挂了没，还好没挂。又查服务日志没有发现异常。这时我有点迷茫，碰运气问了问订单组下午发生了什么事情没？他们说下午有个促销活动，跑了一个<code>JOB</code>批量更新过有些商户的订单信息。</p>
<p>这时，我一下子如梦初醒，是他们在JOB中批量发消息导致的问题。怎么没有通知我们呢？实在太坑了。</p>
<p>虽说知道问题的原因了，倒是眼前积压的这十几万的消息该如何处理呢？</p>
<p>此时，如果直接调大<code>partition</code>数量是不行的，历史消息已经存储到<code>4</code>个固定的partition，只有新增的消息才会到新的partition。我们重点需要处理的是已有的partition。</p>
<p>直接加服务节点也不行，因为<code>kafka</code>允许同组的多个<code>partition</code>被一个<code>consumer</code>消费，但不允许一个partition被同组的多个consumer消费，可能会造成资源浪费。</p>
<p>看来只有用<code>多线程</code>处理了。</p>
<p>为了紧急解决问题，我改成了用线程池处理消息，核心线程和最大线程数都配置成了<code>50</code>。</p>
<p>大致用法如下：</p>
<ol>
<li>先定义一个线程池：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> {

    <span class="hljs-meta">@Value("${thread.pool.corePoolSize:5}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> corePoolSize;

    <span class="hljs-meta">@Value("${thread.pool.maxPoolSize:10}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxPoolSize;

    <span class="hljs-meta">@Value("${thread.pool.queueCapacity:200}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> queueCapacity;

    <span class="hljs-meta">@Value("${thread.pool.keepAliveSeconds:30}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> keepAliveSeconds;

    <span class="hljs-meta">@Value("${thread.pool.threadNamePrefix:ASYNC_}")</span>
    <span class="hljs-keyword">private</span> String threadNamePrefix;

    <span class="hljs-meta">@Bean("messageExecutor")</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">messageExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(corePoolSize);
        executor.setMaxPoolSize(maxPoolSize);
        executor.setQueueCapacity(queueCapacity);
        executor.setKeepAliveSeconds(keepAliveSeconds);
        executor.setThreadNamePrefix(threadNamePrefix);
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<ol start="2">
<li>再定义一个消息的consumer：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConsumerService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Executor messageExecutor;
    
    <span class="hljs-meta">@KafkaListener(id="test",topics={"topic-test"})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listen</span><span class="hljs-params">(String message)</span>{
        System.out.println(<span class="hljs-string">"收到消息："</span> + message);
        messageExecutor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWork</span>(message);
    }
}
</code></pre>
<ol start="3">
<li>在定义的Runable实现类中处理业务逻辑：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWork</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-keyword">private</span> String message;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyWork</span><span class="hljs-params">(String message)</span> {
       <span class="hljs-built_in">this</span>.message = message;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(message);
    }
}
</code></pre>
<p>果然，调整之后消息积压数量确实下降的非常快，大约半小时后，积压的消息就非常顺利的处理完了。</p>
<p>但此时有个更严重的问题出现：我收到了报警邮件，有两个订单系统的节点down机了。。。</p>
<p>更详细内容，请看看我的另一篇文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247490289%26idx%3D1%26sn%3Dbc311da9f4a4d3f48ee5dc207bf31a8b%26chksm%3Dc0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc%26token%3D751314179%26lang%3Dzh_CN%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247490289&amp;idx=1&amp;sn=bc311da9f4a4d3f48ee5dc207bf31a8b&amp;chksm=c0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc&amp;token=751314179&amp;lang=zh_CN&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">我用kafka两年踩过的一些非比寻常的坑</a>》</p>
<h2 data-id="heading-10">11. 统计数量</h2>
<p>在多线程的场景中，有时候需要统计数量，比如：用多线程导入供应商数据时，统计导入成功的供应商数有多少。</p>
<p>如果这时候用count++统计次数，最终的结果可能会不准。因为count++并非原子操作，如果多个线程同时执行该操作，则统计的次数，可能会出现异常。</p>
<p>为了解决这个问题，就需要使用<code>concurent</code>的<code>atomic</code>包下面的类，比如：<code>AtomicInteger</code>、<code>AtomicLong</code>等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Servcie</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportSupplierService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">importSupplier</span><span class="hljs-params">(List&lt;SupplierInfo&gt; supplierList)</span> {
       <span class="hljs-keyword">if</span>(CollectionUtils.isEmpty(supplierList)) {
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
       }

       supplierList.parallelStream().forEach(x -&gt; {
           <span class="hljs-keyword">try</span> {
             importSupplier(x);
             count.addAndGet(<span class="hljs-number">1</span>);
           } <span class="hljs-keyword">catch</span>(Exception e) {
              log.error(e.getMessage(),e);
           }
       );

      <span class="hljs-keyword">return</span> count.get();
  }    
}
</code></pre>
<p><code>AtomicInteger</code>的底层说白了使用<code>自旋锁</code>+<code>CAS</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> get();
        <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (compareAndSet(current, next))
            <span class="hljs-keyword">return</span> next;
    }
}
</code></pre>
<p><code>自旋锁</code>说白了就是一个<code>死循环</code>。</p>
<p>而<code>CAS</code>是<code>比较</code>和<code>交换</code>的意思。</p>
<p>它的实现逻辑是：将内存位置处的<code>旧值</code>与<code>预期值</code>进行比较，若相等，则将内存位置处的值替换为<code>新值</code>。若不相等，则不做任何操作。</p>
<h2 data-id="heading-11">12. 延迟定时任务</h2>
<p>我们经常有延迟处理数据的需求，比如：如果用户下单后，超过30分钟还未完成支付，则系统自动将该订单取消。</p>
<p>这里需求就可以使用<code>延迟定时任务</code>实现。</p>
<p><code>ScheduledExecutorService</code>是<code>JDK1.5+</code>版本引进的定时任务，该类位于<code>java.util.concurrent</code>并发包下。</p>
<p>ScheduledExecutorService是基于多线程的，设计的初衷是为了解决<code>Timer</code>单线程执行，多个任务之间会互相影响的问题。</p>
<p>它主要包含4个方法：</p>
<ul>
<li>schedule(Runnable command,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕。</li>
<li>schedule(Callable callable,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕，并且可以获取执行结果。</li>
<li>scheduleAtFixedRate，表示以固定频率执行的任务，如果当前任务耗时较多，超过定时周期period，则当前任务结束后会立即执行。</li>
<li>scheduleWithFixedDelay，表示以固定延时执行任务，延时是相对当前任务结束为起点计算开始时间。</li>
</ul>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduleExecutorTest</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledExecutorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">5</span>);
        scheduledExecutorService.scheduleAtFixedRate(() -&gt; {
            System.out.println(<span class="hljs-string">"doSomething"</span>);
        },<span class="hljs-number">1000</span>,<span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<p>调用<code>ScheduledExecutorService</code>类的<code>scheduleAtFixedRate</code>方法实现周期性任务，每隔1秒钟执行一次，每次延迟1秒再执行。</p>
<p>这种定时任务是阿里巴巴开发者规范中用来替代<code>Timer</code>类的方案，对于多线程执行周期性任务，是个不错的选择。</p>
<p>使用<code>ScheduledExecutorService</code>类做延迟定时任务的优缺点：</p>
<ul>
<li>
<p>优点：基于多线程的定时任务，多个任务之间不会相关影响，支持周期性的执行任务，并且带延迟功能。</p>
</li>
<li>
<p>缺点：不支持一些较复杂的定时规则。</p>
</li>
</ul>
<p>当然，你也可以使用分布式定时任务，比如：xxl-job或者elastic-job等等。</p>
<p>其实，在实际工作中我使用多线程的场景远远不只这12种，在这里只是抛砖引玉，介绍了一些我认为比较常见的业务场景。</p>
<p>此外，如果你对并发编程中的一些坑，比较感兴趣的话，可以看看我的另一个文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，里面写的非常详细。</p>
<h2 data-id="heading-12">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：susan.net.cn/project</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[负载均衡实现的算法]]></title>    <link>https://juejin.cn/post/7599550337386004543</link>    <guid>https://juejin.cn/post/7599550337386004543</guid>    <pubDate>2026-01-27T06:53:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599550337386004543" data-draft-id="7599591405313654825" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="负载均衡实现的算法"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-27T06:53:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            负载均衡实现的算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-27T06:53:52.000Z" title="Tue Jan 27 2026 06:53:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-27
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nacos 本身不直接“实现”负载均衡算法，它是服务注册与发现中心，真正的负载均衡由客户端（如 Spring Cloud LoadBalancer / Ribbon / Dubbo / gRPC / Nginx 等）完成。但在微服务体系中，和 Nacos 搭配使用时，常见的负载均衡算法主要有以下几种：</p>
<hr/>
<h2 data-id="heading-0">一、轮询（Round Robin）</h2>
<p><strong>原理：</strong><br/>
按顺序依次调用每个实例。</p>
<p><strong>特点：</strong></p>
<ul>
<li>简单公平</li>
<li>不考虑实例性能差异</li>
</ul>
<p><strong>适用场景：</strong><br/>
实例配置一致、请求耗时相近。</p>
<hr/>
<h2 data-id="heading-1">二、随机（Random）</h2>
<p><strong>原理：</strong><br/>
从实例列表中随机选一个。</p>
<p><strong>特点：</strong></p>
<ul>
<li>实现简单</li>
<li>在实例数量大时分布较均匀</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、加权轮询（Weighted Round Robin）</h2>
<p><strong>原理：</strong><br/>
按权重比例轮询，性能高的机器分配更多请求。</p>
<p><strong>示例：</strong><br/>
A权重5，B权重1 → 6次请求中A拿5次，B拿1次。</p>
<p><strong>适用：</strong><br/>
不同配置机器混用（如4核和16核）。</p>
<hr/>
<h2 data-id="heading-3">四、加权随机（Weighted Random）</h2>
<p><strong>原理：</strong><br/>
按权重概率随机选择。</p>
<hr/>
<h2 data-id="heading-4">五、最少连接数（Least Connections）</h2>
<p><strong>原理：</strong><br/>
优先选择当前连接数最少的实例。</p>
<p><strong>适用：</strong><br/>
长连接、请求耗时差异大的场景。</p>
<hr/>
<h2 data-id="heading-5">六、一致性 Hash（Consistent Hash）</h2>
<p><strong>原理：</strong><br/>
根据请求参数（如 userId）Hash 到固定实例。</p>
<p><strong>特点：</strong></p>
<ul>
<li>同一用户总是打到同一台机器</li>
<li>扩容时影响面小</li>
</ul>
<p><strong>常见用途：</strong></p>
<ul>
<li>会话粘性</li>
<li>缓存命中率优化</li>
</ul>
<hr/>
<h2 data-id="heading-6">七、基于响应时间的负载均衡</h2>
<p><strong>原理：</strong><br/>
优先选择平均响应时间最短的实例。</p>
<hr/>
<h2 data-id="heading-7">八、Nacos 权重感知 + 健康度感知</h2>
<p>Nacos 会给每个实例维护：</p>
<ul>
<li>权重（weight）</li>
<li>健康状态（healthy）</li>
<li>临时实例 / 持久实例</li>
<li>心跳状态</li>
</ul>
<p>客户端负载均衡器通常会：</p>
<ol>
<li>过滤掉不健康实例</li>
<li>按权重参与算法（轮询 / 随机）</li>
<li>支持动态权重调整（运维可在线改）</li>
</ol>
<hr/>
<h2 data-id="heading-8">Spring Cloud Alibaba 中的对应关系</h2>





























<table><thead><tr><th>算法</th><th>实现类</th></tr></thead><tbody><tr><td>轮询</td><td>RoundRobinLoadBalancer</td></tr><tr><td>随机</td><td>RandomLoadBalancer</td></tr><tr><td>权重</td><td>NacosWeightedRule（Ribbon 时代）</td></tr><tr><td>最少连接</td><td>LeastConnections</td></tr><tr><td>一致性Hash</td><td>ConsistentHashRule</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[B 端工业软件图表优化：让十万级设备数据不再拖慢操作]]></title>    <link>https://juejin.cn/post/7598710324168376335</link>    <guid>https://juejin.cn/post/7598710324168376335</guid>    <pubDate>2026-01-26T02:12:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324168376335" data-draft-id="7565043507125026831" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="B 端工业软件图表优化：让十万级设备数据不再拖慢操作"/> <meta itemprop="keywords" content="前端,ECharts,性能优化"/> <meta itemprop="datePublished" content="2026-01-26T02:12:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋天的一阵风"/> <meta itemprop="url" content="https://juejin.cn/user/3588413946594925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            B 端工业软件图表优化：让十万级设备数据不再拖慢操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3588413946594925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋天的一阵风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:12:23.000Z" title="Mon Jan 26 2026 02:12:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p><strong/></p><p align="center"><strong>Hello~大家好。我是秋天的一阵风</strong></p><p/>
<p>在 B 端工业软件开发中，设备参数趋势、能耗分析、质检对比等核心模块均依赖图表可视化，单台设备按 5 秒采集频率，一天数据量即可突破 10 万级。当数据量达到此规模时，传统渲染方式会面临明显性能问题：</p>
<h3 data-id="heading-1">1. 遇到的问题：</h3>
<ul>
<li>图表初始化加载耗时超 1.5 秒，多模块并发打开时更久</li>
</ul>

<ul>
<li>用户交互（拖动时间轴、缩放数据）存在 0.5-0.6 秒延迟</li>
</ul>

<ul>
<li>折线图拖动时出现 “卡顿断连”，影响数据趋势判断</li>
</ul>
<h3 data-id="heading-2">2. 技术挑战：</h3>
<p>如何在保证工业数据趋势完整性（如设备参数波动、异常点捕捉）的前提下，实现 10 万级数据图表的流畅渲染与交互？</p>
<h2 data-id="heading-3">二、解决方案概述</h2>
<p>本文聚焦以下几种 ECharts 适配工业场景的性能优化方案，无需复杂定制开发即可落地：</p>
<ol>
<li>
<p><strong>LTTB 数据降采样（Sampling）</strong> ：智能筛选设备数据中的关键波动点（峰值、谷值、突变点），剔除平稳冗余数据，在不影响趋势判断的前提下，将渲染数据量压缩至原有的 1/25-1/30。</p>
</li>
<li>
<p><strong>DataZoom 区域缩放</strong>：默认只渲染 “最近 24 小时” 等核心时段数据（约 12% 数据量），用户按需缩放时才加载对应时段数据，避免全量渲染浪费资源。</p>
</li>
<li>
<p><strong>large 模式</strong>：ECharts 针对超大数据量（50万级以上）设计的底层渲染优化模式，通过简化绘制逻辑、减少绘制细节来提升渲染效率，适配设备集群海量数据概览场景。</p>
</li>
</ol>
<h2 data-id="heading-4">三、方案详细落地与实测</h2>
<h3 data-id="heading-5">1. 第一招：LTTB 降采样 —— 精准保留工业数据核心趋势</h3>
<p>B 端工业软件对图表的核心需求是 “捕捉设备参数异常波动”，而非展示每一个原始数据点。<code>LTTB（ Largest-Triangle-Three-Bucket ）</code>算法的优势在于，能从 10 万条数据中，优先保留体现趋势变化的 3000-4000 个关键节点（如温度突升点、转速骤降点），剔除数值平稳的冗余数据，既保证工业数据的分析价值，又大幅降低渲染压力。</p>
<h4 data-id="heading-6">核心配置与避坑点：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">series</span>: [{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>, <span class="hljs-comment">// 折线图</span>
  <span class="hljs-attr">data</span>: deviceParamData, <span class="hljs-comment">// 10万条设备原始数据</span>
  <span class="hljs-attr">sampling</span>: <span class="hljs-string">'lttb'</span>, <span class="hljs-comment">// 启用LTTB降采样，优先保留波动点</span>
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'none'</span>, <span class="hljs-comment">// 必加：工业图表无需单个数据点标记，减少DOM渲染</span>
  <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 必关：工业场景需实时响应，动画会增加0.3秒延迟</span>
  <span class="hljs-attr">emphasis</span>: { <span class="hljs-attr">lineStyle</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">2</span> } } <span class="hljs-comment">// 适配多设备对比，hover时曲线加粗易区分</span>
}]
</code></pre>
<h4 data-id="heading-7">其他采样方式及适用场景</h4>
<ul>
<li><strong>average（平均值采样）</strong> ：功能是将采样区间内的所有数据点取平均值作为采样结果。适用场景：工业能耗统计、设备运行平均参数监控等需要体现整体均值水平的场景，例如按小时统计车间设备平均功率。</li>
<li><strong>max（最大值采样）</strong> ：仅保留采样区间内的最大值作为采样点。适用场景：设备峰值监控，如电机最大负载、锅炉最高温度等关键参数的极值追踪，可快速定位设备运行的峰值时刻。</li>
<li><strong>min（最小值采样）</strong> ：与max相反，保留采样区间内的最小值。适用场景：设备运行下限监控，如冷却系统最低水温、润滑油最低压力等，确保关键参数不低于安全阈值。</li>
<li><strong>sum（求和采样）</strong> ：对采样区间内的数据点进行求和计算作为采样结果。适用场景：工业产量统计、物料消耗累计等需要累加数据的场景，比如按班次统计生产线产品总产量。</li>
</ul>
<h4 data-id="heading-8">实测效果：</h4>
<p>原 10 万条 5 秒级设备参数数据，初始化需 1.9 秒，拖动卡顿；启用 LTTB 后，数据点降至 3500 个，初始化仅需 350 毫秒，交互无延迟，且设备异常波动点 100% 保留，未影响数据分析。</p>
<h3 data-id="heading-9">2. 第二招：DataZoom 区域缩放 —— 适配工业时段化查看习惯</h3>
<p>工业软件用户常按 “生产班次”“单日 / 单周” 查看数据，全量加载全年数据完全无必要。</p>
<p>DataZoom 的核心是 “按需渲染”：默认只加载最近 24 小时数据（约 1.2 万条，占 12%），用户通过滑块或滚轮缩放时，再动态加载对应时段数据，从源头减少渲染数据量。</p>
<h4 data-id="heading-10">核心配置与工业适配：</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">dataZoom</span>: [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'inside'</span>, <span class="hljs-comment">// 支持鼠标滚轮精准缩放，适配工业精细查看需求</span>
    <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">12</span>, <span class="hljs-comment">// 初始显示12%数据（对应1个生产班次）</span>
    <span class="hljs-attr">minValueSpan</span>: <span class="hljs-number">300</span>, <span class="hljs-comment">// 最小缩放300个数据点（对应5分钟工业数据粒度）</span>
    <span class="hljs-attr">filterMode</span>: <span class="hljs-string">'empty'</span> <span class="hljs-comment">// 过滤不可见数据，减少计算负担</span>
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'slider'</span>, <span class="hljs-comment">// 显示滑块，方便定位历史生产时段</span>
    <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">12</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">28</span>,
    <span class="hljs-attr">labelFormatter</span>: <span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(value).<span class="hljs-title function_">toLocaleTimeString</span>([], { <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>, <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span> }) <span class="hljs-comment">// 适配工业时间显示习惯</span>
  }
]
</code></pre>
<h4 data-id="heading-11">适配技巧：</h4>
<p>用<code>requestIdleCallback</code>替代<code>setTimeout</code>初始化图表，避开工业软件 “设备告警”“生产计数” 等核心模块的加载高峰，避免图表与核心功能抢资源导致的延迟。实测显示，此调整可减少 30% 的初始化卡顿概率。</p>
<h3 data-id="heading-12">3. 第三招：large模式——超大数据量渲染的底层优化</h3>
<p>当工业场景需要展示车间所有设备（如50台设备，单台10万条数据，总计500万条）的运行状态概览时，仅靠降采样可能仍存在渲染压力。</p>
<p>large模式是ECharts的底层优化机制，开启后会自动采用 <em><em>“批量绘制”</em> *** “简化路径”</em>* 等策略，减少Canvas绘制的调用次数，同时关闭部分精细渲染效果，在保证整体趋势可见的前提下最大化提升性能。</p>
<h4 data-id="heading-13">核心配置与工业适配案例</h4>
<p>以“车间50台设备温度趋势概览”场景为例，核心配置如下：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">series</span>: [{
  <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>, <span class="hljs-comment">// 折线图，适配多设备趋势对比</span>
  <span class="hljs-attr">data</span>: multiDeviceTempData, <span class="hljs-comment">// 50台设备总计500万条温度数据</span>
  <span class="hljs-attr">sampling</span>: <span class="hljs-string">'lttb'</span>, <span class="hljs-comment">// 结合降采样进一步压缩数据量</span>
  <span class="hljs-attr">symbol</span>: <span class="hljs-string">'none'</span>, <span class="hljs-comment">// 关闭数据点标记，减少绘制负担</span>
  <span class="hljs-attr">animation</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭动画，保障实时交互</span>
  <span class="hljs-attr">large</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用large模式，开启底层渲染优化</span>
  <span class="hljs-attr">largeThreshold</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// 阈值设置：数据量超过1万条时触发large模式</span>
  <span class="hljs-attr">lineStyle</span>: {
    <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 线条宽度设为1px，平衡显示效果与渲染性能</span>
  }
}]
</code></pre>
<h4 data-id="heading-14">关键说明与适用场景</h4>
<ul>
<li><strong>核心功能</strong>：通过合并绘制指令、简化图形路径等底层优化，降低Canvas绘制开销，针对100万级以上数据量效果显著；largeThreshold用于设置触发阈值，可根据场景灵活调整（工业场景建议设5000-20000）。</li>
<li><strong>适用场景</strong>：设备集群运行状态概览（如车间所有设备温度/压力趋势）、全厂能耗总览等“重全局轻局部”的场景，不适用于需要精准查看单个数据点或细微波动的质检分析场景。</li>
<li><strong>搭配技巧</strong>：large模式建议与LTTB降采样组合使用，降采样负责“数据量压缩”，large模式负责“渲染效率优化”，两者结合可处理千万级数据的初步概览展示。</li>
</ul>
<h4 data-id="heading-15">实测效果</h4>
<p>500万条多设备温度数据，仅用LTTB降采样时初始化需1.2秒，拖动有轻微延迟；开启“LTTB+large模式”后，初始化耗时降至520毫秒，拖动、缩放等交互延迟均控制在0.1秒内，且50台设备的温度高低趋势清晰可辨，满足概览监控需求。</p>
<h2 data-id="heading-16">四、统计对比</h2>









































<table><thead><tr><th>优化方案</th><th>单模块渲染点</th><th>单模块初始化耗时</th><th>交互体验</th></tr></thead><tbody><tr><td>无优化</td><td>100,000</td><td>1800ms</td><td>缩放延迟 0.6 秒，切换模块卡顿</td></tr><tr><td>只开 LTTB</td><td>3,500</td><td>350ms</td><td>流畅，多曲线对比无延迟</td></tr><tr><td>只开 DataZoom</td><td>12,000</td><td>280ms</td><td>流畅，放大历史数据稍慢 0.1 秒</td></tr><tr><td>两者一起开</td><td>1,800</td><td>210ms</td><td>缩放、切换模块均无感知延迟</td></tr><tr><td>LTTB+DataZoom+large模式（500万数据）</td><td>10,000</td><td>520ms</td><td>概览流畅，支持快速切换设备集群视图</td></tr></tbody></table>
<h2 data-id="heading-17">五、B 端工业图表避坑指南与优化思路</h2>
<ol>
<li><strong>基础配置必做</strong>：无论哪种方案，<code>animation: false和symbol: 'none'</code>是底线 —— 工业场景无需动画效果，单个数据点标记只会增加 DOM 负担，这两项配置可减少 40% 渲染耗时。</li>
<li><strong>数据粒度协同</strong>：当数据超 50 万条时，需联合后端按 “工业时间粒度预采样”（如按分钟合并数据），前端再二次降采样，若数据超100万条，建议叠加large模式，避免前端处理超大数据量导致的内存占用问题。</li>
<li><strong>交互适配场景</strong>：工业用户多通过鼠标操作，DataZoom 滑块高度设 25-30px，minValueSpan对应实际生产粒度（如 5 分钟 / 1 小时）；开启large模式后，避免开启emphasis等精细交互效果，防止性能回退。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>