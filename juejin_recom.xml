<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Suno 歌曲生成 API 对接说明]]></title>    <link>https://juejin.cn/post/7603575399255310376</link>    <guid>https://juejin.cn/post/7603575399255310376</guid>    <pubDate>2026-02-06T15:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255310376" data-draft-id="7603556326816514100" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Suno 歌曲生成 API 对接说明"/> <meta itemprop="keywords" content="API,人工智能"/> <meta itemprop="datePublished" content="2026-02-06T15:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Suno 歌曲生成 API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:59:53.000Z" title="Fri Feb 06 2026 15:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读46分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着 AI 的应用变广，各类 AI 程序已逐渐普及。AI 已逐渐深入到人们的工作生活方方面面。而 AI 涉及的行业也越来越多，从最初的写作，到医疗教育，再到现在的音乐。</p>
<p>Suno 是一个专业高质量的 AI 歌曲和音乐创作平台，用户只需输入简单的文本提示词，即可根据流派风格和歌词生成带有人声的歌曲。该 AI 音乐生成器由来自 Meta、TikTok、Kensho 等知名科技公司的团队成员开发，目标是不需要任何乐器工具，让所有人都可以创造美妙的音乐。</p>
<p>以下是模型更新的进度：</p>





















































<table><thead><tr><th align="left">版本</th><th align="left">model</th><th align="left">上线时间</th><th align="left">prompt 限制</th><th align="left">style 限制</th><th align="left">歌曲最长时长</th></tr></thead><tbody><tr><td align="left">v5</td><td align="left">chirp-v5</td><td align="left">2025.09.23</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 分钟</td></tr><tr><td align="left">v4.5+</td><td align="left">chirp-v4-5-plus</td><td align="left">2025.07.17</td><td align="left">5000</td><td align="left">1000</td><td align="left">8 分钟</td></tr><tr><td align="left">v4.5</td><td align="left">chirp-v4-5</td><td align="left">2025.05.03</td><td align="left">5000</td><td align="left">1000</td><td align="left">4 分钟</td></tr><tr><td align="left">v4</td><td align="left">chirp-v4</td><td align="left">2024.12.17</td><td align="left">3000</td><td align="left">200</td><td align="left">150 秒</td></tr><tr><td align="left">v3.5</td><td align="left">chirp-v3-5</td><td align="left">---</td><td align="left">3000</td><td align="left">200</td><td align="left">120 秒</td></tr></tbody></table>
<p>Suno 最新已将音乐生成模型升级到 V5 版本，调用最新的 V5 只需要把 model 参数修改为<code>chirp-v5</code>，可生成 9 分钟的歌曲。</p>
<p>然而 Suno 官方是并没有提供 API 的，AceDataCloud 提供了一套 Suno 的 API，模拟对接了 Suno 官方，可以方便快捷地生成想要的音乐。</p>
<h2 data-id="heading-0">申请和使用</h2>
<p>要使用 Suno Audios API，首先可以到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F4da95d9d-7722-4a72-857d-bf6be86036e9" target="_blank" title="https://platform.acedata.cloud/documents/4da95d9d-7722-4a72-857d-bf6be86036e9" ref="nofollow noopener noreferrer">Suno Audios Generation API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92b95384eb93468ebfc146a57c188efc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=DaNfS0%2BgXv1%2B%2BYgaVocvm8TFd6g%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b0ba7d1abc64d388b414a3e64fcc9a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=8jNvi%2BCuV25DeEGYLymjztwpVDQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，默认是 <code>generate</code>，主要包含：<code>extend</code>、<code>upload_extend</code>、<code>cover</code>、<code>upload_cover</code>、<code>replace_section</code>、<code>replace_section</code>、<code>concat</code>、<code>stems</code>、<code>all_stems</code>、<code>remaster</code>。</li>
<li><code>prompt</code>：Suno 官方的灵感模式的提示词。</li>
<li><code>model</code>：此次音乐生成任务的模型，默认是 <code>chirp-v3-5</code>，主要包含：<code>chirp-v3</code>、<code>chirp-v4</code>、<code>chirp-v3-5</code>、<code>chirp-v4-5</code>、<code>chirp-v4-5-plus</code>、 <code>chirp-v5</code>。</li>
<li><code>lyric</code>：Suno 官方的自定义模式的歌词内容。</li>
<li><code>custom</code>：是否采用自定义模式，默认是: <code>false</code>。</li>
<li><code>instrumental</code>：Suno 官方的灵感模式的纯音乐选项。</li>
<li><code>title</code>：Suno 官方的自定义模式的音乐标题。</li>
<li><code>style</code>：Suno 官方的自定义模式的音乐风格。</li>
<li><code>style_negative</code>：Suno 官方的自定义模式的排除风格。</li>
<li><code>audio_weight</code>：上传的参考音频占比，范围 0-1，越大越依赖参考音频。</li>
<li><code>audio_id</code>：参考音乐的 ID。</li>
<li><code>overpainting_start</code>/<code>overpainting_end</code>：为已有纯音乐补充人声的起止时间，单位秒。</li>
<li><code>underpainting_start</code>/<code>underpainting_end</code>：为清唱加伴奏的起止时间，单位秒。</li>
<li><code>persona_id</code>：艺术家的歌曲 ID。</li>
<li><code>continue_at</code>：以秒为单位继续现有音频的时间。例如，213.5 表示继续到 3 分 33.5 秒。</li>
<li><code>style_influence</code>：<code>style_influence</code> 高级参数。</li>
<li><code>replace_section_end</code>：替换片段的最终时间。</li>
<li><code>replace_section_start</code>：替换片段的起始时间。</li>
<li><code>vocal_gender</code>：控制男女声，女声 <code>f</code>，男声 <code>m</code>，4.5 及以上模型有效。</li>
<li><code>weirdness</code>：<code>weirdness</code> 高级参数。</li>
<li><code>lyric_prompt</code>：生成歌词的 prompt，当且仅当 <code>custom</code> 为 <code>true</code> 并且 <code>lyric</code> 没有传的时候生效。</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
</ul>
<p>生成的代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4efea0d2888a43acba95265f71963bf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=xgrPY%2B890LKsYNH1IQ2LYHvcAC8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以点击「Try」按钮直接测试 API，稍等 1-2 分钟，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e72fb249-bd5b-4e2a-b20c-8a06fea5ac14"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7dbc5b6a-b2c0-4d85-9d39-fa8a8a785ccf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b481b17a-bf50-4e10-8adc-4d5635050893"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b481b17a-bf50-4e10-8adc-4d5635050893.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fire’s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA season’s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b481b17a-bf50-4e10-8adc-4d5635050893.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fbf22dab-5e2b-4e02-84c0-6d7605f14c3d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Under the Mistletoe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes falling on the ground\nTwinkling lights all around\nThe scent of pine fills the air\nChristmas magic everywhere\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Verse 2]\nStockings hung by the fire’s glow\nWarmth inside while the cold winds blow\nCookies baking\nSweet delight\nA season of joy shining bright\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right\n[Bridge]\nCarols sung by candlelight\nStars above make the world feel tight\nPeace and love\nA season’s creed\nFilling hearts with all we need\n[Chorus]\nUnder the mistletoe tonight\nHearts aglow in the soft moonlight\nLaughter echoes\nSpirits bright\nIt’s Christmas time\nIt feels so right"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/fbf22dab-5e2b-4e02-84c0-6d7605f14c3d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T15:59:32.468Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, cheerful, male vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.48</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到这时候我们就得到了两首歌的内容，包括标题、预览图、歌词、音频、视频等内容。</p>
<p>字段说明如下：</p>
<ul>
<li>success：生成是否成功，如果成功则为 <code>true</code>，否则为 <code>false</code></li>
<li>data：是一个列表，包含了生成的歌曲的详细信息。
<ul>
<li>state： 歌曲生成状态，主要包含四种，具体的如下：
<ul>
<li>succeeded：生成成功</li>
<li>pending：队列中</li>
<li>running：执行中</li>
<li>error：失败</li>
</ul>
</li>
<li>id：歌曲 ID</li>
<li>title：歌曲的标题</li>
<li>image_url：歌曲的封面图片</li>
<li>lyric：歌曲的歌词</li>
<li>audio_url：歌曲的音频文件，打开就是一个 mp3 音频。</li>
<li>video_url：歌曲的视频文件，打开就是一个 mp4 视频。</li>
<li>created_at：创建的时间</li>
<li>model：使用的模型，一般是最新的 v3 模型</li>
<li>style：风格</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Verse]</span>\nSnowflakes falling <span class="hljs-attribute">all</span> around\nGlistening white\nCovering the ground\nChildren laughing\nFull of delight\nIn this winter wonderland tonight\nSanta's sleigh\nUp in the sky\nRudolph's nose shining bright\nOh my\nHear the jingle bells\nRinging so <span class="hljs-attribute">clear</span>\nBringing joy and holiday cheer\n<span class="hljs-selector-attr">[Verse 2]</span>\nRoasting chestnuts by the fire's glow\nChristmas lights\nThey twinkle and show\nFamilies gathering with love and cheer\nSpreading warmth <span class="hljs-selector-tag">to</span> everyone near
</code></pre>
<blockquote>
<p>注意，这里的歌词中 <code>\n</code> 是换行符，如果你不知道如何生成歌词，可以使用 AceDataCloud 提供的歌词生成 API 来通过 prompt 生成歌词，API 是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F514d82dc-f7ab-4638-9f21-8b9275916b08" target="_blank" title="https://platform.acedata.cloud/documents/514d82dc-f7ab-4638-9f21-8b9275916b08" ref="nofollow noopener noreferrer">Suno Lyrics Generation API</a>。</p>
</blockquote>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650e76020cda4dda82d613d7687979f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=SscCFqHs5U85aPR6QPx36XjBum4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f27a8257c398422495d708bc0dc800bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=9ZEP1mkqjuzz6XGNq11ECQNzX20%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/suno/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "generate",
  "prompt": "A song for Christmas",
  "model": "chirp-v4-5",
  "lyric": "[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<h2 data-id="heading-3">自定义歌手风格生成功能</h2>
<p>如果想使用歌手风格来生成歌曲的话，首先通过上文的基本使用生成一首歌曲，
最后得到了需要设置这个歌曲为歌手风格，然后需要进入<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F78bb6c62-6ce0-490f-a7df-e89d80ec0583" target="_blank" title="https://platform.acedata.cloud/documents/78bb6c62-6ce0-490f-a7df-e89d80ec0583" ref="nofollow noopener noreferrer">Suno Persona API</a>根据官方生成的音乐 ID <code>audio_id</code> 来生成一个歌手风格的 id 参数 <code>persona_id</code>，具体的参数如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b9f31bd7e7d42c58e20448eaf3b0b7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=XR6NrApo%2BQBC%2FsZbRbssI83SW28%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1df81d7340304db5bf21540cf0e743b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=1QoGBTH%2BLMMzJeEBLrQiKTQpaPI%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/persona"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"test"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7628b754-4fe7-4e79-bda4-806d0dd8bf6e"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"persona_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>我们以上面的 <code>audio_id</code> 和 <code>persona_id</code> 分别为 <code>97efc9f4-0e8d-4b3e-88df-14568fa1b11f</code>、<code>e0d7319e-aa2a-44cb-b00a-916218d7cb0b</code> 为此次的示例数据。 然后可以将参数 <code>action</code> 设置为 <code>artist_consistency</code> (如果是新版的歌手风格Persona-v2-vox，<code>action</code> 必须设置为 <code>artist_consistency_vox</code>)，并且输入需要继续生成歌曲的 ID 、 歌手风格 ID，填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56c4f4055d534772bd9b8a50c09e73f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=vRkE%2BjykA%2BwFAoHL5o7p5MfgB9k%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc66f818bf4f4fd1b06eaddaaddd6479~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=AQ1ltfDPdJifj0nofM0Y%2F9x%2BRKE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"artist_consistency"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"persona_id"</span>: <span class="hljs-string">"e0d7319e-aa2a-44cb-b00a-916218d7cb0b"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9b732b1a-bd67-48bc-95e4-90140e06836f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30fcd88e-7687-4137-92d7-913b58115204"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"727a36e2-8dce-4df7-99e5-14e44635c80f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_727a36e2-8dce-4df7-99e5-14e44635c80f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/727a36e2-8dce-4df7-99e5-14e44635c80f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">244.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3b33301a-b17e-4b25-8842-09b46dab1a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3b33301a-b17e-4b25-8842-09b46dab1a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3b33301a-b17e-4b25-8842-09b46dab1a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:27:33.979Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.88</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看出，结果内容与上文的是一致的，这也就实现使用歌手风格来生成歌曲的功能。</p>
<h2 data-id="heading-4">继续生成功能</h2>
<p>如果想对已经生成的 Suno 歌曲进行继续生成的话，可以将参数 <code>action</code> 设置为 <code>extend</code> ，并且输入需要继续生成歌曲的 ID，歌曲 ID 的获取是根据基本使用来获取，通过上文可知，这时候可以看到歌曲的 ID 为：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>
</code></pre>
<blockquote>
<p>注意，这里的歌词中 <code>id</code> 是生成后歌曲的 ID，如果你不知道如何生成歌曲，可以参考上文的基本使用来生成歌曲。</p>
</blockquote>
<p>如果想对自己上传的歌曲进行继续生成的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续生成自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload Generation API</a>来获取，如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58b7faa73caa4329bf1f9a8fb0aaa960~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=Q2rbr%2FqGxvN4Kt2FHBr8NR7wkVg%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>接下来我们要必须填歌词、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>style：歌曲的风格，选填。</li>
<li>continue_at：以秒为单位继续现有音频的时间。例如，213.5 表示继续到 3 分 33.5 秒。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdd5c75161e242c3adb572d98a395c50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=P7Z66q2Ot%2BzCDZLZ3dbjzX153o8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50b047bb4ef04bc885149d7239e43715~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=%2Bo6UBUIkyAkq%2BkYkBUqSoUULNLk%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"extend"</span>,
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"A song for Christmas"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span>,
    <span class="hljs-string">"continue_at"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"instrumental"</span>: <span class="hljs-literal">False</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"75b835d9-30d1-4641-8524-0aeedbdc9e1a"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44c41045-a2e1-4d19-aafc-7abd239d0d5c"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">165.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4334c5b4-0a44-4b26-a8f6-66cc4dbb8fc3.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:38:35.509Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.84</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看出，结果内容与上文的是一致的，这也就实现歌曲的继续生成功能。</p>
<h2 data-id="heading-5">获取完整歌曲</h2>
<p>当基于原有的歌曲继续生成歌曲之后，返回的歌曲并不包含原来的歌曲内容。如果要获得完整的歌曲内容，需要使用拼接功能，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>concat</code>。</li>
<li>audio_id：最后一个片段的 ID。</li>
</ul>
<p>比如扩展后的歌曲 ID 是：0a1e1b10-c36a-41c9-9bfb-b26d9d25db98，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"concat"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首完整的歌曲，就是所有歌曲片段的拼接结果，但结果只有一首歌，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0f794915-8418-4124-93f5-b7eb3a417167"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"62afcce0-e7e5-44b8-8c2e-4bba12a4f414"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0efec7e0-11bf-4313-9981-2c0e7218d7dd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_0a1e1b10-c36a-41c9-9bfb-b26d9d25db98.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near\n[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta's sleigh\\nUp in the sky\\nRudolph's nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire's glow\\nChristmas lights\\nThey twinkle and show\\nFamilies gathering with love and cheer\\nSpreading warmth to everyone near"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/0efec7e0-11bf-4313-9981-2c0e7218d7dd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:43:06.718Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">167.91997916666668</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"continue_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97efc9f4-0e8d-4b3e-88df-14568fa1b11f"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"web"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">音乐翻版</h2>
<p>当基于原有的歌曲继续生成歌曲之后，返回的歌曲的风格可能不太合适。如果要对原先生成的歌曲(若是自定义上传的音乐也支持)进行翻版，需要使用音乐翻版方法，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>cover</code>，当是对自定义上传的音乐进行翻版操作的时候必须指定内容为：<code>upload_cover</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：0a1e1b10-c36a-41c9-9bfb-b26d9d25db98，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cover"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0a1e1b10-c36a-41c9-9bfb-b26d9d25db98"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4-5"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首翻版后的歌曲，就是对原先生成的歌曲进行翻版后的结果，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9d43d06-2e0a-4b5e-9e0d-7dfab32e00ab"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6c5e567d-0fdc-4c44-9b36-4090d9a75ff5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6988fa57-f810-41cf-afab-7838db2c77dc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6988fa57-f810-41cf-afab-7838db2c77dc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6988fa57-f810-41cf-afab-7838db2c77dc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">182.4</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ce98b991-0258-4f05-8245-e43d4efa8fb8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ce98b991-0258-4f05-8245-e43d4efa8fb8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ce98b991-0258-4f05-8245-e43d4efa8fb8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-17T16:44:13.007Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.72</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行翻版生成的过程。</p>
<h2 data-id="heading-7">替换片段</h2>
<p>当生成歌曲之后需要进行替换歌曲片段单独操作的二次创作时，可以对歌曲的某个片段进行替换操作。就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>replace_section</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
<li>model: 歌曲生成模型，</li>
<li>lyric: 替换后的完整歌词（只需要与 prompt 有重复就行，不需要完全的歌词），</li>
<li>prompt：需要替换的歌词部分。</li>
<li>style：歌曲的风格，选填。</li>
<li>replace_section_start：<code>lyric</code>对应的歌词时间轴的起始时间。</li>
<li>replace_section_end：<code>lyric</code>对应的歌词时间轴的终点时间。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"replace_section"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\n新年快乐 人人欢快歌\n祝福洒满每一片角落\n新年快乐 心中花火多\n愿望成真生活似金色波\n[Verse 2]\n梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"replace_section_end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"custom"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"instrumental"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>其他参数不变，返回的就是一首替换后的歌曲，就是对原先生成的歌曲进行替换片段后的结果，样例如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7a37c35d-7081-413d-908d-ab2d3f8139bf"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ed92d6e-9a19-48f7-ab34-68c82c792303"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"新年快乐"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dc1b5edc-fbae-44a3-8962-d596dbd2b0d7.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Chorus]\n新年快乐 人人欢快歌\n祝福洒满每一片角落\n新年快乐 心中花火多\n愿望成真生活似金色波\n[Verse 2]\n梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2a1467dc-51a4-4872-9ccc-ccd96e4fbbb6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-04-18T01:55:02.930Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"traditional influences, female vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">202.52</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"concat_history"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ade7241b-0357-4a5e-9b3d-4ec4f4b3a0c0"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gen"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ios"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">28.94100580270793</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_dur_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">56.45309477756285</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_start_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_context_end_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">115.39410058027079</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_future_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"include_history_s"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"infill_lyrics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"梅花绽放春意洋溢满地\n梅花绽放春意洋溢满地"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dc1b5edc-fbae-44a3-8962-d596dbd2b0d7"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行替换片段的过程。</p>
<h2 data-id="heading-8">声曲分离</h2>
<p>当生成歌曲之后需要进行伴奏和人声单独操作的二次创作时，可以分离纯音乐伴奏和清唱人声。就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>stems</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：ec13e502-d043-4eb2-92ee-e900c6da69d1，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ec13e502-d043-4eb2-92ee-e900c6da69d1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>通过以上参数即可得到声曲分离的结果，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4050affc-f8a6-4cba-a86c-bf201eed053d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5107ee58-687d-422f-9195-fa0e82e1fcc8"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e3de0928-085a-42c4-b982-3b24738d1989"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e3de0928-085a-42c4-b982-3b24738d1989.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnowflakes dance on rooftops high\nChildren's laughter fills the sky\nCarols ring from church bells loud\nHolidays a joyful crowd\n[Verse 2]\nCandy canes and cocoa warm\nWrapped up tight in our own storm\nStockings hung with dreams and cheer\nMagic growing every year\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright\n[Verse 3]\nFireside tales of long ago\nReindeer prance in icy glow\nEvergreen and tinsel’s gleam\nChristmas time a lovely dream\n[Bridge]\nHearts are full with friends and kin\nMistletoe for love to win\nGifts of love and hope we share\nChristmas spirit everywhere\n[Chorus]\nDeck the sky with twinkling stars\nHoliday joy feels ours and ours\nSing the songs of love and light\nChristmas glows so pure and bright"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e3de0928-085a-42c4-b982-3b24738d1989.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.881Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Deck the Sky - Instrumental"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/ad5d7c89-709c-4eb4-a5a6-72f9f5e57fdb.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-01-05T07:49:16.892Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"holiday, jolly"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">174.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行声曲分离的过程。</p>
<h2 data-id="heading-9">全轨道声曲分离</h2>
<p>当生成歌曲之后需要进行全轨道声曲分离操作时，就可以指定如下内容：</p>
<ul>
<li>action：内容为 <code>all_stems</code>。</li>
<li>audio_id：之前生成歌曲的 ID。</li>
</ul>
<p>比如原先生成后的歌曲 ID 是：bdf23a5a-59f5-4103-b452-054a824a7f9f，那么可以设置参数如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"all_stems"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"audio_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bdf23a5a-59f5-4103-b452-054a824a7f9f"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>通过以上参数即可得到全轨道声曲分离的结果，结果如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f4b16fb9-8478-4857-88c7-b9a1f0bb9518"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9c560ebd-4fc6-4bdb-988a-8890160a92fb"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f86ca64a-9519-4ea7-a592-52438e001412"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f86ca64a-9519-4ea7-a592-52438e001412.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f86ca64a-9519-4ea7-a592-52438e001412.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"99e649a7-a394-47b9-a915-d7f847285a36"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_99e649a7-a394-47b9-a915-d7f847285a36.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/99e649a7-a394-47b9-a915-d7f847285a36.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6d710bf7-809f-4fdc-bb63-b8cb3a456d42"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_6d710bf7-809f-4fdc-bb63-b8cb3a456d42.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/6d710bf7-809f-4fdc-bb63-b8cb3a456d42.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"e05f07e3-7d80-4713-8e51-7f176c733543"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_e05f07e3-7d80-4713-8e51-7f176c733543.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/e05f07e3-7d80-4713-8e51-7f176c733543.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"93fe7cd8-62fd-4739-b78e-142c7e0b8562"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_93fe7cd8-62fd-4739-b78e-142c7e0b8562.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/93fe7cd8-62fd-4739-b78e-142c7e0b8562.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8367d71c-fdd3-441c-8ebe-70c33cca821b"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_8367d71c-fdd3-441c-8ebe-70c33cca821b.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/8367d71c-fdd3-441c-8ebe-70c33cca821b.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"28c03590-731c-416e-8fd3-95cdb3d75043"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_28c03590-731c-416e-8fd3-95cdb3d75043.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/28c03590-731c-416e-8fd3-95cdb3d75043.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3d4c1a28-4e1c-485a-8201-d21bb93aca2f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_3d4c1a28-4e1c-485a-8201-d21bb93aca2f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/3d4c1a28-4e1c-485a-8201-d21bb93aca2f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b9db8ded-01ec-4e37-b8a5-64aab3a814c2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b9db8ded-01ec-4e37-b8a5-64aab3a814c2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b9db8ded-01ec-4e37-b8a5-64aab3a814c2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10a5248e-32e6-42b9-8da1-678a8a392aef"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_10a5248e-32e6-42b9-8da1-678a8a392aef.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/10a5248e-32e6-42b9-8da1-678a8a392aef.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d272128-111f-4901-8f62-5ae1eb43095a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d272128-111f-4901-8f62-5ae1eb43095a.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d272128-111f-4901-8f62-5ae1eb43095a.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/4a7c19a5-f8d4-4e4a-add9-aa0bad9307cc.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1ca774f9-3e75-48a6-941b-808875eadcd2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_1ca774f9-3e75-48a6-941b-808875eadcd2.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/1ca774f9-3e75-48a6-941b-808875eadcd2.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.770Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"14c5ffc7-addf-4fee-afd2-4b8b3e7ee470"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Backing Vocals)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/14c5ffc7-addf-4fee-afd2-4b8b3e7ee470.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9d044557-450d-48ab-90dc-8eaf6f1cdb6c"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Drums)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_9d044557-450d-48ab-90dc-8eaf6f1cdb6c.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/9d044557-450d-48ab-90dc-8eaf6f1cdb6c.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efd052d0-c12f-47b3-8282-1f3ef7610e1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Bass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_efd052d0-c12f-47b3-8282-1f3ef7610e1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/efd052d0-c12f-47b3-8282-1f3ef7610e1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5775372b-292e-4420-96ef-60e57a60cc1f"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Guitar)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_5775372b-292e-4420-96ef-60e57a60cc1f.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/5775372b-292e-4420-96ef-60e57a60cc1f.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dab3f220-19cd-408e-9b96-30ec18f5b049"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Keyboard)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_dab3f220-19cd-408e-9b96-30ec18f5b049.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/dab3f220-19cd-408e-9b96-30ec18f5b049.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2d0cd6d4-af82-4bb5-86fe-d92bdb367157"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Percussion)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2d0cd6d4-af82-4bb5-86fe-d92bdb367157.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2d0cd6d4-af82-4bb5-86fe-d92bdb367157.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f3191a1a-5e8d-4afe-b638-3add222d52cd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Strings)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f3191a1a-5e8d-4afe-b638-3add222d52cd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f3191a1a-5e8d-4afe-b638-3add222d52cd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a8834ea5-200b-4206-a812-9780ef336660"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Synth)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a8834ea5-200b-4206-a812-9780ef336660.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a8834ea5-200b-4206-a812-9780ef336660.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f50d1a31-ef72-400a-b8ae-0367849d007d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (FX)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_f50d1a31-ef72-400a-b8ae-0367849d007d.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/f50d1a31-ef72-400a-b8ae-0367849d007d.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cb581673-23cc-40d6-9f9b-0f76720f0d18"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Brass)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_cb581673-23cc-40d6-9f9b-0f76720f0d18.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/cb581673-23cc-40d6-9f9b-0f76720f0d18.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"d91cfb52-f0a3-4546-bf8a-2ad14c3775a5"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"安全之弦 (Woodwinds)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/d91cfb52-f0a3-4546-bf8a-2ad14c3775a5.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-11T02:40:30.771Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-ahi-stem-12-t1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">154.92</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的结果与上文类似，这就完成了对原先生成的歌曲进行声曲分离的过程。</p>
<h2 data-id="heading-10">自定义生成的高级参数</h2>
<p>官方允许在自定义模式下使用高级参数 <code>weirdness</code>==&gt;<code>Weirdness</code>、<code>style_influence</code>==&gt;<code>Style Influence</code>、<code>audio_weight</code>==&gt;<code>Audio Influence</code>来进行生成，对应如下如的官方示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/656344f7831b40288277e83e7bf13c23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=Gm10k755vsF2EbcUe9gAOTO9Z7I%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>其中高级参数的范围都在 0-1 之间，具体的参数如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa9bdef609f74b14baac97dadae7851f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=99TESMqCpwvoMjVsZWS5jf5HmDQ%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16556d6fdc0b45b2afda8f8979ddeb11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=7325eq4CmUx2R0MkOo4wUOHVMYo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"generate"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Hello Hello Hello "</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"weirdness"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"style_influence"</span>: <span class="hljs-number">0.4</span>,
    <span class="hljs-string">"audio_weight"</span>: <span class="hljs-number">0.4</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2f3aa682-e1a7-43a9-9fbb-ed0ce8668a4b"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"07408194-7deb-4a52-a36d-9a9a13143b5f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"c66e2077-7580-43f2-9937-c67a8afcd8bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_c66e2077-7580-43f2-9937-c67a8afcd8bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/c66e2077-7580-43f2-9937-c67a8afcd8bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">187.92</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a922f97b-307c-4c4d-aae3-a47ba8202a10"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a922f97b-307c-4c4d-aae3-a47ba8202a10.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Hello Hello Hello "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a922f97b-307c-4c4d-aae3-a47ba8202a10.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-07-10T12:54:35.199Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-auk"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">229.64</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就使用了高级参数进行生成自定义歌曲，结果与上文类似。</p>
<h2 data-id="heading-11">Add Insterumental 功能</h2>
<p>2025 年 8 月份 suno 新出 Add Insterumental 功能，首先需要上传一首清唱无配音的歌曲, 让 suno 帮你配乐，首先可以先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>上传一首清唱无配乐的歌曲，对应如下如的操作如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/147e7631221d45429996ed2d62aa9442~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=2SFrXHqOGyjfDMXeNGSuQvI%2FoUo%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>然后需要记录上传后的<code>audio_id</code>，具体的结果如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d81e5fe62a947d0a38ab72374dfa7e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=ZTZDf%2FSzdSVGyWWppcS%2FWs6KVl0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>最后得到了一个<code>audio_id</code>：92254cab-3372-4d9e-bce9-cdcfdbc39070，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>underpainting</code>。</li>
<li>underpainting_start：对上传的歌曲进行添加伴奏的起始时间，默认值是 0。</li>
<li>underpainting_end：对上传的歌曲进行添加伴奏的终点时间，必须小于歌曲的总时长。</li>
<li>audio_id：上传的清唱无配音的歌曲 ID。</li>
<li>style：伴奏的风格，最好是不用歌词 毕竟是配音。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56fe49a2d3684fe5954828475f01b65e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=lIrhhEg3xzyjA%2B7QINIatUEyRO8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"underpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"style"</span>: <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"underpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"822d2e14-c535-4d48-a4e5-1b6ab00b04a7"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"257eac2c-8e4f-44d0-8454-5e215111eefa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2788cd21-bd84-422d-beb5-859c60fbf5b6"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_2788cd21-bd84-422d-beb5-859c60fbf5b6.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/2788cd21-bd84-422d-beb5-859c60fbf5b6.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10.16</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a4bb7220-e971-4cbf-a626-b86c648bcf55"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a4bb7220-e971-4cbf-a626-b86c648bcf55.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a4bb7220-e971-4cbf-a626-b86c648bcf55.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:25:42.548Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop rap, uplifting, magnetic male vocals, piano, synth, electric guitar, driving bass, clear structure"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.52</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对上传的清唱无配音歌曲进行配乐的操作，结果与上文类似。</p>
<h2 data-id="heading-12">Add Vocals 功能</h2>
<p>2025 年 8 月份 suno 新出 Add Vocals 功能，首先需要上传一首纯音乐，让 suno 填词、出人声歌唱，首先可以先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F766db278-012c-43c4-9245-5f18d8dc4d82" target="_blank" title="https://platform.acedata.cloud/documents/766db278-012c-43c4-9245-5f18d8dc4d82" ref="nofollow noopener noreferrer">Suno Upload API</a>上传一首清唱无配乐的歌曲，对应如下如的操作如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3476d60a40934285bd0778221e00e903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=3eeK4%2F4NWUa9FkxHaNZefH0kbmE%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>然后需要记录上传后的<code>audio_id</code>，具体的结果如下图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28290bdc768f45a9a051085c760c3684~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=CL0UHNd8od%2BM17h3CZ%2FzZjaTyB0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>最后得到了一个<code>audio_id</code>：92254cab-3372-4d9e-bce9-cdcfdbc39070，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>overpainting</code>。</li>
<li>overpainting_start：对上传的歌曲进行添加人声的起始时间，默认值是 0。</li>
<li>overpainting_end：对上传的歌曲进行添加人声的终点时间，必须小于歌曲的总时长。</li>
<li>audio_id：上传的清唱无配音的歌曲 ID。</li>
<li>custom：该模式下必须使用自定义模式填入歌词。</li>
<li>lyric：自定义模式下填写的歌词。</li>
<li>style：伴奏的风格。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd79402af97841adb0d7b42c8ba1759a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=ntavZzCyDlhkOIKGTUHB%2FXnSOh4%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"overpainting"</span>,
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"chirp-v4-5"</span>,
    <span class="hljs-string">"lyric"</span>: <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span>,
    <span class="hljs-string">"custom"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"92254cab-3372-4d9e-bce9-cdcfdbc39070"</span>,
    <span class="hljs-string">"overpainting_end"</span>: <span class="hljs-number">120</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"31bb250e-6614-49ec-ac85-631f224daeba"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"efe8e7f3-9a65-4f13-a9f8-51e8478899df"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a597f945-64df-4722-a631-d436450832bd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_a597f945-64df-4722-a631-d436450832bd.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/a597f945-64df-4722-a631-d436450832bd.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105.32</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b41a8b91-3d88-4ebd-a6cf-732764b24954"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b41a8b91-3d88-4ebd-a6cf-732764b24954.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Yea your were the best I could get \\nBut I knew that it couldn’t last \\nStayed down since we were friends \\nHad to leave those thoughts in the past \\nMade like 40k just last week \\nOn top of the 20 with my babe\\ndon’t care for what niggas say"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b41a8b91-3d88-4ebd-a6cf-732764b24954.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-08-27T15:33:51.550Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">148.16</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对上传的清唱无配音歌曲进行配人声的操作，结果与上文类似。</p>
<h2 data-id="heading-13">Remaster 功能</h2>
<p>2025 年 12 月份 suno 新出 Remaster 功能，该功能可以重新生成歌曲，不可跨账号，然后我们还需要填写如下参数：</p>
<ul>
<li>action：内容为 <code>remaster</code>。</li>
<li>audio_id：需要重新生成的歌曲 ID。</li>
<li>model：仅支持 v4.5+、v5。</li>
<li>variation_category：仅在 v5 以上版本支持，而且只有 3 个值 high normal subtle。</li>
</ul>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d95ce4ed02347c39a03951f83e44942~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=fQNkNgVLhItez9vVSCjrYzwwV38%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的 Python 代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/suno/audios"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"action"</span>: <span class="hljs-string">"remaster"</span>,
    <span class="hljs-string">"variation_category"</span>: <span class="hljs-string">"high"</span>,
    <span class="hljs-string">"audio_id"</span>: <span class="hljs-string">"21fd46d4-45c3-4826-bec9-3f3df667902e"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"791ee74c-9363-4352-afe7-babb19b89899"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"77acda57-c3d4-4e11-a506-4f50e0609916"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b0515cdf-9cb5-46cd-b0fe-10a239dc9274"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_b0515cdf-9cb5-46cd-b0fe-10a239dc9274.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parón;\ncose el grupo entre villancicos\ny un buen trocito de turrón.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon música y diversión;\nlos alumnos comeremos\nGolosinas un montón "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b0515cdf-9cb5-46cd-b0fe-10a239dc9274.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"06edab94-a4f9-4c0c-abac-a2e8a97c76a8"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Navidad en costura  (Remastered)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn2.suno.ai/image_large_06edab94-a4f9-4c0c-abac-a2e8a97c76a8.jpeg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"En Teror las clases siguen,\nni en Navidad hay parón;\ncose el grupo entre villancicos\ny un buen trocito de turrón.\nLa Popular abre sus puertas,\ny el taller suena mejor;\nhilo, aguja y canto alegre\nlo pasaremos mejor\nSeguimos en las costuras,\ncon música y diversión;\nlos alumnos comeremos\nGolosinas un montón "</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/06edab94-a4f9-4c0c-abac-a2e8a97c76a8.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-12-04T13:09:59.936Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Villancico"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">32.2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这样就完成了对已生成歌曲重新生成的操作，结果与上文类似。</p>
<h2 data-id="heading-14">异步回调</h2>
<p>由于 Suno 生成音乐的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成音乐的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F%25EF%25BC%258C%25E6%2589%2593%25E5%25BC%2580%25E8%25AF%25A5%25E7%25BD%2591%25E7%25AB%2599%25E5%258D%25B3%25E5%258F%25AF%25E5%25BE%2597%25E5%2588%25B0%25E4%25B8%2580%25E4%25B8%25AA" target="_blank" title="https://webhook.site/%EF%BC%8C%E6%89%93%E5%BC%80%E8%AF%A5%E7%BD%91%E7%AB%99%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA" ref="nofollow noopener noreferrer">webhook.site/，打开该网站即可得到一…</a> Webhook URL，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c23a19fa544512ad5efe1d9005f768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=PsoR1wQ9qhS6IsWwdJYO9%2Fge6ps%3D" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2%25E3%2580%2582" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2%E3%80%82" ref="nofollow noopener noreferrer">webhook.site/03e60575-3d…</a></p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5568437cfa3401cb6bd0e39684643b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=h16jdQXvcu7%2FIQQe8WRDSl2rOcI%3D" alt="" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F03e60575-3d96-4132-b681-b713d78116e2" target="_blank" title="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2" ref="nofollow noopener noreferrer">webhook.site/03e60575-3d…</a> 上观察到生成歌曲的结果，如图所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72033db0e0e74ee99896c08a770a4906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=hEf51F4dDBKkwD%2Fe7LWgi6%2FE7w4%3D" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"44472ab8-783b-4054-b861-5bf14e462f60"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da4324e5-84b2-484b-b0e9-dd261381c594"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_da4324e5-84b2-484b-b0e9-dd261381c594.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b878a87b-a0db-4046-8ccd-ecd2fb3d4372"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Winter Whispers"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/image_b878a87b-a0db-4046-8ccd-ecd2fb3d4372.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-05-11T07:33:05.430Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chirp-v3"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pop"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<p>当然我们也可以通过流式调用来获取结果，我们只需要将请求头里面的<code>accept</code>的值设置为<code>application/x-ndjson</code>即可，下面用一个示例输入作为示范：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9684399b0264fcda9edc0fe2c4d8528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770998392&amp;x-signature=%2FjdVATaXU%2Fs%2FB%2BEunND3NWf0iZ0%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>等待过程中我们可以得到以下输出：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"pending"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp4"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://audiopipe.suno.ai/?item_id=d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"running"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1af4b454-ce84-4512-a0a2-de3f8574ecd8"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"4440342a-41c4-4140-8bb1-3537a598ca2e"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"1f610752-f426-4fd5-89a8-ba2ad0370881"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_1f610752-f426-4fd5-89a8-ba2ad0370881.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/1f610752-f426-4fd5-89a8-ba2ad0370881.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.92</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"d1a3109d-799b-401e-b032-4b501bcf26f3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"Snowflakes and Mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"image_large_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn2.suno.ai/image_large_d1a3109d-799b-401e-b032-4b501bcf26f3.jpeg"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"[Verse]\nLights are tangled on the tree again\nThe cat’s knocked over the wreath\nCookies burning in the oven too\nBut I’m still grinning through my teeth\n[Prechorus]\nSnow is falling like glitter in the sky\nI’ve got a feeling this year’s gonna fly\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe\n[Verse 2]\nGrandma’s singing a little off-key\nThe kids are laughing too loud\nThe dog’s stolen a turkey leg\nChaos is a Christmas crowd\n[Prechorus]\nBut the fire’s crackling\nWarm and bright\nAnd my heart’s a candle tonight\n[Chorus]\nSnowflakes and mistletoe\nEverywhere I go\nI know\nLove is the gift\nThe glow\nSnowflakes and mistletoe"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"https://cdn1.suno.ai/d1a3109d-799b-401e-b032-4b501bcf26f3.mp3"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"2025-12-13T11:29:25.101Z"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chirp-v5"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"A song for Christmas"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"uplifting, orchestral with bells and acoustic guitar"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span><span class="hljs-number">127.16</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>得到的结果跟基本调用类似，上面多个结果就实现了流式调用。</p>
<h2 data-id="heading-15">错误处理</h2>
<p>如果发生错误，您将得到类似如下的错误信息：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"forbidden"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Song Description contained artist name: eminem"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb7c2f4-3b7b-4965-b50a-f663874b1b6f"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9bb3a2a6-c438-436d-a9f3-fa466abc077c"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>下面是 HTTP Status Code, <code>error.code</code>, <code>error.message</code> 的列表：</p>
































































































































































<table><thead><tr><th>Status Code</th><th><code>error.code</code></th><th><code>error.message</code></th></tr></thead><tbody><tr><td>400</td><td><code>bad_request</code></td><td><code>The song id does not exist or has been taken offline.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Prompt too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Tags too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Uploaded audio matches existing work of art.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>instrumental must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Title too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>Topic too long.</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>style must be less than or equal 120</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>custom must be a boolean</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>audio_id is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at is required when extend audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>continue_at must be a number greater than 0</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when extend audio and instrumental is false</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>prompt is required when generate audio</code></td></tr><tr><td>400</td><td><code>bad_request</code></td><td><code>lyric is required when generate custom audio</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely malformed</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt likely copyrighted</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt contained inappropriate material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description flagged for moderation</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Tags contained artist name</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Lyrics contained copyrighted material</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Song Description contained producer tag</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Generic openAI error</code></td></tr><tr><td>403</td><td><code>forbidden</code></td><td><code>Prompt flagged for moderation</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>Unable to generate lyrics from song description</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>job failed with unknown error</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>no available worker in system</code></td></tr><tr><td>500</td><td><code>api_error</code></td><td><code>service under maintenance, generation paused</code></td></tr><tr><td>504</td><td><code>timeout</code></td><td><code>timeout while waiting for audio generation</code></td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Batch实战]]></title>    <link>https://juejin.cn/post/7603575763786874906</link>    <guid>https://juejin.cn/post/7603575763786874906</guid>    <pubDate>2026-02-06T23:44:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575763786874906" data-draft-id="7603352117640134665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Batch实战"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2026-02-06T23:44:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Batch实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T23:44:29.000Z" title="Fri Feb 06 2026 23:44:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Batch实战</h2>
<h3 data-id="heading-1">前言</h3>
<p>在企业级应用中，批量数据处理是一个非常常见的需求。比如月底的工资代发、银行对账、数据报表生成等。当数据量达到几十万甚至上百万时，如何高效、可靠地处理这些数据，就成了一个技术挑战。</p>
<p>本文将以"50万笔工资代发"为实际场景，详细介绍如何使用Spring Batch框架来处理大规模批量数据，并重点讲解当处理失败时，如何实现<strong>部分回滚机制</strong>，确保已成功处理的数据不会因为少量失败记录而全部回滚。</p>
<hr/>
<h3 data-id="heading-2">一、什么是Spring Batch？</h3>
<h4 data-id="heading-3">1.1 Spring Batch简介</h4>
<p>Spring Batch是一个轻量级的、全面的批处理框架，由Spring团队开发，旨在帮助企业开发健壮的批处理应用程序。它于2008年首次发布，经过十多年的发展，已经成为Java批处理领域的事实标准。</p>
<p>Spring Batch的核心设计理念包括：</p>
<ul>
<li><strong>Chunk-oriented Processing（块级处理）</strong>：将大量数据分批处理，避免内存溢出</li>
<li><strong>事务管理</strong>：每个Chunk作为一个独立的事务，支持部分回滚</li>
<li><strong>容错机制</strong>：支持跳过（Skip）、重试（Retry）等容错策略</li>
<li><strong>作业调度</strong>：支持定时任务、手动触发等多种调度方式</li>
<li><strong>监控与统计</strong>：提供完整的执行记录和统计信息</li>
</ul>
<h4 data-id="heading-4">1.2 核心概念详解</h4>
<h5 data-id="heading-5">Job（作业）</h5>
<p>Job是批处理的核心概念，代表一个完整的批处理任务。一个Job可以包含多个Step，按顺序或并行执行。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
        .start(step1())
        .next(step2())
        .build();
}
</code></pre>
<h5 data-id="heading-6">Step（步骤）</h5>
<p>Step是Job的基本执行单元，每个Step包含：</p>
<ul>
<li><strong>ItemReader</strong>：读取数据</li>
<li><strong>ItemProcessor</strong>：处理数据（可选）</li>
<li><strong>ItemWriter</strong>：写入数据</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"salaryPaymentStep"</span>)
        .&lt;SalaryPayment, SalaryPayment&gt;chunk(<span class="hljs-number">1000</span>)
        .reader(reader())
        .processor(processor())
        .writer(writer())
        .build();
}
</code></pre>
<h5 data-id="heading-7">Chunk（数据块）</h5>
<p>Chunk是Spring Batch处理数据的基本单位。每次从Reader读取指定数量的记录，处理后一起提交到数据库：</p>
<pre><code class="hljs">读取1000条 → 处理1000条 → 写入1000条 → 提交事务
</code></pre>
<h4 data-id="heading-8">1.3 应用场景</h4>
<p>Spring Batch适用于以下典型场景：</p>






























<table><thead><tr><th>场景</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td>数据迁移</td><td>跨系统数据同步</td><td>从旧系统迁移数据到新系统</td></tr><tr><td>数据转换</td><td>ETL过程</td><td>从数据库读取、转换、写入数据仓库</td></tr><tr><td>批量处理</td><td>定期批量操作</td><td>月底工资代发、银行对账</td></tr><tr><td>报表生成</td><td>定期生成报表</td><td>每日交易汇总报表</td></tr></tbody></table>
<h4 data-id="heading-9">1.4 与其他框架对比</h4>









































<table><thead><tr><th>特性</th><th>Spring Batch</th><th>Quartz</th><th>Scheduled Executor</th></tr></thead><tbody><tr><td>批量处理</td><td>✅ 专用</td><td>需要</td><td>需要</td></tr><tr><td>事务管理</td><td>✅ 内置</td><td>无</td><td>无</td></tr><tr><td>容错机制</td><td>✅ 完善的Skip/Retry</td><td>无</td><td>无</td></tr><tr><td>监控统计</td><td>✅ 数据库持久化</td><td>基础</td><td>无</td></tr><tr><td>并行处理</td><td>✅ 多种模式</td><td>无</td><td>基础</td></tr></tbody></table>
<p><strong>为什么需要部分回滚？</strong></p>
<p>想象一下：你需要处理50万笔工资代发，如果第49万笔记录因为银行卡号错误而失败，在没有部分回滚机制的情况下，前面489,999笔已成功处理的数据会全部回滚！这对于业务来说是不可接受的。</p>
<hr/>
<h3 data-id="heading-10">二、系统架构设计</h3>
<p>为了实现50万笔工资代发的高效处理，我们设计了如下的系统架构：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcd00eb304e3405bba04e396f8f17e3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6U7zJ6OTXz6gkHUmSzFWbDGsk6w%3D" alt="" loading="lazy"/></p>
<p>上图展示了Spring Batch工资代发系统的分层架构：</p>
<ul>
<li><strong>Web层</strong>：提供监控面板，支持Job启动/停止、实时状态监控和统计信息查询</li>
<li><strong>Batch控制层</strong>：REST API接口，包含JobLauncher和JobRepository</li>
<li><strong>Spring Batch核心层</strong>：Job→Step→Chunk的处理流程，包含Reader、Processor、Writer三大组件</li>
<li><strong>数据存储层</strong>：MySQL数据库、CSV文件和Job执行日志</li>
</ul>
<h4 data-id="heading-11">2.1 核心组件说明</h4>



































<table><thead><tr><th>组件</th><th>职责</th><th>实现类</th></tr></thead><tbody><tr><td>Job</td><td>整个批处理任务</td><td>SalaryPaymentJob</td></tr><tr><td>Step</td><td>任务中的一个步骤</td><td>SalaryPaymentStep</td></tr><tr><td>ItemReader</td><td>数据读取器</td><td>FlatFileItemReader（读取CSV）</td></tr><tr><td>ItemProcessor</td><td>数据处理器</td><td>SalaryPaymentProcessor（数据验证）</td></tr><tr><td>ItemWriter</td><td>数据写入器</td><td>JdbcBatchItemWriter（批量写入数据库）</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-12">三、部分回滚机制原理</h3>
<h4 data-id="heading-13">3.1 Chunk-Oriented Processing</h4>
<p>Spring Batch采用**Chunk-Oriented Processing（块级处理）**模式，这是实现部分回滚的核心机制：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d084688d1ebe463c9652b1ba0d53c668~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=UuFoHlDwgOOpU%2FXE5sMRjhtTvc8%3D" alt="" loading="lazy"/></p>
<p>上图展示了Batch处理的核心流程：Reader读取数据 → Processor处理验证 → Writer批量写入，形成完整的处理管道。</p>
<p>对于50万笔数据的处理，Chunk机制的工作方式如下：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">50</span>万笔数据
    │
    ├─► Chunk <span class="hljs-number">1</span> (<span class="hljs-number">1</span>-<span class="hljs-number">1000</span>笔)   ──► 独立事务 ──► 成功提交
    ├─► Chunk <span class="hljs-number">2</span> (<span class="hljs-number">1001</span>-<span class="hljs-number">2000</span>笔) ──► 独立事务 ──► 成功提交
    ├─► Chunk <span class="hljs-number">3</span> (<span class="hljs-number">2001</span>-<span class="hljs-number">3000</span>笔) ──► 独立事务 ──► 第<span class="hljs-number">2500</span>笔失败 → 重试<span class="hljs-number">3</span>次 → 跳过 → 其余<span class="hljs-number">999</span>笔提交
    ├─► Chunk <span class="hljs-number">4</span> (<span class="hljs-number">3001</span>-<span class="hljs-number">4000</span>笔) ──► 独立事务 ──► 成功提交
    ...
    └─► Chunk <span class="hljs-number">500</span> (<span class="hljs-number">499001</span>-<span class="hljs-number">500000</span>笔) ──► 独立事务 ──► 成功提交

最终结果：<span class="hljs-number">499</span>,<span class="hljs-number">999</span>笔成功，<span class="hljs-number">1</span>笔被跳过
</code></pre>
<p><strong>关键配置：</strong></p>
<ul>
<li><strong>chunkSize</strong>: 1000（每1000笔提交一次）</li>
<li><strong>skipLimit</strong>: 100（最多跳过100笔失败记录）</li>
<li><strong>retryLimit</strong>: 3（每笔失败重试3次）</li>
</ul>
<h4 data-id="heading-14">3.2 事务边界与部分回滚</h4>
<p>每个Chunk是独立的事务单元，这是实现部分回滚的关键：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3cadc7def044954ab96efb3b4f174c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=tDesgDqGrq9SQu7Kbxsq%2FXq2ljQ%3D" alt="" loading="lazy"/></p>
<p>上图清晰地展示了事务边界和部分回滚的工作机制：</p>
<p><strong>事务规则：</strong></p>
<ul>
<li>Chunk内任意记录失败 → 整个Chunk回滚</li>
<li>重试成功 → 继续处理</li>
<li>重试失败且可跳过 → 跳过该记录，继续处理Chunk内剩余记录</li>
<li>跳过次数超限 → 整个Job失败</li>
</ul>
<p><strong>实际案例：</strong>
假设Chunk 3中有1000笔数据，第500笔验证失败：</p>
<ol>
<li>Spring Batch回滚整个Chunk 3</li>
<li>重新读取Chunk 3的1000笔数据</li>
<li>处理到第500笔时，捕获异常</li>
<li>重试3次后仍然失败</li>
<li>检查是否可跳过（IllegalArgumentException在跳过列表中）</li>
<li>跳过第500笔，继续处理501-1000笔</li>
<li>最终Chunk 3成功提交999笔，1笔被跳过</li>
</ol>
<h4 data-id="heading-15">3.3 容错策略配置</h4>
<pre><code class="hljs language-java" lang="java">.faultTolerant()                    <span class="hljs-comment">// 启用容错</span>
    .skipLimit(<span class="hljs-number">100</span>)                 <span class="hljs-comment">// 最多跳过100条</span>
    .skip(IllegalArgumentException.class)    <span class="hljs-comment">// 跳过数据验证异常</span>
    .skip(NullPointerException.class)        <span class="hljs-comment">// 跳过空指针异常</span>
    .retryLimit(<span class="hljs-number">3</span>)                  <span class="hljs-comment">// 失败重试3次</span>
    .retry(Exception.class)         <span class="hljs-comment">// 重试所有异常</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">四、50万笔工资代发数据处理流程</h3>
<p>在理解了部分回滚机制后，我们来看完整的工资代发数据处理流程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8b9318892e8425abf7d289b608db5bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=SIsXxsWk3rb%2BjcCk4aE465G5rXg%3D" alt="" loading="lazy"/></p>
<p>上图展示了从CSV文件读取到数据库写入的完整数据流，包含以下关键步骤：</p>
<ol>
<li><strong>数据读取</strong>：FlatFileItemReader读取CSV文件，每行映射为SalaryPayment对象</li>
<li><strong>数据验证</strong>：SalaryPaymentProcessor进行数据校验
<ul>
<li>员工ID非空验证</li>
<li>金额范围验证（0.01-100万）</li>
<li>银行卡号格式验证（16-19位数字）</li>
</ul>
</li>
<li><strong>状态更新</strong>：设置状态为PROCESSING，生成唯一交易ID</li>
<li><strong>批量写入</strong>：JdbcBatchItemWriter批量写入数据库</li>
<li><strong>异常处理</strong>：验证失败的记录被跳过，记录到失败列表</li>
</ol>
<hr/>
<h3 data-id="heading-17">五、核心代码实现</h3>
<h4 data-id="heading-18">5.1 Job配置</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentJobConfig</span> {

    <span class="hljs-meta">@Value("${batch.chunk.size:1000}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> chunkSize;  <span class="hljs-comment">// 每次处理的记录数</span>

    <span class="hljs-meta">@Value("${batch.skip.limit:100}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> skipLimit;  <span class="hljs-comment">// 跳过限制</span>

    <span class="hljs-meta">@Value("${batch.retry.limit:3}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> retryLimit; <span class="hljs-comment">// 重试次数</span>

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Step <span class="hljs-title function_">salaryPaymentStep</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> stepBuilderFactory
            .get(<span class="hljs-string">"salaryPaymentStep"</span>)
            .&lt;SalaryPayment, SalaryPayment&gt;chunk(chunkSize)
            .reader(salaryPaymentReader())
            .processor(salaryPaymentProcessor())
            .writer(salaryPaymentWriter())
            .faultTolerant()  <span class="hljs-comment">// 启用容错</span>
            .skipLimit(skipLimit)
            .skip(IllegalArgumentException.class)
            .skip(NullPointerException.class)
            .retryLimit(retryLimit)
            .retry(Exception.class)
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemReadListener</span>())
            .listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SalaryItemWriteListener</span>())
            .build();
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Job <span class="hljs-title function_">salaryPaymentJob</span><span class="hljs-params">(Step step, SalaryJobExecutionListener listener)</span> {
        <span class="hljs-keyword">return</span> jobBuilderFactory.get(<span class="hljs-string">"salaryPaymentJob"</span>)
            .incrementer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RunIdIncrementer</span>())
            .listener(listener)
            .start(step)
            .build();
    }
}
</code></pre>
<h4 data-id="heading-19">5.2 数据读取器</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> FlatFileItemReader&lt;SalaryPayment&gt; <span class="hljs-title function_">salaryPaymentReader</span><span class="hljs-params">()</span> {
    FlatFileItemReader&lt;SalaryPayment&gt; reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlatFileItemReader</span>&lt;&gt;();
    reader.setName(<span class="hljs-string">"salaryPaymentReader"</span>);
    reader.setResource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"input/salary-payments.csv"</span>));
    reader.setLinesToSkip(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 跳过CSV标题行</span>

    <span class="hljs-comment">// 设置列映射</span>
    <span class="hljs-type">DelimitedLineTokenizer</span> <span class="hljs-variable">tokenizer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelimitedLineTokenizer</span>();
    tokenizer.setNames(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[]{
        <span class="hljs-string">"employeeId"</span>, <span class="hljs-string">"employeeName"</span>, <span class="hljs-string">"accountNumber"</span>,
        <span class="hljs-string">"accountName"</span>, <span class="hljs-string">"bankName"</span>, <span class="hljs-string">"amount"</span>, <span class="hljs-string">"currency"</span>,
        <span class="hljs-string">"paymentDate"</span>, <span class="hljs-string">"remark"</span>
    });

    <span class="hljs-comment">// 设置字段映射</span>
    BeanWrapperFieldSetMapper&lt;SalaryPayment&gt; mapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanWrapperFieldSetMapper</span>&lt;&gt;();
    mapper.setTargetType(SalaryPayment.class);

    DefaultLineMapper&lt;SalaryPayment&gt; lineMapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultLineMapper</span>&lt;&gt;();
    lineMapper.setLineTokenizer(tokenizer);
    lineMapper.setFieldSetMapper(mapper);
    reader.setLineMapper(lineMapper);

    <span class="hljs-keyword">return</span> reader;
}
</code></pre>
<h4 data-id="heading-20">5.3 数据处理器（验证逻辑）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemProcessor</span>&lt;SalaryPayment, SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MIN_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.01"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">MAX_AMOUNT</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"1000000"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SalaryPayment <span class="hljs-title function_">process</span><span class="hljs-params">(SalaryPayment item)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. 数据验证</span>
        <span class="hljs-keyword">if</span> (item.getEmployeeId() == <span class="hljs-literal">null</span> || item.getEmployeeId().trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"员工ID不能为空"</span>);
        }

        <span class="hljs-comment">// 2. 金额验证</span>
        <span class="hljs-keyword">if</span> (item.getAmount() == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"发放金额不能为空"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MIN_AMOUNT) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"发放金额不能小于0.01元"</span>);
        }
        <span class="hljs-keyword">if</span> (item.getAmount().compareTo(MAX_AMOUNT) &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"发放金额不能大于100万元"</span>);
        }

        <span class="hljs-comment">// 3. 银行卡号验证</span>
        <span class="hljs-keyword">if</span> (item.getAccountNumber() == <span class="hljs-literal">null</span> ||
            item.getAccountNumber().length() &lt; <span class="hljs-number">16</span> ||
            item.getAccountNumber().length() &gt; <span class="hljs-number">19</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"银行账号长度必须在16-19位之间"</span>);
        }

        <span class="hljs-comment">// 4. 设置处理状态</span>
        item.setStatus(<span class="hljs-string">"PROCESSING"</span>);
        item.setTransactionId(<span class="hljs-string">"SAL"</span> + System.currentTimeMillis() + item.getEmployeeId());

        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
<h4 data-id="heading-21">5.4 数据写入器</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SalaryPaymentWriter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ItemWriter</span>&lt;SalaryPayment&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> JdbcBatchItemWriter&lt;SalaryPayment&gt; delegate;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SalaryPaymentWriter</span><span class="hljs-params">(DataSource dataSource)</span> {
        <span class="hljs-built_in">this</span>.delegate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JdbcBatchItemWriter</span>&lt;&gt;();
        <span class="hljs-built_in">this</span>.delegate.setDataSource(dataSource);
        <span class="hljs-built_in">this</span>.delegate.setSql(
            <span class="hljs-string">"INSERT INTO salary_payment "</span> +
            <span class="hljs-string">"(employee_id, employee_name, account_number, account_name, "</span> +
            <span class="hljs-string">"bank_name, amount, currency, payment_date, remark, "</span> +
            <span class="hljs-string">"status, transaction_id, create_time, update_time) "</span> +
            <span class="hljs-string">"VALUES (:employeeId, :employeeName, :accountNumber, :accountName, "</span> +
            <span class="hljs-string">":bankName, :amount, :currency, :paymentDate, :remark, "</span> +
            <span class="hljs-string">":status, :transactionId, :createTime, :updateTime)"</span>);
        <span class="hljs-built_in">this</span>.delegate.setItemSqlParameterSourceProvider(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanPropertyItemSqlParameterSourceProvider</span>&lt;&gt;()
        );
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(List&lt;? extends SalaryPayment&gt; items)</span> <span class="hljs-keyword">throws</span> Exception {
        delegate.write(items);
    }
}
</code></pre>
<h4 data-id="heading-22">5.5 自定义SkipPolicy</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PartialRollbackHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SkipPolicy</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SKIP_LIMIT</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">shouldSkip</span><span class="hljs-params">(Throwable throwable, <span class="hljs-type">int</span> skipCount)</span> {
        <span class="hljs-comment">// 超过跳过限制</span>
        <span class="hljs-keyword">if</span> (skipCount &gt;= SKIP_LIMIT) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 文件不存在，不能跳过</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FileNotFoundException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 数据格式错误，可以跳过</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> FlatFileParseException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">// 数据验证失败，可以跳过</span>
        <span class="hljs-keyword">if</span> (throwable <span class="hljs-keyword">instanceof</span> IllegalArgumentException ||
            throwable <span class="hljs-keyword">instanceof</span> NullPointerException) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-23">六、监控与调度架构</h3>
<p>除了数据处理，Spring Batch还提供了完善的监控和调度能力：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d4b1910c2744e1ae48875ce1ce6e31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=6ByRneA25pJ%2BsYmXWs9B49dsOdQ%3D" alt="" loading="lazy"/></p>
<p>上图展示了完整的监控与调度架构：</p>
<p><strong>调度层</strong>：支持三种调度方式</p>
<ul>
<li>Quartz调度器：支持分布式调度，适合集群环境</li>
<li>Spring Task调度：简单的定时任务，轻量级选择</li>
<li>Cron表达式：灵活的时间配置</li>
</ul>
<p><strong>执行层</strong>：核心执行组件</p>
<ul>
<li>JobLauncher：启动作业，创建执行上下文</li>
<li>JobOperator：操作作业，支持停止/重启/重试</li>
<li>StepExecution：步骤执行，采用Chunk处理模式</li>
<li>ThreadPoolExecutor：线程池，实现并发处理</li>
</ul>
<p><strong>监控层</strong>：监控与统计</p>
<ul>
<li>JobRepository：存储元数据（BATCH_JOB_INSTANCE、BATCH_JOB_EXECUTION、BATCH_STEP_EXECUTION）</li>
<li>JobExplorer：查询作业状态、获取执行历史</li>
<li>Metrics：处理记录数、执行时间、失败率统计</li>
</ul>
<p><strong>数据层</strong>：数据存储</p>
<ul>
<li>MySQL 8.0：存储元数据表、业务数据表、日志记录</li>
<li>Redis缓存：执行状态缓存、计数器、分布式锁</li>
</ul>
<hr/>
<h3 data-id="heading-24">七、数据库设计</h3>
<h4 data-id="heading-25">7.1 工资代发表</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> salary_payment (
    id <span class="hljs-type">BIGINT</span> AUTO_INCREMENT <span class="hljs-keyword">PRIMARY</span> KEY,
    employee_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'员工ID'</span>,
    employee_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'员工姓名'</span>,
    account_number <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'银行账号'</span>,
    account_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'账户名称'</span>,
    bank_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'开户行'</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'发放金额'</span>,
    currency <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'CNY'</span> COMMENT <span class="hljs-string">'币种'</span>,
    payment_date DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'发放日期'</span>,
    remark <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">500</span>) COMMENT <span class="hljs-string">'备注'</span>,
    status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span> COMMENT <span class="hljs-string">'状态'</span>,
    transaction_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) COMMENT <span class="hljs-string">'交易ID'</span>,
    error_message <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">1000</span>) COMMENT <span class="hljs-string">'错误信息'</span>,
    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    update_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
    INDEX idx_employee_id (employee_id),
    INDEX idx_status (status)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h4 data-id="heading-26">7.2 Spring Batch元表</h4>
<p>Spring Batch框架会自动创建以下元表来存储Job执行信息：</p>
<ul>
<li><code>batch_job_instance</code> - Job实例表</li>
<li><code>batch_job_execution</code> - Job执行表</li>
<li><code>batch_job_execution_params</code> - Job参数表</li>
<li><code>batch_step_execution</code> - Step执行表</li>
<li><code>batch_step_execution_context</code> - Step上下文表</li>
</ul>
<hr/>
<h3 data-id="heading-27">八、REST API设计</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/batch")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchJobController</span> {

    <span class="hljs-comment">// 启动Job</span>
    <span class="hljs-meta">@PostMapping("/start")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">startJob</span><span class="hljs-params">(
        <span class="hljs-meta">@RequestParam</span> String inputFile
    )</span> {
        <span class="hljs-type">JobParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobParametersBuilder</span>()
            .addLong(<span class="hljs-string">"startTime"</span>, System.currentTimeMillis())
            .addString(<span class="hljs-string">"inputFile"</span>, inputFile)
            .toJobParameters();
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobLauncher.run(salaryPaymentJob, params);
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// 获取Job状态</span>
    <span class="hljs-meta">@GetMapping("/status/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getJobStatus</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        <span class="hljs-comment">// 返回执行详情</span>
    }

    <span class="hljs-comment">// 停止Job</span>
    <span class="hljs-meta">@PostMapping("/stop/{jobExecutionId}")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">stopJob</span><span class="hljs-params">(
        <span class="hljs-meta">@PathVariable</span> Long jobExecutionId
    )</span> {
        <span class="hljs-type">JobExecution</span> <span class="hljs-variable">execution</span> <span class="hljs-operator">=</span> jobRepository.getJobExecution(jobExecutionId);
        execution.stop();
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    }

    <span class="hljs-comment">// 获取统计信息</span>
    <span class="hljs-meta">@GetMapping("/statistics")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">getStatistics</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 返回总数、成功数、失败数等统计</span>
    }

    <span class="hljs-comment">// 健康检查</span>
    <span class="hljs-meta">@GetMapping("/health")</span>
    <span class="hljs-keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 返回系统健康状态</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">九、性能优化与并行处理</h3>
<p>当数据量达到50万甚至更多时，单线程处理可能成为瓶颈。Spring Batch提供了多种并行处理方式。</p>
<h4 data-id="heading-29">9.1 多线程并发处理</h4>
<p>Spring Batch支持多线程并发处理，大幅提升处理效率：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/316e23bab05d4fe596fe18021513b6c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=0BkUFvIWBtjJgwbQoXjOKq2s7MQ%3D" alt="" loading="lazy"/></p>
<p>上图展示了多线程并发处理的工作原理：</p>
<p><strong>核心机制：</strong></p>
<ul>
<li><strong>主线程</strong>：创建线程池，分配任务</li>
<li><strong>工作线程</strong>：并发执行多个Step或Chunk</li>
<li><strong>线程安全</strong>：JobRepository保证线程安全的状态管理</li>
<li><strong>负载均衡</strong>：任务均匀分配到各个线程</li>
</ul>
<p><strong>配置示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> TaskExecutor <span class="hljs-title function_">taskExecutor</span><span class="hljs-params">()</span> {
    <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
    executor.setCorePoolSize(<span class="hljs-number">5</span>);
    executor.setMaxPoolSize(<span class="hljs-number">10</span>);
    executor.setQueueCapacity(<span class="hljs-number">100</span>);
    executor.setThreadNamePrefix(<span class="hljs-string">"salary-batch-"</span>);
    executor.initialize();
    <span class="hljs-keyword">return</span> executor;
}

<span class="hljs-comment">// 在Step中使用</span>
.step(stepName)
.chunk(chunkSize)
.taskExecutor(taskExecutor())
.throttleLimit(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 限制并发数</span>
.build();
</code></pre>
<h4 data-id="heading-30">9.2 分区处理（Partitioning）</h4>
<p>对于超大数据集，可以使用分区处理实现更高程度的并行：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2a8815f01144f197a00ba5ad2c0802~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771026268&amp;x-signature=9I%2BjxPUBFL%2B5Vi3qT9oI4Xub9sM%3D" alt="" loading="lazy"/></p>
<p>上图展示了分区处理的架构：</p>
<p><strong>核心组件：</strong></p>
<ul>
<li><strong>Master Step</strong>：负责创建和管理分区</li>
<li><strong>Slave Step</strong>：每个分区独立执行</li>
<li><strong>Partitioner</strong>：将数据分成多个分区</li>
<li><strong>TaskExecutor</strong>：线程池执行分区任务</li>
</ul>
<p><strong>配置示例：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), rangePartitioner(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 分成10个分区</span>
        .taskExecutor(taskExecutor())
        .build();
}

<span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Partitioner <span class="hljs-title function_">rangePartitioner</span><span class="hljs-params">(<span class="hljs-type">int</span> min, <span class="hljs-type">int</span> max)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Partitioner</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> Map&lt;String, ExecutionContext&gt; <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span> gridSize)</span> {
            Map&lt;String, ExecutionContext&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-type">int</span> <span class="hljs-variable">range</span> <span class="hljs-operator">=</span> (max - min) / gridSize;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; gridSize; i++) {
                <span class="hljs-type">ExecutionContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionContext</span>();
                context.putInt(<span class="hljs-string">"minValue"</span>, min + i * range);
                context.putInt(<span class="hljs-string">"maxValue"</span>, min + (i + <span class="hljs-number">1</span>) * range - <span class="hljs-number">1</span>);
                result.put(<span class="hljs-string">"partition"</span> + i, context);
            }
            <span class="hljs-keyword">return</span> result;
        }
    };
}
</code></pre>
<h4 data-id="heading-31">9.3 调优参数</h4>






























<table><thead><tr><th>参数</th><th>推荐值</th><th>说明</th></tr></thead><tbody><tr><td>chunkSize</td><td>1000-5000</td><td>根据记录大小调整，越大吞吐量越高但内存占用也越大</td></tr><tr><td>skipLimit</td><td>100-500</td><td>根据数据质量设置</td></tr><tr><td>retryLimit</td><td>3-5</td><td>过多会浪费时间，过少可能误判暂时性故障</td></tr><tr><td>线程池大小</td><td>CPU核心数*2</td><td>用于多线程处理</td></tr></tbody></table>
<h4 data-id="heading-32">9.4 批量写入优化</h4>
<p>使用JDBC批量操作代替单条插入：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 单条插入（慢）</span>
<span class="hljs-keyword">for</span> (SalaryPayment p : payments) {
    jdbcTemplate.update(sql, p.getId(), p.getName(), ...);
}

<span class="hljs-comment">// 批量插入（快）</span>
jdbcTemplate.batchUpdate(sql, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BatchPreparedStatementSetter</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValues</span><span class="hljs-params">(PreparedStatement ps, <span class="hljs-type">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException {
        <span class="hljs-comment">// 设置参数</span>
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBatchSize</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> payments.size();
    }
});
</code></pre>
<h4 data-id="heading-33">9.5 索引优化</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 为常用查询字段添加索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_employee_id <span class="hljs-keyword">ON</span> salary_payment(employee_id);
<span class="hljs-keyword">CREATE</span> INDEX idx_status <span class="hljs-keyword">ON</span> salary_payment(status);
<span class="hljs-keyword">CREATE</span> INDEX idx_create_time <span class="hljs-keyword">ON</span> salary_payment(create_time);

<span class="hljs-comment">-- 复合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_status_employee <span class="hljs-keyword">ON</span> salary_payment(status, employee_id);
</code></pre>
<hr/>
<h3 data-id="heading-34">十、实际应用场景</h3>
<h4 data-id="heading-35">场景1：月底工资代发</h4>
<p>某公司月底需要为50,000名员工发放工资，使用Spring Batch：</p>
<ul>
<li>设置chunkSize=1000，分成50个Chunk处理</li>
<li>假设第23个Chunk中第23,456号员工银行卡号错误</li>
<li>系统重试3次后跳过该记录</li>
<li>最终结果：49,999笔成功，1笔记录到失败列表供后续处理</li>
</ul>
<h4 data-id="heading-36">场景2：银行对账文件处理</h4>
<p>银行提供100万笔交易对账文件：</p>
<ul>
<li>设置chunkSize=5000，提高处理效率</li>
<li>使用多线程并发处理（Partitioning）</li>
<li>完成后生成对账差异报告</li>
</ul>
<h4 data-id="heading-37">场景3：数据报表生成</h4>
<p>每天凌晨生成T+1交易报表：</p>
<ul>
<li>使用Spring Task定时调度</li>
<li>读取当日交易数据</li>
<li>生成Excel报表并发送邮件</li>
</ul>
<hr/>
<h3 data-id="heading-38">十一、常见问题与解决方案</h3>
<h4 data-id="heading-39">Q1: Job执行一半挂了怎么办？</h4>
<p>Spring Batch支持Job重启。通过JobRepository记录的执行状态，可以从上次失败的位置继续执行：</p>
<pre><code class="hljs language-java" lang="java">.job(salaryPaymentJob)
    .allowStartIfComplete(<span class="hljs-literal">false</span>)  <span class="hljs-comment">// 已完成的Job不重新执行</span>
    .restartable(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// 允许重启</span>
</code></pre>
<h4 data-id="heading-40">Q2: 如何实现并行处理？</h4>
<p>使用Partitioning方式实现多线程并行处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Bean</span>
<span class="hljs-keyword">public</span> Step <span class="hljs-title function_">masterStep</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> stepBuilderFactory.get(<span class="hljs-string">"masterStep"</span>)
        .partitioner(slaveStep().getName(), partitioner())
        .step(slaveStep())
        .gridSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 分成10个分区并行处理</span>
        .taskExecutor(taskExecutor())
        .build();
}
</code></pre>
<h4 data-id="heading-41">Q3: 处理失败的数据如何重试？</h4>
<p>可以通过以下方式重试：</p>
<ol>
<li>查询status='FAILED'的记录</li>
<li>修正错误数据</li>
<li>将status改回'PENDING'</li>
<li>重新执行Job</li>
</ol>
<hr/>
<h3 data-id="heading-42">十二、总结</h3>
<p>Spring Batch作为成熟的批处理框架，提供了完整的解决方案来处理大规模批量数据。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>银行对账、清算</li>
<li>工资代发、批量转账</li>
<li>报表生成、数据导出</li>
</ul>
<p><strong>注意事项：</strong></p>
<ul>
<li>合理设置chunkSize，平衡内存和性能</li>
<li>配置合适的Skip和Retry策略</li>
<li>做好失败记录的重处理机制</li>
<li>定期清理Job执行历史数据</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3基础：函数基础，解锁模块化编程新技能]]></title>    <link>https://juejin.cn/post/7603563360329465898</link>    <guid>https://juejin.cn/post/7603563360329465898</guid>    <pubDate>2026-02-06T15:08:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329465898" data-draft-id="7603563317040480319" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3基础：函数基础，解锁模块化编程新技能"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-02-06T15:08:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3基础：函数基础，解锁模块化编程新技能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:08:24.000Z" title="Fri Feb 06 2026 15:08:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第五阶段：函数基础，解锁模块化编程新技能</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
<p>🔥豆包AI</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>在第四阶段，我们吃透了列表、元组、字典、集合四大容器，还掌握了字符串高级操作，能够高效存储和处理各类数据。但在实际编程中，我们常会遇到重复使用的代码——比如多次筛选列表中的有效数据、反复计算不同数值的求和/平均值、批量格式化输出内容，逐行编写不仅繁琐，还容易出错、难以修改。</p>
<p>而第五阶段我们要重点攻克的「函数基础」，就是解决这一问题的“神器”。函数的核心作用是<strong>代码复用与模块化</strong>：将重复逻辑封装成一个“代码模块”，一次定义、多次调用，既能减少重复代码量，还能让代码结构更清晰、更易维护。这也是Python编程从“零散代码”走向“规范编程”的关键一步，为后续学习函数进阶、面向对象、模块与包打下坚实基础。</p>
<p>本次第五阶段，我们将严格按照「函数定义与调用→函数参数→函数返回值→局部变量与全局变量→匿名函数→函数嵌套与递归（基础版）」的节奏，每个知识点都搭配可直接复制运行的代码示例、通俗解析和新手避坑技巧，全程贴合新手学习节奏，跟着敲代码、练案例，就能轻松吃透函数基础～</p>
<h3 data-id="heading-2">1、函数的定义与调用：从“零散代码”到“模块化封装”</h3>
<p>简单来说，函数就是“提前写好的、可重复调用的代码块”——就像工厂里的“标准化生产线”，提前设定好流程（代码逻辑），每次投入原材料（参数），就能产出对应产品（结果）。Python中定义函数必须使用 <code>def</code> 关键字，语法固定，新手只需牢记模板即可。</p>
<h4 data-id="heading-3">1.1 函数的定义（固定模板）</h4>
<p>定义函数的核心语法（新手必背）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 函数定义模板</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">函数名</span>(<span class="hljs-params">参数列表</span>):
    <span class="hljs-string">"""函数文档字符串（可选，用于说明函数功能、参数、返回值）"""</span>
    <span class="hljs-comment"># 函数体（要执行的代码逻辑）</span>
    代码块
    <span class="hljs-comment"># 返回值（可选，用return语句，后续详解）</span>
</code></pre>
<p>解析每个部分的作用，新手一看就懂：</p>
<ul>
<li><code>def</code>：定义函数的关键字，必须放在最前面（相当于“声明这是一个函数”）；</li>
<li>函数名：遵循变量命名规范（字母、数字、下划线组成，不能以数字开头，不能用Python关键字，如def、if），建议见名知意（比如计算求和的函数叫sum_nums，一目了然）；</li>
<li>参数列表：括号内的内容，可选（无参数则括号为空），用于接收外部传入的“原材料”，后续详细讲解；</li>
<li>文档字符串：用三引号包裹，可选，用于说明函数功能，方便自己和他人查看（调用时用help(函数名)可查看）；</li>
<li>函数体：缩进的代码块（推荐4个空格，和if、for循环缩进一致），是函数的核心逻辑，调用函数时会执行这里的代码；</li>
<li>返回值：用return语句，可选，用于将函数的执行结果返回给调用者，没有return则默认返回None。</li>
</ul>
<p>新手入门示例（两个基础函数，可直接复制运行）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：无参数、无返回值的函数（仅执行简单操作）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>():
    <span class="hljs-string">"""无参数函数，用于输出问候语"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, Python! 欢迎学习第五阶段函数基础～"</span>)

<span class="hljs-comment"># 示例2：有参数、无返回值的函数（接收参数，执行操作）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_name</span>(<span class="hljs-params">name</span>):
    <span class="hljs-string">"""有参数函数，用于输出传入的姓名
    参数：name -- 要输出的姓名（字符串类型）
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"我的名字是：<span class="hljs-subst">{name}</span>"</span>)

<span class="hljs-comment"># 示例3：有参数、有简单逻辑的函数（计算两个数的和，暂时不返回结果）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""计算两个数的和，并打印结果
    参数：a -- 第一个数字，b -- 第二个数字
    """</span>
    result = a + b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> + <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)
</code></pre>
<h4 data-id="heading-4">1.2 函数的调用（核心：定义后必须调用才会执行）</h4>
<p>函数定义后，只是“写好了生产线”，不会自动执行，必须通过「函数名(参数)」的方式调用，才能触发函数体的执行——这是新手最容易忽略的点！调用语法和参数传递，要和函数定义时的参数列表对应。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 调用示例1：调用无参数函数（括号为空，无需传参）</span>
greet()  <span class="hljs-comment"># 输出：Hello, Python! 欢迎学习第五阶段函数基础～</span>

<span class="hljs-comment"># 调用示例2：调用有一个参数的函数（必须传入1个参数，与定义时的name对应）</span>
print_name(<span class="hljs-string">"张三"</span>)  <span class="hljs-comment"># 输出：我的名字是：张三</span>
print_name(<span class="hljs-string">"李四"</span>)  <span class="hljs-comment"># 输出：我的名字是：李四</span>

<span class="hljs-comment"># 调用示例3：调用有两个参数的函数（必须传入2个参数，与定义时的a、b对应）</span>
add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 输出：3 + 5 = 8</span>
add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)  <span class="hljs-comment"># 输出：10 + 20 = 30</span>

<span class="hljs-comment"># 查看函数文档字符串（新手必备，忘记函数功能时使用）</span>
<span class="hljs-built_in">help</span>(print_name)  <span class="hljs-comment"># 输出函数的文档说明，包含参数解释</span>
</code></pre>
<h4 data-id="heading-5">3. 新手避坑指南（必看）</h4>
<ul>
<li>避坑1：函数名不能用Python关键字（如def、if、for、list），否则会报错；</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">if</span>():
  File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">if</span>():
        ^^
SyntaxError: invalid synta
</code></pre>
<ul>
<li>避坑2：函数体必须缩进（4个空格），不缩进会被视为普通代码，且报错；</li>
<li>避坑3：定义函数后，必须调用才会执行，只定义不调用，函数体的代码永远不会运行；</li>
<li>避坑4：调用函数时，传入的参数个数、类型，要和函数定义时的参数列表对应（比如add(a,b)必须传2个参数，不能多也不能少）。</li>
</ul>
<h3 data-id="heading-6">2 函数参数：灵活传递“原材料”，适配不同场景</h3>
<p>函数的参数，就是函数与外部交互的“接口”——通过参数，我们可以向函数传递不同的数据，让同一个函数实现不同的功能（比如add(a,b)，传入3和5得到8，传入10和20得到30）。</p>
<p>按照使用场景，我们重点掌握4种核心参数类型，按“基础→进阶”的顺序讲解，每个类型配代码、解析区别，新手可逐步掌握：<strong>位置参数、关键字参数、默认参数、可变参数</strong>，结合参考资料中的参数用法，简化适配新手学习。</p>
<h4 data-id="heading-7">2.1 位置参数（最基础、最常用）</h4>
<p>位置参数，也叫“必选参数”，是最基础的参数类型，特点是：<strong>调用时必须按函数定义的参数顺序传参，参数个数必须一致</strong>，缺一不可、多一不可，就像“按顺序排队”一样。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义一个计算两个数差值的函数（位置参数示例）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""计算a - b的差值，a和b都是位置参数"""</span>
    result = a - b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> - <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># 正确调用：按参数顺序传参（a=10，b=5）</span>
subtract(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 输出：10 - 5 = 5</span>

<span class="hljs-comment"># 正确调用：按参数顺序传参（a=20，b=8）</span>
subtract(<span class="hljs-number">20</span>, <span class="hljs-number">8</span>)  <span class="hljs-comment"># 输出：20 - 8 = 12</span>

<span class="hljs-comment"># 错误调用1：参数个数不足（少传1个参数）</span>
<span class="hljs-comment"># subtract(10)  # 报错：missing 1 required positional argument: 'b'</span>

<span class="hljs-comment"># 错误调用2：参数个数过多（多传1个参数）</span>
<span class="hljs-comment"># subtract(10, 5, 3)  # 报错：takes 2 positional arguments but 3 were given</span>

<span class="hljs-comment"># 错误调用3：参数顺序颠倒（得到错误结果，不报错但逻辑错误）</span>
subtract(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)  <span class="hljs-comment"># 输出：5 - 10 = -5（顺序错，结果错）</span>
</code></pre>
<p>核心总结：位置参数“按顺序、定个数”，调用时必须严格匹配函数定义的参数顺序和个数，新手优先掌握这种参数用法。</p>
<h4 data-id="heading-8">2.2 关键字参数（更灵活，无需记顺序）</h4>
<p>关键字参数，是在调用函数时，通过「参数名=参数值」的方式传参，特点是：<strong>无需按参数顺序传参，只要参数名正确，就能匹配到对应的参数</strong>，适合参数较多的场景，避免记混顺序。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 复用上面的subtract函数（a和b是位置参数，调用时可改用关键字参数）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    result = a - b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{a}</span> - <span class="hljs-subst">{b}</span> = <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-comment"># 正确调用1：全部用关键字参数（顺序可颠倒）</span>
subtract(a=<span class="hljs-number">10</span>, b=<span class="hljs-number">5</span>)  <span class="hljs-comment"># 输出：10 - 5 = 5</span>
subtract(b=<span class="hljs-number">5</span>, a=<span class="hljs-number">10</span>)  <span class="hljs-comment"># 输出：10 - 5 = 5（顺序颠倒，结果正确）</span>

<span class="hljs-comment"># 正确调用2：位置参数和关键字参数混合使用（重点：位置参数必须在关键字参数前面）</span>
subtract(<span class="hljs-number">10</span>, b=<span class="hljs-number">5</span>)  <span class="hljs-comment"># 输出：10 - 5 = 5（a用位置参数，b用关键字参数）</span>

<span class="hljs-comment"># 错误调用：关键字参数在位置参数前面（顺序错误）</span>
<span class="hljs-comment"># subtract(a=10, 5)  # 报错：positional argument follows keyword argument</span>
</code></pre>
<p>核心总结：关键字参数“按名字、不按顺序”，混合使用时，位置参数必须在关键字参数前面，新手可在参数较多时优先使用，减少出错。</p>
<h4 data-id="heading-9">2.3 默认参数（可选传参，简化调用）</h4>
<p>默认参数，是在函数定义时，给参数指定一个“默认值”，特点是：<strong>调用函数时，可传参（覆盖默认值），也可不传参（使用默认值）</strong>，适合参数值经常重复的场景，能简化函数调用。</p>
<p>重点规则：默认参数必须放在<strong>位置参数的后面</strong>（否则报错），参考资料中默认参数的用法，适配新手编写简单案例。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 定义一个计算折扣价的函数（默认参数示例）</span>
<span class="hljs-comment"># price：位置参数（必传），discount：默认参数（默认0.9，即9折）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_discount</span>(<span class="hljs-params">price, discount=<span class="hljs-number">0.9</span></span>):
    <span class="hljs-string">"""计算商品折扣价
    参数：price -- 商品原价（必传，位置参数）
          discount -- 折扣率（可选，默认0.9，即9折）
    """</span>
    final_price = price * discount
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"商品原价：<span class="hljs-subst">{price}</span>元，折扣率：<span class="hljs-subst">{discount}</span>，折后价：<span class="hljs-subst">{final_price}</span>元"</span>)

<span class="hljs-comment"># 调用1：不传默认参数（使用默认折扣0.9）</span>
calculate_discount(<span class="hljs-number">100</span>)  <span class="hljs-comment"># 输出：商品原价：100元，折扣率：0.9，折后价：90.0元</span>

<span class="hljs-comment"># 调用2：传默认参数（覆盖默认值，比如8折）</span>
calculate_discount(<span class="hljs-number">100</span>, <span class="hljs-number">0.8</span>)  <span class="hljs-comment"># 输出：折后价：80.0元</span>

<span class="hljs-comment"># 调用3：用关键字参数传默认参数（更清晰）</span>
calculate_discount(<span class="hljs-number">100</span>, discount=<span class="hljs-number">0.7</span>)  <span class="hljs-comment"># 输出：折后价：70.0元</span>

<span class="hljs-comment"># 错误定义：默认参数放在位置参数前面（顺序错误）</span>
<span class="hljs-comment"># def calculate_discount(discount=0.9, price):  # 报错：non-default argument follows default argument</span>
</code></pre>
<p>新手避坑：默认参数的默认值，最好是不可变类型（如数字、字符串、元组），不要用列表、字典等可变类型（会出现意想不到的错误，后续进阶再详细讲解）。</p>
<h4 data-id="heading-10">2.4 可变参数（不定个数，灵活适配）</h4>
<p>可变参数，是指函数调用时，传入的参数个数可以任意（0个、1个、多个），适合参数个数不确定的场景（比如计算多个数的总和、打印多个信息）。Python中常用两种可变参数：</p>
<ul>
<li><code>*args</code>：接收任意个数的<strong>位置参数</strong>，传入后会自动打包成一个<strong>元组</strong>；</li>
<li><code>**kwargs</code>：接收任意个数的<strong>关键字参数</strong>，传入后会自动打包成一个<strong>字典</strong>。</li>
</ul>
<p>重点：<code>*args</code> 和 <code>**kwargs</code> 只是约定俗成的名字，args和kwargs可以换成其他名字，但星号*和**不能少，参考资料中可变参数的案例，简化后适配新手。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：*args 接收任意个数的位置参数（计算多个数的总和）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sum_nums</span>(<span class="hljs-params">*args</span>):
    <span class="hljs-string">"""计算任意个数的总和，*args接收位置参数，打包成元组"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"传入的参数打包成元组："</span>, args)  <span class="hljs-comment"># 查看args的类型（元组）</span>
    total = <span class="hljs-built_in">sum</span>(args)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"所有数的总和：<span class="hljs-subst">{total}</span>"</span>)

<span class="hljs-comment"># 调用：可传0个、1个、多个参数</span>
sum_nums()  <span class="hljs-comment"># 输出：总和：0（args为空元组）</span>
sum_nums(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># 输出：总和：6（args=(1,2,3)）</span>
sum_nums(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>)  <span class="hljs-comment"># 输出：总和：100（args=(10,20,30,40)）</span>

<span class="hljs-comment"># 示例2：**kwargs 接收任意个数的关键字参数（打印用户信息）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_user_info</span>(<span class="hljs-params">**kwargs</span>):
    <span class="hljs-string">"""打印用户信息，**kwargs接收关键字参数，打包成字典"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"传入的参数打包成字典："</span>, kwargs)  <span class="hljs-comment"># 查看kwargs的类型（字典）</span>
    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> kwargs.items():
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{key}</span>：<span class="hljs-subst">{value}</span>"</span>)

<span class="hljs-comment"># 调用：可传0个、1个、多个关键字参数</span>
print_user_info(name=<span class="hljs-string">"张三"</span>, age=<span class="hljs-number">18</span>, gender=<span class="hljs-string">"男"</span>, score=<span class="hljs-number">95</span>)
<span class="hljs-comment"># 输出：name：张三，age：18，gender：男，score：95（kwargs是对应的字典）</span>
print_user_info()  <span class="hljs-comment"># 输出：无信息（kwargs为空字典）</span>

<span class="hljs-comment"># 示例3：*args 和 **kwargs 混合使用（接收任意位置参数和关键字参数）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">mix_params</span>(<span class="hljs-params">a, b, *args, **kwargs</span>):
    <span class="hljs-string">"""混合使用多种参数，顺序：位置参数 → *args → **kwargs（必记）"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"位置参数a：<span class="hljs-subst">{a}</span>，b：<span class="hljs-subst">{b}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"可变位置参数args：<span class="hljs-subst">{args}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"可变关键字参数kwargs：<span class="hljs-subst">{kwargs}</span>"</span>)

<span class="hljs-comment"># 调用：按顺序传参</span>
mix_params(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, name=<span class="hljs-string">"张三"</span>, age=<span class="hljs-number">18</span>)
<span class="hljs-comment"># 输出：a=1, b=2；args=(3,4,5)；kwargs={'name':'张三','age':18}</span>
</code></pre>
<p>核心总结：可变参数适合“参数个数不确定”的场景，<code>*args</code> 对应元组，<code>**kwargs</code> 对应字典，混合使用时，参数顺序必须是：**位置参数 → 默认参数 → *args → <strong>kwargs</strong>（新手记牢这个顺序，避免报错）。</p>
<h3 data-id="heading-11">3 函数返回值：用return语句，获取函数的“执行结果”</h3>
<p>前面我们写的函数，大多是“执行操作并打印结果”，但在实际编程中，我们常常需要将函数的执行结果保存起来，用于后续的计算、判断等操作——这就需要用到函数的返回值，return语句就是函数的“输出口”，负责将函数内部的结果传递给调用者，参考资料4中return的用法，拆解成新手易懂的知识点。</p>
<h4 data-id="heading-12">3.1 return语句的基础用法（核心）</h4>
<p>语法：<code>return 结果</code>，作用有两个：① 将“结果”返回给函数调用者；② 终止函数执行（return后面的代码，永远不会运行）。</p>
<p>重点：如果函数没有return语句，默认返回 <code>None</code>（Python中的空值，相当于“无结果”）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：有return语句的函数（返回两个数的和，用于后续计算）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""计算a + b的和，并用return返回结果"""</span>
    result = a + b
    <span class="hljs-keyword">return</span> result  <span class="hljs-comment"># 返回计算结果</span>
    <span class="hljs-comment"># return后面的代码不会执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"这句话永远不会被执行！"</span>)

<span class="hljs-comment"># 调用函数，接收返回值（将return的结果赋值给变量total）</span>
total1 = add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3+5的和：<span class="hljs-subst">{total1}</span>"</span>)  <span class="hljs-comment"># 输出：8</span>
<span class="hljs-comment"># 用返回值进行后续计算</span>
total2 = add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"10+20的和乘以2：<span class="hljs-subst">{total2 * <span class="hljs-number">2</span>}</span>"</span>)  <span class="hljs-comment"># 输出：60</span>

<span class="hljs-comment"># 示例2：无return语句的函数（默认返回None）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_hello</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, Python!"</span>)

<span class="hljs-comment"># 接收返回值（默认是None）</span>
res = print_hello()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数的返回值：<span class="hljs-subst">{res}</span>"</span>)  <span class="hljs-comment"># 输出：None</span>

<span class="hljs-comment"># 示例3：return终止函数执行</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">judge_num</span>(<span class="hljs-params">num</span>):
    <span class="hljs-keyword">if</span> num &gt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"正数"</span>  <span class="hljs-comment"># 满足条件，返回结果，终止函数</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"这句话在num&gt;0时，不会执行！"</span>)
    <span class="hljs-keyword">if</span> num == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"零"</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"负数"</span>

<span class="hljs-built_in">print</span>(judge_num(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出：正数（return后面的代码未执行）</span>
</code></pre>
<h4 data-id="heading-13">3.2 return返回多个值（实用技巧）</h4>
<p>Python中，return可以返回多个值，用逗号分隔即可——本质上，return返回的是一个<strong>元组</strong>，调用时可以用多个变量“解包”接收，非常实用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例：一个函数返回多个结果（计算两个数的加、减、乘、除）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calc</span>(<span class="hljs-params">a, b</span>):
    add_res = a + b
    sub_res = a - b
    mul_res = a * b
    div_res = a / b <span class="hljs-keyword">if</span> b != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"除数不能为0"</span>
    <span class="hljs-comment"># 返回多个值，用逗号分隔</span>
    <span class="hljs-keyword">return</span> add_res, sub_res, mul_res, div_res

<span class="hljs-comment"># 方式1：用多个变量解包接收（推荐，清晰直观）</span>
add_r, sub_r, mul_r, div_r = calc(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"加法：<span class="hljs-subst">{add_r}</span>，减法：<span class="hljs-subst">{sub_r}</span>，乘法：<span class="hljs-subst">{mul_r}</span>，除法：<span class="hljs-subst">{div_r}</span>"</span>)
<span class="hljs-comment"># 输出：加法：15，减法：5，乘法：50，除法：2.0</span>

<span class="hljs-comment"># 方式2：用一个变量接收（得到的是元组）</span>
all_res = calc(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"所有结果（元组）：<span class="hljs-subst">{all_res}</span>"</span>)  <span class="hljs-comment"># 输出：(15, 5, 50, 2.0)</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"乘法结果：<span class="hljs-subst">{all_res[<span class="hljs-number">2</span>]}</span>"</span>)  <span class="hljs-comment"># 输出：50（通过索引获取元组中的值）</span>

<span class="hljs-comment"># 处理除数为0的情况</span>
add_r2, sub_r2, mul_r2, div_r2 = calc(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(div_r2)  <span class="hljs-comment"># 输出：除数不能为0</span>
</code></pre>
<h4 data-id="heading-14">3.3 新手避坑指南</h4>
<ul>
<li>避坑1：return和print的区别（新手最易混淆）——print只是“打印结果到屏幕”，不会返回任何值；return是“将结果返回给调用者”，可以用于后续计算；</li>
<li>避坑2：return后面的代码不会执行，不要在return后面写逻辑代码；</li>
<li>避坑3：return返回多个值时，调用者可以用任意个数的变量接收（少接收会报错，多接收可用*args接收剩余值）；</li>
<li>避坑4：函数中可以有多个return语句，但只有第一个被执行的return会生效（因为return会终止函数）。</li>
</ul>
<h3 data-id="heading-15">4 局部变量与全局变量：搞懂“变量的作用范围”，避免报错</h3>
<p>在函数学习中，新手很容易遇到“变量找不到”“变量修改无效”的问题，核心原因是没搞懂「变量的作用范围」——变量分为局部变量和全局变量，各自有不同的作用域（即“能被访问的范围”），结合参考资料1和3中局部与全局变量的案例，简化讲解，重点突破新手痛点。</p>
<h4 data-id="heading-16">4.1 局部变量（函数内部的“临时变量”）</h4>
<p>局部变量：在<strong>函数内部</strong>定义的变量，作用域仅限于函数内部（只能在函数内部访问、修改，函数执行结束后，局部变量会被销毁，外部无法访问）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 局部变量示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-comment"># result是在函数内部定义的，属于局部变量</span>
    result = a + b
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数内部访问局部变量result：<span class="hljs-subst">{result}</span>"</span>)  <span class="hljs-comment"># 正确：函数内部可访问</span>

<span class="hljs-comment"># 调用函数</span>
add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)  <span class="hljs-comment"># 输出：函数内部访问局部变量result：8</span>

<span class="hljs-comment"># 错误：函数外部访问局部变量（超出作用域）</span>
<span class="hljs-comment"># print(f"函数外部访问局部变量result：{result}")  # 报错：name 'result' is not defined</span>
</code></pre>
<p>核心：局部变量是函数内部的“临时变量”，仅供函数内部使用，外部无法访问，函数执行完就消失。</p>
<h4 data-id="heading-17">4.2 全局变量（函数外部的“公共变量”）</h4>
<p>全局变量：在<strong>函数外部</strong>定义的变量，作用域是整个程序（既能在函数外部访问、修改，也能在函数内部访问，但不能直接修改，需要用关键字声明）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 全局变量示例（在函数外部定义）</span>
global_num = <span class="hljs-number">100</span>  <span class="hljs-comment"># global_num是全局变量</span>

<span class="hljs-comment"># 函数内部访问全局变量（无需声明，直接访问）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_global</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数内部访问全局变量global_num：<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># 正确：可直接访问</span>

<span class="hljs-comment"># 函数外部访问全局变量（直接访问）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数外部访问全局变量global_num：<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># 输出：100</span>

<span class="hljs-comment"># 调用函数</span>
print_global()  <span class="hljs-comment"># 输出：函数内部访问全局变量global_num：100</span>
</code></pre>
<h4 data-id="heading-18">4.3 重点：函数内部修改全局变量（必须用global关键字）</h4>
<p>新手最易踩坑：函数内部<strong>不能直接修改全局变量</strong>——如果在函数内部直接给全局变量赋值，Python会认为你是在定义一个“新的局部变量”，而不是修改全局变量，此时会报错或出现逻辑错误。</p>
<p>解决方法：在函数内部，用 <code>global 全局变量名</code> 声明该变量是全局变量，然后再修改。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：错误修改全局变量（未用global声明）</span>
global_num = <span class="hljs-number">100</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">wrong_modify</span>():
    <span class="hljs-comment"># 错误：未声明global，Python认为是定义局部变量</span>
    global_num = <span class="hljs-number">200</span>  <span class="hljs-comment"># 这里的global_num是新的局部变量，不是全局变量</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数内部（错误修改）：<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># 输出：200</span>

wrong_modify()
<span class="hljs-comment"># 函数外部查看全局变量（未被修改，还是原来的值）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数外部查看全局变量：<span class="hljs-subst">{global_num}</span>"</span>)  <span class="hljs-comment"># 输出：100（未修改成功）</span>

<span class="hljs-comment"># 示例2：正确修改全局变量（用global声明）</span>
global_num2 = <span class="hljs-number">100</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correct_modify</span>():
    <span class="hljs-keyword">global</span> global_num2  <span class="hljs-comment"># 声明：global_num2是全局变量，后续修改的是全局变量</span>
    global_num2 = <span class="hljs-number">200</span>  <span class="hljs-comment"># 正确修改全局变量</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数内部（正确修改）：<span class="hljs-subst">{global_num2}</span>"</span>)  <span class="hljs-comment"># 输出：200</span>

correct_modify()
<span class="hljs-comment"># 函数外部查看全局变量（已被修改）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"函数外部查看全局变量：<span class="hljs-subst">{global_num2}</span>"</span>)  <span class="hljs-comment"># 输出：200（修改成功）</span>
</code></pre>
<h4 data-id="heading-19">4.4 新手避坑指南</h4>
<ul>
<li>避坑1：局部变量和全局变量同名时，函数内部优先使用局部变量（全局变量被“屏蔽”）；</li>
<li>避坑2：函数内部访问全局变量，无需声明；修改全局变量，必须用global关键字声明；</li>
<li>避坑3：尽量不要让局部变量和全局变量同名，容易混淆，导致逻辑错误；</li>
<li>避坑4：全局变量适合存储“整个程序都需要使用的公共数据”，不要滥用（否则会让代码逻辑混乱）。</li>
</ul>
<h3 data-id="heading-20">5 匿名函数（lambda表达式）：简洁的“一次性小函数”</h3>
<p>在实际编程中，我们常会遇到“只需要使用一次的简单函数”（比如简单的计算、排序时的key函数），此时用def定义函数会显得繁琐——而匿名函数（lambda表达式），就是为这种场景设计的：<strong>一行代码定义简单函数，无需函数名，用完即丢</strong>，结合参考资料2中lambda的用法，简化适配新手。</p>
<h4 data-id="heading-21">5.1 lambda表达式的基础语法（一行搞定）</h4>
<p>语法（新手必记）：<code>lambda 参数列表: 表达式</code></p>
<p>解析：</p>
<ul>
<li><code>lambda</code>：定义匿名函数的关键字（相当于def）；</li>
<li>参数列表：和普通函数的参数一致（可接收位置参数、默认参数、*args等，通常参数较少）；</li>
<li>表达式：函数的核心逻辑，只能有<strong>一个表达式</strong>（不能有循环、多行条件语句），表达式的结果会自动作为返回值（无需写return）；</li>
<li>匿名函数没有函数名，通常赋值给一个变量，通过变量调用，或直接作为参数传递（比如配合sorted、map等函数）。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：用lambda定义简单的加法函数（对比def定义）</span>
<span class="hljs-comment"># 用def定义（繁琐，适合复杂函数）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add_def</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># 用lambda定义（简洁，适合简单函数）</span>
add_lambda = <span class="hljs-keyword">lambda</span> a, b: a + b  <span class="hljs-comment"># 赋值给变量add_lambda，通过变量调用</span>

<span class="hljs-comment"># 两种函数的调用方式一致</span>
<span class="hljs-built_in">print</span>(add_def(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出：8</span>
<span class="hljs-built_in">print</span>(add_lambda(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出：8</span>

<span class="hljs-comment"># 示例2：lambda表达式的核心特点（一个表达式、自动返回结果）</span>
<span class="hljs-comment"># 计算两个数的最大值（用lambda，一行搞定）</span>
max_lambda = <span class="hljs-keyword">lambda</span> a, b: a <span class="hljs-keyword">if</span> a &gt; b <span class="hljs-keyword">else</span> b  <span class="hljs-comment"># 单行条件表达式（允许）</span>
<span class="hljs-built_in">print</span>(max_lambda(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># 输出：8</span>

<span class="hljs-comment"># 示例3：无参数的lambda表达式</span>
hello_lambda = <span class="hljs-keyword">lambda</span>: <span class="hljs-string">"Hello, lambda!"</span>
<span class="hljs-built_in">print</span>(hello_lambda())  <span class="hljs-comment"># 输出：Hello, lambda!</span>

<span class="hljs-comment"># 示例4：带默认参数的lambda表达式</span>
power_lambda = <span class="hljs-keyword">lambda</span> x, n=<span class="hljs-number">2</span>: x **n  <span class="hljs-comment"># n默认值为2（平方）</span>
<span class="hljs-built_in">print</span>(power_lambda(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出：9（3的平方）</span>
<span class="hljs-built_in">print</span>(power_lambda(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出：27（3的立方）</span>
</code></pre>
<h4 data-id="heading-22">5.2 lambda表达式的常用场景（新手必学）</h4>
<p>lambda的核心价值是“简洁”，最常用的场景是：作为“临时函数”传递给其他函数（比如配合sorted排序、map映射），结合第四阶段的容器类型，实现高效编程。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 场景1：配合sorted()排序（按列表中元组的第二个元素排序）</span>
<span class="hljs-comment"># 定义一个包含元组的列表（存储姓名和年龄）</span>
students = [(<span class="hljs-string">"张三"</span>, <span class="hljs-number">19</span>), (<span class="hljs-string">"李四"</span>, <span class="hljs-number">17</span>), (<span class="hljs-string">"王五"</span>, <span class="hljs-number">18</span>)]

<span class="hljs-comment"># 用lambda作为key函数，按年龄排序（升序）</span>
sorted_students = <span class="hljs-built_in">sorted</span>(students, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">"按年龄升序排序："</span>, sorted_students)
<span class="hljs-comment"># 输出：[('李四', 17), ('王五', 18), ('张三', 19)]</span>

<span class="hljs-comment"># 场景2：配合map()映射（将列表中所有元素乘以2）</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
<span class="hljs-comment"># 用lambda定义映射逻辑，map()批量处理元素</span>
new_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x * <span class="hljs-number">2</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"所有元素乘以2："</span>, new_nums)  <span class="hljs-comment"># 输出：[2, 4, 6, 8, 10]</span>

<span class="hljs-comment"># 场景3：配合filter()过滤（筛选列表中的偶数）</span>
nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]
<span class="hljs-comment"># 用lambda定义过滤条件，filter()筛选符合条件的元素</span>
even_nums = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, nums))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"筛选列表中的偶数："</span>, even_nums)  <span class="hljs-comment"># 输出：[2, 4, 6]</span>
</code></pre>
<h4 data-id="heading-23">5.3 新手避坑指南</h4>
<ul>
<li>避坑1：lambda表达式只能有<strong>一个表达式</strong>，不能有循环、多行条件语句（if...elif...else），复杂逻辑请用def定义普通函数；</li>
<li>避坑2：lambda表达式没有函数名，不能直接调用，必须赋值给变量，或作为参数传递给其他函数；</li>
<li>避坑3：lambda适合“简单、一次性”的函数场景，不要用lambda写复杂逻辑（否则会让代码可读性变差）；</li>
<li>避坑4：lambda表达式的参数列表，和普通函数的参数规则一致，传参时要匹配参数个数和类型。</li>
</ul>
<h3 data-id="heading-24">6 函数嵌套与递归（基础版）：解锁更复杂的函数逻辑</h3>
<p>掌握了前面的基础后，我们来学习函数的进阶用法——函数嵌套与递归（基础版）。函数嵌套是“函数内部定义函数”，实现逻辑封装；递归是“函数调用自身”，解决可拆分的简单问题，结合参考资料1和3中的案例，简化成新手能理解的基础版本，不深入复杂逻辑。</p>
<h4 data-id="heading-25">6.1 函数嵌套（函数内部定义函数）</h4>
<p>函数嵌套：在一个函数（外部函数）的内部，再定义另一个函数（内部函数），核心特点：</p>
<ul>
<li>内部函数只能在<strong>外部函数内部</strong>访问和调用，外部无法直接访问；</li>
<li>内部函数可以访问外部函数的参数和局部变量（实现逻辑封装，隐藏内部细节）；</li>
<li>外部函数可以返回内部函数，让内部函数在外部被调用（后续进阶讲解，基础版暂不深入）。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 函数嵌套示例（外部函数+内部函数）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">outer_func</span>():
    <span class="hljs-string">"""外部函数"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"进入外部函数"</span>)
    
    <span class="hljs-comment"># 内部函数（在外部函数内部定义）</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner_func</span>():
        <span class="hljs-string">"""内部函数，只能在外部函数内部访问"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"进入内部函数，访问外部函数的局部变量："</span>, outer_num)
    
    <span class="hljs-comment"># 外部函数的局部变量</span>
    outer_num = <span class="hljs-number">100</span>
    <span class="hljs-comment"># 外部函数内部调用内部函数（正确）</span>
    inner_func()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"退出外部函数"</span>)

<span class="hljs-comment"># 调用外部函数（会触发内部函数的调用）</span>
outer_func()
<span class="hljs-comment"># 输出顺序：进入外部函数 → 进入内部函数，访问外部函数的局部变量：100 → 退出外部函数</span>

<span class="hljs-comment"># 错误：外部直接调用内部函数（超出作用域）</span>
<span class="hljs-comment"># inner_func()  # 报错：name 'inner_func' is not defined</span>

<span class="hljs-comment"># 示例2：内部函数访问外部函数的参数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-string">"""外部函数，接收两个参数"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>():
        <span class="hljs-comment"># 内部函数访问外部函数的参数a和b</span>
        <span class="hljs-keyword">return</span> a + b
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>():
        <span class="hljs-keyword">return</span> a - b
    
    <span class="hljs-comment"># 外部函数返回内部函数的执行结果</span>
    <span class="hljs-keyword">return</span> add(), subtract()

<span class="hljs-comment"># 调用外部函数，获取内部函数的结果</span>
add_res, sub_res = calculate(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"加法结果：<span class="hljs-subst">{add_res}</span>，减法结果：<span class="hljs-subst">{sub_res}</span>"</span>)  <span class="hljs-comment"># 输出：15，5</span>
</code></pre>
<p>核心总结：函数嵌套的核心是“封装内部逻辑”，将复杂逻辑拆分成多个小函数，隐藏内部细节，让外部函数的调用更简洁。</p>
<h4 data-id="heading-26">6.2 递归（基础版）：函数调用自身，解决简单问题</h4>
<p>递归的核心：<strong>函数自己调用自己</strong>，就像“套娃”一样，适合解决“可以拆分成多个相同小问题”的场景（比如计算阶乘、斐波那契数列）。</p>
<p>新手必记：递归必须满足两个条件（否则会陷入无限递归，导致程序崩溃）：</p>
<ul>
<li>
<ol>
<li>终止条件：存在一个明确的终止递归的条件（当满足条件时，不再调用自身）；</li>
</ol>
</li>
<li>
<ol start="2">
<li>递推关系：每次递归调用，都要让问题的规模“缩小”（比如计算n!，递推关系是n! = n * (n-1)!，规模从n缩小到n-1）。</li>
</ol>
</li>
</ul>
<p>基础示例1：计算n的阶乘（n! = 1×2×3×...×n，终止条件：n=1时，1! = 1），参考资料1中的阶乘案例，简化适配新手：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 递归计算n的阶乘（基础版）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):
    <span class="hljs-string">"""递归计算n的阶乘
    参数：n -- 非负整数
    终止条件：n == 1 或 n == 0 时，返回1
    递推关系：n! = n * (n-1)!
    """</span>
    <span class="hljs-comment"># 终止条件（必须有，否则无限递归）</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-comment"># 递推关系：函数调用自身，问题规模缩小（n → n-1）</span>
    <span class="hljs-keyword">return</span> n * factorial(n - <span class="hljs-number">1</span>)

<span class="hljs-comment"># 调用函数，测试结果</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出：120（5! = 5×4×3×2×1 = 120）</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出：6（3! = 3×2×1 = 6）</span>
<span class="hljs-built_in">print</span>(factorial(<span class="hljs-number">0</span>))  <span class="hljs-comment"># 输出：1（0! 规定为1）</span>
</code></pre>
<p>基础示例2：递归计算斐波那契数列（前两项为1，从第三项开始，每一项等于前两项之和）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 递归计算斐波那契数列的第n项（基础版）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params">n</span>):
    <span class="hljs-string">"""递归计算斐波那契数列第n项
    终止条件：n == 1 或 n == 2 时，返回1
    递推关系：fib(n) = fib(n-1) + fib(n-2)
    """</span>
    <span class="hljs-keyword">if</span> n == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> n == <span class="hljs-number">2</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> fibonacci(n - <span class="hljs-number">1</span>) + fibonacci(n - <span class="hljs-number">2</span>)

<span class="hljs-comment"># 调用函数，输出前10项斐波那契数列</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):
    <span class="hljs-built_in">print</span>(fibonacci(i), end=<span class="hljs-string">" "</span>)  <span class="hljs-comment"># 输出：1 1 2 3 5 8 13 21 34 55</span>
</code></pre>
<h4 data-id="heading-27">6.3 新手避坑指南（递归重点！）</h4>
<ul>
<li>避坑1：递归必须有<strong>明确的终止条件</strong>，否则会陷入无限递归（程序会报错“RecursionError”，栈溢出）；</li>
<li>避坑2：递归的递推关系必须让“问题规模缩小”，否则即使有终止条件，也无法触发；</li>
<li>避坑3：Python的递归深度有限（默认约1000层），递归次数过多会报错，基础阶段不要用递归解决大规模问题；</li>
<li>避坑4：递归适合“简单、可拆分”的问题，复杂问题用循环（for/while）实现更高效（后续会对比）。</li>
</ul>
<h3 data-id="heading-28">7 总结</h3>
<p>到这里，Python3基础学习第五阶段「函数基础」的核心内容就全部梳理完毕了！这一阶段，我们从“函数的定义与调用”入手，逐步掌握了参数、返回值、局部与全局变量、匿名函数、函数嵌套与递归（基础版），每一个知识点都是Python模块化编程的基础，也是后续学习更高级内容（函数进阶、面向对象、模块与包）的关键。</p>
<p>对于新手来说，这一阶段的重点不是死记硬背语法，而是理解函数的核心价值（代码复用、模块化），并多动手练习，重点注意以下几点：</p>
<ol>
<li>函数的定义与调用是基础，牢记def关键字的模板，注意缩进和调用方式，避免“只定义不调用”；</li>
<li>函数参数是重点，分清4种参数类型的用法和顺序，尤其是可变参数<code>*args</code>和<code>**kwargs</code>，多练习混合传参；</li>
<li>分清return和print的区别，掌握return返回多个值的技巧，这是后续数据处理的常用方法；</li>
<li>搞懂局部变量与全局变量的作用域，记住“修改全局变量必须用global声明”，避免变量报错；</li>
<li>匿名函数适合简单、一次性场景，复杂逻辑用普通函数，不要滥用lambda；</li>
<li>递归基础重点记“终止条件+递推关系”，新手先练习简单案例（阶乘、斐波那契数列），不要追求复杂递归。</li>
</ol>
<p>第五阶段的学习，难度比前四阶段略有提升，尤其是参数、局部全局变量、递归这三个知识点，新手容易踩坑。建议大家每天花30分钟，亲手敲写每个知识点的代码示例，修改参数、调试报错，感受函数的用法——只有多动手，才能真正吃透函数，让代码变得更简洁、更高效。</p>
<p>下一个阶段，我们将进入「函数进阶」的学习，重点攻克递归进阶、高阶函数、装饰器等内容，进一步提升代码的复用性和可读性。继续加油，稳步解锁Python编程的更多技能，离“合格的Python初学者”又近了一步～</p>
<hr/>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德 @一个有梦有戏的人</strong><br/>
持续创作很不容易，作者将以尽可能的详细把所学知识分享各位开发者，一起进步一起学习。<strong>转载请携带链接，转载到微信公众号请勿选择原创，谢谢！</strong><br/>
👍创作不易，如有错误请指正，感谢观看！记得点赞哦！👍<br/>
谢谢支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python3基础：进阶基础，筑牢编程底层能力]]></title>    <link>https://juejin.cn/post/7603561363571490879</link>    <guid>https://juejin.cn/post/7603561363571490879</guid>    <pubDate>2026-02-06T15:09:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603561363571490879" data-draft-id="7603563317040496703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python3基础：进阶基础，筑牢编程底层能力"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-02-06T15:09:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python3基础：进阶基础，筑牢编程底层能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:09:55.000Z" title="Fri Feb 06 2026 15:09:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">第六阶段：进阶基础，筑牢编程底层能力</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
<p>🔥豆包AI</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>在第五阶段，我们吃透了函数基础的核心知识点——从函数的定义与调用，到参数、返回值、局部与全局变量，再到匿名函数、函数嵌套与递归，我们终于摆脱了“零散代码”的困境，实现了代码的复用与模块化。</p>
<p>而第六阶段我们要攻克的「进阶基础」，是Python编程从“会用”走向“活用”的关键一步，更是后续学习复杂项目、框架（如Django、PyTorch）的核心基石。这一阶段，我们将重点学习四大核心内容：模块与包（实现代码的规模化复用）、文件操作（实现数据的持久化存储）、异常处理（让代码更健壮、容错性更强）、面向对象基础（解锁更灵活的编程思维）。</p>
<p>本阶段的学习难度相较于前五个阶段略有提升，核心目标不再是“记住语法”，而是“理解逻辑、灵活运用”。全程将延续“知识点解析+可运行代码+避坑技巧”的模式，贴合新手学习节奏，每个代码示例都可直接复制运行，每个知识点都搭配通俗解读，跟着敲代码、练案例，就能轻松掌握进阶基础的核心能力，稳步向“合格的Python初学者”迈进～</p>
<h3 data-id="heading-2">1 模块与包：实现代码规模化复用，告别“复制粘贴”</h3>
<p>在第五阶段，我们用函数实现了“代码片段的复用”，但当项目越来越大、函数越来越多，我们会发现：大量函数堆砌在一个文件中，不仅难以查找、维护，还容易出现命名冲突。而「模块与包」，就是为解决这个问题而生的——它们能帮我们将代码按功能分类、组织，实现“跨文件复用”，让代码结构更清晰、更具可扩展性。</p>
<p>简单来说：<strong>模块（Module）</strong> 是一个包含Python代码的 <code>.py</code> 文件（比如my_module.py），里面可以定义函数、类、变量；<strong>包（Package）</strong> 是一个包含多个模块（.py文件）的目录，目录下必须有一个 <code>__init__.py</code> 文件（可为空），用于标识这个目录是一个Python包。</p>
<h4 data-id="heading-3">1.1 模块的使用：import导入（核心操作）</h4>
<p>Python提供了多种导入模块的方式，核心是使用 <code>import</code> 关键字，新手重点掌握4种常用方式，结合示例理解，可直接复制运行。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 方式1：导入整个模块（最基础）</span>
<span class="hljs-comment"># 语法：import 模块名</span>
<span class="hljs-keyword">import</span> random  <span class="hljs-comment"># 导入Python内置的随机数模块（无需自己创建）</span>

<span class="hljs-comment"># 使用模块中的函数/变量：模块名.函数名() / 模块名.变量名</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机整数（1-10）："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机浮点数（0-1）："</span>, random.random())

<span class="hljs-comment"># 方式2：导入模块并指定别名（简化调用，常用）</span>
<span class="hljs-comment"># 语法：import 模块名 as 别名</span>
<span class="hljs-keyword">import</span> datetime <span class="hljs-keyword">as</span> dt  <span class="hljs-comment"># 导入内置日期时间模块，别名dt</span>

<span class="hljs-comment"># 使用别名调用，更简洁</span>
now = dt.datetime.now()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间："</span>, now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>))

<span class="hljs-comment"># 方式3：从模块中导入指定的函数/变量（推荐，按需导入）</span>
<span class="hljs-comment"># 语法：from 模块名 import 函数名1, 函数名2, 变量名</span>
<span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> pi, sqrt  <span class="hljs-comment"># 从内置数学模块导入pi（圆周率）和sqrt（开平方）</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"圆周率pi："</span>, pi)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"9的平方根："</span>, sqrt(<span class="hljs-number">9</span>))  <span class="hljs-comment"># 输出3.0</span>

<span class="hljs-comment"># 方式4：从模块中导入所有内容（不推荐，易出现命名冲突）</span>
<span class="hljs-comment"># 语法：from 模块名 import *</span>
<span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> *

<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机选择列表元素："</span>, choice([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]))
<span class="hljs-comment"># 注意：这种方式会导入模块中所有可导入的内容，若与自身定义的函数/变量同名，会覆盖</span>
</code></pre>
<h4 data-id="heading-4">1.2 自定义模块：自己写模块，实现跨文件复用</h4>
<p>除了使用Python内置模块，我们还可以自己编写模块（.py文件），将自己定义的函数、类、变量放入其中，供其他文件导入使用——这是实际编程中常用的技巧，实现代码的跨文件复用。</p>
<p>步骤：① 创建一个 <code>.py</code> 文件（模块文件），编写代码（函数、类等）；② 在另一个文件中，用import导入这个模块，即可使用其中的内容。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 第一步：创建自定义模块（文件名：my_module.py，与当前运行文件放在同一目录下）</span>
<span class="hljs-comment"># ------------------ my_module.py 内容 ------------------</span>
<span class="hljs-comment"># 定义一个计算两数之和的函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a + b

<span class="hljs-comment"># 定义一个计算两数之差的函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a - b

<span class="hljs-comment"># 定义一个全局变量</span>
PI = <span class="hljs-number">3.1415926</span>

<span class="hljs-comment"># 模块自测：当模块被直接运行时，执行以下代码（导入时不执行）</span>
<span class="hljs-comment"># 控制模块执行（入口点）</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"模块自测：3+5 ="</span>, add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"模块自测：10-4 ="</span>, subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>))
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># 第二步：在当前文件（比如main.py）中导入自定义模块，使用其中的内容</span>
<span class="hljs-comment"># 导入自定义模块</span>
<span class="hljs-keyword">import</span> my_module

<span class="hljs-comment"># 使用模块中的函数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"3+5 ="</span>, my_module.add(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出8</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"10-4 ="</span>, my_module.subtract(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>))  <span class="hljs-comment"># 输出6</span>

<span class="hljs-comment"># 使用模块中的变量</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"圆周率（自定义模块）："</span>, my_module.PI)  <span class="hljs-comment"># 输出3.1415926</span>

<span class="hljs-comment"># 也可以用别名导入</span>
<span class="hljs-keyword">import</span> my_module <span class="hljs-keyword">as</span> mm
<span class="hljs-built_in">print</span>(<span class="hljs-string">"5+8 ="</span>, mm.add(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>))  <span class="hljs-comment"># 输出13</span>

<span class="hljs-comment"># 也可以按需导入</span>
<span class="hljs-keyword">from</span> my_module <span class="hljs-keyword">import</span> add, PI
<span class="hljs-built_in">print</span>(<span class="hljs-string">"2+7 ="</span>, add(<span class="hljs-number">2</span>, <span class="hljs-number">7</span>))  <span class="hljs-comment"># 输出9</span>
</code></pre>
<p>关键知识点：<code>if __name__ == "__main__":</code> —— 每个模块都有一个 <code>__name__</code> 属性，当模块被直接运行时，<code>__name__</code> 的值为 <code>"__main__"</code>，此时会执行该判断下的代码（用于模块自测）；当模块被导入时，<code>__name__</code> 的值为模块名，该判断下的代码不会执行。</p>
<blockquote>
<p>类似 Java 的 main 方法</p>
<p>public class MyClass {</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {

    <span class="hljs-comment">// 入口点</span>

}
</code></pre>
<p>}</p>
</blockquote>
<h4 data-id="heading-5">1.3 包的使用：组织多个模块，实现功能分类</h4>
<p>当自定义模块越来越多（比如10个、20个），我们可以用“包”将它们按功能分类（比如数据处理相关的模块放在一个包，工具类模块放在另一个包）。包的核心是“目录+<strong>init</strong>.py文件”。</p>
<p>示例（包的创建与导入）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 第一步：创建包（目录结构如下）</span>
<span class="hljs-comment"># my_package/  # 包目录</span>
<span class="hljs-comment">#     __init__.py  # 必须有，可为空文件（标识该目录是Python包）</span>
<span class="hljs-comment">#     calc_module.py  # 模块1：计算相关函数</span>
<span class="hljs-comment">#     tool_module.py  # 模块2：工具相关函数</span>

<span class="hljs-comment"># 第二步：编写包内模块的代码</span>
<span class="hljs-comment"># ------------------ calc_module.py 内容 ------------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a * b

<span class="hljs-keyword">def</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>):
    <span class="hljs-keyword">return</span> a / b <span class="hljs-keyword">if</span> b != <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"除数不能为0"</span>
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># ------------------ tool_module.py 内容 ------------------</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">print_info</span>(<span class="hljs-params">info</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"【信息】：<span class="hljs-subst">{info}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">is_positive</span>(<span class="hljs-params">num</span>):
    <span class="hljs-keyword">return</span> num &gt; <span class="hljs-number">0</span>
<span class="hljs-comment"># ------------------------------------------------------</span>

<span class="hljs-comment"># 第三步：导入包中的模块，使用其中的内容</span>
<span class="hljs-comment"># 方式1：导入包中的某个模块</span>
<span class="hljs-keyword">from</span> my_package <span class="hljs-keyword">import</span> calc_module, tool_module

<span class="hljs-built_in">print</span>(<span class="hljs-string">"3×5 ="</span>, calc_module.multiply(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出15</span>
tool_module.print_info(<span class="hljs-string">"Python包的使用示例"</span>)  <span class="hljs-comment"># 输出【信息】：Python包的使用示例</span>

<span class="hljs-comment"># 方式2：导入包中模块的指定函数</span>
<span class="hljs-keyword">from</span> my_package.calc_module <span class="hljs-keyword">import</span> multiply
<span class="hljs-keyword">from</span> my_package.tool_module <span class="hljs-keyword">import</span> is_positive

<span class="hljs-built_in">print</span>(<span class="hljs-string">"4×6 ="</span>, multiply(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>))  <span class="hljs-comment"># 输出24</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"5是否为正数："</span>, is_positive(<span class="hljs-number">5</span>))  <span class="hljs-comment"># 输出True</span>

<span class="hljs-comment"># 方式3：给包/模块指定别名</span>
<span class="hljs-keyword">from</span> my_package <span class="hljs-keyword">import</span> tool_module <span class="hljs-keyword">as</span> tm
tm.print_info(<span class="hljs-string">"别名导入示例"</span>)  <span class="hljs-comment"># 输出【信息】：别名导入示例</span>
</code></pre>
<h4 data-id="heading-6">1.4 常用内置模块（新手必学，直接可用）</h4>
<p>Python内置了大量实用模块，无需自己编写，导入即可使用，新手重点掌握以下5个，能解决80%的基础编程场景：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. random：随机数模块（常用）</span>
<span class="hljs-keyword">import</span> random
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机整数（1-100）："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机选择元素："</span>, random.choice([<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>]))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"打乱列表："</span>, random.shuffle([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]))  <span class="hljs-comment"># 原地打乱</span>

<span class="hljs-comment"># 2. datetime：日期时间模块（常用）</span>
<span class="hljs-keyword">import</span> datetime
now = datetime.datetime.now()  <span class="hljs-comment"># 获取当前时间</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间："</span>, now)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"格式化时间（年-月-日）："</span>, now.strftime(<span class="hljs-string">"%Y-%m-%d"</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"3天后的日期："</span>, now + datetime.timedelta(days=<span class="hljs-number">3</span>))

<span class="hljs-comment"># 3. math：数学模块（常用）</span>
<span class="hljs-keyword">import</span> math
<span class="hljs-built_in">print</span>(<span class="hljs-string">"圆周率："</span>, math.pi)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"16的平方根："</span>, math.sqrt(<span class="hljs-number">16</span>))  <span class="hljs-comment"># 4.0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"绝对值："</span>, math.fabs(-<span class="hljs-number">5.2</span>))  <span class="hljs-comment"># 5.2</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"正弦值（弧度）："</span>, math.sin(math.pi/<span class="hljs-number">2</span>))  <span class="hljs-comment"># 1.0</span>

<span class="hljs-comment"># 4. os：操作系统相关模块（文件路径、目录操作）</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前目录路径："</span>, os.getcwd())  <span class="hljs-comment"># 获取当前工作目录</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前目录下的文件："</span>, os.listdir())  <span class="hljs-comment"># 列出当前目录下所有文件/目录</span>
<span class="hljs-comment"># os.mkdir("test_dir")  # 创建一个名为test_dir的目录（需确保目录不存在）</span>

<span class="hljs-comment"># 5. sys：系统相关模块（简单了解）</span>
<span class="hljs-keyword">import</span> sys
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Python版本："</span>, sys.version)  <span class="hljs-comment"># 查看Python版本</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"命令行参数："</span>, sys.argv)  <span class="hljs-comment"># 查看命令行参数</span>
</code></pre>
<h4 data-id="heading-7">1.5 新手避坑指南（模块与包必看）</h4>
<ul>
<li>避坑1：自定义模块名、包名，不要与Python内置模块名重名（比如不要命名为random.py、math.py），否则会覆盖内置模块，导致报错；</li>
<li>避坑2：导入模块时，若模块不在当前目录下，会报错——解决方案：将模块所在目录添加到Python的搜索路径，或把模块放在当前运行文件同一目录；</li>
<li>避坑3：包目录下必须有 <code>__init__.py</code> 文件（可为空），否则Python不会将其识别为包，无法导入；</li>
<li>避坑4：尽量避免使用 <code>from 模块名 import *</code>，容易出现命名冲突，推荐按需导入（from 模块名 import 函数名）；</li>
<li>避坑5：<code>if __name__ == "__main__":</code> 仅用于模块自测，导入模块时不会执行，不要依赖它实现核心功能。</li>
</ul>
<h3 data-id="heading-8">2 文件操作：实现数据持久化，让数据“存得住”</h3>
<p>在前面的学习中，我们处理的数据（比如列表、字典、变量），都是“临时数据”——程序运行结束后，数据就会被销毁。而实际编程中，我们常常需要将数据“保存到文件中”（比如用户信息、日志、数据结果），也需要从文件中“读取数据”——这就是「文件操作」的核心作用：实现数据的持久化存储。</p>
<p>Python中文件操作的核心是 <code>open()</code> 函数，用于打开文件，然后通过相关方法实现读取、写入、关闭，重点掌握“打开→操作→关闭”的流程，以及更简洁、安全的 <code>with</code> 上下文管理器。</p>
<h4 data-id="heading-9">2.1 文件操作的核心流程：打开→读取/写入→关闭</h4>
<p>文件操作必须遵循“打开文件→操作文件（读/写）→关闭文件”的流程——关闭文件是重中之重，若忘记关闭，会导致文件资源泄露、文件被占用（无法再次打开），甚至数据丢失。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 核心语法：open(文件路径, 打开模式, encoding=编码格式)</span>
<span class="hljs-comment"># 1. 打开文件（以读取模式打开，encoding='utf-8'避免中文乱码）</span>
<span class="hljs-comment"># 注意：若文件不存在，r模式会报错</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)

<span class="hljs-comment"># 2. 读取文件内容（三种常用方式）</span>
<span class="hljs-comment"># 方式1：read()：读取全部内容，返回字符串</span>
content1 = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"read()读取全部内容："</span>, content1)

<span class="hljs-comment"># 方式2：readline()：读取一行内容，每次调用读取下一行</span>
file.seek(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 重置文件指针到开头（否则会从上次读取的位置继续）</span>
content2 = file.readline()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readline()读取第一行："</span>, content2)
content3 = file.readline()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readline()读取第二行："</span>, content3)

<span class="hljs-comment"># 方式3：readlines()：读取所有行，返回列表（每行为一个元素）</span>
file.seek(<span class="hljs-number">0</span>)
content4 = file.readlines()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"readlines()读取所有行："</span>, content4)  <span class="hljs-comment"># 输出：['第一行内容\n', '第二行内容\n', '第三行内容']</span>

<span class="hljs-comment"># 3. 关闭文件（必须执行，否则会导致资源泄露）</span>
file.close()

<span class="hljs-comment"># 补充：写入文件（w模式：覆盖写入，若文件不存在则创建）</span>
file2 = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file2.write(<span class="hljs-string">"这是覆盖写入的内容\n"</span>)  <span class="hljs-comment"># 写入字符串</span>
file2.write(<span class="hljs-string">"这是第二行写入的内容"</span>)
file2.close()  <span class="hljs-comment"># 关闭文件后，写入内容才会生效</span>

<span class="hljs-comment"># 补充：追加写入（a模式：在文件末尾追加，不覆盖原有内容）</span>
file3 = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"a"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file3.write(<span class="hljs-string">"\n这是追加的内容"</span>)
file3.close()
</code></pre>
<h4 data-id="heading-10">2.2 关键知识点：打开模式（必记）</h4>
<p>open()函数的第二个参数“打开模式”，决定了文件操作的类型（读/写/追加），新手重点记以下6种常用模式：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 常用打开模式（核心必记）</span>
<span class="hljs-comment"># 1. r：只读模式（默认），若文件不存在则报错，只能读取，不能写入</span>
<span class="hljs-comment"># 2. w：覆盖写入模式，若文件不存在则创建，若文件存在则覆盖原有内容</span>
<span class="hljs-comment"># 3. a：追加写入模式，若文件不存在则创建，写入内容追加到文件末尾</span>
<span class="hljs-comment"># 4. r+：读写模式，既能读取，也能写入（不会覆盖原有内容，从指针位置开始写入）</span>
<span class="hljs-comment"># 5. w+：读写模式，覆盖写入（若文件不存在则创建），既能写也能读</span>
<span class="hljs-comment"># 6. a+：读写模式，追加写入，既能写也能读</span>

<span class="hljs-comment"># 示例：r+模式（读写）</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r+"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
content = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"读取内容："</span>, content)
file.write(<span class="hljs-string">"\nr+模式写入的内容"</span>)  <span class="hljs-comment"># 在文件末尾写入（因为指针在读取后到了末尾）</span>
file.close()

<span class="hljs-comment"># 示例：w+模式（覆盖读写）</span>
file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test2.txt"</span>, <span class="hljs-string">"w+"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
file.write(<span class="hljs-string">"w+模式覆盖写入的内容"</span>)
file.seek(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 重置指针到开头，否则读取不到内容</span>
content = file.read()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"w+模式读取内容："</span>, content)
file.close()
</code></pre>
<h4 data-id="heading-11">2.3 with上下文管理器：自动关闭文件，更简洁、更安全</h4>
<p>新手最容易踩的坑：忘记关闭文件（file.close()），导致文件资源泄露。而 <code>with</code> 上下文管理器，能帮我们自动关闭文件——进入with代码块时，自动打开文件；退出with代码块时，自动关闭文件（无论代码是否报错），无需手动调用close()，是文件操作的“首选方式”。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># with上下文管理器（读取文件，推荐用法）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-comment"># 缩进内的代码的是文件操作范围，退出缩进后，文件自动关闭</span>
    content = file.read()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"with读取文件："</span>, content)
<span class="hljs-comment"># 退出with后，文件已自动关闭，无需手动close()</span>
<span class="hljs-comment"># print(file.read())  # 报错：文件已关闭，无法读取</span>

<span class="hljs-comment"># with写入文件（覆盖写入）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    file.write(<span class="hljs-string">"with模式写入的内容\n"</span>)
    file.write(<span class="hljs-string">"自动关闭文件，无需手动操作"</span>)

<span class="hljs-comment"># with追加写入</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"a"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    file.write(<span class="hljs-string">"\n追加写入的内容"</span>)

<span class="hljs-comment"># with同时打开多个文件（比如复制文件内容）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test3.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> read_file, \
     <span class="hljs-built_in">open</span>(<span class="hljs-string">"test4.txt"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> write_file:
    <span class="hljs-comment"># 读取test3.txt的内容，写入test4.txt（实现文件复制）</span>
    content = read_file.read()
    write_file.write(content)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"文件复制完成！"</span>)
</code></pre>
<p>核心优势：用with操作文件，既简洁（少写close()），又安全（即使代码块中报错，也会自动关闭文件），新手全程优先使用这种方式。</p>
<h4 data-id="heading-12">2.4 文件路径：找到文件的“准确位置”</h4>
<p>文件操作时，若文件不在当前运行目录下，直接写文件名会报错——此时需要指定“文件路径”，文件路径分为两种：相对路径和绝对路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 相对路径（常用）：以当前运行文件的目录为基准，查找文件</span>
<span class="hljs-comment"># 示例1：文件在当前目录下（直接写文件名）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 示例2：文件在当前目录的子目录下（比如data目录下）</span>
<span class="hljs-comment"># 目录结构：当前文件 → data → test5.txt</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"data/test5.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 示例3：文件在当前目录的上级目录下</span>
<span class="hljs-comment"># 目录结构：上级目录 → 当前文件目录 → 当前文件；上级目录 → test6.txt</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"../test6.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># ../ 表示上级目录</span>

<span class="hljs-comment"># 2. 绝对路径（精准，不会出错）：从电脑的根目录开始，指定完整路径</span>
<span class="hljs-comment"># Windows系统（注意路径中的反斜杠用\\，或用正斜杠/）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"D:\\Python\\test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>
<span class="hljs-comment"># 或</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"D:/Python/test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># Mac/Linux系统（路径用正斜杠/）</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"/Users/xxx/Python/test7.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    <span class="hljs-keyword">pass</span>

<span class="hljs-comment"># 补充：用os模块获取当前路径，避免路径错误（推荐）</span>
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># 获取当前运行文件的目录路径</span>
current_dir = os.path.dirname(os.path.abspath(__file__))
<span class="hljs-comment"># 拼接文件路径（兼容Windows和Mac/Linux）</span>
file_path = os.path.join(current_dir, <span class="hljs-string">"test.txt"</span>)
<span class="hljs-comment"># 使用拼接后的路径打开文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
    content = file.read()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"通过os模块拼接路径读取："</span>, content)
</code></pre>
<h4 data-id="heading-13">2.5 新手避坑指南（文件操作必看）</h4>
<ul>
<li>避坑1：操作中文文件时，必须指定 <code>encoding="utf-8"</code>，否则会出现中文乱码或报错；</li>
<li>避坑2：忘记关闭文件——优先使用with上下文管理器，自动关闭文件，无需手动操作；</li>
<li>避坑3：w模式是“覆盖写入”，慎用！一旦使用w模式打开已有文件，原有内容会被全部清空，无法恢复；</li>
<li>避坑4：读取文件后，文件指针会移动到读取结束的位置，再次读取会读取不到内容，需用 <code>file.seek(0)</code> 重置指针；</li>
<li>避坑5：文件路径错误——若文件不在当前目录，需指定相对路径或绝对路径，推荐用os模块拼接路径，避免手动写路径出错；</li>
<li>避坑6：with代码块外，无法访问文件对象（文件已自动关闭），不要在with外操作文件。</li>
</ul>
<h3 data-id="heading-14">3 异常处理：让代码更健壮，从容应对“报错”</h3>
<p>在前面的学习中，我们写的代码一旦出现错误（比如文件不存在、除以零、输入错误），程序就会直接崩溃，抛出异常（报错信息）。而「异常处理」，就是通过特定的语法，捕获程序运行中的异常，处理异常（比如给出友好提示），让程序不会崩溃，继续执行——这是编写“健壮代码”的核心技能。</p>
<p>Python中异常处理的核心语法是<code>try-except</code>，配合 <code>finally</code>、<code>raise</code>，实现完整的异常处理逻辑。</p>
<h4 data-id="heading-15">3.1 基础异常处理：try-except（捕获异常）</h4>
<p>语法逻辑：尝试执行try代码块中的代码，若出现异常，就执行except代码块中的代码（处理异常）；若没有异常，就跳过except代码块，执行后续代码。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：捕获所有异常（简单，但不推荐，无法定位具体异常类型）</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 尝试执行的代码（可能会报错的代码）</span>
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字："</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字："</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果：<span class="hljs-subst">{num1}</span> ÷ <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span>:
    <span class="hljs-comment"># 出现异常时，执行的代码（处理异常）</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"出错了！请输入正确的数字，且除数不能为0！"</span>)

<span class="hljs-comment"># 示例2：捕获指定类型的异常（推荐，能精准处理不同异常）</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字："</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字："</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果：<span class="hljs-subst">{num1}</span> ÷ <span class="hljs-subst">{num2}</span> = <span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span> ValueError:
    <span class="hljs-comment"># 捕获“值错误”（比如输入的不是数字）</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"出错了！请输入整数类型的数字！"</span>)
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># 捕获“除以零错误”</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"出错了！除数不能为0，请重新输入！"</span>)

<span class="hljs-comment"># 示例3：捕获多个指定异常，统一处理</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-comment"># 尝试打开文件读取</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test_not_exist.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
        content = file.read()
<span class="hljs-keyword">except</span> (FileNotFoundError, UnicodeDecodeError):
    <span class="hljs-comment"># 捕获“文件不存在”或“编码错误”</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"出错了！文件不存在或编码格式错误！"</span>)

<span class="hljs-comment"># 示例4：捕获异常，并获取异常信息（便于调试）</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字："</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字："</span>))
    result = num1 / num2
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># e 是异常对象，存储异常信息</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"值错误：<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># 输出具体的错误信息，比如：invalid literal for int() with base 10: 'abc'</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"除以零错误：<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># 输出：division by zero</span>
</code></pre>
<h4 data-id="heading-16">3.2 finally语句：无论是否异常，都必须执行</h4>
<p><code>finally</code> 语句用于定义“无论是否出现异常，都必须执行的代码”，常用场景：资源清理（比如关闭文件、断开数据库连接）——即使try代码块报错，finally代码块也会执行。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：finally基本用法</span>
<span class="hljs-keyword">try</span>:
    num1 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第一个数字："</span>))
    num2 = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">"请输入第二个数字："</span>))
    result = num1 / num2
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"结果：<span class="hljs-subst">{result}</span>"</span>)
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"除数不能为0！"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 无论是否异常，都会执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"程序执行完毕（无论成功还是失败）"</span>)

<span class="hljs-comment"># 示例2：finally用于资源清理（即使报错，也会关闭文件）</span>
file = <span class="hljs-literal">None</span>
<span class="hljs-keyword">try</span>:
    file = <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
    content = file.read()
    <span class="hljs-built_in">print</span>(content)
<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件不存在！"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-comment"># 无论是否异常，都关闭文件（避免资源泄露）</span>
    <span class="hljs-keyword">if</span> file:  <span class="hljs-comment"># 判断文件是否成功打开</span>
        file.close()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件已关闭"</span>)

<span class="hljs-comment"># 补充：with上下文管理器已自动处理关闭文件，无需用finally，但其他资源清理可使用</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> file:
        content = file.read()
<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件不存在！"</span>)
<span class="hljs-keyword">finally</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件操作流程结束"</span>)
</code></pre>
<h4 data-id="heading-17">3.3 raise语句：主动抛出异常，控制程序逻辑</h4>
<p><code>raise</code> 语句用于“主动抛出异常”——当我们检测到不符合预期的条件时，主动让程序抛出异常，中断执行，或让上层代码处理异常。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：主动抛出异常（基础用法）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">check_age</span>(<span class="hljs-params">age</span>):
    <span class="hljs-comment"># 检测年龄是否合法，不合法则主动抛出异常</span>
    <span class="hljs-keyword">if</span> age &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> age &gt; <span class="hljs-number">120</span>:
        <span class="hljs-comment"># 主动抛出ValueError异常，并指定异常信息</span>
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"年龄不合法！年龄必须在0-120之间"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"年龄合法：<span class="hljs-subst">{age}</span>岁"</span>)

<span class="hljs-comment"># 调用函数，捕获主动抛出的异常</span>
<span class="hljs-keyword">try</span>:
    check_age(-<span class="hljs-number">5</span>)  <span class="hljs-comment"># 不符合条件，主动抛出异常</span>
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"捕获异常：<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># 输出：捕获异常：年龄不合法！年龄必须在0-120之间</span>

<span class="hljs-keyword">try</span>:
    check_age(<span class="hljs-number">25</span>)  <span class="hljs-comment"># 合法，正常执行</span>
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"捕获异常：<span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># 示例2：结合函数，主动抛出异常，控制逻辑</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username, password</span>):
    <span class="hljs-comment"># 模拟登录验证，若用户名或密码为空，主动抛出异常</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"用户名不能为空！"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> password:
        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">"密码不能为空！"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"登录验证通过，正在进入系统..."</span>)

<span class="hljs-comment"># 调用登录函数</span>
<span class="hljs-keyword">try</span>:
    login(<span class="hljs-string">""</span>, <span class="hljs-string">"123456"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"登录失败：<span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># 输出：登录失败：用户名不能为空！</span>
</code></pre>
<h4 data-id="heading-18">3.4 新手避坑指南（异常处理必看）</h4>
<ul>
<li>避坑1：不要滥用 <code>except:</code> 捕获所有异常——无法定位具体的错误类型，不利于调试，推荐捕获指定类型的异常；</li>
<li>避坑2：finally代码块中不要写return语句——会覆盖try/except中的return值，导致异常信息丢失；</li>
<li>避坑3：raise语句抛出的异常，必须有对应的except捕获，否则程序依然会崩溃；</li>
<li>避坑4：异常处理的核心是“处理异常”，不是“隐藏异常”——不要只捕获异常，不给出任何提示，否则会导致程序异常却无法排查；</li>
<li>避坑5：资源清理（如关闭文件），优先用with上下文管理器，若手动打开文件，需在finally中关闭，避免资源泄露。</li>
</ul>
<h3 data-id="heading-19">4 面向对象基础：解锁更灵活的编程思维</h3>
<p>在前面的学习中，我们用“面向过程”的思维编写代码——按步骤拆解问题，一步一步执行（比如先定义函数，再调用函数，按顺序执行逻辑）。而「面向对象」，是一种更灵活、更贴近现实世界的编程思维——将现实世界中的事物（比如人、汽车、学生）抽象成“类”，用类创建“对象”，通过对象的属性和方法实现功能。</p>
<p>面向对象的核心概念：<strong>类（Class）</strong> 和 <strong>对象（Object）</strong>。类是“模板”（比如“学生”类），对象是“模板的实例”（比如“张三”“李四”这两个具体的学生）；类中包含“属性”（事物的特征，比如学生的姓名、年龄）和“方法”（事物的行为，比如学生的学习、吃饭）。</p>
<h4 data-id="heading-20">4.1 类与对象：核心概念与创建</h4>
<p>Python中用 <code>class</code> 关键字定义类，类名通常采用“大驼峰命名法”（首字母大写，多个单词首字母均大写，比如Student、Person）；通过“类名()”创建对象（实例化对象）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例1：定义一个简单的类（Student类）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-comment"># 类的属性（学生的特征）：可以直接定义，也可以通过初始化方法定义</span>
    <span class="hljs-comment"># 类属性：所有对象共享的属性（比如学生的学校）</span>
    school = <span class="hljs-string">"北京大学"</span>

    <span class="hljs-comment"># 类的方法（学生的行为）：定义在类中的函数，第一个参数必须是self</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">study</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># self 代表当前对象（调用该方法的对象），必须作为第一个参数</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> 正在学习Python基础！"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">eat</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span> 正在吃饭！"</span>)

<span class="hljs-comment"># 示例2：创建对象（实例化对象）</span>
<span class="hljs-comment"># 创建第一个对象（张三）</span>
stu1 = Student()
<span class="hljs-comment"># 给对象添加实例属性（每个对象独有的属性，比如姓名、年龄）</span>
stu1.name = <span class="hljs-string">"张三"</span>
stu1.age = <span class="hljs-number">18</span>
<span class="hljs-comment"># 调用对象的方法</span>
stu1.study()  <span class="hljs-comment"># 输出：张三 正在学习Python基础！</span>
stu1.eat()    <span class="hljs-comment"># 输出：张三 正在吃饭！</span>
<span class="hljs-comment"># 访问对象的属性（实例属性和类属性）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名：<span class="hljs-subst">{stu1.name}</span>，年龄：<span class="hljs-subst">{stu1.age}</span>，学校：<span class="hljs-subst">{stu1.school}</span>"</span>)

<span class="hljs-comment"># 创建第二个对象（李四）</span>
stu2 = Student()
stu2.name = <span class="hljs-string">"李四"</span>
stu2.age = <span class="hljs-number">19</span>
stu2.study()  <span class="hljs-comment"># 输出：李四 正在学习Python基础！</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名：<span class="hljs-subst">{stu2.name}</span>，年龄：<span class="hljs-subst">{stu2.age}</span>，学校：<span class="hljs-subst">{stu2.school}</span>"</span>)

<span class="hljs-comment"># 访问类属性（通过类名访问，所有对象共享）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"类属性（学校）："</span>, Student.school)
</code></pre>
<p>关键知识点：<code>self</code> —— 类中定义的方法，第一个参数必须是self，self代表“当前调用方法的对象”，通过self可以访问对象的属性和其他方法，调用方法时，无需手动传递self参数（Python会自动传递）。</p>
<h4 data-id="heading-21">4.2 __init__初始化方法：创建对象时自动初始化属性</h4>
<p>前面的示例中，我们创建对象后，需要手动给对象添加实例属性（stu1.name = "张三"），非常繁琐。而 <code>__init__</code> 方法（初始化方法），是类的特殊方法，创建对象时会<strong>自动调用</strong>，用于初始化对象的属性——相当于“对象的构造函数”，能帮我们简化对象的创建过程。</p>
<p>重点：<code>__init__</code> 前后各有两个下划线（双下划线），是Python的特殊方法命名规范；第一个参数必须是self，后续参数用于接收创建对象时传递的属性值。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例：定义带有__init__初始化方法的Student类（推荐用法）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-comment"># 类属性（所有对象共享）</span>
    school = <span class="hljs-string">"北京大学"</span>

    <span class="hljs-comment"># __init__初始化方法：创建对象时自动调用，初始化实例属性</span>
    <span class="hljs-comment"># self：必须有，代表当前对象</span>
    <span class="hljs-comment"># name、age：接收创建对象时传递的参数，作为实例属性</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-comment"># 给当前对象添加实例属性，绑定参数值</span>
        self.name = name
        self.age = age
        <span class="hljs-comment"># 可以在__init__中添加额外的初始化逻辑</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"创建学生对象：<span class="hljs-subst">{self.name}</span>，<span class="hljs-subst">{self.age}</span>岁"</span>)

    <span class="hljs-comment"># 类中的方法</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">study</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>（<span class="hljs-subst">{self.age}</span>岁）正在学习Python第六阶段内容！"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">introduce</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 访问实例属性和类属性</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"大家好，我是<span class="hljs-subst">{self.name}</span>，今年<span class="hljs-subst">{self.age}</span>岁，来自<span class="hljs-subst">{self.school}</span>"</span>)

<span class="hljs-comment"># 创建对象：创建时直接传递参数，__init__自动调用，初始化属性</span>
stu1 = Student(<span class="hljs-string">"张三"</span>, <span class="hljs-number">18</span>)  <span class="hljs-comment"># 输出：创建学生对象：张三，18岁</span>
stu2 = Student(<span class="hljs-string">"李四"</span>, <span class="hljs-number">19</span>)  <span class="hljs-comment"># 输出：创建学生对象：李四，19岁</span>

<span class="hljs-comment"># 直接访问对象的实例属性（无需手动添加）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu1：<span class="hljs-subst">{stu1.name}</span>，<span class="hljs-subst">{stu1.age}</span>岁"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu2：<span class="hljs-subst">{stu2.name}</span>，<span class="hljs-subst">{stu2.age}</span>岁"</span>)

<span class="hljs-comment"># 调用对象的方法</span>
stu1.study()  <span class="hljs-comment"># 输出：张三（18岁）正在学习Python第六阶段内容！</span>
stu2.introduce()  <span class="hljs-comment"># 输出：大家好，我是李四，今年19岁，来自北京大学</span>

<span class="hljs-comment"># 补充：修改实例属性和类属性</span>
stu1.age = <span class="hljs-number">20</span>  <span class="hljs-comment"># 修改stu1的实例属性（仅影响stu1）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"张三修改后的年龄：<span class="hljs-subst">{stu1.age}</span>岁"</span>)
Student.school = <span class="hljs-string">"清华大学"</span>  <span class="hljs-comment"># 修改类属性（所有对象共享，都会影响）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu1的学校：<span class="hljs-subst">{stu1.school}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"stu2的学校：<span class="hljs-subst">{stu2.school}</span>"</span>)
</code></pre>
<p>关键提醒：<code>__init__</code> 方法不是“构造函数”，Python中对象的创建由 <code>__new__</code> 方法完成，<code>__init__</code> 仅用于对创建好的对象进行初始化操作，新手无需深究 <code>__new__</code> 方法，重点掌握<code>__init__</code> 的用法即可。</p>
<blockquote>
<p>构造方法，类似 Java：</p>
<p>public class MyClass {</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyClass</span>()</span> {  <span class="hljs-comment">// 构造方法</span>

    <span class="hljs-comment">// 初始化代码</span>

}
</code></pre>
<p>}</p>
</blockquote>
<h4 data-id="heading-22">4.3 类的属性与方法：详细解析</h4>
<p>类中包含两种核心元素：属性（特征）和方法（行为），按作用范围可分为“类属性/类方法”和“实例属性/实例方法”，新手重点掌握实例属性和实例方法。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 示例：详细区分实例属性、类属性、实例方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:
    <span class="hljs-comment"># 1. 类属性：定义在类中，不在任何方法中，所有对象共享</span>
    species = <span class="hljs-string">"人类"</span>  <span class="hljs-comment"># 所有Person对象的species属性都是“人类”</span>

    <span class="hljs-comment"># 2. __init__初始化方法：初始化实例属性（每个对象独有）</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):
        <span class="hljs-comment"># 实例属性：定义在__init__中，通过self绑定，每个对象独有</span>
        self.name = name
        self.age = age

    <span class="hljs-comment"># 3. 实例方法：定义在类中，第一个参数是self，只能通过对象调用</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{self.name}</span>（<span class="hljs-subst">{self.age}</span>岁）正在睡觉"</span>)

    <span class="hljs-comment"># 4. 类方法（简单了解）：定义在类中，用@classmethod装饰，第一个参数是cls（代表类）</span>
<span class="hljs-meta">    @classmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">show_species</span>(<span class="hljs-params">cls</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"物种：<span class="hljs-subst">{cls.species}</span>"</span>)  <span class="hljs-comment"># 通过cls访问类属性</span>

<span class="hljs-comment"># 访问类属性（两种方式）</span>
<span class="hljs-built_in">print</span>(Person.species)  <span class="hljs-comment"># 方式1：通过类名访问（推荐）</span>
p1 = Person(<span class="hljs-string">"张三"</span>, <span class="hljs-number">18</span>)
<span class="hljs-built_in">print</span>(p1.species)      <span class="hljs-comment"># 方式2：通过对象访问（不推荐，类属性应通过类名访问）</span>

<span class="hljs-comment"># 访问实例属性（只能通过对象访问）</span>
<span class="hljs-built_in">print</span>(p1.name, p1.age)
<span class="hljs-comment"># print(Person.name)  # 报错：类不能访问实例属性</span>

<span class="hljs-comment"># 调用实例方法（只能通过对象访问）</span>
p1.sleep()

<span class="hljs-comment"># 调用类方法（两种方式）</span>
Person.show_species()  <span class="hljs-comment"># 方式1：通过类名访问（推荐）</span>
p1.show_species()      <span class="hljs-comment"># 方式2：通过对象访问</span>

<span class="hljs-comment"># 补充：修改属性</span>
<span class="hljs-comment"># 修改类属性（影响所有对象）</span>
Person.species = <span class="hljs-string">"智人"</span>
p2 = Person(<span class="hljs-string">"李四"</span>, <span class="hljs-number">19</span>)
<span class="hljs-built_in">print</span>(p1.species)  <span class="hljs-comment"># 输出：智人</span>
<span class="hljs-built_in">print</span>(p2.species)  <span class="hljs-comment"># 输出：智人</span>

<span class="hljs-comment"># 修改实例属性（仅影响当前对象）</span>
p1.age = <span class="hljs-number">20</span>
<span class="hljs-built_in">print</span>(p1.age)  <span class="hljs-comment"># 输出：20</span>
<span class="hljs-built_in">print</span>(p2.age)  <span class="hljs-comment"># 输出：19</span>
</code></pre>
<h4 data-id="heading-23">4.4 新手避坑指南（面向对象基础必看）</h4>
<ul>
<li>避坑1：<code>__init__</code> 方法前后必须各有两个下划线，少写或多写都会变成普通方法，无法自动调用；</li>
<li>避坑2：类中定义的方法，第一个参数必须是self（实例方法）或cls（类方法），否则调用时会报错；</li>
<li>避坑3：实例属性只能通过对象访问，类不能访问实例属性；类属性可以通过类名或对象访问，但推荐通过类名访问；</li>
<li>避坑4：修改类属性时，必须通过“类名.类属性”修改，通过“对象.类属性”修改，本质是给对象添加一个同名的实例属性，不会修改类属性；</li>
<li>避坑5：不要混淆“类”和“对象”——类是模板，不能直接使用方法/属性（除类方法、类属性），必须创建对象，通过对象使用实例方法和实例属性；</li>
<li>避坑6：<code>__init__</code> 方法不能有return语句（除非return None），否则会报错。</li>
</ul>
<h3 data-id="heading-24">5 总结</h3>
<p>恭喜大家！Python3基础学习第六阶段「进阶基础」的核心内容，到这里就全部梳理完毕了！这一阶段，我们跳出了“基础语法”的范畴，学习了四大核心进阶知识点，每一个都对后续的Python学习至关重要：</p>
<ul>
<li>模块与包：帮我们组织代码、实现跨文件复用，告别代码堆砌和命名冲突，为编写大型项目打下基础；</li>
<li>文件操作：实现数据的持久化存储，让我们能读取、写入文件，处理实际场景中的数据（如用户信息、日志）；</li>
<li>异常处理：让代码更健壮、容错性更强，从容应对程序运行中的错误，避免程序崩溃；</li>
<li>面向对象基础：解锁“面向对象”的编程思维，将现实世界的事物抽象成类和对象，让代码更灵活、更易维护。</li>
</ul>
<p>第六阶段的学习，难度明显提升——不仅需要记住语法，更需要理解逻辑、转变思维（尤其是面向对象思维，从“面向过程”到“面向对象”的转变，新手可能需要一定时间适应）。对于新手来说，重点注意以下几点：</p>
<ol>
<li>模块与包：重点掌握import导入的4种方式、自定义模块的编写与导入，以及常用内置模块的使用，多练习跨文件复用代码；</li>
<li>文件操作：全程优先使用with上下文管理器，牢记常用打开模式，掌握相对路径和绝对路径的API.</li>
</ol>
<hr/>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德 @一个有梦有戏的人</strong><br/>
持续创作很不容易，作者将以尽可能的详细把所学知识分享各位开发者，一起进步一起学习。<strong>转载请携带链接，转载到微信公众号请勿选择原创，谢谢！</strong><br/>
👍创作不易，如有错误请指正，感谢观看！记得点赞哦！👍<br/>
谢谢支持！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[主流模型对比-02]]></title>    <link>https://juejin.cn/post/7603575399255261224</link>    <guid>https://juejin.cn/post/7603575399255261224</guid>    <pubDate>2026-02-06T15:28:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255261224" data-draft-id="7603574149773312052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="主流模型对比-02"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-06T15:28:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            主流模型对比-02
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:28:08.000Z" title="Fri Feb 06 2026 15:28:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>GPT-4、Claude、Llama、Qwen、DeepSeek...</p>
<p>面对层出不穷的大语言模型，你是否也曾感到迷茫？</p>
<ul>
<li>选贵的 GPT-4，还是用免费的开源模型？</li>
<li>中文场景应该用什么模型？</li>
<li>本地部署和云端 API 各有什么优劣？</li>
<li>性价比最高的选择是什么？</li>
</ul>
<p>选对模型，不仅能节省成本，还能获得更好的效果。今天我们来聊聊如何做出明智的选择。</p>
<hr/>
<h2 data-id="heading-1">1. 什么是模型选型</h2>
<h3 data-id="heading-2">1.1 闭源模型 vs 开源模型</h3>








































<table><thead><tr><th>特点</th><th>闭源模型</th><th>开源模型</th></tr></thead><tbody><tr><td><strong>代表</strong></td><td>GPT-4、Claude、Gemini</td><td>Llama、Qwen、DeepSeek</td></tr><tr><td><strong>性能</strong></td><td>性能最强</td><td>快速追赶中</td></tr><tr><td><strong>成本</strong></td><td>价格昂贵</td><td>免费或低价</td></tr><tr><td><strong>部署</strong></td><td>仅云端</td><td>可本地部署</td></tr><tr><td><strong>隐私</strong></td><td>数据上传云端</td><td>完全私密</td></tr><tr><td><strong>定制</strong></td><td>难以定制</td><td>高度可定制</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 重要指标</h3>





























<table><thead><tr><th>指标</th><th>说明</th></tr></thead><tbody><tr><td><strong>参数量</strong></td><td>模型规模，通常越大越强</td></tr><tr><td><strong>上下文长度</strong></td><td>能处理的文本长度</td></tr><tr><td><strong>推理能力</strong></td><td>逻辑思考和问题解决能力</td></tr><tr><td><strong>中文能力</strong></td><td>对中文的理解和生成质量</td></tr><tr><td><strong>API 价格</strong></td><td>每 1M tokens 的费用</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">2. 案例</h2>
<h3 data-id="heading-5">案例 1：主流闭源模型对比</h3>





























<table><thead><tr><th>模型</th><th>核心优势</th><th>价格</th><th>最佳场景</th></tr></thead><tbody><tr><td><strong>GPT-4o</strong></td><td>综合能力最强</td><td>$5/1M 输入</td><td>复杂任务、多模态</td></tr><tr><td><strong>Claude 3.5 Sonnet</strong></td><td>长文本、推理强</td><td>$3/1M 输入</td><td>编程、写作</td></tr><tr><td><strong>Gemini 1.5 Pro</strong></td><td>超长上下文(1M)</td><td>按用量计费</td><td>视频、长文档处理</td></tr></tbody></table>
<p><strong>选型建议</strong>：追求极致性能时选择闭源模型。</p>
<h3 data-id="heading-6">案例 2：主流开源模型对比</h3>








































<table><thead><tr><th>模型</th><th>参数量</th><th>核心优势</th><th>硬件要求</th><th>最佳场景</th></tr></thead><tbody><tr><td><strong>Qwen2.5 7B</strong></td><td>70亿</td><td>中文优秀</td><td>6GB 显存</td><td>中文本地部署</td></tr><tr><td><strong>Llama 3.1 8B</strong></td><td>80亿</td><td>通用平衡</td><td>8GB 显存</td><td>英文场景</td></tr><tr><td><strong>DeepSeek-V3</strong></td><td>680亿</td><td>性价比之王</td><td>24GB 显存</td><td>编程任务</td></tr><tr><td><strong>GLM-4 9B</strong></td><td>90亿</td><td>国产化</td><td>6GB 显存</td><td>企业应用</td></tr></tbody></table>
<p><strong>选型建议</strong>：预算有限或关注隐私时选择开源模型。</p>
<h3 data-id="heading-7">案例 3：按场景选模型</h3>
<p><strong>场景 1：中文日常对话</strong></p>
<pre><code class="hljs language-diff" lang="diff">推荐：Qwen2.5 7B 或 DeepSeek-V3
原因：
<span class="hljs-deletion">- 中文能力强</span>
<span class="hljs-deletion">- API 价格低（¥1/1M 输入）</span>
<span class="hljs-deletion">- 响应速度快</span>
</code></pre>
<p><strong>场景 2：代码生成</strong></p>
<pre><code class="hljs language-diff" lang="diff">推荐：DeepSeek-V3 或 Claude 3.5 Sonnet
原因：
<span class="hljs-deletion">- 代码质量高</span>
<span class="hljs-deletion">- 理解上下文能力强</span>
<span class="hljs-deletion">- 调试能力出色</span>
</code></pre>
<p><strong>场景 3：长文档处理</strong></p>
<pre><code class="hljs language-diff" lang="diff">推荐：Claude 3 或 Gemini 1.5 Pro
原因：
<span class="hljs-deletion">- 支持 200K-1M tokens 上下文</span>
<span class="hljs-deletion">- 总结能力强</span>
<span class="hljs-deletion">- 细节保留好</span>
</code></pre>
<p><strong>场景 4：本地部署</strong></p>
<pre><code class="hljs language-diff" lang="diff">推荐：Qwen2.5 7B (INT4 量化)
原因：
<span class="hljs-deletion">- 显存需求低（~4GB）</span>
<span class="hljs-deletion">- 中文优化好</span>
<span class="hljs-deletion">- 性能接近 GPT-3.5</span>
</code></pre>
<h3 data-id="heading-8">案例 4：性价比对比</h3>
<p><strong>云端 API 价格对比（1M tokens）</strong>：</p>



































<table><thead><tr><th>模型</th><th>输入价格</th><th>输出价格</th><th>性价比评级</th></tr></thead><tbody><tr><td>DeepSeek-V3</td><td>¥1</td><td>¥2</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>Qwen-turbo</td><td>¥0.8</td><td>¥2</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>GPT-4o</td><td>$5</td><td>$15</td><td>⭐⭐</td></tr><tr><td>Claude 3.5</td><td>$3</td><td>$15</td><td>⭐⭐</td></tr></tbody></table>
<p><strong>结论</strong>：DeepSeek 和 Qwen 性价比最高。</p>
<h3 data-id="heading-9">案例 5：本地部署成本分析</h3>


























<table><thead><tr><th>配置</th><th>硬件成本</th><th>月电费</th><th>年总成本</th><th>何时回本</th></tr></thead><tbody><tr><td>Qwen2.5 7B</td><td>¥3000</td><td>¥50</td><td>¥3600</td><td>使用 &gt; 1 年</td></tr><tr><td>Qwen2.5 14B</td><td>¥6000</td><td>¥80</td><td>¥6960</td><td>使用 &gt; 1.5 年</td></tr></tbody></table>
<p><strong>结论</strong>：长期使用（&gt;1年），本地部署更划算。</p>
<hr/>
<h2 data-id="heading-10">总结</h2>
<ol>
<li><strong>没有最好的模型，只有最适合的模型</strong></li>
<li><strong>根据实际场景选择，而非盲目追求最新最强</strong></li>
<li><strong>性价比很重要，尤其是在大规模使用时</strong></li>
<li><strong>开源模型已足够应对大部分场景</strong></li>
<li><strong>长期使用考虑本地部署，短期项目用云端 API</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提示词工程入门-03]]></title>    <link>https://juejin.cn/post/7603575399255277608</link>    <guid>https://juejin.cn/post/7603575399255277608</guid>    <pubDate>2026-02-06T15:29:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603575399255277608" data-draft-id="7603444191448940578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提示词工程入门-03"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-06T15:29:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提示词工程入门-03
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T15:29:16.000Z" title="Fri Feb 06 2026 15:29:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>"写个代码"
"帮我写个快速排序函数，用 Python 实现，要求时间复杂度 O(n log n)，添加详细注释"</p>
<p>同样是让 AI 写代码，为什么第一个指令得到的是模糊的回复，而第二个能得到精确满足需求的代码？</p>
<p>这就是提示词工程（Prompt Engineering）的魔力。</p>
<p>好的 Prompt = 好的输出。今天我们来学习如何写出让 AI "秒懂"的提示词。</p>
<hr/>
<h2 data-id="heading-1">1. 什么是提示词工程</h2>
<p><strong>提示词（Prompt）</strong>：你给大模型的输入指令</p>
<p><strong>提示词工程（Prompt Engineering）</strong>：设计和优化 Prompt 的艺术和科学</p>
<h3 data-id="heading-2">Prompt 的黄金结构</h3>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────────────────────────────────┐
│           Prompt 结构模板                 │
├─────────────────────────────────────────┤
│                                         │
│  <span class="hljs-number">1.</span> 角色（Role）                         │
│     <span class="hljs-string">"你是一个经验丰富的程序员..."</span>        │
│                                         │
│  <span class="hljs-number">2.</span> 任务（<span class="hljs-built_in">Task</span>）                         │
│     <span class="hljs-string">"请写一个快速排序函数..."</span>           │
│                                         │
│  <span class="hljs-number">3.</span> 上下文（Context）                    │
│     <span class="hljs-string">"用于处理整数数组..."</span>               │
│                                         │
│  <span class="hljs-number">4.</span> 约束（Constraints）                  │
│     <span class="hljs-string">"要求O(n log n)时间复杂度..."</span>       │
│                                         │
│  <span class="hljs-number">5.</span> 格式（Format）                       │
│     <span class="hljs-string">"返回JSON格式，包含code和说明..."</span>    │
│                                         │
│  <span class="hljs-number">6.</span> 示例（Examples）                     │
│     <span class="hljs-string">"输入:[3,1,2] 输出:[1,2,3]"</span>         │
│                                         │
└─────────────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-3">2. 案例</h2>
<h3 data-id="heading-4">案例 1：明确角色的力量</h3>
<p><strong>❌ 没有角色</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"怎么提高编程能力？"</span>
</code></pre>
<p><strong>✅ 有角色</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"你是一位有10年经验的编程导师，
曾经指导过数百名初学者成为资深工程师。
请给我提供提高编程能力的建议。"</span>
</code></pre>
<p><strong>效果差异</strong>：有角色的 Prompt 能得到更有针对性、更有深度的回答。</p>
<h3 data-id="heading-5">案例 2：具体明确的任务</h3>
<p><strong>❌ 模糊的任务</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我写个文章"</span>
</code></pre>
<p><strong>✅ 明确的任务</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">"请写一篇关于人工智能发展历史的文章，
要求：
<span class="hljs-bullet">1.</span> 字数800-1000字
<span class="hljs-bullet">2.</span> 包含三个主要发展阶段
<span class="hljs-bullet">3.</span> 提到GPT、Llama等关键模型
<span class="hljs-bullet">4.</span> 语言风格通俗易懂"
</code></pre>
<p><strong>SMART 原则</strong>：</p>
<ul>
<li><strong>Specific</strong>（具体明确）：写 Python 代码而非"写代码"</li>
<li><strong>Measurable</strong>（可衡量）：100字以内</li>
<li><strong>Achievable</strong>（可达成）：不要求超出模型能力</li>
<li><strong>Relevant</strong>（相关性）：任务与上下文相关</li>
<li><strong>Time-bound</strong>（有时限）：30秒内能读完的介绍</li>
</ul>
<h3 data-id="heading-6">案例 3：提供充足上下文</h3>
<p><strong>❌ 缺少上下文</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"这个代码有什么问题？"</span>
[粘贴一段代码]
</code></pre>
<p><strong>✅ 充足上下文</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"我正在开发一个电商网站的用户认证功能。
这段Python代码用于验证用户密码，
但总是返回False，帮我找出问题：

[粘贴代码]

预期行为：正确密码返回True，错误密码返回False
实际行为：所有密码都返回False"</span>
</code></pre>
<p><strong>上下文要素清单</strong>：</p>
<ul>
<li>背景：这是什么项目/场景？</li>
<li>目标：想要达到什么效果？</li>
<li>现状：当前是什么情况？</li>
<li>问题：遇到了什么具体问题？</li>
</ul>
<h3 data-id="heading-7">案例 4：使用示例的魔力</h3>
<p><strong>少样本学习示例</strong>：</p>
<pre><code class="hljs">例子1：
输入：苹果
分类：水果

例子2：
胡萝卜
分类：蔬菜

例子3：
香蕉
分类：？
</code></pre>
<p><strong>思维链示例</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">问题：小明有5个苹果，吃了2个，又买了3个，现在有几个？

思考过程：
1. 初始：小明有5个苹果
2. 吃了2个：5 - <span class="hljs-attr">2</span> = <span class="hljs-number">3</span>个
3. 买了3个：3 + <span class="hljs-attr">3</span> = <span class="hljs-number">6</span>个
答案：6个

现在请解决：
小红有10颗糖，给了妹妹3颗，妈妈又给了她5颗，现在有几颗？
</code></pre>
<p><strong>效果</strong>：示例能让 AI 快速理解你想要的输出模式。</p>
<h3 data-id="heading-8">案例 5：格式化输出</h3>
<p><strong>❌ 不好的 Prompt</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"分析这段代码"</span>
</code></pre>
<p><strong>✅ 好的 Prompt</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">"请分析以下代码，并按以下格式输出：

<span class="hljs-comment">## 代码功能</span>
<span class="hljs-section">[简要说明代码的功能]</span>

<span class="hljs-comment">## 时间复杂度</span>
<span class="hljs-section">[分析时间复杂度]</span>

<span class="hljs-comment">## 改进建议</span>
<span class="hljs-section">[列出3条具体改进建议]</span>

<span class="hljs-comment">## 重构代码</span>
\`\`\`python
<span class="hljs-section">[重构后的代码]</span>
\`\`\`"
</code></pre>
<h3 data-id="heading-9">案例 6：常用 Prompt 模板</h3>
<p><strong>代码生成模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">你是一个{语言}专家。
请写一个{功能描述}的{语言}函数，
要求：
<span class="hljs-bullet">1.</span> {要求1}
<span class="hljs-bullet">2.</span> {要求2}
<span class="hljs-bullet">3.</span> {要求3}

请包含：
<span class="hljs-bullet">-</span> 详细的注释
<span class="hljs-bullet">-</span> 错误处理
<span class="hljs-bullet">-</span> 使用示例
</code></pre>
<p><strong>Bug 调试模板</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">我在开发一个{项目类型}项目，
这段{语言}代码出现了{问题描述}：

\<span class="hljs-code">`\`</span>\`{语言}
{代码}
\<span class="hljs-code">`\`</span>\`

预期行为：{预期}
实际行为：{实际}

请帮我：
<span class="hljs-bullet">1.</span> 找出问题所在
<span class="hljs-bullet">2.</span> 解释问题原因
<span class="hljs-bullet">3.</span> 提供修复方案
</code></pre>
<hr/>
<h2 data-id="heading-10">总结</h2>
<h3 data-id="heading-11">核心技巧速记</h3>



































<table><thead><tr><th>技巧</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>明确角色</strong></td><td>给 AI 分配身份</td><td>"你是一位经验丰富的程序员"</td></tr><tr><td><strong>具体任务</strong></td><td>清楚说明要做什么</td><td>"写一个快速排序，O(n log n)"</td></tr><tr><td><strong>充足上下文</strong></td><td>提供背景信息</td><td>"这是电商网站的推荐功能"</td></tr><tr><td><strong>使用示例</strong></td><td>展示期望格式</td><td>"输入A输出B，输入C输出？"</td></tr><tr><td><strong>明确格式</strong></td><td>说明输出形式</td><td>"以 JSON 格式返回"</td></tr></tbody></table>
<h3 data-id="heading-12">Prompt 检查清单</h3>
<p>发送 Prompt 前，问自己：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 角色清晰：是否告诉 AI 它的角色？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 任务明确：是否清楚说明了要做什么？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 上下文充足：是否提供了足够的背景信息？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 约束具体：是否说明了限制和要求？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 格式明确：是否说明了输出格式？</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 示例充分：是否提供了参考示例？</li>
</ul>
<h3 data-id="heading-13">常见陷阱</h3>






























<table><thead><tr><th>陷阱</th><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td><strong>过于简短</strong></td><td>"帮我优化代码"</td><td>说明具体优化目标</td></tr><tr><td><strong>矛盾要求</strong></td><td>"性能最好但代码简洁"</td><td>明确优先级</td></tr><tr><td><strong>一次太多</strong></td><td>"写完整电商系统"</td><td>分解为小任务</td></tr><tr><td><strong>缺少验证</strong></td><td>"计算复杂数学"</td><td>要求给出计算步骤</td></tr></tbody></table>
<h3 data-id="heading-14">高级技巧</h3>
<p><strong>1. 迭代优化</strong></p>
<pre><code class="hljs">第一次尝试 → 评估结果 → 修改 Prompt → 再次尝试
</code></pre>
<p><strong>2. 温度参数调整</strong></p>
<ul>
<li><strong>低温度（0.1-0.3）</strong>：更确定、一致的输出</li>
<li><strong>中等温度（0.4-0.7）</strong>：平衡创造性和准确性</li>
<li><strong>高温度（0.8-1.0）</strong>：更创造性、多样化的输出</li>
</ul>
<p><strong>3. 分解复杂任务</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"设计一个博客系统"</span>
↓ 分解为
<span class="hljs-string">"1. 设计数据库结构"</span>
<span class="hljs-string">"2. 设计用户认证 API"</span>
<span class="hljs-string">"3. 设计文章发布 API"</span>
</code></pre>
<ol>
<li><strong>不要期望一次完美</strong>：迭代优化是常态</li>
<li><strong>从简单开始</strong>：先验证基本方向，再添加细节</li>
<li><strong>保存好用的 Prompt</strong>：建立自己的模板库</li>
<li><strong>对比实验</strong>：用不同版本测试效果差异</li>
<li><strong>学习他人经验</strong>：参考优秀的 Prompt 示例</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js 透视相机完全指南：从入门到精通]]></title>    <link>https://juejin.cn/post/7603584155784626226</link>    <guid>https://juejin.cn/post/7603584155784626226</guid>    <pubDate>2026-02-06T14:25:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603584155784626226" data-draft-id="7602982045138288686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 透视相机完全指南：从入门到精通"/> <meta itemprop="keywords" content="JavaScript,three.js,WebGL"/> <meta itemprop="datePublished" content="2026-02-06T14:25:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="烛阴"/> <meta itemprop="url" content="https://juejin.cn/user/950397795841032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 透视相机完全指南：从入门到精通
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/950397795841032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    烛阴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:25:01.000Z" title="Fri Feb 06 2026 14:25:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是透视相机？</h2>
<h3 data-id="heading-1">生活中的类比</h3>
<p>想象你拿着一部手机摄像头对着一个房间：</p>
<ul>
<li>📱 <strong>手机摄像头</strong> = Three.js 中的相机</li>
<li>🎬 <strong>摄像头能看到的范围</strong> = 视锥体（Frustum）</li>
<li>📐 <strong>摄像头的视角宽度</strong> = 视野角度（FOV）</li>
</ul>
<p>透视相机就像真实的摄像头一样，<strong>离物体越近，看到的范围越小；离物体越远，看到的范围越大</strong>。这就是"透视"的含义。</p>
<h3 data-id="heading-2">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-comment">// 创建透视相机</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
    <span class="hljs-number">40</span>,      <span class="hljs-comment">// 视野角度（FOV）</span>
    <span class="hljs-number">2</span>,       <span class="hljs-comment">// 宽高比（aspect ratio）(一般3D游戏中的屏幕适配都是在调整这个值）</span>
    <span class="hljs-number">0.1</span>,     <span class="hljs-comment">// 近裁剪面（near）</span>
    <span class="hljs-number">1000</span>     <span class="hljs-comment">// 远裁剪面（far）</span>
);

camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">120</span>; <span class="hljs-comment">// 相机位置</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">四个关键参数详解</h2>
<h3 data-id="heading-4">参数 1️⃣：视野角度（FOV - Field of View）</h3>
<p><strong>定义</strong>：相机能看到的<strong>垂直视角范围</strong>，单位是度数（°）。</p>
<p><strong>直观理解</strong>：</p>
<ul>
<li>🔭 <strong>FOV = 10°</strong> → 像用望远镜看，视角很窄，看到的东西很小但很清晰</li>
<li>📷 <strong>FOV = 40°</strong> → 像用普通手机摄像头，视角适中</li>
<li>🐟 <strong>FOV = 90°</strong> → 像用鱼眼镜头，视角很宽，看到很多东西但会变形</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 小视角 - 看得清楚但范围小</span>
<span class="hljs-keyword">const</span> camera1 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">20</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// 中等视角 - 平衡</span>
<span class="hljs-keyword">const</span> camera2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// 大视角 - 看得多但容易变形</span>
<span class="hljs-keyword">const</span> camera3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
</code></pre>
<p><strong>实际应用</strong>：</p>
<ul>
<li>🎮 <strong>第一人称游戏</strong>：FOV 通常 60-90°</li>
<li>🏢 <strong>建筑可视化</strong>：FOV 通常 40-50°</li>
<li>🎥 <strong>电影效果</strong>：FOV 通常 24-35°</li>
</ul>
<hr/>
<h3 data-id="heading-5">参数 2️⃣：宽高比（Aspect Ratio）</h3>
<p><strong>定义</strong>：相机画面的<strong>宽度与高度的比例</strong>。</p>
<p><strong>计算方式</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> aspect = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
<span class="hljs-comment">// 例如：1920 / 1080 = 1.777...</span>
</code></pre>
<p><strong>为什么重要</strong>？</p>
<ul>
<li>✅ 如果 aspect 与实际画布比例一致，画面不会被拉伸</li>
<li>❌ 如果不一致，圆形会变成椭圆，正方形会变成矩形</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 假设窗口是 1920×1080</span>
<span class="hljs-keyword">const</span> aspect = <span class="hljs-number">1920</span> / <span class="hljs-number">1080</span>; <span class="hljs-comment">// ≈ 1.78</span>

<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, aspect, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
</code></pre>
<p><strong>响应式设计</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">onWindowResize</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> width = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>;
    <span class="hljs-keyword">const</span> height = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
    
    camera.<span class="hljs-property">aspect</span> = width / height;
    camera.<span class="hljs-title function_">updateProjectionMatrix</span>(); <span class="hljs-comment">// 重要！更新投影矩阵</span>
    
    renderer.<span class="hljs-title function_">setSize</span>(width, height);
}

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, onWindowResize);
</code></pre>
<hr/>
<h3 data-id="heading-6">参数 3️⃣：近裁剪面（Near）</h3>
<p><strong>定义</strong>：相机能看到的<strong>最近距离</strong>。比这个距离更近的物体不会被显示。</p>
<p><strong>为什么需要它</strong>？</p>
<ul>
<li>🎯 <strong>性能优化</strong>：不渲染相机背后的物体</li>
<li>🔍 <strong>避免穿模</strong>：防止相机进入物体内部时看到内部结构</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// near = 0.1 意味着距离相机 0.1 单位以内的物体看不到</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// 如果物体在 z = 0.05，它会被裁剪掉</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
cube.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">0.05</span>; <span class="hljs-comment">// ❌ 看不到</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">参数 4️⃣：远裁剪面（Far）</h3>
<p><strong>定义</strong>：相机能看到的<strong>最远距离</strong>。比这个距离更远的物体不会被显示。</p>
<p><strong>为什么需要它</strong>？</p>
<ul>
<li>🎯 <strong>性能优化</strong>：不渲染太远的物体</li>
<li>🔍 <strong>深度精度</strong>：提高深度缓冲的精度</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// far = 1000 意味着距离相机 1000 单位以外的物体看不到</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">40</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// 如果物体在 z = 1500，它会被裁剪掉</span>
<span class="hljs-keyword">const</span> star = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
star.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">1500</span>; <span class="hljs-comment">// ❌ 看不到</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">视锥体的可视范围计算</h2>
<h3 data-id="heading-9">什么是视锥体？</h3>
<p>视锥体是一个<strong>四棱锥形的空间</strong>，只有在这个空间内的物体才能被看到。</p>
<h3 data-id="heading-10">计算可视范围的公式</h3>
<p>在距离相机 <code>distance</code> 处，可视范围的大小为：</p>
<pre><code class="hljs language-scss" lang="scss">垂直高度 = <span class="hljs-number">2</span> × <span class="hljs-built_in">tan</span>(FOV/<span class="hljs-number">2</span>) × distance
水平宽度 = 垂直高度 × aspect
</code></pre>
<h3 data-id="heading-11">实际计算示例</h3>
<p>假设我们有这样的相机配置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fov = <span class="hljs-number">40</span>;           <span class="hljs-comment">// 视野角度</span>
<span class="hljs-keyword">const</span> aspect = <span class="hljs-number">2</span>;         <span class="hljs-comment">// 宽高比（2:1）</span>
<span class="hljs-keyword">const</span> distance = <span class="hljs-number">120</span>;     <span class="hljs-comment">// 相机距离（z = 120）</span>

<span class="hljs-comment">// 计算垂直可视高度</span>
<span class="hljs-keyword">const</span> vFOV = fov * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>; <span class="hljs-comment">// 转换为弧度</span>
<span class="hljs-keyword">const</span> height = <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(vFOV / <span class="hljs-number">2</span>) * distance;
<span class="hljs-comment">// height = 2 × tan(20°) × 120</span>
<span class="hljs-comment">// height = 2 × 0.364 × 120</span>
<span class="hljs-comment">// height ≈ 87.2</span>

<span class="hljs-comment">// 计算水平可视宽度</span>
<span class="hljs-keyword">const</span> width = height * aspect;
<span class="hljs-comment">// width = 87.2 × 2</span>
<span class="hljs-comment">// width ≈ 174.4</span>
</code></pre>
<p><strong>结论</strong>：在 z=120 处，相机能看到的范围是：</p>
<ul>
<li>📏 <strong>宽度</strong>：174.4 单位</li>
<li>📏 <strong>高度</strong>：87.2 单位</li>
</ul>
<hr/>
<h2 data-id="heading-12">坐标范围的确定</h2>
<h3 data-id="heading-13">场景布局示例</h3>
<p>假设我们要在场景中放置一个 5×4 的网格（5列 4行），每个物体之间间距为 15 单位：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> spread = <span class="hljs-number">15</span>; <span class="hljs-comment">// 间距</span>

<span class="hljs-comment">// 物体位置计算</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> x = -<span class="hljs-number">2</span>; x &lt;= <span class="hljs-number">2</span>; x++) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> y = -<span class="hljs-number">1</span>; y &lt;= <span class="hljs-number">2</span>; y++) {
        <span class="hljs-keyword">const</span> obj = <span class="hljs-title function_">createObject</span>();
        obj.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = x * spread;  <span class="hljs-comment">// x: -30, -15, 0, 15, 30</span>
        obj.<span class="hljs-property">position</span>.<span class="hljs-property">y</span> = y * spread;  <span class="hljs-comment">// y: -15, 0, 15, 30</span>
        scene.<span class="hljs-title function_">add</span>(obj);
    }
}
</code></pre>
<p><strong>对象分布范围</strong>：</p>
<ul>
<li>X 轴：-30 到 30（宽度 60）</li>
<li>Y 轴：-15 到 30（高度 45）</li>
</ul>
<h3 data-id="heading-14">检查是否超出可视范围</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 相机可视范围</span>
<span class="hljs-keyword">const</span> visibleWidth = <span class="hljs-number">174.4</span>;
<span class="hljs-keyword">const</span> visibleHeight = <span class="hljs-number">87.2</span>;

<span class="hljs-comment">// 对象范围</span>
<span class="hljs-keyword">const</span> objectWidth = <span class="hljs-number">60</span>;
<span class="hljs-keyword">const</span> objectHeight = <span class="hljs-number">45</span>;

<span class="hljs-comment">// 检查</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`宽度是否超出: <span class="hljs-subst">${objectWidth &gt; visibleWidth}</span>`</span>); <span class="hljs-comment">// false ✅</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`高度是否超出: <span class="hljs-subst">${objectHeight &gt; visibleHeight}</span>`</span>); <span class="hljs-comment">// false ✅</span>
</code></pre>
<h3 data-id="heading-15">如果超出范围怎么办？</h3>
<p><strong>问题</strong>：当 spread=20 时，对象范围变为 80×60，超出了可视范围。</p>
<p><strong>解决方案</strong>：</p>
<h4 data-id="heading-16">方案 1：增加相机距离</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原来</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">120</span>;

<span class="hljs-comment">// 改为</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">160</span>; <span class="hljs-comment">// 距离越远，看到的范围越大</span>
</code></pre>
<h4 data-id="heading-17">方案 2：增加视野角度</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原来</span>
<span class="hljs-keyword">const</span> fov = <span class="hljs-number">40</span>;

<span class="hljs-comment">// 改为</span>
<span class="hljs-keyword">const</span> fov = <span class="hljs-number">60</span>; <span class="hljs-comment">// 视角越大，看到的范围越大</span>
</code></pre>
<h4 data-id="heading-18">方案 3：减小间距</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原来</span>
<span class="hljs-keyword">const</span> spread = <span class="hljs-number">20</span>;

<span class="hljs-comment">// 改为</span>
<span class="hljs-keyword">const</span> spread = <span class="hljs-number">15</span>; <span class="hljs-comment">// 物体靠得更近</span>
</code></pre>
<h4 data-id="heading-19">方案 4：使用正交相机</h4>
<p>如果你不需要透视效果，可以使用正交相机（OrthographicCamera），它的可视范围不会随距离变化：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">OrthographicCamera</span>(
    -<span class="hljs-number">100</span>,  <span class="hljs-comment">// left</span>
    <span class="hljs-number">100</span>,   <span class="hljs-comment">// right</span>
    <span class="hljs-number">50</span>,    <span class="hljs-comment">// top</span>
    -<span class="hljs-number">50</span>,   <span class="hljs-comment">// bottom</span>
    <span class="hljs-number">0.1</span>,   <span class="hljs-comment">// near</span>
    <span class="hljs-number">1000</span>   <span class="hljs-comment">// far</span>
);
</code></pre>
<hr/>
<h2 data-id="heading-20">实战代码</h2>
<h3 data-id="heading-21">完整的响应式相机设置</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponsiveCamera</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span> = <span class="hljs-number">40</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span> = <span class="hljs-number">0.1</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span> = <span class="hljs-number">1000</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span> = <span class="hljs-number">120</span>;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCamera</span>();
    }
    
    <span class="hljs-title function_">updateCamera</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> aspect = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span>,
            aspect,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span>,
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span>
        );
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span>;
    }
    
    <span class="hljs-comment">// 计算指定深度处的可视范围</span>
    <span class="hljs-title function_">getVisibleRange</span>(<span class="hljs-params">depth = <span class="hljs-literal">null</span></span>) {
        <span class="hljs-keyword">const</span> vFOV = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">fov</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) / <span class="hljs-number">180</span>;
        <span class="hljs-comment">// 如果没有指定深度，使用相机的默认距离</span>
        <span class="hljs-keyword">const</span> distance = depth !== <span class="hljs-literal">null</span> ? depth : <span class="hljs-variable language_">this</span>.<span class="hljs-property">distance</span>;
        <span class="hljs-keyword">const</span> height = <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(vFOV / <span class="hljs-number">2</span>) * distance;
        <span class="hljs-keyword">const</span> width = height * (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);

        <span class="hljs-keyword">return</span> { width, height };
    }
    
    <span class="hljs-comment">// 检查物体是否在可视范围内</span>
    <span class="hljs-title function_">isObjectVisible</span>(<span class="hljs-params">obj</span>) {
        <span class="hljs-keyword">const</span> pos = obj.<span class="hljs-property">position</span>;
        
        <span class="hljs-comment">// 计算物体相对于相机的距离（沿着相机的视线方向）</span>
        <span class="hljs-keyword">const</span> distanceFromCamera = <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> - pos.<span class="hljs-property">z</span>;
        
        <span class="hljs-comment">// 计算物体所在深度的可视范围</span>
        <span class="hljs-keyword">const</span> range = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getVisibleRange</span>(distanceFromCamera);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'物体距离相机:'</span>, distanceFromCamera, <span class="hljs-string">'该深度的可视范围:'</span>, range);

        <span class="hljs-keyword">return</span> (
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(pos.<span class="hljs-property">x</span>) &lt;= range.<span class="hljs-property">width</span> / <span class="hljs-number">2</span> &amp;&amp;
            <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(pos.<span class="hljs-property">y</span>) &lt;= range.<span class="hljs-property">height</span> / <span class="hljs-number">2</span> &amp;&amp;
            distanceFromCamera &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">near</span> &amp;&amp;
            distanceFromCamera &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">far</span>
        );
    }
    
    <span class="hljs-comment">// 窗口大小改变时更新</span>
    <span class="hljs-title function_">onWindowResize</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateCamera</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-title function_">updateProjectionMatrix</span>();
    }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0x222222</span>);

<span class="hljs-comment">// 4. 创建渲染器：将3D场景渲染到网页上</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// antialias开启抗锯齿</span>
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>); <span class="hljs-comment">// 设置渲染尺寸</span>
<span class="hljs-comment">// 将渲染器的画布添加到网页中</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponsiveCamera</span>();
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> camera.<span class="hljs-title function_">onWindowResize</span>());

<span class="hljs-comment">// 添加光源</span>
<span class="hljs-keyword">const</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.6</span>);
scene.<span class="hljs-title function_">add</span>(ambientLight);

<span class="hljs-keyword">const</span> directionalLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">0.8</span>);
directionalLight.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>);
scene.<span class="hljs-title function_">add</span>(directionalLight);

<span class="hljs-comment">// 检查物体是否可见</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>), <span class="hljs-title function_">createMaterial</span>());
cube.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, -<span class="hljs-number">10</span>);
scene.<span class="hljs-title function_">add</span>(cube);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params">time</span>) {
    renderer.<span class="hljs-title function_">render</span>(scene, camera.<span class="hljs-title function_">getCamera</span>());
    <span class="hljs-title function_">requestAnimationFrame</span>(animate);
}

<span class="hljs-title function_">requestAnimationFrame</span>(animate);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(camera.<span class="hljs-title function_">isObjectVisible</span>(cube)); <span class="hljs-comment">// true or false</span>
</code></pre>
<hr/>
<h2 data-id="heading-22">小结</h2>
<ol>
<li>
<p><strong>FOV 和 distance 决定可视范围</strong></p>
<ul>
<li>FOV 越大，看到的范围越大</li>
<li>distance 越大，看到的范围越大</li>
</ul>
</li>
<li>
<p><strong>aspect 必须与画布比例一致</strong></p>
<ul>
<li>否则画面会被拉伸变形</li>
</ul>
</li>
<li>
<p><strong>near 和 far 定义了深度范围</strong></p>
<ul>
<li>在这个范围外的物体看不到</li>
</ul>
</li>
</ol>
<p>📂 <strong>核心代码与完整示例：</strong>    <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqq790git%2Fmy-three-app.git" target="_blank" title="https://github.com/qq790git/my-three-app.git" ref="nofollow noopener noreferrer">my-three-app</a></p>
<h3 data-id="heading-23">总结</h3>
<p><strong>如果你喜欢本教程，记得点赞+收藏！关注我获取更多Three.js开发干货</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（87）如何在安全测试中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7603563317040349247</link>    <guid>https://juejin.cn/post/7603563317040349247</guid>    <pubDate>2026-02-06T14:25:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040349247" data-draft-id="7603563360329367594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（87）如何在安全测试中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T14:25:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（87）如何在安全测试中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:25:35.000Z" title="Fri Feb 06 2026 14:25:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在安全测试中使用Hibernate，可以帮助你识别和解决与ORM框架相关的安全漏洞，如SQL注入、数据泄露等。以下是一个详细的示例，结合代码讲解如何在安全测试中使用Hibernate，包括数据库配置、编写实体类、模拟潜在的安全漏洞、编写安全测试脚本以及使用工具进行安全评估。</p>
<h3 data-id="heading-0">前提条件</h3>
<ul>
<li>使用MySQL作为数据库。</li>
<li>使用Gradle作为构建工具。</li>
<li>使用JUnit进行安全测试。</li>
<li>使用Hibernate进行ORM操作。</li>
<li>使用OWASP ZAP进行安全扫描。</li>
</ul>
<h3 data-id="heading-1">1. 设置Hibernate配置</h3>
<p>首先，创建一个Hibernate配置文件<code>hibernate.cfg.xml</code>，用于连接数据库。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/security_test_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 创建实体类</h3>
<p>定义一个简单的实体类来表示数据库表中的数据。</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. 配置Gradle</h3>
<p>在Gradle构建脚本中添加Hibernate和JUnit依赖。</p>
<h4 data-id="heading-6"><code>build.gradle</code></h4>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

test {
    useJUnitPlatform()
}
</code></pre>
<h3 data-id="heading-7">4. 编写数据访问对象（DAO）</h3>
<p>编写一个数据访问对象类，用于执行数据库操作。</p>
<h4 data-id="heading-8"><code>UserDAO.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAO</span> {
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDAO</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        session.save(user);
        transaction.commit();
        session.close();
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users;
    }

    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">findUserByNameUnsafe</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User WHERE name = '"</span> + name + <span class="hljs-string">"'"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users.isEmpty() ? <span class="hljs-literal">null</span> : users.get(<span class="hljs-number">0</span>);
    }
}
</code></pre>
<h3 data-id="heading-9">5. 编写安全测试</h3>
<p>编写JUnit测试类，模拟潜在的SQL注入攻击并检测安全漏洞。</p>
<h4 data-id="heading-10"><code>UserDAOTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;

<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAOTest</span> {
    <span class="hljs-keyword">private</span> UserDAO userDAO;

    <span class="hljs-meta">@BeforeEach</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> {
        userDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDAO</span>();
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        user.setName(<span class="hljs-string">"admin"</span>);
        user.setEmail(<span class="hljs-string">"admin@example.com"</span>);
        userDAO.saveUser(user);
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSQLInjection</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">maliciousInput</span> <span class="hljs-operator">=</span> <span class="hljs-string">"admin' OR '1'='1"</span>;
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userDAO.findUserByNameUnsafe(maliciousInput);
        assertNotNull(user, <span class="hljs-string">"SQL injection vulnerability detected!"</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">6. 使用OWASP ZAP进行安全扫描</h3>
<p>OWASP ZAP是一个开源的安全扫描工具，可以用于检测Web应用程序中的安全漏洞。以下是如何使用OWASP ZAP进行安全扫描的步骤。</p>
<h4 data-id="heading-12">安装OWASP ZAP</h4>
<p>从<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.zaproxy.org%2Fdownload%2F" target="_blank" title="https://www.zaproxy.org/download/" ref="nofollow noopener noreferrer">OWASP ZAP官网</a>下载并安装ZAP。</p>
<h4 data-id="heading-13">配置OWASP ZAP代理</h4>
<p>OWASP ZAP可以配置为代理，拦截和分析应用程序的HTTP请求和响应。</p>
<ol>
<li>启动OWASP ZAP。</li>
<li>配置浏览器代理为ZAP代理（默认监听端口为8080）。</li>
</ol>
<h4 data-id="heading-14">运行安全扫描</h4>
<ol>
<li>启动你的Web应用程序。</li>
<li>在浏览器中通过代理访问你的应用程序，让ZAP拦截请求。</li>
<li>使用ZAP进行自动扫描，查找潜在的安全漏洞。</li>
</ol>
<h3 data-id="heading-15">7. 集成到CI/CD流程</h3>
<p>将安全测试和扫描集成到你的CI/CD流程中，确保每次构建都进行安全评估。</p>
<h4 data-id="heading-16"><code>.github/workflows/security-test.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Security</span> <span class="hljs-string">Test</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">security_test_db</span>
          <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">db_user</span>
          <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">db_password</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">--health-cmd="mysqladmin</span> <span class="hljs-string">ping</span> <span class="hljs-string">--silent"</span> <span class="hljs-string">--health-interval=10s</span> <span class="hljs-string">--health-timeout=5s</span> <span class="hljs-string">--health-retries=3</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">security</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">test</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">OWASP</span> <span class="hljs-string">ZAP</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">zaproxy/action-full-scan@v0.4.0</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">target:</span> <span class="hljs-string">'http://localhost:8080'</span>
        <span class="hljs-attr">docker_name:</span> <span class="hljs-string">'owasp/zap2docker-stable'</span>
      <span class="hljs-attr">env:</span>
        <span class="hljs-attr">GITHUB_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.GITHUB_TOKEN</span> <span class="hljs-string">}}</span>
</code></pre>
<h3 data-id="heading-17">例子解释</h3>
<ol>
<li><strong>Hibernate配置：</strong> 配置一个Hibernate配置文件，用于连接数据库。</li>
<li><strong>实体类：</strong> 创建一个简单的实体类来表示数据库表中的数据。</li>
<li><strong>Gradle配置：</strong> 在Gradle构建脚本中添加Hibernate和JUnit依赖。</li>
<li><strong>数据访问对象（DAO）：</strong> 编写一个数据访问对象类，用于执行数据库操作。</li>
<li><strong>安全测试：</strong> 编写JUnit测试类，模拟潜在的SQL注入攻击并检测安全漏洞。</li>
<li><strong>使用OWASP ZAP进行安全扫描：</strong> 配置并使用OWASP ZAP进行安全扫描，查找应用程序中的安全漏洞。</li>
<li><strong>集成到CI/CD流程：</strong> 将安全测试和扫描集成到CI/CD流程中，确保每次构建都进行安全评估。</li>
</ol>
<p>通过以上配置和代码示例，我们展示了如何在安全测试中使用Hibernate。这包括如何配置Hibernate、定义实体类、编写数据访问对象、模拟潜在的安全漏洞、编写安全测试脚本以及使用OWASP ZAP进行安全扫描。此流程帮助识别和解决与ORM框架相关的安全漏洞，确保应用程序的安全性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（88）如何在负载测试中使用Hibernate？]]></title>    <link>https://juejin.cn/post/7603563317040382015</link>    <guid>https://juejin.cn/post/7603563317040382015</guid>    <pubDate>2026-02-06T14:26:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040382015" data-draft-id="7603561363571425343" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（88）如何在负载测试中使用Hibernate？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T14:26:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（88）如何在负载测试中使用Hibernate？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:26:15.000Z" title="Fri Feb 06 2026 14:26:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在负载测试中使用Hibernate，可以帮助你识别和解决应用程序在高负载下的性能瓶颈。以下是一个详细的示例，结合代码讲解如何在负载测试中使用Hibernate，包括数据库配置、编写实体类、设置数据访问对象 (DAO)、负载测试脚本以及使用工具进行负载测试。</p>
<h3 data-id="heading-0">前提条件</h3>
<ul>
<li>使用MySQL作为数据库。</li>
<li>使用Gradle作为构建工具。</li>
<li>使用JUnit进行负载测试。</li>
<li>使用Hibernate进行ORM操作。</li>
<li>使用Gatling进行负载测试。</li>
</ul>
<h3 data-id="heading-1">1. 设置Hibernate配置</h3>
<p>首先，创建一个Hibernate配置文件 <code>hibernate.cfg.xml</code>，用于连接数据库。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span> <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/load_test_db<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>db_user<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>db_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 创建实体类</h3>
<p>定义一个简单的实体类来表示数据库表中的数据。</p>
<h4 data-id="heading-4"><code>User.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "users")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-comment">// Getters and setters</span>
}
</code></pre>
<h3 data-id="heading-5">3. 配置Gradle</h3>
<p>在Gradle构建脚本中添加Hibernate和JUnit依赖。</p>
<h4 data-id="heading-6"><code>build.gradle</code></h4>
<pre><code class="hljs language-groovy" lang="groovy">plugins {
    id 'java'
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.hibernate:hibernate-core:5.6.5.Final'
    implementation 'mysql:mysql-connector-java:8.0.27'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.8.2'
}

test {
    useJUnitPlatform()
}
</code></pre>
<h3 data-id="heading-7">4. 编写数据访问对象（DAO）</h3>
<p>编写一个数据访问对象类，用于执行数据库操作。</p>
<h4 data-id="heading-8"><code>UserDAO.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAO</span> {
    <span class="hljs-keyword">private</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserDAO</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Configuration</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>);
        sessionFactory = config.buildSessionFactory();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        session.save(user);
        transaction.commit();
        session.close();
    }

    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">findAllUsers</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        List&lt;User&gt; users = session.createQuery(<span class="hljs-string">"FROM User"</span>, User.class).list();
        session.close();
        <span class="hljs-keyword">return</span> users;
    }
}
</code></pre>
<h3 data-id="heading-9">5. 编写负载测试脚本</h3>
<p>使用JUnit编写负载测试脚本，模拟高并发环境下的数据库操作。</p>
<h4 data-id="heading-10"><code>UserDAOTest.java</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.junit.jupiter.api.*;
<span class="hljs-keyword">import</span> java.util.concurrent.*;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> org.junit.jupiter.api.Assertions.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDAOTest</span> {
    <span class="hljs-keyword">private</span> UserDAO userDAO;

    <span class="hljs-meta">@BeforeEach</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUp</span><span class="hljs-params">()</span> {
        userDAO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDAO</span>();
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConcurrentUserInserts</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">numberOfThreads</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(numberOfThreads);
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(numberOfThreads);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numberOfThreads; i++) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> i;
            executorService.submit(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
                    user.setName(<span class="hljs-string">"User"</span> + index);
                    user.setEmail(<span class="hljs-string">"user"</span> + index + <span class="hljs-string">"@example.com"</span>);
                    userDAO.saveUser(user);
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown();
                }
            });
        }

        latch.await();
        executorService.shutdown();

        <span class="hljs-comment">// Verify that all users were inserted</span>
        List&lt;User&gt; users = userDAO.findAllUsers();
        assertEquals(numberOfThreads, users.size());
    }
}
</code></pre>
<h3 data-id="heading-11">6. 使用Gatling进行负载测试</h3>
<p>Gatling是一个开源的负载测试工具，可以生成高并发请求来模拟实际的用户行为。</p>
<h4 data-id="heading-12">安装Gatling</h4>
<p>从<a href="https://link.juejin.cn?target=https%3A%2F%2Fgatling.io%2Fopen-source%2F%23download" target="_blank" title="https://gatling.io/open-source/#download" ref="nofollow noopener noreferrer">Gatling官网</a>下载并安装Gatling。</p>
<h4 data-id="heading-13">编写Gatling脚本</h4>
<p>创建一个Gatling脚本来模拟高并发请求。假设你有一个REST API endpoint来保存用户数据。</p>
<h4 data-id="heading-14"><code>UserSimulation.scala</code></h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> io.gatling.core.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> io.gatling.http.<span class="hljs-type">Predef</span>._
<span class="hljs-keyword">import</span> scala.concurrent.duration._

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserSimulation</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Simulation</span> </span>{

  <span class="hljs-keyword">val</span> httpProtocol = http
    .baseUrl(<span class="hljs-string">"http://localhost:8080"</span>) <span class="hljs-comment">// 你的应用程序的基URL</span>
    .acceptHeader(<span class="hljs-string">"application/json"</span>)
    .contentTypeHeader(<span class="hljs-string">"application/json"</span>)

  <span class="hljs-keyword">val</span> scn = scenario(<span class="hljs-string">"User Simulation"</span>)
    .exec(
      http(<span class="hljs-string">"Save User"</span>)
        .post(<span class="hljs-string">"/users"</span>)
        .body(<span class="hljs-type">StringBody</span>(<span class="hljs-string">"""{"name": "John Doe", "email": "john.doe@example.com"}"""</span>)).asJson
        .check(status.is(<span class="hljs-number">200</span>))
    )

  setUp(
    scn.inject(
      atOnceUsers(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 模拟1000个并发用户</span>
    )
  ).protocols(httpProtocol)
}
</code></pre>
<h4 data-id="heading-15">运行Gatling脚本</h4>
<p>在Gatling目录中运行以下命令来执行负载测试。</p>
<pre><code class="hljs language-bash" lang="bash">gatling.sh -s UserSimulation
</code></pre>
<h3 data-id="heading-16">7. 集成到CI/CD流程</h3>
<p>将负载测试集成到CI/CD流程中，确保每次构建都进行负载测试评估。</p>
<h4 data-id="heading-17"><code>.github/workflows/load-test.yml</code></h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Load</span> <span class="hljs-string">Test</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>

    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:5.7</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">load_test_db</span>
          <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">db_user</span>
          <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">db_password</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">--health-cmd="mysqladmin</span> <span class="hljs-string">ping</span> <span class="hljs-string">--silent"</span> <span class="hljs-string">--health-interval=10s</span> <span class="hljs-string">--health-timeout=5s</span> <span class="hljs-string">--health-retries=3</span>

    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">JDK</span> <span class="hljs-number">11</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Grant</span> <span class="hljs-string">execute</span> <span class="hljs-string">permission</span> <span class="hljs-string">for</span> <span class="hljs-string">gradlew</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">chmod</span> <span class="hljs-string">+x</span> <span class="hljs-string">gradlew</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">load</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">./gradlew</span> <span class="hljs-string">test</span>

    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">Gatling</span> <span class="hljs-string">load</span> <span class="hljs-string">test</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">gatling.sh</span> <span class="hljs-string">-s</span> <span class="hljs-string">UserSimulation</span>
</code></pre>
<h3 data-id="heading-18">例子解释</h3>
<ol>
<li><strong>Hibernate配置：</strong> 配置一个Hibernate配置文件，用于连接数据库。</li>
<li><strong>实体类：</strong> 创建一个简单的实体类来表示数据库表中的数据。</li>
<li><strong>Gradle配置：</strong> 在Gradle构建脚本中添加Hibernate和JUnit依赖。</li>
<li><strong>数据访问对象（DAO）：</strong> 编写一个数据访问对象类，用于执行数据库操作。</li>
<li><strong>负载测试脚本：</strong> 使用JUnit编写负载测试脚本，模拟高并发环境下的数据库操作。</li>
<li><strong>使用Gatling进行负载测试：</strong> 编写Gatling脚本，模拟高并发请求来测试应用程序的性能。</li>
<li><strong>集成到CI/CD流程：</strong> 将负载测试集成到CI/CD流程中，确保每次构建都进行负载测试评估。</li>
</ol>
<p>通过以上配置和代码示例，我们展示了如何在负载测试中使用Hibernate。这包括配置Hibernate、定义实体类、编写数据访问对象、编写负载测试脚本、使用Gatling进行负载测试，以及将负载测试集成到CI/CD流程中。此流程帮助识别和解决应用程序在高负载下的性能瓶颈，确保在实际使用环境中系统的稳定性和高效性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别只会“加索引”了！这 3 个 PostgreSQL 反常识优化，能把性能和成本一起打下来]]></title>    <link>https://juejin.cn/post/7603567912592506907</link>    <guid>https://juejin.cn/post/7603567912592506907</guid>    <pubDate>2026-02-06T14:55:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592506907" data-draft-id="7603352117640167433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别只会“加索引”了！这 3 个 PostgreSQL 反常识优化，能把性能和成本一起打下来"/> <meta itemprop="keywords" content="数据库,后端"/> <meta itemprop="datePublished" content="2026-02-06T14:55:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dcs"/> <meta itemprop="url" content="https://juejin.cn/user/3679404422861902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别只会“加索引”了！这 3 个 PostgreSQL 反常识优化，能把性能和成本一起打下来
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3679404422861902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dcs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T14:55:22.000Z" title="Fri Feb 06 2026 14:55:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://files.mdnice.com/user/44095/0ac2522b-136d-4b10-b6a0-32ecdc8ca589.jpg" alt="image" loading="lazy"/></p>
<p>数据库性能优化这事儿，很多人条件反射就三板斧：<strong>改 SQL、加索引、再加索引</strong>。一通操作下来，查询快了，磁盘炸了；延迟降了，维护成本上天；更扎心的是——你还以为自己“优化得很专业”。😅</p>
<p>这篇文章的思路很“叛逆”：与其在常规套路里打转，不如换个角度，利用 PostgreSQL 本身的一些机制做“非常规优化”。下面挑 3 个最容易落地、同时最容易被忽略的点，讲透它们为什么能省钱又提速。</p>
<hr/>
<h2 data-id="heading-0">1）别再全表扫了</h2>
<p>先看一个特别真实的场景：用户表只有两种 plan：<code>free</code> 和 <code>pro</code>，并且写了约束，保证不会出现别的值。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    username TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    plan TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-keyword">CONSTRAINT</span> plan_check <span class="hljs-keyword">CHECK</span> (plan <span class="hljs-keyword">IN</span> (<span class="hljs-string">'free'</span>, <span class="hljs-string">'pro'</span>))
);
</code></pre>
<p>然后某位大佬在报表工具里一顿操作猛如虎，写了个：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> plan <span class="hljs-operator">=</span> <span class="hljs-string">'Pro'</span>;
</code></pre>
<p>注意大小写：<code>Pro</code> ≠ <code>pro</code>。结果当然是 0 行。问题是——它为了得到“0 行”，居然可能 <strong>把全表扫了一遍</strong>，这就很离谱：明明约束告诉你“根本不可能有 Pro”，你还扫什么扫？扫得我 CPU 风扇都快起飞了。</p>
<p>这时可以打开一个“看起来冷门但对报表场景很香”的开关：<code>constraint_exclusion</code>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> constraint_exclusion <span class="hljs-keyword">to</span> <span class="hljs-string">'on'</span>;
</code></pre>
<p>开启后，PostgreSQL 会在生成执行计划时参考约束信息，发现条件永远为假，就直接变成“秒回 0 行”，彻底避免无意义的 Seq Scan。</p>
<p>为什么它默认不是 <code>on</code>？因为它会增加规划阶段开销：对“系统自动生成的简单查询”，大概率用不上；但对 BI/报表这种<strong>人肉手写 SQL</strong>的场景，写错值、写错条件太常见了。
结论很直白：<strong>如果你的数据库经常被报表工具/分析师/临时查询折腾，考虑在报表环境把它打开，能省不少冤枉资源。</strong></p>
<hr/>
<h2 data-id="heading-1">2）只要“按天统计”，就别用“精确到秒”的索引</h2>
<p>函数索引省 3 倍空间还更快</p>
<p>第二个场景更像日常优化现场：10M 的销售表 <code>sale</code>，分析师要做按天汇总：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>), <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> <span class="hljs-string">'2025-01-01 UTC'</span> <span class="hljs-operator">&lt;=</span> sold_at <span class="hljs-keyword">AND</span> sold_at <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-02-01 UTC'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>大家的第一反应：给 <code>sold_at</code> 上 B-Tree 索引！</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX sale_sold_at_ix <span class="hljs-keyword">ON</span> sale(sold_at);
</code></pre>
<p>查询确实快了，但你一看索引体积——214MB，心里也跟着“咯噔”一下：为了按天统计，建了个精确到毫秒级的索引，这属于<strong>用大炮打蚊子</strong>。</p>
<p>更聪明的做法是：只索引“天”，别索引“秒”。直接上表达式索引（函数索引）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX sale_sold_at_date_ix <span class="hljs-keyword">ON</span> sale((date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>))::<span class="hljs-type">date</span>);
</code></pre>
<p>然后把查询写成同样表达式：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>), <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>)::<span class="hljs-type">date</span> <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>结果：索引体积从 214MB 变成 66MB，直接小了 3 倍多，还更快。原因不只是 <code>date</code> 比 <code>timestamptz</code> 小，而是<strong>离散值更少</strong>，B-Tree 可以做去重优化（deduplication），索引变得更紧凑。</p>
<p>但函数索引有个“脾气”：表达式得一模一样，稍微换个写法就可能用不上索引，比如把 <code>date_trunc</code> 换成 <code>::date</code>，就直接退化回 Seq Scan。现实里让全团队“严格写同一表达式”，基本等同于要求大家每天不犯错（这事比上班准点还难🙂）。</p>
<p>解决方案有两种：</p>
<h3 data-id="heading-2">方案 A：View，把表达式固化成列</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_sale <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>, date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>)::<span class="hljs-type">date</span> <span class="hljs-keyword">AS</span> sold_at_date
<span class="hljs-keyword">FROM</span> sale;
</code></pre>
<h3 data-id="heading-3">方案 B：Generated Column（更像“官方自带的 view 列”）</h3>
<p>从 PostgreSQL 14 起支持生成列；文章里提到 PostgreSQL 18 还支持<strong>虚拟生成列</strong>：看起来是列，实际上是每次访问时计算的表达式，既保证表达式一致，又不额外存储（主打一个“既要又要”）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> sale <span class="hljs-keyword">ADD</span> sold_at_date <span class="hljs-type">DATE</span>
GENERATED ALWAYS <span class="hljs-keyword">AS</span> (date_trunc(<span class="hljs-string">'day'</span>, sold_at <span class="hljs-keyword">AT</span> <span class="hljs-type">TIME</span> ZONE <span class="hljs-string">'UTC'</span>));
</code></pre>
<p>然后查询就统一写：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> sold_at_date, <span class="hljs-built_in">SUM</span>(charged)
<span class="hljs-keyword">FROM</span> sale
<span class="hljs-keyword">WHERE</span> sold_at_date <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-31'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>;
</code></pre>
<p>这类优化特别适合那种“指标按天/按周/按月统计”的系统：<strong>别让索引为你用不到的精度买单</strong>。</p>
<hr/>
<h2 data-id="heading-4">3）长 URL 唯一约束把索引撑爆？</h2>
<p>用排他约束 + Hash 索引，5 倍缩容（但有坑）</p>
<p>当你要对一个超长字段（比如 URL）做唯一约束时，B-Tree 索引可能接近表本体大小，因为 B-Tree 叶子节点会存储被索引值本身。URL 又长又几乎不重复，索引很容易“胖成球”。</p>
<p>那能不能用 Hash 索引？Hash 索引存的是 hash 值，通常小很多。问题来了：PostgreSQL 的 Hash 索引 <strong>不支持 unique index</strong>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX urls_url_unique_hash <span class="hljs-keyword">ON</span> urls <span class="hljs-keyword">USING</span> HASH(url);
<span class="hljs-comment">-- ERROR: access method "hash" does not support unique indexes</span>
</code></pre>
<p>但 PostgreSQL 还有个很少人用、名字很霸气的约束：<strong>Exclusion Constraint（排他约束）</strong>。它能配合 Hash 索引做“等值排他”，效果等同唯一约束：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> urls <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> urls_url_unique_hash EXCLUDE <span class="hljs-keyword">USING</span> HASH (url <span class="hljs-keyword">WITH</span> <span class="hljs-operator">=</span>);
</code></pre>
<p>于是你得到了一个“用 Hash 索引实现的唯一性”。索引体积可能从 154MB 掉到 32MB，约 5 倍缩水，而且等值查询同样能用索引：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> urls <span class="hljs-keyword">WHERE</span> url <span class="hljs-operator">=</span> <span class="hljs-string">'https://hakibenita.com'</span>;
</code></pre>
<p>不过它不是银弹，有几个硬坑必须知道：</p>
<ul>
<li><strong>不能被外键引用</strong>：外键要求引用“唯一约束”，而排他约束不算传统意义的 unique constraint，所以引用会失败。</li>
<li><strong><code>INSERT ... ON CONFLICT</code> 有限制</strong>：
<code>ON CONFLICT (url)</code> 可能不认；需要写 <code>ON CONFLICT ON CONSTRAINT ...</code>；更糟的是 <code>DO UPDATE</code> 不支持排他约束。</li>
<li>更通用的替代写法是用 <code>MERGE</code>（如果你的版本支持）：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">MERGE</span> <span class="hljs-keyword">INTO</span> urls t
<span class="hljs-keyword">USING</span> (<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1000004</span>, <span class="hljs-string">'https://hakibenita.com'</span>)) <span class="hljs-keyword">AS</span> s(id, url)
<span class="hljs-keyword">ON</span> t.url <span class="hljs-operator">=</span> s.url
<span class="hljs-keyword">WHEN</span> MATCHED <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">SET</span> id <span class="hljs-operator">=</span> s.id
<span class="hljs-keyword">WHEN</span> <span class="hljs-keyword">NOT</span> MATCHED <span class="hljs-keyword">THEN</span> <span class="hljs-keyword">INSERT</span> (id, url) <span class="hljs-keyword">VALUES</span> (s.id, s.url);
</code></pre>
<p>适用场景一句话总结：<strong>超长字符串字段需要唯一性，但不需要被外键引用，且写入冲突处理可以接受用 MERGE/业务层逻辑替代</strong>。</p>
<hr/>
<h2 data-id="heading-5">结语</h2>
<p>真正的优化，不是“更快”，而是“更合适”✅</p>
<p>这 3 个技巧的共同点很朴素：
不是让数据库“更努力”，而是让数据库<strong>别做无意义的事</strong>。</p>
<ul>
<li>报表查错值？让约束帮你秒判 false，别全表扫</li>
<li>只按天统计？索引就按天建，别为秒级精度付账</li>
<li>长字段唯一性撑爆索引？换思路，用排他约束把 Hash 索引用起来</li>
</ul>
<p>下次你准备“再加一个索引”之前，不妨先问一句：
<strong>需求到底需要多精？这条查询真的值得我为它养一个 200MB 的索引吗？</strong>
能把性能、成本、维护复杂度一起优化的，才是最爽的优化😉</p>
<hr/>
<p><strong>喜欢就奖励一个“👍”和“在看”呗~</strong></p>
<p><img src="https://files.mdnice.com/user/44095/f9363b7e-9738-44f3-9ac6-8ee2cddf995d.png" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个实用的Android Perfetto分析器]]></title>    <link>https://juejin.cn/post/7603321550247690290</link>    <guid>https://juejin.cn/post/7603321550247690290</guid>    <pubDate>2026-02-06T13:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247690290" data-draft-id="7601843004959195182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个实用的Android Perfetto分析器"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T13:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个实用的Android Perfetto分析器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:05:37.000Z" title="Fri Feb 06 2026 13:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「Building a Deterministic Perfetto Analyzer for Android」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fproandroiddev.com%2Fbuilding-a-deterministic-perfetto-analyzer-for-android-95877b3e083e" target="_blank" title="https://proandroiddev.com/building-a-deterministic-perfetto-analyzer-for-android-95877b3e083e" ref="nofollow noopener noreferrer">proandroiddev.com/building-a-…</a>，由Sumeet Singh Arora发布于2026年1月6日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/545e6c1506a5467aa2e109f0a6fa2255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770987937&amp;x-signature=C5zjzErT1qD49Or6rhcArI8lEUc%3D" alt="插图由作者使用 AI 图像生成工具生成。" loading="lazy"/></p>
<h2 data-id="heading-0">每个 Android 性能工程师都面临的问题</h2>
<p>当你打开一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2F" target="_blank" title="https://perfetto.dev/" ref="nofollow noopener noreferrer">Perfetto</a> trace。</p>
<p>会有成千上万个切片。数十个线程。数百万个数据点。一条看起来像抽象艺术的时间线。</p>
<p>而在这其中的某个地方——被层层系统噪声、框架回调和线程交错所掩盖——隐藏着一个简单问题的答案：<em>为什么我的应用运行缓慢？</em></p>
<p>我花了数年时间大规模调试 Android 性能。模式总是千篇一律：</p>
<ol>
<li>
<p>用户抱怨启动卡顿/缓慢</p>
</li>
<li>
<p>工程师捕获跟踪信息</p>
</li>
<li>
<p>工程师打开 Perfetto 用户界面</p>
</li>
<li>
<p>工程师花费 2 小时滚动、缩放、眯眼查看</p>
</li>
<li>
<p>工程师_可能_找到了根本原因</p>
</li>
</ol>
<p>跟踪信息无法讲述故事。它们只是罗列事实——带有时间戳、层层嵌套、令人眼花缭乱。“拥有跟踪信息”和“理解性能”之间存在着巨大的鸿沟。</p>
<p><strong>本文旨在通过编程方式弥合这一鸿沟。</strong></p>
<p>在过去的几周里，我一直在构建一个<strong>Perfetto 跟踪分析器</strong>，它可以将原始跟踪信息转换为结构化的、易于理解的洞察。没有仪表盘。只有确定性分析，它反映了经验丰富的工程师实际思考性能问题的方式。</p>
<p>读完本文，你将了解如何：</p>
<ol>
<li>
<p>使跟踪信息<strong>可读</strong>——启动时间、长时间任务、帧健康状况</p>
</li>
<li>
<p>使跟踪信息<strong>可归属</strong>——进程、线程、组件所有权</p>
</li>
<li>
<p>分离<strong>职责</strong>——应用程序、框架和系统</p>
</li>
<li>
<p>使用<strong>时间窗口</strong>查找关键事件发生的时间点</p>
</li>
<li>
<p>生成<strong>确定性嫌疑对象</strong>——用于调查的优先级信号</p>
</li>
</ol>
<h2 data-id="heading-1">为什么 Perfetto 跟踪难以阅读</h2>
<p>Perfetto 功能极其强大。它可以捕获：</p>
<ul>
<li>
<p>CPU 调度</p>
</li>
<li>
<p>帧渲染</p>
</li>
<li>
<p>Binder 事务</p>
</li>
<li>
<p>应用自定义跟踪部分</p>
</li>
<li>
<p>系统服务活动</p>
</li>
</ul>
<p>但强大的功能也带​​来了复杂性。一个典型的跟踪可能包含：</p>
<ul>
<li>
<p>超过 50,000 个切片</p>
</li>
<li>
<p>超过 100 个不同的线程名称</p>
</li>
<li>
<p>超过 10 层的嵌套层级结构</p>
</li>
</ul>
<p>当你调试卡顿的滚动或缓慢的启动问题时，你并不需要所有这些信息。你需要的是：</p>
<ol>
<li>
<p><strong>发生了什么</strong> — 启动时间、耗时较长的任务、帧健康状况</p>
</li>
<li>
<p><strong>谁做的</strong> — 哪个进程、哪个线程</p>
</li>
<li>
<p><strong>什么类型的工作</strong> — 应用代码、框架还是系统代码</p>
</li>
</ol>
<p>让我们逐一解决这些问题。</p>
<h2 data-id="heading-2">第一步：使跟踪更易读</h2>
<p>首要目标是提取人们真正关心的高级指标。</p>
<h3 data-id="heading-3">启动时间</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">分析器</a> 使用尽力而为的启发式方法来估算启动时间：<strong>从最早的切片到第一个 <code>Choreographer#doFrame</code></strong> 的时间。</p>
<p>这种方法并不完美——它无法涵盖所有​​启动场景——但它提供了一个有用的基准进行比较。</p>
<p>以下是 <a href="https://link.juejin.cn?target=http%3A%2F%2Fmedium.com%2Fr%3Furl%3Dhttps%253A%252F%252Fgithub.com%252Fsinghsume123%252FTraceToy" target="_blank" title="http://medium.com/r?url=https%3A%2F%2Fgithub.com%2Fsinghsume123%2FTraceToy" ref="nofollow noopener noreferrer">TraceToy</a> 测试跟踪的示例（TraceToy 是我专门构建的一个示例应用程序，用于生成有趣的测试跟踪——稍后会详细介绍）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"startup_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>在生产环境中，对于优化良好的冷启动，你通常会看到 500–1500 毫秒的启动时间；而对于初始化繁重的应用程序，启动时间则可能达到 2000–5000 毫秒甚至更长。具体的数值并不重要，重要的是跟踪其随时间的变化——无论基线是 800 毫秒还是 3000 毫秒，20% 的性能下降就是 20% 的性能下降。</p>
<p>生产环境的应用通常会更精确地检测启动过程——使用 <code>reportFullyDrawn()</code>、自定义跟踪标记（例如 <code>Startup#complete</code>）或 Jetpack App Startup 等库。当这些方法不可用时，分析器的启发式方法是一个合理的备选方案，但你可以（也应该）对其进行调整，使其与应用对“启动完成”的实际定义相匹配。</p>
<p>一个数值。可立即用于性能下降检测。</p>
<h3 data-id="heading-4">UI 线程上的长任务</h3>
<p>长任务是指超过阈值并阻塞主线程的任务片段。这些是导致卡顿和无响应的主要原因。</p>
<p>分析器默认使用 <strong>50 毫秒的阈值</strong>（可通过 <code>--long-task-ms</code> 配置）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ui_thread_long_tasks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"threshold_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;internal slice&gt;"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16572.1</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"216"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4103.2</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Handler: android.view.View"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">312.5</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>看出问题了吗？是数字 ID。内部切片。无上下文。无归属信息。</p>
<p>技术上正确。实际应用价值有限。</p>
<p>我们知道_某些东西_阻塞了主线程 16 秒。但我们不知道_是什么_，也不知道_是谁_造成的。这就是原始分析失效的地方——也是为什么步骤 2（归属信息）至关重要的原因。</p>
<h3 data-id="heading-5">帧健康状况</h3>
<p>丢帧会导致明显的卡顿。分析器从 <code>Choreographer#doFrame</code> 切片中提取帧时间：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"frame_features"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"total_frames"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">888</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"janky_frames"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">37</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"p95_frame_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14.35</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>在这里，百分位数比平均值更重要——即使大多数帧都很快，少数几个坏帧也会破坏流畅度。</p>
<h3 data-id="heading-6">局限性</h3>
<p>此时，我们可以回答：<em>发生了什么？</em></p>
<p>但我们无法回答：<em>谁该负责？</em></p>
<h2 data-id="heading-7">步骤 2：使跟踪数据可归因</h2>
<p>归因是指将性能数据与所有权关联起来。在调试实际问题时，工程师会问：</p>
<ul>
<li>
<p><em>哪个</em> <em><strong>进程</strong></em> <em>执行了此操作？</em></p>
</li>
<li>
<p><em>哪个</em> <em><strong>线程</strong></em>*？*</p>
</li>
<li>
<p><em>是我的</em> <em><strong>应用</strong></em> <em>还是其他程序</em>？_</p>
</li>
</ul>
<h3 data-id="heading-8">聚焦进程过滤</h3>
<p>首先，我们需要过滤掉噪声。跟踪数据会捕获设备上的_所有_活动——系统服务、其他应用、内核活动。其中大部分都无关紧要。</p>
<p>分析器支持聚焦模式：</p>
<pre><code class="hljs language-bash" lang="bash">python3 -m perfetto_agent.cli analyze \
  --trace tracetoy_trace.perfetto-trace \
  --focus-process com.example.tracetoy \
  --out analysis.json
</code></pre>
<p>这会将输出从“设备上发生的一切”转移到“与_此_应用相关的内容”。这是一个小小的标志，却能极大地提高信噪比。</p>
<h3 data-id="heading-9">进程和线程识别</h3>
<p>设置聚焦进程后，每个切片都会包含所有权数据。分析器会将 <code>pid</code> 和 <code>tid</code> 连接到进程名和线程名：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">267.29</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xample.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"process_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.tracetoy"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>将其与步骤 1 中无用的 <code>"name": "216"</code> 进行比较。现在我们知道：</p>
<ul>
<li>
<p>✅ 它来自我的应用程序 (<code>com.example.tracetoy</code>)</p>
</li>
<li>
<p>✅ 它运行在主线程上 (tid == pid)</p>
</li>
<li>
<p>✅ 这是一个应用程序定义的段（<code>BG#</code> 前缀）</p>
</li>
</ul>
<h3 data-id="heading-10">主线程检测</h3>
<p>这里有一个微妙但重要的细节：<strong>主线程在跟踪信息中并不总是标记为“main”</strong>。</p>
<p>分析器采用尽力而为的启发式方法：</p>
<ol>
<li>
<p>如果应用进程存在名为 <code>"main"</code> 的线程 → 使用该线程</p>
</li>
<li>
<p>否则，回退到 <code>tid == pid</code>（在 Android 中通常适用于主线程）</p>
</li>
</ol>
<p>这模拟了经验丰富的工程师在元数据不完整时的推理方式——为了透明起见，分析器会记录所使用的启发式方法。</p>
<h3 data-id="heading-11">应用自定义节成为一等公民</h3>
<p>Android 的 <code>Trace.beginSection()</code> API 允许开发者标记自定义 span：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Trace.beginSection(<span class="hljs-string">"UI#loadUserProfile"</span>)
<span class="hljs-comment">// ... work ...</span>
Trace.endSection()
</code></pre>
<p>分析器会显式地提取并聚合这些信息：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"app_sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"top_by_total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">11811.05</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">194</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"UI#stall_button_click"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"total_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">818.05</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这回答了以下问题：<em>我的代码的哪些部分_主导了执行？</em></p>
<p>至此，我们已将匿名切片转换为具有属性的、可操作的数据。但我们仍然没有回答最重要的问题：<strong>究竟是谁的错——我的应用、框架还是系统？</strong></p>
<h2 data-id="heading-12">第三步：职责分离</h2>
<p>关于移动性能，有一个令人不安的真相：</p>
<p><strong>当你的应用运行缓慢时，并非所有问题都出在你身上。</strong></p>
<p>各种数据混杂在一起：</p>
<ul>
<li>
<p>你的应用代码</p>
</li>
<li>
<p>Android 框架内部代码</p>
</li>
<li>
<p>系统和内核活动</p>
</li>
</ul>
<p>如果不将这些数据分离，很容易得出错误的结论，并优化错误的地方。</p>
<h3 data-id="heading-13">确定性分类</h3>
<p>每个切片现在都被标记为以下类别之一：</p>
<ul>
<li>
<p>🟢 <strong>app</strong> — 焦点进程上的应用程序标记（例如，<code>UI#stall_button_click</code>）</p>
</li>
<li>
<p>🔵 <strong>framework</strong> — 焦点进程上的框架标记（例如，<code>Choreographer#doFrame</code>）</p>
</li>
<li>
<p>🔴 <strong>system</strong> — 非焦点进程 ID 或系统标记（例如，<code>binder transaction</code>）</p>
</li>
<li>
<p>⚪ <strong>unknown</strong> — 无法确定分类（例如，数字 ID）</p>
</li>
</ul>
<p>分类器有意采用<strong>保守</strong>的分类方式：</p>
<ul>
<li>
<p>基于进程 ID 的所有权</p>
</li>
<li>
<p>基于线程的所有权</p>
</li>
<li>
<p>基于明确的名称标记规则</p>
</li>
</ul>
<p>如果一个切片无法明确归类，则会被标记为“unknown”。这并非错误，而是诚实。</p>
<h3 data-id="heading-14">带有责任标签的长任务</h3>
<p>以下是一个已分类的长任务切片示例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">267.29</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xample.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"process_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.example.tracetoy"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>以及一个框架密集型任务切片示例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dequeueBuffer - VRI[MainActivity]#0(BLAST Consumer)0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dur_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180.4</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"pid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5664</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tid"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5688</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"thread_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"RenderThread"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"framework"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>相同的跟踪记录，但对优化方向的影响却截然不同。</p>
<h3 data-id="heading-15">聚合分解</h3>
<p>分析器无需手动查看数百个切片，而是计算以下内容：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"work_breakdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"by_category_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12603.72</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">305.77</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"system"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"unknown"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5167.50</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这一个代码块回答了一个重要的问题：</p>
<blockquote>
<p>此性能问题主要是应用程序本身的问题吗？</p>
</blockquote>
<p>有时答案令人不安，有时却令人欣慰。无论如何，它都基于数据。</p>
<h3 data-id="heading-16">主线程阻塞：究竟是谁的责任？</h3>
<p>分析器按类别分解主线程阻塞时间：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"main_thread_blocking"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"app_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12603.72</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"framework_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">305.77</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2840.88</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>责任归属在此变得不可回避。</p>
<p>如果主线程主要被应用程序工作阻塞（就像这个跟踪记录中显示的那样），<strong>你就能准确地知道应该把优化工作集中在哪些方面</strong>。</p>
<h3 data-id="heading-17">摘要块</h3>
<p>所有内容都汇总成一个最简洁的摘要：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"main_thread_found"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_app_sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dequeueBuffer - VRI[MainActivity]#0..."</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"UI#stall_button_click"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_long_slice_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"BG#churn"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dominant_work_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"main_thread_blocked_by"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这不是解释，而是一个<strong>信号</strong>——告诉你应该关注哪里，以及哪些地方不应该关注。</p>
<h2 data-id="heading-18">第四步：时间窗口和嫌疑对象</h2>
<p>知道是谁执行了操作固然重要，但性能下降很少是全局性的——它们往往是<strong>暂时性的</strong>。</p>
<p>典型的问题如下：</p>
<ul>
<li>
<p><em>为什么启动这么慢？</em></p>
</li>
<li>
<p><em>为什么卡顿只在第一个屏幕之后才出现？</em></p>
</li>
<li>
<p><em>为什么 UI 线程在交互过程中被阻塞，但在启动时却没有？</em></p>
</li>
</ul>
<p>缺乏时间上下文的归因分析仍然需要手动梳理时间线。第四步可以减轻这种认知负担。</p>
<h3 data-id="heading-19">时间窗口：明确“何时”⏱️</h3>
<p>分析器不再将跟踪信息视为一条长长的时间线，而是将其划分为粗略的、确定性的窗口：</p>
<ul>
<li>
<p><strong>启动窗口</strong> — 从进程启动到启动结束</p>
</li>
<li>
<p><strong>稳定状态窗口</strong> — 启动后的时间段（默认值：5 秒）</p>
</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"time_windows"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"start_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup_ms"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"start_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7910.15</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup_end + 5000ms"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>仅此一项就改变了你对跟踪信息的推理方式。</p>
<h3 data-id="heading-20">窗口分解：上下文中的责任归属 📊</h3>
<p>对于每个窗口，分析器计算：</p>
<ul>
<li>
<p>按类别划分的总工作量（<code>app</code>、<code>framework</code>、<code>system</code>、<code>unknown</code>）</p>
</li>
<li>
<p>按类别划分的主线程阻塞</p>
</li>
</ul>
<p>来自 TraceToy 跟踪：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"window_breakdown"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"by_category_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">378.43</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"unknown"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"main_thread_blocking_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"app_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"framework_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.0</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-comment">/* ... */</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这可以确定性地回答以下问题：</p>
<blockquote>
<p>启动阶段主要由系统工作主导。稳定阶段有大量未知工作阻塞了主线程。</p>
</blockquote>
<p>无需猜测。</p>
<h3 data-id="heading-21">从数据到嫌疑人 🕵️</h3>
<p>一旦掌握了归因、责任和时间窗口，就可以找出<strong>嫌疑人</strong>。</p>
<p>嫌疑人<strong>并非解释</strong>，而是一个_优先级信号_。</p>
<p>分析器生成一个确定性列表：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"suspects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup main thread dominated by unknown work"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"evidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"unknown_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">101.34</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup dominated by system work"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"evidence"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"system_ms"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">378.43</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
    <span class="hljs-comment">// ... more suspects for steady_state</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这些标签是模板化的、可复现的，并且有证据支持。</p>
<p>它们不解释问题，而是指明方向。</p>
<h3 data-id="heading-22">摘要现在更有意义了🧭</h3>
<p>摘要块变得可操作：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"summary"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"startup_dominant_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"system"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"steady_state_dominant_category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"unknown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"top_suspect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Startup main thread dominated by unknown work"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果你只阅读此摘要，你就已经知道：</p>
<ul>
<li>
<p>从哪里开始调查</p>
</li>
<li>
<p>应该查看哪种类型的工作</p>
</li>
<li>
<p>哪个阶段最重要</p>
</li>
</ul>
<p>这与原始跟踪信息相比是一个巨大的转变。</p>
<h2 data-id="heading-23">整合所有步骤</h2>
<p>以下是完整的工作流程：</p>
<h3 data-id="heading-24">1. 捕获跟踪</h3>
<p>使用 Android Studio 的性能分析器或命令行：</p>
<pre><code class="hljs language-bash" lang="bash">adb shell perfetto -o /data/misc/perfetto-traces/trace.perfetto-trace -t 10s \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik camera input res memory
</code></pre>
<h3 data-id="heading-25">2. 运行分析器</h3>
<pre><code class="hljs language-bash" lang="bash">python3 -m perfetto_agent.cli analyze \
  --trace trace.perfetto-trace \
  --focus-process com.example.myapp \
  --out analysis.json \
  --long-task-ms 50 \
  --top-n 10
</code></pre>
<h3 data-id="heading-26">3.阅读输出</h3>
<p>首先查看 <code>summary</code> 块，了解主要类别和主要嫌疑人，然后深入查看具体信息：</p>
<ul>
<li>
<p><code>work_breakdown</code> 用于查看类别分布</p>
</li>
<li>
<p><code>features.long_slices_attributed</code> 用于查看单个嫌疑人</p>
</li>
<li>
<p><code>features.app_sections</code> 用于查看你的插桩代码</p>
</li>
</ul>
<h2 data-id="heading-27">此功能无法实现的功能</h2>
<p>让我们明确一下它的局限性：</p>
<ul>
<li>
<p>❌ <strong>不追究责任</strong> — 仅显示证据</p>
</li>
<li>
<p>❌ <strong>不生成建议</strong> — 这需要理解意图</p>
</li>
<li>
<p>❌ <strong>不声明因果关系</strong> — 相关性不等于因果关系</p>
</li>
</ul>
<p>该系统使责任<strong>可见</strong>。这就足够了。</p>
<h2 data-id="heading-28">使用 TraceToy 进行测试</h2>
<p>我构建了一个名为 <strong>TraceToy</strong> 的示例应用程序，用于生成有趣的跟踪信息，以便测试分析器。</p>
<p>它包含：</p>
<ul>
<li>
<p><strong>启动初始化</strong>（使用 <code>StartupInit</code> 标记）</p>
</li>
<li>
<p><strong>UI 阻塞按钮</strong> — 使用 <code>UI#stall_button_click</code> 故意阻塞 UI 线程 200 毫秒</p>
</li>
<li>
<p><strong>后台加载切换</strong> — 生成 <code>BG#churn</code> 标记</p>
</li>
<li>
<p><strong>可滚动列表</strong> — 生成帧渲染事件</p>
</li>
</ul>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4818d302d5584cfc904545a0977c2f32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770987937&amp;x-signature=R9CxaIdfumR0XYki0a16Qi7bX5w%3D" alt="" width="50%" loading="lazy"/></p>
<p>截图由作者从 Android TraceToys 示例应用中截取。</p>
<h3 data-id="heading-29">快速入门</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Record a 20-second trace</span>
adb shell perfetto -o /data/misc/perfetto-traces/trace -t 20s <span class="hljs-built_in">sched</span> gfx view dalvik
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Interact with the app (tap UI Stall, scroll, toggle background load)# Pull and analyze</span>
adb pull /data/misc/perfetto-traces/trace tracetoy_trace.perfetto-trace
python3 -m perfetto_agent.cli analyze \
  --trace tracetoy_trace.perfetto-trace \
  --focus-process com.example.tracetoy \
  --out analysis.json
</code></pre>
<p>输出应包含：</p>
<ul>
<li>
<p>已识别 TraceToy 进程（<code>com.example.tracetoy</code>，进程 ID 5664）</p>
</li>
<li>
<p>应用部分中出现 <code>BG#churn</code>（194 次，总计 11.8 秒）和 <code>UI#stall_button_click</code>（4 次，总计 818 毫秒）</p>
</li>
<li>
<p>199 个耗时超过 50 毫秒阈值的长任务</p>
</li>
<li>
<p>888 帧，其中 37 帧卡顿（p95：14.35 毫秒）</p>
</li>
</ul>
<h2 data-id="heading-30">实现亮点：切片分类</h2>
<p>分析器中最有趣的部分是分类器。它使用显式标记列表，并且有意采用保守的分类方法：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">classify_slice_name</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, pid: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span>, focus_pid: <span class="hljs-built_in">int</span> | <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""Classify a slice into app/framework/system/unknown using pid + name tokens."""</span>
    <span class="hljs-comment"># If not from focus process, it's system</span>
    <span class="hljs-keyword">if</span> focus_pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid != focus_pid:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"system"</span>    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>    
    
    lower_name = name.lower()        
    app_tokens = [<span class="hljs-string">"ui#"</span>, <span class="hljs-string">"bg#"</span>, <span class="hljs-string">"startupinit"</span>]
    framework_tokens = [
        <span class="hljs-string">"choreographer"</span>, <span class="hljs-string">"doframe"</span>, <span class="hljs-string">"renderthread"</span>, 
        <span class="hljs-string">"viewrootimpl"</span>, <span class="hljs-string">"dequeuebuffer"</span>, <span class="hljs-string">"blast"</span>, <span class="hljs-string">"hwui"</span>
    ]
    system_tokens = [<span class="hljs-string">"binder"</span>, <span class="hljs-string">"surfaceflinger"</span>, <span class="hljs-string">"sched"</span>, <span class="hljs-string">"kworker"</span>, <span class="hljs-string">"irq"</span>, <span class="hljs-string">"futex"</span>]    
    <span class="hljs-comment"># Check app tokens first (highest confidence)</span>
    <span class="hljs-keyword">if</span> focus_pid <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> pid == focus_pid:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> app_tokens):
            <span class="hljs-keyword">return</span> <span class="hljs-string">"app"</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> framework_tokens):
            <span class="hljs-keyword">return</span> <span class="hljs-string">"framework"</span>    
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">any</span>(token <span class="hljs-keyword">in</span> lower_name <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> system_tokens):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"system"</span>    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>
</code></pre>
<p>关键见解：<strong>保守的分类方法优于错误的置信度</strong>。如果无法准确分类，则“未知”是 诚实的答案。</p>
<p>请参阅<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">完整实现</a>，了解启动检测、主线程解析和帧健康计算。</p>
<h2 data-id="heading-31">为你的应用添加插桩</h2>
<p>为了最大限度地利用此分析，请对你的代码进行插桩：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.os.Trace
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileLoader</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadProfile</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: UserProfile {
        Trace.beginSection(<span class="hljs-string">"UI#loadUserProfile"</span>)
        <span class="hljs-keyword">try</span> {
            Trace.beginSection(<span class="hljs-string">"UI#fetchFromCache"</span>)
            <span class="hljs-keyword">val</span> cached = cache.<span class="hljs-keyword">get</span>(userId)
            Trace.endSection()                        
            <span class="hljs-keyword">if</span> (cached != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> cached                        
            
            Trace.beginSection(<span class="hljs-string">"IO#fetchFromNetwork"</span>)
            <span class="hljs-keyword">val</span> profile = api.fetchProfile(userId)
            Trace.endSection()                        
            <span class="hljs-keyword">return</span> profile
        } <span class="hljs-keyword">finally</span> {
            Trace.endSection()
        }
    }
}
</code></pre>
<p>使用一致的命名约定：</p>
<ul>
<li>
<p><code>UI#</code> — 主线程/UI 操作</p>
</li>
<li>
<p><code>BG#</code> — 后台线程操作</p>
</li>
<li>
<p><code>IO#</code> — I/O 操作</p>
</li>
<li>
<p><code>DB#</code> — 数据库操作</p>
</li>
</ul>
<p>这使得分析器的输出能够立即转化为实际操作。</p>
<h2 data-id="heading-32">亲自尝试</h2>
<p>该分析器是开源的：</p>
<p>🔗 <strong>Perfetto 分析器</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2Fperfetto-agent" target="_blank" title="https://github.com/singhsume123/perfetto-agent" ref="nofollow noopener noreferrer">github.com/singhsume12…</a></p>
<p>🔗 <strong>TraceToy 测试应用</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsinghsume123%2FTraceToy" target="_blank" title="https://github.com/singhsume123/TraceToy" ref="nofollow noopener noreferrer">github.com/singhsume12…</a></p>
<p>该仓库包含：</p>
<ul>
<li>
<p>Python 命令行分析器</p>
</li>
<li>
<p>示例跟踪和输出 (<code>analysis.json</code>)</p>
</li>
<li>
<p>设置说明</p>
</li>
</ul>
<h2 data-id="heading-33">要点总结</h2>
<ol>
<li>
<p><strong>Perfetto 跟踪功能强大但信息量庞大</strong> — 程序化分析能够从噪声中提取有效信息</p>
</li>
<li>
<p><strong>归属至关重要</strong> — 了解谁执行了工作（进程、线程、组件）至关重要</p>
</li>
<li>
<p><strong>明确职责分离</strong> — 应用、框架和系统之间的职责划分最重要的区别</p>
</li>
<li>
<p><strong>时间窗口至关重要</strong> — 启动阶段和稳定阶段通常具有截然不同的特征</p>
</li>
<li>
<p><strong>嫌疑人指出问题所在，而非解释问题原因</strong> — 确定性信号告诉你应该首先从哪里入手</p>
</li>
<li>
<p><strong>保守的分类胜过错误的自信</strong> — “未知”总比错误好</p>
</li>
<li>
<p><strong>为你的代码添加插桩</strong> — <code>Trace.beginSection()</code> 是你的好帮手</p>
</li>
</ol>
<p>性能调试并非要找出_所有_发生的事情。而是要找出：</p>
<ul>
<li>
<p><strong>什么才是关键的</strong></p>
</li>
<li>
<p><strong>何时才是关键的</strong></p>
</li>
<li>
<p><strong>谁负责</strong></p>
</li>
</ul>
<p>此分析器将这个模型清晰地呈现出来，并且机器可读。</p>
<p>_有任何问题或反馈？请在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fsumeet-singh-arora-50605153%2F" target="_blank" title="https://www.linkedin.com/in/sumeet-singh-arora-50605153/" ref="nofollow noopener noreferrer"><em>LinkedIn</em></a> 上联系我。</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第14篇）：CC Workflow Studio - 可视化AI工作流编辑器，让AI自动化更简单]]></title>    <link>https://juejin.cn/post/7603563360329285674</link>    <guid>https://juejin.cn/post/7603563360329285674</guid>    <pubDate>2026-02-06T13:08:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329285674" data-draft-id="7603563360329269290" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第14篇）：CC Workflow Studio - 可视化AI工作流编辑器，让AI自动化更简单"/> <meta itemprop="keywords" content="Claude,工作流引擎,AIGC"/> <meta itemprop="datePublished" content="2026-02-06T13:08:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第14篇）：CC Workflow Studio - 可视化AI工作流编辑器，让AI自动化更简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:08:24.000Z" title="Fri Feb 06 2026 13:08:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"如果设计AI工作流就像画流程图一样简单，那该多好？"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第14篇文章。今天带你了解的项目是 <strong>CC Workflow Studio</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://github.com/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在AI辅助编程的世界里，我们经常需要设计复杂的工作流：多个子Agent协作、条件分支、循环处理、MCP工具调用等。传统的文本配置方式虽然灵活，但不够直观，难以快速理解和修改。CC Workflow Studio 提供了一个可视化的拖拽式编辑器，让你像画流程图一样设计AI工作流，还支持AI辅助编辑，让复杂的工作流设计变得简单直观。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🎨 <strong>可视化编辑</strong>：拖拽式界面，直观设计复杂工作流</li>
<li>✨ <strong>AI辅助编辑</strong>：通过自然语言对话改进和优化工作流</li>
<li>⚡ <strong>一键导出运行</strong>：支持导出到 Claude Code、GitHub Copilot、OpenAI Codex</li>
<li>🔀 <strong>子Agent编排</strong>：支持复杂的多Agent协作和条件分支</li>
<li>🌟 <strong>社区认可</strong>：3.4k+ Stars，398+ Forks，持续活跃更新</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>CC Workflow Studio 的核心架构和设计理念</li>
<li>如何使用可视化编辑器设计AI工作流</li>
<li>AI辅助编辑功能的使用方法</li>
<li>如何导出工作流到不同的AI编程平台</li>
<li>子Agent编排和条件分支的实现</li>
<li>与其他工作流工具的对比分析</li>
<li>实际开发场景中的应用案例</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对AI辅助编程有基本了解（Claude Code、GitHub Copilot等）</li>
<li>了解工作流和自动化概念</li>
<li>熟悉JSON配置文件格式</li>
<li>对React和TypeScript有基本认识（可选，有助于理解实现原理）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>CC Workflow Studio</strong> 是一个<strong>可视化AI工作流编辑器</strong>，专为设计复杂的AI Agent工作流而打造。它提供了一个直观的拖拽式界面，让开发者能够通过图形化方式设计、编辑和优化AI自动化工作流，然后一键导出到 Claude Code、GitHub Copilot 或 OpenAI Codex 等平台使用。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>AI工作流配置复杂，文本方式不够直观</li>
<li>难以快速理解和修改现有的工作流配置</li>
<li>缺乏可视化工具来设计复杂的多Agent协作流程</li>
<li>不同AI平台的工作流格式不统一，难以迁移</li>
<li>工作流设计需要反复调试，缺乏交互式编辑体验</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>使用 Claude Code、GitHub Copilot 等AI编程工具的开发者</li>
<li>需要设计复杂AI自动化工作流的团队</li>
<li>希望可视化管理AI Agent协作的开发者</li>
<li>需要将工作流在不同AI平台间迁移的开发者</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>作者：breaking-brake</strong></p>
<ul>
<li><strong>背景</strong>：专注于AI工具和开发者体验的开源贡献者</li>
<li><strong>项目创建时间</strong>：2025年（具体月份未明确）</li>
<li><strong>理念</strong>：让AI工作流设计变得简单、直观、高效</li>
<li><strong>技术栈</strong>：TypeScript、React Flow、VS Code Extension API</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 3.4k+（持续增长中）</li>
<li>🍴 <strong>Forks</strong>: 398+</li>
<li>📦 <strong>版本</strong>: v3.19.2（最新版本，2026年2月6日发布）</li>
<li>📄 <strong>License</strong>: AGPL-3.0-or-later（开源，但修改后需开源）</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-vsx.org%2Fextension%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://open-vsx.org/extension/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">OpenVSX</a></li>
<li>💬 <strong>社区</strong>: GitHub Issues 活跃，22个开放Issues，8个Pull Requests</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2025年：项目创建，发布初始版本</li>
<li>2025-2026年：持续迭代，添加新功能</li>
<li>2026年2月：发布 v3.19.2，功能稳定</li>
<li>持续维护：项目持续活跃，社区贡献不断</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>CC Workflow Studio 的核心作用是<strong>通过可视化编辑器设计和管理AI工作流</strong>，主要功能包括：</p>
<ol>
<li><strong>可视化工作流编辑</strong>：拖拽式界面，直观设计复杂工作流</li>
<li><strong>AI辅助编辑</strong>：通过自然语言对话改进和优化工作流</li>
<li><strong>多平台导出</strong>：支持导出到 Claude Code、GitHub Copilot、OpenAI Codex</li>
<li><strong>子Agent编排</strong>：支持复杂的多Agent协作和条件分支</li>
<li><strong>一键运行</strong>：直接在编辑器中运行工作流，即时验证效果</li>
<li><strong>工作流保存加载</strong>：保存为JSON格式，方便版本管理和分享</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<ol>
<li>
<p><strong>设计PR代码审查工作流</strong></p>
<ul>
<li>需要多个步骤：代码分析、安全检查、性能评估、生成报告</li>
<li>使用可视化编辑器设计流程，添加条件分支</li>
<li>导出到 Claude Code，使用 <code>/pr-review</code> 命令触发</li>
</ul>
</li>
<li>
<p><strong>创建多Agent协作流程</strong></p>
<ul>
<li>设计者Agent负责架构设计</li>
<li>开发者Agent负责代码实现</li>
<li>测试者Agent负责测试用例</li>
<li>使用可视化界面编排Agent之间的协作关系</li>
</ul>
</li>
<li>
<p><strong>优化现有工作流</strong></p>
<ul>
<li>导入现有的 <code>.claude</code> 配置文件</li>
<li>使用AI辅助编辑功能，通过对话优化工作流</li>
<li>添加新的步骤或修改逻辑分支</li>
</ul>
</li>
<li>
<p><strong>跨平台工作流迁移</strong></p>
<ul>
<li>在 Claude Code 中设计的工作流</li>
<li>导出为 GitHub Copilot 格式</li>
<li>在不同平台间复用相同的工作流逻辑</li>
</ul>
</li>
<li>
<p><strong>学习和理解工作流</strong></p>
<ul>
<li>导入复杂的工作流配置</li>
<li>通过可视化界面理解工作流的执行逻辑</li>
<li>学习最佳实践和设计模式</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装扩展</h4>
<ol>
<li>
<p><strong>VS Code 扩展市场</strong></p>
<ul>
<li>打开 VS Code</li>
<li>搜索 "CC Workflow Studio"</li>
<li>点击安装</li>
</ul>
</li>
<li>
<p><strong>OpenVSX（开源VS Code扩展市场）</strong></p>
<ul>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-vsx.org%2Fextension%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://open-vsx.org/extension/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">OpenVSX</a></li>
<li>下载 <code>.vsix</code> 文件</li>
<li>在 VS Code 中通过 "Install from VSIX" 安装</li>
</ul>
</li>
</ol>
<h4 data-id="heading-12">启动编辑器</h4>
<ol>
<li>
<p><strong>方式一：点击图标</strong></p>
<ul>
<li>在 VS Code 右上角找到 CC Workflow Studio 图标</li>
<li>点击打开编辑器</li>
</ul>
</li>
<li>
<p><strong>方式二：命令面板</strong></p>
<ul>
<li>按 <code>Cmd+Shift+P</code>（Mac）或 <code>Ctrl+Shift+P</code>（Windows/Linux）</li>
<li>输入 "CC Workflow Studio: Open Editor"</li>
<li>选择命令打开编辑器</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">创建第一个工作流</h4>
<ol>
<li>
<p><strong>添加节点</strong></p>
<ul>
<li>从左侧节点面板拖拽节点到画布</li>
<li>常见节点类型：Agent、Condition、Action、MCP Tool等</li>
</ul>
</li>
<li>
<p><strong>连接节点</strong></p>
<ul>
<li>点击节点的输出端口</li>
<li>拖拽到目标节点的输入端口</li>
<li>建立节点之间的连接关系</li>
</ul>
</li>
<li>
<p><strong>配置节点</strong></p>
<ul>
<li>点击节点打开配置面板</li>
<li>设置节点名称、描述、参数等</li>
<li>保存配置</li>
</ul>
</li>
<li>
<p><strong>保存工作流</strong></p>
<ul>
<li>点击工具栏的保存按钮</li>
<li>工作流保存为 <code>.vscode/workflows/*.json</code></li>
</ul>
</li>
<li>
<p><strong>导出工作流</strong></p>
<ul>
<li>点击工具栏的导出按钮</li>
<li>选择目标平台（Claude Code、GitHub Copilot等）</li>
<li>导出为对应的格式文件</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">核心特性</h3>
<ol>
<li>
<p><strong>可视化拖拽编辑</strong></p>
<ul>
<li>基于 React Flow 的现代化界面</li>
<li>直观的节点和连接线表示</li>
<li>支持缩放、平移、多选等操作</li>
<li>实时预览工作流结构</li>
</ul>
</li>
<li>
<p><strong>AI辅助编辑（Edit with AI）</strong></p>
<ul>
<li>通过自然语言对话改进工作流</li>
<li>支持添加功能、优化逻辑、修复问题</li>
<li>使用 Claude Code 或 GitHub Copilot 作为AI提供者</li>
<li>迭代式优化，逐步完善工作流</li>
</ul>
</li>
<li>
<p><strong>多平台导出支持</strong></p>
<ul>
<li><strong>Claude Code</strong>：导出为 <code>.claude/agents/</code> 和 <code>.claude/commands/</code></li>
<li><strong>GitHub Copilot Chat</strong>：导出为 <code>.github/prompts/</code></li>
<li><strong>GitHub Copilot CLI</strong>：导出为 <code>.github/skills/</code></li>
<li><strong>OpenAI Codex CLI</strong>：导出为 <code>.codex/skills/</code></li>
</ul>
</li>
<li>
<p><strong>子Agent编排</strong></p>
<ul>
<li>支持创建多个子Agent</li>
<li>定义Agent之间的协作关系</li>
<li>支持条件分支和循环逻辑</li>
<li>实现复杂的多Agent工作流</li>
</ul>
</li>
<li>
<p><strong>条件分支和循环</strong></p>
<ul>
<li>支持 if-else 条件判断</li>
<li>支持循环处理逻辑</li>
<li>可视化展示控制流</li>
<li>灵活的工作流控制</li>
</ul>
</li>
<li>
<p><strong>MCP工具集成</strong></p>
<ul>
<li>支持调用 MCP（Model Context Protocol）工具</li>
<li>可视化配置工具参数</li>
<li>集成外部服务和数据源</li>
</ul>
</li>
<li>
<p><strong>一键运行测试</strong></p>
<ul>
<li>在编辑器中直接运行工作流</li>
<li>实时查看执行结果</li>
<li>快速验证工作流逻辑</li>
<li>调试和优化工作流</li>
</ul>
</li>
<li>
<p><strong>工作流版本管理</strong></p>
<ul>
<li>保存为JSON格式</li>
<li>支持版本控制和Git管理</li>
<li>方便团队协作和分享</li>
<li>导入导出功能完善</li>
</ul>
</li>
</ol>
<h3 data-id="heading-15">项目优势</h3>















































<table><thead><tr><th align="left">对比项</th><th align="left">CC Workflow Studio</th><th align="left">文本配置</th><th align="left">其他可视化工具</th></tr></thead><tbody><tr><td align="left"><strong>易用性</strong></td><td align="left">⭐⭐⭐⭐⭐ 拖拽式编辑</td><td align="left">⭐⭐ 需要手写配置</td><td align="left">⭐⭐⭐ 中等</td></tr><tr><td align="left"><strong>可视化</strong></td><td align="left">⭐⭐⭐⭐⭐ 图形化界面</td><td align="left">⭐ 纯文本</td><td align="left">⭐⭐⭐⭐ 图形化</td></tr><tr><td align="left"><strong>AI辅助</strong></td><td align="left">⭐⭐⭐⭐⭐ 内置AI编辑</td><td align="left">⭐ 无</td><td align="left">⭐⭐ 部分支持</td></tr><tr><td align="left"><strong>多平台支持</strong></td><td align="left">⭐⭐⭐⭐⭐ 4种格式</td><td align="left">⭐⭐ 单一格式</td><td align="left">⭐⭐⭐ 2-3种格式</td></tr><tr><td align="left"><strong>学习曲线</strong></td><td align="left">⭐⭐⭐⭐ 较低</td><td align="left">⭐⭐ 需要学习语法</td><td align="left">⭐⭐⭐ 中等</td></tr><tr><td align="left"><strong>调试能力</strong></td><td align="left">⭐⭐⭐⭐⭐ 一键运行</td><td align="left">⭐⭐ 手动测试</td><td align="left">⭐⭐⭐ 部分支持</td></tr></tbody></table>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>🎯 <strong>降低门槛</strong>：可视化编辑让非技术用户也能设计工作流</li>
<li>🚀 <strong>提升效率</strong>：AI辅助编辑快速优化工作流，减少反复调试</li>
<li>🔄 <strong>跨平台兼容</strong>：一套工作流可以导出到多个平台使用</li>
<li>🎨 <strong>直观理解</strong>：图形化界面让复杂工作流一目了然</li>
<li>💪 <strong>功能完整</strong>：支持子Agent、条件分支、MCP工具等高级特性</li>
</ul>
<hr/>
<h2 data-id="heading-16">项目详细剖析</h2>
<h3 data-id="heading-17">架构设计</h3>
<p>CC Workflow Studio 采用现代化的前端架构，基于 VS Code Extension API 和 React Flow 构建。</p>
<h4 data-id="heading-18">核心组件</h4>
<ol>
<li>
<p><strong>VS Code Extension 主程序</strong></p>
<ul>
<li>使用 TypeScript 编写</li>
<li>实现扩展的激活和生命周期管理</li>
<li>提供命令和WebView接口</li>
</ul>
</li>
<li>
<p><strong>React Flow 可视化引擎</strong></p>
<ul>
<li>基于 React Flow 构建节点图</li>
<li>处理节点拖拽、连接、布局等交互</li>
<li>提供流畅的用户体验</li>
</ul>
</li>
<li>
<p><strong>工作流引擎</strong></p>
<ul>
<li>解析和验证工作流配置</li>
<li>执行工作流逻辑</li>
<li>处理节点之间的数据流转</li>
</ul>
</li>
<li>
<p><strong>导出转换器</strong></p>
<ul>
<li>将可视化工作流转换为不同平台的格式</li>
<li>支持 Claude Code、GitHub Copilot、OpenAI Codex 等格式</li>
<li>保持工作流逻辑的一致性</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">数据模型</h4>
<p>工作流以JSON格式存储，包含以下核心结构：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"代码审查Agent"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"审查代码质量和安全性"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"tools"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"x"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"y"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"edges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"edge-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node-2"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"viewport"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"x"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"y"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"zoom"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-20">关键实现</h3>
<h4 data-id="heading-21">可视化编辑器实现</h4>
<p>CC Workflow Studio 使用 React Flow 作为可视化引擎，这是一个专门用于构建节点图的React库。</p>
<p><strong>节点类型系统</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持的节点类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NodeType</span> = 
  | <span class="hljs-string">'agent'</span>      <span class="hljs-comment">// Agent节点</span>
  | <span class="hljs-string">'condition'</span>  <span class="hljs-comment">// 条件判断节点</span>
  | <span class="hljs-string">'action'</span>      <span class="hljs-comment">// 动作节点</span>
  | <span class="hljs-string">'mcp-tool'</span>    <span class="hljs-comment">// MCP工具节点</span>
  | <span class="hljs-string">'input'</span>       <span class="hljs-comment">// 输入节点</span>
  | <span class="hljs-string">'output'</span>;     <span class="hljs-comment">// 输出节点</span>
</code></pre>
<p><strong>节点渲染</strong>：</p>
<ul>
<li>每个节点类型有对应的React组件</li>
<li>节点可以自定义样式和交互行为</li>
<li>支持节点配置面板，编辑节点属性</li>
</ul>
<p><strong>连接处理</strong>：</p>
<ul>
<li>使用 React Flow 的 Edge 组件表示连接</li>
<li>支持条件连接（带标签的分支）</li>
<li>验证连接的有效性（类型匹配等）</li>
</ul>
<h4 data-id="heading-22">AI辅助编辑功能</h4>
<p>AI辅助编辑是 CC Workflow Studio 的核心创新功能，让用户可以通过自然语言对话来改进工作流。</p>
<p><strong>工作流程</strong>：</p>
<ol>
<li>
<p><strong>用户输入需求</strong></p>
<ul>
<li>点击 "Edit with AI" 按钮</li>
<li>输入自然语言描述（如"添加代码安全检查步骤"）</li>
</ul>
</li>
<li>
<p><strong>AI理解需求</strong></p>
<ul>
<li>将工作流当前状态发送给AI</li>
<li>AI分析工作流结构</li>
<li>理解用户的改进需求</li>
</ul>
</li>
<li>
<p><strong>生成改进方案</strong></p>
<ul>
<li>AI生成修改建议</li>
<li>可能包括：添加节点、修改连接、调整配置等</li>
<li>以JSON格式返回修改方案</li>
</ul>
</li>
<li>
<p><strong>应用修改</strong></p>
<ul>
<li>解析AI返回的修改方案</li>
<li>应用到工作流图中</li>
<li>用户确认后保存</li>
</ul>
</li>
</ol>
<p><strong>AI提供者支持</strong>：</p>
<ul>
<li><strong>Claude Code</strong>：默认支持，使用 Claude 模型</li>
<li><strong>GitHub Copilot</strong>：需要安装 Copilot 扩展</li>
<li><strong>OpenAI Codex</strong>：需要配置 API 密钥</li>
</ul>
<h4 data-id="heading-23">多平台导出机制</h4>
<p>CC Workflow Studio 支持将可视化工作流导出为多种格式，适配不同的AI编程平台。</p>
<p><strong>导出流程</strong>：</p>
<ol>
<li>
<p><strong>工作流验证</strong></p>
<ul>
<li>检查节点配置完整性</li>
<li>验证连接的有效性</li>
<li>确保工作流逻辑正确</li>
</ul>
</li>
<li>
<p><strong>格式转换</strong></p>
<ul>
<li>根据目标平台选择转换器</li>
<li>将节点图转换为目标格式</li>
<li>处理平台特定的配置项</li>
</ul>
</li>
<li>
<p><strong>文件生成</strong></p>
<ul>
<li>生成对应的配置文件</li>
<li>保存到指定目录</li>
<li>更新平台配置索引</li>
</ul>
</li>
</ol>
<p><strong>Claude Code 导出示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># .claude/agents/code-review-agent.md</span>

<span class="hljs-section">## Agent: 代码审查Agent</span>

<span class="hljs-section">### Description</span>
审查代码质量和安全性

<span class="hljs-section">### Steps</span>
<span class="hljs-bullet">1.</span> 分析代码结构
<span class="hljs-bullet">2.</span> 检查安全问题
<span class="hljs-bullet">3.</span> 评估代码质量
<span class="hljs-bullet">4.</span> 生成审查报告

<span class="hljs-section">### Tools</span>
<span class="hljs-bullet">-</span> file-reader
<span class="hljs-bullet">-</span> security-scanner
</code></pre>
<p><strong>GitHub Copilot 导出示例</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/prompts/code-review.yml</span>

<span class="hljs-attr">name:</span> <span class="hljs-string">Code</span> <span class="hljs-string">Review</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">审查代码质量和安全性</span>
<span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">Code</span>
    <span class="hljs-attr">action:</span> <span class="hljs-string">analyze</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">Security</span>
    <span class="hljs-attr">action:</span> <span class="hljs-string">security-scan</span>
</code></pre>
<h4 data-id="heading-24">子Agent编排机制</h4>
<p>CC Workflow Studio 支持创建多个子Agent，并编排它们之间的协作关系。</p>
<p><strong>子Agent设计</strong>：</p>
<ul>
<li>每个子Agent有独立的配置和提示词</li>
<li>子Agent可以调用MCP工具</li>
<li>支持子Agent之间的数据传递</li>
</ul>
<p><strong>协作模式</strong>：</p>
<ol>
<li>
<p><strong>顺序执行</strong></p>
<ul>
<li>Agent A 完成后，将结果传递给 Agent B</li>
<li>适合流水线式处理</li>
</ul>
</li>
<li>
<p><strong>并行执行</strong></p>
<ul>
<li>多个Agent同时执行</li>
<li>最后合并结果</li>
</ul>
</li>
<li>
<p><strong>条件分支</strong></p>
<ul>
<li>根据条件选择不同的Agent执行</li>
<li>实现动态路由</li>
</ul>
</li>
</ol>
<p><strong>实现示例</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"nodes"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"designer"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"架构设计师"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"developer"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"agent"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"代码开发者"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"needs_refactor"</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"edges"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"designer"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"condition"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"developer"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"condition"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"true"</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-25">扩展机制</h3>
<h4 data-id="heading-26">自定义节点类型</h4>
<p>CC Workflow Studio 支持扩展自定义节点类型，开发者可以：</p>
<ol>
<li>
<p><strong>定义节点组件</strong></p>
<ul>
<li>创建React组件</li>
<li>实现节点渲染逻辑</li>
<li>定义配置面板</li>
</ul>
</li>
<li>
<p><strong>注册节点类型</strong></p>
<ul>
<li>在扩展配置中注册</li>
<li>添加到节点面板</li>
<li>支持节点验证</li>
</ul>
</li>
<li>
<p><strong>实现节点逻辑</strong></p>
<ul>
<li>定义节点的执行逻辑</li>
<li>处理输入输出</li>
<li>集成到工作流引擎</li>
</ul>
</li>
</ol>
<h4 data-id="heading-27">MCP工具集成</h4>
<p>CC Workflow Studio 支持集成 MCP（Model Context Protocol）工具，扩展AI的能力边界。</p>
<p><strong>集成方式</strong>：</p>
<ol>
<li>
<p><strong>发现MCP服务器</strong></p>
<ul>
<li>扫描已安装的MCP服务器</li>
<li>读取工具定义</li>
<li>生成工具节点</li>
</ul>
</li>
<li>
<p><strong>工具节点</strong></p>
<ul>
<li>每个MCP工具对应一个节点</li>
<li>可视化配置工具参数</li>
<li>支持工具链式调用</li>
</ul>
</li>
<li>
<p><strong>数据流转</strong></p>
<ul>
<li>工具输出可以作为其他节点的输入</li>
<li>支持复杂的数据处理流程</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-28">项目地址与资源</h2>
<h3 data-id="heading-29">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbreaking-brake%2Fcc-wf-studio" target="_blank" title="https://github.com/breaking-brake/cc-wf-studio" ref="nofollow noopener noreferrer">github.com/breaking-br…</a></li>
</ul>
<h3 data-id="heading-30">适用人群</h3>
<p><strong>CC Workflow Studio 特别适合以下开发者</strong>：</p>
<ol>
<li>
<p><strong>AI工具使用者</strong></p>
<ul>
<li>正在使用 Claude Code、GitHub Copilot 等AI编程工具</li>
<li>希望设计复杂的工作流自动化</li>
<li>需要可视化管理和优化工作流</li>
</ul>
</li>
<li>
<p><strong>团队协作开发者</strong></p>
<ul>
<li>需要统一团队的工作流标准</li>
<li>希望分享和复用工作流配置</li>
<li>需要版本管理工作流</li>
</ul>
</li>
<li>
<p><strong>工作流设计者</strong></p>
<ul>
<li>需要设计多Agent协作流程</li>
<li>希望快速迭代和优化工作流</li>
<li>需要跨平台迁移工作流</li>
</ul>
</li>
<li>
<p><strong>学习研究者</strong></p>
<ul>
<li>想了解AI工作流的设计模式</li>
<li>研究Agent编排和协作机制</li>
<li>学习可视化编辑器的实现</li>
</ul>
</li>
</ol>
<p><strong>使用建议</strong>：</p>
<ul>
<li>从简单的工作流开始，逐步学习复杂功能</li>
<li>充分利用AI辅助编辑功能，快速优化工作流</li>
<li>多使用一键运行功能，及时验证工作流逻辑</li>
<li>参考社区示例，学习最佳实践</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Kotlin系列18】进阶之路：从语言特性到架构思维]]></title>    <link>https://juejin.cn/post/7603563360329302058</link>    <guid>https://juejin.cn/post/7603563360329302058</guid>    <pubDate>2026-02-06T13:23:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563360329302058" data-draft-id="7603563317040250943" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Kotlin系列18】进阶之路：从语言特性到架构思维"/> <meta itemprop="keywords" content="编程语言,Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T13:23:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Kotlin系列18】进阶之路：从语言特性到架构思维
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T13:23:21.000Z" title="Fri Feb 06 2026 13:23:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>"我已经学完了Kotlin的所有语法特性,但总觉得缺少什么。"——这是许多学完Kotlin基础教程的开发者的困惑。</p>
<p>两年前,我带领团队将一个大型Android项目从Java迁移到Kotlin。迁移初期,团队成员虽然掌握了Kotlin语法,但写出的代码仍然充满"Java思维":大量的可空类型检查、冗长的条件判断、重复的模板代码。<strong>我们会用Kotlin,但没有用好Kotlin。</strong></p>
<p>真正的转变发生在我们开始思考"为什么Kotlin要这样设计"之后。当我们理解了:</p>
<ul>
<li>为什么Kotlin要区分可空类型和非空类型?</li>
<li>为什么要提供<code>let</code>、<code>apply</code>、<code>also</code>等作用域函数?</li>
<li>为什么要支持协程而不是传统线程模型?</li>
<li>为什么要提供DSL构建能力?</li>
</ul>
<p>我们的代码才真正变得"Kotlinish"——简洁、安全、高效、优雅。</p>
<p><strong>本文是《Kotlin完全学习指南》系列的最后一篇,也是最重要的一篇。</strong> 我们将站在更高的视角,回顾这17篇文章学到的知识,梳理知识体系,探索设计哲学,建立从语言特性到架构设计的思维框架。</p>
<p>这不是一篇新知识的文章,而是一次系统化思维的升华。</p>
<hr/>
<h2 data-id="heading-1">一、知识体系回顾:从入门到精通的完整地图</h2>
<h3 data-id="heading-2">1.1 系列文章知识架构</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeea0d7bbda94e2b812ba174ba392e9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=qpinziwyNoX%2BUKxWmysttlqD7DE%3D" alt="18-01-kotlin-knowledge-map.png" loading="lazy"/></p>
<p>让我们回顾一下整个系列的知识结构:</p>
<p><strong>第零阶段:快速入门(5篇)</strong> ⭐</p>
<ul>
<li>环境搭建、Hello World、REPL</li>
<li>变量、数据类型、空安全基础</li>
<li>控制流、函数、Lambda表达式</li>
<li>类与对象、Data Class</li>
<li>集合框架与函数式操作</li>
</ul>
<p><strong>第一阶段:进阶基础(3篇)</strong> ⭐⭐⭐</p>
<ul>
<li>面向对象进阶:接口、抽象类、多态、密封类</li>
<li>类型系统深度解析:可空类型、智能转换、类型推断</li>
<li>泛型进阶:型变、具体化类型参数、PECS原则</li>
</ul>
<p><strong>第二阶段:核心特性(4篇)</strong> ⭐⭐⭐⭐</p>
<ul>
<li>委托机制:类委托、属性委托、自定义委托</li>
<li>协程(上):结构化并发、作用域、调度器、异常处理</li>
<li>协程(下):Flow、StateFlow、Channel、背压处理</li>
<li>函数式编程:高阶函数、扩展函数、作用域函数</li>
</ul>
<p><strong>第三阶段:高级应用(5篇)</strong> ⭐⭐⭐⭐⭐</p>
<ul>
<li>DSL设计:Lambda with Receiver、类型安全Builder</li>
<li>编译器插件:KSP、KAPT、字节码增强</li>
<li>Kotlin Multiplatform:跨平台代码共享</li>
<li>性能优化:内联函数、内存管理、字节码分析</li>
<li>Android协程最佳实践:生命周期感知、错误处理</li>
</ul>
<h3 data-id="heading-3">1.2 知识层次的递进</h3>
<p>这个系列的设计遵循"螺旋式上升"的学习路径:</p>
<pre><code class="hljs">基础语法 → 面向对象 → 类型系统 → 函数式编程
   ↓           ↓           ↓            ↓
实践应用 → 设计模式 → 性能优化 → 架构思维
</code></pre>
<p><strong>第一层:语法掌握</strong> - 知道Kotlin有哪些特性</p>
<ul>
<li>关键词:可空类型、Lambda、扩展函数、协程</li>
</ul>
<p><strong>第二层:原理理解</strong> - 理解为什么要这样设计</p>
<ul>
<li>关键词:空安全、零开销抽象、结构化并发</li>
</ul>
<p><strong>第三层:实践应用</strong> - 知道何时使用哪个特性</p>
<ul>
<li>关键词:最佳实践、设计模式、性能优化</li>
</ul>
<p><strong>第四层:架构思维</strong> - 建立系统化的设计理念</p>
<ul>
<li>关键词:简洁性、安全性、互操作性、表达力</li>
</ul>
<h3 data-id="heading-4">1.3 核心知识点关联图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0b1c54389d74a368cedcec3ecc7e3e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=Zv23TXrLMeiKdN7jDsJ4dl%2BBnP4%3D" alt="18-02-concept-relationships.png" loading="lazy"/></p>
<p>Kotlin的各个特性并非孤立存在,而是相互关联、相互支撑:</p>
<p><strong>空安全</strong> ← 类型系统基础</p>
<ul>
<li>可空类型 <code>String?</code></li>
<li>安全调用 <code>?.</code></li>
<li>Elvis操作符 <code>?:</code></li>
<li>非空断言 <code>!!</code></li>
</ul>
<p><strong>函数式编程</strong> ← 简洁表达的核心</p>
<ul>
<li>Lambda表达式</li>
<li>高阶函数</li>
<li>扩展函数</li>
<li>作用域函数(let/apply/also/run/with)</li>
</ul>
<p><strong>协程</strong> ← 异步编程的优雅方案</p>
<ul>
<li>挂起函数 <code>suspend</code></li>
<li>结构化并发</li>
<li>Flow响应式数据流</li>
<li>生命周期感知</li>
</ul>
<p><strong>委托</strong> ← 代码复用的高级手段</p>
<ul>
<li>类委托 <code>by</code></li>
<li>属性委托(lazy/observable)</li>
<li>避免继承的灵活方式</li>
</ul>
<p><strong>DSL</strong> ← 表达力的终极体现</p>
<ul>
<li>Lambda with Receiver</li>
<li>类型安全Builder</li>
<li>领域特定语言构建</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、Kotlin设计哲学:为什么Kotlin这样设计?</h2>
<h3 data-id="heading-6">2.1 核心设计理念</h3>
<p>Kotlin的设计遵循四大核心理念:</p>
<h4 data-id="heading-7">1. 简洁性(Conciseness)</h4>
<p><strong>设计目标</strong>: 减少样板代码,让开发者专注于业务逻辑。</p>
<p><strong>体现</strong>:</p>
<ul>
<li>Data Class自动生成equals/hashCode/toString/copy</li>
<li>扩展函数无需继承即可扩展功能</li>
<li>作用域函数简化常见操作模式</li>
<li>类型推断减少冗余类型声明</li>
</ul>
<p><strong>对比</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java: 30行样板代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> int age;

    <span class="hljs-keyword">public</span> User(String name, int age) {
        <span class="hljs-keyword">this</span>.name = name;
        <span class="hljs-keyword">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> String getName() { <span class="hljs-keyword">return</span> name; }
    <span class="hljs-keyword">public</span> int getAge() { <span class="hljs-keyword">return</span> age; }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> boolean equals(Object o) { <span class="hljs-comment">/* 10行... */</span> }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> int hashCode() { <span class="hljs-comment">/* 5行... */</span> }
}

<span class="hljs-comment">// Kotlin: 1行</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-keyword">val</span> name: String, <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span>)
</code></pre>
<h4 data-id="heading-8">2. 安全性(Safety)</h4>
<p><strong>设计目标</strong>: 在编译期消除常见运行时错误。</p>
<p><strong>体现</strong>:</p>
<ul>
<li>空安全:编译器强制处理可空类型</li>
<li>类型安全:强类型系统防止类型错误</li>
<li>不可变性优先:<code>val</code> vs <code>var</code>、不可变集合</li>
<li>智能转换:自动类型转换避免手动cast</li>
</ul>
<p><strong>哲学</strong>: "Make impossible states unrepresentable" (让非法状态无法表达)</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 编译器保证不会有NPE</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(name: <span class="hljs-type">String</span>?)</span></span> {
    <span class="hljs-comment">// 必须显式处理null</span>
    <span class="hljs-keyword">val</span> length = name?.length ?: <span class="hljs-number">0</span>

    <span class="hljs-comment">// 智能转换后无需手动cast</span>
    <span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span>) {
        println(name.uppercase())  <span class="hljs-comment">// name自动转为非空</span>
    }
}
</code></pre>
<h4 data-id="heading-9">3. 互操作性(Interoperability)</h4>
<p><strong>设计目标</strong>: 与Java无缝集成,平滑迁移。</p>
<p><strong>体现</strong>:</p>
<ul>
<li>100% Java互操作:可以调用Java库,Java也可以调用Kotlin</li>
<li>字节码兼容:生成标准JVM字节码</li>
<li>平台类型:合理处理Java的可空性</li>
<li>注解兼容:支持Java注解</li>
</ul>
<p><strong>策略</strong>: 务实主义而非纯粹主义</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 调用Java代码</span>
<span class="hljs-keyword">val</span> list = ArrayList&lt;String&gt;()  <span class="hljs-comment">// Java类</span>
list.add(<span class="hljs-string">"Kotlin"</span>)

<span class="hljs-comment">// Java调用Kotlin</span>
<span class="hljs-meta">@JvmStatic</span>  <span class="hljs-comment">// 生成Java友好的静态方法</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: User = User(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">25</span>)
</code></pre>
<h4 data-id="heading-10">4. 工具友好性(Tooling)</h4>
<p><strong>设计目标</strong>: 优秀的IDE支持,提升开发体验。</p>
<p><strong>体现</strong>:</p>
<ul>
<li>IntelliJ IDEA原生支持</li>
<li>智能代码补全</li>
<li>强大的重构能力</li>
<li>编译速度优化(K2编译器)</li>
</ul>
<p><strong>原因</strong>: JetBrains自己开发Kotlin,工具支持是一等公民</p>
<h3 data-id="heading-11">2.2 设计权衡与取舍</h3>
<p>任何语言设计都是权衡的艺术,Kotlin也不例外:</p>
<h4 data-id="heading-12">权衡1:简洁 vs 可读性</h4>
<p><strong>问题</strong>: 过于简洁可能损害可读性</p>
<p><strong>Kotlin的选择</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ✅ 简洁但仍清晰</span>
<span class="hljs-keyword">val</span> adults = users.filter { it.age &gt;= <span class="hljs-number">18</span> }

<span class="hljs-comment">// ❌ 过度简洁,牺牲可读性</span>
<span class="hljs-keyword">val</span> x = u.f { i.a &gt;= <span class="hljs-number">18</span> }.m { i.n }
</code></pre>
<p><strong>原则</strong>: 简洁是为了清晰,不是为了炫技</p>
<h4 data-id="heading-13">权衡2:安全 vs 灵活性</h4>
<p><strong>问题</strong>: 严格的空安全可能带来繁琐的检查</p>
<p><strong>Kotlin的选择</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 提供逃生舱:非空断言!!</span>
<span class="hljs-keyword">val</span> length = name!!.length  <span class="hljs-comment">// 明确表达"我知道这不为null"</span>

<span class="hljs-comment">// 但会在运行时崩溃,迫使开发者谨慎使用</span>
</code></pre>
<p><strong>原则</strong>: 默认安全,保留灵活性,但要求明确意图</p>
<h4 data-id="heading-14">权衡3:性能 vs 抽象</h4>
<p><strong>问题</strong>: 高阶函数、Lambda会创建对象,影响性能</p>
<p><strong>Kotlin的选择</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 提供内联函数避免性能损失</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">measure</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
    <span class="hljs-keyword">val</span> start = System.nanoTime()
    <span class="hljs-keyword">val</span> result = block()  <span class="hljs-comment">// 内联后无对象创建</span>
    println(<span class="hljs-string">"Time: <span class="hljs-subst">${System.nanoTime() - start}</span>ns"</span>)
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<p><strong>原则</strong>: 零开销抽象(Zero-cost Abstractions)</p>
<h3 data-id="heading-15">2.3 Kotlin的"三重境界"</h3>
<p>学习Kotlin可以分为三个境界:</p>
<p><strong>第一境界:工具人</strong> - 把Kotlin当工具用</p>
<ul>
<li>特征:能写Kotlin代码,但思维仍是Java</li>
<li>代码:充满<code>?.let {}</code>、过度使用<code>!!</code></li>
<li>评价:会用,但不优雅</li>
</ul>
<p><strong>第二境界:实践者</strong> - 理解Kotlin的设计意图</p>
<ul>
<li>特征:知道何时用何种特性,代码Kotlinish</li>
<li>代码:合理使用扩展函数、作用域函数、委托</li>
<li>评价:用得好,写得优雅</li>
</ul>
<p><strong>第三境界:架构师</strong> - 建立系统化的设计思维</p>
<ul>
<li>特征:能设计Kotlin风格的API,编写DSL</li>
<li>代码:类型安全、表达力强、易于扩展</li>
<li>评价:不仅会用,还能创造</li>
</ul>
<p><strong>目标</strong>: 本系列文章助你从第一境界跨越到第二境界,并为第三境界打下基础。</p>
<hr/>
<h2 data-id="heading-16">三、知识应用:从特性到模式</h2>
<h3 data-id="heading-17">3.1 常见设计模式的Kotlin实现</h3>
<p>Kotlin的语言特性让某些设计模式变得简单甚至消失:</p>
<h4 data-id="heading-18">1. 单例模式 → Object声明</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java需要复杂的双重检查锁</span>
<span class="hljs-comment">// Kotlin: 一行搞定,线程安全</span>
<span class="hljs-keyword">object</span> DatabaseManager {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span></span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h4 data-id="heading-19">2. 建造者模式 → DSL + Apply</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java需要Builder类</span>
<span class="hljs-comment">// Kotlin: DSL + apply</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpRequest</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">val</span> url: String,
    <span class="hljs-keyword">val</span> method: String,
    <span class="hljs-keyword">val</span> headers: Map&lt;String, String&gt;
) {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">var</span> url: String = <span class="hljs-string">""</span>
        <span class="hljs-keyword">var</span> method: String = <span class="hljs-string">"GET"</span>
        <span class="hljs-keyword">var</span> headers = mutableMapOf&lt;String, String&gt;()

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">()</span></span> = HttpRequest(url, method, headers)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">buildRequest</span><span class="hljs-params">(<span class="hljs-keyword">init</span>: <span class="hljs-type">HttpRequest</span>.<span class="hljs-type">Builder</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>: HttpRequest {
    <span class="hljs-keyword">return</span> HttpRequest.Builder().apply(<span class="hljs-keyword">init</span>).build()
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> request = buildRequest {
    url = <span class="hljs-string">"https://api.example.com"</span>
    method = <span class="hljs-string">"POST"</span>
    headers[<span class="hljs-string">"Content-Type"</span>] = <span class="hljs-string">"application/json"</span>
}
</code></pre>
<h4 data-id="heading-20">3. 策略模式 → 高阶函数</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java需要Strategy接口 + 多个实现类</span>
<span class="hljs-comment">// Kotlin: 高阶函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;, strategy: (<span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: List&lt;<span class="hljs-built_in">Int</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.map(strategy)
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> doubled = processData(list) { it * <span class="hljs-number">2</span> }
<span class="hljs-keyword">val</span> squared = processData(list) { it * it }
</code></pre>
<h4 data-id="heading-21">4. 装饰器模式 → 扩展函数</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java需要装饰器类包装</span>
<span class="hljs-comment">// Kotlin: 扩展函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> String.<span class="hljs-title">toTitleCase</span><span class="hljs-params">()</span></span>: String {
    <span class="hljs-keyword">return</span> split(<span class="hljs-string">" "</span>).joinToString(<span class="hljs-string">" "</span>) { word -&gt;
        word.replaceFirstChar { it.uppercase() }
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> title = <span class="hljs-string">"hello world"</span>.toTitleCase()  <span class="hljs-comment">// "Hello World"</span>
</code></pre>
<h4 data-id="heading-22">5. 观察者模式 → Flow</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Java需要Observer接口 + Subject类</span>
<span class="hljs-comment">// Kotlin: Flow</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataRepository</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _dataFlow = MutableStateFlow&lt;Data&gt;(Data.Empty)
    <span class="hljs-keyword">val</span> dataFlow: StateFlow&lt;Data&gt; = _dataFlow.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateData</span><span class="hljs-params">(newData: <span class="hljs-type">Data</span>)</span></span> {
        _dataFlow.value = newData
    }
}

<span class="hljs-comment">// 观察</span>
viewModelScope.launch {
    repository.dataFlow.collect { <span class="hljs-keyword">data</span> -&gt;
        updateUI(<span class="hljs-keyword">data</span>)
    }
}
</code></pre>
<h3 data-id="heading-23">3.2 架构模式的Kotlin实现</h3>
<h4 data-id="heading-24">1. MVVM架构的Kotlin化</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModel() {

    <span class="hljs-comment">// StateFlow替代LiveData</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow&lt;UiState&gt;(UiState.Loading)
    <span class="hljs-keyword">val</span> uiState = _uiState.asStateFlow()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _uiState.value = UiState.Loading

            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = repository.getUser(userId)
                _uiState.value = UiState.Success(user)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.value = UiState.Error(e.message ?: <span class="hljs-string">"Unknown error"</span>)
            }
        }
    }
}

<span class="hljs-comment">// UI层</span>
lifecycleScope.launch {
    repeatOnLifecycle(Lifecycle.State.STARTED) {
        viewModel.uiState.collect { state -&gt;
            <span class="hljs-keyword">when</span> (state) {
                <span class="hljs-keyword">is</span> UiState.Loading -&gt; showLoading()
                <span class="hljs-keyword">is</span> UiState.Success -&gt; showUser(state.user)
                <span class="hljs-keyword">is</span> UiState.Error -&gt; showError(state.message)
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-25">2. Repository模式的离线优先策略</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dao: UserDao
) {
    <span class="hljs-comment">// 单一数据源(Single Source of Truth)</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Flow&lt;User&gt; = flow {
        <span class="hljs-comment">// 1. 立即发射缓存数据</span>
        dao.getUserById(userId)?.let { emit(it) }

        <span class="hljs-comment">// 2. 从网络获取最新数据</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> user = api.getUser(userId)
            dao.insertUser(user)
            <span class="hljs-comment">// 数据库更新后Flow自动发射新值</span>
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            <span class="hljs-comment">// 网络失败,使用缓存</span>
        }
    }.flowOn(Dispatchers.IO)
}
</code></pre>
<h3 data-id="heading-26">3.3 实战经验总结</h3>
<h4 data-id="heading-27">经验1:优先使用不可变数据</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 可变数据导致bug</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-keyword">var</span> users: MutableList&lt;User&gt; = mutableListOf()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt; {
        <span class="hljs-keyword">return</span> users  <span class="hljs-comment">// 危险!外部可以修改</span>
    }
}

<span class="hljs-comment">// ✅ 不可变数据更安全</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _users = mutableListOf&lt;User&gt;()
    <span class="hljs-keyword">val</span> users: List&lt;User&gt; <span class="hljs-keyword">get</span>() = _users.toList()  <span class="hljs-comment">// 返回副本</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addUser</span><span class="hljs-params">(user: <span class="hljs-type">User</span>)</span></span> {
        _users.add(user)
    }
}
</code></pre>
<h4 data-id="heading-28">经验2:合理使用作用域函数</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 过度使用let导致嵌套地狱</span>
user?.let {
    it.profile?.let {
        it.avatar?.let {
            loadImage(it.url)
        }
    }
}

<span class="hljs-comment">// ✅ 使用安全调用链</span>
user?.profile?.avatar?.url?.let { loadImage(it) }

<span class="hljs-comment">// ✅ 使用run简化</span>
user?.run {
    profile?.avatar?.url?.let(::loadImage)
}
</code></pre>
<h4 data-id="heading-29">经验3:用密封类表示状态</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 使用多个Boolean表示状态,容易出错</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span>(
    <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> isError: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: User? = <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">val</span> errorMessage: String? = <span class="hljs-literal">null</span>
)
<span class="hljs-comment">// 可能出现非法状态:isLoading=true同时isError=true</span>

<span class="hljs-comment">// ✅ 使用密封类,编译器保证状态合法</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span> {
    <span class="hljs-keyword">object</span> Loading : UiState()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Success</span>(<span class="hljs-keyword">val</span> user: User) : UiState()
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Error</span>(<span class="hljs-keyword">val</span> message: String) : UiState()
}
</code></pre>
<hr/>
<h2 data-id="heading-30">四、学习路径:如何持续精进</h2>
<h3 data-id="heading-31">4.1 技能成长路线图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dab3d1d6504409e9aaa789b2632b2e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770989000&amp;x-signature=2q66MiylC2BrJ40OguAXvOAqahE%3D" alt="18-03-skill-growth-path.png" loading="lazy"/></p>
<p><strong>初级 (0-3个月)</strong></p>
<ul>
<li>✅ 掌握基础语法(变量、函数、类、控制流)</li>
<li>✅ 理解空安全机制</li>
<li>✅ 学会使用集合操作符</li>
<li>✅ 完成小型练习项目</li>
</ul>
<p><strong>中级 (3-9个月)</strong></p>
<ul>
<li>✅ 深入理解协程和Flow</li>
<li>✅ 掌握泛型和型变</li>
<li>✅ 熟练使用委托和扩展函数</li>
<li>✅ 参与实际项目开发</li>
</ul>
<p><strong>高级 (9-18个月)</strong></p>
<ul>
<li>✅ 设计类型安全的DSL</li>
<li>✅ 编写编译器插件</li>
<li>✅ 性能分析与优化</li>
<li>✅ 架构设计能力</li>
</ul>
<p><strong>专家 (18个月+)</strong></p>
<ul>
<li>✅ Kotlin Multiplatform实践</li>
<li>✅ 贡献开源项目</li>
<li>✅ 编写技术博客分享经验</li>
<li>✅ 建立个人技术影响力</li>
</ul>
<h3 data-id="heading-32">4.2 实践项目推荐</h3>
<h4 data-id="heading-33">1. 入门项目:待办事项应用</h4>
<p><strong>技术点</strong>:</p>
<ul>
<li>Data Class定义数据模型</li>
<li>LiveData/StateFlow状态管理</li>
<li>Room数据库CRUD操作</li>
<li>RecyclerView列表展示</li>
</ul>
<p><strong>学习目标</strong>: 掌握Kotlin基础语法和Android基本架构</p>
<h4 data-id="heading-34">2. 进阶项目:新闻阅读器</h4>
<p><strong>技术点</strong>:</p>
<ul>
<li>Retrofit网络请求</li>
<li>协程异步处理</li>
<li>Flow数据流</li>
<li>离线优先策略(Repository模式)</li>
<li>Paging3分页加载</li>
</ul>
<p><strong>学习目标</strong>: 掌握协程和网络编程最佳实践</p>
<h4 data-id="heading-35">3. 高级项目:IM即时通讯应用</h4>
<p><strong>技术点</strong>:</p>
<ul>
<li>WebSocket长连接</li>
<li>Channel消息队列</li>
<li>SharedFlow事件广播</li>
<li>自定义协程Dispatcher</li>
<li>性能优化</li>
</ul>
<p><strong>学习目标</strong>: 深入理解协程和并发编程</p>
<h4 data-id="heading-36">4. 专家项目:跨平台SDK开发</h4>
<p><strong>技术点</strong>:</p>
<ul>
<li>Kotlin Multiplatform</li>
<li>expect/actual机制</li>
<li>平台特定实现</li>
<li>Gradle插件开发</li>
<li>API设计</li>
</ul>
<p><strong>学习目标</strong>: 掌握跨平台开发和SDK设计</p>
<h3 data-id="heading-37">4.3 学习资源清单</h3>
<h4 data-id="heading-38">官方资源</h4>
<p><strong>文档</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.org%2Fdocs%2Fhome.html" target="_blank" title="https://kotlinlang.org/docs/home.html" ref="nofollow noopener noreferrer">Kotlin官方文档</a> - 权威参考</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.kotlinlang.org%2Fkoans" target="_blank" title="https://play.kotlinlang.org/koans" ref="nofollow noopener noreferrer">Kotlin Koans</a> - 交互式练习</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.kotlinlang.org%2FbyExample" target="_blank" title="https://play.kotlinlang.org/byExample" ref="nofollow noopener noreferrer">Kotlin by Example</a> - 示例学习</li>
</ul>
<h4 data-id="heading-39">书籍推荐</h4>
<p><strong>入门</strong>:</p>
<ul>
<li>《Kotlin in Action》 - Kotlin设计者Dmitry Jemerov编写</li>
<li>《Atomic Kotlin》 - Bruce Eckel的现代Kotlin教程</li>
</ul>
<p><strong>进阶</strong>:</p>
<ul>
<li>《Kotlin Coroutines by Tutorials》 - 协程深度指南</li>
<li>《Effective Kotlin》 - Marcin Moskała的最佳实践</li>
</ul>
<p><strong>高级</strong>:</p>
<ul>
<li>《Kotlin Programming: The Big Nerd Ranch Guide》 - 综合性进阶指南</li>
<li>《Functional Kotlin》 - 函数式编程实践</li>
</ul>
<h4 data-id="heading-40">社区资源</h4>
<p><strong>博客</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.jetbrains.com%2Fkotlin%2F" target="_blank" title="https://blog.jetbrains.com/kotlin/" ref="nofollow noopener noreferrer">Kotlin官方博客</a> - 最新动态</li>
</ul>
<p><strong>社区</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fkotlinlang.slack.com%2F" target="_blank" title="https://kotlinlang.slack.com/" ref="nofollow noopener noreferrer">Kotlin Slack</a> - 官方Slack频道</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kotlincn.net%2F" target="_blank" title="https://www.kotlincn.net/" ref="nofollow noopener noreferrer">Kotlin中文社区</a> - 中文资源</li>
</ul>
<h4 data-id="heading-41">开源项目</h4>
<p><strong>学习源码</strong>:</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKotlin%2Fkotlinx.coroutines" target="_blank" title="https://github.com/Kotlin/kotlinx.coroutines" ref="nofollow noopener noreferrer">kotlinx.coroutines</a> - 协程库源码</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fktorio%2Fktor" target="_blank" title="https://github.com/ktorio/ktor" ref="nofollow noopener noreferrer">Ktor</a> - Kotlin Web框架</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2FExposed" target="_blank" title="https://github.com/JetBrains/Exposed" ref="nofollow noopener noreferrer">Exposed</a> - Kotlin ORM框架</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJetBrains%2Fcompose-multiplatform" target="_blank" title="https://github.com/JetBrains/compose-multiplatform" ref="nofollow noopener noreferrer">Compose Multiplatform</a> - 跨平台UI</li>
</ul>
<p><strong>参与贡献</strong>:
从小PR开始(文档修正、测试补充),逐步参与Feature开发</p>
<hr/>
<h2 data-id="heading-42">五、未来展望:Kotlin的发展方向</h2>
<h3 data-id="heading-43">5.1 Kotlin 2.0时代</h3>
<p><strong>K2编译器</strong>:</p>
<ul>
<li>编译速度提升2倍</li>
<li>更好的IDE性能</li>
<li>新的语言特性支持</li>
</ul>
<p><strong>语言特性演进</strong>:</p>
<ul>
<li>Context Receivers(上下文接收者)</li>
<li>Value Classes改进</li>
<li>更强大的泛型系统</li>
</ul>
<h3 data-id="heading-44">5.2 Kotlin Multiplatform的成熟</h3>
<p><strong>应用场景扩展</strong>:</p>
<ul>
<li>移动端:iOS + Android代码共享</li>
<li>Web端:Kotlin/JS、Kotlin/Wasm</li>
<li>后端:Ktor服务端框架</li>
<li>桌面端:Compose Desktop</li>
</ul>
<p><strong>生态完善</strong>:</p>
<ul>
<li>更多KMP库支持</li>
<li>更好的工具链</li>
<li>企业级采用案例增多</li>
</ul>
<h3 data-id="heading-45">5.3 Compose的跨平台野心</h3>
<p><strong>Compose Multiplatform</strong>:</p>
<ul>
<li>Android、iOS、Desktop、Web统一UI框架</li>
<li>声明式UI编程范式</li>
<li>Kotlin DSL构建UI</li>
</ul>
<p><strong>未来趋势</strong>: "一次编写,到处运行"的现代实现</p>
<h3 data-id="heading-46">5.4 Kotlin在服务端的机遇</h3>
<p><strong>Spring Boot + Kotlin</strong>:</p>
<ul>
<li>更简洁的配置</li>
<li>协程支持</li>
<li>DSL路由定义</li>
</ul>
<p><strong>Ktor框架</strong>:</p>
<ul>
<li>纯Kotlin编写</li>
<li>异步非阻塞</li>
<li>轻量级高性能</li>
</ul>
<hr/>
<h2 data-id="heading-47">六、系列结语:Kotlin之路,永无止境</h2>
<h3 data-id="heading-48">6.1 系列回顾</h3>
<p>经过18篇文章、超过17万字的深度讲解,我们一起完成了从Kotlin入门到精通的完整旅程。</p>
<p><strong>致Kotlin初学者</strong>:</p>
<p>不要被Kotlin丰富的特性吓倒。学习Kotlin是一个渐进的过程,从基础语法开始,一步步深入。记住:</p>
<ul>
<li>先会用,再理解,最后创造</li>
<li>多动手,少焦虑</li>
<li>错误是最好的老师</li>
</ul>
<p><strong>致有经验的Java开发者</strong>:</p>
<p>Kotlin不仅仅是"更好的Java",而是一种思维方式的转变。不要把Java的思维强加到Kotlin上:</p>
<ul>
<li>忘掉getters/setters,拥抱属性</li>
<li>忘掉null检查,拥抱空安全</li>
<li>忘掉回调地狱,拥抱协程</li>
</ul>
<p><strong>致想成为Kotlin专家的开发者</strong>:</p>
<p>精通Kotlin不是终点,而是起点。真正的专家不仅会用Kotlin,更能:</p>
<ul>
<li>设计优雅的API</li>
<li>编写可维护的代码</li>
<li>分享知识帮助他人</li>
<li>推动技术社区发展</li>
</ul>
<p><strong>本系列完结。感谢陪伴!</strong> 🎉</p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p>
<p><strong>系列文章索引</strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7593541291011883035" target="_blank" title="https://juejin.cn/post/7593541291011883035">01. Kotlin快速入门</a></li>
<li><a href="https://juejin.cn/post/7593713738856677414" target="_blank" title="https://juejin.cn/post/7593713738856677414">02. 变量与数据类型</a></li>
<li><a href="https://juejin.cn/post/7594242987598528539" target="_blank" title="https://juejin.cn/post/7594242987598528539">03. 控制流与函数</a></li>
<li><a href="https://juejin.cn/post/7594669638559727642" target="_blank" title="https://juejin.cn/post/7594669638559727642">04. 类与对象基础</a></li>
<li><a href="https://juejin.cn/post/7595041883145142318" target="_blank" title="https://juejin.cn/post/7595041883145142318">05. 集合框架</a></li>
<li><a href="https://juejin.cn/post/7595410455222943754" target="_blank" title="https://juejin.cn/post/7595410455222943754">06. 面向对象进阶</a></li>
<li><a href="https://juejin.cn/post/7595841630675763251" target="_blank" title="https://juejin.cn/post/7595841630675763251">07. 类型系统深度解析</a></li>
<li><a href="https://juejin.cn/post/7595808703074893850" target="_blank" title="https://juejin.cn/post/7595808703074893850">08. 泛型进阶</a></li>
<li><a href="https://juejin.cn/post/7596906473306275890" target="_blank" title="https://juejin.cn/post/7596906473306275890">09. 委托机制</a></li>
<li><a href="https://juejin.cn/post/7597266141912465454" target="_blank" title="https://juejin.cn/post/7597266141912465454">10. 协程原理与实战(上)</a></li>
<li><a href="https://juejin.cn/post/7597623395907829806" target="_blank" title="https://juejin.cn/post/7597623395907829806">11. 协程原理与实战(下)</a></li>
<li><a href="https://juejin.cn/post/7598057199962210355" target="_blank" title="https://juejin.cn/post/7598057199962210355">12. 函数式编程</a></li>
<li><a href="https://juejin.cn/post/7598374376094302235" target="_blank" title="https://juejin.cn/post/7598374376094302235">13. DSL设计</a></li>
<li><a href="https://juejin.cn/post/7598532592455942171" target="_blank" title="https://juejin.cn/post/7598532592455942171">14. 编译器插件</a></li>
<li><a href="https://juejin.cn/post/7598801700050812966" target="_blank" title="https://juejin.cn/post/7598801700050812966">15. Kotlin多平台开发</a></li>
<li><a href="https://juejin.cn/post/7599920572839919625" target="_blank" title="https://juejin.cn/post/7599920572839919625">16. 性能优化</a></li>
<li><a href="https://juejin.cn/post/7601159804491022355" target="_blank" title="https://juejin.cn/post/7601159804491022355">17. Android协程最佳实践</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin中的JvmMultifileClass注解]]></title>    <link>https://juejin.cn/post/7603444191448727586</link>    <guid>https://juejin.cn/post/7603444191448727586</guid>    <pubDate>2026-02-06T12:13:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191448727586" data-draft-id="7603383311531311119" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin中的JvmMultifileClass注解"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-02-06T12:13:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin中的JvmMultifileClass注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:13:13.000Z" title="Fri Feb 06 2026 12:13:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmMultifileClass 是 Kotlin 中的一个文件级注解（File-level Annotation），通常与 @file:JvmName 配合使用，将多个 Kotlin 文件的顶层声明合并到同一个 JVM 类中。</p>
<p>其核心作用是解决“同一功能模块的代码分散在多个 Kotlin 文件中时，如何在 Java 中以统一的类名调用”的问题，提升跨语言调用的便利性。</p>
<h2 data-id="heading-0">背景与问题场景</h2>
<p>Kotlin 的顶层函数（不在类或对象中定义的函数）默认会被编译到一个与文件名关联的 JVM 类中（命名规则：文件名 + "Kt"，例如 StringUtils.kt 生成 StringUtilsKt 类）。</p>
<p>若一个功能模块的工具方法分散在多个 Kotlin 文件中（例如 StringUtils.kt、NumberUtils.kt），每个文件会生成独立的 JVM 类（如 StringUtilsKt、NumberUtilsKt），导致 Java 调用时需要分别引用不同的类，不够直观。</p>
<p>示例问题：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File1: StringUtils.kt</span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-comment">// File2: NumberUtils.kt  </span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span> = num &gt; <span class="hljs-number">0</span>

<span class="hljs-comment">// Java 调用时需分别引用两个类：</span>
<span class="hljs-comment">// boolean empty = StringUtilsKt.isEmpty("test");</span>
<span class="hljs-comment">// boolean positive = NumberUtilsKt.isPositive(10);</span>
</code></pre>
<h2 data-id="heading-1">@JvmMultifileClass 的解决方案</h2>
<p>通过 @file:JvmName 为多个文件指定相同的 JVM 类名，并添加 @file:JvmMultifileClass 注解，Kotlin 编译器会将这些文件的顶层声明合并到同一个 JVM 类中。这样，Java 调用时只需通过一个类名即可访问所有分散的顶层函数。</p>
<p>使用步骤与示例</p>
<ol>
<li>为目标文件指定相同的 @file:JvmName</li>
</ol>
<p>在所有需要合并的 Kotlin 文件顶部，使用 @file:JvmName 注解指定相同的 JVM 类名（需包含包名）。</p>
<ol start="2">
<li>添加 @file:JvmMultifileClass 注解</li>
</ol>
<p>在每个文件的 @file:JvmName 下方添加 @file:JvmMultifileClass 注解，告知编译器合并这些文件的顶层声明。</p>
<p>示例代码：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File1: StringUtils.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"CommonUtils"</span>)       <span class="hljs-comment">// 指定 JVM 类名为 com.example.utils.CommonUtils</span>
<span class="hljs-meta">@file:JvmMultifileClass</span>           <span class="hljs-comment">// 标记为需要合并的文件</span>
<span class="hljs-keyword">package</span> com.example.utils          <span class="hljs-comment">// 包名需一致</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-comment">// File2: NumberUtils.kt  </span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"CommonUtils"</span>)       <span class="hljs-comment">// 与 File1 相同的 JVM 类名</span>
<span class="hljs-meta">@file:JvmMultifileClass</span>           <span class="hljs-comment">// 同样标记为需要合并的文件</span>
<span class="hljs-keyword">package</span> com.example.utils          <span class="hljs-comment">// 包名必须一致</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(num: <span class="hljs-type">Int</span>)</span></span> = num &gt; <span class="hljs-number">0</span>
</code></pre>
<ol start="3">
<li>Java 调用效果</li>
</ol>
<p>编译后，两个文件的顶层函数会被合并到 com.example.utils.CommonUtils 类中。Java 调用时只需通过该统一类名访问：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java 调用（无需区分 StringUtilsKt 或 NumberUtilsKt）</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">empty</span> <span class="hljs-operator">=</span> CommonUtils.isEmpty(<span class="hljs-string">"test"</span>);      <span class="hljs-comment">// 来自 StringUtils.kt</span>
<span class="hljs-type">boolean</span> <span class="hljs-variable">positive</span> <span class="hljs-operator">=</span> CommonUtils.isPositive(<span class="hljs-number">10</span>);    <span class="hljs-comment">// 来自 NumberUtils.kt</span>
</code></pre>
<h2 data-id="heading-2">关键注意事项</h2>
<ol>
<li>
<p>包名必须一致：所有参与合并的 Kotlin 文件必须属于同一个包（即 package 语句相同），否则无法合并。</p>
</li>
<li>
<p>@file:JvmName 的名称需全局唯一：指定的 JVM 类名（如 CommonUtils）不能与同一模块中其他类的名称冲突，否则会导致编译错误。</p>
</li>
<li>
<p>仅合并顶层声明：@JvmMultifileClass 仅对顶层函数、顶层属性生效，类、对象、伴生对象等声明不会被合并。</p>
</li>
<li>
<p>注解顺序要求：@file:JvmName 必须位于 @file:JvmMultifileClass 之前，且两者均需放在文件顶部（package 语句之前）。</p>
</li>
<li>
<p>避免过度合并：合并的文件应具有逻辑关联性（如同一功能模块的工具类），否则可能导致 JVM 类过于庞大，影响可读性和维护性。</p>
</li>
</ol>
<h2 data-id="heading-3">典型应用场景</h2>
<p>• 工具类拆分：将一个大型工具类（如 StringUtils、NumberUtils）拆分为多个 Kotlin 文件，但通过 @JvmMultifileClass 合并为同一个 JVM 类，方便 Java 调用。</p>
<p>• 模块化开发：团队开发中，不同开发者负责同一功能模块的不同部分（如网络请求的工具函数、数据校验的工具函数），通过合并注解保持对外接口的统一。</p>
<h2 data-id="heading-4">总结</h2>
<p>@JvmMultifileClass 是 Kotlin 为优化 JVM 平台互操作性设计的注解，通过与 @file:JvmName 配合，将多个文件的顶层声明合并到同一个 JVM 类中，解决了“分散代码的统一调用”问题。合理使用可提升跨语言代码的可读性和维护性，尤其适用于工具类或模块化开发的场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[地平线征程 6 工具链入门教程 | 征程 6B 计算平台部署指南]]></title>    <link>https://juejin.cn/post/7603359026711838730</link>    <guid>https://juejin.cn/post/7603359026711838730</guid>    <pubDate>2026-02-06T12:14:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026711838730" data-draft-id="7603584155784331314" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="地平线征程 6 工具链入门教程 | 征程 6B 计算平台部署指南"/> <meta itemprop="keywords" content="自动驾驶,算法"/> <meta itemprop="datePublished" content="2026-02-06T12:14:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="地平线开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1257497032132567"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            地平线征程 6 工具链入门教程 | 征程 6B 计算平台部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497032132567/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    地平线开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:14:55.000Z" title="Fri Feb 06 2026 12:14:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.前言</h2>
<p>本文旨在提供 征程 6B 计算平台的部署指南，将会从硬件、软件两部分进行介绍，本文整理了我们推荐的使用流程，和大家可能会用到的一些工具特性，以便于您更好地理解工具链。某个工具具体详细的使用说明，还请参考用户手册。</p>
<h2 data-id="heading-1">2.征程 6B 硬件配置</h2>
<p><img src="http://openwrite.cn/uploads/19742/59443/6e793ae7-b061-4833-8cbd-7baade202e31.png" alt="image.png" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19742/59443/e3db4baa-bba9-45b6-9dea-96e5bfb80ec3.png" alt="image.png" loading="lazy"/></p>
<p>BPU 内部器件：</p>
<p><strong>TAE</strong>：BPU 内部的张量加速引擎，主要用于 Conv、MatMul、Linear 等 Gemm 类算子加速，<strong>征程 6B 新增</strong>​<strong>浮点</strong>​<strong>输出支持（模型中间层支持 ​</strong>​<strong>fp16</strong>​<strong>​ 输出，模型</strong>​<strong>输出层</strong>​<strong>支持 fp32 输出）</strong></p>
<p><strong>AAE</strong>：Pooling、Resizer、Warping 等偏专用单元的集合，其中 Warping 可用于加速 Gridsample 等算子</p>
<p><strong>DTE</strong>：BPU 内部的数据排布变换引擎，支持各种维度的高效变换</p>
<p><strong>VAE</strong>：BPU 内部的 SIMD 向量加速引擎，可用于加速 Add、Mul、查表等 Vector 计算，<strong>征程 6B 新增浮点支持</strong></p>
<p><strong>VPU</strong>：BPU 内部的 SIMT 向量加速单元，征程 6EM 可用于实现 Quantize、Dequantize 等算子，<strong>征程 6B 没有该硬件</strong></p>
<p><strong>SPU</strong>：BPU 内部的 RISC-V 标量加速单元，征程 6EM 可用于实现 TopK 等算子，<strong>征程 6B 没有该硬件，仅有 APM</strong></p>
<p><strong>APM</strong>：BPU 内部另一块 RISC-V 标量加速单元，主要用于 BPU 任务调度等功能</p>
<h2 data-id="heading-2">3.征程 6 工具链简介</h2>
<h3 data-id="heading-3">3.1 模块架构图</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/84d44aa3-9ca6-4d7b-b21e-73eed5341ee4.png" alt="image.png" loading="lazy"/></p>
<p><strong>PTQ</strong>：征程 6 工具链基于 <code>horizon_tc_ui</code> 包封装的 <code>hb_compile</code> 命令行工具，提供 ONNX 模型 PTQ 全流程转换能力，其内部会先调用 <code>hmct</code> 包实现模型解析、图优化、校准功能，再调用 <code>hbdk4_compiler</code> 包实现模型的定点化和编译功能；</p>
<p><strong>QAT</strong>：征程 6 工具链基于 <code>horizon_plugin_pytorch</code> 包提供量化感知训练能力；</p>
<p><strong>HBDK</strong>：征程 6 工具链编译器，基于 <code>hbdk4_compiler</code> 包提供模型定点化、图修改、模型编译、静态 perf 等功能；</p>
<p><strong>高效模型算法包</strong>：征程 6 工具链基于 <code>horizon-torch-samples</code> 包，以源码开放形式提供了多场景参考算法，这些模型基于开源数据集训练，模型结构贴合地平线芯片进行了高效且用户友好的设计，并基于 QAT 链路实现了模型的量化转换；</p>
<p><strong>UCP</strong>：征程 6 工具链统一计算平台，通过一套统一的异构编程接口实现了对 征程 6 计算平台相关计算资源的调用，提供视觉处理、模型推理、高性能计算库、自定义算子插件开发等功能；</p>
<p><strong>AI-Benchmark</strong>：征程 6 工具链基于预编译好模型提供的嵌入式工程示例，可实现模型的性能评测和精度评测。</p>
<h3 data-id="heading-4">3.2 两套模型转换链路</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/3023172f-40fc-4c06-8c03-417e1325aff3.png" alt="image.png" loading="lazy"/></p>
<p>征程 6 工具链支持 PTQ（训练后量化）、QAT（量化感知训练）两套模型转换链路，其特性和优缺点如下：</p>
<p><strong>PTQ</strong>：基于 <code>hb_compile</code> 命令行工具转换模型，配置好 yaml、校准数据集后，可一步实现模型的图优化、校准、量化、编译全流程。​<strong>该量化方式快捷易用，但仅基于数学统计方式的离线量化不利于模型迭代，且可能会触发难以解决的 corner case</strong>​，因此在量产项目中通常用于早期评测和简单模型的量化。</p>
<p><strong>QAT</strong>：在 PyTorch 开源框架上，基于 <code>plugin</code> 插件的形式提供模型量化能力，并调用 <code>hbdk</code> 编译器的 API 实现模型的定点化和编译。该链路支持模型校准后进一步的 finetune 训练，虽然上手难度和训练成本都较高，​<strong>但精度上限也更高，更利于模型迭代优化</strong>​，是量产项目中的更优选择。</p>
<h3 data-id="heading-5">3.3 工具链推荐使用流程</h3>
<p>鉴于两条量化链路的特性，我们建议的工具链使用流程如下：
<img src="http://openwrite.cn/uploads/19742/59443/a43e1ccb-89fb-4712-8546-e7eece421719.png" alt="image.png" loading="lazy"/></p>
<p><strong>Step1</strong>：先导出浮点 ONNX 模型（opset10～19），并基于 PTQ 链路进行快速的模型结构验证，全 int8 性能上限验证；若该性能符合预期，则可以精调 PTQ，若最终精度/精度都可同时满足预期，则可进行板端部署。</p>
<p><strong>Step2</strong>：如果遇到 PTQ 无法解决的精度 corner case，则需要转到 QAT 链路进行量化。依然建议先进行模型结构验证和全 int8 性能上限验证；若该性能符合预期，则优先在全 int16 配置下将精度训练至符合预期，然后再降低 int16 比例，实现 int8/int16/fp16 混合精度下的性能/精度调优，最后进行板端部署。</p>
<p>在以上推荐链路中：</p>
<p>PTQ 链路的模型结构验证和标准量化，可在 X86 端参考本文 4.2 节使用 <code>hb_compile</code> 命令行工具；</p>
<p>模型性能分析和验证，可在 X86 端参考本文 6.4 节《静态 perf》使用 <code>hbm_perf</code> 接口生成 html 分析文件，可在板端参考本文 8.2.1 节使用 <code>hrt_model_exec</code> 工具；</p>
<p>模型推理，可在 X86 端参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_tool%2Fhbruntime.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_tool/hbruntime.html" ref="nofollow noopener noreferrer">训练后量化-PTQ 转换工具-HBRuntime 推理库</a>》，可在板端参考本文第 8 章《模型板端部署》使用 UCP 推理接口；</p>
<p>模型性能/精度调优，请见后续文章的详细介绍。</p>
<h2 data-id="heading-6">4.PTQ 链路</h2>
<h3 data-id="heading-7">4.1 模型转换流程</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/5f1bc48b-20b3-41de-9440-6431df6e4b6a.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">4.2 hb_compile 工具</h3>
<p><code>hb_compile</code> 为 PTQ 模型转换的命令行工具，支持以下 3 种使用方式：</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/078b7de3-c703-4452-ad08-f89f8ba17c5f.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">4.3 PTQ 模型产出物</h3>



































<table><thead><tr><th><strong>original_float.onnx</strong></th><th>浮点</th><th>对 Caffe1.0 模型进行解析，转成 ONNX</th></tr></thead><tbody><tr><td><strong>optimized_float.onnx</strong></td><td>浮点</td><td>图优化，例如 BN 融合到 Conv</td></tr><tr><td><strong>calibrated.onnx</strong></td><td>伪量化</td><td>插入校准节点，并基于校准数据计算统计到每个节点的量化参数</td></tr><tr><td><strong>ptq.onnx</strong></td><td>查表算子定点 + 其他算子伪量化</td><td>将查表算子定点化</td></tr><tr><td><strong>quantized.bc</strong></td><td>定点</td><td>整个模型定点化，并转换为地平线 hbir 中间表达</td></tr><tr><td><strong>hbm</strong></td><td>指令集</td><td>经过编译后的最终部署模型</td></tr></tbody></table>
<h3 data-id="heading-10">4.4 PTQ 精度配置方法</h3>
<p>在 config.yaml 中，支持通过 json 的方式配置 ​<strong>全局</strong>​、​<strong>某类算子</strong>​、​<strong>某个子图</strong>​、<strong>某个节点 ​</strong>的计算精度，可根据 BPU 算子支持约束进行配置。</p>
<pre><code class="hljs language-Plain" lang="Plain"># 校准参数组
calibration_parameters:
  quant_config: './quant_config.json'
</code></pre>
<h3 data-id="heading-11">4.5 PTQ 精度调优流程</h3>
<p>请参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_usage%2Faccuracy_tune.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_usage/accuracy_tune.html" ref="nofollow noopener noreferrer">训练后量化-PTQ 转换步骤-模型精度调优</a>》和《训练后量化-PTQ 转换步骤-精度调优实战》章节。</p>
<h2 data-id="heading-12">5.QAT 链路</h2>
<h3 data-id="heading-13">5.1 模型转换流程</h3>
<p><img src="http://openwrite.cn/uploads/19742/59443/eaadb6db-c995-494c-b37a-f3970fac4b90.png" alt="image.png" loading="lazy"/></p>
<p><strong>浮点模型改造​</strong>：在模型前插入 QuantStub、在模型后插入 DequantStub，用于识别模型首尾部，剥离前后处理</p>
<p><strong>模型校准</strong>：通过在模型中插入 Observer 的方式，在 forward 过程中统计各处的数据分布，以计算出量化参数</p>
<p>部分模型仅通过 Calibration 便可满足精度要求，则无需进行 QAT，可直接编译模型用于部署</p>
<p>即使 Calibration 无法满足精度要求，也可降低后续 QAT 难度，缩短训练时间，提升最终训练精度</p>
<p><strong>量化感知训练</strong>：进一步通过训练的方式微调模型参数，如果 Calibration 精度较好，则推荐固定激活 scale</p>
<p>JIT-STRIP：使用 hook 和 subclass tensor 的方式感知图结构，在原有 forward 上做算子替换/算子融合等操作，并且会根据模型中 QuantStub 和 DequantStub 的位置识别并跳过前后处理</p>
<p>优点：全自动，代码修改少，屏蔽了很多细节问题，便于 debug</p>
<p>缺点：动态代码块仍需要特殊处理</p>
<h3 data-id="heading-14">5.2 QAT 精度配置方法</h3>
<p>请见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F13112" target="_blank" title="https://developer.horizon.auto/blog/13112" ref="nofollow noopener noreferrer">【地平线 J6 工具链入门教程】QAT 新版 qconfig 量化模板使用教程</a>。</p>
<h3 data-id="heading-15">5.3 QAT 精度调优流程</h3>
<p><strong>整体调优流程：</strong></p>
<p>征程 6B 区别于征程 6E/M 来说浮点算子（fp16）的支持能力更多，但是由于没有 vpu，因此不高优推荐 fp16 调优，仍建议沿用。
<img src="http://openwrite.cn/uploads/19742/59443/66fa477b-078d-4b92-85c7-945ab281d6e3.png" alt="image.png" loading="lazy"/></p>
<p><strong>fp16 配置方式：</strong></p>
<p>QAT 新版 qconfig 量化模板使用教程见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F13112" target="_blank" title="https://developer.horizon.auto/blog/13112" ref="nofollow noopener noreferrer">developer.horizon.auto/blog/13112</a></p>
<pre><code class="hljs language-Plain" lang="Plain">my_qconfig_setter=QconfigSetter(
    reference_qconfig=get_qconfig(observer=MSEObserver),
    templates=[
        ModuleNameTemplate({ "":qint16,}),
        ModuleNameTemplate({"quant":torch.float16}),
        ...        
        ],
        save_dir="./work_dir",
    )
</code></pre>
<p>需要注意，由于征程 6B 没有 vpu，fp16 算子的使用可能会引入 cpu 的 quant、dequant 算子。建议尽量少的配 FP 16，避免性能损失。</p>
<h2 data-id="heading-16">6.模型导出/定点化/编译</h2>
<h3 data-id="heading-17">6.1 PTQ 链路</h3>
<p>该流程封装在 <code>hb_compile</code> 中，相关参数通过 yaml 进行配置。若自行调用编译器接口执行，参考代码如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">import onnx
from hbdk4.compiler.onnx import export
from hbdk4.compiler import convert, save, compile

# 经过PTQ校准得到的伪量化onnx模型，非线性的查表算子已定点
ptq_model = onnx.load("xxx_ptq_model.onnx")    

# 导出查表算子定点+其他算子伪量化的hbir模型
qat_bc = export(ptq_model)
save(qat_bc, "qat.bc")

# 导出全定点hbir模型
quantized_bc = convert(qat_bc, "nash-b")
save(quantized_bc, "quantized.bc")

# 编译生成hbm模型
compile(
    m=quantized_bc, 
    path="model.hbm", 
    opt=2, 
    march="nash-b", 
    progress_bar=True,
    input_no_padding=True,
    output_no_padding=True
)
</code></pre>
<h4 data-id="heading-18">6.1.1 输入/输出去 padding</h4>
<p>模型在 BPU 上推理时，其输入和输出节点的内存大小和数据存放规则需满足硬件对齐要求。</p>
<p><strong>内存对齐</strong>：申请的内存大小需满足某个字节数的整数倍，</p>
<p><strong>跨距对齐</strong>：跨距（Stride）是指数据存储在内存中时，每一行所占空间的实际大小，当对齐到某个字节数的整数倍后，硬件即可高效处理。该对齐的操作又叫 Padding，实际的对齐规则取决于具体的软硬件系统。假设一份 NHWC 为 1x20x30x1 的 int8 数据，若硬件要求跨距 W32 对齐，那么每一行 W 都将 Padding 2 个字节。</p>
<p>征程 6 工具链支持在 <code>compile</code> 接口中传入 <code>input_no_padding</code>、<code>output_no_padding</code> 参数来控制是否使用 BPU 自动完成 padding 对齐操作。开启后用户即可不关心 BPU 跨距对齐要求，无需手动 Padding，数据可连续存储在内存中。该特性可优化模型输入/输出的 IO 负载，但也有微小概率会引入性能的小幅下降，所以是否开启该功能请在您的模型上实际验证，并请在模型编译和板端部署环节统一跨距对齐的处理策略。</p>
<h3 data-id="heading-19">6.2 QAT 链路</h3>
<p>QAT 链路的模型定点化和编译直接调用如上的编译器接口，模型导出额外封装了一层，参考代码如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">from horizon_plugin_pytorch.quantization.hbdk4 import export

def export(
    model: nn.Module,
    example_inputs: Any,
    name: str = "forward",
    input_names: Optional[Any] = None,    # 建议在模型导出时就配置好输入输出节点名称
    output_names: Optional[Any] = None,
    input_descs: Optional[Any] = None,
    output_descs: Optional[Any] = None,
    native_pytree: bool = True,
) -&gt; Module
</code></pre>
<h3 data-id="heading-20">6.3 模型修改</h3>
<p>编译器支持在 hbir 上进行多 batch 拆分、插入数据前处理、算子删除、调整输入输出 layout 等修改操作，其主要应用场景如下：</p>
<p><strong>多 batch 拆分</strong>：典型场景是 BEV 模型在部署时，多 V 输入来源于不同的摄像头，其数据在内存中独立存储，因此模型可将其多 V 输入沿 batch 维度做拆分；</p>
<p><strong>数据前处理</strong>：征程 6 工具链支持在模型前端插入一个前处理节点，以实现颜色空间转换（如 NV12—&gt; BGR）、数据归一化（<code>(data-mean)/std</code>），和 Resizer 功能（从大图上抠图 + Resize），并可由 BPU 进行加速；</p>
<p><strong>算子删除</strong>：征程 6 工具链支持将模型首尾部的 Quantize、Dequantize、Cast、Reshape、Transpose 等算子删除，以适配更加灵活的部署方案；</p>
<p><strong>调整输入输出 layout</strong>：模型首尾部除了支持删除 Reshape、Transpose 节点外，还支持插入 Transpose 节点，用户可灵活调整其 layout 排布。</p>
<p>以下参考代码对一个多输入模型实现了多 batch 输入拆分、图像输入的色彩空间转换、数据归一化、Resizer 功能：</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import load, convert

qat_bc = load("qat.bc")  
func = qat_bc[0]
batch_input = ["input_name1"]   # 需要使用独立地址方式部署的输入节点名称列表
resizer_input = ["resize"]      # 部署时数据来源于resizer的输入节点名称列表
pyramid_input = ["pym"]         # 部署时数据来源于pyramid的输入节点名称列表

def channge_source(input, source):
    node = input.insert_transpose(permutes=[0, 3, 1, 2])
    node = node.insert_image_preprocess(mode="yuvbt601full2bgr", divisor=1, mean=[128, 128, 128], std=[128, 128, 128])
    if source == "pyramid":
        node.insert_image_convert("nv12")          
    elif source == "resizer":
        node.insert_roi_resize("nv12")

for input in func.inputs[::-1]:
    if input.name in batch_input:
        origin_name = input.name
        split_inputs = input.insert_split(dim=0)
        for split_input in reversed(split_inputs):
            if origin_name in pyramid_input:
                channge_source(split_input, "pyramid")
            elif origin_name in resizer_input:
                channge_source(split_input, "resizer")
</code></pre>
<h3 data-id="heading-21">6.4 静态 perf</h3>
<p>对于编译好的 hbm，编译器支持在 X86 端对其 BPU 部分进行静态性能预估，执行以下命令即可生成一个 html 文件，包含模型预估性能、带宽、内存占用、BPU 内部单帧执行时序图等信息。</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import hbm_perf
hbm_perf(model="xxx.hbm", output_dir="./")
</code></pre>
<h2 data-id="heading-22">7.浮点能力使用</h2>
<h3 data-id="heading-23">7.1 TAE 张量输出，VAE 向量计算支持浮点</h3>
<p>征程 6B BPU 的 TAE 张量计算单元支持 FP16/FP32 输出，VAE 向量计算单元支持 FP16 计算。但在实际部署中仍需综合评估后再使用，具体原因如下：</p>
<p><strong>精度</strong>：FP16 并非在所有情况下都优于 INT16，通常情况下数值范围小时 FP16 更优，数值范围大时 INT16 更优，但也需要考虑数值较小或较大部分的误差对模型输出的影响程度。所以量化精度是否使用 FP16，更建议基于精度 Debug 的分析结果来确定；</p>
<p><strong>性能</strong>：除 Reduce 性能为 INT16 的 1/2 外，其他算子的 FP16 性能和 INT16 性能持平</p>
<p><strong>额外开销</strong>：虽然 FP16 算子本身无需量化，但上下游算子如果涉及 FP16 &lt;—&gt; INT16 的数据转换，则会引入量化/反量化：</p>
<p>虽然该节点可以由 VAE 硬件直接支持，但相比于全 INT16 直接串接仍会有额外的性能、带宽开销；</p>
<p>新引入的量化或反量化节点的 Scale 需要重新校准/QAT 训练得到。</p>
<h3 data-id="heading-24">7.2 无 VPU 加速量化/反量化</h3>
<p>相比于 征程 6EM 计算平台，征程 6B 无 VPU 硬件加速模型首尾部的量化/反量化节点，但支持 Gemm 类算子直接 FP32 输出，其他 INT8/INT16 输出节点的反量化，则更建议使用编译器接口将其从 quantized.bc 上移除，并参考该篇文章（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.horizon.auto%2Fblog%2F10424" target="_blank" title="https://developer.horizon.auto/blog/10424" ref="nofollow noopener noreferrer">反量化节点的融合实现</a>）将其融合进前后处理代码中，以减少一次数据遍历的冗余开销。</p>
<pre><code class="hljs language-Plain" lang="Plain">from hbdk4.compiler import load

quantized_bc = load("quantized.bc")
quantized_bc[0].remove_io_op(op_types=["Quantize", "Dequantize"])
</code></pre>
<h3 data-id="heading-25">7.3 无 SPU，标量计算能力有限</h3>
<p>相比于 征程 6 其他计算平台，征程 6B 的标量计算单元算力减少，因此 TopK 等标量算子的部署性能需要综合评估后选择合适方案。</p>
<h2 data-id="heading-26">8.模型板端部署</h2>
<h3 data-id="heading-27">8.1 UCP 简介</h3>
<p>UCP（Unify Compute Platform，统一计算平台）定义了一套统一的异构编程接口， 将 SOC 上的功能硬件抽象出来并进行封装，对外提供基于功能的 API 进行调用。UCP 提供的具体功能包括：​<strong>视觉处理</strong>​（Vision Process）、​<strong>神经网络模型推理</strong>​（Neural Network）、​<strong>高性能计算库</strong>​（High Performance Library）、​<strong>自定义算子插件开发</strong>​。</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/723349cb-c241-4612-859f-594123989d06.png" alt="image.png" loading="lazy"/></p>
<p>UCP 支持的 Backend 如下：
<img src="http://openwrite.cn/uploads/19742/59443/19bd1039-5d83-4358-bde4-dd9d664eb1fc.png" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-28">8.2 快速上手</h3>
<p>使用 UCP 推理模型的基本代码参考如下，详细信息可参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Fruntime_dev.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/runtime/runtime_dev.html" ref="nofollow noopener noreferrer">统一计算平台-模型推理开发</a>》、《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fmodel_deployment_guidance%2Fmodel_deployment_guidance_examples%2Frgb_resnet18_deployment_guidance.html" target="_blank" title="https://doc.oe.horizon.auto/guide/model_deployment_guidance/model_deployment_guidance_examples/rgb_resnet18_deployment_guidance.html" ref="nofollow noopener noreferrer">模型部署实践指导-模型部署实践指导实例</a>》、《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oe.horizon.auto%2Fguide%2Fucp%2Fucp_api_reference%2Fucp_api_overview.html" target="_blank" title="https://docs.oe.horizon.auto/guide/ucp/ucp_api_reference/ucp_api_overview.html" ref="nofollow noopener noreferrer">UCP 通用 API 介绍</a>》等相关章节。</p>
<pre><code class="hljs language-Plain" lang="Plain">// 1. 加载模型并获取模型名称列表以及Handle
{
    hbDNNInitializeFromFiles(&amp;packed_dnn_handle, &amp;modelFileName, 1);
    hbDNNGetModelNameList(&amp;model_name_list, &amp;model_count, packed_dnn_handle);
    hbDNNGetModelHandle(&amp;dnn_handle, packed_dnn_handle, model_name_list[0]);
}

// 2. 根据模型的输入输出信息准备张量
std::vector&lt;hbDNNTensor&gt; input_tensors;
std::vector&lt;hbDNNTensor&gt; output_tensors;
int input_count = 0;
int output_count = 0;
{
    hbDNNGetInputCount(&amp;input_count, dnn_handle);
    hbDNNGetOutputCount(&amp;output_count, dnn_handle);
    input_tensors.resize(input_count);
    output_tensors.resize(output_count);
    prepare_tensor(input_tensors.data(), output_tensors.data(), dnn_handle);
}

// 3. 准备输入数据并填入对应的张量中
{
    read_data_2_tensor(input_data, input_tensors);
    // 确保更新输入后进行Flush操作以确保BPU使用正确的数据
    for (int i = 0; i &lt; input_count; i++) {
      hbUCPMemFlush(&amp;input_tensors[i].sysMem, HB_SYS_MEM_CACHE_CLEAN);
    }
}

// 4. 创建任务并进行推理
{
    // 创建任务
    hbDNNInferV2(&amp;task_handle, output_tensors.data(), input_tensors.data(), dnn_handle)
    
    // 提交任务
    hbUCPSchedParam sched_param;
    HB_UCP_INITIALIZE_SCHED_PARAM(&amp;sched_param);
    sched_param.backend = HB_UCP_BPU_CORE_ANY;
    hbUCPSubmitTask(task_handle, &amp;sched_param);
    
    // 等待任务完成
    hbUCPWaitTaskDone(task_handle, 0);
}

// 5. 处理输出数据
{
    // 确保处理输出前进行Flush操作以确保读取的不是缓存中的脏数据
    for (int i = 0; i &lt; output_count; i++) {
      hbUCPMemFlush(&amp;output_tensors[i].sysMem, HB_SYS_MEM_CACHE_INVALIDATE);
    }
    // 对输出进行后处理操作
}

// 6. 释放资源
{
    // 释放任务
    hbUCPReleaseTask(task_handle);
    // 释放输入内存
    for (int i = 0; i &lt; input_count; i++) {
      hbUCPFree(&amp;(input_tensors[i].sysMem));
    }
    // 释放输出内存
    for (int i = 0; i &lt; output_count; i++) {
      hbUCPFree(&amp;(output_tensors[i].sysMem));
    }
    // 释放模型
    hbDNNRelease(packed_dnn_handle);
}
</code></pre>
<h4 data-id="heading-29">8.2.1 hrt_model_exec 工具</h4>
<p>为了方便用户快速查看 hbm 和 quantized.bc 的模型信息、进行模型单帧推理和性能评测，征程 6 工具链 UCP 提供了 <code>hrt_model_exec</code> 工具，并支持编译 X86、aarch64（aarch64 仅支持 hbm 推理）两个架构下的可执行程序。</p>
<p>hrt_model_exec 的三种使用方法如下：</p>
<pre><code class="hljs language-Plain" lang="Plain"># 设置环境变量
# arch代表架构类型，aarch64或x86
arch=aarch64
bin=../$arch/bin/hrt_model_exec
lib=../$arch/lib/
export LD_LIBRARY_PATH=${lib}:${LD_LIBRARY_PATH}

# 获取模型信息
${bin} model_info --model_file=xxx.hbm

# 模型单帧推理
${bin} infer --model_file=xxx.hbm --input_file=xxx.bin

# 模型性能评测-Latency(单线程)
${bin} perf --model_file=xxx.hbm --thread_num 1 --frame_count=1000

# 模型性能评测-FPS(多线程)
${bin} perf --model_file=xxx.hbm --thread_num 8 --frame_count=1000
</code></pre>
<h3 data-id="heading-30">8.3 图像输入动态 shape/stride</h3>
<p>在 征程 6 芯片的视频通路上，有一块叫 Pyramid 的金字塔硬件处理模块，可提供 Camera 输入图像的缩放及 ROI 抠图能力，其输出为 nv12 类型的图像数据，并可基于共享内存机制直接给到 BPU 进行模型推理。因此在 征程 6 工具链中：</p>
<ol>
<li>Pyramid 模型指的是具有 nv12 图像输入的模型；</li>
<li>Resizer 模型指的是具有 nv12 图像输入和 ROI 输入的模型，编译器支持通过 JIT 动态指令的方式，从 nv12 图像上完成 ROI 抠图 + Resize 的功能。</li>
</ol>
<p>在 征程 6 工具链中，Pyramid 的输入 stride 为动态，Resizer 模型的 stride 和 shape 都是动态。如下为 mobilenetv1 编译后的模型信息：
<img src="http://openwrite.cn/uploads/19742/59443/58fced0e-364c-4019-95fd-730d8d9b7896.png" alt="image.png" loading="lazy"/>
hrt_model_exec model_info 板端可执行程序工具</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/75071b3d-fa56-4930-a50d-4d99fded8704.png" alt="image.png" loading="lazy"/></p>
<p>其中，-1 为占位符，表示为动态，Pyramid 输入的 stride 为动态；Resizer 输入的 H、W、stride 均为动态。</p>
<ul>
<li>Resizer 输入的 ​<strong>HW 动态</strong>​，是因为原始输入的大小可以是任意的；</li>
<li>Pyramid/Resizer 输入的​<strong>​ stride 动态</strong>​，可以理解为是支持 ​<strong>Crop 功能</strong>​，详细内容可参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Fbasic_sample.html%23crop" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/runtime/basic_sample.html#crop" ref="nofollow noopener noreferrer">统一计算平台-模型推理开发-基础示例包使用说明-advanced_samples-crop</a>》</li>
</ul>
<h3 data-id="heading-31">8.4 非图像 tensor 内存对齐</h3>
<p>对于非图像 tensor，征程 6B 要求 128 对齐，征程 6EM 要求内存 64 对齐，征程 6PH 要求 256 对齐。如上图所示，模型输出节点虽然 stride[0] 为 4000，但需要申请的 BPU 内存大小（aligned byte size）为 4096，即为 128 对齐的结果。</p>
<p>在模型实际部署中，非图像输入/输出节点所需申请的内存大小（ aligned byte size）均可从模型节点属性的结构体中读取到（<code>hbDNNTensorProperties</code>），因此无需特别关注。</p>
<h3 data-id="heading-32">8.5 图像 tensor 跨距对齐</h3>
<p>征程 6EMB 对于 Pyramid/Resizer 模型的图像输入，要求 W32 对齐，征程 6PH 要求 W64 对齐。若您有 征程 6 不同架构平台迁移的场景，请注意跨距对齐要求的差异。</p>
<p>部署代码建议您避免 hard code，推荐基于模型节点属性中的 validShape（张量有效内容尺寸）和 stride（张量各维度步长）进行解析和使用。</p>
<h4 data-id="heading-33">8.5.1 Pyramid 输入</h4>
<p>Pyramid 输入 tensor 准备的参考代码如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">hbDNNTensor *input = input_tensor;
for (int i = 0; i &lt; input_count; i++) {
HB_CHECK_SUCCESS(
    hbDNNGetInputTensorProperties(&amp;input[i].properties, dnn_handle, i),
    "hbDNNGetInputTensorProperties failed");
    
    auto dim_len = input[i].properties.validShape.numDimensions;    // 获取维度信息
    for (int32_t dim_i = dim_len - 1; dim_i &gt;= 0; --dim_i) {
      if (input[i].properties.stride[dim_i] == -1) {                // stride=-1即为动态
        auto cur_stride =                                           // 计算当前维度stride
            input[i].properties.stride[dim_i + 1] *
            input[i].properties.validShape.dimensionSize[dim_i + 1];
        input[i].properties.stride[dim_i] = ALIGN_32(cur_stride);   // 32对齐
      }
    }

    int input_memSize = input[i].properties.stride[0] *             // 计算内存大小
                        input[i].properties.validShape.dimensionSize[0];
    HB_CHECK_SUCCESS(hbUCPMallocCached(&amp;input[i].sysMem[0], input_memSize, 0),
                     "hbUCPMallocCached failed");
    
    const char *input_name;
    HB_CHECK_SUCCESS(hbDNNGetInputName(&amp;input_name, dnn_handle, i),    // 获取节点名称
                     "hbDNNGetInputName failed");
}
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-Plain" lang="Plain">ucp_tutorial/dnn/basic_samples/code/00_quick_start/resnet_nv12/src/main.cc
</code></pre>
<p>​<strong>注意</strong>​：</p>
<p>视频通路上的金字塔硬件，其输出层支持配置 y、uv 的 stride，但仅要求 W16 对齐，若数据需要喂给 BPU 推理模型，建议直接按 BPU 的跨距对齐要求来配置。金字塔硬件的更多信息请参考系统软件用户手册。</p>
<h4 data-id="heading-34">8.5.2 Resizer 输入</h4>
<p>Resizer 输入的 H、W 也是动态的，因此需要设置为原图尺寸，并计算好 W32 对齐的 Stride；ROI 作为模型输入节点，也需要对其进行赋值。以下为参考代码：</p>
<pre><code class="hljs language-Plain" lang="Plain">#define ALIGN(value, alignment) (((value) + ((alignment)-1)) &amp; ~((alignment)-1))
#define ALIGN_32(value) ALIGN(value, 32)

int prepare_image_tensor(const std::vector&lt;hbUCPSysMem&gt; &amp;image_mem, int input_h,
                         int input_w, hbDNNHandle_t dnn_handle,
                         std::vector&lt;hbDNNTensor&gt; &amp;input_tensor) {
  // 准备Y、UV输入tensor
  for (int i = 0; i &lt; 2; i++) {
    HB_CHECK_SUCCESS(hbDNNGetInputTensorProperties(&amp;input_tensor[i].properties,
                                                   dnn_handle, i),
                     "hbDNNGetInputTensorProperties failed");
    // auto w_stride = ALIGN_32(input_w);
    // int32_t y_mem_size = input_h * w_stride;
    input_tensor[i].sysMem[0] = image_mem[i];

    // 配置原图大小，NHWC
    input_tensor[i].properties.validShape.dimensionSize[1] = input_h;
    input_tensor[i].properties.validShape.dimensionSize[2] = input_w;
    if (i == 1) {
      // UV输入大小为Y的1/2
      input_tensor[i].properties.validShape.dimensionSize[1] /= 2;
      input_tensor[i].properties.validShape.dimensionSize[2] /= 2;
    }

    // stride满足32对齐
    input_tensor[i].properties.stride[1] =
        ALIGN_32(input_tensor[i].properties.stride[2] *
                 input_tensor[i].properties.validShape.dimensionSize[2]);
    input_tensor[i].properties.stride[0] =
        input_tensor[i].properties.stride[1] *
        input_tensor[i].properties.validShape.dimensionSize[1];
  }
  return 0;
}

// 准备roi输入tensor
int prepare_roi_tensor(const hbUCPSysMem *roi_mem, hbDNNHandle_t dnn_handle,
                       int32_t roi_tensor_id, hbDNNTensor *roi_tensor) {
  HB_CHECK_SUCCESS(hbDNNGetInputTensorProperties(&amp;roi_tensor-&gt;properties,
                                                 dnn_handle, roi_tensor_id),
                   "hbDNNGetInputTensorProperties failed");
  roi_tensor-&gt;sysMem[0] = *roi_mem;
  return 0;
}

int prepare_roi_mem(const std::vector&lt;hbDNNRoi&gt; &amp;rois,
                    std::vector&lt;hbUCPSysMem&gt; &amp;roi_mem) {
  auto roi_size = rois.size();
  roi_mem.resize(roi_size);
  for (auto i = 0; i &lt; roi_size; ++i) {
    int32_t mem_size = 4 * sizeof(int32_t);
    HB_CHECK_SUCCESS(hbUCPMallocCached(&amp;roi_mem[i], mem_size, 0),
                     "hbUCPMallocCached failed");
    int32_t *roi_data = reinterpret_cast&lt;int32_t *&gt;(roi_mem[i].virAddr);
    roi_data[0] = rois[i].left;
    roi_data[1] = rois[i].top;
    roi_data[2] = rois[i].right;
    roi_data[3] = rois[i].bottom;
    hbUCPMemFlush(&amp;roi_mem[i], HB_SYS_MEM_CACHE_CLEAN);
  }
  return 0;
}
</code></pre>
<p>示例：</p>
<pre><code class="hljs language-Plain" lang="Plain">ucp_tutorial/dnn/basic_samples/code/02_advanced_samples/roi_infer/src/roi_infer.cc
</code></pre>
<h3 data-id="heading-35">8.6 小模型批量处理功能</h3>
<p>由于 BPU 是资源独占式硬件，所以对于 Latency 很小的模型而言，其框架调度开销占比会相对较大。在 征程 6 平台，UCP 支持通过复用 task_handle 的方式，将多个小模型任务一次性下发，全部执行完成后再一次性返回，从而可将 N 次框架调度开销合并为 1 次，以下为参考代码：</p>
<pre><code class="hljs language-Plain" lang="Plain">// 获取模型指针并存储
std::vector&lt;hbDNNHandle_t&gt; model_handles;

// 准备各个模型的输入输出，准备过程省略
std::vector&lt;std::vector&lt;hbDNNTensor&gt;&gt; inputs;
std::vector&lt;std::vector&lt;hbDNNTensor&gt;&gt; outputs;

// 创建任务并进行推理
{
    // 创建并添加任务，复用task_handle
    hbUCPTaskHandle_t task_handle{nullptr};
    for(size_t task_id{0U}; task_id &lt; inputs.size(); task_id++){
        hbDNNInferV2(&amp;task_handle, outputs[task_id].data(), inputs[task_id].data(), model_handles[i]);
    }
    
    // 提交任务
    hbUCPSchedParam sche_param;
    HB_UCP_INITIALIZE_SCHED_PARAM(&amp;sche_param);
    sche_param.backend = HB_UCP_BPU_CORE_ANY;
    hbUCPSubmitTask(task_handle, &amp;sche_param);
    
    // 等待任务完成
    hbUCPWaitTaskDone(task_handle, 0);
}
</code></pre>
<h3 data-id="heading-36">8.7 优先级调度/抢占</h3>
<p>UCP 支持任务优先级调度和抢占，可通过 <code>hbUCPSchedParam</code> 结构体进行配置，其中：</p>
<ul>
<li><code>priority</code> &gt; <code>customId</code> &gt; submit_time（任务提交时间）</li>
<li><code>priority</code> 支持 [0， 255]，对于模型任务而言：</li>
</ul>
<p>[0， 253] 为普通优先级，不可抢占其他任务，但在未执行时支持按优先级进行排队</p>
<p>254 为 high 抢占任务，可支持抢占普通任务</p>
<p>255 为 urgent 抢占任务，可抢占普通任务和 high 抢占任务</p>
<p>可被中断抢占的低优任务，需要在模型编译阶段配置 <code>max_time_per_fc</code> 参数拆分模型指令</p>
<ul>
<li>其他 backend 任务，priority 支持 [0， 255]，但不支持抢占，可以认为都是普通优先级</li>
</ul>
<h3 data-id="heading-37">8.8 X86 仿真</h3>
<p>征程 6 工具链在 X86 端支持 hbm 指令仿真，但效率非常低，所以更推荐使用 quantized.bc 模型进行推理，其定点部分和 hbm 数值二进制一致，浮点部分可能存在架构本身差异，但通常对精度影响可忽略不计。</p>
<p>征程 6B 平台 X86 仿真需要配置如下环境变量，默认架构为"nash-m"：</p>
<p>export HB_UCP_SIM_PLATFORM_TYPE=nash-b</p>
<h4 data-id="heading-38">8.8.1 推理 quantized.bc</h4>
<p><strong>Python 推理：</strong></p>
<p>quantized.bc 在 X86 端的推理，可以使用 <code>horizon_tc_ui</code> 包封装的 <code>HBRuntime</code> 接口，具体可见用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fptq%2Fptq_tool%2Fhbruntime.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ptq/ptq_tool/hbruntime.html" ref="nofollow noopener noreferrer">训练后量化-PTQ 转换工具-HBRuntime 推理库</a>》，参考代码如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">import numpy as np
from horizon_tc_ui.hb_runtime import HBRuntime

sess = HBRuntime("quantized.bc")
input_names = sess.input_names
output_names = sess.output_names

data1 = np.load("input1.npy")
data2 = np.load("input2.npy")
input_feed = {input_names[0]: data1, input_names[1]: data2}

output = sess.run(output_names, input_feed)
</code></pre>
<p>quantized.bc 也可以直接调用其 func 的 feed 接口进行推理，其输入格式也为 dict，value 支持 torch.tensor 和 np.array 两种类型，输出格式与输入格式保持一致。参考代码如下：</p>
<pre><code class="hljs language-Plain" lang="Plain">import numpy as np
from hbdk4.compiler import load

hbir = load("quantized.bc")
func = hbir[0]

data1 = np.load("input1.npy")
data2 = np.load("input2.npy") 
input_feed = {inputs[0].name: data1, inputs[1].name: data2}
hbir_outputs = func.feed(input_feed)
</code></pre>
<p><strong>C++ 推理：</strong></p>
<p>quantized.bc 的 C++ 推理接口复用 hbm UCP 推理接口，仅 so 动态库需要替换成 X86 版本即可。 您也可以在 X86 端使用 <code>hrt_model_exec</code> 工具对 quantized.bc 进行模型信息查看和单帧推理。</p>
<h4 data-id="heading-39">8.8.2 推理 hbm</h4>
<p>由于 X86 端 hbm 推理为指令仿真，运行速度非常慢，因此工具链提供了 <code>hbm_infer</code> 工具以便用户在服务器端给直连的开发板下发推理任务。本文只介绍最简单的单进程使用方式，多进程、多阶段模型输入输出的传输优化，以及统计模型推理、网络传输耗时等功能请参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oe.horizon.auto%2Fguide%2Fucp%2Fruntime%2Ftool_introduction%2Fhbm_infer.html" target="_blank" title="https://docs.oe.horizon.auto/guide/ucp/runtime/tool_introduction/hbm_infer.html" ref="nofollow noopener noreferrer">hbm_infer 工具介绍</a>》。</p>
<pre><code class="hljs language-Plain" lang="Plain"># hbm也可传入一个list，推理时通过指定model_name来选择推理哪个模型，推理所用的.so即可只传输一次
hbm_model = HbmRpcSession(
    host="xx.xx.xx.xx",
    local_hbm_path="xx.hbm", 
)

# 打印模型输入输出信息
hbm_model.show_input_output_info()

# 准备输入数据
input_data = {
    'img': torch.ones((1, 3, 224, 224), dtype=torch.int8)
}

# 执行推理并返回结果
# 若传入的是list，需要正确指定model_name
# output_data = hbm_model(input_data, model_name=model_name)
output_data = hbm_model(input_data) 

print([output_data[k].shape for k in output_data])

# 关闭server
hbm_model.close_server()
</code></pre>
<h2 data-id="heading-40">9.UCP 视觉处理/高性能算子</h2>
<p>除模型推理外，UCP 还提供了视觉处理和高性能算子两大方向的多种算子接口，可支持诸如 Remap、Jpeg、H264/265、FFT/IFF 等功能，这些算子底层是基于地平线 SOC 上不同硬件 IP 进行的封装，并提供统一的调用接口。</p>
<p>更多信息可参考用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fucp_overview.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/ucp_overview.html" ref="nofollow noopener noreferrer">统一计算平台</a>》的相关章节。</p>
<p><strong>注意：</strong></p>
<ol>
<li>板端实际部署时，ISP 到 Pyramid 的视频通路不建议使用 UCP，无法实现数据 Online，建议直接调用底软接口进行功能实现。</li>
<li>基于 DSP Backend 实现的 HPL 算子，在 征程 6B 平台仅会提供 征程 6EM 上 Q8 实现的源码，如需在 征程 6B 上使用 HPL 算子，需要您自行适配 V130 并编译镜像。VP 算子和 SLAM 等 征程 6EM 上已有的 Q8 DSP sample，将在 征程 6B 后续正式版本中提供 V130 版本。</li>
</ol>
<h2 data-id="heading-41">10.UCP 自定义算子（DSP）</h2>
<p>为了简化用户开发，UCP 封装了一套基于 RPC 的开发框架，来实现 CPU 对 DSP 的功能调用，但具体 DSP 算子实现仍是调用 Cadence 接口去做开发。总体来说可分为三个步骤：</p>
<p>使用 Cadence 提供的工具及资料完成算子开发；</p>
<pre><code class="hljs language-Plain" lang="Plain">int test_custom_op(void *input, void *output, void *tm) {
  // custom impl
  return 0;
}
</code></pre>
<p>DSP 侧通过 UCP 提供的 API 注册算子，编译带自定义算子的镜像；</p>
<pre><code class="hljs language-Plain" lang="Plain">// dsp镜像中注册自定义算子
hb_dsp_register_fn(cmd, test_custom_op, latency)
</code></pre>
<p>ARM 侧通过 UCP 提供的算子调用接口，完成开发板上的部署使用。</p>
<pre><code class="hljs language-Plain" lang="Plain">// 将输入输出的hbUCPSysMem映射为DSP可访问的内存地址
hbUCPSysMem in;
hbUCPMalloc(&amp;in, in_size, 0)
hbDSPAddrMap(&amp;in, &amp;in)

hbUCPSysMem out;
hbUCPMalloc(&amp;out, out_size, 0)
hbDSPAddrMap(&amp;out, &amp;out)

// 创建并提交DSP任务
hbUCPTaskHandle_t taskHandle{nullptr};
hbDSPRpcV2(&amp;taskHandle, &amp;in, &amp;out, cmd)

hbUCPSchedParam ctrl_param;
HB_UCP_INITIALIZE_SCHED_PARAM(&amp;ctrl_param);
ctrl_param.backend = HB_UCP_DSP_CORE_ANY;
hbUCPSubmitTask(task_handle, &amp;ctrl_param);

// 等待任务完成
hbUCPWaitTaskDone(task_handle, 0);
</code></pre>
<p>更多信息可见用户手册《<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.oe.horizon.auto%2Fguide%2Fucp%2Fplugin%2Fdsp_develop%2Fdsp_intro.html" target="_blank" title="https://doc.oe.horizon.auto/guide/ucp/plugin/dsp_develop/dsp_intro.html" ref="nofollow noopener noreferrer">统一计算平台-自定义算子-DSP 算子开发</a>》。</p>
<h2 data-id="heading-42">11.性能监测工具</h2>
<p>征程 6 平台 BPU、DSP 都是独占的硬件资源，任务一旦提交就会独占推理，UCP 侧仅能通过 <code>hrt_ucp_monitor</code> 工具去监测其硬件占用率（采样频率支持配置 [10， 1000]，默认 500），并且能查看到 DDR 内存占用情况。</p>
<p><img src="http://openwrite.cn/uploads/19742/59443/5a9ecb7e-7ed0-4d6e-a605-da2b9e42c012.png" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-43">12.QNX 带来的功能裁剪</h2>
<ol>
<li><strong>UCP Service （中继模式）</strong>：
UCP 框架支持两种主要工作模式：直连模式、中继模式。系统默认运行在直连模式下，在中继模式下，UCP 将支持跨进程任务优先级的统一调度。但 QNX 上跨进程调度的模型性能较差，不满足使用需求，故功能移除。</li>
<li><strong>UCP Trace</strong>： UCP trace 通过在 UCP 执行的关键路径上嵌入 trace 记录，提供深入分析 UCP 应用程序调度逻辑的能力。在出现性能异常时，可以通过分析 UCP trace，快速找到异常发生的时间点。但 QNX 底软不支持 Trace 功能，故移除。</li>
<li><strong>DEB 部署包</strong>： 用于简化板端部署，可通过自动安装所需的二进制文件和相关依赖库，快速设置并运行 UCP 相关的应用程序，具体包括：<code>ucp_service</code> 和 <code>hrt_ucp_monitor</code>。但鉴于 <code>ucp_service</code> 不支持，该功能也移除。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[凌晨突袭！GPT-5.3-Codex手撕代码，OpenAI让AI开始造AI了]]></title>    <link>https://juejin.cn/post/7603567912592244763</link>    <guid>https://juejin.cn/post/7603567912592244763</guid>    <pubDate>2026-02-06T12:18:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592244763" data-draft-id="7603567912592228379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="凌晨突袭！GPT-5.3-Codex手撕代码，OpenAI让AI开始造AI了"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-06T12:18:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            凌晨突袭！GPT-5.3-Codex手撕代码，OpenAI让AI开始造AI了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:18:49.000Z" title="Fri Feb 06 2026 12:18:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在这个2026年2月的寒冷清晨，科技圈的很多开发者大概又是被手机震醒的。</p>
<p>就在几个小时前，硅谷上演了一场经典的“神仙打架”。Anthropic前脚刚发布Claude Opus 4.6，OpenAI后脚就甩出了GPT-5.3-Codex。相差不过几分钟，但这不仅仅是巧合，更是两条路线的正面硬刚。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fdfasgfdg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/dfasgfdg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64a23f1d5ea94e17ab0ba545b561ebe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=wNOaZHJxg%2F6CiXtoHR11MneXyxs%3D" alt="dfasgfdg" loading="lazy"/></a></p>
<p>如果你还以为这只是又一次常规的模型升级，只是写代码稍微快一点，那你就大错特错了。根据目前流出的各路评测和媒体报道，OpenAI这次没打算和你聊“聊天机器人”，他们直接把“全能智能体”摆上了桌面。</p>
<h3 data-id="heading-0">不只是写代码，它是你的硅谷合伙人</h3>
<p>很长一段时间里，我们在使用Copilot或者ChatGPT时，心里是有预期的：它是个助手，我得盯着它，因为这货随时可能胡言乱语。</p>
<p>但GPT-5.3-Codex的定位彻底变了。它不再满足于当你敲代码时的自动补全工具，它想接管你的整个工作流。</p>
<p>现在的它，能从头到尾干完一套活：写代码、自己调试、跑单元测试、去终端环境里配置服务器，甚至最后还能帮你把产品文档（PRD）和PPT写好。以前我们说AI是“副驾驶”，现在的感觉是，它想坐主驾驶位，你只要在旁边喝咖啡喊口号就行。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fadgdfg-1024x566.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/adgdfg-1024x566.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6aabe2dd9394ec0b6589bb5ef1ae38f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=9uwL013SoX6Guj0tCSaXh%2FDye7c%3D" alt="adgdfg" loading="lazy"/></a></p>
<p>这种底气来自哪里？看看数据就知道了。</p>
<p>在Terminal-Bench 2.0这个专门测试终端操作和环境配置的考场上，GPT-5.3-Codex拿下了77.3%的高分。作为对比，上一代还在64%徘徊。这意味着在面对那些让人头秃的黑框命令行时，它的表现已经不仅是“能用”，而是“精通”。</p>
<p>更杀人诛心的是，有数据显示，在这一项上它比隔壁同期发布的Claude Opus 4.6高出了将近12个百分点。虽然Claude在长文本推理上依然强悍，但在这种还要动手干脏活累活的工程能力上，OpenAI这次确实秀了一把肌肉。</p>
<h3 data-id="heading-1">快，而且省</h3>
<p>对于企业主和开发者来说，性能强固然好，但“贵”是原罪。</p>
<p>这次更新最让我感到意外的，不是它能考多少分，而是它的效率。根据测试，GPT-5.3-Codex在完成同等复杂度的任务时，消耗的Token数量直接砍半。与此同时，推理速度提升了25%。</p>
<p>这意味着什么？意味着它的废话变少了，直击痛点的能力变强了。以前你得跟AI来回拉扯十几个回合才能修好的Bug，现在可能三两下就解决了。这不仅仅是省钱，更是省命——毕竟谁也不想在大半夜陪AI玩猜谜游戏。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fagdfgfdgh.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/agdfgfdgh.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d745f35db4541be884def24363679bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=1c0QZ4OsHu7gjR4STWnTgAriGPY%3D" alt="agdfgfdgh" loading="lazy"/></a></p>
<p>还有一个非常人性化的改进：<strong>实时引导</strong>。以前的任务是“离手不管”，你发了指令就得干等结果。现在你可以像指导坐在你工位旁的实习生一样，中间随时插嘴：“不对，这个方向错了，换个库试试。”这种交互模式的改变，才是真正让AI融入团队的关键。</p>
<p><strong>细思极恐的“自我迭代”</strong></p>
<p>整场发布会最让我起鸡皮疙瘩的，其实是OpenAI轻描淡写透露的一句话：</p>
<h3 data-id="heading-2">这是首个参与了自身开发过程的模型。</h3>
<p>没错，OpenAI的工程师们在训练GPT-5.3-Codex时，已经在使用它的早期版本来调试训练流程、管理部署甚至诊断问题了。</p>
<p>这听起来很像科幻电影的开场白，AI开始通过自我递归来加速进化。虽然目前还需要人类把控方向，但这层窗户纸捅破后，技术迭代的速度可能会超出我们的线性认知。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Frthfgfg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/rthfgfg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebf86829561649b19d34d702cf0a604a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=l1e0yYeB%2F4ppf4I3JXTnSDnp5mo%3D" alt="rthfgfg" loading="lazy"/></a></p>
<p>当然，能力越强，风险越大。OpenAI这次也很谨慎，因为这东西的网络攻击能力也被评定为“高”。所以API接口暂时没开，目前只有ChatGPT的付费用户（Plus、Team、Enterprise）可以通过Codex应用、命令行工具（CLI）或IDE插件尝鲜。为了安抚安全界，他们还专门掏了1000万美元搞防御研究。</p>
<h3 data-id="heading-3">写在最后</h3>
<p>看着手中这份新鲜出炉的报告，我的感觉很复杂。</p>
<p>一方面，作为工具使用者，GPT-5.3-Codex带来的生产力释放是诱人的。它能帮我们搞定那些繁琐的文档、讨厌的环境配置和无穷无尽的单元测试。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdffgdfg.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdffgdfg.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fcb3aadcd13456eb61c44223fe99ba7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770985128&amp;x-signature=J3YR3XL549SN0wYvFKShNxM2sAw%3D" alt="asdffgdfg" loading="lazy"/></a></p>
<p>另一方面，作为从业者，我们也清晰地看到了门槛的提升。当AI已经能熟练操作操作系统、能自我Debug甚至能优化自己的时候，“写代码”这项技能本身的护城河，正在被以前所未有的速度填平。</p>
<p>2026年的春天，比以往来得更早一些，也更猛烈一些。各位，准备好迎接这位新同事了吗？</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Debian 12 环境下 PostgreSQL 15 部署与安全配置]]></title>    <link>https://juejin.cn/post/7603321550247641138</link>    <guid>https://juejin.cn/post/7603321550247641138</guid>    <pubDate>2026-02-06T12:22:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247641138" data-draft-id="7603321550247624754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Debian 12 环境下 PostgreSQL 15 部署与安全配置"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T12:22:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Debian 12 环境下 PostgreSQL 15 部署与安全配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:22:24.000Z" title="Fri Feb 06 2026 12:22:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1. 系统安装</p>
<p>Debian 12 官方仓库已包含 PostgreSQL 15。</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install postgresql postgresql<span class="hljs-operator">-</span>contrib <span class="hljs-operator">-</span>y
</code></pre>
<p>2. 防火墙配置 (UFW)</p>
<p>确保系统防火墙放行数据库默认端口 <strong>5432</strong>。</p>
<pre><code class="hljs language-bash" lang="bash">sudo ufw allow 5432/tcp
sudo ufw reload
</code></pre>
<p>3. 数据库权限管理</p>
<p>直接在终端调用 <code>psql</code> 管理器创建环境：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 以 postgres 管理员身份进入</span>
sudo -u postgres psql

<span class="hljs-comment"># --- SQL 执行区域 ---</span>
<span class="hljs-comment"># 1. 创建用户并设密码</span>
CREATE USER myuser WITH PASSWORD 'your_password'<span class="hljs-comment">;</span>

<span class="hljs-comment"># 2. 创建数据库并指定归属</span>
CREATE DATABASE mydatabase OWNER myuser<span class="hljs-comment">;</span>

<span class="hljs-comment"># 3. 授予所有权限</span>
GRANT ALL PRIVILEGES ON DATABASE mydatabase TO myuser<span class="hljs-comment">;</span>

<span class="hljs-comment"># 退出</span>
\q
</code></pre>
<p>4. 开启外部连接 (核心配置)</p>
<p>默认情况下，PostgreSQL 只允许本机 <code>127.0.0.1</code> 访问。若要远程连接，需修改两个配置文件。</p>
<p>A. 修改监听地址</p>
<p>使用 GNU Nano 编辑器 修改主配置：</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/postgresql/15/main/postgresql.conf
</code></pre>
<p>找到以下行，取消注释并将 <code>localhost</code> 改为 <code>*</code>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">listen_addresses</span> = <span class="hljs-string">'*'</span>
</code></pre>
<p>B. 修改访问策略</p>
<p>修改基于主机的身份验证文件：</p>
<pre><code class="hljs language-bash" lang="bash">sudo nano /etc/postgresql/15/main/pg_hba.conf
</code></pre>
<p>在文件末尾添加以下行（允许所有 IP 使用 MD5 密码认证）：</p>
<pre><code class="hljs language-css" lang="css">host    <span class="hljs-attribute">all</span>             <span class="hljs-attribute">all</span>             <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">0</span>               md5
</code></pre>
<p>C. 重启服务</p>
<pre><code class="hljs">sudo systemctl restart postgresql
</code></pre>
<p><strong>建议步骤：</strong> 你现在可以使用 <strong>Navicat</strong> 或 <strong>DBeaver</strong> 尝试连接。如果连接失败，请检查是否漏掉了 <strong>5432</strong> 端口的放行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin中的JvmPackageName注解]]></title>    <link>https://juejin.cn/post/7603563317040218175</link>    <guid>https://juejin.cn/post/7603563317040218175</guid>    <pubDate>2026-02-06T12:26:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040218175" data-draft-id="7603581886149427254" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin中的JvmPackageName注解"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-02-06T12:26:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin中的JvmPackageName注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:26:08.000Z" title="Fri Feb 06 2026 12:26:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmPackageName 是 Kotlin 中的一个文件级注解（File-level Annotation），用于自定义 Kotlin 文件中的顶层声明（函数、属性等）在 JVM 平台上生成的类所在的包名。</p>
<p>其核心作用是突破 Kotlin 文件 package 语句的限制，让同一文件中的顶层声明在 JVM 中生成到不同的包路径下，从而更灵活地组织代码结构或适配已有的 Java 包结构。</p>
<h2 data-id="heading-0">背景与问题场景</h2>
<p>Kotlin 的顶层声明（如顶层函数、属性）在编译为 JVM 字节码时，默认会被放入一个与 Kotlin 文件 package 语句一致的类中（类名由 @file:JvmName 或默认规则 文件名 + "Kt" 决定）。例如：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: com/example/utils/StringUtils.kt</span>
<span class="hljs-keyword">package</span> com.example.utils  <span class="hljs-comment">// Kotlin 文件的包名</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()
</code></pre>
<p>编译后，该函数的 JVM 类为 com.example.utils.StringUtilsKt（假设未使用 @file:JvmName），包名与 Kotlin 文件的 package 完全一致。</p>
<p>但实际开发中可能需要：</p>
<p>• 让 Kotlin 顶层声明生成的 JVM 类放入与 Kotlin 文件 package 不同的路径（如适配已有的 Java 包结构）；</p>
<p>• 同一 Kotlin 文件中的不同顶层声明生成到不同的 JVM 包（尽管这种情况较少见）。</p>
<p>此时，默认的包名规则无法满足需求，@JvmPackageName 应运而生。</p>
<h2 data-id="heading-1">核心作用</h2>
<p>通过 @JvmPackageName 注解，可以显式指定当前 Kotlin 文件中的顶层声明在 JVM 中生成的类的包名，覆盖 Kotlin 文件 package 语句的默认行为。</p>
<h2 data-id="heading-2">使用方式与示例</h2>
<h3 data-id="heading-3">基本用法：覆盖文件包名</h3>
<p>在 Kotlin 文件顶部使用 @file:JvmPackageName 注解，指定目标 JVM 包名（需包含完整包路径）。该注解需放在 package 语句之前。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: src/kotlin/com/example/utils/StringUtils.kt</span>
<span class="hljs-meta">@file:JvmPackageName</span>(<span class="hljs-string">"com.example.java.utils"</span>)  <span class="hljs-comment">// 指定 JVM 包名为 com.example.java.utils</span>
<span class="hljs-keyword">package</span> com.example.utils  <span class="hljs-comment">// Kotlin 文件的包名（仅为 Kotlin 代码的组织，不影响 JVM 包名）</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isEmpty()

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isBlank</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.isBlank()
</code></pre>
<p>编译后效果：</p>
<p>Kotlin 顶层函数 isEmpty 和 isBlank 会被编译到 JVM 类 com.example.java.utils.StringUtilsKt（类名仍由默认规则或 @file:JvmName 决定），而非 com.example.utils.StringUtilsKt。</p>
<p>Java 调用方式：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 直接通过目标 JVM 包名访问，无需关心 Kotlin 文件的 package 语句</span>
<span class="hljs-keyword">import</span> com.example.java.utils.StringUtilsKt;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">empty</span> <span class="hljs-operator">=</span> StringUtilsKt.isEmpty(<span class="hljs-string">"test"</span>);
        <span class="hljs-type">boolean</span> <span class="hljs-variable">blank</span> <span class="hljs-operator">=</span> StringUtilsKt.isBlank(<span class="hljs-string">"  "</span>);
    }
}
</code></pre>
<h3 data-id="heading-4">与 @file:JvmName 配合使用</h3>
<p>@JvmPackageName 通常与 @file:JvmName 配合使用，同时自定义 JVM 类的包名和类名，完全控制顶层声明在 JVM 中的定位。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File: src/kotlin/utils/LegacyUtils.kt</span>
<span class="hljs-meta">@file:JvmPackageName</span>(<span class="hljs-string">"com.legacy.api"</span>)       <span class="hljs-comment">// 自定义 JVM 包名</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"OldStringUtils"</span>)             <span class="hljs-comment">// 自定义 JVM 类名（替代默认的 LegacyUtilsKt）</span>
<span class="hljs-keyword">package</span> com.kotlin.<span class="hljs-keyword">internal</span>                  <span class="hljs-comment">// Kotlin 文件的包名（仅用于 Kotlin 代码组织）</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trimAndUpper</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span> = str.trim().uppercase()
</code></pre>
<p>编译后效果：</p>
<p>函数 trimAndUpper 对应的 JVM 类为 com.legacy.api.OldStringUtils（包名由 @JvmPackageName 指定，类名由 @file:JvmName 指定）。</p>
<p>Java 调用方式：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.legacy.api.OldStringUtils;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> OldStringUtils.trimAndUpper(<span class="hljs-string">"  hello  "</span>); <span class="hljs-comment">// 输出 "HELLO"</span>
    }
}
</code></pre>
<h2 data-id="heading-5">关键注意事项</h2>
<ol>
<li>
<p>注解位置限制：@file:JvmPackageName 是文件级注解，必须放在 Kotlin 文件的最顶部（package 语句之前），否则会编译报错。</p>
</li>
<li>
<p>包名格式要求：value 参数需传入完整的 JVM 包名（如 "com.example.utils"），不能省略包路径或使用相对路径。</p>
</li>
<li>
<p>与 package 语句的关系：Kotlin 文件的 package 语句仅用于 Kotlin 代码内部的组织（如导入、可见性），不影响 JVM 类的包名；@JvmPackageName 才是 JVM 包名的决定因素。</p>
</li>
<li>
<p>避免包名冲突：自定义的 JVM 包名不能与项目中其他类（包括 Java 类和 Kotlin 类）的包名重复，否则会导致类加载冲突。</p>
</li>
<li>
<p>适用范围：@JvmPackageName 仅对当前文件的顶层函数、顶层属性生效，类、对象、伴生对象等声明仍遵循其自身的 package 语句（或 @JvmPackageName 若在类上标注时的规则，不过类通常不使用此注解）。</p>
</li>
</ol>
<h2 data-id="heading-6">典型应用场景</h2>
<p>• 适配已有 Java 包结构：当需要将 Kotlin 编写的工具函数集成到已有的 Java 项目中，且 Java 项目要求工具类必须位于特定包路径（如 com.company.common.utils）时，可用 @JvmPackageName 强制 Kotlin 顶层声明生成到该路径。</p>
<p>• 隔离 Kotlin 与 Java 包结构：Kotlin 项目希望内部代码按一种包结构组织（如 com.kotlin.feature），但对外提供的 JVM 接口需按另一种结构暴露（如 com.api.v1），此时可通过 @JvmPackageName 解耦。</p>
<p>• 避免类名冲突：当多个 Kotlin 文件因文件名相似导致默认生成的 JVM 类名冲突时（如 StringUtils.kt 和 StringUtils_Ext.kt 均生成 StringUtilsKt 和 StringUtils_ExtKt），可通过 @JvmPackageName 将它们分配到不同的 JVM 包中。</p>
<h2 data-id="heading-7">总结</h2>
<p>@JvmPackageName 是 Kotlin 为 JVM 平台提供的精细化包名控制工具，通过覆盖 Kotlin 文件 package 语句的默认行为，让顶层声明在 JVM 中生成到任意指定的包路径。它与 @file:JvmName 配合使用时，能完全自定义 JVM 类的定位（包名+类名），是跨语言开发中优化代码结构的重要手段。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin中的JvmField注解]]></title>    <link>https://juejin.cn/post/7603352117640003593</link>    <guid>https://juejin.cn/post/7603352117640003593</guid>    <pubDate>2026-02-06T12:41:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603352117640003593" data-draft-id="7603376587652546610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin中的JvmField注解"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T12:41:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin中的JvmField注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:41:47.000Z" title="Fri Feb 06 2026 12:41:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmField 是 Kotlin 中的一个注解（Annotation），用于将 Kotlin 类中的属性（Property）直接暴露为 JVM 平台的字段（Field），而不是默认的 getter/setter 方法。</p>
<p>其核心作用是消除 Kotlin 属性访问器与 Java 字段访问之间的差异，让 Kotlin 属性在 Java 中调用时更符合 Java 开发者的直觉（直接访问字段而非方法）。</p>
<h2 data-id="heading-0">背景：Kotlin 属性的默认 JVM 表现</h2>
<p>在 Kotlin 中，属性（如 var name: String 或 val age: Int）本质上由以下部分组成：</p>
<p>• 幕后字段（Backing Field）：存储属性值的实际字段（仅在需要时生成）。</p>
<p>• 访问器（Accessor）：getter（读取值）和 setter（设置值，仅 var 有）方法。</p>
<p>默认情况下，Kotlin 属性在 JVM 中会被编译为：</p>
<p>• 对于 val（只读属性）：生成一个 getXxx() 方法（如 getName()）。</p>
<p>• 对于 var（可变属性）：生成 getXxx() 和 setXxx() 方法（如 getName() 和 setName()）。</p>
<p>这种设计符合 Kotlin 的封装原则，但与 Java 中直接访问字段的习惯（如 obj.name）不一致。此时，@JvmField 注解可改变这一默认行为。</p>
<h2 data-id="heading-1">@JvmField 的作用</h2>
<p>@JvmField 的核心目标是让 Kotlin 属性在 JVM 中表现为一个公共字段（Public Field），而非 getter/setter 方法。具体表现为：</p>
<p>• Java 代码可直接通过 对象.字段名 访问属性值（如同访问 Java 类的公共字段）。</p>
<p>• 不再生成默认的 getter/setter 方法（除非显式定义）。</p>
<h2 data-id="heading-2">使用场景与示例</h2>
<h3 data-id="heading-3">标注在类的属性上（非私有、非 const）</h3>
<p>@JvmField 可用于标注类的普通属性（val 或 var），使其暴露为 JVM 字段。需注意：属性必须是非私有（public 或包级可见）且非 const（const val 本身已生成静态字段，无需 @JvmField）。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-comment">// 普通 var 属性：默认生成 getName()/setName()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// 暴露为 JVM 字段（无 getter/setter）</span>
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">"Unknown"</span>
    
    <span class="hljs-comment">// 普通 val 属性：默认生成 getAge()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// 暴露为 JVM 字段（无 getter）</span>
    <span class="hljs-keyword">val</span> age: <span class="hljs-built_in">Int</span> = <span class="hljs-number">18</span>
}
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java">Java 代码可直接访问字段，无需调用 getter/setter：  
<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
user.name = <span class="hljs-string">"Alice"</span>;  <span class="hljs-comment">// 直接赋值（等效于 Kotlin 的 user.setName("Alice")）</span>
<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.name;  <span class="hljs-comment">// 直接读取（等效于 Kotlin 的 user.getName()）</span>
<span class="hljs-type">int</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> user.age;  <span class="hljs-comment">// 直接读取（等效于 Kotlin 的 user.getAge()）</span>
</code></pre>
<p>若不添加 @JvmField，Java 需通过 getter/setter 访问：</p>
<pre><code class="hljs language-java" lang="java">user.setName(<span class="hljs-string">"Alice"</span>);  <span class="hljs-comment">// 必须调用 setter</span>
<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> user.getName();  <span class="hljs-comment">// 必须调用 getter</span>
</code></pre>
<h3 data-id="heading-4">标注在伴生对象的属性上</h3>
<p>伴生对象（companion object）中的属性默认在 JVM 中属于伴生对象的 Companion 类（如 User.Companion.getStaticName()）。</p>
<p>使用 @JvmField 可将伴生对象的属性暴露为宿主类的静态字段（如同 Java 的 static final 字段）。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Kotlin 类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 普通伴生属性：默认生成 Config.Companion.getDefaultPort()</span>
        <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// 暴露为 Config.DEFAULT_PORT（静态字段）</span>
        <span class="hljs-keyword">val</span> DEFAULT_PORT: <span class="hljs-built_in">Int</span> = <span class="hljs-number">8080</span>
        
        <span class="hljs-comment">// const val 本身已生成静态字段（无需 @JvmField）</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> VERSION: String = <span class="hljs-string">"1.0"</span>
    }
}
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java">Java 可直接通过宿主类访问静态字段：  
<span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> Config.DEFAULT_PORT;  <span class="hljs-comment">// 直接访问（等效于 Kotlin 的 Config.DEFAULT_PORT）</span>
<span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> Config.VERSION;  <span class="hljs-comment">// const val 本身已是静态字段</span>
</code></pre>
<p>若不添加 @JvmField，Java 需通过伴生对象的 Companion 类访问：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> Config.Companion.getDefaultPort();  <span class="hljs-comment">// 需通过 Companion</span>
</code></pre>
<h3 data-id="heading-5">标注在顶层属性上</h3>
<p>顶层属性（不在任何类或对象中定义的属性）默认被编译到 文件名 + "Kt" 类中（如 AppConfig.kt 生成 AppConfigKt 类），并通过 getter/setter 访问。使用 @JvmField 可将其暴露为 文件名 + "Kt" 类的静态字段。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 文件：AppConfig.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"AppConfig"</span>) <span class="hljs-comment">// 自定义 JVM 类名为 AppConfig（可选）</span>

<span class="hljs-comment">// 顶层属性：默认生成 AppConfigKt.getBaseUrl()</span>
<span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// 暴露为 AppConfig.BASE_URL（静态字段）</span>
<span class="hljs-keyword">val</span> BASE_URL: String = <span class="hljs-string">"https://api.example.com"</span>
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java">Java 可直接通过自定义的类名访问静态字段：  
<span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> AppConfig.BASE_URL;  <span class="hljs-comment">// 直接访问（等效于 Kotlin 的 BASE_URL）</span>
</code></pre>
<p>若不添加 @JvmField，Java 需通过 AppConfigKt 类的 getter 访问：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> AppConfigKt.getBaseUrl();  <span class="hljs-comment">// 需通过 Kt 类</span>
</code></pre>
<h3 data-id="heading-6">标注在枚举类的属性上</h3>
<p>枚举常量的属性默认通过 getter 访问（如 Color.RED.getHex()）。使用 @JvmField 可将其暴露为枚举常量的字段，便于 Java 直接访问。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Color</span>(<span class="hljs-keyword">val</span> hex: String) {
    RED(<span class="hljs-string">"#FF0000"</span>),
    GREEN(<span class="hljs-string">"#00FF00"</span>);

    <span class="hljs-comment">// 枚举常量的属性：默认生成 getHex()</span>
    <span class="hljs-meta">@JvmField</span> <span class="hljs-comment">// 暴露为 RED.hex（字段）</span>
    <span class="hljs-keyword">val</span> hexCode: String = hex
}
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java">Java 可直接访问枚举常量的字段：  
<span class="hljs-type">String</span> <span class="hljs-variable">redHex</span> <span class="hljs-operator">=</span> Color.RED.hexCode;  <span class="hljs-comment">// 直接访问（等效于 Kotlin 的 Color.RED.hexCode）</span>
</code></pre>
<p>若不添加 @JvmField，Java 需通过 getter 访问：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">redHex</span> <span class="hljs-operator">=</span> Color.RED.getHexCode();  <span class="hljs-comment">// 需调用 getter</span>
</code></pre>
<h2 data-id="heading-7">关键注意事项</h2>
<ol>
<li>
<p>访问权限限制：被 @JvmField 标注的属性必须是非私有的（public 或包级可见）。私有属性（private）无法被 Java 直接访问，即使添加 @JvmField 也会被忽略（编译报错）。</p>
</li>
<li>
<p>不可与自定义访问器共存：若属性显式定义了自定义的 getter/setter（如 get() = ... 或 set(value) { ... }），则不能使用 @JvmField（编译报错）。因为 @JvmField 要求属性直接暴露为字段，而自定义访问器会覆盖默认行为，导致冲突。</p>
</li>
<li>
<p>val 与 var 的差异：</p>
<p>• val（只读属性）+ @JvmField：暴露为 JVM 的 final 字段（Java 中不可修改）。</p>
<p>• var（可变属性）+ @JvmField：暴露为 JVM 的非 final 字段（Java 中可修改）。</p>
</li>
<li>
<p>与 const val 的区别：const val 用于编译期常量（如 const val MAX_SIZE = 100），默认生成 JVM 的 public static final 字段，无需 @JvmField。@JvmField 主要用于运行时常量或非 const 属性。</p>
</li>
<li>
<p>线程安全问题：直接暴露为字段的属性（尤其是 var）在多线程环境下可能存在并发修改风险，需自行保证线程安全（如加锁或使用原子类）。</p>
</li>
</ol>
<h2 data-id="heading-8">典型应用场景</h2>
<p>• Java 互操作：当 Kotlin 类需要被 Java 频繁访问属性时（如配置类、数据模型），使用 @JvmField 可简化 Java 代码（避免调用 getter/setter）。</p>
<p>• 性能优化：直接访问字段比调用方法更快（尤其在高频场景下），适合对性能敏感的场景（如游戏引擎、实时系统）。</p>
<p>• 枚举或常量类：枚举常量的属性或配置常量通过 @JvmField 暴露为字段，更符合 Java 开发者的使用习惯。</p>
<h2 data-id="heading-9">总结</h2>
<p>@JvmField 是 Kotlin 与 JVM 平台互操作的重要注解，通过将 Kotlin 属性直接暴露为 JVM 字段，消除了 getter/setter 方法的调用开销，提升了跨语言代码的可读性和性能。合理使用 @JvmField 可使 Kotlin 代码在 Java 中调用时更自然、更高效，但需注意其使用限制（如非私有、无自定义访问器等）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[打造 GitHub 仓库智能推荐系统]]></title>    <link>https://juejin.cn/post/7603556326816120884</link>    <guid>https://juejin.cn/post/7603556326816120884</guid>    <pubDate>2026-02-06T12:41:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603556326816120884" data-draft-id="7603355275258478632" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="打造 GitHub 仓库智能推荐系统"/> <meta itemprop="keywords" content="GitHub,人工智能,开源"/> <meta itemprop="datePublished" content="2026-02-06T12:41:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gorse"/> <meta itemprop="url" content="https://juejin.cn/user/2682464100417854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            打造 GitHub 仓库智能推荐系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464100417854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gorse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:41:40.000Z" title="Fri Feb 06 2026 12:41:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>为了测试和展示 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgorse" target="_blank" title="https://github.com/gorse-io/gorse" ref="nofollow noopener noreferrer">Gorse 推荐系统</a>的基本功能，博主打造了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io" target="_blank" title="https://gitrec.gorse.io" ref="nofollow noopener noreferrer">GitRec</a>——专门为 GitHub 仓库设计的推荐系统。这个项目既可以展示 Gorse 的基本能力，也能帮助开发者们在海量的开源项目中发现有趣且有用的仓库。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io%2F%23%2F" target="_blank" title="https://gitrec.gorse.io/#/" ref="nofollow noopener noreferrer">GitRec</a> 已经运行了三年之久，但是在 2025 年针对 Gorse v0.5 进行了全面的升级和重构，本文介绍的内容均基于最新版本的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io%2F%23%2F" target="_blank" title="https://gitrec.gorse.io/#/" ref="nofollow noopener noreferrer">GitRec</a>。</p>
</blockquote>
<h2 data-id="heading-0">数据收集</h2>
<p>巧妇难为无米之炊，构建推荐系统的第一步是构造好物品、用户、反馈三种数据。</p>
<h3 data-id="heading-1">物品：GitHub 仓库</h3>
<ul>
<li><code>ItemId</code>：为了方便拼接URL，仓库名称中的<code>/</code>被替换为<code>:</code>并统一为小写。</li>
<li><code>Categories</code>：仓库的主要编程语言，用户可以使用编程语言过滤推荐结果。</li>
<li><code>Timestamp</code>：仓库的最后更新时间。</li>
<li><code>Labels</code>是由两个字段组成的JSON：
<ul>
<li><strong>话题</strong>：由仓库管理员添加的话题标签 (Topics)。</li>
<li><strong>描述的本文嵌入向量</strong>：GitRec 的一大亮点是它利用 OpenAI 的 <code>text-embedding-v3</code> 模型为每个仓库的描述（Description）生成了 512 维的向量嵌入。如果一个仓库没有描述，：GitRec 会使用 <code>gpt-5-nano</code> 大语言模型阅读其 <code>README.md</code> 文件，并生成一个单句摘要，然后再进行向量化。</li>
</ul>
</li>
</ul>
<p>以下是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgorse" target="_blank" title="https://github.com/gorse-io/gorse" ref="nofollow noopener noreferrer">Gorse 仓库</a> 在 Gorse 中的物品记录，<code>Comment</code> 字段使用仓库描述作为备注方便后台查看。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ItemId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gorse-io:gorse"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"IsHidden"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"go"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-05-24T19:41:09Z"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"embedding"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-number">-0.0913363918662071</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0.0101912319660187</span><span class="hljs-punctuation">,</span> <span class="hljs-number">-0.0689065530896187</span><span class="hljs-punctuation">,</span> <span class="hljs-number">0.0137317562475801</span><span class="hljs-punctuation">,</span> ...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"topics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"recommender-system"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"collaborative-filtering"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"go"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"knn"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"machine-learning"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Comment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Gorse open source recommender system engine"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>由于 GitHub 上的仓库数量庞大，GitRec 只收集 stars 数量超过 100 的仓库以在成本和覆盖率之间取得平衡。仓库主要由两种方式收集：</p>
<ol>
<li>每天爬取 GitHub trending 上的热门仓库。</li>
<li>接受用户反馈时，顺便将用户反馈涉及的仓库加入到物品库中。</li>
</ol>
<h3 data-id="heading-2">用户：放弃个人信息</h3>
<p>综合考虑之下，GitRec 选择不收集用户除了用户 ID 和反馈以外的任何个人信息，原因如下：</p>
<ol>
<li>GitHub 用户的个人信息非常多样化，除了公司、位置等少量结构化数据外，用户还可以在个人简介、README 文件等非结构化文本中提供信息。同时，也有非常多的用户只填写了极少量的信息甚至没有，这使得基于个人信息的推荐变得非常困难。</li>
<li>在注重隐私保护的当下，选择不收集个人信息是一个不错的选择。</li>
</ol>
<p>Gorse 中一条用户记录的<code>UserId</code>对应 GitHub 用户ID，而其他字段都为空。每当新用户登录 GitRec，系统会自动创建一条用户记录。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"UserId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zhenghaoz"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Labels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Comment"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">反馈：点赞和浏览</h3>
<p>通过 GitHub 的 API，实际上只能获取到用户对仓库的 <code>star</code> 行为，但是无法获取“已读”的行为。因此，GitRec 提供了一个浏览器插件，可以收集用户浏览仓库的记录。最终，GitRec 中的反馈定义如下：</p>
<p><strong>正向反馈</strong>：</p>
<ul>
<li><code>star</code>: 用户在 GitHub 上为一个仓库点赞。</li>
<li><code>like</code>: 用户在 GitRec 网站上::likefill::一个仓库。</li>
<li><code>read&gt;=3</code>: 用户查看一个仓库至少 3 次。</li>
</ul>
<p><strong>浏览反馈</strong>：</p>
<ul>
<li><code>read</code>: 用户查看一个仓库。</li>
</ul>
<p><code>read</code>反馈由浏览器插件收集，<code>like</code>反馈由 GitRec 网站收集，而<code>star</code>反馈通过 GitHub API 每天同步一次。<code>read</code>次数在每次用户访问仓库时累加，当次数达到 3 次时，系统会将其转换为正向反馈。</p>
<h2 data-id="heading-4">推荐流水线配置</h2>
<p>GitRec 推荐流水线的详细配置可以在仓库的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgorse-io%2Fgitrec%2Fblob%2Fmaster%2Fconfig.toml" target="_blank" title="https://github.com/gorse-io/gitrec/blob/master/config.toml" ref="nofollow noopener noreferrer">config.toml</a>文件中找到，主要内容为：</p>
<ul>
<li>非个性化推荐<code>most_starred_weekly</code>：分数由自定义公式计算，推荐本周收藏数最多的仓库。</li>
<li>物品到物品推荐<code>neighbors</code>：根据仓库描述的向量嵌入推荐相似的项目。</li>
<li>用户到物品推荐<code>neighbors</code>：推荐来自收藏仓库重叠程度较高的用户所喜欢的项目。</li>
<li>协同过滤推荐保持默认配置。</li>
</ul>
<p>排序阶段合并上述的推荐结果和最新物品后使用训练好的因子分解机进行最终排序。如果生成的推荐结果不足，会依次使用物品到物品推荐和最新物品进行补全。下图为可视化推荐流程编辑器中看到的推荐流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38fa194db8c543fd98c0e04bf48a15ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=1aVFqGD32spIpRJ%2Fj261qQ9gaz0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">用户界面和交互</h2>
<p>GitRec 通过两种方式为用户提供服务。</p>
<h3 data-id="heading-6">网站</h3>
<p>网站仿照抖音提供了一个沉浸式的仓库发现体验：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b60151aeab004f6586c541bc7d2c5cd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=bKYHMcE3%2FRMyAw94LoFpXne1xFQ%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>"发现页（Explore）</strong>：这是网站的核心功能，全屏展示仓库的 <code>README</code> 内容。你可以选择：
<ul>
<li>点击❤️按钮，这个行为会被记录为一次正向反馈。</li>
<li>点击▶️按钮，系统会将当前仓库标记为“已读”，并为你呈现下一个推荐。</li>
<li>页面上方可以选择编程语言过滤推荐结果。</li>
</ul>
</li>
<li><strong>收藏夹（Favorites）</strong>：这里包含了所有你在 GitHub 上 ⭐ 过或在 GitRec 网站上 ❤️过的仓库。</li>
</ul>
<h3 data-id="heading-7">浏览器插件</h3>
<p>浏览器插件将推荐无缝集成到 GitHub 页面中：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af5aad4cbd7412bb8c63148481d452d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR29yc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986500&amp;x-signature=%2F%2B1Xy1fGm6uOUxcjTkkrKbBWt1M%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>GitHub 主页的“探索”模块</strong>：在 GitHub 的主页，插件会注入一个“Explore repositories”模块，提供个性化的项目推荐。即使没有登录 GitRec，插件也能通过最近 <code>star</code> 的项目提供初步的个性化推荐。</li>
<li><strong>仓库页面的“相关仓库”</strong>：浏览任何一个 stars 超过 100的 GitHub 仓库时，插件会在页面右侧添加一个“Related repositories”栏目。这里会展示与当前仓库内容最相似的几个项目。</li>
<li><strong>浏览记录收集</strong>：插件会记录浏览过的仓库，并将这些信息发送回 GitRec 服务器，除此之外不会收集任何其他个人信息。</li>
</ul>
<h2 data-id="heading-8">规模和成本</h2>
<p>到 2025 年底，GitRec 的数据规模如下：</p>
<ul>
<li>超过 24 万个 GitHub 仓库</li>
<li>超过 3000 名注册用户</li>
<li>超过 30 万条用户反馈记录</li>
</ul>
<p>Gorse 推荐系统以及数据库部署在一台 2 核 CPU、8GB 内存的云服务器上，花费330人民币/月。</p>
<h2 data-id="heading-9">总结</h2>
<p>GitRec 不仅仅是一个 GitHub 仓库推荐系统，更是 Gorse 推荐系统的试验场。欢迎使用 GitRec <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitrec.gorse.io" target="_blank" title="https://gitrec.gorse.io" ref="nofollow noopener noreferrer">网站</a> 或安装浏览器插件（支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fchromewebstore.google.com%2Fdetail%2Fgitrec%2Feihokbaeiebdenibjophfipedicippfl" target="_blank" title="https://chromewebstore.google.com/detail/gitrec/eihokbaeiebdenibjophfipedicippfl" ref="nofollow noopener noreferrer">Chrome</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Faddons.mozilla.org%2Fzh-CN%2Ffirefox%2Faddon%2Fgitrec%2F" target="_blank" title="https://addons.mozilla.org/zh-CN/firefox/addon/gitrec/" ref="nofollow noopener noreferrer">Firefox</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fmicrosoftedge.microsoft.com%2Faddons%2Fdetail%2Fgitrec%2Fcpcfbfpnagiffgpmfljmcdokmfjffdpa" target="_blank" title="https://microsoftedge.microsoft.com/addons/detail/gitrec/cpcfbfpnagiffgpmfljmcdokmfjffdpa" ref="nofollow noopener noreferrer">Edge</a>），助力 Gorse 推荐系统的持续开发。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[心流不是天赋，是环境设计：一个程序员被低效折磨后的自救实验]]></title>    <link>https://juejin.cn/post/7603359026711904266</link>    <guid>https://juejin.cn/post/7603359026711904266</guid>    <pubDate>2026-02-06T12:48:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026711904266" data-draft-id="7603352117639987209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="心流不是天赋，是环境设计：一个程序员被低效折磨后的自救实验"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-02-06T12:48:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="loonggg"/> <meta itemprop="url" content="https://juejin.cn/user/1750078239286167"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            心流不是天赋，是环境设计：一个程序员被低效折磨后的自救实验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078239286167/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    loonggg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:48:06.000Z" title="Fri Feb 06 2026 12:48:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我发现一个很有意思的现象：很多程序员都说自己最高效的时间是深夜。</p>
<p>不是因为深夜更聪明，而是因为深夜更“安静”。没有会议、没有消息轰炸、没有突然的需求变更。你终于可以沉下心来，进入那种“忘记时间”的状态。</p>
<p>这种状态有个专业名词，叫“心流”(Flow)。</p>
<p>心理学家米哈里·契克森米哈赖（Mihaly Csikszentmihalyi）研究了几十年，发现心流状态有几个特征：</p>
<ul>
<li>
<p>你完全专注于当前任务</p>
</li>
<li>
<p>时间感消失（一抬头发现过了 3 小时）</p>
</li>
<li>
<p>你感觉“刚好够难，但又能搞定”</p>
</li>
<li>
<p>你进入了一种“自动驾驶”的高效模式</p>
</li>
</ul>
<p>对程序员来说，心流就是那种“代码如流水般写出来”的状态。你不需要刻意思考每一行，整个逻辑在脑子里已经成型，手指只是在把它“翻译”出来。</p>
<p>但问题是：这种状态太难进入了，而且太容易被打断。</p>
<h2 data-id="heading-0">一、心流的三大杀手：为什么你总是“进不去”？</h2>
<p>我观察了很多程序员朋友，包括我自己，发现心流被打断通常来自三个层面：</p>
<h3 data-id="heading-1">1、外部干扰：环境不允许你专注</h3>
<p>最明显的杀手是“被打断”。</p>
<p>一个消息弹窗、一个同事过来问问题、一个突然的会议通知。每一次打断，你都需要重新“加载”之前的上下文。研究表明，被打断后平均需要 23 分钟才能重新进入深度工作状态。</p>
<p>但还有一种更隐蔽的干扰：环境噪音。</p>
<p>不是说你旁边有人在吵架，而是那种“低烈度的持续刺激”。空调的嗡嗡声、键盘的敲击声、显示器的轻微闪烁、办公室的日光灯。这些东西你可能意识不到，但你的大脑一直在处理它们，消耗着你的注意力预算。</p>
<h3 data-id="heading-2">2、视觉疲劳：你的眼睛在“抗议”</h3>
<p>程序员一天盯屏幕的时间，少说也有 8 小时。</p>
<p>但你有没有发现，写了 2-3 小时代码后，你会莫名其妙地“不想看屏幕”？不是累，是一种“视觉上的抵触”。</p>
<p>这不是你的问题，是屏幕的问题。</p>
<p>大多数显示器的色温、亮度、对比度，都是按照“通用场景”调校的，看视频、浏览网页、处理文档。但编程是一种极其特殊的场景：</p>
<ul>
<li>
<p>你需要长时间盯着高对比度的文本（黑底白字或白底黑字）</p>
</li>
<li>
<p>你需要快速识别不同颜色的语法高亮</p>
</li>
<li>
<p>你需要在 IDE 的多个区域之间快速切换视线</p>
</li>
<li>
<p>你经常在深夜或弱光环境下工作</p>
</li>
</ul>
<p>如果显示器不是为这种场景优化的，你的眼睛就会一直处于“对抗”状态。要么觉得刺眼，要么觉得模糊，要么觉得色彩“不对劲”。</p>
<p>这种视觉疲劳会直接拖垮你的专注力。你不是不想写代码，是你的眼睛在“抗议”。</p>
<h3 data-id="heading-3">3、心理阻力：你的大脑在“拖延”</h3>
<p>还有一种更微妙的打断，来自你自己。</p>
<p>你打开 IDE，准备开始写一个复杂的功能。但你发现自己：</p>
<ul>
<li>
<p>先去倒杯水</p>
</li>
<li>
<p>再刷一下手机</p>
</li>
<li>
<p>然后突然想起要回个消息</p>
</li>
<li>
<p>最后发现半小时过去了，代码一行没写</p>
</li>
</ul>
<p>这不是拖延症，是大脑的自我保护机制。</p>
<p>当一个任务“看起来很难”时，大脑会本能地寻找“更简单的事情”来做。这是因为进入心流需要一个“启动成本”。你需要把所有相关的上下文加载到工作记忆里，这个过程很耗能。</p>
<p>所以，大脑会找各种理由拖延这个“启动”过程。</p>
<p>但有意思的是，一旦你真正开始了，这种阻力就会消失。难的不是“做”，而是“开始做”。</p>
<h2 data-id="heading-4">二、如何保护心流？从“环境设计”开始</h2>
<p>既然心流这么脆弱，我们能做什么？</p>
<p>答案不是“更自律”或“更努力”，而是<strong>重新设计你的工作环境</strong>。</p>
<p>心理学有个概念叫“环境提示”(Environmental Cues)。你的环境会给大脑发送信号，告诉它“现在该做什么”。</p>
<p>比如：</p>
<ul>
<li>
<p>你躺在床上，大脑会自动进入“休息模式”</p>
</li>
<li>
<p>你坐在咖啡厅，大脑会进入“社交/轻度工作模式”</p>
</li>
<li>
<p>你坐在安静的图书馆，大脑会进入“深度学习模式”</p>
</li>
</ul>
<p>同样的道理，如果你的工作环境能给大脑发送“现在是深度编程时间”的信号，你就更容易进入心流。</p>
<p>这就是为什么很多程序员喜欢深夜编程。不是因为深夜更聪明，而是因为深夜的环境提示更清晰：</p>
<ul>
<li>
<p>光线变暗（视觉刺激减少）</p>
</li>
<li>
<p>噪音消失（听觉干扰减少）</p>
</li>
<li>
<p>没人打扰（社交压力消失）</p>
</li>
<li>
<p>时间感模糊（不会焦虑“还有多少事没做”）</p>
</li>
</ul>
<h2 data-id="heading-5">三、我的解决方案：用“仪式感”触发心流</h2>
<p>我最近换了一台显示器，明基 RD280U，它是一款专门为程序员设计的专业编程显示器。</p>
<p>用了一个多月后，我发现它最大的价值不是参数有多强（虽然参数确实很强），而是它帮我建立了一套“进入心流”的仪式感。</p>
<h3 data-id="heading-6">MoonHalo 光环系统：给大脑一个“开始”的信号</h3>
<p>这个功能一开始我觉得是噱头。显示器背后有一圈灯，可以发出柔和的光晕。</p>
<p>但用了几次后，我发现它的作用远不止“好看”。</p>
<p>当我准备开始深度编程时，我会：</p>
<ol>
<li>
<p>关掉书房的主灯</p>
</li>
<li>
<p>打开显示器的 MoonHalo 模式</p>
</li>
<li>
<p>戴上降噪耳机</p>
</li>
<li>
<p>开始写代码</p>
</li>
</ol>
<p>这个过程只需要 30 秒，但它给我的大脑发送了一个非常明确的信号：<strong>“现在是深度工作时间”</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57046c9dcdf347dd8a1eb6b7818a4b35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9vbmdnZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986886&amp;x-signature=14NzgqNnS1KvI35g93%2BbNo%2BO2sI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">为什么 MoonHalo 能触发心流？</h4>
<p>这不是玄学，背后有扎实的科学原理。</p>
<p><strong>第一，它利用了“光线引导注意力”的心理学机制。</strong></p>
<p>人类的注意力天生会被光线吸引。当你坐在一个被柔和光晕包围的工作台前，你的视觉焦点会自然地“收缩”到屏幕区域，周围的环境逐渐“隐退”。</p>
<p>这种感觉就像在电影院看电影。当灯光暗下来，屏幕亮起来，你的注意力会自动聚焦到屏幕上，外界的干扰都消失了。</p>
<p>MoonHalo 创造的就是这种“聚焦效应”。</p>
<p><strong>第二，它降低了环境对比度，减少视觉疲劳。</strong></p>
<p>如果你在完全黑暗的房间里盯着一个亮屏幕，你的瞳孔会一直在“屏幕亮度”和“周围黑暗”之间来回调节。这种频繁调节会加剧视觉疲劳，让你很快就“不想看屏幕”。</p>
<p>而 MoonHalo 的背光提供了一个“过渡区”。它不是直射的强光，而是从显示器背后漫射出来的柔和光晕。这种光线会在屏幕和周围环境之间建立一个“缓冲带”，让你的瞳孔不需要频繁调节。</p>
<p>这就是为什么很多人用了 MoonHalo 后，会觉得“眼睛没那么累了”。不是因为屏幕变暗了，而是因为环境对比度降低了。</p>
<p><strong>第三，它创造了一种“仪式感”，帮助大脑切换状态。</strong></p>
<p>心理学研究发现，人类的大脑需要“仪式”来切换状态。</p>
<p>比如，运动员在比赛前会做热身动作，不仅是为了活动身体，更是为了让大脑进入“比赛模式”。作家在写作前会泡一杯咖啡、整理桌面，不仅是为了舒适，更是为了让大脑进入“创作模式”。</p>
<p>同样的道理，当你每次开始深度编程前都打开 MoonHalo，你的大脑会逐渐建立一个条件反射：<strong>MoonHalo 亮起 = 深度工作时间</strong>。</p>
<p>这种仪式感会大大降低“启动成本”。你不需要花半小时“进入状态”，而是一打开 MoonHalo，大脑就自动切换到“心流模式”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b0bde473d6c491488a7d4a2b824d16f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9vbmdnZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986886&amp;x-signature=EO7l1IWF8TptjWjkDKZB1fohdlI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">MoonHalo 的细节设计：不只是“亮起来”那么简单</h4>
<p>很多人可能会说：“这不就是氛围灯吗？我自己买个台灯不行吗？”</p>
<p>可以，但效果完全不一样。</p>
<p>因为 MoonHalo 不是简单的“背景光”，而是一个<strong>为编程场景深度优化的光环系统</strong>。</p>
<p><strong>1. 可调节的色温和亮度</strong></p>
<p>MoonHalo 支持多种颜色和亮度调节。</p>
<p>这种“可调节性”是普通台灯做不到的。因为 MoonHalo 的光线是“围绕屏幕”的，而不是“照亮桌面”的。它的目标不是让你看清键盘，而是创造一个“沉浸式的视觉环境”。</p>
<p><strong>2. 自动调光功能和多种灯光模式选择</strong></p>
<p>更智能的是，MoonHalo 支持自动调光，自动给我最合适的光线环境。同时，还支持多种灯光模式供我们选择，总有一款适合你。</p>
<p>这就是“一键进入状态”的体验。</p>
<p><strong>3. 不会在屏幕上产生反光</strong></p>
<p>这是一个很容易被忽略的细节。</p>
<p>如果你用普通的台灯或落地灯，光线很容易在屏幕上产生反光，尤其是当你用的是镜面屏或半镜面屏的时候。这种反光会分散你的注意力，让你不自觉地调整坐姿或屏幕角度。</p>
<p>而 MoonHalo 的光线是从显示器背后漫射出来的，它的方向是“向外”的，而不是“向屏幕”的。这意味着它不会在屏幕上产生任何反光，也不会干扰你的视线。</p>
<p>这种“无感”才是最好的设计。你只会感受到“环境变舒服了”，而不会意识到“有一个灯在亮着”。</p>
<p>说实话，我一开始买 RD280U 的时候，完全没把 MoonHalo 当回事。我觉得这就是个“营销噱头”，实际用处不大。</p>
<p>但用了一周后，我发现自己已经离不开它了。</p>
<p>而且，我发现 MoonHalo 还有一个意外的好处：<strong>它帮我建立了“工作边界”</strong>。</p>
<p>比如，因为环境没有变化，我的大脑一直处于“工作模式”，很难放松。但现在，当我关掉 MoonHalo 的时候，我的大脑会自动切换到“休息模式”。这种“仪式感”帮我建立了清晰的工作边界，让我既能高效工作，也能彻底放松。</p>
<h3 data-id="heading-9">猫头鹰模式：让深夜编程不再“伤眼”</h3>
<p>如果说 MoonHalo 是帮你“进入心流”，那猫头鹰模式就是帮你“保持心流”。</p>
<p>很多程序员喜欢深夜编程，但深夜编程有个大问题：光线太暗，屏幕太亮，眼睛很容易疲劳。</p>
<p>你可能会说：“那我把屏幕亮度调低不就行了？”</p>
<p>可以，但远远不够。</p>
<p>因为“亮度”只是视觉舒适度的一个维度，还有色温、对比度、蓝光比例、色彩饱和度等等。如果你只是简单地降低亮度，你会发现：</p>
<ul>
<li>
<p>屏幕变“灰”了，代码的色彩识别度下降</p>
</li>
<li>
<p>你需要更用力地“盯”屏幕，反而更累</p>
</li>
<li>
<p>蓝光依然在抑制褪黑素分泌，让你“越看越精神”，但也让你睡不着</p>
</li>
</ul>
<p>猫头鹰模式的逻辑是：<strong>在保持代码清晰度的前提下，动态调整所有参数，让屏幕适应深夜环境</strong>。无论你的周边环境多暗，RD280U通过固件调整打破亮度限制，提供极低的亮度与色彩平衡方案，让你的眼睛始终保持舒适，深夜编程也无惧</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e4d97706fac4a2fb76cd8d1063dda40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9vbmdnZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986886&amp;x-signature=UFk0r4ofPRYygakW7iES4ppukKQ%3D" alt="" loading="lazy"/></p>
<p>所以，猫头鹰模式，这不是简单的“降低亮度”，而是一套<strong>针对深夜编程场景的综合调校方案</strong>。</p>
<h2 data-id="heading-10">四、3:2 屏幕比例：为什么它特别适合“心流编程”？</h2>
<p>除了 MoonHalo 和猫头鹰模式，RD280U 还有一个很特别的设计：<strong>3:2 的屏幕比例</strong>。</p>
<p>这个比例看起来“不起眼”，但它对心流的影响远比你想象的大。</p>
<p>心流的一个关键特征是“注意力高度集中”。如果你需要频繁地上下滚动、左右切换，你的注意力就会被“打断”。</p>
<p>而 3:2 的屏幕比例，恰恰可以<strong>减少视线移动和上下文切换</strong>。</p>
<h3 data-id="heading-11">为什么 3:2 比 16:9 更适合心流编程？</h3>
<p>16:9 是“视频比例”，它天生是为“横向内容”设计的——看电影、看视频、玩游戏。</p>
<p>但编程是“纵向内容”，你需要看代码、看日志、看文档、看终端。这些内容都是“从上往下”的。</p>
<p>如果你用 16:9 的屏幕，你会发现：</p>
<ul>
<li>
<p>IDE 的代码区域很“矮”，你需要频繁上下滚动</p>
</li>
<li>
<p>终端和日志区域被挤到很小，你需要频繁切换标签页</p>
</li>
<li>
<p>文档和 API 参考没地方放，你需要来回切窗口</p>
</li>
</ul>
<p>这些“频繁切换”会不断打断你的心流。</p>
<p>而 3:2 的屏幕比例，比 16:9 多出了约 30% 的垂直空间。这意味着：</p>
<ul>
<li>
<p><strong>终端和日志可以常驻在底部</strong>，不需要频繁切换标签页</p>
</li>
<li>
<p><strong>文档和 API 参考可以并排显示</strong>，不需要来回切窗口</p>
</li>
<li>
<p><strong>diff 和 PR 页面可以一屏看完</strong>，不需要反复滚动</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7211b372caf54d0d90777bd380ca333a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG9vbmdnZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770986886&amp;x-signature=0A63%2BwE72JBEPECyMbPHKJ0PTGM%3D" alt="" loading="lazy"/></p>
<p>这些看起来是“小优化”，但它们会直接影响你的心流体验。</p>
<p>因为心流的本质是：<strong>你的工作记忆里只有一件事</strong>。</p>
<p>如果你需要频繁地“切换上下文”（比如从代码切到文档，再切到终端，再切回代码），你的工作记忆就会被“污染”，心流就会中断。</p>
<p>而 3:2 的屏幕比例，配合 28 寸 4K 的分辨率（3840×2560），可以让你在一个屏幕上“看到所有相关信息”，减少上下文切换。</p>
<p>这种“一屏掌控”的感觉，会让你更容易进入心流，也更容易保持心流。</p>
<h2 data-id="heading-12">五、心流不是“天赋”，而是“环境设计”</h2>
<p>回到开头的问题：程序员的心流为什么总被打断？</p>
<p>答案很清楚了。<strong>不是你不够专注，而是你的环境在拖你后腿</strong>。</p>
<p>心流不是一种“天赋”，而是一种“状态”。这种状态需要三个条件：</p>
<ol>
<li>
<p><strong>足够的挑战</strong>（任务不能太简单，也不能太难）</p>
</li>
<li>
<p><strong>即时的反馈</strong>（你能清楚地知道自己在进步）</p>
</li>
<li>
<p><strong>无干扰的环境</strong>（外部干扰和内部阻力都要降到最低）</p>
</li>
</ol>
<p>前两个条件取决于你的工作内容，但第三个条件，完全可以通过“环境设计”来优化。</p>
<p>而一个好的显示器，恰恰是“环境设计”的核心。</p>
<p>因为它是你每天 8 小时都要盯着的东西，它决定了：</p>
<ul>
<li>
<p>你的眼睛会不会疲劳</p>
</li>
<li>
<p>你的注意力会不会分散</p>
</li>
<li>
<p>你的大脑会不会抵触</p>
</li>
</ul>
<p>如果这三个问题都解决了，心流就会自然而然地发生。</p>
<p>这就是为什么我会推荐明基 RD280U 这款显示器。它不是“参数最强”的显示器，但它是“最懂程序员心流”的显示器。</p>
<p>它知道你需要“仪式感”来触发心流（MoonHalo），它知道你需要“舒适度”来保持心流（猫头鹰模式），它知道你需要“视觉连续性”来减少心流中断（3:2 屏幕比例）。</p>
<p>这些细节加起来，就是“心流”和“被打断”的区别。</p>
<h2 data-id="heading-13">写在最后：投资你的“工作台”，而不只是你的“技能”</h2>
<p>很多程序员喜欢投资“技能”，学新框架、刷算法题、看技术书。</p>
<p>这些当然重要，但还有一件同样重要、却经常被忽略的事：<strong>投资你的工作环境</strong>。</p>
<p>因为再强的技能，也需要一个“能让你发挥出来”的环境。</p>
<p>如果你的显示器让你眼睛疲劳、注意力分散、心流中断，那你的技能就会被“打折扣”。</p>
<p>而一个好的显示器，可以让你：</p>
<ul>
<li>
<p>每天多写 2 小时高质量代码（因为眼睛不累了）</p>
</li>
<li>
<p>每周多进入 5 次心流状态（因为环境更沉浸了）</p>
</li>
<li>
<p>每个月少加几次班（因为效率更高了）</p>
</li>
</ul>
<p>这些收益，远远超过显示器本身的价格。</p>
<p>所以，如果你真的想提升编程效率、保护心流状态，别只盯着软件和技巧，先看看你的硬件配得上你的水平吗。</p>
<p>屏幕是你的“工作台”，而不是“装饰品”。</p>
<p>选对了，你会发现：心流不是“偶尔发生”的幸运，而是“每天都能进入”的常态。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【转载】Introducing OpenAI Frontier]]></title>    <link>https://juejin.cn/post/7603567912592277531</link>    <guid>https://juejin.cn/post/7603567912592277531</guid>    <pubDate>2026-02-06T12:59:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592277531" data-draft-id="7603584155784446002" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【转载】Introducing OpenAI Frontier"/> <meta itemprop="keywords" content="OpenAI"/> <meta itemprop="datePublished" content="2026-02-06T12:59:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【转载】Introducing OpenAI Frontier
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T12:59:40.000Z" title="Fri Feb 06 2026 12:59:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AI 让团队能够完成过去只会讨论却难以落地的事情。事实上，75% 的企业员工表示，AI 帮助他们完成了以前做不到的任务。我们从每个部门都听到这样的反馈，而不只是技术团队。工作的完成方式已经改变，企业正在以非常显著的方式感受到这种变化。过去几年里，我们在超过 100
万家企业客户中看到了这种变化的真实发生。</p>
<p>在一家大型制造商那里，智能体把生产优化工作从六周缩短到一天。在一家全球投资公司，智能体贯穿销售流程的端到端部署，为销售人员腾出了超过 90% 的时间，让他们能更多地与客户交流。而在一家大型能源生产商那里，智能体帮助将产量提高了最多 5%，这意味着额外增加超过 10 亿美元的收入。</p>
<p>这一切正在各行各业的 AI 领导者中发生，追赶的压力也在增加。真正拖慢他们的不是模型的智能水平，而是组织内部智能体是如何被构建和运行的。</p>
<p>今天，我们推出 Frontier——一个新的平台，帮助企业构建、部署与管理能够做“真实工作”的 AI 智能体。Frontier 让智能体具备人类在工作中成功所需的同类能力：共享上下文、入职培训、带反馈的实践学习，以及清晰的权限与边界。这样，团队才能从孤立的单点用例，迈向能跨业务协同的 AI 同事。</p>
<p>HP、Intuit、Oracle、State Farm、Thermo Fisher 和 Uber 是最早采用 Frontier 的企业之一；而包括 BBVA、Cisco 和 T-Mobile 在内的数十家现有客户，已经试点了 Frontier 的方法，用来驱动他们最复杂、最有价值的一些 AI 工作。</p>
<p>（引言）
“与 OpenAI 合作能帮助我们为成千上万的 State Farm 代理人与员工提供更好的工具来服务客户。把 OpenAI 的 Frontier 平台与部署专长同我们的团队结合起来，我们正在加速 AI 能力建设，并找到新的方式，帮助数百万人提前规划、守护重要事物，并在意外发生时更快恢复。”
—— Joe Park，State Farm 执行副总裁兼首席数字与信息官</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>AI 机会鸿沟</p>
<p>企业已经被分散在不同云、数据平台与应用中的割裂系统与治理框架压得喘不过气。AI 让这种碎片化更明显，在很多情况下也更严重。</p>
<p>智能体正在被部署到各处，但每个智能体能够看到和能够做的事情都是孤立的。每新增一个智能体，可能不是在降低复杂度，反而在增加复杂度——因为它缺乏做好工作所需的上下文。</p>
<p>随着智能体能力提升，“模型能做什么”与“团队实际上能部署什么”之间的机会鸿沟正在扩大。这个鸿沟不仅由技术驱动。团队仍在建立把智能体从早期试点推进到真实工作的知识体系，而 AI 的进步速度更快。仅在 OpenAI
内部，几乎每三天就会发布一次新东西，而且节奏还在加快。要跟上，就必须在控制与实验之间取得平衡，而这很难把握。</p>
<p>企业现在感到必须立刻解决这个问题，因为早期领跑者与其他企业之间的差距正在迅速拉大。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>OpenAI Frontier</p>
<p>我们发现，团队不只是需要“能解决拼图某一块”的更好工具。他们需要一个端到端的方法，来把智能体真正带入生产环境：构建、部署与管理。</p>
<p>我们从企业如何扩展“人”的方式开始思考：他们会建立入职流程；教授制度性知识与内部语言；允许通过实践学习，并通过反馈提升表现；授予对正确系统的访问权，同时设定边界。AI 同事也需要同样的东西。</p>
<p>要让 AI 同事真正工作，有几件事很关键：</p>
<ul>
<li>他们必须理解跨系统的实际工作流程是如何运转的；</li>
<li>他们需要访问电脑与工具来规划、行动并解决现实问题；</li>
<li>他们需要理解“什么是好”，从而随着工作变化而持续提升质量；</li>
<li>他们需要一个可被信任的身份、权限与边界。</li>
</ul>
<p>而这一切必须能在分布于多云环境的众多系统中运作。</p>
<p>Frontier 与团队已有的系统协同工作，而不是强迫他们重新平台化。你可以在数据与 AI 所在之处直接接入它们，并使用开放标准集成你已经在用的应用——不需要新格式，也不需要放弃你已经部署的智能体或应用。</p>
<p>这种方法的“超能力”在于：AI 同事可以通过任何界面被访问并发挥作用，而不是被困在单一 UI 或单一应用背后。他们可以在工作的任何地方与人合作：无论是通过 ChatGPT 交互、通过 Atlas 的工作流，还是嵌入到既有的业务应用中。无论智能体是由企业内部开发、从 OpenAI
获得，还是由你已在用的其他供应商集成而来，都是如此。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>理解工作（Understand the work）</p>
<p>每位高效员工都了解业务如何运作、信息在哪里、以及什么样的决策是好的。Frontier 连接彼此孤立的数据仓库、CRM 系统、工单工具与内部应用，为 AI 同事提供同样的共享业务上下文。</p>
<p>他们理解信息如何流动、决策在哪里发生、以及哪些结果最重要。它成为企业的语义层，所有 AI 同事都能引用它来有效运作并沟通。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>规划、行动与解决问题（Plan, act, and solve problems）</p>
<p>有了共享上下文之后，智能体必须能够真正把工作做出来。组织内的技术与非技术团队都可以使用 Frontier 来“雇用”AI 同事，让他们承担许多人类在电脑上完成的任务。</p>
<p>Frontier 赋予 AI 同事在一个可靠、开放的智能体执行环境中推理数据并完成复杂任务的能力，例如：处理文件、运行代码、使用工具等。</p>
<p>随着 AI 同事运行，他们会建立记忆，把过去的交互转化为有用的上下文，从而随时间推移持续提升表现。部署后，AI 同事可以在本地环境、企业云基础设施与 OpenAI 托管运行时之间运行，而无需团队重造工作方式。对于时间敏感的工作，Frontier 优先提供对 OpenAI
模型的低延迟访问，以保持响应快速且一致。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>在真实工作上提升质量（Improve quality on real work）</p>
<p>智能体要长期有用，就必须像人一样从经验中学习。内置的评估与优化方式，能让人类管理者与 AI 同事清晰看到哪些有效、哪些无效，从而让良好行为随时间不断强化。</p>
<p>随着时间推移，AI 同事会学习“好”是什么样子，并在最重要的工作上变得更好。这就是智能体从惊艳的演示走向可靠队友的路径。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>身份、权限与边界（Identity, permissions, and boundaries）</p>
<p>Frontier 确保 AI 同事在清晰边界内运行。每个 AI 同事都有自己的身份，并具备明确的权限与护栏。这使得它们能够在敏感且受监管的环境中被放心使用。企业级安全与治理能力内置其中，帮助团队在扩展规模时不失控。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>将技术与方法论结合（Combining technology with know-how）</p>
<p>弥合机会鸿沟不仅是技术问题。多年来，我们与大型企业在复杂 AI 部署上紧密合作，见证了哪些有效、哪些无效。现在，我们正在帮助团队把这些经验用于最棘手的问题。</p>
<p>我们把 OpenAI 的 Forward Deployed Engineers（FDE，前线部署工程师）与客户团队配对，肩并肩工作，帮助你制定在生产环境中构建与运行智能体的最佳实践。FDE 也让团队与 OpenAI Research 建立直接连接。</p>
<p>当你部署智能体时，我们不仅学习如何改进围绕模型的系统，也学习模型本身需要如何演进，才能对你的工作更有用。这条从业务问题→部署→研究→再反馈回来的闭环，让双方都能更快前进。</p>
<p>（示例/案例：根因分析、数字零售助手、设备维护、用户个性化、营销活动等）
业务问题：数以百万计的硬件测试失败，工程师每年花费数千小时（几乎一半时间）通过翻日志、文档与代码来人工定位原因。
我们解决了什么：把每次失败的根因定位从约 4 小时缩短到几分钟，加速故障排查。
如何实现：AI 同事汇总仿真日志、内部文档、工作流与代码，运行端到端调查，找出最可能的根因以及下一步措施。
结果：调试从小时级降到分钟级，每年节省数千工程小时，并加快开发进度。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>打开 AI 生态（Opening the AI ecosystem）</p>
<p>在企业里，AI 要发挥最佳效果，平台与应用需要协同工作。由于 Frontier 基于开放标准，软件团队可以接入并构建智能体应用，使其受益于同一套共享上下文。</p>
<p>这很重要，因为许多智能体应用失败的原因很简单：缺少所需的上下文。数据分散在各个系统中，权限复杂，每次集成都可能变成一次性项目。Frontier 让应用更容易（在正确的控制下）访问业务上下文，因此从第一天起就能融入真实工作流。</p>
<p>对企业而言，这意味着更快的上线速度，而不必每次都经历漫长的集成周期。</p>
<p>我们也在与一小部分 Frontier Partners 合作——一些 AI 原生的构建者（例如 Abridge、Clay、Ambience、Decagon、Harvey、Sierra）——他们承诺与 Frontier 深度协作。他们将与 OpenAI 紧密合作，学习客户需求、设计解决方案并支持部署。随着时间推移，我们会扩大该计划，欢迎更多专注企业 AI
的构建者加入。</p>
<p>────────────────────────────────────────────────────────────────────────────────</p>
<p>一起构建（Let’s build）</p>
<p>现在的问题不再是 AI 是否会改变工作方式，而是你的组织能多快把智能体变成真正的优势。Frontier 目前已向一部分客户开放，未来几个月将更广泛可用。</p>
<p>如果你想探索与我们合作，请联系你的 OpenAI 团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习：Kotlin中的JvmStatic注解]]></title>    <link>https://juejin.cn/post/7603567912592113691</link>    <guid>https://juejin.cn/post/7603567912592113691</guid>    <pubDate>2026-02-06T11:28:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603567912592113691" data-draft-id="7603359026711756810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习：Kotlin中的JvmStatic注解"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2026-02-06T11:28:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习：Kotlin中的JvmStatic注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:28:55.000Z" title="Fri Feb 06 2026 11:28:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JvmStatic 是 Kotlin 中的一个注解（Annotation），专门用于标注在 Kotlin 对象（包括单例对象和伴生对象）中的方法或属性上，使其能够以类似 Java 静态成员的方式被 JVM 访问。</p>
<p>它的核心作用是消除 Kotlin 对象成员与 Java 静态成员之间的语法差异，让 Kotlin 代码在 Java 中调用时更符合 Java 的开发习惯。</p>
<h2 data-id="heading-0">基本定义与使用场景</h2>
<p>Kotlin 的对象（object）和伴生对象（companion object）本质上是单例实例，其成员在 Kotlin 中通过对象实例访问（如 MyObject.method()）。</p>
<p>但在 Java 中，静态成员直接通过类名访问（如 MyClass.staticMethod()）。为了让 Kotlin 对象中的成员在 Java 中表现为静态成员，JvmStatic 注解被引入。</p>
<h2 data-id="heading-1">具体用法与效果</h2>
<h3 data-id="heading-2">标注在伴生对象（companion object）的成员上</h3>
<p>伴生对象是 Kotlin 中为类提供“静态-like”功能的机制（如工厂方法、常量）。</p>
<p>默认情况下，伴生对象的成员在 Java 中需要通过 Companion 接口访问（如 MyClass.Companion.create()）。</p>
<p>使用 @JvmStatic 后，这些成员可以直接通过类名访问，如同 Java 静态方法。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 未使用 @JvmStatic：Java 中需通过 MyClass.Companion.getVersion()</span>
        <span class="hljs-keyword">val</span> version = <span class="hljs-string">"1.0"</span>
        
        <span class="hljs-comment">// 使用 @JvmStatic：Java 中可直接通过 MyClass.getVersion()</span>
        <span class="hljs-meta">@JvmStatic</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getVersion</span><span class="hljs-params">()</span></span>: String = version
        
        <span class="hljs-comment">// 未使用 @JvmStatic：Java 中需通过 MyClass.Companion.create()</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: MyClass = MyClass()
        
        <span class="hljs-comment">// 使用 @JvmStatic：Java 中可直接通过 MyClass.create()</span>
        <span class="hljs-meta">@JvmStatic</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createInstance</span><span class="hljs-params">()</span></span>: MyClass = MyClass()
    }
}
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 未使用 @JvmStatic 的版本（需通过 Companion）</span>
<span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> MyClass.Companion.getVersion(); 
<span class="hljs-type">MyClass</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> MyClass.Companion.create();

<span class="hljs-comment">// 使用 @JvmStatic 的版本（直接通过类名，类似 Java 静态方法）</span>
<span class="hljs-type">String</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> MyClass.getVersion(); 
<span class="hljs-type">MyClass</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> MyClass.createInstance(); 
</code></pre>
<h3 data-id="heading-3">标注在单例对象（object）的成员上</h3>
<p>Kotlin 的单例对象（非伴生对象的独立对象）默认在 Java 中表现为一个单例实例（如 MySingleton.INSTANCE），其成员需通过该实例访问。</p>
<p>使用 @JvmStatic 后，成员可直接通过对象名访问，如同 Java 静态成员。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> MySingleton {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> count = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// 未使用 @JvmStatic：Java 中需通过 MySingleton.INSTANCE.increment()</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span></span> { count++ }
    
    <span class="hljs-comment">// 使用 @JvmStatic：Java 中可直接通过 MySingleton.increment()</span>
    <span class="hljs-meta">@JvmStatic</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">incrementCount</span><span class="hljs-params">()</span></span> { count++ }
    
    <span class="hljs-comment">// 未使用 @JvmStatic：Java 中需通过 MySingleton.INSTANCE.getCount()</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
    
    <span class="hljs-comment">// 使用 @JvmStatic：Java 中可直接通过 MySingleton.getCount()</span>
    <span class="hljs-meta">@JvmStatic</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTotalCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> = count
}
</code></pre>
<p>Java 调用效果：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 未使用 @JvmStatic 的版本（需通过 INSTANCE）</span>
MySingleton.INSTANCE.increment(); 
<span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> MySingleton.INSTANCE.getCount();

<span class="hljs-comment">// 使用 @JvmStatic 的版本（直接通过对象名，类似 Java 静态方法）</span>
MySingleton.incrementCount(); 
<span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> MySingleton.getTotalCount(); 
</code></pre>
<h2 data-id="heading-4">关键注意事项</h2>
<p>• 仅对对象/伴生对象的成员有效：@JvmStatic 只能用于 object 或 companion object 内部的方法或属性，不能用于普通类（class）的成员。</p>
<p>• 属性与方法的差异：</p>
<pre><code class="hljs language-less" lang="less">• 对于方法：<span class="hljs-variable">@JvmStatic</span> 会让方法在 Java 中表现为静态方法（直接通过类名调用）。  

• 对于属性：<span class="hljs-variable">@JvmStatic</span> 会让属性的 getter/setter 方法在 Java 中表现为静态方法（如 Kotlin 的 val version 生成的 <span class="hljs-built_in">getVersion</span>() 会变成静态方法）。
</code></pre>
<p>• 与 @JvmField 的区别：@JvmField 用于将对象中的属性暴露为 Java 静态字段（直接访问字段值），而 @JvmStatic 是将属性的访问器（getter/setter）暴露为静态方法。两者可配合使用，但场景不同。</p>
<h2 data-id="heading-5">总结</h2>
<p>@JvmStatic 的核心价值是桥接 Kotlin 对象成员与 Java 静态成员的访问方式，提升跨语言调用的兼容性。</p>
<p>它让 Kotlin 的单例或伴生对象中的方法/属性在 Java 中调用时更符合 Java 开发者的直觉，避免了繁琐的 Companion 或 INSTANCE 中间层。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全模态、多引擎、一体化，阿里云DLF3.0构建Data+AI驱动的智能湖仓平台]]></title>    <link>https://juejin.cn/post/7603355275258445864</link>    <guid>https://juejin.cn/post/7603355275258445864</guid>    <pubDate>2026-02-06T11:54:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603355275258445864" data-draft-id="7603347438013759523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全模态、多引擎、一体化，阿里云DLF3.0构建Data+AI驱动的智能湖仓平台"/> <meta itemprop="keywords" content="大数据,人工智能"/> <meta itemprop="datePublished" content="2026-02-06T11:54:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全模态、多引擎、一体化，阿里云DLF3.0构建Data+AI驱动的智能湖仓平台
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:54:21.000Z" title="Fri Feb 06 2026 11:54:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">▌导读</h2>
<p>在AI时代,数据工程师和AI工程师的协作变得前所未有的重要。阿里云DLF产品负责人李鲁兵在本次分享中,详细介绍了全模态湖仓DLF 3.0的完整能力体系。这个平台不仅支持传统的结构化数据处理,更在业界首次实现了结构化、半结构化、非结构化数据的统一管理和处理,为Data+AI一体化提供了端到端的解决方案。</p>
<h2 data-id="heading-1">▌全模态平台的核心理念:数据统一、计算按需、工作流驱动</h2>
<p>全模态湖仓管理平台的设计理念可以概括为四个关键词:数据统一、计算按需、工作流驱动、多方协作。在AI时代,数据工程师负责数据准备和预处理,AI工程师专注于模型训练、推理和召回,两个角色需要在统一的平台上无缝协作,这对平台能力提出了更高的要求。</p>
<p>数据统一是基础。传统的数据平台往往将结构化数据、半结构化数据、非结构化数据分别存储在不同系统中,造成数据孤岛和管理复杂度的急剧上升。DLF 3.0通过统一的Omni Catalog,实现了对Paimon、Iceberg、Lance、Format Table、Object Table等多种格式的统一管理。无论是传统的数据库表,还是文本、音频、图片、视频等多模态数据,都可以在同一套元数据目录中进行管理,Data工程师和AI工程师可以基于同一份数据进行协作。</p>
<p>计算按需是核心。不同的应用场景需要不同的计算引擎。实时分析需要Flink和Hologres,离线分析依赖Spark和MaxCompute,全模态检索要用到Milvus和Elasticsearch/OpenSearch,模型训练则需要PAI和Ray。DLF 3.0支持所有这些计算引擎在统一的湖仓之上按需调用,一份数据,多个引擎共享,避免了数据的重复存储和迁移。</p>
<p>工作流驱动是保障。数据处理和AI应用往往涉及多个步骤:数据摄取、预处理、特征工程、模型训练、推理、召回等。DLF 3.0提供了完整的工作流编排能力,数据工程师和AI工程师可以通过工作流将各个环节串联起来,实现端到端的自动化流程。</p>
<p>多方协作是目标。通过统一的IDE/Notebook开发环境、Copilot代码辅助、自然语言分析、Agent智能助手等能力,DLF 3.0降低了开发门槛,提升了协作效率。数据工程师和AI工程师可以在同一个平台上使用各自熟悉的工具,同时又能无缝共享数据和成果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59d3d18f96a74481aac0a3a37f850eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=VGuaEwlWd2EuW%2BZ7nxhsnouFY8w%3D" alt="幻灯片3.png" loading="lazy"/></p>
<h2 data-id="heading-2">▌产品方案大图:从结构化到全模态的能力升级</h2>
<p>DLF 3.0的产品方案大图清晰地展示了从结构化数据处理到全模态处理的能力演进。在传统的数据处理链路上,我们有CDC/Batch Ingestion(数据摄取)、Stream/Batch ETL(数据加工)、OLAP Analytic(分析查询)三个主要环节,对应的计算引擎包括Flink、Spark、Hologres、StarRocks、MaxCompute等。</p>
<p>在全模态处理链路上,新增了四个关键环节:数据集管理、数据预处理、数据训练、数据推理、数据检索召回。这些环节分别对应不同的计算引擎:数据预处理可以使用MaxFrame和PySpark,模型训练依赖PAI和Ray,数据检索召回则需要Milvus和Elasticsearch/OpenSearch等搜索引擎。</p>
<p>两条链路并非孤立存在,而是通过统一的Omni Catalog和DLF元数据服务实现了深度融合。底层的Lakehouse Managed Storage Service提供了统一的存储层,支持Virtual File System、生命周期管理、冷热分层、存储优化等能力。数据缓存加速服务CPFS进一步提升了GPU/CPU的数据读取效率,为AI训练和推理提供了高性能保障。</p>
<p>DLF作为统一的湖仓管理平台,提供了Rest Catalog Service、Lakehouse SDK(Paimon、Iceberg)、File SDK、权限管理、血缘追踪、监控日志等完整的企业级能力。这种架构设计使得同一份数据可以同时服务于传统的数据分析场景和新兴的AI应用场景,真正实现了Data+AI一体化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/247784032551427d8cef001e1e6ff326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=NIo1tJc1CzTN0UaN4Z7FP0lvnxs%3D" alt="幻灯片4.png" loading="lazy"/></p>
<h2 data-id="heading-3">▌Omni Catalog:全模态管理的统一目录</h2>
<p>在全模态时代,元数据管理面临前所未有的挑战。传统的Catalog只需要管理Tables、Views、Functions等结构化对象,而在AI场景下,还需要管理各种文件(Files)、向量索引、Blob数据等非结构化对象。如果不同类型的数据使用不同的Catalog或System进行管理,就会产生新的数据孤岛,计算引擎需要跨不同的Catalog进行处理,大幅增加了复杂度。</p>
<p>DLF 3.0推出的Omni Catalog正是为了解决这一问题。它通过一套统一的元数据目录,同时管理Tables和Files,支持Paimon、Iceberg、Lance、Format Table(Parquet、ORC、Avro)、Object Table(Files)等多种格式。计算引擎无论是传统的大数据引擎(Flink、Spark、Hologres)还是新型的AI框架(Ray、PyTorch),都可以通过统一的Rest API、Open API、Paimon SDK、Iceberg SDK、VFS SDK进行数据访问。</p>
<p>Omni Catalog的核心优势在于降低了数据孤岛的风险。通过统一的目录,数据治理、权限控制、血缘追踪等能力可以覆盖所有类型的数据,而不需要在不同系统间切换。这对于企业级应用尤为重要,因为数据合规、安全审计等需求必须覆盖全域数据,而不能有盲区。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8c15d6f50a44631872794bbebf8303a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=NkF4TNMBwN0T%2FBPoYeiCi0rTIwA%3D" alt="幻灯片5.png" loading="lazy"/></p>
<h2 data-id="heading-4">▌DLF提供商业化Paimon全模态存储:统一管理异构数据</h2>
<p>Paimon作为DLF 3.0的核心表格式,在全模态存储方面进行了深度创新。全模态存储面临三大核心需求:统一管理异构数据的能力、支持结构化和多模态数据的顺序访问(用于大规模批式推理)、提供高性能的标签和向量检索(支持随机访问)。</p>
<p>Paimon通过Row ID机制实现了对不同列、不同格式数据的统一管理。每一行数据都有一个全局唯一的Row ID,通过Row ID可以关联该行在不同文件格式中的存储位置。对于结构化数据,Paimon使用Parquet Files存储,对于向量数据,可以使用Lance Files或Faiss Vector索引,对于大型Blob数据(图片、音频、视频),则使用Paimon Blob格式。</p>
<p>在索引构建方面,Paimon提供了多种索引类型。Btree和Bitmap索引用于快速的标量查询,Invert倒排索引支持全文检索,Vector Index则提供高效的向量相似度搜索。这些索引通过Index Manifests进行统一管理,建立了字段与Row ID之间的映射关系。</p>
<p>在数据访问方面,Paimon通过Data Manifests管理文件组,支持Row Ranges范围扫描。对于顺序访问场景(如模型训练),Paimon可以将多条数据打包成Virtual File Group,提供高吞吐的批量读取。对于随机访问场景(如实时检索),Paimon通过全局索引实现了毫秒级的点查性能。</p>
<p>通过这种灵活的File Formats组合和统一的Table Format封装,Paimon实现了在一张宽表上承载结构化、半结构化、非结构化所有类型数据的目标,为全模态应用提供了坚实的存储基础。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078603b5f7c749daa5f375db65d502f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=Se4usRMUx0cjJgztV0vtvIh2rWE%3D" alt="幻灯片6.png" loading="lazy"/></p>
<h2 data-id="heading-5">▌DLF湖表管理与优化:智能化提升性能降低成本</h2>
<p>DLF 3.0提供了完整的湖表管理和优化能力,通过智能化的方式提升读写性能、降低存储成本。整个优化体系包括四大核心能力:自适应分桶、智能Compaction、快照管理清理、存储服务与冷热分层。</p>
<p>自适应分桶是一项创新性功能。传统的分桶策略需要用户在建表时指定分桶数,但随着数据量的变化,固定的分桶数可能导致性能问题。DLF 3.0支持根据数据量自适应地调整分桶数(Rescale),用户只需指定分桶Key,平台会自动维护最优的分桶配置,大幅降低了管理负担。</p>
<p>智能Compaction是性能优化的关键。随着数据的不断写入,湖表会产生大量小文件,影响读取性能。DLF 3.0提供了多种Compaction策略:动态资源模式支持延时优先、资源优先、均衡模式三种策略,平台会根据当前资源状况自动调整Compaction节奏;固定资源模式则允许用户自定义资源配置和参数,实现精细化控制。对于全模态数据,DLF 3.0还支持针对不同文件类型(结构化、半结构化、非结构化)采用不同的Compaction策略,保证整体效率。</p>
<p>快照管理和清理功能帮助用户有效管理数据生命周期。用户可以基于分区或快照设置自动清理策略,平台还会自动扫描Orphan Files(孤儿文件)并清理,避免存储空间的浪费。同时支持手动触发管理操作,满足特殊场景需求。</p>
<p>整个优化流程由DLF元数据服务、Event Store事件存储、Paimon存储优化服务协同完成。作业生成引擎、规则优化引擎、智能优化引擎共同组成了智能决策层,作业调度管理则负责在多个计算资源池上高效执行Compaction任务。这种架构设计实现了从元数据到数据文件的全链路优化,用户无需关心底层细节,即可享受高性能和低成本的双重优势。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32f7a8c2d5ab4eb48546938e350a2021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=E1LzIycKddmUeF5YAggVY%2B7ccKc%3D" alt="幻灯片7.png" loading="lazy"/></p>
<h2 data-id="heading-6">▌智能冷热分层:大幅降低存储成本</h2>
<p>存储成本是企业在构建数据湖时的重要考量因素。DLF 3.0提供了智能的冷热分层能力,可以根据数据访问模式自动将数据在不同存储类型间迁移,在保证性能的同时大幅降低成本。</p>
<p>DLF 3.0支持四种存储类型:标准存储、低频存储、归档存储、冷归档存储。平台会根据数据的最近访问时间和最近更新时间,自动决定数据应该存储在哪个层级。对于频繁访问的热数据,保持在标准存储以保证高性能;对于访问频率降低的温数据,迁移到低频存储节省成本;对于长期不访问的冷数据,则可以归档到成本更低的归档存储或冷归档存储。</p>
<p>智能加热是冷热分层的重要补充功能。当归档的数据再次被访问时,平台会自动将其加热到更高性能的存储层级。加热策略支持Partition(分区)和File(文件)两层管理,可以针对分区级别或文件级别的访问进行精细化控制。这种设计既保证了数据访问的性能,又最大化地利用了低成本存储,实现了性能与成本的最佳平衡。</p>
<p>通过智能冷热分层,企业可以在不牺牲数据可用性的前提下,将长期存储成本降低数倍。对于PB级甚至EB级的数据湖,这种成本优化能力可以为企业节省大量资金,使得海量数据的长期保存成为可能。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eacc1c90e8314f0d83288c97fe808881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=try%2FVa50gZQP%2BUsIIJAenxNnpx4%3D" alt="幻灯片8.png" loading="lazy"/></p>
<h2 data-id="heading-7">▌细粒度权限控制:企业级安全保障</h2>
<p>企业级数据平台必须具备完善的权限控制和安全审计能力。DLF 3.0提供了从用户管理、权限控制到审计治理的全链路安全保障体系。</p>
<p>在用户管理方面,DLF 3.0原生支持阿里云RAM用户体系,基于用户和角色进行权限管理。用户可以通过Open API和REST API进行编程式的权限配置,也可以通过控制台进行可视化管理。</p>
<p>权限控制方面,DLF 3.0支持对湖表设置ACL细粒度权限,可以精确到Catalog、Database、Table、Column(列)甚至Row(行)级别。列级权限允许用户只访问特定的列,行级权限则通过WHERE条件和AND、OR等逻辑运算符,实现对特定行范围的访问控制。列Masking功能可以对敏感字段进行脱敏处理,保护数据隐私。</p>
<p>Data Sharing能力支持跨主账号的数据协作。企业可以将特定的数据集授权给合作伙伴或其他部门,实现安全可控的数据共享。权限检索功能帮助管理员快速了解数据的授权情况,权限委托和授权管理则提供了灵活的权限分级体系。</p>
<p>审计和治理方面,DLF 3.0全面记录所有操作日志,满足生产环境的合规要求。审计管理功能支持漏洞发现和安全治理,帮助企业及时发现和修复安全隐患。这套完整的安全体系,使得DLF 3.0可以满足金融、医疗、政务等高安全要求行业的需求。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d315a473b6c482480dca3fd93946b34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=x8IENH5MQajCb9ywSg%2Bu5rFi5B0%3D" alt="幻灯片9.png" loading="lazy"/></p>
<h2 data-id="heading-8">▌实时湖仓与全模态处理:AI时代的两大刚需</h2>
<p>实时化和全模态化是AI时代数据平台的两大刚需。DLF 3.0在这两个方向上都实现了业界领先的能力。</p>
<p>在实时湖仓方面,DLF 3.0基于Paimon实现了三大核心能力:流式更新、流式订阅、实时查询。数据可以通过Flink等流计算引擎不断流式更新到湖仓中,支持大规模的增量更新和部分列更新。下游系统可以通过流式订阅的方式实时消费变更日志(Changelog),构建实时数据链路。查询层面,Paimon的数据可以被StarRocks、Hologres等OLAP引擎实时查询,延迟可以达到秒级甚至亚秒级。</p>
<p>与业界的Iceberg和Delta相比,Paimon在流式更新场景下具有明显优势。Iceberg和Delta主要面向日志场景,Compaction代价高、速度慢,难以支撑大规模流式增量更新。而中国市场的实时需求走在世界前列,Paimon正是为此而生,通过排序和文件组织优化,大幅降低了Compaction成本,实现了ODS、DWD、DWS全链路的实时更新。</p>
<p>在全模态处理方面,DLF 3.0提供了完整的多模态宽表能力。一张Paimon表可以同时存储id、url、vectors(向量)、labels(标签)、summary(文本摘要)、blobs(大型二进制对象)、meta(元数据)、json(半结构化数据)等多种类型的字段,避免了多表查询和治理负担。统一的存储底层使得数据工程师和AI工程师可以基于同一张表协作,通过高效的索引机制支持向量检索、全文检索、分析查询、模型推理、训练等多种应用场景。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f640430354942e1a42557d8844926a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=2hOuFZmPsNwNtYBfcHK7dnfhPZ4%3D" alt="幻灯片10.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7c535fedf084c0ca03036d9b863ae28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=ocDuzGLPtt7xN4ggqUmiXws7JaM%3D" alt="幻灯片11.png" loading="lazy"/></p>
<p>DLF 3.0还对接了主流的大数据处理和AI预处理框架,包括Spark、Flink、Ray、PyTorch等,提供了PyPaimon等Python原生接口,使得AI工程师可以像操作本地文件一样便捷地访问湖上数据。相比业界的LanceDB等方案,DLF 3.0具有生态丰富、统一性强、工业级验证等优势,已经在阿里巴巴集团和众多外部客户中大规模落地。</p>
<h2 data-id="heading-9">▌典型场景与客户案例:从理论到实践</h2>
<p>DLF 3.0已经在多个典型场景中得到了验证。在离线实时一体化湖仓场景中,通过Flink CDC实现数据库的实时摄取,支持Schema Evolution和整库同步,分钟级实时可查询。Flink在Paimon上进行流读流写,实现全链路实时湖仓,支持低成本的去重和部分列更新。Spark提供数仓级别的批处理性能,支持Filter/Min/Max/TopN/Limit等算子下推和Native计算加速。StarRocks和Hologres则通过Manifests缓存、删除向量、文件过滤等优化技术,实现了对Paimon湖表的极速查询,性能可以对标内表。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8125ae7d2f654e2e855c65f5b18e111e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=2W%2FmHG4XwX%2FKYJbFKYk74OlwFo8%3D" alt="幻灯片12.png" loading="lazy"/></p>
<p>在全模态数据管理和处理场景中,音频、文本、图片、视频等多模态数据通过统一的采集入湖,经过Spark或Ray进行预处理(如文本Chunking、Embedding等),将结构化标签、向量、Blob数据统一存储在一张Paimon表中。AI工程师可以通过Milvus或StarRocks进行向量检索和标量过滤,实现样本圈选和预览。PyPaimon直接对接Ray和PyTorch,支持数据加载和模型训练,整个流程端到端打通,数据无需跨系统迁移。</p>
<p>在客户案例方面,智能汽车向量湖是一个典型应用。自动驾驶场景产生海量的车载数据、地理信息、雷达数据、视频图片等多模态数据。通过DLF 3.0,这些数据统一采集并通过人工或机器打标生成Labels,经过预处理将图片、视频拆解为目标对象,再通过Embedding生成向量。Labels和向量数据构建成统一的向量湖,支持标量+向量混合检索召回,可以快速找到符合特定条件的数据样本,用于AI模型的迭代训练。整个方案实现了从数据采集到推理到检索的完整Pipeline,百亿级数据规模的混合检索性能表现优异。<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d75a9aeaf40d428db8a05c1f47193073~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=VD5RpAJvw95zH1KWHORdu5KCr%2BE%3D" alt="幻灯片13.png" loading="lazy"/></p>
<p>阿里巴巴集团内部的全模态湖也是重要实践。基于Paimon Blob字段,集团构建了EB级的多模态混合存储,支持视频、音频、图片等大型文件的高效管理。通过顺序读高吞吐的数据加载能力,GPU的数据利用率提升了10%,这对于大规模AI训练具有巨大的成本节省价值。这些真实案例充分验证了DLF 3.0全模态湖仓方案的技术先进性和商业价值。<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f355de9d818246e49e7158ec86095bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770983660&amp;x-signature=TrJwZ%2FAaVkS%2BUFuYscKeuQ6ixHI%3D" alt="幻灯片15.png" loading="lazy"/></p>
<h2 data-id="heading-10">▌产品商业化与生态建设</h2>
<p>DLF产品已于2025年正式商业化,现在提供免费试用机会。阿里云还建立了DLF钉钉交流群(群号:106575000021),欢迎用户加入进行技术交流和问题反馈。</p>
<p>全模态湖仓代表了大数据和AI结合发展的下一阶段重要方向。随着多模态AI应用的普及,企业对统一管理和处理异构数据的需求将越来越强烈。DLF 3.0通过开放的架构、强大的性能、完善的企业级能力,为客户提供了一个面向未来的数据平台选择。无论是传统的大数据分析场景,还是新兴的AI训练推理场景,DLF 3.0都可以提供端到端的支持,帮助企业在AI时代保持竞争力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlin中的JvmName注解]]></title>    <link>https://juejin.cn/post/7603556326816071732</link>    <guid>https://juejin.cn/post/7603556326816071732</guid>    <pubDate>2026-02-06T11:58:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603556326816071732" data-draft-id="7603444191448678434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlin中的JvmName注解"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-02-06T11:58:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlin中的JvmName注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T11:58:30.000Z" title="Fri Feb 06 2026 11:58:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>@JvmName 是 Kotlin 中的一个注解（Annotation），主要用于自定义 Kotlin 声明（类、函数、属性等）在 JVM 平台上的名称。</p>
<p>它的核心作用是解决 Kotlin 与 Java 互操作时因命名规则差异导致的兼容性问题，让 Kotlin 代码在 Java 中调用时更灵活、更符合 Java 开发习惯。</p>
<h2 data-id="heading-0">核心作用</h2>
<p>Kotlin 的某些语法特性（如顶层函数、扩展函数、伴生对象方法等）在编译为 JVM 字节码时，默认的命名规则可能与 Java 的预期不一致。</p>
<p>例如：</p>
<p>• Kotlin 的顶层函数会被编译到名为 FileNameKt 的类中（如 Utils.kt 生成 UtilsKt 类），Java 中需通过 UtilsKt.method() 调用。</p>
<p>• Kotlin 的扩展函数在 JVM 中会生成一个静态方法，但方法名可能包含接收者类型信息（如 String.extension() 可能生成 extension(String)）。</p>
<p>@JvmName 允许开发者显式指定这些声明在 JVM 中的名称，避免默认的“不友好”命名，提升跨语言调用的可读性。</p>
<h2 data-id="heading-1">使用场景与示例</h2>
<h3 data-id="heading-2">标注顶层函数/属性（Top-level Declarations）</h3>
<p>Kotlin 的顶层函数（不在任何类或对象中定义的函数）会被编译到一个与文件名相关的类中（默认规则：文件名 + "Kt"）。使用 @JvmName 可以自定义这个类名。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 文件：StringUtils.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"StringHelper"</span>) <span class="hljs-comment">// 自定义 JVM 类名为 StringHelper（替代默认的 StringUtilsKt）</span>

<span class="hljs-keyword">package</span> com.example.utils

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isEmpty</span><span class="hljs-params">(str: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Boolean</span> = str.isEmpty()

<span class="hljs-comment">// 调用（Kotlin）：isEmpty("hello")</span>
<span class="hljs-comment">// 调用（Java，默认）：StringUtilsKt.isEmpty("hello") → 不直观</span>
<span class="hljs-comment">// 调用（Java，使用 @JvmName）：StringHelper.isEmpty("hello") → 更清晰</span>
</code></pre>
<p>说明：</p>
<p>@file:JvmName 需写在文件顶部（package 语句之前），作用于整个文件的顶层声明。value 参数为目标 JVM 类名（无需包名，包名由 package 语句决定）。</p>
<h3 data-id="heading-3">标注扩展函数/属性（Extension Declarations）</h3>
<p>Kotlin 的扩展函数在 JVM 中会生成一个静态方法，方法名默认格式为 扩展函数名(接收者类型)（如 String?.isNullOrEmpty() 生成 isNullOrEmpty(String)）。使用 @JvmName 可以自定义方法名。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 扩展函数：为 String? 添加判空扩展</span>
<span class="hljs-meta">@JvmName(<span class="hljs-string">"isStringNullOrEmpty"</span>)</span> <span class="hljs-comment">// 自定义 JVM 方法名为 isStringNullOrEmpty</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> String?.<span class="hljs-title">isNullOrEmpty</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> = <span class="hljs-keyword">this</span> == <span class="hljs-literal">null</span> || <span class="hljs-keyword">this</span>.isEmpty()

<span class="hljs-comment">// 调用（Kotlin）：str.isNullOrEmpty()</span>
<span class="hljs-comment">// 调用（Java，默认）：StringUtilsKt.isNullOrEmpty(str) → 方法名不明确</span>
<span class="hljs-comment">// 调用（Java，使用 @JvmName）：StringUtilsKt.isStringNullOrEmpty(str) → 语义更清晰</span>
</code></pre>
<p>说明：</p>
<p>扩展函数的 @JvmName 需标注在函数上，value 参数为目标 JVM 方法名（需符合 Java 方法命名规范）。</p>
<h3 data-id="heading-4">标注伴生对象（Companion Object）的方法/属性</h3>
<p>伴生对象的成员默认在 JVM 中通过 Companion 接口访问（如 MyClass.Companion.create()）。结合 @JvmStatic 和 @JvmName，可以进一步自定义方法名。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// 默认：Java 中需通过 MyClass.Companion.newInstance()</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">()</span></span>: MyClass = MyClass()
        
        <span class="hljs-comment">// 使用 @JvmStatic + @JvmName：Java 中可直接通过 MyClass.newObj()</span>
        <span class="hljs-meta">@JvmStatic</span>
        <span class="hljs-meta">@JvmName(<span class="hljs-string">"newObj"</span>)</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createInstance</span><span class="hljs-params">()</span></span>: MyClass = MyClass()
    }
}

<span class="hljs-comment">// 调用（Java）：</span>
<span class="hljs-comment">// MyClass.Companion.create() → 原始方式</span>
<span class="hljs-comment">// MyClass.newObj() → 自定义名称和静态访问</span>
</code></pre>
<p>说明：</p>
<p>@JvmName 可与 @JvmStatic 配合使用，同时控制方法的 JVM 名称（静态化）和访问方式。</p>
<h3 data-id="heading-5">标注类/接口的别名（Type Aliases）</h3>
<p>Kotlin 的类型别名（typealias）在 JVM 中默认不直接暴露，但结合 @JvmName 可以为类型别名指定一个“虚拟”的 JVM 类名（通常用于文档或反射场景）。</p>
<p>示例：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@JvmName(<span class="hljs-string">"UserIdAlias"</span>)</span>
<span class="hljs-keyword">typealias</span> UserId = <span class="hljs-built_in">Long</span>

<span class="hljs-comment">// 反射时可通过 "UserIdAlias" 识别该类型别名（实际仍是 Long）</span>
</code></pre>
<h2 data-id="heading-6">注意事项</h2>
<p>• 避免名称冲突：自定义的 JVM 名称不能与同一包下的其他类/方法重名，否则会导致编译错误。</p>
<p>• 与 @JvmMultifileClass 配合：若多个 Kotlin 文件使用相同的 @file:JvmName，需添加 @file:JvmMultifileClass 注解，将这些文件的顶层声明合并到同一个 JVM 类中（适用于工具类拆分）。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// File1.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"StringUtils"</span>)
<span class="hljs-meta">@file:JvmMultifileClass</span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">func1</span><span class="hljs-params">()</span></span> {}

<span class="hljs-comment">// File2.kt</span>
<span class="hljs-meta">@file:JvmName</span>(<span class="hljs-string">"StringUtils"</span>)
<span class="hljs-meta">@file:JvmMultifileClass</span>
<span class="hljs-keyword">package</span> com.example.utils
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">func2</span><span class="hljs-params">()</span></span> {}

<span class="hljs-comment">// Java 中可统一通过 StringUtils.func1() 和 StringUtils.func2() 调用</span>
</code></pre>
<p>• 注解位置限制：@JvmName 的位置需严格遵循语法规则（如 @file:JvmName 必须在文件顶部，@JvmName 标注函数/属性时需直接作用于声明）。</p>
<h2 data-id="heading-7">总结</h2>
<p>@JvmName 是 Kotlin 与 JVM 平台交互的重要工具，通过自定义声明在 JVM 上的名称，解决了 Kotlin 语法特性（如顶层函数、扩展函数）在 Java 中调用的兼容性问题。合理使用 @JvmName 可以显著提升跨语言代码的可读性和可维护性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL 数据库中的锁有哪些？一篇文章给你讲明白]]></title>    <link>https://juejin.cn/post/7603561363571081279</link>    <guid>https://juejin.cn/post/7603561363571081279</guid>    <pubDate>2026-02-06T09:42:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603561363571081279" data-draft-id="7603383059152257066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL 数据库中的锁有哪些？一篇文章给你讲明白"/> <meta itemprop="keywords" content="数据库,后端"/> <meta itemprop="datePublished" content="2026-02-06T09:42:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="chlk123"/> <meta itemprop="url" content="https://juejin.cn/user/502907612446611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL 数据库中的锁有哪些？一篇文章给你讲明白
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/502907612446611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    chlk123
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:42:43.000Z" title="Fri Feb 06 2026 09:42:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>做后端开发的朋友不管是在开发过程中还是在线上环境，亦或者是面试中，多多少少肯定都遇过 MySQL 锁相关的问题。</p>
<p>其实MySQL锁问题还挺常见的。比如线上业务突然卡顿、线上突然出现事务阻塞、死锁报错，这些问题查到最后发现基本都是 MySQL 锁冲突问题。是不是有时听别人说起行锁、表锁，自己却一头雾水？虽然MySQL 里的锁看起来五花八门，但其实 MySQL 的锁说复杂也复杂，说简单吧，理清分类逻辑就能理解了。</p>
<p>下面一张图告诉你从不同的维度理解MySQL的锁。
<img src="https://coze-coding-project.tos.coze.site/coze_storage_7603657844071661622/image/generate_image_738bf643-f355-425f-8d50-90a210ecfd63.jpeg?sign=1801902147-8517affaaf-0-52f8cb31ae23fdfa0d60cac7bc10977803d639a456ff5d9e54aee206563e2f20" alt="image" loading="lazy"/></p>
<h2 data-id="heading-0">先从分类维度理清楚</h2>
<p>MySQL 的锁说起来复杂，但其实按不同维度拆分一下就清晰多了。咱们可以从最常用的几个分类开始展开说：</p>
<h3 data-id="heading-1">1. 按锁定粒度分：表、行、页级锁</h3>
<p>这应该是最直观的分类了，毕竟锁定的范围直接影响并发性能。</p>
<ul>
<li><strong>表级锁</strong>：开销小，加锁快，也不会出现死锁，但架不住锁定粒度大啊，锁冲突概率直接拉满，并发度就高不起来了。像 MyISAM 引擎就只支持表锁，InnoDB 在特殊情况（比如全表扫描没用到索引）下也会触发表锁。</li>
<li><strong>行级锁</strong>：InnoDB 的看家本领，锁定粒度最小，锁冲突概率最低，并发度自然最高。但是吧，它开销大、加锁慢，还容易出现死锁，毕竟每个事务都盯着不同的行，一不小心就互相等对方释放锁了。</li>
<li><strong>页级锁</strong>：这个用得不多，开销和加锁时间介于表锁和行锁之间，并发度也就一般般，主要是 BDB 引擎在用，咱们日常开发接触得少，了解就行。</li>
</ul>
<h3 data-id="heading-2">2. 按锁的级别分：共享、排他、意向锁各司其职</h3>
<p>这个维度是围绕读写操作的权限来的，核心就是解决 "能不能同时读"、"能不能同时写" 的问题：</p>
<ul>
<li><strong>共享锁（S 锁 / 读锁）</strong>：顾名思义，就是多个事务可以同时加的锁，加了之后只能读不能改。比如执行<code>select ... lock in share mode</code>，其他事务也能加 S 锁读，但想加写锁就得等了。</li>
<li><strong>排他锁（X 锁 / 写锁）</strong>：这就霸道多了，一个事务加了 X 锁，其他事务啥锁都加不了，只能等着。像<code>update</code>、<code>delete</code>语句，InnoDB 会自动给涉及的行加 X 锁，<code>select ... for update</code>也能手动加。</li>
<li><strong>意向锁（IS/IX）</strong>：这个是 InnoDB 为了快速判断表中有没有行锁而搞的 "前置锁"。比如你要给某行加 S 锁，得先给表加 IS 意向共享锁；要加 X 锁，先加 IX 意向排他锁。这样当有人想加表锁的时候，不用逐行检查有没有锁，看一眼意向锁就知道了，省了不少事儿。</li>
</ul>
<h3 data-id="heading-3">3. 其他实用分类</h3>
<p>除了上面两个核心维度，还有几个分类也得知道：</p>
<ul>
<li><strong>按操作划分</strong>：DML 锁（针对数据增删改查）、DDL 锁（针对表结构修改），比如执行<code>alter table</code>的时候，就会加 DDL 写锁，阻塞所有 DML 操作。</li>
<li><strong>按加锁方式划分</strong>：自动锁（比如 InnoDB 执行<code>update</code>自动加 X 锁）和显示锁（比如手动执行<code>lock tables</code>或者<code>select ... for update</code>）。</li>
<li><strong>按并发策略划分</strong>：悲观锁和乐观锁。悲观锁就是默认觉得会有冲突，先加锁再操作，比如前面说的 X 锁、S 锁；乐观锁则是默认没冲突，用版本号或者时间戳来控制，比如更新的时候加个<code>where version = 1</code>，只有版本匹配才更新，适合并发冲突少的场景。</li>
</ul>
<h2 data-id="heading-4">几种具体的常用锁</h2>
<p>光说分类太抽象，咱们可以看看实际开发中经常遇到的锁：</p>
<h3 data-id="heading-5">全局锁：锁整个数据库实例</h3>
<p>听名字就知道范围有多大了，执行<code>flush tables with read lock</code>（FTWRL）就能给整个库加全局读锁，加了之后整个库就只读了，增删改、DDL、事务提交全都会被阻塞。
这个锁主要用在全库逻辑备份的时候，但要注意，InnoDB 可以用<code>mysqldump --single-transaction</code>来做一致性备份，不用加全局锁，因为它会启动一个事务，利用 MVCC 拿到一致性视图。但是吧，如果是 MyISAM 这种不支持事务的引擎，那还是得用 FTWRL。
这里要提个坑，别用<code>set global readonly = true</code>来代替 FTWRL，因为如果客户端异常断开，FTWRL 会自动释放锁，但<code>readonly</code>不会，搞不好就把库一直锁在那儿了。</p>
<h3 data-id="heading-6">元数据锁（MDL）：表结构守护者</h3>
<p>这个锁是 InnoDB 自动加的，你甚至感知不到它的存在，但它却很重要。比如你执行<code>select</code>、<code>update</code>这些 DML 操作，InnoDB 会自动加 MDL 读锁；执行<code>alter table</code>这种 DDL 操作，会加 MDL 写锁。
MDL 读锁之间不互斥，读锁和写锁、写锁和写锁是互斥的，这样就能防止一个事务在修改数据的时候，另一个事务突然改了表结构，导致数据不一致。
这里有个容易踩的坑：MDL 锁是在事务开始时申请，事务提交后才释放的。比如你开了一个事务，只是执行了一个<code>select</code>，这时候加了 MDL 读锁，然后你一直不提交事务，这时候别人要执行<code>alter table</code>就会被卡住，直到你提交事务。我之前就碰到过一次，排查了半天才发现是个没提交的事务占着 MDL 锁，真是血泪教训啊!
<img src="https://coze-coding-project.tos.coze.site/coze_storage_7603657844071661622/image/generate_image_db188797-e78c-40ee-ae6e-9309322da893.jpeg?sign=1801902180-a920b589c9-0-61bff1382cf2d94872609d7fd3349f6f4f6f1ddd2cd13bb461bc3fa916bd2003" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">行级锁的细分：记录锁、间隙锁、临键锁</h3>
<p>InnoDB 的行锁其实还有更细的划分，主要是为了解决幻读问题：</p>
<ul>
<li><strong>记录锁</strong>：就是给某一行记录加锁，比如<code>update user set name = '张三' where id = 1</code>，如果 id 是主键，那就是给 id=1 的这行加记录锁。</li>
<li><strong>间隙锁</strong>：这个是 InnoDB 在 RR（可重复读）隔离级别下才有的，它锁住的是两个索引记录之间的间隙，比如表中 id 有 1、3、5，执行<code>select * from user where id between 1 and 5 for update</code>，会锁住 (1,3)、(3,5) 这两个间隙，防止其他事务在中间插入 id=2 或 4 的记录，解决幻读问题。</li>
<li><strong>临键锁</strong>：这个是记录锁 + 间隙锁的组合，默认情况下 InnoDB 在 RR 隔离级别下加的行锁都是临键锁。比如执行<code>select * from user where id &gt; 3 for update</code>，会锁住 (3,5]、(5, +∞) 这些区间，既锁住了存在的记录，也锁住了可能插入的间隙。</li>
</ul>
<p><img src="https://coze-coding-project.tos.coze.site/coze_storage_7603657844071661622/image/generate_image_69f14d74-fee3-44bf-9607-fd38466ff54c.jpeg?sign=1801902160-0c1b954a34-0-dad0219fdee9363dfe53505b097bc986646edb0310e6d049b2edf17ad09a8dfe" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">最后聊聊锁的坑和优化建议</h2>
<p>说了这么多，再给大家提几个注意事项：</p>
<ol>
<li><strong>行锁变表锁</strong>：InnoDB 的行锁是基于索引的，如果你的查询没用到索引，或者索引失效了，那 InnoDB 就会退化成表锁，比如<code>update user set name = '张三' where name = '李四'</code>，如果 name 没有索引，那就是全表扫描，加表锁，并发瞬间就没了。</li>
<li><strong>死锁问题</strong>：行锁容易出现死锁，比如事务 A 锁住了行 1，等着行 2；事务 B 锁住了行 2，等着行 1，这就死锁了。InnoDB 默认会开启死锁检测，发现死锁后会回滚代价小的事务，也可以通过<code>innodb_lock_wait_timeout</code>设置等待超时时间，默认是 50 秒。</li>
<li><strong>合理选择隔离级别</strong>：如果你的业务能接受幻读，把隔离级别改成 RC（读已提交），那 InnoDB 就不会用间隙锁和临键锁了，能减少锁冲突，提升并发性能。</li>
</ol>
<p>其实吧，MySQL 的锁虽然多，但只要理清分类，理解每种锁的适用场景和底层逻辑，遇到问题的时候就能快速定位了。比如线上出现锁等待，先看看是表锁还是行锁，再看看是哪个事务占着锁，一步步排查总能解决的。</p>
<p>最后想问下，你在开发中遇到过最头疼的锁问题是什么？欢迎在评论区交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BigInt 与 Number 的爱恨情仇，为何大佬都劝你“能用 Number 就别用 BigInt”？]]></title>    <link>https://juejin.cn/post/7603393977477447706</link>    <guid>https://juejin.cn/post/7603393977477447706</guid>    <pubDate>2026-02-06T09:50:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603393977477447706" data-draft-id="7603321550247346226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BigInt 与 Number 的爱恨情仇，为何大佬都劝你“能用 Number 就别用 BigInt”？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T09:50:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gogo1121"/> <meta itemprop="url" content="https://juejin.cn/user/4162081326907051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BigInt 与 Number 的爱恨情仇，为何大佬都劝你“能用 Number 就别用 BigInt”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4162081326907051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gogo1121
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:50:29.000Z" title="Fri Feb 06 2026 09:50:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>最近在写业务逻辑时，遇到一个非常诡异的 Bug。</p>
<p>数据库里的 User ID 是 <code>101092432494557966</code>，但是前端请求回来的数据里，ID 竟然变成了 <code>101092432494557970</code>！</p>
<p>尾数的 <code>66</code> 变成了 <code>70</code>，导致前端拿这个 ID 去查详情时，直接报 404 Not Found。</p>
<p>这简直是“灵异事件”。查了一圈代码，发现罪魁祸首竟然是 <strong>JavaScript 的 Number 类型</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟案发现场</span>
<span class="hljs-keyword">const</span> dbId = <span class="hljs-number">101092432494557966n</span>; <span class="hljs-comment">// BigInt 从数据库出来</span>
<span class="hljs-keyword">const</span> apiResponse = <span class="hljs-title class_">Number</span>(dbId); <span class="hljs-comment">// 手贱转成了 Number</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(apiResponse); 
<span class="hljs-comment">// 输出: 101092432494557970 😱</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>为什么会这样？这就引出了今天的主角：<strong>BigInt</strong> 与 <strong>Number</strong>。</p>
<hr/>
<h2 data-id="heading-0">🔍 原理剖析：Number 的“安全区”</h2>
<p>JavaScript 的 <code>Number</code> 类型本质上是 <strong>IEEE 754 双精度浮点数</strong>。</p>
<p>它不是无限精度的，它只有 <strong>53 个二进制位</strong> 用来存储有效数字（尾数）。</p>
<h3 data-id="heading-1">1. 安全整数范围</h3>
<p>JS 能“精准”表示的最大整数是 <code>Number.MAX_SAFE_INTEGER</code>，即 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>53</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{53} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">53</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>。</p>
<p>数值为：<strong>9,007,199,254,740,991</strong>（约 9 千万亿）。</p>
<h3 data-id="heading-2">2. 精度丢失的真相</h3>
<p>一旦数字超过这个安全范围（比如上面的 18 位 ID），Number 的“刻度尺”就不够用了。它无法分辨 <code>...966</code> 和 <code>...970</code> 之间的微小差别，只能进行“四舍五入”，强制对齐到最近的一个可表示数值。</p>
<p>这就是为什么你的 ID 会变异。</p>
<hr/>
<h2 data-id="heading-3">⚔️ BigInt 的救赎与“三宗罪”</h2>
<p>为了解决这个问题，ES2020 推出了 <code>BigInt</code>。它可以表示任意大的整数。</p>
<p>看起来很美好对吧？数据库里的 <code>bigint</code> 字段直接映射成 JS 的 <code>BigInt</code> 好像很完美。</p>
<p><strong>但是，在实际工程中，BigInt 其实是个“刺头”。</strong> 很多资深开发者的原则是：<strong>除非迫不得已，尽量用 Number。</strong></p>
<p>为什么？因为 BigInt 有三大“工程痛点”：</p>
<h3 data-id="heading-4">痛点一：JSON 序列化炸弹（最致命）</h3>
<p>这是 Node.js/NestJS 开发中最容易踩的坑。</p>
<p><strong><code>JSON.stringify</code> 不支持 BigInt！</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">100n</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"John"</span>
};

<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user);
<span class="hljs-comment">// ❌ 报错: TypeError: Do not know how to serialize a BigInt</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>如果你的接口直接返回了包含 BigInt 的对象，整个请求会直接 500 挂掉。你必须手动处理每一个字段，或者配置全局拦截器，非常麻烦。</p>
<h3 data-id="heading-5">痛点二：生态隔离</h3>
<p>JavaScript 生态中 99% 的第三方库（Lodash, Chart.js, Mathjs, Excel 导出库等）都是基于 <code>Number</code> 设计的。</p>
<p>如果你传一个 <code>BigInt</code> 进去，它们大概率会报错，或者计算出奇怪的结果。为了兼容，你不得不转来转去，代码写得像通心粉。</p>
<h3 data-id="heading-6">痛点三：严苛的类型运算</h3>
<p>JS 不允许 BigInt 和 Number 混合运算，必须显式转换。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">money</span> = <span class="hljs-number">100</span>n<span class="hljs-comment">;</span>
const <span class="hljs-attr">tax</span> = <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>

// ❌ 报错: Cannot mix BigInt and other types
const <span class="hljs-attr">total</span> = money + tax<span class="hljs-comment">; </span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>这在业务逻辑复杂的代码中，会增加大量的心智负担。</p>
<hr/>
<h2 data-id="heading-7">💡 最佳实践：怎么选？怎么存？怎么传？</h2>
<p>既然 Number 有精度上限，BigInt 又难用，我们在项目中到底该怎么办？</p>
<p>以下是经过实战验证的 <strong>“黄金法则”</strong> 。</p>
<h3 data-id="heading-8">1. 什么时候必须用 BigInt？</h3>
<p>只有满足以下条件时，才引入 BigInt：</p>
<ul>
<li><strong>分布式 ID (Snowflake)</strong> ：如 Twitter 雪花算法生成的 ID（18-19 位），必超 Number 安全范围。</li>
<li><strong>高精度时间戳</strong>：纳秒级计时。</li>
<li><strong>加密货币/金融</strong>：涉及比特币等超大数值计算。</li>
</ul>
<h3 data-id="heading-9">2. 什么时候坚决用 Number？</h3>
<ul>
<li><strong>金额（分）</strong> ：只要业务不超过 <strong>9 千万亿</strong>（相信我，你公司的业务很难超过这个数），存“分”用 Number 绰绰有余。</li>
<li><strong>普通自增 ID</strong>：MySQL 的自增主键。</li>
<li><strong>数量、库存、点赞数</strong>。</li>
</ul>
<p><strong>理由</strong>：享受原生 JSON 支持，享受极致的 CPU 浮点运算速度，兼容所有第三方库。</p>
<h3 data-id="heading-10">3. 工程化解决方案（核心）</h3>
<p>针对“ID 精度丢失”和“JSON 报错”问题，标准的解决链路如下：</p>
<ul>
<li>
<p><strong>数据库层</strong>：必须用 <code>BIGINT</code> 或 <code>VARCHAR</code> 存储，确保源头不丢。</p>
</li>
<li>
<p><strong>后端计算层</strong>：</p>
<ul>
<li>如果是 ID：用 <code>BigInt</code> 或 <code>String</code> 传递。</li>
<li>如果是金额：用 <code>Number</code> 计算（在安全范围内）。</li>
</ul>
</li>
<li>
<p><strong>接口返回层（DTO）—— 关键一步！</strong></p>
</li>
</ul>
<p><strong>千万不要把 BigInt 直接丢给前端！</strong></p>
<p><strong>千万不要把 BigInt 转成 Number 丢给前端！</strong></p>
<p>✅ <strong>正确做法</strong>：在返回给前端的那一刻，把 <strong>大数 ID 转成 String</strong>。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// NestJS DTO 示例</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Transform</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'class-transformer'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDto</span> {
  <span class="hljs-comment">// 1. 数据库里是 BigInt</span>
  <span class="hljs-comment">// 2. 这里的 Transform 负责在序列化给前端时，转成 String</span>
  <span class="hljs-meta">@Transform</span>(<span class="hljs-function">(<span class="hljs-params">{ value }</span>) =&gt;</span> <span class="hljs-title class_">String</span>(value))
  <span class="hljs-attr">unionId</span>: <span class="hljs-built_in">string</span>; 

  <span class="hljs-comment">// 金额如果没超限，直接用 Number</span>
  <span class="hljs-attr">balance</span>: <span class="hljs-built_in">number</span>; 
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>前端 JavaScript 处理大数 ID 的唯一标准方案就是：<strong>把它当字符串处理</strong>。</p>
<hr/>
<h2 data-id="heading-11">📝 总结</h2>
<ol>
<li>
<p><strong>精度陷阱</strong>：超过 16 位的数字用 <code>Number</code> 存一定会丢精度，ID 会变异。</p>
</li>
<li>
<p><strong>序列化坑</strong>：<code>BigInt</code> 无法被 JSON 序列化，会导致接口报错。</p>
</li>
<li>
<p><strong>选型原则</strong>：</p>
<ul>
<li><strong>能用 Number 就用 Number</strong>（金额、计数、普通 ID）。</li>
<li><strong>超长 ID 必须用 BigInt/String</strong>。</li>
</ul>
</li>
<li>
<p><strong>传输原则</strong>：后端计算可以用 BigInt，但<strong>给前端的数据，必须是 String</strong>。</p>
</li>
</ol>
<p>以后再看到后端传回来的 ID 尾数不对，别犹豫，直接去检查是不是中间某一步被偷偷转成 <code>Number</code> 了！</p>
<hr/>
<p><em>觉得有用的话，点赞收藏防踩坑！</em> 👍</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多卡数据切换流程]]></title>    <link>https://juejin.cn/post/7603359026711592970</link>    <guid>https://juejin.cn/post/7603359026711592970</guid>    <pubDate>2026-02-06T09:39:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026711592970" data-draft-id="7603359026711576586" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多卡数据切换流程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T09:39:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多卡数据切换流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:39:01.000Z" title="Fri Feb 06 2026 09:39:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1️⃣ <strong>整体流程架构</strong></h2>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────┐
│ 用户操作：在设置中选择默认数据卡                         │
└──────────────────┬──────────────────────────────────────┘
                   │ Settings<span class="hljs-selector-class">.Global</span><span class="hljs-selector-class">.putInt</span>(
                   │ MULTI_SIM_DATA_CALL_SUBSCRIPTION, subId)
                   ▼
┌─────────────────────────────────────────────────────────┐
│ SubscriptionManagerService 监听 WatchedInt 变化         │
│ mDefaultDataSubId<span class="hljs-selector-class">.set</span>(newValue)                         │
│ → Settings<span class="hljs-selector-class">.Global</span> 同步更新                             │
└──────────────────┬──────────────────────────────────────┘
                   │ mDefaultDataSubIdChangedRegistrants
                   │ <span class="hljs-selector-class">.notifyRegistrants</span>()
                   ▼
┌─────────────────────────────────────────────────────────┐
│ MultiSimSettingController                              │
│ EVENT_DEFAULT_DATA_SUBSCRIPTION_CHANGED                 │
│ → <span class="hljs-built_in">onDefaultDataSettingChanged</span>()                         │
└──────────────────┬──────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────────────────────┐
│ PhoneSwitcher                                           │
│ <span class="hljs-built_in">notifyDefaultDataSubChanged</span>()                           │
│ → <span class="hljs-built_in">onEvaluate</span>() 重新评估应该激活哪些 Modem              │
└──────────────────┬──────────────────────────────────────┘
                   │
         ┌─────────┴──────────────┐
         │                        │
         ▼                        ▼
    ┌──────────┐        ┌───────────────┐
    │ 旧数据卡  │        │ 新数据卡       │
    │ 停用      │        │ 激活           │
    │deactivate│        │activate        │
    └────┬─────┘        └────┬──────────┘
         │                    │
         ▼                    ▼
  ┌──────────────┐   ┌──────────────────┐
  │ setDataAllowed│  │ setDataAllowed    │
  │ (false)       │  │ (true)            │
  │ → RIL         │  │ → RIL             │
  └────┬─────────┘   └────┬─────────────┘
       │                   │
       ▼                   ▼
  ┌──────────────┐   ┌──────────────────┐
  │ 释放旧连接    │   │ 建立新连接        │
  │ PDP 去激活    │   │ PDP 激活          │
  │ 网络指示      │   │ 网络指示          │
  └────┬─────────┘   └────┬─────────────┘
       │                   │
       └─────────┬─────────┘
                 │
                 ▼
    ┌─────────────────────────┐
    │ ConnectivityService     │
    │ 更新默认网络            │
    │ 应用切换网络            │
    └─────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-1">2️⃣ <strong>详细执行步骤</strong></h2>
<h3 data-id="heading-2"><strong>Step 1: 用户设置变化 (Settings 层)</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 位置：frameworks_opt_telephony/src/java/com/android/internal/telephony/</span>
<span class="hljs-comment">// subscription/SubscriptionManagerService.java:505-519</span>

mDefaultDataSubId = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WatchedInt</span>(
    Settings.Global.getInt(
        mContext.getContentResolver(),
        Settings.Global.MULTI_SIM_DATA_CALL_SUBSCRIPTION,  ◄──── Key!
        SubscriptionManager.INVALID_SUBSCRIPTION_ID)) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">set</span><span class="hljs-params">(<span class="hljs-type">int</span> newValue)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">oldValue</span> <span class="hljs-operator">=</span> mValue;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">super</span>.set(newValue)) {
            logl(<span class="hljs-string">"Default data subId changed from "</span> + oldValue + <span class="hljs-string">" to "</span> + newValue);
            <span class="hljs-comment">// 同步更新 Settings.Global</span>
            Settings.Global.putInt(mContext.getContentResolver(),
                    Settings.Global.MULTI_SIM_DATA_CALL_SUBSCRIPTION, newValue);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
};
</code></pre>
<p><strong>关键点</strong>：</p>
<ul>
<li><code>WatchedInt</code> 是一个被 "监视" 的整数</li>
<li>当值改变时会自动触发注册的 registrant</li>
<li>同时同步更新到 Settings.Global 数据库</li>
</ul>
<hr/>
<h3 data-id="heading-3"><strong>Step 2: MultiSimSettingController 响应 (协调器)</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 位置：MultiSimSettingController.java:319-350</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyDefaultDataSubChanged</span><span class="hljs-params">()</span> {
    obtainMessage(EVENT_DEFAULT_DATA_SUBSCRIPTION_CHANGED).sendToTarget();
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
    <span class="hljs-keyword">switch</span> (msg.what) {
        <span class="hljs-keyword">case</span> EVENT_DEFAULT_DATA_SUBSCRIPTION_CHANGED:
            onDefaultDataSettingChanged();  ◄──── 处理默认数据卡变化
            <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDefaultDataSettingChanged</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 验证数据卡有效性</span>
    <span class="hljs-comment">// 同步关联订阅的设置（如数据漫游）</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">defaultDataSubId</span> <span class="hljs-operator">=</span> mSubscriptionManagerService.getDefaultDataSubId();
    
    <span class="hljs-comment">// 通知 PhoneSwitcher</span>
    PhoneSwitcher.getInstance().notifyDefaultDataSubChanged();
}
</code></pre>
<p><strong>职责</strong>：</p>
<ul>
<li>协调多张卡的设置</li>
<li>确保同组订阅的设置一致</li>
<li>触发 PhoneSwitcher 的重新评估</li>
</ul>
<hr/>
<h3 data-id="heading-4"><strong>Step 3: PhoneSwitcher 评估 (决策点) ⭐</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 位置：PhoneSwitcher.java:1430-1480</span>

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePreferredDataPhoneId</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 优先级决策：</span>
    
    <span class="hljs-comment">// 1️⃣ 紧急情况：优先级最高</span>
    <span class="hljs-keyword">if</span> (mEmergencyOverride != <span class="hljs-literal">null</span>) {
        mPreferredDataPhoneId = mEmergencyOverride.mPhoneId;
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 2️⃣ 有通话时：如果启用了 "通话期间数据切换"</span>
    <span class="hljs-keyword">if</span> (isAnyVoiceCallActiveOnDevice() &amp;&amp; shouldSwitchDataDueToInCall()) {
        mPreferredDataPhoneId = mPhoneIdInVoiceCall;  <span class="hljs-comment">// 切换到通话卡</span>
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 3️⃣ 自动切换建议：CBRS 等</span>
    <span class="hljs-keyword">if</span> (mAutoSelectedDataSubId != DEFAULT_SUBSCRIPTION_ID) {
        mPreferredDataPhoneId = getPhoneIdBySubId(mAutoSelectedDataSubId);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 4️⃣ 用户选择的默认数据卡：最终方案</span>
    <span class="hljs-keyword">if</span> (SubscriptionManager.isUsableSubIdValue(mPrimaryDataSubId)) {
        mPreferredDataPhoneId = mSubscriptionManagerService.getPhoneId(mPrimaryDataSubId);
    }
}

<span class="hljs-comment">// 关键方法：评估是否需要改变激活的 Modem</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onEvaluate</span><span class="hljs-params">(<span class="hljs-type">boolean</span> requestsChanged, String evaluationReason)</span> {
    logl(<span class="hljs-string">"onEvaluate: "</span> + evaluationReason);
    
    <span class="hljs-keyword">if</span> (updatesIfPhoneInVoiceCallChanged()      ◄──── 通话状态
        || updatesIfSubscriptionChanged()         ◄──── 订阅变化
        || updatesIfActiveModemCountChanged()) {  ◄──── Modem 数
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    
    updatePreferredDataPhoneId();  ◄──── 更新偏好数据 Modem
    
    <span class="hljs-comment">// ... 计算应该激活哪些 Modem ...</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">phoneId</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; phoneId &lt; mActiveModemCount; phoneId++) {
        <span class="hljs-keyword">if</span> (!newActivePhones.contains(phoneId)) {
            deactivate(phoneId);   ◄──── 停用旧数据卡
        }
    }
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> phoneId : newActivePhones) {
        activate(phoneId);         ◄──── 激活新数据卡
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p><strong>决策流程</strong>（优先级从高到低）：</p>
<ol>
<li><strong>紧急通话</strong> - 必须优先</li>
<li><strong>有语音通话且启用通话期间数据切换</strong> - 防止数据丢失</li>
<li><strong>自动切换建议</strong>（如 CBRS）</li>
<li><strong>用户选择的默认数据卡</strong></li>
</ol>
<hr/>
<h3 data-id="heading-5"><strong>Step 4: 停用/激活 Modem (执行层)</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// PhoneSwitcher.java:1307-1322</span>

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">activate</span><span class="hljs-params">(<span class="hljs-type">int</span> phoneId)</span> {
    switchPhone(phoneId, <span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deactivate</span><span class="hljs-params">(<span class="hljs-type">int</span> phoneId)</span> {
    switchPhone(phoneId, <span class="hljs-literal">false</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">switchPhone</span><span class="hljs-params">(<span class="hljs-type">int</span> phoneId, <span class="hljs-type">boolean</span> active)</span> {
    <span class="hljs-type">PhoneState</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> mPhoneStates[phoneId];
    <span class="hljs-keyword">if</span> (state.active == active) <span class="hljs-keyword">return</span>;  ◄──── 避免重复操作
    
    state.active = active;
    logl((active ? <span class="hljs-string">"activate "</span> : <span class="hljs-string">"deactivate "</span>) + phoneId);
    state.lastRequested = System.currentTimeMillis();
    
    sendRilCommands(phoneId);  ◄──── 发送给 RIL
}

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendRilCommands</span><span class="hljs-params">(<span class="hljs-type">int</span> phoneId)</span> {
    <span class="hljs-keyword">if</span> (!SubscriptionManager.isValidPhoneId(phoneId)) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-built_in">this</span>, EVENT_MODEM_COMMAND_DONE, phoneId);
    
    <span class="hljs-keyword">if</span> (mActiveModemCount &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 调用 RIL 的 setDataAllowed</span>
        PhoneFactory.getPhone(phoneId)
            .mCi.setDataAllowed(isPhoneActive(phoneId), message);
                             ▲
                             │
                    ┌────────┴───────────┐
                    │                    │
                 <span class="hljs-literal">true</span> (激活)          <span class="hljs-literal">false</span> (停用)
    }
}
</code></pre>
<p><strong>关键：setDataAllowed 的含义</strong></p>
<ul>
<li><code>true</code> - 告诉 Modem："允许这个 SIM 卡建立数据连接"</li>
<li><code>false</code> - 告诉 Modem："禁止这个 SIM 卡建立数据连接"</li>
</ul>
<hr/>
<h3 data-id="heading-6"><strong>Step 5: RIL 处理 (通信层)</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// RIL.java:4166-4182</span>

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDataAllowed</span><span class="hljs-params">(<span class="hljs-type">boolean</span> allowed, Message result)</span> {
    <span class="hljs-type">RadioDataProxy</span> <span class="hljs-variable">dataProxy</span> <span class="hljs-operator">=</span> getRadioServiceProxy(RadioDataProxy.class);
    <span class="hljs-keyword">if</span> (!canMakeRequest(<span class="hljs-string">"setDataAllowed"</span>, dataProxy, result, 
            RADIO_HAL_VERSION_1_4)) {
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-type">RILRequest</span> <span class="hljs-variable">rr</span> <span class="hljs-operator">=</span> obtainRequest(RIL_REQUEST_ALLOW_DATA, result, 
            mRILDefaultWorkSource);
    
    riljLog(rr.serialString() + <span class="hljs-string">"&gt; setDataAllowed allowed = "</span> + allowed);
    
    <span class="hljs-comment">// 通过 HIDL/AIDL 发送给 Radio HAL</span>
    radioServiceInvokeHelper(HAL_SERVICE_DATA, rr, <span class="hljs-string">"setDataAllowed"</span>, () -&gt; {
        dataProxy.setDataAllowed(rr.mSerial, allowed);
    });
}
</code></pre>
<hr/>
<h3 data-id="heading-7"><strong>Step 6: Modem 处理 (硬件层)</strong></h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// hardware_ril/libril/ril_service.cpp:2359-2363</span>

Return&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title function_">RadioImpl::setDataAllowed</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> serial, <span class="hljs-type">bool</span> allow)</span> {
    RLOGD(<span class="hljs-string">"setDataAllowed: serial %d"</span>, serial);
    
    <span class="hljs-comment">// 发送 RIL 请求到 RIL daemon</span>
    dispatchInts(serial, mSlotId, RIL_REQUEST_ALLOW_DATA, 
            <span class="hljs-number">1</span>, BOOL_TO_INT(allow));
    <span class="hljs-keyword">return</span> Void();
}

<span class="hljs-comment">// Modem 接收到后：</span>
<span class="hljs-comment">// - allow = true:  PDP 激活条件满足，启动连接</span>
<span class="hljs-comment">// - allow = false: PDP 停用，释放连接，断开网络</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">3️⃣ <strong>切换过程中避免网络断连的方案</strong></h2>
<h3 data-id="heading-9"><strong>问题分析</strong></h3>
<pre><code class="hljs language-makefile" lang="makefile">时间线：
<span class="hljs-section">0ms:    用户切换 SIM 卡</span>
<span class="hljs-section">10ms:   旧 SIM 卡 → setDataAllowed(false)</span>
<span class="hljs-section">20ms:   Modem 释放旧连接 ❌ 网络断连（&lt;1s）</span>
<span class="hljs-section">100ms:  新 SIM 卡 → setDataAllowed(true)</span>
<span class="hljs-section">300ms:  新连接建立 ✓ 网络恢复</span>

问题：中间的 80-280ms 内没有数据连接！
应用在这段时间的传输会失败。
</code></pre>
<h3 data-id="heading-10"><strong>优化方案 1: 快速序列（当前实现）</strong></h3>
<pre><code class="hljs language-makefile" lang="makefile">特点：依赖 Modem 的快速处理

时间线：
<span class="hljs-section">0ms:    旧 setDataAllowed(false)  + 新 setDataAllowed(true)</span>
        ↓ 同步发出 (几乎同时)
<span class="hljs-section">10ms:   Modem 收到两个命令</span>
<span class="hljs-section">20ms:   Modem 同时处理：</span>
        - 旧连接 DETACH
        - 新连接 ATTACH
        这个瞬间，新连接可能已经初始化！

优点：速度最快，断连时间 &lt; 100ms
缺点：依赖 Modem 实现，不同厂商行为不同
</code></pre>
<p><strong>代码实现（推荐）</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在 PhoneSwitcher 中修改 switchPhone 逻辑</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">switchPhoneOptimized</span><span class="hljs-params">(<span class="hljs-type">int</span> oldPhoneId, <span class="hljs-type">int</span> newPhoneId)</span> {
    <span class="hljs-comment">// 同步发送两个命令，而不是顺序发送</span>
    <span class="hljs-type">Message</span> <span class="hljs-variable">message1</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-built_in">this</span>, EVENT_MODEM_COMMAND_DONE, oldPhoneId);
    <span class="hljs-type">Message</span> <span class="hljs-variable">message2</span> <span class="hljs-operator">=</span> Message.obtain(<span class="hljs-built_in">this</span>, EVENT_MODEM_COMMAND_DONE, newPhoneId);
    
    PhoneFactory.getPhone(oldPhoneId).mCi.setDataAllowed(<span class="hljs-literal">false</span>, message1);
    PhoneFactory.getPhone(newPhoneId).mCi.setDataAllowed(<span class="hljs-literal">true</span>, message2);
    
    logl(<span class="hljs-string">"Simultaneous switch: "</span> + oldPhoneId + <span class="hljs-string">" -&gt; "</span> + newPhoneId);
}
</code></pre>
<h3 data-id="heading-11"><strong>优化方案 2: 带验证的切换</strong></h3>
<pre><code class="hljs language-makefile" lang="makefile">特点：确保新卡网络有效后再断开旧卡

流程：
<span class="hljs-section">0ms:    激活新 SIM 卡 → setDataAllowed(true)</span>
<span class="hljs-section">100ms:  等待 ConnectivityService 验证网络</span>
<span class="hljs-section">300ms:  验证成功 ✓</span>
<span class="hljs-section">400ms:  此时停用旧卡 → setDataAllowed(false)</span>

优点：保证网络连续性，无断连
缺点：延迟增加（通常 400-500ms）
       短期内有两个连接（费电）

实现位置：PhoneSwitcher.java
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 使用 CellularNetworkValidator 验证网络</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">switchPhoneWithValidation</span><span class="hljs-params">(<span class="hljs-type">int</span> oldPhoneId, <span class="hljs-type">int</span> newPhoneId)</span> {
    <span class="hljs-comment">// 1️⃣ 先激活新卡</span>
    activate(newPhoneId);
    
    <span class="hljs-comment">// 2️⃣ 启动网络验证</span>
    mValidator.validate(getSubIdByPhoneId(newPhoneId),
            <span class="hljs-literal">true</span>,  <span class="hljs-comment">// needValidation</span>
            DataSwitch.Reason.DATA_SWITCH_REASON_USER,
            (validated, subId) -&gt; {
                <span class="hljs-keyword">if</span> (validated) {
                    <span class="hljs-comment">// 3️⃣ 验证成功，停用旧卡</span>
                    logl(<span class="hljs-string">"Network validated, deactivating old phone: "</span> + oldPhoneId);
                    deactivate(oldPhoneId);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// ❌ 验证失败，回滚到旧卡</span>
                    logl(<span class="hljs-string">"Validation failed, reverting to old phone: "</span> + oldPhoneId);
                    deactivate(newPhoneId);
                    activate(oldPhoneId);
                }
            });
}
</code></pre>
<h3 data-id="heading-12"><strong>优化方案 3: 应用缓冲</strong></h3>
<pre><code class="hljs">在应用层实现缓冲，减少切换影响：

1️⃣ 检测到网络切换（ConnectivityManager.NetworkCallback）
2️⃣ 缓冲待发送数据（100-300ms）
3️⃣ 新网络建立后，发送缓冲数据
4️⃣ 提高用户体验

优点：对系统无侵入，应用自主控制
缺点：每个应用都需要实现
</code></pre>
<hr/>
<h2 data-id="heading-13">4️⃣ <strong>应用正在传输数据时的切换处理</strong></h2>
<h3 data-id="heading-14"><strong>场景分析</strong></h3>
<pre><code class="hljs language-makefile" lang="makefile">应用场景：用户在下载时切换 SIM 卡

时间线：
<span class="hljs-section">0ms:    下载 file.bin (SIM1, 10MB, 进度 30%)</span>
<span class="hljs-section">100ms:  用户切换到 SIM2</span>
<span class="hljs-section">110ms:  旧连接断开 ❌</span>
<span class="hljs-section">120ms:  新连接建立</span>
<span class="hljs-section">130ms:  下载继续 (从头？从断点？)</span>

问题：连接中断，下载暂停甚至失败！
</code></pre>
<h3 data-id="heading-15"><strong>Android 系统处理机制</strong></h3>
<pre><code class="hljs language-scss" lang="scss">ConnectivityService 的自动恢复：

事件                    系统行为
─────────────────────────────────────────
<span class="hljs-number">1</span>. 数据连接丢失         DetectableConnectivityError
                        → 回调应用 <span class="hljs-built_in">onLost</span>()
                        
<span class="hljs-number">2</span>. 应用收到 <span class="hljs-built_in">onLost</span>()    应该：
                        - 暂停所有数据传输
                        - 保存进度信息
                        - 等待新网络
                        
<span class="hljs-number">3</span>. 新网络可用           <span class="hljs-built_in">onAvailable</span>()
                        → 应用恢复传输（从断点）
                        
<span class="hljs-number">4</span>. ConnectivityManager
   <span class="hljs-built_in">validateNetwork</span>()     确保新网络真的可用
</code></pre>
<h3 data-id="heading-16"><strong>推荐的应用处理方式</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 位置：应用代码</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataDownloadManager</span>(context: Context) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> connectivityManager = 
        context.getSystemService&lt;ConnectivityManager&gt;()!!
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> networkCallback = <span class="hljs-keyword">object</span> : ConnectivityManager.NetworkCallback() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLost</span><span class="hljs-params">(network: <span class="hljs-type">Network</span>)</span></span> {
            <span class="hljs-comment">// 1️⃣ 检测到网络丢失</span>
            logg(<span class="hljs-string">"Network lost, pausing download"</span>)
            pauseAllDownloads()  <span class="hljs-comment">// 暂停下载</span>
            saveProgress()       <span class="hljs-comment">// 保存进度</span>
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAvailable</span><span class="hljs-params">(network: <span class="hljs-type">Network</span>)</span></span> {
            <span class="hljs-comment">// 2️⃣ 新网络可用</span>
            logg(<span class="hljs-string">"Network available, resuming download"</span>)
            resumeDownloads()    <span class="hljs-comment">// 从断点恢复</span>
        }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCapabilitiesChanged</span><span class="hljs-params">(
            network: <span class="hljs-type">Network</span>,
            caps: <span class="hljs-type">NetworkCapabilities</span>)</span></span> {
            <span class="hljs-comment">// 3️⃣ 检查网络是否已验证</span>
            <span class="hljs-keyword">if</span> (caps.hasCapability(NET_CAPABILITY_VALIDATED)) {
                logg(<span class="hljs-string">"Network validated"</span>)
                <span class="hljs-comment">// 现在安全发送数据</span>
            }
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startMonitoring</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> request = NetworkRequest.Builder()
            .addCapability(NET_CAPABILITY_INTERNET)
            .addCapability(NET_CAPABILITY_NOT_RESTRICTED)
            .build()
        
        connectivityManager.registerNetworkCallback(request, networkCallback)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">pauseAllDownloads</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 暂停所有下载任务</span>
        <span class="hljs-comment">// 记录当前位置</span>
        downloads.forEach { it.pause() }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">saveProgress</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 保存进度到数据库或文件</span>
        downloads.forEach { download -&gt;
            database.updateProgress(download.id, download.currentBytes)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">resumeDownloads</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 从保存的断点恢复</span>
        downloads.forEach { download -&gt;
            <span class="hljs-keyword">val</span> savedProgress = database.getProgress(download.id)
            download.resume(savedProgress)
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-17">5️⃣ <strong>两张卡都是 4G 时的切换延迟分析</strong></h2>
<h3 data-id="heading-18"><strong>延迟来源分解</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">┌─────────────────────────────────────────────────────────┐
│ 多卡数据切换总延迟 = Δt<span class="hljs-emphasis">_total                          │
└─────────────────────────────────────────────────────────┘

Δt_</span>total 包含以下部分：

<span class="hljs-bullet">1.</span> 应用层感知 (10-50ms) 
   Settings.Global 变化 → SubscriptionManagerService

<span class="hljs-bullet">2.</span> MultiSimSettingController 处理 (5-20ms)
   事件分发 → 有效性校验

<span class="hljs-bullet">3.</span> PhoneSwitcher 评估 (20-100ms) ⭐⭐⭐ 最长
<span class="hljs-bullet">   -</span> onEvaluate() 遍历所有网络请求
<span class="hljs-bullet">   -</span> 更新所有优先级
<span class="hljs-bullet">   -</span> 决策激活/停用 Modem
   
<span class="hljs-bullet">4.</span> RIL 命令发送 (5-10ms)
   Java → C++ → HIDL/AIDL 消息传递

<span class="hljs-bullet">5.</span> Modem DETACH (旧卡) (200-500ms) ⭐⭐⭐ 关键
<span class="hljs-bullet">   -</span> 通知网络（NW：释放连接）
<span class="hljs-bullet">   -</span> 等待网络确认
<span class="hljs-bullet">   -</span> 关闭 PDP 上下文
<span class="hljs-bullet">   -</span> 两张都是 4G 时，这通常很快 (200-300ms)

<span class="hljs-bullet">6.</span> Modem ATTACH (新卡) (200-800ms) ⭐⭐⭐ 最不确定
   两张卡都是 4G 时的关键：
   
   a) 搜网 (50-200ms)
<span class="hljs-bullet">      -</span> 如果已经驻留，可能 0-50ms
<span class="hljs-bullet">      -</span> 如果需要搜网，可能 100-200ms
<span class="hljs-code">      
   b) 认证/附着 (100-300ms)
      - MME/HSS 认证
      - GUTI 分配等
      
   c) PDN 建立 (100-300ms)
      - PDP 激活
      - 获取 IP 地址
      
   总计：200-800ms
   
   两张 4G 时优化：
   - 如果两张都已驻留：可降至 200-300ms
   - 如果切换到信号弱的卡：可能 500-800ms
</span>
<span class="hljs-bullet">7.</span> ConnectivityService 检测 (0-100ms)
   onAvailable() 回调

<span class="hljs-bullet">8.</span> 应用感知 (0-1000ms+)
   取决于应用是否监听 NetworkCallback

────────────────────────────────────────────────

总合（最优情况）：
10 + 5 + 50 + 5 + 250 + 250 + 50 + 100 = 720ms

总合（最坏情况）：
50 + 20 + 100 + 10 + 500 + 800 + 100 + 1000 = 2580ms

两张 4G 时的期望值：500-800ms
</code></pre>
<h3 data-id="heading-19"><strong>可接受的延迟基准</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">应用类型               可接受延迟        说明
─────────────────────────────────────────────────
<span class="hljs-bullet">1.</span> 网页浏览            &lt; 3 秒           用户感知不强
<span class="hljs-bullet">2.</span> 实时通话(VoIP)      &lt; 1 秒           时延敏感，需验证
<span class="hljs-bullet">3.</span> 在线游戏            &lt; 500ms          关键，需回滚机制
<span class="hljs-bullet">4.</span> 视频流播放          &lt; 2 秒           需缓冲策略
<span class="hljs-bullet">5.</span> 文件下载            无限制           应用缓冲处理
<span class="hljs-bullet">6.</span> 短视频(抖音)        &lt; 2 秒           用户容忍度低

系统推荐：&lt; 1000ms (1秒)
</code></pre>
<h3 data-id="heading-20"><strong>优化建议（两张 4G）</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 方案 1: 预附着优化（最激进）</span>
<span class="hljs-comment">// 在停用旧卡前，新卡已完全附着</span>
<span class="hljs-comment">// 优点：0ms 断连</span>
<span class="hljs-comment">// 缺点：短期两个活跃连接（耗电）</span>

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">optimizedSwitchWith4G</span><span class="hljs-params">(<span class="hljs-type">int</span> oldPhoneId, <span class="hljs-type">int</span> newPhoneId)</span> {
    <span class="hljs-comment">// 不需要等待验证，直接激活</span>
    logl(<span class="hljs-string">"4G → 4G switch, using fast track"</span>);
    
    <span class="hljs-comment">// 时刻 0ms：激活新卡，同时停用旧卡（并发）</span>
    PhoneFactory.getPhone(newPhoneId).mCi.setDataAllowed(<span class="hljs-literal">true</span>, msg1);
    PhoneFactory.getPhone(oldPhoneId).mCi.setDataAllowed(<span class="hljs-literal">false</span>, msg2);
    
    <span class="hljs-comment">// 预期延迟：200-300ms（纯 ATTACH 时间）</span>
}

<span class="hljs-comment">// 方案 2: 串联优化（平衡）</span>
<span class="hljs-comment">// 新卡 ATTACH 成功后再 DETACH 旧卡</span>

<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">balancedSwitch4G</span><span class="hljs-params">(<span class="hljs-type">int</span> oldPhoneId, <span class="hljs-type">int</span> newPhoneId)</span> {
    PhoneFactory.getPhone(newPhoneId).mCi.setDataAllowed(<span class="hljs-literal">true</span>, 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleCallback</span><span class="hljs-params">()</span> {
                <span class="hljs-comment">// 新卡附着成功</span>
                logl(<span class="hljs-string">"New SIM attached, detaching old"</span>);
                PhoneFactory.getPhone(oldPhoneId)
                    .mCi.setDataAllowed(<span class="hljs-literal">false</span>, msg);
            }
        });
    
    <span class="hljs-comment">// 预期延迟：200-300ms (新) + 200-300ms (旧) = 400-600ms</span>
    <span class="hljs-comment">// 但提供了 100% 的连续性保障</span>
}

<span class="hljs-comment">// 方案 3: 验证优化（最安全）</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">validatedSwitch4G</span><span class="hljs-params">(<span class="hljs-type">int</span> oldPhoneId, <span class="hljs-type">int</span> newPhoneId)</span> {
    mValidator.setValidationCallback((validated, subId) -&gt; {
        <span class="hljs-keyword">if</span> (validated &amp;&amp; subId == getSubIdByPhoneId(newPhoneId)) {
            logl(<span class="hljs-string">"Network fully validated, safe to detach old"</span>);
            PhoneFactory.getPhone(oldPhoneId)
                .mCi.setDataAllowed(<span class="hljs-literal">false</span>, msg);
        }
    });
    
    <span class="hljs-comment">// 预期延迟：200-300ms (ATTACH) + 100-200ms (验证) = 300-500ms</span>
    <span class="hljs-comment">// 最大的延迟，但提供最强的保障</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-21">6️⃣ <strong>性能指标监控</strong></h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 监控数据切换延迟的实现</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSwitchMetrics</span> {
    
    <span class="hljs-keyword">private</span> fun <span class="hljs-title function_">logSwitchEvent</span><span class="hljs-params">(
        oldSubId: Int,
        newSubId: Int,
        startTime: Long,
        endTime: Long
    )</span> {
        <span class="hljs-type">val</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> endTime - startTime
        
        <span class="hljs-title function_">logg</span><span class="hljs-params">(<span class="hljs-string">""</span><span class="hljs-string">"
            Data Switch Metrics:
            Old SubId: $oldSubId
            New SubId: $newSubId
            Duration: ${duration}ms
            Network Continuous: ${duration &lt; 1000}
            
            Recommendation:
            ${when {
                duration &lt; 300 -&gt; "</span>⭐⭐⭐ Excellent<span class="hljs-string">"
                duration &lt; 500 -&gt; "</span>⭐⭐ Good<span class="hljs-string">"
                duration &lt; 1000 -&gt; "</span>⭐ Acceptable<span class="hljs-string">"
                else -&gt; "</span>❌ Poor - Review Modem<span class="hljs-string">"
            }}
        "</span><span class="hljs-string">""</span>.trimIndent()</span>)
        
        <span class="hljs-comment">// 上报到 metrics 系统</span>
        TelephonyMetrics.getInstance().writeDataSwitchEvent(
            mPhoneId,
            oldSubId,
            newSubId,
            duration,
            <span class="hljs-string">"success"</span>
        )
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-22">总结表格</h2>








































<table><thead><tr><th>方面</th><th>指标</th><th>说明</th></tr></thead><tbody><tr><td><strong>两张 4G 最优延迟</strong></td><td>200-300ms</td><td>仅 ATTACH 时间</td></tr><tr><td><strong>推荐延迟</strong></td><td>&lt; 1000ms</td><td>用户基本无感</td></tr><tr><td><strong>不可接受延迟</strong></td><td>&gt; 3000ms</td><td>需要优化系统</td></tr><tr><td><strong>可接受无网时间</strong></td><td>&lt; 500ms</td><td>大多数应用可容忍</td></tr><tr><td><strong>关键优化点</strong></td><td>Modem ATTACH</td><td>占总延迟 30-50%</td></tr><tr><td><strong>推荐切换方案</strong></td><td>验证+串联</td><td>平衡性能和安全</td></tr></tbody></table>
<p>这就是完整的<strong>多卡数据切换流程及优化方案</strong>！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝重复造轮子？我们偏偏花365天，用Vue3写了款AI协同的Word编辑器]]></title>    <link>https://juejin.cn/post/7603563317040021567</link>    <guid>https://juejin.cn/post/7603563317040021567</guid>    <pubDate>2026-02-06T10:07:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603563317040021567" data-draft-id="7603587738159874111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝重复造轮子？我们偏偏花365天，用Vue3写了款AI协同的Word编辑器"/> <meta itemprop="keywords" content="前端,Vue.js,GitHub"/> <meta itemprop="datePublished" content="2026-02-06T10:07:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="徐小夕"/> <meta itemprop="url" content="https://juejin.cn/user/3808363978429613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝重复造轮子？我们偏偏花365天，用Vue3写了款AI协同的Word编辑器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363978429613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    徐小夕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:07:56.000Z" title="Fri Feb 06 2026 10:07:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ps：开源版SDK已发布，github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fjitword-sdk" target="_blank" title="https://github.com/MrXujiang/jitword-sdk" ref="nofollow noopener noreferrer">github.com/MrXujiang/j…</a></p>
<p>又到了我们定期AI创业复盘的时间了。今天和大家分享一下，我们决定花1年时间打造AI Word编辑器的理由，以及做AI文档创业过程中踩过的坑。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7c968f333be4232825b9e88109835e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=a3vfTbhdrEH1thzUfy93HtKLvyk%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-0">为什么"偏偏"要造个Word轮子</h3>
<p>我们之所以下定决心做这件事，主要是因为前两年我们的一个产品，需要集成word能力对外服务，但是我们调研了一圈，得到的结论是：1. 大厂的文档产品集成成本过高，对外商业化受限头部大厂做的文档产品，要么是按次付费（并发次数）：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/250035413bb04bbbb6635e4d472f3dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=fpNuVcXMZr4M1ksBw9QRJpHZgwo%3D" alt="图片" loading="lazy"/>比如上面这张，如果高频使用，我们团队算了一笔账，每年api的调用基本都要花10-20w左右，更别说对外给客户服务了，那成本只有大公司能玩了。另一方面，国内B端客户大部分的Saas场景都需要私有化部署，国企事业金融企业更要求内网部署，所以基本上不可能集成大厂的SDK，这条商业模式已经被堵死了。2. 大厂的文档产品技术债过重，扩展度和开放程度受限这基本上是行业的共识了。普通企业只能用大厂的系统，如果要开发，要么动辄百万，要么就等“等更新”。但是我们的AI文档场景，并不需要很多冗余的功能，而是保留最核心的能力，其他的我们希望开发给企业自定义。同时，现有文档编辑器都是"互联网时代的产物"，为"人写给人看"设计。AI无法真正理解文档结构，只能当"高级搜索框"。我们结合这两年AI的发展，洞察的结果是：内容创作正在从"人驱动"转向"人机协作"，但工具没有跟上。所以综合上面分析，再结合我们团队大厂架构和文档产品的研发经验，我们毅然决定自研。</p>
<h3 data-id="heading-1">365天我们做了什么</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc3f8c610e2f44fb88d480ad8eaf1e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=r3mRfY2H56GW%2FHQpHIAhhlyqC0k%3D" alt="图片" loading="lazy"/></p>
<p>说实话，规划了1年，其实并不是单纯的时间维度的概念，我们打算将 JitWord 打造成一个未来我们 all in 的一个产品长链路的方向：基于JitWord的文档引擎，扩展出企业共建版，JitOffice办公软件，JitCloud AI云服务生态。所以可能未来1-2年，我们还是会持续深耕在“知识内容传承”这个赛道。</p>
<h4 data-id="heading-2">第一步，架构重构：从"富文本"到"结构化数据"</h4>
<p>在做 JitWord 之前，我们对 Office 文档做了大量的调研，从docx格式到文档的复杂操作，都意味着传统的富文本格式（html）难以驾驭复杂的文档场景。</p>
<p>我们也调研了很多开源方案，比如 tiptap，quill，editorjs等。最终我们选择了tiptap的一个早期稳定的版本，作为我们的底层文档组件，并对 tiptap 的架构做了上层的优化，已支持复杂的文档操作。</p>
<p>下面是我们第一版的文档设计架构：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0cdf6f0d5754273bcf5a1dce1ec2ea0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=8KPZ9gQAbJ5e8VdtuHCrODpZ3V0%3D" alt="图片" loading="lazy"/></p>
<p>其实单纯实现类似 Office 的UI界面，难度不是很大，只需要花时间来开发，我相信每一个前端工程师都能实现，其难点在于：</p>
<ul>
<li>如何高效的做文档解析（需要对docx进行高精度格式还原）</li>
<li>如何基于文档做高性能协同（支持多人协同编辑）</li>
<li>如何在web文档处理复杂公式编辑和渲染</li>
<li>实现文档的复杂操作（划词评论，版本对比，高级排版，分页视图等）</li>
<li>实现文档的权限控制和高性能渲染（100w+字秒级渲染）</li>
</ul>
<p>等等，每一个骨头都比较硬，基本上都是我们花大量实现自研，比如：</p>
<p>基于文档做高性能协同（支持多人协同编辑）</p>
<p>目前市面上其实有些协同方案，比如CRDT算法驱动的YJS，当然我们也是基于YJS实现的文档协同算法。但是单纯使用Yjs，只能实现基础协同，在协同过程中我们需要考虑很多复杂场景：</p>
<ol>
<li><strong>操作可交换性</strong>不同用户的操作可以以任意顺序执行，最终结果一致</li>
<li><strong>操作可合并性</strong>多个操作可以智能合并，减少网络传输</li>
<li><strong>最终一致性</strong>所有客户端最终会收敛到相同的文档状态</li>
<li><strong>无需中央协调</strong>不依赖中央服务器进行冲突解决</li>
</ol>
<p>下面是我们设计的协同操作流程：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28c6c8c06b4149e597eb04ff2e35f2e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=C9LIPYMBhVPSpts7v%2FqusAytdaA%3D" alt="图片" loading="lazy"/></p>
<p>在协同编辑的性能上，我们也做了进一步算法优化，保证我们在普通服务器上（2核4G）也能支持10-50人的高效协同编辑，如果扩大服务器性能和集群，我们将有可能支持数千上万人的协同编辑。</p>
<p>下面是我们的文档协同和存储架构数据流：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c8ceb434ec448419584ca467a240d44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=nHApwU752iGZ7cXFPbVQt5bs1WQ%3D" alt="图片" loading="lazy"/></p>
<p>实现在web端处理复杂公式编辑和渲染</p>
<p>基本上市面上的开源方案都达不到我们对复杂公式的极致追求，大部分是让用户直接编辑latex，但是到了导出docx后，公式要么无法导出，要么导出后无法二次编辑。</p>
<p>基于上面的痛点，我们对docx文件做了数据结构的分析和算法层的兼容，同时对用户编辑公式的体验也做了进一步升级：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b28bac938d7448fb0b52669e3f7eec9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=7Kj1imdkqyM6qDW%2FLN5v9DfmiHw%3D" alt="图片" loading="lazy"/></p>
<p>我们提供了数学公式的编辑面板，我们可以实时编辑和预览公式，同时我们内置了100+高频的数学和科研公式，方便大家更快速的编写复杂公式。</p>
<p>下面是渲染到 JitWord 中的公式效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/210501a4476545b68709edab391c0c39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=U6sej6uA6sRS9jkpKyYGEdQt0Rc%3D" alt="图片" loading="lazy"/></p>
<p>同时，我们也能直接导出带复杂公式的文档，并在 word 中二次编辑。</p>
<p>文档的高效渲染（100w字秒级渲染）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cd694d1a9694274a8caa8952a82878a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=hQv31Dznc0upvXxqzUXSu9K4BVo%3D" alt="图片" loading="lazy"/></p>
<p>上面是我们文档中渲染了100w字的效果，目前测试下来还是可以编辑文档，只有略微的延迟。</p>
<p>这一结果归功于我们对文档性能的极致追求，在文档渲染层我们做了极致的优化，并全方面测试了渲染协同稳定性能：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d351c797d3ee48d6a2e5d3b0a18b3684~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=jpoSwMsUcHsKFyuSjsGToqyk8u0%3D" alt="图片" loading="lazy"/></p>
<p>实现文档的复杂操作（划词评论，版本对比，高级排版，分页视图等）</p>
<p>任何一个富文本编辑器，都很难自带划词评论，版本对比，高级排版，分页视图这些高级操作功能。</p>
<p>我们研究这些功能花费了很多时间，也在每个月以2-3个版本的迭代速度更新着JitWord。</p>
<p>终于在2025年底实现了上面提到的这几个功能，下面我也给大家一一介绍一下。</p>
<ol>
<li>划词评论</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/714a3af6670c4738bbf9e7953ff70b53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=LWjeITslk7bHKze33wZ2vjslVFQ%3D" alt="图片" loading="lazy"/></p>
<p>当然大家可不要以为我们只是做了划词评论功能。我们在划词评论之后，还做了通信机制，在多人协同过程中可以实时通知给其他人，让协作者可以第一时间看到划词的内容，这个流程我们完全打通了。</p>
<ol start="2">
<li>版本管理功能</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af625a2b4d2421184a9ef1a7dbc13fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=5c8cSgYGhhUqi28SFCBwabdIH00%3D" alt="图片" loading="lazy"/></p>
<p>我们的操作会定期存储，可以一键恢复，并支持版本的差异对比。这个功能基本上也是市面上web端文档独一份的，当然我们还在持续优化。</p>
<ol start="3">
<li>分页视图功能</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1272cefcd6e44ee6ae1233b0c013d61d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=GjpE88XMMBumcRO0h%2FSNRYP%2FFJk%3D" alt="图片" loading="lazy"/></p>
<p>这个功能是最难坑的，不容置疑。但是我们花了2个月 all in 这个功能，终于实现了类似 word 的分页功能。它的难点在于分页之后内容的排版和位置自动计算机制，需要消耗大量的 js 性能，所以我们各种性能优化的方式都用上了，结合我们设计的独有的dom组织模式，终于实现了分页能力。</p>
<p>大家可以在 JitWord 共建版体验到分页的功能。</p>
<p>当然，我们还会支持页眉页脚功能，全面对标 Office。</p>
<h4 data-id="heading-3">第二步，AI协作引擎：让文档"活"起来</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634d1de9f8a548febde3c2055b9cd8f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=ZjGbLfQrJvHjFsWwoJEiNocpRA8%3D" alt="图片" loading="lazy"/></p>
<p>上面是我们设计的 AI Native 驱动的模式架构，保证我们在文档编辑的全生命周期里，都能体验AI创作的乐趣。</p>
<p>下面是演示效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/200058913ded48029f40438f675d9314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=kkG%2FryVsDDhlVR5zww%2B8ixK5wSw%3D" alt="图片" loading="lazy"/></p>
<p>我们除了直接让AI创作内容，还可以基于文本和段落，进行二次AI优化，比如文本润色，纠错，续写等：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfd24db496274d5fbef315455238b6d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=A8N5N%2F1MoTEnN0PczeNx3akKsEc%3D" alt="图片" loading="lazy"/></p>
<p>最近我们还迭代上线了AI公文助手，可以通过AI一键生成合同和公文：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d9f222858304e2f95f2406e5bb1d523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=Y62ZGXAlvKcx9OGYeFU3%2BDE9ers%3D" alt="图片" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1679d5973384d3d8549764c52681428~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=VIJZEIArqtiXehXWNLF3Tw8OecI%3D" alt="图片" loading="lazy"/></p>
<p>当然后续会实现更多和AI结合的场景，提高用户办公的效率。</p>
<h4 data-id="heading-4">第三步，Vue3的执念：为什么死磕Vue？</h4>
<p>很多人问：文档编辑器为什么要强调Vue3？用React不是生态更好？</p>
<p>我们的回答是：<strong>响应式性能决定了AI协作的流畅度</strong>。</p>
<p><strong>技术细节：</strong></p>
<ul>
<li><strong>Proxy-based响应式</strong>：10万字符文档的实时协作，传统<code>Object.defineProperty</code>会卡成PPT，Vue3的Proxy实现了毫秒级更新</li>
<li><strong>Composition API</strong>：AI建议卡片、协作光标、公式渲染器……这些复杂组件的组合逻辑，用Composables管理比HOC清晰10倍</li>
<li><strong>Tree-shaking友好</strong>：最终打包体积比同类React方案小40%，SaaS嵌入时客户感知明显</li>
</ul>
<p><strong>一个真实案例：</strong></p>
<p>一个客户把我们的产品嵌入他们的CRM系统，原先用的React方案首屏加载3.2s，替换为 JitWord 后降到1.1s。客户CTO的原话："<strong>你们这个Vue3版本，让我们的SaaS看起来像原生应用。</strong> "</p>
<p>这就是"造轮子"的意义：<strong>不是为造而造，是为跑得更快。</strong></p>
<p><strong>并且国产化环境，很多客户都是更倾向用 Vue 技术栈，所以站在客户和用户体验的角度，我们Vue的策略是完全经得起考验的。</strong></p>
<h2 data-id="heading-5">拒绝自嗨，持续打磨应用场景</h2>
<p>技术人最容易犯的错：拿着锤子找钉子。</p>
<p>我们花了两个月时间，把产品扔到真实场景里验证，我们上线了我们开源SDK，让大家可以集成到自己的真实项目中来体验：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cae120bad14e6794b3ec1c119bc845~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=Rol6Il4XpEMNHMHPj2%2BQanBdvwE%3D" alt="图片" loading="lazy"/></p>
<p>目前有各行各业的客户给我们反馈了大量的建议，我们也在持续排期优化，下面分享一下我们内部的需求列表：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a04b1c625d84216b3432ca23083da98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5bCP5aSV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770977276&amp;x-signature=Yf%2Buu65XpNIGSmtnBclkPpEzDHo%3D" alt="图片" loading="lazy"/></p>
<p>目前已经有100多个我们评估后觉得非常有价值的功能点，在今年的一年里，我们会陆续上线。</p>
<p>当然大家有好的建议，也欢迎随时交流反馈～</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrXujiang%2Fjitword-sdk" target="_blank" title="https://github.com/MrXujiang/jitword-sdk" ref="nofollow noopener noreferrer">github.com/MrXujiang/j…</a></p>
<hr/>
<h2 data-id="heading-6">开源与商业化思考</h2>
<p>写到这里，必须回答那个最尖锐的问题：</p>
<blockquote>
<p><strong>你们最后要卖钱吗？还是说只是技术情怀？</strong></p>
</blockquote>
<p>我的答案是：<strong>部分开源，商业闭环。</strong></p>
<hr/>
<h3 data-id="heading-7">为什么开源？</h3>
<p>开源了基础的文档引擎SDK，包括：</p>
<ul>
<li>结构化文档模型</li>
<li>Vue3组件基础</li>
<li>公式渲染模块</li>
<li>docx导入导出功能</li>
</ul>
<p><strong>目的不是做慈善，是建立标准。</strong></p>
<p>如果 JitWord 的文档模型成为行业事实标准，第三方开发者自然会基于我们的格式开发插件。这等于用社区力量帮我们扩展生态——<strong>比招100个产品经理都有效</strong>。</p>
<hr/>
<h3 data-id="heading-8">为什么保留商业版？</h3>
<p>商业版包含：</p>
<ul>
<li>AI协作引擎（调用大模型API，成本敏感）</li>
<li>企业级协作功能（权限管理、审计日志）</li>
<li>SaaS嵌入解决方案</li>
</ul>
<p><strong>这不是"开源版阉割功能"，是"开源版定义基础，商业版解决复杂问题"。</strong></p>
<p>类比：Android开源，但GMS（Google服务）收费；MySQL开源，但企业版有高级监控。这是经过验证的商业模式。</p>
<p><strong>一个创业者的坦白：</strong></p>
<p>我们考虑过完全开源、靠服务变现。但过去一年和几十家企业聊过后，我发现<strong>B端客户真正付费的不是"软件"，是"确定性"</strong> ——出了问题能找到人、能签SLA、能定制开发。这些只能靠商业团队支撑。</p>
<p><strong>所以，造轮子不是目的。</strong></p>
<p><strong>让轮子跑得更快，让更多人用上更快的轮子，同时让造轮子的人能持续造下去——这才是目的。</strong></p>
<hr/>
<p><strong>关于作者</strong>：前大厂技术专家，现 JitWord 联合创始人。相信AI时代的生产力工具，应该由懂产品和技术的人重新做一遍。</p>
<p>我们团队均来自一线中大厂，资深工程师和技术专家，配合3个Agent，开启6人协作的创业之旅～</p>
<p>如果大家有好的建议，想法，欢迎留言反馈～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Telephony 数据恢复与容错机制详解]]></title>    <link>https://juejin.cn/post/7603347438013579299</link>    <guid>https://juejin.cn/post/7603347438013579299</guid>    <pubDate>2026-02-06T09:43:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603347438013579299" data-draft-id="7603309951227576370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Telephony 数据恢复与容错机制详解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T09:43:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Telephony 数据恢复与容错机制详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:43:45.000Z" title="Fri Feb 06 2026 09:43:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、数据卡死检测机制</h3>
<h4 data-id="heading-1">1. 检测层次结构</h4>
<pre><code class="hljs language-scss" lang="scss">ConnectivityService (网络连接服务)
    ↓
NetworkMonitor (网络监控)
    ↓ (检测方法)
  ├─ DNS Events (DNS超时检测)
  ├─ TCP Metrics (TCP失败率检测)
  └─ IPv4/IPv6 探针 (ICMP Reachability)
    ↓
数据卡死判定
    ↓
DataStallRecoveryManager (DSRM - 数据卡死恢复管理器)
</code></pre>
<h4 data-id="heading-2">2. 数据卡死的定义</h4>
<p>根据代码注释，数据卡死是指：</p>
<ul>
<li><strong>DNS 事件</strong>：连续多个 DNS 超时</li>
<li><strong>TCP 指标</strong>：TCP 包失败率超过阈值</li>
<li><strong>网络探针失败</strong>：无法到达任何网关/DNS 服务器</li>
</ul>
<p>这些指标由 <code>NetworkMonitor</code> 实时监测，当条件触发时，通过以下路径上报：</p>
<pre><code class="hljs language-scss" lang="scss">NetworkMonitor
  → ConnectivityService<span class="hljs-selector-class">.notifyDataStallSuspected</span>()
  → DataStallRecoveryManager<span class="hljs-selector-class">.onInternetValidationStatusChanged</span>(NOT_VALID)
</code></pre>
<hr/>
<h3 data-id="heading-3">二、四级递进恢复机制详解</h3>
<h4 data-id="heading-4">恢复机制概览图</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│ 数据卡死被检测到 (VALIDATION_STATUS_NOT_VALID)                   │
└────────────────┬──────────────────────────────────────────────────┘
                 │
                 ↓
        ┌────────────────────┐
        │  Level <span class="hljs-number">0</span>           │
        │ GET_DATA_CALL_LIST │  ← 仅查询，不修改
        └────────┬───────────┘
                 │ (等待 <span class="hljs-number">180s</span>，检查验证状态)
                 ↓
        ┌────────────────────┐
        │  Level <span class="hljs-number">1</span>           │
        │    CLEANUP         │  ← 轻量级恢复，不涉及 Radio
        │(DEACTIVATE/SETUP)  │
        └────────┬───────────┘
                 │ (等待 <span class="hljs-number">180s</span>，检查验证状态)
                 ↓
        ┌────────────────────┐
        │  Level <span class="hljs-number">2</span>           │
        │  RADIO_RESTART     │  ← 中等级恢复，涉及 Radio Power 重启
        └────────┬───────────┘
                 │ (等待 <span class="hljs-number">180s</span>，检查验证状态)
                 ↓
        ┌────────────────────┐
        │  Level <span class="hljs-number">3</span>           │
        │  RESET_MODEM       │  ← 最终恢复，涉及 Modem 重启
        │(NV_RESET_CONFIG)   │
        └────────┬───────────┘
                 │
                 ↓
        验证通过或已尝试所有步骤 → 复位到初始状态
</code></pre>
<h4 data-id="heading-5">2.1 Level 0: GET_DATA_CALL_LIST</h4>
<p><strong>目的</strong>：查询当前数据连接列表，同步 RIL 和 Framework 的数据连接状态</p>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">720</span>|    <span class="hljs-comment">/** Recovery Action: RECOVERY_ACTION_GET_DATA_CALL_LIST */</span>
<span class="hljs-number">721</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getDataCallList</span><span class="hljs-params">()</span> {
<span class="hljs-number">722</span>|        log(<span class="hljs-string">"getDataCallList: request data call list"</span>);
<span class="hljs-number">723</span>|        mWwanDataServiceManager.requestDataCallList(<span class="hljs-literal">null</span>);
<span class="hljs-number">724</span>|    }
</code></pre>
<p><strong>调用链</strong>：</p>
<ul>
<li><code>DataStallRecoveryManager.getDataCallList()</code></li>
<li>→ <code>DataServiceManager.requestDataCallList(Message)</code></li>
<li>→ <code>IDataService.requestDataCallList(int phoneId, IDataServiceCallback callback)</code> (AIDL)</li>
<li>→ Modem → RIL 返回 <code>DataCallResponse[]</code></li>
</ul>
<p><strong>使用场景</strong>：</p>
<ul>
<li>当 Framework 认为数据连接出现问题，但 Modem 端可能正常</li>
<li>通过 RIL_REQUEST_GET_DATA_CALL_LIST 查询实际连接状态</li>
<li>可能发现 IP 地址或 DNS 服务器信息在 Modem 端已更新，但未上报给 Framework</li>
</ul>
<p><strong>关键配置</strong>：</p>
<ul>
<li>延迟：CarrierConfig <code>KEY_DATA_STALL_RECOVERY_TIMERS_LONG_ARRAY[0]</code> (默认 180000ms = 3分钟)</li>
<li>可跳过：CarrierConfig <code>KEY_DATA_STALL_RECOVERY_SHOULD_SKIP_ARRAY[0]</code></li>
</ul>
<hr/>
<h4 data-id="heading-6">2.2 Level 1: CLEANUP</h4>
<p><strong>目的</strong>：完全断开现有数据连接，随后重新建立连接（Channel 重建）</p>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">726</span>|    <span class="hljs-comment">/** Recovery Action: RECOVERY_ACTION_CLEANUP */</span>
<span class="hljs-number">727</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanUpDataNetwork</span><span class="hljs-params">()</span> {
<span class="hljs-number">728</span>|        log(<span class="hljs-string">"cleanUpDataNetwork: notify clean up data network"</span>);
<span class="hljs-number">729</span>|        mDataStallRecoveryManagerCallback.invokeFromExecutor(
<span class="hljs-number">730</span>|                mDataStallRecoveryManagerCallback::onDataStallReestablishInternet);
<span class="hljs-number">731</span>|    }
</code></pre>
<p><strong>调用链</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">DataStallRecoveryManager<span class="hljs-selector-class">.cleanUpDataNetwork</span>()
  → DataNetworkController<span class="hljs-selector-class">.onDataStallReestablishInternet</span>()
    → mDataNetworkList<span class="hljs-selector-class">.stream</span>()
        <span class="hljs-selector-class">.filter</span>(DataNetwork::isInternetSupported)
        <span class="hljs-selector-class">.forEach</span>(dataNetwork → 
          dataNetwork.tearDown(TEAR_DOWN_REASON_DATA_STALL)
        )
          → RIL_REQUEST_DEACTIVATE_DATA_CALL (所有 PDN)
          → 断开连接后，等待网络请求重新建立
          → RIL_REQUEST_SETUP_DATA_CALL
</code></pre>
<p><strong>具体步骤</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─ <span class="hljs-number">1</span>. 断开所有互联网数据连接 (DEACTIVATE_DATA_CALL)
│     ├─ 所有 <span class="hljs-built_in">isInternetSupported</span>() == true 的 DataNetwork
│     ├─ 发送 RIL_REQUEST_DEACTIVATE_DATA_CALL for each CID
│     └─ 等待 Modem 回复 DEACTIVATE 响应
│
├─ <span class="hljs-number">2</span>. 断开完成后，unsatisfied network requests 重新评估
│     └─ DataNetworkController 检查是否有待满足的网络请求
│
└─ <span class="hljs-number">3</span>. 根据网络请求重新建立连接 (SETUP_DATA_CALL)
      ├─ 发送 RIL_REQUEST_SETUP_DATA_CALL
      ├─ 建立新的 PDN
      └─ 获取新的 IP、DNS 等链接属性
</code></pre>
<p><strong>核心代码</strong>：</p>
<pre><code class="hljs language-3450|" lang="3450|">3451|        log("onDataStallReestablishInternet: Tear down data networks that support internet.");
3452|        // 断开所有支持互联网的数据网络
3453|        mDataNetworkList.stream()
3454|            .filter(DataNetwork::isInternetSupported)
3455|            .forEach(dataNetwork -&gt; dataNetwork.tearDown(
3456|                DataNetwork.TEAR_DOWN_REASON_DATA_STALL));
3457|    }
</code></pre>
<p><strong>为什么有效</strong>：</p>
<ul>
<li>断开-重建可以清除 Modem 与 Radio 之间的沟通错误</li>
<li>在某些情况下（如链接层异常），断开重建可强制 Modem 重新协商参数</li>
</ul>
<p><strong>关键配置</strong>：</p>
<ul>
<li>延迟：CarrierConfig[1] (默认 180000ms = 3分钟)</li>
<li>可跳过：CarrierConfig[1] (某些运营商的相同 APN 情况)</li>
</ul>
<hr/>
<h4 data-id="heading-7">2.3 Level 2: RADIO_RESTART</h4>
<p><strong>目的</strong>：关闭再打开 Radio（不涉及 Modem 重启），强制重新注册网络</p>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">733</span>|    <span class="hljs-comment">/** Recovery Action: RECOVERY_ACTION_RADIO_RESTART */</span>
<span class="hljs-number">734</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">powerOffRadio</span><span class="hljs-params">()</span> {
<span class="hljs-number">735</span>|        log(<span class="hljs-string">"powerOffRadio: Restart radio"</span>);
<span class="hljs-number">736</span>|        mPhone.getServiceStateTracker().powerOffRadioSafely();
<span class="hljs-number">737</span>|    }
</code></pre>
<p><strong>调用链</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">DataStallRecoveryManager.powerOffRadio()
  → ServiceStateTracker.powerOffRadioSafely()
    → RIL_REQUEST_RADIO_POWER (<span class="hljs-attr">power</span> = <span class="hljs-literal">false</span>)
    → (等待 Modem 响应，关闭 RF 发射)
    → <span class="hljs-section">[延迟 ~3 秒]</span>
    → RIL_REQUEST_RADIO_POWER (<span class="hljs-attr">power</span> = <span class="hljs-literal">true</span>)
    → (Modem 重新打开 RF，发起网络注册)
    → ServiceState 从 POWER_OFF → SEARCHING → IN_SERVICE
</code></pre>
<p><strong>状态转换</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─ <span class="hljs-number">1</span>. Radio 关闭
│     └─ <span class="hljs-built_in">RIL_REQUEST_RADIO_POWER</span>(false)
│        → Modem 关闭 RF 发射
│        → ServiceState → POWER_OFF
│
├─ <span class="hljs-number">2</span>. <span class="hljs-selector-attr">[系统等待物理重启]</span>
│     └─ ~<span class="hljs-number">100</span>-<span class="hljs-number">500ms</span> delay
│
├─ <span class="hljs-number">3</span>. Radio 打开
│     └─ <span class="hljs-built_in">RIL_REQUEST_RADIO_POWER</span>(true)
│        → Modem 重新打开 RF
│        → 重新发起网络注册过程
│
└─ <span class="hljs-number">4</span>. 网络重新注册
      ├─ CS domain attach (语音)
      ├─ PS domain attach (数据)
      ├─ 获取新的信号参数、LAC/TAC、小区信息
      └─ 重建 PDP context（如果需要）
</code></pre>
<p><strong>何时触发 Event_RADIO_STATE_CHANGED</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">377</span>|            <span class="hljs-keyword">case</span> EVENT_RADIO_STATE_CHANGED:
<span class="hljs-number">378</span>|                mRadioPowerState = mPhone.getRadioPowerState();
<span class="hljs-number">379</span>|                <span class="hljs-keyword">if</span> (mDataStalled) {
<span class="hljs-number">380</span>|                    <span class="hljs-comment">// 只在数据卡死时记录 Radio 状态改变</span>
<span class="hljs-number">381</span>|                    mRadioStateChangedDuringDataStall = <span class="hljs-literal">true</span>;
<span class="hljs-number">382</span>|                    ...
<span class="hljs-number">383</span>|                    setRecoveryAction(mLastAction);
<span class="hljs-number">384</span>|                }
</code></pre>
<p><strong>为什么有效</strong>：</p>
<ul>
<li>RF 关闭再打开强制 Modem 重新初始化 Radio 栈</li>
<li>清除可能的信号处理路径上的异常状态</li>
<li>强制重新获取网络参数和附着信息</li>
</ul>
<p><strong>关键配置</strong>：</p>
<ul>
<li>延迟：CarrierConfig[2] (默认 180000ms = 3分钟)</li>
<li>可跳过：CarrierConfig[2]</li>
</ul>
<hr/>
<h4 data-id="heading-8">2.4 Level 3: RESET_MODEM</h4>
<p><strong>目的</strong>：Modem 全系统重启，恢复 Modem 固件到初始状态</p>
<p><strong>实现</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">739</span>|    <span class="hljs-comment">/** Recovery Action: RECOVERY_ACTION_RESET_MODEM */</span>
<span class="hljs-number">740</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rebootModem</span><span class="hljs-params">()</span> {
<span class="hljs-number">741</span>|        log(<span class="hljs-string">"rebootModem: reboot modem"</span>);
<span class="hljs-number">742</span>|        mPhone.rebootModem(<span class="hljs-literal">null</span>);
<span class="hljs-number">743</span>|    }
</code></pre>
<p><strong>调用链</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">DataStallRecoveryManager<span class="hljs-selector-class">.rebootModem</span>()
  → Phone<span class="hljs-selector-class">.rebootModem</span>(Message)
    → RIL<span class="hljs-selector-class">.nvResetConfig</span>() 或其他 Modem 重启命令
      → NV_RESET_CONFIG (可选)
      → MODEM_RESET (通过 SoC reset 或 watchdog)
</code></pre>
<p><strong>Modem 重启过程</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">┌─ <span class="hljs-number">1</span>. 发起 Modem 重启请求
│     └─ RIL_REQUEST_MODEM_RESET (AIDL)
│        或 NV_RESET_CONFIG
│
├─ <span class="hljs-number">2</span>. Modem 断电或被 SoC 强制重置
│     ├─ Modem 固件终止所有进程
│     ├─ 所有状态变量清空
│     ├─ 无线小区连接断开
│     └─ PDN 上下文丢弃
│
├─ <span class="hljs-number">3</span>. Modem 重启（Boot &amp; Initialization）
│     ├─ 固件加载和初始化
│     ├─ 硬件检测
│     ├─ NV Item 重载
│     └─ ~<span class="hljs-number">5</span>-<span class="hljs-number">30</span> 秒重启时间
│
└─ <span class="hljs-number">4</span>. Framework 重新初始化
      ├─ 监听 UNSOL_MODEM_RESTART indication
      ├─ ServiceState → POWER_OFF → SEARCHING → IN_SERVICE
      ├─ 重新建立所有数据连接
      └─ DataNetwork 重新 SETUP_DATA_CALL
</code></pre>
<p><strong>关键指示</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">hardware/radio/1.0/IRadioIndication.hal:
   oneway modemReset(RadioIndicationType <span class="hljs-built_in">type</span>, string reason);
   
当 Modem 重启完成时，该 indication 会被上报到 Framework
</code></pre>
<p><strong>为什么有效</strong>（最后的手段）：</p>
<ul>
<li>Modem 固件级别的完全恢复</li>
<li>清除所有可能的 memory leak、state machine 异常</li>
<li>重新加载 NV Item（可能包含故障的配置）</li>
</ul>
<p><strong>约束条件</strong>：</p>
<ul>
<li><strong>最终恢复步骤</strong>：仅在其他方式都失败后执行</li>
<li><strong>无限延迟</strong>：达到 RESET_MODEM 后，如果仍然失败，则标记 <code>mIsAttemptedAllSteps = true</code>，停止进一步恢复</li>
</ul>
<p><strong>关键配置</strong>：</p>
<ul>
<li>延迟：CarrierConfig[3] (默认 180000ms = 3分钟，实际上不再延迟，因为是最后步骤)</li>
<li>可跳过：CarrierConfig[3]</li>
</ul>
<hr/>
<h3 data-id="heading-9">三、恢复条件判断 &amp; 约束条件</h3>
<h4 data-id="heading-10">3.1 恢复是否需要的判定 (isRecoveryNeeded)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">780</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRecoveryNeeded</span><span class="hljs-params">(<span class="hljs-type">boolean</span> isNeedToCheckTimer)</span> {
<span class="hljs-number">781</span>|        <span class="hljs-comment">// Skip if network is invalid and recovery was not started yet</span>
<span class="hljs-number">782</span>|        <span class="hljs-keyword">if</span> (!mIsValidNetwork &amp;&amp; !isRecoveryAlreadyStarted()) {
<span class="hljs-number">783</span>|            logl(<span class="hljs-string">"skip when network still remains invalid..."</span>);
<span class="hljs-number">784</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 网络仍然无效，恢复尚未开始</span>
<span class="hljs-number">785</span>|        }
<span class="hljs-number">786</span>|
<span class="hljs-number">787</span>|        <span class="hljs-comment">// Skip recovery if we have already attempted all steps.</span>
<span class="hljs-number">788</span>|        <span class="hljs-keyword">if</span> (mIsAttemptedAllSteps) {
<span class="hljs-number">789</span>|            logl(<span class="hljs-string">"skip retrying continue recovery action"</span>);
<span class="hljs-number">790</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 已尝试所有步骤，放弃</span>
<span class="hljs-number">791</span>|        }
<span class="hljs-number">792</span>|
<span class="hljs-number">793</span>|        <span class="hljs-comment">// To avoid back to back recovery, wait for a grace period</span>
<span class="hljs-number">794</span>|        <span class="hljs-keyword">if</span> (getElapsedTimeSinceRecoveryMs() &lt; getDataStallRecoveryDelayMillis(mLastAction)
<span class="hljs-number">795</span>|                &amp;&amp; isNeedToCheckTimer) {
<span class="hljs-number">796</span>|            logl(<span class="hljs-string">"skip back to back data stall recovery"</span>);
<span class="hljs-number">797</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 距离上次恢复时间不足，避免频繁触发</span>
<span class="hljs-number">798</span>|        }
<span class="hljs-number">799</span>|
<span class="hljs-number">800</span>|        <span class="hljs-comment">// Skip recovery if it can cause a call to drop</span>
<span class="hljs-number">801</span>|        <span class="hljs-keyword">if</span> (mPhone.getState() != PhoneConstants.State.IDLE
<span class="hljs-number">802</span>|                &amp;&amp; getRecoveryAction() &gt; RECOVERY_ACTION_CLEANUP) {
<span class="hljs-number">803</span>|            logl(<span class="hljs-string">"skip data stall recovery as there is an active call"</span>);
<span class="hljs-number">804</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 通话中，避免 RADIO_RESTART/RESET_MODEM</span>
<span class="hljs-number">805</span>|        }
<span class="hljs-number">806</span>|
<span class="hljs-number">807</span>|        <span class="hljs-comment">// Skip when poor signal strength</span>
<span class="hljs-number">808</span>|        <span class="hljs-keyword">if</span> (mPhone.getSignalStrength().getLevel() &lt;= CellSignalStrength.SIGNAL_STRENGTH_POOR) {
<span class="hljs-number">809</span>|            logl(<span class="hljs-string">"skip data stall recovery as in poor signal condition"</span>);
<span class="hljs-number">810</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 信号太差，恢复无意义</span>
<span class="hljs-number">811</span>|        }
<span class="hljs-number">812</span>|
<span class="hljs-number">813</span>|        <span class="hljs-keyword">if</span> (!mDataNetworkController.isInternetDataAllowed(...)) {
<span class="hljs-number">814</span>|            logl(<span class="hljs-string">"skip data stall recovery as data not allowed."</span>);
<span class="hljs-number">815</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 用户禁用了移动数据或网络策略不允许</span>
<span class="hljs-number">816</span>|        }
<span class="hljs-number">817</span>|
<span class="hljs-number">818</span>|        <span class="hljs-keyword">if</span> (!mIsInternetNetworkConnected) {
<span class="hljs-number">819</span>|            logl(<span class="hljs-string">"skip data stall recovery as data not connected"</span>);
<span class="hljs-number">820</span>|            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ← 无互联网连接（可能是 IWLAN 等）</span>
<span class="hljs-number">821</span>|        }
<span class="hljs-number">822</span>|        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ← 所有条件满足，允许恢复</span>
<span class="hljs-number">823</span>|    }
</code></pre>
<h4 data-id="heading-11">恢复触发的完整流程</h4>
<pre><code class="hljs language-scss" lang="scss">ConnectivityService 网络验证失败
  ↓
<span class="hljs-built_in">onInternetValidationStatusChanged</span>(NOT_VALID)
  ↓
<span class="hljs-built_in">setNetworkValidationState</span>(false)  <span class="hljs-comment">// 标记 mDataStalled = true</span>
  ↓
<span class="hljs-built_in">isRecoveryNeeded</span>(true)?
  ├─ Yes → 发送 EVENT_SEND_DATA_STALL_BROADCAST
  │         ↓
  │         <span class="hljs-selector-attr">[等待 DSRM_PREDICT_WAITING_MILLIS (1000ms)]</span>
  │         ↓
  │         <span class="hljs-built_in">doRecovery</span>() 执行当前恢复动作
  │         ↓
  │         <span class="hljs-built_in">startNetworkCheckTimer</span>(mLastAction)
  │         ↓
  │         <span class="hljs-selector-attr">[等待 getDataStallRecoveryDelayMillis(action) 时间]</span>
  │         ↓
  │         自动触发下一个 EVENT_SEND_DATA_STALL_BROADCAST
  │
  └─ No → 记录日志，等待下次网络验证
</code></pre>
<h4 data-id="heading-12">3.2 智能跳过恢复步骤</h4>
<p>某些运营商配置允许跳过特定步骤：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">620</span>|    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRecoveryAction</span><span class="hljs-params">(<span class="hljs-meta">@RecoveryAction</span> <span class="hljs-type">int</span> action)</span> {
<span class="hljs-number">621</span>|        ...
<span class="hljs-number">640</span>|        <span class="hljs-comment">// 检查配置是否需要跳过该步骤</span>
<span class="hljs-number">641</span>|        <span class="hljs-keyword">if</span> (shouldSkipRecoveryAction(mRecoveryAction)) {
<span class="hljs-number">642</span>|            <span class="hljs-keyword">switch</span> (mRecoveryAction) {
<span class="hljs-number">643</span>|                <span class="hljs-keyword">case</span> RECOVERY_ACTION_GET_DATA_CALL_LIST:
<span class="hljs-number">644</span>|                    setRecoveryAction(RECOVERY_ACTION_CLEANUP);  <span class="hljs-comment">// 直接跳到 CLEANUP</span>
<span class="hljs-number">645</span>|                    <span class="hljs-keyword">break</span>;
<span class="hljs-number">646</span>|                <span class="hljs-keyword">case</span> RECOVERY_ACTION_CLEANUP:
<span class="hljs-number">647</span>|                    setRecoveryAction(RECOVERY_ACTION_RADIO_RESTART);  <span class="hljs-comment">// 直接跳到 RADIO_RESTART</span>
<span class="hljs-number">648</span>|                    <span class="hljs-keyword">break</span>;
<span class="hljs-number">649</span>|                <span class="hljs-keyword">case</span> RECOVERY_ACTION_RADIO_RESTART:
<span class="hljs-number">650</span>|                    setRecoveryAction(RECOVERY_ACTION_RESET_MODEM);  <span class="hljs-comment">// 直接跳到 RESET_MODEM</span>
<span class="hljs-number">651</span>|                    <span class="hljs-keyword">break</span>;
<span class="hljs-number">652</span>|                <span class="hljs-keyword">case</span> RECOVERY_ACTION_RESET_MODEM:
<span class="hljs-number">653</span>|                    resetAction();  <span class="hljs-comment">// 放弃，复位</span>
<span class="hljs-number">654</span>|                    <span class="hljs-keyword">break</span>;
<span class="hljs-number">655</span>|            }
<span class="hljs-number">656</span>|        }
    ...
<span class="hljs-number">657</span>|    }
</code></pre>
<p><strong>何时跳过</strong>：</p>
<ul>
<li>某些运营商为相同 APN（如同时用于互联网和 IMS 的 APN）</li>
<li>CLEANUP 可能无效，因为 Modem 不会断开</li>
<li>此时配置会直接跳到 RADIO_RESTART</li>
</ul>
<hr/>
<h3 data-id="heading-13">四、恢复流程中的计时器与状态管理</h3>
<h4 data-id="heading-14">4.1 核心状态变量</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">165</span>-<span class="hljs-number">166</span>|    <span class="hljs-meta">@RecoveryAction</span>
<span class="hljs-number">166</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mRecoveryAction;        <span class="hljs-comment">// 当前恢复动作</span>
<span class="hljs-number">183</span>|    <span class="hljs-meta">@RecoveryAction</span>
<span class="hljs-number">184</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mLastAction;             <span class="hljs-comment">// 上次执行的恢复动作</span>
<span class="hljs-number">173</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mRecoveryTriggered;  <span class="hljs-comment">// 恢复是否已触发</span>
<span class="hljs-number">175</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mDataStalled;        <span class="hljs-comment">// 是否处于卡死状态</span>
<span class="hljs-number">177</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mLastActionReported; <span class="hljs-comment">// 上次动作是否已上报</span>
<span class="hljs-number">181</span>|    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> mDataStallStartMs;       <span class="hljs-comment">// 卡死开始时间</span>
<span class="hljs-number">189</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mNetworkCheckTimerStarted;  <span class="hljs-comment">// 计时器是否已启动</span>
<span class="hljs-number">190</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mRadioStateChangedDuringDataStall;  <span class="hljs-comment">// Radio 状态在卡死期间是否改变</span>
<span class="hljs-number">191</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mIsAirPlaneModeEnableDuringDataStall;  <span class="hljs-comment">// 卡死期间飞行模式是否启用</span>
<span class="hljs-number">195</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mMobileDataChangedToEnabledDuringDataStall;  <span class="hljs-comment">// 卡死期间移动数据是否从禁用变启用</span>
<span class="hljs-number">197</span>|    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> mIsAttemptedAllSteps;  <span class="hljs-comment">// 是否已尝试所有步骤</span>
</code></pre>
<h4 data-id="heading-15">4.2 计时器逻辑</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">750</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startNetworkCheckTimer</span><span class="hljs-params">(<span class="hljs-meta">@RecoveryAction</span> <span class="hljs-type">int</span> action)</span> {
<span class="hljs-number">751</span>|        <span class="hljs-comment">// 最后一步（RESET_MODEM）不再设置计时器</span>
<span class="hljs-number">752</span>|        <span class="hljs-keyword">if</span> (action == RECOVERY_ACTION_RESET_MODEM) <span class="hljs-keyword">return</span>;
<span class="hljs-number">753</span>|
<span class="hljs-number">754</span>|        <span class="hljs-keyword">if</span> (!mNetworkCheckTimerStarted) {
<span class="hljs-number">755</span>|            mNetworkCheckTimerStarted = <span class="hljs-literal">true</span>;
<span class="hljs-number">756</span>|            mTimeLastRecoveryStartMs = SystemClock.elapsedRealtime();
<span class="hljs-number">757</span>|            <span class="hljs-comment">// 发送延迟消息，触发下一次恢复尝试</span>
<span class="hljs-number">758</span>|            sendMessageDelayed(
<span class="hljs-number">759</span>|                    obtainMessage(EVENT_SEND_DATA_STALL_BROADCAST),
<span class="hljs-number">760</span>|                    getDataStallRecoveryDelayMillis(action));  <span class="hljs-comment">// 默认 3 分钟</span>
<span class="hljs-number">761</span>|        }
<span class="hljs-number">762</span>|    }
</code></pre>
<p><strong>计时流程示例</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">时刻 T=<span class="hljs-number">0</span>
  └─ 检测到数据卡死 (VALIDATION_STATUS_NOT_VALID)
     └─ 触发 <span class="hljs-built_in">doRecovery</span>()
        └─ 执行 <span class="hljs-built_in">getDataCallList</span>()
        └─ 设置下一动作：mRecoveryAction = CLEANUP
        └─ <span class="hljs-built_in">startNetworkCheckTimer</span>(GET_DATA_CALL_LIST)
           └─ <span class="hljs-built_in">sendMessageDelayed</span>(..., <span class="hljs-number">180000ms</span>)

时刻 T=<span class="hljs-number">180s</span>
  └─ 网络验证再次失败
  │  └─ 触发 <span class="hljs-built_in">doRecovery</span>()
  │     └─ 执行 <span class="hljs-built_in">cleanUpDataNetwork</span>()
  │     └─ 设置下一动作：mRecoveryAction = RADIO_RESTART
  │     └─ <span class="hljs-built_in">startNetworkCheckTimer</span>(CLEANUP)
  │        └─ <span class="hljs-built_in">sendMessageDelayed</span>(..., <span class="hljs-number">180000ms</span>)
  │
  └─ 或者网络验证成功
     └─ 触发 <span class="hljs-built_in">reset</span>()
        └─ 恢复到初始状态
        └─ mDataStalled = false
        └─ mRecoveryAction = GET_DATA_CALL_LIST
</code></pre>
<h4 data-id="heading-16">4.3 恢复条件的动态调整</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">627</span>-<span class="hljs-number">639</span>|    <span class="hljs-keyword">if</span> (mMobileDataChangedToEnabledDuringDataStall
<span class="hljs-number">630</span>|            &amp;&amp; mRecoveryAction &lt; RECOVERY_ACTION_RADIO_RESTART) {
<span class="hljs-number">631</span>|        mRecoveryAction = RECOVERY_ACTION_RADIO_RESTART;  <span class="hljs-comment">// 直接跳到第二级</span>
<span class="hljs-number">632</span>|    }
<span class="hljs-number">633</span>|
<span class="hljs-number">634</span>|    <span class="hljs-keyword">if</span> (mRadioStateChangedDuringDataStall
<span class="hljs-number">636</span>|            &amp;&amp; mRadioPowerState == TelephonyManager.RADIO_POWER_ON) {
<span class="hljs-number">637</span>|        mRecoveryAction = RECOVERY_ACTION_RESET_MODEM;  <span class="hljs-comment">// 直接跳到第三级</span>
<span class="hljs-number">638</span>|    }
</code></pre>
<p><strong>含义</strong>：</p>
<ul>
<li><strong>用户启用移动数据</strong>（从禁用变启用）：跳过 CLEANUP，直接尝试 RADIO_RESTART</li>
<li><strong>Radio 在卡死期间重启</strong>：说明系统已经执行了 RADIO_RESTART，直接尝试 RESET_MODEM</li>
</ul>
<hr/>
<h3 data-id="heading-17">五、指标和诊断</h3>
<h4 data-id="heading-18">5.1 数据卡死恢复统计</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">693</span>-<span class="hljs-number">717</span>|    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">broadcastDataStallDetected</span><span class="hljs-params">(<span class="hljs-meta">@RecoveryAction</span> <span class="hljs-type">int</span> recoveryAction)</span> {
<span class="hljs-number">694</span>|        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(TelephonyManager.ACTION_DATA_STALL_DETECTED);
<span class="hljs-number">697</span>|        intent.putExtra(TelephonyManager.EXTRA_RECOVERY_ACTION, recoveryAction);
<span class="hljs-number">699</span>|
<span class="hljs-number">700</span>|        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isRecovered</span> <span class="hljs-operator">=</span> !mDataStalled;
<span class="hljs-number">701</span>|        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (SystemClock.elapsedRealtime() - mDataStallStartMs);
<span class="hljs-number">702</span>|        <span class="hljs-meta">@RecoveredReason</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">reason</span> <span class="hljs-operator">=</span> getRecoveredReason(mIsValidNetwork);
<span class="hljs-number">703</span>|        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">durationOfAction</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) getDurationOfCurrentRecoveryMs();
<span class="hljs-number">704</span>|
<span class="hljs-number">710</span>|        <span class="hljs-type">Bundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> mStats.getDataStallRecoveryMetricsData(
<span class="hljs-number">711</span>|                recoveryAction, isRecovered, duration, reason, 
<span class="hljs-number">712</span>|                mValidationCount, mActionValidationCount, durationOfAction);
<span class="hljs-number">713</span>|        intent.putExtra(<span class="hljs-string">"EXTRA_DSRS_STATS_BUNDLE"</span>, bundle);
<span class="hljs-number">714</span>|
<span class="hljs-number">717</span>|        mPhone.getContext().sendBroadcast(intent, READ_PRIVILEGED_PHONE_STATE);
    }
</code></pre>
<p><strong>上报的关键指标</strong>：</p>
<ul>
<li><code>isRecovered</code>: 是否已恢复</li>
<li><code>duration</code>: 从卡死开始到恢复的总耗时</li>
<li><code>reason</code>: 恢复原因（DSRM、Modem、User、None）</li>
<li><code>validationCount</code>: 总验证次数</li>
<li><code>actionValidationCount</code>: 当前动作的验证次数</li>
<li><code>durationOfAction</code>: 当前恢复动作的执行耗时</li>
</ul>
<h4 data-id="heading-19">5.2 ConnectivityDiagnostics 集成</h4>
<p>数据卡死恢复统计会获取以下诊断数据：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">185</span>-<span class="hljs-number">191</span>|    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDataStallSuspected</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> DataStallReport report)</span> {
<span class="hljs-number">186</span>|        <span class="hljs-type">PersistableBundle</span> <span class="hljs-variable">bundle</span> <span class="hljs-operator">=</span> report.getStallDetails();
<span class="hljs-number">187</span>|        mTcpMetricsCollectionPeriodMillis =
<span class="hljs-number">188</span>|            bundle.getInt(KEY_TCP_METRICS_COLLECTION_PERIOD_MILLIS);
<span class="hljs-number">189</span>|        mTcpPacketFailRate = bundle.getInt(KEY_TCP_PACKET_FAIL_RATE);
<span class="hljs-number">190</span>|        mDnsConsecutiveTimeouts = bundle.getInt(KEY_DNS_CONSECUTIVE_TIMEOUTS);
<span class="hljs-number">191</span>|    }
</code></pre>
<p><strong>诊断信息</strong>：</p>
<ul>
<li><strong>DNS 连续超时数</strong>：连续 DNS 查询失败的次数</li>
<li><strong>TCP 包失败率</strong>：TCP 包送达失败的百分比</li>
<li><strong>TCP 指标收集周期</strong>：这些指标的统计周期</li>
</ul>
<hr/>
<h3 data-id="heading-20">六、完整流程图</h3>
<pre><code class="hljs language-ini" lang="ini">数据卡死场景
  ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 1: 检测阶段                                             │
│ - NetworkMonitor 监测到 DNS 超时或 TCP 失败率高              │
│ - ConnectivityService 通知验证失败                           │
│ - onInternetValidationStatusChanged(NOT_VALID)              │
└─────────────────────┬───────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 2: 触发检查                                             │
│ - <span class="hljs-attr">mDataStalled</span> = <span class="hljs-literal">true</span>                                        │
│ - isRecoveryNeeded() 判断是否满足恢复条件                    │
│   ├─ 有活跃通话？→ 跳过高级别恢复 (RADIO_RESTART+)          │
│   ├─ 用户禁用数据？→ 放弃恢复                                │
│   ├─ 信号太差？→ 放弃恢复                                    │
│   └─ 已尝试所有步骤？→ 放弃恢复                              │
└─────────────────────┬───────────────────────────────────────┘
                      ↓
          ┌───────────────────────┐
          │ 恢复条件满足？         │
          └───┬─────────┬─────────┘
              │ YES     │ NO
              ↓         └─→ 等待下次验证
              ↓
┌──────────────────────────────────────────────────────────────┐
│ Step 3: 恢复执行 (doRecovery)                                │
│                                                               │
│ ┌─ Action 0: GET_DATA_CALL_LIST                             │
│ │  └─ requestDataCallList() 查询数据连接列表                │
│ │     └─ <span class="hljs-section">[等待 180s]</span>                                         │
│ │
│ ├─ Action 1: CLEANUP                                         │
│ │  └─ onDataStallReestablishInternet()                      │
│ │     ├─ 断开所有 Internet PDN (DEACTIVATE_DATA_CALL)       │
│ │     └─ 等待网络请求重建 (SETUP_DATA_CALL)                │
│ │        └─ <span class="hljs-section">[等待 180s]</span>                                      │
│ │
│ ├─ Action 2: RADIO_RESTART                                   │
│ │  └─ powerOffRadioSafely()                                 │
│ │     ├─ RIL_REQUEST_RADIO_POWER(false) 关闭 RF             │
│ │     ├─ <span class="hljs-section">[延迟 ~100-500ms]</span>                                   │
│ │     └─ RIL_REQUEST_RADIO_POWER(true) 打开 RF              │
│ │        └─ <span class="hljs-section">[等待 180s 或更长，重新注册网络]</span>                │
│ │
│ └─ Action 3: RESET_MODEM                                     │
│    └─ rebootModem()                                          │
│       ├─ RIL_REQUEST_MODEM_RESET                            │
│       ├─ Modem 完全重启 (~5-30s)                            │
│       ├─ Framework 监听 UNSOL_MODEM_RESTART                │
│       └─ 重建所有数据连接                                    │
│          └─ <span class="hljs-section">[不再等待，标记 mIsAttemptedAllSteps = true]</span>    │
└──────────────────────────────────────────────────────────────┘
                      ↓
┌──────────────────────────────────────────────────────────────┐
│ Step 4: 验证结果                                             │
│                                                               │
│ ┌─ 验证通过 (VALIDATION_STATUS_VALID)                       │
│ │  └─ reset() 恢复到初始状态                                 │
│ │     ├─ <span class="hljs-attr">mDataStalled</span> = <span class="hljs-literal">false</span>                               │
│ │     ├─ <span class="hljs-attr">mRecoveryAction</span> = GET_DATA_CALL_LIST               │
│ │     ├─ <span class="hljs-attr">mIsAttemptedAllSteps</span> = <span class="hljs-literal">false</span>                       │
│ │     └─ 发送 ACTION_DATA_STALL_DETECTED 广播               │
│ │
│ └─ 验证继续失败                                              │
│    └─ <span class="hljs-section">[延迟后]</span> 触发下一级恢复                                │
│       或 <span class="hljs-section">[已尝试所有步骤]</span> 放弃恢复                           │
└──────────────────────────────────────────────────────────────┘
</code></pre>
<hr/>
<h3 data-id="heading-21">七、关键配置项</h3>
<pre><code class="hljs language-ini" lang="ini">CarrierConfigManager.KEY_DATA_STALL_RECOVERY_TIMERS_LONG_ARRAY
├─ <span class="hljs-section">[0]</span>: GET_DATA_CALL_LIST → CLEANUP 间隔 (默认 180000ms)
├─ <span class="hljs-section">[1]</span>: CLEANUP → RADIO_RESTART 间隔 (默认 180000ms)
├─ <span class="hljs-section">[2]</span>: RADIO_RESTART → RESET_MODEM 间隔 (默认 180000ms)
└─ <span class="hljs-section">[3]</span>: RESET_MODEM 后的间隔 (默认 180000ms，实际不用)

CarrierConfigManager.KEY_DATA_STALL_RECOVERY_SHOULD_SKIP_ARRAY
├─ <span class="hljs-section">[0]</span>: 是否跳过 GET_DATA_CALL_LIST
├─ <span class="hljs-section">[1]</span>: 是否跳过 CLEANUP (某些相同 APN 情况)
├─ <span class="hljs-section">[2]</span>: 是否跳过 RADIO_RESTART
└─ <span class="hljs-section">[3]</span>: 是否跳过 RESET_MODEM

Settings.Global.DSRM_ENABLED_ACTIONS
└─ "true,true,false,true" 格式，允许动态禁用特定恢复动作

Settings.Global.DSRM_DURATION_MILLIS
└─ "180000,180000,180000,180000" 格式，允许动态调整延迟
</code></pre>
<hr/>
<h3 data-id="heading-22">八、总结</h3>
<p>数据卡死恢复是一个精心设计的<strong>四级递进容错机制</strong>：</p>








































<table><thead><tr><th>级别</th><th>名称</th><th>作用范围</th><th>风险等级</th><th>恢复时间</th></tr></thead><tbody><tr><td>0</td><td>GET_DATA_CALL_LIST</td><td>状态查询、同步</td><td>无</td><td>&lt;1s</td></tr><tr><td>1</td><td>CLEANUP</td><td>连接重建、Channel 清理</td><td>低</td><td>&lt;10s</td></tr><tr><td>2</td><td>RADIO_RESTART</td><td>RF 重启、重新注册</td><td>中</td><td>~30-60s</td></tr><tr><td>3</td><td>RESET_MODEM</td><td>完全Modem重启</td><td>高</td><td>~5-30s + 重连</td></tr></tbody></table>
<p><strong>关键特性</strong>：</p>
<ul>
<li>✅ <strong>渐进式</strong>：从轻量级到重量级逐步升级</li>
<li>✅ <strong>自适应</strong>：根据运营商配置跳过不必要的步骤</li>
<li>✅ <strong>安全</strong>：通话中避免高风险恢复、信号差时放弃恢复</li>
<li>✅ <strong>可配置</strong>：每个步骤的延迟和是否执行都可动态配置</li>
<li>✅ <strong>可诊断</strong>：详细的上报恢复事件和诊断数据</li>
</ul>
<p>现在让我更新 TODO 列表：</p>
<p>完美！现在让我提供几个关键代码片段的详细分析，以供你进一步深入理解：</p>
<hr/>
<h2 data-id="heading-23">📌 关键代码深度分析</h2>
<h3 data-id="heading-24">1. 恢复循环的核心逻辑</h3>
<pre><code class="hljs language-357:401:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java" lang="357:401:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java">    @Override
    public void handleMessage(Message msg) {
        logv("handleMessage = " + msg);
        switch (msg.what) {
            case EVENT_SEND_DATA_STALL_BROADCAST:
                mRecoveryTriggered = true;
                // Verify that DSRM needs to process the recovery action
                if (!isRecoveryNeeded(false)) {
                    cancelNetworkCheckTimer();
                    startNetworkCheckTimer(getRecoveryAction());
                    return;
                }
                // Broadcast intent that data stall has been detected.
                broadcastDataStallDetected(getRecoveryAction());
                // Schedule the message to wait for the predicted value.
                sendMessageDelayed(
                        obtainMessage(EVENT_DO_RECOVERY), mPredictWaitingMillis);
                break;
            case EVENT_DO_RECOVERY:
                doRecovery();
                break;
            case EVENT_RADIO_STATE_CHANGED:
                mRadioPowerState = mPhone.getRadioPowerState();
                if (mDataStalled) {
                    // Store the radio state changed flag only when data stall occurred.
                    mRadioStateChangedDuringDataStall = true;
                    if (Settings.Global.getInt(
                                    mPhone.getContext().getContentResolver(),
                                    Settings.Global.AIRPLANE_MODE_ON,
                                    0) != 0) {
                        mIsAirPlaneModeEnableDuringDataStall = true;
                    }
                    setRecoveryAction(mLastAction);
                }
                break;
            case EVENT_CONTENT_DSRM_ENABLED_ACTIONS_CHANGED:
                updateGlobalConfigActions();
                break;
            case EVENT_CONTENT_DSRM_DURATION_MILLIS_CHANGED:
                updateGlobalConfigDurations();
                break;
            default:
                loge("Unexpected message = " + msg);
                break;
        }
    }
</code></pre>
<p><strong>关键点分析</strong>：</p>
<ul>
<li>
<p><strong>EVENT_SEND_DATA_STALL_BROADCAST</strong> 是恢复循环的关键触发点，它会：</p>
<ol>
<li>检查 <code>isRecoveryNeeded(false)</code> 判断是否真的需要恢复（不再等待延迟）</li>
<li>如果需要，发送 DSRS Broadcast（用于诊断）</li>
<li>延迟 <code>mPredictWaitingMillis</code>（通常 1000ms）后发送 EVENT_DO_RECOVERY</li>
</ol>
</li>
<li>
<p><strong>EVENT_RADIO_STATE_CHANGED</strong> 会自动升级恢复步骤，如果系统已经自己重启了 Radio（可能由其他模块触发），则直接跳到 RESET_MODEM</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-25">2. 验证状态变化处理</h3>
<pre><code class="hljs language-570:591:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java" lang="570:591:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java">    private void onInternetValidationStatusChanged(@ValidationStatus int status) {
        logl("onInternetValidationStatusChanged: " + DataUtils.validationStatusToString(status));
        final boolean isValid = status == NetworkAgent.VALIDATION_STATUS_VALID;
        if (mFeatureFlags.dsrsDiagnosticsEnabled()) {
            mValidationCount += 1;
            mActionValidationCount += 1;
        }
        setNetworkValidationState(isValid);
        if (isValid) {
            if (mFeatureFlags.dsrsDiagnosticsEnabled()) {
                // Broadcast intent that data stall recovered.
                broadcastDataStallDetected(mLastAction);
            }
            reset();
        } else if (isRecoveryNeeded(true)) {
            // Set the network as invalid, because recovery is needed
            mIsValidNetwork = false;
            log("trigger data stall recovery");
            mTimeLastRecoveryStartMs = SystemClock.elapsedRealtime();
            sendMessage(obtainMessage(EVENT_SEND_DATA_STALL_BROADCAST));
        }
    }
</code></pre>
<p><strong>验证流程</strong>：</p>
<ol>
<li>验证通过 → 立即 <code>reset()</code> 复位，恢复完成</li>
<li>验证失败 + 满足恢复条件 → 立即触发 <code>EVENT_SEND_DATA_STALL_BROADCAST</code> 进入恢复循环</li>
<li>验证失败 + 不满足恢复条件 → 记录日志，等待下次验证</li>
</ol>
<hr/>
<h3 data-id="heading-26">3. CLEANUP 的实际执行</h3>
<pre><code class="hljs language-3450:3459:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataNetworkController.java" lang="3450:3459:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataNetworkController.java">    private void onDataStallReestablishInternet() {
        log("onDataStallReestablishInternet: Tear down data networks that support internet.");
        // Tear down all data networks that support internet. After data disconnected, unsatisfied
        // network requests will be re-evaluate again and data network controller will attempt to
        // setup data networks to satisfy them.
        mDataNetworkList.stream()
                .filter(DataNetwork::isInternetSupported)
                .forEach(dataNetwork -&gt; dataNetwork.tearDown(
                        DataNetwork.TEAR_DOWN_REASON_DATA_STALL));
    }
</code></pre>
<p><strong>重要细节</strong>：</p>
<ul>
<li>仅断开 <code>isInternetSupported()</code> 的网络（通常是默认 APN）</li>
<li>不会断开 IMS、MMS 等特殊用途的 PDN</li>
<li>断开后，<code>DataNetworkController</code> 会根据待决的网络请求自动重建</li>
<li>这是一个"轻量级"恢复，因为没有涉及 Radio 或 Modem</li>
</ul>
<hr/>
<h3 data-id="heading-27">4. 动态调整恢复步骤</h3>
<pre><code class="hljs language-620:659:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java" lang="620:659:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java">    public void setRecoveryAction(@RecoveryAction int action) {
        // Reset the validation count for action change
        if (mFeatureFlags.dsrsDiagnosticsEnabled() &amp;&amp; mRecoveryAction != action) {
            mActionValidationCount = 0;
        }
        mRecoveryAction = action;

        // Check if the mobile data enabled is TRUE, it means that the mobile data setting changed
        // from DISABLED to ENABLED, we will set the next recovery action to
        // RECOVERY_ACTION_RADIO_RESTART due to already did the RECOVERY_ACTION_CLEANUP.
        if (mMobileDataChangedToEnabledDuringDataStall
                &amp;&amp; mRecoveryAction &lt; RECOVERY_ACTION_RADIO_RESTART) {
            mRecoveryAction = RECOVERY_ACTION_RADIO_RESTART;
        }
        // Check if the radio state changed from off to on, it means that the modem already
        // did the radio restart, we will set the next action to RECOVERY_ACTION_RESET_MODEM.
        if (mRadioStateChangedDuringDataStall
                &amp;&amp; mRadioPowerState == TelephonyManager.RADIO_POWER_ON) {
            mRecoveryAction = RECOVERY_ACTION_RESET_MODEM;
        }
        // To check the flag from DataConfigManager if we need to skip the step.
        if (shouldSkipRecoveryAction(mRecoveryAction)) {
            switch (mRecoveryAction) {
                case RECOVERY_ACTION_GET_DATA_CALL_LIST:
                    setRecoveryAction(RECOVERY_ACTION_CLEANUP);
                    break;
                case RECOVERY_ACTION_CLEANUP:
                    setRecoveryAction(RECOVERY_ACTION_RADIO_RESTART);
                    break;
                case RECOVERY_ACTION_RADIO_RESTART:
                    setRecoveryAction(RECOVERY_ACTION_RESET_MODEM);
                    break;
                case RECOVERY_ACTION_RESET_MODEM:
                    resetAction();
                    break;
            }
        }

        log("setRecoveryAction: " + recoveryActionToString(mRecoveryAction));
    }
</code></pre>
<p><strong>三层智能逻辑</strong>：</p>
<ol>
<li><strong>用户操作检测</strong>：如果用户在卡死期间启用数据 → 跳过已执行的步骤</li>
<li><strong>System Event 检测</strong>：如果 Radio 在卡死期间重启 → 说明系统已执行 RADIO_RESTART，直接尝试 RESET_MODEM</li>
<li><strong>运营商配置</strong>：根据运营商配置跳过不必要的步骤（递归调用）</li>
</ol>
<hr/>
<h3 data-id="heading-28">5. 运营商配置的动态更新</h3>
<pre><code class="hljs language-428:454:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java" lang="428:454:frameworks_opt_telephony/src/java/com/android/internal/telephony/data/DataStallRecoveryManager.java">    private void updateGlobalConfigActions() {
        String enabledActions = Settings.Global.getString(
                mPhone.getContext().getContentResolver(),
                Settings.Global.DSRM_ENABLED_ACTIONS);

        if (!TextUtils.isEmpty(enabledActions)) {
            String[] splitEnabledActions = enabledActions.split(",");
            boolean[] enabledActionsArray = new boolean[splitEnabledActions.length];
            for (int i = 0; i &lt; enabledActionsArray.length; i++) {
                enabledActionsArray[i] = Boolean.parseBoolean(splitEnabledActions[i].trim());
            }

            int minLength = Math.min(enabledActionsArray.length,
                    mSkipRecoveryActionArray.length);

            // Update the skip recovery action array.
            for (int i = 0; i &lt; minLength; i++) {
                mSkipRecoveryActionArray[i] = !enabledActionsArray[i];
            }
            log("SkipRecoveryAction: "
                    + Arrays.toString(mSkipRecoveryActionArray));
            mPredictWaitingMillis = DSRM_PREDICT_WAITING_MILLIS;
        } else {
            mPredictWaitingMillis = 0;
            log("Enabled actions is null");
        }
    }
</code></pre>
<p><strong>动态配置特性</strong>：</p>
<ul>
<li>支持运营商通过 <code>Settings.Global.DSRM_ENABLED_ACTIONS</code> 动态控制恢复步骤</li>
<li>格式：<code>"true,true,false,true"</code> 表示启用步骤 0、1、3，跳过步骤 2</li>
<li>也支持动态调整延迟时间：<code>Settings.Global.DSRM_DURATION_MILLIS</code></li>
</ul>
<hr/>
<h2 data-id="heading-29">🎯 实战应用指南</h2>
<h3 data-id="heading-30">问题排查</h3>
<ol>
<li>
<p><strong>数据卡死频繁发生</strong></p>
<ul>
<li>检查 NetworkMonitor 的 DNS/TCP 检测阈值</li>
<li>检查网络信号强度和网络质量</li>
<li>查看 DSRM 是否真的执行了恢复步骤（查看日志）</li>
</ul>
</li>
<li>
<p><strong>恢复步骤没有执行</strong></p>
<ul>
<li>检查 <code>shouldSkipRecoveryAction()</code> 是否因运营商配置跳过了</li>
<li>检查 <code>isRecoveryNeeded()</code> 的各个条件是否满足</li>
<li>查看用户是否处于通话中、飞行模式、或禁用数据</li>
</ul>
</li>
<li>
<p><strong>某个恢复步骤无效</strong></p>
<ul>
<li>对于 CLEANUP 无效 → 可能需要运营商配置跳过，直接尝试 RADIO_RESTART</li>
<li>对于 RADIO_RESTART 无效 → 可能是 Modem 固件问题，需要 RESET_MODEM</li>
<li>对于 RESET_MODEM 无效 → 可能是硬件或信号问题，超出 DSRM 范围</li>
</ul>
</li>
</ol>
<h3 data-id="heading-31">性能优化</h3>
<ol>
<li>
<p><strong>减少卡死误报</strong></p>
<ul>
<li>增加 NetworkMonitor 的检测阈值</li>
<li>减少检测频率</li>
</ul>
</li>
<li>
<p><strong>加快恢复速度</strong></p>
<ul>
<li>减少 DSRM 延迟配置（CarrierConfig）</li>
<li>对于某些运营商，可以跳过不必要的步骤</li>
</ul>
</li>
<li>
<p><strong>降低用户影响</strong></p>
<ul>
<li>在通话中不执行 RADIO_RESTART/RESET_MODEM</li>
<li>信号差时不执行恢复（避免无谓的操作）</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-32">📚 相关文件索引</h2>
<pre><code class="hljs language-scss" lang="scss">核心实现
├─ DataStallRecoveryManager<span class="hljs-selector-class">.java</span> (DSRM 主逻辑)
├─ DataNetworkController<span class="hljs-selector-class">.java</span> (数据网络管理)
├─ DataNetwork<span class="hljs-selector-class">.java</span> (单个 PDN 的连接管理)
└─ RIL<span class="hljs-selector-class">.java</span> (与 Modem 通信)

诊断和统计
├─ DataStallRecoveryStats<span class="hljs-selector-class">.java</span> (恢复统计)
├─ ConnectivityService<span class="hljs-selector-class">.java</span> (网络验证)
└─ NetworkMonitor (网络质量监测)

配置
├─ CarrierConfigManager<span class="hljs-selector-class">.java</span> (运营商配置)
├─ DataConfigManager<span class="hljs-selector-class">.java</span> (数据配置管理)
└─ Settings<span class="hljs-selector-class">.Global</span> (动态全局设置)
</code></pre>
<p>这就是 Android Telephony 中完整的<strong>数据恢复与容错机制</strong>！如有任何疑问，欢迎继续提问 🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Compose BOM 2026.01.01 上新：1.10.2 稳定补丁 + Material 3 1.4.0 重点能力梳理]]></title>    <link>https://juejin.cn/post/7603321550247362610</link>    <guid>https://juejin.cn/post/7603321550247362610</guid>    <pubDate>2026-02-06T09:53:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247362610" data-draft-id="7603309951227625522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose BOM 2026.01.01 上新：1.10.2 稳定补丁 + Material 3 1.4.0 重点能力梳理"/> <meta itemprop="keywords" content="Android Jetpack"/> <meta itemprop="datePublished" content="2026-02-06T09:53:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Nicko"/> <meta itemprop="url" content="https://juejin.cn/user/3791538512733501"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose BOM 2026.01.01 上新：1.10.2 稳定补丁 + Material 3 1.4.0 重点能力梳理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3791538512733501/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Nicko
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:53:38.000Z" title="Fri Feb 06 2026 09:53:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    69
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Compose BOM <code>2026.01.01</code> 上新：1.10.2 稳定补丁 + Material 3 <code>1.4.0</code> 重点能力梳理</h2>
<h3 data-id="heading-1">前言</h3>
<p>如果你在 Android 项目里使用 Jetpack Compose，<code>BOM</code>（Bill of Materials）是最稳的版本管理方式之一：</p>
<ul>
<li>只声明一个 BOM 版本，Compose 相关依赖就能自动对齐。</li>
<li>降低“某个模块偷偷升了版本，结果运行时出问题”的概率。</li>
</ul>
<p>截至 <strong>2026-02-06</strong>，Compose 官方文档中的示例 BOM 已更新到：</p>
<ul>
<li><code>androidx.compose:compose-bom:2026.01.01</code></li>
<li><code>androidx.compose:compose-bom-alpha:2026.01.01</code></li>
<li><code>androidx.compose:compose-bom-beta:2026.01.01</code></li>
</ul>
<p>这篇文章按“前言 → 版本速览 → 模块更新 → 迁移建议”的结构，快速讲清楚这个版本值不值得升、升了要注意什么。</p>
<hr/>
<h3 data-id="heading-2">Compose BOM <code>2026.01.01</code> 速览</h3>
<h4 data-id="heading-3">1）一句话结论</h4>
<p><code>2026.01.01</code> 是一个<strong>稳定补丁聚合版本</strong>：</p>
<ul>
<li>核心 Compose 组（<code>animation</code>/<code>foundation</code>/<code>runtime</code>/<code>ui</code>）对齐到 <code>1.10.2</code>。</li>
<li><code>material3</code> 对齐到稳定版 <code>1.4.0</code>。</li>
<li><code>material3.adaptive</code> 对齐到 <code>1.2.0</code>。</li>
</ul>
<h4 data-id="heading-4">2）关键映射（官方 BOM Mapping）</h4>





















































<table><thead><tr><th>Compose 组</th><th>代表 Artifact</th><th>BOM 对应版本</th><th>发布说明</th></tr></thead><tbody><tr><td>Animation</td><td><code>androidx.compose.animation:animation</code></td><td><code>1.10.2</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-animation%231.10.2" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-animation#1.10.2" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>Foundation</td><td><code>androidx.compose.foundation:foundation</code></td><td><code>1.10.2</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-foundation%231.10.2" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-foundation#1.10.2" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>Runtime</td><td><code>androidx.compose.runtime:runtime</code></td><td><code>1.10.2</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-runtime%231.10.2" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-runtime#1.10.2" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>UI</td><td><code>androidx.compose.ui:ui</code></td><td><code>1.10.2</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-ui%231.10.2" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-ui#1.10.2" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>Material (M2)</td><td><code>androidx.compose.material:material</code></td><td><code>1.10.2</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-material%231.10.2" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-material#1.10.2" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>Material3</td><td><code>androidx.compose.material3:material3</code></td><td><code>1.4.0</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-material3%231.4.0" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-material3#1.4.0" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr><tr><td>Material3 Adaptive</td><td><code>androidx.compose.material3.adaptive:adaptive</code></td><td><code>1.2.0</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-material3-adaptive%231.2.0" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-material3-adaptive#1.2.0" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></td></tr></tbody></table>
<blockquote>
<p>时间点参考：<code>1.10.2</code> 发布于 <strong>2026-01-28</strong>；<code>material3:1.4.0</code> 发布于 <strong>2025-09-24</strong>。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">主要更新（你真正会感知到的）</h3>
<h3 data-id="heading-6">1）Animation 1.10：共享元素能力明显增强</h3>
<p>虽然 BOM 映射到的是 <code>1.10.2</code>（补丁版），但 1.10 周期里动画能力升级很实用：</p>
<ul>
<li>Shared transition APIs 在 1.10 正式稳定。</li>
<li>新增 <code>Modifier.skipToLookaheadPosition()</code>，可在共享过渡中直接跳到目标位置。</li>
<li>支持动态启用/禁用 shared elements。</li>
<li>支持共享元素过渡的初速度（fling 场景更自然）。</li>
<li>为 <code>AnimatedVisibility</code> / <code>AnimatedContent</code> 增加 veil layer 动画能力。</li>
</ul>
<p>适用场景：详情页转场、卡片到全屏、图库过渡等“空间连续性”动画。</p>
<h3 data-id="heading-7">2）Foundation 1.10：性能和稳定性继续收敛</h3>
<p>值得关注的两类变化：</p>
<ul>
<li><strong>性能方向</strong>：<code>isPausableCompositionInPrefetchEnabled</code> 在 1.10 周期默认启用，Lazy 列表预取更平滑、主线程压力更可控。</li>
<li><strong>稳定性方向</strong>：<code>1.10.2</code> 修复了文本选择相关的崩溃（例如页面返回时有活动选区）。</li>
</ul>
<p>如果你有长列表 + 重 Item 组合，升级后通常更容易获得稳定帧率。</p>
<h3 data-id="heading-8">3）Runtime 1.10：<code>retain</code> 体系成熟，补丁版更稳</h3>
<p>Runtime 1.10 周期中，<code>RetainedValuesStore</code> 相关 API 经历了整理：</p>
<ul>
<li>更强调通过 provider/registry 管理 retained values。</li>
<li>自定义 retained store 的接入方式有迁移成本（命名和安装方式变化较多）。</li>
<li><code>1.10.2</code> 主要是补丁整合，重点在稳定性。</li>
</ul>
<p>如果你只是“正常使用 <code>retain</code>”，改动通常不大；如果你实现了自定义 store，建议对照 release notes 逐项迁移。</p>
<h3 data-id="heading-9">4）UI 1.10：焦点、测试与 Popup 行为更一致</h3>
<p>1.10 周期里 UI 侧有几项很实用：</p>
<ul>
<li>焦点分发优化（降低复杂焦点树下的额外开销）。</li>
<li>间接触控 API 命名统一到 indirect pointer 体系。</li>
<li>Compose UI Test 对 <code>effectContext</code>、<code>StandardTestDispatcher</code> 支持更清晰。</li>
<li><code>1.10.1</code> 修复了 <code>LookaheadScope</code> + pausable composition 崩溃，以及 <code>PopupPositionProvider</code> 坐标计算问题。</li>
</ul>
<p>如果你的项目有 TV/键盘焦点、复杂 Popup 定位、或 UI 测试稳定性问题，这部分收益会比较明显。</p>
<h3 data-id="heading-10">5）Material3 <code>1.4.0</code>：组件能力升级最明显</h3>
<p><code>material3:1.4.0</code> 的变化量很大，重点看这几类：</p>
<ul>
<li><strong>图标策略变化</strong>：不再推荐 <code>androidx.compose.material.icons</code> 作为主路径；且 Material3 不再自动依赖 <code>material-icons-core</code>。</li>
<li><strong>行为调整</strong>：<code>NavigationBarItem</code> / <code>NavigationRailItem</code> 的 active label 颜色策略有调整。</li>
<li><strong>动效体系</strong>：组件开始采用 <code>MotionScheme</code>。</li>
<li><strong>新组件/能力</strong>：
<ul>
<li><code>HorizontalCenteredHeroCarousel</code></li>
<li><code>VerticalDragHandle</code></li>
<li><code>SecureTextField</code> / <code>OutlinedSecureTextField</code></li>
<li><code>Text</code> 支持 <code>autoSize</code></li>
<li><code>TimePickerDialog</code></li>
<li>新的 SearchBar API 拆分与状态控制</li>
</ul>
</li>
</ul>
<p>结论：如果你正在做 Material3 设计系统迭代，这一块是 BOM <code>2026.01.01</code> 最值得关注的部分。</p>
<hr/>
<h3 data-id="heading-11">升级示例</h3>
<h3 data-id="heading-12">1）Gradle Kotlin DSL</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
    <span class="hljs-keyword">val</span> composeBom = platform(<span class="hljs-string">"androidx.compose:compose-bom:2026.01.01"</span>)
    implementation(composeBom)
    androidTestImplementation(composeBom)

    implementation(<span class="hljs-string">"androidx.compose.ui:ui"</span>)
    implementation(<span class="hljs-string">"androidx.compose.ui:ui-tooling-preview"</span>)
    debugImplementation(<span class="hljs-string">"androidx.compose.ui:ui-tooling"</span>)

    implementation(<span class="hljs-string">"androidx.compose.material3:material3"</span>)

    androidTestImplementation(<span class="hljs-string">"androidx.compose.ui:ui-test-junit4"</span>)
    debugImplementation(<span class="hljs-string">"androidx.compose.ui:ui-test-manifest"</span>)
}
</code></pre>
<h3 data-id="heading-13">2）如果你用 Version Catalog</h3>
<p><code>libs.versions.toml</code> 中把 BOM 改到：</p>
<pre><code class="hljs language-toml" lang="toml"><span class="hljs-section">[versions]</span>
<span class="hljs-attr">compose-bom</span> = <span class="hljs-string">"2026.01.01"</span>

<span class="hljs-section">[libraries]</span>
<span class="hljs-attr">androidx-compose-bom</span> = { module = <span class="hljs-string">"androidx.compose:compose-bom"</span>, version.ref = <span class="hljs-string">"compose-bom"</span> }
</code></pre>
<hr/>
<h3 data-id="heading-14">迁移与排坑建议</h3>
<h3 data-id="heading-15">1）检查图标依赖</h3>
<p>如果你之前“隐式”用到了图标，升级后建议显式声明：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">implementation(<span class="hljs-string">"androidx.compose.material:material-icons-core"</span>)
</code></pre>
<h3 data-id="heading-16">2）检查 <code>retain</code> 的自定义用法</h3>
<p>有自定义 <code>RetainedValuesStore</code> 的项目，重点回看 Runtime 1.10 的 API 变更。</p>
<h3 data-id="heading-17">3）回归测试建议</h3>
<ul>
<li>重点回归 <code>Popup</code> 定位、文本选择、导航返回。</li>
<li>UI 测试项目可逐步尝试 <code>StandardTestDispatcher</code>，减少与生产调度模型差异。</li>
</ul>
<h3 data-id="heading-18">4）版本策略建议</h3>
<p>如果你追求稳定，优先跟 BOM 稳定版；
如果你要抢新特性（尤其 Material3 1.5.x alpha），建议单独分支验证再合入主干。</p>
<hr/>
<h3 data-id="heading-19">小结</h3>
<p>Compose BOM <code>2026.01.01</code> 的定位很清晰：</p>
<ul>
<li>用 <code>1.10.2</code> 把核心栈稳定性再打磨一轮；</li>
<li>让 Material3 <code>1.4.0</code> 的能力成为稳定可用基线。</li>
</ul>
<p>对大多数业务 App 来说，这个版本属于“可以计划升级，并且收益可见”的一档。</p>
<hr/>
<h3 data-id="heading-20">参考链接</h3>
<ul>
<li>Compose BOM：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fbom" target="_blank" title="https://developer.android.com/develop/ui/compose/bom" ref="nofollow noopener noreferrer">developer.android.com/develop/ui/…</a></li>
</ul>
</li>
<li>BOM Mapping：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fbom%2Fbom-mapping" target="_blank" title="https://developer.android.com/develop/ui/compose/bom/bom-mapping" ref="nofollow noopener noreferrer">developer.android.com/develop/ui/…</a></li>
</ul>
</li>
<li>Compose Release Notes：
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-animation" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-animation" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-foundation" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-foundation" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-runtime" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-runtime" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-ui" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-ui" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fjetpack%2Fandroidx%2Freleases%2Fcompose-material3" target="_blank" title="https://developer.android.com/jetpack/androidx/releases/compose-material3" ref="nofollow noopener noreferrer">developer.android.com/jetpack/and…</a></li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[sql]sql和nosql]]></title>    <link>https://juejin.cn/post/7603309951227707442</link>    <guid>https://juejin.cn/post/7603309951227707442</guid>    <pubDate>2026-02-06T10:08:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603309951227707442" data-draft-id="7603393977477496858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[sql]sql和nosql"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2026-02-06T10:08:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [sql]sql和nosql
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:08:37.000Z" title="Fri Feb 06 2026 10:08:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1/核心概念</h2>
<ol>
<li>
<p><strong>SQL（Structured Query Language）</strong></p>
<ul>
<li><strong>本意</strong>：指 <strong>结构化查询语言</strong>，是与关系型数据库通信的标准语言。</li>
<li><strong>现在通常指代</strong>：<strong>关系型数据库</strong> 本身。它基于关系模型（使用表、行、列），数据模式是预定义且固定的，强调数据的 <strong>一致性</strong> 和 <strong>完整性</strong>。</li>
</ul>
</li>
<li>
<p><strong>NoSQL（Not Only SQL）</strong></p>
<ul>
<li><strong>本意</strong>：<strong>不仅仅是 SQL</strong>。</li>
<li><strong>现在通常指代</strong>：<strong>非关系型数据库</strong>。它是一个统称，涵盖所有不遵循传统关系模型的数据存储系统。NoSQL 数据库通常为 <strong>可扩展性</strong>、<strong>灵活的模式</strong> 和 <strong>高性能</strong> 等特定需求而设计。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-1">2/主要区别</h2>













































<table><thead><tr><th align="left">特性</th><th align="left">SQL（关系型数据库）</th><th align="left">NoSQL（非关系型数据库）</th></tr></thead><tbody><tr><td align="left"><strong>数据模型</strong></td><td align="left"><strong>结构化</strong>。预定义的模式（表结构），数据以<strong>行和列</strong>的形式存储在表中，表之间通过外键关联。</td><td align="left"><strong>灵活/非结构化</strong>。无固定模式。根据类型不同，可以是键值对、文档、图或宽列。</td></tr><tr><td align="left"><strong>查询语言</strong></td><td align="left">使用标准化的 <strong>SQL</strong> 语言进行增删改查。</td><td align="left">没有统一查询语言。每种数据库有自己的 API 或查询方法（如基于 JSON 的查询）。</td></tr><tr><td align="left"><strong>扩展性</strong></td><td align="left"><strong>垂直扩展</strong>为主。通过增加单台服务器的 CPU、内存、硬盘来提升性能。横向扩展（分库分表）较复杂。</td><td align="left"><strong>水平扩展</strong>为主。天然支持通过增加服务器节点（分布式集群）来分担负载，扩展性强。</td></tr><tr><td align="left"><strong>事务性（ACID）</strong></td><td align="left">强调 <strong>ACID 属性</strong>（原子性、一致性、隔离性、持久性），支持复杂事务。</td><td align="left">通常遵循 <strong>BASE 原则</strong>（基本可用、软状态、最终一致性），牺牲强一致性以获得高可用和分区容错性。但部分 NoSQL 现在也支持事务。</td></tr><tr><td align="left"><strong>主要优势</strong></td><td align="left">数据结构化，数据完整性好，支持复杂查询和多表关联操作，技术成熟。</td><td align="left">高并发读写性能好，扩展灵活，模式灵活易于迭代，能很好地处理海量数据和非结构化数据。</td></tr><tr><td align="left"><strong>主要劣势</strong></td><td align="left">扩展性相对困难，高并发下可能遇到瓶颈，固定的模式在需求频繁变化时不够灵活。</td><td align="left">不支持复杂的关联查询（Join），事务支持相对较弱（尤其在分布式下），不同产品特性差异大。</td></tr><tr><td align="left"><strong>适用场景</strong></td><td align="left">需要复杂查询、强一致性、事务支持的场景。如：金融系统、ERP、CRM、会计系统等。</td><td align="left">大数据量、高并发、模式多变、数据结构不固定的场景。如：社交网络、内容管理系统、物联网、实时分析、购物车缓存等。</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">3/各自代表的数据库</h2>
<h5 data-id="heading-3"><strong>SQL（关系型数据库）代表</strong></h5>
<p>这些都是 <strong>基于表的、支持 SQL 标准</strong> 的成熟数据库。</p>
<ol>
<li><strong>MySQL / MariaDB</strong>： 最流行的开源关系数据库，广泛用于Web应用。MariaDB 是 MySQL 的一个分支。</li>
<li><strong>PostgreSQL</strong>： 功能强大的开源对象-关系型数据库，支持高级数据类型（如 JSON、GIS）和复杂查询，被誉为“最先进的开源关系数据库”。</li>
<li><strong>Oracle Database</strong>： 企业级商业数据库的王者，功能极其全面强大，常用于大型、关键业务系统。</li>
<li><strong>Microsoft SQL Server</strong>： 微软推出的商业数据库，与 Windows 生态和 .NET 平台集成紧密。</li>
<li><strong>SQLite</strong>： 轻量级的嵌入式数据库，整个数据库就是一个文件，常用于移动端和桌面应用。</li>
</ol>
<h5 data-id="heading-4"><strong>NoSQL（非关系型数据库）代表</strong></h5>
<p>NoSQL 通常分为以下几大类，每类解决不同问题：</p>
<p><strong>1. 文档型数据库</strong></p>
<ul>
<li><strong>特点</strong>： 数据以类似 JSON/BSON 的<strong>文档</strong>形式存储，每个文档可以有完全不同的结构。</li>
<li><strong>代表</strong>：
<ul>
<li><strong>MongoDB</strong>： 最流行的文档数据库，查询功能强大，适合内容管理、用户配置等。</li>
<li><strong>CouchDB</strong>： 使用 HTTP API，支持数据同步。</li>
</ul>
</li>
</ul>
<p><strong>2. 键值型数据库</strong></p>
<ul>
<li><strong>特点</strong>： 最简单的 NoSQL 模型，数据以 <strong>键-值对</strong> 形式存储，通过键快速访问值。性能极高。</li>
<li><strong>代表</strong>：
<ul>
<li><strong>Redis</strong>： 数据存储在内存中，速度极快，常用作缓存、消息队列、会话存储。</li>
<li><strong>Amazon DynamoDB</strong>： AWS 托管的键值/文档混合数据库，提供极高的可扩展性。</li>
<li><strong>etcd</strong>： 用于分布式系统配置共享和服务发现。</li>
</ul>
</li>
</ul>
<p><strong>3. 宽列存储数据库</strong></p>
<ul>
<li><strong>特点</strong>： 数据存储在 <strong>列族</strong> 中，可以动态添加列，非常适合<strong>海量数据</strong>的存储和查询（特别是读操作）。</li>
<li><strong>代表</strong>：
<ul>
<li><strong>Apache Cassandra</strong>： 高可用、无单点故障的分布式数据库，写性能优异。</li>
<li><strong>Apache HBase</strong>： 构建在 Hadoop HDFS 之上的分布式数据库，适合大数据分析。</li>
<li><strong>Google Bigtable</strong>： Cassandra 和 HBase 的设计灵感来源。</li>
</ul>
</li>
</ul>
<p><strong>4. 图数据库</strong></p>
<ul>
<li><strong>特点</strong>： 专门存储<strong>实体（节点）</strong> 和<strong>关系（边）</strong> 的信息，擅长处理复杂的关系网络。</li>
<li><strong>代表</strong>：
<ul>
<li><strong>Neo4j</strong>： 最著名的图数据库，使用 Cypher 查询语言。</li>
<li><strong>Amazon Neptune</strong>： AWS 托管的图数据库服务。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">4/总结与趋势</h2>
<ul>
<li><strong>不是替代关系，而是互补关系</strong>： SQL 和 NoSQL 适用于不同的场景。现代架构中经常 <strong>混合使用</strong>，例如用 MySQL 存储核心交易数据，用 Redis 做缓存，用 Elasticsearch（一种搜索引擎，常被归为 NoSQL）做全文检索。</li>
<li><strong>融合趋势</strong>： 出现了 <strong>“NewSQL”</strong> 数据库（如 Google Spanner, CockroachDB），试图结合 SQL 的强一致性和 NoSQL 的水平扩展性。同时，许多传统 SQL 数据库（如 PostgreSQL, MySQL）也开始支持 JSON 等非结构化数据，而 NoSQL 数据库（如 MongoDB）也增加了事务支持。</li>
<li><strong>如何选择</strong>：
<ul>
<li>如果你的数据<strong>结构化、关系复杂、需要强一致性</strong>，优先选择 <strong>SQL</strong>。</li>
<li>如果你需要处理<strong>海量数据、高并发、模式多变、或数据结构松散</strong>，优先考虑 <strong>NoSQL</strong>。</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第14章：包管理与模块化开发——组织大型项目]]></title>    <link>https://juejin.cn/post/7603383311531048975</link>    <guid>https://juejin.cn/post/7603383311531048975</guid>    <pubDate>2026-02-06T10:12:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603383311531048975" data-draft-id="7603355275258118184" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第14章：包管理与模块化开发——组织大型项目"/> <meta itemprop="keywords" content="后端,Go,编程语言"/> <meta itemprop="datePublished" content="2026-02-06T10:12:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第14章：包管理与模块化开发——组织大型项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:12:25.000Z" title="Fri Feb 06 2026 10:12:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Golang开发中，从小脚本到大型分布式应用，最核心的转变之一就是「代码组织与依赖管理」。早期的GOPATH模式曾因依赖混乱、版本冲突等问题让开发者诟病，而Go 1.11正式推出的Go Modules，彻底解决了这一痛点，成为目前Golang大型项目的标准模块化方案。</p>
<h3 data-id="heading-0">一、包的作用</h3>
<p>包（Package）是Golang中<strong>组织代码的最小单元</strong>，本质是将功能相关的.go文件聚合在一起，实现“模块化拆分、代码复用、作用域隔离”，类比Java的Package、Python的Module，是大型项目分层、协作开发的基础。</p>
<p>简单来说，包的核心作用有3个，用表格清晰梳理（掘金常用呈现方式）：</p>





















<table><thead><tr><th><strong>核心作用</strong></th><th><strong>详细说明（直击痛点）</strong></th></tr></thead><tbody><tr><td>代码复用</td><td>将通用功能（如工具函数、常用结构体、加密逻辑）封装成包，多个项目或项目内多个模块可直接导入使用，避免重复编码（比如所有项目都需要的字符串处理，封装成utils包一次开发、多次复用）</td></tr><tr><td>作用域隔离</td><td>通过包名和公私访问控制，解决命名冲突（比如A模块和B模块都有Init()函数，通过包名a.Init()、b.Init()区分，无需担心同名覆盖）</td></tr><tr><td>项目结构化</td><td>大型项目可按功能拆分多个包（如路由包router、数据库包db、工具包utils、业务包service），让代码层次清晰，便于多人协作、后期维护（比如后端项目中，路由、业务、数据访问分层拆分，各司其职）</td></tr></tbody></table>
<h4 data-id="heading-1">1.1 极简代码示例（包的基本结构）</h4>
<p>假设我们创建一个简单的工具包utils，包含一个计算平方的函数，目录结构和代码如下（简化版，聚焦核心）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 目录结构：utils/square.go（单个文件即可构成一个包）</span>
<span class="hljs-keyword">package</span> utils <span class="hljs-comment">// 声明当前文件属于utils包（包名建议与目录名一致，便于识别）</span>

<span class="hljs-comment">// CalculateSquare 计算整数的平方（后续讲解私有公有，此处先聚焦包结构）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CalculateSquare</span><span class="hljs-params">(num <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> num * num
}

</code></pre>
<p>在项目的主文件中，我们可以直接导入这个utils包，复用CalculateSquare函数，无需重复编写计算逻辑：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 目录结构：main.go（与utils目录同级）</span>
<span class="hljs-keyword">package</span> main <span class="hljs-comment">// 主程序必须属于main包，且包含main()函数</span>

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"./utils"</span> <span class="hljs-comment">// 导入当前目录下的utils包（后续讲解导入规则的详细用法）</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    res := utils.CalculateSquare(<span class="hljs-number">5</span>) <span class="hljs-comment">// 通过「包名.函数名」调用包内功能</span>
    fmt.Printf(<span class="hljs-string">"5的平方是：%d\n"</span>, res) <span class="hljs-comment">// 输出：5的平方是：25</span>
}

</code></pre>
<h4 data-id="heading-2">1.2 关键补充（避坑重点）</h4>
<ul>
<li>
<p>一个目录下的所有.go文件，必须声明属于同一个包（比如utils目录下的所有文件，package声明都必须是utils，不能出现其他包名）；</p>
</li>
<li>
<p>包名可以与目录名不同，但不推荐（比如utils目录下的文件声明package util，会增加识别成本，不符合Go的简洁原则）；</p>
</li>
<li>
<p>main包是特殊包：只有main包可以包含main()函数（程序入口），非main包不能有main()函数，只能被其他包导入使用。</p>
</li>
</ul>
<h4 data-id="heading-3">1.3 参考链接</h4>
<ul>
<li>
<p>Go官方文档（包的基础概念）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Fcode%23Packages" target="_blank" title="https://go.dev/doc/code#Packages" ref="nofollow noopener noreferrer">Organizing code with packages</a></p>
</li>
<li>
<p>掘金优质文（包的核心用法）：<a href="https://juejin.cn/post/6844903902202802189" target="_blank" title="https://juejin.cn/post/6844903902202802189">Go 包（Package）详解：从基础到实战</a></p>
</li>
</ul>
<h3 data-id="heading-4">二、导入规则</h3>
<p>导入（import）是Go中使用其他包的核心方式，本质是“引入其他包的公开功能”，支持多种导入语法，适用于不同场景（如标准库导入、自定义包导入、第三方包导入）。核心规则：导入路径必须能唯一定位到目标包，且导入后需通过「包名.功能名」调用。</p>
<p>下面按“导入语法分类+场景示例”的方式讲解，贴合掘金“实用优先”风格，每个示例都极简可运行。</p>
<h4 data-id="heading-5">2.1 三种核心导入语法（表格梳理）</h4>






























<table><thead><tr><th><strong>语法类型</strong></th><th><strong>语法格式</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>直接导入</td><td>import "包路径"</td><td>最常用，导入单个包，通过包名直接调用功能（如标准库fmt、自定义包utils）</td></tr><tr><td>批量导入</td><td>import ( "包1路径" "包2路径" )</td><td>导入多个包，代码更简洁（推荐，符合Go代码规范）</td></tr><tr><td>别名导入</td><td>import 别名 "包路径"</td><td>解决包名冲突，或简化过长的包名（如将复杂包名简化为简短别名）</td></tr><tr><td>匿名导入</td><td>import _ "包路径"</td><td>只执行包的init()函数，不使用包内其他功能（如数据库驱动包，只需初始化注册）</td></tr></tbody></table>
<h4 data-id="heading-6">2.2 极简代码示例（分场景）</h4>
<h5 data-id="heading-7">示例1：直接导入+批量导入（最常用）</h5>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>          <span class="hljs-comment">// 批量导入：标准库fmt包（打印功能）</span>
    <span class="hljs-string">"math/rand"</span>    <span class="hljs-comment">// 批量导入：标准库math/rand包（随机数功能）</span>
    <span class="hljs-string">"./utils"</span>      <span class="hljs-comment">// 批量导入：自定义包utils（前文创建的工具包）</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    fmt.Println(<span class="hljs-string">"随机数："</span>, rand.Intn(<span class="hljs-number">100</span>)) <span class="hljs-comment">// 标准库包调用：rand包的Intn函数</span>
    fmt.Println(<span class="hljs-string">"3的平方："</span>, utils.CalculateSquare(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 自定义包调用</span>
}

</code></pre>
<h5 data-id="heading-8">示例2：别名导入（解决包名冲突）</h5>
<p>假设我们导入两个包，包名都叫util（冲突），此时用别名区分：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    u1 <span class="hljs-string">"./util1"</span>   <span class="hljs-comment">// 别名u1，对应util1包</span>
    u2 <span class="hljs-string">"./util2"</span>   <span class="hljs-comment">// 别名u2，对应util2包（两个包名都是util，通过别名区分）</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    fmt.Println(u1.GetName()) <span class="hljs-comment">// 调用util1包的功能（别名u1）</span>
    fmt.Println(u2.GetName()) <span class="hljs-comment">// 调用util2包的功能（别名u2）</span>
}

</code></pre>
<h5 data-id="heading-9">示例3：匿名导入（初始化包，不使用功能）</h5>
<p>典型场景：导入MySQL驱动包，只需执行其init()函数完成注册，无需直接调用包内功能：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"database/sql"</span>
    _ <span class="hljs-string">"github.com/go-sql-driver/mysql"</span> <span class="hljs-comment">// 匿名导入：MySQL驱动包（只执行init）</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 无需调用驱动包的功能，只需初始化后，即可使用sql包操作MySQL</span>
    db, _ := sql.Open(<span class="hljs-string">"mysql"</span>, <span class="hljs-string">"user:pass@tcp(127.0.0.1:3306)/dbname"</span>)
    <span class="hljs-keyword">defer</span> db.Close()
}

</code></pre>
<h4 data-id="heading-10">2.3 导入路径的3种类型（重点）</h4>
<p>导入路径是导入规则的核心，必须能唯一定位到包，分为3种类型，对应不同场景：</p>
<ol>
<li>
<p><strong>标准库路径</strong>：直接写包名（如fmt、math、os），Go会自动从标准库目录中查找（无需手动配置路径）；</p>
</li>
<li>
<p><strong>相对路径</strong>：以「./」或「../」开头，对应当前项目内的自定义包（如./utils、../common），适用于项目内包的导入；</p>
</li>
<li>
<p><strong>绝对路径（Go Modules）</strong>：以模块名开头（如github.com/yourname/yourproject/utils），适用于第三方包或跨项目导入（后续Go Modules章节详细讲解）。</p>
</li>
</ol>
<h4 data-id="heading-11">2.4 常见误区（避坑重点）</h4>
<ul>
<li>
<p>导入路径错误：相对路径必须正确（比如当前文件在src目录，utils在src/utils，导入路径写./utils，不能漏写./）；</p>
</li>
<li>
<p>导入未使用：Go不允许导入包后不使用（编译报错），若确实需要导入（如匿名导入），用_别名；</p>
</li>
<li>
<p>循环导入：两个包互相导入（如a导入b，b导入a），会导致编译报错，这是大型项目常见坑，需通过“拆分公共包”解决。</p>
</li>
</ul>
<h4 data-id="heading-12">2.5 参考链接</h4>
<ul>
<li>Go官方文档（导入规则）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Import_declarations" target="_blank" title="https://go.dev/ref/spec#Import_declarations" ref="nofollow noopener noreferrer">Import declarations</a></li>
</ul>
<h3 data-id="heading-13">三、私有公有</h3>
<p>Go中没有专门的关键字（如public、private）来定义私有/公有，而是通过<strong>标识符首字母大小写</strong>来区分，这是Go简洁设计的体现，规则极其简单，记住一句话即可：<strong>首字母大写=公有（可被其他包导入使用），首字母小写=私有（只能在当前包内使用）</strong>。</p>
<p>适用范围：函数、变量、结构体、结构体字段、接口等所有标识符，均遵循此规则。</p>
<h4 data-id="heading-14">3.1 极简代码示例（清晰区分）</h4>
<p>先创建一个utils包，包含公有和私有标识符，观察其他包能否导入使用：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 目录：utils/common.go</span>
<span class="hljs-keyword">package</span> utils

<span class="hljs-comment">// 1. 公有函数（首字母大写）：可被其他包导入使用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PublicFunc</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"我是公有函数，可被外部调用"</span>
}

<span class="hljs-comment">// 2. 私有函数（首字母小写）：只能在utils包内使用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">privateFunc</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"我是私有函数，外部包无法调用"</span>
}

<span class="hljs-comment">// 3. 公有结构体（首字母大写）</span>
<span class="hljs-keyword">type</span> PublicStruct <span class="hljs-keyword">struct</span> {
    PublicField <span class="hljs-type">string</span> <span class="hljs-comment">// 公有字段（首字母大写）</span>
    privateField <span class="hljs-type">string</span> <span class="hljs-comment">// 私有字段（首字母小写）</span>
}

<span class="hljs-comment">// 4. 私有结构体（首字母小写）</span>
<span class="hljs-keyword">type</span> privateStruct <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span>
}

<span class="hljs-comment">// 5. 公有变量（首字母大写）</span>
<span class="hljs-keyword">var</span> PublicVar = <span class="hljs-string">"我是公有变量"</span>

<span class="hljs-comment">// 6. 私有变量（首字母小写）</span>
<span class="hljs-keyword">var</span> privateVar = <span class="hljs-string">"我是私有变量"</span>

</code></pre>
<p>在main包中导入utils包，测试能否使用这些标识符：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"./utils"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 1. 调用公有函数：正常使用</span>
    fmt.Println(utils.PublicFunc())

    <span class="hljs-comment">// 2. 调用私有函数：编译报错（undefined: utils.privateFunc）</span>
    <span class="hljs-comment">// fmt.Println(utils.privateFunc())</span>

    <span class="hljs-comment">// 3. 使用公有结构体和公有字段：正常使用</span>
    obj := utils.PublicStruct{
        PublicField: <span class="hljs-string">"测试公有字段"</span>,
        <span class="hljs-comment">// privateField: "无法赋值", // 编译报错：私有字段，外部无法访问</span>
    }
    fmt.Println(obj.PublicField)

    <span class="hljs-comment">// 4. 使用私有结构体：编译报错（undefined: utils.privateStruct）</span>
    <span class="hljs-comment">// var p utils.privateStruct</span>

    <span class="hljs-comment">// 5. 使用公有变量：正常使用</span>
    fmt.Println(utils.PublicVar)

    <span class="hljs-comment">// 6. 使用私有变量：编译报错（undefined: utils.privateVar）</span>
    <span class="hljs-comment">// fmt.Println(utils.privateVar)</span>
}

</code></pre>
<h4 data-id="heading-15">3.2 核心补充（避坑重点）</h4>
<ul>
<li>
<p>私有标识符的作用域：仅当前包内，即使是同一个项目的其他包，也无法访问；</p>
</li>
<li>
<p>结构体字段的特殊性：即使结构体是公有的，其私有字段（首字母小写）也无法被外部包访问（如示例中PublicStruct的privateField）；</p>
</li>
<li>
<p>访问私有标识符的间接方式：若需让外部包使用包内私有功能，可通过公有函数封装（比如在utils包中写一个公有函数，调用内部私有函数，外部包调用这个公有函数即可）。</p>
</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// utils/common.go 补充：用公有函数封装私有功能</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetPrivateData</span><span class="hljs-params">()</span></span> <span class="hljs-type">string</span> {
    <span class="hljs-keyword">return</span> privateFunc() <span class="hljs-comment">// 公有函数内部调用私有函数</span>
}

<span class="hljs-comment">// main.go 中调用：正常使用</span>
fmt.Println(utils.GetPrivateData()) <span class="hljs-comment">// 输出：我是私有函数，外部包无法调用</span>

</code></pre>
<h4 data-id="heading-16">3.3 参考链接</h4>
<ul>
<li>Go官方文档（标识符可见性）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fspec%23Exported_identifiers" target="_blank" title="https://go.dev/ref/spec#Exported_identifiers" ref="nofollow noopener noreferrer">Exported identifiers</a></li>
</ul>
<h3 data-id="heading-17">四、Go Modules</h3>
<p>Go Modules（简称mod）是Go 1.11推出、Go 1.16强制启用的<strong>模块化包管理工具</strong>，核心目标是解决早期GOPATH模式的痛点（依赖混乱、版本冲突、无法跨环境复用），目前是Golang大型项目的标准包管理方案。</p>
<p>核心定义：一个Go Modules就是一个“模块”，对应一个项目，包含项目的所有代码、依赖配置，模块通过「模块名」唯一标识，便于依赖管理和跨项目复用。</p>
<h4 data-id="heading-18">4.1 为什么需要Go Modules？（痛点对比）</h4>
<p>早期GOPATH模式的3大痛点，Go Modules全部解决，用表格对比更清晰：</p>

























<table><thead><tr><th><strong>痛点</strong></th><th><strong>GOPATH模式</strong></th><th><strong>Go Modules模式</strong></th></tr></thead><tbody><tr><td>项目路径限制</td><td>所有项目必须放在GOPATH/src目录下，极其不便</td><td>项目可放在任意目录，无路径限制</td></tr><tr><td>依赖管理</td><td>无版本控制，依赖全部放在GOPATH/pkg，不同项目依赖冲突</td><td>每个项目独立管理依赖，支持版本控制，依赖隔离</td></tr><tr><td>跨项目复用</td><td>自定义包只能在GOPATH内复用，跨环境需手动复制</td><td>通过模块名导入，支持远程仓库（GitHub、GitLab）复用</td></tr></tbody></table>
<h4 data-id="heading-19">4.2 核心命令（高频使用，极简记忆）</h4>
<p>Go Modules的使用全靠命令行，核心命令只有5个，掌握即可应对90%的场景，每个命令配简短说明：</p>



































<table><thead><tr><th><strong>命令</strong></th><th><strong>功能说明</strong></th><th><strong>常用场景</strong></th></tr></thead><tbody><tr><td>go mod init 模块名</td><td>初始化模块，生成go.mod文件（模块的核心配置文件）</td><td>新建项目时，首次执行（必须）</td></tr><tr><td>go mod tidy</td><td>自动梳理依赖：添加缺失的依赖、删除无用的依赖</td><td>导入新依赖后、删除依赖后，执行（最常用）</td></tr><tr><td>go mod download</td><td>手动下载go.mod中声明的所有依赖</td><td>跨环境部署时，快速下载依赖</td></tr><tr><td>go mod vendor</td><td>将依赖复制到项目的vendor目录（本地依赖备份）</td><td>无网络环境部署、依赖版本固定</td></tr><tr><td>go mod verify</td><td>验证依赖的完整性（是否被篡改）</td><td>怀疑依赖被修改时，执行校验</td></tr></tbody></table>
<h4 data-id="heading-20">4.3 极简实战示例（初始化模块）</h4>
<p>全程模拟新建一个Go Modules项目，步骤清晰，可直接跟着操作：</p>
<ol>
<li>
<p><strong>新建项目目录</strong>（任意路径，无需在GOPATH）：
<code>mkdir go-mod-demo &amp;&amp; cd go-mod-demo</code></p>
</li>
<li>
<p><strong>初始化模块</strong>（模块名建议用远程仓库地址，便于后续发布，本地测试可自定义）：
<code>go mod init github.com/yourname/go-mod-demo</code>执行后，项目目录下会生成<strong>go.mod文件</strong>（核心配置文件），内容如下（极简）：`module github.com/yourname/go-mod-demo # 模块名（唯一标识）</p>
</li>
</ol>
<p>go 1.21 # 当前项目使用的Go版本`</p>
<ol start="3">
<li><strong>编写代码，导入依赖</strong>（比如导入标准库fmt和第三方包gin）：
`// main.go
package main</li>
</ol>
<p>import (
"fmt"
"github.com/gin-gonic/gin" // 第三方依赖（gin框架）
)</p>
<p>func main() {
r := gin.Default()
r.GET("/", func(c *gin.Context) {
c.String(200, "Hello Go Modules!")
})
fmt.Println("服务启动：localhost:8080")
r.Run()
}`</p>
<ol start="4">
<li>
<p><strong>梳理依赖</strong>（自动下载缺失的gin依赖）：
<code>go mod tidy</code>执行后，会发生两个变化：</p>
<ul>
<li>
<p>go.mod文件会自动添加gin的依赖声明（后续依赖配置章节详细讲）；</p>
</li>
<li>
<p>生成<strong>go.sum文件</strong>（依赖校验文件，记录依赖的版本和哈希值，防止篡改）。</p>
</li>
</ul>
</li>
<li>
<p><strong>运行程序</strong>（正常执行，依赖已自动处理）：
<code>go run main.go</code></p>
</li>
</ol>
<h4 data-id="heading-21">4.4 关键补充（核心概念）</h4>
<ul>
<li>
<p>go.mod：模块的核心配置文件，记录模块名、Go版本、依赖包的名称和版本，是Go Modules的核心；</p>
</li>
<li>
<p>go.sum：依赖校验文件，无需手动修改，Go会自动维护，用于验证依赖的完整性；</p>
</li>
<li>
<p>依赖存储路径：Go Modules下载的依赖，默认存储在 $GOPATH/pkg/mod 目录下，多个项目可共享依赖（避免重复下载）。</p>
</li>
</ul>
<h4 data-id="heading-22">4.5 参考链接</h4>
<ul>
<li>Go官方文档（Go Modules详解）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fmod" target="_blank" title="https://go.dev/ref/mod" ref="nofollow noopener noreferrer">Go Modules Reference</a></li>
</ul>
<h3 data-id="heading-23">五、版本管理</h3>
<p>Go Modules的版本管理遵循<strong>语义化版本（Semantic Versioning，简称SemVer）</strong>，核心是“用版本号区分依赖的迭代，避免版本冲突”，版本号格式固定，且支持多种版本选择方式，适配不同场景（如固定版本、兼容版本、最新版本）。</p>
<h4 data-id="heading-24">5.1 语义化版本格式（必须记住）</h4>
<p>Go Modules强制要求依赖包遵循语义化版本，格式为：<strong>v主版本.次版本.修订版本</strong>（如v1.2.3），每个部分的含义如下：</p>
<ul>
<li>
<p>主版本（Major）：v1、v2... ，当API发生不兼容的重大变更时，主版本号加1（如v1→v2）；</p>
</li>
<li>
<p>次版本（Minor）：v1.2、v1.3... ，当新增功能但API兼容时，次版本号加1（如v1.2→v1.3）；</p>
</li>
<li>
<p>修订版本（Patch）：v1.2.3、v1.2.4... ，当修复bug但不新增功能、不修改API时，修订版本号加1（如v1.2.3→v1.2.4）。</p>
</li>
</ul>
<p>补充：预发布版本（如v1.2.3-beta.1）、开发版本（如v1.2.3-20240501123456-abcdef123456）也被支持，但生产环境优先使用正式版本。</p>
<h4 data-id="heading-25">5.2 版本选择方式（4种高频场景）</h4>
<p>在go.mod中声明依赖版本时，支持多种写法，对应不同的版本选择策略，用表格梳理（结合示例，易懂好记）：</p>






























<table><thead><tr><th><strong>选择方式</strong></th><th><strong>写法示例</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>固定版本</td><td>github.com/gin-gonic/gin v1.9.1</td><td>强制使用指定版本（v1.9.1），不自动升级，最稳定（生产环境推荐）</td></tr><tr><td>兼容版本</td><td>github.com/gin-gonic/gin v1.9.0+incompatible</td><td>使用兼容指定版本的最新版本（如v1.9.1、v1.9.2，不超过v2.0.0）</td></tr><tr><td>最新版本</td><td>github.com/gin-gonic/gin latest</td><td>自动使用该依赖的最新正式版本（不推荐生产环境，可能有兼容性问题）</td></tr><tr><td>主版本兼容</td><td>github.com/gin-gonic/gin v1</td><td>使用v1主版本下的最新版本（如v1.9.1，不升级到v2）</td></tr></tbody></table>
<h4 data-id="heading-26">5.3 极简代码示例（版本操作）</h4>
<h5 data-id="heading-27">示例1：手动指定固定版本</h5>
<p>在go.mod中手动添加依赖，指定固定版本（v1.9.1）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// go.mod</span>
module github.com/yourname/<span class="hljs-keyword">go</span>-mod-demo

<span class="hljs-keyword">go</span> <span class="hljs-number">1.21</span>

<span class="hljs-comment">// 手动指定gin版本为v1.9.1（固定版本）</span>
require github.com/gin-gonic/gin v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>
</code></pre>
<p>执行go mod tidy，会自动下载v1.9.1版本的gin，且不会自动升级。</p>
<h5 data-id="heading-28">示例2：升级/降级依赖版本</h5>
<p>通过go get命令升级或降级依赖版本，无需手动修改go.mod：</p>
<pre><code class="hljs language-bash" lang="bash">// 1. 升级gin到最新版本
go get github.com/gin-gonic/gin@latest

// 2. 升级gin到指定版本（v1.9.2）
go get github.com/gin-gonic/gin@v1.9.2

// 3. 降级gin到指定版本（v1.9.0）
go get github.com/gin-gonic/gin@v1.9.0
</code></pre>
<p>执行后，go.mod和go.sum会自动更新为对应版本。</p>
<h5 data-id="heading-29">示例3：主版本变更的注意事项</h5>
<p>当依赖包的主版本变更（如v1→v2），API可能不兼容，Go Modules要求导入路径必须包含主版本号（如v2），示例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 导入gin的v2版本（主版本变更，导入路径需加/v2）</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"github.com/gin-gonic/gin/v2"</span>

<span class="hljs-comment">// go.mod中对应的依赖声明</span>
require github.com/gin-gonic/gin/v2 v2<span class="hljs-number">.0</span><span class="hljs-number">.0</span>
</code></pre>
<h4 data-id="heading-30">5.4 常见误区（避坑重点）</h4>
<ul>
<li>
<p>版本号必须以v开头：如v1.2.3（正确），1.2.3（错误），Go Modules不识别非v开头的版本；</p>
</li>
<li>
<p>主版本变更即不兼容：v1和v2是两个不兼容的版本，导入路径需加/v2，否则会报错；</p>
</li>
<li>
<p>避免使用latest版本：生产环境中，latest版本可能随时更新，导致项目不稳定，优先使用固定版本。</p>
</li>
</ul>
<h4 data-id="heading-31">5.5 参考链接</h4>
<ul>
<li>Go官方文档（版本管理）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fmod%23versions" target="_blank" title="https://go.dev/ref/mod#versions" ref="nofollow noopener noreferrer">Module versions</a></li>
</ul>
<h3 data-id="heading-32">六、依赖配置</h3>
<p>依赖配置的核心是<strong>go.mod文件</strong>，所有依赖相关的配置（依赖声明、版本约束、替换依赖、排除依赖）都在该文件中定义，Go会自动维护大部分内容，手动修改时需遵循固定语法，本节讲解go.mod中最常用的配置项。</p>
<p>先看一个完整的go.mod示例（包含所有常用配置），再逐一拆解：</p>
<pre><code class="hljs language-go" lang="go">module github.com/yourname/<span class="hljs-keyword">go</span>-mod-demo # 模块名

<span class="hljs-keyword">go</span> <span class="hljs-number">1.21</span> # Go版本

# 直接依赖（手动添加或<span class="hljs-keyword">go</span> mod tidy自动添加）
require (
    github.com/gin-gonic/gin v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>
    github.com/<span class="hljs-keyword">go</span>-sql-driver/mysql v1<span class="hljs-number">.7</span><span class="hljs-number">.1</span>
)

# 替换依赖（将远程依赖替换为本地依赖，便于开发调试）
replace github.com/gin-gonic/gin =&gt; ../gin

# 排除依赖（排除某个依赖的特定版本）
exclude github.com/<span class="hljs-keyword">go</span>-sql-driver/mysql v1<span class="hljs-number">.7</span><span class="hljs-number">.0</span>
</code></pre>
<h4 data-id="heading-33">6.1 核心配置项（分点详解）</h4>
<h5 data-id="heading-34">6.1.1 module（模块名）</h5>
<p>格式：module 模块名，是模块的唯一标识，必须放在go.mod文件的第一行，用于导入该模块（如其他项目导入当前模块，需使用该模块名作为导入路径）。</p>
<p>示例：module github.com/yourname/go-mod-demo（推荐用远程仓库地址，便于后续发布）。</p>
<h5 data-id="heading-35">6.1.2 go（Go版本）</h5>
<p>格式：go 版本号，声明当前模块使用的Go版本，用于指定编译该模块所需的最低Go版本，Go会根据该版本启用对应的语言特性。</p>
<p>示例：go 1.21（表示当前模块需用Go 1.21及以上版本编译）。</p>
<h5 data-id="heading-36">6.1.3 require（依赖声明）</h5>
<p>格式：require 依赖包路径 版本号，核心配置项，用于声明项目所需的依赖包及其版本，支持单个声明和批量声明（用括号包裹）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 单个依赖声明</span>
require github.com/gin-gonic/gin v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>

<span class="hljs-comment">// 批量依赖声明（推荐，简洁）</span>
require (
    github.com/gin-gonic/gin v1<span class="hljs-number">.9</span><span class="hljs-number">.1</span>
    github.com/<span class="hljs-keyword">go</span>-sql-driver/mysql v1<span class="hljs-number">.7</span><span class="hljs-number">.1</span>
)
</code></pre>
<h5 data-id="heading-37">6.1.4 replace（替换依赖）</h5>
<p>格式：replace 原依赖路径 =&gt; 替换后的路径，核心用于“开发调试”，将远程依赖（如GitHub上的包）替换为本地依赖（本地目录中的包），无需修改代码中的导入路径。</p>
<p>示例（将远程gin包替换为本地gin包）：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 格式：replace 原依赖路径 =&gt; 本地依赖目录（相对路径或绝对路径）</span>
replace github.com/gin-gonic/gin =&gt; ../gin
</code></pre>
<p>注意：replace配置仅在本地开发有效，发布模块时，需删除replace配置（否则其他项目导入会报错）。</p>
<h5 data-id="heading-38">6.1.5 exclude（排除依赖）</h5>
<p>格式：exclude 依赖包路径 版本号，用于排除某个依赖的特定版本（如某个版本有bug，不希望项目使用该版本）。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 排除mysql包的v1.7.0版本（项目不会使用该版本）</span>
exclude github.com/<span class="hljs-keyword">go</span>-sql-driver/mysql v1<span class="hljs-number">.7</span><span class="hljs-number">.0</span>
</code></pre>
<h4 data-id="heading-39">6.2 极简实战示例（依赖配置调试）</h4>
<p>模拟本地开发时，替换远程依赖为本地依赖，步骤如下：</p>
<ol>
<li>
<p>本地有两个项目：go-mod-demo（主项目）、gin（本地gin源码，用于调试），目录结构如下：
<code>├── go-mod-demo # 主项目（Go Modules模块） │   ├── go.mod │   └── main.go └── gin # 本地gin源码（用于替换远程依赖）</code></p>
</li>
<li>
<p>在主项目的go.mod中添加replace配置：
<code>replace github.com/gin-gonic/gin =&gt; ../gin</code></p>
</li>
<li>
<p>主项目代码中，正常导入远程gin包：
<code>import "github.com/gin-gonic/gin"</code></p>
</li>
<li>
<p>执行go mod tidy，Go会自动使用本地gin包（而非远程包），便于调试本地修改的gin源码。</p>
</li>
</ol>
<h4 data-id="heading-40">6.3 常见误区（避坑重点）</h4>
<ul>
<li>
<p>手动修改go.mod需谨慎：go.mod的语法严格，手动修改时，避免写错依赖路径、版本号（否则go mod tidy会报错）；</p>
</li>
<li>
<p>replace配置不可发布：发布模块前，必须删除replace配置，否则其他项目无法正常导入你的模块；</p>
</li>
<li>
<p>exclude配置仅作用于直接依赖：exclude无法排除间接依赖（即依赖的依赖），如需排除间接依赖，需使用replace替换。</p>
</li>
</ul>
<h4 data-id="heading-41">6.4 参考链接</h4>
<ul>
<li>Go官方文档（go.mod配置）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fref%2Fmod%23go-mod-file" target="_blank" title="https://go.dev/ref/mod#go-mod-file" ref="nofollow noopener noreferrer">The go.mod file</a></li>
</ul>
<h3 data-id="heading-42">七、模块发布</h3>
<p>模块发布的核心是“将你的Go Modules模块，发布到远程代码仓库（如GitHub、GitLab），供其他项目导入使用”，发布流程简单，核心是“遵循语义化版本+打标签”，全程无需额外工具，只需使用Git命令即可完成。</p>
<p>前提：已创建远程代码仓库（如GitHub仓库），且本地模块的module名与远程仓库地址一致（如module github.com/yourname/yourmodule）。</p>
<h4 data-id="heading-43">7.1 模块发布的5个步骤（极简实战）</h4>
<p>以GitHub为例，全程可直接跟着操作，步骤清晰：</p>
<ol>
<li>
<p><strong>检查模块配置</strong>（关键第一步）：</p>
<ul>
<li>
<p>确保go.mod中的module名，与GitHub仓库地址一致（如GitHub仓库地址是<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyourname%2Fmyutil%25EF%25BC%258Cmodule%25E5%2590%258D%25E5%25BF%2585%25E9%25A1%25BB%25E6%2598%25AFgithub.com%2Fyourname%2Fmyutil%25EF%25BC%2589%25EF%25BC%259B" target="_blank" title="https://github.com/yourname/myutil%EF%BC%8Cmodule%E5%90%8D%E5%BF%85%E9%A1%BB%E6%98%AFgithub.com/yourname/myutil%EF%BC%89%EF%BC%9B" ref="nofollow noopener noreferrer">github.com/yourname/my…</a></p>
</li>
<li>
<p>删除go.mod中的replace配置（若有），避免影响其他项目导入；</p>
</li>
<li>
<p>执行go mod tidy，确保依赖完整、无无用依赖。</p>
</li>
</ul>
</li>
<li>
<p><strong>初始化Git仓库（本地）</strong>：
`# 初始化Git仓库
git init</p>
</li>
</ol>
<h2 data-id="heading-44">添加所有文件</h2>
<p>git add .</p>
<h2 data-id="heading-45">提交代码（提交信息建议规范，如"feat: 完成utils包核心功能"）</h2>
<p>git commit -m "feat: init module, add CalculateSquare function"`</p>
<ol start="3">
<li>
<p><strong>关联远程GitHub仓库</strong>：
<code># 关联远程仓库（替换为你的GitHub仓库地址） git remote add origin https://github.com/yourname/myutil.git</code></p>
</li>
<li>
<p><strong>打版本标签（核心步骤）</strong>：
遵循语义化版本，打标签（标签名必须以v开头，如v1.0.0），标签是Go Modules识别版本的核心：`# 打标签（v1.0.0，首次发布建议用v1.0.0）
git tag v1.0.0</p>
</li>
</ol>
<h2 data-id="heading-46">查看标签</h2>
<p>git tag`</p>
<ol start="5">
<li><strong>推送代码和标签到远程仓库</strong>：
`# 推送代码到远程master/main分支
git push origin master</li>
</ol>
<h2 data-id="heading-47">推送标签到远程（必须推送标签，否则其他项目无法获取版本）</h2>
<p>git push origin v1.0.0`</p>
<p>推送完成后，你的模块就发布成功了！其他项目可通过go get命令导入使用：</p>
<pre><code class="hljs language-bash" lang="bash">go get github.com/yourname/myutil@v1.0.0
</code></pre>
<h4 data-id="heading-48">7.2 版本更新（发布新版本）</h4>
<p>当模块功能迭代后，发布新版本只需两步：</p>
<ol>
<li>
<p>修改代码、提交代码（Git commit）；</p>
</li>
<li>
<p>打新的版本标签，推送标签到远程：
`# 迭代版本（如v1.0.1，修复bug）
git tag v1.0.1
git push origin v1.0.1</p>
</li>
</ol>
<h2 data-id="heading-49">若有重大变更，升级主版本（如v2.0.0）</h2>
<p>git tag v2.0.0
git push origin v2.0.0`</p>
<h4 data-id="heading-50">7.3 关键注意事项</h4>
<ul>
<li>
<p>标签必须以v开头：如v1.0.0（正确），1.0.0（错误），Go Modules无法识别非v开头的标签；</p>
</li>
<li>
<p>module名必须与远程仓库地址一致：否则其他项目go get会失败（无法定位模块）；</p>
</li>
<li>
<p>版本标签不可删除/修改：一旦推送标签到远程，不建议删除或修改（会导致依赖该版本的项目报错），如需回滚，可打新的版本标签。</p>
</li>
</ul>
<h4 data-id="heading-51">7.4 参考链接</h4>
<ul>
<li>Go官方文档（模块发布）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Fmodules%2Fpublishing" target="_blank" title="https://go.dev/doc/modules/publishing" ref="nofollow noopener noreferrer">Publishing a module</a></li>
</ul>
<h3 data-id="heading-52">八、项目结构</h3>
<p>大型Golang项目的结构设计，核心是“按功能分层、职责单一”，遵循“高内聚、低耦合”的原则，便于多人协作、后期维护和扩展。Go没有强制的项目结构规范，但行业内有成熟的标准结构（适配大部分后端项目），本节给出通用结构示例，并拆解各目录的作用。</p>
<p>提示：以下结构适用于「大型后端项目」（如API服务、微服务），小型项目可简化（如只保留main.go和必要的包）。</p>
<h4 data-id="heading-53">8.1 大型Golang项目标准结构（目录树示例）</h4>
<pre><code class="hljs language-bash" lang="bash">your-project/                  <span class="hljs-comment"># 项目根目录（Go Modules模块，执行go mod init的目录）</span>
├── go.mod                     <span class="hljs-comment"># Go Modules核心配置文件（声明模块名、Go版本、依赖）</span>
├── go.sum                     <span class="hljs-comment"># 依赖校验文件（自动生成，记录依赖版本和哈希值，防篡改）</span>
├── main.go                    <span class="hljs-comment"># 简易程序入口（单可执行程序项目用，多可执行程序建议放cmd目录）</span>
├── cmd/                       <span class="hljs-comment"># 可执行程序目录（核心！多可执行程序分离存放，避免入口混乱）</span>
│   └── api/                   <span class="hljs-comment"># API服务可执行程序（后端核心服务入口）</span>
│       └── main.go            <span class="hljs-comment"># API服务入口（初始化路由、配置、依赖，启动服务）</span>
│   └── cli/                   <span class="hljs-comment"># 命令行工具入口（可选，如数据迁移、脚本执行等离线工具）</span>
│       └── main.go            <span class="hljs-comment"># CLI工具入口（处理命令行参数，执行对应离线逻辑）</span>
├── internal/                  <span class="hljs-comment"># 内部包（核心！只能被当前项目导入，外部项目无法访问，隔离内部逻辑）</span>
│   ├── service/               <span class="hljs-comment"># 业务逻辑层（核心业务处理，承上启下）</span>
│   │   ├── user_service.go    <span class="hljs-comment"># 用户相关业务（注册、登录、查询等核心逻辑）</span>
│   │   └── order_service.go   <span class="hljs-comment"># 订单相关业务（创建订单、支付回调、订单查询等）</span>
│   ├── dao/                   <span class="hljs-comment"># 数据访问层（与数据库、缓存交互，封装数据操作）</span>
│   │   ├── user_dao.go        <span class="hljs-comment"># 用户数据操作（查询用户、新增用户、更新用户信息）</span>
│   │   ├── order_dao.go       <span class="hljs-comment"># 订单数据操作（订单入库、状态更新、关联查询）</span>
│   │   └── db/                <span class="hljs-comment"># 数据库连接封装（初始化MySQL、Redis，提供连接池）</span>
│   ├── model/                 <span class="hljs-comment"># 数据模型层（结构体定义，与数据库表、接口参数对应）</span>
│   │   ├── user.go            <span class="hljs-comment"># 用户模型（与user表字段对应，包含结构体标签）</span>
│   │   ├── order.go           <span class="hljs-comment"># 订单模型（与order表字段对应，关联用户、商品模型）</span>
│   │   └── request.go         <span class="hljs-comment"># 接口请求模型（接收前端传入的参数，做参数校验）</span>
│   ├── router/                <span class="hljs-comment"># 路由层（API接口路由定义，关联路由与业务逻辑）</span>
│   │   ├── router.go          <span class="hljs-comment"># 路由初始化（注册所有接口路由，配置中间件）</span>
│   │   ├── user_router.go     <span class="hljs-comment"># 用户相关路由（/api/user/login、/api/user/info等）</span>
│   │   └── order_router.go    <span class="hljs-comment"># 订单相关路由（/api/order/create、/api/order/detail等）</span>
│   └── middleware/            <span class="hljs-comment"># 中间件层（拦截请求，处理通用逻辑）</span>
│       ├── auth.go            <span class="hljs-comment"># 权限校验中间件（验证Token、接口访问权限）</span>
│       ├── logger.go          <span class="hljs-comment"># 日志中间件（记录请求参数、响应结果、访问耗时）</span>
│       └── recover.go         <span class="hljs-comment"># 异常捕获中间件（捕获接口panic，返回统一错误信息）</span>
├── pkg/                       <span class="hljs-comment"># 公共包（可被外部项目导入复用，封装通用、无业务关联的功能）</span>
│   ├── utils/                 <span class="hljs-comment"># 工具包（通用工具函数，无业务依赖）</span>
│   │   ├── crypto.go          <span class="hljs-comment"># 加密解密（MD5、SHA256、AES等通用加密逻辑）</span>
│   │   ├── validator.go       <span class="hljs-comment"># 参数校验（通用校验规则，如手机号、邮箱、必填项校验）</span>
│   │   └── time.go            <span class="hljs-comment"># 时间工具（时间格式化、时间差计算等）</span>
│   ├── config/                <span class="hljs-comment"># 配置包（读取配置文件，提供全局配置访问）</span>
│   │   ├── config.go          <span class="hljs-comment"># 配置初始化（读取yaml/env配置，解析到结构体）</span>
│   │   └── config.yaml        <span class="hljs-comment"># 配置文件（存放MySQL、Redis、端口等配置信息）</span>
│   └── logger/                <span class="hljs-comment"># 日志包（封装日志打印、存储，全局复用）</span>
│       └── logger.go          <span class="hljs-comment"># 日志初始化（配置日志级别、输出路径、滚动策略）</span>
├── api/                       <span class="hljs-comment"># API接口定义（规范接口，便于前后端协作、跨服务调用）</span>
│   ├── api.pb                 <span class="hljs-comment"># Protobuf接口定义（微服务场景用，定义接口参数和返回值）</span>
│   └── swagger/               <span class="hljs-comment"># Swagger接口文档（自动生成，提供接口调试、文档查阅）</span>
├── assets/                    <span class="hljs-comment"># 静态资源目录（存放静态文件，可选）</span>
│   ├── html/                  <span class="hljs-comment"># 静态HTML文件（如后台管理页面静态页面）</span>
│   └── static/                <span class="hljs-comment"># 静态资源（CSS、JS、图片等）</span>
├── docs/                      <span class="hljs-comment"># 项目文档目录（存放项目相关文档，便于维护）</span>
│   ├── 架构设计.md            <span class="hljs-comment"># 项目架构设计文档（分层说明、模块交互逻辑）</span>
│   ├── 接口文档.md            <span class="hljs-comment"># 接口文档（非Swagger场景，手动维护接口说明）</span>
│   └── 部署文档.md            <span class="hljs-comment"># 部署文档（服务器配置、部署步骤、启停脚本）</span>
├── scripts/                   <span class="hljs-comment"># 脚本目录（存放部署、迁移等脚本，简化操作）</span>
│   ├── deploy.sh              <span class="hljs-comment"># 部署脚本（一键部署服务、重启服务）</span>
│   └── migrate.sh             <span class="hljs-comment"># 数据迁移脚本（数据库表创建、数据初始化）</span>
├── <span class="hljs-built_in">test</span>/                      <span class="hljs-comment"># 测试目录（存放单元测试、集成测试代码，规范测试）</span>
│   ├── internal/              <span class="hljs-comment"># 内部包测试（service、dao等层的单元测试）</span>
│   │   ├── service_test.go    <span class="hljs-comment"># 业务逻辑测试（模拟请求，验证业务逻辑正确性）</span>
│   │   └── dao_test.go        <span class="hljs-comment"># 数据访问测试（测试数据库操作正确性）</span>
│   └── pkg/                   <span class="hljs-comment"># 公共包测试（utils、config等包的单元测试）</span>
└── .gitignore                 <span class="hljs-comment"># Git忽略文件（指定无需提交到Git的文件/目录，如编译产物、日志）</span>
</code></pre>
<h4 data-id="heading-54">8.2 核心目录职责拆解（避坑重点）</h4>
<p>结合前文包管理、私有公有、Go Modules知识，重点拆解高频目录的核心作用，帮你理解“为什么这么设计”，避免踩结构混乱的坑：</p>
<ul>
<li>
<p><strong>cmd/</strong>：核心是“分离可执行程序入口”，比如后端API服务和离线数据迁移工具，分开放在cmd/api和cmd/cli下，各自有独立的main()函数，避免所有入口混在根目录main.go，后期维护困难。注意：cmd下的包可导入internal和pkg包，属于程序入口层。</p>
</li>
<li>
<p><strong>internal/</strong>：Go语言原生支持的“内部包”，其下的所有包只能被当前项目（your-project）导入，外部项目即使导入你的模块，也无法访问internal下的内容——这是隔离内部业务逻辑的关键，避免外部依赖你的内部实现，导致后期重构困难（贴合前文“私有公有”思想，相当于项目级别的“私有包”）。</p>
</li>
<li>
<p><strong>pkg/</strong>：与internal相反，是“公共包”，封装的是无业务依赖、可复用的功能（如工具函数、配置读取），可被外部项目导入复用。注意：pkg下的包必须遵循“公有标识符可访问”原则（首字母大写），内部不包含任何业务逻辑，确保通用性。</p>
</li>
<li>
<p><strong>model/</strong>：统一存放所有数据模型，避免模型分散在各个包中，导致结构体重复定义。模型分为三类：数据库模型（与表对应）、请求模型（接收前端参数）、响应模型（返回给前端数据），三者分离，便于参数校验和维护。</p>
</li>
<li>
<p><strong>service/ + dao/</strong>：分层设计的核心，遵循“单一职责”：dao层只负责数据操作（与MySQL、Redis交互），不处理任何业务逻辑；service层调用dao层，处理核心业务逻辑（如用户注册时，先校验参数，再调用dao新增用户，最后返回结果），避免业务逻辑与数据操作耦合，便于后期修改（如替换数据库时，只需修改dao层，不影响service层）。</p>
</li>
</ul>
<h4 data-id="heading-55">8.3 结构设计技巧（贴合模块化开发）</h4>
<ol>
<li>小型项目简化：如果是单可执行程序（如简单API服务），可删除cmd/目录，将main.go放在根目录，同时简化internal/目录（只保留service、dao、model核心子包）；</li>
<li>微服务适配：如果是微服务项目，可在api/目录下用Protobuf定义接口，同时新增rpc/目录，存放微服务间调用的客户端和服务端代码；</li>
<li>依赖隔离：internal/下的包可相互导入（如service导入dao、model），但尽量避免循环导入（前文导入规则的避坑点）；pkg/下的包不依赖internal/下的包（确保pkg的通用性）；</li>
<li>可扩展性：每个目录的职责单一，新增功能时，只需在对应目录下新增文件（如新增商品业务，在internal/service下新增goods_service.go，在internal/dao下新增goods_dao.go），不影响其他目录。</li>
</ol>
<h4 data-id="heading-56">8.4 参考链接</h4>
<p>Go官方文档（项目结构建议）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgo.dev%2Fdoc%2Fcode%23Organization" target="_blank" title="https://go.dev/doc/code#Organization" ref="nofollow noopener noreferrer">Code organization</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React扩展]]></title>    <link>https://juejin.cn/post/7603587738159923263</link>    <guid>https://juejin.cn/post/7603587738159923263</guid>    <pubDate>2026-02-06T10:14:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603587738159923263" data-draft-id="7598947628467372078" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React扩展"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-06T10:14:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端马国成"/> <meta itemprop="url" content="https://juejin.cn/user/4471082537196452"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React扩展
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4471082537196452/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端马国成
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:14:48.000Z" title="Fri Feb 06 2026 10:14:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">CSS</h4>
<p>styled-components: yarn add styled-components</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// props透传</span>
<span class="hljs-comment">// attrs的使用</span>
<span class="hljs-comment">// 传入state作为props属性</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledInput</span> = styled.<span class="hljs-property">input</span>.<span class="hljs-title function_">attrs</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'password'</span>,
  <span class="hljs-attr">placeholder</span>:<span class="hljs-string">'请输入'</span>,
  <span class="hljs-attr">bgColor</span>:<span class="hljs-string">'#000'</span>
})<span class="hljs-string">`
  color: <span class="hljs-subst">${props =&gt; props.color}</span>;
  background-color: <span class="hljs-subst">${props =&gt; props.bgColor}</span>;
`</span>

<span class="hljs-comment">// 继承</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">StyledInput2</span> = <span class="hljs-title function_">styled</span>(<span class="hljs-title class_">StyledInput</span>)<span class="hljs-string">`
  margin-top: 20px;
  padding: 10px;
`</span>
</code></pre>
<h4 data-id="heading-1">动画</h4>
<pre><code class="hljs language-js" lang="js">npm install react-transition-group --save

&lt;<span class="hljs-title class_">CSSTransition</span>
    nodeRef={<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeRef</span>}
    <span class="hljs-keyword">in</span>={<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">show</span>}
    timeout={<span class="hljs-number">500</span>}
    classNames=<span class="hljs-string">"fade"</span>
    unmountOnExit
    appear
&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{this.nodeRef}</span>&gt;</span>CSS Transition<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">CSSTransition</span>&gt;

.<span class="hljs-property">fade</span>-enter, .<span class="hljs-property">fade</span>-appear{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>;
}

.<span class="hljs-property">fade</span>-enter-active, .<span class="hljs-property">fade</span>-appear-active{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attr">transition</span>: opacity 500ms ease-<span class="hljs-keyword">in</span>-out;
}

.<span class="hljs-property">fade</span>-enter-done, .<span class="hljs-property">fade</span>-appear-done{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>;
}
.<span class="hljs-property">fade</span>-exit{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>;
}


.<span class="hljs-property">fade</span>-exit-active{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attr">transition</span>: opacity 500ms ease-<span class="hljs-keyword">in</span>-out;
}

.<span class="hljs-property">fade</span>-exit-done{
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-2">Redux</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>
<span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span>
<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(reducer)
store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-title function_">getState</span>())
})
store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addAction</span>(<span class="hljs-number">1</span>))
store.<span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">subAction</span>(<span class="hljs-number">10</span>))

<span class="hljs-comment">// action.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">addAction</span>= (<span class="hljs-params">num</span>) =&gt; ({
  <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">ADD_NUMBER</span>,
  num
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">subAction</span>= (<span class="hljs-params">num</span>) =&gt; ({
  <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">SUB_NUMBER</span>,
  num
})

<span class="hljs-comment">// reducer.js</span>
<span class="hljs-keyword">const</span> defaultlState = {
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">state = defaultlState, action</span>) {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-attr">ADD_NUMBER</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + action.<span class="hljs-property">num</span>,
      } 
    <span class="hljs-keyword">case</span> <span class="hljs-attr">SUB_NUMBER</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - action.<span class="hljs-property">num</span>,
      } 
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state
  }
}


<span class="hljs-comment">// 加入connect</span>
<span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> { createStore, applyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>
**<span class="hljs-keyword">import</span> { thunk } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-thunk'</span>**
<span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span>

<span class="hljs-keyword">const</span> storeEnhancer = <span class="hljs-title function_">applyMiddleware</span>(thunk)

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(reducer, storeEnhancer)    

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store

<span class="hljs-comment">// reducer.js</span>
<span class="hljs-keyword">import</span> { createStore, applyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux'</span>
<span class="hljs-keyword">import</span> { thunk } <span class="hljs-keyword">from</span> <span class="hljs-string">'redux-thunk'</span>
<span class="hljs-keyword">import</span> reducer <span class="hljs-keyword">from</span> <span class="hljs-string">'./reducer'</span>

<span class="hljs-keyword">const</span> storeEnhancer = <span class="hljs-title function_">applyMiddleware</span>(thunk)

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(reducer, storeEnhancer)    

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store

<span class="hljs-comment">// actionCreator.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">ADD_NUMBER</span>, <span class="hljs-variable constant_">SUB_NUMBER</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./constans'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">addAction</span>= (<span class="hljs-params">num</span>) =&gt; ({
  <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">ADD_NUMBER</span>,
  num
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">subAction</span>= (<span class="hljs-params">num</span>) =&gt; ({
  <span class="hljs-attr">type</span>: <span class="hljs-variable constant_">SUB_NUMBER</span>,
  num
})

**<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getBannerList</span> = (<span class="hljs-params">dispatch</span>) =&gt; (
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getBannerList'</span>)
)**

<span class="hljs-comment">// connect.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PureComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> store <span class="hljs-keyword">from</span> <span class="hljs-string">'../store'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">mapStateToProps, mapDispatchToProps</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">Component</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectedComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PureComponent</span> {
      <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) {
        <span class="hljs-variable language_">super</span>(props)
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = {
            <span class="hljs-attr">storeState</span>: <span class="hljs-title function_">mapStateToProps</span>(store.<span class="hljs-title function_">getState</span>()),
        }
      }
      <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">unsubscribe</span> = store.<span class="hljs-title function_">subscribe</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({
            <span class="hljs-attr">storeState</span>: <span class="hljs-title function_">mapStateToProps</span>(store.<span class="hljs-title function_">getState</span>()),
          })
        })
      }
      <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unsubscribe</span>()
      }
      <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> (
          <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span>
            {<span class="hljs-attr">...this.props</span>}
            {<span class="hljs-attr">...this.state.storeState</span>}
            {<span class="hljs-attr">...mapDispatchToProps</span>(<span class="hljs-attr">store.dispatch</span>)}
          /&gt;</span></span>
        );
      }
    };
  };
}
<span class="hljs-comment">// home.js</span>
<span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/connect'</span>
<span class="hljs-keyword">import</span> { addAction, subAction, getBannerList } <span class="hljs-keyword">from</span> <span class="hljs-string">'../store/actionCreator'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">mapStateToProps</span> = (<span class="hljs-params">state</span>) =&gt; ({
  <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">mapDispatchToProps</span> = (<span class="hljs-params">dispatch</span>) =&gt; ({
  <span class="hljs-attr">addAction</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">addAction</span>(num)),
  <span class="hljs-attr">subAction</span>: <span class="hljs-function">(<span class="hljs-params">num</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">subAction</span>(num)),
  <span class="hljs-attr">getBannerList</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>(getBannerList)
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Home2</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>HOME<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前计数:{props.count}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.addAction(1)}&gt;+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.subAction(1)}&gt;-1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> props.getBannerList()}&gt;获取轮播图<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    ) 
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">connect</span>(mapStateToProps, mapDispatchToProps)(<span class="hljs-title class_">Home2</span>)
</code></pre>
<h4 data-id="heading-3">router</h4>
<pre><code class="hljs language-js" lang="js">npm install react-router-dom
<span class="hljs-title class_">BrowserRouter</span>: history模式
<span class="hljs-title class_">HashRouter</span>: hash模式

&lt;<span class="hljs-title class_">BrowserRouter</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/a"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/a"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">BrowserRouter</span>&gt;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Routes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useRoutes</span>([    
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/home'</span>,
        <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Home</span> /&gt;</span></span>
      },
      {
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
        <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">About</span> /&gt;</span></span>,
        <span class="hljs-attr">children</span>: [
          {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'history'</span>,
            <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AboutHistory</span> /&gt;</span></span>
          },
          {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'school'</span>,
            <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AboutSchool</span> /&gt;</span></span>
          },
          {
            <span class="hljs-attr">path</span>: <span class="hljs-string">'company'</span>,
            <span class="hljs-attr">element</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AboutCompany</span> /&gt;</span></span>
          }
        ]
      }
])}
</code></pre>
<h4 data-id="heading-4">Hooks</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span>组件比函数式组件的优势（没有hooks的时候）
    <span class="hljs-number">1.</span><span class="hljs-keyword">class</span>组件可以定义自己的state，用来保存组件自己内部的状态
      函数式组件不可以，因为函数每次调用都会产生新的临时变量
    <span class="hljs-number">2.</span><span class="hljs-keyword">class</span>组件有自己的生命周期，比如在componentDidMounted中发送网络请求，
      并且在生命周期函数只会执行一次
      在函数中发送网络请求，意味着每次重新渲染都会重新发送一次网络请求
    <span class="hljs-number">3.</span><span class="hljs-keyword">class</span>组件可以在状态改变时只会重新执行rendr函数以及生命周期componentDidUpdate
      函数式组件在重新渲染时，整个函数都会被执行
      
useState
本身是一个函数，来自react包
参数和返回值
    <span class="hljs-number">1.</span>参数：给创建出来的状态一个默认值
    <span class="hljs-number">2.</span>返回值：数组，元素<span class="hljs-number">1</span>：当前state的状态值，元素<span class="hljs-number">2</span>是更新状态的函数
只能在函数最外层调用<span class="hljs-title class_">Hook</span>，不要在循环，条件判断或者子函数中使用
只能在react的函数组件中调用hook，不能在其他js函数中调用

useCallback
<span class="hljs-comment">// memo 用于包裹函数组件，使其在 props 未发生变化时跳过重新渲染，从而提升性能。</span>
<span class="hljs-comment">// 父组件重新渲染，子组件也会重新渲染，但是如果子组件被 memo 包裹，且 props 未发生变化，那么子组件就不会重新渲染。</span>
<span class="hljs-comment">// HYBButton1的increment函数会重新创建，所以memo包裹的props发生变化，会重新渲染</span>
<span class="hljs-comment">// HYBButton2的increment函数不会重新创建，所以memo包裹的props没有发生变化，不会重新渲染</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HYBButton</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{title, increment}</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'重新渲染'</span>, title)
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>
      +1
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  )
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Callback</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> [isShow, setIsShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick1</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">111</span>)
  }

  <span class="hljs-keyword">const</span> handleClick2 = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">222</span>)
  },[count])

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前计数: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前显示状态: {isShow ? '显示' : '隐藏'}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">HYBButton</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"增加1"</span> <span class="hljs-attr">increment</span>=<span class="hljs-string">{handleClick1}</span>  /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">HYBButton</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"增加2"</span> <span class="hljs-attr">increment</span>=<span class="hljs-string">{handleClick2}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsShow(!isShow)}&gt;显示/隐藏<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

useContext
<span class="hljs-title class_">App</span>.<span class="hljs-property">js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title function_">createContext</span>()
&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">StrictMode</span>&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{name:</span> '<span class="hljs-attr">张三</span>', <span class="hljs-attr">age:</span> <span class="hljs-attr">18</span>}}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MemoDemo</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">React</span>.<span class="hljs-property">StrictMode</span>&gt;

index.<span class="hljs-property">js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../index'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>)
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前用户: {user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前用户年龄: {user.age}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

useMemo
<span class="hljs-keyword">import</span> { useState,useMemo,memo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calcNum</span>(<span class="hljs-params">count</span>){
    <span class="hljs-keyword">let</span> total = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        total += i
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'total'</span>,total)
    }
    <span class="hljs-keyword">return</span> total
}

<span class="hljs-keyword">const</span> <span class="hljs-title class_">HYUser</span> = <span class="hljs-title function_">memo</span>(<span class="hljs-keyword">function</span> <span class="hljs-title function_">HYUser</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> {name, age} = props
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HYUser'</span>, name, age)
  <span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前用户: {name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前年龄: {age}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MemoDemo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> [isShow, setIsShow] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>)
<span class="hljs-comment">//   let total = 0</span>
<span class="hljs-comment">//   for(let i = 0; i &lt; count; i++) {</span>
<span class="hljs-comment">//     // 切换show每次都会执行for循环</span>
<span class="hljs-comment">//     total += i</span>
<span class="hljs-comment">//   }</span>
  <span class="hljs-keyword">const</span> total = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">calcNum</span>(count), [count])
  <span class="hljs-keyword">const</span> info = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({<span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>}), []) <span class="hljs-comment">// 依赖项为空数组，只在组件挂载时执行一次</span>
<span class="hljs-comment">//const info = {name: '张三', age: 18} 每次重新渲染都创建一个新对象，会导致HYUser组件重新渲染</span>

  <span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前计数: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前显示状态: {isShow ? '显示' : '隐藏'}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前total: {total}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">HYUser</span> <span class="hljs-attr">info</span>=<span class="hljs-string">{info}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsShow(!isShow)}&gt;切换显示状态<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}
- useMemo ：缓存值 ，用于优化复杂计算
- useCallback ：缓存函数 ，用于优化子组件渲染
- useCallback 是 useMemo 的特例 ： <span class="hljs-title function_">useCallback</span>(fn, deps) 等价于 <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> fn, deps)

useReducer
<span class="hljs-keyword">import</span> { useReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">state, action</span>) {
  <span class="hljs-keyword">switch</span>(action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'increment'</span>:
      <span class="hljs-keyword">return</span> {<span class="hljs-attr">counter</span>: state.<span class="hljs-property">counter</span> + action.<span class="hljs-property">payload</span>}
    <span class="hljs-keyword">case</span> <span class="hljs-string">'decrement'</span>:
      <span class="hljs-keyword">return</span> {<span class="hljs-attr">counter</span>: state.<span class="hljs-property">counter</span> - action.<span class="hljs-property">payload</span>}
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state
  }
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, {<span class="hljs-attr">counter</span>: <span class="hljs-number">0</span>})
  <span class="hljs-keyword">return</span>(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>当前状态: {state.counter}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({type: 'increment', payload: 1})}&gt;增加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({type: 'decrement', payload: 1})}&gt;减少<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

useLayoutEffect
useEffect会在渲染的内容更新到<span class="hljs-variable constant_">DOM</span>上后执行，不会阻塞<span class="hljs-variable constant_">DOM</span>的更新
useLayoutEffect会在渲染的内容更新到<span class="hljs-variable constant_">DOM</span>上之前执行，会阻塞<span class="hljs-variable constant_">DOM</span>的更新
如果我们希望在某些操作发生之后再更新<span class="hljs-variable constant_">DOM</span>，那么应该将这个操作放到useLayoutEffect

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenClaw集成钉钉机器人应用配置]]></title>    <link>https://juejin.cn/post/7603556326815907892</link>    <guid>https://juejin.cn/post/7603556326815907892</guid>    <pubDate>2026-02-06T10:18:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603556326815907892" data-draft-id="7603383311531016207" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenClaw集成钉钉机器人应用配置"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2026-02-06T10:18:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="玹外之音"/> <meta itemprop="url" content="https://juejin.cn/user/2666763911448411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenClaw集成钉钉机器人应用配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2666763911448411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    玹外之音
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:18:48.000Z" title="Fri Feb 06 2026 10:18:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">钉钉机器人应用配置与OpenClaw集成指南</h2>
<p>本指南将帮助您完成钉钉机器人应用的创建、配置以及与 OpenClaw 的集成。</p>
<hr/>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E9%92%89%E9%92%89%E5%BA%94%E7%94%A8" title="#%E5%88%9B%E5%BB%BA%E9%92%89%E9%92%89%E5%BA%94%E7%94%A8">创建钉钉应用</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9" title="#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9">配置选项</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEopenclaw" title="#%E9%85%8D%E7%BD%AEopenclaw">配置OpenClaw</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">所需凭证</h3>
<ul>
<li>Client ID</li>
<li>Client Secret</li>
<li>Robot Code</li>
<li>Corp ID</li>
<li>Agent ID</li>
<li>卡片模板 ID</li>
</ul>
<hr/>
<h3 data-id="heading-3">相关链接</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-dev.dingtalk.com" target="_blank" title="https://open-dev.dingtalk.com" ref="nofollow noopener noreferrer">钉钉开发者后台</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-dev.dingtalk.com%2Ffe%2Fcard" target="_blank" title="https://open-dev.dingtalk.com/fe/card" ref="nofollow noopener noreferrer">钉钉卡片平台</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsoimy%2Fopenclaw-channel-dingtalk" target="_blank" title="https://github.com/soimy/openclaw-channel-dingtalk" ref="nofollow noopener noreferrer">插件GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.32zi.com" target="_blank" title="https://ai.32zi.com" ref="nofollow noopener noreferrer">AI API 聚合平台</a></li>
</ul>
<hr/>
<h3 data-id="heading-4">注意事项</h3>
<ul>
<li>必须加入组织才能使用钉钉开发者后台</li>
<li>发布应用前需填写版本详情</li>
<li>手动安装插件后需执行npm install</li>
<li>配置文件中需要填写正确的凭证信息</li>
</ul>
<hr/>
<h3 data-id="heading-5">创建钉钉应用</h3>
<h4 data-id="heading-6">步骤 1：打开钉钉开发者后台</h4>
<p>访问：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-dev.dingtalk.com" target="_blank" title="https://open-dev.dingtalk.com" ref="nofollow noopener noreferrer">open-dev.dingtalk.com</a></p>
<blockquote>
<p><strong>注意</strong>：必须加入组织才能使用钉钉开发者后台。</p>
</blockquote>
<h4 data-id="heading-7">步骤 2：创建应用</h4>
<p>找到 <strong>应用开发</strong> → <strong>钉钉应用</strong> → <strong>创建应用</strong> → 填写相关信息</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/564d8c2c05af4f90845e39021092e493~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=M1gSlGg%2B7JQfmMyJk9AdiEYWrPE%3D" alt="屏幕截图 2026-02-06 092539.png" loading="lazy"/></p>
<h4 data-id="heading-8">步骤 3：添加机器人能力</h4>
<p>创建应用成功之后会自动打开新的标签页，在"添加应用能力"选择<strong>机器人</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db81bcae1ba44a08a5bae5a67be983ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=6oVxso2PmqjxPz2Iq0LSlhAtAHc%3D" alt="屏幕截图 2026-02-06 092819.png" loading="lazy"/></p>
<h4 data-id="heading-9">步骤 4：配置机器人</h4>
<p>把机器人配置打开，填写相关信息之后直接发布。</p>
<h4 data-id="heading-10">步骤 5：发布应用</h4>
<p>点击<strong>凭证与基础信息</strong> → <strong>查看版本详情</strong> → 第一次发布需要填写详情 → <strong>确认发布</strong>之后就能在钉钉里面搜索到机器人。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fb3919514c64f9986823f951099e58a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=yEOZYnPKCRctUKqzJC5B65oEGt0%3D" alt="屏幕截图 2026-02-06 101547.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29714bee60d74ec6b6051b3d17470fb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=66ACVfItBlGJrHC2%2FZ88RiPa3I8%3D" alt="屏幕截图 2026-02-06 102127.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/939c2a709949485f8d8b7cc01e3e4068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=t9iDxX1CynLvta%2BlDUKiMqYIQyY%3D" alt="屏幕截图 2026-02-06 102519.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b88906c76194178ba15c471225ec4ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=pIVIQ6IR1oXZra0h%2BNnClgigpgo%3D" alt="屏幕截图 2026-02-06 102629.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/352d0da6290a446d9813054950cfa7c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=WOsRSzWMet1WrcLpe5AR3BcblTM%3D" alt="屏幕截图 2026-02-06 102841.png" loading="lazy"/></p>
<h4 data-id="heading-11">步骤 6：配置权限管理</h4>
<p>在应用的权限管理页面，需要开启以下权限：</p>
<ul>
<li><strong>✅ Card.Instance.Write</strong> — 创建和投放卡片实例</li>
<li><strong>✅ Card.Streaming.Write</strong> — 对卡片进行流式更新</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f28e5f9f00964d1fbdd81cc6cec7a8f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=8rgFS%2FnjPaf%2B8r0mgTHykcafT50%3D" alt="屏幕截图 2026-02-06 093616.png" loading="lazy"/></p>
<h4 data-id="heading-12">步骤 7：建立卡片模板</h4>
<p>如需使用 AI 互动卡片功能，需要在钉钉卡片平台创建模板：</p>
<ol>
<li>访问钉钉卡片平台：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopen-dev.dingtalk.com%2Ffe%2Fcard%3Fspm%3Dding_open_doc.document.0.0.21544a97LNpJiA%26hash%3D%2523%252F%23%2F" target="_blank" title="https://open-dev.dingtalk.com/fe/card?spm=ding_open_doc.document.0.0.21544a97LNpJiA&amp;hash=%23%2F#/" ref="nofollow noopener noreferrer">open-dev.dingtalk.com/fe/card</a></li>
<li>点击「新建模板」</li>
<li>卡片模板场景选择 <strong>「AI 卡片」</strong></li>
<li>无需选择预设模板，直接点击保存</li>
<li>复制模板 ID（格式如：xxxxx-xxxxx-xxxxx.schema）</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab53c47147194d1ca4ac821020d8482a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=t304iJKd8ySD7h3eTGv1pdPAqsQ%3D" alt="屏幕截图 2026-02-06 094055.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f4a7915670942e3b420f95ba5bbaed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=Kiz0V5KGHZDfSe1TdfN5lhM9O34%3D" alt="屏幕截图 2026-02-06 094225.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb71514f0ea04a8e93f1527f516756ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=suclTZ1KhHanIkGIAQJf7%2F52%2F8o%3D" alt="屏幕截图 2026-02-06 132741.png" loading="lazy"/></p>
<h4 data-id="heading-13">步骤 8：获取凭证</h4>
<p>从开发者后台获取以下凭证并保存下来：</p>
<ul>
<li><strong>Client ID (AppKey)</strong></li>
<li><strong>Client Secret (AppSecret)</strong></li>
<li><strong>Robot Code</strong> (与 Client ID 相同)</li>
<li><strong>Corp ID</strong> (企业 ID)</li>
<li><strong>Agent ID</strong> (应用 ID)</li>
<li><strong>模板 ID</strong> (卡片模板)</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca19ad352d3f4d22bb5ab6ae8712237d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=3oxcbph07xL%2FnL2yjqn0ac%2F%2BYAY%3D" alt="屏幕截图 2026-02-06 112517.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-14">配置选项</h3>



















































































<table><thead><tr><th>选项</th><th>类型</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td><code>enabled</code></td><td>boolean</td><td>true</td><td>是否启用</td></tr><tr><td><code>clientId</code></td><td>string</td><td>必填</td><td>应用的 AppKey</td></tr><tr><td><code>clientSecret</code></td><td>string</td><td>必填</td><td>应用的 AppSecret</td></tr><tr><td><code>robotCode</code></td><td>string</td><td>-</td><td>机器人代码</td></tr><tr><td><code>corpId</code></td><td>string</td><td>-</td><td>企业 ID</td></tr><tr><td><code>agentId</code></td><td>string</td><td>-</td><td>应用 ID</td></tr><tr><td><code>dmPolicy</code></td><td>string</td><td>"open"</td><td>私聊策略：open/pairing/allowlist</td></tr><tr><td><code>groupPolicy</code></td><td>string</td><td>"open"</td><td>群聊策略：open/allowlist</td></tr><tr><td><code>allowFrom</code></td><td>string[]</td><td>[]</td><td>允许的发送者 ID 列表</td></tr><tr><td><code>messageType</code></td><td>string</td><td>"markdown"</td><td>消息类型：markdown/card</td></tr><tr><td><code>cardTemplateId</code></td><td>string</td><td>"382e4302-551d-4880-bf29-a30acfab2e71.schema"</td><td>AI 互动卡片模板 ID（仅当 messageType=card）</td></tr><tr><td><code>debug</code></td><td>boolean</td><td>false</td><td>是否开启调试日志</td></tr></tbody></table>
<h4 data-id="heading-15">安全策略</h4>
<h5 data-id="heading-16">私聊策略 (dmPolicy)</h5>
<ul>
<li><strong>open</strong> — 任何人都可以私聊机器人</li>
<li><strong>pairing</strong> — 新用户需要通过配对码验证</li>
<li><strong>allowlist</strong> — 只有 allowFrom 列表中的用户可以使用</li>
</ul>
<h5 data-id="heading-17">群聊策略 (groupPolicy)</h5>
<ul>
<li><strong>open</strong> — 任何群都可以 @机器人</li>
<li><strong>allowlist</strong> — 只有配置的群可以使用</li>
</ul>
<hr/>
<h3 data-id="heading-18">配置OpenClaw</h3>
<h4 data-id="heading-19">步骤 1：自动安装（推荐）</h4>
<p>如果有VPN可以直接执行：</p>
<pre><code class="hljs language-bash" lang="bash">openclaw plugins install https://github.com/soimy/clawdbot-channel-dingtalk.git
</code></pre>
<p>没有VPN就用手动安装方式。</p>
<h4 data-id="heading-20">步骤 2：手动安装</h4>
<ol>
<li>执行 <code>openclaw plugins list</code> 找到系统插件所在的目录（如：<code>D:\Program Files\nodejs\node_global\node_modules\openclaw\extensions</code>）</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9252180a4b18431d8745ed4f248139c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=aZHYaqXSkRORZdrQeL7JqX7W7QY%3D" alt="屏幕截图 2026-02-06 101019.png" loading="lazy"/></p>
<ol start="2">
<li>
<p>创建dingtalk目录：<code>D:\Program Files\nodejs\node_global\node_modules\openclaw\extensions\dingtalk</code></p>
</li>
<li>
<p>把openclaw-channel-dingtalk下的文件复制到创建的dingtalk目录</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c5d71b559f94bf5bfdc1a35c83452e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=q%2B0YQgxtJi1j1TRtpku5GOVHGco%3D" alt="屏幕截图 2026-02-06 101244.png" loading="lazy"/></p>
<ol start="4">
<li>打开dingtalk目录，执行安装依赖：<code>npm install</code></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e0baae09f564f7990c036ce33b5debb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=jwKb4mmDjJLwULqN2aXegTyax7k%3D" alt="屏幕截图 2026-02-06 104836.png" loading="lazy"/></p>
<ol start="5">
<li>运行 <code>openclaw plugins list</code> 确认 dingtalk 已显示在列表中</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4375eb19ddeb4a64ab781ce4e4a43632~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=wPguHlPwsEbq4PPb3ScxOJgHxmc%3D" alt="屏幕截图 2026-02-06 101139.png" loading="lazy"/></p>
<h4 data-id="heading-21">步骤 3：编辑配置文件</h4>
<p>可以通过 <code>openclaw gateway status</code> 查看配置文件目录</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6056cc622dda4240b939a9a09e8022e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=io6BPcu6yoih%2FRIpb5aSXgC7kSY%3D" alt="屏幕截图 2026-02-06 094621.png" loading="lazy"/></p>
<p>编辑文件 <code>~/.openclaw/openclaw.json</code>，添加 dingtalk 字段内容，将上面获取到的ID填入相应的字段：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  ...
  <span class="hljs-attr">"channels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"telegram"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> ... <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"dingtalk"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"clientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dingvex0dgwcce9fexxd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"clientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-app-secret"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"robotCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dingvex0dgwcce9fexxd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"corpId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dingvex0dgwcce9fexxd"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"agentId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4250080956"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"dmPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"open"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"groupPolicy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"open"</span><span class="hljs-punctuation">,</span>      
      <span class="hljs-attr">"messageType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"card"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"cardTemplateId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1fd68835-1571-4b33-a5d1-1b0c969ae85e.schema"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"debug"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
  ...
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-22">步骤 4：重启服务</h4>
<p>重新启动：<code>openclaw gateway --port 18789 --verbose</code></p>
<p>或者重启 Gateway：<code>openclaw gateway restart</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2952d6191924487f9ef094e62d1b64dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=svRpBgJuVz1xvx4cKwmrz%2B%2FRJD0%3D" alt="屏幕截图 2026-02-06 104932.png" loading="lazy"/></p>
<h4 data-id="heading-23">步骤 5：⚠️ 常见问题提示</h4>
<p>如果通过 Git 拉取代码后，AI 回复无法显示卡片，并在日志中出现类似以下错误：</p>
<pre><code class="hljs language-ini" lang="ini">04:44:02 <span class="hljs-section">[dingtalk]</span> <span class="hljs-section">[AICard]</span> <span class="hljs-attr">conversationType</span>=<span class="hljs-number">1</span>, conversationId=<span class="hljs-number">20376554481106336</span>
04:44:02 <span class="hljs-section">[dingtalk]</span> <span class="hljs-section">[AICard]</span> POST /v1.0/card/instances/createAndDeliver <span class="hljs-attr">body</span>={<span class="hljs-string">"cardTemplateId"</span>:<span class="hljs-string">"daee59fc-bcf6-4669-873f-b38eec80eaff.schema"</span>,<span class="hljs-string">"outTrackId"</span>:<span class="hljs-string">"card_86f9c23a-906e-41f4-8f5b-fbe5f7a3650a"</span>,<span class="hljs-string">"cardData"</span>:{<span class="hljs-string">"cardParamMap"</span>:{}},<span class="hljs-string">"callbackType"</span>:<span class="hljs-string">"STREAM"</span>,<span class="hljs-string">"imGroupOpenSpaceModel"</span>:{<span class="hljs-string">"supportForward"</span>:<span class="hljs-literal">true</span>},<span class="hljs-string">"imRobotOpenSpaceModel"</span>:{<span class="hljs-string">"supportForward"</span>:<span class="hljs-literal">true</span>},<span class="hljs-string">"openSpaceId"</span>:<span class="hljs-string">"dtv1.card//IM_ROBOT.20376554481106336"</span>,<span class="hljs-string">"userIdType"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"imRobotOpenDeliverModel"</span>:{<span class="hljs-string">"spaceType"</span>:<span class="hljs-string">"IM_ROBOT"</span>}}
04:44:03 <span class="hljs-section">[dingtalk]</span> <span class="hljs-section">[AICard]</span> Create failed: Request failed with status code 400
04:44:03 <span class="hljs-section">[dingtalk]</span> <span class="hljs-section">[AICard]</span> Error response: <span class="hljs-attr">status</span>=<span class="hljs-number">400</span> data={<span class="hljs-string">"requestid"</span>:<span class="hljs-string">"D85C4B2D-E655-7412-9FFA-89341F737BAA"</span>,<span class="hljs-string">"code"</span>:<span class="hljs-string">"param.empty"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"param.empty"</span>}
</code></pre>
<p><strong>解决方案</strong>：编辑 <code>src/channel.ts</code> 文件，找到 <code>createAICard</code> 方法，将 <code>cardParamMap: {}</code> 替换为以下代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">cardParamMap</span>: {
  <span class="hljs-comment">// Provide default parameters to avoid empty param error</span>
  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
},
</code></pre>
<p>然后重新重启服务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3977eb4115764f3e9b510483a6aef23f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=i19K5fDD5ftLVYeVKaMob%2BSLylU%3D" alt="屏幕截图 2026-02-06 133335.png" loading="lazy"/></p>
<h4 data-id="heading-24">最终结果</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cefa06ce47f34312ab82ad420e1c9d9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54655aSW5LmL6Z-z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770980169&amp;x-signature=BhPVHORzZWFbwNDjrIhIA0oT2IY%3D" alt="屏幕截图 2026-02-06 142551.png" loading="lazy"/></p>
<hr/>
<blockquote>
<p><strong>插件GitHub地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsoimy%2Fopenclaw-channel-dingtalk" target="_blank" title="https://github.com/soimy/openclaw-channel-dingtalk" ref="nofollow noopener noreferrer">github.com/soimy/openc…</a></p>
</blockquote>
<blockquote>
<p><strong>AI API 聚合平台</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.32zi.com" target="_blank" title="https://ai.32zi.com" ref="nofollow noopener noreferrer">快速、稳定、低价</a></p>
</blockquote>
<hr/>
<p><em>钉钉机器人应用配置与OpenClaw集成指南 | 最后更新: 2026年2月</em></p>
<p><em>注意：原创文章，转载请标明来处</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent Skills：智能 IDE 正在掀起一场“能力模块化”革命]]></title>    <link>https://juejin.cn/post/7603355275258167336</link>    <guid>https://juejin.cn/post/7603355275258167336</guid>    <pubDate>2026-02-06T10:27:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603355275258167336" data-draft-id="7603444191447973922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent Skills：智能 IDE 正在掀起一场“能力模块化”革命"/> <meta itemprop="keywords" content="Agent,Cursor,Trae"/> <meta itemprop="datePublished" content="2026-02-06T10:27:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="__不想说话__"/> <meta itemprop="url" content="https://juejin.cn/user/1626932940391191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent Skills：智能 IDE 正在掀起一场“能力模块化”革命
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932940391191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    __不想说话__
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T10:27:38.000Z" title="Fri Feb 06 2026 10:27:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从“靠嘴指挥”到“直接上手”，AI 终于学会像工程师一样干活了。</p>
</blockquote>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc034a943f8c490b8bcd3f42bc89cdb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=NCNNiX%2Bz99q0WoiJgYsJTnPpQ2k%3D" alt="AI 从聊天走向执行" loading="lazy"/></p>
<h2 data-id="heading-0">一、Agent Skills 是什么？🤔</h2>
<p>如果你最近频繁玩 <strong>Cursor、Claude Code、Gemini CLI、Codex CLI、Trae</strong> 这类“智能 IDE”，应该已经察觉到一个明显的趋势：</p>
<blockquote>
<p>AI 不再满足于“你问我答”了，它开始<strong>直接上手帮你把事做完</strong>。</p>
</blockquote>
<p>而让这一切成为可能的核心机制之一，就是 <strong>Agent Skills</strong>。</p>
<p>简单来说，<strong>Agent Skills 是一组可复用、可组合、能被 AI 主动调用的“技能包”</strong>。它不是一个简单的 Prompt，也不只是一个 API，而是：</p>
<ul>
<li>一套<strong>结构化的任务说明书（SOP）</strong></li>
<li>一组<strong>可以直接运行的脚本、模板或工具</strong></li>
<li>一种<strong>能被 IDE 或 AI 理解并随时调用的能力描述方式</strong></li>
</ul>
<p>你可以把它想象成：</p>
<blockquote>
<p><strong>扔给 AI 的一本「岗位职责 + 操作手册」</strong>。</p>
</blockquote>
<h3 data-id="heading-1">来看一个真实的 Skill 长啥样</h3>
<p>在 Claude / Cursor 的生态里，一个 Skill 其实就是一个文件夹，核心是里面的 <code>SKILL.md</code>：</p>
<pre><code class="hljs language-bash" lang="bash">.claude/skills/
  react-component-generator/
    SKILL.md
    templates/
    scripts/
</code></pre>
<p><code>SKILL.md</code> 的开头是 YAML 配置，后面跟着 Markdown 格式的执行指南：</p>
<pre><code class="hljs language-md" lang="md">---
name: react-component-generator
<span class="hljs-section">description: 根据需求生成 React 组件
---</span>

当用户描述一个 UI 或功能需求时：
<span class="hljs-bullet">1.</span> 分析组件的职责与结构
<span class="hljs-bullet">2.</span> 匹配合适的组件模板
<span class="hljs-bullet">3.</span> 生成符合当前项目规范的 React 组件代码
</code></pre>
<p>AI 不再是“随意发挥”，而是<strong>在明确流程约束下执行任务，大幅降低随机性</strong>。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e749bf7bd88f426380cf0ea943909d97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=0YEItQwNTNRxj7u1%2Fu4m36CPwEE%3D" alt="Skill = SOP + 工具箱" loading="lazy"/></p>
<h2 data-id="heading-2">二、技能进化史：Agent Skills 是怎么来的？📜</h2>
<p>Agent Skills 不是石头缝里蹦出来的，它的出现其实是一条清晰的技术演进路线的终点。</p>
<h3 data-id="heading-3">1️⃣ Prompt Engineering 时代：纯靠“嘴遁”</h3>
<p>早期我们只能靠 Prompt 来指挥 AI：</p>
<blockquote>
<p>“你是一个资深前端，请按以下规范生成代码……”</p>
</blockquote>
<p>但问题很明显：</p>
<ul>
<li>不稳定（上下文一变就跑偏）</li>
<li>难复用（每次都要重新说一遍）</li>
<li>团队经验无法沉淀</li>
</ul>
<h3 data-id="heading-4">2️⃣ Tool / Function Calling：AI 学会“用工具”了</h3>
<p>接着出现了 <strong>Toolformer、Function Calling</strong>：</p>
<ul>
<li>AI 能自己判断“什么时候该调用工具”</li>
<li>还能把参数整理好传给函数</li>
</ul>
<p>但依然存在一个短板：</p>
<blockquote>
<p><strong>工具只告诉 AI“你能做什么”，却没告诉它“你应该怎么做”</strong>。</p>
</blockquote>
<h3 data-id="heading-5">3️⃣ Agent + Skills：开始真正“像人一样工作”</h3>
<p>Agent Skills 补上了最后一块拼图：</p>
<ul>
<li>把<strong>人类工程师的工作流</strong>固化下来</li>
<li>让 AI 面对复杂任务时，有清晰的步骤可循</li>
<li>支持按需加载技能，避免“一次性吃成胖子”（上下文爆炸）</li>
</ul>
<p>这也是为什么 <strong>Claude、Cursor、VSCode Agent、Trae</strong> 都在 2024~2025 年间集体拥抱了 Skills 机制。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e811de3ef743c0b6417c9dd34ae161~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=LYtIJ2bY7UhIzbbqbsUjzvAE1xs%3D" alt="Prompt vs Skill" loading="lazy"/></p>
<h2 data-id="heading-6">三、Skills vs MCP：别再傻傻分不清楚！🚨</h2>
<p>这是很多人容易搞混、但又必须弄清楚的一个点。</p>
<h3 data-id="heading-7">MCP 是什么？</h3>
<p><strong>MCP（Multi-agent / Model Context Protocol）</strong> 解决的是：</p>
<blockquote>
<p><strong>Agent 怎么“连接外部世界”</strong></p>
</blockquote>
<p>比如：</p>
<ul>
<li>读取数据库</li>
<li>调用搜索引擎</li>
<li>操作浏览器或文件系统</li>
</ul>
<p>你可以把它理解成：</p>
<blockquote>
<p><strong>接口协议 / 数据管道 / 外设驱动</strong></p>
</blockquote>
<h3 data-id="heading-8">Skills 又是什么？</h3>
<p>Skills 解决的则是另一件事：</p>
<blockquote>
<p><strong>Agent 应该“按照什么流程正确做事”</strong></p>
</blockquote>
<h3 data-id="heading-9">一个超形象的类比</h3>

















<table><thead><tr><th>角色</th><th>类比</th></tr></thead><tbody><tr><td>MCP</td><td>USB 接口 / API 网关</td></tr><tr><td>Skills</td><td>说明书 / 标准作业程序（SOP）</td></tr></tbody></table>
<p>👉 <strong>MCP 管的是“能不能做”</strong><br/>
👉 <strong>Skills 管的是“该怎么做”</strong></p>
<p>它们俩是<strong>互补关系</strong>，而不是谁替代谁。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6ceb2bee6004074b2103a87f7d8e638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=OMlz1vBWVxJJGP31u0FLI8IA9y4%3D" alt="MCP vs Skills" loading="lazy"/></p>
<h2 data-id="heading-10">四、上手实战：在智能 IDE 里怎么玩转 Skills？🎮</h2>
<p>我们拿 <strong>Claude Code / Cursor</strong> 来举个完整的例子。</p>
<h3 data-id="heading-11">1️⃣ 安装 Skills 管理工具</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g openskills
</code></pre>
<h3 data-id="heading-12">2️⃣ 安装官方或社区的 Skills</h3>
<pre><code class="hljs language-bash" lang="bash">openskills install anthropics/skills
</code></pre>
<p>你可以挑着装，比如只装这几个：</p>
<ul>
<li>pptx-generator（自动做 PPT）</li>
<li>git-changelog-analyzer（分析 Git 日志）</li>
<li>code-review-helper（辅助代码审查）</li>
</ul>
<h3 data-id="heading-13">3️⃣ 生成 AGENTS.md 索引文件</h3>
<pre><code class="hljs language-bash" lang="bash">openskills <span class="hljs-built_in">sync</span>
</code></pre>
<p>这个文件非常关键：</p>
<blockquote>
<p><strong>它就像是 AI 的“技能清单”</strong>。</p>
</blockquote>
<h3 data-id="heading-14">4️⃣ 实际体验：一句话让 AI 干活</h3>
<p>在 Cursor / Claude Code 里直接输入：</p>
<blockquote>
<p>用 <code>pptx</code> skill，基于最近 10 次 git commit，生成一份技术周报 PPT</p>
</blockquote>
<p>接下来 AI 会自动：</p>
<ol>
<li>查看 AGENTS.md</li>
<li>找到 pptx 这个技能</li>
<li>拉取 git 日志</li>
<li>调用模板和脚本生成 PPT 文件</li>
</ol>
<p>全程<strong>无需你再手写任何一句 Prompt</strong>。</p>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbc50e73d6884fc7b1f45768d4208ad1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=hBZmWXtFR6%2BdVj0dut5g7QMdEmM%3D" alt="Skill 调用流程" loading="lazy"/></p>
<h2 data-id="heading-15">五、真实场景：Skills 能用来做什么？💼</h2>
<p>这里才是 Agent Skills 真正让人兴奋（甚至有点吓人）的地方。</p>
<h3 data-id="heading-16">🧩 对开发者</h3>
<ul>
<li>统一项目代码风格（ESLint + Prettier 自动化）</li>
<li>自动生成组件、API 层、Mock 数据</li>
<li>一键补全单元测试</li>
<li>按团队规范批量重构代码</li>
</ul>
<h3 data-id="heading-17">📦 对产品与技术管理者</h3>
<ul>
<li>自动生成 PRD / 技术方案框架</li>
<li>版本发布自动生成变更说明</li>
<li>定期生成技术周报、月报</li>
</ul>
<h3 data-id="heading-18">🛠 对团队协作</h3>
<ul>
<li>把团队大佬的经验封装成 Skill</li>
<li>新人入职直接“加载技能包”</li>
<li>AI 化身真正能干的“虚拟同事”</li>
</ul>
<p>一句话总结：</p>
<blockquote>
<p><strong>只要你能写成标准流程的活儿，都有可能变成一个 Skill。</strong></p>
</blockquote>
<hr/>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a3cac3ea0d4862870d1e3de88826f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX1_kuI3mg7Por7Tor51fXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770978458&amp;x-signature=j1DS9S3gwu3UFuoVpBdJu95lojs%3D" alt="Skills 应用场景" loading="lazy"/></p>
<h2 data-id="heading-19">六、冷静一下：Skills 的隐患与未来 ⚠️</h2>
<p>能力越强，责任越大，风险也越真实。</p>
<h3 data-id="heading-20">⚠️ 已经露头的风险</h3>
<ul>
<li>恶意 Skill 偷偷注入危险指令</li>
<li>一次授权，AI 就可能长期“失控”</li>
<li>诱导 AI 执行高权限操作（比如读 SSH Key、跑系统命令）</li>
</ul>
<p>现实中已有安全团队警告：</p>
<blockquote>
<p>部分 Skill 可在用户无感知的情况下，读取敏感文件或执行命令。</p>
</blockquote>
<h3 data-id="heading-21">🛡️ 必须补上的防护</h3>
<ul>
<li>Skill 权限分级管理</li>
<li>脚本在沙箱中执行</li>
<li>安全扫描与审核机制</li>
<li>关键操作需人类确认</li>
</ul>
<h3 data-id="heading-22">🌱 未来的想象空间</h3>
<ul>
<li>Skill 应用商店 &amp; 行业标准</li>
<li>一次开发，多 IDE 通用</li>
<li>企业私有 Skill 仓库</li>
<li>Skill + MCP + Agent 的完整工程体系</li>
</ul>
<hr/>
<h2 data-id="heading-23">写在最后 ✨</h2>
<p>如果你最近觉得：</p>
<blockquote>
<p>“AI 终于像个靠谱的工程师了”</p>
</blockquote>
<p>那很可能是因为：</p>
<blockquote>
<p><strong>它不再只是一个语言模型，而是一个装备了 Skills 的智能体。</strong></p>
</blockquote>
<p>下一阶段的竞争，或许不再是比谁的 Prompt 写得妙，
而是看谁<strong>更会给 AI 设计“技能架构”</strong>。</p>
<p>欢迎从今天开始，</p>
<blockquote>
<p><strong>少写 Prompt，多写 Skills。</strong> 🚀</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么建议把 map 换成 for loop？—— 聊聊 Side Effects 与语义化编程]]></title>    <link>https://juejin.cn/post/7603352117639168009</link>    <guid>https://juejin.cn/post/7603352117639168009</guid>    <pubDate>2026-02-06T08:55:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603352117639168009" data-draft-id="7603309951227379762" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么建议把 map 换成 for loop？—— 聊聊 Side Effects 与语义化编程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T08:55:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gogo1121"/> <meta itemprop="url" content="https://juejin.cn/user/4162081326907051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么建议把 map 换成 for loop？—— 聊聊 Side Effects 与语义化编程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4162081326907051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gogo1121
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T08:55:12.000Z" title="Fri Feb 06 2026 08:55:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在进行代码审查（Code Review）时，你是否收到过这样的评论：</p>
<blockquote>
<p><strong>“这里的 side effect 会不会考虑一下用 for loop？”</strong></p>
</blockquote>
<p>当时的我心里想：“反正代码都能跑，<code>map</code> 和 <code>for</code> 有什么区别吗？<code>map</code> 写起来不是更短更帅吗？”</p>
<p>这篇文章就是为了解答这个疑惑。这不仅仅是代码风格的问题，更关乎<strong>代码的可读性（语义）</strong> 、<strong>性能（内存）以及函数式编程的原则</strong>。</p>
<hr/>
<h2 data-id="heading-0">一、 什么是 Side Effect（副作用）？</h2>
<p>首先，我们要听懂“行话”。在编程中，<strong>Side Effect</strong> 指的是一个函数在执行过程中，除了返回结果之外，还<strong>改变了外部的世界</strong>。</p>
<ul>
<li>
<p><strong>纯函数 (Pure Function)</strong> ：输入 <code>2</code>，输出 <code>4</code>。不修改任何外部变量，不读写数据库，不打印日志。像数学公式一样纯粹。</p>
</li>
<li>
<p><strong>有副作用 (Side Effect)</strong> ：</p>
<ul>
<li>修改了外部定义的变量（如 <code>total += 1</code>）。</li>
<li>写入数据库（DB Insert/Update）。</li>
<li>发送网络请求（API Call）。</li>
<li>打印日志（<code>console.log</code>）。</li>
</ul>
</li>
</ul>
<p><strong>Reviewer 的潜台词：</strong> “我看你在遍历数组时，并不是为了把 A 变成 B，而是为了拿 A 去做一些操作（比如存库）。这种情况，请不要用 <code>map</code>。”</p>
<hr/>
<h2 data-id="heading-1">二、 <code>map</code> vs <code>for</code>：看似一样，实则背道而驰</h2>
<p>虽然它们都能遍历数组，但它们在**设计初衷（语义）**上是完全不同的。</p>
<h3 data-id="heading-2">1. <code>map</code> 的契约：我只负责“转换”</h3>
<p><code>map</code> 是函数式编程（Functional Programming）的明星工具。它的名字来源于数学中的“映射”（Mapping）。</p>
<ul>
<li><strong>语义</strong>：给我一个数组 <code>[A, B, C]</code>，我给你返回一个新数组 <code>[A', B', C']</code>。</li>
<li><strong>潜规则</strong>：<strong>一定要有返回值</strong>，且<strong>不要修改原始数据</strong>。</li>
</ul>
<h3 data-id="heading-3">2. <code>for</code> / <code>forEach</code> 的契约：我只负责“执行”</h3>
<p><code>for</code> 循环（包括 <code>for...of</code>）是指令式编程（Imperative Programming）的工具。</p>
<ul>
<li><strong>语义</strong>：对着数组里的每一个元素，去<strong>执行</strong>一段逻辑。</li>
<li><strong>潜规则</strong>：我不关心返回值，我只关心过程（比如存库、发邮件）。</li>
</ul>
<hr/>
<h2 data-id="heading-4">三、 为什么用 <code>map</code> 处理副作用被视为 Anti-pattern（反模式）？</h2>
<p>如果你写了这样的代码：</p>
<pre><code class="hljs language-ini" lang="ini">// ❌ 被吐槽的写法
const <span class="hljs-attr">userIds</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<span class="hljs-comment">;</span>

userIds.map(<span class="hljs-attr">id</span> =&gt; {
  db.updateStatus(id, 'active')<span class="hljs-comment">; // &lt;--- 这就是 Side Effect</span>
  // 没有 return，或者 return 了一个没用的东西
})<span class="hljs-comment">;</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>Reviewer 看到这段代码会有三个层面的担忧：</p>
<h3 data-id="heading-5">1. 误导阅读者（语义错误）</h3>
<p>代码是写给人看的。 当你使用 <code>map</code> 时，阅读代码的人会预期：“哦，这里在生成一个新的数据列表。” 结果看了一圈发现，你并没有使用 <code>map</code> 的返回值，只是在里面干活。这就像是你<strong>雇了一个顶级大厨（map），却让他去送快递（side effect）</strong> ——虽然他也能送，但让人觉得很违和。</p>
<h3 data-id="heading-6">2. 内存浪费（性能隐患）</h3>
<p>这是实打实的技术问题。 <code>map</code> 函数<strong>一定会</strong>在内存中分配一个新的数组。</p>
<ul>
<li>如果你用 <code>map</code> 遍历 10,000 个用户去发邮件，通过 <code>map</code> 你会隐式地创建了一个包含 10,000 个 <code>undefined</code>（因为你没 return）的数组。</li>
<li>这个数组创建完立刻就被扔掉等待垃圾回收（GC）。</li>
<li><strong>结论</strong>：你在浪费内存，给 GC 增加压力。</li>
</ul>
<h3 data-id="heading-7">3. Async/Await 的陷阱</h3>
<p>在后端开发中，这尤为致命。</p>
<pre><code class="hljs language-python" lang="python">// ❌ 危险的 <span class="hljs-built_in">map</span> 写法
ids.<span class="hljs-built_in">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-built_in">id</span>) =&gt; {
  <span class="hljs-keyword">await</span> db.delete(<span class="hljs-built_in">id</span>);
});
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>上面这段代码<strong>不会</strong>等待数据库删除完成！<code>map</code> 会瞬间执行完，返回一堆 <code>Promise</code>，而你的主程序会继续往下跑。</p>
<p>如果要等待，必须配合 <code>Promise.all</code>：</p>
<pre><code class="hljs language-python" lang="python">// ✅ 如果要并发，且一定要用 <span class="hljs-built_in">map</span>
<span class="hljs-keyword">await</span> Promise.<span class="hljs-built_in">all</span>(ids.<span class="hljs-built_in">map</span>(<span class="hljs-keyword">async</span> (<span class="hljs-built_in">id</span>) =&gt; <span class="hljs-keyword">await</span> db.delete(<span class="hljs-built_in">id</span>)));
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>但如果你想要<strong>按顺序</strong>一个一个删（避免把数据库打挂），<code>map</code> 做不到，必须用 <code>for...of</code>。</p>
<hr/>
<h2 data-id="heading-8">四、 最佳实践：如何修改？</h2>
<p>针对 Reviewer 的建议，可以根据场景选择以下两种改法：</p>
<h3 data-id="heading-9">场景 A：纯同步操作 / 不需要等待结果</h3>
<p>使用 <code>forEach</code> 或 <code>for...of</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 语义清晰：我在对每个 ID 执行操作</span>
userIds.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Processing user <span class="hljs-subst">${id}</span>`</span>);
});
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-10">场景 B：异步操作（数据库/API）—— <strong>最推荐</strong></h3>
<p>现代 JavaScript/TypeScript 开发中，<code>for...of</code> 是处理异步副作用的神器</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ✅ 语义清晰，且支持 await 顺序执行</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> id of userIds) {
  <span class="hljs-comment">// 只有上一个 update 完成了，才会执行下一个</span>
  <span class="hljs-keyword">await</span> db.updateStatus(id, <span class="hljs-string">'active'</span>); 
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-11">五、 总结</h2>
<p>下次当你手指放在键盘上准备敲下 <code>.map</code> 时，停下来问自己一个问题：</p>
<p><strong>“我是想要根据旧数组【生成】一个新数组，还是想要用这些数据去【做】一些事情？”</strong></p>
<ul>
<li>如果是<strong>生成</strong>数据（转换）：请用 <code>map</code>。</li>
<li>如果是<strong>做</strong>事情（副作用）：请用 <code>for...of</code> 或 <code>forEach</code>。</li>
</ul>
<p>这不仅仅是代码能不能跑的区别，更是从“写代码的人”进阶到“工程师”的必经之路：<strong>精准地使用工具，表达清晰的意图。</strong></p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你不知道的JS上-（八）]]></title>    <link>https://juejin.cn/post/7603444191447990306</link>    <guid>https://juejin.cn/post/7603444191447990306</guid>    <pubDate>2026-02-06T08:55:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191447990306" data-draft-id="7603444191447924770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你不知道的JS上-（八）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-02-06T08:55:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户1443618340097"/> <meta itemprop="url" content="https://juejin.cn/user/2782223226650328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你不知道的JS上-（八）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2782223226650328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户1443618340097
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T08:55:26.000Z" title="Fri Feb 06 2026 08:55:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">this 和对象原型</h2>
<h3 data-id="heading-1">对象</h3>
<h4 data-id="heading-2">语法</h4>
<p>对象可以通过两种形式定义：声明（文字）形式和构造形式。</p>
<p>文字语法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObj = {
  <span class="hljs-attr">key</span>: value,
  <span class="hljs-comment">//...</span>
};
</code></pre>
<p>构造语法：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
myObj.<span class="hljs-property">key</span> = value;
</code></pre>
<p>构造形式和文字形式的区别就是，文字声明中可以添加多个健/值对，构造语法只能逐个添加。</p>
<h4 data-id="heading-3">类型</h4>
<p>对象是JavaScript的基础。在JavaScript中一个有六种主要类型（术语是“语言类型”）：string、number、boolean、null、undefined、object</p>
<p>注意，简单基本类型本身并不是对象。null有时会被当作一种对象类型，但这是语言本身的一个bug，即对null执行typeof null时会返回字符串“object”。null本身是基本类型。</p>
<p>实际上，JS中有许多特殊的对象子类型，我们称之为复杂基本类型。</p>
<p>函数、数组都是对象的一种类型。</p>
<h5 data-id="heading-4">内置对象</h5>
<p>JS中还有一些对象子类型，通常被称为内置对象。有些内置对象的名字看起来和基础类型一样，不过它们的关系更加复杂。String、Number、Boolean、Object、Function、Array、Date、RegExp、Error。</p>
<p>这些内置对象从表现形式上和其他语言中的类型（type）或者类（class）很像，比如Java中的String类。</p>
<p>但在JS中，它们实际上只是一些内置函数。这些内置函数可以当作构造函数来使用，从而构造一个对应子类型的新对象。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> strPrimitive = <span class="hljs-string">"I am a String"</span>;
<span class="hljs-keyword">typeof</span> strPrimitive; <span class="hljs-comment">// "string"</span>
strPrimitive <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>; <span class="hljs-comment">// false</span>

<span class="hljs-keyword">var</span> strObject = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"I am a String"</span>);
<span class="hljs-keyword">typeof</span> strObject; <span class="hljs-comment">// "object"</span>
strObject <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 检查sub-type对象</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(strObject); <span class="hljs-comment">// [object String]</span>
</code></pre>
<p>原始值"I am a String"并不是一个对象，它只是一个字面量，并且是一个不可变的值。语言会自动把字符串字面量转换成一个String对象以便对其执行一些操作，比如获取长度、访问其中某个字符等。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> strPrimitive = <span class="hljs-string">"I am a String"</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(strPrimitive.<span class="hljs-property">length</span>); <span class="hljs-comment">// 13</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(strPrimitive.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// "m"</span>
</code></pre>
<p>同样的事也会发生在数值字面量和布尔字面量上。</p>
<p>null和undefined没有对应的构造形式，它们只有文字形式。相反，Date只有构造，没有文字形式。</p>
<p>对于Object、Array、Function和RegExp来说，无论使用文字还是构造形式，它们都是对象，不是字面量。</p>
<p>Error对象很少在代码中显示创建，一般是在抛出异常时被自动创建。也可以使用new Error(..)来创建。</p>
<h4 data-id="heading-5">内容</h4>
<p>对象的内容是由一些存储在特地命名位置的（任意类型的）值组成的，我们称之为属性。</p>
<p>在引擎内部，属性的存储方式是多种多样的，一般并不会存在对象容器内部。存储在对象容器内部的是这些属性的名称，它们就像指针（从技术角度来说就是引用）一样，指向这些值真正的存储位置。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
};

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>

myObject[<span class="hljs-string">"a"</span>]; <span class="hljs-comment">// 2</span>
</code></pre>
<p>“.a”语法通常被称为“属性访问”，“["a"]”语法通常被称为“键访问”。它们访问的都是同一个位置。</p>
<p>两种语法的主要区别为“.”操作符要求属性名满足标识符的命名规范，“[".."]”语法可以接受任意UTF-8/Unicode字符串作为属性名。</p>
<p>在对象中，属性名永远都是字符串。如果使用的是string（字面量）以外的其他值作为属性名，那它首先会被转换为一个字符串。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {};

myObject[<span class="hljs-literal">true</span>] = <span class="hljs-string">"foo"</span>;
myObject[<span class="hljs-number">3</span>] = <span class="hljs-string">"bar"</span>;
myObject[myObject] = <span class="hljs-string">"baz"</span>;

myObject[<span class="hljs-string">"true"</span>]; <span class="hljs-comment">// "foo"</span>
myObject[<span class="hljs-string">"3"</span>]; <span class="hljs-comment">// "bar"</span>
myObject[<span class="hljs-string">"[object Object]"</span>]; <span class="hljs-comment">// "baz"</span>
</code></pre>
<h5 data-id="heading-6">可计算属性名</h5>
<p>ES6 增加了可计算属性名：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> prefix = <span class="hljs-string">"foo"</span>;

<span class="hljs-keyword">var</span> myObject = {
  [prefix + <span class="hljs-string">"bar"</span>]: <span class="hljs-string">"hello"</span>,
  [prefix + <span class="hljs-string">"baz"</span>]: <span class="hljs-string">"world"</span>,
};

myObject[<span class="hljs-string">"foobar"</span>]; <span class="hljs-comment">// hello</span>
myObject[<span class="hljs-string">"foobaz"</span>]; <span class="hljs-comment">// world</span>
</code></pre>
<h5 data-id="heading-7">数组</h5>
<p>数组也支持[]访问形式。数组期望额是数值下标，也就是值存储的位置（通常被称为索引）是非负整数：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myArray = [<span class="hljs-string">"foo"</span>, <span class="hljs-number">42</span>, <span class="hljs-string">"bar"</span>];

myArray.<span class="hljs-property">length</span>; <span class="hljs-comment">// 3</span>
myArray[<span class="hljs-number">0</span>]; <span class="hljs-comment">// "foo"</span>
myArray[<span class="hljs-number">2</span>]; <span class="hljs-comment">// "bar"</span>
</code></pre>
<p>数组也是对象，可以给数组添加属性（但不建议这么做）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myArray = [<span class="hljs-string">"foo"</span>, <span class="hljs-number">42</span>, <span class="hljs-string">"bar"</span>];

myArray.<span class="hljs-property">baz</span> = <span class="hljs-string">"baz"</span>;
myArray.<span class="hljs-property">length</span>; <span class="hljs-comment">// 3</span>
myArray.<span class="hljs-property">baz</span>; <span class="hljs-comment">// "baz"</span>
</code></pre>
<h5 data-id="heading-8">复制对象</h5>
<p>在JS中复制一个对象是复杂的，需要判断深复制还是浅复制。对于浅拷贝，会和旧对象使用相同的引用；对于深拷贝，存在循环引用的情况就会导致死循环。</p>
<p>许多JS框架都提出了自己的解决办法，但是JS采用的标准又不统一。</p>
<p>对于JSON安全（也就是可以被序列化为一个JSON字符串并且可以根据这个字符串解析出一个结构和值完全一样的对象）的对象来说：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> newObj = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(someObj));
</code></pre>
<p>ES6定义了Object.assign(..)方法实现浅复制：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> newObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, myObject);
</code></pre>
<h5 data-id="heading-9">属性描述符</h5>
<p>ES5之前按，JS语言本身没有提供可以直接检测属性特性的方法，比如判断属性是否是只读。</p>
<p>ES5开始，所有的属性都具备了属性描述符。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(myObject, <span class="hljs-string">"a"</span>);
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   value: 2,</span>
<span class="hljs-comment">//   writable: true,</span>
<span class="hljs-comment">//   enumerable: true,</span>
<span class="hljs-comment">//   configurable: true</span>
<span class="hljs-comment">// }</span>
</code></pre>
<p>如我们所见，该普通的对象属性对应的属性描述符（也被称为“数描述符”，因为它只能保存一个数据），不仅只是2。还有另外三个特性：writable（可写）、enumerable（可枚举）和configurable（可配置）。</p>
<p>我们可以使用Object.defineProperty(..)来添加一个新的属性或修改已有属性（如果它是configurable）对特性进行设置。</p>
<ol>
<li>writable
writable决定是否可以修改属性的值</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-string">"a"</span>， {
  <span class="hljs-attr">value</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">writable</span>: fasle, <span class="hljs-comment">// 不可写</span>
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
});

myObject.<span class="hljs-property">a</span> = <span class="hljs-number">3</span>;

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>

</code></pre>
<ol start="2">
<li>configurable
只要属性是可配置的，就可以使用defineProperty(..)方法来修改属性描述符</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>
};

myObject.<span class="hljs-property">a</span> = <span class="hljs-number">3</span>;
myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 3</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-string">"a"</span>， {
  <span class="hljs-attr">value</span>: <span class="hljs-number">4</span>,
  <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">configurable</span>: fasle <span class="hljs-comment">// 不可配置</span>
});

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 4</span>
myObject.<span class="hljs-property">a</span> = <span class="hljs-number">5</span>;
myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 5</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-string">"a"</span>， {
  <span class="hljs-attr">value</span>: <span class="hljs-number">6</span>,
  <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,wrai
  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
}); <span class="hljs-comment">// TypeError</span>
</code></pre>
<p>可见将configurable修改为false是单向操作，无法撤销。</p>
<blockquote>
<p>要注意一个例外，即便属性是configurable: false,还是能够将 writable 的状态由 true 改为 false，但是无法由 fasle 改为 true。</p>
</blockquote>
<p>且configurable: false 还会禁止删除这个属性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>
};

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>

<span class="hljs-keyword">delete</span> myObject.<span class="hljs-property">a</span>;
myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// undefined</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-string">"a"</span>， {
  <span class="hljs-attr">value</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">configurable</span>: fasle <span class="hljs-comment">// 不可配置</span>
});

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>
<span class="hljs-keyword">delete</span> myObject.<span class="hljs-property">a</span>;
myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>
</code></pre>
<ol start="3">
<li>enumerable</li>
</ol>
<p>该描述符控制属性是否会出现在对象的属性枚举中，比如for..in循环，如果设置enumerable为false，这个属性就不会出现在枚举中。</p>
<h5 data-id="heading-10">不变性</h5>
<p>有时我们希望属性或者对象是不可改变的，H5中可以通过很多方法实现，但所有的方法都是浅不变性，它们只会影响目标对象和它的直接属性。</p>
<ol>
<li>对象常量
结合 writable: false 和 configurable: fasle就可以创建一个真正的常量属性（不可修改、重新定义或者删除）：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-string">"FAVORITE_NUMBER"</span>， {
  <span class="hljs-attr">value</span>: <span class="hljs-number">42</span>,
  <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">configurable</span>: fasle
});
</code></pre>
<ol start="2">
<li>禁止拓展
可以使用Object.preventExtensions(..)：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">preventExtensions</span>(myObject);

myObject.<span class="hljs-property">b</span> = <span class="hljs-number">3</span>;
myObject.<span class="hljs-property">b</span>; <span class="hljs-comment">// undefined</span>
</code></pre>
<ol start="3">
<li>
<p>密封
Object.seal(..) 会创建一个“密封”的对象，这个方法会一个在现有的对象上调用Object.preventExtensions(..)，并把所有的属性标记为configurable: false。</p>
</li>
<li>
<p>冻结
Object.freeze(..) 会创建一个“冻结”的对象，这个方法会一个在现有的对象上调用Object.seal(..)，并把所有“数据访问”属性标记为writable: false，这样旧无法修改值。</p>
</li>
</ol>
<p>该方法是我们可以应用在对象上的最高的不可变性，它会禁止对象本身及其任意直接属性的修改（不过该对象引用的其他对象是不受影响的）。</p>
<h5 data-id="heading-11">[[Get]]</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObjedt = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
};
myObjedt.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>
</code></pre>
<p>myObjedt.a通过[[Get]]操作实现对a属性的访问。对象默认的内置[[Get]]操作会首先查找是否有同名的属性，有就返回该对象的值。没有就会遍历可能存在的[[Prototype]]链，还是没找到的话就会返回undefined。</p>
<h5 data-id="heading-12">[[Put]]</h5>
<p>[[Put]]被触发时，会取决于许多因素，包括对象中是否存在这个属性。</p>
<p>如果已经存在这个属性，[[Put]]算法大致会检查下面这些内容。</p>
<ol>
<li>属性是否是访问描述符？如何是并且存在setter就调用setter。</li>
<li>属性的数据描述符中writable是否是false？如果是，在非严格模式静默失败，在严格模式抛出TypeError异常。</li>
<li>如果都不是将值设为属性的值。</li>
</ol>
<p>如果对象中不存在这个属性，[[Put]]操作会更加复制。后续详细介绍。</p>
<h5 data-id="heading-13">Getter和Setter</h5>
<p>对象默认的[[Put]]和[[Get]]操作分别可以控制属性值的设置和获取。</p>
<p>在ES5中可以使用getter和setter部分改写默认操作，但是只能应用在单个属性上，无法应用在整个对象上。getter是一个隐藏函数，会在获取属性值时调用。setter也是一个隐藏函数，会在设置属性值时调用。</p>
<p>当你给一个属性定义getter、setter 或者两者都有时，这个属性会被定义为“访问描述符”（和“数据描述符”相对）。对于访问描述符来说，JavaScript 会忽略它们的value和
writable特性，取而代之的是关心set和get（还有configurable和enumerable）特性</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-comment">// 给a定义一个getter</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">a</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
  },
};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(
  myObject, <span class="hljs-comment">// 目标对象</span>
  <span class="hljs-string">"b"</span>, <span class="hljs-comment">// 属性名</span>
  {
    <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> * <span class="hljs-number">2</span>;
    },
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
  },
);

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 2</span>

myObject.<span class="hljs-property">b</span>; <span class="hljs-comment">// 4</span>
</code></pre>
<p>通常getter和setter是成对出现的（只定义一个的话通常会产生意料之外的行为）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-comment">// 给a定义一个getter</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">a</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_a_</span>;
  }

  <span class="hljs-comment">// 给a定义一个setter</span>
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">a</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_a_</span> = val * <span class="hljs-number">2</span>;
  }
}

myObject.<span class="hljs-property">a</span> = <span class="hljs-number">2</span>;

myObject.<span class="hljs-property">a</span>; <span class="hljs-comment">// 4</span>
</code></pre>
<h5 data-id="heading-14">存在性</h5>
<p>当myObject.a的属性访问返回值为undefined时，这个值可能时属性中存储的undefined，也可能是属性不存在而返回undefined。我们可以在不访问属性值的情况下判断对象中是否存在这个属性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
};

<span class="hljs-string">"a"</span> <span class="hljs-keyword">in</span> myObject; <span class="hljs-comment">// true</span>
<span class="hljs-string">"b"</span> <span class="hljs-keyword">in</span> myObject; <span class="hljs-comment">// false</span>

myObject.<span class="hljs-title function_">hasOwnProhaperty</span>(<span class="hljs-string">"a"</span>); <span class="hljs-comment">// true</span>
myObject.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"b"</span>); <span class="hljs-comment">// false</span>
</code></pre>
<p>in 操作符会检查属性是否在对象及其[[Prototype]]原型链中。</p>
<p>hasOwnproperty(..)只会检查属性是否在myObject对象中，不会检查[[Prototype]]链。</p>
<h6 data-id="heading-15">枚举</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(
  myObject,
  <span class="hljs-string">"a"</span>,
  <span class="hljs-comment">// 让a可枚举</span>
  { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
);

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(
  myObject,
  <span class="hljs-string">"b"</span>,
  <span class="hljs-comment">// 让b不可枚举</span>
  { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
);

myObject.<span class="hljs-property">b</span>; <span class="hljs-comment">// 3</span>
<span class="hljs-string">"b"</span> <span class="hljs-keyword">in</span> myObject; <span class="hljs-comment">// true</span>
myObject.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">"b"</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// .............</span>

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> myObject) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(k, myObject[k]);
} <span class="hljs-comment">// "a" 2</span>
</code></pre>
<p>可以看到myObject.b确实存在并且有访问值，但不会出现在for..in循环中。</p>
<p>也可以通过其他方式来区分属性是否可枚举：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(
  myObject,
  <span class="hljs-string">"a"</span>,
  <span class="hljs-comment">// 让a可枚举</span>
  { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> },
);

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(
  myObject,
  <span class="hljs-string">"b"</span>,
  <span class="hljs-comment">// 让b不可枚举</span>
  { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">3</span> },
);

myObject.<span class="hljs-title function_">propertyIsEnumerable</span>(<span class="hljs-string">"a"</span>); <span class="hljs-comment">// true</span>
myObject.<span class="hljs-title function_">propertyIsEnumerable</span>(<span class="hljs-string">"b"</span>); <span class="hljs-comment">// false</span>

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(myObject); <span class="hljs-comment">// ["a"]</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyNames</span>(myObject); <span class="hljs-comment">// ["a", "b"]</span>
</code></pre>
<h4 data-id="heading-16">遍历</h4>
<p>for..in 循环可以用来遍历对象的可枚举属性列表（包括[[Prototype]]链）</p>
<p>ES6中增加了 for..of 循环语法来遍历数组（如果对象本身定义了迭代器的话也可以遍历对象）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myArray = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v <span class="hljs-keyword">of</span> myArray) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);
}
<span class="hljs-comment">// 1</span>
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 3</span>
</code></pre>
<p>for..of 循环首先会向被访问对象请求一个迭代器对象，然后通过调用迭代器对象的next()方法来遍历所有返回值。</p>
<p>数组内有内置的@@iterator，因此for..of可以直接应用在数组上。我们使用内置的@@iterator来手动遍历数组，看看它是怎么工作的：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myArray = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">var</span> it = myArray[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]();

it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value:1,done:false}</span>
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value:2,done:false}</span>
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value:3,done:false}</span>
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {done:true}</span>
</code></pre>
<p>和数组不同，普通的对象没有内置的@@iterator，所有无法自动完成for..of遍历。之所以要这样做，有许多复杂的原因，不过简单来说这样是为了避免影响未来的对象类型。</p>
<p>我们可以给想遍历的对象定义@@iterator：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">var</span> myObject = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">b</span>: <span class="hljs-number">3</span>,
};

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(myObject, <span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>, {
  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">value</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-keyword">var</span> o = <span class="hljs-variable language_">this</span>;
    <span class="hljs-keyword">var</span> idx = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> ks = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(o);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">next</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">value</span>: o[ks[idx++]],
          <span class="hljs-attr">done</span>: idx &gt; ks.<span class="hljs-property">length</span>,
        };
      },
    };
  },
});

<span class="hljs-comment">// 手动遍历myObject</span>
<span class="hljs-keyword">var</span> it = myObject[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]();
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value: 2,done: false}</span>
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value: 3,done: false}</span>
it.<span class="hljs-title function_">next</span>(); <span class="hljs-comment">// {value: undefined,done: true}</span>

<span class="hljs-comment">// 用for..of遍历myObject</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v <span class="hljs-keyword">of</span> myObject) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(v);
}
<span class="hljs-comment">// 2</span>
<span class="hljs-comment">// 3</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[当 AI 学会了写博客：Cursor AI Skill 如何让你的开发效率翻倍]]></title>    <link>https://juejin.cn/post/7603383059151880234</link>    <guid>https://juejin.cn/post/7603383059151880234</guid>    <pubDate>2026-02-06T08:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603383059151880234" data-draft-id="7603383059151749162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="当 AI 学会了写博客：Cursor AI Skill 如何让你的开发效率翻倍"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-06T08:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PTC"/> <meta itemprop="url" content="https://juejin.cn/user/3925713569717248"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            当 AI 学会了写博客：Cursor AI Skill 如何让你的开发效率翻倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3925713569717248/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PTC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T08:56:58.000Z" title="Fri Feb 06 2026 08:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    43
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>你有没有想过，写完代码之后，AI 自动帮你把技术博客也写了？</p>
<p>这不是幻想。我在自己的博客系统 <strong>Ink &amp; Code</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fptclove.com%2F" target="_blank" title="https://ptclove.com/" ref="nofollow noopener noreferrer">ptclove.com</a>）上实现了这个能力——通过 Cursor 的 AI Skill 机制，只需一句话，AI 就能分析代码、撰写文章、一键发布。</p>
<p>本文会深入介绍 AI Skill 的实际应用，以及支撑这一切的技术架构：<strong>Next.js 16 + Prisma + Tailwind CSS 4 + Tiptap</strong>。</p>
<h2 data-id="heading-1">什么是 Cursor AI Skill</h2>
<p>AI Skill 是 Cursor IDE 提供的一种扩展机制，本质上是一份 Markdown 格式的指令文件（<code>SKILL.md</code>），告诉 AI 在特定场景下该做什么、怎么做。</p>
<p>与普通的 Prompt 不同，Skill 有几个核心优势：</p>
<ol>
<li><strong>场景触发</strong>：当用户提到"写博客"、"发布文章"时自动激活</li>
<li><strong>结构化流程</strong>：定义清晰的多步骤工作流，而不是一次性提问</li>
<li><strong>工具集成</strong>：可以调用 Shell 脚本、API 接口，实现端到端的自动化</li>
</ol>
<h2 data-id="heading-2">实战：一个自动写博客的 Skill</h2>
<p>我在项目中创建了 <code>.cursor/skills/generate-blog/SKILL.md</code>，定义了博客生成的完整流程：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">generate-blog</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">生成技术博客并发布到</span> <span class="hljs-string">Ink</span> <span class="hljs-string">&amp;</span> <span class="hljs-string">Code</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># 生成博客文章</span>

<span class="hljs-comment">## 工作流程</span>

<span class="hljs-comment">### 1. 确定生成模式</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">commit</span> <span class="hljs-string">模式：根据</span> <span class="hljs-string">Git</span> <span class="hljs-string">提交改动生成</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">topic</span> <span class="hljs-string">模式：根据特定主题生成</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">repo</span> <span class="hljs-string">模式：介绍整个项目</span>

<span class="hljs-comment">### 2. 收集上下文</span>
<span class="hljs-string">根据模式收集相关代码上下文...</span>

<span class="hljs-comment">### 3. 生成博客内容</span>
<span class="hljs-string">撰写高质量技术博客，包含背景、方案、实现、总结...</span>

<span class="hljs-comment">### 4. 发布文章</span>
<span class="hljs-string">使用脚本发布到博客系统：</span>
</code></pre>
<p>关键在于第 4 步——Skill 不仅能生成内容，还能通过 Shell 脚本直接发布：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># publish.sh - 一键发布到博客</span>
TITLE=<span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
TAGS=<span class="hljs-string">"<span class="hljs-variable">$2</span>"</span>

<span class="hljs-comment"># 读取内容（支持文件、stdin、剪贴板）</span>
<span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$CONTENT_FILE</span>"</span> ] &amp;&amp; [ -f <span class="hljs-string">"<span class="hljs-variable">$CONTENT_FILE</span>"</span> ]; <span class="hljs-keyword">then</span>
    CONTENT=$(<span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">$CONTENT_FILE</span>"</span>)
<span class="hljs-keyword">elif</span> [ ! -t 0 ]; <span class="hljs-keyword">then</span>
    CONTENT=$(<span class="hljs-built_in">cat</span>)
<span class="hljs-keyword">else</span>
    CONTENT=$(pbpaste 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>)
<span class="hljs-keyword">fi</span>

<span class="hljs-comment"># 构建 JSON 并调用 API</span>
jq -n --arg title <span class="hljs-string">"<span class="hljs-variable">$TITLE</span>"</span> --arg content <span class="hljs-string">"<span class="hljs-variable">$CONTENT</span>"</span> \
  <span class="hljs-string">'{title: $title, content: $content, published: false}'</span> \
  &gt; /tmp/blog_payload.json

curl -X POST <span class="hljs-string">"<span class="hljs-variable">${INK_AND_CODE_URL}</span>/api/article/create-from-commit"</span> \
  -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$INK_AND_CODE_TOKEN</span>"</span> \
  -d @/tmp/blog_payload.json
</code></pre>
<p>这意味着从代码变更到文章发布，整个链路都是自动化的。</p>
<h2 data-id="heading-3">更进一步：GitHub Actions + AI 自动发文</h2>
<p>除了本地 Skill，我还配置了 GitHub Actions 实现 CI/CD 级别的博客自动化：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/auto-blog.yml</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [<span class="hljs-string">main</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">generate-blog:</span>
    <span class="hljs-comment"># 只有提交信息包含 [blog] 时才触发</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">contains(github.event.head_commit.message,</span> <span class="hljs-string">'[blog]'</span><span class="hljs-string">)</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Gather</span> <span class="hljs-string">project</span> <span class="hljs-string">context</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          git diff HEAD~1 HEAD &gt; /tmp/commit_diff.txt
          # 收集项目结构、改动文件、配置文件...
</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Generate</span> <span class="hljs-string">and</span> <span class="hljs-string">publish</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          # 将上下文发送给 AI，生成博客
          # 解析标题、内容、标签
          # 调用 API 发布
</span></code></pre>
<p><strong>工作原理</strong>：当我提交代码时，在 commit message 中加上 <code>[blog]</code> 标记，GitHub Actions 会自动收集项目上下文（diff、文件结构、配置文件），调用 DeepSeek/Claude/GPT 生成技术博客，最后通过 API 发布到网站。</p>
<p>整个过程无需人工干预，写完代码，博客就自动出现在网站上了。</p>
<h2 data-id="heading-4">支撑一切的技术架构</h2>
<p>这套自动化能跑通，离不开底层的技术架构。Ink &amp; Code 采用的是 <strong>Next.js 16 + Prisma + Tailwind CSS 4 + Tiptap</strong> 的组合。</p>
<h3 data-id="heading-5">Next.js 16 App Router</h3>
<p>项目使用 Next.js 16 的 App Router 架构，目录结构清晰：</p>
<pre><code class="hljs language-ini" lang="ini">app/
├── api/          <span class="hljs-comment"># API 路由</span>
│   ├── article/  <span class="hljs-comment"># 文章 CRUD</span>
│   ├── chat/     <span class="hljs-comment"># AI 聊天</span>
│   └── auth/     <span class="hljs-comment"># 认证</span>
├── admin/        <span class="hljs-comment"># 后台管理</span>
├── blog/         <span class="hljs-comment"># 博客页面</span>
├── components/   <span class="hljs-comment"># 组件</span>
└── u/<span class="hljs-section">[username]</span>/ <span class="hljs-comment"># 用户主页</span>
</code></pre>
<p>API 路由提供了完整的 RESTful 接口，支持两种认证方式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// Session 认证（用户登录）</span>
<span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> auth();

<span class="hljs-comment">// Token 认证（外部调用，如 GitHub Actions）</span>
<span class="hljs-keyword">const</span> token = request.headers
  .<span class="hljs-keyword">get</span>(<span class="hljs-string">'Authorization'</span>)?.replace(<span class="hljs-string">'Bearer '</span>, <span class="hljs-string">''</span>);
<span class="hljs-keyword">const</span> hashedToken = hashToken(token);
<span class="hljs-keyword">const</span> apiToken = <span class="hljs-keyword">await</span> prisma.apiToken.findUnique({
  <span class="hljs-keyword">where</span>: { tokenHash: hashedToken }
});
</code></pre>
<p>这种双认证机制让博客系统既支持浏览器登录，又支持脚本和 CI/CD 的外部调用。</p>
<h3 data-id="heading-6">Prisma 数据建模</h3>
<p>数据层使用 Prisma ORM，核心模型设计：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">model Post {
  id         String    <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(cuid())</span>
  title      String
  slug       String
  content    String    <span class="hljs-meta">@db</span>.Text  <span class="hljs-comment">// TipTap JSON</span>
  excerpt    String?
  coverImage String?
  published  <span class="hljs-built_in">Boolean</span>   <span class="hljs-meta">@default(false)</span>
  tags       String[]
  sortOrder  <span class="hljs-built_in">Int</span>       <span class="hljs-meta">@default(0)</span>

  user       User      <span class="hljs-meta">@relation(fields: [userId])</span>
  category   Category? <span class="hljs-meta">@relation(fields: [categoryId])</span>

  @<span class="hljs-meta">@unique([userId, slug])</span>
}

model Category {
  id       String     <span class="hljs-meta">@id</span> <span class="hljs-meta">@default(cuid())</span>
  name     String
  slug     String
  icon     String?
  parentId String?    <span class="hljs-comment">// 树形结构</span>
  parent   Category?  <span class="hljs-meta">@relation(<span class="hljs-string">"children"</span>, fields: [parentId])</span>
  children Category[] <span class="hljs-meta">@relation(<span class="hljs-string">"children"</span>)</span>

  @<span class="hljs-meta">@unique([userId, slug])</span>
}
</code></pre>
<p>文章内容以 TipTap JSON 格式存储，而非原始 Markdown。这意味着从外部（如 GitHub Actions）提交的 Markdown 内容需要经过转换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// lib/markdown-to-tiptap.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">markdownToTiptap</span>(<span class="hljs-params">markdown: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">doc</span>: <span class="hljs-title class_">TiptapDoc</span> = { <span class="hljs-attr">type</span>: <span class="hljs-string">'doc'</span>, <span class="hljs-attr">content</span>: [] };
  <span class="hljs-keyword">const</span> lines = markdown.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);

  <span class="hljs-keyword">while</span> (i &lt; lines.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">const</span> line = lines[i];
    <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'```'</span>)) {
      <span class="hljs-comment">// 代码块 → codeBlock 节点</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^#{1,6}\s/</span>)) {
      <span class="hljs-comment">// 标题 → heading 节点</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^\d+.\s/</span>)) {
      <span class="hljs-comment">// 有序列表 → orderedList 节点</span>
    }
    <span class="hljs-comment">// ...更多格式处理</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(doc);
}
</code></pre>
<h3 data-id="heading-7">Tiptap 富文本编辑器</h3>
<p>后台管理使用 Tiptap 作为编辑器，支持丰富的内容格式：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> editor = <span class="hljs-built_in">useEditor</span>({
  extensions: [
    StarterKit,
    CodeBlockLowlight.<span class="hljs-built_in">configure</span>({
      lowlight  <span class="hljs-comment">// 代码高亮</span>
    }),
    Image,           <span class="hljs-comment">// 图片</span>
    Link,            <span class="hljs-comment">// 链接</span>
    Table,           <span class="hljs-comment">// 表格</span>
    Placeholder.<span class="hljs-built_in">configure</span>({
      placeholder: <span class="hljs-string">'开始写作...'</span>
    }),
  ],
});
</code></pre>
<p>编辑器还实现了自动保存、快捷键（Cmd+S）、图片上传（阿里云 OSS）等实用功能。</p>
<h3 data-id="heading-8">Tailwind CSS 4</h3>
<p>样式层使用最新的 Tailwind CSS 4，通过 CSS 变量实现主题切换：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#b8860b</span>;
  <span class="hljs-attr">--color-background</span>: <span class="hljs-number">#faf8f5</span>;
  <span class="hljs-attr">--color-foreground</span>: <span class="hljs-number">#1a1a1a</span>;
}

<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">'dark'</span>]</span> {
  <span class="hljs-attr">--color-primary</span>: <span class="hljs-number">#d4a537</span>;
  <span class="hljs-attr">--color-background</span>: <span class="hljs-number">#1a1a1a</span>;
  <span class="hljs-attr">--color-foreground</span>: <span class="hljs-number">#e8e8e8</span>;
}
</code></pre>
<p>配合 ThemeProvider 组件，实现了丝滑的明暗主题切换。</p>
<h2 data-id="heading-9">Ink &amp; Code 核心功能一览</h2>
<p>除了上面提到的技术架构，<a href="https://link.juejin.cn?target=https%3A%2F%2Fptclove.com%2F" target="_blank" title="https://ptclove.com/" ref="nofollow noopener noreferrer">ptclove.com</a> 还有这些核心功能：</p>
<ul>
<li><strong>AI 助手</strong>：内置 AI 聊天组件，基于 DeepSeek 实时流式响应，随时提问</li>
<li><strong>智能目录</strong>：自动从文章标题生成目录树，支持大标题折叠子标题、滚动高亮、点击跳转</li>
<li><strong>分类体系</strong>：支持树形分类结构，多层级管理文章</li>
<li><strong>文档树管理</strong>：后台采用树形文档管理，拖拽排序，所见即所得</li>
<li><strong>多用户支持</strong>：每个用户有独立主页（<code>/u/username</code>），独立分类和文章</li>
<li><strong>深色模式</strong>：跟随系统或手动切换，全站适配</li>
<li><strong>响应式设计</strong>：从手机到桌面端完美适配</li>
<li><strong>一键部署</strong>：GitHub Actions 自动构建、SSH 部署到服务器，PM2 进程管理</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>Cursor AI Skill 的价值不在于它是一个多高深的技术，而在于它提供了一种思路：<strong>让 AI 不只是回答问题，而是融入你的工作流</strong>。</p>
<p>在 Ink &amp; Code 这个项目中，AI Skill 串联了从代码提交到博客发布的完整链路。而 Next.js + Prisma + Tiptap + Tailwind 这套技术栈，则提供了足够灵活的底层能力来支撑这种自动化。</p>
<p>如果你也想体验 AI 驱动的博客写作，欢迎访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fptclove.com%2F" target="_blank" title="https://ptclove.com/" ref="nofollow noopener noreferrer">ptclove.com</a> ，也欢迎在评论区交流你的 AI Skill 实践。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android稀奇古怪DNS异常之DNS数据获取]]></title>    <link>https://juejin.cn/post/7603383059152044074</link>    <guid>https://juejin.cn/post/7603383059152044074</guid>    <pubDate>2026-02-06T09:09:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603383059152044074" data-draft-id="7603301285476188202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android稀奇古怪DNS异常之DNS数据获取"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-06T09:09:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没有了遇见"/> <meta itemprop="url" content="https://juejin.cn/user/1521379826212983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android稀奇古怪DNS异常之DNS数据获取
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379826212983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没有了遇见
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:09:11.000Z" title="Fri Feb 06 2026 09:09:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b71a09fcc8a54a0e8e1f0b68a18444bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5pyJ5LqG6YGH6KeB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973751&amp;x-signature=6FfG0n8Y0Ap8O8FjFUtGbTV7wEs%3D" alt="image.png" loading="lazy"/></p>
<p>接着处理稀奇古怪问题之DNS异常导致网络不通!!!!</p>
<p>部分用户访问不通,后台说DNS问题,这不需求就来了.要求Android 搜集DNS数据,方便后台查询.....</p>
<h2 data-id="heading-0">需求:获取DNS数据和后台相应数据</h2>
<h2 data-id="heading-1">思路</h2>
<ul>
<li>获取网络配置中的DNS配置</li>
<li>获取网络请求时的DNS/HOST/响应的数据</li>
</ul>
<h2 data-id="heading-2">1:获取网络配置的DNS数据</h2>
<p><code>注意:</code></p>
<p>需要<code>&lt;uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/&gt;</code> 权限</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 获取当前 WiFi 路由器或系统 DNS 服务器列表
 * <span class="hljs-doctag">@param</span> context Context
 * <span class="hljs-doctag">@return</span> List&lt;String&gt; DNS IP 列表
 */</span>


<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDnsServers</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: List&lt;String&gt; {
    <span class="hljs-keyword">val</span> connectivityManager = context.getSystemService(Context.CONNECTIVITY_SERVICE) <span class="hljs-keyword">as</span> ConnectivityManager
    <span class="hljs-keyword">val</span> activeNetwork = connectivityManager.activeNetwork ?: <span class="hljs-keyword">return</span> emptyList()
    <span class="hljs-keyword">val</span> linkProperties = connectivityManager.getLinkProperties(activeNetwork) ?: <span class="hljs-keyword">return</span> emptyList()

    <span class="hljs-comment">// 获取 InetAddress 列表并转换为字符串</span>
    <span class="hljs-keyword">return</span> linkProperties.dnsServers.map { formatDnsType(it)}
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">formatDnsType</span><span class="hljs-params">(addr: <span class="hljs-type">InetAddress</span>)</span></span>: String {
    <span class="hljs-keyword">val</span> type = <span class="hljs-keyword">when</span> (addr) {
        <span class="hljs-keyword">is</span> Inet4Address -&gt; <span class="hljs-string">"ipv4--&gt; "</span>
        <span class="hljs-keyword">is</span> Inet6Address -&gt; <span class="hljs-string">"ipv6--&gt; "</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"unknown--&gt; "</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-variable">$type</span>:<span class="hljs-subst">${addr.hostAddress}</span>"</span>
}
</code></pre>
<h2 data-id="heading-3">2:获取网络请求的响应以及DNS数据</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">DnsCheckCallback</span> {
    <span class="hljs-comment">/** 域名解析结果 */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDnsResolved</span><span class="hljs-params">(hostname: <span class="hljs-type">String</span>, ipList: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span>

    <span class="hljs-comment">/** HTTP 请求响应 */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onHttpResponse</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, body: <span class="hljs-type">String</span>)</span></span>

    <span class="hljs-comment">/** 请求或解析失败 */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(t: <span class="hljs-type">Throwable</span>)</span></span>
}

<span class="hljs-comment">/**
 * 使用系统 DNS 请求指定 URL 并通过回调返回 DNS 和 HTTP 信息
 * <span class="hljs-doctag">@param</span> url 请求的完整 URL，例如 https://xxx.xx.com  测试的域名
 * <span class="hljs-doctag">@param</span> callback 回调
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkDns</span><span class="hljs-params">(
    url: <span class="hljs-type">String</span>,
    callback: <span class="hljs-type">DnsCheckCallback</span>
)</span></span> {
    <span class="hljs-keyword">val</span> client = OkHttpClient.Builder()
        .dns(<span class="hljs-keyword">object</span> : Dns {
            <span class="hljs-meta">@Throws(UnknownHostException::class)</span>
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">lookup</span><span class="hljs-params">(hostname: <span class="hljs-type">String</span>)</span></span>: List&lt;InetAddress&gt; {
                <span class="hljs-keyword">val</span> addresses = Dns.SYSTEM.lookup(hostname)

                <span class="hljs-comment">// 回调 DNS 解析结果</span>
                <span class="hljs-keyword">val</span> ipList = addresses.map { hostname+<span class="hljs-string">" ---&gt; "</span>+formatDnsType(it) }
                callback.onDnsResolved(hostname, ipList)

                <span class="hljs-keyword">return</span> addresses
            }
        })
        .build()

    <span class="hljs-keyword">val</span> request = Request.Builder()
        .url(url)
        .<span class="hljs-keyword">get</span>()
        .build()

    client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, e: <span class="hljs-type">IOException</span>)</span></span> {
            callback.onFailure(e)
        }

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> body = response.body?.string() ?: <span class="hljs-string">""</span>
                callback.onHttpResponse(response.code, body)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                callback.onFailure(e)
            }
        }
    })
}
</code></pre>
<h2 data-id="heading-4">3: 获取工具</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">import</span> android.content.Context
<span class="hljs-keyword">import</span> android.net.ConnectivityManager
<span class="hljs-keyword">import</span> android.net.wifi.WifiManager
<span class="hljs-keyword">import</span> android.os.Build
<span class="hljs-keyword">import</span> android.util.Log
<span class="hljs-keyword">import</span> okhttp3.*
<span class="hljs-keyword">import</span> java.io.IOException
<span class="hljs-keyword">import</span> java.net.Inet4Address
<span class="hljs-keyword">import</span> java.net.Inet6Address
<span class="hljs-keyword">import</span> java.net.InetAddress
<span class="hljs-keyword">import</span> java.net.UnknownHostException

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@Author</span>: wkq
 * <span class="hljs-doctag">@Time</span>: 2026/2/6 12:15
 * <span class="hljs-doctag">@Desc</span>: 使用 OkHttp 请求指定 URL 并通过回调返回 DNS 和 HTTP 信息（简化版，只用系统 DNS）
 */</span>
<span class="hljs-keyword">object</span> DnsCheckUtil {

    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DnsCheckCallback</span> {
        <span class="hljs-comment">/** 域名解析结果 */</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDnsResolved</span><span class="hljs-params">(hostname: <span class="hljs-type">String</span>, ipList: <span class="hljs-type">List</span>&lt;<span class="hljs-type">String</span>&gt;)</span></span>

        <span class="hljs-comment">/** HTTP 请求响应 */</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onHttpResponse</span><span class="hljs-params">(code: <span class="hljs-type">Int</span>, body: <span class="hljs-type">String</span>)</span></span>

        <span class="hljs-comment">/** 请求或解析失败 */</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(t: <span class="hljs-type">Throwable</span>)</span></span>
    }

    <span class="hljs-comment">/**
     * 使用系统 DNS 请求指定 URL 并通过回调返回 DNS 和 HTTP 信息
     * <span class="hljs-doctag">@param</span> url 请求的完整 URL，例如
     * <span class="hljs-doctag">@param</span> callback 回调
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">checkDns</span><span class="hljs-params">(
        url: <span class="hljs-type">String</span>,
        callback: <span class="hljs-type">DnsCheckCallback</span>
    )</span></span> {
        <span class="hljs-keyword">val</span> client = OkHttpClient.Builder()
            .dns(<span class="hljs-keyword">object</span> : Dns {
                <span class="hljs-meta">@Throws(UnknownHostException::class)</span>
                <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">lookup</span><span class="hljs-params">(hostname: <span class="hljs-type">String</span>)</span></span>: List&lt;InetAddress&gt; {
                    <span class="hljs-keyword">val</span> addresses = Dns.SYSTEM.lookup(hostname)

                    <span class="hljs-comment">// 回调 DNS 解析结果</span>
                    <span class="hljs-keyword">val</span> ipList = addresses.map { hostname+<span class="hljs-string">" ---&gt; "</span>+formatDnsType(it) }
                    callback.onDnsResolved(hostname, ipList)

                    <span class="hljs-keyword">return</span> addresses
                }
            })
            .build()

        <span class="hljs-keyword">val</span> request = Request.Builder()
            .url(url)
            .<span class="hljs-keyword">get</span>()
            .build()

        client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, e: <span class="hljs-type">IOException</span>)</span></span> {
                callback.onFailure(e)
            }

            <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">val</span> body = response.body?.string() ?: <span class="hljs-string">""</span>
                    callback.onHttpResponse(response.code, body)
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    callback.onFailure(e)
                }
            }
        })
    }


    <span class="hljs-comment">/**
     * 获取当前 WiFi 路由器或系统 DNS 服务器列表
     * <span class="hljs-doctag">@param</span> context Context
     * <span class="hljs-doctag">@return</span> List&lt;String&gt; DNS IP 列表
     */</span>


    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDnsServers</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: List&lt;String&gt; {
        <span class="hljs-keyword">val</span> connectivityManager = context.getSystemService(Context.CONNECTIVITY_SERVICE) <span class="hljs-keyword">as</span> ConnectivityManager
        <span class="hljs-keyword">val</span> activeNetwork = connectivityManager.activeNetwork ?: <span class="hljs-keyword">return</span> emptyList()
        <span class="hljs-keyword">val</span> linkProperties = connectivityManager.getLinkProperties(activeNetwork) ?: <span class="hljs-keyword">return</span> emptyList()

        <span class="hljs-comment">// 获取 InetAddress 列表并转换为字符串</span>
        <span class="hljs-keyword">return</span> linkProperties.dnsServers.map { formatDnsType(it)}
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">formatDnsType</span><span class="hljs-params">(addr: <span class="hljs-type">InetAddress</span>)</span></span>: String {
        <span class="hljs-keyword">val</span> type = <span class="hljs-keyword">when</span> (addr) {
            <span class="hljs-keyword">is</span> Inet4Address -&gt; <span class="hljs-string">"ipv4--&gt; "</span>
            <span class="hljs-keyword">is</span> Inet6Address -&gt; <span class="hljs-string">"ipv6--&gt; "</span>
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"unknown--&gt; "</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-variable">$type</span>:<span class="hljs-subst">${addr.hostAddress}</span>"</span>
    }

}
</code></pre>
<h2 data-id="heading-5">总结</h2>
<p>DNS污染/VPN/运营商拉黑都会导致域名指向不对,这种问题需要前后端配合处理,暂时只进展到了DNS数据查询,后续有处理的相关进展会伴随更新</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MaxCompute Autoscale自动弹性功能上线：资源随需而动，成本精打细算]]></title>    <link>https://juejin.cn/post/7603308967125942272</link>    <guid>https://juejin.cn/post/7603308967125942272</guid>    <pubDate>2026-02-06T09:12:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603308967125942272" data-draft-id="7603355275257708584" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MaxCompute Autoscale自动弹性功能上线：资源随需而动，成本精打细算"/> <meta itemprop="keywords" content="大数据,人工智能"/> <meta itemprop="datePublished" content="2026-02-06T09:12:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MaxCompute Autoscale自动弹性功能上线：资源随需而动，成本精打细算
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:12:09.000Z" title="Fri Feb 06 2026 09:12:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在云原生数据仓库的演进过程中，如何在<strong>保障作业SLA</strong>与<strong>优化资源成本</strong>之间取得平衡，始终是用户关注的核心问题。传统静态资源配置模式难以应对现代数据作业中普遍存在的<strong>突发性、非周期性、不可预测性</strong>负载特征。</p>
<p>MaxCompute 全新推出 <strong>自动弹性（Autoscale）功能</strong>——基于实时负载感知的秒级弹性扩缩容机制，结合按量计费模型，实现计算资源供给与业务需求的动态对齐。</p>
<h2 data-id="heading-0">一、背景：从静态预留到智能弹性</h2>
<p>过去，MaxCompute 用户主要依赖 <strong>包年包月预留资源</strong>：稳定可靠，但缺乏灵活性；面对突发需求，只能提前大量采购，造成大量闲置。</p>
<p>后来，基于推出的<strong>弹性预留</strong> 模式：用户可自定义时间计划和扩缩规则，适用于有明显周期性波动的场景（如每天凌晨跑批）。但这也要求用户具备较强的运维能力，且难以应对突发或不规则的负载变化。</p>
<p>现在，MaxCompute 全新推出 <strong>自动弹性（Autoscale）功能</strong> —— 通过系统的负载感知与调度策略，实现“无感扩缩”，填补了<strong>非稳态、高动态</strong>场景下的资源管理空白，真正做到“用多少，付多少”。</p>





























<table><thead><tr><th><strong>资源类型</strong></th><th><strong>扩缩机制</strong></th><th><strong>计费模型</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>包年包月预留</td><td>固定CU，长期持有</td><td>为购买量付费</td><td>负载稳定、无波动</td></tr><tr><td>弹性预留</td><td>用户自定义时间/CU规则扩缩</td><td>按用户分时配置的固定CU量计费</td><td>周期性波动、峰谷可预测、用户有精细化配置经验</td></tr><tr><td><strong>自动弹性</strong></td><td><strong>系统实时感知负载后自动扩缩容</strong></td><td><strong>按实际用量和使用时长付费</strong></td><td><strong>波动频繁、不可预测，追求成本效率</strong></td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cbbfef6d0ef43208687820584bf3eb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973929&amp;x-signature=YN8OMbza5jn8v5DuTU0UMJ6gFCg%3D" alt="5eecdaf48460cde50899366ff2de297027d88596f71c45df75b8339e1c4c2483d73fcbd75708105f8d68742cd653602a15464a86392b1bf5bbb40cca91051d59fb518341bbcfc52040cf883a4fe865182fc27d1bdab16641220e3dd3b60b5d1e.png" loading="lazy"/></p>
<p>三者可组合使用：以包年包月为基础保障，弹性预留应对可预测高峰，自动弹性兜底突发流量，构建MaxCompute Serverless 弹性资源体系。</p>
<h2 data-id="heading-1">二、自动弹性核心优势</h2>
<h3 data-id="heading-2">1. 开箱即用，低运维负担</h3>
<ul>
<li>
<p>用户只需设置 <code>AutoscaleLimitCU</code>（自动弹性上限），系统自动完成扩缩决策；</p>
</li>
<li>
<p>支持一级/二级 Quota 粒度配置，二级 Quota 共享一级自动弹性CU资源池，自动分配。</p>
</li>
</ul>
<h3 data-id="heading-3">2. 按需供给，按量计费</h3>
<ul>
<li>
<p>仅对实际使用的自动弹性CU（<code>AutoscaleUsedCU</code>）用量按秒计量，按小时统计出账；</p>
</li>
<li>
<p>单价：<strong>0.36元 / (CU·时)</strong>，无需预付，无最低消费。</p>
</li>
</ul>
<h3 data-id="heading-4">3. 秒级响应，保障作业SLA</h3>
<ul>
<li>
<p>相比小时级调度窗口，自动弹性支持<strong>秒级资源调整</strong>，有效应对突发作业排队；</p>
</li>
<li>
<p>后端基于历史负载与预测模型优化库存保障和资源调度，提升弹性资源可用性。</p>
</li>
</ul>
<p>⚠️ 注意：自动弹性依赖实时资源库存，无法100%保证极端突发场景下的资源可达性。对于强SLA要求场景（如大促），建议<strong>同步配置弹性预留</strong>作为资源兜底。</p>
<h2 data-id="heading-5">三、真实场景案例</h2>
<h3 data-id="heading-6">场景一：突发业务高峰下的作业SLA保障</h3>
<p>某电商平台客户，日常使用 <strong>50 CU 包年包月Quota</strong>，足以支撑日常数据加工分析任务。但每逢大促，作业量激增3倍，原有资源严重不足，作业排队超2小时，严重影响数据产出时效。</p>
<p>客户曾评估扩容包年包月Quota至150 CU，但大促仅占全年不到20%的时间，全年多花<strong>约18万元</strong>，长期持有高配资源性价比极低。</p>
<p><strong>启用 Autoscale 后</strong>：</p>
<ul>
<li>
<p>设置 自动弹性上限 AutoscaleLimit 为 <strong>100 CU</strong>（即最多可额外使用100 CU自动弹性CU）</p>
</li>
<li>
<p>系统在检测到作业队列积压后，<strong>秒级自动扩容，</strong> 动态将可用CU提升至140CU（50 CU包年包月 + 90CU自动弹性），作业完成时间恢复至30分钟内，满足业务SLA要求；</p>
</li>
</ul>
<p>“以前不敢做大促实时分析，现在敢了，而且花得更少！” —— 客户反馈</p>
<h3 data-id="heading-7">场景二：替代分时弹性，实现降本增效</h3>
<p>某金融客户每日需执行大量 T+1 批处理任务，用于全量交易对账、监管报送数据聚合等，长期采用 <strong>分时弹性预留策略</strong>：每日22:00–6:00 时段将 Quota 从 包月预留 50 CU 扩容至 100 CU。</p>
<p>但时常因业务活动、节假日调休、系统割接活上游产出延迟等，常出现“资源空转”或“容量不足”并存的问题，运维团队需频繁调整弹性计划，但人工干预滞后性强，且易出错。</p>
<p><strong>切换至 Autoscale 后</strong>：</p>
<ul>
<li>
<p>设置自动弹性上限 AutoscaleLimitCU 为 <strong>60 CU</strong> ，允许系统在 50 – 110 CU 范围内动态扩缩；</p>
</li>
<li>
<p>系统根据实际作业队列动态调整弹性CU，夜间平均仅使用 <strong>30 CU</strong> 自动弹性资源；</p>
</li>
<li>
<p>月度弹性费用从分时弹性CU <strong>3780元</strong> （50CU *0.315元/CU*8小时*30天）降至 <strong>2592元</strong>（30CU *0.36元/CU*小时*8小时*30天），<strong>降本32%</strong>，且作业完成时间更稳定。</p>
</li>
</ul>
<p>“不用再熬夜调配置了，系统自己会‘看饭下菜’！” —— 运维工程师点赞</p>
<h2 data-id="heading-8">四、快速启用</h2>
<h3 data-id="heading-9">概念说明</h3>
<p>自动弹性上限CU（AutoscalelimitCU）：指用户为Quota设置的弹性CU资源总上限。当该值 &gt; 0 时，则为启用自动弹性功能，系统可在此上限范围内按实际负载自动扩缩容。自动弹性使用CU（AutoscaleUsedCU）：指在启用自动弹性后，Quota中实际消耗的自动弹性CU资源使用量。系统将根据作业负载自动调整CU用量，并按此实际CU使用量计费。</p>
<h3 data-id="heading-10">使用须知</h3>
<p><strong>前提条件</strong>：必须已购买<strong>包年包月计算资源Quota</strong>；<strong>计费单位</strong>：CU·时，按秒采样、按小时聚合；<strong>自动弹性CU价格</strong>：0.36元 /(CU*时)；<strong>计费公式：</strong> 每小时的费用 = 该小时自动弹性CU用量（单位：CU*时）× 自动弹性CU价格。</p>
<h3 data-id="heading-11">谁适合用自动弹性？</h3>
<p>✅ <strong>业务负载波动频繁、难以预测</strong>（如营销活动、临时分析）
✅ <strong>希望保障作业性能，同时避免资源浪费</strong>
✅ <strong>已有包年包月Quota，想进一步补充/优化弹性资源</strong></p>
<p>登录 MaxCompute 控制台 → Quota管理 → 编辑基础配置 → 设置 <strong>AutoscaleLimitCU</strong></p>
<p>即可开启智能弹性之旅！</p>
<p>更多说明文档请参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fmaxcompute%2Fuse-cases%2Fauto-elastic-usage-best-practices%3Fspm%3Da2c4g.11174283.help-menu-search-27797.d_0" target="_blank" title="https://help.aliyun.com/zh/maxcompute/use-cases/auto-elastic-usage-best-practices?spm=a2c4g.11174283.help-menu-search-27797.d_0" ref="nofollow noopener noreferrer">help.aliyun.com/zh/maxcompu…</a></p>
<h2 data-id="heading-12">五、总结</h2>
<p>自动弹性不是简单的“资源扩容”，而是 MaxCompute 在<strong>智能调度、成本治理、SLA保障</strong>三位一体方向上的重要演进。它让资源管理从“静态规划”走向“动态协同”，真正实现“<strong>用多少，付多少；要多少，给多少</strong>”。</p>
<p>欢迎您的试用并反馈您的生产实践。我们将持续优化弹性调度算法与资源保障能力，助力企业构建更高效、更经济的云原生数据基础设施。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI时代的开发者，需要的是“判断空间”]]></title>    <link>https://juejin.cn/post/7603309951227461682</link>    <guid>https://juejin.cn/post/7603309951227461682</guid>    <pubDate>2026-02-06T09:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603309951227461682" data-draft-id="7603359026711314442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI时代的开发者，需要的是“判断空间”"/> <meta itemprop="keywords" content="后端,前端,程序员"/> <meta itemprop="datePublished" content="2026-02-06T09:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东东拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/3808364011728392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI时代的开发者，需要的是“判断空间”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364011728392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东东拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:13:59.000Z" title="Fri Feb 06 2026 09:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">引言</h3>
<p>在AI进展突飞猛进的今天，我的工作方式已经悄悄发生了许多改变。</p>
<p>比如，我花在“写代码”上的时间在变的越来越少，花在“判断方向、判断结果、判断是否符合预期”上的时间，却在明显变多。</p>
<p>代码本身，已经不再是最消耗精力的部分。</p>
<p>真正让人感到疲惫的，是不断地确认：</p>
<p>AI 给出的东西，是不是我想要的那个方向。</p>
<p>也正是在这样的工作状态下，我开始重新审视一些以前习以为常的工具——</p>
<p>比如，一台每天陪我坐在桌子前的显示器。</p>
<h3 data-id="heading-1">当“看”成为主要工作，屏幕就不再是背景</h3>
<p>在 AI 参与开发之后，我花在“看”上的时间，远比以前多。</p>
<p>看模型生成的代码结构是否合理，看逻辑有没有在某个分支上走偏，看它是不是在解决我真正想解决的问题。</p>
<p>在这个过程中，屏幕不再只是一个承载代码的背景，而是我理解信息的第一道过滤器。</p>
<p>如果屏幕本身在颜色、反光、层级上给我制造干扰，那判断就会变得更慢，也更容易出错。</p>
<p>这次我体验到了BenQ RD280UG这款产品，就是一台专为开发者设计的显示器：</p>
<p>3:2 的屏幕比例，把更多空间留给阅读和判断；针对深色、浅色 IDE 的专业编程模式，让代码层级更容易被识别；这次还升级了编程-彩纸模式和120Hz的高刷，让反复查看、对照不那么疲惫；</p>
<p>这些特性在 AI 时代，当“判断”成为我们的主要工作时，我发现它们开始变得很重要。</p>
<h3 data-id="heading-2">编程模式，其实是为“判断”服务的</h3>
<p>BenQ RD280UG提供了编程专用的色彩模式，针对高频使用的Idea、Vs Code等IDE主题环境，提供了深色、亮色两种主题模式。</p>
<p>在编程模式下，通过智能优化语法高亮，对多种代码元素进行色温，色彩，对比度的专项优化，极大的凸现了代码字符清晰度，提高代码区分度。</p>
<p>在面对 AI 生成的代码时，让不同层级的信息，在第一眼就能被区分出来，在当下的开发模式下，正在变得越来越重要。</p>
<p>我现在还不能完全信任AI的代码，因此需要快速判断：</p>
<ul>
<li>哪一段是关键逻辑</li>
<li>哪些地方需要我进一步介入</li>
</ul>
<p>也正是在这样的工作状态下，我重新理解了所谓的“编程模式”。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0aeee4b52aa451ba53a614fbdff054e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=Cqj5KTI5ldekYKWcjCK2LAHBAxI%3D" alt="2E0ED2A5-C2E1-4252-AD5E-72A871182CF6.jpg" loading="lazy"/>
(左侧是开启深色主题，右侧是不开深色主题)</p>
<p>当屏幕能够针对深色、浅色 IDE 做出适配，强化语义和结构差异时，判断这件事本身，就会变得更直接一些。</p>
<p>不是更快，而是更少绕路。</p>
<p>在AI时代，分屏工作已经成为了常态。</p>
<p>或许是一边看着文档，一边用大模型进行提问和总结，也可能是一边开着IDE开发，另一侧打开系统实时调试。</p>
<p>BenQ RD280UG采用3:2的屏幕比例，相比传统的16:9比例，提供了更大的垂直空间，能够在同一时间多显示约20%的内容， 非常适合编程和代码阅读。据我实际计算，16:9在我正常的工作模式下，可以展示40行代码，但是使用RD280UG可以展示50行。</p>
<p>不但如此，还提供了双色彩显示增强版，在分屏模式下，可以单独设置显示模式。</p>
<p>比如我在IDEA里面设置编码模式，而在浏览器里面设置M-Book模式，无论你的注意力在哪，都能让你感受到最好的体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d5d42913bb644e6beb5b967e545ed28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=CKdGrolKElBu3fXPeGXgye%2Bjrh4%3D" alt="3C2B0B4A-63DC-47BF-AD9C-C42C186E20F3.jpg" loading="lazy"/>
(左侧是开启电子书模式，右侧是深色编程模式)</p>
<h3 data-id="heading-3">彩纸模式</h3>
<p>RD280UG 这次新升级了一个编程模式——彩纸模式。</p>
<p>光看名字，我一开始把它理解成了某一种护眼模式，但是这一段时间体验下来，却成了我最常用的设置。</p>
<p>深色编程模式固然适合编码，可我们并不是所有时间，我都处在高强度判断和输出的状态。</p>
<p>有些时候，我只是想慢慢读一份技术规范，或者AI或者技术相关的文档；</p>
<p>也有些时候，是在晚上翻开一本电子书。</p>
<p>这类阅读，和写代码是完全不同的节奏。</p>
<p>如果屏幕依然保持着高对比、强刺激的显示风格，大脑会不自觉地被推向“赶紧处理完”的状态。</p>
<p>当我想慢下来看点东西的时候，我反而会切到彩纸模式。</p>
<p>RD280UG会自动调节色温和背景亮度，优化字符和底色的对比关系，最终让我有了一种更接近纸张阅读的观感。</p>
<p>很抱歉这里无法放出一个实际的效果图，相机拍出来的效果无法和眼睛相比，但是眼睛是不会骗人的，这里只有亲身体会才能看出区别。</p>
<p>但在需要耐心消化信息、允许自己慢下来阅读的时候，</p>
<p>彩纸模式能帮我完成一次状态切换——</p>
<p>从“马上判断”，切换到“先理解再说”。</p>
<p>而在 AI 不断生成内容的当下，从这种从输出节奏中抽离出来，帮助自己重新回到阅读本身的能力，不应该被忽视。</p>
<h3 data-id="heading-4">120Hz 高刷，是让反复确认没那么累</h3>
<p>这次升级到 120Hz，我的感受并不激烈。</p>
<p>它不会让我在某个瞬间意识到“升级了”，</p>
<p>但在长时间反复确认的过程中，它的存在感会慢慢显现出来。</p>
<p>比如这一次AI重构代码，一个文件有十几处改动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68f684e349474e21a392cc3a92088e7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=30NUQZArnDN5mRn8mBtyrla%2Bhuc%3D" alt="5CABD2D3-078F-4928-BFFB-482EC8D60531.png" loading="lazy"/>
在滚动长段代码、频繁跳转文件、来回比对结果时，120Hz 的高刷新率能让页面滚动和窗口拖拽的动画极其流畅，几乎没有拖影或跳跃感。</p>
<p>传统的60Hz屏幕在显示快速运动的画面时，可能会产生微小的闪烁或模糊，长时间观看容易导致眼睛疲劳、干涩甚至头痛。</p>
<p>这种流畅的视觉感受，能够有效缓解视觉压力，对于需要长时间面对屏幕的程序员至关重要。</p>
<h2 data-id="heading-5">保护双眼</h2>
<p>对做过飞秒手术的我来说，我对屏幕非常敏感。</p>
<p>白天还好，一旦到了晚上，尤其是只剩屏幕亮着的时候，</p>
<p>眼睛很容易开始不舒服——酸、胀、干，甚至会不自觉地流泪。</p>
<p>这种感觉更像是眼睛在提醒我：它已经扛不住这种夜晚的刺激了。</p>
<p>也正因为这样，我对显示器的护眼设计，其实一直很在意。</p>
<p>不是为了参数，而是为了能不能多坐一会。</p>
<p>RD 280UG在护眼这件事上，算是长期投入的一条线：无频闪、硬件级低蓝光、抗反射这些设计，再加上多项莱茵认证和智慧调光的专利。</p>
<p>就拿抗反射来说，是展示屏幕实力的重要体现。</p>
<p>BenQ RD280UG 在这点上做到了极致，面板全部覆盖了抗反射涂层，并且通过了TUV莱茵抗反射认证。</p>
<p>无论是白天窗外刺眼的阳光，还是深夜桌面上的台灯，屏幕就像是可以“吸光”一般，把影响降到最低，让你几乎看不到反射的东西。</p>
<p>即使我拿着手电去直接照射屏幕，屏幕也几乎没有影响，而我的Macbook Pro就像镜子一般，被照射的地方什么也看不到了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da74725ef3f446d8b1fe090873bdc1ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=aN%2Fju2xYy5nHyCOIQwqXisWw3ms%3D" alt="6A389846-A7BE-4AD7-B3A3-E16AA8C4F3DD.jpg" loading="lazy"/>
它们更多是在你意识不到的时候，默默把对你的影响降低。</p>
<p>我印象最深的，是它的夜间保护模式，也就是“猫头鹰模式”。</p>
<p>这个模式听名字就知道，很明显是为夜晚使用设计的。</p>
<p>毕竟只有等孩子睡了的那段时间，才是真正属于自己的。</p>
<p>在环境光非常低的情况下，它会通过固件调节，把亮度和色彩压到一个非常克制的水平。</p>
<p>即使深夜长时间看屏幕，眼睛不再需要在极暗和极亮之间反复适应。</p>
<p>对我来说，最直观的变化就是：</p>
<p>深夜工作时，眼睛干涩的情况明显缓解了，不会那么快产生“必须停下来”的信号。</p>
<p>另外一个很实用的细节是，当前是否开启了低蓝光、夜间模式，都会直接显示在屏幕下方。不用反复进菜单确认，这一点在晚上其实特别省心。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4d9ab2c78f9435aa7fc194dfc2d3578~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=d43rSnFfnZus3Co5mjNRjDv4F0I%3D" alt="DB4C3D9C-5607-4223-8025-F98C7DCAB7EF.jpg" loading="lazy"/></p>
<h3 data-id="heading-6">让屏幕设置更顺手</h3>
<p>说到调节显示器，很多人应该都有类似的经历：</p>
<p>为了调亮度、换模式，在显示器背后摸来摸去，一不小心还会按错键。</p>
<p>我以前一直觉得这件事挺反直觉的——</p>
<p>明明是很日常的操作，却非要通过实体按键完成。</p>
<p>RD 系列在软硬件结合这件事上，给了一个完美答案。</p>
<p>通过配套的 Display Pilot 2，很多原本需要在屏幕上折腾半天的设置，</p>
<p>现在都可以在软件里直接完成。</p>
<p>像显示模式切换、快捷键控制、桌面分区这些常用功能，都能集中在一个地方调好。</p>
<p>甚至可以按照自己的节奏，给不同时间段设定不同的工作流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a253c09756b446ba39ccd7d2ebe66a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=j7YgfVy11rRLkDqcW4cLoSFE7ys%3D" alt="D924443D-DBA6-46E7-A3BD-8B21509E9EFD.png" loading="lazy"/>
我现在觉着最有用的工作流，是晚上十点半启动，把屏幕的色彩模式调成电子书模式。</p>
<p>屏幕显示成电子书模式后，无论我是在写代码，还是在打游戏或者刷视频，都能够立即把我从娱乐中打断，告诉自己：你现在该睡觉了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/072bbbcf1fff4f16a3dcfb2c5d3ecb27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Lic5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974039&amp;x-signature=xpKJK6YBvz863AKbYR25i14k2a8%3D" alt="AF6EAFEA-25B3-4CC9-BB5F-DEBA8BB40794.jpg" loading="lazy"/>
当然还有很多种玩法，比如不同应用设置不同的颜色模式，还能够设置模式的不同参数，便捷的分屏操作等。</p>
<p>什么时候专心工作，什么时候读东西，什么时候只是随便看看。</p>
<p>这些功能本身解决我一个很现实的问题——</p>
<p>不要在已经很消耗注意力的工作里，再把精力浪费在调屏幕这件事上。</p>
<h3 data-id="heading-7">体验总结</h3>
<p>这段时间用下来，我对 RD280UG 的感受，其实很简单：</p>
<p>它没有试图让我更兴奋，而是让我更容易坐下来。</p>
<p>在 AI 逐渐接管“写”的当下，开发者真正消耗精力的，变成了判断、理解和反复确认。</p>
<p>当屏幕比例、编程模式、阅读模式和护眼设计都围绕这些状态展开时，工具本身就不再抢注意力，而是慢慢退到背后。</p>
<p>拥有一台好的设备，不只是让事情变快，而是让你在需要慢下来思考的时候，依然愿意停留在那里。</p>
<p>也许，这才是我现在最需要的生产力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不止是写代码｜如何用 TRAE 进行复杂数据分析]]></title>    <link>https://juejin.cn/post/7603389033042378806</link>    <guid>https://juejin.cn/post/7603389033042378806</guid>    <pubDate>2026-02-06T09:20:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603389033042378806" data-draft-id="7603314759758741523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不止是写代码｜如何用 TRAE 进行复杂数据分析"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-02-06T09:20:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TRAE_ai"/> <meta itemprop="url" content="https://juejin.cn/user/3048259110571032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不止是写代码｜如何用 TRAE 进行复杂数据分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048259110571032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TRAE_ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:20:06.000Z" title="Fri Feb 06 2026 09:20:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2614d47a9d2d4cc596e4bc73b405dd31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=1WIZxUdEAAT4RmoPdkNdtDrC7Ro%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>本文作者：杨辉，TRAE 战略分析师</p>
</blockquote>
<p>本文来自 TRAE 团队的战略分析同学，他将从“什么是数据分析”以及“数据分析的常见痛点”这两个基本问题出发，结合两个真实数据分析场景，带大家实际操作如何使用 IDE 进行数据分析。让更多的非开发背景的同学也能轻松应对复杂的数据分析任务。</p>
<blockquote>
<p>本文实践操作版本：TRAE 中国版</p>
<p>模型选择：Auto 模式</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ed0f9030e164d7a97380a8531e867db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=0oYW9QTgzcg8LFSYvyB%2BYpS8lZA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>什么是数据分析？</strong></h2>
<p>数据分析是指通过<strong>收集、清洗、整理、分析和解读数据，提取有价值信息、挖掘数据规律</strong>，从而为决策提供依据的过程。它核心价值在于<strong>将零散的数据转化为可落地的洞察</strong>，助力不同领域解决问题、优化流程、提升效率。</p>
<p>在众多职业（例如咨询、金融、互联网）场景中，数据分析都是不可或缺的核心能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a826e4c238644d50a8e62c3144dbd868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=oAyyplziHav44VOQbFrQ5TQ7%2BGg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>数据分析常见痛点</strong></h2>
<p>在数据分析工具发展的早期阶段，<strong>Excel</strong> 是绝大多数从业者的首选工具。它<strong>操作门槛低、功能全面</strong>，既能完成<strong>数据的录入、清洗和计算</strong>，也能通过<strong>数据透视表快速汇总分析数据</strong> <strong>，还支持柱状图、折线图、饼图等多种图表制作</strong>，将复杂的数据结果可视化呈现，满足了日常工作中基础的数据分析需求。</p>
<p>对于简单的数据汇总（数据量级 &lt; 1 万行），Excel 通常较为流畅，操作响应秒级，但是当数据量级超过 1 万行甚至 10 万行时，Excel 开始变慢，<strong>筛选、排序、数据透视表等操作耗时延长（秒到分钟级）</strong> 。当表格里有大量<em><strong>VLOOKUP</strong></em>、<em><strong>SUMIFS</strong></em>、数组公式，或是跨表引用、嵌套函数时，甚至<strong>出现文件崩溃</strong>的情况，通常需要关闭自动计算（改为手动计算），并且频繁保存，否则文件崩溃会导致几个小时的工作量白费。</p>
<p>数据分析本是一项对技术能力有较高要求的专业工作，但在 AI 编程技术的赋能下，非技术背景的从业者也能借助 <strong>AI IDE</strong> 高效完成从数据处理、深度分析到可视化呈现的全流程，彻底突破 Excel 在复杂场景下的应用瓶颈。</p>
<p>例如，用户无需再记忆繁杂的公式或代码语法，只需用自然语言描述分析需求，AI 就能自动拆解任务、生成代码并输出精准结果。无论是基础的数据清洗（如读取 CSV 文件并处理重复值）、业务指标计算（如按区域汇总销售额），还是更复杂的可视化呈现（如用折线图展示月度趋势）与进阶的预测分析（如通过时间序列算法预测未来销量），都能通过简单的自然语言指令快速实现——而在过去，这些能力对非技术人员而言几乎是难以企及的。</p>
<blockquote>
<p>一言以蔽之，AI 让数据分析告别 “专业壁垒”，成为所有非专业人员都能零门槛上手的实用工具。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0bb89117ab74efbbd5e3ca1cd7bca46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=kUb1zA0MmbnXfNtq9xGii3iU81s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>为什么用 TRAE 做数据分析</strong></h2>
<p>我们把 Excel、ChatGPT、TRAE IDE 基于数据分析的场景进行了多维度对比，可以发现 IDE <strong>在效率、适配性与智能化上全面超越 Excel 与 Chatbot（例如 ChatGPT）：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d87ed302aa446daaa4c2e7f7898def~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=tBPHeJ2LSFjdETLEuuuvwC3Cj9M%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3"><strong>和 Excel 相比</strong></h3>
<ul>
<li>
<p><strong>性能无上限：</strong> 轻松驾驭 10 万行甚至百万行数据，彻底告别 Excel 处理大数据时的卡顿、假死与崩溃风险。</p>
</li>
<li>
<p><strong>零代码分析范式：</strong> 告别复杂的 <em><strong>VLOOKUP</strong></em>、<em><strong>SUMIFS</strong></em> 嵌套或 VBA 脚本。通过自然语言指令即可驱动分析，让非技术人员也能完成高阶统计。</p>
</li>
<li>
<p><strong>端到端流程自动化：</strong> 实现从<strong>原始清洗、多维分析到可视化呈现</strong>的一键式串联，将原本碎片化的操作转化为自动化的数据流水线。</p>
</li>
<li>
<p><strong>逻辑沉淀：</strong> 分析过程不再是不可逆的手动点击，而是自动生成<strong>可复用的分析脚本</strong>。今年的分析模型，明年新数据只需一键运行即可复用。</p>
</li>
</ul>
<h3 data-id="heading-4"><strong>和 ChatBot 类型的产品相比</strong></h3>
<ul>
<li>
<p><strong>操作便捷灵活：</strong> 原生支持超大文件及多个分散文件的关联处理，无需手动切分或反复上传，直接在本地工作区起步。</p>
</li>
<li>
<p><strong>项目理解满分：</strong> 具备项目级上下文理解能力，深度关联历史分析逻辑与业务标签，避免了 Chatbot 常见的重复沟通与上下文断裂。</p>
</li>
<li>
<p><strong>中间逻辑可追溯、可追问：</strong> 拒绝“结果黑盒”，你可以针对分析过程中的<strong>任何中间步骤进行追问和校验</strong>（如：“为什么这么过滤？”），确保逻辑百分之百准确。</p>
</li>
<li>
<p><strong>分析产出持久化：</strong> 支持将图表与分析结果直接转化为<strong>多格式持久化文件</strong>。这种“产出即资产”的能力，为深度分析与跨工具协作提供了坚实的工程基础。</p>
</li>
<li>
<p><strong>多工具协同执行：</strong> 凭借智能推理与多工具协同，不仅精准识别需求，更能自动配置环境并执行代码，实现真正闭环的 AI 分析体验。</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64c9db9b23be41e6b11e55dab085fe57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=6uFJV3CtxX79FJF1wW7ZIfwDxZk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>实操</strong></h2>
<p>Stack Overflow 开发者调研是一份面向全球开发者的问卷报告，调研当前开发领域的技术趋势与核心痛点等。他们每年会将源数据发布在其官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsurvey.stackoverflow.co%2F" target="_blank" title="https://survey.stackoverflow.co/" ref="nofollow noopener noreferrer">survey.stackoverflow.co/</a></p>
<p>本教程以 Stack Overflow 2025 年开发者调研数据为例，演示如何用 TRAE 完成全流程数据分析。</p>
<h3 data-id="heading-6"><strong>工具安装与数据准备</strong></h3>
<ol>
<li>
<p><strong>下载安装 TRAE ：</strong> 访问 TRAE 官网（<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.trae.com.cn%25EF%25BC%2589%25EF%25BC%258C%25E4%25B8%258B%25E8%25BD%25BD%25E5%25AE%2589%25E8%25A3%2585%25E5%258C%2585%25EF%25BC%258C%25E6%258C%2589%25E5%25BC%2595%25E5%25AF%25BC%25E5%25AE%258C%25E6%2588%2590%25E5%25AE%2589%25E8%25A3%2585%25EF%25BC%258C%25E7%2594%25A8%25E6%2589%258B%25E6%259C%25BA%25E5%258F%25B7%25E8%25B4%25A6%25E5%258F%25B7%25E7%2599%25BB%25E5%25BD%2595%25E5%258D%25B3%25E5%258F%25AF%25E3%2580%2582" target="_blank" title="http://www.trae.com.cn%EF%BC%89%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%EF%BC%8C%E6%8C%89%E5%BC%95%E5%AF%BC%E5%AE%8C%E6%88%90%E5%AE%89%E8%A3%85%EF%BC%8C%E7%94%A8%E6%89%8B%E6%9C%BA%E5%8F%B7%E8%B4%A6%E5%8F%B7%E7%99%BB%E5%BD%95%E5%8D%B3%E5%8F%AF%E3%80%82" ref="nofollow noopener noreferrer">www.trae.com.cn），下载安装包，按引导完成安装，用手机号账号登录即可。</a></p>
</li>
<li>
<p><strong>打开 TRAE SOLO 模式：</strong> TRAE 目前提供 SOLO 和 IDE 两种模式，本次我将选择 TRAE SOLO 模式来完成需求。</p>
</li>
</ol>
<h4 data-id="heading-7"><strong>SOLO 和 IDE 模式的区别：</strong></h4>
<ul>
<li>
<p>SOLO：AI 主导全流程，自动拆解任务、调度工具，开发者仅需提需求、审核成果</p>
</li>
<li>
<p>IDE：开发者主导，AI 提供代码补全、智能问答等辅助，保留传统开发流程，掌控感更强</p>
</li>
</ul>
<p>SOLO 有 2 个选项，分别为 SOLO Builder 和 SOLO Coder，我们本次选择 SOLO Coder，其中的 Plan 模式也为分析方案的讨论提供了很大便利。</p>
<h4 data-id="heading-8"><strong>SOLO Builder 和 SOLO Coder 的区别：</strong></h4>
<ul>
<li>
<p>SOLO Coder: 适合已有复杂项目的迭代、重构、Bug 修复，可自主规划、执行多步任务</p>
</li>
<li>
<p>SOLO Builder: 适合从 0 到 1 完整项目的快速原型验证，从需求分析到部署全流程自动化</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24dfd87d59064ff6a7fd0ca6d406b997~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=6P7Z3e7GYhJQR9fT%2BzBTNeu6%2Ba0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9"><strong>单文件数据分析场景</strong></h3>
<h4 data-id="heading-10"><strong>数据准备</strong></h4>
<p>从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsurvey.stackoverflow.co%2F" target="_blank" title="https://survey.stackoverflow.co/" ref="nofollow noopener noreferrer">survey.stackoverflow.co/</a> <strong>下载 Stack Overflow 2025 调研数据集</strong>，包含「受访者基本信息、技术使用习惯、AI 工具态度」等维度，将数据集保存至本地文件夹（例如 “StackOverflow2025” ），方便后续 TRAE 进行读取。</p>
<p>需要注意的是，要单独创建一个文件夹，将下载下来的数据集保存在这个文件夹内，而不是直接打开excel文件。</p>
<p>选择「打开项目」，找到对应文件夹打开。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95fe1e4f569e45ef994488a7e4f172bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=5BPj3KwWA8YYeygUXvMTB5z2irI%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a0fd50bbb434aa68eeddad286e133ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=01JqVfcvqb15t5GP1VrkOrPn2WM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-11"><strong>开始数据分析</strong></h4>
<p><strong>1.</strong> 直接在对话框里输入指令，<strong>指令可以简单（例如“帮我分析一下这个数据集”）</strong> ，也可以更细节具体，可以参考下方，这一步是为了让 AI 清晰自己的角色定位。</p>
<p>「我是数据分析师，需要分析Stack Overflow 2025开发者调研数据。 </p>
<p>请读取本地文件夹“StackOverflow2025”中的CSV文件，查看数据的前10行、字段列表、数据形状（行数/列数），统计各字段的缺失值数量，生成基础信息报告。 </p>
<p>注意处理中文编码问题，避免乱码。」</p>
<p><strong>2.</strong> 从官网下载的数据是 zip 文件，<strong>无需人工手动解压，</strong> AI 自己会解压并使用 Python 来读取和分析数据；大概经过 2 分钟，AI 会显示初步分析结果，例如 <strong>数据基本情况、开发者画像、AI 工具使用情况、薪资情况以及技术使用情况</strong>等多个方面</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0f5327e42284714860c827a90d49500~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=yRIDdu2kLiN1HFAgHsTS8HAL%2BXk%3D" alt="" loading="lazy"/></p>
<ol start="3">
<li>从初步的分析返回结果来看，我们可以发现一些<strong>有趣的下钻分析的维度</strong>，例如：</li>
</ol>
<p>  a. 年龄分布和薪资情况是否有关系</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b33a5902e8b54fa7b9f252217b59415c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=iKxRLAasAF45lJU4BuGsadJLx10%3D" alt="" loading="lazy"/></p>
<p>  b. 最常用的编程语言和薪资情况是否有关系</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f29edad37744030b09ccd8a95f44087~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=yxOnbMKxNhN5uVfOiWMYKYaKhQE%3D" alt="" loading="lazy"/></p>
<p>  c. 工作满意度和薪资情况是否有关系</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3d5b15528e443be925fd95a61dcfe15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=nM2jgBWFs4M%2FsLUUvVTeyw%2BRxbc%3D" alt="" loading="lazy"/></p>
<p><strong>4.</strong> 原始数据里有个字段是“国家”，因为字段较多，所以 AI 在最开始的描述性统计时没有提到，但如果期望补充更多下钻分析的维度，可以直接问 AI</p>
<p>「分析一下不同国家的薪资分布（看一下前10国家，按调研用户数量排序，薪资中位数，均值和25/75分位数，全部换算为美金）」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bf573ad448d4ab4b6d19f80d602c298~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=btRUaac%2FZW5A8QytdJsTvAj%2FmhE%3D" alt="" loading="lazy"/></p>
<p><strong>5.</strong> 可以交叉“国家”和“开发者身份”，分析薪资分布情况</p>
<p>「分析一下不同国家、不同开发者身份的薪资分布（看一下前10国家，前一下前10开发者身份，按调研用户数量排序，薪资中位数，均值和25/75分位数，全部换算为美金）」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89b68c6fc42e4f36a14f92694e3514d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=xvXXVo3loZECV7al5ey5p6k5kmM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12"><strong>生成数据分析图表</strong></h4>
<blockquote>
<p>数据分析常常需要结合图表，可以更加直观展示数据情况。</p>
</blockquote>
<p>直接在对话框里输入指令，<strong>指令可以简单（例如“帮我画一个 XX 图”）</strong> ，也可以更细节具体，可以参考下方。</p>
<p>「帮我画一个热力表，横轴是国家（按中文名称），数轴是开发者类型（简写），数值是薪资平均值」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c3591dab4604119b89ba246834d7f6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=AqhOzHcwIK9A9Q3Vc9XX5Eta898%3D" alt="" loading="lazy"/></p>
<p>「帮我画一个图，展示每个国家的25/75/中位数 薪资，只需要展示前10国家即可」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0de4f0c2a28e4397aa57edd838845dbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=ZigVH5MVgWmS2cUhVe%2FMHbHQqjI%3D" alt="" loading="lazy"/></p>
<p>「帮我画一个气泡图，横轴是薪资均值（单位是美金），数轴是每日使用过AI的占比，大小是开发者调研用户数量，展示前10国家，气泡大小适中，注意美观」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fa4ce3e77184d5ab2057b0cfcfaf296~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=x2KaWXCGG05ooc6RtP8wfyBY5wQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-13"><strong>数据分析结果导出</strong></h4>
<p>除了数据分析和画图外，我们也可以将分析结果储存为 <strong>CSV 、Excel 等格式方便后续阅读和处理数据，或者让其将完整报告存储为 MD、PDF、 PPT 等格式方便阅读文文字内容</strong>。以 csv 为例，</p>
<p>「帮我把每个国家的调研人数，薪资中位数，25/75分位数和均值导出为csv+」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a61e53ad914a00801e56e2a729bfe9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=0i1V4FtyEKQPl2nRDRnKAIZyAtk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14"><strong>总结</strong></h4>
<p>以上分析只是这个数据集的一部分，还有其他分析维度例如 AI 工具使用率分析、编程语言偏好分析、工具偏好与 AI 使用关联性等，大家可以自行修改提示词探索。</p>
<h3 data-id="heading-15"><strong>跨文件分析场景</strong></h3>
<p>有时候数据分散在不同的文件，而我们需要将不同文件之间的数据对比结合起来分析，因此会有跨文件分析的场景。</p>
<h4 data-id="heading-16"><strong>数据准备</strong></h4>
<p>从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaggle.com%2Fdatasets%2Fretailrocket%2Fecommerce-dataset%2Fdata" target="_blank" title="https://www.kaggle.com/datasets/retailrocket/ecommerce-dataset/data" ref="nofollow noopener noreferrer">www.kaggle.com/datasets/re…</a>  <strong>下载 Retailrocket recommender system dataset 数据集</strong>；该数据集包含四个文件：一个存储用户行为数据的文件（events.csv）、两个存储商品属性数据的文件（item_properties_part1.csv 和 item_properties_part2.csv），以及一个描述类目层级结构的文件（category_tree.csv）；<strong>无需手动解压</strong>，可以直接把数据集保存至本地文件夹（例如 “电商推荐” ），方便后续 TRAE 进行读取。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c613c756eca4ac2823a4b4c0b8e14d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=CjJuP6qolYcuJrCay3vBMJsEzyE%3D" alt="" loading="lazy"/></p>
<p>选择「打开项目」，找到对应文件夹打开。</p>
<h4 data-id="heading-17"><strong>开始数据分析</strong></h4>
<p><strong>1.</strong> 直接在对话框里输入指令，<strong>指令可以简单（例如“帮我分析和总结一下这个数据集”）</strong> ；可以看到三个文件里，ategory_tree.csv 是商品类别树结构（1670 行）；events.csv 是户行为事件（276 万行），主要是三类事情：浏览、加入购物车和交易；item_properties 是商品属性（2000 万行），包含多种属性类型</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d98e200c3ab4144b816108b68405494~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=%2BisHqRg5qO%2F8N22CtFBMKmbKQ7c%3D" alt="" loading="lazy"/></p>
<p><strong>2.</strong> 我们可以先针对单个文件夹做一些下钻分析，例如：</p>
<p>a. 下钻分析商品类别树分布，可以看到顶级类别数量为 25 个，最深层级为 6 层，层级 3 和层级 4 是最主要的层级，共占 81.90%，平均每个父类别有 4.54 个子类别，中位数为 4，表明类别结构比较均衡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bee50b986e6426c9b0fd87cef285458~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=eBs2%2F84dtiYO1A9MVBgC1e52ypE%3D" alt="" loading="lazy"/></p>
<p>b. 下钻分析用户行为数据，可以看到共计 141 万个用户和 276 万条记录，平均一个用户有 1.96 条记录；71%的用户仅 1 条记录，27%的用户有 2-10 条记录，1.4%用户有超过 10 条记录；从事件类型看，浏览占比 96.67%，加入购物车为 2.52%，购买为 0.81%；浏览从加入购物车转化比例为 2.60%，加入购物车到交易为 32%</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ce6989af935499aabc42328bfdeefc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=kMa7q2te4bSJT943Flpr5SQmSLA%3D" alt="" loading="lazy"/></p>
<p>c. 下钻分析商品属性数据，可以看到共计 2000 万条属性记录，涉及 40 万商品，平均一个商品 3 个属性；除了库存（available）和类目（categoryid）这两个属性外，其他属性都被哈希；最常用的前 10 个属性使用占比基本都是 100%</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a5fc0b9a8ab41eab3c5acf38f68b985~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=ooZ3dXlxvBQxNpBUwGEWW33ub10%3D" alt="" loading="lazy"/></p>
<p><strong>3.</strong> 除了单个文件下钻分析外，我们也可以交叉三个文件进行分析，例如按顶级类别看下从浏览到加入购物车到交易的转化比例：可以看到平均转化率为 0.91%，3 个类别（140、1224、859）转化率高于 1%，11 个类别转化率低于 0.5%，其他介于 0.5-1%；7 个类目的浏览量低于 1000，其中 2 个浏览量为 0</p>
<p>​「按25个顶级类别看下从浏览到加入购物车到交易的转化比例（浏览事件粒度，不是商品或者用户粒度，如果一个商品的类别有过变化，用最新的类别）」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a28c2c512d524a939ffdef5290912e38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=IrK94tLElq0bj5XAScHzvBwvso0%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-18"><strong>生成数据分析图表</strong></h4>
<p>可以直接在对话框里输入指令，例如：</p>
<p>「帮我画一个图，按top 10顶级类别浏览到加入购物车，加入购物车到交易的比例，并在图表的上方，加上每个类目的浏览、加购、交易次数」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/529b91b1c68a474183265223414f8e7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=WKNaLeLQjtUWxNp2Qrz%2FX9Oot2k%3D" alt="" loading="lazy"/></p>
<p>「帮我画一个气泡图，横轴浏览到加购的转化，竖轴是加购到购买的转化，大小是浏览量级，只需要画按浏览量前10个顶级类别」</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a9af24af731436c80fb260f2c3a6ff4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=XWU%2Fv%2BUYOXGwUw%2FCcwF4ZZc6Ztk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19"><strong>数据分析结果导出</strong></h4>
<p>「把以上top 10 顶级类别的气泡图导出为ppt」</p>
<p>可以发现，TRAE 会使用 matplotlib 绘制相关气泡图，截屏然后插入ppt里面，而没有使用PPT原生画图能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb6d7c960edc4b2dbbfae97a44325081~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=McIKZgVOTHnvrFUk4A7yEQlflhg%3D" alt="" loading="lazy"/></p>
<p>当然你也可以通过提示词「请帮我在 <strong>PPT</strong> 里面直接画图，而不是复制图片」，TRAE 也能调用 PPT 相关能力进行构图，但画出来的图片美观度略有不足，只能达到基本要求。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88cfe1a4ecd94232816dd36b2c0cb8a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=RtCC0L%2FPUAzfyHOITQgPivc4TTM%3D" alt="" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd85a44b7c6d4dbaa29f5bcc63a91ab7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=YnkLpAKMOuZ%2BksHWbo9kCHwmuf4%3D" alt="" loading="lazy"/></p>
<p>以上分析只是这个数据集的一部分，还有其他分析维度例如其他属性对购买转化比例的影响等，大家可以自行修改提示词探索。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55679dac25b046d48545f45e41ce5bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVFJBRV9haQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770974409&amp;x-signature=xfkEDQvqBOVouH507g%2Fc7xbdpoY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-20"><strong>写在最后</strong></h2>
<p>无论是咨询项目（例如银行压力测试、消费品市场趋势分析等），还是互联网场景下的数据任务（例如分国家用户留存分析、付费转化漏斗搭建等），基本都能通过 AI IDE 高效落地。<strong>AI IDE 在数据挖掘与深度分析环节的表现堪称出色，能精准完成核心任务</strong>；仅在最终数据可视化呈现的细节优化上，偶尔需要少量辅助调整，<strong>但其整体交付质量大多超出预期，大幅提升了数据分析的效率与专业性。</strong></p>
<p>IDE 从来不是专业开发者的专属工具，它可以离每个人的工作和生活都更近一些。借助 AI 的能力，我们不必精通复杂的编程语言，也能把一个个灵感和想法变成真正可落地的“数字小帮手”；不管你是产品、运营、数据分析、设计师，还是任何一一个角色，都可以用 AI Coding 去搭建属于自己的智能工作台。</p>
<p>期待多样化的你带来更多不一样的 AI Coding 实现！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端 AI Coding 落地指南（一）架构篇]]></title>    <link>https://juejin.cn/post/7603347438013480995</link>    <guid>https://juejin.cn/post/7603347438013480995</guid>    <pubDate>2026-02-06T09:26:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603347438013480995" data-draft-id="7603347438013333539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端 AI Coding 落地指南（一）架构篇"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2026-02-06T09:26:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AntonCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3966693684293240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端 AI Coding 落地指南（一）架构篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693684293240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AntonCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:26:13.000Z" title="Fri Feb 06 2026 09:26:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是也遇到过这些情况：AI 生成的代码风格和现有项目不一致；项目结构不符合预期，设计稿要么看不懂、要么分析漏项，页面 UI 还原度低；改来改去返工多，需求越走越偏，最后还得自己重写一版？</p>
<p>我在实际项目里经过多次迭代的实践，落地了一套</p>
<p><strong>以规范、能力扩展和流程为主线的 AI Coding 架构</strong></p>
<p>把「风格不一致、步骤漏、设计稿不会分析/验收、提案任务格式乱」都收进可控范围。落地之后最直观的效果是：</p>
<p><strong>前端页面可以做到 90% 还原设计稿，需求实现更准确，代码风格一致，结构设计合理</strong></p>
<hr/>
<h2 data-id="heading-0">架构简介</h2>
<p>架构运用了多种现下流行的 Agent 通用能力：</p>

























<table><thead><tr><th>架构组成</th><th>说明</th></tr></thead><tbody><tr><td>SDD</td><td>开发流程控制，保证需求不遗漏，开发不脱节，可进行需求分析/开发规划/验收测试/复盘归档</td></tr><tr><td>MCP</td><td>对接外部能力，如设计稿读取、浏览器访问页面查看实际效果、接口文档</td></tr><tr><td>Rules</td><td>约定「做什么、不做什么」，如保证 AI 遵循项目结构，规范约束，代码风格</td></tr><tr><td>Skills</td><td>约定「怎么做」，渐进披露按需指导 AI 怎么做，如怎么写UI，怎么验收UI</td></tr></tbody></table>
<p><strong>Rules 管「怎么才算对」，Skills 管「怎么一步步做」，MCP 让 Agent 能看到真实世界，而 SDD 负责记录「这次为什么要改、应该改成什么样」并把每次变更沉淀成新的真相</strong>，四者合在一起，才是真正稳定可演进的 AI Coding 底座。</p>
<p>从需求到归档的完整链路如下：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A[需求输入] --&gt; B{有设计稿?}
    B --&gt;|是| C[设计稿 MCP 读稿]
    C --&gt; D[design-analysis 产出 UI 分析清单]
    B --&gt;|否| E[create-proposal + SDD]
    D --&gt; E
    E --&gt; F[proposal / tasks / spec 增量 校验]
    F --&gt; G[按 tasks 实施]
    G --&gt; H[Rules + create-route/component/theme 页面开发]
    H --&gt; I{有实现页?}
    I --&gt;|是| J[Browser MCP 打开页面]
    J --&gt; K[ui-verification 比对设计稿/清单]
    K --&gt; L[产出 UI 问题清单 修复再验]
    L --&gt; M[create-api/store + 接口/Context7 业务联调]
    G --&gt; M
    M --&gt; N[SDD 归档 更新 specs]
</code></pre>
<ol>
<li><strong>需求输入</strong>：明确是否有设计稿、是否有接口、交付形态（页面/组件/其它）。</li>
<li><strong>设计稿分析</strong>（有稿时）：用 Pencil（或 Figma）MCP 读稿 → 执行 design-analysis 技能 → 产出 UI 分析清单。</li>
<li><strong>创建提案</strong>：执行 create-proposal，产出 SDD 的 proposal、tasks、spec 增量；若有设计稿，在 tasks 中写明依据 UI 分析清单实现、实现后用 ui-verification 验收；validate 通过后进入实施。</li>
<li><strong>页面/UI 开发</strong>：按 tasks 顺序做；读 Rules（项目结构、组件、路由、样式等）+ Skills（create-route、create-component、theme-variables）；依据 UI 分析清单还原布局与样式。</li>
<li><strong>UI 验收</strong>：用 Cursor IDE Browser（或 Playwright）打开实现页，执行 ui-verification，与设计稿或分析清单比对，按 P0/P1/P2 产出问题清单；修复后再次用 Browser 验证。</li>
<li><strong>业务开发与联调</strong>：Rules（API、状态、通用约束）+ create-api、create-store；接口文档 MCP、Context7 按需使用。</li>
<li><strong>归档</strong>：tasks 全部勾选后执行 SDD archive，更新 specs，变更挪入 archive。</li>
</ol>
<hr/>
<h2 data-id="heading-1">主流 Agent 通用</h2>
<p>本套架构方案，适用所有支持 skills/mcp 的 Agent，且
<strong>只维护一份，所有 Agent 共用</strong>：</p>
<p>首先在你的项目根目录创建 <strong><code>.agents</code></strong>，下面放 <code>rules</code> 和 <code>skills</code>，然后根据你所使用的 Agent 或多个 Agent 做如下配置：</p>
<ul>
<li><strong>Cursor</strong>：在项目根创建 <code>.cursor</code> 目录，其下的 <code>rules</code>、<code>skills</code> 用 <strong>软链接</strong> 指到 <code>.agents/rules</code>、<code>.agents/skills</code>。</li>
<li><strong>Claude</strong>：同理，创建 <code>.claude</code>，将 <code>rules</code>、<code>skills</code> 软链到 <code>.agents</code> 下同名目录。</li>
<li><strong>OpenCode</strong>：创建 <code>.opencode</code>，同理软链。</li>
<li><strong>Gemini</strong>：创建 <code>.agent</code>，同理软链。</li>
<li><strong>Trae</strong>：创建 <code>.trae</code>，同理软链。</li>
</ul>
<p>这样只需维护 <code>.agents</code> 一份，即可同时支持上述所有 Agent。</p>
<p><strong>目录结构示例</strong>（仅展示与本文相关的部分）：</p>
<pre><code class="hljs language-text" lang="text">项目根/
├── .agents/                    # 唯一维护的规范与技能目录
│   ├── rules/                  # 规则
│   └── skills/                 # 技能
│
├── .cursor/                    # Cursor：内部 rules、skills 软链到 .agents
├── .claude/                    # Claude：同上
├── .opencode/                  # OpenCode：同上
├── .agent/                     # Gemini：同上
└── .trae/                      # Trae：同上
</code></pre>
<hr/>
<h2 data-id="heading-2">SDD</h2>
<p><strong>SDD 是什么</strong><br/>
Specification-Driven Development，用「规范/spec」来驱动开发：</p>
<ul>
<li><strong>先写 spec 再写代码</strong>：任何需求或变更，先写清楚需求，「现在是怎样 → 期望变成怎样」，再开干；</li>
<li><strong>变更可追踪</strong>：变更以「提案 + 任务 + spec 增量」管理，实施完归档，可回溯是谁、什么时候、为什么改了什么；</li>
<li><strong>验收有据可依</strong>：验收按 spec 来，而不是「感觉差不多」。</li>
</ul>
<p><strong>SDD 的选择</strong></p>
<p>Spec-kit 和 OpenSpec 是两个比较热门的 SDD 工具，我在尝试过两个工具后，最终选择使用 openspec 因为他比 speckit 简单很多，speckit 的流程更严谨，也更繁琐，其复杂度适合从 0 到 1 规划一个新项目。</p>
<p><strong>OpenSpec</strong></p>
<p>通过 <code>openspec init</code> 初始化项目后，你就会得到如下的一个典型的 OpenSpec 目录：</p>
<pre><code class="hljs language-text" lang="text">openspec/
├── project.md          # 项目约定与 AI 使用说明
├── specs/              # 当前「真相」：已经生效的能力与约束
└── changes/            # 进行中的变更：proposal、tasks、design、spec 增量
    ├── &lt;change-id&gt;/
    │   ├── proposal.md
    │   ├── tasks.md
    │   ├── design.md      # 可选：草图/交互/边界情况
    │   └── spec-delta.md  # 本次变更对 specs 的增量
    └── ...
</code></pre>
<p>首先你需要编写 <code>project.md</code>，将你项目的规范告诉 openspec，以此作为规范进行推动后续的工作，这是我项目的 <code>project.md</code>，起初也是一个庞大的文件，现在已经拆分到 rules 和 skills 了（后面会介绍）：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目上下文</span>

<span class="hljs-section">## 项目概述</span>

当前项目是一个基于 React + TypeScript 的单页应用（SPA）。

<span class="hljs-section">## 技能与规范</span>

本项目定义了两层指导体系，统一存放在 <span class="hljs-code">`.agents/`</span> 目录下。

<span class="hljs-section">### `.agents/rules/` - 开发规范</span>

规范文件包含项目开发的核心规则，不会自动加载。当需要确认规范时，主动读取对应文件：

| 文件             | 何时读取                   |
| ---------------- | -------------------------- |
| <span class="hljs-code">`01-项目概述.md`</span> | 需要了解项目背景、技术栈时 |
| <span class="hljs-code">`02-编码规范.md`</span> | 编写或审查代码时           |
| <span class="hljs-code">`03-项目结构.md`</span> | 确定代码应放在哪个目录时   |
| <span class="hljs-code">`04-组件规范.md`</span> | 创建或拆分组件时           |
| <span class="hljs-code">`05-API规范.md`</span>  | 新增或修改接口时           |
| <span class="hljs-code">`06-路由规范.md`</span> | 新增页面或配置路由时       |
| <span class="hljs-code">`07-状态管理.md`</span> | 新增或重构状态管理时       |
| <span class="hljs-code">`08-通用约束.md`</span> | 确认通用约束时             |
| <span class="hljs-code">`09-样式规范.md`</span> | 编写组件样式或主题适配时   |
| <span class="hljs-code">`10-文档规范.md`</span> | 编写或审查代码注释时       |
| <span class="hljs-code">`11-测试规范.md`</span> | 确认测试要求时             |

<span class="hljs-section">### `.agents/skills/` - 实践技能</span>

技能文件包含具体落地步骤与示例代码，按需读取：

| 场景              | 技能文件                                   |
| ----------------- | ------------------------------------------ |
| 创建提案时        | <span class="hljs-code">`.agents/skills/create-proposal/SKILL.md`</span>  |
| 新增接口          | <span class="hljs-code">`.agents/skills/create-api/SKILL.md`</span>       |
| 创建/拆分组件     | <span class="hljs-code">`.agents/skills/create-component/SKILL.md`</span> |
| 新增页面路由      | <span class="hljs-code">`.agents/skills/create-route/SKILL.md`</span>     |
| 新增全局状态      | <span class="hljs-code">`.agents/skills/create-store/SKILL.md`</span>     |
| 编写样式/主题适配 | <span class="hljs-code">`.agents/skills/theme-variables/SKILL.md`</span>  |

技能索引文件：<span class="hljs-code">`.agents/skills/README.md`</span>

</code></pre>
<p>配置了规范后，就可以使用 openspec 的指令进行需求的实现，先是 <code>openspec proposal</code> 创建提案，Agent 会根据你的描述，生成详细的需求文档，规划开发任务，待你确认。</p>
<p>开发任务确认后，再执行 <code>openspec apply</code> 开始实施任务，任务完成 <code>openspec archive</code> 对本次需求归档，这会作为后续新需求的一个参考，让 Agent 对项目的现状更了解。</p>
<p><strong>OpenSpec 在这套架构里的作用</strong><br/>
结合前面讲的 Rules / Skills / MCP，这里的 OpenSpec 主要在三个环节发力：</p>
<ul>
<li><strong>需求 / 变更收敛</strong>：不管输入来自 PRD、口头、IM 还是设计稿，先用 OpenSpec 写一条变更（proposal + tasks + spec 增量），把「要改什么、影响到哪里」说清楚，避免 AI 直接在代码上「盲改」；</li>
<li><strong>开发执行对齐</strong>：开发时，Agent 读取对应变更的 proposal / tasks / spec 增量，再结合 Rules（项目级约束）、Skills（如 create-route / create-api / design-analysis）和 MCP（设计稿 / 浏览器 / 接口文档），按 tasks 一项项完成，实现过程始终围绕同一份 spec 展开；</li>
<li><strong>验收与归档</strong>：UI 验收阶段，ui-verification 会同时参考 UI 分析清单（design-analysis 产物）和 OpenSpec 中的 spec 增量，验证是否满足这次变更的业务与交互预期；验收通过后，将变更移动到 archive，并把 spec 增量合到 specs，下次再改同一块能力时，所有上下文都在这里。</li>
</ul>
<hr/>
<h2 data-id="heading-3">MCP</h2>
<p><strong>MCP 是什么</strong>：Model Context Protocol，模型通用的上下文协议，让模型能安全、结构化地调用外部能力。设计稿、浏览器、接口文档等通过 MCP 暴露成工具，Agent 按需调用，拿到真实数据或执行真实操作。</p>
<p>这套架构中用到如下的 MCP：</p>















































<table><thead><tr><th>MCP</th><th>用途</th><th>环节</th><th>说明</th></tr></thead><tbody><tr><td>Pencil</td><td>.pen 设计稿结构、布局、节点、截图</td><td>设计稿分析</td><td>设计稿分析首选，效果优于 Figma MCP</td></tr><tr><td>Figma</td><td>Figma 链接的截图与设计上下文</td><td>设计稿分析（Figma 稿时）</td><td>有 .pen 时优先 Pencil</td></tr><tr><td>Cursor IDE Browser</td><td>打开页面、快照、截图</td><td>UI 验收</td><td>Cursor 内优先，效果优于 Playwright</td></tr><tr><td>Playwright</td><td>页面打开、截图、自动化</td><td>UI 验收（非 Cursor 或脚本化）</td><td>可作为 Browser 的补充</td></tr><tr><td>ApiFox</td><td>OAS 等接口定义</td><td>业务开发/联调</td><td>按当前文档生成/校验请求</td></tr><tr><td>Context7</td><td>主流库最新文档与示例注入</td><td>页面/业务开发</td><td>避免过时 API、幻觉</td></tr></tbody></table>
<p><strong>设计稿类</strong></p>
<ul>
<li><strong>Pencil MCP</strong>：面向 <code>.pen</code> 设计稿。能读层级、节点、布局、截图（如 <code>snapshot_layout</code>、<code>get_screenshot</code>、<code>batch_get</code> 等），把设计稿里的元素尺寸、间距、字体、颜色直接触达 Agent。在「设计稿分析」环节作为主数据源，<strong>效果明显好于 Figma MCP</strong>——层级与细节更完整，分析清单更准，因此有 .pen 稿时优先用 Pencil。可以直接拷贝 Figma 粘贴到 Pencil 设计稿。</li>
<li><strong>Figma MCP</strong>：面向 Figma 链接。可解析 file key / node id、取截图与设计上下文，适合设计稿在 Figma 的场景，但 Figma 可复制到 Pencil ，95%+ 样式复制后还原，个别暂不支持的例如 Pencil 没有虚线边框。</li>
</ul>
<p><strong>浏览器类</strong></p>
<ul>
<li><strong>Cursor IDE Browser</strong>：在 Cursor 内打开目标页、拉快照、截图、简单交互。用于 UI 验收时「真实页面 vs 设计稿」比对。<strong>在 Cursor 里做 UI 验收时，优先用 Cursor IDE Browser，效果比 Playwright MCP 更好</strong>（集成度、稳定性、截图比对流程更顺）。</li>
<li><strong>Playwright MCP</strong>：同样可打开页面、截图、操作，适合不在 Cursor 或需要脚本化验收时使用。</li>
</ul>
<p><strong>接口与文档类</strong></p>
<ul>
<li><strong>接口文档 MCP（如 ApiFox）</strong>：读/刷新项目 OAS 等，在业务开发/联调时按当前文档生成或校验请求与类型，避免接口变更后模型用旧假设。</li>
<li><strong>Context7</strong>：按需注入当前版本的库文档与代码示例，在页面/业务开发时减少依赖过时、模型幻觉 API 的问题。</li>
</ul>
<hr/>
<h2 data-id="heading-4">Rules</h2>
<p><strong>Rules 是什么</strong>：写在项目里的持久化指导，约定规范、约束和惯例（项目概述、编码、结构、组件、API、路由、状态、样式、文档、测试等），让 Agent 遵守「做什么、不做什么」。</p>
<p><strong>实践中的演进历程</strong>：</p>
<ul>
<li>最初是一整个大 Rule.md，上下文过大、易丢记忆、难按场景聚焦；</li>
<li>后来按模块拆成多份（如 01～11），按需读；</li>
<li>Skills 加入后，Rules 只需要保留原则与约束，把步骤、检查点、模板、示例迁到 Skills，实现渐进式披露。</li>
</ul>
<p><strong>项目级 Rules 清单</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">.agents/rules/
├── 01-项目概述.md
├── 02-编码规范.md
├── 03-项目结构.md
├── 04-组件规范.md
├── 05-API规范.md
├── 06-路由规范.md
├── 07-状态管理.md
├── 08-通用约束.md
├── 09-样式规范.md
├── 10-文档规范.md
├── 11-测试规范.md
└── README.md
</code></pre>
<p><strong>Rules 目录下的 README 清晰的介绍了各个 rule 的作用和使用时机</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目规范索引</span>

本目录包含前端项目的开发规范，按模块分类组织，便于快速查找。

<span class="hljs-section">## 规范模块列表</span>

<span class="hljs-section">### 📋 [<span class="hljs-string">01-项目概述</span>](<span class="hljs-link">./01-项目概述.md</span>)</span>

<span class="hljs-bullet">-</span> 项目定位
<span class="hljs-bullet">-</span> 技术栈

<span class="hljs-section">### 💻 [<span class="hljs-string">02-编码规范</span>](<span class="hljs-link">./02-编码规范.md</span>)</span>

<span class="hljs-bullet">-</span> TypeScript 规范
<span class="hljs-bullet">-</span> 命名规范（文件夹、变量、常量、接口、组件等）
<span class="hljs-bullet">-</span> 业务函数命名（事件处理、内部处理）

<span class="hljs-section">### 📁 [<span class="hljs-string">03-项目结构</span>](<span class="hljs-link">./03-项目结构.md</span>)</span>

<span class="hljs-bullet">-</span> 目录结构概览
<span class="hljs-bullet">-</span> 各目录使用约束（禁止新建非标准目录）

<span class="hljs-section">### 🧩 [<span class="hljs-string">04-组件规范</span>](<span class="hljs-link">./04-组件规范.md</span>)</span>

<span class="hljs-bullet">-</span> 组件结构规范
<span class="hljs-bullet">-</span> 组件层级规划（通用 vs 页面级）

<span class="hljs-section">### 🌐 [<span class="hljs-string">05-API规范</span>](<span class="hljs-link">./05-API规范.md</span>)</span>

<span class="hljs-bullet">-</span> 接口请求规范
<span class="hljs-bullet">-</span> 接口函数命名（NON-NEGOTIABLE）
<span class="hljs-bullet">-</span> 接口错误处理（NON-NEGOTIABLE）

<span class="hljs-section">### 🛣️ [<span class="hljs-string">06-路由规范</span>](<span class="hljs-link">./06-路由规范.md</span>)</span>

<span class="hljs-bullet">-</span> 路由结构规范
<span class="hljs-bullet">-</span> 路由与菜单规范（NON-NEGOTIABLE）

<span class="hljs-section">### 🗄️ [<span class="hljs-string">07-状态管理</span>](<span class="hljs-link">./07-状态管理.md</span>)</span>

<span class="hljs-bullet">-</span> Zustand 使用规范
<span class="hljs-bullet">-</span> Store 组织规范
<span class="hljs-bullet">-</span> 持久化策略

<span class="hljs-section">### ⚙️ [<span class="hljs-string">08-通用约束</span>](<span class="hljs-link">./08-通用约束.md</span>)</span>

<span class="hljs-bullet">-</span> 语言规范（中文注释）
<span class="hljs-bullet">-</span> 可观测性与兜底
<span class="hljs-bullet">-</span> 约束汇总

<span class="hljs-section">### 🎨 [<span class="hljs-string">09-样式规范</span>](<span class="hljs-link">./09-样式规范.md</span>)</span>

<span class="hljs-bullet">-</span> SCSS Modules 使用规范
<span class="hljs-bullet">-</span> 主题色 CSS 变量（NON-NEGOTIABLE）

<span class="hljs-section">### 📝 [<span class="hljs-string">10-文档规范</span>](<span class="hljs-link">./10-文档规范.md</span>)</span>

<span class="hljs-bullet">-</span> 注释规范
<span class="hljs-bullet">-</span> JSDoc 使用

<span class="hljs-section">### ✅ [<span class="hljs-string">11-测试规范</span>](<span class="hljs-link">./11-测试规范.md</span>)</span>

<span class="hljs-bullet">-</span> 测试覆盖要求
<span class="hljs-bullet">-</span> 质量门禁

<span class="hljs-section">## 使用说明</span>

<span class="hljs-bullet">1.</span> 根据需要的规范类型，点击对应的模块链接查看详细内容
<span class="hljs-bullet">2.</span> 所有规范文件都包含 <span class="hljs-code">`alwaysApply: true`</span> 标记，确保规范自动应用
<span class="hljs-bullet">3.</span> 详细示例与落地步骤见 <span class="hljs-code">`.agents/skills/`</span> 目录下的技能文件

<span class="hljs-section">## 快速查找</span>

| 需求 | 规范文件 |
|------|----------|
| 项目背景是什么？使用哪些技术栈？ | 01-项目概述 |
| 如何命名函数/变量？ | 02-编码规范 |
| 代码放在哪个目录？ | 03-项目结构 |
| 如何创建/拆分组件？ | 04-组件规范 |
| 如何调用接口？ | 05-API规范 |
| 如何配置路由？ | 06-路由规范 |
| 如何使用 Zustand？ | 07-状态管理 |
| 有哪些通用约束？ | 08-通用约束 |
| 如何使用主题变量？ | 09-样式规范 |
| 如何写注释？ | 10-文档规范 |
| 有何测试要求？ | 11-测试规范 |

</code></pre>
<p>更详细的 rules 落地示例见：<a href="https://juejin.cn/post/7603444191448104994" target="_blank" title="https://juejin.cn/post/7603444191448104994"><strong>《前端 AI Coding 落地指南（二）Rules 篇》</strong></a>。</p>
<hr/>
<h2 data-id="heading-5">Skills</h2>
<p><strong>Skills 是什么</strong>：用 Markdown 写的技能文件，教会 Agent 完成某一类任务。一个技能一个目录，必有 <code>SKILL.md</code>（YAML 头 + 步骤 + 示例），可带子规则。</p>
<p><strong>Skills 有什么用</strong>：按场景加载、渐进披露，例如在 Rules 划好边界的前提下给「怎么做」的步骤与示例拆分成 skills，避免大量 rules 导致上下文庞大，模型无法集中，出现幻觉和记忆丢失问题。</p>
<p><strong>开源 Skills</strong>：</p>
<p>有许多开源的优质 skills，直接安装到你的项目中大有裨益，在我的 React 项目中就用到了以下开源 skills</p>



































<table><thead><tr><th>技能</th><th>简介</th><th>使用环节</th></tr></thead><tbody><tr><td>vercel-react-best-practices</td><td>React 代码编写的最佳实践</td><td>页面/业务开发时按需引用</td></tr><tr><td>vercel-composition-patterns</td><td>复合组件、状态提升、避免 boolean props 等</td><td>设计组件 API、组合与状态时</td></tr><tr><td>web-design-guidelines</td><td>通用 UI/UX 设计指南</td><td>UI 分析、实现时参考</td></tr><tr><td>find-skills</td><td>查找并选用可用技能</td><td>需要发现技能时</td></tr><tr><td>skill-creator</td><td>创建新技能的结构与规范</td><td>扩展能力、新增 Skills 时</td></tr></tbody></table>
<p><strong>自封装 Skills</strong>：</p>
<p>除了开源 skills，你还可以自己封装 skills，当有固定步骤流程且会反复做的任务时，就可以封装成 Skill。在我的项目中就有以下两类自封装的 skill：</p>
<ol>
<li>
<p>从 Rules「怎么做」拆出来的（create-route、create-component、create-api、create-store、theme-variables）；</p>
</li>
<li>
<p>可复用的流程，给予 Agent 指导（create-proposal、design-analysis、ui-verification）。</p>
</li>
</ol>
<p>像 design-analysis、ui-verification 这种内容多的技能，还可以再把细分工具能力等拆到技能下的 rules 子目录里，充分发挥渐进披露的优势，SKILL 只做入口说明。</p>
<pre><code class="hljs language-text" lang="text">.agents/skills/
├── create-proposal/     # 创建提案（SDD proposal、tasks、spec 增量）
│   └── SKILL.md
├── design-analysis/     # 设计稿分析 → UI 分析清单
│   ├── SKILL.md
│   └── rules/          # 分析顺序、四类重点、工作流、输出模板、工具等
├── ui-verification/    # UI 验收 → 问题清单
│   ├── SKILL.md
│   └── rules/          # 比对维度、常见错误、工作流、工具等
├── create-route/       # 新增路由、Page、Loader
├── create-api/         # 新增接口、类型、请求封装
├── create-store/       # 新增 Zustand store
├── create-component/   # 新增/拆分组件
├── theme-variables/    # 主题 CSS 变量使用
└── README.md
</code></pre>
<p><strong>skills 在 AI Coding 过程中发挥的作用</strong>：</p>
<ul>
<li>创建 SDD 提案时同时使用 create-proposal；</li>
<li>有设计稿时用 design-analysis 产出 UI 分析清单；</li>
<li>页面/UI 开发时用 create-route、create-component、theme-variables；</li>
<li>实现完成后用 ui-verification 做还原验收；</li>
<li>业务开发/联调时用 create-api、create-store。</li>
<li>其他开源第三方 skills 在写代码、做架构决策时按需引用。</li>
</ul>
<p><strong>skills 目录下的 README</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
name: huayiyi-skills-index
<span class="hljs-section">description: 前端项目的技能索引，帮助 Agent 在具体开发场景下选择合适的技能文件。
---</span>

<span class="hljs-section"># 画衣衣项目技能索引</span>

项目在 <span class="hljs-code">`.agents/skills`</span> 下定义了一些与 RULE 配套的技能，用于承载<span class="hljs-strong">**具体实践步骤与示例代码**</span>，避免在 RULE 中塞入过多细节。

<span class="hljs-section">## 当前技能列表</span>

<span class="hljs-bullet">-</span> <span class="hljs-code">`create-api`</span>：创建与维护 HTTP 接口（配合 <span class="hljs-code">`05-API规范`</span> 使用）
<span class="hljs-bullet">-</span> <span class="hljs-code">`create-component`</span>：创建与拆分通用组件/页面级组件（配合 <span class="hljs-code">`03/04`</span> 使用）
<span class="hljs-bullet">-</span> <span class="hljs-code">`create-route`</span>：创建与维护路由目录与 Loader/Page（配合 <span class="hljs-code">`06-路由规范`</span> 使用）
<span class="hljs-bullet">-</span> <span class="hljs-code">`create-store`</span>：使用 Zustand 创建与维护全局状态（配合 <span class="hljs-code">`07-状态管理`</span> 使用）
<span class="hljs-bullet">-</span> <span class="hljs-code">`theme-variables`</span>：正确使用 Antd 与自定义主题 CSS 变量（配合 <span class="hljs-code">`09-样式规范`</span> 使用）

后续如有新的实践场景（例如：测试用例编写、文档撰写模板等），也建议以新的技能目录形式补充到本目录中。

</code></pre>
<p>更详细的 Skills 落地示例见：<a href="https://juejin.cn/post/7603347438013497379" target="_blank" title="https://juejin.cn/post/7603347438013497379"><strong>《前端 AI Coding 落地指南（三）Skills 篇》</strong></a>。</p>
<hr/>
<h2 data-id="heading-6">总结</h2>
<p><strong>当下的局限性</strong>：要高接纳率、少返工，需要较好的模型与算力；在无限额度、高配模型下稳定性才有保障，成本不低。配合 git worktree + 多 Agent 多任务并行，不计成本时接近 100% AI Coding 在技术上可行，成本和流程需按团队权衡。</p>
<p><strong>AI Coding 展望</strong>：模型会更聪明，上下文管理会更智能，交互会更简洁。在这套 MCP + Rules + Skills + SDD 的底座上，只靠 AI Coding 完成日常前端开发不会太远；先跑通「需求 → 提案 → 分析 → 开发 → 验收」闭环，再逐步扩展，接纳率和效率都会有可见提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端 AI Coding 落地指南（二）Rules篇]]></title>    <link>https://juejin.cn/post/7603444191448104994</link>    <guid>https://juejin.cn/post/7603444191448104994</guid>    <pubDate>2026-02-06T09:27:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603444191448104994" data-draft-id="7603288778678517795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端 AI Coding 落地指南（二）Rules篇"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2026-02-06T09:27:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AntonCoding"/> <meta itemprop="url" content="https://juejin.cn/user/3966693684293240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端 AI Coding 落地指南（二）Rules篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693684293240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AntonCoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:27:35.000Z" title="Fri Feb 06 2026 09:27:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本篇是《前端 AI Coding 落地指南》的续作，专门讲 <strong>Rules</strong> 的实践：演进过程、设计原则、如何划分模块、何时写 Rules 何时写 Skills，以及项目级 Rules 的完整清单与每条 rule 的头部、介绍和通用化示例。首篇中已给出 Rules 的简要历程与清单，这里展开为可落地的细节。</p>
<hr/>
<h2 data-id="heading-0">Rules 是什么、解决什么问题</h2>
<p><strong>Rules</strong> 是写在项目里的持久化指导，用 Markdown 等形式约定项目的规范、约束和惯例。Agent 在「需要确认某类规范时」按需读取对应规则文件，从而在生成或审查代码时遵守「做什么、不做什么」——命名、目录、接口契约、样式变量、错误处理等有据可查。</p>
<p><strong>作用</strong>：统一边界（减少模型随意发挥）、按需加载（控制上下文长度）、提高接纳率（生成结果更符合项目既有约定）。<strong>能解决的 AI Coding 问题</strong>：规范不一致（没有规则时 AI 易按通用习惯写，与项目脱节）；约束缺失（如「接口必须放某目录」不写进规则就容易漏）；上下文漂移（规则按场景拆分，需要时只加载相关文件，避免一次性塞入整本规范导致注意力分散）。</p>
<hr/>
<h2 data-id="heading-1">演进过程</h2>
<p><strong>一开始：整个项目一个庞大的 Rules</strong><br/>
所有规范、步骤、示例都塞在一个或少数几个大文件里。带来的问题是：单次上下文过大（容易顶到上下文上限或挤占对话）、容易丢记忆/注意力分散（长文档里模型容易「看了后面忘前面」）、难以按场景聚焦（比如只想加个路由，却不得不带着 UI 验收、设计稿分析等无关内容）。结果是步骤漏、检查项漏，接纳率反而不稳定。</p>
<p><strong>中期：按模块拆成多个 Rules</strong><br/>
把「项目概述、编码、结构、组件、API、路由、状态、通用约束、样式、文档、测试」等拆成 01～11 这样的独立文件，需要哪类规范就读哪几个。按需加载效果好很多，上下文压力下来，也便于维护。但还有一个问题没解决：「如何落地」的步骤和示例仍然写在 Rules 里——例如「怎么加一个路由」的详细步骤、目录示例、检查清单，和「路由必须和菜单一致」这类约束混在一起，单文件仍然偏长，且步骤化、可复用工作流不好跨项目复用。</p>
<p><strong>最近：Skills 盛行，Rules 简化 + 实施指导迁到 Skills</strong><br/>
引入 Skills 之后，做了两件事：<strong>Rules 只保留「原则与约束」</strong>（做什么、不做什么、目录/命名/契约），<strong>把「如何一步步做、怎么写示例、产出长什么样」迁到 Skills</strong>，并利用 Skills 的<strong>渐进式披露</strong>（只在执行该任务时加载对应 SKILL 和技能内 rules）。这样 Rules 变薄、按需读；具体落地在 Skills 里按场景加载，既避免上下文爆炸，又避免模型在长文档里「抓不住重点」。<strong>Skills 的详细实践、何时封装、技能下 rules 如何拆分见<a href="https://juejin.cn/post/7603347438013497379" target="_blank" title="https://juejin.cn/post/7603347438013497379">《前端 AI Coding 落地指南（三）Skills 篇》</a>。</strong></p>
<hr/>
<h2 data-id="heading-2">设计原则：哪些写 Rules、哪些写 Skills</h2>
<p><strong>原则概括</strong>：<strong>Rules 回答「是什么 / 不能是什么」，Skills 回答「怎么做 / 先做什么再做什么」。</strong></p>
<p><strong>模块划分</strong>：按「开发时会被问到的决策类型」来拆，而不是按代码目录拆。例如：项目背景与技术栈（项目概述）、命名与风格（编码规范）、文件放哪（项目结构）、组件怎么拆（组件规范）、接口怎么定义和调用（API 规范）、路由和菜单怎么对（路由规范）、状态放哪怎么用（状态管理）、全局约定（通用约束）、样式和主题（样式规范）、注释与测试（文档/测试规范）。这样 Agent 在「要做一个什么类型的决策」时，能对应到某一个或少数几个规则文件。</p>
<p><strong>什么留在 Rules</strong>：原则、约束、契约、目录与命名约定。例如「接口必须放在某目录下」「路由配置必须和菜单配置一致」「错误必须用统一方式处理」「主题色必须走 CSS 变量」——这些是「是/否」判断，不涉及长步骤和大量示例，适合放在 Rules，篇幅可控。</p>
<p><strong>什么放到 Skills</strong>：多步骤流程、检查清单、产出模板、示例代码。例如「创建提案的 5 步」「设计稿分析的 4 步」「加一个路由要创建哪几个文件、每步检查什么」「UI 分析清单/问题清单长什么样」——这些一旦写进 Rules 会让单文件很长，且和「原则」混在一起，不利于按场景加载；放到 Skills 里，用 SKILL.md + 技能内 rules 做渐进披露更合适。</p>
<p><strong>判断方式</strong>：若一句话能说清且不需要示例，放 Rules；若需要「第一步、第二步、检查点、模板、示例」，放 Skills。</p>
<hr/>
<h2 data-id="heading-3">项目级 Rules 清单（目录结构）</h2>
<pre><code class="hljs language-text" lang="text">.agents/rules/
├── 01-项目概述.md
├── 02-编码规范.md
├── 03-项目结构.md
├── 04-组件规范.md
├── 05-API规范.md
├── 06-路由规范.md
├── 07-状态管理.md
├── 08-通用约束.md
├── 09-样式规范.md
├── 10-文档规范.md
├── 11-测试规范.md
└── README.md
</code></pre>
<p>由于篇幅问题，以下每条 rule 示例是简化后的，主要作为参考，后续会把完整的代码放到 github 上。</p>
<hr/>
<h3 data-id="heading-4">01-项目概述</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 项目定位与技术栈概览。当需要了解项目背景、使用的技术栈时读取此规则。
---</span>

<span class="hljs-section"># 项目概述</span>

<span class="hljs-section">## 项目定位</span>
一段话说明项目是什么、面向谁、核心能力。

<span class="hljs-section">## 技术栈</span>
| 领域 | 技术 | 说明 |
|------|------|------|
| UI 框架 | React x.x | 强制使用 |
| 类型系统 | TypeScript x.x | 强制使用，禁止 JavaScript |
| 状态管理 | Zustand / Redux 等 | 统一使用，禁止其他方案 |
| 组件库 | Ant Design / 其他 | 交互 UI 基于此二次封装 |
| 样式方案 | SCSS Modules | 强制使用，禁止全局样式 |
</code></pre>
<hr/>
<h3 data-id="heading-5">02-编码规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 编码规范，包括 TypeScript 使用、命名约定（变量、常量、接口、组件等）、业务函数命名。编写或审查代码时读取。
---</span>

<span class="hljs-section"># 编码规范</span>

<span class="hljs-section">## TypeScript 规范</span>
<span class="hljs-bullet">-</span> 所有代码必须使用 TypeScript，禁止使用 JavaScript
<span class="hljs-bullet">-</span> 禁止使用 <span class="hljs-code">`any`</span>（除非有明确理由并注释）
<span class="hljs-bullet">-</span> 接口、类型使用 PascalCase；组件 Props 必须定义清晰接口

<span class="hljs-section">## 命名规范</span>
| 类型 | 规则 | 示例 |
|------|------|------|
| 文件夹/路由 | kebab-case | user-profile |
| 变量/函数 | camelCase | userList, onSubmit |
| 常量 | UPPER<span class="hljs-emphasis">_CASE | API_</span>TIMEOUT |
| 接口/类 | PascalCase | UserInfo |
| React 组件 | PascalCase | UserProfile |
| 自定义 Hooks | use 开头 | useUserStore |

<span class="hljs-section">## 业务函数命名</span>
<span class="hljs-bullet">-</span> 事件处理：onXxx（如 onSubmit）
<span class="hljs-bullet">-</span> 内部处理：handleXxx（如 handleDelete）
</code></pre>
<hr/>
<h3 data-id="heading-6">03-项目结构</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 目录结构规范，各目录用途与约束（禁止新建非标准目录）。确定代码放哪时读取。
---</span>

<span class="hljs-section"># 项目结构（NON-NEGOTIABLE）</span>

<span class="hljs-section">## 目录结构</span>
src/
├── assets/        # 静态资源
├── components/    # 可复用 UI 组件
├── constants/     # 业务常量、枚举
├── hooks/         # 自定义 Hook
├── http/          # 请求封装
├── interfaces/    # 类型声明（model、api）
├── routes/        # 路由页面
├── stores/        # 全局状态，按业务拆分
├── utils/         # 工具函数
└── 根级入口文件

<span class="hljs-section">## 结构约束</span>
<span class="hljs-bullet">-</span> 常量 → constants/；状态 → stores/；接口类型 → interfaces/（每模块含 model.ts、api.ts）
<span class="hljs-bullet">-</span> 组件 → components/ 或 routes/<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span></span>/components/；路由 → routes/，每路由含 Page、Loader、index.module.scss
</code></pre>
<hr/>
<h3 data-id="heading-7">04-组件规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 组件目录结构、样式方案、通用 vs 页面级。创建或拆分组件时读取。
---</span>

<span class="hljs-section"># 组件规范</span>

<span class="hljs-section">## 组件结构</span>
<span class="hljs-bullet">-</span> 组件在 src/components 或路由下 components，每组件单独目录
<span class="hljs-bullet">-</span> 文件：index.tsx、index.module.scss；必须 SCSS Modules，禁止全局样式
<span class="hljs-bullet">-</span> Props 接口必须明确；使用 classnames 管理动态 class

<span class="hljs-section">## 组件层级</span>
<span class="hljs-bullet">-</span> 页面级：仅单页使用 → routes/<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">page</span>&gt;</span></span>/components/
<span class="hljs-bullet">-</span> 通用：跨页面复用 → src/components/
<span class="hljs-bullet">-</span> 单文件建议不超过 400 行（拆分参考）
</code></pre>
<hr/>
<h3 data-id="heading-8">05-API规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 接口请求封装、函数命名、错误处理。新增或修改接口时读取。
---</span>

<span class="hljs-section"># API 规范</span>

<span class="hljs-section">## 接口请求规范</span>
<span class="hljs-bullet">-</span> 请求使用 src/http 下封装；类型 Params/Body/Response 放在 src/interfaces/<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span></span>/api.ts
<span class="hljs-bullet">-</span> 所有接口集中在 src/http/<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span></span>.ts

<span class="hljs-section">## 接口函数命名（NON-NEGOTIABLE）</span>
| 操作 | 命名规则 | 示例 |
|------|----------|------|
| 获取列表 | getXxxList | getBannerList |
| 获取详情 | getXxxDetail | getBannerDetail |
| 创建/更新/删除 | createXxx / updateXxx / deleteXxx | 禁止 fetch 前缀 |

<span class="hljs-section">## 错误处理（NON-NEGOTIABLE）</span>
<span class="hljs-bullet">-</span> 接口错误由拦截器统一处理，业务代码只处理成功逻辑；禁止重复 message.error
</code></pre>
<hr/>
<h3 data-id="heading-9">06-路由规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 路由目录结构、Page/Loader 模式、路由配置集中管理。新增页面或配置路由时读取。
---</span>

<span class="hljs-section"># 路由规范（NON-NEGOTIABLE）</span>

<span class="hljs-section">## 路由结构</span>
<span class="hljs-bullet">-</span> 路由目录在 src/routes 下，每页单独目录，kebab-case
<span class="hljs-bullet">-</span> 必须包含：Page.tsx、Loader.tsx、index.module.scss
<span class="hljs-bullet">-</span> Loader 只负责懒加载对应 Page，不嵌套 Routes/Route

<span class="hljs-section">## 路由与菜单</span>
<span class="hljs-bullet">-</span> 禁止多处维护路由：全局唯一路由配置集中管理
<span class="hljs-bullet">-</span> 同一页面只在一处被 lazy 引入
</code></pre>
<hr/>
<h3 data-id="heading-10">07-状态管理</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 全局状态使用 Zustand（或项目约定方案）。新增或重构状态时读取。
---</span>

<span class="hljs-section"># 状态管理规范（NON-NEGOTIABLE）</span>

<span class="hljs-section">## 基础规范</span>
<span class="hljs-bullet">-</span> 必须使用项目约定的状态库（如 Zustand），所有 store 放在 src/stores
<span class="hljs-bullet">-</span> 禁止在 src 下新建其他目录存放 store

<span class="hljs-section">## Store 组织</span>
<span class="hljs-bullet">-</span> 按业务模块划分，每模块单独文件；暴露 useXxxStore Hook
<span class="hljs-bullet">-</span> Store 只存数据与业务行为，不耦合 UI 组件
<span class="hljs-bullet">-</span> 需持久化时使用 persist 等中间件
</code></pre>
<hr/>
<h3 data-id="heading-11">08-通用约束</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 语言、可观测性、占位元素等通用约束。确认通用约束时读取。
---</span>

<span class="hljs-section"># 通用约束</span>

<span class="hljs-section">## 语言规范（NON-NEGOTIABLE）</span>
<span class="hljs-bullet">-</span> 文档和代码注释使用中文；变量/函数命名仍用英文

<span class="hljs-section">## 可观测性与兜底</span>
<span class="hljs-bullet">-</span> 任务需完整链路：任务 ID、引用、日志；失败时兜底提示与重试

<span class="hljs-section">## 占位元素</span>
<span class="hljs-bullet">-</span> 图标/图片未定时：用占位 div + TODO 注释，禁止临时 svg/占位图服务；明确标记替换点
</code></pre>
<hr/>
<h3 data-id="heading-12">09-样式规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: SCSS Modules、主题 CSS 变量。编写样式或主题适配时读取。
---</span>

<span class="hljs-section"># 样式规范</span>

<span class="hljs-section">## 基础原则</span>
<span class="hljs-bullet">-</span> 样式采用 SCSS Modules（index.module.scss）；classnames 管理动态 class
<span class="hljs-bullet">-</span> 自定义样式必须使用主题色 CSS 变量，禁止硬编码颜色

<span class="hljs-section">## 主题变量（NON-NEGOTIABLE）</span>
<span class="hljs-bullet">-</span> 主色/文本/背景/边框等使用 var(--ant-color-xxx) 或项目自定义 var(--xxx)
<span class="hljs-bullet">-</span> 确保主题切换（浅色/暗色）一致
</code></pre>
<hr/>
<h3 data-id="heading-13">10-文档规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: JSDoc 与注释规范。编写或审查注释时读取。
---</span>

<span class="hljs-section"># 文档规范</span>

<span class="hljs-section">## 注释规范</span>
<span class="hljs-bullet">-</span> 使用 JSDoc（/** <span class="hljs-emphasis">*/），解释「为什么」而非「是什么」
- 文件头、函数/方法、复杂逻辑、类型定义均需必要说明
</span></code></pre>
<hr/>
<h3 data-id="heading-14">11-测试规范</h3>
<pre><code class="hljs language-markdown" lang="markdown">---
alwaysApply: false
<span class="hljs-section">description: 测试覆盖与质量门禁。确认测试要求时读取。
---</span>

<span class="hljs-section"># 测试规范</span>

<span class="hljs-section">## 测试要求</span>
<span class="hljs-bullet">-</span> 新增功能需必要类型定义，关键业务逻辑需测试用例
<span class="hljs-bullet">-</span> 所有代码通过 TypeScript 与 ESLint 检查
</code></pre>
<hr/>
<p>以上就是项目级 Rules 的完整清单与通用化示例。项目级 Skills 的逐条示例在<a href="https://juejin.cn/post/7603347438013497379" target="_blank" title="https://juejin.cn/post/7603347438013497379">《前端 AI Coding 落地指南（三）Skills 篇》</a>；<a href="https://juejin.cn/post/7603347438013480995#heading-4" target="_blank" title="https://juejin.cn/post/7603347438013480995#heading-4">架构篇</a>、Rules 篇、Skills 篇一起构成从架构到 Rules/Skills 落地的完整指南。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android应用冷启动优化：从测量方法到分层实践]]></title>    <link>https://juejin.cn/post/7603321550247100466</link>    <guid>https://juejin.cn/post/7603321550247100466</guid>    <pubDate>2026-02-06T09:07:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247100466" data-draft-id="7593338828218531855" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android应用冷启动优化：从测量方法到分层实践"/> <meta itemprop="keywords" content="Android,性能优化,源码阅读"/> <meta itemprop="datePublished" content="2026-02-06T09:07:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光光跬步"/> <meta itemprop="url" content="https://juejin.cn/user/1286855157887751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android应用冷启动优化：从测量方法到分层实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1286855157887751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光光跬步
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:07:37.000Z" title="Fri Feb 06 2026 09:07:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>优化Android 应用启动速度是性能优化中重要的一环，当启动速度过慢时，用户可能不愿意等待，从而直接关闭应用。启动速度这不仅影响应用日活，还会影响应用的留存率。</p>
<blockquote>
<p>注意：本文出现的源码基于Android - 15.0.0_r1。另外本文关注主要逻辑，省略部分代码。</p>
</blockquote>
<h2 data-id="heading-1">本文大纲</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63f3fea9189f4a04b52d1186e432e048~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=gFgKCmkLJm%2F7dPTcFmZfeNgKxQQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">一、启动类型</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce2e6a580cb7461499f86c104cc23967~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=dcrw%2F81Uk9g3L0aU%2BnDo%2BOw3t7U%3D" alt="image.png" loading="lazy"/></p>
<p>Android App启动种类共3种：冷启动，温启动，热启动。<br/>
接下来，我们简要介绍这三种启动类型。</p>
<h4 data-id="heading-3">1.1 冷启动</h4>
<ul>
<li><strong>条件</strong>：应用进程完全不存在（被系统杀死或首次启动）</li>
<li><strong>过程</strong>：创建进程 → 初始化应用 → 创建Activity → 渲染界面</li>
<li><strong>特点</strong>：耗时最长，涉及完整启动链，是性能优化的主要目标</li>
</ul>
<h4 data-id="heading-4">1.2 温启动</h4>
<ul>
<li><strong>条件</strong>：应用进程存在，但Activity被销毁（如系统内存回收）</li>
<li><strong>过程</strong>：进程已存在 → 重新创建Activity → 渲染界面</li>
<li><strong>特点</strong>：耗时中等，跳过部分初始化，但仍需重建Activity</li>
</ul>
<h4 data-id="heading-5">1.3 热启动</h4>
<ul>
<li><strong>条件</strong>：应用进程和Activity都在内存中（如按Home键返回）</li>
<li><strong>过程</strong>：直接将Activity从后台带到前台</li>
<li><strong>特点</strong>：耗时最短，近乎瞬间，主要涉及界面切换</li>
</ul>
<h2 data-id="heading-6">二、测量指标</h2>
<p>要想知道启动速度优化的效果，我们就得知道优化前后冷启动时间，因此接下来看看测量指标。</p>
<p>启动时间分为2种: TTID 和 TTFD。</p>
<h3 data-id="heading-7">2.1 初始显示时间 (TTID)</h3>
<p>初始显示所用时间 (TTID) 是指显示应用界面的第一帧所用的时间。此指标用于测量应用生成第一帧所用的时间，包括冷启动期间的进程初始化、冷启动或温启动期间的 activity 创建，以及显示第一帧。包括以下事件序列的总经过时间：</p>
<ul>
<li>启动进程。</li>
<li>初始化对象。</li>
<li>创建并初始化 activity。</li>
<li>膨胀布局。</li>
<li>首次绘制应用。</li>
</ul>
<h3 data-id="heading-8">2.2 完全显示时间 (TTFD)</h3>
<p>完全显示时间 (TTFD) 是指应用达到可与用户互动的状态所用的时间。系统会报告显示应用界面的第一帧以及在显示第一帧后异步加载的内容所需的时间。一般情况下，这是从网络或磁盘加载的主要内容（由应用报告）。换句话说，TTFD 包括 TTID 以及应用可供使用所需的时间。</p>
<h3 data-id="heading-9">2.3 小结</h3>
<p>TTID : 显示应用界面的第一帧所用的时间<br/>
TTFD: 应用达到可与用户互动的状态所用的时间 (TTID + 应用可供使用所需的时间)</p>
<h2 data-id="heading-10">三、测量方法</h2>
<p>看完了测量指标，我们再看看有哪些测量启动时间的方法。</p>
<h3 data-id="heading-11">3.1 基础工具：AS日志与ADB命令</h3>
<h4 data-id="heading-12">3.1.1 Android Studio Logcat命令查看</h4>
<p>Android Studio中查看日志，过滤 tag:ActivityTaskManager Displayed
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/282fb8ecfa4e4945bcf54b547d42e089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=fjjr5UVO4kiaXVmDOXWwQdZkFys%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>注：这个日志是显式的初始显示所用时间 (TTID)</p>
</blockquote>
<h4 data-id="heading-13">3.1.2 adb shell am start -W命令</h4>
<p>adb shell am start -W 包名/首屏Activity<br/>
比如：adb shell am start -W com.xxx.xxx/com.xxx.xxx.MainActivity
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acb40c82663c4932a0139a8a846e0541~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=noM5dCMclx3NwTEa98DnQvx7JAs%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>ThisTime:：最后一个Activity启动耗时</li>
<li>TotalTime：所有Acitivity启动耗时</li>
<li>WaitTime：AMS启动Activity的总耗时</li>
</ul>
<p>注：ThisTime &lt;= TotalTime &lt; WaitTime</p>
<h3 data-id="heading-14">3.2 官方方案：Jetpack Macrobenchmark</h3>
<p>谷歌官方的 <strong>Jetpack Macrobenchmark</strong> 可以用来测量启动时间, 它的使用也是很方便的：
New -&gt; New Module -&gt; 选择Benchmark -&gt; 点击Finish即可
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/166d5ec97c384af9b79d7dd8f975b724~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=AQwK%2FJqi6iaUJQQMDwqORTjZMtQ%3D" alt="image.png" loading="lazy"/></p>
<p>如下是定义一个测试次数为5次的冷启动测试</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@RunWith(AndroidJUnit4::class)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleStartupBenchmark</span> {
    <span class="hljs-meta">@get:Rule</span>
    <span class="hljs-keyword">val</span> benchmarkRule = MacrobenchmarkRule()

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startup</span><span class="hljs-params">()</span></span> = benchmarkRule.measureRepeated(
        <span class="hljs-comment">// 被测应用的包名</span>
        packageName = <span class="hljs-string">"com.xxx.xxx"</span>,
        <span class="hljs-comment">// 基准测试中提取的主要信息类型</span>
        metrics = listOf(StartupTimingMetric()),
        <span class="hljs-comment">// 设置测试次数</span>
        iterations = <span class="hljs-number">5</span>,
        <span class="hljs-comment">// 设置启动模式为</span>
        startupMode = StartupMode.COLD
    ) {
        pressHome()
        startActivityAndWait()
    }
}
</code></pre>
<blockquote>
<p>如果要测量TTFD，记得在<strong>应用页面</strong>(不是在Macrobenchmark模块)中调用 ComponentActivity#reportFullyDrawn 方法</p>
</blockquote>
<p>测试完成后，会展示简略的测试结果，显示TTID TTFD
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e289de04465c4a859be7a3ea54224eca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=sHEvaxLA%2BNbChXah12pYtbU7QPI%3D" alt="image.png" loading="lazy"/></p>
<p>而在benchmark/build/outputs/connected_android_test_additional_output/benchmark/connected/设备名 下面会生成测试报告
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c5ce7d29fe404da63b797a14c1423a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=BHz5Jl63ZiCHzUXh86Qy7tG5JOQ%3D" alt="image.png" loading="lazy"/></p>
<p>打开包名-benchmarkData.json可以看到此次测试的设备信息，每次测试的时间、
最长/短启动时间、P50</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 设备信息</span>
    ... 
    <span class="hljs-attr">"benchmarks"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"startup"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"com.xxx.xxx"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"totalRunTimeNs"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">58688817257</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"metrics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"timeToInitialDisplayMs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                    <span class="hljs-attr">"minimum"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">547.887593</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"maximum"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">641.342603</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"median"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">583.550673</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// P50</span>
                    <span class="hljs-attr">"coefficientOfVariation"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.05969737243251711</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-attr">"runs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                        <span class="hljs-number">641.342603</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-number">612.770907</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-number">580.224135</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-number">583.550673</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-number">547.887593</span>
                    <span class="hljs-punctuation">]</span>
                <span class="hljs-punctuation">}</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            ...
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>生成的.perfetto-trace，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.perfetto.dev%2F" target="_blank" title="https://ui.perfetto.dev/" ref="nofollow noopener noreferrer">ui.perfetto.dev/</a> 打开它，截图如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b12be93e3b74432dbdd348dba58ab935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=itEGEi%2BIXOP%2FWQTvbLx9NYLukx8%3D" alt="image.png" loading="lazy"/></p>
<p>当然 Android Studio 也是可以打开(open-&gt;选择要打开的文件)这种类型的文件，截图如下：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/07bb20636a7d4eb4935c1a155fed4618~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=RzvupjMdHxQWmfqt5nKwFwDctsI%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>Macrobenchmark官方文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fperformance%2Fbenchmarking%2Fmacrobenchmark-overview%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.google.cn/topic/performance/benchmarking/macrobenchmark-overview?hl=zh-cn" ref="nofollow noopener noreferrer">Jetpack Macrobenchmark</a>; Macrobenchmark官方Demo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fandroid%2Fperformance-samples" target="_blank" title="https://github.com/android/performance-samples" ref="nofollow noopener noreferrer">github.com/android/per…</a></p>
</blockquote>
<h3 data-id="heading-15">3.3 自动化测试脚本</h3>
<h4 data-id="heading-16">3.3.1 开发原因</h4>
<p>AS日志与ADB命令测试方便但只能测试一次，多次测试需要重复操作，且无法统计P50, P90等信息，也没有当前设备信息。</p>
<p>而官方的Macrobenchmark呢，笔者发现国内设备(测试华为Y9, iqoo13)上，使用Macrobenchmark无法测试。想使用一种更通用的方式，编写脚本不失为一种好的方式，脚本测试方便且通用。因脚本内容较长，故放在了github上。详见<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Fblob%2Fmain%2Fapp_launch_benchmark.sh" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/blob/main/app_launch_benchmark.sh" ref="nofollow noopener noreferrer">AndroidStartupOptimizationDemo</a></p>
<blockquote>
<p>注：此脚本参考了马哥的脚本，详见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FvW6-zag2CKrFgcYAPdeUFg" target="_blank" title="https://mp.weixin.qq.com/s/vW6-zag2CKrFgcYAPdeUFg" ref="nofollow noopener noreferrer">App冷启动优化测试干货分享（一）</a>。笔者做了以下改动：1.合并了app_launch_benchmark.sh 和 app_config.cfg。2.添加了P50, P90, P95和设备信息(如Android系统版本，内存信息等)；3.生成start_up_reports文件夹，将启动报告统一放在了此文件夹下；4.多次测试会卡住，添加adb server 重启策略和超时处理</p>
</blockquote>
<h4 data-id="heading-17">3.3.2 使用方式</h4>
<ol>
<li>复制脚本到项目根目录下</li>
<li>修改包名和MainActivity为当前应用</li>
</ol>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 内置默认配置（原 app_config.cfg）</span>
<span class="hljs-comment"># ============================================</span>
DEFAULT_CONFIG_CONTENT=$(<span class="hljs-built_in">cat</span> &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment"># App启动时间测试配置文件</span>
<span class="hljs-comment"># 格式：包名|Activity类名|显示名称|启动类型|备注</span>

<span class="hljs-comment"># 系统应用 - 冷启动测试</span>
<span class="hljs-comment"># com.android.settings|com.android.settings.Settings|系统设置|cold|冷启动测试</span>
<span class="hljs-comment"># com.android.dialer|com.android.dialer.main.impl.MainActivity|拨号器|cold|冷启动测试</span>

<span class="hljs-comment"># 第三方应用</span>
<span class="hljs-comment"># com.tencent.mm|com.tencent.mm.ui.LauncherUI|微信|cold|社交应用冷启动</span>
<span class="hljs-comment"># com.taobao.taobao|com.taobao.tao.homepage.MainActivity3|淘宝|warm|电商应用温启动</span>
<span class="hljs-comment"># 此处添加当前应用信息</span>
</code></pre>
<ol start="3">
<li>git命令行执行当前脚本</li>
</ol>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># 使用方式</span>
<span class="hljs-comment"># ============================================</span>
<span class="hljs-comment"># ./app_launch_benchmark.sh                     # 使用默认配置测试</span>
<span class="hljs-comment"># ./app_launch_benchmark.sh -n 5      # 测试5次</span>
<span class="hljs-comment"># ./app_launch_benchmark.sh -c xxx.cfg -n 5 # 自定义配置，测试5次</span>
</code></pre>
<h4 data-id="heading-18">3.3.3 测试截图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0288a98a4c1a4033a344de24eda0e1e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=dHw4dj96xZoUJ8oYW3vZOewUC0k%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-19">四、优化方法</h2>
<h3 data-id="heading-20">4.1 常规优化</h3>
<h4 data-id="heading-21">4.1.1 收敛ContentProviders</h4>
<h5 data-id="heading-22">原理</h5>
<p>在应用启动流程中，会安装ContentProvider。时序图如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa0b5c1347f64e38b99b1a56493fd7f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=lVmFcHD%2BJUCjdbJPACsDTQXqgP4%3D" alt="image.png" loading="lazy"/></p>
<p>ActivityThread#installContentProviders的代码如下：</p>
<pre><code class="hljs language-Java" lang="Java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleBindApplication</span><span class="hljs-params">(AppBindData data)</span> {
        ...
        
        <span class="hljs-comment">// 安装ContentProvider</span>
        installContentProviders(app, data.providers);
        ...
    }
</code></pre>
<p>在应用启动的 ActivityThread#handleBindApplication 阶段，系统会调用 installContentProviders。如果 Manifest 中声明了多个 Provider（如 Firebase、Facebook SDK 各自带一个），系统会<strong>串行</strong>初始化它们，这会占用主线程几十到上百毫秒。</p>
<h5 data-id="heading-23">优化方案</h5>
<p>使用 Jetpack Startup 将多个 Provider 合并为一个初始化入口</p>
<p>首先要确定当前应用有哪些ContentProvider，使用 AS 打开 Apk/aab里面的Manifest</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>
    &lt;<span class="hljs-attr">application</span>
        <span class="hljs-attr">...</span>
        &lt;<span class="hljs-attr">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.facebook.internal.FacebookInitProvider"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.xxx.xxx.FacebookInitProvider"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.google.mlkit.common.internal.MlKitInitProvider"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.xxx.xxx.mlkitinitprovider"</span>
            <span class="hljs-attr">android:initOrder</span>=<span class="hljs-string">"99"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.google.firebase.provider.FirebaseInitProvider"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.xxx.xxx.firebaseinitprovider"</span>
            <span class="hljs-attr">android:initOrder</span>=<span class="hljs-string">"100"</span>
            <span class="hljs-attr">android:directBootAware</span>=<span class="hljs-string">"true"</span> /&gt;</span>
         ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>比如当前示例App的Manifest中，未收敛时有3个ContentProvider,</p>
<p>官方提供了Jetpack StartUp, 我们可以用它来收敛ContentProvider，使用方法如下：<br/>
首先定义各个启动器</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FirebaseCombinedInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        <span class="hljs-comment">// 初始化 FirebaseApp, 防止未 initialize 报错</span>
        FirebaseApp.initializeApp(context)

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取 Firebase Analytics 的 appInstanceId</span>
            FirebaseAnalytics.getInstance(context).appInstanceId
                .addOnCompleteListener { task -&gt;
                    task.result?.let { id -&gt;
                        SpUtil.saveStringData(SpKeyConstants.FIREBASE_ID, id)
                    }
                }
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Timber.tag(<span class="hljs-string">"FirebaseInit"</span>).e(e, <span class="hljs-string">"获取 appInstanceId 失败"</span>)
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; = emptyList()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FacebookManualInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        <span class="hljs-comment">// 使用协程在后台线程激活 App Events，避免阻塞</span>
        CoroutineScope(Dispatchers.IO).launch {
            <span class="hljs-keyword">try</span> {
                AppEventsLogger.activateApp(context <span class="hljs-keyword">as</span> Application)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-comment">// 忽略初始化失败，避免影响启动</span>
            }
        }
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;?&gt;?&gt; = emptyList()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MlKitManualInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        MlKit.initialize(context)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;?&gt;?&gt; = emptyList()
}
</code></pre>
<p>然后修改Manifest</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.startup.InitializationProvider"</span>
    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.androidx-startup"</span>
    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Firebase 初始化，无依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.xxxr.FirebaseCombinedInitializer"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- ML Kit 初始化，无依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.xxx.MlKitManualInitializer"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>
    <span class="hljs-comment">&lt;!-- Facebook 初始化，无依赖 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.xxx.FacebookManualInitializer"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.google.firebase.provider.FirebaseInitProvider"</span>
    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.firebaseinitprovider"</span>
    <span class="hljs-attr">tools:node</span>=<span class="hljs-string">"remove"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.facebook.internal.FacebookInitProvider"</span>
    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.FacebookInitProvider"</span>
    <span class="hljs-attr">tools:node</span>=<span class="hljs-string">"remove"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.google.mlkit.common.internal.MlKitInitProvider"</span>
    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.mlkitinitprovider"</span>
    <span class="hljs-attr">tools:node</span>=<span class="hljs-string">"remove"</span> /&gt;</span>
</code></pre>
<p>到这里就结束了，实际操作其实不复杂。</p>
<h5 data-id="heading-24">验证</h5>
<p>最后验证下是否生效了，我们打开收敛后Apk中的Mainfest文件</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>
    &lt;<span class="hljs-attr">application</span>
        <span class="hljs-attr">...</span>
        &lt;<span class="hljs-attr">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.startup.InitializationProvider"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.xxx.androidx-startup"</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
                <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.AppsFlyerInitializer"</span>
                <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
                <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.initializer.FirebaseCombinedInitializer"</span>
                <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
                <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.initializer.MlKitManualInitializer"</span>
                <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
                <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.initializer.FacebookManualInitializer"</span>
                <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>

            ...
        <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>可以看到，收敛后Apk的Manifest中，仅有1个ContentProvider</p>
<h5 data-id="heading-25">优化效果</h5>





























<table><thead><tr><th>时间类型</th><th>未优化</th><th>优化后</th><th>减少幅度</th></tr></thead><tbody><tr><td>P50</td><td>465ms</td><td>436ms</td><td>-29ms (-6.24%)</td></tr><tr><td>P90</td><td>476ms</td><td>446ms</td><td>-30ms (-6.30%)</td></tr><tr><td>P95</td><td>480<br/></td><td>451ms</td><td>-29ms (-6.04%)</td></tr></tbody></table>
<blockquote>
<p>详细的测试数据请看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Ftree%2Ffeature%2Fcontent-provider%2Fstart_up_reports" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/tree/feature/content-provider/start_up_reports" ref="nofollow noopener noreferrer">AndroidStartupOptimizationDemo/start_up_reports at feature/content-provider</a></p>
</blockquote>
<h4 data-id="heading-26">4.1.2 初始化优化与任务调度</h4>
<h5 data-id="heading-27">时机优化</h5>
<p><strong>a.延迟/按需初始化</strong></p>
<p>对于启动非必要的任务，我们可以延迟/按需它的初始化，减少初始化的任务，从而减少应用启动的时间。<br/>
比如上面的MlKitManualInitializer，它其实是非启动必需的任务，用户并不是每次使用应用，都需要用到人脸识别，因此我们可以在调用它之前的页面，去初始化它。还可以进一步根据后端返回字段，如果xx接口返回此次需要使用人脸识别，那么我们再初始化它。</p>
<p><strong>b.异步初始化</strong></p>
<p>对于启动必需但不需要同步的任务，我们可以通过异步初始化，这样就不会阻塞主线程，从而减少应用启动的时间。</p>
<p><strong>c.首屏数据加载策略</strong></p>
<p>对于启动后立即需要的首屏数据（如用户信息、配置列表），其加载也属于启动必需但无需阻塞主线程的任务。我们可以进一步优化：</p>
<ul>
<li><strong>并行请求</strong>：将多个独立的数据请求并行发起，而非串行等待。</li>
<li><strong>高效解析</strong>：选用性能更优的序列化库（如替换默认的Gson为Kotlin serialization或Moshi），减少数据反序列化的CPU耗时。详见<a href="https://juejin.cn/post/7287083662758379554" target="_blank" title="https://juejin.cn/post/7287083662758379554">常用 JSON 库性能对比: Gson VS Moshi VS Kotlin Serialization VS ...</a></li>
<li><strong>缓存优先</strong>：对于不要求实时数据的首屏页面，可以先展示缓存页面，后进行网络更新，即优先展示本地缓存数据，让UI快速可交互，后台再更新数据。</li>
</ul>
<p>这些策略虽不直接影响 TTID，但能显著缩短 TTFD，让用户更快地开始使用应用。</p>
<p><strong>d.优化效果</strong></p>
<p>在示例App中，使用收敛ContentProvider、异步初始化任务和延迟初始化后的优化前后对比如下：</p>





























<table><thead><tr><th>时间类型</th><th>未优化</th><th>优化后</th><th>减少幅度</th></tr></thead><tbody><tr><td>P50</td><td>465ms</td><td>436ms</td><td>-29ms (-6.23%)</td></tr><tr><td>P90</td><td>476ms</td><td>445ms</td><td>-31ms (-6.51%)</td></tr><tr><td>P95</td><td>480<br/></td><td>449ms</td><td>-31ms (-6.46%)</td></tr></tbody></table>
<blockquote>
<p>详细的测试数据请看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Ftree%2Ffeature%2Finit-optimization-strategy%2Fstart_up_reports" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/tree/feature/init-optimization-strategy/start_up_reports" ref="nofollow noopener noreferrer">AndroidStartupOptimizationDemo/start_up_reports at feature/init-optimization-strategy</a></p>
</blockquote>
<h5 data-id="heading-28">编排初始化任务</h5>
<p>在初始化任务时，应用可能会存在依赖的情况，如任务A的初始化完成后，任务B的初始化才能正常执行。我们先画出任务间依赖关系的有向图，先理清任务间的关系，后续使用官方的 <strong>StartUp</strong> 来编排任务。</p>
<p>举个例子，现有任务a,b,c,d,e，然后 c依赖a，d依赖b，然后 e依赖d，c。<br/>
先画出有向无环图，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3925bc5a4e04a7295ac0069e1c2495c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=F8ScsZ1pdlWawvPq3k1o7Fg0KpE%3D" alt="image.png" loading="lazy"/></p>
<p>之后创建各个任务的启动器</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        Log.d(<span class="hljs-string">"AInitializer"</span>, <span class="hljs-string">"create: AInitializer"</span>)
    }

    <span class="hljs-comment">// A无依赖</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; = emptyList()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        Log.d(<span class="hljs-string">"BInitializer"</span>, <span class="hljs-string">"create: BInitializer"</span>)
    }

    <span class="hljs-comment">// B无依赖</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; = emptyList()
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        Log.d(<span class="hljs-string">"CInitializer"</span>, <span class="hljs-string">"create: CInitializer"</span>)
    }

    <span class="hljs-comment">// C依赖A</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; =
        listOf(AInitializer::<span class="hljs-keyword">class</span>.java)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        Log.d(<span class="hljs-string">"DInitializer"</span>, <span class="hljs-string">"create: DInitializer"</span>)
    }

    <span class="hljs-comment">// D依赖B</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; =
        listOf(BInitializer::<span class="hljs-keyword">class</span>.java)
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EInitializer</span> : <span class="hljs-type">Initializer</span>&lt;<span class="hljs-type">Unit</span>&gt; {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span> {
        Log.d(<span class="hljs-string">"EInitializer"</span>, <span class="hljs-string">"create: EInitializer"</span>)
    }

    <span class="hljs-comment">// E依赖C,D</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dependencies</span><span class="hljs-params">()</span></span>: List&lt;Class&lt;<span class="hljs-keyword">out</span> Initializer&lt;*&gt;&gt;&gt; =
        listOf(CInitializer::<span class="hljs-keyword">class</span>.java, DInitializer::<span class="hljs-keyword">class</span>.java)
}
</code></pre>
<p>后续在manifest中，声明E的启动器即可，StartUp 会自动解析依赖关系</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">application</span>
        <span class="hljs-attr">...</span>
        &lt;<span class="hljs-attr">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.startup.InitializationProvider"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.androidx-startup"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">tools:node</span>=<span class="hljs-string">"merge"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
                <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.xxx.xxx.initializer.EInitializer"</span>
                <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>后续运行代码，打印日志如下：<br/>
create: AInitializer<br/>
create: CInitializer<br/>
create: BInitializer<br/>
create: DInitializer<br/>
create: EInitializer</p>
<h4 data-id="heading-29">4.1.3 基准配置文件</h4>
<p>基准配置文件是官方推荐使用的一种优化方式，下面先看看它的原理吧。</p>
<h5 data-id="heading-30">原理</h5>
<p>我们可以通过一个生活中的例子来理解它的工作原理：第一次到朋友家，他让我们帮忙找东西。当没有使用基准配置文件时，就相当于我们不知道东西在哪里，那么只能每个房间、每个位置都翻找一遍；而使用基准配置文件后，就相当于朋友提前给了我们一份文件清单，上面清楚标明了每样东西的位置，我们按图索骥，就能快速找到目标。</p>
<p><strong>这个文件清单，对应的就是基准配置文件（Profile-Guided Optimization，PGO）技术生成的热点代码清单（baseline-prof.txt）。</strong></p>
<p>在技术层面，传统的AOT（提前）编译会试图编译所有代码，这往往导致应用安装缓慢且包体积增大。而PGO则反其道而行之：它通过在真实设备上运行应用，记录下实际使用时的关键执行路径（例如启动过程），从而生成一份针对性的“热点代码清单”。</p>
<p>ART运行时在<strong>两个时机</strong>使用这份清单：</p>
<ol>
<li><strong>安装时</strong>：对清单中的方法进行AOT编译</li>
<li><strong>后台优化</strong>：设备空闲时，根据实际使用情况进一步优化</li>
</ol>
<p>这样既减少了运行时解释/JIT开销，又避免了"全量编译"的弊端。</p>
<h5 data-id="heading-31">使用基准配置文件</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f39147c7018e471dbc965026b41a330e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=QnK31F10BrfyMV3NcvSqvSaxEdY%3D" alt="image.png" loading="lazy"/><br/>
在AS中选择 File -&gt; New -&gt; New Module</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87efbfcf8fb44acebeb95cd98f4040ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=lV8kXVMSIrssPKEH4Ver%2FJ4ZP6I%3D" alt="image.png" loading="lazy"/>
选择Baseline Profile Generator，点击Finish。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed716e0d8457490991e072d4d32948ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=OAdccydig1qR6I8nzn7eTcDD1L4%3D" alt="image.png" loading="lazy"/><br/>
之后会生成一个名为 BaselineProfile 的新模块。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aac78e2c87d41f9a63798d19ceea5cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=8QHxIgf0qcTs5C%2BWlvU%2BPD36FqQ%3D" alt="image.png" loading="lazy"/>
现在点击运行 Generate Baseline Profile for app，提示Error: Target module's selected variant is debuggable. Please use Build Variants tools window to change the variant of Dex.app。就是说需要使用 release 变体（非 debuggable 版本）。</p>
<p>这里就不介绍怎么生成 release 签名文件了，直接看 release 签名配置完成之后。</p>
<blockquote>
<p>详细签名步骤，请读者自行查看官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Fstudio%2Fpublish%2Fapp-signing%3Fhl%3Dzh-cn%23sign-apk" target="_blank" title="https://developer.android.google.cn/studio/publish/app-signing?hl=zh-cn#sign-apk" ref="nofollow noopener noreferrer">为应用签名</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/512418ff3ff24c8ca47d596595cd0bd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=TFu1uX1DysBEONZzZe3UvPjLMHU%3D" alt="image.png" loading="lazy"/><br/>
配置完签名，修改 <strong>App 模块的 Build Variant</strong>，再次点击图标，运行 Generate Baseline Profile for app</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd60518568dc43b3ac0b3eb72ba30add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=QWqrojKEAEtt537AB9Jq2j1NL9I%3D" alt="image.png" loading="lazy"/><br/>
运行完成之后，我们会在 app/src/xxxRelease/generated 下面看到生成了 baseline-prof.text 和 startup-prof.text 文件</p>
<h4 data-id="heading-32">4.1.4 启动配置文件</h4>
<p>在上一节中，我们通过基准配置文件知道了“东西”的位置。本小节我们来了解另一个关键的优化文件——启动配置文件，看看它如何在此基础上进行更深层的优化。</p>
<h5 data-id="heading-33">原理</h5>
<p>我们可以继续用“找东西”的例子来理解它的工作原理：基准配置文件已经告诉我们东西在哪，但它们仍然分散在各个房间。<strong>启动配置文件</strong>则更进一步，相当于朋友提前把要用的所有东西打包进了几个背包，并把背包放在了门口。这样，你进门就能直接拿到所有必需品，省去了去各个房间的时间。</p>
<p>在技术上，启动配置文件的核心原理是 <strong>DEX布局优化</strong>，其根本目标是减少应用启动过程中的<strong>缺页中断</strong>，从而降低耗时的IO操作，最终显著缩短启动时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f795a0f419f48068eadce55fe5d236a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=SIFqJ8DwdfehHQtj7z6wVAjtrTg%3D" alt="image.png" loading="lazy"/>
借用官网的一张图来说明:</p>
<ul>
<li>左侧：在apk中多个classes.dex，启动代码分散在各个classes.dex，且启动各个类非连续排列，此时就会有不必要的缺页中断，增加了多余的IO操作。</li>
<li>右侧：使用DEX布局优化，将原本分散在各个classes.dex中的启动代码放在了主classes.dex，并且连续排列。减少了缺页中断，也就减少了IO操作。</li>
</ul>
<p>也就是说通过优化DEX布局，使启动所需的类在dex中连续存储，然后就能顺序读取，减少磁盘寻道时间，并且减少缺页中断，也就减少了IO操作。我们知道IO操作是比较耗时的，当减少了它之后，启动时间自然也就减少了。</p>
<h5 data-id="heading-34">使用启动配置文件</h5>
<p>使用方式详见4.1.3小节，基准配置文件和启动配置文件会一起生成。</p>
<h5 data-id="heading-35">验证启动配置文件</h5>
<p>首先修改settings.gradle</p>
<pre><code class="hljs language-kts" lang="kts">pluginManagement {
    ...

    buildscript {
        repositories {
            mavenCentral()
            maven {
                url = uri(<span class="hljs-string">"https://storage.googleapis.com/r8-releases/raw"</span>)
            }
        }
        dependencies {
            classpath(<span class="hljs-string">"com.android.tools:r8:8.3.6-dev"</span>)
        }
    }
}
</code></pre>
<p>然后执行如下命令
./gradlew assembleRelease --info</p>
<p>等编译完成后，查看编译日志，可搜索关键字 <strong>Startup DEX</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f09e22c9e914b008f6a426e446449d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=SpJJeJHiq6zdvJQRfyVlc3GK4Kg%3D" alt="image.png" loading="lazy"/></p>
<p>INFO: R8: Startup DEX files contains 3398 classes and 14427 methods of which 7249 (50%) are non-startup methods. Distribution of classes by their number of startup methods:<br/>
0: 737 classes<br/>
1: 1026 classes<br/>
2-3: 1183 classes<br/>
4-5: 245 classes<br/>
6-10: 139 classes<br/>
11+: 68 classes</p>
<p>这表明了编译时，DEX布局已经成功优化了。</p>
<h5 data-id="heading-36">优化效果</h5>
<p>因为基准配置文件和启动配置文件是一起生成了，此处就不分开测试这2种文件了。</p>
<p>在同一设备上，测试同一应用，使用3.3小节的脚本，分别测试了200次未使用 和 使用这2种文件优化前后的冷启动时间，数据如下：</p>





























<table><thead><tr><th>时间类型</th><th>未优化</th><th>优化后</th><th>减少幅度</th></tr></thead><tbody><tr><td>P50</td><td>465ms</td><td>428ms</td><td>-37ms (-7.96%)</td></tr><tr><td>P90</td><td>476ms</td><td>438ms</td><td>-38ms (-7.98%)</td></tr><tr><td>P95</td><td>480<br/></td><td>447ms</td><td>-33ms (-6.88%)</td></tr></tbody></table>
<blockquote>
<p>详细的测试数据请看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Ftree%2Ffeature%2Fbaseline-startup-profiles%2Fstart_up_reports" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/tree/feature/baseline-startup-profiles/start_up_reports" ref="nofollow noopener noreferrer">StudyH2g/AndroidStartupOptimizationDemo at feature/baseline-startup-profiles</a></p>
</blockquote>
<h3 data-id="heading-37">4.2 激进优化</h3>
<p>激进优化的效果依赖于设备硬件、系统版本及实时负载，不具备普遍性，并且有一定的兼容性风险与维护成本。建议读者若有意尝试，务必在深入理解其原理的基础上，<strong>在目标设备上建立完善的测试与监控机制</strong>，谨慎评估其实际收益。</p>
<blockquote>
<p>注： 本节中提到的绑定CPU大核、抑制GC等实现思路与代码示例，主要参考了《Android性能优化之道：从底层原理到一线实践》一书中的方案。<br/>
想过这小节应该叫激进优化还是进阶优化，但考虑到此小节优化方法不具备普遍性，因此还是选择了激进优化。请读者一定要在充分验证后，再考虑上生产环境，并做好相应的兜底策略。</p>
</blockquote>
<h4 data-id="heading-38">4.2.1 <strong>绑定CPU大核</strong></h4>
<p>原理部分就简单说下，读取 /sys/devices/system/cpu/cpu/cpufreq/cpuinfo_max_freq 文件来比较每个核心的最大频率，就可以拿到最高频率的 CPU 核心索引，然后通过 sched_setaffinity 将主线程绑定到 CPU 大核上。</p>
<p>我们就着重看实现部分</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-comment">/**
 * 获取最高频率的 CPU 核心索引（大核）
 * 通过读取 /sys/devices/system/cpu/cpu/cpufreq/cpuinfo_max_freq 文件来比较每个核心的最大频率
 *
 * @param env JNI 环境
 * @param clazz Java 类对象
 * @return 最高频率核心的索引, 如果获取失败则返回 -1
 */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">JNIEXPORT jint JNICALL
<span class="hljs-title">Java_com_studyh2g_androidstartupoptimizationdemo_jni_JniHelper_getMaxFreqCpuIndex</span><span class="hljs-params">(
        JNIEnv* env,
        jclass clazz)</span> </span>{
    <span class="hljs-comment">// 统计 CPU 核心数量</span>
    <span class="hljs-type">int</span> cores = <span class="hljs-number">0</span>;
    DIR *dir;
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dirent</span> *ent;
    <span class="hljs-keyword">if</span>((dir = <span class="hljs-built_in">opendir</span>(<span class="hljs-string">"/sys/devices/system/cpu"</span>)) != <span class="hljs-literal">NULL</span>) {
        <span class="hljs-keyword">while</span>((ent = <span class="hljs-built_in">readdir</span>(dir)) != <span class="hljs-literal">NULL</span>) {
            std::string path = ent-&gt;d_name;
            <span class="hljs-comment">// 查找以 "cpu" 开头的目录</span>
            <span class="hljs-keyword">if</span>(path.<span class="hljs-built_in">find</span>(<span class="hljs-string">"cpu"</span>) == <span class="hljs-number">0</span>) {
                <span class="hljs-type">bool</span> isCore = <span class="hljs-literal">true</span>;
                <span class="hljs-comment">// 检查 "cpu" 后面是否全是数字（排除 cpufreq、cpuidle 等非核心目录）</span>
                <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">3</span>; i &lt; path.<span class="hljs-built_in">length</span>(); i++) {
                    <span class="hljs-keyword">if</span>(path[i] &lt; <span class="hljs-string">'0'</span> || path[i] &gt; <span class="hljs-string">'9'</span>) {
                        isCore = <span class="hljs-literal">false</span>;
                        <span class="hljs-keyword">break</span>;
                    }
                }
                <span class="hljs-keyword">if</span>(isCore) {
                    cores++;
                }
            }
        }
        <span class="hljs-built_in">closedir</span>(dir);
    }
    <span class="hljs-comment">// 遍历所有核心，找出最高频率的核心</span>
    <span class="hljs-type">int</span> maxFreq = <span class="hljs-number">-1</span>;
    <span class="hljs-type">int</span> maxFreqCoreIndex = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">if</span> (cores != <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; cores; i++) {
            <span class="hljs-comment">// 读取每个核心的最大频率文件</span>
            std::string filename = <span class="hljs-string">"/sys/devices/system/cpu/cpu"</span> + std::<span class="hljs-built_in">to_string</span>(i) + <span class="hljs-string">"/cpufreq/cpuinfo_max_freq"</span>;
            <span class="hljs-function">std::ifstream <span class="hljs-title">cpuInfoMaxFreqFile</span><span class="hljs-params">(filename)</span></span>;
            <span class="hljs-keyword">if</span> (cpuInfoMaxFreqFile.<span class="hljs-built_in">is_open</span>()) {
                std::string line;
                <span class="hljs-keyword">if</span> (std::<span class="hljs-built_in">getline</span>(cpuInfoMaxFreqFile, line)) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-type">int</span> freqBound = std::<span class="hljs-built_in">stoi</span>(line);
                        <span class="hljs-keyword">if</span> (freqBound &gt; maxFreq) {
                            maxFreq = freqBound;
                            maxFreqCoreIndex = i;
                        }
                    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::invalid_argument&amp; e) {
                        <span class="hljs-comment">// 频率值解析失败，跳过</span>
                    }
                }
                cpuInfoMaxFreqFile.<span class="hljs-built_in">close</span>();
            }
        }
    }
    <span class="hljs-keyword">return</span> maxFreqCoreIndex;
}

<span class="hljs-comment">/**
 * 将当前线程绑定到指定的 CPU 核心
 * 绑定后，当前线程只会在指定的核心上运行，可以利用大核提升性能
 *
 * @param env JNI 环境
 * @param clazz Java 类对象
 * @param coreNum 要绑定的 CPU 核心索引
 */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL
<span class="hljs-title">Java_com_studyh2g_androidstartupoptimizationdemo_jni_JniHelper_bindToCore</span><span class="hljs-params">(
        JNIEnv* env,
        jclass clazz,
        jint coreNum)</span> </span>{
    <span class="hljs-type">cpu_set_t</span> mask;
    <span class="hljs-comment">// 清空 CPU 集合</span>
    <span class="hljs-built_in">CPU_ZERO</span>(&amp;mask);
    <span class="hljs-comment">// 将指定核心加入集合</span>
    <span class="hljs-built_in">CPU_SET</span>(coreNum, &amp;mask);
    <span class="hljs-comment">// 获取当前线程 ID</span>
    <span class="hljs-type">pid_t</span> tid = <span class="hljs-built_in">gettid</span>();
    <span class="hljs-comment">// 设置线程的 CPU 亲和性（绑定到指定核心）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sched_setaffinity</span>(tid, <span class="hljs-built_in">sizeof</span>(mask), &amp;mask) == <span class="hljs-number">-1</span>) {
        <span class="hljs-comment">// 绑定失败</span>
    }
}

<span class="hljs-comment">/**
 * 获取当前线程绑定的 CPU 核心列表
 * 返回当前线程允许运行的所有 CPU 核心
 *
 * @param env JNI 环境
 * @param clazz Java 类对象
 * @return CPU 核心列表的字符串，如 "Current CPU affinity: 0 1 2 3 4 5 6 7 "
 */</span>
<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">JNIEXPORT jstring JNICALL
<span class="hljs-title">Java_com_studyh2g_androidstartupoptimizationdemo_jni_JniHelper_getBoundCores</span><span class="hljs-params">(
        JNIEnv* env,
        jclass clazz)</span> </span>{
    <span class="hljs-type">cpu_set_t</span> mask;
    <span class="hljs-comment">// 获取当前线程 ID</span>
    <span class="hljs-type">pid_t</span> tid = <span class="hljs-built_in">gettid</span>();
    <span class="hljs-comment">// 获取当前线程绑定的 CPU 核心列表（失败则返回错误）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">sched_getaffinity</span>(tid, <span class="hljs-built_in">sizeof</span>(mask), &amp;mask) == <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(<span class="hljs-string">"Failed to get affinity"</span>);
    }
    std::string result = <span class="hljs-string">"Current CPU affinity: "</span>;
    <span class="hljs-comment">// 遍历所有可能的 CPU 核心</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; CPU_SETSIZE; i++) {
        <span class="hljs-comment">// 检查该核心是否在绑定集合中</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">CPU_ISSET</span>(i, &amp;mask)) {
            result += std::<span class="hljs-built_in">to_string</span>(i) + <span class="hljs-string">" "</span>;
        }
    }
    <span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(result.<span class="hljs-built_in">c_str</span>());
}
</code></pre>
<p>然后在启动的Activity#attachBaseContext中调用方法就可以了</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">/**
 * 在应用启动的最早时机将主线程绑定到 CPU 大核
 *
 * attachBaseContext 是 Activity 生命周期中最早执行的回调，此时主线程还未开始执行繁重的初始化工作。
 * 将主线程绑定到大核可以充分利用大核的高性能，减少启动耗时。
 *
 * <span class="hljs-doctag">@param</span> newBase 新的 Context 基对象
 */</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachBaseContext</span><span class="hljs-params">(newBase: <span class="hljs-type">Context</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.attachBaseContext(newBase)
    <span class="hljs-comment">// 打印绑定前的 CPU 核心列表（用于验证）</span>
    Log.d(tag, <span class="hljs-string">"attachBaseContext before: <span class="hljs-subst">${JniHelper.getBoundCores()}</span>"</span>)
    <span class="hljs-comment">// 获取最高频率的 CPU 核心索引（大核）</span>
    <span class="hljs-keyword">val</span> maxFreqCpuIndex = JniHelper.getMaxFreqCpuIndex()
    <span class="hljs-keyword">if</span> (maxFreqCpuIndex != -<span class="hljs-number">1</span>) {
        <span class="hljs-comment">// 将主线程绑定到大核</span>
        JniHelper.bindToCore(maxFreqCpuIndex)
        <span class="hljs-comment">// 打印绑定后的 CPU 核心列表（用于验证绑定是否成功）</span>
        Log.d(tag, <span class="hljs-string">"attachBaseContext after: <span class="hljs-subst">${JniHelper.getBoundCores()}</span>"</span>)
    }
}
</code></pre>
<p>日志如下：<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/502fde811c2544f4bdd9d65f8976bbf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=uF3Fn1armpaIQBPjWd%2B%2FIdFBmUc%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>读者可拉取 feature/aggressive-bind-cpu 分支代码运行看看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Ftree%2Ffeature%2Faggressive-bind-cpu" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/tree/feature/aggressive-bind-cpu" ref="nofollow noopener noreferrer">StudyH2g/AndroidStartupOptimizationDemo at feature/aggressive-bind-cpu</a>； 如对JNI接触较少，可参阅<a href="https://juejin.cn/post/7521250344129429556" target="_blank" title="https://juejin.cn/post/7521250344129429556">Android JNI入门：从基础注册到集成第三方So库及源码分析</a></p>
</blockquote>
<p>现在主线程已经绑定到了 CPU 大核，但如果主线程一直绑定到 CPU 大核上，那么可能会<strong>导致功耗异常和系统调度问题</strong>，后续可以找一个恰当的时机解除绑定。</p>
<h4 data-id="heading-39">4.2.2 <strong>抑制GC</strong></h4>
<p>在启动期间抑制垃圾回收（GC）理论上可以减少因GC事件导致的线程停顿（Stop-The-World），从而优化TTID。这通常需要通过 Inline Hook（如使用 ShadowHook 库）拦截ART运行时中触发并发GC的关键函数（如ConcurrentGCTask::Run）来实现。</p>
<p>具体代码如下</p>
<pre><code class="hljs language-C++" lang="C++"><span class="hljs-type">static</span> <span class="hljs-type">void</span>* g_hook_stub = <span class="hljs-literal">nullptr</span>;

<span class="hljs-comment">// Hook 函数</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">newFunc</span><span class="hljs-params">(<span class="hljs-type">void</span>* self)</span> </span>{
    <span class="hljs-built_in">SHADOWHOOK_STACK_SCOPE</span>();
    <span class="hljs-comment">// 休眠2秒</span>
    <span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>);
    <span class="hljs-comment">// 执行原来的 Run 方法</span>
    <span class="hljs-built_in">SHADOWHOOK_CALL_PREV</span>(newFunc, self);
}

<span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">JNIEXPORT jboolean JNICALL
<span class="hljs-title">Java_com_xxx_xxx_MainActivity_initGCHookNative</span><span class="hljs-params">(
        JNIEnv* env,
        jobject <span class="hljs-comment">/* this */</span>)</span> </span>{
    <span class="hljs-keyword">if</span> (g_hook_stub != <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-keyword">return</span> JNI_TRUE;
    }

    <span class="hljs-comment">// 开启调试日志</span>
    <span class="hljs-built_in">shadowhook_set_debuggable</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-comment">// 初始化 ShadowHook</span>
    <span class="hljs-type">int</span> ret = <span class="hljs-built_in">shadowhook_init</span>(SHADOWHOOK_MODE_SHARED, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span> &amp;&amp; ret != <span class="hljs-number">2</span>) {
        <span class="hljs-built_in">LOGE</span>(<span class="hljs-string">"ShadowHook init failed: %d"</span>, ret);
        <span class="hljs-keyword">return</span> JNI_FALSE;
    }

    <span class="hljs-built_in">LOGI</span>(<span class="hljs-string">"ShadowHook initialized successfully"</span>);

    <span class="hljs-comment">// 使用 shadowhook_hook_sym_name</span>
    g_hook_stub = <span class="hljs-built_in">shadowhook_hook_sym_name</span>(
            <span class="hljs-string">"libart.so"</span>,
            <span class="hljs-string">"_ZN3art2gc4Heap16ConcurrentGCTask3RunEPNS_6ThreadE"</span>,
            <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">void</span>*&gt;(&amp;newFunc),
            <span class="hljs-literal">nullptr</span>
    );

    <span class="hljs-keyword">if</span> (g_hook_stub == <span class="hljs-literal">nullptr</span>) {
        <span class="hljs-type">int</span> error_num = <span class="hljs-built_in">shadowhook_get_errno</span>();
        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* error_msg = <span class="hljs-built_in">shadowhook_to_errmsg</span>(error_num);
        <span class="hljs-built_in">LOGE</span>(<span class="hljs-string">"Hook failed: %d - %s"</span>, error_num, error_msg);
        <span class="hljs-keyword">return</span> JNI_FALSE;
    }

    <span class="hljs-type">int</span> error_num = <span class="hljs-built_in">shadowhook_get_errno</span>();
    <span class="hljs-keyword">if</span> (error_num == <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">LOGI</span>(<span class="hljs-string">"GC Hook successful!"</span>);
        <span class="hljs-keyword">return</span> JNI_TRUE;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error_num == <span class="hljs-number">1</span>) {
        <span class="hljs-built_in">LOGI</span>(<span class="hljs-string">"GC Hook pending (libart.so not loaded yet)"</span>);
        <span class="hljs-keyword">return</span> JNI_TRUE;
    }

    <span class="hljs-keyword">return</span> JNI_FALSE;
}
</code></pre>
<p>本小节代码请不要用于生产环境，是用于展示一种优化启动速度的方式，请读者一定要在充分测试的情况下，再考虑用抑制 GC 的方式。</p>
<blockquote>
<p>ShadowHook详细使用方法请阅读 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbytedance%2Fandroid-inline-hook%2Fblob%2Fmain%2Fdoc%2Fmanual.zh-CN.md" target="_blank" title="https://github.com/bytedance/android-inline-hook/blob/main/doc/manual.zh-CN.md" ref="nofollow noopener noreferrer">shadowhook 手册</a></p>
</blockquote>
<h4 data-id="heading-40">4.2.3 <strong>提高核心线程优先级</strong></h4>
<p>Android 5开始，主线程负责测量和布局，渲染则由独立的渲染线程（RenderThread）负责。理论上，提高这两个线程的优先级可以让它们获得更多CPU时间，从而加速启动。</p>
<h5 data-id="heading-41">实现原理</h5>
<ol>
<li><strong>主线程</strong>：在 <strong>attachBaseContext</strong> 中直接设置优先级</li>
<li><strong>渲染线程</strong>：需要先获取其线程ID（TID），然后设置优先级</li>
</ol>
<h5 data-id="heading-42">关键代码实现</h5>
<p><strong>1. 提高主线程优先级</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachBaseContext</span><span class="hljs-params">(newBase: <span class="hljs-type">Context</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.attachBaseContext(newBase)
    Process.setThreadPriority(startupPriority)
}
</code></pre>
<p><strong>2. 提高渲染线程优先级的两种方案</strong></p>
<p><strong>方案1：主动轮询（更早设置）</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">/**
 * 方案1：通过多次尝试主动查找 RenderThread 来设置优先级
 * 在 RenderThread 创建之前的任何时机都可能调用，如果找不到就定时重试
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">trySetupRenderThreadPriority</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 条件：最多尝试x次，且未设置成功</span>
    <span class="hljs-keyword">if</span> (renderThreadSetupAttempt++ &lt; attemptTimes &amp;&amp; !renderThreadPrioritySet) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> tid = getRenderThreadTid()
            <span class="hljs-keyword">if</span> (tid != -<span class="hljs-number">1</span>) {
                Process.setThreadPriority(tid, startupPriority)
                renderThreadPrioritySet = <span class="hljs-literal">true</span>
                Log.d(tag, <span class="hljs-string">"方案1：成功设置渲染线程优先级: <span class="hljs-variable">$startupPriority</span> (第<span class="hljs-subst">${renderThreadSetupAttempt}</span>次尝试)"</span>)
                <span class="hljs-comment">// 成功设置后，可设置一个较晚的兜底恢复（如5秒后），确保系统健康</span>
                handler.postDelayed({ safelyResetPriority() }, <span class="hljs-number">5000</span>)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 如果没找到，16ms后重试（约一帧时间）</span>
                handler.postDelayed(::trySetupRenderThreadPriority, <span class="hljs-number">16</span>)
                Log.d(tag, <span class="hljs-string">"方案1：第<span class="hljs-subst">${renderThreadSetupAttempt}</span>次尝试：未找到渲染线程，稍后重试"</span>)
            }
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            Log.e(tag, <span class="hljs-string">"方案1：设置渲染线程优先级时发生异常"</span>, e)
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!renderThreadPrioritySet) {
        Log.w(tag, <span class="hljs-string">"方案1：已达到最大尝试次数，未能设置渲染线程优先级"</span>)
    }
}
<span class="hljs-comment">// 在onCreate中调用</span>
</code></pre>
<p><strong>方案2：等待首帧绘制后（更可靠）</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin">window.decorView.viewTreeObserver.addOnPreDrawListener {
    <span class="hljs-keyword">val</span> tid = getRenderThreadTid()
    <span class="hljs-keyword">if</span> (tid != -<span class="hljs-number">1</span>) {
        Process.setThreadPriority(tid, startupPriority)
    }
}
</code></pre>
<p><strong>3. 恢复优先级</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">restorePriorities</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 恢复主线程</span>
    Process.setThreadPriority(Process.THREAD_PRIORITY_DEFAULT)
    
    <span class="hljs-comment">// 恢复渲染线程</span>
    <span class="hljs-keyword">val</span> tid = getRenderThreadTid()
    <span class="hljs-keyword">if</span> (tid != -<span class="hljs-number">1</span>) {
        Process.setThreadPriority(tid, Process.THREAD_PRIORITY_DEFAULT)
    }
}
<span class="hljs-comment">// 在首帧绘制完成后调用</span>
</code></pre>
<p><strong>4. 获取渲染线程TID的工具函数</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">import</span> android.os.Process
<span class="hljs-keyword">import</span> java.io.BufferedReader
<span class="hljs-keyword">import</span> java.io.File
<span class="hljs-keyword">import</span> java.io.FileReader

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getRenderThreadTid</span><span class="hljs-params">()</span></span> : <span class="hljs-built_in">Int</span> {
   <span class="hljs-keyword">val</span> taskParentDir = File(<span class="hljs-string">"/proc/"</span> + Process.myPid() + <span class="hljs-string">"/task/"</span>)
   <span class="hljs-keyword">if</span> (taskParentDir.isDirectory()) {
       <span class="hljs-keyword">val</span> taskFiles = taskParentDir.listFiles()
       taskFiles?.let {
           <span class="hljs-keyword">for</span> (taskFile <span class="hljs-keyword">in</span> it) {
               <span class="hljs-keyword">var</span> br : BufferedReader? = <span class="hljs-literal">null</span>
               <span class="hljs-keyword">var</span> line: String?
               <span class="hljs-keyword">try</span> {
                   br = BufferedReader(FileReader(taskFile.getPath() + <span class="hljs-string">"/stat"</span>), <span class="hljs-number">100</span>)
                   line = br.readLine()
                   <span class="hljs-keyword">if</span> (line.isNotEmpty()) {
                       <span class="hljs-keyword">val</span> param = line.split(<span class="hljs-string">" "</span>)
                       <span class="hljs-keyword">if</span> (param.size &lt; <span class="hljs-number">2</span>) {
                           <span class="hljs-keyword">continue</span>
                       }
                       <span class="hljs-keyword">val</span> threadName: String = param[<span class="hljs-number">1</span>]
                       <span class="hljs-keyword">if</span> (threadName.contains(<span class="hljs-string">"RenderThread"</span>)) {
                           <span class="hljs-keyword">return</span> param[<span class="hljs-number">0</span>].toInt()
                       }
                   }
               } <span class="hljs-keyword">catch</span> (e : Exception) {

               } <span class="hljs-keyword">finally</span> {
                   br?.close()
               }
           }
       }
   }
   <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
}
</code></pre>
<p>再次提醒，使用激进优化中的手段时，请进行充分的测试后，再考虑上生产环境。</p>
<blockquote>
<p>详细代码请参阅<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FStudyH2g%2FAndroidStartupOptimizationDemo%2Ftree%2Ffeature%2Faggressive-thread-priority" target="_blank" title="https://github.com/StudyH2g/AndroidStartupOptimizationDemo/tree/feature/aggressive-thread-priority" ref="nofollow noopener noreferrer">StudyH2g/AndroidStartupOptimizationDemo at feature/aggressive-thread-priority</a></p>
</blockquote>
<h3 data-id="heading-43">4.3 优化用户感官体验</h3>
<p>需要说明的是，此种方式<strong>不会优化启动速度</strong>，只是优化用户感官体验。</p>
<h4 data-id="heading-44">4.3.1 主题切换: 优化空白Window</h4>
<p>在启动流程中，会显示一个空白窗口。时序图如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ccfadc265db4a1e8cb119fc2fd6b370~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=9rxj0qtrLTgZJpig7RnLGNfFxzc%3D" alt="image.png" loading="lazy"/></p>
<p>ActivityStarter#recycleTask代码如下</p>
<pre><code class="hljs language-Java" lang="Java">    <span class="hljs-comment">// ActivityStarter#recycleTask</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">recycleTask</span><span class="hljs-params">()</span> {
        ...
        <span class="hljs-keyword">if</span> (mMovedToFront) {
            <span class="hljs-comment">// 冷启动 mMovedToFront 为 true, 显示空白窗口</span>
            targetTaskTop.showStartingWindow(<span class="hljs-literal">true</span> <span class="hljs-comment">/* taskSwitch */</span>);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mDoResume) {
            <span class="hljs-comment">// Make sure the root task and its belonging display are moved to topmost.</span>
            mTargetRootTask.moveToFront(<span class="hljs-string">"intentActivityFound"</span>);
        }
        ...
    }
</code></pre>
<p>它的调用是在 Application#onCreate 之前的。我们可以用一张图片来替换掉这个空白Window，从而避免白屏，让用户体验更好。那么下面就详细说明具体做法：</p>
<p>首先定义要显示的图片</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">layer-list</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">android:drawable</span>=<span class="hljs-string">"@android:color/white"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">bitmap</span>
            <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
            <span class="hljs-attr">android:src</span>=<span class="hljs-string">"@drawable/ic_xxx"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">layer-list</span>&gt;</span>
</code></pre>
<p>再定义启动的主题</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Theme.Launcher"</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">"android:Theme.Material.Light.NoActionBar"</span> &gt;</span><span class="xml">
    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"android:windowBackground"</span>&gt;</span>@drawable/ic_start_xxx<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>后续将Manifest中的主题替换为启动主题</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">application</span>
        <span class="hljs-attr">...</span>
        <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/Theme.Launcher"</span>&gt;</span>
        ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>最后我们在启动的首个 Activity#onCreate，设置为原本的主题，注意要<strong>在 super.onCreate 之前</strong>。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-comment">// 设置为原本的主题</span>
        setTheme(R.style.Theme_xxx)
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        enableEdgeToEdge()
        setContent {
            xxx
        }
    }
}
</code></pre>
<p>这样做了之后，这个空白window就会变成我们设置的图片了。</p>
<p><strong>使用</strong>主题切换优化空白弹窗效果：<br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5df355f3d64e4cbd3eea010e30add2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=wWF%2BqfX2I8OmI8fSBcypw836Xqo%3D" alt="demo (online-video-cutter.com).gif" loading="lazy"/><br/>
为了更好的看优化效果，此处延迟了1.5S显示内容</p>
<p>再次提醒，这种方式仅仅优化了空白window，并<strong>不会优化启动速度</strong>。</p>
<h4 data-id="heading-45">4.3.2 骨架屏</h4>
<p>骨架屏就是正常页面的不带数据显示的空白版本，一般会使用灰色块来显示大体的外形。通过使用骨架屏，我们可以优化用户感官体验，从而提高用户的留存率和日活。</p>
<p><strong>骨架屏的实现根据对视觉还原度的要求，分为两种：</strong> 模块式骨架屏、真实UI式骨架屏</p>
<h5 data-id="heading-46">模块式骨架屏</h5>
<p>侧重于内容模块的<strong>布局位置</strong>，使用简单的灰色色块构成页面框架。其优势在于实现简单、复用性高，可以快速提升用户感官体验。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d1176182c8b4c6484a947f628d5ae13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=SACNzjVr2khHI17%2FSXZJnF86%2FUM%3D" alt="modelScreen.gif" loading="lazy"/></p>
<h5 data-id="heading-47">真实UI式骨架屏</h5>
<p>在内容加载前，显示与最终界面<strong>高度一致的视觉样式</strong>，包括图标、间距等细节。这种方案能提供丝滑的过渡体验，但实现和维护成本也相应更高。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ba06e458e3e43758789e88ed3d92495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=ig1CkhuuIu3JaAijYJ1WUnY93rQ%3D" alt="SkeScreen.gif" loading="lazy"/></p>
<p>模块骨架屏和真实UI骨架屏在实现方式上是相同的，只是实现的细节程度的不同。我们就看看怎么实现Compose模块屏</p>
<h5 data-id="heading-48">实现骨架屏</h5>
<p>这里介绍下带闪烁效果的骨架屏，直接看代码吧</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shimmerBrush</span><span class="hljs-params">()</span></span>: Brush {
    <span class="hljs-comment">// 定义渐变色</span>
    <span class="hljs-keyword">val</span> gradient = listOf(
        Color.LightGray.copy(alpha = <span class="hljs-number">0.6f</span>),
        Color.LightGray.copy(alpha = <span class="hljs-number">0.2f</span>),
        Color.LightGray.copy(alpha = <span class="hljs-number">0.6f</span>)
    )
    <span class="hljs-comment">// 创建无限平移的动画</span>
    <span class="hljs-keyword">val</span> transition = rememberInfiniteTransition(label = <span class="hljs-string">"shimmer"</span>)
    <span class="hljs-keyword">val</span> translateAnimation = transition.animateFloat(
        initialValue = <span class="hljs-number">0f</span>,
        targetValue = <span class="hljs-number">1000f</span>,
        animationSpec = infiniteRepeatable(
            animation = tween(durationMillis = <span class="hljs-number">1000</span>, easing = LinearEasing),
            repeatMode = RepeatMode.Restart
        ),
        label = <span class="hljs-string">"shimmerTranslation"</span>
    )
    <span class="hljs-comment">// 返回计算好的 Brush</span>
    <span class="hljs-keyword">return</span> Brush.linearGradient(
        colors = gradient,
        start = Offset(x = translateAnimation.value - <span class="hljs-number">500</span>, y = <span class="hljs-number">0f</span>),
        end = Offset(x = translateAnimation.value, y = <span class="hljs-number">100f</span>)
    )
}
</code></pre>
<p>上面我们就定义好了一个从左到右的渐变的闪烁效果。然后我们只要在Modifier.
drawWithCache使用它就可以了，如下：</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SkeletonBox</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> shimmerBrush = shimmerBrush()

    Box(
        modifier = Modifier
            .fillMaxWidth()
            .height(<span class="hljs-number">62.</span>dp)
            .clip(RoundedCornerShape(<span class="hljs-number">60</span>))
            .drawWithCache {
                onDrawBehind { drawRect(brush = shimmerBrush) }
            }
    )
}
</code></pre>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/610d8045835344a198e7caa4687dc8b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWJ5YWJ6Les5q2l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770973656&amp;x-signature=SeWDZavzpvCdmraW%2BC6PG2EYlFw%3D" alt="Screen_recording_20260130_143741 (online-video-cutter.com).gif" loading="lazy"/></p>
<p>我们现在就已经实现了一个带闪烁效果的按钮了。由于页面布局各异，核心是实现 shimmerBrush 并应用于Modifier。大家可根据自身UI结构复用此方法。</p>
<p>而在页面中肯定会有多个组件，我们可以通过状态提升，共用一个shimmerBrush</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SkeletonModel</span><span class="hljs-params">(navController: <span class="hljs-type">NavController</span>)</span></span> {
    <span class="hljs-comment">// 共用 shimmerBrush</span>
    <span class="hljs-keyword">val</span> shimmerBrush = shimmerBrush()
    Column(modifier = Modifier
        .padding(horizontal = <span class="hljs-number">16.</span>dp)
        .verticalScroll(rememberScrollState())
    ) {
        Spacer(modifier = Modifier.height(<span class="hljs-number">12.</span>dp))
        <span class="hljs-comment">// 1</span>
        ProductBrushItem(shimmerBrush)
        Spacer(modifier = Modifier.height(<span class="hljs-number">12.</span>dp))
        <span class="hljs-comment">// 2</span>
        AmountBrushItem(shimmerBrush)
        Spacer(modifier = Modifier.height(<span class="hljs-number">12.</span>dp))
        <span class="hljs-comment">// 3</span>
        ButtonBrushItem(shimmerBrush)
    }
}
</code></pre>
<p>还有一点是，页面中数据加载前后，组件没有变化 或 有明确含义的，可以直接用它们 或 它们代表的含义。比如上面示例 App 中，Choose a loan product文案，按钮下面的 Terms &amp; Service and Privacy Policy都直接用的它们，因为加载数据前后无变化，而min amount 和 max amount则是选择产品的最小/大值的含义。</p>
<p>最后说说选择页面的准则：个人认为应优先选择用户日常使用中，最频繁的那个页面（比如购物软件的首页），而次级的页面，可以先实现模块级骨架屏，后续再考虑改进。</p>
<h2 data-id="heading-49">五、总结</h2>
<p>优化冷启动， 可以按<strong>测量-分析-优化-验证</strong> 这样的环节去进行</p>
<ul>
<li><strong>测量</strong>：分清TTID（第一帧）与TTFD（可交互），用可靠工具（如脚本）获取优化前后数据。</li>
<li><strong>分析</strong>：弄清楚冷启动涉及到的所有环节，即<strong>代码层、编译层、体验层、系统层</strong> 。</li>
<li><strong>优化</strong>：分层优化，建议先从收敛Provider、初始化优化和任务调度做起，务必用上基准配置和启动配置；推荐使用感官优化手段；激进方式请慎重评估场景与风险，并进行充分测试后再考虑使用。</li>
<li><strong>验证</strong>：对优化前后进行测试，验证优化效果。<strong>（在我主导的项目中，通过实践这一闭环，我们将冷启动的P50时间成功降低了24%。）</strong></li>
</ul>
<p>感谢阅读，希望本文对你有所帮助，<strong>如有任何不对的地方，欢迎大家指正</strong>。</p>
<h2 data-id="heading-50">六、参考资料</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fperformance%2Fvitals%2Flaunch-time%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.google.cn/topic/performance/vitals/launch-time?hl=zh-cn" ref="nofollow noopener noreferrer">应用启动时间</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Fperformance%2Fbenchmarking%2Fmacrobenchmark-overview%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.google.cn/topic/performance/benchmarking/macrobenchmark-overview?hl=zh-cn" ref="nofollow noopener noreferrer">Jetpack Macrobenchmark</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.google.cn%2Ftopic%2Flibraries%2Fapp-startup%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.google.cn/topic/libraries/app-startup?hl=zh-cn" ref="nofollow noopener noreferrer">App Startup</a></li>
<li>《Android性能优化之道：从底层原理到一线实践》</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FvW6-zag2CKrFgcYAPdeUFg" target="_blank" title="https://mp.weixin.qq.com/s/vW6-zag2CKrFgcYAPdeUFg" ref="nofollow noopener noreferrer">App冷启动优化测试干货分享（一）</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoding.imooc.com%2Fclass%2F308.html" target="_blank" title="https://coding.imooc.com/class/308.html" ref="nofollow noopener noreferrer">Top团队大牛带你玩转Android性能分析与优化</a></li>
<li><a href="https://juejin.cn/post/7287083662758379554" target="_blank" title="https://juejin.cn/post/7287083662758379554">常用 JSON 库性能对比: Gson VS Moshi VS Kotlin Serialization VS ...</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Subscription 管理]]></title>    <link>https://juejin.cn/post/7603321550247149618</link>    <guid>https://juejin.cn/post/7603321550247149618</guid>    <pubDate>2026-02-06T09:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603321550247149618" data-draft-id="7603359026711330826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Subscription 管理"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-06T09:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Subscription 管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:17:50.000Z" title="Fri Feb 06 2026 09:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 核心概念</h3>
<h4 data-id="heading-1">什么是 Subscription（订阅）？</h4>
<p><strong>Subscription</strong> 是对设备上单个 SIM 卡或 eSIM 的逻辑表示。每个 Subscription 都有一个唯一的 <strong>SubId</strong>（Subscription ID），用来标识该订阅在系统中的身份。</p>
<p>关键概念：</p>
<ul>
<li><strong>SubId</strong>：订阅的逻辑标识符（整数），用于应用层和框架层通信</li>
<li><strong>PhoneId</strong>：物理调制解调器的索引，也称为逻辑 SIM 卡槽索引</li>
<li><strong>IccId</strong>：SIM 卡的集成电路卡标识符（集成电路卡号）</li>
<li><strong>Active Subscription</strong>：当前在 SIM 卡槽中加载并可用的订阅</li>
</ul>
<h4 data-id="heading-2">Subscription 的类型</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 本地 SIM：物理 SIM 或 eSIM</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUBSCRIPTION_TYPE_LOCAL_SIM</span> <span class="hljs-operator">=</span> SimInfo.SUBSCRIPTION_TYPE_LOCAL_SIM;

<span class="hljs-comment">// 远程 SIM：通过蓝牙等连接的外部设备的 SIM</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SUBSCRIPTION_TYPE_REMOTE_SIM</span> <span class="hljs-operator">=</span> SimInfo.SUBSCRIPTION_TYPE_REMOTE_SIM;
</code></pre>
<h3 data-id="heading-3">2. 核心数据模型</h3>
<h4 data-id="heading-4">SubscriptionInfo（公开 API 类）</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">38</span>:<span class="hljs-number">65</span>:frameworks_base/telephony/java/android/telephony/SubscriptionInfo.java
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mId;                           <span class="hljs-comment">// SubId</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mIccId;                     <span class="hljs-comment">// SIM 卡号</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mSimSlotIndex;                 <span class="hljs-comment">// SIM 槽位索引</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CharSequence mDisplayName;         <span class="hljs-comment">// 用户显示名称</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CharSequence mCarrierName;         <span class="hljs-comment">// 运营商名称</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mDisplayNameSource;            <span class="hljs-comment">// 显示名称来源</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mIconTint;                     <span class="hljs-comment">// 图标颜色</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mNumber;                    <span class="hljs-comment">// 电话号码</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mDataRoaming;                  <span class="hljs-comment">// 数据漫游设置</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mMcc;                       <span class="hljs-comment">// 移动国家代码</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mMnc;                       <span class="hljs-comment">// 移动网络代码</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> mIsEmbedded;               <span class="hljs-comment">// 是否为 eSIM</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ParcelUuid mGroupUuid;             <span class="hljs-comment">// 订阅组 UUID</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mCarrierId;                    <span class="hljs-comment">// 运营商 ID</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> mIsOpportunistic;          <span class="hljs-comment">// 是否为机会性订阅</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> mAreUiccApplicationsEnabled;  <span class="hljs-comment">// UICC 应用是否启用</span>
</code></pre>
<h4 data-id="heading-5">SubscriptionInfoInternal（内部使用）</h4>
<p>这是框架内部使用的模型，完全对应 <code>SimInfo</code> 数据库表的每一列。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">318</span>:<span class="hljs-number">410</span>:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionInfoInternal.java
<span class="hljs-comment">// 包含所有数据库字段，如 IMSI、RCS 配置、网络类型权限等</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mImsi;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mEnabledMobileDataPolicies;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mIsRcsUceEnabled;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> mIsCrossSimCallingEnabled;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] mRcsConfig;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> mAllowedNetworkTypesForReasons;
<span class="hljs-comment">// ... 更多字段</span>
</code></pre>
<h3 data-id="heading-6">3. Subscription 数据库</h3>
<h4 data-id="heading-7">SimInfo 表</h4>
<p>所有订阅信息存储在 <code>TelephonyProvider</code> 的 <code>SimInfo</code> 表中，内容 URI 为 <code>content://telephony/siminfo</code>。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">4286</span><span class="hljs-symbol">:</span><span class="hljs-number">4300</span><span class="hljs-symbol">:frameworks_base/core/java/android/provider/Telephony</span>.java
<span class="hljs-keyword">public</span> static final <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimInfo</span> {
    <span class="hljs-keyword">public</span> static final <span class="hljs-title class_">Uri</span> <span class="hljs-variable constant_">CONTENT_URI</span> = <span class="hljs-title class_">Uri</span>.parse(<span class="hljs-string">"content://telephony/siminfo"</span>);
    <span class="hljs-regexp">//</span> 包含 <span class="hljs-number">50</span>+ 列，存储所有订阅相关数据
}
</code></pre>
<h4 data-id="heading-8">SubscriptionDatabaseManager</h4>
<p>负责 <code>SimInfo</code> 表的读写缓存，所有数据库访问都应通过此类进行。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-number">84</span>:<span class="hljs-number">678</span>:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/<span class="hljs-type">SubscriptionDatabaseManager</span>.java
<span class="hljs-comment">/**
 * The subscription database manager is the wrapper of {@link SimInfo} table.
 * It's a full memory cache of the entire subscription database.
 */</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubscriptionDatabaseManager</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Handler</span> </span>{
    <span class="hljs-comment">// 内存缓存，使用读写锁保护</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Integer</span>, <span class="hljs-type">SubscriptionInfoInternal</span>&gt; mAllSubscriptionInfoInternalCache;
}
</code></pre>
<h3 data-id="heading-9">4. Subscription 生命周期</h3>
<h4 data-id="heading-10">4.1 Subscription 发现与创建流程</h4>
<pre><code class="hljs language-scss" lang="scss">                    ┌─────────────────────────────────┐
                    │      UiccController             │
                    │  (UICC 卡管理)                   │
                    └──────────────┬──────────────────┘
                                   │ <span class="hljs-built_in">updateSimState</span>()
                                   ▼
           ┌──────────────────────────────────────────┐
           │   SubscriptionManagerService             │
           │      <span class="hljs-built_in">updateSimState</span>()                     │
           └──────────────┬───────────────────────────┘
                          │
                    <span class="hljs-built_in">updateSubscription</span>()
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
    检查 IccId      查找现有订阅        创建新订阅
    是否存在         (数据库)            (若无则插入)
</code></pre>
<p>关键代码：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">1499</span><span class="hljs-symbol">:</span><span class="hljs-number">1522</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionManagerService</span>.java
<span class="hljs-keyword">if</span> (!<span class="hljs-title class_">TextUtils</span>.isEmpty(iccId)) {
    <span class="hljs-regexp">//</span> 检查订阅是否已存在
    subInfo = mSubscriptionDatabaseManager.getSubscriptionInfoInternalByIccId(iccId);
    int subId;
    <span class="hljs-keyword">if</span> (subInfo == null) {
        <span class="hljs-regexp">//</span> 这是新 <span class="hljs-variable constant_">SIM</span> 卡。插入新记录。
        subId = insertSubscriptionInfo(iccId, phoneId, null,
                <span class="hljs-title class_">SubscriptionManager</span>.<span class="hljs-variable constant_">SUBSCRIPTION_TYPE_LOCAL_SIM</span>);
        <span class="hljs-regexp">//</span> 设置显示名称
        mSubscriptionDatabaseManager.setDisplayName(subId,
                mContext.getResources().getString(R.string.default_card_name, getCardNumber(subId)));
    } <span class="hljs-keyword">else</span> {
        subId = subInfo.getSubscriptionId();
        log(<span class="hljs-string">"Found existing subscription. subId= "</span> + subId + <span class="hljs-string">", phoneId="</span> + phoneId);
    }
    
    /<span class="hljs-regexp">/ 更新 SIM 槽位索引，使订阅变为活跃状态
    if (subInfo != null &amp;&amp; subInfo.areUiccApplicationsEnabled()) {
        mSlotIndexToSubId.put(phoneId, subId);
        mSubscriptionDatabaseManager.setSimSlotIndex(subId, phoneId);
    }
}
</span></code></pre>
<h4 data-id="heading-11">4.2 插入新订阅</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">1092</span><span class="hljs-symbol">:</span><span class="hljs-number">1114</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionManagerService</span>.java
<span class="hljs-keyword">private</span> int insertSubscriptionInfo(<span class="hljs-variable">@NonNull</span> <span class="hljs-title class_">String</span> iccId, int slotIndex,
        <span class="hljs-variable">@Nullable</span> <span class="hljs-title class_">String</span> displayName, <span class="hljs-variable">@SubscriptionType</span> int subscriptionType) {
    <span class="hljs-title class_">String</span> defaultAllowNetworkTypes = <span class="hljs-title class_">Phone</span>.convertAllowedNetworkTypeMapIndexToDbName(...);
    <span class="hljs-title class_">SubscriptionInfoInternal</span>.<span class="hljs-title class_">Builder</span> builder = new <span class="hljs-title class_">SubscriptionInfoInternal</span>.<span class="hljs-title class_">Builder</span>()
            .setIccId(iccId)
            .setCardString(iccId)
            .setSimSlotIndex(slotIndex)
            .setType(subscriptionType)
            .setIconTint(getColor())
            .setAllowedNetworkTypesForReasons(defaultAllowNetworkTypes);
    
    int subId = mSubscriptionDatabaseManager.insertSubscriptionInfo(builder.build());
    <span class="hljs-keyword">return</span> subId;
}
</code></pre>
<h3 data-id="heading-12">5. Subscription 查询与访问</h3>
<h4 data-id="heading-13">5.1 公开 API（SubscriptionManager）</h4>
<p>应用通过 <code>SubscriptionManager</code> 类查询订阅信息：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 获取所有订阅信息</span>
List&lt;SubscriptionInfo&gt; allSubs = subscriptionManager.getAllSubscriptionInfoList();

<span class="hljs-comment">// 获取活跃订阅</span>
List&lt;SubscriptionInfo&gt; activeSubs = subscriptionManager.getActiveSubscriptionInfoList();

<span class="hljs-comment">// 通过 SubId 获取</span>
<span class="hljs-type">SubscriptionInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> subscriptionManager.getActiveSubscriptionInfo(subId);

<span class="hljs-comment">// 获取默认订阅</span>
<span class="hljs-type">int</span> <span class="hljs-variable">defaultDataSubId</span> <span class="hljs-operator">=</span> SubscriptionManager.getDefaultDataSubscriptionId();
<span class="hljs-type">int</span> <span class="hljs-variable">defaultVoiceSubId</span> <span class="hljs-operator">=</span> SubscriptionManager.getDefaultVoiceSubscriptionId();
</code></pre>
<h4 data-id="heading-14">5.2 内部访问（SubscriptionDatabaseManager）</h4>
<p>框架内部通过 <code>SubscriptionDatabaseManager</code> 直接访问数据库：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">2442</span><span class="hljs-symbol">:</span><span class="hljs-number">2463</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionDatabaseManager</span>.java
<span class="hljs-variable">@Nullable</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">SubscriptionInfoInternal</span> getSubscriptionInfoInternal(int subId) {
    mReadWriteLock.readLock().lock();
    try {
        <span class="hljs-keyword">return</span> mAllSubscriptionInfoInternalCache.get(subId);
    } finally {
        mReadWriteLock.readLock().unlock();
    }
}

<span class="hljs-variable">@NonNull</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">SubscriptionInfoInternal</span>&gt; getAllSubscriptions() {
    mReadWriteLock.readLock().lock();
    try {
        <span class="hljs-keyword">return</span> new <span class="hljs-title class_">ArrayList</span>&lt;&gt;(mAllSubscriptionInfoInternalCache.values());
    } finally {
        mReadWriteLock.readLock().unlock();
    }
}
</code></pre>
<h3 data-id="heading-15">6. 默认订阅（Default Subscriptions）</h3>
<h4 data-id="heading-16">6.1 三种默认订阅</h4>
<ul>
<li><strong>Default Voice SubId</strong>：用于语音通话的默认订阅</li>
<li><strong>Default Data SubId</strong>：用于移动数据的默认订阅</li>
<li><strong>Default SMS SubId</strong>：用于 SMS 的默认订阅</li>
</ul>
<h4 data-id="heading-17">6.2 默认值存储</h4>
<p>默认值存储在系统设置（Settings.Global）中：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">489</span><span class="hljs-symbol">:</span><span class="hljs-number">500</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionManagerService</span>.java
mDefaultVoiceSubId = new <span class="hljs-title class_">WatchedInt</span>(<span class="hljs-title class_">Settings</span>.<span class="hljs-title class_">Global</span>.getInt(mContext.getContentResolver(),
        <span class="hljs-title class_">Settings</span>.<span class="hljs-title class_">Global</span>.<span class="hljs-variable constant_">MULTI_SIM_VOICE_CALL_SUBSCRIPTION</span>,
        <span class="hljs-title class_">SubscriptionManager</span>.<span class="hljs-variable constant_">INVALID_SUBSCRIPTION_ID</span>)) {
    <span class="hljs-variable">@Override</span>
    <span class="hljs-keyword">public</span> boolean set(int newValue) {
        int oldValue = mValue;
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">super</span>.set(newValue)) {
            logl(<span class="hljs-string">"Default voice subId changed from "</span> + oldValue + <span class="hljs-string">" to "</span> + newValue);
            <span class="hljs-title class_">Settings</span>.<span class="hljs-title class_">Global</span>.putInt(mContext.getContentResolver(), 
                <span class="hljs-title class_">Settings</span>.<span class="hljs-title class_">Global</span>.<span class="hljs-variable constant_">MULTI_SIM_VOICE_CALL_SUBSCRIPTION</span>, newValue);
            <span class="hljs-regexp">//</span> ... 广播变化
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
};
</code></pre>
<h4 data-id="heading-18">6.3 自动更新默认值</h4>
<p><code>MultiSimSettingController</code> 负责在多卡场景下自动更新默认值：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-number">619</span>:<span class="hljs-number">650</span>:frameworks_opt_telephony/src/java/com/android/<span class="hljs-keyword">internal</span>/telephony/MultiSimSettingController.java
<span class="hljs-comment">/**
 * Automatically update default settings (data / voice / sms).
 * 
 * 1) If the default subscription is still active, keep it unchanged.
 * 2) Or if there's another active primary subscription that's in the same group,
 *    make it the new default value.
 * 3) Or if there's only one active primary subscription, automatically set default
 *    data subscription on it.
 * 4) If none above is met, clear the default value to INVALID.
 */</span>
<span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateDefaults</span>()</span> {
    <span class="hljs-keyword">if</span> (!isReadyToReevaluate()) <span class="hljs-keyword">return</span>;
    
    List&lt;SubscriptionInfo&gt; activeSubInfos = mSubscriptionManagerService
            .getActiveSubscriptionInfoList(...);
    
    <span class="hljs-keyword">if</span> (ArrayUtils.isEmpty(activeSubInfos)) {
        <span class="hljs-comment">// 无活跃订阅，清除默认值</span>
        mSubscriptionManagerService.setDefaultDataSubId(INVALID_SUBSCRIPTION_ID);
        mSubscriptionManagerService.setDefaultVoiceSubId(INVALID_SUBSCRIPTION_ID);
        mSubscriptionManagerService.setDefaultSmsSubId(INVALID_SUBSCRIPTION_ID);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// 自动更新...</span>
}
</code></pre>
<h3 data-id="heading-19">7. 订阅组（Subscription Groups）</h3>
<h4 data-id="heading-20">7.1 订阅组概念</h4>
<p>订阅组用于关联多个订阅（通常是主订阅和机会性订阅），它们共享某些设置。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">200</span>:<span class="hljs-number">240</span>:frameworks_base/telephony/java/com/android/internal/telephony/ISub.aidl
<span class="hljs-comment">/**
 * Inform SubscriptionManager that subscriptions in the list are bundled as a group.
 * Typically it's a primary subscription and an opportunistic subscription.
 * Being in the same group means they might be activated or deactivated together.
 */</span>
<span class="hljs-function">ParcelUuid <span class="hljs-title">createSubscriptionGroup</span><span class="hljs-params">(in <span class="hljs-type">int</span>[] subIdList, <span class="hljs-type">String</span> callingPackage)</span></span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addSubscriptionsIntoGroup</span><span class="hljs-params">(in <span class="hljs-type">int</span>[] subIdList, in ParcelUuid groupUuid,
        <span class="hljs-type">String</span> callingPackage)</span></span>;

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">removeSubscriptionsFromGroup</span><span class="hljs-params">(in <span class="hljs-type">int</span>[] subIdList, in ParcelUuid groupUuid,
        <span class="hljs-type">String</span> callingPackage)</span></span>;

<span class="hljs-function">List&lt;SubscriptionInfo&gt; <span class="hljs-title">getSubscriptionsInGroup</span><span class="hljs-params">(in ParcelUuid groupUuid,
        <span class="hljs-type">String</span> callingPackage, <span class="hljs-type">String</span> callingFeatureId)</span></span>;
</code></pre>
<h4 data-id="heading-21">7.2 组设置同步</h4>
<p>同组内的订阅必须共享相同的数据设置：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">372</span><span class="hljs-symbol">:</span><span class="hljs-number">394</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/MultiSimSettingController</span>.java
/**
 * <span class="hljs-title class_">Make</span> sure <span class="hljs-variable constant_">MOBILE_DATA</span> of subscriptions <span class="hljs-keyword">in</span> same group are synced.
 *<span class="hljs-regexp">/
private void onUserDataEnabled(int subId, boolean enable, boolean setDefaultData) {
    /</span><span class="hljs-regexp">/ 确保同组订阅的 MOBILE_DATA 设置同步
    setUserDataEnabledForGroup(subId, enable);
    
    SubscriptionInfo subInfo = mSubscriptionManagerService.getSubscriptionInfo(subId);
    int defaultDataSubId = mSubscriptionManagerService.getDefaultDataSubId();
    
    /</span><span class="hljs-regexp">/ 如果用户启用了非默认的非机会性订阅，将其设为默认
    if (defaultDataSubId != subId &amp;&amp; subInfo != null &amp;&amp; !subInfo.isOpportunistic() 
            &amp;&amp; enable &amp;&amp; subInfo.isActive() &amp;&amp; setDefaultData) {
        mSubscriptionManagerService.setDefaultDataSubId(subId);
    }
}
</span></code></pre>
<h3 data-id="heading-22">8. 活跃与非活跃订阅</h3>
<h4 data-id="heading-23">8.1 什么是活跃订阅？</h4>
<p>当且仅当以下条件都满足时，订阅才是活跃的：</p>
<ol>
<li><code>SimSlotIndex &gt;= 0</code>（已分配到 SIM 卡槽）</li>
<li>UICC 应用已启用（<code>areUiccApplicationsEnabled() == true</code>）</li>
</ol>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">1517</span><span class="hljs-symbol">:</span><span class="hljs-number">1522</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionManagerService</span>.java
<span class="hljs-keyword">if</span> (subInfo != null &amp;&amp; subInfo.areUiccApplicationsEnabled()) {
    mSlotIndexToSubId.put(phoneId, subId);
    <span class="hljs-regexp">//</span> 更新 <span class="hljs-variable constant_">SIM</span> 槽位索引。这将使订阅变为活跃状态。
    mSubscriptionDatabaseManager.setSimSlotIndex(subId, phoneId);
}
</code></pre>
<h4 data-id="heading-24">8.2 非活跃订阅的 SimSlotIndex</h4>
<p>非活跃订阅的 <code>SimSlotIndex</code> 被设置为 <code>SubscriptionManager.INVALID_SIM_SLOT_INDEX (-1)</code>。</p>
<h3 data-id="heading-25">9. 机会性订阅（Opportunistic Subscriptions）</h3>
<p>机会性订阅是自动选择的订阅，用于特定场景（如某些地区有更便宜的数据计划）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">boolean</span> <span class="hljs-variable">isOpportunistic</span> <span class="hljs-operator">=</span> subscriptionInfo.isOpportunistic();

<span class="hljs-comment">// 机会性订阅不能是默认订阅</span>
<span class="hljs-comment">// 它们通常与主订阅组合使用</span>
</code></pre>
<h3 data-id="heading-26">10. 关键流程：SIM 插入/移除</h3>
<h4 data-id="heading-27">10.1 SIM 插入流程</h4>
<pre><code class="hljs language-scss" lang="scss">                    SIM Card Inserted
                           │
                           ▼
              UiccController detects state
                           │
                           ▼
          UiccController<span class="hljs-selector-class">.updateSimState</span>()
                           │
                           ▼
      SubscriptionManagerService<span class="hljs-selector-class">.updateSimState</span>()
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
        检查 IccId    数据库查询    创建/更新
        是否新 SIM     现有订阅      订阅记录
              │            │            │
              └────────────┼────────────┘
                           ▼
           <span class="hljs-built_in">updateSubscription</span>() completes
                           │
                ┌──────────┼──────────┐
                ▼          ▼          ▼
        更新显示名 更新运营商 广播变化
        更新位置代码 更新电话号码 通知应用
</code></pre>
<p>关键代码在 <code>updateSubscription()</code> 方法中：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">1536</span><span class="hljs-symbol">:</span><span class="hljs-number">1558</span><span class="hljs-symbol">:frameworks_opt_telephony/src/java/com/android/internal/telephony/subscription/SubscriptionManagerService</span>.java
<span class="hljs-keyword">if</span> (simState == <span class="hljs-title class_">TelephonyManager</span>.<span class="hljs-variable constant_">SIM_STATE_LOADED</span>) {
    <span class="hljs-regexp">//</span> 获取 <span class="hljs-variable constant_">MCC</span>/<span class="hljs-variable constant_">MNC</span> 信息
    <span class="hljs-title class_">String</span> mccMnc = mTelephonyManager.getSimOperatorNumeric(subId);
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">TextUtils</span>.isEmpty(mccMnc)) {
        <span class="hljs-keyword">if</span> (subId == getDefaultSubId()) {
            <span class="hljs-title class_">MccTable</span>.updateMccMncConfiguration(mContext, mccMnc);
        }
        setMccMnc(subId, mccMnc);
    }
    
    /<span class="hljs-regexp">/ 获取国家代码
    String iso = TelephonyManager.getSimCountryIsoForPhone(phoneId);
    if (!TextUtils.isEmpty(iso)) {
        setCountryIso(subId, iso);
    }
    
    /</span><span class="hljs-regexp">/ 获取电话号码
    String msisdn = PhoneFactory.getPhone(phoneId).getLine1Number();
    if (!TextUtils.isEmpty(msisdn)) {
        setDisplayNumber(msisdn, subId);
    }
}
</span></code></pre>
<h4 data-id="heading-28">10.2 SIM 移除流程</h4>
<pre><code class="hljs language-scss" lang="scss">                    SIM Card Removed
                           │
                           ▼
          UiccController detects ABSENT
                           │
                           ▼
      SubscriptionManagerService<span class="hljs-selector-class">.updateSimState</span>()
                           │
                           ▼
          <span class="hljs-built_in">markSubscriptionsInactive</span>(phoneId)
                           │
            ┌──────────────┼──────────────┐
            ▼              ▼              ▼
      设置 SimSlotIndex  清除显示名  清除运营商
      为 <span class="hljs-built_in">INVALID</span>(-<span class="hljs-number">1</span>)    清除位置信息    通知更新
</code></pre>
<h3 data-id="heading-29">11. 权限和访问控制</h3>
<h4 data-id="heading-30">11.1 权限要求</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 读取订阅信息</span>
<span class="hljs-meta">@RequiresPermission(anyOf = {
    Manifest.permission.READ_PHONE_STATE,
    "carrier privileges"
})</span>

<span class="hljs-comment">// 修改订阅信息</span>
<span class="hljs-meta">@RequiresPermission(Manifest.permission.MODIFY_PHONE_STATE)</span>

<span class="hljs-comment">// 读取设备标识符（获取 IccId、GroupUuid）</span>
<span class="hljs-meta">@RequiresPermission(Manifest.permission.READ_PHONE_NUMBERS)</span>
</code></pre>
<h4 data-id="heading-31">11.2 运营商特权访问</h4>
<p>具有运营商特权的应用可以访问相关订阅的更多信息。</p>
<h3 data-id="heading-32">12. SubscriptionManager 缓存机制</h3>
<p>为了提高性能，<code>SubscriptionManager</code> 使用了 <code>PropertyInvalidatedCache</code>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> PropertyInvalidatedCache&lt;Integer, Integer&gt; sGetSubIdCache = 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertyInvalidatedCache</span>&lt;Integer, Integer&gt;(<span class="hljs-number">16</span>, CACHE_PROPERTY_PREFIX + <span class="hljs-string">"subscription"</span>) {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">recompute</span><span class="hljs-params">(Integer slotIndex)</span> {
            <span class="hljs-comment">// 查询数据库或从 SubscriptionManagerService 获取</span>
        }
    };
</code></pre>
<p>当订阅信息变化时，缓存会被自动清除。</p>
<h3 data-id="heading-33">13. 实践：查询和使用订阅</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 获取 SubscriptionManager</span>
<span class="hljs-type">SubscriptionManager</span> <span class="hljs-variable">subscriptionManager</span> <span class="hljs-operator">=</span> 
    context.getSystemService(SubscriptionManager.class);

<span class="hljs-comment">// 获取所有活跃订阅</span>
List&lt;SubscriptionInfo&gt; activeSubscriptions = 
    subscriptionManager.getActiveSubscriptionInfoList();

<span class="hljs-keyword">for</span> (SubscriptionInfo subInfo : activeSubscriptions) {
    <span class="hljs-type">int</span> <span class="hljs-variable">subId</span> <span class="hljs-operator">=</span> subInfo.getSubscriptionId();
    <span class="hljs-type">String</span> <span class="hljs-variable">displayName</span> <span class="hljs-operator">=</span> subInfo.getDisplayName().toString();
    <span class="hljs-type">int</span> <span class="hljs-variable">simSlotIndex</span> <span class="hljs-operator">=</span> subInfo.getSimSlotIndex();
    <span class="hljs-type">String</span> <span class="hljs-variable">iccId</span> <span class="hljs-operator">=</span> subInfo.getIccId();
    <span class="hljs-type">String</span> <span class="hljs-variable">carrierName</span> <span class="hljs-operator">=</span> subInfo.getCarrierName().toString();
    
    Log.d(TAG, <span class="hljs-string">"SubId: "</span> + subId + <span class="hljs-string">", Name: "</span> + displayName 
        + <span class="hljs-string">", Slot: "</span> + simSlotIndex + <span class="hljs-string">", Carrier: "</span> + carrierName);
}

<span class="hljs-comment">// 为特定订阅创建 TelephonyManager</span>
<span class="hljs-type">TelephonyManager</span> <span class="hljs-variable">telManager</span> <span class="hljs-operator">=</span> 
    context.getSystemService(TelephonyManager.class)
           .createForSubscriptionId(subId);

<span class="hljs-comment">// 获取该订阅的网络运营商</span>
<span class="hljs-type">String</span> <span class="hljs-variable">operatorName</span> <span class="hljs-operator">=</span> telManager.getNetworkOperatorName();
</code></pre>
<h3 data-id="heading-34">14. 关键类总结</h3>









































<table><thead><tr><th>类</th><th>作用</th></tr></thead><tbody><tr><td><code>SubscriptionManager</code></td><td>公开 API，应用端查询订阅信息</td></tr><tr><td><code>SubscriptionManagerService</code></td><td>系统服务，管理所有订阅的后端</td></tr><tr><td><code>SubscriptionDatabaseManager</code></td><td>订阅数据库管理，缓存和访问 <code>SimInfo</code> 表</td></tr><tr><td><code>SubscriptionInfo</code></td><td>公开订阅信息模型</td></tr><tr><td><code>SubscriptionInfoInternal</code></td><td>内部订阅信息模型，完整对应数据库</td></tr><tr><td><code>MultiSimSettingController</code></td><td>多卡设置协调，确保同组订阅设置同步</td></tr><tr><td><code>ISub</code></td><td>AIDL 接口，定义 SubscriptionManagerService 的 IPC 方法</td></tr><tr><td><code>PhoneSwitcher</code></td><td>多卡数据连接管理（详见多卡管理章节）</td></tr></tbody></table>
<hr/>
<p>这就是 Android 电话框架中 Subscription 管理的完整体系。它是 DSDS（双卡双待）管理的基础，为系统如何跟踪、访问和协调多个 SIM 卡提供了数据模型和操作框架。</p>
<p>有任何关于 Subscription 管理的具体问题吗？我可以深入解释任何特定的部分。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android RIL 中 HIDL 和 AIDL 的区别]]></title>    <link>https://juejin.cn/post/7603309951227543602</link>    <guid>https://juejin.cn/post/7603309951227543602</guid>    <pubDate>2026-02-06T09:26:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603309951227543602" data-draft-id="7603309951227527218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android RIL 中 HIDL 和 AIDL 的区别"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-06T09:26:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android RIL 中 HIDL 和 AIDL 的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:26:08.000Z" title="Fri Feb 06 2026 09:26:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">1. 历史背景</h3>





























<table><thead><tr><th>时期</th><th>语言</th><th>Android 版本</th><th>说明</th></tr></thead><tbody><tr><td><strong>Android 7.0 - 12</strong></td><td><strong>HIDL</strong> (HAL Interface Definition Language)</td><td>Nougat - S</td><td>首个现代 HAL 接口语言</td></tr><tr><td><strong>Android 13+</strong></td><td><strong>AIDL</strong> (Android Interface Definition Language)</td><td>T 及以后</td><td>统一的 IPC 接口语言</td></tr><tr><td><strong>过渡期</strong></td><td><strong>两者共存</strong></td><td>S/T</td><td>兼容性层支持 HIDL 驱动</td></tr></tbody></table>
<h3 data-id="heading-1">2. 核心架构差异</h3>
<h4 data-id="heading-2">2.1 接口定义方式</h4>
<p><strong>HIDL（旧）- <code>.hal</code> 文件：</strong></p>
<pre><code class="hljs language-scss" lang="scss">hardware_interfaces/radio/<span class="hljs-number">1.4</span>/IRadio<span class="hljs-selector-class">.hal</span>
package android<span class="hljs-selector-class">.hardware</span><span class="hljs-selector-class">.radio</span>@<span class="hljs-number">1.4</span>;

interface IRadio {
    oneway <span class="hljs-built_in">dial</span>(int32_t serial, Dial dialInfo);
    oneway <span class="hljs-built_in">hangupConnection</span>(int32_t serial, uint32_t gsmCallNumber);
    oneway <span class="hljs-built_in">setResponseFunctions</span>(IRadioResponse radioResponse, IRadioIndication radioIndication);
}
</code></pre>
<p><strong>AIDL（新）- <code>.aidl</code> 文件：</strong></p>
<pre><code class="hljs language-java" lang="java">hardware_interfaces/radio/aidl/android/hardware/radio/voice/IRadioVoice.aidl
<span class="hljs-keyword">package</span> android.hardware.radio.voice;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRadioVoice</span> {
    oneway <span class="hljs-keyword">void</span> <span class="hljs-title function_">dial</span><span class="hljs-params">(in <span class="hljs-type">int</span> serial, in Dial dialInfo)</span>;
    oneway <span class="hljs-keyword">void</span> <span class="hljs-title function_">hangupConnection</span><span class="hljs-params">(in <span class="hljs-type">int</span> serial, in <span class="hljs-type">int</span> gsmCallNumber)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setResponseFunctions</span><span class="hljs-params">(in IRadioVoiceResponse radioVoiceResponse,
                              in IRadioVoiceIndication radioVoiceIndication)</span>;
}
</code></pre>
<h4 data-id="heading-3">2.2 接口颗粒度</h4>
<p><strong>HIDL：单体接口</strong></p>
<ul>
<li>一个 <code>IRadio</code> 接口包含所有功能（voice, data, network, messaging, sim, config）</li>
<li>版本号递增：1.0 → 1.1 → 1.2 → ... → 1.6</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">hardware_interfaces/radio/1.0/IRadio.hal    (2000+ 行)
    ├─ Voice 功能
    ├─ Data 功能
    ├─ Network 功能
    ├─ Messaging 功能
    ├─ SIM 功能
    └─ Config 功能
</code></pre>
<p><strong>AIDL：模块化接口</strong></p>
<ul>
<li>按功能域分离成多个接口</li>
<li>每个模块独立版本控制</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino">hardware_interfaces/radio/aidl/android/hardware/radio/
├─ voice/IRadioVoice.aidl
├─ data/IRadioData.aidl
├─ network/IRadioNetwork.aidl
├─ messaging/IRadioMessaging.aidl
├─ sim/IRadioSim.aidl
├─ modem/IRadioModem.aidl
└─ config/IRadioConfig.aidl
</code></pre>
<h3 data-id="heading-4">3. 响应和指示机制</h3>
<h4 data-id="heading-5">3.1 HIDL 响应流程</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-title class_">Framework</span> (<span class="hljs-title class_">Java</span>)
    │
    ├─ setResponseFunctions(<span class="hljs-title class_">IRadioResponse</span>, <span class="hljs-title class_">IRadioIndication</span>)
    │
<span class="hljs-variable constant_">RIL</span> (<span class="hljs-variable constant_">JNI</span>/C++)
    │
    ├─ <span class="hljs-title class_">IRadio</span><span class="hljs-variable">@1</span>.<span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:dial</span>()
    │
    └─ <span class="hljs-title class_">IRadioResponse</span><span class="hljs-variable">@1</span>.<span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:dialResponse</span>()
       <span class="hljs-title class_">IRadioIndication</span><span class="hljs-variable">@1</span>.<span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:callStateChanged</span>()
</code></pre>
<p>响应和指示通过同一对接口处理：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-number">44</span>:<span class="hljs-number">60</span>:hardware_interfaces/radio/<span class="hljs-number">1.0</span>/IRadio.hal
interface IRadio {
    <span class="hljs-built_in">setResponseFunctions</span>(IRadioResponse radioResponse, IRadioIndication radioIndication);
    oneway <span class="hljs-built_in">dial</span>(int32_t serial, Dial dialInfo);
    <span class="hljs-comment">// ...</span>
}

interface IRadioResponse {
    <span class="hljs-built_in">dialResponse</span>(RadioResponseInfo info);
}

interface IRadioIndication {
    <span class="hljs-built_in">callStateChanged</span>(RadioIndicationType type);
}
</code></pre>
<h4 data-id="heading-6">3.2 AIDL 响应流程</h4>
<pre><code class="hljs language-scss" lang="scss">Framework (Java)
    │
    ├─ <span class="hljs-built_in">setResponseFunctions</span>(IRadioVoiceResponse, IRadioVoiceIndication)
    │
RIL (C++)
    │
    ├─ IRadioVoice::<span class="hljs-built_in">dial</span>()
    │
    └─ IRadioVoiceResponse::<span class="hljs-built_in">dialResponse</span>()
       IRadioVoiceIndication::<span class="hljs-built_in">callStateChanged</span>()
</code></pre>
<p>AIDL 采用<strong>分离的响应接口</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp">hardware_interfaces/radio/aidl/android/hardware/radio/voice/IRadioVoice.aidl
<span class="hljs-keyword">interface</span> <span class="hljs-title">IRadioVoice</span> {
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setResponseFunctions</span>(<span class="hljs-params"><span class="hljs-keyword">in</span> IRadioVoiceResponse radioVoiceResponse,
                              <span class="hljs-keyword">in</span> IRadioVoiceIndication radioVoiceIndication</span>)</span>;
    <span class="hljs-function">oneway <span class="hljs-keyword">void</span> <span class="hljs-title">dial</span>(<span class="hljs-params"><span class="hljs-keyword">in</span> <span class="hljs-built_in">int</span> serial, <span class="hljs-keyword">in</span> Dial dialInfo</span>)</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title">IRadioVoiceResponse</span> {
    <span class="hljs-function">oneway <span class="hljs-keyword">void</span> <span class="hljs-title">dialResponse</span>(<span class="hljs-params"><span class="hljs-keyword">in</span> RadioResponseInfo info</span>)</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title">IRadioVoiceIndication</span> {
    <span class="hljs-function">oneway <span class="hljs-keyword">void</span> <span class="hljs-title">callStateChanged</span>(<span class="hljs-params"><span class="hljs-keyword">in</span> RadioIndicationType type</span>)</span>;
}
</code></pre>
<h3 data-id="heading-7">4. 数据结构定义</h3>
<h4 data-id="heading-8">4.1 HIDL - 复杂的继承体系</h4>
<pre><code class="hljs language-ini" lang="ini">hardware_interfaces/radio/1.0/types.hal
struct Dial {
    string address<span class="hljs-comment">;</span>
    Clir clir<span class="hljs-comment">;</span>
    vec&lt;UusInfo&gt; uusInfo<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

struct RadioResponseInfo {
    RadioResponseType type<span class="hljs-comment">;</span>
    int32_t serial<span class="hljs-comment">;</span>
    RadioError error<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>HIDL 支持联合（union）和层级继承。</p>
<h4 data-id="heading-9">4.2 AIDL - 扁平的数据结构</h4>
<pre><code class="hljs language-ini" lang="ini">hardware_interfaces/radio/aidl/android/hardware/radio/voice/Dial.aidl
package android.hardware.radio.voice<span class="hljs-comment">;</span>
parcelable Dial {
    String address<span class="hljs-comment">;</span>
    int clir<span class="hljs-comment">;</span>
    UusInfo<span class="hljs-section">[]</span> uusInfo<span class="hljs-comment">;</span>
}

hardware_interfaces/radio/aidl/android/hardware/radio/RadioResponseInfo.aidl
package android.hardware.radio<span class="hljs-comment">;</span>
parcelable RadioResponseInfo {
    RadioResponseType type<span class="hljs-comment">;</span>
    int serial<span class="hljs-comment">;</span>
    RadioError error<span class="hljs-comment">;</span>
}
</code></pre>
<p>AIDL 使用 <code>parcelable</code> 而非 <code>struct</code>。</p>
<h3 data-id="heading-10">5. RIL Java 层的适配</h3>
<p>RIL 框架通过代理类适配两种接口：</p>
<pre><code class="hljs language-ini" lang="ini">53:100:frameworks_opt_telephony/src/java/com/android/internal/telephony/RadioServiceProxy.java
/**
 * A holder for IRadio services.
 * Use getHidl to get the HIDL IRadio service or getAidl to get the corresponding AIDL service.
 */
public abstract class RadioServiceProxy {
    boolean mIsAidl<span class="hljs-comment">;                                    // 标志：是否为 AIDL</span>
    HalVersion <span class="hljs-attr">mHalVersion</span> = RIL.RADIO_HAL_VERSION_UNKNOWN<span class="hljs-comment">;</span>
    volatile android.hardware.radio.V1_4.IRadio <span class="hljs-attr">mRadioProxy</span> = null<span class="hljs-comment">;</span>

    /**
     * Set IRadio as the HIDL implementation for RadioServiceProxy
     */
    public void setHidl(HalVersion halVersion, android.hardware.radio.V1_4.IRadio radio) {
        <span class="hljs-attr">mHalVersion</span> = halVersion<span class="hljs-comment">;</span>
        <span class="hljs-attr">mRadioProxy</span> = radio<span class="hljs-comment">;</span>
        <span class="hljs-attr">mIsAidl</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }

    /**
     * Set IRadio as the AIDL implementation for RadioServiceProxy
     */
    public void setAidl(android.hardware.radio.IRadio radioAidl) {
        <span class="hljs-attr">mAidlRadioProxy</span> = radioAidl<span class="hljs-comment">;</span>
        <span class="hljs-attr">mIsAidl</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    }

    public boolean isAidl() {
        return mIsAidl<span class="hljs-comment">;</span>
    }
}
</code></pre>
<h3 data-id="heading-11">6. 兼容性层：libradiocompat</h3>
<p>Android 13 引入了兼容性层，允许在 AIDL 框架中使用旧的 HIDL HAL 实现。</p>
<h4 data-id="heading-12">6.1 架构</h4>
<pre><code class="hljs language-scss" lang="scss">         Framework (AIDL)
               │
     ┌─────────┴─────────┐
     │                   │
  AIDL HAL          libradiocompat
  (Native)          (Converter)
                        │
                   HIDL HAL (Legacy)
</code></pre>
<h4 data-id="heading-13">6.2 数据结构转换</h4>
<p>libradiocompat 提供了双向转换函数：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-number">19</span><span class="hljs-symbol">:</span><span class="hljs-number">45</span><span class="hljs-symbol">:hardware_interfaces/radio/aidl/compat/libradiocompat/commonStructs</span>.cpp
namespace android::hardware::radio::compat {

<span class="hljs-regexp">//</span> <span class="hljs-variable constant_">HIDL</span> to <span class="hljs-variable constant_">AIDL</span> conversion
aidl::<span class="hljs-title class_">RadioResponseInfo</span> toAidl(const <span class="hljs-variable constant_">V1_0</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:RadioResponseInfo&amp;</span> info) {
    <span class="hljs-keyword">return</span> {
            .type = toAidl(info.type),
            .serial = info.serial,
            .error = toAidl(info.error),
    };
}

/<span class="hljs-regexp">/ AIDL to HIDL conversion
V1_0::RadioCapability toHidl(const aidl::RadioCapability&amp; capa) {
    return {
            .session = capa.session,
            .phase = static_cast&lt;V1_0::RadioCapabilityPhase&gt;(capa.phase),
            .raf = toHidlBitfield&lt;V1_0::RadioAccessFamily&gt;(capa.raf),
            .logicalModemUuid = capa.logicalModemUuid,
            .status = static_cast&lt;V1_0::RadioCapabilityStatus&gt;(capa.status),
    };
}

}
</span></code></pre>
<h4 data-id="heading-14">6.3 集合转换</h4>
<p>支持向量和数组的自动转换：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">23</span>:<span class="hljs-number">56</span>:hardware_interfaces/radio/aidl/compat/libradiocompat/collections.h
<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">toAidl</span><span class="hljs-params">(<span class="hljs-type">const</span> hidl_vec&lt;T&gt;&amp; inp)</span> </span>{
    <span class="hljs-function">std::vector&lt;<span class="hljs-title">decltype</span><span class="hljs-params">(toAidl(T{}))</span>&gt; <span class="hljs-title">out</span><span class="hljs-params">(inp.size())</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; inp.<span class="hljs-built_in">size</span>(); i++) {
        out[i] = <span class="hljs-built_in">toAidl</span>(inp[i]);
    }
    <span class="hljs-keyword">return</span> out;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">toHidl</span><span class="hljs-params">(<span class="hljs-type">const</span> std::vector&lt;T&gt;&amp; inp)</span> </span>{
    <span class="hljs-function">hidl_vec&lt;<span class="hljs-title">decltype</span><span class="hljs-params">(toHidl(T{}))</span>&gt; <span class="hljs-title">out</span><span class="hljs-params">(inp.size())</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; inp.<span class="hljs-built_in">size</span>(); i++) {
        out[i] = <span class="hljs-built_in">toHidl</span>(inp[i]);
    }
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<h3 data-id="heading-15">7. 关键差异对比表</h3>























































<table><thead><tr><th>特性</th><th>HIDL</th><th>AIDL</th></tr></thead><tbody><tr><td><strong>引入时间</strong></td><td>Android 7.0 (Nougat)</td><td>Android 13 (Tiramisu)</td></tr><tr><td><strong>定义文件</strong></td><td><code>.hal</code></td><td><code>.aidl</code></td></tr><tr><td><strong>接口粒度</strong></td><td>单体（IRadio 包含所有）</td><td>模块化（IRadioVoice, IRadioData 等）</td></tr><tr><td><strong>版本管理</strong></td><td>整体版本（1.0-1.6）</td><td>按模块版本（各模块独立）</td></tr><tr><td><strong>类型系统</strong></td><td>复杂继承体系</td><td>简洁的 parcelable 类型</td></tr><tr><td><strong>代码生成</strong></td><td>HIDL 编译器</td><td>AIDL 编译器</td></tr><tr><td><strong>二进制兼容性</strong></td><td>使用 HIDL 运行时</td><td>使用 Binder</td></tr><tr><td><strong>兼容性支持</strong></td><td>原生支持 HIDL</td><td>通过 libradiocompat</td></tr><tr><td><strong>性能特征</strong></td><td>针对 HAL 优化</td><td>通用 IPC 优化</td></tr></tbody></table>
<h3 data-id="heading-16">8. 版本管理对比</h3>
<p><strong>HIDL 版本演进：</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">android.hardware.radio<span class="hljs-variable">@1</span>.<span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span>
    ├─ dial()
    ├─ hangupConnection()
    └─ ...

android.hardware.radio<span class="hljs-variable">@1</span>.<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span> extends <span class="hljs-variable">@1</span>.<span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span>
    └─ setCarrierInfoForImsiEncryption()  (新增)

android.hardware.radio<span class="hljs-variable">@1</span>.<span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span> extends <span class="hljs-variable">@1</span>.<span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span>
    └─ startNetworkScan()                 (新增)

...

android.hardware.radio<span class="hljs-variable">@1</span>.<span class="hljs-number">6</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span> extends <span class="hljs-variable">@1</span>.<span class="hljs-number">5</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadio</span>
    └─ setSimCardPower()                  (新增)
</code></pre>
<p><strong>AIDL 模块化版本：</strong></p>
<pre><code class="hljs language-ruby" lang="ruby">android.hardware.radio.voice<span class="hljs-variable">@1</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadioVoice</span>
    ├─ dial()
    ├─ hangupConnection()
    └─ ...

android.hardware.radio.data<span class="hljs-variable">@1</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadioData</span>
    ├─ setupDataCall()
    ├─ deactivateDataCall()
    └─ ...

android.hardware.radio.sim<span class="hljs-variable">@1</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:IRadioSim</span>
    ├─ getIccCardStatus()
    ├─ supplyIccPin()
    └─ ...
</code></pre>
<h3 data-id="heading-17">9. 实际通信流程</h3>
<h4 data-id="heading-18">9.1 HIDL 请求/响应</h4>
<pre><code class="hljs language-less" lang="less">┌─────────────────┐
│ <span class="hljs-selector-tag">RIL</span> (Java/JNI)  │
└────────┬────────┘
         │ <span class="hljs-number">1</span>. <span class="hljs-selector-tag">mRadioProxy</span><span class="hljs-selector-class">.dial</span>(serial, dialInfo)
         ▼
┌─────────────────────────────────┐
│ <span class="hljs-selector-tag">HIDL</span> <span class="hljs-selector-tag">Service</span> (radio<span class="hljs-variable">@1</span>.<span class="hljs-number">4</span>::IRadio)│ (Native HAL)
└────────┬────────────────────────┘
         │ <span class="hljs-number">2</span>. 内部处理
         │ <span class="hljs-number">3</span>. 调用响应回调
         ▼
┌──────────────────────────────────┐
│ <span class="hljs-selector-tag">HIDL</span> <span class="hljs-selector-tag">Callback</span> (IRadioResponse)    │
└────────┬─────────────────────────┘
         │ <span class="hljs-number">4</span>. <span class="hljs-selector-tag">response-</span>&gt;<span class="hljs-selector-tag">dialResponse</span>(responseInfo)
         ▼
┌─────────────────────┐
│ <span class="hljs-selector-tag">RIL</span> <span class="hljs-selector-tag">Callback</span> <span class="hljs-selector-tag">Handler</span>│
└─────────────────────┘
</code></pre>
<h4 data-id="heading-19">9.2 AIDL 请求/响应</h4>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────┐
│ RIL (Java/JNI)  │
└────────┬────────┘
         │ <span class="hljs-number">1</span>. mRadioProxy<span class="hljs-selector-class">.dial</span>(serial, dialInfo)
         ▼
┌─────────────────────────────────┐
│ AIDL Service (IRadioVoice)       │ (Native HAL or Compat Layer)
└────────┬────────────────────────┘
         │ <span class="hljs-number">2</span>. 内部处理
         │ <span class="hljs-number">3</span>. 调用响应回调
         ▼
┌──────────────────────────────────┐
│ AIDL Callback (IRadioVoiceResponse)
└────────┬─────────────────────────┘
         │ <span class="hljs-number">4</span>. response-&gt;<span class="hljs-built_in">dialResponse</span>(responseInfo)
         ▼
┌─────────────────────┐
│ RIL Callback Handler│
└─────────────────────┘
</code></pre>
<h3 data-id="heading-20">10. 构建系统差异</h3>
<p><strong>HIDL 编译：</strong></p>
<pre><code class="hljs language-makefile" lang="makefile">hidl_interface {
    name: <span class="hljs-string">"android.hardware.radio"</span>,
    root: <span class="hljs-string">"android.hardware"</span>,
    srcs: [
        <span class="hljs-string">"1.4/IRadio.hal"</span>,
        <span class="hljs-string">"1.4/IRadioResponse.hal"</span>,
        <span class="hljs-string">"1.4/IRadioIndication.hal"</span>,
        <span class="hljs-string">"1.4/types.hal"</span>,
    ],
    interfaces: [
        <span class="hljs-string">"android.hardware.base@1.0"</span>,
    ],
}
</code></pre>
<p><strong>AIDL 编译：</strong></p>
<pre><code class="hljs language-blueprint" lang="blueprint">aidl_interface {
    name: "android.hardware.radio",
    vendor_available: true,
    srcs: [
        "android/hardware/radio/voice/*.aidl",
        "android/hardware/radio/data/*.aidl",
        "android/hardware/radio/network/*.aidl",
        "android/hardware/radio/sim/*.aidl",
        "android/hardware/radio/modem/*.aidl",
        "android/hardware/radio/messaging/*.aidl",
    ],
    stability: "vintf",
    backend: {
        cpp: { enabled: true; },
        java: { enabled: true; },
    },
    versions_with_info: [
        { version: "1"; },
        { version: "2"; },
        { version: "3"; },
    ],
    frozen: true,
}
</code></pre>
<h3 data-id="heading-21">11. 性能和稳定性考量</h3>



































<table><thead><tr><th>方面</th><th>HIDL</th><th>AIDL</th></tr></thead><tbody><tr><td><strong>内存占用</strong></td><td>较小（C++ 优化）</td><td>相同或稍大</td></tr><tr><td><strong>IPC 延迟</strong></td><td>优化的 Binder 使用</td><td>标准 Binder 延迟</td></tr><tr><td><strong>类型安全</strong></td><td>强类型检查</td><td>强类型检查</td></tr><tr><td><strong>向后兼容</strong></td><td>通过继承链</td><td>通过版本管理</td></tr><tr><td><strong>热修复</strong></td><td>困难（版本锁定）</td><td>更容易（模块独立）</td></tr></tbody></table>
<h3 data-id="heading-22">12. 迁移建议</h3>
<p><strong>从 HIDL 迁移到 AIDL 的好处：</strong></p>
<ol>
<li><strong>模块化</strong> - 各功能模块独立演进</li>
<li><strong>统一 IPC</strong> - 不再有特殊的 HAL IPC 机制</li>
<li><strong>灵活版本管理</strong> - 每个模块独立版本</li>
<li><strong>更好的工具</strong> - 统一使用 AIDL 工具链</li>
<li><strong>长期支持</strong> - AIDL 是未来方向</li>
</ol>
<p><strong>兼容性策略：</strong></p>
<ul>
<li>Android 13-14：HIDL 和 AIDL 并存，通过 libradiocompat 支持旧 HAL</li>
<li>Android 15+：可能逐步淘汰 HIDL 支持</li>
</ul>
<hr/>
<p>总结来说，<strong>HIDL 是针对 HAL 的专用接口语言</strong>，而 <strong>AIDL 是通用的系统服务接口语言</strong>。RIL 从 HIDL 迁移到 AIDL 反映了 Android 系统架构向更统一、模块化方向的演进。</p>
<p>有任何关于 HIDL/AIDL 在 RIL 中的实现细节的问题吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Modem 向系统上报的无线指示（Unsolicited Indication）的完整列表]]></title>    <link>https://juejin.cn/post/7603359026711478282</link>    <guid>https://juejin.cn/post/7603359026711478282</guid>    <pubDate>2026-02-06T09:29:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7603359026711478282" data-draft-id="7603393977477365786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Modem 向系统上报的无线指示（Unsolicited Indication）的完整列表"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-06T09:29:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户341408199125"/> <meta itemprop="url" content="https://juejin.cn/user/570004686782272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Modem 向系统上报的无线指示（Unsolicited Indication）的完整列表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/570004686782272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户341408199125
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-06T09:29:59.000Z" title="Fri Feb 06 2026 09:29:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Modem 向系统上报的无线指示共分为 <strong>7 个大类</strong>，总计约 <strong>70+ 种具体指示</strong>，分布如下：</p>
<hr/>
<h2 data-id="heading-0">1️⃣ <strong>语音指示（Voice Indications）- 13 种</strong></h2>
<p>来自 <code>IRadioVoiceIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> callRing                          - 来电铃声（来电响铃指示）
<span class="hljs-bullet">2.</span> callStateChanged                  - 通话状态变化
<span class="hljs-bullet">3.</span> cdmaCallWaiting                   - CDMA 呼叫等待
<span class="hljs-bullet">4.</span> cdmaInfoRec                       - CDMA 信息记录
<span class="hljs-bullet">5.</span> cdmaOtaProvisionStatus            - CDMA OTA 配置状态
<span class="hljs-bullet">6.</span> currentEmergencyNumberList        - 紧急号码列表
<span class="hljs-bullet">7.</span> enterEmergencyCallbackMode        - 进入紧急回调模式
<span class="hljs-bullet">8.</span> exitEmergencyCallbackMode         - 退出紧急回调模式
<span class="hljs-bullet">9.</span> indicateRingbackTone              - 指示回铃音
<span class="hljs-bullet">10.</span> onSupplementaryServiceIndication - 补充服务指示
<span class="hljs-bullet">11.</span> onUssd                           - USSD 消息
<span class="hljs-bullet">12.</span> resendIncallMute                 - 重新发送通话中静音
<span class="hljs-bullet">13.</span> srvccStateNotify                 - SRVCC 状态变化
<span class="hljs-bullet">14.</span> stkCallControlAlphaNotify        - STK 呼叫控制字母通知
<span class="hljs-bullet">15.</span> stkCallSetup                     - STK 设置呼叫
</code></pre>
<hr/>
<h2 data-id="heading-1">2️⃣ <strong>数据指示（Data Indications）- 5 种</strong></h2>
<p>来自 <code>IRadioDataIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> dataCallListChanged     - 数据连接列表变化
<span class="hljs-bullet">2.</span> keepaliveStatus         - 保活会话状态
<span class="hljs-bullet">3.</span> pcoData                 - PCO 数据（运营商配置数据）
<span class="hljs-bullet">4.</span> unthrottleApn           - 解除 APN 限流
<span class="hljs-bullet">5.</span> slicingConfigChanged    - 网络切片配置变化
</code></pre>
<hr/>
<h2 data-id="heading-2">3️⃣ <strong>网络指示（Network Indications）- 14 种</strong></h2>
<p>来自 <code>IRadioNetworkIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> barringInfoChanged              - 禁用信息变化
<span class="hljs-bullet">2.</span> cdmaPrlChanged                  - CDMA PRL 版本变化
<span class="hljs-bullet">3.</span> cellInfoList                    - 小区信息列表
<span class="hljs-bullet">4.</span> currentLinkCapacityEstimate     - 链路容量估计
<span class="hljs-bullet">5.</span> currentPhysicalChannelConfigs   - 物理信道配置
<span class="hljs-bullet">6.</span> currentSignalStrength           - 信号强度
<span class="hljs-bullet">7.</span> imsNetworkStateChanged          - IMS 网络状态变化
<span class="hljs-bullet">8.</span> networkScanResult               - 网络扫描结果
<span class="hljs-bullet">9.</span> networkStateChanged             - 网络状态变化
<span class="hljs-bullet">10.</span> nitzTimeReceived               - NITZ 时间接收
<span class="hljs-bullet">11.</span> registrationFailed             - 注册失败
<span class="hljs-bullet">12.</span> restrictedStateChanged         - 受限状态变化
<span class="hljs-bullet">13.</span> suppSvcNotify                  - 补充服务通知
<span class="hljs-bullet">14.</span> voiceRadioTechChanged          - 语音无线技术变化
<span class="hljs-bullet">15.</span> emergencyNetworkScanResult     - 紧急网络扫描结果
</code></pre>
<hr/>
<h2 data-id="heading-3">4️⃣ <strong>SIM/卡指示（SIM Indications）- 10 种</strong></h2>
<p>来自 <code>IRadioSimIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> carrierInfoForImsiEncryption    - 运营商 IMSI 加密信息
<span class="hljs-bullet">2.</span> cdmaSubscriptionSourceChanged   - CDMA 订阅源变化
<span class="hljs-bullet">3.</span> simPhonebookChanged             - SIM 电话簿变化
<span class="hljs-bullet">4.</span> simPhonebookRecordsReceived     - SIM 电话簿记录接收
<span class="hljs-bullet">5.</span> simRefresh                      - SIM 刷新
<span class="hljs-bullet">6.</span> simStatusChanged                - SIM 状态变化
<span class="hljs-bullet">7.</span> stkEventNotify                  - STK 事件通知
<span class="hljs-bullet">8.</span> stkProactiveCommand             - STK 主动命令
<span class="hljs-bullet">9.</span> stkSessionEnd                   - STK 会话结束
<span class="hljs-bullet">10.</span> subscriptionStatusChanged      - 订阅状态变化
<span class="hljs-bullet">11.</span> uiccApplicationsEnablementChanged - UICC 应用启用/禁用变化
</code></pre>
<hr/>
<h2 data-id="heading-4">5️⃣ <strong>消息指示（Messaging Indications）- 6 种</strong></h2>
<p>来自 <code>IRadioMessagingIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> cdmaNewSms               - 新 CDMA 短信
<span class="hljs-bullet">2.</span> cdmaRuimSmsStorageFull   - CDMA RUIM 短信存储满
<span class="hljs-bullet">3.</span> newBroadcastSms          - 新广播短信
<span class="hljs-bullet">4.</span> newSms                   - 新 GSM 短信
<span class="hljs-bullet">5.</span> newSmsOnSim              - SIM 卡上新短信
<span class="hljs-bullet">6.</span> newSmsStatusReport       - 短信状态报告
<span class="hljs-bullet">7.</span> simSmsStorageFull        - SIM 短信存储满
</code></pre>
<hr/>
<h2 data-id="heading-5">6️⃣ <strong>Modem/调制解调器指示（Modem Indications）- 6 种</strong></h2>
<p>来自 <code>IRadioModemIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> hardwareConfigChanged    - 硬件配置变化
<span class="hljs-bullet">2.</span> modemReset               - Modem 重启
<span class="hljs-bullet">3.</span> radioCapabilityIndication - Radio 能力指示
<span class="hljs-bullet">4.</span> radioStateChanged        - Radio 状态变化
<span class="hljs-bullet">5.</span> rilConnected             - RIL 连接
<span class="hljs-bullet">6.</span> onImeiMappingChanged     - IMEI 映射变化
</code></pre>
<hr/>
<h2 data-id="heading-6">7️⃣ <strong>IMS 指示（IMS Indications）- 3 种</strong></h2>
<p>来自 <code>IRadioImsIndication</code> 接口：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> onConnectionSetupFailure - IMS 连接设置失败
<span class="hljs-bullet">2.</span> notifyAnbr               - 接收网络速率建议 (ANBR)
<span class="hljs-bullet">3.</span> triggerImsDeregistration - 触发 IMS 去注册
</code></pre>
<hr/>
<h2 data-id="heading-7">额外信息：Config 指示（Config Indications）</h2>
<p>除了上述主要指示，还有 <strong>Config 相关指示</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">来自 IRadioConfigIndication 接口：
<span class="hljs-bullet">1.</span> simSlotsStatusChanged      - SIM 槽状态变化
<span class="hljs-bullet">2.</span> enabledLogicalSlots        - 启用的逻辑槽变化
</code></pre>
<hr/>
<h2 data-id="heading-8">📊 总体分类</h2>


















































<table><thead><tr><th>类别</th><th>指示数</th><th>主要功能</th></tr></thead><tbody><tr><td>Voice</td><td>13</td><td>通话、CDMA、紧急呼叫、STK</td></tr><tr><td>Data</td><td>5</td><td>数据连接、PCO、APN 限流</td></tr><tr><td>Network</td><td>15</td><td>网络注册、信号、小区信息</td></tr><tr><td>SIM</td><td>11</td><td>SIM 卡、STK、订阅</td></tr><tr><td>Messaging</td><td>7</td><td>SMS、广播短信</td></tr><tr><td>Modem</td><td>6</td><td>Radio 状态、硬件配置、RIL</td></tr><tr><td>IMS</td><td>3</td><td>IMS 连接、速率建议</td></tr><tr><td><strong>总计</strong></td><td><strong>~60+</strong></td><td>—</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">🔑 关键点</h2>
<ol>
<li>
<p><strong>HIDL vs AIDL</strong>：</p>
<ul>
<li><strong>HIDL 1.0-1.6</strong>：所有指示通过单一 <code>IRadioIndication</code> 接口</li>
<li><strong>AIDL</strong>：指示分为 7 个专项接口，实现了模块化设计</li>
</ul>
</li>
<li>
<p><strong>指示触发时机</strong>：</p>
<ul>
<li>某些指示需要确认（如 SMS）</li>
<li>某些指示只在状态变化时触发（如 networkStateChanged）</li>
<li>某些指示可能定期触发（如 signalStrength）</li>
</ul>
</li>
<li>
<p><strong>Wake Lock 策略</strong>：在 HIDL 中，每个指示都关联一个 wake lock 策略（<code>WAKE_PARTIAL</code>、<code>DONT_WAKE</code> 等）</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>