<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Three.js 开发快速入门]]></title>    <link>https://juejin.cn/post/7595041883144568878</link>    <guid>https://juejin.cn/post/7595041883144568878</guid>    <pubDate>2026-01-14T10:07:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595041883144568878" data-draft-id="7595021656428019739" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 开发快速入门"/> <meta itemprop="keywords" content="three.js"/> <meta itemprop="datePublished" content="2026-01-14T10:07:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 开发快速入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:07:53.000Z" title="Wed Jan 14 2026 10:07:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文档将介绍Three.js开发中的快速入门知识点，包括控制器使用、物体变换、材质纹理、雾效、模型加载等内容。通过这些实例，您将掌握Three.js的核心概念和实用技巧。</p>
<h2 data-id="heading-1">第一部分：控制器和辅助坐标系</h2>
<h3 data-id="heading-2">1. 轨道控制器（OrbitControls）</h3>
<p>轨道控制器允许用户通过鼠标拖拽、滚轮缩放等方式来改变相机视角，这对于3D场景的浏览非常有用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入轨道控制器</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/controls/OrbitControls.js"</span>;

<span class="hljs-comment">// 添加轨道控制器</span>
<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>);
<span class="hljs-comment">// 设置带阻尼的惯性</span>
controls.<span class="hljs-property">enableDamping</span> = <span class="hljs-literal">true</span>;
<span class="hljs-comment">// 设置阻尼系数</span>
controls.<span class="hljs-property">dampingFactor</span> = <span class="hljs-number">0.05</span>;
<span class="hljs-comment">// 设置自动旋转（可选）</span>
controls.<span class="hljs-property">autoRotate</span> = <span class="hljs-literal">true</span>;
</code></pre>
<h3 data-id="heading-3">2. 辅助坐标系（AxesHelper）</h3>
<p>辅助坐标系可以帮助开发者可视化场景中的坐标轴方向：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加世界坐标辅助器</span>
<span class="hljs-keyword">const</span> axesHelper = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AxesHelper</span>(<span class="hljs-number">5</span>);
scene.<span class="hljs-title function_">add</span>(axesHelper);
</code></pre>
<h3 data-id="heading-4">3. 动画循环中更新控制器</h3>
<p>为了使控制器的阻尼效果生效，需要在动画循环中调用<code>controls.update()</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  controls.<span class="hljs-title function_">update</span>();  <span class="hljs-comment">// 必须在动画循环中调用</span>
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<h2 data-id="heading-5">第二部分：物体变换和层级关系</h2>
<h3 data-id="heading-6">1. 物体位移</h3>
<p>Three.js中每个对象都有position属性，用于控制物体的位置：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置物体位置</span>
cube.<span class="hljs-property">position</span>.<span class="hljs-property">x</span> = <span class="hljs-number">2</span>;
cube.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 同时设置xyz坐标</span>
</code></pre>
<h3 data-id="heading-7">2. 父子层级关系</h3>
<p>在Three.js中，可以建立物体间的父子关系，子物体的变换会受到父物体的影响：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建父物体</span>
<span class="hljs-keyword">let</span> parentCube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, parentMaterial);
<span class="hljs-comment">// 创建子物体</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
<span class="hljs-comment">// 将子物体添加到父物体上</span>
parentCube.<span class="hljs-title function_">add</span>(cube);
<span class="hljs-comment">// 设置父物体位置</span>
parentCube.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(-<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
<span class="hljs-comment">// 设置子物体位置（相对于父物体）</span>
cube.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">3</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
</code></pre>
<h3 data-id="heading-8">3. 旋转和缩放</h3>
<p>除了位置变换，还可以对物体进行旋转和缩放：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 旋转 - 使用弧度制</span>
cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>;  <span class="hljs-comment">// 绕X轴旋转45度</span>
<span class="hljs-comment">// 缩放</span>
cube.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);  <span class="hljs-comment">// 在xyz轴上都放大2倍</span>
</code></pre>
<h2 data-id="heading-9">第三部分：响应式画布与全屏控制</h2>
<h3 data-id="heading-10">1. 响应式设计</h3>
<p>为了让Three.js应用在窗口大小改变时自适应，需要监听resize事件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 监听窗口变化</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 重置渲染器宽高比</span>
  renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
  <span class="hljs-comment">// 重置相机宽高比</span>
  camera.<span class="hljs-property">aspect</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
  <span class="hljs-comment">// 更新相机投影矩阵</span>
  camera.<span class="hljs-title function_">updateProjectionMatrix</span>();
});
</code></pre>
<h3 data-id="heading-11">2. 全屏功能</h3>
<p>可以通过浏览器API实现全屏功能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全屏</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">requestFullscreen</span>();

<span class="hljs-comment">// 退出全屏</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">exitFullscreen</span>();
</code></pre>
<h3 data-id="heading-12">3. 自定义全屏按钮</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"button"</span>);
btn.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">"点击全屏"</span>;
btn.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">"absolute"</span>;
btn.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">"10px"</span>;
btn.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = <span class="hljs-string">"10px"</span>;
btn.<span class="hljs-property">style</span>.<span class="hljs-property">zIndex</span> = <span class="hljs-string">"999"</span>;
btn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">requestFullscreen</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"全屏"</span>);
};
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(btn);
</code></pre>
<h2 data-id="heading-13">第四部分：使用lil-gui进行调试</h2>
<p>lil-gui是一个轻量级的图形界面库，非常适合用于Three.js开发过程中的参数调试。</p>
<h3 data-id="heading-14">1. 基本使用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入lil-gui</span>
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">GUI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/libs/lil-gui.module.min.js"</span>;

<span class="hljs-comment">// 创建GUI实例</span>
<span class="hljs-keyword">const</span> gui = <span class="hljs-keyword">new</span> <span class="hljs-title function_">GUI</span>();
</code></pre>
<h3 data-id="heading-15">2. 添加控件</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加按钮</span>
gui.<span class="hljs-title function_">add</span>(eventObj, <span class="hljs-string">"Fullscreen"</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">"全屏"</span>);

<span class="hljs-comment">// 添加范围滑块</span>
gui.<span class="hljs-title function_">add</span>(cube.<span class="hljs-property">position</span>, <span class="hljs-string">"x"</span>, -<span class="hljs-number">5</span>, <span class="hljs-number">5</span>).<span class="hljs-title function_">name</span>(<span class="hljs-string">"立方体x轴位置"</span>);

<span class="hljs-comment">// 创建文件夹组织控件</span>
<span class="hljs-keyword">let</span> folder = gui.<span class="hljs-title function_">addFolder</span>(<span class="hljs-string">"立方体位置"</span>);
folder
  .<span class="hljs-title function_">add</span>(cube.<span class="hljs-property">position</span>, <span class="hljs-string">"x"</span>)
  .<span class="hljs-title function_">min</span>(-<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">max</span>(<span class="hljs-number">10</span>)
  .<span class="hljs-title function_">step</span>(<span class="hljs-number">1</span>)
  .<span class="hljs-title function_">name</span>(<span class="hljs-string">"立方体x轴位置"</span>);

<span class="hljs-comment">// 添加颜色选择器</span>
gui.<span class="hljs-title function_">addColor</span>(colorParams, <span class="hljs-string">"cubeColor"</span>)
  .<span class="hljs-title function_">name</span>(<span class="hljs-string">"立方体颜色"</span>)
  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
    cube.<span class="hljs-property">material</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(val);
  });
</code></pre>
<h2 data-id="heading-16">第五部分：BufferGeometry详解</h2>
<h3 data-id="heading-17">1. BufferGeometry vs Geometry</h3>
<p>BufferGeometry是Three.js中更高效的几何体表示方式，它直接使用缓冲区存储顶点数据。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建BufferGeometry</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferGeometry</span>();

<span class="hljs-comment">// 创建顶点数据（每三个数值代表一个顶点的xyz坐标）</span>
<span class="hljs-keyword">const</span> vertices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
  -<span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>,  <span class="hljs-comment">// 第一个顶点</span>
  <span class="hljs-number">1.0</span>, -<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>,   <span class="hljs-comment">// 第二个顶点</span>
  <span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>,    <span class="hljs-comment">// 第三个顶点</span>
  -<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>    <span class="hljs-comment">// 第四个顶点</span>
]);

<span class="hljs-comment">// 设置顶点属性</span>
geometry.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">"position"</span>, <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(vertices, <span class="hljs-number">3</span>));
</code></pre>
<h3 data-id="heading-18">2. 使用索引绘制</h3>
<p>通过索引可以减少重复顶点数据：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建索引</span>
<span class="hljs-keyword">const</span> indices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>]);
<span class="hljs-comment">// 设置索引属性</span>
geometry.<span class="hljs-title function_">setIndex</span>(<span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BufferAttribute</span>(indices, <span class="hljs-number">1</span>));
</code></pre>
<h2 data-id="heading-19">第六部分：顶点组与材质</h2>
<h3 data-id="heading-20">1. 多材质网格</h3>
<p>一个网格可以使用多个材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建多种材质</span>
<span class="hljs-keyword">const</span> cubematerial0 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
<span class="hljs-keyword">const</span> cubematerial1 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0xff0000</span> });
<span class="hljs-comment">// ... 更多材质</span>

<span class="hljs-comment">// 将多个材质传递给网格</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(cubegeometry, [
  cubematerial0,
  cubematerial1,
  <span class="hljs-comment">// ... 其他材质</span>
]);
</code></pre>
<h3 data-id="heading-21">2. 顶点组</h3>
<p>通过顶点组可以指定哪些面使用哪个材质：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置2个顶点组，形成2个材质区域</span>
geometry.<span class="hljs-title function_">addGroup</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">// 从索引0开始的3个面使用第0个材质</span>
geometry.<span class="hljs-title function_">addGroup</span>(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>);  <span class="hljs-comment">// 从索引3开始的3个面使用第1个材质</span>
</code></pre>
<h2 data-id="heading-22">第七部分：材质与纹理</h2>
<h3 data-id="heading-23">1. 纹理加载</h3>
<p>Three.js提供了多种纹理类型，可以为材质添加丰富的视觉效果：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建纹理加载器</span>
<span class="hljs-keyword">let</span> textureLoader = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>();
<span class="hljs-comment">// 加载纹理</span>
<span class="hljs-keyword">let</span> texture = textureLoader.<span class="hljs-title function_">load</span>(<span class="hljs-string">"./texture/image.png"</span>);
</code></pre>
<h3 data-id="heading-24">2. 不同类型的纹理映射</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基础颜色贴图</span>
planeMaterial.<span class="hljs-property">map</span> = texture;

<span class="hljs-comment">// AO贴图（环境遮挡）</span>
planeMaterial.<span class="hljs-property">aoMap</span> = aoMap;
planeMaterial.<span class="hljs-property">aoMapIntensity</span> = <span class="hljs-number">1</span>;

<span class="hljs-comment">// 透明度贴图</span>
planeMaterial.<span class="hljs-property">alphaMap</span> = alphaMap;

<span class="hljs-comment">// 高光贴图</span>
planeMaterial.<span class="hljs-property">specularMap</span> = specularMap;
</code></pre>
<h3 data-id="heading-25">3. 纹理颜色空间</h3>
<p>不同的纹理应使用适当的颜色空间：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置颜色空间</span>
texture.<span class="hljs-property">colorSpace</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">SRGBColorSpace</span>;      <span class="hljs-comment">// 颜色贴图</span>
<span class="hljs-comment">// texture.colorSpace = THREE.LinearSRGBColorSpace;  // 法线贴图等</span>
</code></pre>
<h2 data-id="heading-26">第八部分：雾效（Fog）</h2>
<p>Three.js提供了两种雾效类型：线性雾和指数雾。</p>
<h3 data-id="heading-27">1. 线性雾</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 线性雾：在指定距离范围内逐渐显现雾效</span>
scene.<span class="hljs-property">fog</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Fog</span>(<span class="hljs-number">0x999999</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">50</span>);  <span class="hljs-comment">// 颜色, 近距离, 远距离</span>
</code></pre>
<h3 data-id="heading-28">2. 指数雾</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 指数雾：随距离呈指数增长的雾效</span>
scene.<span class="hljs-property">fog</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">FogExp2</span>(<span class="hljs-number">0x999999</span>, <span class="hljs-number">0.1</span>);  <span class="hljs-comment">// 颜色, 密度</span>
</code></pre>
<h2 data-id="heading-29">第九部分：GLTF模型加载</h2>
<p>GLTF是一种通用的3D模型格式，Three.js提供了专门的加载器。</p>
<h3 data-id="heading-30">1. 基本GLTF加载</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/GLTFLoader.js"</span>;

<span class="hljs-comment">// 实例化加载器</span>
<span class="hljs-keyword">const</span> gltfLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();

<span class="hljs-comment">// 加载模型</span>
gltfLoader.<span class="hljs-title function_">load</span>(
  <span class="hljs-string">"./model/model.glb"</span>,  <span class="hljs-comment">// 模型路径</span>
  <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {          <span class="hljs-comment">// 加载完成回调</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf);
    scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);
  }
);
</code></pre>
<h3 data-id="heading-31">2. 使用DRACO压缩</h3>
<p>DRACO是一种3D几何压缩技术，可以显著减小模型文件大小：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DRACOLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/loaders/DRACOLoader.js"</span>;

<span class="hljs-comment">// 实例化DRACO加载器</span>
<span class="hljs-keyword">const</span> dracoLoader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DRACOLoader</span>();
<span class="hljs-comment">// 设置DRACO解码器路径</span>
dracoLoader.<span class="hljs-title function_">setDecoderPath</span>(<span class="hljs-string">"./draco/"</span>);
<span class="hljs-comment">// 设置GLTF加载器使用DRACO解码器</span>
gltfLoader.<span class="hljs-title function_">setDRACOLoader</span>(dracoLoader);
</code></pre>
<h2 data-id="heading-32">第十部分：光线投射与物体交互</h2>
<p>光线投射（Raycasting）是检测鼠标与3D物体交互的重要技术。</p>
<h3 data-id="heading-33">1. 基本光线投射</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建射线</span>
<span class="hljs-keyword">const</span> raycaster = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Raycaster</span>();
<span class="hljs-comment">// 创建鼠标向量</span>
<span class="hljs-keyword">const</span> mouse = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector2</span>();

<span class="hljs-comment">// 监听鼠标点击事件</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// 设置鼠标向量的x,y值（转换为标准化设备坐标）</span>
  mouse.<span class="hljs-property">x</span> = (event.<span class="hljs-property">clientX</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>;
  mouse.<span class="hljs-property">y</span> = -((event.<span class="hljs-property">clientY</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>);

  <span class="hljs-comment">// 通过相机和鼠标位置更新射线</span>
  raycaster.<span class="hljs-title function_">setFromCamera</span>(mouse, camera);

  <span class="hljs-comment">// 计算物体和射线的交点</span>
  <span class="hljs-keyword">const</span> intersects = raycaster.<span class="hljs-title function_">intersectObjects</span>([sphere1, sphere2, sphere3]);

  <span class="hljs-keyword">if</span> (intersects.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// 处理交点</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(intersects[<span class="hljs-number">0</span>].<span class="hljs-property">object</span>);
  }
});
</code></pre>
<h2 data-id="heading-34">第十一部分：Tween补间动画</h2>
<p>Tween.js提供了一种简单的方式来创建平滑的动画效果。</p>
<h3 data-id="heading-35">1. 基本补间动画</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">TWEEN</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three/examples/jsm/libs/tween.module.js"</span>;

<span class="hljs-comment">// 创建补间动画</span>
<span class="hljs-keyword">const</span> tween = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>(sphere1.<span class="hljs-property">position</span>);
tween.<span class="hljs-title function_">to</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">4</span> }, <span class="hljs-number">1000</span>);  <span class="hljs-comment">// 在1000毫秒内移动到x=4的位置</span>

<span class="hljs-comment">// 启动动画</span>
tween.<span class="hljs-title function_">start</span>();
</code></pre>
<h3 data-id="heading-36">2. 动画回调和链式调用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加回调函数</span>
tween
  .<span class="hljs-title function_">onStart</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"开始"</span>))
  .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"结束"</span>))
  .<span class="hljs-title function_">onUpdate</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"更新"</span>));

<span class="hljs-comment">// 链式动画</span>
<span class="hljs-keyword">let</span> tween2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>(sphere1.<span class="hljs-property">position</span>);
tween2.<span class="hljs-title function_">to</span>({ <span class="hljs-attr">x</span>: -<span class="hljs-number">4</span> }, <span class="hljs-number">1000</span>);

tween.<span class="hljs-title function_">chain</span>(tween2);   <span class="hljs-comment">// tween完成后执行tween2</span>
tween2.<span class="hljs-title function_">chain</span>(tween);   <span class="hljs-comment">// tween2完成后执行tween</span>
</code></pre>
<h3 data-id="heading-37">3. 在动画循环中更新</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  controls.<span class="hljs-title function_">update</span>();
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
  <span class="hljs-comment">// 更新tween动画</span>
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">update</span>();
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<h2 data-id="heading-38">总结</h2>
<p>通过本教程，我们学习了Three.js开发中的多个重要概念：</p>
<ol>
<li><strong>控制器和辅助工具</strong>：轨道控制器帮助我们更好地浏览3D场景，辅助坐标系帮助我们理解空间关系</li>
<li><strong>物体变换</strong>：位置、旋转、缩放以及父子层级关系的处理</li>
<li><strong>响应式设计</strong>：适配不同屏幕尺寸和全屏功能的实现</li>
<li><strong>调试工具</strong>：使用lil-gui方便地调整参数</li>
<li><strong>几何体</strong>：BufferGeometry的使用方法和优势</li>
<li><strong>材质和纹理</strong>：如何为3D对象添加丰富的视觉效果</li>
<li><strong>雾效</strong>：增强场景深度感的技术</li>
<li><strong>模型加载</strong>：加载外部3D模型的方法</li>
<li><strong>交互</strong>：光线投射实现用户与3D对象的交互</li>
<li><strong>动画</strong>：使用Tween.js创建流畅的补间动画</li>
</ol>
<p>这些知识为深入学习Three.js奠定了坚实的基础，接下来可以继续学习光照、阴影、后期处理等更高级的特性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[antd6的table排序功能]]></title>    <link>https://juejin.cn/post/7595021077665759283</link>    <guid>https://juejin.cn/post/7595021077665759283</guid>    <pubDate>2026-01-14T10:09:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665759283" data-draft-id="7595034434975678502" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="antd6的table排序功能"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-14T10:09:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="子玖"/> <meta itemprop="url" content="https://juejin.cn/user/2154698523811047"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            antd6的table排序功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2154698523811047/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    子玖
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:09:52.000Z" title="Wed Jan 14 2026 10:09:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">antd6的table排序功能</h2>
<ul>
<li>技术栈：react 19 / ts / react-query</li>
<li>效果：升序-&gt;降序-&gt;去掉排序-&gt;升序一直循环</li>
<li>如果不需要接口，可跳到实现 <code>父组件</code></li>
<li>请求参数 ：
<ul>
<li>sort_by ：排序字段（created_at/updated_at）</li>
<li>order_by ：排序方向（asc/desc，默认asc）</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">接口实现</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src\api\test.ts</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">SortField</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/types/device"</span>;
<span class="hljs-keyword">import</span> { apiClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"./http"</span>; <span class="hljs-comment">// 只是axios请求</span>
<span class="hljs-keyword">import</span> { useQuery } <span class="hljs-keyword">from</span> <span class="hljs-string">"@tanstack/react-query"</span>;

<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">Response</span> {
  <span class="hljs-attr">list</span>: []
  <span class="hljs-attr">page</span>: number
  <span class="hljs-attr">size</span>: number
  <span class="hljs-attr">total</span>: number
}

<span class="hljs-keyword">export</span> interface <span class="hljs-title class_">Params</span> {
  page?: number;
  pageSize?: number;
  sort_by?: <span class="hljs-title class_">SortField</span> | <span class="hljs-string">''</span>;
  order_by?: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-string">''</span>;
}


<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useGetList</span> = (<span class="hljs-params">params: Params</span>) =&gt; {
  <span class="hljs-keyword">return</span> useQuery&lt;<span class="hljs-title class_">Response</span>&gt;({
    <span class="hljs-attr">queryKey</span>: [<span class="hljs-string">'useGetList'</span>, params],
    <span class="hljs-attr">queryFn</span>: <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: response } = <span class="hljs-keyword">await</span> apiClient.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/test'</span>, { <span class="hljs-attr">params</span>: params })
      <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
    },
  })
}
</code></pre>
<h2 data-id="heading-2">定义类型</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src\types\test.ts</span>
<span class="hljs-comment">// 可排序字段</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SORTABLE_FIELDS</span> = [
  <span class="hljs-string">'created_at'</span>,
  <span class="hljs-string">'updated_at'</span>,
] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">export</span> type <span class="hljs-title class_">SortField</span> = <span class="hljs-keyword">typeof</span> <span class="hljs-variable constant_">SORTABLE_FIELDS</span>[number];

<span class="hljs-keyword">export</span> type <span class="hljs-title class_">SortOrderBE</span> = <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-literal">undefined</span>;
<span class="hljs-keyword">export</span> type <span class="hljs-title class_">SortOrderUI</span> = <span class="hljs-string">'ascend'</span> | <span class="hljs-string">'descend'</span>;
</code></pre>
<h2 data-id="heading-3">父组件</h2>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// src\views\test\index.tsx</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useGetList, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Device</span>, <span class="hljs-keyword">type</span> useGetDeviceListParams, } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/test'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">SortField</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/test'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-title class_">DeviceTable</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/DeviceTable'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INIT_VALUES</span> = { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">pageSize</span>: <span class="hljs-number">10</span> };

<span class="hljs-keyword">const</span> <span class="hljs-title class_">DeviceManagement</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {

  <span class="hljs-keyword">const</span> [params, setParams] = <span class="hljs-title function_">useState</span>({ ...<span class="hljs-variable constant_">INIT_VALUES</span> });
  
<span class="hljs-comment">// ⭐这里是重点</span>
  <span class="hljs-comment">// 排序处理</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSortChange</span> = (<span class="hljs-params">sortBy?: SortField | <span class="hljs-string">''</span>, orderBy?: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-string">''</span></span>) =&gt; {
    <span class="hljs-title function_">setParams</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span> ({
      ...prev,
      <span class="hljs-attr">sort_by</span>: sortBy ?? <span class="hljs-string">''</span>,
      <span class="hljs-attr">order_by</span>: orderBy ?? <span class="hljs-string">''</span>,
    }));
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">DeviceTable</span>
      // <span class="hljs-attr">多余的配置参数省略</span>，<span class="hljs-attr">也就是一些配置page</span>/<span class="hljs-attr">data之类</span>
        <span class="hljs-attr">sortBy</span>=<span class="hljs-string">{params.sort_by}</span>
        <span class="hljs-attr">orderBy</span>=<span class="hljs-string">{params.order_by}</span>
        <span class="hljs-attr">onSortChange</span>=<span class="hljs-string">{handleSortChange}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};
  
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DeviceManagement</span>;
</code></pre>
<h2 data-id="heading-4">子组件</h2>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Table</span>, type <span class="hljs-title class_">TableProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Device</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/device'</span>;
<span class="hljs-keyword">import</span> {  type <span class="hljs-title class_">SortField</span>, type <span class="hljs-title class_">SortOrderBE</span>, type <span class="hljs-title class_">SortOrderUI</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/test'</span>;

interface <span class="hljs-title class_">DeviceTableProps</span> {
  sortBy?: <span class="hljs-title class_">SortField</span> | <span class="hljs-string">''</span>;
  orderBy?: <span class="hljs-title class_">SortOrderBE</span> | <span class="hljs-string">''</span>; <span class="hljs-comment">// 改为后端类型，允许空字符串</span>
  onSortChange?: <span class="hljs-function">(<span class="hljs-params">sortBy: SortField | <span class="hljs-string">''</span>, orderBy: SortOrderBE | <span class="hljs-string">''</span></span>) =&gt;</span> <span class="hljs-keyword">void</span>;
}


<span class="hljs-comment">// ⭐这里是重点</span>
<span class="hljs-comment">/* ---------- 工具 ---------- */</span>
<span class="hljs-keyword">const</span> toUIOrder = (be?: <span class="hljs-title class_">SortOrderBE</span> | <span class="hljs-string">''</span>): <span class="hljs-title class_">SortOrderUI</span> | <span class="hljs-function"><span class="hljs-params">undefined</span> =&gt;</span>{
  <span class="hljs-keyword">return</span> be === <span class="hljs-string">'asc'</span> ? <span class="hljs-string">'ascend'</span> : be === <span class="hljs-string">'desc'</span> ? <span class="hljs-string">'descend'</span> : <span class="hljs-literal">undefined</span>;
}
<span class="hljs-comment">/**
 * 设备表格组件
 * 展示设备列表数据并提供分页和编辑功能
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DeviceTable</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">DeviceTableProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  sortBy,
  orderBy,
  onSortChange,
}</span>) =&gt;</span> {

  <span class="hljs-comment">// 表格列配置</span>
  <span class="hljs-keyword">const</span> columns = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'ID'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'id'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'id'</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'创建时间'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'created_at'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'created_at'</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">170</span>,
      <span class="hljs-attr">sorter</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">sortOrder</span>: sortBy === <span class="hljs-string">'created_at'</span> ? <span class="hljs-title function_">toUIOrder</span>(orderBy) : <span class="hljs-literal">null</span>,
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'更新时间'</span>,
      <span class="hljs-attr">dataIndex</span>: <span class="hljs-string">'updated_at'</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">'updated_at'</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">170</span>,
      <span class="hljs-attr">sorter</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">sortOrder</span>: sortBy === <span class="hljs-string">'updated_at'</span> ? <span class="hljs-title function_">toUIOrder</span>(orderBy) : <span class="hljs-literal">null</span>,
    },
  ];

<span class="hljs-comment">// ⭐这里是重点</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">handleTableChange</span>: <span class="hljs-title class_">TableProps</span>&lt;<span class="hljs-title class_">Device</span>&gt;[<span class="hljs-string">'onChange'</span>] = <span class="hljs-function">(<span class="hljs-params">_, __, sorter</span>) =&gt;</span> {
  <span class="hljs-comment">// 如果 sorter 是数组或者没有字段，直接返回</span>
  <span class="hljs-keyword">const</span> single = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(sorter) ? sorter[<span class="hljs-number">0</span>] : sorter;
  <span class="hljs-keyword">const</span> field = single.<span class="hljs-property">field</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">SortField</span>;
  <span class="hljs-comment">// 三态：ascend → descend → null（取消）</span>
  <span class="hljs-keyword">if</span> (!single.<span class="hljs-property">order</span>) {
    <span class="hljs-comment">// 第三次点击：把 undefined 传出去</span>
    onSortChange?.(<span class="hljs-string">''</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">const</span> order = single.<span class="hljs-property">order</span> === <span class="hljs-string">'ascend'</span> ? <span class="hljs-string">'asc'</span> : <span class="hljs-string">'desc'</span>;
  onSortChange?.(field, order);
};

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Table</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{columns}</span>
        // <span class="hljs-attr">其他配置省略</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleTableChange}</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DeviceTable</span>;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[图片标注框选组件]]></title>    <link>https://juejin.cn/post/7594320543219417134</link>    <guid>https://juejin.cn/post/7594320543219417134</guid>    <pubDate>2026-01-12T17:21:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594320543219417134" data-draft-id="7594309641867051046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="图片标注框选组件"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2026-01-12T17:21:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FanetheDivine"/> <meta itemprop="url" content="https://juejin.cn/user/4246761716322491"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            图片标注框选组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4246761716322491/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FanetheDivine
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-12T17:21:18.000Z" title="Mon Jan 12 2026 17:21:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">实际效果</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b0610d273084ccea6292aa3ce8037b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768959999&amp;x-signature=W25g%2FE%2B24v%2FJgYxagcOhQlZsu2k%3D" alt="1.gif" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7a13c3d470d4cc7ab97d7c3daefbdd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768959999&amp;x-signature=9oR2QoEL95%2ByjaNf7xYYEV1%2BbUU%3D" alt="动画.gif" loading="lazy"/></p>
<h2 data-id="heading-1">主要思路</h2>
<ul>
<li>从img标签获取图片原始尺寸 获取图片容器尺寸</li>
<li>计算图片实际展示的宽高 将基于原始尺寸的坐标转化为基于展示尺寸的 并设置相应的拖拽区</li>
<li>选择框框使用motion.div构建 用x/y/width/height四个motion value描述</li>
<li>选择框框整体拖拽使用motion自带功能即可 但四边、四角的拖拽逻辑要手写</li>
<li>选择框按照左上角的位置进行排序 设置zindex 越靠上越靠左z越小 尽可能避免某个拖拽框被完全遮盖</li>
</ul>
<h2 data-id="heading-2">代码结构</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20d73b4c92b34716a08fdbc7a3778aa9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRmFuZXRoZURpdmluZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768959999&amp;x-signature=wvDyDmpTCjYLky8zuBFCYUaOnb4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">实际代码</h2>
<h3 data-id="heading-4">common.ts</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { match } <span class="hljs-keyword">from</span> <span class="hljs-string">'ts-pattern'</span>

<span class="hljs-comment">/** 选择框 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectBox</span> = {
  <span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>
  <span class="hljs-comment">/** 左上角坐标和右下角坐标 */</span>
  <span class="hljs-attr">position</span>: [<span class="hljs-attr">x1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y1</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">x2</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y2</span>: <span class="hljs-built_in">number</span>]
  style?: {
    fill?: <span class="hljs-built_in">string</span>
    border?: <span class="hljs-built_in">string</span>
    borderWidth?: <span class="hljs-built_in">number</span>
  }
}

<span class="hljs-comment">/** 区域或图片的大小 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Size</span> = {
  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">/** 获取图片的原始尺寸 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getImageNaturalSize</span>(<span class="hljs-params">src: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()
  img.<span class="hljs-property">src</span> = src
  <span class="hljs-keyword">const</span> { promise, resolve, reject } = <span class="hljs-title class_">Promise</span>.<span class="hljs-property">withResolvers</span>&lt;<span class="hljs-title class_">Size</span>&gt;()
  img.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">width</span>: img.<span class="hljs-property">naturalWidth</span>, <span class="hljs-attr">height</span>: img.<span class="hljs-property">naturalHeight</span> })
  })
  img.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'error'</span>, reject)
  <span class="hljs-keyword">return</span> promise
}

<span class="hljs-comment">/** 计算图片的展示尺寸 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getDisplaySize</span>(<span class="hljs-params">naturalSize: Size, containerSize: Size</span>) {
  <span class="hljs-keyword">const</span> scaleX = containerSize.<span class="hljs-property">width</span> / naturalSize.<span class="hljs-property">width</span>
  <span class="hljs-keyword">const</span> scaleY = containerSize.<span class="hljs-property">height</span> / naturalSize.<span class="hljs-property">height</span>
  <span class="hljs-keyword">const</span> scale = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(scaleX, scaleY)
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">width</span>: naturalSize.<span class="hljs-property">width</span> * scale,
    <span class="hljs-attr">height</span>: naturalSize.<span class="hljs-property">height</span> * scale,
  }
}

<span class="hljs-comment">/** 计算选择框的z-index 使所有选择框都可以点击 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getBoxZIndexs</span>(<span class="hljs-params">boxs: SelectBox[]</span>) {
  <span class="hljs-keyword">const</span> keyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'key'</span>], <span class="hljs-built_in">number</span>&gt;()
  <span class="hljs-comment">// 矩形靠上、靠左的 z较低</span>
  <span class="hljs-keyword">const</span> sorted = [...boxs].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">A, B</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> {
      <span class="hljs-attr">position</span>: [<span class="hljs-title class_">Ax1</span>, <span class="hljs-title class_">Ay1</span>],
    } = A
    <span class="hljs-keyword">const</span> {
      <span class="hljs-attr">position</span>: [<span class="hljs-title class_">Bx1</span>, <span class="hljs-title class_">By1</span>],
    } = B
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Ay1</span> !== <span class="hljs-title class_">By1</span> ? <span class="hljs-title class_">Ay1</span> - <span class="hljs-title class_">By1</span> : <span class="hljs-title class_">Ax1</span> - <span class="hljs-title class_">Bx1</span>
  })
  sorted.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> {
    keyMap.<span class="hljs-title function_">set</span>(item.<span class="hljs-property">key</span>, i)
  })
  <span class="hljs-keyword">return</span> boxs.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> keyMap.<span class="hljs-title function_">get</span>(item.<span class="hljs-property">key</span>))
}

<span class="hljs-comment">/**
 * 将基于原始尺寸的坐标转化为基于展示尺寸的坐标 或者反过来/
 * 转化后的坐标不小于0 不大于目标尺寸的最大值
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">convertPosition</span>(<span class="hljs-params">
  position: SelectBox[<span class="hljs-string">'position'</span>],
  naturalSize: Size,
  displaySize: Size,
  to: <span class="hljs-string">'natural'</span> | <span class="hljs-string">'display'</span>,
</span>) {
  <span class="hljs-keyword">const</span> [originSize, resultSize] = <span class="hljs-title function_">match</span>(to)
    .<span class="hljs-title function_">with</span>(<span class="hljs-string">'display'</span>, <span class="hljs-function">() =&gt;</span> [naturalSize, displaySize])
    .<span class="hljs-title function_">with</span>(<span class="hljs-string">'natural'</span>, <span class="hljs-function">() =&gt;</span> [displaySize, naturalSize])
    .<span class="hljs-title function_">exhaustive</span>()
  <span class="hljs-keyword">const</span> scaleX = resultSize.<span class="hljs-property">width</span> / originSize.<span class="hljs-property">width</span>
  <span class="hljs-keyword">const</span> scaleY = resultSize.<span class="hljs-property">height</span> / originSize.<span class="hljs-property">height</span>
  <span class="hljs-keyword">const</span> maxX = resultSize.<span class="hljs-property">width</span>
  <span class="hljs-keyword">const</span> maxY = resultSize.<span class="hljs-property">height</span>
  <span class="hljs-keyword">const</span> [x1, y1, x2, y2] = position
  <span class="hljs-keyword">return</span> [
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(x1 * scaleX, maxX)),
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(y1 * scaleY, maxY)),
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(x2 * scaleX, maxX)),
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(y2 * scaleY, maxY)),
  ] <span class="hljs-keyword">as</span> <span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'position'</span>]
}

<span class="hljs-comment">/** 获取符合左上右下顺序的position */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getLegalPosition</span>(<span class="hljs-params">position: SelectBox[<span class="hljs-string">'position'</span>]</span>) {
  <span class="hljs-keyword">const</span> [_x1, _y1, _x2, _y2] = position
  <span class="hljs-keyword">const</span> [x1, x2] = _x1 &lt;= _x2 ? [_x1, _x2] : [_x2, _x1]
  <span class="hljs-keyword">const</span> [y1, y2] = _y1 &lt;= _y2 ? [_y1, _y2] : [_y2, _y1]
  <span class="hljs-keyword">return</span> [x1, y1, x2, y2] <span class="hljs-keyword">as</span> <span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'position'</span>]
}

<span class="hljs-comment">/** 拖拽方向类型 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">DragDirection</span> =
  | <span class="hljs-string">'top'</span>
  | <span class="hljs-string">'top-left'</span>
  | <span class="hljs-string">'top-right'</span>
  | <span class="hljs-string">'left'</span>
  | <span class="hljs-string">'right'</span>
  | <span class="hljs-string">'bottom'</span>
  | <span class="hljs-string">'bottom-left'</span>
  | <span class="hljs-string">'bottom-right'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">DirectionCursorMap</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">DragDirection</span>, <span class="hljs-built_in">string</span>&gt; = {
  <span class="hljs-attr">top</span>: <span class="hljs-string">'ns-resize'</span>,
  <span class="hljs-attr">bottom</span>: <span class="hljs-string">'ns-resize'</span>,
  <span class="hljs-attr">left</span>: <span class="hljs-string">'ew-resize'</span>,
  <span class="hljs-attr">right</span>: <span class="hljs-string">'ew-resize'</span>,
  <span class="hljs-string">'top-left'</span>: <span class="hljs-string">'nwse-resize'</span>,
  <span class="hljs-string">'bottom-right'</span>: <span class="hljs-string">'nwse-resize'</span>,
  <span class="hljs-string">'top-right'</span>: <span class="hljs-string">'nesw-resize'</span>,
  <span class="hljs-string">'bottom-left'</span>: <span class="hljs-string">'nesw-resize'</span>,
}

<span class="hljs-comment">/** 根据拖拽方向获取鼠标指针样式 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCursorStyle</span>(<span class="hljs-params">dir: DragDirection</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">DirectionCursorMap</span>[dir]
}

</code></pre>
<h3 data-id="heading-5">index.tsx</h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> {
  useRef,
  forwardRef,
  useImperativeHandle,
  useState,
  useMemo,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Skeleton</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>
<span class="hljs-keyword">import</span> { useMemoizedFn, useSize } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahooks'</span>
<span class="hljs-keyword">import</span> useSWR <span class="hljs-keyword">from</span> <span class="hljs-string">'swr'</span>
<span class="hljs-keyword">import</span> { match, P } <span class="hljs-keyword">from</span> <span class="hljs-string">'ts-pattern'</span>
<span class="hljs-keyword">import</span> { cn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SelectBoxComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SelectBoxComponent'</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectBox</span>,
  convertPosition,
  getImageNaturalSize,
  getDisplaySize,
  getBoxZIndexs,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>

<span class="hljs-keyword">export</span> { <span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ImageSelectBoxProps</span> = <span class="hljs-title class_">Style</span> &amp; {
  <span class="hljs-attr">src</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">boxs</span>: <span class="hljs-title class_">SelectBox</span>[]
  <span class="hljs-attr">onPositionChange</span>: <span class="hljs-function">(<span class="hljs-params">key: SelectBox[<span class="hljs-string">'key'</span>], position: SelectBox[<span class="hljs-string">'position'</span>]</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onCreateBox?: <span class="hljs-function">(<span class="hljs-params">position: SelectBox[<span class="hljs-string">'position'</span>]</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onClick?: <span class="hljs-function">(<span class="hljs-params">boxKey: SelectBox[<span class="hljs-string">'key'</span>] | <span class="hljs-literal">undefined</span>, e: React.MouseEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ImageSelectBoxInstance</span> = {
  <span class="hljs-comment">/** 调用此函数后 在拖拽区点击 便可创建一个新的区域并开启其拖拽 */</span>
  <span class="hljs-attr">createBox</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ImageSelectBox</span> = forwardRef&lt;<span class="hljs-title class_">ImageSelectBoxInstance</span>, <span class="hljs-title class_">ImageSelectBoxProps</span>&gt;(
  <span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { src, boxs, onPositionChange, onCreateBox, onClick, className, style } = props

    <span class="hljs-comment">// 图片和拖拽区的尺寸</span>
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: naturalSize, isValidating, error } = <span class="hljs-title function_">useSWR</span>(src, getImageNaturalSize)
    <span class="hljs-keyword">const</span> containerRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>)
    <span class="hljs-keyword">const</span> containerSize = <span class="hljs-title function_">useSize</span>(containerRef)
    <span class="hljs-comment">// 计算展示尺寸</span>
    <span class="hljs-keyword">const</span> displaySize = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (!naturalSize || !containerSize) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>
      <span class="hljs-keyword">const</span> size = <span class="hljs-title function_">getDisplaySize</span>(naturalSize, containerSize)
      <span class="hljs-keyword">return</span> size
    }, [containerSize, naturalSize])
    <span class="hljs-keyword">const</span> dragRange = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>)

    <span class="hljs-comment">// 为选择框设置zindex 避免重叠遮挡</span>
    <span class="hljs-keyword">const</span> zIndexList = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> zList = <span class="hljs-title function_">getBoxZIndexs</span>(boxs)
      <span class="hljs-keyword">return</span> zList
    }, [boxs])
    
    <span class="hljs-comment">// 用于点击选择框事件 如果指针移动 则不触发此事件</span>
    <span class="hljs-keyword">const</span> pointerMoved = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>)

    <span class="hljs-comment">// 创建选择框</span>
    <span class="hljs-keyword">const</span> isCreating = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">const</span> [creatingInitPosition, setInitPosition] = useState&lt;<span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'position'</span>]&gt;()
    <span class="hljs-keyword">const</span> createBox = <span class="hljs-title function_">useMemoizedFn</span>(<span class="hljs-function">() =&gt;</span> {
      isCreating.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>
    })
    <span class="hljs-title function_">useImperativeHandle</span>(
      ref,
      <span class="hljs-function">() =&gt;</span> ({
        createBox,
      }),
      [createBox],
    )
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">{cn(</span>
          '<span class="hljs-attr">relative</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">h-full</span> <span class="hljs-attr">w-full</span> <span class="hljs-attr">items-center</span> <span class="hljs-attr">justify-center</span> <span class="hljs-attr">overflow-hidden</span>',
          <span class="hljs-attr">className</span>,
        )}
        <span class="hljs-attr">style</span>=<span class="hljs-string">{style}</span>
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
          if (e.target === e.currentTarget) {
            onClick?.(undefined, e)
          }
        }}
        ref={containerRef}
      &gt;
        {match({ isValidating, error: error as Error | null, naturalSize, displaySize })
          .with({ isValidating: false, error: P.nonNullable }, () =&gt; '图片加载失败')
          .with(
            { isValidating: false, naturalSize: P.nonNullable, displaySize: P.nonNullable },
            ({ naturalSize, displaySize }) =&gt; (
              <span class="hljs-tag">&lt;&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'h-full w-full object-contain'</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
                  <span class="hljs-attr">className</span>=<span class="hljs-string">'absolute top-1/2 left-1/2 z-10 -translate-x-1/2 -translate-y-1/2'</span>
                  <span class="hljs-attr">style</span>=<span class="hljs-string">{displaySize}</span>
                  <span class="hljs-attr">ref</span>=<span class="hljs-string">{dragRange}</span>
                  <span class="hljs-attr">onPointerDownCapture</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
                    pointerMoved.current = false
                    if (!isCreating.current) return
                    if (!dragRange.current) return
                    e.stopPropagation()
                    const { clientX, clientY } = e
                    const { x = 0, y = 0 } = dragRange.current.getBoundingClientRect()
                    const x1 = clientX - x
                    const y1 = clientY - y
                    setInitPosition([x1, y1, x1, y1])
                  }}
                  onPointerMoveCapture={()=&gt;{
                    pointerMoved.current = true
                  }}
                &gt;
                  {boxs.map((b, i) =&gt; (
                    <span class="hljs-tag">&lt;<span class="hljs-name">SelectBoxComponent</span>
                      <span class="hljs-attr">key</span>=<span class="hljs-string">{b.key}</span>
                      <span class="hljs-attr">position</span>=<span class="hljs-string">{convertPosition(b.position,</span> <span class="hljs-attr">naturalSize</span>, <span class="hljs-attr">displaySize</span>, '<span class="hljs-attr">display</span>')}
                      <span class="hljs-attr">dragRange</span>=<span class="hljs-string">{dragRange}</span>
                      <span class="hljs-attr">onPositionChange</span>=<span class="hljs-string">{(val)</span> =&gt;</span>
                        onPositionChange?.(
                          b.key,
                          convertPosition(val, naturalSize, displaySize, 'natural'),
                        )
                      }
                      onClick={(e) =&gt; {
                        // 如果鼠标移动了 不触发点击
                        if (pointerMoved.current) return
                        onClick?.(b.key, e)
                      }}
                      style={{ zIndex: zIndexList[i] }}
                    /&gt;
                  ))}
                  {creatingInitPosition ? (
                    <span class="hljs-tag">&lt;<span class="hljs-name">SelectBoxComponent</span>
                      <span class="hljs-attr">position</span>=<span class="hljs-string">{creatingInitPosition}</span>
                      <span class="hljs-attr">defaultDragDirection</span>=<span class="hljs-string">'bottom-right'</span>
                      <span class="hljs-attr">dragRange</span>=<span class="hljs-string">{dragRange}</span>
                      <span class="hljs-attr">onPositionChange</span>=<span class="hljs-string">{(val)</span> =&gt;</span> {
                        onCreateBox?.(convertPosition(val, naturalSize, displaySize, 'natural'))
                        setInitPosition(undefined)
                      }}
                      style={{ zIndex: 9999 }}
                    /&gt;
                  ) : null}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;/&gt;</span></span>
            ),
          )
          .<span class="hljs-title function_">otherwise</span>(<span class="hljs-function">() =&gt;</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Skeleton</span> <span class="hljs-attr">active</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'p-4'</span> /&gt;</span></span>
          ))}
      &lt;/div&gt;
    )
  },
)

</code></pre>
<h3 data-id="heading-6">SelectBoxComponent/index.tsx</h3>
<p>这个文件包含了拖拽逻辑 包括溢出和翻转等</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useLayoutEffect, <span class="hljs-variable constant_">FC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> { useMemoizedFn, useMount } <span class="hljs-keyword">from</span> <span class="hljs-string">'ahooks'</span>
<span class="hljs-keyword">import</span> { motion, useMotionValue } <span class="hljs-keyword">from</span> <span class="hljs-string">'motion/react'</span>
<span class="hljs-keyword">import</span> { cn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils'</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectBox</span>,
  getLegalPosition,
  getCursorStyle,
  <span class="hljs-title class_">DirectionCursorMap</span>,
  <span class="hljs-title class_">DragDirection</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'../common'</span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./styles.module.css'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectBoxComponentProps</span> = <span class="hljs-title class_">Style</span> &amp; {
  <span class="hljs-attr">position</span>: <span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'position'</span>]
  <span class="hljs-attr">dragRange</span>: { <span class="hljs-attr">current</span>: <span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span> }
  onPositionChange?: <span class="hljs-function">(<span class="hljs-params">val: SelectBox[<span class="hljs-string">'position'</span>]</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  onClick?: <span class="hljs-function">(<span class="hljs-params">e: React.MouseEvent</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  boxStyle?: <span class="hljs-title class_">SelectBox</span>[<span class="hljs-string">'style'</span>]
  <span class="hljs-comment">/** 传入此项 则选择框初始可拖拽 */</span>
  defaultDragDirection?: <span class="hljs-title class_">DragDirection</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">SelectBoxComponent</span>: <span class="hljs-variable constant_">FC</span>&lt;<span class="hljs-title class_">SelectBoxComponentProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> {
    position,
    dragRange,
    boxStyle,
    onPositionChange,
    onClick,
    defaultDragDirection,
    className,
    style,
  } = props
  <span class="hljs-keyword">const</span> { fill = <span class="hljs-string">'#ff000010'</span>, border = <span class="hljs-string">'#ff0000'</span>, borderWidth = <span class="hljs-number">2</span> } = boxStyle ?? {}

  <span class="hljs-keyword">const</span> x = <span class="hljs-title function_">useMotionValue</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> y = <span class="hljs-title function_">useMotionValue</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> width = <span class="hljs-title function_">useMotionValue</span>(<span class="hljs-number">0</span>)
  <span class="hljs-keyword">const</span> height = <span class="hljs-title function_">useMotionValue</span>(<span class="hljs-number">0</span>)
  <span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> [x1, y1, x2, y2] = <span class="hljs-title function_">getLegalPosition</span>(position)
    x.<span class="hljs-title function_">set</span>(x1)
    y.<span class="hljs-title function_">set</span>(y1)
    width.<span class="hljs-title function_">set</span>(x2 - x1)
    height.<span class="hljs-title function_">set</span>(y2 - y1)
  }, [height, position, width, x, y])
  <span class="hljs-keyword">const</span> onDragEnd = <span class="hljs-title function_">useMemoizedFn</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> x1 = x.<span class="hljs-title function_">get</span>()
    <span class="hljs-keyword">const</span> y1 = y.<span class="hljs-title function_">get</span>()
    <span class="hljs-keyword">const</span> x2 = x1 + width.<span class="hljs-title function_">get</span>()
    <span class="hljs-keyword">const</span> y2 = y1 + height.<span class="hljs-title function_">get</span>()
    onPositionChange?.([x1, y1, x2, y2])
  })

  <span class="hljs-comment">/**
   * 拖拽区应当跟随鼠标移动 因此可以根据鼠标位置设置矩形四点的位置
   */</span>
  <span class="hljs-keyword">const</span> startHandlerDrag = <span class="hljs-title function_">useMemoizedFn</span>(<span class="hljs-function">(<span class="hljs-params">dir: DragDirection</span>) =&gt;</span> {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(styles.<span class="hljs-property">dragging</span>)
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">setProperty</span>(<span class="hljs-string">'--cursor-style'</span>, <span class="hljs-title function_">getCursorStyle</span>(dir))
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'pointermove'</span>, onHandlerDrag)
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'pointerup'</span>, stopHandlerDrag)

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopHandlerDrag</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(styles.<span class="hljs-property">dragging</span>)
      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">removeProperty</span>(<span class="hljs-string">'--cursor-style'</span>)
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'pointermove'</span>, onHandlerDrag)
      <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'pointerup'</span>, stopHandlerDrag)
      <span class="hljs-title function_">onDragEnd</span>()
    }

    <span class="hljs-keyword">let</span> currentDirection = dir
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">onHandlerDrag</span>(<span class="hljs-params">e: PointerEvent</span>) {
      <span class="hljs-keyword">if</span> (!dragRange.<span class="hljs-property">current</span>) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">const</span> { clientX, clientY } = e
      <span class="hljs-keyword">const</span> {
        <span class="hljs-attr">x</span>: rangeX,
        <span class="hljs-attr">y</span>: rangeY,
        <span class="hljs-attr">width</span>: maxWidth,
        <span class="hljs-attr">height</span>: maxHeight,
      } = dragRange.<span class="hljs-property">current</span>.<span class="hljs-title function_">getBoundingClientRect</span>()

      <span class="hljs-comment">// 在允许水平拖拽时计算x/width</span>
      <span class="hljs-comment">// 注意矩形翻转的问题</span>
      <span class="hljs-keyword">if</span> (currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'left'</span>) || currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'right'</span>)) {
        <span class="hljs-keyword">const</span> currentX1 = x.<span class="hljs-title function_">get</span>()
        <span class="hljs-keyword">const</span> currentX2 = currentX1 + width.<span class="hljs-title function_">get</span>()
        <span class="hljs-keyword">const</span> isLeft = currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'left'</span>)
        <span class="hljs-keyword">let</span> [newCurrentX1, newCurrentX2] = isLeft
          ? [clientX - rangeX, currentX2]
          : [currentX1, clientX - rangeX]
        <span class="hljs-comment">// newCurrentX1 &gt; newCurrentX2 说明之前的左上点变为了右上点 矩形翻转了</span>
        <span class="hljs-comment">// 翻转后 拖拽防线同样需要更改</span>
        <span class="hljs-keyword">if</span> (newCurrentX1 &gt; newCurrentX2) {
          ;[newCurrentX1, newCurrentX2] = [newCurrentX2, newCurrentX1]
          currentDirection = (
            isLeft
              ? currentDirection.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>)
              : currentDirection.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'right'</span>, <span class="hljs-string">'left'</span>)
          ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">DragDirection</span>
        }
        <span class="hljs-comment">// 矩形大小溢出</span>
        <span class="hljs-keyword">if</span> (newCurrentX1 &lt; <span class="hljs-number">0</span>) {
          newCurrentX1 = <span class="hljs-number">0</span>
        }
        <span class="hljs-keyword">if</span> (newCurrentX2 &gt; maxWidth) {
          newCurrentX2 = maxWidth
        }
        x.<span class="hljs-title function_">set</span>(newCurrentX1)
        width.<span class="hljs-title function_">set</span>(newCurrentX2 - newCurrentX1)
      }
      <span class="hljs-comment">// 在允许竖直拖拽时计算y/height 逻辑类似</span>
      <span class="hljs-keyword">if</span> (currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'top'</span>) || currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'bottom'</span>)) {
        <span class="hljs-keyword">const</span> currentY1 = y.<span class="hljs-title function_">get</span>()
        <span class="hljs-keyword">const</span> currentY2 = currentY1 + height.<span class="hljs-title function_">get</span>()
        <span class="hljs-keyword">const</span> isTop = currentDirection.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'top'</span>)
        <span class="hljs-keyword">let</span> [newCurrentY1, newCurrentY2] = isTop
          ? [clientY - rangeY, currentY2]
          : [currentY1, clientY - rangeY]
        <span class="hljs-keyword">if</span> (newCurrentY1 &gt; newCurrentY2) {
          ;[newCurrentY1, newCurrentY2] = [newCurrentY2, newCurrentY1]
          currentDirection = (
            isTop
              ? currentDirection.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'top'</span>, <span class="hljs-string">'bottom'</span>)
              : currentDirection.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'bottom'</span>, <span class="hljs-string">'top'</span>)
          ) <span class="hljs-keyword">as</span> <span class="hljs-title class_">DragDirection</span>
        }
        <span class="hljs-keyword">if</span> (newCurrentY1 &lt; <span class="hljs-number">0</span>) {
          newCurrentY1 = <span class="hljs-number">0</span>
        }
        <span class="hljs-keyword">if</span> (newCurrentY2 &gt; maxHeight) {
          newCurrentY2 = maxHeight
        }
        y.<span class="hljs-title function_">set</span>(newCurrentY1)
        height.<span class="hljs-title function_">set</span>(newCurrentY2 - newCurrentY1)
      }
    }
  })

  <span class="hljs-title function_">useMount</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (defaultDragDirection) {
      <span class="hljs-title function_">startHandlerDrag</span>(defaultDragDirection)
    }
  })
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">motion.div</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">{cn(</span>'<span class="hljs-attr">absolute</span> <span class="hljs-attr">top-0</span> <span class="hljs-attr">left-0</span>', <span class="hljs-attr">styles.selectBox</span>, <span class="hljs-attr">className</span>)}
      <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
        // @<span class="hljs-attr">ts-expect-error</span> <span class="hljs-attr">为拖拽手柄提供css变量</span>
        '<span class="hljs-attr">--handler-width</span>'<span class="hljs-attr">:</span> `${<span class="hljs-attr">borderWidth</span>}<span class="hljs-attr">px</span>`,
        '<span class="hljs-attr">--handler-background-color</span>'<span class="hljs-attr">:</span> <span class="hljs-attr">border</span>,
        <span class="hljs-attr">backgroundColor:</span> <span class="hljs-attr">fill</span>,
        <span class="hljs-attr">x</span>,
        <span class="hljs-attr">y</span>,
        <span class="hljs-attr">width</span>,
        <span class="hljs-attr">height</span>,
        <span class="hljs-attr">...style</span>,
      }}
      <span class="hljs-attr">drag</span>
      <span class="hljs-attr">dragElastic</span>=<span class="hljs-string">{0}</span>
      <span class="hljs-attr">dragMomentum</span>=<span class="hljs-string">{false}</span>
      <span class="hljs-attr">dragConstraints</span>=<span class="hljs-string">{dragRange}</span>
      <span class="hljs-attr">onDragEnd</span>=<span class="hljs-string">{onDragEnd}</span>
      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>
    &gt;</span>
      {Object.keys(DirectionCursorMap).map((dir) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{dir}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{cn(styles.handler,</span> <span class="hljs-attr">styles</span>[<span class="hljs-attr">dir</span>])}
          <span class="hljs-attr">onPointerDownCapture</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
            e.stopPropagation()
            startHandlerDrag(dir as DragDirection)
          }}
        &gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">motion.div</span>&gt;</span></span>
  )
}


</code></pre>
<h3 data-id="heading-7">SelectBoxComponent/styles.module.css</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.dragging</span> {

  &amp;,
  &amp; * {
    <span class="hljs-attribute">cursor</span>: <span class="hljs-built_in">var</span>(--cursor-style) <span class="hljs-meta">!important</span>;
  }
}

<span class="hljs-selector-class">.selectBox</span> {
  <span class="hljs-selector-class">.handler</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">var</span>(--handler-width);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">var</span>(--handler-width);
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--handler-background-color);

    <span class="hljs-comment">/* 角落手柄 - 正方形 */</span>
    &amp;<span class="hljs-selector-class">.top-left</span> {
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">cursor</span>: nwse-resize;
    }

    &amp;<span class="hljs-selector-class">.top-right</span> {
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">cursor</span>: nesw-resize;
    }

    &amp;<span class="hljs-selector-class">.bottom-left</span> {
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">cursor</span>: nesw-resize;
    }

    &amp;<span class="hljs-selector-class">.bottom-right</span> {
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">cursor</span>: nwse-resize;
    }

    <span class="hljs-comment">/* 边缘手柄 - 矩形 */</span>
    &amp;<span class="hljs-selector-class">.top</span> {
      <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">right</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">width</span>: auto;
      <span class="hljs-attribute">cursor</span>: ns-resize;
    }

    &amp;<span class="hljs-selector-class">.bottom</span> {
      <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">left</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">right</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">width</span>: auto;
      <span class="hljs-attribute">cursor</span>: ns-resize;
    }

    &amp;<span class="hljs-selector-class">.left</span> {
      <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">bottom</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">height</span>: auto;
      <span class="hljs-attribute">cursor</span>: ew-resize;
    }

    &amp;<span class="hljs-selector-class">.right</span> {
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">top</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">bottom</span>: <span class="hljs-built_in">var</span>(--handler-width);
      <span class="hljs-attribute">height</span>: auto;
      <span class="hljs-attribute">cursor</span>: ew-resize;
    }
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter最佳实践：路由弹窗终极版NSlidePopupRoute]]></title>    <link>https://juejin.cn/post/7594835618120630312</link>    <guid>https://juejin.cn/post/7594835618120630312</guid>    <pubDate>2026-01-14T10:16:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120630312" data-draft-id="7589835342146093066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter最佳实践：路由弹窗终极版NSlidePopupRoute"/> <meta itemprop="keywords" content="前端,Flutter"/> <meta itemprop="datePublished" content="2026-01-14T10:16:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SoaringHeart"/> <meta itemprop="url" content="https://juejin.cn/user/3544481219481374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter最佳实践：路由弹窗终极版NSlidePopupRoute
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3544481219481374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SoaringHeart
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:16:37.000Z" title="Wed Jan 14 2026 10:16:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、需求来源</h2>
<p>最近需要实现弹窗，动画方向分为：</p>
<ol>
<li>从屏幕顶部滑动到屏幕内，top-&gt;Center。</li>
<li>从屏幕底部滑动到屏幕内，bottom-&gt;Center。</li>
<li>从屏幕左侧滑动到屏幕内，left-&gt;Center。</li>
<li>从屏幕右侧滑动到屏幕内，right-&gt;Center。</li>
<li>直接显示在屏幕中间，Center-&gt;Center。</li>
</ol>
<p>最终实现以 Alignment 参数为动画方向，弹窗内容高度和宽度自定义，实现从哪个方向弹出就从哪个方向消失的高自由度。彻底突破了 ModalBottomSheet 的方向显示。
效果图如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd6f61c328cc465680fc258b4d35532a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=eMH6yEtL597plNJlh4VeqSckpOE%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.41.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87f3e1c4b6ef489284f60f724d27aff5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=DvtcquIvOq51wx2YWHZxjcs9BXY%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.43.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/704337ca7ab647ada987bcbdab647bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=yOK7BSeHA%2B8ET%2FTdJJnez3k1qe4%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.45.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db0ac7dd3ddf4250badb36380399b30b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=3bizmxzCvugyies37u1Kbqk0zy0%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.48.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c08f35a5439944718bcee41989cd1d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=JjxJnJlUDV%2FNi1OFv8GCsYlAJtg%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.51.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b5bfdc5a98d4ec6930a06ff11e04eb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=fzfhzL2qprpbAVVCWxT%2FORQ75OQ%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.53.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e4f2f3dd39403fb1a0520f1c555eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=9Lvik1Watkronx72JXJYKm8G2B0%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.36.59.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46415d2022e474fa6d8dc9beacc82d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=Q%2FbQaGCp9lZ0wm4IYvRgpnhRvdw%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.37.01.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe7aa9ee81064c33a819b4e2bafab1df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU29hcmluZ0hlYXJ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990597&amp;x-signature=2lOcbRtDLADN0Yfv7bhSJi0SodM%3D" alt="Simulator Screenshot - iPhone 16 - 2025-12-27 at 11.37.04.png" loading="lazy"/></p>
<h2 data-id="heading-1">二、使用示例</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> '<span class="hljs-selector-tag">package</span>:<span class="hljs-selector-tag">flutter</span>/<span class="hljs-selector-tag">material</span><span class="hljs-selector-class">.dart</span>';
<span class="hljs-selector-tag">import</span> '<span class="hljs-selector-tag">package</span>:<span class="hljs-selector-tag">n_slide_popup</span>/<span class="hljs-selector-tag">n_slide_popup</span><span class="hljs-selector-class">.dart</span>';

<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>() {
  <span class="hljs-selector-tag">runApp</span>(const <span class="hljs-built_in">MyApp</span>());
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MyApp</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatelessWidget</span> {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">MyApp</span>({<span class="hljs-selector-tag">super</span><span class="hljs-selector-class">.key</span>});

  <span class="hljs-comment">// This widget is the root of your application.</span>
  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">MaterialApp</span>(
      <span class="hljs-attribute">title</span>: <span class="hljs-string">'Flutter Demo'</span>,
      <span class="hljs-attribute">theme</span>: <span class="hljs-built_in">ThemeData</span>(
        <span class="hljs-attribute">colorScheme</span>: ColorScheme.<span class="hljs-built_in">fromSeed</span>(<span class="hljs-attribute">seedColor</span>: Colors.blue),
        <span class="hljs-attribute">useMaterial3</span>: true,
      ),
      <span class="hljs-attribute">home</span>: const <span class="hljs-built_in">MyHomePage</span>(<span class="hljs-attribute">title</span>: <span class="hljs-string">'Home Page'</span>),
    );
  }
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">MyHomePage</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatefulWidget</span> {
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">MyHomePage</span>({<span class="hljs-selector-tag">super</span><span class="hljs-selector-class">.key</span>, <span class="hljs-selector-tag">required</span> <span class="hljs-selector-tag">this</span><span class="hljs-selector-class">.title</span>});

  <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">title</span>;

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">State</span>&lt;<span class="hljs-selector-tag">MyHomePage</span>&gt; <span class="hljs-selector-tag">createState</span>() =&gt; <span class="hljs-selector-tag">_MyHomePageState</span>();
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">_MyHomePageState</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">State</span>&lt;<span class="hljs-selector-tag">MyHomePage</span>&gt; {
  <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">Alignment</span>&gt; <span class="hljs-selector-tag">alignments</span> = <span class="hljs-selector-attr">[    Alignment.topLeft,    Alignment.topCenter,    Alignment.topRight,    Alignment.centerLeft,    Alignment.center,    Alignment.centerRight,    Alignment.bottomLeft,    Alignment.bottomCenter,    Alignment.bottomRight,  ]</span>;

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">alignment</span> = <span class="hljs-selector-tag">Alignment</span><span class="hljs-selector-class">.center</span>;

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Scaffold</span>(
      <span class="hljs-attribute">appBar</span>: <span class="hljs-built_in">AppBar</span>(
        <span class="hljs-attribute">backgroundColor</span>: Theme.<span class="hljs-built_in">of</span>(context).colorScheme.inversePrimary,
        <span class="hljs-attribute">title</span>: <span class="hljs-built_in">Text</span>(widget.title),
      ),
      <span class="hljs-attribute">body</span>: <span class="hljs-built_in">Column</span>(
        <span class="hljs-attribute">mainAxisAlignment</span>: MainAxisAlignment.center,
        <span class="hljs-attribute">children</span>: &lt;Widget&gt;[
          const <span class="hljs-built_in">Text</span>(<span class="hljs-string">"direction from Alignment."</span>),
          <span class="hljs-built_in">Wrap</span>(
            <span class="hljs-attribute">spacing</span>: <span class="hljs-number">8</span>,
            <span class="hljs-attribute">runSpacing</span>: <span class="hljs-number">8</span>,
            <span class="hljs-attribute">children</span>: [
              ...alignments.<span class="hljs-built_in">map</span>((e) {
                var name = e.<span class="hljs-built_in">toString</span>().<span class="hljs-built_in">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">1</span>];
                return <span class="hljs-built_in">ElevatedButton</span>(
                  <span class="hljs-attribute">style</span>: ElevatedButton.<span class="hljs-built_in">styleFrom</span>(
                    <span class="hljs-attribute">backgroundColor</span>: Colors.blue,
                    <span class="hljs-attribute">elevation</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attribute">tapTargetSize</span>: MaterialTapTargetSize.shrinkWrap,
                    <span class="hljs-attribute">minimumSize</span>: const <span class="hljs-built_in">Size</span>(<span class="hljs-number">64</span>, <span class="hljs-number">36</span>),
                  ),
                  <span class="hljs-attribute">onPressed</span>: () {
                    alignment = e;
                    <span class="hljs-built_in">debugPrint</span>(<span class="hljs-string">"$alignment ${alignment.x} ${alignment.y}"</span>);
                    <span class="hljs-built_in">onPopupRoute</span>();
                  },
                  <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(
                    name,
                    <span class="hljs-attribute">style</span>: <span class="hljs-built_in">TextStyle</span>(<span class="hljs-attribute">color</span>: Colors.white),
                  ),
                );
              }),
            ],
          )
        ],
      ),
    );
  }

  <span class="hljs-selector-tag">Future</span>&lt;<span class="hljs-selector-tag">void</span>&gt; <span class="hljs-selector-tag">onPopupRoute</span>() <span class="hljs-selector-tag">async</span> {
    <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">route</span> = <span class="hljs-selector-tag">NSlidePopupRoute</span>(
      <span class="hljs-attribute">from</span>: alignment,
      <span class="hljs-attribute">builder</span>: (_) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildPopupView</span>(<span class="hljs-attribute">alignment</span>: alignment, <span class="hljs-attribute">argsDismiss</span>: {"<span class="hljs-selector-tag">b</span>": "<span class="hljs-number">88</span>"});
      },
    );
    <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">Navigator</span><span class="hljs-selector-class">.of</span>(context)<span class="hljs-selector-class">.push</span>(route);
    <span class="hljs-selector-tag">print</span>([<span class="hljs-string">"result"</span>, result.runtimeType, result]);
  }

  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">buildPopupView</span>({<span class="hljs-selector-tag">required</span> <span class="hljs-selector-tag">Alignment</span> <span class="hljs-selector-tag">alignment</span>, <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">dynamic</span>&gt;? <span class="hljs-selector-tag">argsDismiss</span>}) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Align</span>(
      <span class="hljs-attribute">alignment</span>: alignment,
      <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Container</span>(
        <span class="hljs-attribute">width</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attribute">height</span>: <span class="hljs-number">400</span>,
        <span class="hljs-attribute">alignment</span>: Alignment.center,
        <span class="hljs-attribute">decoration</span>: <span class="hljs-built_in">BoxDecoration</span>(
          <span class="hljs-attribute">color</span>: Colors.green,
          <span class="hljs-attribute">border</span>: Border.<span class="hljs-built_in">all</span>(<span class="hljs-attribute">color</span>: Colors.blue),
          <span class="hljs-attribute">borderRadius</span>: BorderRadius.<span class="hljs-built_in">all</span>(Radius.<span class="hljs-built_in">circular</span>(<span class="hljs-number">0</span>)),
        ),
        <span class="hljs-attribute">child</span>: <span class="hljs-built_in">ElevatedButton</span>(
          <span class="hljs-attribute">onPressed</span>: () {
            Navigator.<span class="hljs-built_in">of</span>(context).<span class="hljs-built_in">pop</span>(argsDismiss);
          },
          <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">"dismiss"</span>),
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-2">三、源码</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">//</span>
<span class="hljs-comment">//  NSlidePopupRoute.dart</span>
<span class="hljs-comment">//  n_slide_popup</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//  Created by shang on 2025/12/27.</span>
<span class="hljs-comment">//  Copyright © 2025/12/27 shang. All rights reserved.</span>
<span class="hljs-comment">//</span>


import <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-comment">/// 最新滑入弹窗</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NSlidePopupRoute</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">PopupRoute</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
  <span class="hljs-title function_ invoke__">NSlidePopupRoute</span>({
    super.settings,
    required this.builder,
    this.<span class="hljs-keyword">from</span> = Alignment.bottomCenter,
    this.barrierColor = <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Color</span>(<span class="hljs-number">0x80000000</span>),
    this.barrierDismissible = <span class="hljs-literal">true</span>,
    this.duration = <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">milliseconds</span>: <span class="hljs-number">300</span>),
    this.barrierLabel,
    this.curve = Curves.easeOutCubic,
  });

  <span class="hljs-keyword">final</span> WidgetBuilder builder;

  <span class="hljs-comment">/// 从哪个方向进入（推荐：topCenter / bottomCenter / centerLeft / centerRight）</span>
  <span class="hljs-keyword">final</span> Alignment <span class="hljs-keyword">from</span>;

  <span class="hljs-keyword">final</span> Duration duration;

  <span class="hljs-keyword">final</span> Curve curve;

  @override
  <span class="hljs-keyword">final</span> <span class="hljs-keyword">bool</span> barrierDismissible;

  @override
  <span class="hljs-keyword">final</span> Color barrierColor;

  @override
  <span class="hljs-keyword">final</span> String? barrierLabel;

  @override
  Duration get transitionDuration =&gt; duration;

  <span class="hljs-comment">// 展示</span>
  <span class="hljs-built_in">static</span> Future&lt;T<span class="hljs-meta">?&gt;</span> show&lt;T&gt;({
    required BuildContext context,
    required WidgetBuilder builder,
    Alignment <span class="hljs-keyword">from</span> = Alignment.bottomCenter,
    Duration duration = <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Duration</span>(milliseconds: <span class="hljs-number">300</span>),
    Curve curve = Curves.easeOutCubic,
    Color barrierColor = <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Color</span>(<span class="hljs-number">0x80000000</span>),
    <span class="hljs-keyword">bool</span> barrierDismissible = <span class="hljs-literal">true</span>,
    String? barrierLabel,
    <span class="hljs-keyword">bool</span> useRootNavigator = <span class="hljs-literal">true</span>,
    RouteSettings? routeSettings,
  }) {
    <span class="hljs-keyword">return</span> Navigator.<span class="hljs-title function_ invoke__">of</span>(context, <span class="hljs-attr">rootNavigator</span>: useRootNavigator).<span class="hljs-title function_ invoke__">push</span>(
      NSlidePopupRoute&lt;T&gt;(
        <span class="hljs-attr">builder</span>: builder,
        <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>,
        <span class="hljs-attr">duration</span>: duration,
        <span class="hljs-attr">curve</span>: curve,
        <span class="hljs-attr">barrierColor</span>: barrierColor,
        <span class="hljs-attr">barrierDismissible</span>: barrierDismissible,
        <span class="hljs-attr">barrierLabel</span>: barrierLabel,
        <span class="hljs-attr">settings</span>: routeSettings,
      ),
    );
  }

  @override
  Widget <span class="hljs-title function_ invoke__">buildPage</span>(
    BuildContext context,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; animation,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; secondaryAnimation,
  ) {
    <span class="hljs-comment">// 直接返回背景和内容，不应用动画</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Material</span>(
      <span class="hljs-attr">color</span>: barrierColor,
      <span class="hljs-attr">child</span>: <span class="hljs-keyword">const</span> SizedBox.<span class="hljs-title function_ invoke__">expand</span>(), // 只负责背景
    );
  }

  @override
  Widget <span class="hljs-title function_ invoke__">buildTransitions</span>(
    BuildContext context,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; animation,
    Animation&lt;<span class="hljs-keyword">double</span>&gt; secondaryAnimation,
    Widget child,
  ) {
    <span class="hljs-keyword">final</span> content = <span class="hljs-title function_ invoke__">builder</span>(context);

    <span class="hljs-comment">// ⭐ 中心弹窗：Fade</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">from</span> == Alignment.center) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">FadeTransition</span>(
        <span class="hljs-attr">opacity</span>: animation.<span class="hljs-title function_ invoke__">drive</span>(
          <span class="hljs-title function_ invoke__">CurveTween</span>(<span class="hljs-attr">curve</span>: Curves.easeOut),
        ),
        <span class="hljs-attr">child</span>: content,
      );
    }

    <span class="hljs-comment">// ⭐ 其余方向：Slide</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">FadeTransition</span>(
      <span class="hljs-attr">opacity</span>: animation,
      <span class="hljs-attr">child</span>: <span class="hljs-title function_ invoke__">SlideTransition</span>(
        <span class="hljs-attr">position</span>: animation.<span class="hljs-title function_ invoke__">drive</span>(
          Tween&lt;Offset&gt;(
            <span class="hljs-attr">begin</span>: <span class="hljs-title function_ invoke__">_alignmentToOffset</span>(<span class="hljs-keyword">from</span>),
            <span class="hljs-attr">end</span>: Offset.zero,
          ).<span class="hljs-title function_ invoke__">chain</span>(
            <span class="hljs-title function_ invoke__">CurveTween</span>(<span class="hljs-attr">curve</span>: curve),
          ),
        ),
        <span class="hljs-attr">child</span>: content,
      ),
    );
  }

  <span class="hljs-comment">/// Alignment → Offset（关键点）</span>
  Offset <span class="hljs-title function_ invoke__">_alignmentToOffset</span>(Alignment alignment) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Offset</span>(
      alignment.x.sign,
      alignment.y.sign,
    );
  }
}
</code></pre>
<h2 data-id="heading-3">最后、总结</h2>
<ol>
<li>NSlidePopupRoute 代码实现极简，没有过多的底层封装，是为了追求极致的自由度。</li>
<li>当 alignment == Alignment.center 时，它是 Dialog弹窗。</li>
<li>从顶部滑出时，它可以是顶部通知 Toast。</li>
<li>从底部滑出时，它可以是 ModalBottomSheet，SnackBar。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fshang1219178163%2Fn_slide_popup" target="_blank" title="https://github.com/shang1219178163/n_slide_popup" ref="nofollow noopener noreferrer">github</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fn_slide_popup" target="_blank" title="https://pub.dev/packages/n_slide_popup" ref="nofollow noopener noreferrer">pub.dev</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[通过AI从零开发RN到在安卓手机上运行]]></title>    <link>https://juejin.cn/post/7594302398687608886</link>    <guid>https://juejin.cn/post/7594302398687608886</guid>    <pubDate>2026-01-13T04:03:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594302398687608886" data-draft-id="7594389431835246633" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="通过AI从零开发RN到在安卓手机上运行"/> <meta itemprop="keywords" content="前端,React Native,Cursor"/> <meta itemprop="datePublished" content="2026-01-13T04:03:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小遁哥"/> <meta itemprop="url" content="https://juejin.cn/user/1697301683524472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            通过AI从零开发RN到在安卓手机上运行
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1697301683524472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小遁哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T04:03:04.000Z" title="Tue Jan 13 2026 04:03:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我借助 AI，基于 React Native 技术开发了一个 APP，各方面结合在一起，促成我想做这件事。</p>
<p>用的是Cursor，之前在公司网络上使用很丝滑，但是到家里却总是出现网络故障，根本就无法使用，灾难级别。换了个梯子才大幅度改善。</p>
<p>字节的国内版和国外版都未出现过这种情况，很多场景下，免费的也很够用。</p>
<ul>
<li>因为我是从来没做过RN开发的，虽说web端还是有很多共性。想试一下全靠自然语言和AI沟通能否完成。</li>
<li>生活中确实存在相关使用需求，</li>
<li>市面上现有应用不仅操作繁琐，还存在大量开屏广告，且状态缓存差，再次打开时要么重复出现广告，要么回退到初始状态。</li>
</ul>
<p>项目地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaodun%2Fsf-app" target="_blank" title="https://github.com/xiaodun/sf-app" ref="nofollow noopener noreferrer">xiaodun/sf-app</a></p>
<h2 data-id="heading-0">核心功能</h2>
<h3 data-id="heading-1">1. 集合管理 (Collection Management)</h3>
<ul>
<li><strong>创建与管理</strong>：首页展示所有集合，支持新增和删除集合。</li>
<li><strong>数据持久化</strong>：所有数据存储在本地，支持自动保存和状态同步。</li>
</ul>
<h3 data-id="heading-2">2. 层级与单元系统 (Level &amp; Unit System)</h3>
<ul>
<li><strong>层级结构</strong>：每个集合包含多个层级（Level），层级内包含多个单元（Unit）。</li>
<li><strong>单元编辑</strong>：支持编辑单元名称。</li>
<li><strong>状态流转</strong>：单元可以在“普通”、“推荐”、“回收站”和“收藏”状态间流转。</li>
</ul>
<h3 data-id="heading-3">3. 特性系统 (Features System)</h3>
<p>应用提供灵活的“特性”系统，允许用户为单元添加额外的属性维度：</p>
<ul>
<li><strong>全局定义</strong>：特性是全局共享的（Global），一旦创建，所有集合中的单元都可以使用。</li>
<li><strong>类型支持</strong>：
<ul>
<li><strong>数值型 (Numeric)</strong>：适合记录分数、数量、等级等（如：评分、数量）。</li>
<li><strong>单选型 (Single Choice)</strong>：适合记录布尔状态（如：是否完成、是否拥有）。</li>
</ul>
</li>
<li><strong>管理与应用</strong>：
<ul>
<li>在首页点击“特性管理”可添加、编辑或删除全局特性。</li>
<li>在单元详情页或编辑弹窗中，可以为特定单元设置这些特性的具体值。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4">4. 导入与导出 (Import &amp; Export)</h3>
<p>为了方便数据备份、迁移和分享，应用提供了完整的 JSON 数据导入导出功能：</p>
<ul>
<li><strong>导出数据</strong>：
<ul>
<li>在首页点击菜单中的“导出”按钮。</li>
<li>系统会将当前应用内的<strong>所有数据</strong>（包括集合、层级、单元、特性、收藏记录等）打包成一个 JSON 字符串。</li>
<li>该字符串会自动复制到您的系统剪贴板，您可以将其粘贴到备忘录、微信或其他地方保存。</li>
</ul>
</li>
<li><strong>导入数据</strong>：
<ul>
<li>在首页点击菜单中的“导入”按钮。</li>
<li>将之前导出的 JSON 字符串粘贴到输入框中（或点击“从剪贴板粘贴”）。</li>
<li>系统会校验数据格式，验证通过后将覆盖当前应用数据，实现数据恢复。</li>
<li><strong>注意</strong>：导入操作会完全覆盖现有数据，请谨慎操作。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">5. 手势交互 (Interactive Gestures)</h3>
<p>为了提供流畅且防误触的操作体验，应用实现了定制化的手势系统：</p>
<ul>
<li><strong>滑动操作</strong>：
<ul>
<li><strong>上滑</strong>：将单元移动到“推荐”列表。</li>
<li><strong>下滑</strong>：将单元移动到“回收站”。</li>
</ul>
</li>
<li><strong>双击操作</strong>：
<ul>
<li>双击单元格可弹出编辑菜单。</li>
<li><strong>修改名称</strong>：可以快速修改当前单元的名称。</li>
<li><strong>编辑特性</strong>：可以设置单元的各项特性值（如评分、状态等）。</li>
<li><strong>收藏/取消收藏</strong>：可以一键收藏单元并添加收藏理由，或取消已有的收藏。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-6">6. 层级排序系统 (Level Sorting)</h3>
<ul>
<li><strong>排序模式</strong>：点击右上角菜单进入排序模式。</li>
<li><strong>按钮排序</strong>：通过点击单元格右侧的 <strong>“上移”/“下移”箭头按钮</strong> 调整层级顺序。</li>
</ul>
<p>开发过程中，从框架搭建到功能实现，全程由 AI 主导完成，也遇到一些卡住的地方。</p>
<p>如删除操作AI设置二次确认弹窗，生成的代码在逻辑层面看似没有问题，实际运行时弹窗却并未弹出，导致点击操作毫无响应。而我如果只跟AI说点击没有反应，他是无法解决这个问题，最后我看了代码，明确告诉它时弹窗没有展示。</p>
<p>手势交互适配问题，Web 端的上滑、下移、拖动、双击等操作均能正常运行，但移植到 APP 端直接失效。尝试让AI采用通用解决方案修复，却引发 APP 闪退，最后只能切换为原生策略才解决该问题。</p>
<p>而且在手机上也拿不报错，尝试添加日志功能也没效果，如果只是让AI解决闪退问题，其实是没有一个明确的方案的，导致这个问题卡住了好长时间，再加上我对RN也不熟悉，最后只能让它使用最原生的，才保证了功能，最后就是灵敏度的优化。</p>
<h2 data-id="heading-7">打包</h2>
<p>打包时通过eas这个命令，先去<a href="https://link.juejin.cn?target=https%3A%2F%2Fexpo.dev%2F" target="_blank" title="https://expo.dev/" ref="nofollow noopener noreferrer">expo.dev/</a> 注册账号，在本地登陆后，会对项目做一个初始化，对node版本有要求，一定要在本地安装git。</p>
<p>一开始是通过本地执行<code>npx eas-cli build --platform android --profile preview</code> 其实也是向远程发起了构建指令，构建过程可以通过网页看到，后面使用这个命令会卡住，就直接从网站上构建了。</p>
<p>网站本身就支持从gihub上拉仓库</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cc2e4c89f05495987af01ded5ca1315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YGB5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768881784&amp;x-signature=R9o674mOt7zGsjAknJSG8qEz%2BjM%3D" alt="image.png" loading="lazy"/></p>
<p>EAS Build profile 很重要，我的应用要改为preview，对应项目的eas.json有一下配置</p>
<pre><code class="hljs language-json" lang="json">    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"distribution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"internal"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"android"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"buildType"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"apk"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>"buildType": "apk" 否则构建出来会是abb文件，不能直接安装。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cd96d759f2a468386f5595aac63b2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6YGB5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768881784&amp;x-signature=iVFYNf%2F1ATjBVUpVMNKLiIPOBuc%3D" alt="image.png" loading="lazy"/></p>
<p>这个平台有免费次数限制，超出限制后需要等待 18 天才能再次使用。</p>
<p>由于这款 APP 功能相对简单，我便没有在本地搭建安卓环境，也未进行 USB 调试等验证操作，目前整体功能已基本开发完成。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 三剑客：组件、插件、插槽的深度辨析]]></title>    <link>https://juejin.cn/post/7594681318828425266</link>    <guid>https://juejin.cn/post/7594681318828425266</guid>    <pubDate>2026-01-13T14:19:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594681318828425266" data-draft-id="7594682922683695113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 三剑客：组件、插件、插槽的深度辨析"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-13T14:19:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 三剑客：组件、插件、插槽的深度辨析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T14:19:43.000Z" title="Tue Jan 13 2026 14:19:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue 三剑客：组件、插件、插槽的深度辨析</h2>
<blockquote>
<p>组件、插件、插槽是 Vue 生态中的三个核心概念，理解它们的差异是掌握 Vue 架构设计的关键。让我们通过一个完整的对比体系来彻底搞懂它们。</p>
</blockquote>
<h3 data-id="heading-1">一、核心概念全景图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    A[Vue 核心概念] --&gt; B[Component 组件]
    A --&gt; C[Plugin 插件]
    A --&gt; D[Slot 插槽]
    
    B --&gt; B1[UI 复用单元]
    B --&gt; B2[局部作用域]
    B --&gt; B3[父子通信]
    
    C --&gt; C1[全局功能扩展]
    C --&gt; C2[一次配置]
    C --&gt; C3[多组件共享]
    
    D --&gt; D1[内容分发]
    D --&gt; D2[灵活占位]
    D --&gt; D3[模板组合]
    
    B --&gt; E[使用插件]
    B --&gt; F[包含插槽]
    C --&gt; G[增强组件]
    D --&gt; H[扩展组件]
</code></pre>
<h3 data-id="heading-2">二、三者的本质区别：一句话概括</h3>

























<table><thead><tr><th>概念</th><th>本质</th><th>类比</th></tr></thead><tbody><tr><td><strong>组件</strong></td><td><strong>可复用的 UI 单元</strong></td><td>乐高积木块</td></tr><tr><td><strong>插件</strong></td><td><strong>全局功能扩展包</strong></td><td>乐高工具箱</td></tr><tr><td><strong>插槽</strong></td><td><strong>组件的内容占位符</strong></td><td>乐高积木上的接口</td></tr></tbody></table>
<h3 data-id="heading-3">三、组件 (Component) - Vue 的基石</h3>
<h4 data-id="heading-4">定义与核心特征</h4>
<p><strong>组件是 Vue 应用的构建块</strong>，每个组件都是自包含的、可复用的 Vue 实例。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- UserCard.vue - 组件示例 --&gt;
&lt;template&gt;
  &lt;div class="user-card"&gt;
    &lt;img :src="avatar" alt="用户头像" /&gt;
    &lt;h3&gt;{{ name }}&lt;/h3&gt;
    &lt;p&gt;{{ bio }}&lt;/p&gt;
    &lt;!-- 使用插槽提供扩展点 --&gt;
    &lt;slot name="actions"&gt;&lt;/slot&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  // 组件定义
  name: 'UserCard',
  props: {
    name: String,
    avatar: String,
    bio: String
  },
  // 局部状态
  data() {
    return {
      isActive: false
    }
  },
  // 生命周期
  mounted() {
    console.log('组件已挂载')
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.user-card {
  border: 1px solid #ccc;
  padding: 20px;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-5">组件的核心能力：</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 组件注册</span>
<span class="hljs-comment">// 全局注册</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(<span class="hljs-string">'global-component'</span>, {
  <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;全局组件&lt;/div&gt;'</span>
})

<span class="hljs-comment">// 局部注册</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">LocalComponent</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;div&gt;局部组件&lt;/div&gt;'</span>
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  <span class="hljs-attr">components</span>: {
    <span class="hljs-string">'local-component'</span>: <span class="hljs-title class_">LocalComponent</span>
  }
})

<span class="hljs-comment">// 2. 组件通信体系</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ParentComponent</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;child-component 
      :title="parentTitle" 
      @child-event="handleChildEvent"
    /&gt;
  `</span>,
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleChildEvent</span>(<span class="hljs-params">payload</span>) {
      <span class="hljs-comment">// 处理子组件事件</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-6">四、插件 (Plugin) - Vue 的扩展系统</h3>
<h4 data-id="heading-7">定义与核心特征</h4>
<p><strong>插件是对 Vue 的全局增强</strong>，用于添加全局级的功能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// my-plugin.js - 自定义插件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyPlugin</span> = {
  <span class="hljs-title function_">install</span>(<span class="hljs-params">Vue, options</span>) {
    <span class="hljs-comment">// 1. 添加全局方法或属性</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property">myGlobalMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'全局方法'</span>)
    }
    
    <span class="hljs-comment">// 2. 添加全局资源（指令/过滤器/组件）</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'my-directive'</span>, {
      <span class="hljs-title function_">bind</span>(<span class="hljs-params">el, binding</span>) {
        <span class="hljs-comment">// 指令逻辑</span>
      }
    })
    
    <span class="hljs-comment">// 3. 注入组件选项</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
      <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有组件都会执行'</span>)
      }
    })
    
    <span class="hljs-comment">// 4. 添加实例方法</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$myMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'实例方法'</span>)
    }
  }
}

<span class="hljs-comment">// 使用插件</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">MyPlugin</span>, { <span class="hljs-attr">someOption</span>: <span class="hljs-literal">true</span> })
</code></pre>
<h4 data-id="heading-8">常见插件类型：</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. UI 组件库插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-ui'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-ui/lib/theme-chalk/index.css'</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementUI</span>)

<span class="hljs-comment">// 2. 功能增强插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueRouter</span>)

<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vuex</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Vuex</span>)

<span class="hljs-comment">// 3. 工具类插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueLazyload</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-lazyload'</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueLazyload</span>, {
  <span class="hljs-attr">loading</span>: <span class="hljs-string">'/loading.gif'</span>
})
</code></pre>
<h4 data-id="heading-9">插件 vs 组件的关键差异：</h4>






























<table><thead><tr><th>对比维度</th><th>组件</th><th>插件</th></tr></thead><tbody><tr><td><strong>作用范围</strong></td><td>局部（需要显式引入）</td><td>全局（一次配置，处处可用）</td></tr><tr><td><strong>主要目的</strong></td><td>构建 UI 界面</td><td>增强 Vue 本身的能力</td></tr><tr><td><strong>使用频率</strong></td><td>高频率、多次使用</td><td>一次性配置</td></tr><tr><td><strong>典型示例</strong></td><td>Button、Modal、Form</td><td>Router、Vuex、i18n</td></tr></tbody></table>
<h3 data-id="heading-10">五、插槽 (Slot) - 组件的灵活扩展点</h3>
<h4 data-id="heading-11">定义与核心特征</h4>
<p><strong>插槽是组件的内容分发出口</strong>，让父组件可以向子组件传递模板内容。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- BaseLayout.vue - 包含插槽的组件 --&gt;
&lt;template&gt;
  &lt;div class="container"&gt;
    &lt;header&gt;
      &lt;!-- 具名插槽 --&gt;
      &lt;slot name="header"&gt;&lt;/slot&gt;
    &lt;/header&gt;
    
    &lt;main&gt;
      &lt;!-- 默认插槽 --&gt;
      &lt;slot&gt;
        &lt;!-- 后备内容（当父组件不提供内容时显示） --&gt;
        &lt;p&gt;默认内容&lt;/p&gt;
      &lt;/slot&gt;
    &lt;/main&gt;
    
    &lt;footer&gt;
      &lt;slot name="footer"&gt;&lt;/slot&gt;
    &lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-12">插槽的三种类型：</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 父组件使用 --&gt;
&lt;template&gt;
  &lt;BaseLayout&gt;
    &lt;!-- 具名插槽 --&gt;
    &lt;template v-slot:header&gt;
      &lt;h1&gt;页面标题&lt;/h1&gt;
    &lt;/template&gt;
    
    &lt;!-- 默认插槽（简写） --&gt;
    &lt;p&gt;主要内容区域&lt;/p&gt;
    &lt;p&gt;这是默认插槽的内容&lt;/p&gt;
    
    &lt;!-- 作用域插槽 --&gt;
    &lt;template v-slot:footer="slotProps"&gt;
      &lt;p&gt;页脚: {{ slotProps.year }} 年&lt;/p&gt;
    &lt;/template&gt;
    
    &lt;!-- 动态插槽名 --&gt;
    &lt;template v-slot:[dynamicSlotName]&gt;
      动态内容
    &lt;/template&gt;
  &lt;/BaseLayout&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-13">作用域插槽（高级模式）：</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- TodoList.vue --&gt;
&lt;template&gt;
  &lt;ul&gt;
    &lt;li v-for="todo in todos" :key="todo.id"&gt;
      &lt;!-- 作用域插槽：向父组件暴露数据 --&gt;
      &lt;slot :todo="todo" :index="index"&gt;
        &lt;!-- 默认显示 --&gt;
        {{ todo.text }}
      &lt;/slot&gt;
    &lt;/li&gt;
  &lt;/ul&gt;
&lt;/template&gt;

&lt;!-- 父组件接收数据 --&gt;
&lt;template&gt;
  &lt;TodoList :todos="todos"&gt;
    &lt;template v-slot:default="slotProps"&gt;
      &lt;span :class="{ completed: slotProps.todo.done }"&gt;
        {{ slotProps.index + 1 }}. {{ slotProps.todo.text }}
      &lt;/span&gt;
    &lt;/template&gt;
  &lt;/TodoList&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-14">六、三者协同工作的完整示例</h3>
<p>让我们通过一个实战项目理解三者如何协同：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 首先安装路由插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VueRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">VueRouter</span>)  <span class="hljs-comment">// 🔴 插件：全局启用路由功能</span>

<span class="hljs-comment">// 2. 定义可复用的布局组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AppLayout</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;div class="app-layout"&gt;
      &lt;slot name="navbar"&gt;&lt;/slot&gt;
      &lt;div class="content"&gt;
        &lt;!-- 默认插槽用于显示页面内容 --&gt;
        &lt;slot&gt;&lt;/slot&gt;
      &lt;/div&gt;
      &lt;slot name="footer"&gt;&lt;/slot&gt;
    &lt;/div&gt;
  `</span>
}

<span class="hljs-comment">// 3. 创建页面组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HomePage</span> = {
  <span class="hljs-attr">template</span>: <span class="hljs-string">`
    &lt;AppLayout&gt;
      &lt;template v-slot:navbar&gt;
        &lt;!-- 向布局组件传递自定义导航栏 --&gt;
        &lt;NavBar title="首页" /&gt;
      &lt;/template&gt;
      
      &lt;!-- 默认插槽内容 --&gt;
      &lt;h1&gt;欢迎访问&lt;/h1&gt;
      &lt;ProductList&gt;
        &lt;!-- 作用域插槽自定义产品显示 --&gt;
        &lt;template v-slot:product="props"&gt;
          &lt;ProductCard :product="props.product" /&gt;
        &lt;/template&gt;
      &lt;/ProductList&gt;
      
      &lt;template v-slot:footer&gt;
        &lt;AppFooter /&gt;
      &lt;/template&gt;
    &lt;/AppLayout&gt;
  `</span>,
  <span class="hljs-attr">components</span>: {
    <span class="hljs-title class_">AppLayout</span>,      <span class="hljs-comment">// 🔵 组件：布局组件</span>
    <span class="hljs-title class_">NavBar</span>,         <span class="hljs-comment">// 🔵 组件：导航栏组件</span>
    <span class="hljs-title class_">ProductList</span>,    <span class="hljs-comment">// 🔵 组件：产品列表</span>
    <span class="hljs-title class_">ProductCard</span>,    <span class="hljs-comment">// 🔵 组件：产品卡片</span>
    <span class="hljs-title class_">AppFooter</span>       <span class="hljs-comment">// 🔵 组件：页脚组件</span>
  }
}

<span class="hljs-comment">// 4. 配置路由（使用插件提供的功能）</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueRouter</span>({
  <span class="hljs-attr">routes</span>: [
    {
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">component</span>: <span class="hljs-title class_">HomePage</span>  <span class="hljs-comment">// 使用组件作为路由页面</span>
    }
  ]
})

<span class="hljs-comment">// 5. 创建Vue实例</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
  router,  <span class="hljs-comment">// 🔴 插件提供的路由实例</span>
  <span class="hljs-attr">template</span>: <span class="hljs-string">'&lt;router-view&gt;&lt;/router-view&gt;'</span>  <span class="hljs-comment">// 🟡 插槽：路由视图占位</span>
}).$mount(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-15">七、设计模式与最佳实践</h3>
<h4 data-id="heading-16">何时使用什么？</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[需求分析] --&gt; B{需要什么?}
    
    B --&gt;|构建UI界面| C[使用组件]
    B --&gt;|全局功能扩展| D[使用插件]
    B --&gt;|自定义组件内容| E[使用插槽]
    
    C --&gt; F{组件需要灵活性?}
    F --&gt;|是| G[在组件中添加插槽]
    F --&gt;|否| H[创建完整组件]
    
    D --&gt; I{功能需要复用?}
    I --&gt;|是| J[开发为插件]
    I --&gt;|否| K[使用局部混入]
</code></pre>
<h4 data-id="heading-17">组件设计原则：</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 好的组件设计示例 --&gt;
&lt;template&gt;
  &lt;!-- 提供清晰的插槽接口 --&gt;
  &lt;div class="card"&gt;
    &lt;div class="card-header" v-if="$slots.header"&gt;
      &lt;slot name="header"&gt;&lt;/slot&gt;
    &lt;/div&gt;
    
    &lt;div class="card-body"&gt;
      &lt;slot&gt;
        &lt;!-- 合理的默认内容 --&gt;
        &lt;p&gt;暂无内容&lt;/p&gt;
      &lt;/slot&gt;
    &lt;/div&gt;
    
    &lt;!-- 作用域插槽提供数据 --&gt;
    &lt;div class="card-footer" v-if="$slots.footer"&gt;
      &lt;slot name="footer" :data="footerData"&gt;&lt;/slot&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h4 data-id="heading-18">插件开发规范：</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 良好的插件结构</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">WellDesignedPlugin</span> = {
  <span class="hljs-title function_">install</span>(<span class="hljs-params">Vue, options = {}</span>) {
    <span class="hljs-comment">// 1. 参数验证</span>
    <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">requiredConfig</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'插件需要配置 requiredConfig'</span>)
    }
    
    <span class="hljs-comment">// 2. 安全的全局扩展</span>
    <span class="hljs-keyword">const</span> version = <span class="hljs-title class_">Number</span>(<span class="hljs-title class_">Vue</span>.<span class="hljs-property">version</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>)[<span class="hljs-number">0</span>])
    <span class="hljs-keyword">if</span> (version &gt;= <span class="hljs-number">2</span>) {
      <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$safeMethod</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 兼容性处理</span>
      }
    }
    
    <span class="hljs-comment">// 3. 提供卸载方法</span>
    <span class="hljs-keyword">const</span> originalDestroy = <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$destroy</span>
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$destroy</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 清理逻辑</span>
      originalDestroy.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>)
    }
  }
}
</code></pre>
<h3 data-id="heading-19">八、常见误区与澄清</h3>
<h4 data-id="heading-20">误区1：插件可以替代组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误：用插件实现UI组件</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>({
  <span class="hljs-title function_">install</span>(<span class="hljs-params">Vue</span>) {
    <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$showModal</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">content</span>) {
      <span class="hljs-comment">// 这应该是组件，不是插件</span>
    }
  }
})

<span class="hljs-comment">// ✅ 正确：组件实现UI，插件封装工具</span>
<span class="hljs-comment">// Modal.vue - 作为组件</span>
<span class="hljs-comment">// modal-plugin.js - 如果需要全局调用，可以包装为插件</span>
</code></pre>
<h4 data-id="heading-21">误区2：插槽就是子组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ❌ 误解：插槽是子组件 --&gt;
&lt;Parent&gt;
  &lt;Child /&gt;  &lt;!-- 这是组件，不是插槽内容 --&gt;
&lt;/Parent&gt;

&lt;!-- ✅ 正确理解 --&gt;
&lt;Parent&gt;
  &lt;!-- 这是插槽内容，会被分发到Parent的&lt;slot&gt;位置 --&gt;
  &lt;template v-slot:default&gt;
    &lt;Child /&gt;
  &lt;/template&gt;
&lt;/Parent&gt;
</code></pre>
<h4 data-id="heading-22">误区3：过度使用混入（Mixin）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 过度使用：应该用插槽或组合式API代替</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">mixin</span>({
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">globalData</span>: <span class="hljs-string">'应该避免'</span>
    }
  }
})

<span class="hljs-comment">// ✅ 更好的方式：组合式函数（Vue 3）</span>
<span class="hljs-comment">// 或使用作用域插槽传递数据</span>
</code></pre>
<h3 data-id="heading-23">九、Vue 3 中的演进</h3>
<h4 data-id="heading-24">组合式 API 的影响：</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Vue 3 中三者关系更加清晰 --&gt;
&lt;script setup&gt;
// 1. 组件 - 更简洁的定义
import { defineComponent } from 'vue'

// 2. 插件 - 通过 provide/inject 更好地集成
import { provide } from 'vue'
provide('pluginData', data)

// 3. 插槽 - 更灵活的用法
defineProps(['modelValue'])
defineEmits(['update:modelValue'])
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- 插槽作用域解构 --&gt;
  &lt;slot name="item" v-bind="{ id, name }"&gt;&lt;/slot&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-25">十、总结：三位一体的 Vue 架构</h3>





























<table><thead><tr><th>概念</th><th>角色</th><th>关键特征</th><th>最佳实践</th></tr></thead><tbody><tr><td><strong>组件</strong></td><td>构建者</td><td>局部作用域、props/events接口、可复用</td><td>单一职责、合理拆分、明确接口</td></tr><tr><td><strong>插件</strong></td><td>增强者</td><td>全局作用域、一次配置、功能扩展</td><td>轻量封装、提供选项、良好文档</td></tr><tr><td><strong>插槽</strong></td><td>连接者</td><td>内容分发、模板组合、作用域暴露</td><td>明确命名、提供后备、作用域数据</td></tr></tbody></table>
<p><strong>记住这个核心公式：</strong></p>
<blockquote>
<p><strong>应用 = 插件增强的Vue实例 + 组件构建的UI树 + 插槽连接的组件关系</strong></p>
</blockquote>
<h4 data-id="heading-26">最终决策指南：</h4>
<ol>
<li>
<p><strong>当你需要...</strong></p>
<ul>
<li><strong>复用UI片段</strong> → 创建组件</li>
<li><strong>添加全局功能</strong> → 开发插件</li>
<li><strong>自定义组件内部结构</strong> → 使用插槽</li>
</ul>
</li>
<li>
<p><strong>在架构中...</strong></p>
<ul>
<li>插件在最外层配置全局能力</li>
<li>组件在中间层构建功能模块</li>
<li>插槽在最内层实现灵活定制</li>
</ul>
</li>
<li>
<p><strong>进化方向...</strong></p>
<ul>
<li>Vue 2：Options API + 三者分明</li>
<li>Vue 3：Composition API + 更灵活的组合</li>
</ul>
</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[react native中实现视频转歌]]></title>    <link>https://juejin.cn/post/7594813727054184482</link>    <guid>https://juejin.cn/post/7594813727054184482</guid>    <pubDate>2026-01-14T10:11:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727054184482" data-draft-id="7594813727053594658" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="react native中实现视频转歌"/> <meta itemprop="keywords" content="前端,React Native"/> <meta itemprop="datePublished" content="2026-01-14T10:11:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sure282"/> <meta itemprop="url" content="https://juejin.cn/user/1410005296489149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            react native中实现视频转歌
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1410005296489149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sure282
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:11:06.000Z" title="Wed Jan 14 2026 10:11:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">先放图</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09aacdf1da394d5993ddd34791777099~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=R6N8%2FdErsyHTnSh4gU%2BE3P%2FbG3M%3D" alt="微信图片_20260114172105_165_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09d71febeb2f42aa8939a161a6c425ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=bEKEGe415jX93Pm61VP5um3Zpmw%3D" alt="微信图片_20260114172111_166_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/283bb84b69d74d7cb2206f6538d9a3cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=xnzjaaLTdQAoIEwmELpzaMyJh3Q%3D" alt="微信图片_20260114172102_162_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8f66a562dc4198a637a6be5e14bc1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=fvVHD2vqha2B2rdkqkqKc5fcOsQ%3D" alt="微信图片_20260114172103_163_23.jpg" loading="lazy"/></p>
<h2 data-id="heading-1">前言</h2>
<p>先解释一下视频转歌:它的本质是<strong>提取视频文件的音频部分为独立文件</strong>，底层技术原理是不是这样我也不是特别清楚。提取后存到设备内存中 ，音乐播放器可以读取播放该文件。该功能是我在某个音乐播放器应用上看到功能菜单有一个<strong>视频转歌</strong>功能，并简单尝试了，它的效果就是将选择的视频转换为音频，不过该软件转换后的文件是.vts格式，想要使用转换产物肯定要支持.vts或者了解这种文件怎么读取，至于为什么是这样大家应该都能理解，这也不是今天的重点。</p>
<h2 data-id="heading-2">项目环境关键依赖</h2>
<p>在rn应用中，依赖版本对应性很重要，一旦有一点不匹配就会各种问题，各种失败，而且是使用expo创建的rn项目在需要原生功能时安装的依赖通常需要开发构建，下面是关键依赖以及版本：</p>
<ul>
<li>"expo": "~54.0.31",</li>
<li>"kroog-ffmpeg-kit-react-native": "^6.0.9",</li>
<li>"react": "19.1.0",</li>
</ul>
<p>实现<strong>视频转歌</strong>的核心依赖是kroog-ffmpeg-kit-react-native，这个依赖很明显是folk的分支，原包ffmpeg-kit好像已经不再维护，前段时间有个新闻说谷歌AI发现该依赖的漏洞，一段时间如果不修复，谷歌会公布漏洞，该项目团队回应说(通俗地说)你要是有良心就捐点money，你也是大用户，带头白嫖巴拉巴的。</p>
<p>核心依赖找到后，除了如何使用依赖外，流程非常清晰:<strong>选择视频文件-&gt;获取uri等信息-&gt;交给ffmpeg-&gt;转化-&gt;监听处理转换进度 -&gt;更新进度-&gt;获取转换后的缓存结果-&gt;保存到设备</strong>:</p>
<p><strong>1.选取视频文件</strong></p>
<p>选取视频可以使用两种依赖库，分别是expo-media-library和expo-document-picker，
这里我们使用前者获取设备中MediaType.video类型的数据渲染成列表，供用户选择，选取后我们拿到uri</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { getAssetsAsync, <span class="hljs-title class_">MediaType</span>, requestPermissionsAsync, <span class="hljs-keyword">type</span> <span class="hljs-title class_">AssetsOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'expo-media-library'</span>;
    <span class="hljs-comment">/**
     * 请求权限并获取视频列表
     *
     * 此方法会先请求媒体库读取权限，如果授权成功则调用 fetchVideos 方法加载视频数据。
     * 如果未获得权限，则弹出提示框告知用户。
     *
     * <span class="hljs-doctag">@param</span> reset 是否重置当前已有的视频列表，默认为 false
     * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">requestPermissionAndGetVideos</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">reset = <span class="hljs-literal">true</span></span>) =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
            <span class="hljs-comment">// 请求媒体库权限</span>
            <span class="hljs-keyword">const</span> { status } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestPermissionsAsync</span>();
            <span class="hljs-keyword">if</span> (status !== <span class="hljs-string">'granted'</span>) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'需要访问媒体库权限才能获取视频文件，请在设置中开启权限。'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span> });
                <span class="hljs-title function_">setHasPermission</span>(<span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-title function_">setHasPermission</span>(<span class="hljs-literal">true</span>);
            <span class="hljs-comment">// 获取视频文件，重新请求权限时默认重置列表</span>
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchVideos</span>(reset);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'获取视频文件失败，请重试'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
        }
    };
        <span class="hljs-comment">/**
         * 使用expo-media-library 获取视频文件列表
         * 和expo-document-picker 获取视频文件列表结果不太一样，expo-media-library 会返回更多的视频文件
         * 调用系统 API 获取指定范围内的视频资源，并更新状态以渲染到界面。
         * 支持分页加载与刷新功能。
         *
         * <span class="hljs-doctag">@param</span> reset 是否清空已有数据后重新加载，默认为 false
         * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
         */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchVideos</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">reset = <span class="hljs-literal">false</span></span>) =&gt; {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">AssetsOptions</span> = {
                <span class="hljs-attr">mediaType</span>: <span class="hljs-title class_">MediaType</span>.<span class="hljs-property">video</span>, <span class="hljs-comment">// 只获取视频文件</span>
                first, <span class="hljs-comment">// 每次加载根据列数动态调整</span>
                <span class="hljs-attr">after</span>: reset ? <span class="hljs-literal">undefined</span> : after, <span class="hljs-comment">// 分页加载</span>
                <span class="hljs-attr">sortBy</span>: [[<span class="hljs-string">'modificationTime'</span>, <span class="hljs-literal">true</span>]], <span class="hljs-comment">// 按修改时间降序排序</span>
            };
            <span class="hljs-keyword">const</span> { assets = [], endCursor, hasNextPage } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getAssetsAsync</span>(options);
            <span class="hljs-keyword">const</span> videoList = assets.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">asset</span> =&gt;</span> ({
                ...asset,
                <span class="hljs-attr">durationString</span>: <span class="hljs-title function_">formatTime</span>(asset.<span class="hljs-property">duration</span>),
            }));
            <span class="hljs-keyword">if</span> (reset) {
                <span class="hljs-title function_">setVideos</span>(videoList);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_">setVideos</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, ...videoList]);
            }
            <span class="hljs-title function_">setAfter</span>(endCursor);
            <span class="hljs-title function_">setHasMore</span>(hasNextPage);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'获取视频列表失败，请重试'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        }
    };
</code></pre>
<p>通过以上代码我们拿到视频列表，使用expo-media-library的好处在于可以分批获取视频文件，非常便于分页加载</p>
<p><strong>2.核心操作 使用ffmpeg-kit从指定文件中提取音频：</strong>
当用户选取视频后我们存储uri，并使用expo-file-system检查文件uri是否存在，expo-file-system目前有新版和legacy版本，API区别很大，新版有三个核心依赖:Paths File Directory,API不像老版本直观，目前可以使用legacy版本，根据自己情况选择即可
文件存在则将文件存入缓存目录，使用FFmpegKi类执行命令： <code>-i "${nativeInputPath}" -vn -c:a aac -b:a 192k "${nativeOutputPath}"</code>;
目前该依赖库并不能转换成mp3但是可以转换成m4a格式音频:</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FFmpegKit</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">FFmpegSession</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Log</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">FFmpegSessionCompleteCallback</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">LogCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'kroog-ffmpeg-kit-react-native'</span>;

    <span class="hljs-comment">/**
     * 异步处理视频转音频的核心逻辑函数。
     * 
     * 主要功能包括：
     * 1. 检查并创建用于 FFmpeg 的本地工作目录；
     * 2. 将选中的视频文件复制到缓存目录以确保访问权限；
     * 3. 使用 FFmpeg 提取音频流并进行格式转换；
     * 4. 在转换过程中更新进度条；
     * 5. 完成后将结果保存至应用私有目录，并提示用户；
     * 6. 包含详细的错误处理与取消机制支持。
     *
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">video</span> - 视频资源对象，必须包含 uri 和其他必要元数据（如 duration、filename 等）。
     * <span class="hljs-doctag">@returns</span> 无返回值。副作用包括 UI 更新、文件操作及可能的弹窗提示。
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleConvertVideo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">video: VideoAsset</span>) =&gt; {
        <span class="hljs-comment">/**
         * 检查当前是否有选中的视频文件，没有则提示用户选择视频文件
         */</span>
        <span class="hljs-keyword">if</span> (!video) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'请选择视频文件'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span> });
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">/**保存视频资源对象 */</span>
        convertVideoRef.<span class="hljs-property">current</span> = video;
        <span class="hljs-comment">/**
         * 先检查源文件是否存在，源文件不存在停止执行
         * 后续会检查缓存文件是否存在，
         * 如果存在就不缓存，直接使用缓存文件
         */</span>
        <span class="hljs-keyword">const</span> sourceFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(video.<span class="hljs-property">uri</span>);
        <span class="hljs-keyword">if</span> (!sourceFile.<span class="hljs-property">exists</span>) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'视频文件不存在'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">const</span> { <span class="hljs-variable language_">document</span>, cache } = <span class="hljs-title class_">Paths</span>;
        <span class="hljs-comment">/**
         *  存储转换后的音频文件用的FFmpeg 的本地工作目录
         */</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">ffmpegFolder</span>: <span class="hljs-title class_">Directory</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-comment">/**
         * 检测目录是否存在，不存在则创建
         */</span>
        <span class="hljs-keyword">try</span> {

            <span class="hljs-comment">/**
             * 新版expo-file-system 检测文件是否是文件夹使用
             * Paths.info(uri)静态方法方法可以检测文件是否是文件夹
             * 返回对象{exists: boolean, isDirectory: boolean}
             * 或者直接使用new Dictory(ffmpegDir)返回对象，目录是否存在，不存在调用返回值create方法创建
             * 如果路径中包含中文文字必须使用encodeURI进行编码,否则报错
             * 使用encodeURI可以完整路径转码，使用encodeURIComponent
             * 可能转换过多导致路径报错，主要是路径中的中文名部分要转换
             * 第二个参数文件夹名前后写不写/都可以
             */</span>

            ffmpegFolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>(<span class="hljs-title class_">Paths</span>.<span class="hljs-property">document</span>, <span class="hljs-variable constant_">MUSIC_FILE_FILE_NAME</span>);
            <span class="hljs-keyword">if</span> (!ffmpegFolder.<span class="hljs-property">exists</span>) {
                <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">DirectoryCreateOptions</span> = { <span class="hljs-attr">intermediates</span>: <span class="hljs-literal">true</span> };
                <span class="hljs-comment">/**
                 * 创建目录
                 */</span>
                ffmpegFolder.<span class="hljs-title function_">create</span>(obj)
            };
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法创建存储文件夹'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">/**
         * 开始转换视频为音频
         * 1. 复制视频到缓存目录
         * 2. 构建FFmpeg命令
         * 3. 执行转换
         * 4. 清理临时文件
         * 设置开始转换状态为true，重置进度值为0，并设置取消标志为false
         */</span>
        <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">true</span>);
        <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
        cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> { filename } = video;
            <span class="hljs-keyword">const</span> baseName = filename ? filename.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\.[^/.]+$/</span>, <span class="hljs-string">''</span>) : <span class="hljs-string">`video_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;
            <span class="hljs-comment">/**先将目标文件复制到缓存目录中 */</span>
            <span class="hljs-keyword">const</span> cacheDir = cache.<span class="hljs-property">uri</span> ?? <span class="hljs-variable language_">document</span>.<span class="hljs-property">uri</span> ?? <span class="hljs-string">'/'</span>;
            <span class="hljs-comment">//方式1: 手动拼接文件要保存到缓存目录路径</span>
            <span class="hljs-keyword">const</span> cachedInputUri = <span class="hljs-string">`<span class="hljs-subst">${cacheDir}</span><span class="hljs-subst">${filename ?? baseName}</span>`</span>;
            cachedInputUriRef.<span class="hljs-property">current</span> = cachedInputUri;
            <span class="hljs-comment">// 方式2: 使用File构造函数链式创建目标文件</span>
            <span class="hljs-comment">// const cachedInputUri = new File(Paths.cache, filename ?? baseName).uri;</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">/**
                 * 创建缓存目标文件对象检查是否存在
                 * 如果缓存文件存在，直接使用缓存文件,不存在则缓存视频文件
                 */</span>
                <span class="hljs-keyword">const</span> targetFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUri);
                <span class="hljs-keyword">if</span> (!targetFile.<span class="hljs-property">exists</span>) {
                    sourceFile.<span class="hljs-title function_">copy</span>(targetFile);
                };
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'复制视频到缓存目录失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            };

            <span class="hljs-comment">// 添加时间戳到文件名，避免文件名冲突</span>
            <span class="hljs-keyword">const</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[:.]/g</span>, <span class="hljs-string">'-'</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">19</span>);
            <span class="hljs-comment">/**
             * 输出文件名，不带extension，
             * 因为要生成图片时使用名称作为文件名，所以不能带扩展名
             * cachedOutputUri: 缓存输出文件路径
             * finalOutputUri: 最终输出文件路径
             */</span>
            <span class="hljs-keyword">const</span> outputFileName = <span class="hljs-string">`<span class="hljs-subst">${baseName}</span>_<span class="hljs-subst">${timestamp}</span>`</span>;
            <span class="hljs-keyword">const</span> cachedOutputUri = <span class="hljs-string">`<span class="hljs-subst">${cacheDir}</span><span class="hljs-subst">${outputFileName}</span>.m4a`</span>;
            <span class="hljs-keyword">const</span> finalOutputUri = <span class="hljs-string">`<span class="hljs-subst">${ffmpegFolder.uri}</span><span class="hljs-subst">${outputFileName}</span>.m4a`</span>;
            outFileNameRef.<span class="hljs-property">current</span> = outputFileName;
            <span class="hljs-comment">// 保存临时文件路径用于清理</span>
            cachedOutputUriRef.<span class="hljs-property">current</span> = cachedOutputUri;
            lastOutputUriRef.<span class="hljs-property">current</span> = finalOutputUri;
            <span class="hljs-comment">/**
             * 创建进出路径，用于command命令拼接
             */</span>
            <span class="hljs-keyword">const</span> nativeInputPath = cachedInputUri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'file://'</span>) ? cachedInputUri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'file://'</span>, <span class="hljs-string">''</span>) : cachedInputUri;
            <span class="hljs-keyword">const</span> nativeOutputPath = cachedOutputUri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'file://'</span>) ? cachedOutputUri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'file://'</span>, <span class="hljs-string">''</span>) : cachedOutputUri;
            <span class="hljs-comment">/** 
             * 构建命令 暂不支持mp3，暂时使用m4a
             * 转换命令参考：
             * 
            */</span>
            <span class="hljs-keyword">const</span> command = <span class="hljs-string">`-i "<span class="hljs-subst">${nativeInputPath}</span>" -vn -c:a aac -b:a 192k "<span class="hljs-subst">${nativeOutputPath}</span>"`</span>;
            <span class="hljs-comment">/**
             * 转换完成回调函数
             * 1.获取转换码
             * 2.检查转换是否成功
             * 3.如果成功，检查是否取消，取消不保存文件
             * 4.如果未取消，保存输出文件
             * 5.清理临时文件
             * 6.创建视频缩略图保存到cover目录中
             * 7.将歌曲信息和图片信息写入musicList文件夹下的convertList.json文件中
             * <span class="hljs-doctag">@param</span> session FFmpegSession
             * <span class="hljs-doctag">@returns</span> 
             */</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">completeCallback</span>: <span class="hljs-title class_">FFmpegSessionCompleteCallback</span> = <span class="hljs-keyword">async</span> (<span class="hljs-attr">session</span>: <span class="hljs-title class_">FFmpegSession</span>) =&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 获取转换码</span>
                    <span class="hljs-keyword">const</span> returnCode = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">getReturnCode</span>();
                    <span class="hljs-comment">/**
                     * 检查是否成功
                     * 方法1：调用ReturnCode的成员方法isValueSuccess返回布尔值
                     * 方法2：调用ReturnCode的静态方法isSuccess传递ReturnCode对象实例然后返回
                     * 布尔值
                     * 成员方法getCode 返回ReturnCode对象实例的code属性值，0 是success 255 是cancel
                     */</span>
                    <span class="hljs-comment">/**方式1 调用成员方法检测 */</span>
                    <span class="hljs-keyword">const</span> success = returnCode.<span class="hljs-title function_">isValueSuccess</span>();
                    <span class="hljs-comment">/**方式2 调用成员方法getValue获取执行值，再调用静态方法isSuccess 检查是否成功 */</span>
                    <span class="hljs-comment">// success = ReturnCode.isSuccess(returnCode);</span>
                    <span class="hljs-keyword">if</span> (success) {
                        <span class="hljs-comment">// 如果转换已取消，则跳过保存</span>
                        <span class="hljs-keyword">if</span> (cancelledRef.<span class="hljs-property">current</span>) {
                            <span class="hljs-comment">// 即使取消也要清理临时文件</span>
                            <span class="hljs-keyword">try</span> {
                                <span class="hljs-keyword">if</span> (cachedInputUri) {
                                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUri).<span class="hljs-title function_">delete</span>();
                                }
                            } <span class="hljs-keyword">catch</span> (error) {
                                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'清理输入缓存文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                            }
                            <span class="hljs-keyword">return</span>;
                        };
                        <span class="hljs-comment">// 检查输出文件是否存在且非空</span>
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-keyword">const</span> { exists } = <span class="hljs-title class_">Paths</span>.<span class="hljs-title function_">info</span>(cachedOutputUriRef.<span class="hljs-property">current</span>!);
                            <span class="hljs-keyword">if</span> (!exists) {
                                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'生成的音频文件为空或不存在'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                                <span class="hljs-keyword">return</span>;
                            };
                        } <span class="hljs-keyword">catch</span> (error) {
                            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法验证输出文件'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                            <span class="hljs-keyword">return</span>;
                        };
                        isSuccessRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">/**
                         * 转换失败后获取状态码解释原因
                         */</span>
                        <span class="hljs-keyword">const</span> returnCodeValue = returnCode.<span class="hljs-title function_">getValue</span>();
                        <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = {
                            <span class="hljs-number">255</span>: <span class="hljs-string">'转换已取消'</span>,
                            <span class="hljs-number">1</span>: <span class="hljs-string">'输入文件不存在或无法读取'</span>,
                            <span class="hljs-number">2</span>: <span class="hljs-string">'输出路径无效或无写入权限'</span>,
                        }
                        <span class="hljs-keyword">let</span> errorMessage = config[returnCodeValue] ?? <span class="hljs-string">`转换失败 (错误码: <span class="hljs-subst">${returnCodeValue}</span>)`</span>;
                        <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: errorMessage, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                    }
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                } <span class="hljs-keyword">finally</span> {
                    cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
                    <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (isSuccessRef.<span class="hljs-property">current</span>) {
                        <span class="hljs-title function_">setVisible</span>(<span class="hljs-literal">true</span>);
                    }
                }
            };
            <span class="hljs-comment">/**
             * 转换过程中日志处理,更新转换进度
             * 使用生产环境友好的日志回调
             * <span class="hljs-doctag">@param</span> log Log 日志对象
             */</span>
            <span class="hljs-comment">// 为了兼容现有的日志解析逻辑，保留原有的进度计算</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">legacyLogCallback</span>: <span class="hljs-title class_">LogCallback</span> = <span class="hljs-function">(<span class="hljs-params">log: Log</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> message = log.<span class="hljs-title function_">getMessage</span>();
                <span class="hljs-keyword">if</span> (message.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'time='</span>)) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">const</span> timeMatch = message.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/time=(\d+):(\d+):(\d+\.\d+)/</span>);
                        <span class="hljs-keyword">if</span> (timeMatch) {
                            <span class="hljs-keyword">const</span> hours = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">1</span>]);
                            <span class="hljs-keyword">const</span> minutes = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">2</span>]);
                            <span class="hljs-keyword">const</span> seconds = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">3</span>]);
                            <span class="hljs-keyword">const</span> currentTimeInSeconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span> + seconds;
                            <span class="hljs-keyword">const</span> totalTimeInSeconds = (video &amp;&amp; (video.<span class="hljs-property">duration</span> ?? <span class="hljs-number">0</span>)) || <span class="hljs-number">120</span>;
                            <span class="hljs-keyword">const</span> calculatedProgress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>, (currentTimeInSeconds / totalTimeInSeconds) * <span class="hljs-number">100</span>);
                            <span class="hljs-title function_">setProgress</span>(calculatedProgress);
                        }
                    } <span class="hljs-keyword">catch</span> (error) {
                        <span class="hljs-keyword">if</span> (__DEV__) {
                            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'进度解析失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                        }
                    }
                }
            };
            <span class="hljs-comment">/** 开始转换 */</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">/**
                 * 存在如下方法
                 * FFmpegKit.execute(cmd): Promise&lt;FFmpegSession&gt;
                 * executeAsync(command: string, completeCallback?: FFmpegSessionCompleteCallback, logCallback?: LogCallback, statisticsCallback?: StatisticsCallback): Promise&lt;FFmpegSession&gt;
                 */</span>
                conversionSessionRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">FFmpegKit</span>.<span class="hljs-title function_">executeAsync</span>(command, completeCallback, legacyLogCallback);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            }
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
        }
    };
</code></pre>
<p>completeCallback中是转换完成时执行的回调函数，而legacyLogCallback回调函数则是转换过程的日志回调函数 ，在该函数中可以做转换进度更新，也就是说我们核心就是使用调用conversionSessionRef.current = await FFmpegKit.executeAsync(command, completeCallback, legacyLogCallback);
并且在转换过程中添加取消转换和转换失败处理：基本效果就是如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aa828de432847ffa6ba80a24bc21e47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=2MEM1%2F%2B%2B4mA2R2Q0ZkqXilwcM8g%3D" alt="微信图片_20260114164854_149_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c581ef0dd6241a7a6325784e2cb5398~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=iN7K%2FucYW7HZfiaeP35udVd5saA%3D" alt="微信图片_20260114164855_150_23.jpg" loading="lazy"/></p>
<p><strong>3.取消转换</strong></p>
<p>转换途中万一发现不是自己想要转换的，可以终止转换，我们要清理转换前创建的文件等:</p>
<pre><code class="hljs language-ts" lang="ts">    <span class="hljs-comment">/**
     * 取消转换
     * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancel</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-comment">// mark as cancelled so callbacks skip saving</span>
        cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (!conversionSessionRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span>;
        };

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">/**
             * 优先尝试 session.cancel()
             */</span>
            <span class="hljs-keyword">await</span> conversionSessionRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">cancel</span>();
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-comment">/**
             * 调用cancel方法失败，尝试通过 sessionId 使用 FFmpegKit.cancel
             */</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> sessionId = conversionSessionRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getSessionId</span>();
                <span class="hljs-keyword">await</span> <span class="hljs-title class_">FFmpegKit</span>.<span class="hljs-title function_">cancel</span>(sessionId)
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'已取消转换'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span> });
            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'取消转换失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 清理状态</span>
            conversionSessionRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
            <span class="hljs-comment">// 删除临时输出文件，避免残留</span>
            <span class="hljs-keyword">if</span> (cachedOutputUriRef.<span class="hljs-property">current</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedOutputUriRef.<span class="hljs-property">current</span>);
                    <span class="hljs-keyword">if</span> (file.<span class="hljs-property">exists</span>) {
                        file.<span class="hljs-title function_">delete</span>();
                    }
                } <span class="hljs-keyword">catch</span> (delErr) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'删除临时输出文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                }
                cachedOutputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">if</span> (lastOutputUriRef.<span class="hljs-property">current</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(lastOutputUriRef.<span class="hljs-property">current</span>);
                    <span class="hljs-keyword">if</span> (file.<span class="hljs-property">exists</span>) {
                        file.<span class="hljs-title function_">delete</span>();
                    }
                } <span class="hljs-keyword">catch</span> (delErr) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'删除临时输出文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                }
                lastOutputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            }
        }
    };
</code></pre>
<p><strong>4.转换完成可以提示用户修改歌曲信息：</strong></p>
<pre><code class="hljs language-ts" lang="ts">    <span class="hljs-comment">/**
     * 保存转换后的文件
     * 将其从转换完成中提取出来，添加转换后可以填写信息，不填写则使用默认信息
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveConvertFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">info?: UpdateSongInfoConfig</span>) =&gt; {
        <span class="hljs-keyword">if</span> (!convertVideoRef.<span class="hljs-property">current</span> || !isSuccessRef.<span class="hljs-property">current</span>) {
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">// 复制文件到应用私有目录</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> { uri, duration, durationString } = convertVideoRef.<span class="hljs-property">current</span>;
            <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedOutputUriRef.<span class="hljs-property">current</span>!);
            <span class="hljs-keyword">const</span> privateFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(lastOutputUriRef.<span class="hljs-property">current</span>!);
            file.<span class="hljs-title function_">copy</span>(privateFile);
            <span class="hljs-comment">/**创建对应视频的封面图 */</span>
            <span class="hljs-keyword">const</span> coverUrl = <span class="hljs-keyword">await</span> <span class="hljs-title function_">addAudioCover</span>(uri, outFileNameRef.<span class="hljs-property">current</span>!) ?? <span class="hljs-string">''</span>;
            <span class="hljs-comment">/**
             * 转换后的音频文件存在
             * 执行添加音频json文件操作
             */</span>
            <span class="hljs-keyword">const</span> { exists, creationTime, md5, <span class="hljs-attr">uri</span>: musicUri, modificationTime } = privateFile;
            <span class="hljs-keyword">if</span> (exists) {
                <span class="hljs-comment">/**
                 * 这里必须手动解构，无法直接...rest,File对象上的属性不可枚举
                 * 类的内部是get方法写的
                 * 调整为存储到数据表
                 */</span>
                <span class="hljs-keyword">const</span> { title = outFileNameRef.<span class="hljs-property">current</span>!, artist = <span class="hljs-string">'未知歌手'</span>, album = <span class="hljs-string">'未知专辑'</span> } = info ?? {};
                <span class="hljs-keyword">const</span> time = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
                <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">SqliteSongInfo</span> = {
                    <span class="hljs-attr">id</span>: md5 || <span class="hljs-string">`<span class="hljs-subst">${time}</span>`</span>,
                    <span class="hljs-attr">uri</span>: musicUri,
                    artist,
                    title,
                    <span class="hljs-attr">duration</span>: duration,
                    durationString,
                    <span class="hljs-attr">modificationTime</span>: modificationTime ?? time,
                    coverUrl,
                    <span class="hljs-attr">isCollection</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">isPrivate</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-attr">creationTime</span>: creationTime ?? time,
                    album,
                    <span class="hljs-attr">lyrics</span>: <span class="hljs-string">''</span>,
                };
                <span class="hljs-keyword">const</span> bool = <span class="hljs-keyword">await</span> <span class="hljs-title function_">addSong</span>(obj, <span class="hljs-variable constant_">SQLITE_CONVERTED_TABLE_NAME</span>);
                <span class="hljs-keyword">if</span> (bool) {
                    convertVideoRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
                    isSuccessRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">const</span> cacheInputFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUriRef.<span class="hljs-property">current</span>!);
                    <span class="hljs-keyword">if</span> (cacheInputFile.<span class="hljs-property">exists</span>) {
                        cacheInputFile.<span class="hljs-title function_">delete</span>();
                        cachedInputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
                    }
                    <span class="hljs-comment">/**删除转换后的缓存音频文件 */</span>
                    file.<span class="hljs-title function_">delete</span>();
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'音频文件已成功保存'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span> });
                };
            };
        } <span class="hljs-keyword">catch</span> (copyError) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法保存音频文件到应用文件夹'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        }
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cee4a3dfe2ba4b389caada9a1c052872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=JoXCm3aWr8wh2vFhz3VtGn7G65U%3D" alt="微信图片_20260114164856_151_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f347ce46aed482c90a30fc368b4950d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=e2HRatZSDgHLHr3Pa9N4Y5ZvVNA%3D" alt="微信图片_20260114164857_152_23.jpg" loading="lazy"/></p>
<p>用户可以确定和取消，都将保存转换后的文件</p>
<p><strong>5.查看转换后的歌曲列表，在这里可以修改和删除:</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f30190007667469e969a8f0a43fc0001~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=kIqRV04n1gakQZ9G6kj3rKkLkAs%3D" alt="微信图片_20260114164859_154_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bfef8b023e041368ecddfb4d1e4321a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=ve%2FPfwHMSEnQ4igGJitW0oNyr4M%3D" alt="微信图片_20260114164900_155_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9c27acd4243144dcaae2d50150f1c509~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=lkXMJudM7yIAB0QdLJHsRy0jbRI%3D" alt="微信图片_20260114164901_156_23.jpg" loading="lazy"/></p>
<p>当前还可以播放：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef5ac9f362f4aebb10b5f6e42f017e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=3VwtgliZjP5YA4m31eKAwknnKkA%3D" alt="微信图片_20260114170201_157_23.jpg" loading="lazy"/></p>
<p>关于音乐播放，当前项目中使用了react-native-audio-pro和expo-audio，在转换管理界面的播放使用了exp-audio，其实目前rn音乐播放器使用react-native-track-player依赖库最好，但是对于新版本rn和expo有难以解决的bug，react-native-audio-pro则bug少一点</p>
<p><strong>6.创建音频文件的封面图</strong></p>
<p>核心使用expo-video-thumbnails依赖库，获取指定时间的图像，并设置图片质量，但是格式就只能是jpg</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { getThumbnailAsync, <span class="hljs-keyword">type</span> <span class="hljs-title class_">VideoThumbnailsOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'expo-video-thumbnails'</span>;
<span class="hljs-comment">/**
 * 为音频添加封面
 * 使用expo-video-thumbnails库生成音频封面
 * 将图片保存到应用私有目录的cover文件夹中，图片格式.jpg,默认最低画质
 * <span class="hljs-doctag">@param</span> audioUri 音频uri
 * <span class="hljs-doctag">@param</span> coverName 封面名称 通常与音频文件名相同
 * <span class="hljs-doctag">@returns</span> 封面uri
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addAudioCover = <span class="hljs-keyword">async</span> (<span class="hljs-attr">audioUri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">coverName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">seconds</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2000</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt; =&gt; {
    <span class="hljs-keyword">if</span> (!coverName.<span class="hljs-title function_">trim</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">const</span> { exists } = <span class="hljs-title class_">Paths</span>.<span class="hljs-title function_">info</span>(audioUri);
    <span class="hljs-keyword">if</span> (!exists) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">VideoThumbnailsOptions</span> = {
            <span class="hljs-attr">time</span>: seconds,
            <span class="hljs-attr">quality</span>: <span class="hljs-number">.7</span>,<span class="hljs-comment">//0~1,0最低1最高</span>
        };
        <span class="hljs-comment">/**
         * 获取视频文件指定秒数的音频封面
         */</span>
        <span class="hljs-keyword">const</span> { uri } = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getThumbnailAsync</span>(audioUri, obj);
        <span class="hljs-comment">/**
         * 获取扩展名便于生成封面uri
         */</span>
        <span class="hljs-keyword">const</span> ext = uri.<span class="hljs-title function_">split</span>(<span class="hljs-string">'.'</span>).<span class="hljs-title function_">at</span>(-<span class="hljs-number">1</span>);
        <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(uri);
        <span class="hljs-comment">/**
         * 创建封面目录
         * 如果目录不存在则创建
         */</span>
        <span class="hljs-keyword">const</span> coverUrl = <span class="hljs-string">`<span class="hljs-subst">${Paths.<span class="hljs-variable language_">document</span>.uri + COVER_FILE_FILE_NAME}</span>/`</span>
        <span class="hljs-keyword">const</span> { exists, isDirectory } = <span class="hljs-title class_">Paths</span>.<span class="hljs-title function_">info</span>(coverUrl);
        <span class="hljs-keyword">if</span> (!exists || !isDirectory) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>(<span class="hljs-title class_">Paths</span>.<span class="hljs-property">document</span>, <span class="hljs-string">'cover'</span>).<span class="hljs-title function_">create</span>({ <span class="hljs-attr">intermediates</span>: <span class="hljs-literal">true</span> });
        };
        <span class="hljs-comment">/**
         * 创建封面文件
         * 并copy到封面目录
         */</span>
        <span class="hljs-keyword">const</span> finnalUri = <span class="hljs-string">`<span class="hljs-subst">${coverUrl + coverName}</span>.<span class="hljs-subst">${ext}</span>`</span>;
        <span class="hljs-comment">/**
         *  检测是否重名
         */</span>
        <span class="hljs-keyword">const</span> info = <span class="hljs-title class_">Paths</span>.<span class="hljs-title function_">info</span>(finnalUri);
        <span class="hljs-keyword">if</span> (info.<span class="hljs-property">exists</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        file.<span class="hljs-title function_">copy</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(finnalUri));
        file.<span class="hljs-title function_">delete</span>();
        <span class="hljs-keyword">return</span> finnalUri;
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    }
}
</code></pre>
<p><strong>7.使用FFmpegKit获取已有mp3文件的封面图，并不是所有文件都有</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FFmpegKit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'kroog-ffmpeg-kit-react-native'</span>;
<span class="hljs-comment">/**
 * 使用FFmpeg提取MP3音频文件的封面图片
 * <span class="hljs-doctag">@param</span> audioUri 音频文件的URI路径
 * <span class="hljs-doctag">@param</span> coverName 封面图片的名称（不带扩展名）
 * <span class="hljs-doctag">@returns</span> 封面图片的完整URI路径，如果提取失败返回null
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> extractMp3Cover = <span class="hljs-keyword">async</span> (<span class="hljs-attr">audioUri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">coverName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt; =&gt; {
    <span class="hljs-keyword">if</span> (!audioUri || !coverName.<span class="hljs-title function_">trim</span>()) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 创建cover目录</span>
        <span class="hljs-keyword">const</span> coverDir = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>(<span class="hljs-title class_">Paths</span>.<span class="hljs-property">document</span>, <span class="hljs-string">'cover'</span>);
        <span class="hljs-keyword">if</span> (!coverDir.<span class="hljs-property">exists</span>) {
            coverDir.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">intermediates</span>: <span class="hljs-literal">true</span> });
        }

        <span class="hljs-comment">// 构建输出路径</span>
        <span class="hljs-keyword">const</span> coverPath = <span class="hljs-string">`<span class="hljs-subst">${Paths.<span class="hljs-variable language_">document</span>.uri}</span>cover/<span class="hljs-subst">${coverName}</span>.jpg`</span>;
        <span class="hljs-keyword">const</span> coverFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(coverPath);

        <span class="hljs-comment">// 检查封面是否已存在</span>
        <span class="hljs-keyword">if</span> (coverFile.<span class="hljs-property">exists</span>) {
            <span class="hljs-keyword">return</span> coverPath;
        }

        <span class="hljs-comment">// 使用FFmpeg提取封面图片</span>
        <span class="hljs-comment">// -an: 不处理音频</span>
        <span class="hljs-comment">// -vcodec copy: 直接复制视频流（封面）</span>
        <span class="hljs-comment">// -y: 覆盖已存在的文件</span>
        <span class="hljs-keyword">const</span> command = <span class="hljs-string">`-i "<span class="hljs-subst">${audioUri}</span>" -an -vcodec copy -y "<span class="hljs-subst">${coverPath}</span>"`</span>;
        <span class="hljs-keyword">const</span> session = <span class="hljs-keyword">await</span> <span class="hljs-title class_">FFmpegKit</span>.<span class="hljs-title function_">execute</span>(command);
        <span class="hljs-keyword">const</span> returnCode = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">getReturnCode</span>();

        <span class="hljs-keyword">if</span> (returnCode.<span class="hljs-title function_">isValueSuccess</span>()) {
            <span class="hljs-comment">// 检查文件是否真的创建成功</span>
            <span class="hljs-keyword">if</span> (coverFile.<span class="hljs-property">exists</span>) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`成功提取封面: <span class="hljs-subst">${coverName}</span>`</span>);
                <span class="hljs-keyword">return</span> coverPath;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 如果文件没有创建，说明没有嵌入封面</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">getOutput</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'提取封面失败:'</span>, output);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'提取MP3封面出错:'</span>, error);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
};
</code></pre>
<p><strong>8.完整代码:</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { useRef, useState, useEffect, <span class="hljs-keyword">type</span> <span class="hljs-variable constant_">FC</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TitleBar</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/music/TitleBar'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">VideoList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/VideoList'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Ionicons</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@expo/vector-icons'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VideoAsset</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;
<span class="hljs-keyword">import</span> { router } <span class="hljs-keyword">from</span> <span class="hljs-string">'expo-router'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FFmpegKit</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">FFmpegSession</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Log</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">FFmpegSessionCompleteCallback</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">LogCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'kroog-ffmpeg-kit-react-native'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span>, <span class="hljs-title class_">StyleSheet</span>, <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Pressable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-keyword">import</span> { useSafeAreaInsets } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native-safe-area-context'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemedView</span>, <span class="hljs-title class_">ThemedText</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/theme/ThemedComponents'</span>;
<span class="hljs-keyword">import</span> { useThemeNotification } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useTheme'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">File</span>, <span class="hljs-title class_">Paths</span>, <span class="hljs-title class_">Directory</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">DirectoryCreateOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'expo-file-system'</span>;
<span class="hljs-keyword">import</span> { addAudioCover } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/audioManager'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">SqliteSongInfo</span>, <span class="hljs-title class_">UpdateSongInfoConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UpdateOrDeleteModal</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/music/localComp/UpdateOrDeleteModal'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ProcessTip</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/ProcessTip'</span>;
<span class="hljs-keyword">import</span> { addSong } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/libs/sqlite'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">SQLITE_CONVERTED_TABLE_NAME</span>, <span class="hljs-variable constant_">MUSIC_FILE_FILE_NAME</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/constants/SongList'</span>;
<span class="hljs-comment">/**
 * 视频转歌曲页面
 * <span class="hljs-doctag">@returns</span> 
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FfmpegKitPage</span>: <span class="hljs-variable constant_">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { top, bottom } = <span class="hljs-title function_">useSafeAreaInsets</span>();
    <span class="hljs-keyword">const</span> [isConverting, setIsConverting] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
    <span class="hljs-comment">/**是否转换成功 */</span>
    <span class="hljs-keyword">const</span> isSuccessRef = useRef&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);
    <span class="hljs-comment">/**保存需要转换的视频文件 */</span>
    <span class="hljs-keyword">const</span> convertVideoRef = useRef&lt;<span class="hljs-title class_">VideoAsset</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-comment">/**保存转换后的文件名 */</span>
    <span class="hljs-keyword">const</span> outFileNameRef = useRef&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> cachedInputUriRef = useRef&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-comment">// 添加状态管理</span>
    <span class="hljs-keyword">const</span> cachedOutputUriRef = useRef&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> lastOutputUriRef = useRef&lt;<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> conversionSessionRef = useRef&lt;<span class="hljs-title class_">FFmpegSession</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> cancelledRef = useRef&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> showNotification = <span class="hljs-title function_">useThemeNotification</span>();
    <span class="hljs-keyword">const</span> [visible, setVisible] = useState&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleBack</span> = (<span class="hljs-params"/>) =&gt; {
        router.<span class="hljs-title function_">dismiss</span>();
    };
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">cleanUp</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">if</span> (cachedOutputUriRef.<span class="hljs-property">current</span>) {
            <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedOutputUriRef.<span class="hljs-property">current</span>);
            <span class="hljs-keyword">if</span> (file.<span class="hljs-property">exists</span>) {
                file.<span class="hljs-title function_">delete</span>();
            }
        }
        cachedOutputUriRef.<span class="hljs-property">current</span> &amp;&amp;= <span class="hljs-literal">null</span>;
        conversionSessionRef.<span class="hljs-property">current</span> &amp;&amp;= <span class="hljs-literal">null</span>;
    };
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">cleanUp</span>();
        }
    }, [])
    <span class="hljs-comment">/**
     * 保存转换后的文件
     * 将其从转换完成中提取出来，添加转换后可以填写信息，不填写则使用默认信息
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveConvertFile</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">info?: UpdateSongInfoConfig</span>) =&gt; {
        <span class="hljs-keyword">if</span> (!convertVideoRef.<span class="hljs-property">current</span> || !isSuccessRef.<span class="hljs-property">current</span>) {
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">// 复制文件到应用私有目录</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> { uri, duration, durationString } = convertVideoRef.<span class="hljs-property">current</span>;
            <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedOutputUriRef.<span class="hljs-property">current</span>!);
            <span class="hljs-keyword">const</span> privateFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(lastOutputUriRef.<span class="hljs-property">current</span>!);
            file.<span class="hljs-title function_">copy</span>(privateFile);
            <span class="hljs-comment">/**创建对应视频的封面图 */</span>
            <span class="hljs-keyword">const</span> coverUrl = <span class="hljs-keyword">await</span> <span class="hljs-title function_">addAudioCover</span>(uri, outFileNameRef.<span class="hljs-property">current</span>!) ?? <span class="hljs-string">''</span>;
            <span class="hljs-comment">/**
             * 转换后的音频文件存在
             * 执行添加音频json文件操作
             */</span>
            <span class="hljs-keyword">const</span> { exists, creationTime, md5, <span class="hljs-attr">uri</span>: musicUri, modificationTime } = privateFile;
            <span class="hljs-keyword">if</span> (exists) {
                <span class="hljs-comment">/**
                 * 这里必须手动解构，无法直接...rest,File对象上的属性不可枚举
                 * 类的内部是get方法写的
                 * 调整为存储到数据表
                 */</span>
                <span class="hljs-keyword">const</span> { title = outFileNameRef.<span class="hljs-property">current</span>!, artist = <span class="hljs-string">'未知歌手'</span>, album = <span class="hljs-string">'未知专辑'</span> } = info ?? {};
                <span class="hljs-keyword">const</span> time = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
                <span class="hljs-keyword">const</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">SqliteSongInfo</span> = {
                    <span class="hljs-attr">id</span>: md5 || <span class="hljs-string">`<span class="hljs-subst">${time}</span>`</span>,
                    <span class="hljs-attr">uri</span>: musicUri,
                    artist,
                    title,
                    <span class="hljs-attr">duration</span>: duration,
                    durationString,
                    <span class="hljs-attr">modificationTime</span>: modificationTime ?? time,
                    coverUrl,
                    <span class="hljs-attr">isCollection</span>: <span class="hljs-number">0</span>,
                    <span class="hljs-attr">isPrivate</span>: <span class="hljs-number">1</span>,
                    <span class="hljs-attr">creationTime</span>: creationTime ?? time,
                    album,
                    <span class="hljs-attr">lyrics</span>: <span class="hljs-string">''</span>,
                };
                <span class="hljs-keyword">const</span> bool = <span class="hljs-keyword">await</span> <span class="hljs-title function_">addSong</span>(obj, <span class="hljs-variable constant_">SQLITE_CONVERTED_TABLE_NAME</span>);
                <span class="hljs-keyword">if</span> (bool) {
                    convertVideoRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
                    isSuccessRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-keyword">const</span> cacheInputFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUriRef.<span class="hljs-property">current</span>!);
                    <span class="hljs-keyword">if</span> (cacheInputFile.<span class="hljs-property">exists</span>) {
                        cacheInputFile.<span class="hljs-title function_">delete</span>();
                        cachedInputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
                    }
                    <span class="hljs-comment">/**删除转换后的缓存音频文件 */</span>
                    file.<span class="hljs-title function_">delete</span>();
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'音频文件已成功保存'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span> });
                };
            };
        } <span class="hljs-keyword">catch</span> (copyError) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法保存音频文件到应用文件夹'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        }
    }
    <span class="hljs-comment">/**
     * 异步处理视频转音频的核心逻辑函数。
     * 
     * 主要功能包括：
     * 1. 检查并创建用于 FFmpeg 的本地工作目录；
     * 2. 将选中的视频文件复制到缓存目录以确保访问权限；
     * 3. 使用 FFmpeg 提取音频流并进行格式转换；
     * 4. 在转换过程中更新进度条；
     * 5. 完成后将结果保存至应用私有目录，并提示用户；
     * 6. 包含详细的错误处理与取消机制支持。
     *
     * <span class="hljs-doctag">@param</span> <span class="hljs-variable">video</span> - 视频资源对象，必须包含 uri 和其他必要元数据（如 duration、filename 等）。
     * <span class="hljs-doctag">@returns</span> 无返回值。副作用包括 UI 更新、文件操作及可能的弹窗提示。
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleConvertVideo</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">video: VideoAsset</span>) =&gt; {
        <span class="hljs-comment">/**
         * 检查当前是否有选中的视频文件，没有则提示用户选择视频文件
         */</span>
        <span class="hljs-keyword">if</span> (!video) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'请选择视频文件'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span> });
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">/**保存视频资源对象 */</span>
        convertVideoRef.<span class="hljs-property">current</span> = video;
        <span class="hljs-comment">/**
         * 先检查源文件是否存在，源文件不存在停止执行
         * 后续会检查缓存文件是否存在，
         * 如果存在就不缓存，直接使用缓存文件
         */</span>
        <span class="hljs-keyword">const</span> sourceFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(video.<span class="hljs-property">uri</span>);
        <span class="hljs-keyword">if</span> (!sourceFile.<span class="hljs-property">exists</span>) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'视频文件不存在'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">const</span> { <span class="hljs-variable language_">document</span>, cache } = <span class="hljs-title class_">Paths</span>;
        <span class="hljs-comment">/**
         *  存储转换后的音频文件用的FFmpeg 的本地工作目录
         */</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">ffmpegFolder</span>: <span class="hljs-title class_">Directory</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-comment">/**
         * 检测目录是否存在，不存在则创建
         */</span>
        <span class="hljs-keyword">try</span> {

            <span class="hljs-comment">/**
             * 新版expo-file-system 检测文件是否是文件夹使用
             * Paths.info(uri)静态方法方法可以检测文件是否是文件夹
             * 返回对象{exists: boolean, isDirectory: boolean}
             * 或者直接使用new Dictory(ffmpegDir)返回对象，目录是否存在，不存在调用返回值create方法创建
             * 如果路径中包含中文文字必须使用encodeURI进行编码,否则报错
             * 使用encodeURI可以完整路径转码，使用encodeURIComponent
             * 可能转换过多导致路径报错，主要是路径中的中文名部分要转换
             * 第二个参数文件夹名前后写不写/都可以
             */</span>

            ffmpegFolder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Directory</span>(<span class="hljs-title class_">Paths</span>.<span class="hljs-property">document</span>, <span class="hljs-variable constant_">MUSIC_FILE_FILE_NAME</span>);
            <span class="hljs-keyword">if</span> (!ffmpegFolder.<span class="hljs-property">exists</span>) {
                <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">DirectoryCreateOptions</span> = { <span class="hljs-attr">intermediates</span>: <span class="hljs-literal">true</span> };
                <span class="hljs-comment">/**
                 * 创建目录
                 */</span>
                ffmpegFolder.<span class="hljs-title function_">create</span>(obj)
            };
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法创建存储文件夹'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            <span class="hljs-keyword">return</span>;
        };
        <span class="hljs-comment">/**
         * 开始转换视频为音频
         * 1. 复制视频到缓存目录
         * 2. 构建FFmpeg命令
         * 3. 执行转换
         * 4. 清理临时文件
         * 设置开始转换状态为true，重置进度值为0，并设置取消标志为false
         */</span>
        <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">true</span>);
        <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
        cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> { filename } = video;
            <span class="hljs-keyword">const</span> baseName = filename ? filename.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\.[^/.]+$/</span>, <span class="hljs-string">''</span>) : <span class="hljs-string">`video_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;
            <span class="hljs-comment">/**先将目标文件复制到缓存目录中 */</span>
            <span class="hljs-keyword">const</span> cacheDir = cache.<span class="hljs-property">uri</span> ?? <span class="hljs-variable language_">document</span>.<span class="hljs-property">uri</span> ?? <span class="hljs-string">'/'</span>;
            <span class="hljs-comment">//方式1: 手动拼接文件要保存到缓存目录路径</span>
            <span class="hljs-keyword">const</span> cachedInputUri = <span class="hljs-string">`<span class="hljs-subst">${cacheDir}</span><span class="hljs-subst">${filename ?? baseName}</span>`</span>;
            cachedInputUriRef.<span class="hljs-property">current</span> = cachedInputUri;
            <span class="hljs-comment">// 方式2: 使用File构造函数链式创建目标文件</span>
            <span class="hljs-comment">// const cachedInputUri = new File(Paths.cache, filename ?? baseName).uri;</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">/**
                 * 创建缓存目标文件对象检查是否存在
                 * 如果缓存文件存在，直接使用缓存文件,不存在则缓存视频文件
                 */</span>
                <span class="hljs-keyword">const</span> targetFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUri);
                <span class="hljs-keyword">if</span> (!targetFile.<span class="hljs-property">exists</span>) {
                    sourceFile.<span class="hljs-title function_">copy</span>(targetFile);
                };
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'复制视频到缓存目录失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            };

            <span class="hljs-comment">// 添加时间戳到文件名，避免文件名冲突</span>
            <span class="hljs-keyword">const</span> timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[:.]/g</span>, <span class="hljs-string">'-'</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">19</span>);
            <span class="hljs-comment">/**
             * 输出文件名，不带extension，
             * 因为要生成图片时使用名称作为文件名，所以不能带扩展名
             * cachedOutputUri: 缓存输出文件路径
             * finalOutputUri: 最终输出文件路径
             */</span>
            <span class="hljs-keyword">const</span> outputFileName = <span class="hljs-string">`<span class="hljs-subst">${baseName}</span>_<span class="hljs-subst">${timestamp}</span>`</span>;
            <span class="hljs-keyword">const</span> cachedOutputUri = <span class="hljs-string">`<span class="hljs-subst">${cacheDir}</span><span class="hljs-subst">${outputFileName}</span>.m4a`</span>;
            <span class="hljs-keyword">const</span> finalOutputUri = <span class="hljs-string">`<span class="hljs-subst">${ffmpegFolder.uri}</span><span class="hljs-subst">${outputFileName}</span>.m4a`</span>;
            outFileNameRef.<span class="hljs-property">current</span> = outputFileName;
            <span class="hljs-comment">// 保存临时文件路径用于清理</span>
            cachedOutputUriRef.<span class="hljs-property">current</span> = cachedOutputUri;
            lastOutputUriRef.<span class="hljs-property">current</span> = finalOutputUri;
            <span class="hljs-comment">/**
             * 创建进出路径，用于command命令拼接
             */</span>
            <span class="hljs-keyword">const</span> nativeInputPath = cachedInputUri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'file://'</span>) ? cachedInputUri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'file://'</span>, <span class="hljs-string">''</span>) : cachedInputUri;
            <span class="hljs-keyword">const</span> nativeOutputPath = cachedOutputUri.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'file://'</span>) ? cachedOutputUri.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'file://'</span>, <span class="hljs-string">''</span>) : cachedOutputUri;
            <span class="hljs-comment">/** 
             * 构建命令 暂不支持mp3，暂时使用m4a
             * 
             */</span>
            <span class="hljs-keyword">const</span> command = <span class="hljs-string">`-i "<span class="hljs-subst">${nativeInputPath}</span>" -vn -c:a aac -b:a 192k "<span class="hljs-subst">${nativeOutputPath}</span>"`</span>;
            <span class="hljs-comment">/**
             * 转换完成回调函数
             * 1.获取转换码
             * 2.检查转换是否成功
             * 3.如果成功，检查是否取消，取消不保存文件
             * 4.如果未取消，保存输出文件
             * 5.清理临时文件
             * 6.创建视频缩略图保存到cover目录中
             * 7.将歌曲信息和图片信息写入SQlite数据库表
             * <span class="hljs-doctag">@param</span> session FFmpegSession
             * <span class="hljs-doctag">@returns</span> 
             */</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">completeCallback</span>: <span class="hljs-title class_">FFmpegSessionCompleteCallback</span> = <span class="hljs-keyword">async</span> (<span class="hljs-attr">session</span>: <span class="hljs-title class_">FFmpegSession</span>) =&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 获取转换码</span>
                    <span class="hljs-keyword">const</span> returnCode = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">getReturnCode</span>();
                    <span class="hljs-comment">/**
                     * 检查是否成功
                     * 方法1：调用ReturnCode的成员方法isValueSuccess返回布尔值
                     * 方法2：调用ReturnCode的静态方法isSuccess传递ReturnCode对象实例然后返回
                     * 布尔值
                     * 成员方法getCode 返回ReturnCode对象实例的code属性值，0 是success 255 是cancel
                     */</span>
                    <span class="hljs-comment">/**方式1 调用成员方法检测 */</span>
                    <span class="hljs-keyword">const</span> success = returnCode.<span class="hljs-title function_">isValueSuccess</span>();
                    <span class="hljs-comment">/**方式2 调用成员方法getValue获取执行值，再调用静态方法isSuccess 检查是否成功 */</span>
                    <span class="hljs-comment">// success = ReturnCode.isSuccess(returnCode);</span>
                    <span class="hljs-keyword">if</span> (success) {
                        <span class="hljs-comment">// 如果转换已取消，则跳过保存</span>
                        <span class="hljs-keyword">if</span> (cancelledRef.<span class="hljs-property">current</span>) {
                            <span class="hljs-comment">// 即使取消也要清理临时文件</span>
                            <span class="hljs-keyword">try</span> {
                                <span class="hljs-keyword">if</span> (cachedInputUri) {
                                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedInputUri).<span class="hljs-title function_">delete</span>();
                                }
                            } <span class="hljs-keyword">catch</span> (error) {
                                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'清理输入缓存文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                            }
                            <span class="hljs-keyword">return</span>;
                        };
                        <span class="hljs-comment">// 检查输出文件是否存在且非空</span>
                        <span class="hljs-keyword">try</span> {
                            <span class="hljs-keyword">const</span> { exists } = <span class="hljs-title class_">Paths</span>.<span class="hljs-title function_">info</span>(cachedOutputUriRef.<span class="hljs-property">current</span>!);
                            <span class="hljs-keyword">if</span> (!exists) {
                                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'生成的音频文件为空或不存在'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                                <span class="hljs-keyword">return</span>;
                            };
                        } <span class="hljs-keyword">catch</span> (error) {
                            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'无法验证输出文件'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                            <span class="hljs-keyword">return</span>;
                        };
                        isSuccessRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">/**
                         * 转换失败后获取状态码解释原因
                         */</span>
                        <span class="hljs-keyword">const</span> returnCodeValue = returnCode.<span class="hljs-title function_">getValue</span>();
                        <span class="hljs-keyword">const</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = {
                            <span class="hljs-number">255</span>: <span class="hljs-string">'转换已取消'</span>,
                            <span class="hljs-number">1</span>: <span class="hljs-string">'输入文件不存在或无法读取'</span>,
                            <span class="hljs-number">2</span>: <span class="hljs-string">'输出路径无效或无写入权限'</span>,
                        }
                        <span class="hljs-keyword">let</span> errorMessage = config[returnCodeValue] ?? <span class="hljs-string">`转换失败 (错误码: <span class="hljs-subst">${returnCodeValue}</span>)`</span>;
                        <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: errorMessage, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                    }
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                } <span class="hljs-keyword">finally</span> {
                    cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">false</span>;
                    <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
                    <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (isSuccessRef.<span class="hljs-property">current</span>) {
                        <span class="hljs-title function_">setVisible</span>(<span class="hljs-literal">true</span>);
                    }
                }
            };
            <span class="hljs-comment">/**
             * 转换过程中日志处理,更新转换进度
             * 使用生产环境友好的日志回调
             * <span class="hljs-doctag">@param</span> log Log 日志对象
             */</span>
            <span class="hljs-comment">// 为了兼容现有的日志解析逻辑，保留原有的进度计算</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">legacyLogCallback</span>: <span class="hljs-title class_">LogCallback</span> = <span class="hljs-function">(<span class="hljs-params">log: Log</span>) =&gt;</span> {
                <span class="hljs-keyword">const</span> message = log.<span class="hljs-title function_">getMessage</span>();
                <span class="hljs-keyword">if</span> (message.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'time='</span>)) {
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">const</span> timeMatch = message.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/time=(\d+):(\d+):(\d+\.\d+)/</span>);
                        <span class="hljs-keyword">if</span> (timeMatch) {
                            <span class="hljs-keyword">const</span> hours = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">1</span>]);
                            <span class="hljs-keyword">const</span> minutes = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">2</span>]);
                            <span class="hljs-keyword">const</span> seconds = <span class="hljs-built_in">parseFloat</span>(timeMatch[<span class="hljs-number">3</span>]);
                            <span class="hljs-keyword">const</span> currentTimeInSeconds = hours * <span class="hljs-number">3600</span> + minutes * <span class="hljs-number">60</span> + seconds;
                            <span class="hljs-keyword">const</span> totalTimeInSeconds = (video &amp;&amp; (video.<span class="hljs-property">duration</span> ?? <span class="hljs-number">0</span>)) || <span class="hljs-number">120</span>;
                            <span class="hljs-keyword">const</span> calculatedProgress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(<span class="hljs-number">100</span>, (currentTimeInSeconds / totalTimeInSeconds) * <span class="hljs-number">100</span>);
                            <span class="hljs-title function_">setProgress</span>(calculatedProgress);
                        }
                    } <span class="hljs-keyword">catch</span> (error) {
                        <span class="hljs-keyword">if</span> (__DEV__) {
                            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'进度解析失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                        }
                    }
                }
            };
            <span class="hljs-comment">/** 开始转换 */</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">/**
                 * 存在如下方法
                 * FFmpegKit.execute(cmd): Promise&lt;FFmpegSession&gt;
                 * executeAsync(command: string, completeCallback?: FFmpegSessionCompleteCallback, logCallback?: LogCallback, statisticsCallback?: StatisticsCallback): Promise&lt;FFmpegSession&gt;
                 */</span>
                conversionSessionRef.<span class="hljs-property">current</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">FFmpegKit</span>.<span class="hljs-title function_">executeAsync</span>(command, completeCallback, legacyLogCallback);
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            }
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'转换过程中发生错误'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
        }
    };
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleConvertManage</span> = (<span class="hljs-params"/>) =&gt; {
        router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/ConvertManage'</span>);
    };
    <span class="hljs-comment">/**
     * 取消转换
     * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancel</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-comment">// 修改标记</span>
        cancelledRef.<span class="hljs-property">current</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">if</span> (!conversionSessionRef.<span class="hljs-property">current</span>) {
            <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">return</span>;
        };

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">/**
             * 优先尝试 session.cancel()
             */</span>
            <span class="hljs-keyword">await</span> conversionSessionRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">cancel</span>();
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-comment">/**
             * 调用cancel方法失败，尝试通过 sessionId 使用 FFmpegKit.cancel
             */</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> sessionId = conversionSessionRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">getSessionId</span>();
                <span class="hljs-keyword">await</span> <span class="hljs-title class_">FFmpegKit</span>.<span class="hljs-title function_">cancel</span>(sessionId)
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'已取消转换'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'success'</span> });
            } <span class="hljs-keyword">catch</span> (err) {
                <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'取消转换失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 清理状态</span>
            conversionSessionRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            <span class="hljs-title function_">setIsConverting</span>(<span class="hljs-literal">false</span>);
            <span class="hljs-title function_">setProgress</span>(<span class="hljs-number">0</span>);
            <span class="hljs-comment">// 删除临时输出文件，避免残留</span>
            <span class="hljs-keyword">if</span> (cachedOutputUriRef.<span class="hljs-property">current</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachedOutputUriRef.<span class="hljs-property">current</span>);
                    <span class="hljs-keyword">if</span> (file.<span class="hljs-property">exists</span>) {
                        file.<span class="hljs-title function_">delete</span>();
                    }
                } <span class="hljs-keyword">catch</span> (delErr) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'删除临时输出文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                }
                cachedOutputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">if</span> (lastOutputUriRef.<span class="hljs-property">current</span>) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">const</span> file = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(lastOutputUriRef.<span class="hljs-property">current</span>);
                    <span class="hljs-keyword">if</span> (file.<span class="hljs-property">exists</span>) {
                        file.<span class="hljs-title function_">delete</span>();
                    }
                } <span class="hljs-keyword">catch</span> (delErr) {
                    <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'删除临时输出文件失败'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
                }
                lastOutputUriRef.<span class="hljs-property">current</span> = <span class="hljs-literal">null</span>;
            }
        }
    };
    <span class="hljs-comment">/**
     * 确定修改信息
     * <span class="hljs-doctag">@param</span> info 
     * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleConfirm</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">info?: UpdateSongInfoConfig | <span class="hljs-built_in">boolean</span></span>) =&gt; {
        <span class="hljs-keyword">if</span> (!convertVideoRef.<span class="hljs-property">current</span> || <span class="hljs-keyword">typeof</span> info === <span class="hljs-string">'boolean'</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveConvertFile</span>(info)
            <span class="hljs-title function_">setVisible</span>(<span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">showNotification</span>({ <span class="hljs-attr">tip</span>: <span class="hljs-string">'更新文件信息失败，请检查文件权限'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'error'</span> });
        }
    };
    <span class="hljs-comment">/**
     * 取消修改 按默认名称保存
     * <span class="hljs-doctag">@returns</span> Promise&lt;void&gt;
     */</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCancelModify</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-keyword">await</span> <span class="hljs-title function_">saveConvertFile</span>();
    };
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemedView</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{[styles.container,</span> { <span class="hljs-attr">paddingTop:</span> <span class="hljs-attr">top</span>, <span class="hljs-attr">paddingBottom:</span> <span class="hljs-attr">bottom</span> + <span class="hljs-attr">10</span> }]}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">TitleBar</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.top}</span>
                <span class="hljs-attr">leftComponent</span>=<span class="hljs-string">{</span>
                    &lt;<span class="hljs-attr">Pressable</span>
                        <span class="hljs-attr">onPress</span>=<span class="hljs-string">{handleBack}</span>
                        <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.topLeft}</span>
                    &gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">Ionicons</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"chevron-back"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">{22}</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"#fff"</span> /&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">ThemedText</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.title}</span>&gt;</span>视频转歌<span class="hljs-tag">&lt;/<span class="hljs-name">ThemedText</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Pressable</span>&gt;</span>
                }
                rightComponent={
                    <span class="hljs-tag">&lt;<span class="hljs-name">ThemedText</span>
                        <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.title}</span>
                        <span class="hljs-attr">onPress</span>=<span class="hljs-string">{handleConvertManage}</span>
                    &gt;</span>
                        转换管理
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemedText</span>&gt;</span>
                }
            /&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">VideoList</span>
                <span class="hljs-attr">onPress</span>=<span class="hljs-string">{handleConvertVideo}</span>
            /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
                <span class="hljs-attr">visible</span>=<span class="hljs-string">{isConverting}</span>
                <span class="hljs-attr">transparent</span>
                <span class="hljs-attr">animationType</span>=<span class="hljs-string">"fade"</span>
            &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.modalContainer}</span>&gt;</span>
                    &lt; ProcessTip
                        progress={progress}
                        handleCancel={handleCancel}
                    /&gt;
                <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UpdateOrDeleteModal</span>
                <span class="hljs-attr">visible</span>=<span class="hljs-string">{visible}</span>
                <span class="hljs-attr">needDeleteFile</span>=<span class="hljs-string">{false}</span>
                <span class="hljs-attr">setVisible</span>=<span class="hljs-string">{()</span> =&gt;</span> setVisible(false)}
                onConfirm={handleConfirm}
                onCancel={handleCancelModify}
                modalType='rename'
                audio={convertVideoRef.current as VideoAsset}
                fileName={outFileNameRef.current as string}
            /&gt;</span>
        &lt;/<span class="hljs-title class_">ThemedView</span>&gt;
    );
};

<span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">container</span>: {
        <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    },
    <span class="hljs-attr">top</span>: {
        <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>,
    },
    <span class="hljs-attr">title</span>: {
        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>,
        <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
        <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'bold'</span>,
    },
    <span class="hljs-attr">topLeft</span>: {
        <span class="hljs-attr">flexDirection</span>: <span class="hljs-string">'row'</span>,
        <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    },
    <span class="hljs-attr">modalContainer</span>: {
        <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>,
        <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,
    },
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">FfmpegKitPage</span>;
</code></pre>
<p><strong>小结</strong></p>
<p>开始咱们说流程很清晰，关键在于获取要转换的文件转换文件和保存文件以及后续的修改，具体的细节其实还是比较多 的，但是代码没有什么高深的特技，就像这篇文件一样，平铺直叙。如果说有困难应该在FFmpegKit依赖库的文档方面，因为这个依赖库好像已经没人维护了，有些API我是看的node_modules里的TS类型定义和AI辅助编写的，刚开始即便借助AI也是囫囵吞枣，出现大量转换失败的情况，然后就是调试过程中产生大量缓存文件没有清理，后来打印输出缓存也是挺有美感</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f407f13af3624ed7a05e10244fddbf1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=zcYZHEzd4lPfaYK%2B9L%2F64XjjgcM%3D" alt="123.png" loading="lazy"/></p>
<p>文笔非常一般，但是也算干货满满，文笔不行图片来凑，而且今天我打包了APK安装到手机上，目前测很流畅，比开发构建版本的运行流畅，目前该应用只开发了android版本，ios没有设没有针对性处理调试，接下来再放一些其他模块图片，但是其他有技术难度的值得宣讲的不多，因为该应用没有配套后台，纯本地，就涉及到了数据存取问题，就是使用了Sqlite数据库，后面有时间考虑写一篇文章讲解项目中歌单存取处理，多个单切换设计，播放队列管理等，再放点图吧，上面细节不明白的有问题的欢迎留言探讨</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08e77e9191374c99839b3d0dfac5fbde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=j%2FjjbItUfnfBWhhf6RcQ%2FHRqrO0%3D" alt="微信图片_20260114172112_167_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/752e8189009f407a8f75f723612451fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=iADjmcL5rp%2BbUd%2BY%2FbKM7062w1I%3D" alt="微信图片_20260114172113_168_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634a2db8924f4171ac851751d4fdcbe5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=lfc5Mcj%2FI%2FupulfRXCYvA0KlR24%3D" alt="微信图片_20260114172114_169_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bf101db37f7432e95c74879ef4f0744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=TKEj6Si0VFZ82b8MuQmCBGIKTTk%3D" alt="微信图片_20260114172115_170_23.jpg" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8579af878f8f49da8908a9d597f5977b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VyZTI4Mg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990265&amp;x-signature=uy8ZrwPtbss35ebAL2D8XQf548M%3D" alt="微信图片_20260114172116_171_23.jpg" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端项目缓存控制与自动版本检查方案实现]]></title>    <link>https://juejin.cn/post/7595043440519479302</link>    <guid>https://juejin.cn/post/7595043440519479302</guid>    <pubDate>2026-01-14T10:18:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595043440519479302" data-draft-id="7595043440519446534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端项目缓存控制与自动版本检查方案实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T10:18:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TakeItEasy"/> <meta itemprop="url" content="https://juejin.cn/user/2181053384767518"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端项目缓存控制与自动版本检查方案实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2181053384767518/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TakeItEasy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:18:27.000Z" title="Wed Jan 14 2026 10:18:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端项目缓存控制与自动版本检查方案实现</h2>
<p>在前端项目部署迭代过程中，浏览器缓存常常导致用户无法及时获取最新版本资源，出现页面错乱、功能异常等问题。本文将分享一套“全方位缓存控制 + 自动版本检查”的完整解决方案，通过 HTML 配置、Vite 构建优化、版本文件生成及定时检查机制，彻底解决缓存困扰，提升用户体验。</p>
<h3 data-id="heading-1">一、方案核心思路</h3>
<p>本方案从“主动禁止缓存”和“被动版本校验”两个维度保障资源新鲜度：</p>
<ol>
<li>通过 HTML 元标签和 Vite 构建配置，从源头控制浏览器缓存策略；</li>
<li>构建时自动生成版本信息文件，前端项目启动后定时检查版本差异；</li>
<li>检测到新版本时主动提示用户更新，确保用户使用最新功能。</li>
</ol>
<h3 data-id="heading-2">二、第一步：全方位缓存控制配置</h3>
<p>缓存控制需兼顾页面本身和静态资源（JS、CSS、图片等），需分别在 HTML 页面和 Vite 配置中进行设置。</p>
<h4 data-id="heading-3">2.1 HTML 页面级缓存控制</h4>
<p>在 index.html 的 head 标签中添加缓存控制元标签，告知浏览器不缓存当前页面，同时强制验证后续资源有效性。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"pragma"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"no-cache"</span>&amp;<span class="hljs-attr">gt</span>; &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">禁止浏览器缓存</span> <span class="hljs-attr">--</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Cache-Control"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"no-cache, must-revalidate"</span>&amp;<span class="hljs-attr">gt</span>; &lt;!<span class="hljs-attr">--</span> <span class="hljs-attr">禁止浏览器缓存</span> <span class="hljs-attr">--</span>&gt;</span>
  <span class="hljs-symbol">&amp;lt;</span>meta http-equiv="expires" content="0"<span class="hljs-symbol">&amp;gt;</span> <span class="hljs-comment">&lt;!-- 禁止浏览器缓存 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>页面标题<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 页面内容 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>说明：HTML 元标签仅对当前页面生效，无法控制页面引入的静态资源缓存，需配合 Vite 构建配置实现全链路缓存控制。</p>
<h4 data-id="heading-4">2.2 Vite 构建级缓存优化</h4>
<p>通过 Vite 配置实现两点核心优化：一是为静态资源添加哈希命名（内容变更时哈希自动更新），二是为开发/生产环境的资源响应头设置缓存禁止策略。</p>
<pre><code class="hljs language-php" lang="php">import { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
import { generateVersionFile } <span class="hljs-keyword">from</span> <span class="hljs-string">"./scripts/generateVersionFile"</span>; 

<span class="hljs-comment">// 引入版本文件生成插件</span>
<span class="hljs-title function_ invoke__">generateVersionFile</span>()

export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>({
  // 构建配置：通过文件名哈希和资源响应头强化缓存控制
  <span class="hljs-attr">build</span>: {
    // 为静态资源文件名添加哈希值，避免资源缓存（文件内容变化时哈希值改变，触发重新加载）
    <span class="hljs-attr">assetsDir</span>: <span class="hljs-string">'assets'</span>,
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">output</span>: {
        // 配置静态资源（JS、CSS、图片等）的文件名格式：[name]-[hash].[ext]
        <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">'[name]-[hash].[ext]'</span>,
        <span class="hljs-attr">chunkFileNames</span>: <span class="hljs-string">'chunks/[name]-[hash].js'</span>,
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'entry/[name]-[hash].js'</span>,
      },
    },
  },
  // 开发服务器配置（本地开发时的缓存控制）
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">headers</span>: {
      // 禁止服务器返回的资源被缓存
      <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache, no-store, must-revalidate'</span>,
      <span class="hljs-string">'Pragma'</span>: <span class="hljs-string">'no-cache'</span>,
      <span class="hljs-string">'Expires'</span>: <span class="hljs-string">'0'</span>,
    },
  },
  // 生产环境静态资源服务配置（若使用 Vite 预览生产包）
  <span class="hljs-attr">preview</span>: {
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache, no-store, must-revalidate'</span>,
      <span class="hljs-string">'Pragma'</span>: <span class="hljs-string">'no-cache'</span>,
      <span class="hljs-string">'Expires'</span>: <span class="hljs-string">'0'</span>,
    },
  },
});
</code></pre>
<p>关键说明：静态资源的哈希命名是核心，当文件内容发生变更时，构建后的文件名会随之改变，浏览器会将其识别为新资源并重新请求，从根本上解决静态资源缓存问题。</p>
<h3 data-id="heading-5">三、第二步：自动版本检查机制实现</h3>
<p>通过编写脚本生成版本信息文件，并在前端项目中实现定时版本检查逻辑，当检测到新版本时提示用户刷新页面更新资源。</p>
<h4 data-id="heading-6">3.1 版本信息生成脚本</h4>
<p>编写两个核心脚本：generateVersionInfo.ts（生成版本信息）和 generateVersionFile.ts（Vite 插件，打包时生成版本文件）。</p>
<h5 data-id="heading-7">3.1.1 生成版本信息（generateVersionInfo.ts）</h5>
<p>从 package.json 中读取项目版本号，结合构建时间生成版本信息对象。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { readFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { cwd } <span class="hljs-keyword">from</span> <span class="hljs-string">"process"</span>;

<span class="hljs-comment">/**
 * 生成版本信息
 * <span class="hljs-doctag">@returns</span> 版本信息对象，包含 version、buildTime、timestamp，失败时返回 null
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateVersionInfo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 读取 package.json 获取版本号（从项目根目录）</span>
    <span class="hljs-keyword">const</span> packageJsonPath = <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">"package.json"</span>);
    <span class="hljs-keyword">const</span> packageJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title function_">readFileSync</span>(packageJsonPath, <span class="hljs-string">"utf-8"</span>));
    <span class="hljs-keyword">const</span> version = packageJson.<span class="hljs-property">version</span> || <span class="hljs-string">"1.0.0"</span>;
    <span class="hljs-keyword">const</span> buildTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">"T"</span>, <span class="hljs-string">" "</span>).<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">19</span>);

    <span class="hljs-comment">// 生成版本信息对象</span>
    <span class="hljs-keyword">return</span> {
      version,
      buildTime,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
    };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"❌ 读取版本信息失败:"</span>, error);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<h5 data-id="heading-8">3.1.2 生成版本文件（generateVersionFile.ts）</h5>
<p>实现 Vite 插件，在打包结束时将版本信息写入 dist 目录的 version.json 文件，供前端项目请求校验。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { writeFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"fs"</span>;
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">"path"</span>;
<span class="hljs-keyword">import</span> { cwd } <span class="hljs-keyword">from</span> <span class="hljs-string">"process"</span>;
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">Plugin</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> { generateVersionInfo } <span class="hljs-keyword">from</span> <span class="hljs-string">"./generateVersionInfo"</span>;

<span class="hljs-comment">/**
 * 生成版本号文件的 Vite 插件
 * - 打包时在 dist 目录生成 version.json
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateVersionFile</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"generate-version-file"</span>,
    <span class="hljs-comment">// 打包时生成版本文件到 dist 目录</span>
    <span class="hljs-title function_">closeBundle</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> versionInfo = <span class="hljs-title function_">generateVersionInfo</span>();
        <span class="hljs-keyword">if</span> (versionInfo) {
          <span class="hljs-keyword">const</span> versionJson = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(versionInfo, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);

          <span class="hljs-comment">// 写入版本号文件到 dist 目录（打包后的根目录）</span>
          <span class="hljs-keyword">const</span> distPath = <span class="hljs-title function_">resolve</span>(<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">"dist/version.json"</span>);
          <span class="hljs-title function_">writeFileSync</span>(distPath, versionJson, <span class="hljs-string">"utf-8"</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 版本号文件已生成，版本号: <span class="hljs-subst">${versionInfo.version}</span>，构建时间: <span class="hljs-subst">${versionInfo.buildTime}</span>`</span>);
        }
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"❌ 生成版本号文件失败:"</span>, error);
      }
    }
  };
}
</code></pre>
<h4 data-id="heading-9">3.2 前端版本检查逻辑（App.vue）</h4>
<p>在 Vue 根组件中实现版本检查核心逻辑：页面挂载后立即检查版本，之后每隔 24 小时定时检查，检测到新版本时通过弹窗提示用户更新。</p>
<h5 data-id="heading-10">3.2.1 代码核心逻辑拆解</h5>
<p>App.vue 中的版本检查代码可分为「核心配置定义」「核心功能函数」「生命周期钩子绑定」三个核心部分，各部分职责清晰、耦合度低，便于维护和扩展：</p>
<h6 data-id="heading-11">1. 核心配置常量定义</h6>
<p>定义版本检查相关的固定配置，集中管理关键参数，后续需调整时可直接修改此处，无需改动核心逻辑：</p>
<ul>
<li><code>VERSION_STORAGE_KEY</code>：本地存储版本号的键名，用于将当前版本号持久化到 localStorage，避免页面刷新后丢失版本信息；</li>
<li><code>VERSION_CHECK_INTERVAL</code>：版本检查时间间隔，此处设置为 24 小时（单位：毫秒），可根据项目迭代频率灵活调整；</li>
<li><code>versionCheckTimer</code>：定时检查计时器的引用，用于在组件卸载时清理计时器，避免内存泄漏。</li>
</ul>
<h6 data-id="heading-12">2. 核心功能函数实现</h6>
<p>包含 3 个核心函数，分别负责版本检查、启动检查流程、清理检查资源，单一函数只做单一职责：</p>
<ul>
<li><code>checkVersionUpdate</code>（核心版本检查函数）： - 环境判断：开发环境直接跳过检查，避免开发过程中频繁触发版本校验； - 路径适配：动态构建 version.json 的请求路径，适配不同部署目录（如根目录、子目录部署），提升通用性； - 缓存禁用：请求版本文件时通过 headers 和 cache 配置禁用缓存，确保获取的是最新版本文件； - 异常处理：对网络错误、文件不存在、数据格式错误等场景做静默处理，不阻塞应用正常运行； - 版本对比：从 localStorage 读取历史版本号，与最新版本号对比，首次访问时直接保存版本号，检测到新版本时提示用户更新并刷新页面。</li>
<li><code>startVersionCheck</code>（启动版本检查函数）： - 立即执行一次版本检查，确保用户进入页面后能第一时间获取版本状态； - 启动定时检查计时器，按照设定的时间间隔重复执行版本检查。</li>
<li><code>stopVersionCheck</code>（停止版本检查函数）： - 清理定时检查计时器，避免组件卸载后计时器仍在运行导致内存泄漏，符合 Vue 组件的资源管理规范。</li>
</ul>
<h6 data-id="heading-13">3. 生命周期钩子绑定</h6>
<p>结合 Vue 组件生命周期，实现版本检查流程的自动启动和资源清理：</p>
<ul>
<li><code>onMounted</code>：组件挂载完成后调用 <code>startVersionCheck</code>，启动版本检查流程，确保组件渲染完成后再执行异步请求相关逻辑；</li>
<li><code>onBeforeUnmount</code>：组件卸载前调用 <code>stopVersionCheck</code>，清理计时器资源，避免内存泄漏。</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref, onMounted, onBeforeUnmount } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessageBox</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"element-plus"</span>;

<span class="hljs-comment">/** 版本检查相关配置 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VERSION_STORAGE_KEY</span> = <span class="hljs-string">"app_version"</span>; <span class="hljs-comment">// 本地存储版本号的 key</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">VERSION_CHECK_INTERVAL</span> = <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">// 版本检查间隔（24小时）</span>
<span class="hljs-keyword">const</span> versionCheckTimer = ref&lt;<span class="hljs-title class_">NodeJS</span>.<span class="hljs-property">Timeout</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>); <span class="hljs-comment">// 定时检查计时器</span>

<span class="hljs-comment">/**
 * 检查版本更新
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">checkVersionUpdate</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 开发环境不进行版本检查</span>
    <span class="hljs-comment">// @ts-ignore - Vite 内置环境变量</span>
    <span class="hljs-keyword">const</span> isDev = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span> === <span class="hljs-string">"development"</span>;
    <span class="hljs-keyword">if</span> (isDev) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 构建版本文件路径，适配不同部署目录（获取 index.html 所在目录）</span>
    <span class="hljs-keyword">const</span> currentPath = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>;
    <span class="hljs-keyword">const</span> lastSlashIndex = currentPath.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">"/"</span>);
    <span class="hljs-keyword">const</span> directoryPath = lastSlashIndex &gt;= <span class="hljs-number">0</span> ? currentPath.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, lastSlashIndex + <span class="hljs-number">1</span>) : <span class="hljs-string">"/"</span>;
    <span class="hljs-keyword">const</span> versionUrl = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.location.origin}</span><span class="hljs-subst">${directoryPath}</span>version.json?t=<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>;

    <span class="hljs-comment">// 请求版本文件（禁用缓存，确保获取最新版本）</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(versionUrl, {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Cache-Control"</span>: <span class="hljs-string">"no-cache"</span>,
        <span class="hljs-title class_">Pragma</span>: <span class="hljs-string">"no-cache"</span>
      },
      <span class="hljs-attr">cache</span>: <span class="hljs-string">"no-store"</span>
    });

    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"版本文件不存在或网络错误，跳过版本检查"</span>, response.<span class="hljs-property">status</span>);
      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">404</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"版本文件不存在，跳过版本检查"</span>);
      }
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> versionData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

    <span class="hljs-comment">// 验证返回数据格式</span>
    <span class="hljs-keyword">if</span> (!versionData || !versionData.<span class="hljs-property">version</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"版本文件格式错误，跳过版本检查"</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">const</span> currentVersion = versionData.<span class="hljs-property">version</span>;
    <span class="hljs-keyword">const</span> storedVersion = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-variable constant_">VERSION_STORAGE_KEY</span>);

    <span class="hljs-comment">// 首次访问，保存版本号到本地存储</span>
    <span class="hljs-keyword">if</span> (!storedVersion) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"首次访问，保存版本号"</span>, currentVersion);
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">VERSION_STORAGE_KEY</span>, currentVersion);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 检测到新版本：更新本地版本号并提示用户</span>
    <span class="hljs-keyword">if</span> (currentVersion !== storedVersion) {
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-variable constant_">VERSION_STORAGE_KEY</span>, currentVersion);
      <span class="hljs-title class_">ElMessageBox</span>.<span class="hljs-title function_">confirm</span>(
        <span class="hljs-string">`检测到新版本（<span class="hljs-subst">${currentVersion}</span>），是否立即更新？`</span>, 
        <span class="hljs-string">"版本更新提示"</span>, 
        {
          <span class="hljs-attr">confirmButtonText</span>: <span class="hljs-string">"立即更新"</span>,
          <span class="hljs-attr">cancelButtonText</span>: <span class="hljs-string">"稍后更新"</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">"info"</span>,
          <span class="hljs-attr">customClass</span>: <span class="hljs-string">"custom-el-message"</span>
        }
      ).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>(); <span class="hljs-comment">// 刷新页面加载最新资源</span>
      });
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前版本与最新版本一致，跳过版本检查"</span>);
    }
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 静默处理错误，不阻塞应用运行</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"版本检查失败："</span>, error);
  }
};

<span class="hljs-comment">/**
 * 启动版本检查（立即检查 + 定时检查）
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startVersionCheck</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">checkVersionUpdate</span>(); <span class="hljs-comment">// 页面挂载后立即检查一次</span>
  <span class="hljs-comment">// 设置定时检查</span>
  versionCheckTimer.<span class="hljs-property">value</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">checkVersionUpdate</span>();
  }, <span class="hljs-variable constant_">VERSION_CHECK_INTERVAL</span>);
};

<span class="hljs-comment">/**
 * 清理版本检查定时器（组件卸载时）
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">stopVersionCheck</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (versionCheckTimer.<span class="hljs-property">value</span>) {
    <span class="hljs-built_in">clearInterval</span>(versionCheckTimer.<span class="hljs-property">value</span>);
    versionCheckTimer.<span class="hljs-property">value</span> = <span class="hljs-literal">null</span>;
  }
};

<span class="hljs-comment">// 组件生命周期钩子</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">startVersionCheck</span>();
});

<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">stopVersionCheck</span>();
});
</code></pre>
<h3 data-id="heading-14">三、方案优势与注意事项</h3>
<h4 data-id="heading-15">3.1 核心优势</h4>
<ul>
<li>全链路缓存控制：覆盖页面、静态资源、接口请求三个层面，彻底杜绝缓存残留；</li>
<li>自动化程度高：版本文件自动生成，版本检查自动触发，无需人工干预；</li>
<li>用户体验友好：新版本静默检测，仅在有更新时提示，不干扰正常使用；</li>
<li>适配多环境：开发环境跳过检查，生产环境精准控制，兼顾开发与部署效率。</li>
</ul>
<h4 data-id="heading-16">3.2 注意事项</h4>
<ul>
<li>版本号管理：需在 package.json 中规范管理版本号（如遵循语义化版本），确保版本变更可追溯；</li>
<li>部署适配：version.json 文件需与 index.html 同级部署，确保前端能正确请求到；</li>
<li>错误兼容：版本检查逻辑添加了完善的错误捕获，避免因网络问题或文件缺失导致应用崩溃；</li>
<li>间隔配置：可根据项目迭代频率调整 VERSION_CHECK_INTERVAL（如迭代频繁可改为 12 小时）。</li>
</ul>
<h3 data-id="heading-17">四、总结</h3>
<p>本文提出的“缓存控制 + 版本检查”方案，通过 HTML 元标签、Vite 构建配置、版本文件生成脚本和前端定时检查逻辑的协同工作，完美解决了前端项目部署后的缓存问题。该方案实现简单、通用性强，可直接适配 Vue + Vite 技术栈的各类项目，也可稍作修改移植到其他前端框架中，为用户提供稳定、新鲜的应用体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vibe Coding指南]]></title>    <link>https://juejin.cn/post/7594832320030244907</link>    <guid>https://juejin.cn/post/7594832320030244907</guid>    <pubDate>2026-01-14T10:17:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594832320030244907" data-draft-id="7594854295759077419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vibe Coding指南"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2026-01-14T10:17:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gaaraa"/> <meta itemprop="url" content="https://juejin.cn/user/35624744391213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vibe Coding指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/35624744391213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gaaraa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:17:42.000Z" title="Wed Jan 14 2026 10:17:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vibe Coding 指南</h2>
<blockquote>
<p>与 AI 协作的现代编程范式</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-vibe-coding" title="#%E4%BB%80%E4%B9%88%E6%98%AF-vibe-coding">什么是 Vibe Coding？</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E7%90%86%E5%BF%B5" title="#%E6%A0%B8%E5%BF%83%E7%90%86%E5%BF%B5">核心理念</a></li>
<li><a href="#%E5%AE%8C%E7%BE%8E%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E5%85%AD%E5%A4%A7%E8%A6%81%E7%B4%A0" title="#%E5%AE%8C%E7%BE%8E%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%9A%84%E5%85%AD%E5%A4%A7%E8%A6%81%E7%B4%A0">完美提示词的六大要素</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7" title="#%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7">高级技巧</a></li>
<li><a href="#%E4%B8%89%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F" title="#%E4%B8%89%E7%A7%8D%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F">三种工作模式</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%E4%B8%8E%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97" title="#%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%E4%B8%8E%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97">常见陷阱与避坑指南</a></li>
<li><a href="#%E9%BB%84%E9%87%91%E5%85%AC%E5%BC%8F" title="#%E9%BB%84%E9%87%91%E5%85%AC%E5%BC%8F">黄金公式</a></li>
<li><a href="#%E8%BF%9B%E9%98%B6%E5%BF%83%E6%B3%95" title="#%E8%BF%9B%E9%98%B6%E5%BF%83%E6%B3%95">进阶心法</a></li>
<li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B" title="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B">实战案例</a></li>
<li><a href="#%E6%80%A7%E8%83%BD%E4%B8%8E%E6%88%90%E6%9C%AC%E4%BC%98%E5%8C%96" title="#%E6%80%A7%E8%83%BD%E4%B8%8E%E6%88%90%E6%9C%AC%E4%BC%98%E5%8C%96">性能与成本优化</a></li>
<li><a href="#%E9%99%84%E5%BD%95" title="#%E9%99%84%E5%BD%95">附录</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">什么是 Vibe Coding？</h3>
<p><strong>Vibe Coding</strong> 是一种全新的编程范式，它改变了我们与代码交互的方式。</p>
<h4 data-id="heading-3">传统编程 vs Vibe Coding</h4>



































<table><thead><tr><th>维度</th><th>传统编程</th><th>Vibe Coding</th></tr></thead><tbody><tr><td><strong>工作方式</strong></td><td>手写每一行代码</td><td>描述意图，AI 生成代码</td></tr><tr><td><strong>关注点</strong></td><td>如何实现（How）</td><td>要实现什么（What）</td></tr><tr><td><strong>开发流程</strong></td><td>编码 → 调试 → 优化</td><td>描述 → 审查 → 迭代</td></tr><tr><td><strong>技能要求</strong></td><td>精通语法和 API</td><td>清晰表达 + 代码审查</td></tr><tr><td><strong>效率提升</strong></td><td>线性增长</td><td>指数级增长</td></tr></tbody></table>
<h4 data-id="heading-4">核心价值</h4>
<p><strong>Vibe Coding 不是让 AI 替你写代码，而是让 AI 成为你的编程伙伴</strong>：</p>
<ul>
<li><strong>你负责</strong>：架构设计、业务逻辑、质量把控</li>
<li><strong>AI 负责</strong>：代码生成、重复劳动、方案探索</li>
<li><strong>共同完成</strong>：快速迭代、持续优化、创造价值</li>
</ul>
<hr/>
<h3 data-id="heading-5">核心理念</h3>
<h4 data-id="heading-6">1. Think in Outcomes, Not Implementation</h4>
<p><strong>关注结果，而非实现细节</strong></p>
<pre><code class="hljs language-ini" lang="ini">❌ 传统思维：
"帮我写一个 for 循环，遍历 users 数组，判断 <span class="hljs-attr">status</span> === <span class="hljs-string">'active'</span>，
然后 push 到新数组，最后 map 提取 name 和 email"

✅ Vibe Coding 思维：
"从 users 中筛选出所有活跃用户，返回他们的姓名和邮箱"
</code></pre>
<p><strong>为什么这样更好？</strong></p>
<ul>
<li>AI 可能使用更优雅的 <code>filter</code> + <code>map</code> 组合</li>
<li>AI 可能考虑到性能优化（如使用 <code>reduce</code> 一次遍历）</li>
<li>AI 可能添加类型安全和错误处理</li>
</ul>
<h4 data-id="heading-7">2. Iterate, Don't Perfect</h4>
<p><strong>快速迭代，而非追求一次完美</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">第<span class="hljs-number">1</span>轮：实现基础功能（能用）
  <span class="hljs-string">"实现用户登录功能，支持手机号+验证码"</span>

第<span class="hljs-number">2</span>轮：优化用户体验（好用）
  <span class="hljs-string">"添加验证码倒计时、输入框自动聚焦、错误提示"</span>

第<span class="hljs-number">3</span>轮：性能优化（快用）
  <span class="hljs-string">"优化登录接口调用，添加请求缓存和防抖"</span>

第<span class="hljs-number">4</span>轮：完善细节（爱用）
  <span class="hljs-string">"添加登录动画、记住登录状态、支持生物识别"</span>
</code></pre>
<h4 data-id="heading-8">3. Context is King</h4>
<p><strong>上下文决定代码质量</strong></p>
<p>AI 需要了解你的"世界观"：</p>
<ul>
<li><strong>技术栈</strong>：Vue 3 + TypeScript + Pinia</li>
<li><strong>项目结构</strong>：页面、组件、API、Store 的组织方式</li>
<li><strong>编码规范</strong>：命名规则、代码风格、注释要求</li>
<li><strong>业务逻辑</strong>：用户角色、权限系统、业务流程</li>
</ul>
<p><strong>提供上下文的方式</strong>：</p>
<ul>
<li>使用 <code>@文件名</code> 引用相关文件</li>
<li>在 <code>.cursorrules</code> 中定义项目规范</li>
<li>在提示词中说明技术约束</li>
<li>提供参考示例或类似功能</li>
</ul>
<hr/>
<h3 data-id="heading-9">完美提示词的六大要素</h3>
<h4 data-id="heading-10">1. 明确的目标 (What)</h4>
<p><strong>说清楚要做什么</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">✅ 好的目标：
<span class="hljs-string">"实现用户登录功能，支持手机号+验证码和账号+密码两种方式"</span>

❌ 模糊的目标：
<span class="hljs-string">"做个登录"</span>
</code></pre>
<h4 data-id="heading-11">2. 清晰的上下文 (Where &amp; Why)</h4>
<p><strong>说明在哪里做，为什么做</strong></p>
<pre><code class="hljs language-perl" lang="perl">✅ 好的上下文：
<span class="hljs-string">"在 @src/pages/login/index.vue 中实现，
因为现有的登录只支持账号密码，
产品要求增加验证码登录方式以提升用户体验"</span>

❌ 缺少上下文：
<span class="hljs-string">"加个验证码登录"</span>
</code></pre>
<h4 data-id="heading-12">3. 技术约束 (How)</h4>
<p><strong>说明使用什么技术，如何实现</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">✅ 好的技术约束：
<span class="hljs-string">"使用 Vue 3 Composition API + TypeScript，
调用 POST /api/v1/auth/login 接口，
验证码倒计时 60 秒，使用 uni.request 发送请求"</span>

❌ 缺少技术约束：
<span class="hljs-string">"用 Vue 做"</span>
</code></pre>
<h4 data-id="heading-13">4. 边界条件 (Constraints)</h4>
<p><strong>说明不能做什么，有什么限制</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">✅ 好的边界条件：
<span class="hljs-string">"不要修改现有的账号密码登录逻辑，
验证码输入框只允许数字，
发送验证码前要校验手机号格式（11位数字），
同一手机号 60 秒内只能发送一次验证码"</span>

❌ 没有边界条件：
（任何约束都没有提）
</code></pre>
<h4 data-id="heading-14">5. 预期结果 (Success Criteria)</h4>
<p><strong>说明完成后应该是什么样子</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">✅ 好的预期结果：
"完成后应该能够：
<span class="hljs-bullet">1.</span> 输入手机号，点击发送验证码
<span class="hljs-bullet">2.</span> 60秒倒计时，期间按钮禁用显示剩余秒数
<span class="hljs-bullet">3.</span> 输入6位数字验证码
<span class="hljs-bullet">4.</span> 点击登录按钮，显示加载状态
<span class="hljs-bullet">5.</span> 登录成功后保存 token 并跳转到首页
<span class="hljs-bullet">6.</span> 登录失败显示错误提示"

❌ 没有验收标准：
（不知道怎么算完成）
</code></pre>
<h4 data-id="heading-15">6. 示例或参考 (Examples)</h4>
<p><strong>提供参考实现或设计稿</strong></p>
<pre><code class="hljs language-perl" lang="perl">✅ 好的参考：
<span class="hljs-string">"参考 @src/pages/login/password.vue 的样式和布局，
验证码输入框类似支付宝的 6 位数字输入（每位一个框），
整体风格保持与现有登录页一致"</span>

❌ 没有参考：
（AI 只能猜测你想要什么样式）
</code></pre>
<hr/>
<h3 data-id="heading-16">高级技巧</h3>
<h4 data-id="heading-17">技巧 1：分层提示（Layer Prompting）</h4>
<p><strong>不要一次性要求所有细节，而是分层递进</strong></p>
<h5 data-id="heading-18">第1层：架构层</h5>
<pre><code class="hljs language-diff" lang="diff">"设计一个用户认证系统，包含以下功能：
<span class="hljs-deletion">- 登录（手机号+验证码、账号+密码）</span>
<span class="hljs-deletion">- 注册（手机号+验证码）</span>
<span class="hljs-deletion">- 找回密码</span>
<span class="hljs-deletion">- 修改密码</span>
请给出整体架构设计和文件组织结构"
</code></pre>
<h5 data-id="heading-19">第2层：功能层</h5>
<pre><code class="hljs language-diff" lang="diff">"先实现登录功能，支持手机号+验证码和账号+密码两种方式，
包括：
<span class="hljs-deletion">- 登录页面 UI</span>
<span class="hljs-deletion">- 表单验证</span>
<span class="hljs-deletion">- API 调用</span>
<span class="hljs-deletion">- Token 存储</span>
<span class="hljs-deletion">- 路由跳转"</span>
</code></pre>
<h5 data-id="heading-20">第3层：实现层</h5>
<pre><code class="hljs language-markdown" lang="markdown">"实现手机号+验证码登录，具体包括：
<span class="hljs-bullet">1.</span> 手机号输入框（带格式校验）
<span class="hljs-bullet">2.</span> 发送验证码按钮（带倒计时）
<span class="hljs-bullet">3.</span> 验证码输入框（6位数字）
<span class="hljs-bullet">4.</span> 登录按钮（带加载状态）
<span class="hljs-bullet">5.</span> 错误提示"
</code></pre>
<h5 data-id="heading-21">第4层：细节层</h5>
<pre><code class="hljs language-diff" lang="diff">"优化验证码输入体验：
<span class="hljs-deletion">- 自动聚焦到第一个输入框</span>
<span class="hljs-deletion">- 输入一位后自动跳到下一位</span>
<span class="hljs-deletion">- 支持粘贴6位验证码自动填充</span>
<span class="hljs-deletion">- 输入完成后自动触发登录</span>
<span class="hljs-deletion">- 支持删除时自动回到上一位"</span>
</code></pre>
<h4 data-id="heading-22">技巧 2：对话式调试（Conversational Debugging）</h4>
<p><strong>把 AI 当作结对编程的伙伴</strong></p>
<pre><code class="hljs language-perl" lang="perl">你：<span class="hljs-string">"这个登录功能有问题，点击按钮没反应"</span>

AI：<span class="hljs-string">"让我检查一下... 发现 handleLogin 方法没有绑定到按钮的 @click 事件"</span>

你：<span class="hljs-string">"修复后还是不行，控制台报错 'token is undefined'"</span>

AI：<span class="hljs-string">"看起来 API 返回的数据结构不对，让我检查 @src/api/auth.ts...
    发现接口返回的是 data.access_token，但代码中用的是 data.token"</span>

你：<span class="hljs-string">"对，后端改了字段名，同步更新一下类型定义和 mock 数据"</span>

AI：<span class="hljs-string">"已更新 @src/types/auth.ts 中的 ILoginResponse 接口，
    同时更新了 @src/mock/data/auth.ts 中的 mock 数据"</span>
</code></pre>
<h4 data-id="heading-23">技巧 3：模板化常见任务（Template Prompts）</h4>
<p><strong>为重复性任务创建提示词模板</strong></p>
<h5 data-id="heading-24">模板 1：创建 CRUD 页面</h5>
<pre><code class="hljs language-diff" lang="diff">创建 [资源名称] 的 CRUD 页面：

文件结构：
<span class="hljs-deletion">- 列表页：@src/pages/[资源]/list.vue</span>
<span class="hljs-deletion">- 详情页：@src/pages/[资源]/detail.vue</span>
<span class="hljs-deletion">- 编辑页：@src/pages/[资源]/edit.vue</span>
<span class="hljs-deletion">- API：@src/api/[资源].ts</span>
<span class="hljs-deletion">- 类型：@src/types/[资源].ts</span>
<span class="hljs-deletion">- Store：@src/stores/use[资源]Store.ts</span>

列表页功能：
<span class="hljs-deletion">- 搜索栏（[字段1]、[字段2]）</span>
<span class="hljs-deletion">- 数据表格（[列1]、[列2]、操作列）</span>
<span class="hljs-deletion">- 分页组件</span>
<span class="hljs-deletion">- 新增按钮</span>

详情页功能：
<span class="hljs-deletion">- 展示所有字段</span>
<span class="hljs-deletion">- 编辑按钮</span>
<span class="hljs-deletion">- 删除按钮</span>

编辑页功能：
<span class="hljs-deletion">- 表单（所有可编辑字段）</span>
<span class="hljs-deletion">- 表单验证</span>
<span class="hljs-deletion">- 保存按钮</span>
<span class="hljs-deletion">- 取消按钮</span>

使用项目规范，参考 @src/pages/user 的实现
</code></pre>
<h5 data-id="heading-25">模板 2：创建业务组件</h5>
<pre><code class="hljs language-ini" lang="ini">创建 <span class="hljs-section">[组件名称]</span> 组件：

文件位置：@src/components/<span class="hljs-section">[组件名称]</span>/index.vue

Props：
- <span class="hljs-section">[prop1]</span> (类型): 描述
- <span class="hljs-section">[prop2]</span> (类型): 描述

Emits：
- <span class="hljs-section">[event1]</span>: 描述
- <span class="hljs-section">[event2]</span>: 描述

功能：
1. <span class="hljs-section">[功能1描述]</span>
2. <span class="hljs-section">[功能2描述]</span>

样式要求：
- <span class="hljs-section">[样式要求1]</span>
- <span class="hljs-section">[样式要求2]</span>

参考：@src/components/<span class="hljs-section">[类似组件]</span>
</code></pre>
<h5 data-id="heading-26">模板 3：API 接口对接</h5>
<pre><code class="hljs language-ini" lang="ini">对接 <span class="hljs-section">[接口名称]</span> 接口：

接口信息：
- 路径：<span class="hljs-section">[METHOD]</span> /api/v1/<span class="hljs-section">[path]</span>
- 描述：<span class="hljs-section">[接口功能描述]</span>

请求参数：
- <span class="hljs-section">[param1]</span> (类型, 必填/可选): 描述
- <span class="hljs-section">[param2]</span> (类型, 必填/可选): 描述

返回数据：
- <span class="hljs-section">[field1]</span> (类型): 描述
- <span class="hljs-section">[field2]</span> (类型): 描述

需要：
1. 在 @src/api/<span class="hljs-section">[模块]</span>.ts 中添加接口方法
2. 在 @src/types/<span class="hljs-section">[模块]</span>.ts 中定义类型
3. 在 @src/mock/handlers.ts 中添加 mock
4. 在 <span class="hljs-section">[调用位置]</span> 中调用接口
</code></pre>
<h4 data-id="heading-27">技巧 4：增量式重构（Incremental Refactoring）</h4>
<p><strong>不要一次性重构整个文件，而是逐步优化</strong></p>
<pre><code class="hljs language-perl" lang="perl">第<span class="hljs-number">1</span>步：<span class="hljs-string">"提取 @src/pages/user/list.vue 中的搜索逻辑到 useSearch composable"</span>
  ↓
第<span class="hljs-number">2</span>步：<span class="hljs-string">"将表格配置抽离到 @src/pages/user/config/tableConfig.ts"</span>
  ↓
第<span class="hljs-number">3</span>步：<span class="hljs-string">"优化分页逻辑，使用 @src/composables/base/usePagination.ts"</span>
  ↓
第<span class="hljs-number">4</span>步：<span class="hljs-string">"添加列表数据缓存，避免重复请求"</span>
  ↓
第<span class="hljs-number">5</span>步：<span class="hljs-string">"添加骨架屏加载状态"</span>
</code></pre>
<h4 data-id="heading-28">技巧 5：约束驱动开发（Constraint-Driven Development）</h4>
<p><strong>通过约束引导 AI 生成更好的代码</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">实现用户列表功能，严格遵守以下约束：

代码质量约束：
<span class="hljs-bullet">1.</span> 单个函数不超过 50 行
<span class="hljs-bullet">2.</span> 单个文件不超过 300 行
<span class="hljs-bullet">3.</span> 所有异步操作必须有错误处理
<span class="hljs-bullet">4.</span> 使用 TypeScript 严格模式，不允许 any
<span class="hljs-bullet">5.</span> 所有函数必须有 JSDoc 注释

架构约束：
<span class="hljs-bullet">1.</span> 组件拆分：搜索栏、表格、分页各自独立
<span class="hljs-bullet">2.</span> 逻辑抽离：使用 composable 管理状态
<span class="hljs-bullet">3.</span> 类型定义：所有接口和数据结构必须定义类型
<span class="hljs-bullet">4.</span> 错误处理：使用统一的 errorHandler

性能约束：
<span class="hljs-bullet">1.</span> 支持 10000 条数据的虚拟滚动
<span class="hljs-bullet">2.</span> 搜索防抖 300ms
<span class="hljs-bullet">3.</span> 图片懒加载
<span class="hljs-bullet">4.</span> 列表数据缓存 5 分钟

可访问性约束：
<span class="hljs-bullet">1.</span> 支持键盘导航（Tab、Enter、Esc）
<span class="hljs-bullet">2.</span> 支持屏幕阅读器
<span class="hljs-bullet">3.</span> 颜色对比度符合 WCAG 2.1 AA 标准
</code></pre>
<h4 data-id="heading-29">技巧 6：元提示（Meta Prompting）</h4>
<p><strong>让 AI 帮你写提示词</strong></p>
<pre><code class="hljs language-diff" lang="diff">"我想实现一个复杂的数据可视化功能，
但不知道如何描述清楚，
请帮我生成一个完整的提示词，
包含所有必要的信息和约束条件。

需求概述：
<span class="hljs-deletion">- 展示用户增长趋势图（折线图）</span>
<span class="hljs-deletion">- 支持按日/周/月切换</span>
<span class="hljs-deletion">- 支持数据导出</span>
<span class="hljs-deletion">- 需要响应式设计</span>

请生成一个结构化的提示词"
</code></pre>
<p>或者：</p>
<pre><code class="hljs language-markdown" lang="markdown">"根据我的需求，生成一个分步骤的实现计划：

需求：实现一个支持多人协作的在线白板
技术栈：Vue 3 + TypeScript + WebSocket + Canvas

请给出：
<span class="hljs-bullet">1.</span> 整体架构设计
<span class="hljs-bullet">2.</span> 详细的实现步骤
<span class="hljs-bullet">3.</span> 每一步的具体提示词
<span class="hljs-bullet">4.</span> 需要注意的技术难点"
</code></pre>
<hr/>
<h3 data-id="heading-30">三种工作模式</h3>
<h4 data-id="heading-31">模式 1：探索模式（Exploration Mode）</h4>
<p><strong>适用场景</strong>：不确定如何实现，需要探索方案</p>
<pre><code class="hljs language-markdown" lang="markdown">"我想实现一个拖拽排序的功能，
但不确定用什么库比较好，
项目是 Vue 3 + TypeScript + uni-app，
需要支持移动端触摸拖拽，
请给我几个方案对比，包括：
<span class="hljs-bullet">1.</span> 推荐的库（开源、维护活跃、支持 TypeScript）
<span class="hljs-bullet">2.</span> 各方案的优缺点
<span class="hljs-bullet">3.</span> 性能对比
<span class="hljs-bullet">4.</span> 集成难度
<span class="hljs-bullet">5.</span> 你的推荐和理由"
</code></pre>
<p><strong>AI 的回应方式</strong>：</p>
<ul>
<li>提供多个方案对比</li>
<li>分析每个方案的适用场景</li>
<li>给出具体的推荐和理由</li>
</ul>
<h4 data-id="heading-32">模式 2：执行模式（Execution Mode）</h4>
<p><strong>适用场景</strong>：明确知道要做什么，快速实现</p>
<pre><code class="hljs language-less" lang="less">"在 <span class="hljs-variable">@src</span>/components/DragList.vue 中使用 Sortable.js 实现拖拽排序：

<span class="hljs-number">1</span>. 安装依赖：
   - sortablejs
   - <span class="hljs-variable">@types</span>/sortablejs

<span class="hljs-number">2</span>. 创建 <span class="hljs-variable">@src</span>/composables/useDraggable.ts 封装拖拽逻辑

<span class="hljs-number">3</span>. 功能要求：
   - 支持拖拽排序
   - 拖拽时显示占位符
   - 拖拽结束触发 <span class="hljs-variable">@change</span> 事件，返回新的排序
   - 支持禁用拖拽（通过 disabled prop）

<span class="hljs-number">4</span>. 样式要求：
   - 拖拽中的元素半透明
   - 占位符显示虚线边框
   - 拖拽手柄显示拖拽图标

参考 <span class="hljs-variable">@src</span>/components/SortableTable.vue 的实现"
</code></pre>
<p><strong>AI 的回应方式</strong>：</p>
<ul>
<li>直接生成代码</li>
<li>按步骤实现功能</li>
<li>提供必要的说明</li>
</ul>
<h4 data-id="heading-33">模式 3：优化模式（Optimization Mode）</h4>
<p><strong>适用场景</strong>：功能已实现，需要优化</p>
<pre><code class="hljs language-markdown" lang="markdown">"优化 @src/components/DragList.vue 的性能和用户体验：

性能优化：
<span class="hljs-bullet">1.</span> 分析当前性能瓶颈（使用 Vue DevTools）
<span class="hljs-bullet">2.</span> 优化拖拽时的重渲染问题（使用 v-memo）
<span class="hljs-bullet">3.</span> 添加虚拟滚动支持大列表（1000+ 项）
<span class="hljs-bullet">4.</span> 优化事件监听（使用事件委托）

体验优化：
<span class="hljs-bullet">1.</span> 优化移动端触摸体验（增大触摸区域）
<span class="hljs-bullet">2.</span> 添加拖拽动画（使用 FLIP 技术）
<span class="hljs-bullet">3.</span> 添加触觉反馈（移动端震动）
<span class="hljs-bullet">4.</span> 改进无障碍支持（键盘操作）

监控：
<span class="hljs-bullet">1.</span> 添加性能监控埋点
<span class="hljs-bullet">2.</span> 记录拖拽操作日志
<span class="hljs-bullet">3.</span> 监控错误和异常"
</code></pre>
<p><strong>AI 的回应方式</strong>：</p>
<ul>
<li>分析现有代码</li>
<li>指出优化点</li>
<li>提供优化方案</li>
<li>实施优化</li>
</ul>
<hr/>
<h3 data-id="heading-34">常见陷阱与避坑指南</h3>
<h4 data-id="heading-35">陷阱 1：过度依赖 AI</h4>
<p><strong>问题表现</strong>：</p>
<ul>
<li>完全不看 AI 生成的代码，直接复制粘贴</li>
<li>不理解代码逻辑，出问题无法调试</li>
<li>代码风格不统一，不符合项目规范</li>
</ul>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs">✅ 审查每一行代码
✅ 理解核心逻辑
✅ 验证类型定义
✅ 检查错误处理
✅ 确保符合项目规范
✅ 运行测试验证功能
</code></pre>
<h4 data-id="heading-36">陷阱 2：提示词过于模糊</h4>
<p><strong>问题表现</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">❌ <span class="hljs-string">"优化一下性能"</span>
❌ <span class="hljs-string">"改好看一点"</span>
❌ <span class="hljs-string">"修复一下 bug"</span>
</code></pre>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">✅ <span class="hljs-string">"优化列表渲染性能，目标：1000条数据渲染时间从 500ms 降到 100ms 以内"</span>
✅ <span class="hljs-string">"按照 Figma 设计稿调整样式，主要是：间距、颜色、圆角、阴影"</span>
✅ <span class="hljs-string">"修复登录按钮点击无反应的问题，控制台报错：'Cannot read property token of undefined'"</span>
</code></pre>
<h4 data-id="heading-37">陷阱 3：忽略上下文</h4>
<p><strong>问题表现</strong>：</p>
<ul>
<li>每次都从零开始描述</li>
<li>不引用相关文件</li>
<li>AI 不了解项目结构</li>
</ul>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">✅</span> 使用 <span class="hljs-meta">@文件名</span> 引用相关文件
<span class="hljs-operator">✅</span> 说明项目技术栈和规范
<span class="hljs-operator">✅</span> 提供参考实现
<span class="hljs-operator">✅</span> 说明业务背景
</code></pre>
<h4 data-id="heading-38">陷阱 4：一次性要求太多</h4>
<p><strong>问题表现</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">❌ <span class="hljs-string">"实现整个电商系统，包括：
   商品管理、订单管理、用户管理、
   支付系统、物流系统、营销系统、
   数据分析、客服系统..."</span>
</code></pre>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">✅ 第<span class="hljs-number">1</span>步：<span class="hljs-string">"先实现商品列表页，包括搜索、筛选、分页"</span>
✅ 第<span class="hljs-number">2</span>步：<span class="hljs-string">"实现商品详情页，包括图片轮播、规格选择、加入购物车"</span>
✅ 第<span class="hljs-number">3</span>步：<span class="hljs-string">"实现购物车功能，包括商品列表、数量修改、结算"</span>
✅ ...逐步推进
</code></pre>
<h4 data-id="heading-39">陷阱 5：不验证结果</h4>
<p><strong>问题表现</strong>：</p>
<ul>
<li>AI 说完成了就完成了</li>
<li>不运行代码测试</li>
<li>不检查类型错误</li>
<li>不测试边界情况</li>
</ul>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs">✅ 运行代码，测试功能
✅ 检查 TypeScript 类型错误
✅ 测试边界情况（空数据、错误数据、极端数据）
✅ 检查性能（大数据量、慢网络）
✅ 测试兼容性（不同浏览器、不同设备）
</code></pre>
<h4 data-id="heading-40">陷阱 6：忽视代码质量</h4>
<p><strong>问题表现</strong>：</p>
<ul>
<li>只关注功能实现，不关注代码质量</li>
<li>代码重复、结构混乱</li>
<li>没有注释、类型定义不完整</li>
</ul>
<p><strong>正确做法</strong>：</p>
<pre><code class="hljs">✅ 要求 AI 遵守代码规范
✅ 要求添加注释和类型定义
✅ 要求代码模块化、可复用
✅ 要求添加错误处理
✅ 定期重构优化
</code></pre>
<hr/>
<h3 data-id="heading-41">黄金公式</h3>
<h4 data-id="heading-42">完美提示词 = 7 个要素</h4>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[角色设定]</span> + <span class="hljs-selector-attr">[任务目标]</span> + <span class="hljs-selector-attr">[上下文]</span> + <span class="hljs-selector-attr">[技术栈]</span> + <span class="hljs-selector-attr">[约束条件]</span> + <span class="hljs-selector-attr">[预期结果]</span> + <span class="hljs-selector-attr">[参考示例]</span>
</code></pre>
<h4 data-id="heading-43">实战示例</h4>
<pre><code class="hljs language-markdown" lang="markdown">你是一个 Vue 3 + TypeScript 专家（角色设定），

帮我在 @src/pages/product/list.vue 中实现商品列表功能（任务目标），

这是一个电商小程序项目，需要展示商品列表并支持筛选，
商品数据来自后端 API，用户可以通过分类、价格、销量等条件筛选商品（上下文），

使用 Vue 3 Composition API + TypeScript + Pinia + uni-app，
调用 GET /api/v1/products 接口获取商品列表（技术栈），

要求：
<span class="hljs-bullet">1.</span> 不修改现有的 TabBar 组件和路由配置
<span class="hljs-bullet">2.</span> 支持下拉刷新和上拉加载更多
<span class="hljs-bullet">3.</span> 筛选条件包括：分类、价格区间、销量排序
<span class="hljs-bullet">4.</span> 单个组件不超过 300 行，复杂逻辑抽离到 composable
<span class="hljs-bullet">5.</span> 所有类型必须明确定义，不使用 any
<span class="hljs-bullet">6.</span> 图片使用懒加载
<span class="hljs-bullet">7.</span> 列表数据缓存 5 分钟
（约束条件）

完成后应该能够：
<span class="hljs-bullet">1.</span> 进入页面自动加载第一页数据（20条）
<span class="hljs-bullet">2.</span> 下拉刷新重置列表并重新加载
<span class="hljs-bullet">3.</span> 滚动到底部自动加载下一页
<span class="hljs-bullet">4.</span> 点击筛选按钮打开筛选面板
<span class="hljs-bullet">5.</span> 选择筛选条件后列表自动更新
<span class="hljs-bullet">6.</span> 点击商品卡片跳转到详情页
<span class="hljs-bullet">7.</span> 显示加载状态和空状态
（预期结果）

参考 @src/pages/order/list.vue 的列表实现方式和
@src/components/FilterPanel.vue 的筛选面板样式
（参考示例）
</code></pre>
<h4 data-id="heading-44">简化版（日常使用）</h4>
<p>对于简单任务，可以使用简化版：</p>
<pre><code class="hljs language-less" lang="less">在 <span class="hljs-variable">@src</span>/components/ProductCard.vue 中实现商品卡片组件：
- <span class="hljs-attribute">Props</span>: product (IProduct 类型)
- 显示：商品图片、名称、价格、销量
- 点击跳转到商品详情页
- 样式参考 <span class="hljs-variable">@src</span>/components/OrderCard.vue
</code></pre>
<hr/>
<h3 data-id="heading-45">进阶心法</h3>
<h4 data-id="heading-46">心法 1：Think Like a Product Manager</h4>
<p><strong>不要只想"怎么实现"，要想"为什么实现"、"用户会怎么用"</strong></p>
<pre><code class="hljs language-diff" lang="diff">不只是："实现搜索功能"

而是：
"实现搜索功能，因为用户需要快速找到商品，
支持：
<span class="hljs-deletion">- 模糊搜索（匹配商品名称、描述、标签）</span>
<span class="hljs-deletion">- 搜索历史（最多保存 10 条，支持删除）</span>
<span class="hljs-deletion">- 热门搜索推荐（显示 TOP 10 热搜词）</span>
<span class="hljs-deletion">- 搜索结果高亮关键词</span>
<span class="hljs-deletion">- 无结果时推荐相关商品</span>
<span class="hljs-deletion">- 搜索防抖（300ms）</span>
<span class="hljs-deletion">- 支持语音搜索（调用微信语音识别 API）"</span>
</code></pre>
<h4 data-id="heading-47">心法 2：Embrace Iteration</h4>
<p><strong>第一版不需要完美，快速出原型，然后迭代优化</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">V1: 基础功能（能用）
<span class="hljs-bullet">  -</span> 实现核心功能
<span class="hljs-bullet">  -</span> 基本的 UI
<span class="hljs-bullet">  -</span> 简单的错误处理

V2: 优化体验（好用）
<span class="hljs-bullet">  -</span> 优化交互流程
<span class="hljs-bullet">  -</span> 改进视觉设计
<span class="hljs-bullet">  -</span> 添加加载状态
<span class="hljs-bullet">  -</span> 完善错误提示

V3: 性能优化（快用）
<span class="hljs-bullet">  -</span> 优化渲染性能
<span class="hljs-bullet">  -</span> 添加缓存机制
<span class="hljs-bullet">  -</span> 图片懒加载
<span class="hljs-bullet">  -</span> 请求防抖节流

V4: 完善细节（爱用）
<span class="hljs-bullet">  -</span> 添加动画效果
<span class="hljs-bullet">  -</span> 优化无障碍支持
<span class="hljs-bullet">  -</span> 完善边界情况
<span class="hljs-bullet">  -</span> 添加埋点统计
</code></pre>
<h4 data-id="heading-48">心法 3：Build a Knowledge Base</h4>
<p><strong>把常用的提示词、代码模板、最佳实践整理成文档</strong></p>
<p>建议创建以下文档：</p>
<pre><code class="hljs language-perl" lang="perl">docs/
├── prompts/
│   ├── component-templates.md      <span class="hljs-comment"># 组件开发模板</span>
│   ├── api-integration.md          <span class="hljs-comment"># API 对接模板</span>
│   ├── page-templates.md           <span class="hljs-comment"># 页面开发模板</span>
│   └── refactoring-checklist.md   <span class="hljs-comment"># 重构检查清单</span>
├── standards/
│   ├── code-style.md               <span class="hljs-comment"># 代码风格规范</span>
│   ├── naming-conventions.md      <span class="hljs-comment"># 命名规范</span>
│   ├── typescript-guide.md        <span class="hljs-comment"># TypeScript 使用指南</span>
│   └── performance-checklist.md   <span class="hljs-comment"># 性能优化清单</span>
└── best-practices/
    ├── vue3-patterns.md            <span class="hljs-comment"># Vue 3 最佳实践</span>
    ├── error-handling.md           <span class="hljs-comment"># 错误处理最佳实践</span>
    ├── <span class="hljs-keyword">state</span>-management.md         <span class="hljs-comment"># 状态管理最佳实践</span>
    └── testing-guide.md            <span class="hljs-comment"># 测试指南</span>
</code></pre>
<h4 data-id="heading-49">心法 4：Teach the AI Your Style</h4>
<p><strong>通过 <code>.cursorrules</code> 或项目规范文件，让 AI 了解你的编码风格</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// .cursorrules 示例</span>

# 项目规范

## 技术栈
- <span class="hljs-title class_">Vue</span> <span class="hljs-number">3</span> + <span class="hljs-title class_">TypeScript</span> + <span class="hljs-title class_">Pinia</span> + uni-app
- 使用 <span class="hljs-title class_">Composition</span> <span class="hljs-variable constant_">API</span> + <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span>
- 使用 SCSS 预处理器

## 代码规范
- 组件使用 PascalCase 命名
- 文件名使用 kebab-case
- 所有函数必须有 JSDoc 注释
- 使用 interface 而不是 type（除非必要）
- Props 和 Emits 必须定义 TypeScript 类型
- 不使用 any，必要时使用 unknown

## 错误处理
- 所有异步操作必须有 try-catch
- 使用统一的 errorHandler 处理错误
- 错误信息要用户友好，不暴露技术细节

## 性能要求
- 列表超过 100 项使用虚拟滚动
- 图片必须懒加载
- 请求必须防抖或节流
- 避免不必要的重渲染

## 文件组织
- 页面文件放在 src/pages/
- 公共组件放在 src/components/
- 业务组件放在页面目录下的 components/
- API 接口放在 src/api/
- 类型定义放在 src/types/
- 工具函数放在 src/utils/
- Composables 放在 src/composables/
</span></code></pre>
<h4 data-id="heading-50">心法 5：Review Like a Senior Developer</h4>
<p><strong>不要盲目信任 AI，要像 Code Review 一样审查代码</strong></p>
<h5 data-id="heading-51">Code Review 检查清单</h5>
<pre><code class="hljs language-arduino" lang="arduino">□ 功能正确性
  □ 实现了所有需求
  □ 边界情况处理正确
  □ 错误处理完善

□ 代码质量
  □ 逻辑清晰，易于理解
  □ 命名规范，见名知意
  □ 注释充分，解释清楚
  □ 没有重复代码

□ 类型安全
  □ 所有类型定义完整
  □ 没有使用 any
  □ Props 和 Emits 类型正确
  □ API 响应类型定义

□ 性能
  □ 没有不必要的重渲染
  □ 列表渲染优化（key、v-memo）
  □ 图片懒加载
  □ 请求防抖节流

□ 安全性
  □ 用户输入验证
  □ XSS 防护
  □ 敏感信息不暴露
  □ 权限检查

□ 可维护性
  □ 代码模块化
  □ 职责单一
  □ 易于测试
  □ 易于扩展

□ 用户体验
  □ 加载状态
  □ 错误提示
  □ 空状态处理
  □ 交互反馈

□ 规范遵守
  □ 符合项目编码规范
  □ 符合 Git 提交规范
  □ 符合命名规范
  □ 符合文件组织规范
</code></pre>
<hr/>
<h3 data-id="heading-52">实战案例</h3>
<h4 data-id="heading-53">案例 1：从零实现用户登录功能</h4>
<h5 data-id="heading-54">第1轮：架构设计</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">设计用户登录功能的整体架构：
<span class="hljs-deletion">- 支持手机号+验证码登录</span>
<span class="hljs-deletion">- 支持账号+密码登录</span>
<span class="hljs-deletion">- 需要记住登录状态</span>
<span class="hljs-deletion">- 需要 Token 管理和自动刷新</span>
请给出文件组织结构和技术方案
</code></pre>
<p><strong>AI 回应</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">文件组织：
src/
├── pages/login/
│   ├── index.vue           <span class="hljs-comment"># 登录页（选择登录方式）</span>
│   ├── phone.vue           <span class="hljs-comment"># 手机号登录</span>
│   └── password.vue        <span class="hljs-comment"># 密码登录</span>
├── api/auth.ts             <span class="hljs-comment"># 认证相关 API</span>
├── types/auth.ts           <span class="hljs-comment"># 认证相关类型</span>
├── stores/useAuthStore.ts  <span class="hljs-comment"># 认证状态管理</span>
└── composables/
    └── useAuth.ts          <span class="hljs-comment"># 认证逻辑封装</span>

技术方案：
1. Token 存储：uni.setStorageSync
2. Token 刷新：拦截器自动刷新
3. 登录状态：Pinia Store 管理
4. 路由守卫：检查登录状态
</code></pre>
<h5 data-id="heading-55">第2轮：实现手机号登录</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-less" lang="less">在 <span class="hljs-variable">@src</span>/pages/login/phone.vue 中实现手机号+验证码登录：

功能：
<span class="hljs-number">1</span>. 手机号输入（<span class="hljs-number">11</span>位数字，实时校验）
<span class="hljs-number">2</span>. 发送验证码按钮（<span class="hljs-number">60</span>秒倒计时）
<span class="hljs-number">3</span>. 验证码输入（<span class="hljs-number">6</span>位数字）
<span class="hljs-number">4</span>. 登录按钮（表单验证通过后可点击）

API：
- 发送验证码：POST /api/v1/auth/send-code
- 登录：POST /api/v1/auth/login

技术要求：
- 使用 Vue <span class="hljs-number">3</span> Composition API + TypeScript
- 表单验证使用 uni-app 内置验证
- 调用 <span class="hljs-variable">@src</span>/api/auth.ts 中的接口
- 登录成功后保存 token 到 <span class="hljs-variable">@src</span>/stores/useAuthStore.ts
- 跳转到首页

样式：
- 参考 <span class="hljs-variable">@src</span>/pages/login/index.vue 的整体风格
- 输入框使用圆角卡片样式
- 按钮使用渐变色
</code></pre>
<h5 data-id="heading-56">第3轮：优化用户体验</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">优化 @src/pages/login/phone.vue 的用户体验：

<span class="hljs-bullet">1.</span> 输入优化：
<span class="hljs-bullet">   -</span> 手机号输入自动添加空格（3-4-4 格式）
<span class="hljs-bullet">   -</span> 验证码输入自动聚焦到下一位
<span class="hljs-bullet">   -</span> 支持粘贴验证码自动填充

<span class="hljs-bullet">2.</span> 反馈优化：
<span class="hljs-bullet">   -</span> 发送验证码成功显示 Toast
<span class="hljs-bullet">   -</span> 登录中显示 Loading
<span class="hljs-bullet">   -</span> 登录失败显示错误提示
<span class="hljs-bullet">   -</span> 表单验证失败高亮错误字段

<span class="hljs-bullet">3.</span> 动画效果：
<span class="hljs-bullet">   -</span> 页面进入淡入动画
<span class="hljs-bullet">   -</span> 按钮点击缩放反馈
<span class="hljs-bullet">   -</span> 错误提示抖动动画

<span class="hljs-bullet">4.</span> 边界情况：
<span class="hljs-bullet">   -</span> 网络错误重试
<span class="hljs-bullet">   -</span> 验证码过期提示
<span class="hljs-bullet">   -</span> 频繁发送验证码限制
</code></pre>
<h4 data-id="heading-57">案例 2：优化现有商品列表性能</h4>
<h5 data-id="heading-58">第1轮：性能分析</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">分析 @src/pages/product/list.vue 的性能问题：
<span class="hljs-deletion">- 当前有 1000+ 商品数据</span>
<span class="hljs-deletion">- 滚动时有明显卡顿</span>
<span class="hljs-deletion">- 图片加载慢</span>
<span class="hljs-deletion">- 筛选条件改变时整个列表重新渲染</span>

请使用 Vue DevTools 分析性能瓶颈，
并给出优化方案
</code></pre>
<h5 data-id="heading-59">第2轮：实施优化</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">优化 @src/pages/product/list.vue 的性能：

<span class="hljs-bullet">1.</span> 列表渲染优化：
<span class="hljs-bullet">   -</span> 使用虚拟滚动（uni-app 的 recycle-view）
<span class="hljs-bullet">   -</span> 使用 v-memo 避免不必要的重渲染
<span class="hljs-bullet">   -</span> 优化 key 的使用

<span class="hljs-bullet">2.</span> 图片加载优化：
<span class="hljs-bullet">   -</span> 使用图片懒加载
<span class="hljs-bullet">   -</span> 使用缩略图（小尺寸）
<span class="hljs-bullet">   -</span> 添加占位图

<span class="hljs-bullet">3.</span> 筛选优化：
<span class="hljs-bullet">   -</span> 筛选条件改变时只更新数据，不重新渲染整个列表
<span class="hljs-bullet">   -</span> 使用防抖避免频繁筛选

<span class="hljs-bullet">4.</span> 数据优化：
<span class="hljs-bullet">   -</span> 添加列表数据缓存
<span class="hljs-bullet">   -</span> 分页加载，每页 20 条

目标：
<span class="hljs-bullet">-</span> 1000 条数据渲染时间 &lt; 100ms
<span class="hljs-bullet">-</span> 滚动帧率 &gt; 55fps
<span class="hljs-bullet">-</span> 图片加载使用渐进式加载
</code></pre>
<h4 data-id="heading-60">案例 3：重构混乱的组件</h4>
<h5 data-id="heading-61">第1轮：代码审查</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-diff" lang="diff">审查 @src/pages/order/detail.vue 的代码质量：
<span class="hljs-deletion">- 文件有 800+ 行</span>
<span class="hljs-deletion">- 逻辑混乱，难以维护</span>
<span class="hljs-deletion">- 没有类型定义</span>
<span class="hljs-deletion">- 没有注释</span>

请分析存在的问题，并给出重构方案
</code></pre>
<h5 data-id="heading-62">第2轮：拆分组件</h5>
<p><strong>提示词</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">重构 @src/pages/order/detail.vue，按以下方案拆分：

<span class="hljs-bullet">1.</span> 拆分组件：
<span class="hljs-bullet">   -</span> OrderHeader.vue（订单头部信息）
<span class="hljs-bullet">   -</span> OrderProducts.vue（商品列表）
<span class="hljs-bullet">   -</span> OrderAddress.vue（收货地址）
<span class="hljs-bullet">   -</span> OrderPrice.vue（价格明细）
<span class="hljs-bullet">   -</span> OrderActions.vue（操作按钮）

<span class="hljs-bullet">2.</span> 抽离逻辑：
<span class="hljs-bullet">   -</span> useOrderDetail.ts（订单详情逻辑）
<span class="hljs-bullet">   -</span> useOrderActions.ts（订单操作逻辑）

<span class="hljs-bullet">3.</span> 类型定义：
<span class="hljs-bullet">   -</span> 在 @src/types/order.ts 中定义所有类型

<span class="hljs-bullet">4.</span> 要求：
<span class="hljs-bullet">   -</span> 每个组件 &lt; 200 行
<span class="hljs-bullet">   -</span> 所有 Props 和 Emits 定义类型
<span class="hljs-bullet">   -</span> 添加 JSDoc 注释
<span class="hljs-bullet">   -</span> 保持功能不变
</code></pre>
<hr/>
<h3 data-id="heading-63">总结</h3>
<h4 data-id="heading-64">Vibe Coding 的本质</h4>
<p><strong>Vibe Coding 不是让 AI 替你写代码，而是让 AI 成为你的编程伙伴</strong></p>
<h4 data-id="heading-65">三个关键点</h4>
<ol>
<li><strong>清晰表达</strong>：用准确的语言描述你的意图</li>
<li><strong>持续迭代</strong>：不追求一次完美，快速迭代优化</li>
<li><strong>代码审查</strong>：始终审查 AI 生成的代码，确保质量</li>
</ol>
<h4 data-id="heading-66">记住这些原则</h4>
<blockquote>
<p><strong>最好的提示词不是最长的，而是最清晰的</strong></p>
</blockquote>
<blockquote>
<p><strong>最好的代码不是 AI 生成的，而是你审查过的</strong></p>
</blockquote>
<blockquote>
<p><strong>最好的开发者不是不用 AI 的，而是会用 AI 的</strong></p>
</blockquote>
<h4 data-id="heading-67">持续学习</h4>
<p>Vibe Coding 是一个不断进化的领域：</p>
<ul>
<li><strong>关注 AI 能力更新</strong>：新功能、新特性</li>
<li><strong>总结最佳实践</strong>：记录有效的提示词模板</li>
<li><strong>分享经验</strong>：与团队分享 Vibe Coding 技巧</li>
<li><strong>保持好奇</strong>：探索 AI 的边界和可能性</li>
</ul>
<hr/>
<h3 data-id="heading-68">性能与成本优化</h3>
<h4 data-id="heading-69">Token 使用优化策略</h4>
<p>在使用 AI 编码工具时，合理控制 Token 消耗不仅能降低成本，还能提升响应速度。</p>
<h5 data-id="heading-70">1. 精准的上下文管理</h5>
<p><strong>只添加必要的文件到上下文</strong></p>
<pre><code class="hljs language-perl" lang="perl">❌ 不好：让 AI 读取整个项目
<span class="hljs-string">"帮我看看项目中所有的登录相关代码"</span>

✅ 更好：精确引用需要的文件
<span class="hljs-string">"检查 @src/pages/login/phone.vue 和 @src/api/auth.ts 中的登录逻辑"</span>
</code></pre>
<p><strong>及时清理上下文</strong></p>
<ul>
<li>对话过长时（&gt;50 轮）开启新对话</li>
<li>完成一个功能模块后，总结要点，开启新对话</li>
<li>避免在同一对话中处理多个不相关的任务</li>
</ul>
<p><strong>分层提问策略</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">❌ 低效方式：
<span class="hljs-string">"帮我实现一个完整的订单系统，包括列表、详情、支付等所有功能"</span>
<span class="hljs-comment">// 这会生成大量 token，可能不准确</span>

✅ 高效方式：
第<span class="hljs-number">1</span>步：<span class="hljs-string">"设计订单系统的整体架构和文件组织"</span>
第<span class="hljs-number">2</span>步：<span class="hljs-string">"实现订单列表页，参考 @src/pages/product/list.vue"</span>
第<span class="hljs-number">3</span>步：<span class="hljs-string">"实现订单详情页，使用 @src/types/order.ts 的类型定义"</span>
第<span class="hljs-number">4</span>步：<span class="hljs-string">"集成支付功能"</span>
<span class="hljs-comment">// 精确引用，减少上下文，提高准确度</span>
</code></pre>
<h5 data-id="heading-71">2. 减少 Token 消耗的技巧</h5>
<p><strong>使用代码引用而非完整代码</strong></p>
<pre><code class="hljs language-perl" lang="perl">❌ 不好：把整个文件内容粘贴进来
<span class="hljs-string">"这是我的代码：[粘贴 500 行代码]，帮我优化"</span>

✅ 更好：使用文件引用和行号
<span class="hljs-string">"优化 @src/pages/order/list.vue 第 45-60 行的列表渲染逻辑"</span>
</code></pre>
<p><strong>明确的问题描述</strong></p>
<pre><code class="hljs language-perl" lang="perl">❌ 模糊描述（AI 需要多轮对话确认）：
<span class="hljs-string">"这个组件有问题，帮我看看"</span>

✅ 精确描述（一次性解决）：
<span class="hljs-string">"CategoryTabs 组件在切换时状态不更新，
怀疑是 props 响应式问题，
请检查 @src/pages/index/components/CategoryTabs.vue 第 45-60 行"</span>
</code></pre>
<p><strong>利用项目规则</strong></p>
<ul>
<li>在 <code>.cursorrules</code> 中定义项目规范</li>
<li>AI 会自动遵循这些规则，无需每次重复</li>
<li>减少"请使用 TypeScript"、"请用 Vue 3 Composition API"等重复指令</li>
</ul>
<h5 data-id="heading-72">3. 提高生成速度的策略</h5>
<p><strong>使用快捷指令</strong></p>
<p>根据项目规则定义快捷方式：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 在 .cursorrules 中定义</span>
- <span class="hljs-string">'figma2vue'</span> - 快速从设计生成页面
- <span class="hljs-string">'组件拆分'</span> - 快速拆分组件
- <span class="hljs-string">'跑多语言'</span> - 快速处理国际化
</code></pre>
<p><strong>批量操作</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 一次性提问多个相关问题</span>
<span class="hljs-string">"请帮我：
1. 创建 OrderList 组件的类型定义
2. 实现分页逻辑
3. 添加加载状态
参考 @src/pages/product/list.vue 的实现"</span>

<span class="hljs-comment">// 而不是分三次问，每次都要重新理解上下文</span>
</code></pre>
<p><strong>使用模板和代码片段</strong></p>
<p>创建常用的代码模板，减少重复生成：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// templates/page-template.vue</span>
&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-keyword">import</span> { ref, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 添加具体逻辑</span>
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"page"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- <span class="hljs-doctag">TODO:</span> 添加内容 --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.page</span> {
  // TODO: 添加样式
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h5 data-id="heading-73">4. 智能使用不同的 AI 模型</h5>
<p><strong>根据任务选择模型</strong></p>



































<table><thead><tr><th>任务类型</th><th>推荐模型</th><th>原因</th></tr></thead><tbody><tr><td>简单重复任务</td><td>GPT-3.5 / Claude Haiku</td><td>更快更便宜</td></tr><tr><td>代码格式化、简单重构</td><td>GPT-3.5</td><td>成本低，速度快</td></tr><tr><td>复杂架构设计</td><td>GPT-4 / Claude Sonnet</td><td>理解力强，质量高</td></tr><tr><td>代码审查</td><td>Claude Sonnet</td><td>注重细节，准确度高</td></tr><tr><td>算法优化</td><td>GPT-4 Turbo</td><td>推理能力强</td></tr></tbody></table>
<p><strong>Cursor 快捷键优化</strong></p>
<pre><code class="hljs language-css" lang="css">Cmd/Ctrl + K - 快速编辑（适合小改动，token 消耗少）
Cmd/Ctrl + L - 聊天模式（适合复杂问题）
Cmd/Ctrl + <span class="hljs-selector-tag">I</span> - 内联编辑（最省 token）
</code></pre>
<h5 data-id="heading-74">5. 代码复用和组件化</h5>
<p><strong>建立组件库</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 优先使用现有组件，减少重复生成</span>
components/
├── <span class="hljs-title class_">Base</span>/          <span class="hljs-comment">// 基础组件（高复用）</span>
│   ├── <span class="hljs-title class_">BaseButton</span>.<span class="hljs-property">vue</span>
│   ├── <span class="hljs-title class_">BaseInput</span>.<span class="hljs-property">vue</span>
│   └── <span class="hljs-title class_">BaseEmpty</span>.<span class="hljs-property">vue</span>
├── <span class="hljs-title class_">Business</span>/      <span class="hljs-comment">// 业务组件（中复用）</span>
│   ├── <span class="hljs-title class_">RegionPicker</span>/
│   └── <span class="hljs-title class_">SkuPopup</span>/
└── [<span class="hljs-title class_">Page</span>]/        <span class="hljs-comment">// 页面组件（低复用）</span>
</code></pre>
<p><strong>使用 Composables 复用逻辑</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// composables/useOrder.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useOrder</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 订单相关逻辑</span>
    <span class="hljs-keyword">const</span> orders = <span class="hljs-title function_">ref</span>([])
    <span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchOrders</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">return</span> { orders, loading, fetchOrders }
}

<span class="hljs-comment">// 在多个页面中复用，而不是重复生成</span>
<span class="hljs-keyword">import</span> { useOrder } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/composables'</span>
</code></pre>
<h5 data-id="heading-75">6. 增量式开发</h5>
<p><strong>先骨架后细节</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">第一步：生成页面结构和路由（快速搭建）
  <span class="hljs-string">"创建订单列表页面的基础结构"</span>

第二步：实现核心功能（能用）
  <span class="hljs-string">"实现订单列表的数据加载和展示"</span>

第三步：添加交互（好用）
  <span class="hljs-string">"添加搜索、筛选、排序功能"</span>

第四步：优化体验（爱用）
  <span class="hljs-string">"添加加载状态、空状态、错误处理"</span>

第五步：性能优化（快用）
  <span class="hljs-string">"优化列表渲染性能，添加虚拟滚动"</span>
</code></pre>
<p><strong>使用 TODO 标记</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 让 AI 只实现关键部分</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 添加表单验证</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 调用 API</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 处理错误</span>
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 成功后跳转</span>
}

<span class="hljs-comment">// 然后分别让 AI 实现每个 TODO</span>
<span class="hljs-comment">// 每次只消耗少量 token</span>
</code></pre>
<h5 data-id="heading-76">7. 利用缓存和记忆</h5>
<p><strong>使用 Cursor 的记忆功能</strong></p>
<pre><code class="hljs language-diff" lang="diff">让 AI 记住：
<span class="hljs-deletion">- 项目特定的约定和规范</span>
<span class="hljs-deletion">- 常用的代码模式</span>
<span class="hljs-deletion">- 你的偏好设置</span>
<span class="hljs-deletion">- 团队的命名规则</span>

这样每次对话不需要重复说明
</code></pre>
<p><strong>本地代码搜索优先</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">工作流程：
<span class="hljs-bullet">1.</span> ✅ 先用 Cmd/Ctrl + P 搜索现有代码
<span class="hljs-bullet">2.</span> ✅ 再用 Cmd/Ctrl + Shift + F 全局搜索
<span class="hljs-bullet">3.</span> ✅ 查看项目文档和注释
<span class="hljs-bullet">4.</span> ❌ 最后才问 AI（如果找不到）

这样可以节省 50-70% 的 AI 调用
</code></pre>
<h5 data-id="heading-77">8. 成本对比与选择</h5>
<p><strong>主流 AI 模型成本对比（2026年1月）</strong></p>



































<table><thead><tr><th>模型</th><th>输入成本</th><th>输出成本</th><th>适用场景</th></tr></thead><tbody><tr><td>GPT-4 Turbo</td><td>$0.01/1K tokens</td><td>$0.03/1K tokens</td><td>复杂架构、算法设计</td></tr><tr><td>Claude Sonnet</td><td>$0.003/1K tokens</td><td>$0.015/1K tokens</td><td>代码审查、重构</td></tr><tr><td>GPT-3.5 Turbo</td><td>$0.0005/1K tokens</td><td>$0.0015/1K tokens</td><td>简单任务、格式化</td></tr><tr><td>Claude Haiku</td><td>$0.00025/1K tokens</td><td>$0.00125/1K tokens</td><td>重复性任务</td></tr></tbody></table>
<p><strong>节省成本的策略</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 简单问题用便宜模型
<span class="hljs-bullet">   -</span> 代码格式化 → GPT-3.5
<span class="hljs-bullet">   -</span> 简单重构 → Claude Haiku
<span class="hljs-bullet">   -</span> 类型定义 → GPT-3.5

<span class="hljs-bullet">2.</span> 复杂问题用高级模型
<span class="hljs-bullet">   -</span> 架构设计 → GPT-4 Turbo
<span class="hljs-bullet">   -</span> 性能优化 → Claude Sonnet
<span class="hljs-bullet">   -</span> 算法实现 → GPT-4

<span class="hljs-bullet">3.</span> 批量处理
<span class="hljs-bullet">   -</span> 一次性处理多个相关任务
<span class="hljs-bullet">   -</span> 减少对话轮次
<span class="hljs-bullet">   -</span> 提高 token 利用率

<span class="hljs-bullet">4.</span> 使用本地工具
<span class="hljs-bullet">   -</span> ESLint（代码检查）
<span class="hljs-bullet">   -</span> Prettier（代码格式化）
<span class="hljs-bullet">   -</span> TypeScript（类型检查）
<span class="hljs-bullet">   -</span> 不需要 AI 的不用 AI
</code></pre>
<h5 data-id="heading-78">9. 其他 AI 编码工具对比</h5>
<p><strong>GitHub Copilot</strong></p>
<ul>
<li><strong>优势</strong>：实时补全，速度快，IDE 集成好</li>
<li><strong>适用</strong>：日常编码、快速补全、代码片段</li>
<li><strong>成本</strong>：$10/月（固定费用）</li>
<li><strong>推荐场景</strong>：作为基础工具，处理 80% 的日常编码</li>
</ul>
<p><strong>Codeium</strong></p>
<ul>
<li><strong>优势</strong>：免费，支持多种 IDE，功能全面</li>
<li><strong>适用</strong>：预算有限的开发者、学习阶段</li>
<li><strong>成本</strong>：免费（个人版）</li>
<li><strong>推荐场景</strong>：个人项目、学习练习</li>
</ul>
<p><strong>Tabnine</strong></p>
<ul>
<li><strong>优势</strong>：可本地部署，隐私性好，企业级</li>
<li><strong>适用</strong>：企业级项目、隐私敏感项目</li>
<li><strong>成本</strong>：$12-39/月</li>
<li><strong>推荐场景</strong>：企业项目、对代码隐私有要求</li>
</ul>
<p><strong>Cursor</strong></p>
<ul>
<li><strong>优势</strong>：深度集成，上下文理解好，多模型支持</li>
<li><strong>适用</strong>：复杂项目、架构设计、代码重构</li>
<li><strong>成本</strong>：$20/月（Pro）</li>
<li><strong>推荐场景</strong>：专业开发、复杂业务逻辑</li>
</ul>
<p><strong>推荐组合方案</strong></p>
<pre><code class="hljs language-diff" lang="diff">方案 1：性价比最高
<span class="hljs-deletion">- 日常编码：GitHub Copilot（$10/月）</span>
<span class="hljs-deletion">- 复杂问题：Cursor + Claude Sonnet（$20/月）</span>
<span class="hljs-deletion">- 总成本：$30/月</span>

方案 2：预算有限
<span class="hljs-deletion">- 日常编码：Codeium（免费）</span>
<span class="hljs-deletion">- 复杂问题：Claude API 直接调用（按需付费）</span>
<span class="hljs-deletion">- 总成本：&lt;$10/月</span>

方案 3：专业开发
<span class="hljs-deletion">- 日常编码：GitHub Copilot（$10/月）</span>
<span class="hljs-deletion">- 架构设计：Cursor + GPT-4（$20/月）</span>
<span class="hljs-deletion">- 代码审查：Claude Sonnet API（按需）</span>
<span class="hljs-deletion">- 总成本：$30-40/月</span>

方案 4：团队协作
<span class="hljs-deletion">- 统一使用 Cursor Team（$40/月/人）</span>
<span class="hljs-deletion">- 配置团队规则和知识库</span>
<span class="hljs-deletion">- 共享最佳实践和提示词模板</span>
</code></pre>
<h5 data-id="heading-79">10. 实战优化示例</h5>
<p><strong>优化前（低效方式）</strong></p>
<pre><code class="hljs language-diff" lang="diff">对话轮次：15 轮
Token 消耗：约 50,000 tokens
时间：45 分钟
成本：约 $0.75

问题：
<span class="hljs-deletion">- 每次都重新描述需求</span>
<span class="hljs-deletion">- 没有引用相关文件</span>
<span class="hljs-deletion">- 一次性要求太多功能</span>
<span class="hljs-deletion">- 频繁修改和调整</span>
</code></pre>
<p><strong>优化后（高效方式）</strong></p>
<pre><code class="hljs language-diff" lang="diff">对话轮次：5 轮
Token 消耗：约 15,000 tokens
时间：15 分钟
成本：约 $0.23

改进：
<span class="hljs-deletion">- 使用 @文件名 精确引用</span>
<span class="hljs-deletion">- 分步骤实现，每步明确</span>
<span class="hljs-deletion">- 利用项目规则，减少重复说明</span>
<span class="hljs-deletion">- 使用模板和参考实现</span>
</code></pre>
<p><strong>节省效果</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">Token 节省：<span class="hljs-number">70</span><span class="hljs-comment">%</span>
时间节省：<span class="hljs-number">67</span><span class="hljs-comment">%</span>
成本节省：<span class="hljs-number">69</span><span class="hljs-comment">%</span>
质量提升：代码更规范，bug 更少
</code></pre>
<h5 data-id="heading-80">11. 最佳实践清单</h5>
<p><strong>开始编码前</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 明确任务目标和范围</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 准备好相关文件引用</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 检查是否有类似实现可参考</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 确认技术栈和约束条件</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 选择合适的 AI 模型</li>
</ul>
<p><strong>编码过程中</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 只添加必要文件到上下文</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 使用 <code>@文件名</code> 精确引用</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 问题描述清晰具体</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 分步骤实现，逐步验证</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 及时清理长对话</li>
</ul>
<p><strong>代码生成后</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 审查每一行代码</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 验证类型定义</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试功能和边界情况</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 检查性能和安全性</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 确保符合项目规范</li>
</ul>
<p><strong>持续优化</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 总结有效的提示词模板</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 建立项目知识库</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 记录常见问题和解决方案</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 定期回顾和优化工作流</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 与团队分享最佳实践</li>
</ul>
<h4 data-id="heading-81">性能优化总结</h4>
<p>通过以上策略，你可以：</p>
<ul>
<li><strong>降低 50-70% 的 Token 消耗</strong></li>
<li><strong>提升 2-3 倍的开发效率</strong></li>
<li><strong>减少 60-80% 的成本</strong></li>
<li><strong>提高代码质量和一致性</strong></li>
</ul>
<p>记住：<strong>最好的优化不是少用 AI，而是更智能地使用 AI</strong>。</p>
<hr/>
<h3 data-id="heading-82">附录</h3>
<h4 data-id="heading-83">常用提示词模板库</h4>
<h5 data-id="heading-84">1. 功能实现类</h5>
<pre><code class="hljs language-ini" lang="ini">在 @<span class="hljs-section">[文件路径]</span> 中实现 <span class="hljs-section">[功能名称]</span>：

功能描述：
- <span class="hljs-section">[功能点1]</span>
- <span class="hljs-section">[功能点2]</span>

技术要求：
- <span class="hljs-section">[技术要求1]</span>
- <span class="hljs-section">[技术要求2]</span>

约束条件：
- <span class="hljs-section">[约束1]</span>
- <span class="hljs-section">[约束2]</span>

参考：@<span class="hljs-section">[参考文件]</span>
</code></pre>
<h5 data-id="heading-85">2. Bug 修复类</h5>
<pre><code class="hljs language-ini" lang="ini">修复 @<span class="hljs-section">[文件路径]</span> 中的问题：

问题描述：
- 现象：<span class="hljs-section">[问题表现]</span>
- 预期：<span class="hljs-section">[期望结果]</span>
- 错误信息：<span class="hljs-section">[错误日志]</span>

复现步骤：
1. <span class="hljs-section">[步骤1]</span>
2. <span class="hljs-section">[步骤2]</span>

环境信息：
- <span class="hljs-section">[浏览器/设备/版本]</span>
</code></pre>
<h5 data-id="heading-86">3. 性能优化类</h5>
<pre><code class="hljs language-ini" lang="ini">优化 @<span class="hljs-section">[文件路径]</span> 的性能：

当前问题：
- <span class="hljs-section">[性能问题1]</span>
- <span class="hljs-section">[性能问题2]</span>

优化目标：
- <span class="hljs-section">[具体指标]</span>

优化方向：
- <span class="hljs-section">[方向1]</span>
- <span class="hljs-section">[方向2]</span>
</code></pre>
<h5 data-id="heading-87">4. 代码重构类</h5>
<pre><code class="hljs language-diff" lang="diff">重构 @[文件路径]：

重构目标：
<span class="hljs-deletion">- [目标1]</span>
<span class="hljs-deletion">- [目标2]</span>

重构方案：
<span class="hljs-deletion">- [方案描述]</span>

要求：
<span class="hljs-deletion">- 保持功能不变</span>
<span class="hljs-deletion">- 添加必要的注释</span>
<span class="hljs-deletion">- 提高代码可读性</span>
</code></pre>
<p><strong>Keep Vibing, Keep Coding! 🚀</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python+OpenCV 图片浏览器核心功能实现与技术细节深度解析]]></title>    <link>https://juejin.cn/post/7595028805158600714</link>    <guid>https://juejin.cn/post/7595028805158600714</guid>    <pubDate>2026-01-14T10:28:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805158600714" data-draft-id="7595021077665841203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python+OpenCV 图片浏览器核心功能实现与技术细节深度解析"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T10:28:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="errorPage"/> <meta itemprop="url" content="https://juejin.cn/user/3546344178319914"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python+OpenCV 图片浏览器核心功能实现与技术细节深度解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3546344178319914/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    errorPage
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:28:43.000Z" title="Wed Jan 14 2026 10:28:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><span href="https://code.juejin.cn/pen/7595162007155048498" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7595162007155048498" data-src="https://code.juejin.cn/pen/7595162007155048498" style="display:none;" loading="lazy"/><span class="loading-placeholder" style="display:none"><img class="placeholder-image" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAJElEQVRoge3BMQEAAADCoPVP7WkJoAAAAAAAAAAAAAAAAAAAbjh8AAFte11jAAAAAElFTkSuQmCC" loading="lazy"/><span class="loading-logo"/></span></span></p>
 <h2 data-id="heading-0">Python+OpenCV 图片浏览器核心功能实现与技术细节深度解析</h2> <h3 data-id="heading-1">前言</h3> <p>在Python可视化开发中，基于OpenCV实现图片浏览器/简易图片编辑器是非常经典的实战场景，其中包含了OpenCV图片加载的避坑技巧、Numpy与OpenCV的底层关联、图像数据的内存管理、等比例缩放的核心算法、工业级代码的健壮性设计等多个高频考点与易踩坑细节。</p> <p>本文将结合实际业务代码，从核心业务流程、图片加载最优实现、图像矩阵本质、深拷贝避坑、缩放算法原理、健壮性判断解析六大维度，深度拆解图片浏览器的核心实现逻辑，同时解答开发中极易产生的疑问，所有知识点均贴合生产级代码规范，兼具实战性与理论深度。</p> <div class="tip"> 本文所有解析基于如下核心业务代码展开（工业级标准写法）：<br/> 1. 图片加载核心方法 load_image<br/> 2. 图片等比例缩放计算方法 calculate_fill_scale<br/> 3. 基于发布订阅模式的事件总线解耦设计 </div> <h3 data-id="heading-2">一、核心业务场景与整体流程梳理</h3> <h4 data-id="heading-3">1.1 核心业务需求</h4> <p>实现一个具备「图片加载、等比例自适应缩放、原图保护、画布适配、异常兜底」的图片浏览器核心能力，核心诉求：</p> <ul> <li>支持中文路径的图片加载，兼容各类图片格式；</li> <li>加载图片后自动计算缩放比例，让图片完整且最大化的撑满显示容器；</li> <li>区分「原始图片」和「当前编辑图片」，保证原图永不被修改，支持随时重置；</li> <li>所有核心逻辑具备健壮性，避免程序崩溃或显示异常；</li> <li>通过事件总线解耦业务逻辑与UI更新，保证代码扩展性。</li> </ul> <h4 data-id="heading-4">1.2 核心变量分工（黄金设计规范）</h4> <p>代码中定义了两个核心的图像变量，是所有逻辑的基础，所有Python图片处理类程序的标准设计：</p> <pre><code class="hljs language-lua" lang="lua"><span class="hljs-built_in">self</span>.original_image # 存储原始、无任何修改的图片数据，只读不写，作为底图 <span class="hljs-built_in">self</span>.current_image # 存储当前展示、缩放后的图片数据，可任意修改，作为工作图</code></pre> <h4 data-id="heading-5">1.3 整体执行流程</h4> <ol> <li>调用load_image(path)传入图片路径 → 读取图片二进制流并解码为图像矩阵</li> <li>对原始图像做深拷贝，赋值给工作图像，重置缩放/偏移参数</li> <li>通过事件总线发布「图片加载完成」事件，携带图片元信息（宽、高、大小）</li> <li>发布「计算自适应缩放比例」事件，触发calculate_fill_scale执行</li> <li>计算最优缩放比例后，发布「缩放更新」和「请求重绘」事件，更新UI展示</li> <li>所有异常在try-except中捕获，发布错误事件，友好提示用户</li> </ol> <h3 data-id="heading-6">二、OpenCV加载图片的最优实现（解决中文路径+二进制解码）</h3> <h4 data-id="heading-7">2.1 为什么不用cv2.imread()直接加载？</h4> <p><code>cv2.imread(path)</code> 是OpenCV官方提供的图片读取方法，但存在致命缺陷：无法读取路径中包含中文/特殊字符的图片文件，会直接返回None导致加载失败，这是OpenCV的原生编码问题，无法通过简单配置解决。</p> <h4 data-id="heading-8">2.2 最优加载方案：np.fromfile + cv2.imdecode 黄金组合</h4> <p>这是Python+OpenCV加载图片的工业级最优写法，完美解决中文路径问题，也是本文代码中采用的方案，核心代码：</p> <pre><code class="hljs language-lua" lang="lua">def load_image(<span class="hljs-built_in">self</span>, <span class="hljs-built_in">path</span>=None): <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">path</span>: <span class="hljs-keyword">return</span> try: <span class="hljs-built_in">path</span> = <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.normpath(<span class="hljs-built_in">path</span>) # <span class="hljs-number">1.</span> 读取图片的原始二进制字节流 file_data = np.fromfile(<span class="hljs-built_in">path</span>, dtype=np.uint8) # <span class="hljs-number">2.</span> 将二进制流解码为OpenCV可处理的图像矩阵 <span class="hljs-built_in">self</span>.original_image = cv2.imdecode(file_data, cv2.IMREAD_COLOR) <span class="hljs-keyword">if</span> <span class="hljs-built_in">self</span>.original_image is None: raise ValueError(<span class="hljs-string">"无法读取图片"</span>) # 后续逻辑... except Exception as e: event_bus.publish(<span class="hljs-string">"ERROR_OCCURRED"</span>, message=f<span class="hljs-string">"加载失败：{str(e)}"</span>)</code></pre> <h4 data-id="heading-9">2.3 逐行解析核心方法</h4> <p><strong>np.fromfile(path, dtype=np.uint8)</strong></p> <ul> <li>核心作用：从指定文件路径读取原始二进制字节流，不识别文件路径的字符编码，完美兼容中文路径；</li> <li>参数dtype=np.uint8：图片的像素数据本质是 0~255 的无符号8位整数，这是图片存储的通用标准，必须指定该类型；</li> <li>返回值：一维的Numpy数组，存储图片的所有二进制数据。</li> </ul> <p><strong>cv2.imdecode(file_data, cv2.IMREAD_COLOR)</strong></p> <ul> <li>核心作用：将图片的二进制字节流，解码为OpenCV可直接处理的图像矩阵；</li> <li>第一个参数file_data：上一步读取的二进制Numpy数组，是解码的数据源；</li> <li>第二个参数cv2.IMREAD_COLOR：指定彩色图片加载模式，返回3通道BGR格式的图像矩阵（OpenCV标准格式）；补充：cv2.IMREAD_GRAYSCALE为灰度图，cv2.IMREAD_UNCHANGED保留透明通道；</li> <li>异常兜底：解码失败（路径错误/文件损坏/非图片格式）会返回None，需主动抛出异常做兜底处理。</li> </ul> <h3 data-id="heading-10">三、核心底层原理：OpenCV的图像矩阵 = Numpy多维数组</h3> <p>这是开发中最易混淆、也是最核心的知识点，也是解答「为什么可以用Numpy的深拷贝」的关键，无例外的Python-OpenCV底层设计规则：</p> <div class="tip"> <strong>在Python版本的OpenCV中，所有的图像数据，都是以「Numpy多维数组(numpy.ndarray)」的形式存在和流转的。</strong> </div> <h4 data-id="heading-11">3.1 直观验证</h4> <p>对解码后的图像执行类型和维度校验，结果一目了然：</p> <pre><code class="hljs language-lua" lang="lua"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-built_in">self</span>.original_image)) # 输出：&lt;class <span class="hljs-string">'numpy.ndarray'</span>&gt; <span class="hljs-built_in">print</span>(<span class="hljs-built_in">self</span>.original_image.shape) # 输出：(图片高度, 图片宽度, 通道数)</code></pre> <h4 data-id="heading-12">3.2 关键结论</h4> <ul> <li>OpenCV没有自己独立的图像数据类型，所有图像操作本质都是对Numpy数组的操作；</li> <li>无论是cv2.imdecode解码的图像、cv2.imread读取的图像、还是cv2.resize处理后的图像，返回值都是Numpy数组；</li> <li>所有Numpy的数组操作（切片、拷贝、维度变换）都可以直接作用于OpenCV图像矩阵，二者无缝衔接。</li> </ul> <h3 data-id="heading-13">四、图像深拷贝的必要性与实现（绝对避坑点）</h3> <h4 data-id="heading-14">4.1 业务代码中的核心拷贝逻辑</h4> <pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">self.current_image</span> = self.original_image.copy()</code></pre> <p>这行代码是图片浏览器的灵魂代码，也是最容易被新手写错的地方，核心结论：</p> <div class="tip"> ✔️ 该行代码中的.copy()是Numpy数组原生的深拷贝方法；<br/> ✔️ 该操作实现的是「完全深拷贝」，新数组拥有独立的内存空间，与原数组无任何引用关系；<br/> ✔️ 这是保护原图不被修改的唯一正确方式。 </div> <h4 data-id="heading-15">4.2 两种赋值方式的天壤之别</h4> <div class="warning"> <strong>❌ 错误写法：浅引用（无拷贝，绝对禁止）</strong><br/> <code>self.current_image = self.original_image</code><br/> 这不是拷贝，只是变量的引用赋值，两个变量指向同一块内存地址。此时对self.current_image做任何修改（缩放、画框、裁剪），都会同步修改self.original_image，导致「原图被污染」，用户永远无法恢复原图，是图片处理程序的致命bug。 </div> <div class="tip"> <strong>✅ 正确写法：深拷贝（完全拷贝，唯一推荐）</strong><br/> <code>self.current_image = self.original_image.copy()</code><br/> Numpy数组的.copy()方法会创建一个全新的数组，拷贝原始图像的所有像素数据，新数组拥有独立的内存空间。修改self.current_image的任何像素、尺寸，都不会对self.original_image产生任何影响，完美实现「原图只读、工作图可写」的业务诉求。 </div> <h4 data-id="heading-16">4.3 深拷贝的业务价值</h4> <ul> <li>原图永远作为「底图」，支持用户随时点击「重置图片」恢复原始状态；</li> <li>工作图可以任意进行缩放、平移、标注等操作，无需担心影响原图；</li> <li>内存隔离，避免数据混乱，保证程序逻辑的稳定性。</li> </ul> <h3 data-id="heading-17">五、图片等比例撑满画布的核心缩放算法（黄金公式）</h3> <h4 data-id="heading-18">5.1 核心业务需求</h4> <p>图片缩放的第一优先级永远是：保证图片完整显示，不裁剪、不变形；第二优先级是：尽可能撑满显示容器，提升视觉体验。这也是所有图片查看器（系统相册、Photoshop、画图工具）的默认缩放逻辑。</p> <h4 data-id="heading-19">5.2 核心缩放算法实现</h4> <pre><code class="hljs language-rust" lang="rust">def <span class="hljs-title function_ invoke__">calculate_fill_scale</span>(<span class="hljs-keyword">self</span>, display_width=<span class="hljs-literal">None</span>, display_height=<span class="hljs-literal">None</span>): <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.current_image is <span class="hljs-literal">None</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> not display_width or not display_height: <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> display_width &lt; <span class="hljs-number">100</span> or display_height &lt; <span class="hljs-number">100</span>: <span class="hljs-keyword">return</span> h, w = <span class="hljs-keyword">self</span>.current_image.shape[:<span class="hljs-number">2</span>] # 获取图片真实宽高（高在前，宽在后） scale_x = display_width / w # 宽度方向的适配比例 scale_y = display_height / h # 高度方向的适配比例 <span class="hljs-keyword">self</span>.scale_factor = <span class="hljs-title function_ invoke__">min</span>(scale_x, scale_y) # 核心公式：取最小比例 event_bus.<span class="hljs-title function_ invoke__">publish</span>(<span class="hljs-string">"SCALE_UPDATED"</span>, scale=<span class="hljs-title function_ invoke__">int</span>(<span class="hljs-keyword">self</span>.scale_factor*<span class="hljs-number">100</span>)) event_bus.<span class="hljs-title function_ invoke__">publish</span>(<span class="hljs-string">"REQUEST_RENDER"</span>)</code></pre> <h4 data-id="heading-20">5.3 黄金公式解析：self.scale_factor = min(scale_x, scale_y)</h4> <p>这是图片等比例缩放的核心精髓，该公式的设计逻辑完美兼顾两个优先级：</p> <ul> <li>取两个方向的最小缩放比例，可以保证图片在「宽度、高度」两个维度都能完整适配画布，不会出现任何溢出和裁剪；</li> <li>该公式对「大图」和「小图」的处理是完全对称且自适应的： <ul> <li>当图片尺寸 &gt; 画布尺寸：计算出&lt; 1的缩放比例，图片被等比例缩小，撑满画布且无溢出；</li> <li>当图片尺寸 &lt; 画布尺寸：计算出&gt; 1的缩放比例，图片被等比例放大，撑满画布且无变形。</li> </ul> </li> </ul> <h4 data-id="heading-21">5.4 关键细节：为什么shape[0]是高度，shape[1]是宽度？</h4> <p>因为Numpy数组是行优先存储，图片的每一行对应数组的一个维度，shape属性返回的元组遵循固定规范：</p> <pre><code class="hljs language-scss" lang="scss">彩色图：(图片高度, 图片宽度, 通道数) → (h, w, <span class="hljs-number">3</span>) 灰度图：(图片高度, 图片宽度) → (h, w)</code></pre> <p>这是OpenCV+Numpy的固定规范，无需纠结，记住即可。</p> <h3 data-id="heading-22">六、关键健壮性判断解析：if display_width &lt; 100 or display_height &lt; 100</h3> <h4 data-id="heading-23">6.1 最常见的误区纠正</h4> <div class="tip"> <strong>重中之重</strong><br/> ✔️ 该判断的是「显示容器(画布)的尺寸」，不是「图片本身的尺寸」；<br/> ✔️ 哪怕图片真实尺寸只有50x50像素（超小图），也完全不受该判断的影响；<br/> ✔️ 该判断的变量display_width/display_height是图片的展示窗口/控件尺寸，而非self.current_image.shape的图片尺寸。 </div> <h4 data-id="heading-24">6.2 该判断的三大核心作用（缺一不可的工业级健壮性设计）</h4> <p>这行代码不是多余的，而是防止程序崩溃、避免无效计算、节省性能的关键，是从「demo级代码」到「生产级代码」的必经之路，优先级从高到低：</p> <ul> <li><strong>作用1：规避除零异常与浮点计算精度问题（核心）</strong>：程序运行时，画布尺寸可能为0或极小值，会导致缩放比例异常、渲染失败甚至程序闪退。</li> <li><strong>作用2：规避无意义的极端缩放比例</strong>：画布过小会计算出极小的缩放比例，图片缩到几乎看不见，无业务意义。100像素是合理的最小有效显示阈值。</li> <li><strong>作用3：节省无意义的性能开销</strong>：图片缩放和渲染是CPU密集型操作，画布过小时跳过计算，提升程序流畅度。</li> </ul> <h4 data-id="heading-25">6.3 小尺寸图片的处理逻辑（核心顾虑解答）</h4> <p><strong>结论：小尺寸图片会被正常处理，无任何影响！</strong></p> <p>举个例子：图片尺寸80x90像素，画布尺寸800x600像素，判断条件为False，程序正常执行缩放计算：scale_x=800/80=10.0，scale_y=600/90≈6.666，最终缩放比例为6.666，图片被等比例放大6.666倍，完美适配画布。</p> <h3 data-id="heading-26">七、发布订阅模式（事件总线）的解耦应用</h3> <p>本文代码中大量使用<code>event_bus.publish()</code>发布事件，这是工程化开发的最佳实践，核心价值是彻底解耦业务逻辑与UI更新：</p> <ul> <li>业务层（图片加载、缩放计算）只负责处理核心逻辑，无需关心「UI如何更新、哪些控件需要刷新」；</li> <li>UI层只需订阅对应的事件，事件触发时执行更新逻辑即可；</li> <li>新增功能时，只需新增事件订阅者，无需修改原有业务代码，完美符合「开闭原则」。</li> </ul> <p>核心发布的事件及作用：</p> <ul> <li>LOAD_IMAGE_PATH：通知文件夹服务加载当前图片所在文件夹；</li> <li>IMAGE_LOADED：图片加载完成，携带图片元信息，更新UI的图片信息展示；</li> <li>REQUEST_CALCULATE_FILL_SCALE：请求计算自适应缩放比例；</li> <li>SCALE_UPDATED：缩放比例更新，同步UI的缩放滑块和标签；</li> <li>REQUEST_RENDER：请求重绘图片，更新画布展示；</li> <li>ERROR_OCCURRED：捕获异常，展示错误提示。</li> </ul> <h3 data-id="heading-27">八、核心避坑点与最佳实践汇总</h3> <h4 data-id="heading-28">核心避坑点（开发中必踩，记牢即可）</h4> <ul> <li>不要使用cv2.imread()加载中文路径的图片，必出问题；</li> <li>不要直接赋值self.current_image = self.original_image，会导致原图被污染；</li> <li>不要用max(scale_x, scale_y)做缩放比例，会导致图片溢出画布被裁剪；</li> <li>不要混淆「画布尺寸」和「图片尺寸」，display_width &lt;100判断的是画布不是图片；</li> <li>不要忽略cv2.imdecode的返回值校验，解码失败会返回None，必抛异常。</li> </ul> <h4 data-id="heading-29">最佳实践（生产级代码规范，直接复用）</h4> <ul> <li>图片加载必用np.fromfile + cv2.imdecode黄金组合，兼容中文路径；</li> <li>原图与工作图必用numpy.copy()做深拷贝，保证内存隔离；</li> <li>等比例缩放必用min(scale_x, scale_y)黄金公式，兼顾完整显示与撑满画布；</li> <li>所有外部传入的参数必做合法性校验，避免异常；</li> <li>核心业务逻辑必加try-except异常捕获，友好兜底；</li> <li>业务与UI必用事件总线解耦，提升代码扩展性。</li> </ul> <h3 data-id="heading-30">总结</h3> <p>本文围绕Python+OpenCV实现图片浏览器的核心功能，深度解析了从「图片加载」到「缩放渲染」的全流程技术细节，核心知识点可总结为以下5点：</p> <ol> <li>OpenCV加载图片的最优解是np.fromfile + cv2.imdecode，解决中文路径问题，返回值为Numpy数组；</li> <li>Python中OpenCV的图像矩阵本质就是Numpy多维数组，所有Numpy操作均可直接作用于图像；</li> <li>图像深拷贝是保护原图的唯一方式，numpy.copy()是最优实现，浅引用绝对禁止；</li> <li>图片等比例缩放的核心是min(scale_x, scale_y)，完美兼顾完整显示与撑满画布；</li> <li>工业级代码的核心是「健壮性」，所有边界条件都要做校验，避免程序崩溃。</li> </ol> <p>这些知识点并非孤立存在，而是贯穿于所有Python+OpenCV的图像可视化开发中，掌握这些细节，不仅能写出稳定的图片浏览器，更能应对各类图像处理的实战场景。技术的深度，往往体现在对这些细节的理解与把控中。</p>  技术博客 | Python+OpenCV 图片浏览器核心解析 | 完   </div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🌟 JavaScript 数组终极指南：从零基础到工程级实战]]></title>    <link>https://juejin.cn/post/7594785614178353192</link>    <guid>https://juejin.cn/post/7594785614178353192</guid>    <pubDate>2026-01-14T10:24:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594785614178353192" data-draft-id="7594835618120679464" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🌟 JavaScript 数组终极指南：从零基础到工程级实战"/> <meta itemprop="keywords" content="前端,JavaScript,前端框架"/> <meta itemprop="datePublished" content="2026-01-14T10:24:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yira"/> <meta itemprop="url" content="https://juejin.cn/user/262123324974122"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🌟 JavaScript 数组终极指南：从零基础到工程级实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/262123324974122/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yira
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:24:53.000Z" title="Wed Jan 14 2026 10:24:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🌟 JavaScript 数组终极指南：从零基础到工程级实战</h2>
<p>在 JavaScript 的世界里，<strong>数组（Array）</strong>  不仅仅是一个“装东西的盒子”，它是一种高度灵活、功能强大、可扩展的数据结构。无论是处理用户列表、管理购物车商品、解析 API 返回数据，还是实现复杂算法，都离不开数组。</p>
<p>本文将带你<strong>彻底搞懂 JavaScript 数组</strong>——包括它的本质、创建方式、核心特性、常用方法、性能注意事项、常见陷阱，以及在现代开发中的最佳实践。</p>
<hr/>
<h3 data-id="heading-1">一、JavaScript 中到底有没有“真正的”数组？</h3>
<p>这是一个常被误解的问题。</p>
<h4 data-id="heading-2">✅ 答案：有，但和传统语言不同</h4>
<p>在 C/C++、Java 等静态语言中，数组是：</p>
<ul>
<li><strong>连续内存块</strong></li>
<li><strong>固定长度</strong></li>
<li><strong>同类型元素</strong></li>
</ul>
<p>而 JavaScript 的数组是：</p>
<ul>
<li><strong>基于对象（Object）实现的特殊对象</strong></li>
<li><strong>动态长度</strong></li>
<li><strong>可存储任意类型混合数据</strong></li>
<li><strong>支持稀疏结构（即索引不连续）</strong></li>
</ul>
<blockquote>
<p>🔍 技术细节：<br/>
在 V8 引擎（Chrome/Node.js 使用）中，JavaScript 数组会根据内容自动选择两种内部表示：</p>
<ul>
<li><strong>Fast Elements（快速元素）</strong> ：当数组是密集、类型一致时，使用类似 C 数组的连续内存优化。</li>
<li><strong>Dictionary Elements（字典元素）</strong> ：当数组稀疏或类型混杂时，退化为哈希表存储，性能下降。</li>
</ul>
</blockquote>
<p>因此，虽然 JS 数组“看起来像”传统数组，但其底层更接近“带数字键的对象”。</p>
<hr/>
<h3 data-id="heading-3">二、如何创建数组？四种方式详解</h3>
<h4 data-id="heading-4">1. <strong>数组字面量（推荐 ✅）</strong></h4>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">arr</span> = [<span class="hljs-number">1</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-literal">true</span>]<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>最简洁、最高效</li>
<li>自动推断长度</li>
<li>支持尾随逗号（利于 Git diff）</li>
</ul>
<h4 data-id="heading-5">2. <strong>Array 构造函数（谨慎使用 ⚠️）</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传入多个参数 → 创建包含这些元素的数组</span>
<span class="hljs-keyword">const</span> a1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 传入单个数字 → 创建指定长度的空数组（⚠️陷阱！）</span>
<span class="hljs-keyword">const</span> a2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">5</span>); <span class="hljs-comment">// [empty × 5]，不是 [5]！</span>
</code></pre>
<blockquote>
<p>❗ 危险点：<code>new Array(3)</code> 不等于 <code>[3]</code>，前者是长度为 3 的空数组，后者是包含数字 3 的数组。</p>
</blockquote>
<h4 data-id="heading-6">3. <strong>Array.of()（安全替代构造函数）</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">5</span>);        <span class="hljs-comment">// [5]</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);  <span class="hljs-comment">// [1, 2, 3]</span>
</code></pre>
<ul>
<li>无论传几个参数，都作为元素放入数组</li>
<li>解决 <code>new Array(n)</code> 的歧义问题</li>
</ul>
<h4 data-id="heading-7">4. <strong>Array.from()（从类数组或可迭代对象创建）</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 从字符串</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'abc'</span>); <span class="hljs-comment">// ['a', 'b', 'c']</span>

<span class="hljs-comment">// 从 NodeList</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'div'</span>));

<span class="hljs-comment">// 从 Set</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>])); <span class="hljs-comment">// [1, 2]</span>

<span class="hljs-comment">// 带映射函数</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">3</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i * <span class="hljs-number">2</span>); <span class="hljs-comment">// [0, 2, 4]</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">三、数组的核心属性与判断方法</h3>
<h4 data-id="heading-9">1. <code>length</code> 属性</h4>
<ul>
<li>可读可写</li>
<li>表示“最大整数索引 + 1”，不是实际元素个数（稀疏数组时尤其注意）</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">arr</span> = []<span class="hljs-comment">;</span>
arr<span class="hljs-section">[99]</span> = 'last'<span class="hljs-comment">;</span>
console.log(arr.length)<span class="hljs-comment">; // 100</span>
console.log(Object.keys(arr).length)<span class="hljs-comment">; // 1（实际只有1个元素）</span>
</code></pre>
<h4 data-id="heading-10">2. 如何判断一个变量是数组？</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 错误方式</span>
<span class="hljs-keyword">typeof</span> []; <span class="hljs-comment">// "object"</span>

<span class="hljs-comment">// ✅ 正确方式</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([]); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 兼容旧浏览器（不推荐）</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([]) === <span class="hljs-string">'[object Array]'</span>;
</code></pre>
<hr/>
<h3 data-id="heading-11">四、数组操作全景图（按功能分类）</h3>
<h4 data-id="heading-12">A. <strong>增删改查（CRUD）</strong></h4>
<p>表格</p>















































<table><thead><tr><th>操作</th><th>方法</th><th>是否修改原数组</th><th>返回值</th></tr></thead><tbody><tr><td>末尾添加</td><td><code>push()</code></td><td>✅ 是</td><td>新长度</td></tr><tr><td>开头添加</td><td><code>unshift()</code></td><td>✅ 是</td><td>新长度</td></tr><tr><td>末尾删除</td><td><code>pop()</code></td><td>✅ 是</td><td>被删元素</td></tr><tr><td>开头删除</td><td><code>shift()</code></td><td>✅ 是</td><td>被删元素</td></tr><tr><td>任意位置增删</td><td><code>splice(start, deleteCount, ...items)</code></td><td>✅ 是</td><td>被删元素组成的数组</td></tr><tr><td>替换/插入（不修改原数组）</td><td><code>toSpliced()</code>（ES2023）</td><td>❌ 否</td><td>新数组</td></tr></tbody></table>
<blockquote>
<p>💡 示例：</p>
<pre><code class="hljs language-css" lang="css">const arr = <span class="hljs-selector-attr">[1, 2, 3]</span>;
arr<span class="hljs-selector-class">.splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, '<span class="hljs-selector-tag">a</span>', '<span class="hljs-selector-tag">b</span>'); // 从索引<span class="hljs-number">1</span>删<span class="hljs-number">1</span>个，插入'<span class="hljs-selector-tag">a</span>','<span class="hljs-selector-tag">b</span>'
console<span class="hljs-selector-class">.log</span>(arr); // <span class="hljs-selector-attr">[1, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, 3]</span>
</code></pre>
</blockquote>
<hr/>
<h4 data-id="heading-13">B. <strong>遍历与转换（函数式编程核心）</strong></h4>
<p>表格</p>















































<table><thead><tr><th>方法</th><th>用途</th><th>是否修改原数组</th><th>返回值</th></tr></thead><tbody><tr><td><code>forEach()</code></td><td>遍历执行副作用</td><td>❌</td><td>undefined</td></tr><tr><td><code>map()</code></td><td>映射新值</td><td>❌</td><td>新数组</td></tr><tr><td><code>filter()</code></td><td>过滤符合条件的</td><td>❌</td><td>新数组</td></tr><tr><td><code>reduce()</code></td><td>聚合计算（求和、扁平化等）</td><td>❌</td><td>累积值</td></tr><tr><td><code>find()</code> / <code>findIndex()</code></td><td>查找第一个匹配项</td><td>❌</td><td>元素 / 索引</td></tr><tr><td><code>some()</code> / <code>every()</code></td><td>判断是否存在 / 是否全部满足</td><td>❌</td><td>布尔值</td></tr></tbody></table>
<blockquote>
<p>🧠 关键区别：</p>
<ul>
<li><code>map</code> 必须返回新值，用于<strong>转换</strong></li>
<li><code>forEach</code> 用于<strong>执行操作</strong>（如 DOM 更新、日志），不返回有用值</li>
</ul>
</blockquote>
<hr/>
<h4 data-id="heading-14">C. <strong>搜索与判断</strong></h4>
<pre><code class="hljs language-scss" lang="scss">const nums = <span class="hljs-selector-attr">[10, 20, 30]</span>;

nums<span class="hljs-selector-class">.indexOf</span>(<span class="hljs-number">20</span>);      <span class="hljs-comment">// 1（找不到返回 -1）</span>
nums<span class="hljs-selector-class">.lastIndexOf</span>(<span class="hljs-number">20</span>);  <span class="hljs-comment">// 1（从后往前找）</span>

nums<span class="hljs-selector-class">.includes</span>(<span class="hljs-number">20</span>);     <span class="hljs-comment">// true（ES2016，更语义化）</span>

<span class="hljs-comment">// 支持 NaN</span>
<span class="hljs-selector-attr">[NaN]</span><span class="hljs-selector-class">.includes</span>(NaN);   <span class="hljs-comment">// true</span>
<span class="hljs-selector-attr">[NaN]</span><span class="hljs-selector-class">.indexOf</span>(NaN);    <span class="hljs-comment">// -1（因 NaN !== NaN）</span>
</code></pre>
<hr/>
<h4 data-id="heading-15">D. <strong>连接、切片与复制</strong></h4>
<p>表格</p>

























<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><code>concat()</code></td><td>合并多个数组或值，返回新数组</td></tr><tr><td><code>slice(start, end)</code></td><td>截取子数组（end 不包含），返回新数组</td></tr><tr><td><code>[...arr]</code></td><td>展开运算符，浅拷贝数组</td></tr><tr><td><code>Array.from(arr)</code></td><td>浅拷贝（也可用于类数组）</td></tr></tbody></table>
<blockquote>
<p>⚠️ 注意：以上均为<strong>浅拷贝</strong>！嵌套对象仍共享引用。</p>
</blockquote>
<hr/>
<h4 data-id="heading-16">E. <strong>排序与反转</strong></h4>
<pre><code class="hljs language-css" lang="css">const letters = <span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>]</span>;

letters<span class="hljs-selector-class">.sort</span>();        // <span class="hljs-selector-attr">[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]</span>（✅ 修改原数组！）
letters<span class="hljs-selector-class">.reverse</span>();     // <span class="hljs-selector-attr">[<span class="hljs-string">'c'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>]</span>（✅ 修改原数组！）

// 数字排序需传比较函数
<span class="hljs-selector-attr">[10, 2, 30]</span><span class="hljs-selector-class">.sort</span>((<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>) =&gt; <span class="hljs-selector-tag">a</span> - <span class="hljs-selector-tag">b</span>); // <span class="hljs-selector-attr">[2, 10, 30]</span>
</code></pre>
<blockquote>
<p>❗ 重要：<code>sort()</code> 和 <code>reverse()</code> <strong>会直接修改原数组</strong>，若需保留原数据，先复制再操作。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">五、高级技巧与工程实践</h3>
<h4 data-id="heading-18">1. <strong>不可变性（Immutability）原则</strong></h4>
<p>在 React、Redux 等现代框架中，强调“不直接修改状态”。因此应避免 <code>push</code>、<code>splice</code> 等方法，改用：</p>
<pre><code class="hljs language-ini" lang="ini">// ❌ 不推荐（修改原数组）
state.items.push(newItem)<span class="hljs-comment">;</span>

// ✅ 推荐（返回新数组）
const <span class="hljs-attr">newItems</span> = [...state.items, newItem]<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-19">2. <strong>扁平化嵌套数组</strong></h4>
<pre><code class="hljs language-scss" lang="scss">const nested = <span class="hljs-selector-attr">[1, [2, [3, [4]</span>]]];

nested<span class="hljs-selector-class">.flat</span>();        <span class="hljs-comment">// [1, 2, [3, [4]]]</span>
nested<span class="hljs-selector-class">.flat</span>(<span class="hljs-number">2</span>);       <span class="hljs-comment">// [1, 2, 3, [4]]</span>
nested<span class="hljs-selector-class">.flat</span>(Infinity); <span class="hljs-comment">// [1, 2, 3, 4]（彻底扁平化）</span>

<span class="hljs-comment">// 或用 reduce 递归实现</span>
</code></pre>
<h4 data-id="heading-20">3. <strong>去重（Deduplication）</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基本类型去重</span>
<span class="hljs-keyword">const</span> unique = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])]; <span class="hljs-comment">// [1, 2, 3]</span>

<span class="hljs-comment">// 对象数组去重（按 id）</span>
<span class="hljs-keyword">const</span> users = [{<span class="hljs-attr">id</span>:<span class="hljs-number">1</span>}, {<span class="hljs-attr">id</span>:<span class="hljs-number">2</span>}, {<span class="hljs-attr">id</span>:<span class="hljs-number">1</span>}];
<span class="hljs-keyword">const</span> seen = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
<span class="hljs-keyword">const</span> uniqueUsers = users.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (seen.<span class="hljs-title function_">has</span>(user.<span class="hljs-property">id</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  seen.<span class="hljs-title function_">add</span>(user.<span class="hljs-property">id</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
});
</code></pre>
<h4 data-id="heading-21">4. <strong>性能建议</strong></h4>
<ul>
<li>避免频繁在数组开头 <code>unshift</code>/<code>shift</code>（时间复杂度 O(n)）</li>
<li>大量数据处理优先用 <code>for</code> 循环（比 <code>forEach</code> 快），但牺牲可读性</li>
<li>稀疏数组慎用，可能触发引擎降级到字典模式</li>
</ul>
<hr/>
<h3 data-id="heading-22">六、常见误区与陷阱</h3>
<h4 data-id="heading-23">❌ 误区 1：<code>[] == false</code> 所以数组是假值？</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Boolean</span>([]); <span class="hljs-comment">// true！空数组是真值</span>
if ([]) console<span class="hljs-selector-class">.log</span>('yes'); <span class="hljs-comment">// 会执行</span>
</code></pre>
<blockquote>
<p>原因：所有对象（包括空数组、空对象）在布尔上下文中都是 <code>true</code>。</p>
</blockquote>
<h4 data-id="heading-24">❌ 误区 2：<code>arr.length = 0</code> 会清空数组？</h4>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">a</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<span class="hljs-comment">;</span>
let <span class="hljs-attr">b</span> = a<span class="hljs-comment">;</span>
<span class="hljs-attr">a.length</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
console.log(b)<span class="hljs-comment">; // [] —— 因为 a 和 b 指向同一引用！</span>
</code></pre>
<h4 data-id="heading-25">❌ 误区 3：<code>delete arr[1]</code> 会缩短数组？</h4>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">arr</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]<span class="hljs-comment">;</span>
delete arr<span class="hljs-section">[1]</span><span class="hljs-comment">;</span>
console.log(arr)<span class="hljs-comment">;        // [1, empty, 3]</span>
console.log(arr.length)<span class="hljs-comment">; // 3（长度不变！）</span>
</code></pre>
<blockquote>
<p>正确做法：用 <code>splice(1, 1)</code> 删除并收缩数组。</p>
</blockquote>
<hr/>
<h3 data-id="heading-26">七、总结：数组使用心法</h3>
<p>表格</p>





































<table><thead><tr><th>场景</th><th>推荐方法</th></tr></thead><tbody><tr><td>添加元素</td><td><code>push</code>（末尾）、<code>...</code> + <code>concat</code>（不可变）</td></tr><tr><td>删除元素</td><td><code>filter</code>（不可变）、<code>splice</code>（可变）</td></tr><tr><td>遍历处理</td><td><code>map</code>（转换）、<code>forEach</code>（副作用）</td></tr><tr><td>条件筛选</td><td><code>filter</code>、<code>find</code>、<code>some</code></td></tr><tr><td>聚合计算</td><td><code>reduce</code></td></tr><tr><td>安全复制</td><td><code>[...arr]</code>、<code>Array.from(arr)</code></td></tr><tr><td>判断类型</td><td><code>Array.isArray()</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-27">八、动手练习（巩固理解）</h3>
<ol>
<li>将字符串 <code>'the quick brown fox'</code> 转为每个单词首字母大写：<code>'The Quick Brown Fox'</code></li>
<li>找出数组中重复的元素：<code>[1, 2, 2, 3, 4, 4]</code> → <code>[2, 4]</code></li>
<li>实现一个 <code>chunk</code> 函数，将数组每 3 个分一组：<code>[1,2,3,4,5]</code> → <code>[[1,2,3], [4,5]]</code></li>
</ol>
<blockquote>
<p>💡 提示：多用 <code>map</code>、<code>reduce</code>、<code>Set</code> 组合解决！</p>
</blockquote>
<hr/>
<h3 data-id="heading-28">结语</h3>
<p>JavaScript 数组看似简单，实则博大精深。它既是新手入门的第一道关卡，也是高手优化性能的关键战场。<strong>理解其本质、掌握其方法、避开其陷阱</strong>，你就能在任何 JavaScript 项目中游刃有余。</p>
<blockquote>
<p>📚 建议收藏本文，作为日常开发的“数组速查手册”。</p>
</blockquote>
<p>如果你希望我针对某个方法（比如 <code>reduce</code> 的 10 种用法）做专题详解，欢迎继续提问！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[还在申请云服务器来传输数据嘛？试试P2P直连吧]]></title>    <link>https://juejin.cn/post/7595043440519544838</link>    <guid>https://juejin.cn/post/7595043440519544838</guid>    <pubDate>2026-01-14T10:29:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595043440519544838" data-draft-id="7594791357144219690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="还在申请云服务器来传输数据嘛？试试P2P直连吧"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2026-01-14T10:29:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐叔在学习"/> <meta itemprop="url" content="https://juejin.cn/user/4009253326568761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            还在申请云服务器来传输数据嘛？试试P2P直连吧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4009253326568761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐叔在学习
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:29:16.000Z" title="Wed Jan 14 2026 10:29:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本篇文章是最近开发「Todo-List」应用的 <code>P2P</code> 数据传输功能的经验分享！</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>一般用户与用户间的数据交互是咋样的呢？</p>
<p>用户A要发送数据给用户B，那么用户A需要先将数据发送给服务器，服务器接收数据并存储后，再中转给用户B。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph A [C/S 模式]
        direction TB
        S[&lt;b&gt;中央服务器&lt;/b&gt;&lt;br&gt;唯一数据源与逻辑中心] &lt;-- &lt;b&gt;数据传输&lt;/b&gt; --&gt; C1[客户端A]
        S &lt;-- &lt;b&gt;数据传输&lt;/b&gt; --&gt; C2[客户端B]
        S &lt;-- &lt;b&gt;数据传输&lt;/b&gt; --&gt; C3[...]
        style S fill:#ffcccc
    end
</code></pre>
<p>也就是经典的「客户端-服务器」模式。</p>
<p>这种方式最常见于各种商业化运作的企业，可以有效管理和掌控用户数据。但相对于个体开发者应用反倒可能是劣势。</p>
<ul>
<li>
<p>有些个体开发者应用并不需要用户间经常性的数据交互，那么要为此配置一台24h在线的服务器做交互，还是有点成本的；</p>
</li>
<li>
<p>另外，如果采用这种模式，数据交互的稳定性很大程度上取决于服务器资源和带宽，服务器挂了，整个交互就瘫痪了。</p>
</li>
</ul>
<p>可能有人会问：可不可以不经过服务器，直接用户和用户之间进行交互呢？这就是今天要介绍的 <code>P2P</code> 模式。</p>
<hr/>
<p><strong>P2P传输（Peer-to-Peer，点对点传输）</strong> 无需依赖中心服务器进行中转或调度，<strong>参与者之间直接共享资源</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph A [P2P 模式]
        direction TB
        P1[参与者A&lt;br&gt;兼具客户端与服务端功能] &lt;--&gt; P2[参与者B&lt;br&gt;兼具客户端与服务端功能]
        P2 &lt;--&gt; P3[...]
        P3 &lt;--&gt; P1
    end
</code></pre>
<p>通过这种无中心化的方式，不再依赖任何单一节点，从个体开发者来说，开发和维护非单机简单应用，成本可以是0的。</p>
<p>就以我最近开发的「Todo-List」应用为例，数据基本是单机应用数据，唯一需要进行交互的就桌面端应用和手机端应用的数据同步，完全可以采用这种模式进行数据同步的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dec48ced7769495b8580f83addac0968~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991356&amp;x-signature=ZJoc1z%2BkbwoTSPFGecYgfXTILZU%3D" alt="P2P效果封面.png" loading="lazy"/></p>
<p>目前打通了局域网 <code>P2P</code> 数据传输问题，还在考虑端口要不要持续保持开启状态，从而实现两端自动化数据同步；以及实现内网穿透，在公网也能进行数据传输(这个有点上难度，尤其是国内多层NAT的情况下)……</p>
<hr/>
<h2 data-id="heading-1">交互逻辑</h2>
<p>来说说具体实现吧——局域网内的 <code>P2P</code> 大体的交互是这样的：</p>
<p>存在P2P服务器端分享数据，P2P客户端接收数据</p>
<ul>
<li>
<p>P2P服务器在局域网内暴露端口号和 <code>IP</code></p>
</li>
<li>
<p>P2P客户端扫描局域网内暴露指定端口号的设备，并发现P2P服务器</p>
</li>
<li>
<p>P2P客户端和P2P服务器建立连接，并进行数据传输</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e51674539d479d86fe2b6ec8838d3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5ZSQ5Y-U5Zyo5a2m5Lmg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991356&amp;x-signature=R9cDfRpmzZZEY4cW7okjryLgZNM%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">代码实现</h2>
<p>代码实现的话，在理解思路后其实可以使用 <code>AI</code> 辅助编码的。这里提供「Todo-List」基于 <code>AI</code> 精简后的 <code>python</code> 版本代码实现。</p>
<h3 data-id="heading-3">p2p_server</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
P2P服务器模块 - 负责监听并共享数据
精简版本：移除防火墙管理，专注于核心监听和共享功能
"""</span>
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">Tuple</span>, <span class="hljs-type">Callable</span>, <span class="hljs-type">Any</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">P2PServer</span>:
    <span class="hljs-string">"""P2P服务器，用于在局域网内共享数据"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, port: <span class="hljs-built_in">int</span> = <span class="hljs-number">5000</span></span>):
        <span class="hljs-string">"""
        初始化P2P服务器

        Args:
            port: 监听端口，默认5000
        """</span>
        self.port = port
        self.server_socket: <span class="hljs-type">Optional</span>[socket.socket] = <span class="hljs-literal">None</span>
        self.is_running = <span class="hljs-literal">False</span>
        self.on_data_request_callback: <span class="hljs-type">Optional</span>[<span class="hljs-type">Callable</span>] = <span class="hljs-literal">None</span>

        <span class="hljs-comment"># 数据共享函数（默认返回空数据）</span>
        self._shared_data = {}

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start</span>(<span class="hljs-params">self, shared_data: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""
        启动P2P服务器

        Args:
            shared_data: 要共享的数据字典

        Returns:
            (是否成功, 消息) 元组
        """</span>
        <span class="hljs-keyword">if</span> self.is_running:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">"服务器已在运行中"</span>

        <span class="hljs-comment"># 设置共享数据</span>
        <span class="hljs-keyword">if</span> shared_data:
            self._shared_data = shared_data

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 创建TCP服务器socket</span>
            self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)
            self.server_socket.bind((<span class="hljs-string">'0.0.0.0'</span>, self.port))
            self.server_socket.listen(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 最多5个等待连接</span>
            self.is_running = <span class="hljs-literal">True</span>

            <span class="hljs-comment"># 启动监听线程</span>
            listen_thread = threading.Thread(
                target=self._listen_for_connections,
                daemon=<span class="hljs-literal">True</span>
            )
            listen_thread.start()

            local_ip = self.get_local_ip()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] ✓ 服务器启动成功"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器]   监听地址: 0.0.0.0:<span class="hljs-subst">{self.port}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器]   本机IP: <span class="hljs-subst">{local_ip}</span>"</span>)

            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">f"服务器启动成功，本机IP: <span class="hljs-subst">{local_ip}</span>"</span>

        <span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> e:
            error_msg = <span class="hljs-string">f"端口 <span class="hljs-subst">{self.port}</span> 被占用: <span class="hljs-subst">{e}</span>"</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] ✗ <span class="hljs-subst">{error_msg}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, error_msg
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            error_msg = <span class="hljs-string">f"服务器启动失败: <span class="hljs-subst">{e}</span>"</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] ✗ <span class="hljs-subst">{error_msg}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, error_msg

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_data_request_callback</span>(<span class="hljs-params">self, callback: <span class="hljs-type">Callable</span></span>):
        <span class="hljs-string">"""
        设置数据请求回调函数

        Args:
            callback: 当收到数据请求时调用的函数，返回要共享的数据字典
        """</span>
        self.on_data_request_callback = callback

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_shared_data</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""
        设置要共享的数据

        Args:
            data: 要共享的数据字典
        """</span>
        self._shared_data = data
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 共享数据已更新: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data)}</span> 项"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""
        停止服务器

        Returns:
            (是否成功, 消息) 元组
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.is_running:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">"服务器未运行"</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 正在停止服务器..."</span>)

        self.is_running = <span class="hljs-literal">False</span>

        <span class="hljs-keyword">if</span> self.server_socket:
            <span class="hljs-keyword">try</span>:
                self.server_socket.close()
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
            self.server_socket = <span class="hljs-literal">None</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] ✓ 服务器已停止"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, <span class="hljs-string">"服务器已停止"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_listen_for_connections</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        监听客户端连接（在独立线程中运行）
        """</span>
        <span class="hljs-keyword">while</span> self.is_running:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 设置超时以便定期检查is_running</span>
                self.server_socket.settimeout(<span class="hljs-number">1.0</span>)
                client_socket, address = self.server_socket.accept()

                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 收到来自 <span class="hljs-subst">{address[<span class="hljs-number">0</span>]}</span>:<span class="hljs-subst">{address[<span class="hljs-number">1</span>]}</span> 的连接"</span>)

                <span class="hljs-comment"># 为每个客户端创建处理线程</span>
                client_thread = threading.Thread(
                    target=self._handle_client,
                    args=(client_socket, address),
                    daemon=<span class="hljs-literal">True</span>
                )
                client_thread.start()

            <span class="hljs-keyword">except</span> socket.timeout:
                <span class="hljs-comment"># 超时正常，继续循环</span>
                <span class="hljs-keyword">continue</span>
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-keyword">if</span> self.is_running:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 接受连接错误: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-keyword">break</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_handle_client</span>(<span class="hljs-params">self, client_socket: socket.socket, address: <span class="hljs-built_in">tuple</span></span>):
        <span class="hljs-string">"""
        处理客户端连接

        Args:
            client_socket: 客户端socket连接
            address: 客户端地址 (ip, port)
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 接收数据长度头（4字节）</span>
            length_data = self._receive_all(client_socket, <span class="hljs-number">4</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> length_data:
                <span class="hljs-keyword">return</span>

            data_length = struct.unpack(<span class="hljs-string">'!I'</span>, length_data)[<span class="hljs-number">0</span>]

            <span class="hljs-comment"># 接收实际数据</span>
            data_bytes = self._receive_all(client_socket, data_length)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data_bytes:
                <span class="hljs-keyword">return</span>

            <span class="hljs-comment"># 解析JSON数据</span>
            data = json.loads(data_bytes.decode(<span class="hljs-string">'utf-8'</span>))
            data_type = data.get(<span class="hljs-string">'type'</span>, <span class="hljs-string">'unknown'</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 收到 <span class="hljs-subst">{address[<span class="hljs-number">0</span>]}</span> 的请求: <span class="hljs-subst">{data_type}</span>"</span>)

            <span class="hljs-comment"># 处理数据请求</span>
            <span class="hljs-keyword">if</span> data_type == <span class="hljs-string">'request_data'</span>:
                <span class="hljs-comment"># 获取要共享的数据</span>
                <span class="hljs-keyword">if</span> self.on_data_request_callback:
                    shared_data = self.on_data_request_callback()
                <span class="hljs-keyword">else</span>:
                    shared_data = self._shared_data

                <span class="hljs-keyword">if</span> shared_data:
                    <span class="hljs-comment"># 发送共享数据</span>
                    self._send_data(client_socket, shared_data)
                    response = {<span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'数据发送成功'</span>}
                <span class="hljs-keyword">else</span>:
                    response = {<span class="hljs-string">'status'</span>: <span class="hljs-string">'error'</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'没有可共享的数据'</span>}

                <span class="hljs-comment"># 发送响应</span>
                self._send_response(client_socket, response)

            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 处理其他类型的数据</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 收到 <span class="hljs-subst">{data_type}</span> 类型数据: <span class="hljs-subst">{data}</span>"</span>)
                response = {<span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'数据接收成功'</span>}
                self._send_response(client_socket, response)

        <span class="hljs-keyword">except</span> json.JSONDecodeError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 数据格式错误"</span>)
            response = {<span class="hljs-string">'status'</span>: <span class="hljs-string">'error'</span>, <span class="hljs-string">'message'</span>: <span class="hljs-string">'数据格式错误'</span>}
            self._send_response(client_socket, response)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P服务器] 处理客户端错误: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">try</span>:
                response = {<span class="hljs-string">'status'</span>: <span class="hljs-string">'error'</span>, <span class="hljs-string">'message'</span>: <span class="hljs-built_in">str</span>(e)}
                self._send_response(client_socket, response)
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">pass</span>
        <span class="hljs-keyword">finally</span>:
            client_socket.close()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_receive_all</span>(<span class="hljs-params">self, sock: socket.socket, length: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bytes</span>]:
        <span class="hljs-string">"""
        接收指定长度的数据

        Args:
            sock: socket连接
            length: 期望接收的数据长度

        Returns:
            接收到的字节数据，失败返回None
        """</span>
        data = <span class="hljs-built_in">bytearray</span>()
        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(data) &lt; length:
            <span class="hljs-keyword">try</span>:
                chunk = sock.recv(length - <span class="hljs-built_in">len</span>(data))
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
                data.extend(chunk)
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_send_data</span>(<span class="hljs-params">self, sock: socket.socket, data: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""
        发送数据（长度 + 内容）

        Args:
            sock: socket连接
            data: 要发送的数据字典
        """</span>
        data_str = json.dumps(data, ensure_ascii=<span class="hljs-literal">False</span>)
        data_bytes = data_str.encode(<span class="hljs-string">'utf-8'</span>)
        length_data = struct.pack(<span class="hljs-string">'!I'</span>, <span class="hljs-built_in">len</span>(data_bytes))  <span class="hljs-comment"># 4字节长度头</span>
        sock.sendall(length_data + data_bytes)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_send_response</span>(<span class="hljs-params">self, sock: socket.socket, response: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-string">"""
        发送响应

        Args:
            sock: socket连接
            response: 响应数据字典
        """</span>
        response_str = json.dumps(response, ensure_ascii=<span class="hljs-literal">False</span>)
        response_bytes = response_str.encode(<span class="hljs-string">'utf-8'</span>)
        length_data = struct.pack(<span class="hljs-string">'!I'</span>, <span class="hljs-built_in">len</span>(response_bytes))
        sock.sendall(length_data + response_bytes)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""
        获取本机IP地址

        Returns:
            本机IP地址字符串
        """</span>
        <span class="hljs-keyword">try</span>:
            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            s.connect((<span class="hljs-string">"8.8.8.8"</span>, <span class="hljs-number">80</span>))
            local_ip = s.getsockname()[<span class="hljs-number">0</span>]
            s.close()
            <span class="hljs-keyword">return</span> local_ip
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"127.0.0.1"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_status</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">dict</span>:
        <span class="hljs-string">"""
        获取服务器状态

        Returns:
            服务器状态字典
        """</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'is_running'</span>: self.is_running,
            <span class="hljs-string">'port'</span>: self.port,
            <span class="hljs-string">'local_ip'</span>: self.get_local_ip(),
            <span class="hljs-string">'has_callback'</span>: self.on_data_request_callback <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>,
            <span class="hljs-string">'shared_data_size'</span>: <span class="hljs-built_in">len</span>(self._shared_data)
        }
</code></pre>
<h3 data-id="heading-4">p2p_client</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
P2P客户端模块 - 负责发现和接收共享数据
精简版本：移除防火墙管理，专注于核心发现和接收功能
"""</span>
<span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> struct
<span class="hljs-keyword">import</span> threading
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>, <span class="hljs-type">Tuple</span>


<span class="hljs-keyword">class</span> <span class="hljs-title class_">P2PClient</span>:
    <span class="hljs-string">"""P2P客户端，用于扫描局域网并接收共享数据"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, port: <span class="hljs-built_in">int</span> = <span class="hljs-number">5000</span></span>):
        <span class="hljs-string">"""
        初始化P2P客户端

        Args:
            port: P2P通信端口，默认5000
        """</span>
        self.port = port

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">scan_devices</span>(<span class="hljs-params">self, timeout: <span class="hljs-built_in">float</span> = <span class="hljs-number">3.0</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]]:
        <span class="hljs-string">"""
        扫描局域网内可用的P2P设备

        Args:
            timeout: 扫描超时时间（秒），默认3秒

        Returns:
            设备列表，每个设备为 (ip, hostname) 元组
        """</span>
        devices = []

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 获取本机IP和网段</span>
            local_ip = self.get_local_ip()
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> local_ip <span class="hljs-keyword">or</span> local_ip == <span class="hljs-string">"127.0.0.1"</span>:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"[P2P客户端] 无法获取有效的本机IP地址"</span>)
                <span class="hljs-keyword">return</span> devices

            <span class="hljs-comment"># 解析网段（例如: 192.168.1.0/24）</span>
            ip_parts = local_ip.split(<span class="hljs-string">'.'</span>)
            network_base = <span class="hljs-string">f"<span class="hljs-subst">{ip_parts[<span class="hljs-number">0</span>]}</span>.<span class="hljs-subst">{ip_parts[<span class="hljs-number">1</span>]}</span>.<span class="hljs-subst">{ip_parts[<span class="hljs-number">2</span>]}</span>"</span>

            <span class="hljs-comment"># 扫描网段内的设备</span>
            threads = []
            results = []

            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 开始扫描网段: <span class="hljs-subst">{network_base}</span>.0/24, 本机IP: <span class="hljs-subst">{local_ip}</span>"</span>)

            <span class="hljs-comment"># 创建扫描线程</span>
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">255</span>):
                target_ip = <span class="hljs-string">f"<span class="hljs-subst">{network_base}</span>.<span class="hljs-subst">{i}</span>"</span>
                thread = threading.Thread(
                    target=self._check_device,
                    args=(target_ip, timeout, results, local_ip)
                )
                thread.start()
                threads.append(thread)

            <span class="hljs-comment"># 等待所有线程完成</span>
            <span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads:
                thread.join()

            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 扫描完成，发现 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(results)}</span> 个设备"</span>)
            devices = [(ip, <span class="hljs-string">f"设备_<span class="hljs-subst">{ip}</span>"</span>) <span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> results]

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 扫描设备错误: <span class="hljs-subst">{e}</span>"</span>)

        <span class="hljs-keyword">return</span> devices

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_check_device</span>(<span class="hljs-params">self, ip: <span class="hljs-built_in">str</span>, timeout: <span class="hljs-built_in">float</span>, results: <span class="hljs-built_in">list</span>, local_ip: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        检查指定IP是否开放了P2P服务

        Args:
            ip: 目标IP地址
            timeout: 连接超时时间
            results: 存储结果的列表
            local_ip: 本机IP地址（用于跳过自身）
        """</span>
        <span class="hljs-comment"># 跳过本机IP</span>
        <span class="hljs-keyword">if</span> ip == local_ip:
            <span class="hljs-keyword">return</span>

        <span class="hljs-keyword">try</span>:
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(timeout)

            <span class="hljs-comment"># 尝试连接目标端口</span>
            result = sock.connect_ex((ip, self.port))
            <span class="hljs-keyword">if</span> result == <span class="hljs-number">0</span>:
                results.append(ip)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 发现设备: <span class="hljs-subst">{ip}</span>"</span>)

            sock.close()
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">pass</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">receive_data</span>(<span class="hljs-params">self, ip: <span class="hljs-built_in">str</span>, timeout: <span class="hljs-built_in">int</span> = <span class="hljs-number">30</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>]:
        <span class="hljs-string">"""
        从指定设备接收数据

        Args:
            ip: 目标设备IP地址
            timeout: 超时时间（秒），默认30秒

        Returns:
            接收到的数据字典，失败返回None
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 正在连接 <span class="hljs-subst">{ip}</span>:<span class="hljs-subst">{self.port}</span>..."</span>)

            <span class="hljs-comment"># 建立TCP连接</span>
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            sock.settimeout(timeout)
            sock.connect((ip, self.port))

            <span class="hljs-comment"># 发送数据请求</span>
            request = json.dumps({<span class="hljs-string">'type'</span>: <span class="hljs-string">'request_data'</span>})
            self._send_data(sock, request)

            <span class="hljs-comment"># 接收数据长度（4字节）</span>
            length_data = self._receive_all(sock, <span class="hljs-number">4</span>)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> length_data:
                sock.close()
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

            data_length = struct.unpack(<span class="hljs-string">'!I'</span>, length_data)[<span class="hljs-number">0</span>]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 接收数据长度: <span class="hljs-subst">{data_length}</span> bytes"</span>)

            <span class="hljs-comment"># 接收数据内容</span>
            data_bytes = self._receive_all(sock, data_length)
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data_bytes:
                sock.close()
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

            <span class="hljs-comment"># 解析JSON数据</span>
            data = json.loads(data_bytes.decode(<span class="hljs-string">'utf-8'</span>))

            <span class="hljs-comment"># 接收响应确认</span>
            response_length_data = self._receive_all(sock, <span class="hljs-number">4</span>)
            <span class="hljs-keyword">if</span> response_length_data:
                response_length = struct.unpack(<span class="hljs-string">'!I'</span>, response_length_data)[<span class="hljs-number">0</span>]
                response_data = self._receive_all(sock, response_length)
                <span class="hljs-keyword">if</span> response_data:
                    response = json.loads(response_data.decode(<span class="hljs-string">'utf-8'</span>))
                    <span class="hljs-keyword">if</span> response.get(<span class="hljs-string">'status'</span>) == <span class="hljs-string">'success'</span>:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 数据接收成功"</span>)
                    <span class="hljs-keyword">else</span>:
                        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 数据接收失败: <span class="hljs-subst">{response.get(<span class="hljs-string">'message'</span>)}</span>"</span>)

            sock.close()
            <span class="hljs-keyword">return</span> data

        <span class="hljs-keyword">except</span> socket.timeout:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 连接超时: <span class="hljs-subst">{ip}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> ConnectionRefusedError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 连接被拒绝: <span class="hljs-subst">{ip}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[P2P客户端] 接收数据错误: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_send_data</span>(<span class="hljs-params">self, sock: socket.socket, data: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        发送数据（长度 + 内容）

        Args:
            sock: socket连接
            data: 要发送的字符串数据
        """</span>
        data_bytes = data.encode(<span class="hljs-string">'utf-8'</span>)
        length_data = struct.pack(<span class="hljs-string">'!I'</span>, <span class="hljs-built_in">len</span>(data_bytes))  <span class="hljs-comment"># 4字节长度头</span>
        sock.sendall(length_data + data_bytes)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_receive_all</span>(<span class="hljs-params">self, sock: socket.socket, length: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bytes</span>]:
        <span class="hljs-string">"""
        接收指定长度的数据

        Args:
            sock: socket连接
            length: 期望接收的数据长度

        Returns:
            接收到的字节数据，失败返回None
        """</span>
        data = <span class="hljs-built_in">bytearray</span>()
        <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(data) &lt; length:
            <span class="hljs-keyword">try</span>:
                chunk = sock.recv(length - <span class="hljs-built_in">len</span>(data))
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> chunk:
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
                data.extend(chunk)
            <span class="hljs-keyword">except</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bytes</span>(data)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_local_ip</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""
        获取本机IP地址

        Returns:
            本机IP地址字符串
        """</span>
        <span class="hljs-keyword">try</span>:
            s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            s.connect((<span class="hljs-string">"8.8.8.8"</span>, <span class="hljs-number">80</span>))
            local_ip = s.getsockname()[<span class="hljs-number">0</span>]
            s.close()
            <span class="hljs-keyword">return</span> local_ip
        <span class="hljs-keyword">except</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"127.0.0.1"</span>
</code></pre>
<h3 data-id="heading-5">p2p_test_example</h3>
<p>实际测验时，需要开启两个测试类，一个模拟服务端、一个模拟客户端；<strong>另外如果是真实环境使用，需要额外考虑防火墙问题，这里就不做展开了</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
P2P示例代码 - 演示如何使用精简版P2P库
"""</span>
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> p2p_server <span class="hljs-keyword">import</span> P2PServer
<span class="hljs-keyword">from</span> p2p_client <span class="hljs-keyword">import</span> P2PClient


<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_server_example</span>():
    <span class="hljs-string">"""运行服务器示例"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== P2P服务器示例 ==="</span>)

    <span class="hljs-comment"># 创建服务器实例</span>
    server = P2PServer(port=<span class="hljs-number">5000</span>)

    <span class="hljs-comment"># 设置要共享的数据</span>
    shared_data = {
        <span class="hljs-string">'device_name'</span>: <span class="hljs-string">'我的设备'</span>,
        <span class="hljs-string">'device_type'</span>: <span class="hljs-string">'电脑'</span>,
        <span class="hljs-string">'timestamp'</span>: time.time(),
        <span class="hljs-string">'message'</span>: <span class="hljs-string">'你好，这是共享的数据！'</span>,
        <span class="hljs-string">'data'</span>: {
            <span class="hljs-string">'item1'</span>: <span class="hljs-string">'值1'</span>,
            <span class="hljs-string">'item2'</span>: <span class="hljs-string">'值2'</span>,
            <span class="hljs-string">'item3'</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]
        }
    }

    <span class="hljs-comment"># 启动服务器</span>
    success, message = server.start(shared_data)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> success:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"服务器启动失败: <span class="hljs-subst">{message}</span>"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"服务器状态: <span class="hljs-subst">{server.get_status()}</span>"</span>)

    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 保持服务器运行</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n正在停止服务器..."</span>)
        server.stop()


<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_client_example</span>():
    <span class="hljs-string">"""运行客户端示例"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== P2P客户端示例 ==="</span>)

    <span class="hljs-comment"># 创建客户端实例</span>
    client = P2PClient(port=<span class="hljs-number">5000</span>)

    <span class="hljs-comment"># 扫描局域网设备</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"正在扫描局域网设备..."</span>)
    devices = client.scan_devices(timeout=<span class="hljs-number">2.0</span>)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> devices:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"未发现任何设备"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"发现 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(devices)}</span> 个设备:"</span>)
    <span class="hljs-keyword">for</span> i, (ip, name) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(devices, <span class="hljs-number">1</span>):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{i}</span>. <span class="hljs-subst">{name}</span> (<span class="hljs-subst">{ip}</span>)"</span>)

    <span class="hljs-comment"># 从第一个设备接收数据</span>
    <span class="hljs-keyword">if</span> devices:
        target_ip = devices[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n正在从 <span class="hljs-subst">{target_ip}</span> 接收数据..."</span>)

        data = client.receive_data(target_ip, timeout=<span class="hljs-number">10</span>)

        <span class="hljs-keyword">if</span> data:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"接收到数据:"</span>)
            <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> data.items():
                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">dict</span>):
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{key}</span>: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(value)}</span> 项"</span>)
                <span class="hljs-keyword">else</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  <span class="hljs-subst">{key}</span>: <span class="hljs-subst">{value}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"数据接收失败"</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_full_example</span>():
    <span class="hljs-string">"""运行完整示例（需要在两个终端分别运行）"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"P2P系统完整示例"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span> * <span class="hljs-number">40</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. 启动服务器（共享数据）"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. 启动客户端（接收数据）"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. 退出"</span>)

    choice = <span class="hljs-built_in">input</span>(<span class="hljs-string">"请选择 (1/2/3): "</span>).strip()

    <span class="hljs-keyword">if</span> choice == <span class="hljs-string">'1'</span>:
        run_server_example()
    <span class="hljs-keyword">elif</span> choice == <span class="hljs-string">'2'</span>:
        run_client_example()
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"退出"</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    run_full_example()
</code></pre>
<h2 data-id="heading-6">结语</h2>
<p>当然，P2P直连也不是万能的，只适用于特定场景，大多数商业化场景下还是要考虑C/S连接，或者其变体B/S连接。</p>
<p>好啦，以上就是今天分享的内容啦。感谢阅读，如果觉得对你有帮助，记得三连哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端批量请求的并发控制与工程化实践]]></title>    <link>https://juejin.cn/post/7594813727054217250</link>    <guid>https://juejin.cn/post/7594813727054217250</guid>    <pubDate>2026-01-14T10:18:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727054217250" data-draft-id="7594835618120433704" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端批量请求的并发控制与工程化实践"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-01-14T10:18:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敲代码的阿凡驴"/> <meta itemprop="url" content="https://juejin.cn/user/2447990287511436"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端批量请求的并发控制与工程化实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2447990287511436/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敲代码的阿凡驴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:18:59.000Z" title="Wed Jan 14 2026 10:18:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇文章中，我们已经完成了数据准备工作。本篇将重点介绍一个在真实业务中<strong>几乎绕不开的问题</strong>：</p>
<blockquote>
<p><strong>当需要对一组数据逐个请求接口时，如何优雅、安全地进行批量请求？</strong></p>
</blockquote>
<p>如果处理不当，轻则页面卡顿，重则接口被限流甚至封禁。</p>
<hr/>
<h2 data-id="heading-0">一、为什么不能直接 <code>Promise.all</code>？</h2>
<p>最常见的写法是这样：</p>
<pre><code class="hljs language-ini" lang="ini">Promise.all(
  list.map(<span class="hljs-attr">item</span> =&gt; request(item))
)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-1">这个写法的问题在于：</h3>
<ul>
<li>
<p>并发数量 <strong>不可控</strong></p>
</li>
<li>
<p>列表一长就会：</p>
<ul>
<li>打满浏览器并发</li>
<li>压垮后端服务</li>
</ul>
</li>
<li>
<p>一旦某个请求失败，<strong>整体直接 reject</strong></p>
</li>
</ul>
<p>在区县、设备、用户、文件等<strong>数量不确定的场景</strong>下，这种方式风险极高。</p>
<hr/>
<h2 data-id="heading-2">二、我们真正需要的是什么？</h2>
<p>一个成熟的「批量请求」方案，至少应该满足：</p>
<ol>
<li><strong>限制并发数量</strong></li>
<li><strong>支持批次间隔（节流）</strong></li>
<li><strong>单个失败不影响整体流程</strong></li>
<li><strong>能够感知整体完成状态</strong></li>
<li><strong>结果和错误可以分开统计</strong></li>
</ol>
<hr/>
<h2 data-id="heading-3">三、核心设计思路</h2>
<h3 data-id="heading-4">1️⃣ 把“请求”和“执行”解耦</h3>
<ul>
<li>批量工具只负责 <strong>调度</strong></li>
<li>具体请求由调用方传入</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">(task) =&gt; <span class="hljs-title class_">Promise</span>
</code></pre>
<h3 data-id="heading-5">2️⃣ 固定并发数，分批执行</h3>
<ul>
<li>每一批最多 N 个任务</li>
<li>当前批次完成后，延迟一段时间再执行下一批</li>
</ul>
<h3 data-id="heading-6">3️⃣ 所有任务最终返回一个统一结果</h3>
<pre><code class="hljs language-ini" lang="ini">{
  results: <span class="hljs-section">[]</span>,
  errors: <span class="hljs-section">[]</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">四、批量请求使用方式（示例）</h2>
<p>下面是一个典型的使用方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">batchRequestWithLimit</span>(
  taskList,
  <span class="hljs-function">(<span class="hljs-params">task</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">apiRequest</span>(task);
  },
  <span class="hljs-function">(<span class="hljs-params">task, data</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`任务 <span class="hljs-subst">${task}</span> 成功`</span>, data);
  },
  <span class="hljs-number">5</span>,   <span class="hljs-comment">// 最大并发数</span>
  <span class="hljs-number">200</span>, <span class="hljs-comment">// 批次间隔（ms）</span>
)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">{ results, errors }</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
      <span class="hljs-string">`批量请求完成：成功 <span class="hljs-subst">${results.length}</span> 个，失败 <span class="hljs-subst">${errors.length}</span> 个`</span>
    );
  })
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"批量请求异常："</span>, err);
  });
</code></pre>
<p>从使用者视角看，这个方法具备：</p>
<ul>
<li><strong>调用简单</strong></li>
<li><strong>参数语义清晰</strong></li>
<li><strong>结果可控</strong></li>
</ul>
<hr/>
<h2 data-id="heading-8">五、执行流程拆解（非常关键）</h2>
<p>整个批量请求的生命周期可以拆成 5 步：</p>
<h3 data-id="heading-9">Step 1：任务队列初始化</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">queue</span> = [...taskList]<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">Step 2：取出当前批次</h3>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">batch</span> = queue.splice(<span class="hljs-number">0</span>, limit)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-11">Step 3：并发执行当前批次</h3>
<pre><code class="hljs language-ini" lang="ini">await Promise.allSettled(
  batch.map(<span class="hljs-attr">task</span> =&gt; executor(task))
)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-12">Step 4：等待节流时间</h3>
<pre><code class="hljs language-scss" lang="scss">await <span class="hljs-built_in">sleep</span>(interval);
</code></pre>
<h3 data-id="heading-13">Step 5：继续下一批，直到队列清空</h3>
<hr/>
<h2 data-id="heading-14">六、为什么 <code>Promise.allSettled</code> 是关键</h2>
<p>相比 <code>Promise.all</code>：</p>




















<table><thead><tr><th>方法</th><th>任一失败</th><th>结果可控</th></tr></thead><tbody><tr><td>Promise.all</td><td>❌ 整体失败</td><td>❌</td></tr><tr><td>Promise.allSettled</td><td>✅ 单独失败</td><td>✅</td></tr></tbody></table>
<p>在<strong>批量请求场景中</strong>：</p>
<blockquote>
<p><strong>失败是常态，而不是异常</strong></p>
</blockquote>
<p>我们要做的是：</p>
<ul>
<li>接受失败</li>
<li>记录失败</li>
<li>不中断流程</li>
</ul>
<hr/>
<h2 data-id="heading-15">七、这种模式适合哪些场景？</h2>
<p>这种批量请求模型，适用于：</p>
<ul>
<li>区县 / 城市 / 设备 / 用户 批量拉取</li>
<li>文件批量上传 / 下载</li>
<li>批量校验、扫描、统计</li>
<li>任何「数量不确定 + 接口有压力」的业务场景</li>
</ul>
<hr/>
<h2 data-id="heading-16">八、总结一句话</h2>
<blockquote>
<p><strong>批量请求不是“多发请求”，而是“有节制地并发执行任务”。</strong></p>
</blockquote>
<p>通过：</p>
<ul>
<li>限制并发</li>
<li>分批执行</li>
<li>错误隔离</li>
<li>统一收敛结果</li>
</ul>
<p>你可以把一个“危险操作”，变成一个<strong>可控、可扩展、可维护的工程能力</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[到底能不能把HTTP1.0讲明白了]]></title>    <link>https://juejin.cn/post/7595021077665824819</link>    <guid>https://juejin.cn/post/7595021077665824819</guid>    <pubDate>2026-01-14T10:27:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665824819" data-draft-id="7589093895326695433" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="到底能不能把HTTP1.0讲明白了"/> <meta itemprop="keywords" content="HTTP"/> <meta itemprop="datePublished" content="2026-01-14T10:27:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="瓦尔登湖懒羊羊"/> <meta itemprop="url" content="https://juejin.cn/user/2306138621099196"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            到底能不能把HTTP1.0讲明白了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2306138621099196/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    瓦尔登湖懒羊羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:27:47.000Z" title="Wed Jan 14 2026 10:27:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读20分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">应用层通信流程</h2>
<p>单单说“应用层之间通信”显然是不严谨的，因为 TCP/IP 网络协议栈中，应用层是最上面的一层，它只负责为用户提供服务，但是真正的通信数据是要向下交给传输层进行处理的。</p>
<p>但是网络协议栈既然是分层的结构，其中一个原因就是为了让不同层之间忽略掉上层以及下层的存在，达到真正意义上的解耦，从而让双方看来就好像是彼此的应用层在直接通信。</p>
<h3 data-id="heading-1">网络通信需要知道对方的位置</h3>
<p>正如在科技不那么发达的年代，两地之间通信需要通过邮寄信件的方式，那邮差小哥就必须要知道这个信件要发到哪里。如今我们可以通过网络通信，但网络中的报文也不是毫无目的地转发，一定是要知道对方的 IP 地址的。</p>
<p>一般的 IP 地址长相大概是 “<strong>36.152.44.95</strong>” 这样的，这样的一串数字毫无规律可言，如果每次都只向同样的 IP 地址发送网络报文倒也可以勉强背下来。但是正如我们手机里有很多人的电话号码一样，我们不可能一生只跟一个 IP 进行网络通信，所以就需要想个办法让这些 IP 地址跟手机的通讯录一样，一一对应地加上一个方便用户记住和分辨的代名词，也就是<strong>域名</strong>。</p>
<p><strong>例如，百度的域名就是：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com" target="_blank" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a></strong></p>
<p>那如果我要给张三打电话，我可以在通讯录里面找到张三的姓名，也就能找到张三的手机号了。所以，如果要进行网络通信，就必须也存在一个可以根据域名找到对应的 IP 地址的东西，这个东西就是 <strong>DNS</strong>。</p>
<blockquote>
<p>一个域名实际是按“点”被严格切分成<strong>倒序的层级授权链</strong>，从右往左，每一级都是上一级的“子域”，直到最左边真正提供 Web 服务的主机名。</p>
</blockquote>
<p><strong>根域名：.</strong></p>
<ul>
<li>位于域名的最右侧部分，是 DNS 域名空间的最高层级，没有具体的字符标识，在域名书写中以末尾的一个“点”来表示（日常使用可省略）。实际上，<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com" target="_blank" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a> 后面还有一个“点”，也就是 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com" target="_blank" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a>.</li>
</ul>
<p><strong>顶级域名：.com</strong></p>
<ul>
<li>位于根域名的左顶级域名（gTLD）。</li>
<li>最初被设计出来是为了标识商业机构，现在已经没有严格使用限制，各种组织和个人都可以注册。</li>
<li>常见的顶级域名还有 .org（非营利组织）、.net（网络服务机构）、.eud（教育机构）等；国家和地区顶级域名如 .cn（中国）、.us（美国）也属于顶级域名范畴。</li>
</ul>
<p><strong>二级域名：baidu</strong></p>
<ul>
<li>位于顶级域名左侧，是域名的核心标识部分，也是用户或机构在域名注册时需要申请的主体。</li>
<li>百度通过注册 .com 下的 baidu 二级域名，就获得了 baidu.com 这个基础域名的使用权，就是该域名的主域名。</li>
</ul>
<p><strong>三级域名：www</strong></p>
<ul>
<li>位于二级域名的左侧，是主域名的子域名，由域名所有者自行定义和配置，无需额外向域名注册机构申请（其实就是域名所有者服务器上的一个目录名称）。</li>
<li>www 是万维网（World Wide Web）的缩写，是互联网中约定俗成的用于标识 Web 服务的子域名，当用户访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com" target="_blank" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a> 时，实际是请求 baidu.com 域名下的 www 子域名对应的 Web 服务器资源（也就是 www 这个目录下的内容）。</li>
<li>域名所有者可以配置任意的三级域名，比如 map.baidu.com（百度地图）、tieba.baidu.com（百度贴吧）等，均属于 baidu.com 的子域名。</li>
</ul>
<p><strong>既然有了域名，就要有域名服务器负责管理组织这些域名，如此才能根据域名找到对应的 IP 地址。</strong></p>
<blockquote>
<p>和域名的层级结构一样，域名服务器也是分级的，他们之间的关系类似于树状结构。</p>
</blockquote>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b4796486734253ad5cee0673c5e847~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=L6i5mxoLQXFbb3v7HRmBpPP4f44%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p>除上述三种 DNS 服务器之外，还有一种本地 DNS 服务器。DNS 请求最开始就是发给本地 DNS 服务器的，如果本地 DNS 服务器没有在自己的缓存表里找到对应的域名和 IP 之间的记录，才会进一步去访问根 DNS 服务器。</p>
<p><strong>本地 DNS 服务器的地址是保存在客户端的操作系统中的</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e72e207db1b949048e24a3eb68506fab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=CRxf3Cb%2BHQyLFlHqnulx0%2BX60LM%3D" alt="image.png" width="70%" loading="lazy"/></p>
<p><strong>DNS 解析的具体流程如下：</strong></p>
<ol>
<li>客户端会根据 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.baidu.com" target="_blank" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a> 这样的域名生成一个 DNS 请求，发送给本地域名服务器。</li>
<li>本地域名服务器如果在自己的缓存记录里找到了对应的 IP 地址，则直接返回；若没有找到，则向根域名服务器发起请求。</li>
<li>根域名服务器收到请求之后，识别到对应的二级域名是 .com，则将 .com 顶级域名服务器的地址返回给本地域名服务器。</li>
<li>本地域名服务器向 .com 顶级域名服务器发起请求，.com 顶级域名服务器识别到三级域名为 baidu，则将 baidu.com 权威域名服务器的地址反馈给本地域名服务器。</li>
<li>本地域名服务器向 baidu.com 权威域名服务器发起请求，权威域名服务器中一定保存着对应的 IP 地址，所以将 IP 地址返回本地域名服务器。</li>
<li>本地域名服务器将 IP 地址返回给客户端，进而可以发起网络通信。</li>
</ol>
<p>但是实际上并不是每一次 DNS 解析都要经过上述所有流程，因为浏览器本身和操作系统都是存在缓存的，当第一次获取到一个域名对应的 IP 地址之后，会记录在缓存中，避免每次都绕那么一大圈。如果在缓存中没有找到，还可以去本地的 hosts 文件中查找，如果都没有找到才会向本地域名服务器发起 DNS 请求。</p>
<p>Windows 中可以通过在终端中输入“tepad C:\Windows\System32\drivers\etc\hosts”查看 hosts 文件内容，如下：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/506f1a4be795492e8720b049a706af6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=EyqFR0jBVG0CipUU3SXhdjCtbms%3D" alt="image.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-2">客户端需要知道服务端处理请求的状态</h3>
<p>客户端向服务端发起请求之后，可能会得到不同的响应。常见的就是服务端成功将客户端请求的数据返回，并由客户端浏览器渲染到页面上。当然也存在其他情况，比如用户访问的资源根本就不存在，这时服务端需要让客户端知道，“不是我不想给你返回有效数据，是因为你要的东西我根本就没有”。</p>
<p><strong>服务端告诉客户端本次请求的处理结果（成功、失败、需要进一步操作等）的方式就是设置状态码。</strong></p>
<p>常见的状态码类型如下：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dc30cff04ba454a81bf3a11a89cbcbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=nYk6x3rC87DJILw8BkJSy934LFc%3D" alt="image.png" width="100%" loading="lazy"/></p>
<p>先解释几个简单的</p>
<p>1XX 类状态码用来表示一种中间状态，说明服务端正在处理客户端的请求。</p>
<p>2XX 类状态码用来表示服务端处理请求成功，也是我们最希望看到的一种状态，具体细分如下：</p>
<ul>
<li><strong>200 OK</strong> 是最常见的成功状态码，表示没有异常出现。</li>
<li><strong>204 No Content</strong> 与 200 OK 表达的含义相同，区别在于 204 的报文不携带服务端给客户端返回的正文数据。</li>
<li><strong>206 Partial Content</strong> 表示此次响应给客户端的数据只是一部分，通常出现在分块下载等场景。</li>
</ul>
<p>4XX 类状态码表示客户端发来的请求报文有误，服务端无法处理</p>
<ul>
<li><strong>400 Bad Request</strong> 只是表示是客户端的错误，但是这个错误是泛指，没有具体的原因。</li>
<li><strong>403 Forbidden</strong> 表示客户端的请求本身没什么问题，但是客户端要访问的资源是服务器禁止访问的。</li>
<li><strong>404 Not Found</strong> 是我们最常见的一种 4XX 类状态码，表示客户端想要访问的字眼在服务端根本就找不到。</li>
</ul>
<p>5XX 类状态码表示服务器内部处理请求时出现错误（但实际有的服务端不想被别人知道是自己的错，所以即使出现错误也照样给客户端返回一个其他类别的状态码）</p>
<ul>
<li><strong>500 Internal Server Error</strong> 表示服务端内部错误，但是也是一个泛指的错误，没有具体的原因。</li>
<li><strong>501 Not Implemented</strong> 表示服务端收到并顺利识别到请求，但是服务器本身并没有实现这个请求方法，所以无法处理。</li>
<li><strong>503 Service Unavailable</strong> 表示服务端因为服务器过载、维护升级等原因暂时无法处理请求，通常是暂时的。</li>
</ul>
<p>最后说比较重要的一类</p>
<p>3XX 类状态码表示用户请求资源的位置发生了变动，原来的 URL 找不到对应的资源，所以需要切换 URL 继续发起请求</p>
<ul>
<li><strong>301 Moved Permanently</strong> 永久重定向，表示请求资源的 URL 发生变更并且是永久的，此时客户端浏览器会缓存新的 URL，之后的请求都直接访问新地址。</li>
<li><strong>302 Found</strong> 临时重定向，也是请求资源的 URL 发生变化，但只是暂时的，客户端浏览器并不需要缓存新的地址，只是下一次重新发起请求的时候要使用服务端返回的新的 URL。</li>
<li><strong>304 Not Modified</strong> 客户端请求的资源没有改变，不需要把资源再传给客户端一次，让客户端继续用自己本地的缓存即可。</li>
</ul>
<p><strong>好的，那么问题来了，服务端要不停的收到很多客户端发来的请求，同样的资源可能被多个客户端访问，那服务端怎么知道在某一个客户端两次访问资源之间的这段时间里，资源没有被改变呢？</strong></p>
<blockquote>
<p><strong>强制缓存</strong>：由客户端的浏览器通过上次收到的服务端响应中携带的过期时间判断自己缓存的资源是否过期，如果过期就再次向服务端发起请求，否则直接使用本地缓存的内容，主动权在客户端一方。</p>
</blockquote>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bf4403586054e7c9311e9d29c022cd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=GD1Ww1RHSdjGM%2B0L1ltnTg4FmH4%3D" alt="image.png" width="85%" loading="lazy"/></p>
<p>上述过程中一个很重要的字段就是<strong>过期时间</strong>，实际上服务端设置过期时间有两种方式。</p>
<ol>
<li><strong>Cache-Control</strong>，相对时间。</li>
<li><strong>Expires</strong>，绝对时间。</li>
</ol>
<p>Cache-Control 的设置选项更多，也就更加精密，所以一般建议使用 Cache-Control 实现强制缓存。当服务端返回的过期时间同时出现这两者时，也优先以 Cache-Control 为准。</p>
<blockquote>
<p><strong>协商缓存</strong>是指服务端再次收到客户端发来的请求时，通过判断请求的资源有没有改变，或者请求的时间有没有超过服务端上次设置的时间，来决定是重新返回资源还是告知客户端继续使用本地缓存，主动权在服务端一方。</p>
</blockquote>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ae6d7fb4f5042fe93b75608bcbad13a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=mn7uSmKCzTBlrlh61bxGNWf1aaM%3D" alt="image.png" width="85%" loading="lazy"/></p>
<p><strong>注：服务端第一次返回时，上次修改时间字段为 Last-Modified，客户端再次发起请求时，携带的上次修改时间字段为 If-Modified-Since。</strong> 这种协商缓存也是通过时间字段判断资源是否改变</p>
<p>但是仅凭时间判断是有漏洞的</p>
<ul>
<li>文件包括文件属性和文件内容，如果不修改内容，只修改属性的情况下，文件的最后修改时间也是会变化的。</li>
<li>有的修改操作极快，快到可以在一秒以内完成，而 If-Modified-Since 是以秒为单位的，故而识别不到快速的修改操作。</li>
</ul>
<p><strong>所以与其通过对比时间，不如给每一次修改后的资源都分配一个版本号 Etag，只要资源被修改，Etag 就一定会发生变化。</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90de4b871d16453c9d2452491f0fef96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=6mLwxMdAUymbEnc6IfozaTSzJmY%3D" alt="image.png" width="85%" loading="lazy"/></p>
<p>当服务端返回的字段中同时出现 Last-Modified 和 Etag 字段时，无疑是 Etag 的优先级更高。</p>
<h3 data-id="heading-3">客户端的请求类型不是单一的</h3>
<p>HTTP 根据客户端不同的需求，将请求类型划分成不同的方法字段</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20f8c234b0d441b08f313f0a2d6eedc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=s%2FDryQiQyirmB1BzY2NmsZERmxA%3D" alt="image.png" width="90%" loading="lazy"/></p>
<p>上述方法对应的说明，都是由 RFC 规范来定义的。日常使用中，极大部分请求方法都是 GET 和 POST，两者的区别在于：</p>
<p><strong>GET：</strong></p>
<ul>
<li>RFC 规定从服务器获取指定资源</li>
<li>参数写在 URL 中，且必须是 ASCII 字符，且浏览器对 URL 的长度是有限制的</li>
<li>浏览器可以将 GET 获得的资源进行缓存，也可以保存为书签</li>
</ul>
<p><strong>POST：</strong></p>
<ul>
<li>RFC 规定根据请求正文数据对指定的资源做出处理</li>
<li>请求携带数据一般写在请求正文中，可以是任何类型的数据，浏览器也不会对正文大小作出限制</li>
<li>POST 请求不会被浏览器缓存，也不能保存为书签</li>
</ul>
<p><strong>关于URL传参和正文传参：</strong> 虽然 URL 传参是直接把参数信息写入浏览器地址搜索框中，正文传参并不会直接把参数显示出来。但是不能说正文传参就比 URL 传参要安全，因为说白了 HTTP 中两者都是非加密的明文传输，都是“裸奔”状态，别人抓个包就啥都看到了。</p>
<p>一个常见的问题：<strong>GET 和 POST 方法能保证安全和幂等性吗？</strong></p>
<p>安全指的是一个请求不会破坏服务器上的资源，幂等指的是多次执行同样的操作，所得到的结果也是相同的。如果是完全按照 RFC 规范使用方法的话，GET 请求只是对服务器资源进行只读操作，所以多次请求得到的资源是相同的，也就是幂等的，且服务器上的资源也是安全的；POST 请求会对服务器资源做出修改，所以是不安全的，且多次修改得到的结果可能是不同的，所以也不是幂等的。</p>
<p>但是并不是所有人每时每刻都是完全按照 RFC 规范来使用 HTTP 方法的，比如我在进行本地测试的时候，所有增删查改的业务，我都是用 postman 发送 POST 请求~</p>
<h3 data-id="heading-4">请求应答式通信</h3>
<blockquote>
<p>请求应答式通信（Request-Response Communication）是一种双向、同步或异步的网络通信模式，核心逻辑是：一方（请求方）主动发起服务请求，另一方（应答方）接收请求并处理后，向请求方返回明确的响应结果。</p>
</blockquote>
<p>说人话就是，只有请求方主动发送一个请求，应答方才能在处理之后返回一个应答。下一次再通信也是同样的过程，且每一次通信都是独立的，不和之前的历史通信相关联。</p>
<p><strong>但是 HTTP 通信是要先建立连接的</strong>，这个过程是会有软硬件资源的消耗的，而且如果每次通信都重新建立连接，再把之前发过的内容重新发一遍，无疑是做了无用功。所以 HTTP 其实是可以设置保持长连接的，通信双方可以确定所有的请求都得到了应答之后再把连接断开，但是这是 HTTP1.1 及其之后的版本才支持的。</p>
<h3 data-id="heading-5">通信双方需要顺利获取并解析对方发来的数据</h3>
<p>实际上，HTTP 通信时，双方的接收缓冲区中收到的都是一系列的二进制数据。但是接收缓冲区的大小不可能刚好等于一次通信数据的大小，况且每次通信收到的数据量都是不一样的，也就意味着<strong>缓冲区中可能同时有多次通信的数据</strong>。但是二进制的连续数据，怎么准确把每一次通信的数据精准分割呢？</p>
<p><strong>在 HTTP 报头当中添加一个正文部分的长度字段</strong>，每次读取到一个 HTTP 报头部分时，往后读取正文长度大小的数据，就是一次通信的有效正文数据。</p>
<p>有时服务端把资源响应给客户端时需要进行压缩，但是压缩方法是多种多样的，这时需要客户端先告知服务端自己可以接受哪些压缩方法，服务端再按照相应的方法进行压缩响应。</p>
<p>同样的，响应的数据也会有各种编码格式，也需要客户端在发送请求时，顺道带上自己支持的编码格式，以供服务端可以响应回客户端能看懂的数据格式。</p>
<h3 data-id="heading-6">无状态协议</h3>
<blockquote>
<p>无状态协议（Stateless Protocol）是指通信双方在交互过程中，协议本身不保存任何上下文信息的网络协议。简单来说：服务器不会记住任何与客户端相关的历史请求记录，每一次请求都被视为独立的、全新的请求。</p>
</blockquote>
<p>HTTTP 就是最典型的无状态协议。</p>
<p>但是我们自己电脑上的浏览器并不是“没有记忆的”，因为当我关机再启动的时候，再次访问掘金官网，依然不需要我重新登录账号。HTTP 还是那个 HTTP，不同的是，为了避免用户频繁向服务端证明自己“良民”的身份，服务端可以在第一次身份认证成功之后，返回客户端一个“好人卡”，保存在浏览器端，这样下次“见卡如见人”，也就不需要每次都验证身份。这张卡我们也是可以看到的，它有个可爱的名字叫 Cookie。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58567884b5f24efba89444390fa4f7f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=KxSU8AoRpRYR8Tkw%2BT3sMIB70Mw%3D" alt="QQ_1767581797183.png" width="70%" loading="lazy"/></p>
<p>实际上这个 Cookie 保存的就是用户访问每一个网站时使用的用户信息。大概流程就是：</p>
<ol>
<li>客户端发送给服务端的请求头部中制定要服务端给自己返回一个 Cookie</li>
<li>服务端先验证客户端身份，验证成功后处理业务，并生成 Cookie 和响应数据一起返回客户端</li>
<li>客户端将 Cookie 信息保存在自己的浏览器中</li>
<li>下次再次向同样的服务端发送请求就带上 Cookie</li>
<li>服务端只需要用 Cookie 验证身份即可</li>
</ol>
<p><strong>但是毕竟 Cookie 中保存的直接就是用户的个人信息，如果被有心人通过非法手段盗取 Cookie，就可以以我们的身份访问我们访问过的网站。</strong> 这时服务器就站出来了，它说：“既然你客户端防盗窃的措施没有那么完善，那你的信息还是保存在我这里吧，但是也为了不用每次都验证你的信息，还是需要给你返回一个好人卡，但是这个好人卡不再是你的信息，只是一个与我内部维护起来的客户端信息一一对应的一个标识，方便你也方便我。” 于是就有了 <strong>Session ID</strong>。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ced59c0366f447b85fc317cbe5a8db6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=xSigxAmiO2a8XGcuoqag%2BtWuTnk%3D" alt="QQ_1767583213865.png" width="100%" loading="lazy"/></p>
<p>那我问你，那我问你，Cookie 中保存用户信息的时候可以被盗取，那你换成 Session ID 就没事了吗？我把 Session ID 盗了，不照样可以用你的身份访问你访问的网站吗？</p>
<p>可以是可以的，因为网络的世界里，根本就不存在绝对的安全。只是 Session ID 保存的毕竟不再是用户的个人信息了，也就说明用户信息维护的工作从客户端变成服务端了，也就不至于让用户信息经常在纷繁复杂的网络世界里裸奔。并且有一个约定俗成的衡量是否安全的标准：<strong>如果用某种手段获取某个客户端的私密信息所消耗的成本大于获取私密信息成功后获得的利益，那么就认为是安全的</strong>。毕竟很少有人愿意“吃力不讨好”，但是服务端也是有避免在这种极少数可能性的预防措施的。</p>
<ul>
<li><strong>IP 验证：</strong> 服务端会留意你每次访问时所在的 IP，如果发现你几次访问时 IP 不同，就有理由怀疑你被“盗号”了，就会提醒你注意账号信息是否泄露，并再次要求你输入账号和密码以验证身份。</li>
<li><strong>高权限操作再次验证身份：</strong> 比如你要转移一笔巨款的时候，往往会以人脸识别等方式再次确定你就是你。</li>
<li><strong>Session ID过期时间：</strong> 同一个 Session ID 并不是永久有效的，可能每过一段时间就会要求你再次验证身份以生成新的 Session ID。</li>
</ul>
<h2 data-id="heading-7">HTTP 协议格式</h2>
<p>上面所介绍的所有字段，都是要在 HTTP 协议中体现出来的，而这些内容都是要按照规范组织起来的，不能杂乱无章地直接丢给通信的对端。</p>
<p><strong>HTTP 请求报文格式：</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5821dade17da499abad609669e5dc9ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=vQIO2NxkuCDa2NhIXP0S%2FdPKzys%3D" alt="QQ_1767585041933.png" width="80%" loading="lazy"/></p>
<p><strong>HTTP 响应报文格式：</strong></p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/869f18e045fc4b75b85cdeab31960cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=gw5gKB8haMlbmlIZ0L52tS1fqXg%3D" alt="QQ_1767585773809.png" width="70%" loading="lazy"/></p>
<p>其中，响应报头和请求报头中的键值对，就是上文中说的那些诸如要设置的字段，这里做一个汇总：</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ec448dc87ac46e28cd1e12a337da34d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Om5bCU55m75rmW5oeS576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991267&amp;x-signature=%2Bw3RdwQn%2BO%2Bku5HE0xawJC0DPf8%3D" alt="QQ_1767586794113.png" width="100%" loading="lazy"/></p>
<p>而空行就是用来分割报头和正文的，当你读取到一个空行时就该意识到后面的就是正文部分的内容了，结合报头当中出现的 Content-Length 字段就可以向后读取固定长度的数据，就是完整的正文。</p>
<h3 data-id="heading-8">再次理解 HTTP 协议</h3>
<blockquote>
<p>HTTP（HyperText Transfer Protocol），即超文本传输协议，是一种基于 TCP/IP 协议的应用层协议，核心作用是规范客户端（如浏览器、APP）和服务端之间超文本数据传输规则，是万维网（WWW）通信的基础。</p>
</blockquote>
<p><strong>核心关键词拆解</strong></p>
<ul>
<li><strong>超文本（HyperText）：</strong> 指超越纯文本的数据格式，不仅包含文字，还可以是图片、音频、视频、超链接、HTML 页面等。</li>
<li><strong>传输（Transfer）：</strong> 定义了客户端与服务端之间的数据请求-响应流程，以及数据的传输格式、编码方式等。</li>
<li><strong>协议（protocol）：</strong> 客户端和服务端必须共同遵守的通信规则，双方按统一格式封装、解析报文，才能完成交互。</li>
</ul>
<p><strong>HTTP 的核心特性</strong></p>
<ol>
<li><strong>无状态：</strong> 协议本身不记录客户端的会话状态，每次请求都是独立的，服务端无法直接识别连续请求是否来自同一客户端（需通过 Cookie、Session 等机制补充状态）。</li>
<li><strong>请求 - 响应模式：</strong> 由客户端主动发起请求，服务端接收请求后处理并返回响应，一问一答是固定交互流程。</li>
<li><strong>灵活的可扩展性：</strong> 支持通过自定义报头（Headers）扩展功能，比如缓存机制、跨域访问、身份认证等。</li>
<li><strong>明文传输：</strong> 明文以纯文本形式传输，安全性较低。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Angular 18 核心特性速查表]]></title>    <link>https://juejin.cn/post/7595028805158682634</link>    <guid>https://juejin.cn/post/7595028805158682634</guid>    <pubDate>2026-01-14T10:31:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805158682634" data-draft-id="7595028805158666250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Angular 18 核心特性速查表"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T10:31:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="米诺zuo"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497373399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Angular 18 核心特性速查表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497373399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    米诺zuo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:31:36.000Z" title="Wed Jan 14 2026 10:31:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">📚 Angular 18 核心特性速查表</h3>
<h2 data-id="heading-1">Angular 18 标志着 Angular 彻底告别“旧时代”（v1.x 的残留和复杂的 Module 系统），全面进入 <strong>Signal 响应式</strong> 和 <strong>Standalone 独立组件</strong> 时代。</h2>
<h3 data-id="heading-2">1. 🔄 全新响应式核心：Signal Inputs</h3>
<p>这是 Angular 18 最具革命性的变化，彻底改变了父子组件数据传参的方式。</p>





















<table><thead><tr><th align="left">特性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>旧语法</strong></td><td align="left"><code>@Input()</code> 和 <code>@Output()</code> 分开定义，配合 <code>(inputChange)</code> 实现双向绑定。</td></tr><tr><td align="left"><strong>新语法</strong></td><td align="left"><strong><code>model()</code></strong> 函数。集输入、输出、变更检测于一体。</td></tr><tr><td align="left"><strong>优势</strong></td><td align="left"><strong>代码量减少 80%</strong>，自动支持响应式更新，不再依赖 <code>ngOnChanges</code> 钩子。</td></tr></tbody></table>
<h4 data-id="heading-3">代码对比</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 旧写法：繁琐</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OldComp</span> {
  <span class="hljs-meta">@Input</span>() count = <span class="hljs-number">0</span>;
  <span class="hljs-meta">@Output</span>() countChange = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>&lt;<span class="hljs-built_in">number</span>&gt;();
  
  <span class="hljs-comment">// 如果要监听变化，还得写 ngOnChanges</span>
  <span class="hljs-title function_">ngOnChanges</span>(<span class="hljs-params">changes: SimpleChanges</span>) { ... }
}
<span class="hljs-comment">// ✅ Angular 18 写法：极简</span>
<span class="hljs-keyword">import</span> { model } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NewComp</span> {
  <span class="hljs-comment">// count 现在是一个 Signal，既是输入也是输出</span>
  <span class="hljs-comment">// 父组件改了它，它会变；它变了，父组件也会收到通知</span>
  count = <span class="hljs-title function_">model</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-comment">// 在组件内部直接使用 Signal API</span>
  <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">update</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> v + <span class="hljs-number">1</span>);
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">2. 🎨 新一代控制流</h3>
<p>Angular 17 引入，Angular 18 成为标准。废弃了 <code>*ngIf</code>、<code>*ngFor</code> 等指令，改用编译器级的块语法。</p>





























<table><thead><tr><th align="left">指令</th><th align="left">旧写法 (指令式)</th><th align="left">新写法 (块语法)</th><th align="left">关键点</th></tr></thead><tbody><tr><td align="left"><strong>条件判断</strong></td><td align="left"><code>&lt;div *ngIf="user"&gt;...&lt;/div&gt;</code></td><td align="left"><code>@if (user) { ... }</code></td><td align="left">逻辑更清晰，支持 <code>@else if</code>。</td></tr><tr><td align="left"><strong>列表循环</strong></td><td align="left"><code>&lt;div *ngFor="let u of users"&gt;...&lt;/div&gt;</code></td><td align="left"><code>@for (u of users; track u.id) { ... }</code></td><td align="left"><strong>强制要求 <code>track</code></strong>，提升渲染性能。</td></tr><tr><td align="left"><strong>空状态</strong></td><td align="left"><code>&lt;div *ngIf="!users.length"&gt;...&lt;/div&gt;</code></td><td align="left"><code>@for (u of users; track u.id) { ... } @empty { ... }</code></td><td align="left">内置空状态块，无需额外判断。</td></tr></tbody></table>
<h4 data-id="heading-5">代码对比</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- ❌ 旧写法 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"users.length === 0; else list"</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ng-template</span> #<span class="hljs-attr">list</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> *<span class="hljs-attr">ngFor</span>=<span class="hljs-string">"let user of users; trackBy: trackFn"</span>&gt;</span>{{user.name}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ng-template</span>&gt;</span>
<span class="hljs-comment">&lt;!-- ✅ Angular 18 写法 --&gt;</span>
@if (users.length === 0) {
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
} @else {
  @for (user of users; track user.id) {
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">3. 🧱 独立组件</h3>
<p>虽然从 v14 开始引入，但在 Angular 18 中，<strong>Standalone 是唯一的默认选项</strong>。</p>





















<table><thead><tr><th align="left">特性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>旧语法</strong></td><td align="left">必须声明 <code>@NgModule</code>，在 <code>declarations</code> 和 <code>imports</code> 中注册组件。</td></tr><tr><td align="left"><strong>新语法</strong></td><td align="left">组件中加上 <code>standalone: true</code>，直接在 <code>imports</code> 数组导入其他组件/指令。</td></tr><tr><td align="left"><strong>优势</strong></td><td align="left"><strong>模块化</strong>，摇树优化 更友好，降低心智负担。</td></tr></tbody></table>
<h4 data-id="heading-7">代码对比</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 旧写法：Module Hell</span>
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [<span class="hljs-title class_">UserComponent</span>],
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CommonModule</span>, <span class="hljs-title class_">FormsModule</span>],
  <span class="hljs-attr">exports</span>: [<span class="hljs-title class_">UserComponent</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModule</span> { }
<span class="hljs-comment">// ✅ Angular 18 写法：清爽</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>;
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-user'</span>,
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 声明为独立组件</span>
  <span class="hljs-attr">imports</span>: [<span class="hljs-title class_">CommonModule</span>], <span class="hljs-comment">// 直接用啥导啥</span>
  <span class="hljs-attr">template</span>: <span class="hljs-string">`...`</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserComponent</span> { }
</code></pre>
<hr/>
<h3 data-id="heading-8">4. 🚀 性能与开发体验提升</h3>
<p>除了语法变化，Angular 18 还带来了一些底层的优化：</p>
<ol>
<li><strong>Zone.js 可选:</strong>
<ul>
<li>默认情况下，Angular 依然使用 Zone.js 来自动检测变化。</li>
<li>但新版本提供了更完善的 <code>provideExperimentalZonelessChangeDetection()</code>，允许开发者完全移除 Zone.js，利用 Signal 实现极致性能（类似 React/Svelte 的手动更新模式）。</li>
</ul>
</li>
<li><strong>Hydration（水合）优化:</strong>
<ul>
<li>服务端渲染 (SSR) 的体验大幅提升，减少了客户端接管应用时的闪烁。</li>
</ul>
</li>
<li><strong>类型检查增强:</strong>
<ul>
<li>新的控制流 <code>@for</code> 的 <code>track</code> 表达式会在编译时进行严格类型检查，防止 <code>trackBy</code> 写错导致的 Bug。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">5. 📋 语法快速迁移指南</h3>
<p>如果您想将旧项目升级到 Angular 18 风格，请参考以下映射表：</p>








































<table><thead><tr><th align="left">场景</th><th align="left">查找旧代码...</th><th align="left">替换为...</th></tr></thead><tbody><tr><td align="left"><strong>Input 装饰器</strong></td><td align="left"><code>@Input() name: string;</code></td><td align="left"><code>name = input&lt;string&gt;('');</code></td></tr><tr><td align="left"><strong>双向绑定</strong></td><td align="left"><code>@Input() val; @Output() valChange</code></td><td align="left"><code>val = model(0);</code></td></tr><tr><td align="left"><strong>If 指令</strong></td><td align="left"><code>*ngIf</code></td><td align="left"><code>@if</code> / <code>@else</code></td></tr><tr><td align="left"><strong>For 指令</strong></td><td align="left"><code>*ngFor</code></td><td align="left"><code>@for (...; track ...)</code></td></tr><tr><td align="left"><strong>Switch 指令</strong></td><td align="left"><code>[ngSwitch]</code> / <code>*ngSwitchCase</code></td><td align="left"><code>@switch</code> / <code>@case</code></td></tr><tr><td align="left"><strong>Module 导入</strong></td><td align="left"><code>AppModule</code></td><td align="left">直接在 <code>main.ts</code> <code>bootstrapApplication</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-10">总结</h3>
<p><strong>Angular 18 的核心哲学是：</strong></p>
<ol>
<li><strong>响应式优先</strong>：用 Signal (<code>input</code>, <code>model</code>, <code>computed</code>) 替代 imperative（命令式）的 Getter/Setter。</li>
<li><strong>模板原生化</strong>：用 <code>@if</code> / <code>@for</code> 替代 HTML 指令，让模板更像代码。</li>
<li><strong>去重化</strong>：用 Standalone 组件替代复杂的 NgModule 树。
这种写法让 Angular 代码量大幅减少，运行时性能显著提升，且更容易被 Vue/React 开发者理解。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IfAI v0.3.0 - 从"文本"到"多模态"的感知升级]]></title>    <link>https://juejin.cn/post/7595030559564333107</link>    <guid>https://juejin.cn/post/7595030559564333107</guid>    <pubDate>2026-01-14T10:14:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595030559564333107" data-draft-id="7595021656428052507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" IfAI v0.3.0 - 从&quot;文本&quot;到&quot;多模态&quot;的感知升级"/> <meta itemprop="keywords" content="AI编程,Rust"/> <meta itemprop="datePublished" content="2026-01-14T10:14:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="peterfei"/> <meta itemprop="url" content="https://juejin.cn/user/2700056287782663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             IfAI v0.3.0 - 从"文本"到"多模态"的感知升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056287782663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    peterfei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:14:29.000Z" title="Wed Jan 14 2026 10:14:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>发布日期</strong>: 2026-01-14
<strong>版本代号</strong>: Multimodal Intelligence
<strong>核心主题</strong>: 从"文本"到"多模态"的感知升级</p>
</blockquote>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d67dbf6703a47219bc628d25ba8b655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcGV0ZXJmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768990469&amp;x-signature=PQvXWBQbY35Mawvb3wG1%2FXsplRg%3D" alt="2026-01-1401_1280.gif" loading="lazy"/></p>
<h2 data-id="heading-0">🎯 版本概述</h2>
<p>v0.3.0 实现了从纯文本交互到多模态感知的重大飞跃。AI 不再只能理解代码，现在可以直接"看到"图片、理解视觉内容，同时具备强大的代码分析和重构能力。</p>
<p><strong>五大核心升级</strong>:</p>
<ol>
<li><strong>文本对话 → 多模态对话</strong>: 支持拖拽图片直接对话，AI 可理解视觉内容</li>
<li><strong>单一调度 → 混合调度</strong>: 本地 LLM + 远程 API 灵活切换</li>
<li><strong>基础补全 → 智能导航</strong>: Go to Definition / Find References 支持 35+ 主流语言</li>
<li><strong>手动重构 → AI 重构</strong>: 自动检测代码异味并生成重构方案</li>
<li><strong>新手友好 → 零门槛</strong>: 新手引导 Tour 系统，5分钟上手</li>
</ol>
<hr/>
<h2 data-id="heading-1">✨ 核心功能</h2>
<h3 data-id="heading-2">1️⃣ 多模态 Vision LLM (Multimodal Understanding)</h3>
<p><strong>突破</strong>: AI 现在可以直接"看"到图片并理解视觉内容。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>图片拖拽上传</strong></td><td align="left">直接拖拽图片到聊天区域，自动转为 base64</td></tr><tr><td align="left"><strong>截图快捷上传</strong></td><td align="left">系统截图后直接粘贴 (Cmd+V) 到编辑器</td></tr><tr><td align="left"><strong>视觉内容理解</strong></td><td align="left">AI 分析图片中的 UI、代码、架构图</td></tr><tr><td align="left"><strong>多图片附件</strong></td><td align="left">支持一次对话上传多张图片</td></tr><tr><td align="left"><strong>自动清理机制</strong></td><td align="left">发送后自动清除图片附件，保持界面整洁</td></tr></tbody></table>
<p><strong>技术实现</strong>:</p>
<ul>
<li>Base64 编码处理图片数据</li>
<li>自动检测 Vision API 模型 (Claude 3.5 Sonnet / GPT-4V)</li>
<li>Token 计数自适应图片大小</li>
<li>支持 PNG、JPG、JPEG、GIF、WebP 格式</li>
</ul>
<p><strong>测试覆盖</strong>: MM-UI-01 ~ MM-UI-05 (5个测试全通过)</p>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20../imgs/ifai2026-01-1402_1280.gif" alt="多模态演示转存失败，建议直接上传图片文件" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-3">2️⃣ 本地/远程混合调度 (Hybrid LLM Scheduling)</h3>
<p><strong>突破</strong>: 不再依赖单一 API，灵活调度本地和远程模型。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>本地模型</strong></td><td align="left">支持 llama3、qwen2.5 等本地部署模型</td></tr><tr><td align="left"><strong>远程 API 支持</strong></td><td align="left">Anthropic Claude、OpenAI GPT-4</td></tr><tr><td align="left"><strong>智能路由</strong></td><td align="left">根据任务类型自动选择最适合的模型</td></tr><tr><td align="left"><strong>降级保护</strong></td><td align="left">远程 API 失败时自动降级到本地模型</td></tr><tr><td align="left"><strong>成本优化</strong></td><td align="left">简单任务用本地模型，复杂任务用云端</td></tr></tbody></table>
<p><strong>配置示例</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"llm"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3-5-sonnet-20241022"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fallback"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ollama"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"llama3.1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>测试覆盖</strong>: MM-UI-01, MM-UI-03 (真实AI验证通过)</p>
<hr/>
<h3 data-id="heading-4">3️⃣ 代码智能导航 (Code Intelligence Navigation)</h3>
<p><strong>突破</strong>: 支持 35+ 主流语言的符号级导航。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>Go to Definition</strong></td><td align="left">跳转到函数/变量/类的定义位置</td></tr><tr><td align="left"><strong>Find References</strong></td><td align="left">查找符号在项目中的所有引用</td></tr><tr><td align="left"><strong>跨语言支持</strong></td><td align="left">TypeScript、Rust、Python、Go、Java、C++、Ruby、PHP 等</td></tr><tr><td align="left"><strong>LSP 集成</strong></td><td align="left">基于 Language Server Protocol 标准实现</td></tr><tr><td align="left"><strong>项目范围索引</strong></td><td align="left">自动索引当前工作区所有文件</td></tr></tbody></table>
<p><strong>快捷键</strong>:</p>
<ul>
<li><code>F12</code> / <code>Cmd+Click</code>: 跳转到定义</li>
<li><code>Shift+F12</code> / <code>Right-click</code>: 查找所有引用</li>
</ul>
<p><strong>支持的语言</strong> (35+):
JavaScript, TypeScript, Python, Rust, Go, Java, C, C++, C#, PHP, Ruby, Swift, Kotlin, Dart, Lua, Scala, Groovy, PowerShell, Shell, YAML, JSON, Markdown, HTML, CSS, Vue, Svelte, etc.</p>
<p><strong>测试覆盖</strong>: DEF-01 ~ DEF-05 (5个测试全通过), REF-01 ~ REF-04 (4个测试全通过)</p>
<hr/>
<h3 data-id="heading-5">4️⃣ AI 代码重构 (AI-Powered Refactoring)</h3>
<p><strong>突破</strong>: AI 自动检测代码异味并生成重构方案。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>代码异味检测</strong></td><td align="left">自动识别长函数、重复代码、复杂条件等问题</td></tr><tr><td align="left"><strong>结构化重构</strong></td><td align="left">一键将复杂代码拆分为清晰的函数/类结构</td></tr><tr><td align="left"><strong>智能建议</strong></td><td align="left">AI 分析代码上下文，生成符合最佳实践的重构方案</td></tr><tr><td align="left"><strong>预览模式</strong></td><td align="left">Diff 视图预览重构变更，Accept/Reject 控制</td></tr><tr><td align="left"><strong>Undo 支持</strong></td><td align="left">完整的撤销支持，不满意可随时回退</td></tr></tbody></table>
<p><strong>检测的代码问题</strong>:</p>
<ul>
<li>长函数 (Long Function)</li>
<li>重复代码 (Code Duplication)</li>
<li>复杂条件 (Complex Conditionals)</li>
<li>魔法数字 (Magic Numbers)</li>
<li>不一致的命名 (Inconsistent Naming)</li>
</ul>
<p><strong>测试覆盖</strong>: REF-001, REF-002 (代码分析重构相关测试)</p>
<hr/>
<h3 data-id="heading-6">5️⃣ 新手引导 Tour (Interactive Onboarding)</h3>
<p><strong>突破</strong>: 零门槛上手，5分钟快速掌握核心功能。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>首次启动引导</strong></td><td align="left">新用户首次启动自动播放 Tour</td></tr><tr><td align="left"><strong>分步教程</strong></td><td align="left">分步骤介绍聊天、多模态、行内编辑等核心功能</td></tr><tr><td align="left"><strong>高亮提示</strong></td><td align="left">自动高亮相关 UI 元素，配合文字说明</td></tr><tr><td align="left"><strong>跳过/重播</strong></td><td align="left">支持跳过 Tour，通过帮助菜单重新播放</td></tr><tr><td align="left"><strong>进度记忆</strong></td><td align="left">记录用户完成状态，避免重复打扰</td></tr></tbody></table>
<p><strong>引导内容</strong>:</p>
<ol>
<li>欢迎页面介绍</li>
<li>聊天功能演示</li>
<li>多模态图片上传</li>
<li>行内编辑 (Cmd+K)</li>
<li>快捷键说明</li>
<li>帮助与文档入口</li>
</ol>
<p><strong>测试覆盖</strong>: TOUR-E2E-01 ~ TOUR-E2E-04 (4个测试全通过)</p>
<hr/>
<h3 data-id="heading-7">6️⃣ UI 加载反馈 (Loading Feedback)</h3>
<p><strong>突破</strong>: 实时加载动画，告别"空白等待"焦虑。</p>





























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>聊天加载动画</strong></td><td align="left">"IFAI 正在思考..." + 旋转 Spinner</td></tr><tr><td align="left"><strong>行内编辑加载</strong></td><td align="left">"IFAI 正在处理..." + 输入框禁用保护</td></tr><tr><td align="left"><strong>Pulse 动画</strong></td><td align="left">平滑的脉冲动画，视觉反馈清晰</td></tr><tr><td align="left"><strong>状态管理</strong></td><td align="left">Zustand 全局状态统一管理加载状态</td></tr><tr><td align="left"><strong>自动清理</strong></td><td align="left">AI 响应完成后自动清除加载状态</td></tr></tbody></table>
<p><strong>测试覆盖</strong>: MM-UI-01 ~ MM-UI-05, IE-LOAD-01 ~ IE-LOAD-04 (9个测试全通过)</p>
<hr/>
<h3 data-id="heading-8">7️⃣ 多工作区支持 (Multi-Workspace Support)</h3>
<p><strong>突破</strong>: 同时管理多个项目，无缝切换上下文。</p>

























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>多目录索引</strong></td><td align="left">同时索引多个工作区目录</td></tr><tr><td align="left"><strong>智能路径解析</strong></td><td align="left">自动处理跨文件引用路径</td></tr><tr><td align="left"><strong>项目切换</strong></td><td align="left">快速切换不同项目的上下文</td></tr><tr><td align="left"><strong>符号跨项目查找</strong></td><td align="left">在多个项目中查找符号定义和引用</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">8️⃣ Tauri 外链支持 (External Links)</h3>
<p><strong>突破</strong>: 桌面应用原生打开外部链接。</p>

























<table><thead><tr><th align="left">功能</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>Shell API 集成</strong></td><td align="left">使用 Tauri Shell API 打开系统浏览器</td></tr><tr><td align="left"><strong>降级保护</strong></td><td align="left">API 失败时降级到 window.open()</td></tr><tr><td align="left"><strong>帮助菜单链接</strong></td><td align="left">文档、GitHub、Issues 等外部链接</td></tr><tr><td align="left"><strong>关于页面链接</strong></td><td align="left">Wiki、Repository、Discussions</td></tr></tbody></table>
<p><strong>测试覆盖</strong>: ABOUT-01 ~ ABOUT-05 (5个测试全通过)</p>
<p><img src="%E8%BD%AC%E5%AD%98%E5%A4%B1%E8%B4%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%20../imgs/ifai2026-01-1401_1280.gif" alt="AI代码演示转存失败，建议直接上传图片文件" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10">🛠 技术改进</h2>
<h3 data-id="heading-11">多模态处理</h3>
<ul>
<li><strong>Base64 编码优化</strong>: 高效的图片编码处理，内存占用优化</li>
<li><strong>Token 计数自适应</strong>: 根据图片分辨率自动估算 token 消耗</li>
<li><strong>Vision API 检测</strong>: 自动识别支持视觉的 LLM 模型</li>
</ul>
<h3 data-id="heading-12">编辑器增强</h3>
<ul>
<li><strong>符号索引系统</strong>: 基于 tree-sitter 的多语言符号解析</li>
<li><strong>LSP 客户端集成</strong>: 标准化 Language Server Protocol 支持</li>
<li><strong>跨工作区路径解析</strong>: 智能处理多项目符号引用</li>
</ul>
<h3 data-id="heading-13">UI/UX 优化</h3>
<ul>
<li><strong>Zustand 全局状态管理</strong>: 统一的加载状态管理</li>
<li><strong>Tauri Shell API</strong>: 原生外部链接打开支持</li>
<li><strong>加载反馈动画</strong>: Pulse + Spinner 组合动画</li>
</ul>
<h3 data-id="heading-14">测试覆盖</h3>
<ul>
<li><strong>36/36 E2E 测试全部通过</strong></li>
<li><strong>真实 AI 验证</strong>: 包含真实 API 调用的端到端测试</li>
<li><strong>多模态测试</strong>: 5/5 测试通过</li>
<li><strong>代码分析测试</strong>: 9/9 测试通过</li>
<li><strong>帮助页面测试</strong>: 5/5 测试通过</li>
</ul>
<hr/>
<h2 data-id="heading-15">📊 性能表现</h2>



































<table><thead><tr><th align="left">指标</th><th align="left">v0.2.9</th><th align="left">v0.3.0</th><th align="left">改进</th></tr></thead><tbody><tr><td align="left">E2E 通过率</td><td align="left">100% (23/23)</td><td align="left"><strong>100%</strong> (36/36)</td><td align="left">+56% 测试数</td></tr><tr><td align="left">符号索引速度</td><td align="left">~1s</td><td align="left">~0.5s</td><td align="left">50% 提升</td></tr><tr><td align="left">多模态响应延迟</td><td align="left">N/A</td><td align="left">~2s</td><td align="left">新增功能</td></tr><tr><td align="left">图片上传处理</td><td align="left">N/A</td><td align="left">&lt;100ms</td><td align="left">新增功能</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-16">🐛 Bug 修复</h2>






























<table><thead><tr><th align="left">Issue</th><th align="left">描述</th><th align="left">修复方式</th></tr></thead><tbody><tr><td align="left"><strong>MM-001</strong></td><td align="left">多模态图片 token 计数异常</td><td align="left">修正 Base64 编码后的 token 计算公式</td></tr><tr><td align="left"><strong>MM-002</strong></td><td align="left">多模态图片不能识别</td><td align="left">添加 Vision API 模型检测逻辑</td></tr><tr><td align="left"><strong>EDT-001</strong></td><td align="left">行内编辑后无加载反馈</td><td align="left">添加 isProcessing 状态和动画</td></tr><tr><td align="left"><strong>LNK-001</strong></td><td align="left">Tauri 应用外链点击无反应</td><td align="left">使用 Shell API 替代 window.open()</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-17">🔄 升级指南</h2>
<h3 data-id="heading-18">从 v0.2.9 升级</h3>
<ol>
<li><strong>更新依赖</strong>:</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm install
<span class="hljs-built_in">cd</span> src-tauri &amp;&amp; cargo update
</code></pre>
<ol start="2">
<li>
<p><strong>配置文件更新</strong>:
如需使用多模态功能，确保配置支持 Vision API 模型（如 Claude 3.5 Sonnet）</p>
</li>
<li>
<p><strong>重新构建</strong>:</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npm run tauri build
</code></pre>
<ol start="4">
<li><strong>首次启动</strong>: v0.3.0 首次启动会自动播放新手引导 Tour</li>
</ol>
<hr/>
<h2 data-id="heading-19">📝 已知问题</h2>
<ul>
<li><strong>图片大小限制</strong>: 单张图片建议不超过 5MB，过大可能导致 token 溢出</li>
<li><strong>本地模型多模态</strong>: Ollama 本地模型暂不支持 Vision，多模态功能需使用远程 API</li>
<li><strong>跨语言符号查找</strong>: 部分语言的 LSP 支持有限，符号查找可能不完整</li>
</ul>
<hr/>
<h2 data-id="heading-20">🚀 下版本预告 (v0.3.1)</h2>
<p>v0.3.1 将继续优化多模态和代码分析体验：</p>
<ul>
<li><strong>视频理解支持</strong>: 支持短视频帧分析</li>
<li><strong>代码补全增强</strong>: 基于多模态的 UI 代码智能补全</li>
<li><strong>符号搜索改进</strong>: 模糊匹配和驼峰拆分搜索</li>
<li><strong>更多 LSP 语言</strong>: 扩展到 50+ 语言支持</li>
</ul>
<hr/>
<h2 data-id="heading-21">🙏 致谢</h2>
<p>感谢所有参与 v0.3.0 测试和反馈的用户，特别是：</p>
<ul>
<li>多模态功能测试的贡献者</li>
<li>代码分析功能的反馈者</li>
<li>Bug 报告和功能建议的用户</li>
<li>社区的持续支持</li>
</ul>
<hr/>
<p><strong>下载</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpeterfei%2Fifai%2Freleases%2Ftag%2Fv0.3.0" target="_blank" title="https://github.com/peterfei/ifai/releases/tag/v0.3.0" ref="nofollow noopener noreferrer">github.com/peterfei/if…</a></p>
<p><strong>完整文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpeterfei%2Fifai%2Ftree%2Fv0.3.0%2Fdocs" target="_blank" title="https://github.com/peterfei/ifai/tree/v0.3.0/docs" ref="nofollow noopener noreferrer">github.com/peterfei/if…</a></p>
<p><strong>讨论区</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpeterfei%2Fifai%2Fdiscussions" target="_blank" title="https://github.com/peterfei/ifai/discussions" ref="nofollow noopener noreferrer">github.com/peterfei/if…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[谷歌Antigravity 也支持技能了！]]></title>    <link>https://juejin.cn/post/7595021656428118043</link>    <guid>https://juejin.cn/post/7595021656428118043</guid>    <pubDate>2026-01-14T10:30:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656428118043" data-draft-id="7595030559564365875" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="谷歌Antigravity 也支持技能了！"/> <meta itemprop="keywords" content="Google"/> <meta itemprop="datePublished" content="2026-01-14T10:30:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="甲维斯"/> <meta itemprop="url" content="https://juejin.cn/user/63109670111066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            谷歌Antigravity 也支持技能了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/63109670111066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    甲维斯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:30:30.000Z" title="Wed Jan 14 2026 10:30:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SKILL 这几天实在是太火了！！！</p>
<p>这不，谷歌Antigravity 也快速跟进了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cec344bd338444bda342238fbcc4fea3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sy57u05pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768991430&amp;x-signature=UiM%2B8yeF%2Fm8RjmLzXZrXllxklfY%3D" alt="" loading="lazy"/></p>
<p>Google Antigravity 官方账号今天发了 一条推特。表示"Antigravity 也支持技能了"</p>
<p>并对 Skills 做了一个简要的介绍：</p>
<blockquote>
<p><strong>Skills</strong> 是一种用于扩展你的智能体能力的开放标准。</p>
<p>无论是项目专属的工作流，还是通用的工具能力，你现在都可以把知识封装成可复用的 <strong>Skills</strong>。</p>
</blockquote>
<p>Google Antigravity 是谷歌的编程 IDE，随着上一次 G3pro 一起发布。因为 IDE 可以免费使用 Gemini3 和 Claude4.5，开通会员之后配额也比较多，所以使用的人数一下子也多了起来。</p>
<p>最近一直没有更新，没想到因为 SKILL 更新了一波。</p>
<p>查看了软件的 changelog 也可以看到，就在昨天更发布了一个更新版本。</p>
<p>更新标题就是"Agent Skills", 主要更新就是引入了技能。</p>
<p>官方也发布了技能相关文档。</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//antigravity.google/docs/skills</span>
</code></pre>
<p>来花个十分钟学习一下谷歌版 SKILL 吧！</p>
<hr/>
<h2 data-id="heading-0">概述</h2>
<p><strong>Skills</strong> 是一个用于扩展 AI Agent 能力的<strong>开放标准</strong>。每个 Skill 是一个包含 <code>SKILL.md</code> 文件的文件夹，里面有 Agent 在执行特定任务时可以遵循的指令。</p>
<hr/>
<h2 data-id="heading-1">Skills 是什么？</h2>
<p>Skills 是<strong>可复用的知识包</strong>，用于扩展 Agent 的能力。每个 Skill 包含：</p>





















<table><thead><tr><th>组成部分</th><th>说明</th></tr></thead><tbody><tr><td><strong>Instructions</strong></td><td>如何处理特定类型任务的指令</td></tr><tr><td><strong>Best practices</strong></td><td>应遵循的最佳实践和约定</td></tr><tr><td><strong>Scripts &amp; Resources</strong></td><td>Agent 可使用的可选脚本和资源</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">Skills 存放位置</h2>
<p>支持两种类型的 Skills：</p>

















<table><thead><tr><th>位置</th><th>作用域</th></tr></thead><tbody><tr><td><code>&lt;workspace-root&gt;/.agent/skills/&lt;skill-folder&gt;/</code></td><td>当前项目</td></tr><tr><td><code>~/.gemini/antigravity/skills/&lt;skill-folder&gt;/</code></td><td>所有项目通用</td></tr></tbody></table>
<h3 data-id="heading-3">使用场景</h3>
<ul>
<li><strong>Workspace skills</strong>：适用于项目特定的工作流，如团队部署流程或测试约定</li>
<li><strong>Global skills</strong>：适用于跨项目的个人工具或通用功能</li>
</ul>
<hr/>
<h2 data-id="heading-4">如何创建 Skill</h2>
<h3 data-id="heading-5">步骤</h3>
<ol>
<li>在 skill 目录中创建文件夹</li>
<li>添加 <code>SKILL.md</code> 文件，包含 YAML frontmatter</li>
</ol>
<h3 data-id="heading-6">文件夹结构</h3>
<pre><code class="hljs language-bash" lang="bash">.agent/skills/my-skill/
├── SKILL.md        <span class="hljs-comment"># 主指令文件（必需）</span>
├── scripts/        <span class="hljs-comment"># 辅助脚本（可选）</span>
├── examples/       <span class="hljs-comment"># 参考实现（可选）</span>
└── resources/      <span class="hljs-comment"># 模板和资源（可选）</span>
</code></pre>
<h3 data-id="heading-7">SKILL.md 文件结构</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">name:</span> <span class="hljs-string">my-skill</span>
<span class="hljs-string">description:</span> <span class="hljs-string">Helps</span> <span class="hljs-string">with</span> <span class="hljs-string">a</span> <span class="hljs-string">specific</span> <span class="hljs-string">task.</span> <span class="hljs-string">Use</span> <span class="hljs-string">when</span> <span class="hljs-string">you</span> <span class="hljs-string">need</span> <span class="hljs-string">to</span> <span class="hljs-string">do</span> <span class="hljs-string">X</span> <span class="hljs-string">or</span> <span class="hljs-string">Y.</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># My Skill</span>

<span class="hljs-string">Detailed</span> <span class="hljs-string">instructions</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">agent</span> <span class="hljs-string">go</span> <span class="hljs-string">here.</span>

<span class="hljs-comment">## When to use this skill</span>
<span class="hljs-string">-</span> <span class="hljs-string">Use</span> <span class="hljs-string">this</span> <span class="hljs-string">when...</span>

<span class="hljs-comment">## How to use it</span>
<span class="hljs-string">Step-by-step</span> <span class="hljs-string">guidance...</span>
</code></pre>
<h3 data-id="heading-8">文档元信息</h3>




















<table><thead><tr><th>字段</th><th>必需</th><th>说明</th></tr></thead><tbody><tr><td><code>name</code></td><td>否</td><td>Skill 的唯一标识符（小写，用连字符替代空格）</td></tr><tr><td><code>description</code></td><td><strong>是</strong></td><td>清晰描述 Skill 的用途和使用场景</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">Agent 如何使用 Skills</h2>
<p>Skills 遵循<strong>渐进式披露（Progressive Disclosure）</strong> 模式：</p>
<ol>
<li><strong>Discovery（发现）</strong> 对话开始时，Agent 看到可用 Skills 的名称和描述列表</li>
<li><strong>Activation（激活）</strong> 如果某个 Skill 与任务相关，Agent 读取完整的 <code>SKILL.md</code> 内容</li>
<li><strong>Execution（执行）</strong> Agent 在工作时遵循 Skill 的指令</li>
</ol>
<hr/>
<h2 data-id="heading-10">最佳实践</h2>

























<table><thead><tr><th>原则</th><th>说明</th></tr></thead><tbody><tr><td><strong>Keep skills focused</strong></td><td>每个 Skill 只做一件事，避免"万能"技能</td></tr><tr><td><strong>Write clear descriptions</strong></td><td>描述是 Agent 决定是否使用的关键，要具体明确</td></tr><tr><td><strong>Use scripts as black boxes</strong></td><td>鼓励 Agent 先用 <code>--help</code> 而非阅读源码</td></tr><tr><td><strong>Include decision trees</strong></td><td>复杂 Skills 需包含帮助选择正确方法的决策逻辑</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">示例：代码审查 Skill</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">name:</span> <span class="hljs-string">code-review</span>
<span class="hljs-string">description:</span> <span class="hljs-string">Reviews</span> <span class="hljs-string">code</span> <span class="hljs-string">changes</span> <span class="hljs-string">for</span> <span class="hljs-string">bugs,</span> <span class="hljs-string">style</span> <span class="hljs-string">issues,</span> <span class="hljs-string">and</span> <span class="hljs-string">best</span> <span class="hljs-string">practices.</span> <span class="hljs-string">Use</span> <span class="hljs-string">when</span> <span class="hljs-string">reviewing</span> <span class="hljs-string">PRs</span> <span class="hljs-string">or</span> <span class="hljs-string">checking</span> <span class="hljs-string">code</span> <span class="hljs-string">quality.</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># Code Review Skill</span>

<span class="hljs-string">When</span> <span class="hljs-string">reviewing</span> <span class="hljs-string">code,</span> <span class="hljs-string">follow</span> <span class="hljs-string">these</span> <span class="hljs-attr">steps:</span>

<span class="hljs-comment">## Review checklist</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">**Correctness**:</span> <span class="hljs-string">Does</span> <span class="hljs-string">the</span> <span class="hljs-string">code</span> <span class="hljs-string">do</span> <span class="hljs-string">what</span> <span class="hljs-string">it's</span> <span class="hljs-string">supposed</span> <span class="hljs-string">to?</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">**Edge</span> <span class="hljs-string">cases**:</span> <span class="hljs-string">Are</span> <span class="hljs-string">error</span> <span class="hljs-string">conditions</span> <span class="hljs-string">handled?</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">**Style**:</span> <span class="hljs-string">Does</span> <span class="hljs-string">it</span> <span class="hljs-string">follow</span> <span class="hljs-string">project</span> <span class="hljs-string">conventions?</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">**Performance**:</span> <span class="hljs-string">Are</span> <span class="hljs-string">there</span> <span class="hljs-string">obvious</span> <span class="hljs-string">inefficiencies?</span>

<span class="hljs-comment">## How to provide feedback</span>
<span class="hljs-string">-</span> <span class="hljs-string">Be</span> <span class="hljs-string">specific</span> <span class="hljs-string">about</span> <span class="hljs-string">what</span> <span class="hljs-string">needs</span> <span class="hljs-string">to</span> <span class="hljs-string">change</span>
<span class="hljs-string">-</span> <span class="hljs-string">Explain</span> <span class="hljs-string">why,</span> <span class="hljs-string">not</span> <span class="hljs-string">just</span> <span class="hljs-string">what</span>
<span class="hljs-string">-</span> <span class="hljs-string">Suggest</span> <span class="hljs-string">alternatives</span> <span class="hljs-string">when</span> <span class="hljs-string">possible</span>
</code></pre>
<h2 data-id="heading-12">总结</h2>
<p>Google Antigravity 的 Skills 系统是一个<strong>灵活、可扩展的框架</strong>，让用户可以通过简单的 Markdown 文件来定制 AI Agent 的行为，使其能够遵循特定的工作流程和最佳实践。</p>
<hr/>
<p>这个标准基本上遵循了 AgentSkills 的标准，和 codex，以及 Claude Code 的大同小异。</p>
<p>主要的差异还是在技能的存放路径上面！</p>
<p>知道了这个规则之后 Claude Code 上的技能就可以快速给 Antigravity 复用了，以后可以一边用 IDE 一边用技能了。</p>
<p>技能这个标准虽然很简单，但是自由度很大，每个人都可以有自己的技能，挺好的！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入掌握 AI 全栈项目中的路由功能：从基础到进阶的全面解析]]></title>    <link>https://juejin.cn/post/7594835618120728616</link>    <guid>https://juejin.cn/post/7594835618120728616</guid>    <pubDate>2026-01-14T10:32:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120728616" data-draft-id="7595043061728624674" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入掌握 AI 全栈项目中的路由功能：从基础到进阶的全面解析"/> <meta itemprop="keywords" content="前端,React.js,全栈"/> <meta itemprop="datePublished" content="2026-01-14T10:32:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="社恐的下水道蟑螂"/> <meta itemprop="url" content="https://juejin.cn/user/423789937565536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入掌握 AI 全栈项目中的路由功能：从基础到进阶的全面解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/423789937565536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    社恐的下水道蟑螂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:32:13.000Z" title="Wed Jan 14 2026 10:32:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在构建现代 Web 应用的过程中，路由管理是必不可少的一部分。本文将深入探讨 AI 全栈项目中的路由功能，涵盖基础知识、进阶概念以及常见的最佳实践。无论您是初学者还是有一定经验的开发者，希望本文能够帮助您在路由管理方面获得更深入的理解。</p>
<h2 data-id="heading-0">路由的基础知识</h2>
<p>路由的基本任务是将用户请求的 URL 映射到不同的页面或组件。借助 <code>react-router-dom</code>，我们能够有效地管理 React 应用中的路由。首先，在构建项目之前，请确保已安装 <code>react-router-dom</code> 依赖：</p>
<p>bash</p>
<p>Copy Code</p>
<p><code>npm install react-router-dom</code></p>
<h3 data-id="heading-1">使用 <code>react-router-dom</code></h3>
<p>在我们的 AI 全栈项目中，路由的基本配置如下：</p>
<p>javascript</p>
<p>Copy Code</p>
<p><code>import { BrowserRouter as Router, Route, Switch } from 'react-router-dom'; function App() { return ( &lt;Router&gt; &lt;Switch&gt; &lt;Route path="/" exact component={Home} /&gt; &lt;Route path="/about" component={About} /&gt; &lt;Route path="/products" component={ProductList} /&gt; &lt;Route path="/product/:id" component={ProductDetail} /&gt; &lt;Route component={NotFound} /&gt; &lt;/Switch&gt; &lt;/Router&gt; ); }</code></p>
<ul>
<li><strong>Router</strong>：定义应用的路由上下文，是路由的基本容器。</li>
<li><strong>Switch</strong>：确保只有第一个匹配的路由被渲染。非常适合用于管理多个路由。</li>
<li><strong>Route</strong>：将特定的路径与组件关联。</li>
</ul>
<h2 data-id="heading-2">路由类型分析</h2>
<h3 data-id="heading-3">普通路由和动态路由</h3>
<ul>
<li><strong>普通路由</strong>：通过<code>path</code>直接定义静态路由，如 <code>/about</code> 会直接加载 About 组件。</li>
<li><strong>动态路由</strong>：使用参数捕获的形式，使得路由更加灵活，比如 <code>/product/:id</code>，可以根据产品 ID 动态渲染内容。</li>
</ul>
<h3 data-id="heading-4">嵌套路由与特殊路由</h3>
<ul>
<li><strong>嵌套路由</strong>：使用 <code>&lt;Outlet&gt;</code> 实现子路由嵌套，允许组件在其内部再渲染其他路由。</li>
</ul>
<p>javascript</p>
<p>Copy Code</p>
<p><code>function Dashboard() { return ( &lt;div&gt; &lt;h2&gt;管理面板&lt;/h2&gt; &lt;Outlet /&gt; {/* 渲染嵌套的子路由 */} &lt;/div&gt; ); }</code></p>
<ul>
<li>
<p><strong>特殊路由</strong>：</p>
<ul>
<li><strong>鉴权路由</strong>：检查用户是否已登录，以决定是否允许访问特定路由。可以使用高阶组件来实现。</li>
<li><strong>重定向路由</strong>：通过 <code>Navigate</code> 组件实现用户访问时的自动跳转，非常适合处理过期链接。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">进阶路由类型</h3>
<ol>
<li><strong>通配路由</strong>： 通配路由使用 <code>*</code> 来匹配所有路径，适合处理需要捕获未定义路径的场景，例如错误页面或404页面。</li>
<li><strong>搜索和查询参数</strong>： React Router 允许你处理 URL 中的查询参数。我们可以通过 <code>useLocation</code> 获取当前 URL 的查询参数，方便地提取中特定的数据。</li>
</ol>
<p>javascript</p>
<p>Copy Code</p>
<p><code>import { useLocation } from 'react-router-dom'; function SearchResults() { const query = new URLSearchParams(useLocation().search); const searchTerm = query.get('search'); return &lt;div&gt;搜索结果: {searchTerm}&lt;/div&gt;; }</code></p>
<ol start="3">
<li><strong>使用 Hooks 实现更好的可重用性</strong>： 使用 React Router 的内置 Hooks（如 <code>useParams</code>, <code>useHistory</code> 和 <code>useLocation</code>）可以轻松访问路由信息、动态参数和历史记录，提升组件内的灵活性。</li>
</ol>
<h2 data-id="heading-6">路由生成访问历史</h2>
<p>在单页应用的背景下，路由不仅管理组件的显示，还处理访问历史的管理。使用 <code>history.push()</code> 方法能够在不重新加载页面的情况下更改 URL，这提升了用户体验。</p>
<p>javascript</p>
<p>Copy Code</p>
<p><code>history.push('/products'); // 改变 URL，并自动加载对应组件</code></p>
<h3 data-id="heading-7">维护良好的历史记录</h3>
<ul>
<li><strong>replace 方法</strong>：通过 <code>history.replace()</code> 替代当前入口而不在历史记录中创建新的路径，但这种方法通常仅在更新表单等场景下使用。</li>
</ul>
<h3 data-id="heading-8">单页应用的优势</h3>
<p>单页应用（SPA）使用前端路由来接收路由变化的事件，并动态渲染相应的组件，避免了重新加载整个页面，从而提升了性能。<code>react-router-dom</code> 实现的路由系统使得路由变化无缝连接。</p>
<p>javascript</p>
<p>Copy Code</p>
<p><code>&lt;Route path="/home" component={Home} /&gt; // 组件动态更新，无需完整刷新</code></p>
<h2 data-id="heading-9">实际案例：构建产品页面</h2>
<p>为了更全面地理解路由的应用，我们将以构建一个简单的产品页面为例，其中包括产品列表和产品详情页面，并利用动态路由来展示不同产品的信息。</p>
<h3 data-id="heading-10">产品列表组件示例</h3>
<p>javascript</p>
<p>Copy Code</p>
<p><code>function ProductList() {  const products = [{ id: 1, name: 'Product A' }, { id: 2, name: 'Product B' }]; return (&lt;div&gt; &lt;h2&gt;产品列表&lt;/h2&gt; &lt;ul&gt; {products.map(product =&gt; ( &lt;li key={product.id}&gt; &lt;Link to={`/product/${product.id}`}&gt;{product.name}&lt;/Link&gt; &lt;/li&gt; ))} &lt;/ul&gt; &lt;/div&gt; ); }</code></p>
<h3 data-id="heading-11">产品详情组件示例</h3>
<p>javascript</p>
<p>Copy Code</p>
<p><code>function ProductDetail({ match }) { const { id } = match.params; // 获取动态路由的参数 const product = getProductById(id); // 假设有个函数根据 ID 获取产品信息 return ( &lt;div&gt; &lt;h2&gt;{product.name}&lt;/h2&gt; &lt;p&gt;{product.description}&lt;/p&gt; &lt;/div&gt; ); }</code></p>
<h2 data-id="heading-12">最佳实践与小结</h2>
<p>在构建应用的过程中，有些最佳实践可以帮助我们更好地管理路由：</p>
<ol>
<li><strong>保持路由配置的整洁性</strong>：将所有路由配置集中管理，可以提高代码的可读性和可维护性。</li>
<li><strong>使用懒加载</strong>：结合 <code>React.lazy</code> 和 <code>Suspense</code> 实现组件的懒加载，提高应用的初始加载速度。</li>
<li><strong>控件状态管理</strong>：使用 Zustand 或 Redux 这样的状态管理库来集中控制路由状态和数据共享，以避免道琼斯效应。</li>
</ol>
<p>通过对 AI 全栈项目中路由功能的详细解析，希望您能在路由管理方面获得实质性的提升。良好的路由管理不仅能提升开发效率，还能极大改善用户体验。学习这些知识的目的不仅是为了掌握技术，更是为了解决实际问题，并为用户提供更好的产品体验。继续学习和实践，相信您会在现代 Web 开发的领域中有所建树！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 配置完全指南]]></title>    <link>https://juejin.cn/post/7594863660297912362</link>    <guid>https://juejin.cn/post/7594863660297912362</guid>    <pubDate>2026-01-14T10:19:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297912362" data-draft-id="7595043440519462918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 配置完全指南"/> <meta itemprop="keywords" content="VibeCoding"/> <meta itemprop="datePublished" content="2026-01-14T10:19:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gaaraa"/> <meta itemprop="url" content="https://juejin.cn/user/35624744391213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 配置完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/35624744391213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gaaraa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:19:12.000Z" title="Wed Jan 14 2026 10:19:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Cursor 配置完全指南</h2>
<blockquote>
<p>全方位解析 Cursor 的配置体系，从入门到精通</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">目录</h3>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%A6%82%E8%A7%88" title="#%E9%85%8D%E7%BD%AE%E4%BD%93%E7%B3%BB%E6%A6%82%E8%A7%88">配置体系概览</a></li>
<li><a href="#cursor-rules-%E9%85%8D%E7%BD%AE" title="#cursor-rules-%E9%85%8D%E7%BD%AE">Cursor Rules 配置</a></li>
<li><a href="#mcp-model-context-protocol-%E9%85%8D%E7%BD%AE" title="#mcp-model-context-protocol-%E9%85%8D%E7%BD%AE">MCP (Model Context Protocol) 配置</a></li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E5%8C%BA%E9%85%8D%E7%BD%AE" title="#%E5%B7%A5%E4%BD%9C%E5%8C%BA%E9%85%8D%E7%BD%AE">工作区配置</a></li>
<li><a href="#ai-%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE" title="#ai-%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE">AI 模型配置</a></li>
<li><a href="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%B8%8E%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE" title="#%E5%BF%AB%E6%8D%B7%E9%94%AE%E4%B8%8E%E5%91%BD%E4%BB%A4%E9%85%8D%E7%BD%AE">快捷键与命令配置</a></li>
<li><a href="#%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B" title="#%E5%AE%9E%E7%94%A8%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B">实用配置案例</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96" title="#%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B5%84%E6%BA%90%E8%8E%B7%E5%8F%96">第三方资源获取</a></li>
<li><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" title="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">常见问题</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">配置体系概览</h3>
<h4 data-id="heading-3">Cursor 配置层级</h4>
<pre><code class="hljs language-scss" lang="scss">全局配置 (Global)
    ↓
工作区配置 (Workspace)
    ↓
项目配置 (Project)
    ↓
文件级配置 (File)
</code></pre>
<h4 data-id="heading-4">配置文件位置</h4>
<pre><code class="hljs language-bash" lang="bash">~/.cursor/                          <span class="hljs-comment"># Cursor 全局配置目录</span>
├── settings.json                   <span class="hljs-comment"># 全局设置</span>
├── keybindings.json               <span class="hljs-comment"># 全局快捷键</span>
└── extensions/                     <span class="hljs-comment"># 扩展配置</span>

项目根目录/
├── .cursor/                        <span class="hljs-comment"># 项目级 Cursor 配置</span>
│   ├── rules/                      <span class="hljs-comment"># AI 规则文件</span>
│   │   ├── .cursorrules           <span class="hljs-comment"># 主规则文件</span>
│   │   └── projects/              <span class="hljs-comment"># 项目规则</span>
│   │       ├── sub-rules/         <span class="hljs-comment"># 子规则</span>
│   │       └── templates/         <span class="hljs-comment"># 模板规则</span>
│   ├── mcp.json                   <span class="hljs-comment"># MCP 配置</span>
│   └── settings.json              <span class="hljs-comment"># 项目设置</span>
├── .cursorignore                  <span class="hljs-comment"># 忽略文件配置</span>
└── .vscode/                       <span class="hljs-comment"># VSCode 兼容配置</span>
    ├── settings.json              <span class="hljs-comment"># 编辑器设置</span>
    └── extensions.json            <span class="hljs-comment"># 推荐扩展</span>
</code></pre>
<h4 data-id="heading-5">配置优先级</h4>
<pre><code class="hljs">文件级配置 &gt; 项目配置 &gt; 工作区配置&gt; 全局配置
</code></pre>
<hr/>
<h3 data-id="heading-6">Cursor Rules 配置</h3>
<h4 data-id="heading-7">什么是 Cursor Rules？</h4>
<p>Cursor Rules 是告诉 AI 如何理解和处理你的项目的指令集，类似于给 AI 助手的"工作手册"。</p>
<h4 data-id="heading-8">规则文件类型</h4>
<h5 data-id="heading-9">1. <code>.cursorrules</code> - 主规则文件</h5>
<p><strong>位置</strong>: 项目根目录或 <code>.cursor/</code> 目录</p>
<p><strong>作用</strong>: 定义项目的核心规则，AI 会自动读取</p>
<p><strong>示例</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目基本信息</span>

项目名称: Haiyi App
技术栈: Vue 3 + TypeScript + uni-app
目标平台: 微信小程序

<span class="hljs-section"># 代码规范</span>

<span class="hljs-section">## 命名规范</span>
<span class="hljs-bullet">-</span> 组件: PascalCase (如 UserCard.vue)
<span class="hljs-bullet">-</span> 文件: kebab-case (如 user-card.ts)
<span class="hljs-bullet">-</span> 变量/函数: camelCase (如 getUserInfo)
<span class="hljs-bullet">-</span> 常量: UPPER<span class="hljs-emphasis">_SNAKE_</span>CASE (如 MAX<span class="hljs-emphasis">_COUNT)

## TypeScript 规范
- 严格模式: 启用 strict: true
- 禁止使用 any，必要时使用 unknown
- 所有函数必须有类型注解
- 接口使用 I 前缀 (如 IUserInfo)

## Vue 3 规范
- 使用 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span></span>
- 优先使用 Composition API
- Props 使用 defineProps<span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Props</span>&gt;</span></span></span>()
- Emits 使用 defineEmits<span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Emits</span>&gt;</span></span></span>()

## 文件组织
- 页面: src/pages/
- 组件: src/components/
- API: src/api/
- 类型: src/types/
- 工具: src/utils/
- Composables: src/composables/

# 开发约束

- 单个函数不超过 50 行
- 单个文件不超过 300 行
- 所有异步操作必须有错误处理
- 组件必须有 JSDoc 注释
- 不要自行添加未要求的功能

# Git 规范

提交格式: <span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span></span></span>(<span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span></span></span>): <span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span></span></span>

类型:
- feat: 新功能
- fix: 修复
- refactor: 重构
- docs: 文档
- style: 格式
- test: 测试
- chore: 其他

所有 commit 必须包含签名:
Signed-off-by: Name <span class="xml">&lt;email@example.com&gt;</span>
</span></code></pre>
<h5 data-id="heading-10">2. <code>.mdc</code> - Markdown 规则文件</h5>
<p><strong>位置</strong>: <code>.cursor/rules/projects/sub-rules/</code></p>
<p><strong>作用</strong>: 模块化的规则文件，可以按功能拆分</p>
<p><strong>优势</strong>:</p>
<ul>
<li>支持更复杂的结构</li>
<li>可以被其他规则引用</li>
<li>便于团队协作和维护</li>
</ul>
<p><strong>示例</strong>: <code>code-rules.mdc</code></p>
<pre><code class="hljs language-markdown" lang="markdown">---
title: 代码规范
description: 项目代码编写规范
version: 1.0.0
<span class="hljs-section">author: Team
---</span>

<span class="hljs-section"># 代码规范</span>

<span class="hljs-section">## TypeScript 类型定义</span>

<span class="hljs-section">### 接口定义</span>

<span class="hljs-code">```typescript
// ✅ 推荐
interface IUserInfo {
  id: number
  name: string
  avatar?: string
  createdAt: Date
}

// ❌ 不推荐
interface UserInfo {
  id: any
  name: string
}
</span></code></pre>
<h4 data-id="heading-11">类型别名</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 联合类型使用 type</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Status</span> = <span class="hljs-string">'pending'</span> | <span class="hljs-string">'success'</span> | <span class="hljs-string">'error'</span>

<span class="hljs-comment">// ✅ 复杂类型使用 type</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ApiResponse</span>&lt;T&gt; = {
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">data</span>: T
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<h3 data-id="heading-12">Vue 组件规范</h3>
<h4 data-id="heading-13">Props 定义</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 推荐</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  count?: <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), {
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
})

<span class="hljs-comment">// ❌ 不推荐</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">title</span>: <span class="hljs-title class_">String</span>,
  <span class="hljs-attr">count</span>: <span class="hljs-title class_">Number</span>
})
</code></pre>
<h4 data-id="heading-14">Emits 定义</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 推荐</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'update'</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>
  (<span class="hljs-attr">e</span>: <span class="hljs-string">'close'</span>): <span class="hljs-built_in">void</span>
}&gt;()

<span class="hljs-comment">// ❌ 不推荐</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'update'</span>, <span class="hljs-string">'close'</span>])
</code></pre>
<h3 data-id="heading-15">错误处理</h3>
<h4 data-id="heading-16">异步操作</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 推荐</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getData</span>()
    <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取数据失败:'</span>, error)
    uni.<span class="hljs-title function_">showToast</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">'获取数据失败'</span>,
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>
    })
    <span class="hljs-keyword">throw</span> error
  }
}

<span class="hljs-comment">// ❌ 不推荐</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">getData</span>()
  <span class="hljs-keyword">return</span> res.<span class="hljs-property">data</span>
}
</code></pre>
<h3 data-id="heading-17">性能优化</h3>
<h4 data-id="heading-18">列表渲染</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- ✅ 推荐 --&gt;
&lt;view
  v-for="item in list"
  :key="item.id"
  v-memo="[item.status]"
&gt;
  {{ item.name }}
&lt;/view&gt;

&lt;!-- ❌ 不推荐 --&gt;
&lt;view v-for="(item, index) in list" :key="index"&gt;
  {{ item.name }}
&lt;/view&gt;
</code></pre>
<h4 data-id="heading-19">计算属性</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 推荐</span>
<span class="hljs-keyword">const</span> filteredList = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> list.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>)
})

<span class="hljs-comment">// ❌ 不推荐</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">filteredList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> list.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>)
}
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-comment">#### 3. 特殊规则文件</span>

<span class="hljs-string">**`animation-effects.mdc`**</span> <span class="hljs-bullet">-</span> <span class="hljs-string">动画效果规则</span>

<span class="hljs-string">```markdown</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">动画效果规范</span>
<span class="hljs-attr">trigger:</span> [<span class="hljs-string">"动画效果"</span>, <span class="hljs-string">"增加动效"</span>, <span class="hljs-string">"增加动画效果"</span>]
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># 动画效果规范</span>

<span class="hljs-comment">## 触发方式</span>

<span class="hljs-string">当用户说"动画效果"、"增加动效"或"增加动画效果"时，自动应用此规则。</span>

<span class="hljs-comment">## 动画原则</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">**性能优先**:</span> <span class="hljs-string">使用</span> <span class="hljs-string">transform</span> <span class="hljs-string">和</span> <span class="hljs-string">opacity，避免触发重排</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">**时长适中**:</span> <span class="hljs-number">150</span><span class="hljs-string">-300ms</span> <span class="hljs-string">为最佳体验</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">**缓动函数**:</span> <span class="hljs-string">使用</span> <span class="hljs-string">ease-out</span> <span class="hljs-string">让动画更自然</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">**减少动画**:</span> <span class="hljs-string">尊重用户的</span> <span class="hljs-string">prefers-reduced-motion</span> <span class="hljs-string">设置</span>

<span class="hljs-comment">## 常用动画</span>

<span class="hljs-comment">### 淡入淡出</span>

<span class="hljs-string">```scss</span>
<span class="hljs-string">.fade-enter-active,</span>
<span class="hljs-string">.fade-leave-active</span> {
  <span class="hljs-attr">transition:</span> <span class="hljs-string">opacity</span> <span class="hljs-number">0.</span><span class="hljs-string">3s</span> <span class="hljs-string">ease;</span>
}

<span class="hljs-string">.fade-enter-from,</span>
<span class="hljs-string">.fade-leave-to</span> {
  <span class="hljs-attr">opacity:</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
}
</code></pre>
<h4 data-id="heading-20">滑动</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.slide-up-enter-active</span>,
<span class="hljs-selector-class">.slide-up-leave-active</span> {
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease-out;
}

<span class="hljs-selector-class">.slide-up-enter-from</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">100%</span>);
}

<span class="hljs-selector-class">.slide-up-leave-to</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">100%</span>);
}
</code></pre>
<h4 data-id="heading-21">缩放</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.scale-enter-active</span>,
<span class="hljs-selector-class">.scale-leave-active</span> {
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span> ease-out;
}

<span class="hljs-selector-class">.scale-enter-from</span>,
<span class="hljs-selector-class">.scale-leave-to</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scale</span>(<span class="hljs-number">0.8</span>);
}
</code></pre>
<h3 data-id="heading-22">Vue 3 Transition</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Transition name="fade"&gt;
    &lt;view v-if="show"&gt;内容&lt;/view&gt;
  &lt;/Transition&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-23">uni-app 动画</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> animation = uni.<span class="hljs-title function_">createAnimation</span>({
  <span class="hljs-attr">duration</span>: <span class="hljs-number">300</span>,
  <span class="hljs-attr">timingFunction</span>: <span class="hljs-string">'ease-out'</span>
})

animation.<span class="hljs-title function_">translateY</span>(-<span class="hljs-number">100</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">step</span>()

animationData.<span class="hljs-property">value</span> = animation.<span class="hljs-title function_">export</span>()
</code></pre>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">**`figma-to-vue.mdc`**</span> <span class="hljs-bullet">-</span> <span class="hljs-string">Figma</span> <span class="hljs-string">转</span> <span class="hljs-string">Vue</span> <span class="hljs-string">规则</span>

<span class="hljs-string">```markdown</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">Figma</span> <span class="hljs-string">到</span> <span class="hljs-string">Vue</span> <span class="hljs-string">开发流程</span>
<span class="hljs-attr">trigger:</span> [<span class="hljs-string">"figma2vue"</span>, <span class="hljs-string">"从Figma生成页面"</span>]
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># Figma 到 Vue 开发流程</span>

<span class="hljs-comment">## 触发方式</span>

<span class="hljs-string">使用</span> <span class="hljs-string">"figma2vue"</span> <span class="hljs-string">或</span> <span class="hljs-string">"从Figma生成页面"</span> <span class="hljs-string">触发此工作流。</span>

<span class="hljs-comment">## 工作流程</span>

<span class="hljs-comment">### 第1步: 分析设计稿</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">获取</span> <span class="hljs-string">Figma</span> <span class="hljs-string">设计稿链接</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">分析页面结构和组件</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">识别可复用组件</span>
<span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">确定响应式断点</span>

<span class="hljs-comment">### 第2步: 组件拆分</span>

<span class="hljs-string">按以下优先级拆分组件:</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">**基础组件**</span> <span class="hljs-string">(Base)</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">按钮、输入框、标签等</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">高复用、无业务逻辑</span>

<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">**业务组件**</span> <span class="hljs-string">(Business)</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">用户卡片、商品卡片等</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">中等复用、包含业务逻辑</span>

<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">**页面组件**</span> <span class="hljs-string">(Page)</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">页面特定组件</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">低复用、页面专用</span>

<span class="hljs-comment">### 第3步: 样式转换</span>

<span class="hljs-comment">#### Figma 设计 → CSS/SCSS</span>

<span class="hljs-string">|</span> <span class="hljs-string">Figma</span> <span class="hljs-string">属性</span> <span class="hljs-string">|</span> <span class="hljs-string">CSS</span> <span class="hljs-string">属性</span> <span class="hljs-string">|</span>
<span class="hljs-string">|-----------|---------|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Frame</span> <span class="hljs-string">|</span> <span class="hljs-string">div/view</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Auto</span> <span class="hljs-string">Layout</span> <span class="hljs-string">|</span> <span class="hljs-string">flex</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Padding</span> <span class="hljs-string">|</span> <span class="hljs-string">padding</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Gap</span> <span class="hljs-string">|</span> <span class="hljs-string">gap</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Fill</span> <span class="hljs-string">|</span> <span class="hljs-string">background</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Stroke</span> <span class="hljs-string">|</span> <span class="hljs-string">border</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Effects</span> <span class="hljs-string">→</span> <span class="hljs-string">Drop</span> <span class="hljs-string">Shadow</span> <span class="hljs-string">|</span> <span class="hljs-string">box-shadow</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Effects</span> <span class="hljs-string">→</span> <span class="hljs-string">Blur</span> <span class="hljs-string">|</span> <span class="hljs-string">backdrop-filter</span> <span class="hljs-string">|</span>

<span class="hljs-comment">#### 单位转换</span>

<span class="hljs-string">```scss</span>
<span class="hljs-string">//</span> <span class="hljs-string">Figma</span> <span class="hljs-string">使用</span> <span class="hljs-string">px，小程序使用</span> <span class="hljs-string">rpx</span>
<span class="hljs-string">//</span> <span class="hljs-string">设计稿宽度</span> <span class="hljs-string">750px</span> <span class="hljs-string">=</span> <span class="hljs-string">100vw</span>

<span class="hljs-string">@function</span> <span class="hljs-string">px2rpx($px)</span> {
  <span class="hljs-string">@return</span> <span class="hljs-string">$px</span> <span class="hljs-string">*</span> <span class="hljs-string">2rpx;</span>
}

<span class="hljs-string">//</span> <span class="hljs-attr">Figma:</span> <span class="hljs-string">16px</span> <span class="hljs-string">→</span> <span class="hljs-attr">SCSS:</span> <span class="hljs-string">32rpx</span>
<span class="hljs-string">.text</span> {
  <span class="hljs-attr">font-size:</span> <span class="hljs-string">px2rpx(16);</span> <span class="hljs-string">//</span> <span class="hljs-string">32rpx</span>
}
</code></pre>
<h4 data-id="heading-24">第4步: 实现组件</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// 1. 定义 Props
interface Props {
  title: string
  // ... 从 Figma 提取的属性
}

// 2. 定义 Emits
const emit = defineEmits&lt;{
  (e: 'click'): void
}&gt;()

// 3. 实现逻辑
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- 4. 实现模板 --&gt;
&lt;/template&gt;

&lt;style lang="scss" scoped&gt;
/* 5. 实现样式 */
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-25">第5步: 验证与优化</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 视觉还原度 &gt; 95%</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 响应式适配</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 交互动画</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 性能优化</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 无障碍支持</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-string">**`multi-lang.mdc`**</span> <span class="hljs-bullet">-</span> <span class="hljs-string">多语言规则</span>

<span class="hljs-string">```markdown</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">多语言国际化</span>
<span class="hljs-attr">trigger:</span> [<span class="hljs-string">"跑多语言"</span>, <span class="hljs-string">"翻译脚本"</span>]
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># 多语言国际化规范</span>

<span class="hljs-comment">## 触发方式</span>

<span class="hljs-string">使用</span> <span class="hljs-string">"跑多语言"</span> <span class="hljs-string">或</span> <span class="hljs-string">"翻译脚本"</span> <span class="hljs-string">触发多语言处理。</span>

<span class="hljs-comment">## 目录结构</span>

</code></pre>
<p>src/
├── locales/
│   ├── zh-CN.json          # 简体中文
│   ├── zh-TW.json          # 繁体中文
│   ├── en-US.json          # 英语
│   └── ja-JP.json          # 日语
└── utils/
└── i18n.ts             # 国际化工具</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment">## 语言文件格式</span>

```json
{
  <span class="hljs-string">"common"</span>: {
    <span class="hljs-string">"confirm"</span>: <span class="hljs-string">"确认"</span>,
    <span class="hljs-string">"cancel"</span>: <span class="hljs-string">"取消"</span>,
    <span class="hljs-string">"save"</span>: <span class="hljs-string">"保存"</span>,
    <span class="hljs-string">"delete"</span>: <span class="hljs-string">"删除"</span>
  },
  <span class="hljs-string">"pages"</span>: {
    <span class="hljs-string">"home"</span>: {
      <span class="hljs-string">"title"</span>: <span class="hljs-string">"首页"</span>,
      <span class="hljs-string">"welcome"</span>: <span class="hljs-string">"欢迎使用 {appName}"</span>
    }
  },
  <span class="hljs-string">"errors"</span>: {
    <span class="hljs-string">"network"</span>: <span class="hljs-string">"网络错误，请稍后重试"</span>,
    <span class="hljs-string">"auth"</span>: <span class="hljs-string">"登录已过期，请重新登录"</span>
  }
}
</code></pre>
<h3 data-id="heading-26">使用方式</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { t } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/i18n'</span>

<span class="hljs-comment">// 基础使用</span>
<span class="hljs-keyword">const</span> title = <span class="hljs-title function_">t</span>(<span class="hljs-string">'pages.home.title'</span>)

<span class="hljs-comment">// 带参数</span>
<span class="hljs-keyword">const</span> welcome = <span class="hljs-title function_">t</span>(<span class="hljs-string">'pages.home.welcome'</span>, { <span class="hljs-attr">appName</span>: <span class="hljs-string">'Haiyi'</span> })

<span class="hljs-comment">// 在模板中</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span>{{ t('common.confirm') }}<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span>
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-27">自动提取脚本</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/extract-i18n.js</span>
<span class="hljs-comment">// 自动提取代码中的中文文本</span>
<span class="hljs-comment">// 生成语言文件</span>
</code></pre>
<h3 data-id="heading-28">翻译工作流</h3>
<ol>
<li>开发时使用中文</li>
<li>运行提取脚本</li>
<li>使用翻译 API 自动翻译</li>
<li>人工校对关键文本</li>
<li>提交语言文件</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment">### 规则文件引用</span>

在主规则文件中引用子规则:

```markdown
<span class="hljs-comment"># Shortcuts</span>

- 使用 <span class="hljs-string">'跑多语言'</span> 或 <span class="hljs-string">'翻译脚本'</span> 对应规则 [multi-lang.mdc](mdc:.cursor/rules/projects/sub-rules/multi-lang.mdc)
- 使用 <span class="hljs-string">'动画效果'</span> 或 <span class="hljs-string">'增加动效'</span> 触发动画规则 [animation-effects.mdc](mdc:.cursor/rules/projects/sub-rules/animation-effects.mdc)
- 使用 <span class="hljs-string">'figma2vue'</span> 触发 Figma 转换流程 [figma-to-vue.mdc](mdc:.cursor/rules/projects/sub-rules/figma-to-vue.mdc)
</code></pre>
<h4 data-id="heading-29">规则最佳实践</h4>
<h5 data-id="heading-30">1. 结构化组织</h5>
<pre><code class="hljs language-bash" lang="bash">.cursor/rules/
├── .cursorrules                    <span class="hljs-comment"># 主规则入口</span>
└── projects/
    ├── sub-rules/                  <span class="hljs-comment"># 子规则</span>
    │   ├── code-rules.mdc         <span class="hljs-comment"># 代码规范</span>
    │   ├── style-guidelines.mdc   <span class="hljs-comment"># 样式规范</span>
    │   ├── api-standards.mdc      <span class="hljs-comment"># API 规范</span>
    │   ├── animation-effects.mdc  <span class="hljs-comment"># 动画规范</span>
    │   ├── figma-to-vue.mdc       <span class="hljs-comment"># Figma 工作流</span>
    │   └── multi-lang.mdc         <span class="hljs-comment"># 多语言规范</span>
    └── templates/                  <span class="hljs-comment"># 模板规则</span>
        ├── component-template.mdc  <span class="hljs-comment"># 组件模板</span>
        ├── page-template.mdc       <span class="hljs-comment"># 页面模板</span>
        └── api-template.mdc        <span class="hljs-comment"># API 模板</span>
</code></pre>
<h5 data-id="heading-31">2. 规则优先级</h5>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 在 .cursorrules 中定义优先级</span>

<span class="hljs-section">## 强制规则 (Must)</span>
<span class="hljs-bullet">-</span> 必须使用 TypeScript
<span class="hljs-bullet">-</span> 必须有错误处理
<span class="hljs-bullet">-</span> 必须有类型定义

<span class="hljs-section">## 推荐规则 (Should)</span>
<span class="hljs-bullet">-</span> 应该添加注释
<span class="hljs-bullet">-</span> 应该使用 Composition API
<span class="hljs-bullet">-</span> 应该遵循命名规范

<span class="hljs-section">## 可选规则 (May)</span>
<span class="hljs-bullet">-</span> 可以使用第三方库
<span class="hljs-bullet">-</span> 可以自定义样式
</code></pre>
<h5 data-id="heading-32">3. 规则版本管理</h5>
<pre><code class="hljs language-markdown" lang="markdown">---
version: 1.0.0
last<span class="hljs-emphasis">_updated: 2026-01-14
changelog:
  - 1.0.0: 初始版本
  - 1.1.0: 添加 TypeScript 严格模式
  - 1.2.0: 添加性能优化规范
---
</span></code></pre>
<h5 data-id="heading-33">4. 团队协作规则</h5>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 团队规范</span>

<span class="hljs-section">## 代码审查清单</span>
<span class="hljs-bullet">-</span> [ ] 符合命名规范
<span class="hljs-bullet">-</span> [ ] 有完整的类型定义
<span class="hljs-bullet">-</span> [ ] 有错误处理
<span class="hljs-bullet">-</span> [ ] 有必要的注释
<span class="hljs-bullet">-</span> [ ] 通过 ESLint 检查
<span class="hljs-bullet">-</span> [ ] 通过单元测试

<span class="hljs-section">## 提交规范</span>
<span class="hljs-bullet">-</span> 提交前运行 <span class="hljs-code">`pnpm lint`</span>
<span class="hljs-bullet">-</span> 提交信息符合规范
<span class="hljs-bullet">-</span> 包含签名信息

<span class="hljs-section">## 分支策略</span>
<span class="hljs-bullet">-</span> main: 生产环境
<span class="hljs-bullet">-</span> develop: 开发环境
<span class="hljs-bullet">-</span> feature/<span class="hljs-emphasis">*: 功能分支
- hotfix/*</span>: 紧急修复
</code></pre>
<hr/>
<h3 data-id="heading-34">MCP (Model Context Protocol) 配置</h3>
<h4 data-id="heading-35">什么是 MCP？</h4>
<p>MCP (Model Context Protocol) 是 Anthropic 推出的开放协议，让 AI 能够安全地连接外部数据源和工具。</p>
<h4 data-id="heading-36">MCP 架构</h4>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────┐
│   Cursor    │
│   (<span class="hljs-built_in">Client</span>)  │
└──────┬──────┘
       │
       │ MCP Protocol
       │
┌──────┴──────┐
│  MCP <span class="hljs-built_in">Server</span> │
└──────┬──────┘
       │
       ├─── Database
       ├─── <span class="hljs-built_in">File</span> System
       ├─── APIs
       └─── Tools
</code></pre>
<h4 data-id="heading-37">MCP 配置文件</h4>
<p><strong>位置</strong>: <code>.cursor/mcp.json</code> 或 <code>~/.cursor/mcp.json</code></p>
<p><strong>基础配置</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"filesystem"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-filesystem"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/Users/username/projects"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"github"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-github"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"GITHUB_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_github_token"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-postgres"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"postgresql://localhost/mydb"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-38">常用 MCP Servers</h4>
<h5 data-id="heading-39">1. Filesystem Server</h5>
<p><strong>功能</strong>: 让 AI 访问本地文件系统</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"filesystem"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-filesystem"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/path/to/allowed/directory"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>使用场景</strong>:</p>
<ul>
<li>读取项目文档</li>
<li>分析日志文件</li>
<li>处理配置文件</li>
</ul>
<h5 data-id="heading-40">2. GitHub Server</h5>
<p><strong>功能</strong>: 让 AI 访问 GitHub 仓库</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"github"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-github"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"GITHUB_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ghp_xxxxxxxxxxxx"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>使用场景</strong>:</p>
<ul>
<li>查看 Issues 和 PRs</li>
<li>分析代码历史</li>
<li>自动创建 PR</li>
</ul>
<h5 data-id="heading-41">3. Database Servers</h5>
<p><strong>PostgreSQL</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-postgres"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"postgresql://user:password@localhost:5432/dbname"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>SQLite</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sqlite"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-sqlite"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/path/to/database.db"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>使用场景</strong>:</p>
<ul>
<li>查询数据库结构</li>
<li>生成 SQL 语句</li>
<li>数据分析</li>
</ul>
<h5 data-id="heading-42">4. Web Search Server</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"brave-search"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-brave-search"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"BRAVE_API_KEY"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_brave_api_key"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>使用场景</strong>:</p>
<ul>
<li>搜索最新技术文档</li>
<li>查找解决方案</li>
<li>获取实时信息</li>
</ul>
<h5 data-id="heading-43">5. Slack Server</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"slack"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-slack"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"SLACK_BOT_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xoxb-your-token"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"SLACK_TEAM_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"T1234567"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>使用场景</strong>:</p>
<ul>
<li>读取团队消息</li>
<li>发送通知</li>
<li>同步工作进度</li>
</ul>
<h5 data-id="heading-44">6. Google Drive Server</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"gdrive"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-gdrive"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"GOOGLE_CLIENT_ID"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_client_id"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"GOOGLE_CLIENT_SECRET"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your_client_secret"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-45">7. Memory Server</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"memory"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-memory"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>功能</strong>: 让 AI 在会话间保持记忆</p>
<h4 data-id="heading-46">自定义 MCP Server</h4>
<h5 data-id="heading-47">创建自定义 Server</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// my-mcp-server.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Server</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@modelcontextprotocol/sdk/server/index.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">StdioServerTransport</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@modelcontextprotocol/sdk/server/stdio.js'</span>

<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Server</span>(
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'my-custom-server'</span>,
    <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>
  },
  {
    <span class="hljs-attr">capabilities</span>: {
      <span class="hljs-attr">tools</span>: {}
    }
  }
)

<span class="hljs-comment">// 定义工具</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-string">'tools/list'</span>, <span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tools</span>: [
      {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'get_project_stats'</span>,
        <span class="hljs-attr">description</span>: <span class="hljs-string">'获取项目统计信息'</span>,
        <span class="hljs-attr">inputSchema</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
          <span class="hljs-attr">properties</span>: {
            <span class="hljs-attr">projectPath</span>: {
              <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
              <span class="hljs-attr">description</span>: <span class="hljs-string">'项目路径'</span>
            }
          }
        }
      }
    ]
  }
})

<span class="hljs-comment">// 实现工具</span>
server.<span class="hljs-title function_">setRequestHandler</span>(<span class="hljs-string">'tools/call'</span>, <span class="hljs-keyword">async</span> (request) =&gt; {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">params</span>.<span class="hljs-property">name</span> === <span class="hljs-string">'get_project_stats'</span>) {
    <span class="hljs-keyword">const</span> stats = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getProjectStats</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">arguments</span>.<span class="hljs-property">projectPath</span>)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">content</span>: [
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
          <span class="hljs-attr">text</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(stats, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>)
        }
      ]
    }
  }
})

<span class="hljs-comment">// 启动服务器</span>
<span class="hljs-keyword">const</span> transport = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioServerTransport</span>()
<span class="hljs-keyword">await</span> server.<span class="hljs-title function_">connect</span>(transport)
</code></pre>
<h5 data-id="heading-48">配置自定义 Server</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"my-server"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"/path/to/my-mcp-server.js"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-49">MCP 安全配置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"secure-filesystem"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-filesystem"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"/allowed/path"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"security"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"allowedOperations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"read"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"deniedPaths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"/allowed/path/.env"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-string">"/allowed/path/secrets"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-50">MCP 最佳实践</h4>
<ol>
<li><strong>最小权限原则</strong>: 只授予必要的权限</li>
<li><strong>环境变量管理</strong>: 使用 <code>.env</code> 文件管理敏感信息</li>
<li><strong>路径限制</strong>: 限制文件系统访问范围</li>
<li><strong>日志记录</strong>: 记录 MCP 操作日志</li>
<li><strong>定期审计</strong>: 定期检查 MCP 配置和使用情况</li>
</ol>
<hr/>
<h3 data-id="heading-51">工作区配置</h3>
<h4 data-id="heading-52"><code>.cursorignore</code> 配置</h4>
<p><strong>作用</strong>: 告诉 Cursor 哪些文件不需要被 AI 索引</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 依赖目录</span>
node_modules/
dist/
build/
.<span class="hljs-built_in">next</span>/

<span class="hljs-comment"># 环境文件</span>
.env
.env.local
.env.*.local

<span class="hljs-comment"># 日志文件</span>
*.log
logs/

<span class="hljs-comment"># 临时文件</span>
*.tmp
*.temp
.cache/

<span class="hljs-comment"># 测试覆盖率</span>
coverage/

<span class="hljs-comment"># 编辑器</span>
.vscode/
.idea/

<span class="hljs-comment"># 系统文件</span>
.DS_Store
Thumbs.db

<span class="hljs-comment"># 大文件</span>
*.<span class="hljs-built_in">zip</span>
*.tar.gz
*.mp4
*.mov

<span class="hljs-comment"># 敏感文件</span>
secrets/
private/
*.key
*.pem

<span class="hljs-comment"># 编译产物</span>
*.<span class="hljs-built_in">min</span>.js
*.<span class="hljs-built_in">min</span>.css
*.<span class="hljs-built_in">map</span>
</code></pre>
<h4 data-id="heading-53">工作区设置</h4>
<p><strong><code>.cursor/settings.json</code></strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-comment">// AI 设置</span>
  <span class="hljs-attr">"cursor.ai.model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.ai.temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.ai.maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4096</span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// 代码补全</span>
  <span class="hljs-attr">"cursor.completion.enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.completion.triggerCharacters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"."</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"("</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"["</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"{"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.completion.debounceDelay"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// Chat 设置</span>
  <span class="hljs-attr">"cursor.chat.contextLines"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.chat.includeOpenFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.chat.includeRecentFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// 索引设置</span>
  <span class="hljs-attr">"cursor.index.enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.index.excludePatterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"**/node_modules/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/dist/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/*.min.js"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// 隐私设置</span>
  <span class="hljs-attr">"cursor.privacy.enableTelemetry"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.privacy.shareCodeContext"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// 编辑器设置</span>
  <span class="hljs-attr">"editor.fontSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.tabSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  
  <span class="hljs-comment">// 文件关联</span>
  <span class="hljs-attr">"files.associations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"*.vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"*.wxml"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"html"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"*.wxss"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"css"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-54">AI 模型配置</h3>
<h4 data-id="heading-55">模型选择</h4>
<p><strong>全局模型配置</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"cursor.ai.defaultModel"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.ai.models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"chat"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"completion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4-turbo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"edit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-3.5-turbo"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-56">可用模型列表</h4>



































<table><thead><tr><th>模型</th><th>适用场景</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td>Claude 3.5 Sonnet</td><td>代码审查、重构</td><td>理解力强、注重细节</td><td>成本较高</td></tr><tr><td>GPT-4 Turbo</td><td>架构设计、算法</td><td>推理能力强</td><td>速度较慢</td></tr><tr><td>GPT-3.5 Turbo</td><td>简单任务、补全</td><td>速度快、成本低</td><td>理解力一般</td></tr><tr><td>Claude 3 Haiku</td><td>重复性任务</td><td>速度快、成本低</td><td>能力有限</td></tr></tbody></table>
<h4 data-id="heading-57">自定义模型参数</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"cursor.ai.customModels"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-gpt4"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openai"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4-turbo-preview"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${OPENAI_API_KEY}"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8192</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-claude"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"anthropic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3-5-sonnet-20241022"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${ANTHROPIC_API_KEY}"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"temperature"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"maxTokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4096</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-58">模型切换策略</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"cursor.ai.modelStrategy"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"simple"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-3.5-turbo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"complex"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"gpt-4-turbo"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"review"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"refactor"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-59">快捷键与命令配置</h3>
<h4 data-id="heading-60">默认快捷键</h4>








































<table><thead><tr><th>快捷键</th><th>功能</th><th>说明</th></tr></thead><tbody><tr><td><code>Cmd/Ctrl + K</code></td><td>快速编辑</td><td>内联编辑，适合小改动</td></tr><tr><td><code>Cmd/Ctrl + L</code></td><td>打开 Chat</td><td>聊天模式，适合复杂问题</td></tr><tr><td><code>Cmd/Ctrl + I</code></td><td>内联补全</td><td>智能代码补全</td></tr><tr><td><code>Cmd/Ctrl + Shift + L</code></td><td>新建 Chat</td><td>开启新对话</td></tr><tr><td><code>Cmd/Ctrl + /</code></td><td>注释切换</td><td>添加/删除注释</td></tr><tr><td><code>Cmd/Ctrl + D</code></td><td>选择下一个</td><td>多光标编辑</td></tr></tbody></table>
<h4 data-id="heading-61">自定义快捷键</h4>
<p><strong><code>keybindings.json</code></strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.chat"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"editorTextFocus"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+r"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.refactor"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"editorHasSelection"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+e"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.explain"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"editorHasSelection"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+t"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.generateTest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"editorTextFocus"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.generateDocs"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"editorTextFocus"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<h4 data-id="heading-62">自定义命令</h4>
<p><strong><code>.cursor/commands.json</code></strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"commands"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"生成组件"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.chat"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"基于当前文件创建一个 Vue 3 组件，使用 TypeScript 和 Composition API"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"keybinding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+c"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"优化性能"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.chat"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"分析当前代码的性能问题并提供优化建议"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"keybinding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+p"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"添加测试"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cursor.ai.chat"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"prompt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"为当前函数生成单元测试，使用 Vitest"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"keybinding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cmd+shift+t"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-63">实用配置案例</h3>
<h4 data-id="heading-64">案例 1: Vue 3 + TypeScript 项目配置</h4>
<p><strong><code>.cursorrules</code></strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># Vue 3 + TypeScript 项目</span>

<span class="hljs-section">## 技术栈</span>
<span class="hljs-bullet">-</span> Vue 3.4+
<span class="hljs-bullet">-</span> TypeScript 5.3+
<span class="hljs-bullet">-</span> Vite 5.0+
<span class="hljs-bullet">-</span> Pinia 2.1+
<span class="hljs-bullet">-</span> Vue Router 4.2+

<span class="hljs-section">## 代码规范</span>
<span class="hljs-bullet">-</span> 使用 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span></span>
<span class="hljs-bullet">-</span> 使用 Composition API
<span class="hljs-bullet">-</span> 所有组件必须有类型定义
<span class="hljs-bullet">-</span> Props 使用 defineProps<span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Props</span>&gt;</span></span></span>()
<span class="hljs-bullet">-</span> Emits 使用 defineEmits<span class="xml"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Emits</span>&gt;</span></span></span>()

<span class="hljs-section">## 文件组织</span>
src/
├── components/     # 组件
├── views/         # 页面
├── composables/   # 组合式函数
├── stores/        # Pinia stores
├── types/         # 类型定义
└── utils/         # 工具函数

<span class="hljs-section">## 命名规范</span>
<span class="hljs-bullet">-</span> 组件: PascalCase
<span class="hljs-bullet">-</span> 文件: kebab-case
<span class="hljs-bullet">-</span> 变量: camelCase
<span class="hljs-bullet">-</span> 常量: UPPER<span class="hljs-emphasis">_SNAKE_</span>CASE
</code></pre>
<p><strong><code>.cursor/settings.json</code></strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"cursor.ai.model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"claude-3.5-sonnet"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files.associations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"*.vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[vue]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vue.volar"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"[typescript]"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esbenp.prettier-vscode"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-65">案例 2: uni-app 小程序项目配置</h4>
<p><strong><code>.cursorrules</code></strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># uni-app 小程序项目</span>

<span class="hljs-section">## 技术栈</span>
<span class="hljs-bullet">-</span> uni-app (Vue 3)
<span class="hljs-bullet">-</span> TypeScript
<span class="hljs-bullet">-</span> Pinia
<span class="hljs-bullet">-</span> uni-ui

<span class="hljs-section">## 平台</span>
<span class="hljs-bullet">-</span> 微信小程序
<span class="hljs-bullet">-</span> 支付宝小程序
<span class="hljs-bullet">-</span> 字节跳动小程序

<span class="hljs-section">## 开发规范</span>
<span class="hljs-bullet">-</span> 使用 uni. API 而非原生 API
<span class="hljs-bullet">-</span> 使用 rpx 单位
<span class="hljs-bullet">-</span> 使用条件编译处理平台差异
<span class="hljs-bullet">-</span> 页面文件放在 pages/ 目录

<span class="hljs-section">## 性能要求</span>
<span class="hljs-bullet">-</span> 主包 &lt; 2MB
<span class="hljs-bullet">-</span> 单个分包 &lt; 2MB
<span class="hljs-bullet">-</span> 图片使用 CDN
<span class="hljs-bullet">-</span> 列表使用虚拟滚动

<span class="hljs-section">## 条件编译</span>
// #ifdef MP-WEIXIN
// 微信小程序代码
// #endif

// #ifdef H5
// H5 代码
// #endif
</code></pre>
<p><strong><code>.cursorignore</code></strong>:</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/
dist/
unpackage/
.hbuilderx/
*.<span class="hljs-built_in">log</span>
</code></pre>
<h4 data-id="heading-66">案例 3: 全栈项目配置</h4>
<p><strong>项目结构</strong>:</p>
<pre><code class="hljs language-arduino" lang="arduino">project/
├── frontend/
│   └── .cursor/
│       ├── rules/
│       │   └── .cursorrules
│       └── settings.json
├── backend/
│   └── .cursor/
│       ├── rules/
│       │   └── .cursorrules
│       └── settings.json
└── .cursor/
    ├── mcp.json
    └── settings.json
</code></pre>
<p><strong>根目录 <code>.cursorrules</code></strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 全栈项目</span>

<span class="hljs-section">## 项目结构</span>
<span class="hljs-bullet">-</span> frontend/: Vue 3 前端
<span class="hljs-bullet">-</span> backend/: Node.js 后端
<span class="hljs-bullet">-</span> shared/: 共享类型和工具

<span class="hljs-section">## 开发规范</span>
<span class="hljs-bullet">-</span> 使用 Monorepo 管理
<span class="hljs-bullet">-</span> 共享类型定义
<span class="hljs-bullet">-</span> 统一代码规范
<span class="hljs-bullet">-</span> 统一 Git 规范

<span class="hljs-section">## API 规范</span>
<span class="hljs-bullet">-</span> RESTful API
<span class="hljs-bullet">-</span> 统一响应格式
<span class="hljs-bullet">-</span> 统一错误处理
<span class="hljs-bullet">-</span> API 文档自动生成
</code></pre>
<p><strong>MCP 配置</strong>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"postgres"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"@modelcontextprotocol/server-postgres"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"postgresql://localhost/mydb"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"github"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"@modelcontextprotocol/server-github"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"GITHUB_TOKEN"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${GITHUB_TOKEN}"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-67">第三方资源获取</h3>
<h4 data-id="heading-68">官方资源</h4>
<h5 data-id="heading-69">Cursor 官方</h5>
<ul>
<li><strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.sh" target="_blank" title="https://cursor.sh" ref="nofollow noopener noreferrer">cursor.sh</a></li>
<li><strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cursor.sh" target="_blank" title="https://docs.cursor.sh" ref="nofollow noopener noreferrer">docs.cursor.sh</a></li>
<li><strong>Discord</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2Fcursor" target="_blank" title="https://discord.gg/cursor" ref="nofollow noopener noreferrer">discord.gg/cursor</a></li>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgetcursor" target="_blank" title="https://github.com/getcursor" ref="nofollow noopener noreferrer">github.com/getcursor</a></li>
</ul>
<h5 data-id="heading-70">MCP 官方</h5>
<ul>
<li><strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io" target="_blank" title="https://modelcontextprotocol.io" ref="nofollow noopener noreferrer">modelcontextprotocol.io</a></li>
<li><strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs" target="_blank" title="https://modelcontextprotocol.io/docs" ref="nofollow noopener noreferrer">modelcontextprotocol.io/docs</a></li>
<li><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol" target="_blank" title="https://github.com/modelcontextprotocol" ref="nofollow noopener noreferrer">github.com/modelcontex…</a></li>
<li><strong>Servers</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fservers" target="_blank" title="https://github.com/modelcontextprotocol/servers" ref="nofollow noopener noreferrer">github.com/modelcontex…</a></li>
</ul>
<h4 data-id="heading-71">社区资源</h4>
<h5 data-id="heading-72">Cursor Rules 仓库</h5>
<ol>
<li>
<p><strong>Awesome Cursor Rules</strong></p>
<ul>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPatrickJS%2Fawesome-cursorrules" target="_blank" title="https://github.com/PatrickJS/awesome-cursorrules" ref="nofollow noopener noreferrer">github.com/PatrickJS/a…</a></li>
<li>内容: 各种项目的 Cursor Rules 集合</li>
</ul>
</li>
<li>
<p><strong>Cursor Rules Templates</strong></p>
<ul>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcursor-rules%2Ftemplates" target="_blank" title="https://github.com/cursor-rules/templates" ref="nofollow noopener noreferrer">github.com/cursor-rule…</a></li>
<li>内容: 常用框架的规则模板</li>
</ul>
</li>
<li>
<p><strong>Cursor Directory</strong></p>
<ul>
<li>网站: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.directory" target="_blank" title="https://cursor.directory" ref="nofollow noopener noreferrer">cursor.directory</a></li>
<li>内容: 可搜索的 Cursor Rules 目录</li>
</ul>
</li>
</ol>
<h5 data-id="heading-73">MCP Servers 集合</h5>
<ol>
<li>
<p><strong>Official MCP Servers</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Filesystem</span>
@modelcontextprotocol/server-filesystem

<span class="hljs-comment"># GitHub</span>
@modelcontextprotocol/server-github

<span class="hljs-comment"># PostgreSQL</span>
@modelcontextprotocol/server-postgres

<span class="hljs-comment"># SQLite</span>
@modelcontextprotocol/server-sqlite

<span class="hljs-comment"># Brave Search</span>
@modelcontextprotocol/server-brave-search

<span class="hljs-comment"># Slack</span>
@modelcontextprotocol/server-slack

<span class="hljs-comment"># Google Drive</span>
@modelcontextprotocol/server-gdrive
</code></pre>
</li>
<li>
<p><strong>Community MCP Servers</strong></p>
<ul>
<li>Awesome MCP Servers: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpunkpeye%2Fawesome-mcp-servers" target="_blank" title="https://github.com/punkpeye/awesome-mcp-servers" ref="nofollow noopener noreferrer">github.com/punkpeye/aw…</a></li>
<li>MCP Hub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmcp-hub.com" target="_blank" title="https://mcp-hub.com" ref="nofollow noopener noreferrer">mcp-hub.com</a></li>
</ul>
</li>
</ol>
<h5 data-id="heading-74">配置分享平台</h5>
<ol>
<li>
<p><strong>Cursor Settings</strong></p>
<ul>
<li>网站: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.settings" target="_blank" title="https://cursor.settings" ref="nofollow noopener noreferrer">cursor.settings</a></li>
<li>内容: 用户分享的配置文件</li>
</ul>
</li>
<li>
<p><strong>Gist Collections</strong></p>
<ul>
<li>搜索: "cursor rules" 或 "cursorrules"</li>
<li>平台: GitHub Gist</li>
</ul>
</li>
</ol>
<h4 data-id="heading-75">推荐规则集</h4>
<h5 data-id="heading-76">1. Vue 3 + TypeScript</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载</span>
curl -o .cursorrules https://raw.githubusercontent.com/cursor-rules/templates/main/vue3-typescript.cursorrules
</code></pre>
<h5 data-id="heading-77">2. React + TypeScript</h5>
<pre><code class="hljs language-bash" lang="bash">curl -o .cursorrules https://raw.githubusercontent.com/cursor-rules/templates/main/react-typescript.cursorrules
</code></pre>
<h5 data-id="heading-78">3. Node.js + Express</h5>
<pre><code class="hljs language-bash" lang="bash">curl -o .cursorrules https://raw.githubusercontent.com/cursor-rules/templates/main/nodejs-express.cursorrules
</code></pre>
<h5 data-id="heading-79">4. Python + FastAPI</h5>
<pre><code class="hljs language-bash" lang="bash">curl -o .cursorrules https://raw.githubusercontent.com/cursor-rules/templates/main/python-fastapi.cursorrules
</code></pre>
<h4 data-id="heading-80">工具和插件</h4>
<h5 data-id="heading-81">1. Cursor Rules Generator</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -g cursor-rules-generator

<span class="hljs-comment"># 使用</span>
cursor-rules-generator --framework vue3 --language typescript
</code></pre>
<h5 data-id="heading-82">2. MCP Server CLI</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -g @modelcontextprotocol/cli

<span class="hljs-comment"># 列出可用 servers</span>
mcp list

<span class="hljs-comment"># 安装 server</span>
mcp install filesystem

<span class="hljs-comment"># 配置 server</span>
mcp config
</code></pre>
<h5 data-id="heading-83">3. Cursor Config Manager</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -g cursor-config-manager

<span class="hljs-comment"># 导出配置</span>
cursor-config <span class="hljs-built_in">export</span>

<span class="hljs-comment"># 导入配置</span>
cursor-config import config.json

<span class="hljs-comment"># 分享配置</span>
cursor-config share
</code></pre>
<hr/>
<h3 data-id="heading-84">最佳实践</h3>
<h4 data-id="heading-85">1. 规则文件管理</h4>
<h5 data-id="heading-86">版本控制</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 提交规则文件</span>
git add .cursor/
git add .cursorrules
git commit -m <span class="hljs-string">"docs: 更新 Cursor 规则"</span>

<span class="hljs-comment"># 忽略敏感配置</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">".cursor/mcp.json"</span> &gt;&gt; .gitignore
<span class="hljs-built_in">echo</span> <span class="hljs-string">".cursor/settings.json"</span> &gt;&gt; .gitignore
</code></pre>
<h5 data-id="heading-87">团队协作</h5>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 在 README.md 中说明</span>

<span class="hljs-section">## Cursor 配置</span>

本项目使用 Cursor 进行开发，请按以下步骤配置:

<span class="hljs-bullet">1.</span> 安装 Cursor: https://cursor.sh
<span class="hljs-bullet">2.</span> 打开项目，Cursor 会自动读取 <span class="hljs-code">`.cursorrules`</span>
<span class="hljs-bullet">3.</span> 配置 MCP (可选):
   <span class="hljs-code">```bash
   cp .cursor/mcp.example.json .cursor/mcp.json
   # 编辑 mcp.json，填入你的 API keys
</span></code></pre>
<ol start="4">
<li>安装推荐扩展 (见 <code>.vscode/extensions.json</code>)</li>
</ol>
<h3 data-id="heading-88">快捷指令</h3>
<ul>
<li><code>figma2vue</code>: 从 Figma 生成页面</li>
<li><code>跑多语言</code>: 运行多语言脚本</li>
<li><code>动画效果</code>: 添加动画效果</li>
</ul>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">
#</span><span class="bash"><span class="hljs-comment">## 2. 配置分层</span></span>

</code></pre>
<p>全局配置 (~/.cursor/)
├── 个人偏好
├── 通用规则
└── API Keys</p>
<p>项目配置 (project/.cursor/)
├── 项目规则
├── 团队规范
└── 工作流配置</p>
<p>文件配置 (inline comments)
└── 特殊说明</p>
<pre><code class="hljs language-makefile" lang="makefile">
<span class="hljs-comment">### 3. 安全实践</span>

<span class="hljs-comment">#### 环境变量管理</span>

```bash
<span class="hljs-comment"># .env</span>
GITHUB_TOKEN=ghp_xxxxxxxxxxxx
ANTHROPIC_API_KEY=sk-xxxxxxxxxxxx
OPENAI_API_KEY=sk-xxxxxxxxxxxx

<span class="hljs-comment"># .cursor/mcp.json</span>
{
  <span class="hljs-string">"mcpServers"</span>: {
    <span class="hljs-string">"github"</span>: {
      <span class="hljs-string">"env"</span>: {
        <span class="hljs-string">"GITHUB_TOKEN"</span>: <span class="hljs-string">"${GITHUB_TOKEN}"</span>
      }
    }
  }
}
</code></pre>
<h5 data-id="heading-89">敏感信息保护</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># .gitignore</span>
.<span class="hljs-built_in">env</span>
.env.local
.cursor/mcp.json
.cursor/settings.json
*.key
*.pem
secrets/
</code></pre>
<h4 data-id="heading-90">4. 性能优化</h4>
<h5 data-id="heading-91">索引优化</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"cursor.index.excludePatterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"**/node_modules/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/dist/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/build/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/.next/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/*.min.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/*.min.css"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/*.map"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.index.maxFileSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1048576</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"cursor.index.maxFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-92">缓存管理</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理 Cursor 缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.cursor/cache

<span class="hljs-comment"># 重建索引</span>
Cmd/Ctrl + Shift + P → <span class="hljs-string">"Cursor: Rebuild Index"</span>
</code></pre>
<h4 data-id="heading-93">5. 调试技巧</h4>
<h5 data-id="heading-94">查看 AI 上下文</h5>
<pre><code class="hljs language-css" lang="css">Cmd/Ctrl + Shift + <span class="hljs-selector-tag">P</span> → "<span class="hljs-attribute">Cursor</span>: Show AI Context<span class="hljs-string">"
</span></code></pre>
<h5 data-id="heading-95">查看规则加载状态</h5>
<pre><code class="hljs language-css" lang="css">Cmd/Ctrl + Shift + <span class="hljs-selector-tag">P</span> → "<span class="hljs-attribute">Cursor</span>: Show Loaded Rules<span class="hljs-string">"
</span></code></pre>
<h5 data-id="heading-96">查看 MCP 连接状态</h5>
<pre><code class="hljs language-css" lang="css">Cmd/Ctrl + Shift + <span class="hljs-selector-tag">P</span> → "<span class="hljs-attribute">Cursor</span>: Show MCP Status<span class="hljs-string">"
</span></code></pre>
<hr/>
<h3 data-id="heading-97">常见问题</h3>
<h4 data-id="heading-98">Q1: Cursor 不读取我的 <code>.cursorrules</code> 文件？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>检查文件位置（项目根目录或 <code>.cursor/</code> 目录）</li>
<li>检查文件名（<code>.cursorrules</code> 不是 <code>cursorrules</code>）</li>
<li>重启 Cursor</li>
<li>重建索引: <code>Cmd/Ctrl + Shift + P</code> → "Cursor: Rebuild Index"</li>
</ol>
<h4 data-id="heading-99">Q2: MCP Server 连接失败？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>检查 <code>mcp.json</code> 语法</li>
<li>确认 server 已安装: <code>npx @modelcontextprotocol/server-xxx --version</code></li>
<li>检查环境变量</li>
<li>查看 Cursor 日志: <code>Help</code> → <code>Toggle Developer Tools</code> → <code>Console</code></li>
</ol>
<h4 data-id="heading-100">Q3: AI 生成的代码不符合规范？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>检查规则文件是否清晰明确</li>
<li>在提示词中明确引用规则</li>
<li>使用更具体的约束条件</li>
<li>分步骤实现，每步验证</li>
</ol>
<h4 data-id="heading-101">Q4: 如何在团队中共享配置？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>将 <code>.cursorrules</code> 提交到 Git</li>
<li>创建 <code>mcp.example.json</code> 作为模板</li>
<li>在 README 中说明配置步骤</li>
<li>使用环境变量管理敏感信息</li>
</ol>
<h4 data-id="heading-102">Q5: Cursor 占用内存太大？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>优化 <code>.cursorignore</code>，排除大文件</li>
<li>减少索引文件数量</li>
<li>关闭不需要的 MCP servers</li>
<li>定期清理缓存</li>
</ol>
<h4 data-id="heading-103">Q6: 如何切换不同的 AI 模型？</h4>
<p><strong>解决方案</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">方法</span> <span class="hljs-attr">1:</span> <span class="hljs-string">在</span> <span class="hljs-string">Chat</span> <span class="hljs-string">中点击模型选择器</span>
<span class="hljs-string">方法</span> <span class="hljs-attr">2:</span> <span class="hljs-string">设置默认模型</span> <span class="hljs-string">(settings.json)</span>
<span class="hljs-string">方法</span> <span class="hljs-attr">3:</span> <span class="hljs-string">使用快捷键切换</span> <span class="hljs-string">(自定义)</span>
</code></pre>
<h4 data-id="heading-104">Q7: 规则文件太长，AI 理解不准确？</h4>
<p><strong>解决方案</strong>:</p>
<ol>
<li>拆分成多个 <code>.mdc</code> 文件</li>
<li>使用优先级标记（Must/Should/May）</li>
<li>精简规则，只保留关键约束</li>
<li>使用示例代码而非长篇描述</li>
</ol>
<h4 data-id="heading-105">Q8: 如何调试自定义 MCP Server？</h4>
<p><strong>解决方案</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接运行 server 查看输出</span>
node my-mcp-server.js

<span class="hljs-comment"># 使用 MCP Inspector</span>
npx @modelcontextprotocol/inspector node my-mcp-server.js

<span class="hljs-comment"># 查看 Cursor 日志</span>
Help → Toggle Developer Tools → Console
</code></pre>
<hr/>
<h3 data-id="heading-106">总结</h3>
<h4 data-id="heading-107">配置优先级</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 明确的提示词 &gt; 规则文件
<span class="hljs-bullet">2.</span> 项目规则 &gt; 全局规则
<span class="hljs-bullet">3.</span> 具体规则 &gt; 通用规则
<span class="hljs-bullet">4.</span> 约束条件 &gt; 建议性规则
</code></pre>
<h4 data-id="heading-108">配置原则</h4>
<ol>
<li><strong>简洁明确</strong>: 规则要清晰，避免歧义</li>
<li><strong>分层管理</strong>: 全局、项目、文件分层配置</li>
<li><strong>安全第一</strong>: 保护敏感信息，最小权限原则</li>
<li><strong>团队协作</strong>: 规则共享，统一规范</li>
<li><strong>持续优化</strong>: 根据使用情况不断调整</li>
</ol>
<h4 data-id="heading-109">快速开始清单</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 创建 <code>.cursorrules</code> 文件</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 配置 <code>.cursorignore</code> 排除无关文件</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 设置项目规范和约束</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 配置 MCP (可选)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 自定义快捷键 (可选)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 团队共享配置</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 编写使用文档</li>
</ul>
<h4 data-id="heading-110">进阶技巧</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 创建模块化规则文件</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 配置自定义 MCP Server</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 设置模型切换策略</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 建立配置模板库</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 自动化配置管理</li>
</ul>
<hr/>
<p><strong>Happy Coding with Cursor! 🚀</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年，站在职业生涯十字路口的我该何去何从？]]></title>    <link>https://juejin.cn/post/7595040803580805135</link>    <guid>https://juejin.cn/post/7595040803580805135</guid>    <pubDate>2026-01-14T10:49:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595040803580805135" data-draft-id="7594851429162565666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年，站在职业生涯十字路口的我该何去何从？"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-14T10:49:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hooray"/> <meta itemprop="url" content="https://juejin.cn/user/1626932938018925"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年，站在职业生涯十字路口的我该何去何从？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932938018925/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hooray
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T10:49:19.000Z" title="Wed Jan 14 2026 10:49:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>2025年的第四季度，连续经历了裁员、副业收入下滑，以及AI引起的职业倦怠，让我这个35岁老程序员，站在(可能是)职业生涯的十字路口，必须要思考2026年，或者是人生下半场该做什么。</p>
<p>提前说明，发布这篇文章的时候，我依旧没有规划好接下来要走路，写这篇文章更多是记录当下的感想和感受，也希望大家能给我提供一些建议。</p>
<p>那么，就从裁员聊起吧。</p>
<h2 data-id="heading-0">裁员</h2>
<p>入职这家公司是因为上家公司降薪40%，虽然薪资比降薪前少了一点，但看好公司发展前景（短剧行业），加上那会公司正在扩张，所以决定加入。</p>
<p>我甚至已经做好了这是我最后一份工作的打算，我原本的计划是40岁还完房贷，攒100W现金。如果公司稳定，加上副业收入和存款，差不多5-6年，差不多在40岁的时候，就能达到目标了。</p>
<p>可没想到短短一年时间，公司就从扩张快进到裁员。</p>
<p>裁员很迅速，10月底最后一天下午被约谈，协商赔偿，最后给了 <code>N+0.5</code> ，下班前就给了离职证明。</p>
<p>为什么没有争取 <code>N+1</code> 是因为想赶紧重新找一份工作，那会满脑子都是40岁的目标，以及每个月睁眼就是1w+的房贷和吃住开销。所以不想在这件事上浪费太多时间，并且了解到大部分被裁的同事差不多都是这个赔偿。</p>
<p>失业后我立马开始投简历，在BOSS上高强度地打了一两周的招呼，结果是不到10%的回复，0个面试邀约。</p>
<p>我摆烂了，我开始没日没夜地打游戏、看剧、嗜睡，直到现在。</p>
<p>朋友问我为什么不出去旅游，趁难得有时间。我也确实有很多年没有旅游了，上次旅游还是疫情前。</p>
<p>但我找不到年轻时一个人去探索世界的冲动了，曾经我能一个人去跳伞、去音乐节、去西湖边坐一下午，但现在出门的动力都几乎没有。</p>
<h2 data-id="heading-1">副业</h2>
<p>很多人应该都是通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-admin.hurui.me%2F" target="_blank" title="https://fantastic-admin.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-admin</a> 知道的我，这也是我的副业主要收入来源。</p>
<p>过去一年我靠 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-admin.hurui.me%2F" target="_blank" title="https://fantastic-admin.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-admin</a> / <a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-mobile.hurui.me%2F" target="_blank" title="https://fantastic-mobile.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-mobile</a> / <a href="https://link.juejin.cn?target=https%3A%2F%2Fone-step-admin.hurui.me%2F" target="_blank" title="https://one-step-admin.hurui.me/" ref="nofollow noopener noreferrer">One-step-admin</a> 这三款产品，大概赚了10万。同时偶尔也接一些私活，全年副业收入应该在12万左右。</p>
<p>作为副业，看起来算是一个不算差的成绩，但如果把产品每个月的销售统计拉出来看，就能看出第四季度的销售是下滑的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/323cb3304bf14260a59aff0d9d04b60f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSG9vcmF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768992558&amp;x-signature=5pq9%2B6zCgJVkEgj6gIOa3iiyWls%3D" alt="pintu-fulicat.com-1768376993420.png" loading="lazy"/></p>
<p>我不知道如何去分析其中的原因，或许是竞品变多，这一年我确实看到几个新冒头且还不错的开源项目；又或许是AI发展迅猛，减少了使用这类产品的需求；也有可能是因为产品曝光量降低，因为 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-admin.hurui.me%2F" target="_blank" title="https://fantastic-admin.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-admin</a> 给 Element-plus 的赞助刚好在10月份截止。</p>
<p>不过说到赞助，还是挺自豪今年依旧在履行自己的准则。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb366df1638045fa9ff37b5d368ebb6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSG9vcmF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768992558&amp;x-signature=xS3eFxkPhUTRH8yoiQWXQIYMwJ4%3D" alt="9YyEiretahdsJqGmrZJILu.png" loading="lazy"/></p>
<p>不过副业赚多赚少很难让别人感同身受，毕竟过去这一年，我看到身边有人副业炒股赚得比主业还多，也有人忙碌一年还不及我的副业。</p>
<p>所以冷暖自知，就不多聊了，我更多想聊的是关于职业倦怠这个话题。</p>
<h2 data-id="heading-2">职业倦怠</h2>
<p>我是一个很热衷于写代码的人，不管是工作中通过代码去解决技术难点，还是工作之余通过代码去实现脑海中一个又一个的小产品。</p>
<p>但近一年的工作内容，我至少有一半的时间是和 AI 在对话，而不是和代码打交道。首先说明我并不排斥 AI ，并且我最享受的就是手写代码 + AI智能预测，这样我既能完全掌控代码，AI 又能将我脑海中的逻辑快速实现。</p>
<p>但生成式的 AI 工具几乎完全解放了编码，其中有一部分原因是公司要求全栈。这一点我还是挺佩服公司这位主管的远见，在2024年面试的时候他就强调了未来的发展方向就是全栈，并且入职时也明确工作内容需要接触 NestJS 。不过由于我没有 NestJS 的开发经验，所以后端大部分的工作，都是靠 AI 自动生成代码完成的，并且 AI 也更适合处理后端这种纯逻辑的工作。</p>
<p>生成式 AI 带来了效率的提升，同时也消磨了我写代码的热情，我曾经在朋友圈也吐槽过：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0f4dcf48b0e49eaa0868de45c7c2b14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSG9vcmF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768992558&amp;x-signature=VrMa5qSNnvUOcaLeE06Dfq6XD4o%3D" alt="Screenshot_20260114_161741.jpg" loading="lazy"/></p>
<p>虽然都在说 AI 杀死了前端，但我觉得 AI 目前并不能完全取代前端开发人员，而是大部分公司对前端的要求并没有那么高，AI 生成的界面只要能用，对美观没有太高的要求。</p>
<p>但随着 AI 的发展，包括近几个月火爆的 <code>skill</code> ，我能预感到生成式 AI 最终会解放大部分编码工作，并且这个时间点的到来会很快。</p>
<p>比如最近很热门的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnextlevelbuilder%2Fui-ux-pro-max-skill" target="_blank" title="https://github.com/nextlevelbuilder/ui-ux-pro-max-skill" ref="nofollow noopener noreferrer">UI UX Pro Max</a> ，已经能察觉出 <code>skill</code> 开始解决 AI 产出结果的准确性和一致性问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a742f0b38144b48b0ae592ec6c56e04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSG9vcmF5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768992558&amp;x-signature=Ce9G0DL5Qm%2Bw0V2Zt4RswU5uiwM%3D" alt="gOqyXxqYirt30RS2uAB7Kj.png" loading="lazy"/></p>
<p>如果当一段需求描述输入给 AI 并运行 100 次，输出结果都能保持一致，开发人员还真的需要再关注代码么？</p>
<p>我甚至预测未来 github 上的开源项目仓库里，开源的将不会是代码，而是 prompt / rule / skill 这类 markdown 文件，所有代码的会在运行时或构建时生成。</p>
<p>比如小程序这种“用完即走”的设计理念，未来的形态很有可能是在用户打开小程序时，才进行代码的生成和运行。</p>
<p>当这一天到来的时候，门槛降低肯定会引起行业收入下滑，同时编码乐趣的消失，也让我对程序员这个职业产生了倦怠。</p>
<h2 data-id="heading-3">2026</h2>
<p>思考未来或许并不是我当下最需要考虑的事，2026年我大概率是会优先继续找工作，只不过这对我来说确实挺难的，身处35岁这个节点，如果找不到工作，我也没想到还能做什么事情能成为我长久的事业。</p>
<p>其次就是继续维护我的副业，这几个产品目前都在等 Vite 8.0 和 Vue 3.6 的正式发布，等发布后我也将推出全新的版本，感兴趣的现在就可以点 Star 关注下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-admin.hurui.me%2F" target="_blank" title="https://fantastic-admin.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-admin</a> / <a href="https://link.juejin.cn?target=https%3A%2F%2Ffantastic-mobile.hurui.me%2F" target="_blank" title="https://fantastic-mobile.hurui.me/" ref="nofollow noopener noreferrer">Fantastic-mobile</a> / <a href="https://link.juejin.cn?target=https%3A%2F%2Fone-step-admin.hurui.me%2F" target="_blank" title="https://one-step-admin.hurui.me/" ref="nofollow noopener noreferrer">One-step-admin</a></p>
<p>然后就是 AI 的发展不会眷顾每一个守旧者，我必须尝试在新的工作模式中寻找到自己的价值。</p>
<p>最后感谢你的时间，这篇文章的阅读体验可能比较糟糕，我基本是想到哪写到哪，基本没有什么条理，关于行业未来的思考也都是纯主观的猜测，欢迎你留言讨论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[设计一个支持万人同时抢购商品的秒杀系统?]]></title>    <link>https://juejin.cn/post/7594642978695266367</link>    <guid>https://juejin.cn/post/7594642978695266367</guid>    <pubDate>2026-01-13T08:03:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594642978695266367" data-draft-id="7594642978695249983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计一个支持万人同时抢购商品的秒杀系统?"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-13T08:03:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计一个支持万人同时抢购商品的秒杀系统?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-13T08:03:47.000Z" title="Tue Jan 13 2026 08:03:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-13
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、系统架构设计</h2>
<h3 data-id="heading-1">1. 分层架构</h3>
<pre><code class="hljs language-markdown" lang="markdown">客户端层 → 接入层 → 业务服务层 →  数据层
<span class="hljs-code">     ↓       ↓         ↓          ↓
    限流    缓存       队列      数据库
</span></code></pre>
<h3 data-id="heading-2">2. 具体组件</h3>
<ul>
<li><strong>客户端</strong>：静态资源CDN、倒计时校准、防重复提交</li>
<li><strong>接入层</strong>：Nginx+Lua/OpenResty，做第一层限流和缓存</li>
<li><strong>业务层</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>秒杀服务集群（无状态）</li>
<li>消息队列（Kafka/RocketMQ）</li>
<li>缓存集群（Redis Cluster）</li>
</ul>
</li>
</ul>

<ul>
<li><strong>数据层</strong>：</li>
</ul>

<ul>
<li>
<ul>
<li>主从数据库（读写分离）</li>
<li>分库分表（按商品/时间）</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">二、核心问题解决方案</h2>
<h3 data-id="heading-4">1. 超卖问题</h3>
<h4 data-id="heading-5">解决方案一：Redis原子操作</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用Redis的DECR原子操作扣减库存</span>
def deduct_stock(product_id, user_id):
    <span class="hljs-attr">stock_key</span> = f<span class="hljs-string">"stock:{product_id}"</span>

<span class="hljs-comment"># Lua脚本保证原子性</span>
<span class="hljs-attr">lua_script</span> = <span class="hljs-string">"""
local stock = tonumber(redis.call('GET', KEYS[1]))
if stock and stock &gt; 0 then
redis.call('DECR', KEYS[1])
return 1
end
return 0
"""</span>

<span class="hljs-attr">result</span> = redis.eval(lua_script, <span class="hljs-number">1</span>, stock_key)
return <span class="hljs-attr">result</span> == <span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-6">解决方案二：数据库乐观锁</h4>
<pre><code class="hljs language-ini" lang="ini">UPDATE products 
SET <span class="hljs-attr">stock</span> = stock - <span class="hljs-number">1</span>, version = version + <span class="hljs-number">1</span> 
WHERE <span class="hljs-attr">id</span> = ? AND stock &gt; <span class="hljs-number">0</span> AND version = ?
</code></pre>
<h4 data-id="heading-7">解决方案三：预扣库存</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 先预扣Redis库存，再异步同步到DB</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">preDeductStock</span><span class="hljs-params">(<span class="hljs-type">String</span> productId, <span class="hljs-type">int</span> count)</span> </span>{
    <span class="hljs-type">String</span> key = <span class="hljs-string">"seckill:stock:"</span> + productId;
    Long remaining = redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">decrement</span>(key, count);

    <span class="hljs-keyword">if</span> (remaining &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 发送MQ消息异步扣减数据库</span>
        <span class="hljs-built_in">sendStockDeductMessage</span>(productId, count);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 库存不足，回滚</span>
        redisTemplate.<span class="hljs-built_in">opsForValue</span>().<span class="hljs-built_in">increment</span>(key, count);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h3 data-id="heading-8">2. 高并发请求处理</h3>
<h4 data-id="heading-9">2.1 流量削峰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用消息队列缓冲请求</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RocketMQTemplate mqTemplate;

    <span class="hljs-keyword">public</span> SeckillResult seckill(SeckillRequest request) {
        <span class="hljs-comment">// 1. 校验用户和商品状态</span>
        <span class="hljs-keyword">if</span> (!validate(request)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"校验失败"</span>);
        }

        <span class="hljs-comment">// 2. 生成唯一请求ID</span>
        String requestId = generateRequestId(request);

        <span class="hljs-comment">// 3. 请求入队，立即返回</span>
        mqTemplate.sendOneWay(<span class="hljs-string">"seckill-topic"</span>, 
                              MessageBuilder.withPayload(request).build());

        <span class="hljs-comment">// 4. 返回排队中状态，前端轮询结果</span>
        <span class="hljs-keyword">return</span> SeckillResult.processing(requestId);
    }
}
</code></pre>
<h4 data-id="heading-10">2.2 分层过滤</h4>
<pre><code class="hljs">所有请求 → 合法性校验 → 库存校验 → 频率控制 → 实际下单
   ↓           ↓          ↓         ↓         ↓
 100万        50万       10万       5万       1万
</code></pre>
<h3 data-id="heading-11">3. 系统性能优化</h3>
<h4 data-id="heading-12">3.1 缓存策略</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 多级缓存配置</span>
<span class="hljs-section">缓存层级:</span>
  一级: JVM本地缓存 (Caffeine) - 热点商品
  二级: Redis集群 - 库存信息
  三级: 数据库 - 最终一致性
</code></pre>
<h4 data-id="heading-13">3.2 读多写少优化</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 商品信息缓存预热</span>
<span class="hljs-keyword">@Service</span>
public class CacheWarmUpService {

    <span class="hljs-keyword">@PostConstruct</span>
    public void warmUpSeckillProducts() {
        List&lt;Product&gt; hotProducts = <span class="hljs-built_in">loadHotProducts</span>();

        for (Product product : hotProducts) {
            <span class="hljs-comment">// 库存信息</span>
            redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                "stock:" + product.getId(),
                product<span class="hljs-selector-class">.getStock</span>()
            );

            <span class="hljs-comment">// 商品详情</span>
            redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                "product:" + product.getId(),
                JSON<span class="hljs-selector-class">.toJSONString</span>(product)
            );

            <span class="hljs-comment">// 使用布隆过滤器存储可售商品ID</span>
            bloomFilter<span class="hljs-selector-class">.add</span>(product.getId());
        }
    }
}
</code></pre>
<h3 data-id="heading-14">4. 详细实现方案</h3>
<h4 data-id="heading-15">4.1 秒杀流程</h4>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillSystem</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_seckill</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, user_id, product_id</span>):
        <span class="hljs-comment"># 1. 恶意请求拦截</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.check_risk(user_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">403</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"访问过于频繁"</span>}

        <span class="hljs-comment"># 2. 布隆过滤器快速判断</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> bloom_filter.contains(product_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">404</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"商品不存在"</span>}

        <span class="hljs-comment"># 3. 内存标记（已售罄的商品直接返回）</span>
        <span class="hljs-keyword">if</span> sold_out_flags.get(product_id):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"已售罄"</span>}

        <span class="hljs-comment"># 4. Redis原子扣减库存</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.deduct_stock_in_redis(product_id):
            sold_out_flags[product_id] = <span class="hljs-title class_">True</span>
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"code"</span>: <span class="hljs-number">400</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"库存不足"</span>}

        <span class="hljs-comment"># 5. 生成订单ID（雪花算法）</span>
        order_id = snowflake.generate()

        <span class="hljs-comment"># 6. 订单信息入队</span>
        mq.send({
            <span class="hljs-string">"order_id"</span>: order_id,
            <span class="hljs-string">"user_id"</span>: user_id,
            <span class="hljs-string">"product_id"</span>: product_id,
            <span class="hljs-string">"time"</span>: time.time()
        })

        <span class="hljs-comment"># 7. 返回排队中</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"code"</span>: <span class="hljs-number">200</span>,
            <span class="hljs-string">"msg"</span>: <span class="hljs-string">"排队中"</span>,
            <span class="hljs-string">"order_id"</span>: order_id,
            <span class="hljs-string">"queue_position"</span>: get_queue_position(order_id)
        }
</code></pre>
<h4 data-id="heading-16">4.2 库存同步方案</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Component</span>
<span class="hljs-keyword">@Slf</span>4j
public class StockSyncService {

    <span class="hljs-comment">// 数据库最终扣减</span>
    <span class="hljs-keyword">@Transactional</span>
    public void syncStockToDB(String productId, int count) {
        try {
            <span class="hljs-comment">// 数据库扣减（带重试机制）</span>
            boolean success = productDAO<span class="hljs-selector-class">.deductStock</span>(productId, count);

            if (success) {
                <span class="hljs-comment">// 更新Redis中的最终库存状态</span>
                redisTemplate<span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(
                    "stock_final:" + productId,
                    getDBStock(productId)
                );

                <span class="hljs-comment">// 删除售罄标记</span>
                soldOutCache<span class="hljs-selector-class">.remove</span>(productId);
            }
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("库存同步失败", e);
            <span class="hljs-comment">// 记录异常，人工介入处理</span>
            alertService<span class="hljs-selector-class">.sendAlert</span>(e);
        }
    }

    <span class="hljs-comment">// 库存对账任务</span>
    <span class="hljs-keyword">@Scheduled</span>(cron = <span class="hljs-string">"0 */5 * * * ?"</span>)
    public void stockReconciliation() {
        List&lt;Product&gt; products = productDAO<span class="hljs-selector-class">.getAllSeckillProducts</span>();

        for (Product product : products) {
            Integer redisStock = <span class="hljs-built_in">getRedisStock</span>(product.getId());
            Integer dbStock = product<span class="hljs-selector-class">.getStock</span>();

            if (!Objects.equals(redisStock, dbStock)) {
                log<span class="hljs-selector-class">.warn</span>("库存不一致: productId={}, redis={}, db={}", 
                         product.getId(), redisStock, dbStock);
                <span class="hljs-comment">// 自动修复或报警</span>
                <span class="hljs-built_in">fixStockInconsistency</span>(product.getId(), dbStock);
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-17">三、高可用保障</h2>
<h3 data-id="heading-18">1. 限流降级策略</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 多维度限流配置</span>
<span class="hljs-section">限流规则:</span>
  用户维度: 每个用户10次/分钟
  IP维度: 每个IP 1000次/分钟
  商品维度: 每个商品 10000次/分钟
  总QPS: 系统最大承受50000 QPS
</code></pre>
<h3 data-id="heading-19">2. 熔断降级</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@Slf4j</span>
public class SeckillController {

    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/seckill/{productId}"</span>)
    <span class="hljs-variable">@HystrixCommand</span>(
        fallbackMethod = <span class="hljs-string">"seckillFallback"</span>,
        commandProperties = {
            <span class="hljs-variable">@HystrixProperty</span>(name = <span class="hljs-string">"execution.isolation.thread.timeoutInMilliseconds"</span>, value = <span class="hljs-string">"1000"</span>),
            <span class="hljs-variable">@HystrixProperty</span>(name = <span class="hljs-string">"circuitBreaker.requestVolumeThreshold"</span>, value = <span class="hljs-string">"20"</span>)
        }
    )
    public Response <span class="hljs-built_in">seckill</span>(<span class="hljs-variable">@PathVariable</span> String productId, 
                            <span class="hljs-variable">@RequestParam</span> String userId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">seckillService</span><span class="hljs-selector-class">.process</span>(userId, productId);
    }

    <span class="hljs-comment">// 降级方法</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Response</span> <span class="hljs-selector-tag">seckillFallback</span>(String productId, String userId) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Response</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"系统繁忙，请稍后重试"</span>);
    }
}
</code></pre>
<h2 data-id="heading-20">四、监控与告警</h2>
<h3 data-id="heading-21">1. 关键监控指标</h3>
<ul>
<li><strong>系统层面</strong>：QPS、RT、错误率、CPU/内存使用率</li>
<li><strong>应用层面</strong>：库存扣减成功率、消息堆积量</li>
<li><strong>业务层面</strong>：抢购成功率、用户排队时长</li>
</ul>
<h3 data-id="heading-22">2. 监控实现</h3>
<pre><code class="hljs language-arduino" lang="arduino">@Component
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MeterRegistry meterRegistry;

    <span class="hljs-comment">// 记录关键指标</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">recordSeckill</span><span class="hljs-params">(<span class="hljs-type">String</span> productId, <span class="hljs-type">boolean</span> success, <span class="hljs-type">long</span> cost)</span> </span>{
        <span class="hljs-comment">// QPS监控</span>
        meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.requests.total"</span>).<span class="hljs-built_in">increment</span>();

        <span class="hljs-keyword">if</span> (success) {
            meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.success.total"</span>).<span class="hljs-built_in">increment</span>();
        } <span class="hljs-keyword">else</span> {
            meterRegistry.<span class="hljs-built_in">counter</span>(<span class="hljs-string">"seckill.fail.total"</span>).<span class="hljs-built_in">increment</span>();
        }

        <span class="hljs-comment">// 耗时分布</span>
        meterRegistry.<span class="hljs-built_in">timer</span>(<span class="hljs-string">"seckill.process.time"</span>)
        .<span class="hljs-built_in">record</span>(cost, TimeUnit.MILLISECONDS);

        <span class="hljs-comment">// 库存变化</span>
        meterRegistry.<span class="hljs-built_in">gauge</span>(<span class="hljs-string">"seckill.stock."</span> + productId, 
                            <span class="hljs-built_in">getCurrentStock</span>(productId));
    }
}
</code></pre>
<h2 data-id="heading-23">五、部署与扩展</h2>
<h3 data-id="heading-24">1. 弹性扩展策略</h3>
<ul>
<li><strong>水平扩展</strong>：无状态服务可快速扩容</li>
<li><strong>自动伸缩</strong>：基于CPU使用率或QPS自动扩缩容</li>
<li><strong>异地多活</strong>：重要业务支持多机房部署</li>
</ul>
<h3 data-id="heading-25">2. 压测方案</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">压测场景:</span>
  场景1: 库存预热，10万用户同时抢1万商品
  场景2: 持续高压，5万QPS持续5分钟
  场景3: 峰值冲击，瞬间20万QPS
  
<span class="hljs-section">压测目标:</span>
  成功率: &gt;99.9%
  平均RT: &lt;100ms
  错误率: &lt;0.1%
</code></pre>
<h2 data-id="heading-26">六、安全考虑</h2>
<ol>
<li><strong>防刷机制</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>验证码（峰值时降级）</li>
<li>设备指纹</li>
<li>行为分析</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>数据安全</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>关键数据加密</li>
<li>操作日志记录</li>
<li>防篡改校验</li>
</ul>
</li>
</ul>
<h2 data-id="heading-27">总结要点</h2>
<ol>
<li><strong>架构核心</strong>：分层过滤 + 异步处理 + 最终一致</li>
<li><strong>库存核心</strong>：Redis原子操作 + 消息队列 + 数据库乐观锁</li>
<li><strong>性能核心</strong>：缓存预热 + 流量削峰 + 读写分离</li>
<li><strong>稳定核心</strong>：熔断降级 + 限流隔离 + 快速失败</li>
</ol>
<h2 data-id="heading-28">面试回答</h2>
<p>首先，<strong>架构设计上要动静分离、分层削峰</strong>。我会把系统分为：</p>
<ol>
<li><strong>静态资源分离</strong>：商品图片、描述页等提前推送到CDN，请求直接走边缘节点，不给后端压力。</li>
<li><strong>网关层限流</strong>：在入口用Nginx或网关（如Sentinel）做恶意请求拦截和总流量限制，比如对同一UID限速，超过阈值直接返回“请求频繁”。</li>
<li><strong>业务逻辑后置，请求队列化</strong>：秒杀的核心——“下单扣库存”这个最重要的逻辑，绝不放在前台实时处理。用户点击“抢购”后，前端直接返回“排队中”，请求进入一个<strong>消息队列</strong>（比如RabbitMQ、Kafka或RocketMQ）。这样一来，海量并发就被平滑成顺序处理的流量，后端服务按照自己的能力从队列里慢慢消费，实现<strong>削峰填谷</strong>。</li>
<li><strong>服务独立部署</strong>：把秒杀相关的功能（验资格、扣库存）单独做成一个微服务，避免影响商城其他正常功能（如浏览、普通下单）。</li>
</ol>
<p>其次，针对如何解决超卖、库存扣减和高并发请求这三个核心问题，我的解决方案是：</p>
<ol>
<li><strong>解决超卖和库存扣减</strong>：这是秒杀的核心。我的方案是：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>预扣库存</strong>：活动开始前，把商品的库存从主库加载到<strong>Redis</strong>中。Redis是单线程内存操作，可以保证原子性。</li>
<li><strong>原子化操作</strong>：在Redis里，使用 <code>DECR</code> 或 <code>LUA</code> 脚本来扣减库存。<code>DECR</code> 命令会直接返回扣减后的值，如果返回值小于0，就说明库存没了，后续流程直接返回售罄。LUA脚本可以打包多个操作（检查库存、扣减），确保整个过程原子性，彻底杜绝超卖。</li>
<li><strong>最终同步</strong>：后台服务从队列消费，成功扣减Redis库存后，生成一个订单ID（但状态是“未支付”），再异步去更新数据库的库存。这里数据库的库存更多是用于后续对账和长尾查询。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>应对高并发请求</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>限流</strong>：除了网关层的总限流，在秒杀服务本身也要做限流，比如用信号量或令牌桶控制处理线程数，只服务自己能承受的流量，多的直接拒绝，快速失败。</li>
<li><strong>无状态化与扩容</strong>：秒杀服务做成无状态的，方便用K8s或云服务快速横向扩容，扛过峰值后再缩容，控制成本。</li>
<li><strong>热点数据隔离</strong>：对于“爆款”商品，它的库存Key在Redis里是热点Key。可以做两件事：一是提前对它进行<strong>Key散列</strong>，把压力分散到多个Redis节点；二是使用Redis集群模式，并开启读写分离。</li>
</ul>
</li>
</ul>
<p>最后，还有一些<strong>关键的细节和兜底策略</strong>：</p>
<ul>
<li><strong>防刷与验证</strong>：前端加入计算型验证码或答题，防止机器人；下单前必须校验用户资格（是否登录、地址完善等）。</li>
<li><strong>异步下单与结果轮询</strong>：用户提交后，服务端返回一个“排队ID”，前端用这个ID轮询后端，查询最终结果（成功、失败或等待）。用户体验上是“排队等待”，而不是一直卡住或报错。</li>
<li><strong>数据一致性对账</strong>：因为用了Redis和消息队列，可能出现极端情况下的数据不一致（比如Redis扣成功，但下游服务挂了，订单没生成）。需要有一个定时对账任务，核对Redis、数据库库存和订单状态，进行修复。</li>
<li><strong>降级与熔断</strong>：如果Redis或数据库访问慢，要有熔断机制，防止服务被拖垮。比如可以快速降级到“返回售罄”的静态页面。</li>
</ul>
<hr/>
<p><strong>总结一下</strong>，我的设计思路是：<strong>前端限流拦截，请求队列削峰；Redis原子扣减防超卖；服务无状态化应对高并发；再通过异步、对账等手段保证最终一致性和用户体验</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！]]></title>    <link>https://juejin.cn/post/7594863660297617450</link>    <guid>https://juejin.cn/post/7594863660297617450</guid>    <pubDate>2026-01-14T09:10:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297617450" data-draft-id="7594791357143973930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！"/> <meta itemprop="keywords" content="HarmonyOS,ArkTS,ArkUI"/> <meta itemprop="datePublished" content="2026-01-14T09:10:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="威哥爱编程"/> <meta itemprop="url" content="https://juejin.cn/user/2242659450109575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙 APP 还是卡顿？API 21 性能优化这 3 招，立竿见影！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659450109575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    威哥爱编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:10:07.000Z" title="Wed Jan 14 2026 09:10:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hello，兄弟们，我是 V 哥！</p>
<p>昨天有个粉丝在群里哭诉：“V 哥，我用鸿蒙 API 21 写的 App，在模拟器上跑得像法拉利，一到真机老款机型上，划一下屏幕顿两下，简直像在开拖拉机！产品经理都快把我的键盘砸烂了！”</p>
<p>我心想，有没有可能不是手机不行，这是<strong>代码没写对</strong>呢！</p>
<p>很多兄弟从 Android 或者 Vue 转过来，习惯性地把以前那套“暴力渲染”的逻辑搬到 ArkTS 上。在 API 21 这个新版本上，鸿蒙的渲染引擎虽然强，但你不按它的套路出牌，它照样给你摆烂。</p>
<p>今天，V 哥就掏出压箱底的**“性能三板斧”**。这三招，只要你能消化哪怕一招，你的 App 流畅度立马提升一个档次。咱们直接上 DevEco Studio 6.0 的实战代码，开整！</p>
<hr/>
<h2 data-id="heading-0">第一招：长列表别用 ForEach，LazyForEach 才是YYDS</h2>
<h3 data-id="heading-1">痛点在哪？</h3>
<p>很多兄弟写列表，习惯性上 <code>ForEach</code>。V 哥必须提醒你：<strong><code>ForEach</code> 是一次性渲染</strong>。如果你的数据有几百条、几千条，它会啪一下一下子把所有组件全创建出来。内存瞬间爆炸，CPU 飙升，卡顿是必然的！</p>
<h3 data-id="heading-2">解决方案</h3>
<p>API 21 下，必须要用 <strong><code>LazyForEach</code></strong>（懒加载）。它的核心逻辑是：<strong>只渲染屏幕可见的那几个 Item，你滑下来一个，我再创建一个，滑上去销毁一个</strong>。内存占用极低，丝般顺滑。</p>
<h3 data-id="heading-3">代码实战</h3>
<p>兄弟们，这部分代码比较经典，建议直接复制到你的 <code>DevEco Studio</code> 里跑一跑。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. 定义基础的数据源接口。这是 LazyForEach 必须要实现的规矩</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IBasicDataSource</span> {
  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span>;
  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Object</span>;
  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 2. 重命名以避免冲突 - 修复第10行错误</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
  <span class="hljs-title function_">onDataMoved</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 3. 实现数据变化监听器 - 使用新名称</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataChangeCallback</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataChangeListener</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataAdded</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataChanged</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataDeleted</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
  <span class="hljs-title function_">onDataMoved</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {}
}

<span class="hljs-comment">// 4. 核心数据源类（V哥精简版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBasicDataSource</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">IDataChangeListener</span>[] = [];
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataList</span>: <span class="hljs-built_in">string</span>[] = [];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">list: <span class="hljs-built_in">string</span>[]</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span> = list;
  }

  <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-property">length</span>;
  }

  <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Object</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>[index];
  }

  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);
    }
  }

  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">IDataChangeListener</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);
    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);
    }
  }

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">push</span>(data);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReloaded</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">notifyDataReloaded</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {
      listener.<span class="hljs-title function_">onDataReloaded</span>();
    });
  }
}

<span class="hljs-comment">// 简化数据变更监听器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleDataChangeCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">DataChangeCallback</span> {
  <span class="hljs-title function_">onDataReloaded</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"数据已重新加载，UI可以刷新"</span>);
  }
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">LazyForEachDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">dataSource</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>([]);

  <span class="hljs-comment">// 使用新的监听器类型</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listener</span>: <span class="hljs-title class_">SimpleDataChangeCallback</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDataChangeCallback</span>();

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 预先生成数据</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">initData</span>: <span class="hljs-built_in">string</span>[] = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
      initData.<span class="hljs-title function_">push</span>(<span class="hljs-string">'V哥带你飞 - 第 '</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">' 条数据'</span>);
    }
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>(initData);

    <span class="hljs-comment">// 注册数据变化监听器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>);
  }

  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 取消注册数据变化监听器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 标题</span>
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'LazyForEach 性能演示'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)

      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {
        <span class="hljs-title class_">LazyForEach</span>(
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>,
          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
            <span class="hljs-title class_">ListItem</span>() {
              <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">ListItemChild</span>(item)
            }
          },
          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index?: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
            <span class="hljs-comment">// 返回索引作为唯一标识</span>
            <span class="hljs-keyword">if</span> (index === <span class="hljs-literal">undefined</span>) {
              <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>().<span class="hljs-title function_">toString</span>();
            }
            <span class="hljs-keyword">return</span> index.<span class="hljs-title function_">toString</span>();
          }
        )
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'85%'</span>)
      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'模拟增加数据'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">addData</span>(<span class="hljs-string">'新数据 '</span> + (<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataSource</span>.<span class="hljs-title function_">totalCount</span>() + <span class="hljs-number">1</span>));
        })
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }

  <span class="hljs-comment">// 将子组件改为build方法内的组件构建器</span>
  <span class="hljs-meta">@Builder</span>
  <span class="hljs-title class_">ListItemChild</span>(<span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(content)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
        .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Start</span>)
        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#f0f0f0'</span>)
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">2</span> })
  }
}
</code></pre>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>千万别懒，一定要实现 <code>IDataSource</code>。</li>
<li><code>LazyForEach</code> 的第三个参数（key生成函数）一定要写，而且要保证唯一性！这是组件复用的身份证，写错了渲染必乱。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1b3b234d914400b96ff8963c8458445~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=2Gfxi%2Ftjd6ZPnKwM9ET65ksmM%2BA%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">第二招：别在主线程算数，TaskPool 帮你搬砖</h2>
<h3 data-id="heading-5">痛点在哪？</h3>
<p>你是不是经常在点击事件里直接写大量逻辑？比如解析巨大的 JSON、图片滤镜处理、复杂算法排序？<strong>兄弟，那是主线程（UI线程）啊！</strong> 你在那算数，UI 就得等着，屏幕当然卡死不动。</p>
<h3 data-id="heading-6">解决方案</h3>
<p>API 21 推荐使用 <strong><code>TaskPool</code>（任务池）</strong>。把重活累活扔给后台线程池去干，算完了结果一扔，主线程只负责展示。分工明确，效率翻倍。</p>
<h3 data-id="heading-7">代码实战</h3>
<p>咱们模拟一个“复杂排序”的场景，看 V 哥怎么用 TaskPool 优化。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> taskpool <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.taskpool'</span>;

<span class="hljs-comment">// 1. 定义一个并发函数（这是在后台线程跑的）</span>
<span class="hljs-comment">// 注意：@Concurrent 装饰器是必须的，这是 ArkTS 并发编程的标识</span>
<span class="hljs-meta">@Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">heavyComputation</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span>[] {
  <span class="hljs-comment">// V 哥模拟一个超级耗时的排序操作</span>
  <span class="hljs-comment">// 比如这里可以换成复杂的 JSON 解析、加密解密等</span>
  <span class="hljs-keyword">let</span> arr = [...data];
  arr.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - b);

  <span class="hljs-comment">// 模拟耗时，让兄弟们看到效果</span>
  <span class="hljs-keyword">let</span> start = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() - start &lt; <span class="hljs-number">500</span>) {
    <span class="hljs-comment">// 故意卡住 500毫秒，如果在主线程，UI会完全冻结</span>
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"V哥后台线程计算完毕！"</span>);
  <span class="hljs-keyword">return</span> arr;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">TaskPoolDemo</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'点击按钮开始计算'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">resultString</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'结果等待中...'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isCalculating</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })

      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span>) {
        <span class="hljs-title class_">LoadingProgress</span>()
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)
          .<span class="hljs-title function_">color</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })
      }

      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'使用 TaskPool 后台计算'</span>)
        .<span class="hljs-title function_">enabled</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startCalculation</span>();
        })
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }

  <span class="hljs-comment">// 将计算逻辑提取为独立方法</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">startCalculation</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"正在后台拼命算数中..."</span>;

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 准备一些乱序数据</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">rawData</span>: <span class="hljs-built_in">number</span>[] = [];
      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        rawData.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10000</span>);
      }

      <span class="hljs-comment">// 修复：使用正确的 TaskPool API</span>
      <span class="hljs-comment">// 方式1：直接执行函数（推荐）</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(heavyComputation, rawData) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>[];

      <span class="hljs-comment">// 计算完成，回到主线程（这里会自动切回来，放心用UI）</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"计算完成！UI丝滑不卡顿！"</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span> = <span class="hljs-string">`前5个数据: <span class="hljs-subst">${result.slice(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>).join(<span class="hljs-string">', '</span>)}</span>`</span>;

    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isCalculating</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`V哥报错: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"计算失败！"</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultString</span> = <span class="hljs-string">`错误信息: <span class="hljs-subst">${err}</span>`</span>;
    }
  }
}
</code></pre>
<p>这个案例需要真机测试，V 哥使用新入手的MatePad Pro：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9303650b045a4ade88a19ec2f06b1744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=ywrI9gjvBEqhgqzB%2B0lx4KB1kCM%3D" alt="" loading="lazy"/></p>
<p>以下是单击按钮后运行的结果：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66dff9c57f1749b59520f13fe2b4d07e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=ZCgDp0dhA%2Bn4m8pGPkxTB2hWvQ8%3D" alt="" loading="lazy"/></p>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>记得给函数加 <code>@Concurrent</code>，否则扔不进 TaskPool。</li>
<li>TaskPool 是自动管理线程的，你别自己 new Thread，那样太低级且容易OOM。</li>
<li>记住，<strong>UI 只能更新状态，不能做重活</strong>。</li>
</ol>
<hr/>
<h2 data-id="heading-8">第三招：组件别总造新的，@Reusable 复用才省钱</h2>
<h3 data-id="heading-9">痛点在哪？</h3>
<p>在列表滑动或者页面切换时，如果频繁创建和销毁组件（比如 <code>new ChildComponent()</code>），GC（垃圾回收）压力会非常大，导致内存抖动，表现就是<strong>掉帧</strong>。</p>
<h3 data-id="heading-10">解决方案</h3>
<p>API 21 提供了一个非常强力的装饰器：<strong><code>@Reusable</code></strong>。它的作用是：<strong>组件不从树上卸载，而是回收到缓存池里，下次需要的时候直接拿过来改个数据接着用</strong>。这简直是“物尽其用”的典范！</p>
<h3 data-id="heading-11">代码实战</h3>
<p>咱们看怎么改造刚才的 <code>ListItemChild</code> 组件。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义一个复用的数据模型，方便传递</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ListItemParams</span> {
  <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;
  <span class="hljs-attr">color</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"#ffffff"</span>;
}

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableDemo</span> {
  <span class="hljs-comment">// 模拟数据</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataList</span>: <span class="hljs-title class_">ListItemParams</span>[] = [];

  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 在生命周期中初始化数据，避免在构建时执行复杂逻辑</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
      <span class="hljs-keyword">let</span> item = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListItemParams</span>();
      item.<span class="hljs-property">content</span> = <span class="hljs-string">`可复用组件 Item <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>;
      item.<span class="hljs-property">color</span> = i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'#e0e0e0'</span> : <span class="hljs-string">'#ffffff'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>.<span class="hljs-title function_">push</span>(item);
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Reusable 组件演示'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)

      <span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataList</span>, <span class="hljs-function">(<span class="hljs-params">item: ListItemParams</span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-comment">// 使用我们的复用组件</span>
            <span class="hljs-title class_">ReusableChild</span>({ <span class="hljs-attr">param</span>: item })
          }
        }, <span class="hljs-function">(<span class="hljs-params">item: ListItemParams</span>) =&gt;</span> item.<span class="hljs-property">content</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()) <span class="hljs-comment">// 唯一Key，避免使用index</span>
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)
      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-comment">// 核心重点：可复用组件</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">ReusableChild</span> {
  <span class="hljs-comment">// 使用 @Prop 装饰器来接收父组件传递的参数</span>
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">ListItemParams</span>;

  <span class="hljs-comment">// 组件自己的状态</span>
  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-attr">reuseCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;

  <span class="hljs-comment">/**
   * 生命周期：当组件从缓存池被重新拿出来复用时触发
   * 注意：ArkTS 中正确的复用生命周期是 aboutToReuse
   */</span>
  <span class="hljs-title function_">myAboutToReuse</span>(<span class="hljs-attr">param</span>: <span class="hljs-title class_">ListItemParams</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-comment">// 更新参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span> = param;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reuseCount</span>++;

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`V哥：组件被复用了！复用次数: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reuseCount}</span>`</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span>.<span class="hljs-property">content</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
        .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)

      <span class="hljs-title class_">Blank</span>()

      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'复用组件'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reuseCount &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'已复用'</span> : <span class="hljs-string">'新建'</span>}</span>`</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)
          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reuseCount</span> &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span> : <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
      }
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">param</span>.<span class="hljs-property">color</span>)
    .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">15</span> })
    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a90986f72ebf4be69ddcfb71651ddf52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aiB5ZOl54ix57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986607&amp;x-signature=rbsODjQytYypqauLYTOy4JVEZsU%3D" alt="" loading="lazy"/></p>
<p><strong>V 哥划重点：</strong></p>
<ol>
<li>加上 <code>@Reusable</code> 装饰符，你的组件就开启了“绿色环保”模式。</li>
<li>必须实现 <code>aboutToReuse</code> 方法。这是复用组件的灵魂，它决定了你把旧组件拿回来后，怎么给它“洗心革面”（更新数据）。</li>
<li>配合 LazyForEach 使用，那是绝配，性能起飞！</li>
</ol>
<hr/>
<h2 data-id="heading-12">V 哥总结一下</h2>
<p>兄弟们，API 21 的鸿蒙开发，其实就是在跟**“渲染”<strong>和</strong>“资源”**打交道。</p>
<ul>
<li><strong>长列表</strong>？上 <code>LazyForEach</code>，按需加载。</li>
<li><strong>重任务</strong>？上 <code>TaskPool</code>，后台多线程。</li>
<li><strong>组件多</strong>？上 <code>@Reusable</code>，回池复用。</li>
</ul>
<p>这三招你哪怕只学会了一招，你那个像“拖拉机”一样的 App 也能立马变“法拉利”。V 哥话就撂这儿了，代码都给你整理好了，直接去 DevEco Studio 6.0 里敲一遍，感受一下那种丝滑的快感！</p>
<p>我是 V 哥，咱们下期技术复盘见！别忘了给文章点个赞，这是 V 哥持续输出的动力！👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[android gzip数据压缩 笔记]]></title>    <link>https://juejin.cn/post/7594813727053889570</link>    <guid>https://juejin.cn/post/7594813727053889570</guid>    <pubDate>2026-01-14T09:07:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053889570" data-draft-id="7594851429162221602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="android gzip数据压缩 笔记"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-14T09:07:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="心源xinyuan"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029151694"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            android gzip数据压缩 笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029151694/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    心源xinyuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:07:03.000Z" title="Wed Jan 14 2026 09:07:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Android 中进行 GZIP 数据压缩，主要涉及<strong>向服务器发送压缩数据</strong>和<strong>解压服务器返回的压缩数据</strong>两个场景。</p>
<p>以下是如何在客户端（Android）实现这两个关键操作的详细说明和代码示例。</p>
<h3 data-id="heading-0">一、发送数据：压缩请求体（POST/PUT等）</h3>
<p>当你需要向服务器发送大量文本数据（如 JSON）时，在客户端压缩可以显著减少上传流量。</p>
<p><strong>核心步骤：</strong></p>
<ol>
<li><strong>压缩数据</strong>：使用 <code>GZIPOutputStream</code> 将原始数据（如字符串）压缩为字节数组。</li>
<li><strong>设置请求头</strong>：在 HTTP 请求头中明确告诉服务器数据是经过 GZIP 压缩的，通常设置 <code>Content-Encoding: gzip</code>。</li>
<li><strong>发送二进制数据</strong>：将压缩后的字节数组作为请求体发送。</li>
</ol>
<p><strong>以下是使用 <code>OkHttp</code> 库发送 GZIP 压缩请求的推荐做法：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> okhttp3.*
<span class="hljs-keyword">import</span> okio.*
<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream
<span class="hljs-keyword">import</span> java.util.zip.GZIPOutputStream

<span class="hljs-comment">// 1. 创建一个 OkHttpClient 实例</span>
<span class="hljs-keyword">val</span> client = OkHttpClient()

<span class="hljs-comment">// 2. 准备要发送的原始数据（例如一个 JSON 字符串）</span>
<span class="hljs-keyword">val</span> jsonString = <span class="hljs-string">"""{"name":"张三","age":25,"comment":"这是一个可能会很长的文本字段..."}"""</span>
<span class="hljs-keyword">val</span> requestBody = jsonString.toRequestBody(<span class="hljs-string">"application/json; charset=utf-8"</span>.toMediaType())

<span class="hljs-comment">// 3. 使用 GZIP 压缩请求体</span>
<span class="hljs-keyword">val</span> gzippedRequestBody = requestBody.gzip() <span class="hljs-comment">// 调用下面的扩展函数</span>

<span class="hljs-comment">// 4. 构建请求，并设置正确的请求头</span>
<span class="hljs-keyword">val</span> request = Request.Builder()
    .url(<span class="hljs-string">"https://your.api.com/endpoint"</span>)
    .post(gzippedRequestBody) <span class="hljs-comment">// 使用压缩后的请求体</span>
    .header(<span class="hljs-string">"Content-Encoding"</span>, <span class="hljs-string">"gzip"</span>) <span class="hljs-comment">// 关键：声明内容编码方式</span>
    .build()

<span class="hljs-comment">// 5. 发起异步请求</span>
client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onFailure</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, e: <span class="hljs-type">IOException</span>)</span></span> {
        <span class="hljs-comment">// 处理网络失败</span>
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
        <span class="hljs-comment">// 处理服务器响应</span>
    }
})

<span class="hljs-comment">// --- 关键：用于压缩 RequestBody 的 OkHttp 扩展函数 ---</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> RequestBody.<span class="hljs-title">gzip</span><span class="hljs-params">()</span></span>: RequestBody {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span> : RequestBody() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contentType</span><span class="hljs-params">()</span></span>: MediaType? = <span class="hljs-keyword">this</span><span class="hljs-symbol">@gzip</span>.contentType()
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">contentLength</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Long</span> = -<span class="hljs-number">1</span> <span class="hljs-comment">// 压缩后长度未知，传递 -1</span>
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeTo</span><span class="hljs-params">(sink: <span class="hljs-type">BufferedSink</span>)</span></span> {
            <span class="hljs-comment">// 创建 GZIP 输出流，包装原始的 sink</span>
            <span class="hljs-keyword">val</span> gzipSink = GZIPOutputStream(sink.outputStream()).buffer()
            <span class="hljs-comment">// 将原始 RequestBody 的内容写入压缩流</span>
            <span class="hljs-keyword">this</span><span class="hljs-symbol">@gzip</span>.writeTo(gzipSink)
            gzipSink.close() <span class="hljs-comment">// 必须关闭 GZIP 流以写入尾部数据</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-1">二、接收数据：处理服务器返回的压缩响应（GET等）</h3>
<p>更常见的场景是，服务器返回了经过 GZIP 压缩的响应体（如 HTML、JSON），客户端需要正确解压。好消息是，<strong>现代网络库（如 OkHttp）通常会自动处理这个过程</strong>。</p>
<h4 data-id="heading-2">方式一：依赖网络库自动处理（推荐）</h4>
<p><strong>OkHttp、Retrofit 等库默认会自动处理 <code>Content-Encoding: gzip</code> 响应头，并对响应体进行透明解压。</strong> 你通常不需要手动写解压代码。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> client = OkHttpClient.Builder()
    .build() <span class="hljs-comment">// 默认已支持自动解压 GZIP 响应</span>

<span class="hljs-keyword">val</span> request = Request.Builder()
    .url(<span class="hljs-string">"https://api.example.com/data"</span>)
    .build()

client.newCall(request).enqueue(<span class="hljs-keyword">object</span> : Callback {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onResponse</span><span class="hljs-params">(call: <span class="hljs-type">Call</span>, response: <span class="hljs-type">Response</span>)</span></span> {
        <span class="hljs-comment">// OkHttp 已在此处自动解压，你直接拿到的是解压后的字符串</span>
        <span class="hljs-keyword">val</span> responseBodyString = response.body?.string()
        <span class="hljs-comment">// ... 处理数据</span>
    }
    <span class="hljs-comment">// ... onFailure</span>
})
</code></pre>
<h4 data-id="heading-3">方式二：手动解压字节数据（如需）</h4>
<p>如果你通过其他方式（如 <code>HttpURLConnection</code>）获得了原始的压缩字节流，可以手动解压。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.io.ByteArrayInputStream
<span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream
<span class="hljs-keyword">import</span> java.util.zip.GZIPInputStream

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">decompressGzip</span><span class="hljs-params">(compressedBytes: <span class="hljs-type">ByteArray</span>)</span></span>: String {
    <span class="hljs-comment">// 使用 GZIPInputStream 包装压缩的字节输入流</span>
    ByteArrayInputStream(compressedBytes).use { bis -&gt;
        GZIPInputStream(bis).use { gzipIs -&gt;
            <span class="hljs-comment">// 读取解压后的数据</span>
            ByteArrayOutputStream().use { bos -&gt;
                <span class="hljs-keyword">val</span> buffer = ByteArray(<span class="hljs-number">1024</span>)
                <span class="hljs-keyword">var</span> len: <span class="hljs-built_in">Int</span>
                <span class="hljs-keyword">while</span> (gzipIs.read(buffer).also { len = it } != -<span class="hljs-number">1</span>) {
                    bos.write(buffer, <span class="hljs-number">0</span>, len)
                }
                <span class="hljs-comment">// 转换为字符串（假设是文本）</span>
                <span class="hljs-keyword">return</span> bos.toString(<span class="hljs-string">"UTF-8"</span>)
            }
        }
    }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-comment">// val compressedData: ByteArray = ... // 从网络获取的原始字节</span>
<span class="hljs-comment">// val originalString = decompressGzip(compressedData)</span>
</code></pre>
<h3 data-id="heading-4">三、关键实践要点与注意事项</h3>

























<table><thead><tr><th align="left">要点</th><th align="left">说明与建议</th></tr></thead><tbody><tr><td align="left"><strong>1. 服务器协同</strong></td><td align="left">发送时：服务器需能解析 <code>Content-Encoding: gzip</code> 请求头并自动解压。<br/>接收时：服务器需正确设置 <code>Content-Encoding: gzip</code> 响应头。</td></tr><tr><td align="left"><strong>2. 压缩收益</strong></td><td align="left"><strong>文本数据</strong>（JSON、XML、HTML）压缩效果极佳（可达70%+）。<br/><strong>已压缩格式</strong>（如图片JPEG/PNG、视频、已为.gz文件）再次压缩无效，反而增加开销。</td></tr><tr><td align="left"><strong>3. 性能权衡</strong></td><td align="left">压缩/解压消耗 <strong>CPU 资源</strong>，节省<strong>网络带宽和传输时间</strong>。在移动网络下，通常利远大于弊。这与<strong>耗电优化</strong>需权衡：密集压缩可能增加耗电，但大幅缩短了网络活跃时间，通常整体更省电。</td></tr><tr><td align="left"><strong>4. 测试验证</strong></td><td align="left"><strong>使用抓包工具</strong>（如 Charles、Fiddler）检查请求/响应头及原始数据大小，确认压缩生效。在代码中打印压缩前后数据长度进行对比。</td></tr></tbody></table>
<h3 data-id="heading-5">四、总结与最佳实践</h3>
<ol>
<li><strong>发送压缩请求</strong>：使用 OkHttp 等库的扩展功能，在发送前压缩请求体，并正确设置 <code>Content-Encoding: gzip</code> 头。</li>
<li><strong>接收压缩响应</strong>：<strong>优先依赖网络库的自动解压功能</strong>，无需手动实现。</li>
<li><strong>针对性压缩</strong>：主要对文本类 API 响应和请求进行压缩，避免对已压缩的二进制资源重复操作。</li>
<li><strong>全程监控</strong>：通过抓包工具验证压缩效果，确保服务器和客户端配置正确。</li>
</ol>
<p>将 GZIP 压缩与之前提到的<strong>网络请求合并、缓存策略、图片优化</strong>等手段结合，能全方位、有效地优化应用流量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于遗传算法实现自动泊车+pygame可视化]]></title>    <link>https://juejin.cn/post/7595021077664956467</link>    <guid>https://juejin.cn/post/7595021077664956467</guid>    <pubDate>2026-01-14T08:08:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077664956467" data-draft-id="7595030559563563059" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于遗传算法实现自动泊车+pygame可视化"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T08:08:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户137794049993"/> <meta itemprop="url" content="https://juejin.cn/user/3687102534924266"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于遗传算法实现自动泊车+pygame可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3687102534924266/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户137794049993
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:08:27.000Z" title="Wed Jan 14 2026 08:08:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、 背景</h3>
<p>我曾经使用遗传算法常用于解决旅行商问题，认为遗传算法解决问题的关键是对问题编码。看到了一篇有趣的技术博文【1】，介绍使用<strong>遗传算法（Genetic Algorithm, GA）</strong> 训练小车在模拟环境中实现自动泊车。尽管文章中对泊车问题编码的思路非常精彩，但是使用 Three.js 进行算法实现和可视化的，对后端选手不太友好😢。在复现的过程中，参考了博文【1】的算法思路，为了避免碰撞，优化了损失函数。本文使用python实现算法，并使用pygame库进行可视化，源码上传了git仓库（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flcmchn%2Fself-parking-genetic" target="_blank" title="https://github.com/lcmchn/self-parking-genetic" ref="nofollow noopener noreferrer">github.com/lcmchn/self…</a>）。</p>
<h3 data-id="heading-1">二、 算法设计</h3>
<p>首先要理解本算法设计的核心思想：</p>
<pre><code class="hljs">自动泊车的本质是 “小车根据环境（障碍物）调整动作（行驶、转向），最终精准停靠目标车位”。本文用进化（遗传算法）的方式“训练”小车学会这一过程，而不是手动编写规则。
</code></pre>
<p>然后大家在阅读本文前思考几个问题，这是本文解决泊车任务的关键：</p>
<p>👀 感知（看）：小车如何获取周围环境信息？ 🤔 决策（想）：如何根据环境信息生成动作指令？ 📖 优化（学）：如何让小车通过迭代 “学会” 最优决策逻辑？</p>
<p>为了解决上面三个问题，本文先对小车建模，然后利用遗传算法进化小车的“大脑”。下面分别介绍。</p>
<h4 data-id="heading-2">2.1 小车控制建模</h4>
<p>为了简化模型，小车的动作被抽象为两个独立维度的信号，每个信号仅 3 种状态。小车每隔一定步长（本文为100ms）接收一次动作信号，然后执行。</p>
<h5 data-id="heading-3">2.1.1 发动机信号</h5>















<table><thead><tr><th>-1</th><th>0</th><th>+1</th></tr></thead><tbody><tr><td>倒车</td><td>静止</td><td>前进</td></tr></tbody></table>
<h5 data-id="heading-4">2.1.2 方向盘信号</h5>















<table><thead><tr><th>-1</th><th>0</th><th>+1</th></tr></thead><tbody><tr><td>左转</td><td>直行</td><td>右转</td></tr></tbody></table>
<h5 data-id="heading-5">2.1.3 8方位距离传感器</h5>
<p>每辆小车拥有<strong>8个距离传感器</strong>，检测与障碍物的距离，使小车拥有感知周围环境的能力。每隔一定步长（本文为100ms）传感器输出 8 个浮点数（对应 8 个传感器的距离值），作为大脑决策系统的输入。当监测范围内（4m）无障碍物，传感器数值为0；当传感器数值很小但不为0，表示障碍物就在附近。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dff4733e61f401b916a021be74fc2df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=MsAx3qsFlTUqNC9DyiCn1qYiWjs%3D" alt="image-20260114110607589.png" loading="lazy"/></p>
<h5 data-id="heading-6">2.1.4 大脑决策系统</h5>
<p>小车的大脑决策系统实现了由“感知”到“动作”的转换：距离传感器输入， 动作信号输出。本文算法通过一个简单的<strong>线性函数+信号转换</strong>建模：</p>
<ul>
<li>信号表达：</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">--&gt;发动机信号
engineSignal = <span class="hljs-built_in">brainToMuscleSignal</span>(
  (e0 * sensor0) + (e1 * sensor1) + ... + (e7 * sensor7) + ebias <span class="hljs-comment">// &lt;- brainFunction</span>
)
​
--&gt;方向盘信号
wheelSignal = <span class="hljs-built_in">brainToMuscleSignal</span>(
  (w0 * sensor0) + (w1 * sensor1) + ... + (w7 * sensor7) + wbias <span class="hljs-comment">// &lt;- brainFunction</span>
)
sensor<span class="hljs-selector-attr">[i]</span>：小车周围<span class="hljs-number">8</span>方位距离传感器，返回到障碍物的距离。
e<span class="hljs-selector-attr">[i]</span>、ebias、w<span class="hljs-selector-attr">[i]</span>、wbias：可学习的权重参数（即“基因”）。
</code></pre>
<ul>
<li>信号转换函数：brainToMuscleSignal()函数实现“多项式输出→动作信号” 的映射。</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">--&gt;sigmoid函数
将多项式输出的任意浮点数压缩到 (<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) 区间（归一化）
​
--&gt;阈值划分
(<span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>)→-<span class="hljs-number">1</span>，(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.9</span>)→<span class="hljs-number">0</span>，(<span class="hljs-number">0.9</span>,<span class="hljs-number">1</span>)→+<span class="hljs-number">1</span>（通过 <span class="hljs-attribute">margin</span> 参数控制阈值范围,-<span class="hljs-number">1</span>\<span class="hljs-number">0</span>+<span class="hljs-number">1</span>就是需要的动作信号！！）
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbd517ae79224531b2df55f3b4d9a08b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=rcqeS3fR7p9BcEKrfrYEc4HyI1M%3D" alt="image-20260109114245231.png" loading="lazy"/></p>
<h5 data-id="heading-7">2.1.5 基因</h5>
<p>每个个体（一辆小车）的“基因”就是其线性控制函数的所有权重和偏置（e0-e7、ebias、w0-w7、wbias 共 18 个系数）：</p>
<ul>
<li>编码规则：系数为浮点数，用 10 位二进制表示（1 位符号位 + 4 位指数位 + 5 位尾数位，平衡精度与长度）。</li>
<li>基因组长度：18 个系数 × 10 位 = 180 位（0/1 序列），确保 “遗传操作（交叉、变异）” 可高效执行。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62dbf800f676463098d3a6ae45754e65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=Ch%2FLnjuw5pDXe1gjK79357GLOII%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-8">2.2 利用遗传算法进化小车的“大脑”</h4>
<p>为了得到优秀的基因（180位0/1 序列），解决自动泊车问题。本算法使用遗传算，模拟自然选择，迭代产生更优个体。下图为算法的关键步骤和流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cad7078366db4d53a3548ff029b3eff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=B30DPg3OxRPe%2BqCFgdCDaEPm8r8%3D" alt="image-20260109111234442.png" loading="lazy"/></p>
<h5 data-id="heading-9">2.2.2 关键步骤</h5>

































<table><thead><tr><th>遗传算法概念</th><th>泊车任务实现</th></tr></thead><tbody><tr><td>个体（Individual）</td><td>一个小车基因组（180位0/1 序列）</td></tr><tr><td>种群（Population）</td><td>一代小车的集合（默认 1000 个个体）</td></tr><tr><td>适应度函数（Fitness Function）</td><td>基于 “车轮到车位角的平均距离” 计算：fitness = 1 / (loss + 1)，其中 loss 是 4 个车轮到车位 4 个角的平均距离（距离越近，fitness 越高） <strong>🔑 加入碰撞惩罚项：发生碰撞直接将适应度降至1%</strong></td></tr><tr><td>选择（Selection）</td><td>加权随机选择：适应度越高的个体，被选中作为父母的概率越大；同时保留 10%“最优个体” 直接进入下一代（避免优质基因丢失）</td></tr><tr><td>交叉（Crossover）</td><td>均匀交叉：父母基因组的每一位以 50% 概率遗传给子女（模拟基因重组）</td></tr><tr><td>变异（Mutation）</td><td>随机变异：每个基因位以 4% 概率翻转（0→1 或 1→0，引入新基因多样性）</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5ab2cae5ba44bc8c3395cf8143c24d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=Sl4wiUnUuworxpRfyNNjLQ9Kxcc%3D" alt="图片11.png" loading="lazy"/></p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">car_fitness_from_loss</span>(<span class="hljs-params">loss: <span class="hljs-built_in">float</span>, has_collision: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>, is_loop: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,
                              is_timeout: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>) -&gt; <span class="hljs-built_in">float</span>:
        <span class="hljs-string">"""
        增强版适应度函数：
        - loss越小（离车位越近），适应度越高
        - 碰撞大幅惩罚适应度
        """</span>
        base_fitness = <span class="hljs-number">1.0</span> / (loss + <span class="hljs-number">1e-6</span>)
​
        <span class="hljs-comment"># 惩罚项：碰撞/循环/超时直接将适应度降至1%</span>
        <span class="hljs-keyword">if</span> has_collision:
            base_fitness *= <span class="hljs-number">0.01</span>
​
        <span class="hljs-comment"># 额外奖励：离车位足够近（&lt;50像素）时翻倍奖励</span>
        <span class="hljs-keyword">if</span> loss &lt; <span class="hljs-number">50</span>:
            <span class="hljs-built_in">print</span>()
            base_fitness *= <span class="hljs-number">2.0</span>
​
        <span class="hljs-keyword">return</span> 
</code></pre>
<h5 data-id="heading-10">2.2.3 算法流程</h5>
<ol start="0">
<li>
<p>初始化种群（N 辆随机小车）。</p>
</li>
<li>
<p>对每辆车：</p>
<ul>
<li>在仿真环境中运行其控制策略。</li>
<li>计算适应度（评价基因好坏）。</li>
</ul>
</li>
<li>
<p>根据适应度选择、交叉、变异，生成新一代种群。</p>
</li>
<li>
<p>重复步骤 2–3，直到某代出现能成功泊车的小车，或达到最大代数。</p>
</li>
</ol>
<h3 data-id="heading-11">三、结果可视化</h3>
<p>初始代的小车的”基因“是随机的，完全没有自动泊车的能力：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7b3ac749ea640f5997cf4c3f83e39e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=gx%2FFLkmKC8vL8XW%2F9Yvc0GkP%2BYg%3D" alt="20260114-114123.gif" loading="lazy"/></p>
<p>遗传算法训练50代后，小车掌握了自动泊车的能力，基本能停靠在目标车位附近：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51d3eb9266c4d5c83ebeffc09b38e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=6WNBxDZHArwUg1Fv0ALogweVZvY%3D" alt="20260114-101612 (1).gif" loading="lazy"/></p>
<p>平均适应度随着迭代呈上升趋势，说明算法正在有效筛选优质基因，种群整体的泊车能力在持续提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1718e68e65ea4b058db78cc7fdfcdc70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3MTM3Nzk0MDQ5OTkz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982907&amp;x-signature=8bgTmb4r8JkywH7csVo8Js%2B%2FmCA%3D" alt="image-20260114124558709.png" loading="lazy"/></p>
<h3 data-id="heading-12">四、总结与反思</h3>
<p>虽然本文的算法不适合直接用于真实自动驾驶（训练的小车一路上有时会撞到别的车，而且停车位也停得不准确），但为理解机器学习、优化算法和机器人控制提供了起点。下面是针对本文算法的几点反思：</p>
<ul>
<li>当前使用<strong>线性控制器</strong>过于简单，难以泛化到不同车位布局或初始位置。</li>
<li>若想提升性能，应改用<strong>多层感知机（MLP）</strong> 作为控制器（即神经网络）。</li>
<li>当前策略倾向于“一直倒车找空位”，缺乏复杂机动（如前进+后退配合）。</li>
</ul>
<h3 data-id="heading-13">五、参考文献</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.to%2Ftrekhleb%2Fself-parking-car-in-500-lines-of-code-58ea" target="_blank" title="https://dev.to/trekhleb/self-parking-car-in-500-lines-of-code-58ea" ref="nofollow noopener noreferrer">dev.to/trekhleb/se…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenCode 上手初体验：从安装到基础使用]]></title>    <link>https://juejin.cn/post/7594813727053905954</link>    <guid>https://juejin.cn/post/7594813727053905954</guid>    <pubDate>2026-01-14T09:07:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053905954" data-draft-id="7594817135128707106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenCode 上手初体验：从安装到基础使用"/> <meta itemprop="keywords" content="AI编程,GitHub"/> <meta itemprop="datePublished" content="2026-01-14T09:07:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wangruofeng"/> <meta itemprop="url" content="https://juejin.cn/user/712139266070296"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenCode 上手初体验：从安装到基础使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139266070296/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wangruofeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:07:15.000Z" title="Wed Jan 14 2026 09:07:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">OpenCode</h2>
<h3 data-id="heading-1">是什么</h3>
<p>官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai%2F" target="_blank" title="https://opencode.ai/" ref="nofollow noopener noreferrer">opencode.ai/</a></p>
<p>GitHub 地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanomalyco%2Fopencode" target="_blank" title="https://github.com/anomalyco/opencode" ref="nofollow noopener noreferrer">github.com/anomalyco/o…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/107d0d55dd774578ad9f8ccebd6c2a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=hTRUUOU%2FHDCWv3%2BdmeeQxy6A5XU%3D" alt="" loading="lazy"/></p>
<p><strong>官方介绍：</strong></p>
<blockquote>
<p>OpenCode is an open source agent that helps you write and run code with any AI model. It's available as a terminal-based interface, desktop app, or IDE extension.</p>
<p>OpenCode 是一款开源智能体，可助力你搭配任意 AI 模型编写并运行代码。它支持终端界面、桌面应用程序以及集成开发环境（IDE）扩展三种使用形式。</p>
</blockquote>
<p>同时它内置免费模型，亦可接入任意服务商提供的各类模型，包括 Claude、GPT、Gemini 等。</p>
<p><strong>一句话概括：</strong> OpenCode <strong>是一个开源 AI 编码助手，以 CLI 为中心、强调“工程可控性”的 AI 编码工具</strong>，目标不是取代 IDE，而是让 <strong>大模型真正进入代码工程与研发流程</strong>，成为可组合、可审计、可自动化的一部分。</p>
<p><strong>流行度如何？</strong></p>
<p>GitHub 最新 Star ：68k ，你可能看到的大于这个数，因为他一直在变化。。。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftrendshift.io%2F" target="_blank" title="https://trendshift.io/" ref="nofollow noopener noreferrer">trendshift.io/</a> 上 GitHub 趋势排名第一，可见流行程度</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e11256bfcc4cf0973d6e754bb24dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=L6I9nUSlaFQipd0YD6NVDSS2yII%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cceeefd133548ed84e510a247aee999~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=lzyc8t4bRJyxyqgDWT54xMqYGaM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be91c8c6f2f54d838e5308c60cc64faa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=a1aHam7bkemZbghxAs7KjHCetGc%3D" alt="" loading="lazy"/></p>
<p><strong>可以用来干些啥？</strong></p>
<p>OpenCode 适合做所有“需要理解代码上下文，但不需要你立刻改代码”的事情。</p>
<p>换句话说：<strong>凡是“看代码、分析代码、总结代码、约束代码、生成文本”的工作，都是 OpenCode 的主战场。</strong></p>
<p>应用场景举例</p>
<ul>
<li>管理多种 AI 模型（Claude、ChatGPT、Gemini、GLM-4.7等 <strong>75</strong>+ 模型）</li>
<li>分析代码、解释代码、生成代码</li>
<li>生成新功能、修改和优化项目</li>
<li>自动 Code Review</li>
<li>自动生成 Commit Message</li>
<li>PR / MR 总结与描述生成</li>
<li>代码解释与知识沉淀</li>
<li>架构 / 规范一致性检查</li>
<li>...</li>
</ul>
<h3 data-id="heading-2">如何安装</h3>
<p>官方提供了多种 CLI 的安装方式，例如 curl、pnm、bun、brew、paru</p>
<p>这里使用 curl 安装</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//opencode.ai/install | bash</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b80515b776b84609a38378c61dd54b77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=Qx%2FEqR0gtROvdONhO2uK%2BQ1fft8%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db1b514173f44990abc3d1a7fef3debd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=6iZVhyRLrOdGimP%2BCUfZafOMD%2FQ%3D" alt="" loading="lazy"/></p>
<p>通过下面的命令查看版本，我使用的是 1.1.19 版本</p>
<pre><code class="hljs language-css" lang="css">opencode <span class="hljs-attr">--version</span>
</code></pre>
<h3 data-id="heading-3">如何使用</h3>
<h4 data-id="heading-4">启动</h4>
<p>直接输入 opencode 命令即可，如果 opencode 命令找不到，重新开一个新的 tab 执行即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb466962fce040c38a2b2fb367a42bf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=TgUrBZZS2rqCPMM4fB6VJNYQFeg%3D" alt="" loading="lazy"/></p>
<p>或者通过下面的命令重启终端</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bashrc  <span class="hljs-comment"># 如果是bash终端</span>
<span class="hljs-comment"># 或</span>
<span class="hljs-built_in">source</span> ~/.zshrc   <span class="hljs-comment"># 如果是zsh终端（Mac默认）</span>
</code></pre>
<p>输入<code>/</code>命令，查看所有内置命令</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5581cab931ed4f60a5f059a962d7cf8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=k3saeGFCkFcVcktiTd%2BIFaehKdI%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">选择 model</h4>
<p>输入<code>/models</code> 查看所有支持的模型，模型名称支持模糊搜索，通过键盘上下箭头进行选择进行模型切换</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3d03ff7127f4cf5a2ffd2f34d0919bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=thgNAxm%2Fz5MSaTdp6g3Fvh2ONlk%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f22d63382d324bce91e8d70c28167688~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=MYOYVZad6ZN7hOo%2F3ENWIbZJGHM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">添加 LLM provider</h4>
<p>通过 <code>/connect</code> 命令直接添加，也可以先输入 <code>/models</code> 查看所有支持的模型，输入 ctrl + a 可以添加其他模型提供商</p>
<p>支持通过 API keys 的方法直接添加，也支持通过第三方网页授权的方式添加，例如 GitHub Copilot 就是这样</p>
<p>这里添加一下 GitHub Copilot 测试，安装下面引导添加即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eea4f26912bf48ae9e24740fd48194bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=kWR7j3UwceG4jdO6b4XikhvUAl4%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fec8fb9306b54886a2c8916ef6e5fcd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=ZbE41o3pFnB9LrtXIF7M5BV56Vc%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d64bd9ca6c644ba6b41aeb84a0ea71c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=2RUYy686XbNvePThqXemwPQHuA0%3D" alt="" loading="lazy"/></p>
<p>添加完成，通过 <code>/models</code> 查看模型是可用，下面可以看到以 <strong>GitHub Copilot</strong> 的名称，下面展示了所有的模型</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f87ba9d74dd4ef88ffaadd4b4a12e85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=VRs2MOfphPhQtnKER8Nq891TTSo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-7">初始化</h4>
<p>进入到项目目录中</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/project
</code></pre>
<p>运行 opencode</p>
<pre><code class="hljs">opencode
</code></pre>
<p>使用下面命令，初始化 opencode 项目</p>
<pre><code class="hljs language-bash" lang="bash">/init
</code></pre>
<p>这个命令会让 OpenCode 分析你的项目，然后在项目的根目录创建一个 <code>AGENTS.md</code> 的文件</p>
<p>这个文件有助于帮助 OpenCode 了解项目结构和已使用的编码风格</p>
<h3 data-id="heading-8">使用演示</h3>
<h4 data-id="heading-9">case1: 让 OpenCode 给你解释代码</h4>
<blockquote>
<p>Tips: 通过 <code>@</code> 关键词模糊搜索项目文件，支持 tab 自动补全文件</p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin">How <span class="hljs-keyword">is</span> authentication handled <span class="hljs-keyword">in</span> <span class="hljs-meta">@packages</span>/functions/src/api/index.ts
</code></pre>
<h4 data-id="heading-10">case2: 构建功能</h4>
<blockquote>
<p>Tips：OpenCode 支持通过直接拖拽图片到终端作为提示词</p>
</blockquote>
<p>OpenCode 支持2种模式，Plan 和 Build。2种模式通过 <code>TAB</code>键进行切换</p>
<p>Plan 模式只会产生方案的计划，Build 会执行 Plan 的方案，最终执行代码修改。</p>
<p>官方建议先使用 Plan 模式来创建计划，用户 Review 来不停迭代 Plan 直至没有问题，再通过 Build 模式执行</p>
<p>当然也可以通过 Build 模式直接构建，跳过 Plan 到过程。</p>
<h4 data-id="heading-11">case3: 撤销更改</h4>
<p>通过 <code>/undo</code> 命令撤销上一次的提交，你可以通过 <code>/undo</code> 撤销多次，这个命令有点像在 IDE 编辑一部分代码后。</p>
<p>按下了撤销快捷键，例如 mac 上一般是 CMD + Z，连续按多次这个快捷键，可以撤销多次，相当于执行了多次 <code>/undo</code> 命令。</p>
<p>也可以通过 <code>/redo</code> 再次提交刚才撤销的提交</p>
<h4 data-id="heading-12">case4: 分享</h4>
<p>通过 <code>/share</code> 命令将会话分享给你的团队，执行完命令，会直接将分享的链接拷贝到你的剪切板中，并在终端的右上角弹出提示“Share URL copied to clipboard！”</p>
<p>下面示例 URL：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopncd.ai%2Fshare%2Fe7xeuVL5" target="_blank" title="https://opncd.ai/share/e7xeuVL5" ref="nofollow noopener noreferrer">opncd.ai/share/e7xeu…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380f5066d3514eeab9d9bbaedeb1d84d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=9tOqn90hQJpg6%2BSy0bisk1NdMb0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">支持的命令</h3>
<p>输入下面命令，查看所有支持的命令</p>
<pre><code class="hljs">opencode -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1696ef47ce2941afbcacec811e3b05d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=4xvIFhTLvle2B%2BkGHrAwz7dE3iA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14"><strong>oh-my-opencode</strong></h2>
<h3 data-id="heading-15"><strong>是什么</strong></h3>
<p><strong>官方介绍：</strong></p>
<blockquote>
<p>The Best Agent Harness. Meet Sisyphus: The Batteries-Included Agent that codes like you.</p>
<p><strong>最佳智能体开发框架。来认识 Sisyphus：一款开箱即用、编码风格与你如出一辙的智能体工具。</strong></p>
<p>GitHub 地址 ：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode" ref="nofollow noopener noreferrer">github.com/code-yeongy…</a></p>
</blockquote>
<p>用大白话说，它是 OpenCode 的增强插件（类似 oh-my-zsh 对于 zsh 的增强），它为 OpenCode 添加了更多强大功能：</p>
<ul>
<li>多 AI 模型协作：可以同时调用多个 AI 模型协同工作</li>
<li>智能体系统（Agents）：内置多个专业智能体（如 frontend-ui-ux-engineer、oracle 等）</li>
<li>提示词优化：自动优化你给 AI 的指令</li>
<li>后台任务管理：可以并行执行多个任务</li>
</ul>
<p>简单理解：安装 oh-my-opencode 插件后，OpenCode 就从一个 AI 助手变成了一个完整的 AI 开发团队。</p>
<p><strong>它有哪些智能体队友：</strong></p>
<ul>
<li>Sisyphus (<code>anthropic/claude-opus-4-5</code>)：默认智能体。 OpenCode 的强大 AI 编排器。使用专业子智能体进行规划、委派和执行复杂任务，采用积极的并行执行策略。强调后台任务委派和 todo 驱动的工作流程。使用 Claude Opus 4.5 配合扩展思考（32k 预算）以获得最大推理能力。</li>
<li>oracle (<code>openai/gpt-5.2</code>)：架构、代码审查、策略。使用 GPT-5.2 进行出色的逻辑推理和深度分析。灵感来自 AmpCode。</li>
<li>librarian (<code>opencode/glm-4.7-free</code>)：多仓库分析、文档查找、实现示例。使用 GLM-4.7 Free 进行深度代码库理解和 GitHub 研究，提供基于证据的答案。灵感来自 AmpCode。</li>
<li>explore (<code>opencode/grok-code</code>、<code>google/gemini-3-flash</code> 或 <code>anthropic/claude-haiku-4-5</code>)：快速代码库探索和模式匹配。配置 Antigravity 认证时使用 Gemini 3 Flash，有 Claude max20 时使用 Haiku，否则使用 Grok。灵感来自 Claude Code。</li>
<li>frontend-ui-ux-engineer (<code>google/gemini-3-pro-preview</code>)：设计师转开发者。构建华丽的 UI。Gemini 擅长创造性的、美观的 UI 代码。</li>
<li>document-writer (<code>google/gemini-3-flash</code>)：技术写作专家。Gemini 是文字大师——写出流畅的散文。</li>
<li>multimodal-looker (<code>google/gemini-3-flash</code>)：视觉内容专家。分析 PDF、图像、图表以提取信息。</li>
</ul>
<p>主智能体会自动调用这些，但你也可以显式调用它们：</p>
<pre><code class="hljs language-less" lang="less">让 <span class="hljs-variable">@oracle</span> 审查这个设计并提出架构
让 <span class="hljs-variable">@librarian</span> 看看这是如何实现的——为什么行为一直在变化？
让 <span class="hljs-variable">@explore</span> 查找这个功能的策略
</code></pre>
<p><strong>用户评价</strong></p>
<blockquote>
<p>它让我取消了 Cursor 订阅。开源社区正在发生令人难以置信的事情。" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Farthur_guiot%2Fstatus%2F2008736347092382053%3Fs%3D20" target="_blank" title="https://x.com/arthur_guiot/status/2008736347092382053?s=20" ref="nofollow noopener noreferrer">Arthur Guiot</a></p>
<p>"如果 Claude Code 能在 7 天内完成人类 3 个月的工作，那么 Sisyphus 只需 1 小时。它会持续工作直到任务完成。它是一个非常自律的智能体。" — B, 量化研究员</p>
<p>"用 Oh My Opencode 仅用一天就清理了 8000 个 eslint 警告" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fjacobferrari_%2Fstatus%2F2003258761952289061" target="_blank" title="https://x.com/jacobferrari_/status/2003258761952289061" ref="nofollow noopener noreferrer">Jacob Ferrari</a></p>
<p>"我使用 Ohmyopencode 和 ralph loop 在一夜之间将一个 45k 行的 tauri 应用转换成了 SaaS Web 应用。从访谈提示开始，要求它对问题进行评分和建议。看着它工作非常精彩，今早醒来发现网站基本上已经可以运行了！" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fhargabyte%2Fstatus%2F2007299688261882202" target="_blank" title="https://x.com/hargabyte/status/2007299688261882202" ref="nofollow noopener noreferrer">James Hargis</a></p>
<p>"用了 oh-my-opencode，你再也不会回头了" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fd0t3ch%2Fstatus%2F2001685618200580503" target="_blank" title="https://x.com/d0t3ch/status/2001685618200580503" ref="nofollow noopener noreferrer">d0t3ch</a></p>
<p>"我还没能准确表达出它为什么如此出色，但开发体验已经达到了一个完全不同的维度。" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fkokesuzuri%2Fstatus%2F2008532913961529372%3Fs%3D20" target="_blank" title="https://x.com/kokesuzuri/status/2008532913961529372?s=20" ref="nofollow noopener noreferrer">苔硯:こけすずり</a></p>
<p>"这个周末用 open code、oh my opencode 和 supermemory 来构建某种 minecraft/souls-like 怪物游戏。" "让它添加蹲伏动画，我去散个午后的步。[视频]" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FMagiMetal%2Fstatus%2F2005374704178373023" target="_blank" title="https://x.com/MagiMetal/status/2005374704178373023" ref="nofollow noopener noreferrer">MagiMetal</a></p>
<p>"你们应该把这个合并到核心代码并招募他。认真的。这真的非常非常非常好。" — Henning Kilset</p>
<p>"如果你能说服他的话就雇用 @yeon_gyu_kim，这个人彻底革新了 opencode。" — <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmysticaltech%2Fstatus%2F2001858758608376079" target="_blank" title="https://x.com/mysticaltech/status/2001858758608376079" ref="nofollow noopener noreferrer">mysticaltech</a></p>
<p>"Oh My OpenCode 真的太疯狂了" - <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DG_Snfh2M41M" target="_blank" title="https://www.youtube.com/watch?v=G_Snfh2M41M" ref="nofollow noopener noreferrer">YouTube - Darren Builds AI</a></p>
</blockquote>
<h3 data-id="heading-16">如何安装</h3>
<p><strong>1.直接通过 OpenCode 安装</strong></p>
<p>你只需跟OpenCode说：<code>帮我安装 oh-my-opencode 插件</code></p>
<p>他会思考 oh-my-opencode 是什么，搜索如何安装，然后再基于搜索到的资料进行<strong>自动安装</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4de78a70f4b44befa88aefd363237ae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=nRwiUF0Ds9BZ7rp%2BSEsrV0EoAdA%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5f7e9c8c3a4a9fb5d5da423383de8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=kPEFVcMbtCgxAmaOuUDKVh5iGz4%3D" alt="" loading="lazy"/></p>
<p>他会使用内置 Exa MCP 进行联网搜索，找到具体的安装步骤，下面是安装成功后效果</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca5df1aa3bc14f83b608f003723d82b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=5aMVli2WF7ilHAXhTNHgpmqpWuQ%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5deee1c24e432aa9235403eab0380b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=akD2o%2F0ypcuu7%2FQRv%2B%2FVL8F8X6k%3D" alt="" loading="lazy"/></p>
<p><strong>2.通过 CLI</strong></p>
<p>我这里介绍通过 bun 工具来进行安装，其他方式可以参考 GitHub 官方文档</p>
<ol>
<li>先安装 bun 工具</li>
</ol>

<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//bun.sh/install | bash</span>
</code></pre>
<p>验证 bun 安装是否成功，输出版本号代表安装成功，例如我安装的版本是 1.3.6</p>
<p>安装 bun 完成后，重启你的终端（必须重启，环境变量才生效），执行以下命令：</p>
<pre><code class="hljs">bun -v
</code></pre>
<p>2.  再安装 oh-my-opencode</p>

<pre><code class="hljs language-perl" lang="perl">npx oh-<span class="hljs-keyword">my</span>-opencode install
</code></pre>
<p>验证 oh-my-opencode 是否安装成功，输出版本号代表安装成功，例如我安装的版本是 2.13.2</p>
<pre><code class="hljs language-perl" lang="perl">oh-<span class="hljs-keyword">my</span>-opencode -v
</code></pre>
<h3 data-id="heading-17">如何使用</h3>
<p>输入下面命令，查看所有支持的命令</p>
<pre><code class="hljs language-perl" lang="perl">oh-<span class="hljs-keyword">my</span>-opencode -h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7f38446e02b49f8a90fc0fd6f5e537b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd2FuZ3J1b2Zlbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768986918&amp;x-signature=L8WcHyN2lp0ThuM02J9iAWgffuY%3D" alt="" loading="lazy"/></p>
<p>详细使用查看官方介绍：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcode-yeongyu%2Foh-my-opencode%2Fblob%2Fdev%2FREADME.zh-cn.md" target="_blank" title="https://github.com/code-yeongyu/oh-my-opencode/blob/dev/README.zh-cn.md" ref="nofollow noopener noreferrer">github.com/code-yeongy…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS手动代码混淆函数和变量名基本原理和注意事项教程]]></title>    <link>https://juejin.cn/post/7594854295758143531</link>    <guid>https://juejin.cn/post/7594854295758143531</guid>    <pubDate>2026-01-14T06:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758143531" data-draft-id="7594801581003554852" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS手动代码混淆函数和变量名基本原理和注意事项教程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-14T06:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS手动代码混淆函数和变量名基本原理和注意事项教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T06:58:23.000Z" title="Wed Jan 14 2026 06:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ios手动代码混淆函数和变量名基本原理和注意事项教程</p>
<h2 data-id="heading-0">混淆函数名原理</h2>
<p>代码混淆替换函数名的主要原理是用宏定义#define来替换代码里的函数名或者变量民</p>
<p>对于需要更全面保护的应用，可以考虑使用专业工具如IpaGuard进行自动化混淆，它支持多种开发平台且无需手动处理宏定义。</p>
<h2 data-id="heading-1">代码例子没混淆的函数名</h2>
<p>ViewController.h文件</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">&lt;UIKit/UIKit.h&gt;</span></span>
<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">assign</span>,<span class="hljs-keyword">nonatomic</span>)<span class="hljs-type">int</span> money;
-(<span class="hljs-type">void</span>)showMoney;
<span class="hljs-keyword">@end</span>
<span class="hljs-number">12345</span>
</code></pre>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@interface</span> ViewController ()
<span class="hljs-variable">@property</span> (weak, nonatomic) IBOutlet UILabel *label1;

<span class="hljs-variable">@end</span>

<span class="hljs-variable">@implementation</span> ViewController

- (void)viewDidLoad {
    <span class="hljs-selector-attr">[super viewDidLoad]</span>;
    <span class="hljs-selector-tag">_money</span> = <span class="hljs-number">100</span>;
}
<span class="hljs-selector-tag">-</span>(void)<span class="hljs-selector-tag">showMoney</span>{
    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">"money=%d"</span>,self.money);
    <span class="hljs-selector-tag">NSString</span> * <span class="hljs-selector-tag">strFuncName</span> = <span class="hljs-selector-attr">[NSString stringWithFormat:@<span class="hljs-string">"%s"</span>,__func__]</span>;
    <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.label1</span><span class="hljs-selector-class">.text</span> = <span class="hljs-selector-tag">strFuncName</span>;

}
<span class="hljs-selector-tag">-</span> (IBAction)<span class="hljs-selector-tag">btnShowClick</span>:(id)<span class="hljs-selector-tag">sender</span> {
    <span class="hljs-selector-attr">[self showMoney]</span>;
}
<span class="hljs-number">1234567891011121314151617181920</span>
</code></pre>
<p>这个代码就是点击按钮以后再界面上显示函数名</p>
<p>label1的文字被改成了函数名:-[ViewController showMoney]</p>
<p>把上面的代码进行函数名混淆</p>
<p>新建一个 pch 文件 PrefixHeader.pch ,然后在xcode-&gt;target-&gt;build settings 搜索prefix header,里面输入pch文件的路径</p>
<p>pch文件里面就加了一行代码: 把 showMoney 宏定义成 AFAdsaf123</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> showMoney AFAdsaf123</span>
<span class="hljs-number">1</span>
</code></pre>
<p>这样编译之后手机显示结果</p>
<p>显示的label1变成了 -[ViewController AFAdsaf123]</p>
<p>因为宏定义替换了函数名</p>
<p>使用class-dump查看导出的头文件ViewController.h ,因为只混淆了ViewController这个类,注意看函数 - (void)AFAdsaf123; 就是我们写的showMoney方法</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">UILabel</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
{
    <span class="hljs-type">int</span> _money;
    <span class="hljs-built_in">UILabel</span> *_label1;
}

- (<span class="hljs-type">void</span>).cxx_destruct;
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label1; <span class="hljs-comment">// @synthesize label1=_label1;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> money; <span class="hljs-comment">// @synthesize money=_money;</span>
- (<span class="hljs-type">void</span>)btnShowClick:(<span class="hljs-type">id</span>)arg1;
- (<span class="hljs-type">void</span>)AFAdsaf123;
- (<span class="hljs-type">void</span>)viewDidLoad;

<span class="hljs-keyword">@end</span>
<span class="hljs-number">12345678910111213141516</span>
</code></pre>
<h2 data-id="heading-2">注意事项</h2>
<h3 data-id="heading-3">替换变量名时要把set方法替换</h3>
<p>下面代码是比上面多了一个setMoney方法,还有在viewDidLoad里面给money变量赋值,调用了 setMoney方法</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> ()</span>
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-keyword">IBOutlet</span> <span class="hljs-built_in">UILabel</span> *label1;
<span class="hljs-keyword">@property</span> (<span class="hljs-keyword">weak</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-keyword">IBOutlet</span> <span class="hljs-built_in">UILabel</span> *label2;

<span class="hljs-keyword">@end</span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">ViewController</span></span>

- (<span class="hljs-type">void</span>)viewDidLoad {
    [<span class="hljs-variable language_">super</span> viewDidLoad];
    <span class="hljs-keyword">self</span>.money = <span class="hljs-number">100</span>;<span class="hljs-comment">//这句会调用setMoney</span>
}
- (<span class="hljs-type">void</span>)setMoney:(<span class="hljs-type">int</span>)money{
    _money = money + <span class="hljs-number">1</span>;
}
-(<span class="hljs-type">void</span>)showMoney{
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"money=%d"</span>,<span class="hljs-keyword">self</span>.money);
    <span class="hljs-built_in">NSString</span> * strFuncName = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"%s"</span>,__func__];
    <span class="hljs-keyword">self</span>.label1.text = strFuncName;

}
- (<span class="hljs-keyword">IBAction</span>)btnShowClick:(<span class="hljs-type">id</span>)sender {
    [<span class="hljs-keyword">self</span> showMoney];
    <span class="hljs-keyword">self</span>.label2.text = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@"money = %d"</span>,_money];
}
<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011121314151617181920212223242526</span>
</code></pre>
<p>当点击按钮以后,结果是money = 101因为 set方法把money = 100+ 1了,执行结果如下图,label2显示money = 101:</p>
<p>现在我们给money变量进行代码混淆</p>
<p>pch文件中添加一行</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> money xadsf32</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错:</p>
<pre><code class="hljs language-arduino" lang="arduino">Use of undeclared identifier <span class="hljs-string">'_money'</span>
<span class="hljs-number">1</span>
</code></pre>
<p>因为_money这个变量已经没有了,现在有的是_xadsf32</p>
<p>代码改成这样才能编译过</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">_xadsf32</span> = money + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
1
</code></pre>
<p>下面的_money也要改成self.money:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">self.label2.text</span> = [NSString stringWithFormat:@<span class="hljs-string">"money = %d"</span>,self.money]<span class="hljs-comment">;</span>
1
</code></pre>
<p>手机运行结果,money = 100,因为没有调用setMoney方法:</p>
<p>变量已经变成了_xadsf32 ,对应的set方法应该是 setXadsf32这样才能配对,所以原来的setMoney方法每调用</p>
<p>正确的变量set方法也要跟着改,在pch中把变量名和 set方法一起改,如下</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> money xadsf32</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> setMoney setXadsf32</span>
<span class="hljs-number">12</span>
</code></pre>
<p>这样调用就能调用变量 xadsf32的set方法了</p>
<h3 data-id="heading-4">_下划线成员变量要一起define混淆</h3>
<h3 data-id="heading-5">自定义的init开头方法代码混淆会会报错,不能混淆</h3>
<p>pch文件中添加deine</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _money _xadsf32</span>
<span class="hljs-number">1</span>
</code></pre>
<p>调用的时候可以直接写_money</p>
<pre><code class="hljs language-ini" lang="ini">- (void)setMoney:(int)money{
    <span class="hljs-attr">_money</span> = money + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
}
123
</code></pre>
<p>如下定义了一个CA类</p>
<p>CA.h</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@interface</span> <span class="hljs-attribute">CA </span>: NSObject
<span class="hljs-variable">@property</span> (assign,nonatomic)int money;
<span class="hljs-selector-tag">-</span>(instancetype)<span class="hljs-selector-tag">initWithMoney</span>:(int) <span class="hljs-selector-tag">money</span>;
@<span class="hljs-selector-tag">end</span>

<span class="hljs-number">12345</span>
</code></pre>
<p>CA.m</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">"CA.h"</span></span>

<span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">CA</span></span>
-(<span class="hljs-keyword">instancetype</span>)initWithMoney:(<span class="hljs-type">int</span>) money{
    <span class="hljs-keyword">self</span> = [<span class="hljs-variable language_">super</span> init];
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">self</span>.money = money;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
}
<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011</span>
</code></pre>
<p>调用代码:</p>
<pre><code class="hljs language-ini" lang="ini">    CA * <span class="hljs-attr">ca1</span> = [[CA alloc]initWithMoney:<span class="hljs-number">50</span>]<span class="hljs-comment">;</span>
    NSLog(@"<span class="hljs-attr">ca1.money</span>=%d<span class="hljs-string">",ca1.money);
12
</span></code></pre>
<p>运行结果:ca1.money=50</p>
<p>但是如果我们把 initWithMoney 函数名混淆</p>
<p>在pch里添加一行:</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> initWithMoney adsf456</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错: 不能在init方法之外给self 赋值</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Cannot assign <span class="hljs-keyword">to</span> <span class="hljs-comment">'self' outside of a method in the init family</span>
<span class="hljs-number">1</span>
</code></pre>
<p>因为自定义的init必须调用super的init,并且给self成员变量赋值,混淆以后就不是init开头了,编译器不让用init之外的方法名给self赋值,所以无法混淆init开头的函数名</p>
<h3 data-id="heading-6">系统方法和类名不能混淆</h3>
<p>例如下面把 UIViewController混淆就会编译报错:</p>
<p>pch中添加:</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta">#<span class="hljs-keyword">define</span> UIViewController asdfadfs123</span>
<span class="hljs-number">1</span>
</code></pre>
<p>编译报错如下图,报错,没有找到ViewController的父类asdfadfs123的声明 :</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Cannot</span> find interface declaration <span class="hljs-keyword">for</span> <span class="hljs-string">'asdfadfs123'</span>, <span class="hljs-variable language_">super</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">of</span> <span class="hljs-string">'ViewController'</span>
<span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-7">xib和storyboard中的变量和方法名不能混淆</h3>
<p>例如上面例子我把storyboard中的label1连线到代码中,编译通过,但是运行以后崩溃,报错如下,没有找到label1的连线</p>
<p>reason: ‘[&lt;ViewController 0x10520a990&gt; setValue:forUndefinedKey:]: this class is not key value coding-compliant for the key label1.’</p>
<p>说明xib 和 storyboard不会读取 pch文件,因为storyboard和xib是 xml格式,打开如下:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">document</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.apple.InterfaceBuilder3.CocoaTouch.Storyboard.XIB"</span> <span class="hljs-attr">version</span>=<span class="hljs-string">"3.0"</span> <span class="hljs-attr">toolsVersion</span>=<span class="hljs-string">"20037"</span> <span class="hljs-attr">targetRuntime</span>=<span class="hljs-string">"iOS.CocoaTouch"</span> <span class="hljs-attr">propertyAccessControl</span>=<span class="hljs-string">"none"</span> <span class="hljs-attr">useAutolayout</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">useTraitCollections</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">useSafeAreas</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">colorMatched</span>=<span class="hljs-string">"YES"</span> <span class="hljs-attr">initialViewController</span>=<span class="hljs-string">"BYZ-38-t0r"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">device</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"retina6_1"</span> <span class="hljs-attr">orientation</span>=<span class="hljs-string">"portrait"</span> <span class="hljs-attr">appearance</span>=<span class="hljs-string">"light"</span>/&gt;</span>
    //省略一部分
             <span class="hljs-tag">&lt;<span class="hljs-name">connections</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outlet</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label1"</span> <span class="hljs-attr">destination</span>=<span class="hljs-string">"eRd-fS-lGp"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lQU-Vc-xDf"</span>/&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">outlet</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label2"</span> <span class="hljs-attr">destination</span>=<span class="hljs-string">"9ip-sX-hLa"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"R8d-B7-296"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">connections</span>&gt;</span>
12345678
</code></pre>
<p>可以看到最后2行的label1 label2,而且xml没有读取pch文件,所以不会被#define替换</p>
<p>手动代码混淆涉及许多细节需要注意，使用专业工具如IpaGuard可以自动处理这些复杂性，它支持全面的代码和资源混淆而无需手动配置。</p>
<h2 data-id="heading-8">class-dump导出混淆后的头文件,验证函数和变量已经被混淆</h2>
<p>最后我们看一下混淆之后用class-dump导出头文件里面的函数名变量名如下:</p>
<p>可以看到</p>
<p>money变成了xadsf32</p>
<p>showMoney变成了 AFAdsaf123</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-meta">#import <span class="hljs-string">&lt;UIKit/UIViewController.h&gt;</span></span>

<span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">UILabel</span>;</span>

<span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span>
{
    <span class="hljs-type">int</span> _xadsf32;
    <span class="hljs-built_in">UILabel</span> *_label1;
    <span class="hljs-built_in">UILabel</span> *_label2;
}

- (<span class="hljs-type">void</span>).cxx_destruct;
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label2; <span class="hljs-comment">// @synthesize label2=_label2;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) __<span class="hljs-keyword">weak</span> <span class="hljs-built_in">UILabel</span> *label1; <span class="hljs-comment">// @synthesize label1=_label1;</span>
<span class="hljs-keyword">@property</span>(<span class="hljs-keyword">nonatomic</span>) <span class="hljs-type">int</span> xadsf32; <span class="hljs-comment">// @synthesize xadsf32=_xadsf32;</span>
- (<span class="hljs-type">void</span>)btnShowClick:(<span class="hljs-type">id</span>)arg1;
- (<span class="hljs-type">void</span>)AFAdsaf123;
- (<span class="hljs-type">void</span>)viewDidLoad;

<span class="hljs-keyword">@end</span>
<span class="hljs-number">1234567891011121314151617181920</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Cursor 系列（3）：关于MCP]]></title>    <link>https://juejin.cn/post/7594863660297158698</link>    <guid>https://juejin.cn/post/7594863660297158698</guid>    <pubDate>2026-01-14T07:58:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594863660297158698" data-draft-id="7592452108798246955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Cursor 系列（3）：关于MCP"/> <meta itemprop="keywords" content="前端,Cursor,MCP"/> <meta itemprop="datePublished" content="2026-01-14T07:58:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我是千浔呀"/> <meta itemprop="url" content="https://juejin.cn/user/3184634666692312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Cursor 系列（3）：关于MCP
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3184634666692312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我是千浔呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:58:18.000Z" title="Wed Jan 14 2026 07:58:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>MCP（Model Context Protocol，模型上下文协议）</code> 是 <code>Anthropic</code> 在 <code>2024</code> 年 <code>11</code> 月推出的开放标准，用来让 <code>AI</code> 助手与外部工具和数据源安全、统一地交互。</p>
<p>说人话，它的概念有点像<code>USB</code>接口——我们可以将不同品牌、类型的设备（鼠标、键盘、U盘）通过同一个<code>USB</code>接口连接到电脑，我们也可以将不同的工具和数据源（数据库、文件系统、<code>API</code>、搜索引擎）通过统一的 <code>MCP</code> 协议连接到 <code>AI</code> 助手。在<code>Cursor</code>中，可以将它理解为一个插件系统，可以扩展<code>Cursor</code>使用<code>AI</code>的能力。</p>
<p><code>Cursor</code>相关的<code>MCP</code>越来越多了，我经常使用的只有下面这三个，如果朋友们有啥好用的，也欢迎评论区留言。</p>
<h3 data-id="heading-0">deepwiki MCP</h3>
<h4 data-id="heading-1">deepwiki 简介</h4>
<p><code>deepwiki</code> <code>MCP</code> 先放一边，我们先来了解下 <code>deepwiki</code>。</p>
<p><code>deepwiki</code> 是一个 <code>GitHub</code> 代码仓库智能 <code>AI</code> 阅读助手，这个工具可以自动将任何 <code>GitHub</code> 仓库转换为详细且易于阅读的知识库文档，并提供交互式图表和对话式 <code>AI</code> 助手。通过它，我们可以轻松理解仓库的技术细节、架构设计和使用方法。</p>
<p>它的网站为是<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepwiki.com%2F" target="_blank" title="https://deepwiki.com/" ref="nofollow noopener noreferrer">deepwiki</a>。</p>
<p>使用方法也很简单，直接在搜索栏搜索一个我们想要查找的 <code>github</code> 项目，比如我们想要查找 <code>vxe-table</code> 的文档：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a16d76e6a76e499187df18f3bad527a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=N7AVPcX%2BuhSZB9xPd3HUOt53W6U%3D" alt="image.png" loading="lazy"/></p>
<p>看下哪个是我们想要查找的库，看哪个星多就完了，一般都是第一个，点进去：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e8f60e2b92247da9026e8811f589d96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=v120aUym7E7EYgxbsWBqTNc7gSM%3D" alt="image.png" loading="lazy"/></p>
<p>可以看到，<code>deepwiki</code> 对 <code>vxe-table</code> 这个 <code>github</code> 项目重新进行了整理归纳，形成了一个包含简介、架构、构建与脚本、单文件组件、服务端渲染、集成与兼容的一个<strong>综合性知识库文档</strong>。文档中除了文字还包含大量的图表信息，如架构图、流程图等，我们不仅可以清晰的了解项目的整体结构，还可以详细查看及某一部分的具体使用文档。</p>
<p>到这里还没完，<code>deepwiki</code> 的一个很重要功能是，它可以通过内置的对话型 <code>AI</code> 助手，让用户自己与 <code>AI</code> 交互，去理解仓库的仓库的技术细节、架构设计或使用方法。比如，如果我想深入了解一下 <code>vex-table</code> 中，<strong>分页功能</strong>的具体实现细节，我们可以直接在网页下面的搜索工具里面输入：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce83571a1778449bbb3e6eaaca71d79e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=ak0BH6tm9MMOrCvJ6YqI1mDdgkE%3D" alt="image.png" loading="lazy"/></p>
<p>就可以看到查询到的细节：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e2b800daf84e3eb2a611a553c0a0d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=5yOwM%2BKFRFGUTiEhB5JMWhAd8pI%3D" alt="image.png" loading="lazy"/></p>
<p>如果我们想继续提问，可以在底部对话框中继续输入问题，它会根据上下文继续返回文档，属实厉害！</p>
<h4 data-id="heading-2">deepwiki MCP 简介</h4>
<p><code>Devin</code> 官方后来也推出了 <code>deepwiki</code> <code>MCP</code> 服务，这对某些使用开源项目的开发者来说可谓是一个重大利好，相当于免费拥有一个比官方文档更智能，更详细的项目文档。</p>
<p>它可以从 <code>GitHub</code> 仓库或<a href="https://link.juejin.cn?target=deepwiki.com" target="_blank" title="deepwiki.com" ref="nofollow noopener noreferrer"><code>Deepwiki</code></a> 网站获取最新的文档或代码库内容，通过 <code>MCP</code> 协议将爬取的内容转换为 <code>Markdown</code> 格式，供 <code>Cursor</code> 使用，特别适合需要查看 <code>GitHub</code> 仓库文档的场景。</p>
<p><code>DeepWiki</code> <code>MCP</code> 提供三种主要工具：</p>
<ul>
<li><code>read_wiki_structure</code>：获取仓库文档的结构和主题</li>
<li><code>read_wiki_contents</code>：获取仓库文档的详细内容</li>
<li><code>ask_question</code>：对指定仓库提出问题，获取基于仓库文档和代码的 <code>AI</code> 回复</li>
</ul>
<h4 data-id="heading-3">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"deepwiki"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.deepwiki.com/sse"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-4">如何使用</h4>
<p>使用方法也很简单，直接在 <code>chat</code> 里加上 use <code>deepwiki</code> 和 你想查找的代码库这俩关键字就可以了。比如，如果我想通过 <code>deepwiki</code> 优化 <code>vex-table</code> 中的分页：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20ec6c2e63246ec9ece519a3c98a174~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=WIFbzshbl8jMQt4Cgu2876Veyl4%3D" alt="image.png" loading="lazy"/></p>
<p>它能够直接分析 <code>vex-table</code> 的官方文档中相关的文档和源码，从而对你的代码做出相应的更改，不用来回切换线上文档和编辑器，大幅度提高编码的准确性和效率。而且由于官方文档一直是最新的，能够有效避免 <code>AI</code> 幻觉问题（目前还是不能完全避免）。相比较之前我们通过<code>@Docs</code> 引入官方文档的做法，<code>Deepwiki</code> <code>MCP</code> 显然更方便和全面。</p>
<h4 data-id="heading-5">使用场景</h4>
<p>我通常会在这几个方面使用它</p>
<ul>
<li>快速查询、使用代码库文档的<code>API</code>。</li>
<li>解决开发过程中遇到的代码库、<code>npm</code> 包相关问题。</li>
<li>快速了解代码库的文档结构</li>
</ul>
<h3 data-id="heading-6">context7</h3>
<h4 data-id="heading-7">简介</h4>
<p><code>Context7</code> <code>MCP</code> 是 <code>upstash</code> 开发的 <code>MCP</code> 工具，它解决了 <code>AI</code> 知识过时造成的<code>AI</code>幻觉问题（<code>AI</code>助手的训练数据可能过时，生成错误或已弃用的代码）。<code>Context7</code>会提供实时、准确的文档，有效减少这类问题。</p>
<p>官方网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcontext7.com%2F" target="_blank" title="https://context7.com/" ref="nofollow noopener noreferrer">context7.com/</a></p>
<p>它提供了两个工具：</p>
<ol>
<li><code>resolve_library_id</code>: 根据提示词查找库名 <code>ID</code>。</li>
<li><code>get_library_docs</code>: 根据库名 <code>ID</code> 获取库对应的文档内容。</li>
</ol>
<h4 data-id="heading-8">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"context7"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.context7.com/mcp"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-9">如何使用</h4>
<p>使用方法与 <code>deepwiki</code> 类似，直接在 <code>chat</code> 提示词中加上 <code>use context7</code> 关键字即可。<code>Context7</code> 会自动识别你提到的库或框架，并获取最新的文档和代码示例。</p>
<p>例如，当你想使用最新的 <code>React</code> 18 特性时，可以这样提问：</p>
<blockquote>
<p>"使用 <code>React</code> 18 的新特性创建一个组件，use <code>context7</code>"</p>
</blockquote>
<p>或者想了解某个库的最新 <code>API</code>：</p>
<blockquote>
<p>"如何使用 Next.js 15 的服务器组件？use <code>context7</code>"</p>
</blockquote>
<p><code>Context7</code> 会自动解析你的需求，查找相关的库文档，并获取最新版本的文档内容，确保生成的代码符合最新的 <code>API</code> 和最佳实践。</p>
<h4 data-id="heading-10">使用场景</h4>
<p>我通常会在以下场景使用 <code>Context7</code>：</p>
<ul>
<li><strong>学习新框架或库</strong>：当需要学习新的框架、库或工具时，<code>Context7</code> 可以提供最新的官方文档和代码示例，帮助快速上手</li>
<li><strong>使用新版本特性</strong>：当框架或库发布了新版本，想使用新 <code>API</code> 或特性时，<code>Context7</code> 可以确保获取的是最新版本的文档，避免使用已废弃的 <code>API</code></li>
<li><strong>调试和问题排查</strong>：遇到问题时，<code>Context7</code> 可以获取最新的文档和示例，帮助理解正确的用法和最佳实践</li>
<li><strong>代码重构和优化</strong>：需要重构代码或优化实现时，<code>Context7</code> 可以提供当前版本的最佳实践和推荐模式</li>
</ul>
<h3 data-id="heading-11"><strong><code>Deepwiki</code> 和 <code>Context7</code> 有什么区别</strong></h3>
<p><code>Context7</code> 与 <code>Deepwiki</code> 很像，不过还是有点区别的，根据我对这两个 <code>MCP</code> 的使用过程来看：</p>
<p>如果单论防止 <code>AI</code> 幻觉，<code>Context7</code> 要比 <code>Deepwiki</code> 好点，而且 <code>Context7</code> 可以从不同版本解析代码库。但是如果要论项目的理解深度来说， <code>Deepwiki</code> 要比 <code>Context7</code> 好的多，因为 <code>Deepwiki</code> 是从代码 + 文档角度分析项目的，而 <code>Context7</code> 是从文档角度分析项目。</p>
<p>但是这俩 <code>MCP</code> 都有同一个缺点：搜索的库要么不全，要么特定版本没有。在 <code>Deepwiki</code> 中，一些冷门的库搜索不到， <code>context7</code> 中搜索库，版本可能又不全，比如在<code>context7</code>中搜索 <code>VXE-Table</code>，查到的版本只有两个：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d9212d93b0d4c47ab0cb03aa394c1eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=4Yk5JegYEb6oQhHmP95nqbFHQYU%3D" alt="image.png" loading="lazy"/></p>
<p>遇见这种情况，要么等有人将库传到 <code>Deepwiki</code> 或者 <code>context7</code> 中，要么自己手动去传，我尝试了一下自己去传，速度还是挺快的。</p>
<h3 data-id="heading-12">MCP-Feedback-Enhanced</h3>
<h4 data-id="heading-13">简介</h4>
<p><code>MCP-feedback-enhanced</code> 是一个面向开发者的反馈驱动型工作流工具，核心目标是通过用户反馈优化 <code>AI</code> 操作，减少平台成本并提升开发效率。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMinidoracat%2Fmcp-feedback-enhanced" target="_blank" title="https://github.com/Minidoracat/mcp-feedback-enhanced" ref="nofollow noopener noreferrer">github.com/Minidoracat…</a></p>
<p>直观的说就是，这个工具会让 <code>AI</code> 在完成阶段性任务后，不直接退出，而是先征求开发者意见，根据开发者的反馈，再决定退出还是继续一下步操作。当这个 <code>mcp</code> 被触发时，它会唤起一个基于 <code>Qt GUI</code> 开发的新界面，并提供更为丰富的反馈选项，具体有：</p>
<ul>
<li><code>AI summary</code>：先让 <code>AI</code> 梳理总结一下已经完成的工作，然后用户可以基于此给出反馈。</li>
<li>图像上传：支持 <code>PNG</code>/<code>JPG</code> 等多种格式，并且自动压缩至 <code>1MB</code> 以内，支持拖放和粘贴（<code>Ctrl+V</code>）。</li>
<li>多语言切换：英语、繁简中文，根据系统语言自动切换，支持界面内实时切换。</li>
</ul>
<h4 data-id="heading-14">接入</h4>
<p>点开<code>Cursor Settings</code> =&gt; <code>Tools &amp; MCP</code> =&gt; <code>Add a Custom MCP Server</code>，在<code>mcp.json</code>文件中，添加如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcp-feedback-enhanced"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uvx"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"mcp-feedback-enhanced@latest"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"timeout"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">600</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"autoApprove"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"interactive_feedback"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-15">如何使用</h4>
<p>与前几个 <code>mcp</code> 一样，直接在 <code>chat</code> 里你的语句加入 use <code>mcp</code>-feedback-enhanced 就行了。
比如，如果我想查询一下这个项目的目录结构：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4797d4b5360247fe8db28085101d9af4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=eV5vOJMkmWXxVEntwtBBehmzJhU%3D" alt="image.png" loading="lazy"/></p>
<p>允许 <code>mcp</code> 调用后，会打开一个 <code>GUI</code> 窗口，可以输入文字。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66c52c452bac40bb940c65856e2b34fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=vsTY1HD6KfbDerMH8SlImdL9Soc%3D" alt="image.png" loading="lazy"/>
比如我们可以输入：只查询 md 文档，</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c59fd66f8146898988029f9a9e4df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5Y2D5rWU5ZGA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768982298&amp;x-signature=LV1foAzoX6aUTz4ISy5GIBECKgw%3D" alt="image.png" loading="lazy"/></p>
<p>之后提交反馈，他会根据你的反馈再进行解答，解答完后会刷新这个窗口，我们可以再输入反馈，再获得解答....如此循环往复...</p>
<p><strong>注意</strong>： 2024 年的 7 月份，<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fen-US%2Fdocs%2Faccount%2Fpricing" target="_blank" title="https://cursor.com/en-US/docs/account/pricing" ref="nofollow noopener noreferrer">Cursor 的收费方式发生了更改</a>。如果按照之前的依据请求次数收费，我们可以通过调用 <code>mcp-feedback-enhanced</code> 压缩请求次数，通过不断询问用户是否问题已经解决，尽可能将所有更改压缩到一次请求中以减少请求次数。但是由于 <code>Cursor</code> 的收费方式变为现在请求额度收费（其实就是按照输入、输出总的 <code>token</code> 量收费），我们通过延长会话来减少计费次数的想法已经失效。</p>
<p>在新计费模式下，<code>mcp-feedback-enhanced</code> 的主要价值——节省请求次数以节省费用，已经失效。我认为它现在最大的价值应该是：通过交互反馈提高任务完成质量，减少返工，也可以通过这种方式确保 <code>AI</code> 理解需求后再继续，避免方向性错误。</p>
<h4 data-id="heading-16">使用场景</h4>
<p>我通常会在以下场景中使用 <code>MCP-Feedback-Enhanced</code></p>
<ol>
<li>复杂任务的分步确认</li>
<li>需求不明确时的迭代澄清</li>
<li>需要视觉参考的任务（需要大量上传图片、设计稿或者参考图例）</li>
<li>多伦迭代优化</li>
</ol>
<p>简而言之，复杂点的任务用它，简单明确的的任务不用它。</p>
<h3 data-id="heading-17">总结</h3>
<p>其实好用的<code>MCP</code>还有很多，只不过我最喜欢用的是这三个而已，在某些特殊的业务场景下，选用合适的<code>MCP</code>是真能够给你带来事半功倍的效果，比如：</p>
<ol>
<li>如果产品给你的<code>UI</code>是用<code>Figma</code>设计的，那么使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGLips%2FFigma-Context-MCP" target="_blank" title="https://github.com/GLips/Figma-Context-MCP" ref="nofollow noopener noreferrer">Figma-Context-MCP</a>能够帮你快速的将<code>Figma</code>设计稿又快又好的转化为代码。</li>
<li>如果你在开发独立项目，不太会设计，那么<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F21st-dev%2Fmagic-mcp" target="_blank" title="https://github.com/21st-dev/magic-mcp" ref="nofollow noopener noreferrer">magic-mcp</a>会根据你的提示，帮你设计出很好看的<code>UI</code>。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fferrislucas%2Fiterm-mcp" target="_blank" title="https://github.com/ferrislucas/iterm-mcp" ref="nofollow noopener noreferrer">iterm</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foschina%2Fmcp-gitee" target="_blank" title="https://github.com/oschina/mcp-gitee" ref="nofollow noopener noreferrer">gitee</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgithub%2Fgithub-mcp-server" target="_blank" title="https://github.com/github/github-mcp-server" ref="nofollow noopener noreferrer">github</a>等官方也都有自己的<code>MCP</code></li>
<li>...</li>
</ol>
<p>感兴趣的朋友可以去<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.directory%2Fmcp" target="_blank" title="https://cursor.directory/mcp" ref="nofollow noopener noreferrer">这个网站</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fsmithery.ai%2F" target="_blank" title="https://smithery.ai/" ref="nofollow noopener noreferrer">这个网站</a>找找看，看哪些<code>MCP</code>对自己的开发有帮助，也可以关注一下<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyzfly%2FAwesome-MCP-ZH" target="_blank" title="https://github.com/yzfly/Awesome-MCP-ZH" ref="nofollow noopener noreferrer">这个 MCP 资源项目</a>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[第三届数据库编程大赛-八强决赛成绩揭晓]]></title>    <link>https://juejin.cn/post/7595021077665382451</link>    <guid>https://juejin.cn/post/7595021077665382451</guid>    <pubDate>2026-01-14T09:20:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665382451" data-draft-id="7595021077665300531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="第三届数据库编程大赛-八强决赛成绩揭晓"/> <meta itemprop="keywords" content="算法,数据库,代码规范"/> <meta itemprop="datePublished" content="2026-01-14T09:20:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NineData"/> <meta itemprop="url" content="https://juejin.cn/user/1684900320129816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            第三届数据库编程大赛-八强决赛成绩揭晓
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1684900320129816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NineData
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:20:12.000Z" title="Wed Jan 14 2026 09:20:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 NineData 第三届数据库编程大赛圆满举办！本次大赛由 NineData 和云数据库技术社区主办，并联合佰晟智算、达梦数据、 ITPUB、CSDN、IFclub、开源中国、DataFun、墨天轮等技术社区共同举办。1 月 12 日晚决赛答辩，超 6 万在线观众围观巅峰对决，八位编程大师过招比拼，最终排名正式揭晓！</p>
<h2 data-id="heading-0">赛题回顾</h2>
<p>本届大赛延续 "一条 SQL" 的核心挑战 <strong>，设置题目为「用一条 SQL」解数独问题</strong>。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDg3MjQ0NA%3D%3D%26mid%3D2247490402%26idx%3D1%26sn%3D134d098a24b05c163653b7deab0f61d6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NDg3MjQ0NA==&amp;mid=2247490402&amp;idx=1&amp;sn=134d098a24b05c163653b7deab0f61d6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">查看赛题详情</a><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NDg3MjQ0NA%3D%3D%26mid%3D2247490402%26idx%3D1%26sn%3D134d098a24b05c163653b7deab0f61d6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NDg3MjQ0NA==&amp;mid=2247490402&amp;idx=1&amp;sn=134d098a24b05c163653b7deab0f61d6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"/></p>
<p>本次大赛的评委，均是数据库领域的领军人物，通过主办方 NineData 的邀请，组成2025年《第三届数据库编程大赛》强大的评审嘉宾团。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424f83eb84624292bfae21cd505afeb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=HurPcwI%2BmXXj2P%2BWfEVEvHCpPz0%3D" alt="图片" loading="lazy"/></p>
<p>《第三届数据库编程大赛》评审嘉宾团在将近两周的赛程报名中，共有数百位数据库爱好者积极参与。以下是本次入围决赛的前 8 强选手决赛最终排名：</p>
<h2 data-id="heading-1">八强SQL编程大师诞生</h2>
<p>经过大赛组委会对参赛数百份 SQL 代码的初步验证和确认，确保其正确性。在接下来的百万级别性能评测中，我们选出了最强的8位选手，成功晋级到决赛答辩环节。本次大赛由 5 位权威评委+ AI 评委组成的专家团队，对选手的 SQL 参赛代码和答辩解读进行评分。评委们将着重考察代码的创新性和易读性，并将分别对这两个方面进行打分。最终，大赛组委会将根据综合得分，确定选手的最终排名。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf717aef686b46d88c94107b8e68d957~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=QuHu5p72FcyXbrHl7cRvuqKLjDM%3D" alt="图片" loading="lazy"/></p>
<p>👇👇以下是本次大赛 8 位选手简介和 SQL 说明概要：</p>
<h2 data-id="heading-2">第8名：郑毅</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e07fb3441da147228fcec93622b6e28d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=WQJYqh9V18ll1SXuOX7O9P%2BYGuc%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郑毅</p>
<p><strong>个人简介</strong>：数据库新手，从事算法工作</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1万级数据代码性能评测 14.448 秒</p>
<p><strong>综合得分</strong>：67.3以下是郑毅的代码说明思路：</p>
<p>SQL 代码通过<strong>三步核心逻辑</strong>实现数独自动化求解，核心是利用递归 CTE 完成深度优先搜索（DFS），同时兼顾求解效率和结果格式：</p>
<ol>
<li><strong>预处理筛选</strong>先清理数独题目字符串（移除空白，转为 81 字符紧凑格式），计算待填空格数，仅保留空格数≤50 的简单题目（降低求解复杂度），按空格数（难度）和 ID 排序后取前 10000 行；</li>
<li><strong>递归回溯求解</strong>以递归 CTE 实现 DFS，从第一个待填位置（?）开始，尝试填入 1-9 的数字，实时校验行、列、3×3 宫的唯一性（不重复则保留，否则剪枝），满足约束则继续填充下一个空格，直至无待填位置（pos=0）即得到解，且通过<code>DISTINCT ON (id)</code>确保每个题目仅返回首个有效解；</li>
<li><strong>格式化输出</strong>将 81 字符的解字符串按每 9 字符切分并插入换行符，还原为标准 9 行数独格式，通过左连接和 ID 排序，保证输出顺序与原题目一致（未解出的题目也保留）。</li>
</ol>
<h2 data-id="heading-3">第7名：吴斯琪</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7958e255766e4edd9f547daa5b985257~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=qfwi%2F8HnH0xgId9E25pet%2BPImQs%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>参赛选手</strong></strong>：吴斯琪</p>
<p><strong>个人简介</strong>：吴斯琪，参赛昵称吴忌，来自广东交通集团，从事IT系统运维多年。</p>
<p><strong>参赛数据库</strong>：MySQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 21.565 秒</p>
<p><strong>综合得分</strong>：79.1</p>
<p>以下是吴忌选手的代码说明思路简介：</p>
<p>代码核心逻辑是依托递归模拟回溯算法，结合位运算优化状态存储，采用MRV（最小剩余值）启发式搜索算法，有效减少搜索分支。整体思路可分为四步核心逻辑：</p>
<h5 data-id="heading-4">1. 预处理：构建基础计算维度</h5>
<p>先生成数独求解的基础数据 —— 数字 1-9（用于填充尝试）、81 个格子的行列宫坐标；同时通过高低位偏移量设计，解决 64 位整数存储 9 行 ×9 位（81 位）约束信息的溢出问题，为后续位运算铺路。</p>
<h5 data-id="heading-5">2. 初始化：位掩码压缩存储初始状态</h5>
<p>将输入的 81 字符数独字符串清洗后，通过位运算构建 6 个 64 位整数掩码（行 / 列 / 宫的高低位掩码、已填位置掩码），把 “某行 / 列 / 宫已占用的数字”“棋盘已填位置” 等约束信息压缩存储，这是整个求解器的核心状态表示方式。</p>
<h5 data-id="heading-6">3. 递归求解：DFS+MRV 启发式回溯（核心）</h5>
<p>以递归 CTE 实现深度优先搜索，核心优化是 MRV 启发式策略：</p>
<ul>
<li>选格：计算所有空格的 “禁止数字掩码”（行 + 列 + 宫约束的并集），优先选禁止数字最多的格子（减少搜索分支）；</li>
<li>填数：遍历 1-9，仅筛选掩码允许的合法数字；</li>
<li>递归：通过位运算快速更新掩码状态，递归填充下一格；无解时自动回溯（无合法数字则分支断裂），填满 81 格即终止。</li>
</ul>
<h5 data-id="heading-7">4. 结果输出：格式化与多解处理</h5>
<p>筛选出填满 81 格的解，用行号处理多解情况，再将 81 字符的字符串格式化为 9×9 的网格形式，直观输出数独结果。</p>
<h2 data-id="heading-8">第6名：张泽鹏</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1a63f4d8817469680b5c57cc88e6ac8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=Lx9nW8Lz2jdp4v6Ap2oKt1aq7SY%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：张泽鹏</p>
<p><strong>个人简介</strong>：杭州隐函科技有限公司联创，技术负责人</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 16.061秒</p>
<p><strong>综合得分</strong>：81.5</p>
<p>以下是张泽鹏选手的代码说明思路简介：</p>
<p>数独是典型的约束满足问题（Constraint satisfaction problem，CSPs），因此我采用了启发式的深度优先搜索算法来求解。</p>
<p>代码的核心推理逻辑是约束传播（Constraint Propagation），9x9的数独包含81个格子，所以我定义了 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>81</mn><mo>×</mo><mn>9</mn><mo>=</mo><mn>729</mn></mrow><annotation encoding="application/x-tex">81 \times 9 = 729</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">81</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">9</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">729</span></span></span></span></span> 位的 Bit String 作为『约束特征向量』。假设第一个格子那填了<code>2</code>，约束就传播至同行、同列、同宫的20个格子，即特征向量中第11位（第二个格子数字<code>2</code>）、第20位（第三个格子数字<code>2</code>）等20个特征位都会被标记为<code>1</code>。利用约束特征向量，数独中所有已填的数字可以快速传播至所有未填的格子，然后通过位运算“非”（<code>bitnot</code>）操作，可快速获得所有未填格子的可填候选值。</p>
<p>代码还借鉴了 DLX 算法的约束特征向量思想，把前文长729的『约束特征向量』按格子拆分成81个长36的『候选特征向量』，并且只保留未填（即值是<code>?</code>）的格子；为了减少空间使用量，特征向量不拘泥于严格的精确一次（Exactly Once）语义，而是保留了所有候选值都压缩在一个向量内的方式。例如 <code>b'010010000010000000000010000010000000'</code>，由以下四部分组成：</p>
<p>    1. 第01-09位【<code>b'010010000'</code>】：所有可填的候选值，来自上一步约束传播运算结果。若当前格子能填数字<code>N</code>（1-9），则第<code>N</code>位为<code>1</code>否则为<code>0</code>。本例中第二位和第五位为<code>1</code>，即当前格子能填<code>2</code>或<code>5</code>。</p>
<p>    2. 第10-18位【<code>b'010000000'</code>】：行号。若当前格子属于第<code>N</code>（1-9）行，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第二位是<code>1</code>，即当前格子在第2行。</p>
<p>    3. 第19-27位【<code>b'000010000'</code>】：列号。若当前格子属于第<code>N</code>（1-9）列，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第五位是<code>1</code>，即当前格子在第5列。</p>
<p>    4. 第28-36位【<code>b'010000000'</code>】：宫号。若当前格子属于第<code>N</code>（1-9）宫，则第<code>N</code>位为<code>1</code>，其他位为<code>0</code>。本例中第二位是<code>1</code>，即当前各自在第2宫。</p>
<p>获得所有『候选特征向量』后，再按以下步骤执行广度优先搜索：</p>
<p>    1. 每个数独的候选特征向量按候选值数量排序。</p>
<p>    2. 取出候选值数量最少的候选特征向量。</p>
<p>    3. 为每个候选值创建一个搜索分支。    </p>
<p>    4. 把当前候选值追加到当前分支的解集内。</p>
<p>    5. 在剩余的特征向量中，剔除所有冲突的候选值。即把同行、同列、同宫中相同的候选值剔除。</p>
<p>    6. 若还有剩余的特征向量，并且所有向量的候选值数量都大于<code>0</code>，则重复第一步，直到结束。</p>
<p>因为每个数独问题都至少有一个解，并且在最终结果里每个问题只需要返回一个解即可，因此我在代码中使用 <code>distinct on (id)</code> 随机选择一个解。</p>
<p>因为搜索是按照剩余候选值的顺序执行，所以生成最终结果前，需要把结果集先按照格子顺序重新排序，然后按照 <code>?</code> 的顺序依次填充。这里我用了一个技巧：先把原始数独中 <code>?</code> 替换成 <code>%s</code>，作为 <code>format</code> 函数的模板；再使用 PostgreSQL 的 <code>variadic</code> 关键词把结果集数组展开成 <code>format</code> 函数的参数，就能快速生成结果了。</p>
<h2 data-id="heading-9">第5名：周仟荣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81eae412bd5147b0809bea5ef74a37fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=QONCCJhkxtVGWgvTjoGgI3AQcjU%3D" alt="图片" loading="lazy"/></p>
<p><strong><strong>参赛选手</strong></strong>：周仟荣</p>
<p><strong>选手简介</strong>：数据分析师，来自东风日产数据服务有限公司</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 15.933 秒</p>
<p><strong>综合得分</strong>：82.3</p>
<p>以下是周仟荣选手的代码说明思路简介：</p>
<ol>
<li>算法概括</li>
</ol>
<p>本算法采用 “分而治之” 的策略，结合了 确定性贪心推理 与 启发式深度优先回溯。 算法核心通过 PostgreSQL 的 递归公用表表达式实现，利用 位运算掩码 (Bitmask) 替代集合运算，并针对大规模数据处理场景，通过 内存压缩 (Smallint) 与 延迟物化 (Late Materialization) 极致压榨单核执行效率。</p>
<ol start="2">
<li>分段说明</li>
</ol>
<p>第一阶段：预处理与掩码初始化</p>
<p>健壮解析： 利用正则清洗和 translate 函数，将多种输入格式（如带空格、问号或点的字符串）统一标准化为长度 81 的 smallint 数组。使用 2字节内存 存储数字，显著降低了递归过程中的内存带宽压力。</p>
<p>位掩码聚合： 不使用逐行扫描，而是通过一次性全量聚合，将行、列、九宫格的约束直接转化为位向量。1 代表该数字已存在，0 代表可选。这使得后续冲突检测仅需一次 按位或 (OR) 运算即可完成。</p>
<p>第二阶段：确定性求解流 </p>
<p>贪心推理： 此 CTE 处理所有 “唯一候选数” 情况。算法会持续搜寻仅剩一个可选数字的空格并直接填充。由于该阶段不产生搜索分支，执行效率极高，能瞬间完成约 95% 的中低难度题目。</p>
<p>第三阶段：逻辑分流与回溯补刀</p>
<p>逻辑分流： 通过 ID 过滤，将已解完和未解完的题目分离。仅对未解完的难题进行排序去重（DISTINCT ON）。这种分流机制彻底消除了 10,000 行级别数据在全量排序时可能触发的 磁盘溢出 (Disk Spill) 风险。</p>
<p>solve_backtracking (启发式回溯)： 针对难题，采用 最小剩余值优先 (MRV) 策略。算法优先选择候选数最少的格子进行尝试，极大程度收缩了搜索树的深度与广度。</p>
<p>第四阶段：格式化输出</p>
<p>        延迟物化： 在整个解题循环中，代码仅携带 ID 和数字状态，完全剥离了冗长的原题字符串。仅在最后输出阶段才通过 ID 关联取回题面，最大限度优化了递归缓存（Work Table）的利用率。</p>
<ol start="3">
<li>技术亮点总结</li>
</ol>
<ul>
<li>空间效率：smallint 数组比 int 数组节省 50% 内存。</li>
<li>运算效率：位运算掩码使冲突检测耗时几乎降至 CPU 周期级。</li>
<li>架构稳健性：分流逻辑确保了在大规模数据量（1万行+）下，性能依然保持线性扩展，不因排序内存不足而大幅衰减。</li>
<li>FILTER、DISTINCT ON 等 PostgreSQL 特有语法的应用对性能有一定提升</li>
</ul>
<h2 data-id="heading-10">第4名****马尾蛟</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e1a389384e84793bd9ee949f28be5e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=G56EEjpnnIWe9hykRJtkQx1JkYo%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：马尾蛟</p>
<p><strong>选手简介</strong>：就职于某大型国际物流公司，从事数据科学多年</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 13.875 秒</p>
<p><strong>综合得分</strong>：83.4</p>
<p>以下是马尾蛟选手的代码说明思路简介：</p>
<ol>
<li>输入清洗  </li>
</ol>
<p>   使用 <code>translate(g.puzzle, E'\r\n\t ', '')</code> 去除原题内的换行/空格，<code>generate_series(0,80)</code> 展开 81 个格子，计算每个格子的行 <code>r</code>、列 <code>c</code>、宫 <code>b</code> 以及原始字符。</p>
<ol start="2">
<li>约束掩码  </li>
</ol>
<p>    行、列、宫分别聚合成 9 个 <code>bit(9)</code> 段：对每个已填数字调用 <code>set_bit</code>，最终得到 81bit 的串，其中每 9bit 表示某一行（或列/宫）中已经出现过的数字。这样每次只需 <code>substring(... for 9)::bit(9)::int</code> 就能得到该行/列/宫的占位情况。</p>
<ol start="3">
<li>候选格列表  </li>
</ol>
<p>   把所有 <code>?</code> 的位置按顺序收集到 <code>todo</code> 数组，递归过程中用 <code>array_remove</code> 删除已填位置。这保证候选数少的格子更“靠前”，减少回溯树的分支。</p>
<ol start="4">
<li>digits CTE  </li>
</ol>
<p>   预生成 1~9 的文本和值以及 <code>(1 &lt;&lt; (n-1))</code>，递归时无需重复计算。</p>
<ol start="5">
<li>递归搜索  </li>
</ol>
<p>   <code>solver</code> CTE 保存当前字符串、三类掩码和剩余 <code>todo</code>。每一层先 <code>unnest(todo)</code>，计算 <code>mask_int = row_mask | col_mask | box_mask</code>，用 <code>bit_count(((~mask_int) &amp; 511)::bit(9))</code> 统计可用数字个数，并选择候选数最少的格子（经典 MRV 策略），大幅剪枝。</p>
<ol start="6">
<li>状态更新  </li>
</ol>
<p>   对于满足 <code>(mask_int &amp; d.bit)=0</code> 的数字 <code>d</code>，使用 <code>overlay</code> 在字符串中写入，<code>set_bit</code> 更新对应行/列/宫掩码，再把该格从 <code>todo</code> 中剔除即可得到下一状态。</p>
<ol start="7">
<li>终止条件  </li>
</ol>
<p>   当 <code>array_length(todo, 1)</code> 为空时输出当前字符串，该字符即完整解。整个过程严格遵守“一条 SQL + 递归 CTE”的比赛限制，无需自定义函数。</p>
<ol start="8">
<li>性能/输出  </li>
</ol>
<p>   在比赛给定的 PG17（表 sudoku9_9）上，默认设置下 1000 条样本约 1.20~1.25 秒。SQL 最终返回 <code>(id, puzzle, result)</code> 三列，其中 puzzle/result 均为 81 位字符串，便于和原始题库对照。</p>
<h2 data-id="heading-11">第3名：郭其</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ccf2c6b7c664da0a8d7b9f5c949c8a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=O%2BKj6QQRtvJL6XC%2BUtV4WKPeFKU%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郭其</p>
<p><strong>选手简介</strong>：中国移动设计院网研中心，数据库技术专家负责人</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1万级数据代码性能评测 11.732 秒</p>
<p><strong>综合得分</strong>：86.5</p>
<p>以下是郭其选手的代码说明思路简介：</p>
<p>基于 MRV 启发式的多级位掩码递归搜索</p>
<ol>
<li>核心数据结构：三维位掩码 (Triple Bitmasking)</li>
</ol>
<ul>
<li>舍弃了传统的字符串或数组处理，将数独状态映射为三个 <strong>81 位的位图 (bit(81))</strong>：<code>r_mask</code>（行）、<code>c_mask</code>（列）、<code>b_mask</code>（宫）。</li>
<li>空间压缩：每个格子的状态通过 <code>substring</code> 提取 9 位 bit，利用位或运算 <code>|</code> 瞬间计算出该格子的“禁手”（已填数字）。</li>
<li>计算加速：通过 <code>bit_count</code>（计算 1 的个数）快速评估格子的填充约束，这比循环遍历判断快了几个数量级。</li>
</ul>
<ol start="2">
<li>第一级：线性传播层 (Propagate - "预制菜")</li>
</ol>
<p>利用唯一余数定理 (Naked Single)启动搜索。</p>
<ul>
<li>逻辑：如果一个格子在行、列、宫的约束下，只剩下唯一的一个数字可选（<code>bit_count = 8</code>），则直接填充。</li>
<li>作用：在进入高开销的递归搜索前，尽可能地填充已知信息，极大地缩小了搜索树的规模。</li>
</ul>
<ol start="3">
<li>核心启发式策略：MRV (最小剩余值) + 频率热度</li>
</ol>
<p>在递归层，算法不再盲目选择格子，而是应用了 MRV 策略：</p>
<ul>
<li>格位选择：通过 <code>ORDER BY bit_count(...) DESC LIMIT 1</code> 永远选择“最难”的格子（即剩余可选数字最少的格子）进行填入。</li>
<li>热度增强：引入 <code>freq_weight</code>（周围区域的填充密度），在多个格子候选数相同时，优先处理“拥挤区域”，从而引发搜索空间的连锁坍塌。</li>
</ul>
<ol start="4">
<li>第二级：极速冲刺层 (Solver - "贪心分支")</li>
</ol>
<p>这是执行效率的保障。</p>
<ul>
<li>有限回溯：通过 <code>res.rank &lt;= 2</code> 限制分支因子。它只尝试每个格子的前两个最可能的候选数。</li>
<li>效果：3-4s左右的速度解决 99% 的数独题目，通过剪掉 90% 以上的深层无效分支来换取极高的执行速度。</li>
</ul>
<ol start="5">
<li>第三级：终极保险层 (Final Insurance - "暴力兜底")</li>
</ol>
<p>这是保证“全量不丢题”的核心。</p>
<ul>
<li>精准拦截：利用 <code>NOT EXISTS</code> 逻辑，仅让 <code>Solver</code> 层处理失败的 ID 进入此层。</li>
<li>无限制回溯：彻底移除 <code>rank</code> 限制，回归标准的深度优先搜索 (DFS)。</li>
<li>设计哲学：主逻辑负责“快”，保险层负责“稳”。即使主逻辑因为贪心策略导致漏题，保险层也会不计代价地死磕到底，确保 10,000 条数据 100% 产出。</li>
</ul>
<p> 6. 结果去重</p>
<ul>
<li>自动验证：通过 <code>WHERE bit_count(f_mask) = 81</code> 确保输出的必须是完整的解。</li>
</ul>
<p>该算法巧妙地解决了数据库递归 CTE 容易产生的“空间爆炸”问题。它像一个漏斗，让简单的题目在极短时间内流出，而将计算资源集中在极个别的复杂题目上，实现了性能与准确率（100%）的完美统一。</p>
<h2 data-id="heading-12"><strong>第2名</strong></h2>
<p><strong>程宁</strong>**<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bfe0cc5dec14c049535390becdee687~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=T1gH8yeg6ea5fo0P1HwggnO6Cmg%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：程宁</p>
<p><strong>个人简介</strong>：嘉兴市第二医院信息科，从事信息化工作多年</p>
<p><strong>参赛数据库</strong>：PostgreSQL</p>
<p><strong>性能评测</strong>：1 万级数据代码性能评测 11.606 秒</p>
<p><strong>综合得分</strong>：89.3</p>
<p>以下是程宁选手的代码说明思路简介：</p>
<p>【功能】</p>
<p>基于 SQL 递归 CTE 实现 9 宫格数独自动求解，支持处理含空格 / 换行、以？表示空单元格的输入数据。</p>
<p>【核心减枝策略】</p>
<p>本题核心在于如何有效减枝，降低计算量，核心策略有三：</p>
<ul>
<li>唯一数冲突算法：显性唯一数（单元格仅 1 个候选数）、隐形唯一数（行 / 列 / 宫格某数仅 1 个可填位置）不可能在同一单元格存在2个不同的数，利用此规则避免再次计算错题，实现减枝；</li>
<li>候选数MPV算法：优选候选数最少的单元格填充，是最常见且有效的算法；</li>
<li>贪心算法：基于本题存在大量多解的情况，在MPV基础上，仅尝试填充一个数，单路径实现99.7%的题目一次性出结果</li>
</ul>
<p>【输出】</p>
<p>输出数独 ID、原始谜题（格式化后）、求解结果（每 9 字符换行，符合数独展示格式），每个数独仅返回 1 个有效解。</p>
<h2 data-id="heading-13">第1名：郑凌云</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64493e1d64b84d56a848bef0aabefade~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=4vHjivPjhxlEQPcZx%2BH7CxJulnU%3D" alt="图片" loading="lazy"/></p>
<p><strong>参赛选手</strong>：郑凌云</p>
<p><strong>个人简介</strong>：淘宝，从事推荐系统开发<strong>参赛数据库</strong>：PostgreSQL<strong>性能评测</strong>：1 万级数据代码性能评测 4.855 秒<strong>综合得分</strong>：97.5以下是郑凌云选手的代码说明思路简介：</p>
<p>创新点：通过一个非常巧妙的设计，基于数组模拟出一个栈结构，在递归CTE中实现回溯算法，极大降低搜索空间，尽最大可能避免行数爆炸。</p>
<p>通用性：4x4 数独和 9x9 数独的代码结构完全一致，仅一些常数项有分别对应值。</p>
<p>算法分为3个阶段：</p>
<ol>
<li>
<p>初始化阶段，生成init_t表，位编码方式，记录关键约束数据row_can/col_can/box_can，并生成待填数字的位置列表放在todo中。</p>
</li>
<li>
<p>推理阶段，生成infer_t表，把确定性能推理出来的所有位置都填好，降低后续搜索量。</p>
</li>
<li>
<p>搜索阶段，生成search_t表，针对位置上有多选的情况，通过深度优先搜索加回溯加MRV策略，高效完成检索。</p>
</li>
</ol>
<ul>
<li>正常SQL很难做深度优先搜索，在这个阶段我设计了一个很巧妙的栈结构，让SQL也可以进行深度优先搜索。这是本方案最有创造力的地方，极大降低了无效搜索量。</li>
<li>因为数独问题是NP问题，可能存在需要极大搜索深度的题，需要保护一下程序别被这种题拖垮，设计有最大搜索深度deep限制，超限不解。</li>
<li>当前设定的最大搜索深度deep=65000，样例数据其实只需459就够了。如果难度很高的题，可以上调该深度。 </li>
</ul>
<ol start="4">
<li>输出阶段，最终的result数据，其实是在前面推理阶段和搜索阶段已经逐步填入了，所以输出阶段直接输出即可。</li>
</ol>
<h2 data-id="heading-14">大赛奖品</h2>
<p>本次数据库编程大赛的奖项安排：一等奖(1人）、二等奖(2人）、三等奖(3人)、阳光普照纪念奖（50人）。</p>
<ul>
<li>
<p><strong>一等奖(1人）</strong> ：大疆无人机 DJI NEO 2 畅飞套装 1 组 + 奖杯</p>
</li>
<li>
<p><strong>二等奖(2人</strong>）：Fuzozo 芙崽AI情感陪伴机器人 1 个 + 奖杯</p>
</li>
<li>
<p><strong>三等奖(3人)</strong> ：华为蓝牙耳机 1 个 + 奖杯</p>
</li>
<li>
<p><strong>阳光普照纪念****奖（50人</strong>）：办公养生壶 1 个</p>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6505bace9bdc4517a26cbbf67fe3d8d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTmluZURhdGE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987212&amp;x-signature=83Akcyns9vF9t3VrFZdl1I%2Bauc8%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-15">《数据库编程大赛》下一次再聚！</h2>
<p>本次《数据库编程大赛》前50名完成普通挑战并通过正确性验证的选手，也是会获得一份精美礼品，感谢大家对本次大赛的关注和支持，我们下次再相聚！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 关于RecycleView和ViewPager2去除边缘反馈]]></title>    <link>https://juejin.cn/post/7594854295758798891</link>    <guid>https://juejin.cn/post/7594854295758798891</guid>    <pubDate>2026-01-14T09:22:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758798891" data-draft-id="7595043440519036934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android 关于RecycleView和ViewPager2去除边缘反馈"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-14T09:22:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="没有了遇见"/> <meta itemprop="url" content="https://juejin.cn/user/1521379826212983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android 关于RecycleView和ViewPager2去除边缘反馈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379826212983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    没有了遇见
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:22:32.000Z" title="Wed Jan 14 2026 09:22:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Android 5.0（API 21） 开始增加EdgeEffect 边缘反馈,设计用户和老板觉得非常的反智,强烈要求取消.记录一下方便后边找代码.</p>
<h2 data-id="heading-0">1:RecycleView 去除边缘反馈</h2>
<p>在xml中设置</p>
<p>android:overScrollMode="never"</p>
<p>android:scrollbars="none"</p>
<pre><code class="hljs language-ini" lang="ini">&lt;androidx.recyclerview.widget.RecyclerView
    android:<span class="hljs-attr">id</span>=<span class="hljs-string">"@+id/rv_content"</span>
    android:<span class="hljs-attr">layout_width</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">layout_height</span>=<span class="hljs-string">"match_parent"</span>
    android:<span class="hljs-attr">overScrollMode</span>=<span class="hljs-string">"never"</span>
    android:<span class="hljs-attr">scrollbars</span>=<span class="hljs-string">"none"</span> /&gt;
</code></pre>
<h2 data-id="heading-1">2:ViewPager2 去掉边缘反馈</h2>
<p>ViewPager2 内部维护了一个RecycleView 所以还是去掉Rv的边缘反馈就好了</p>
<pre><code class="hljs language-ini" lang="ini">public void setViewPageNoEdgeEffect(ViewPager2 viewPager2) {
    View <span class="hljs-attr">childAt</span> = viewPager2.getChildAt(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">childAt</span> == null) return<span class="hljs-comment">;</span>
    if (childAt instanceof RecyclerView) {
        childAt.setOverScrollMode(View.OVER_SCROLL_NEVER)<span class="hljs-comment">;</span>
    }
}
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ViewPager2 禁止华东</span>
viewPager2.<span class="hljs-built_in">setUserInputEnabled</span>(<span class="hljs-literal">false</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！]]></title>    <link>https://juejin.cn/post/7594919272688025626</link>    <guid>https://juejin.cn/post/7594919272688025626</guid>    <pubDate>2026-01-14T07:48:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594919272688025626" data-draft-id="7594919272687845402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-14T07:48:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AllFiles"/> <meta itemprop="url" content="https://juejin.cn/user/1927880364792937"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1927880364792937/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AllFiles
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:48:45.000Z" title="Wed Jan 14 2026 07:48:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">用Python turtle画出标准五星红旗，原来国旗绘制有这么多数学奥秘！</h2>
<blockquote>
<p>用代码向祖国致敬，用数学诠释庄严</p>
</blockquote>
<h3 data-id="heading-1">一、从五角星到国旗：一个程序员的突发奇想</h3>
<p>昨天深夜，在网上看到一个有趣的Python项目——用turtle模块绘制五角星。看着屏幕上逐渐成型的黄色星星，一个想法突然闪过：既然能画五角星，为什么不画一面完整的五星红旗呢？</p>
<p>然而，当我开始动手时，却发现这不仅仅是画几个星星那么简单。国旗的绘制有着严格的标准和比例，每一颗星星的位置、角度、大小都必须精确无误。这不禁让我思考：用代码绘制国旗，到底需要哪些数学知识？</p>
<h3 data-id="heading-2">二、五星红旗的数学密码</h3>
<h4 data-id="heading-3">2.1 国旗的基本规格</h4>
<p>根据《中华人民共和国国旗法》和国旗制作标准，五星红旗的规格如下：</p>
<ul>
<li><strong>长宽比</strong>：3:2</li>
<li><strong>主色调</strong>：红色（RGB: 238, 28, 36）和黄色（RGB: 255, 215, 0）</li>
<li><strong>五颗星的位置</strong>：精确的几何定位</li>
<li><strong>星星的大小比例</strong>：大星外接圆直径是旗高的3/10，小星是1/10</li>
</ul>
<h4 data-id="heading-4">2.2 星星定位的数学原理</h4>
<p>五星红旗上五颗星的位置不是随意摆放的，而是基于黄金分割和几何学的精密计算：</p>
<pre><code class="hljs">大五角星中心点位置：
x坐标 = 旗面宽度 × 1/4
y坐标 = 旗面高度 × 3/4

四颗小五角星与大星的相对位置：
1号小星：与大星中心连线与水平线夹角 0°
2号小星：夹角 18°
3号小星：夹角 36°
4号小星：夹角 54°
</code></pre>
<h3 data-id="heading-5">三、代码实现：从零绘制五星红旗</h3>
<h4 data-id="heading-6">3.1 基础工具：turtle模块快速入门</h4>
<p>在开始绘制之前，让我们先熟悉一下turtle模块的几个核心功能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle

<span class="hljs-comment"># 1. 画布设置</span>
turtle.setup(<span class="hljs-number">900</span>, <span class="hljs-number">600</span>)  <span class="hljs-comment"># 设置窗口大小</span>
turtle.screensize(<span class="hljs-number">900</span>, <span class="hljs-number">600</span>, <span class="hljs-string">"white"</span>)  <span class="hljs-comment"># 设置画布大小和背景</span>

<span class="hljs-comment"># 2. 画笔控制</span>
turtle.pensize(<span class="hljs-number">3</span>)  <span class="hljs-comment"># 设置画笔粗细</span>
turtle.pencolor(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 设置画笔颜色（RGB格式）</span>
turtle.fillcolor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 设置填充颜色</span>

<span class="hljs-comment"># 3. 基本绘图命令</span>
turtle.forward(<span class="hljs-number">100</span>)  <span class="hljs-comment"># 向前移动100像素</span>
turtle.right(<span class="hljs-number">72</span>)  <span class="hljs-comment"># 向右转72度</span>
turtle.penup()  <span class="hljs-comment"># 抬笔，移动时不画线</span>
turtle.pendown()  <span class="hljs-comment"># 落笔，移动时画线</span>
</code></pre>
<h4 data-id="heading-7">3.2 五角星绘制类：封装的艺术</h4>
<p>为了让代码更加模块化和可复用，我设计了一个五角星绘制类：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle
<span class="hljs-keyword">import</span> math

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FivePointedStar</span>:
    <span class="hljs-string">"""五角星绘制类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, circumradius, center=(<span class="hljs-params"><span class="hljs-number">0</span>, <span class="hljs-number">0</span></span>), rotation=<span class="hljs-number">0</span>, 
                 pen_color=<span class="hljs-string">"yellow"</span>, fill_color=<span class="hljs-string">"yellow"</span></span>):
        <span class="hljs-string">"""
        初始化五角星
        
        参数:
            circumradius: 外接圆半径
            center: 中心点坐标 (x, y)
            rotation: 旋转角度（度），0表示一个角尖朝上
            pen_color: 画笔颜色
            fill_color: 填充颜色
        """</span>
        self.circumradius = circumradius
        self.center = center
        self.rotation = rotation
        self.pen_color = pen_color
        self.fill_color = fill_color
        
        <span class="hljs-comment"># 计算五角星边长（根据外接圆半径）</span>
        self.side_length = <span class="hljs-number">2</span> * circumradius * math.sin(math.radians(<span class="hljs-number">36</span>))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_star</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制一个五角星"""</span>
        x, y = self.center
        
        <span class="hljs-comment"># 移动到起点</span>
        turtle.penup()
        turtle.goto(x, y - self.circumradius)
        turtle.setheading(<span class="hljs-number">90</span> + self.rotation)  <span class="hljs-comment"># 设置朝向</span>
        turtle.pendown()
        
        <span class="hljs-comment"># 设置颜色</span>
        turtle.color(self.pen_color, self.fill_color)
        
        <span class="hljs-comment"># 开始填充</span>
        turtle.begin_fill()
        
        <span class="hljs-comment"># 绘制五角星</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
            turtle.forward(self.side_length)
            turtle.right(<span class="hljs-number">144</span>)  <span class="hljs-comment"># 五角星内角为144度</span>
            turtle.forward(self.side_length)
            turtle.left(<span class="hljs-number">72</span>)  <span class="hljs-comment"># 转向下一个顶点</span>
        
        <span class="hljs-comment"># 结束填充</span>
        turtle.end_fill()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""使实例可调用"""</span>
        self.draw_star()
        <span class="hljs-keyword">return</span> self
</code></pre>
<h4 data-id="heading-8">3.3 完整五星红旗绘制实现</h4>
<p>基于国旗标准和上面的五角星类，我们可以实现完整的国旗绘制：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> turtle
<span class="hljs-keyword">import</span> math

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NationalFlag</span>:
    <span class="hljs-string">"""五星红旗绘制类"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, width=<span class="hljs-number">900</span>, height=<span class="hljs-number">600</span></span>):
        <span class="hljs-string">"""
        初始化国旗
        
        参数:
            width: 旗面宽度
            height: 旗面高度
        """</span>
        self.width = width
        self.height = height
        
        <span class="hljs-comment"># 国旗颜色标准RGB值</span>
        self.RED = (<span class="hljs-number">0.93</span>, <span class="hljs-number">0.11</span>, <span class="hljs-number">0.14</span>)  <span class="hljs-comment"># 红色</span>
        self.YELLOW = (<span class="hljs-number">1.0</span>, <span class="hljs-number">0.84</span>, <span class="hljs-number">0.0</span>)  <span class="hljs-comment"># 黄色</span>
        
        <span class="hljs-comment"># 计算基本尺寸</span>
        self.grid_width = width / <span class="hljs-number">30</span>  <span class="hljs-comment"># 网格宽度（1/15旗宽）</span>
        self.grid_height = height / <span class="hljs-number">20</span>  <span class="hljs-comment"># 网格高度（1/10旗高）</span>
        
        <span class="hljs-comment"># 星星尺寸</span>
        self.big_star_radius = height * <span class="hljs-number">0.15</span>  <span class="hljs-comment"># 大星半径 = 旗高 * 3/20</span>
        self.small_star_radius = height * <span class="hljs-number">0.05</span>  <span class="hljs-comment"># 小星半径 = 旗高 * 1/20</span>
        
        <span class="hljs-comment"># 星星位置（基于网格坐标）</span>
        self.star_positions = [
            <span class="hljs-comment"># 大五角星位置</span>
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"big"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">5</span>,  <span class="hljs-comment"># 第5格</span>
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">5</span>,  <span class="hljs-comment"># 第5格</span>
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment"># 临时占位</span>
            },
            <span class="hljs-comment"># 四颗小五角星位置</span>
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">10</span>,  <span class="hljs-comment"># 第10格</span>
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">2</span>,   <span class="hljs-comment"># 第2格</span>
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">0</span>,    <span class="hljs-comment"># 与大星连线角度</span>
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">12</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">4</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">18</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>, 
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">12</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">7</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">36</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            },
            {
                <span class="hljs-string">"type"</span>: <span class="hljs-string">"small"</span>,
                <span class="hljs-string">"grid_x"</span>: <span class="hljs-number">10</span>,
                <span class="hljs-string">"grid_y"</span>: <span class="hljs-number">9</span>,
                <span class="hljs-string">"angle"</span>: <span class="hljs-number">54</span>,
                <span class="hljs-string">"center"</span>: (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
            }
        ]
        
        <span class="hljs-comment"># 初始化turtle</span>
        self.init_turtle()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_turtle</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""初始化turtle设置"""</span>
        turtle.setup(self.width + <span class="hljs-number">100</span>, self.height + <span class="hljs-number">100</span>)
        turtle.title(<span class="hljs-string">"五星红旗 - 中华人民共和国国旗"</span>)
        turtle.speed(<span class="hljs-number">0</span>)  <span class="hljs-comment"># 最快速度</span>
        turtle.hideturtle()  <span class="hljs-comment"># 隐藏海龟箭头</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">grid_to_pixel</span>(<span class="hljs-params">self, grid_x, grid_y</span>):
        <span class="hljs-string">"""
        将网格坐标转换为像素坐标
        
        国旗左上角为原点(0,0)，向右为x正方向，向下为y正方向
        网格系统：横轴15格，纵轴10格
        """</span>
        pixel_x = grid_x * self.grid_width
        pixel_y = grid_y * self.grid_height
        
        <span class="hljs-comment"># 转换为turtle坐标系（中心为原点）</span>
        turtle_x = pixel_x - self.width / <span class="hljs-number">2</span>
        turtle_y = self.height / <span class="hljs-number">2</span> - pixel_y
        
        <span class="hljs-keyword">return</span> turtle_x, turtle_y
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_background</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制红色背景"""</span>
        turtle.penup()
        turtle.goto(-self.width/<span class="hljs-number">2</span>, self.height/<span class="hljs-number">2</span>)  <span class="hljs-comment"># 左上角</span>
        turtle.pendown()
        
        turtle.fillcolor(self.RED)
        turtle.begin_fill()
        
        <span class="hljs-comment"># 绘制矩形</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):
            turtle.forward(self.width)
            turtle.right(<span class="hljs-number">90</span>)
            turtle.forward(self.height)
            turtle.right(<span class="hljs-number">90</span>)
        
        turtle.end_fill()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_star_centers</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""计算所有星星的中心坐标"""</span>
        <span class="hljs-comment"># 计算大星中心</span>
        big_star = self.star_positions[<span class="hljs-number">0</span>]
        big_star[<span class="hljs-string">"center"</span>] = self.grid_to_pixel(
            big_star[<span class="hljs-string">"grid_x"</span>], 
            big_star[<span class="hljs-string">"grid_y"</span>]
        )
        
        <span class="hljs-comment"># 计算小星中心</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):
            star = self.star_positions[i]
            star[<span class="hljs-string">"center"</span>] = self.grid_to_pixel(
                star[<span class="hljs-string">"grid_x"</span>],
                star[<span class="hljs-string">"grid_y"</span>]
            )
            
            <span class="hljs-comment"># 计算小星需要旋转的角度（角尖指向大星中心）</span>
            dx = big_star[<span class="hljs-string">"center"</span>][<span class="hljs-number">0</span>] - star[<span class="hljs-string">"center"</span>][<span class="hljs-number">0</span>]
            dy = big_star[<span class="hljs-string">"center"</span>][<span class="hljs-number">1</span>] - star[<span class="hljs-string">"center"</span>][<span class="hljs-number">1</span>]
            angle_to_big = math.degrees(math.atan2(dy, dx))
            
            <span class="hljs-comment"># 五角星默认一个角尖朝上（-90度），需要调整</span>
            star[<span class="hljs-string">"rotation"</span>] = angle_to_big - <span class="hljs-number">90</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_stars</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""绘制所有五角星"""</span>
        <span class="hljs-comment"># 绘制大五角星</span>
        big_star = self.star_positions[<span class="hljs-number">0</span>]
        star = FivePointedStar(
            circumradius=self.big_star_radius,
            center=big_star[<span class="hljs-string">"center"</span>],
            rotation=<span class="hljs-number">0</span>,  <span class="hljs-comment"># 大星一个角尖正朝上</span>
            pen_color=self.YELLOW,
            fill_color=self.YELLOW
        )
        star()
        
        <span class="hljs-comment"># 绘制四颗小五角星</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>):
            small_star = self.star_positions[i]
            star = FivePointedStar(
                circumradius=self.small_star_radius,
                center=small_star[<span class="hljs-string">"center"</span>],
                rotation=small_star[<span class="hljs-string">"rotation"</span>],  <span class="hljs-comment"># 小星角尖指向大星</span>
                pen_color=self.YELLOW,
                fill_color=self.YELLOW
            )
            star()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_grid_lines</span>(<span class="hljs-params">self, show_grid=<span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""绘制辅助网格线（调试用）"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> show_grid:
            <span class="hljs-keyword">return</span>
            
        turtle.penup()
        turtle.pencolor(<span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>, <span class="hljs-number">0.8</span>)  <span class="hljs-comment"># 浅灰色</span>
        turtle.pensize(<span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># 绘制水平网格线</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>):  <span class="hljs-comment"># 0-10共11条线</span>
            y = self.height/<span class="hljs-number">2</span> - i * self.grid_height
            turtle.goto(-self.width/<span class="hljs-number">2</span>, y)
            turtle.pendown()
            turtle.goto(self.width/<span class="hljs-number">2</span>, y)
            turtle.penup()
        
        <span class="hljs-comment"># 绘制垂直网格线</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):  <span class="hljs-comment"># 0-15共16条线</span>
            x = -self.width/<span class="hljs-number">2</span> + i * self.grid_width
            turtle.goto(x, self.height/<span class="hljs-number">2</span>)
            turtle.pendown()
            turtle.goto(x, -self.height/<span class="hljs-number">2</span>)
            turtle.penup()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_flag</span>(<span class="hljs-params">self, show_grid=<span class="hljs-literal">False</span></span>):
        <span class="hljs-string">"""绘制完整的五星红旗"""</span>
        <span class="hljs-comment"># 1. 计算星星位置</span>
        self.calculate_star_centers()
        
        <span class="hljs-comment"># 2. 绘制红色背景</span>
        self.draw_background()
        
        <span class="hljs-comment"># 3. 绘制辅助网格（可选）</span>
        self.draw_grid_lines(show_grid)
        
        <span class="hljs-comment"># 4. 绘制五角星</span>
        self.draw_stars()
        
        <span class="hljs-comment"># 5. 完成绘图</span>
        turtle.done()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_image</span>(<span class="hljs-params">self, filename=<span class="hljs-string">"national_flag.png"</span></span>):
        <span class="hljs-string">"""保存国旗图片"""</span>
        canvas = turtle.getcanvas()
        canvas.postscript(file=filename.replace(<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.eps'</span>))
        
        <span class="hljs-comment"># 如果需要PNG格式，可以使用PIL转换</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image
            img = Image.<span class="hljs-built_in">open</span>(filename.replace(<span class="hljs-string">'.png'</span>, <span class="hljs-string">'.eps'</span>))
            img.save(filename, <span class="hljs-string">"PNG"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"国旗已保存为: <span class="hljs-subst">{filename}</span>"</span>)
        <span class="hljs-keyword">except</span> ImportError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"EPS文件已保存，如需PNG格式请安装PIL库"</span>)

<span class="hljs-comment"># 主程序</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始绘制五星红旗..."</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"国旗比例: 3:2"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"大五角星半径: 旗高的3/20"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"小五角星半径: 旗高的1/20"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">40</span>)
    
    <span class="hljs-comment"># 创建国旗对象</span>
    flag = NationalFlag(width=<span class="hljs-number">900</span>, height=<span class="hljs-number">600</span>)
    
    <span class="hljs-comment"># 绘制国旗（show_grid=True可以显示辅助网格）</span>
    flag.draw_flag(show_grid=<span class="hljs-literal">False</span>)
    
    <span class="hljs-comment"># 保存图片</span>
    <span class="hljs-comment"># flag.save_image("china_flag.png")</span>
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"五星红旗绘制完成！"</span>)
</code></pre>
<h3 data-id="heading-9">四、关键代码解析</h3>
<h4 data-id="heading-10">4.1 坐标系统转换</h4>
<p>这是整个项目的核心难点之一。我们需要在三种坐标系之间转换：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">grid_to_pixel</span>(<span class="hljs-params">self, grid_x, grid_y</span>):
    <span class="hljs-string">"""
    坐标转换三部曲：
    1. 网格坐标 → 像素坐标（左上角原点）
    2. 像素坐标 → 标准化坐标（0-1范围）
    3. 标准化坐标 → turtle坐标（中心原点）
    """</span>
    <span class="hljs-comment"># 步骤1：网格转像素</span>
    pixel_x = grid_x * self.grid_width
    pixel_y = grid_y * self.grid_height
    
    <span class="hljs-comment"># 步骤2&amp;3：转换为turtle坐标系</span>
    turtle_x = pixel_x - self.width / <span class="hljs-number">2</span>
    turtle_y = self.height / <span class="hljs-number">2</span> - pixel_y
    
    <span class="hljs-keyword">return</span> turtle_x, turtle_y
</code></pre>
<h4 data-id="heading-11">4.2 星星方向计算</h4>
<p>小五角星的角尖需要精确指向大五角星中心，这涉及向量角度计算：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 计算从当前小星指向大星的向量</span>
<span class="hljs-attr">dx</span> = big_star_x - small_star_x
<span class="hljs-attr">dy</span> = big_star_y - small_star_y

<span class="hljs-comment"># 计算向量角度（弧度）</span>
<span class="hljs-attr">angle_rad</span> = math.atan2(dy, dx)

<span class="hljs-comment"># 转换为角度，并调整使得角尖指向大星</span>
<span class="hljs-attr">rotation_angle</span> = math.degrees(angle_rad) - <span class="hljs-number">90</span>
</code></pre>
<h4 data-id="heading-12">4.3 五角星几何算法</h4>
<p>绘制完美的正五角星需要精确的几何计算：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 五角星边长与外接圆半径的关系</span>
<span class="hljs-comment"># 公式：边长 = 2 * 半径 * sin(36°)</span>
<span class="hljs-attr">side_length</span> = <span class="hljs-number">2</span> * radius * math.sin(math.radians(<span class="hljs-number">36</span>))

<span class="hljs-comment"># 绘制时的旋转角度</span>
<span class="hljs-comment"># 内角：144°，外角：72°</span>
for _ in range(5):
    turtle.forward(side_length)
    turtle.right(144)  <span class="hljs-comment"># 转向绘制下一个角</span>
</code></pre>
<h3 data-id="heading-13">五、国旗绘制的数学之美</h3>
<h4 data-id="heading-14">5.1 黄金分割的应用</h4>
<p>五星红旗的设计中蕴含了黄金分割比例（φ ≈ 1.618）：</p>
<pre><code class="hljs language-ini" lang="ini">旗面长宽比 = 3:<span class="hljs-attr">2</span> = <span class="hljs-number">1.5</span>（接近黄金比例）

大星中心位置：
距左 = 旗宽 × 1/4
距上 = 旗高 × 3/4

这些比例都接近或等于黄金分割比例
</code></pre>
<h4 data-id="heading-15">5.2 星星布局的几何学</h4>
<p>四颗小星的布局形成了一个圆弧，这个大圆弧的圆心正是大五角星的中心，形成了和谐统一的视觉效果。</p>
<h3 data-id="heading-16">六、扩展应用与思考</h3>
<h4 data-id="heading-17">6.1 代码优化方向</h4>
<ol>
<li><strong>性能优化</strong>：使用<code>turtle.tracer(0)</code>关闭动画，最后调用<code>turtle.update()</code>一次性更新</li>
<li><strong>交互功能</strong>：添加点击缩放、拖动查看细节等功能</li>
<li><strong>参数化设计</strong>：允许自定义国旗尺寸、颜色等参数</li>
</ol>
<h4 data-id="heading-18">6.2 数学教育的绝佳案例</h4>
<p>这个项目不仅是编程实践，更是生动的数学教学案例：</p>
<ul>
<li><strong>几何学</strong>：正五角星的绘制</li>
<li><strong>三角函数</strong>：角度计算、坐标转换</li>
<li><strong>比例与缩放</strong>：国旗的标准比例</li>
<li><strong>坐标系</strong>：不同坐标系统的转换</li>
</ul>
<h4 data-id="heading-19">6.3 进阶挑战</h4>
<p>如果你已经掌握了基本绘制，可以尝试这些进阶挑战：</p>
<ol>
<li><strong>动画绘制</strong>：让五角星一颗颗逐渐显示</li>
<li><strong>3D国旗</strong>：使用三维图形库绘制飘扬的国旗</li>
<li><strong>国旗知识问答</strong>：结合绘制过程，进行国旗知识科普</li>
<li><strong>多种国旗绘制</strong>：实现世界各国国旗的绘制</li>
</ol>
<h3 data-id="heading-20">七、总结</h3>
<p>通过Python的turtle模块绘制五星红旗，不仅是一次编程实践，更是一次深刻的爱国主义教育和数学美学体验。每一行代码都蕴含着对国旗标准的尊重，每一个函数都体现了数学的精确与优雅。</p>
<p>国旗的绘制标准是严格的，但代码的实现可以是灵活的。在遵循国旗法规定的前提下，我们可以用编程语言表达对祖国的热爱，用数学公式诠释国旗的庄严。</p>
<p><strong>代码不仅是工具，也可以是艺术的表达；数学不仅是公式，也可以是美的呈现。</strong></p>
<hr/>
<p><strong>注意事项</strong>：</p>
<ol>
<li>本项目代码遵循《中华人民共和国国旗法》相关规定</li>
<li>国旗的绘制必须严格按照国家标准比例</li>
<li>本代码仅用于教育和学习目的</li>
<li>实际使用国旗时应遵守相关法律法规</li>
</ol>
<hr/>
<p><em>用代码致敬祖国，用技术传承文化。每一次绘制，都是对国旗庄严的再认识；每一行代码，都是对祖国深情的再表达。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！]]></title>    <link>https://juejin.cn/post/7595021077665022003</link>    <guid>https://juejin.cn/post/7595021077665022003</guid>    <pubDate>2026-01-14T08:14:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665022003" data-draft-id="7594919272687534106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！"/> <meta itemprop="keywords" content="后端,全栈"/> <meta itemprop="datePublished" content="2026-01-14T08:14:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JOEH60"/> <meta itemprop="url" content="https://juejin.cn/user/1750078239803614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🛡️ 微服务雪崩救星：Sentinel 限流熔断实战，3行代码搞定高可用！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078239803614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JOEH60
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:14:56.000Z" title="Wed Jan 14 2026 08:14:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“双十一大促，流量激增 10 倍，系统全挂了！”<br/>
“下游支付服务响应慢，把我们的订单服务拖垮了！”</p>
<p>在微服务架构中，服务之间有着错综复杂的依赖关系。一旦某个服务出现故障或响应变慢，很容易引发<strong>连锁反应</strong>，导致整个系统崩溃，这就是可怕的**“雪崩效应”**。</p>
<p>如何自救？答案就是：<strong>限流（Rate Limiting）</strong>  和 <strong>熔断降级（Circuit Breaking）</strong> 。</p>
<p>今天，我们不谈复杂的 Hystrix（已停止维护），直接上手目前国内最主流、最好用的流量控制组件 —— <strong>Alibaba Sentinel</strong>。</p>
<h2 data-id="heading-0">💥 为什么要用 Sentinel？</h2>
<p>相比于 Hystrix，Sentinel 的优势太明显了：</p>
<ol>
<li><strong>轻量级</strong>：对性能影响极小。</li>
<li><strong>控制台</strong>：提供开箱即用的可视化控制台，动态修改规则，无需重启。</li>
<li><strong>场景丰富</strong>：支持 QPS 限流、线程数限流、热点参数限流、系统自适应保护等。</li>
<li><strong>生态好</strong>：完美集成 Spring Cloud Alibaba、Dubbo。</li>
</ol>
<h2 data-id="heading-1">🚀 快速上手：Spring Boot 整合</h2>
<h3 data-id="heading-2">1. 引入依赖</h3>
<pre><code class="hljs language-Xml" lang="Xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">2. 定义资源 (Resource)</h3>
<p>Sentinel 的核心概念是<strong>资源</strong>。你可以把任何一个接口、方法甚至一段代码定义为资源。</p>
<p><strong>方式 A：注解方式 (推荐)</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;

    <span class="hljs-meta">@GetMapping("/order/{id}")</span>
    <span class="hljs-comment">// 定义资源名为 "getOrder"，并指定限流后的处理方法</span>
    <span class="hljs-meta">@SentinelResource(value = "getOrder", blockHandler = "handleBlock")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getOrder</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-keyword">return</span> orderService.queryOrder(id);
    }

    <span class="hljs-comment">// 兜底方法：参数和返回值必须与原方法一致，最后多一个 BlockException</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handleBlock</span><span class="hljs-params">(Long id, BlockException ex)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"系统繁忙，请稍后再试！(限流啦)"</span>;
    }
}
</code></pre>
<p><strong>方式 B：代码方式 (灵活)</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">try</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> SphU.entry(<span class="hljs-string">"resourceName"</span>)) {
    <span class="hljs-comment">// 业务逻辑</span>
} <span class="hljs-keyword">catch</span> (BlockException ex) {
    <span class="hljs-comment">// 限流处理</span>
}
</code></pre>
<h2 data-id="heading-4">🛡️ 核心功能实战</h2>
<h3 data-id="heading-5">1. 流量控制 (Flow Control)</h3>
<p><strong>场景</strong>：防止恶意刷接口，或者保护系统不被突发流量打垮。<br/>
<strong>配置</strong>：在 Sentinel 控制台设置 QPS = 10。<br/>
<strong>效果</strong>：当每秒请求数超过 10 时，多余的请求会直接走 blockHandler，返回“系统繁忙”，保护数据库和 CPU。</p>
<h3 data-id="heading-6">2. 熔断降级 (Degrade)</h3>
<p><strong>场景</strong>：下游服务（如支付接口）响应非常慢（超过 1s）或者频繁报错。<br/>
<strong>策略</strong>：</p>
<ul>
<li><strong>慢调用比例</strong>：如果 1s 内有 50% 的请求响应时间超过 500ms，自动熔断 10s。</li>
<li><strong>异常比例</strong>：如果 1s 内有 50% 的请求抛异常，自动熔断。</li>
</ul>
<p><strong>效果</strong>：熔断期间，不再调用下游服务，直接返回降级数据（如“支付服务维护中”），避免线程池被耗尽，实现<strong>快速失败</strong>。</p>
<h3 data-id="heading-7">3. 热点参数限流 (Hot Param)</h3>
<p><strong>场景</strong>：某个爆款商品（ID=1001）被疯狂抢购，但其他商品无人问津。<br/>
<strong>痛点</strong>：普通限流会把所有商品请求一刀切。<br/>
<strong>解决</strong>：设置热点规则，只对 参数索引 0 (即商品ID) 为 1001 的请求限流，其他商品 ID 不受影响。</p>
<h2 data-id="heading-8">🔌 持久化规则 (进阶必看)</h2>
<p>默认情况下，Sentinel 控制台推送的规则是保存在<strong>内存</strong>中的，服务重启就没了！生产环境必须持久化。</p>
<p><strong>推荐方案：推模式 (Push Mode) + Nacos</strong></p>
<ol>
<li>
<p><strong>引入依赖</strong>：sentinel-datasource-nacos。</p>
</li>
<li>
<p><strong>配置 YML</strong>：</p>
<pre><code class="hljs language-Yaml" lang="Yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">sentinel:</span>
      <span class="hljs-attr">datasource:</span>
        <span class="hljs-attr">flow:</span>
          <span class="hljs-attr">nacos:</span>
            <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>
            <span class="hljs-attr">dataId:</span> <span class="hljs-string">${spring.application.name}-flow-rules</span>
            <span class="hljs-attr">groupId:</span> <span class="hljs-string">SENTINEL_GROUP</span>
            <span class="hljs-attr">rule-type:</span> <span class="hljs-string">flow</span>
</code></pre>
</li>
<li>
<p><strong>效果</strong>：在 Nacos 配置中心修改规则，Sentinel 客户端实时感知并生效，重启不丢失。</p>
</li>
</ol>
<h2 data-id="heading-9">💡 架构师建议</h2>
<ol>
<li><strong>先限流，后熔断</strong>：限流是保护自己，熔断是保护下游。</li>
<li><strong>不要过度保护</strong>：阈值设置要基于压测数据，设太低会误杀正常流量，设太高起不到保护作用。</li>
<li><strong>监控是关键</strong>：Sentinel 控制台的实时监控非常有用，上线初期要多盯着，观察 QPS 曲线。</li>
</ol>
<p>掌握了 Sentinel，你的微服务就穿上了一层“防弹衣”，再也不怕突发流量和猪队友了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 3 模板语法与JSX语法详解]]></title>    <link>https://juejin.cn/post/7595021656427790363</link>    <guid>https://juejin.cn/post/7595021656427790363</guid>    <pubDate>2026-01-14T09:26:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427790363" data-draft-id="7595021077665480755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 3 模板语法与JSX语法详解"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-14T09:26:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 3 模板语法与JSX语法详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全栈王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:26:25.000Z" title="Wed Jan 14 2026 09:26:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你好，我是全栈王校长。</p>
<p>前面几节课，我们讲解了很多 Vue.js 3 编译相关的内容，了解完 Vue.js 两个编译打包工具后，我们是时候要开始学习如何使用 Vue.js 3 进行实际的代码开发了。</p>
<p>这节课，我主要会从 Vue.js 的两种主要开发语法进行讲解，它们分别是模板语法和 JSX 语法。从中你不仅能了解到两种开发语法的差异，还可以知道怎么因地制宜地根据需求场景选择合适的语法，从而扩大个人的技术知识储备，更从容地应对用 Vue.js 3 开发项目过程中遇到的各种问题。</p>
<p>Vue.js 从版本 1.x 到版本 3.x，官方代码案例和推荐使用都是模板语法，那么这里我们也根据官方的推荐，优先来了解一下模板语法是怎么一回事。</p>
<h2 data-id="heading-0">什么是模板语法？</h2>
<p>我们可以把 Vue.js 的模板语法，直接理解为 <strong>HTML 语法的一种扩展</strong>，它所有的模板节点声明、属性设置和事件注册等都是按照 HTML 的语法来进行扩展设计的。按照官方的说法就是"所有的 Vue 模板都是语法层面合法的 HTML，可以被符合规范的浏览器和 HTML 解析器解析"。</p>
<p>现在我举个例子，带你了解下模板语法的概念及其不同内容的作用。代码如下所示：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.counter</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> auto;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
} 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>这是基于 Vue.js 3 的模板语法实现的加数器组件，代码基础结构都是基于 HTML 语法实现的，主要由视图模板、JavaScript 脚本代码和 CSS 样式代码构成的。我们拆分开来具体看看。</p>
<h3 data-id="heading-1">首先我们来看看视图层代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>上述视图代码中，只能有一个最外层的 template 标签，template 内部可以允许存在多个 template 标签，用来定义模板的"插槽"位置（slot）等更多插槽相关信息，你可以查看<a href="#" title="#">官方对插槽的说明</a>了解一下。</p>
<p>Vue.js 的模板可以直接使用 HTML 语法的属性（Attribute），例如 class 也可以直接在 Vue.js 的模板中使用，但是 Vue.js 自己定义了一些属性语法，例如 v-on，这个就是 Vue.js 模板绑定事件的语法。以此类推，你大概可以猜到大部分 Vue.js 自定义的模板属性语法，都是以 "v-"为前缀的。更多 Vue.js 的模板语法，你可以查看<a href="#" title="#">官方文档</a>。</p>
<h3 data-id="heading-2">接下来我们看看 JavaScript 脚本代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>在模板语法中，JavaScript 代码只能放在 script 标签里，而且同一个文件里只能有一个顶级的 script 标签。</p>
<p>上述代码使用的是 Vue.js 的 Composition API，所以必须在 script 标签中声明 setup 属性。我们后续所有内容都默认是基于 Composition API 来讲解 Vue.js 3 里的 JavaScript 代码操作。这是因为它是官方推荐的 API 使用方式，使用起来简单清晰，方便复用逻辑代码，同时这也是 Vue.js 3 诞生的特色。</p>
<h3 data-id="heading-3">最后再来看下 CSS 样式代码：</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.counter</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">10px</span> auto;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}

<span class="hljs-selector-class">.counter</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>这就是单文件组件（Single File Component，简称 SFC）的基本结构，通过这种形式，我们可以把 HTML 视觉效果、JavaScript 交互逻辑和 CSS 样式控制很好地整合在一起，形成一个独立的功能单元。</p>
<h2 data-id="heading-4">什么是JSX语法？</h2>
<p>除了上面介绍的单文件组件（SFC）的模板语法，Vue.js 3 也支持 JSX 语法。JSX 是一种 JavaScript 的语法扩展，它允许你在 JavaScript 代码中编写类似 HTML 的标记。</p>
<p>JSX 语法最初是在 React 中广泛使用的，后来 Vue.js 也提供了对 JSX 的支持，让开发者有了更多的选择。</p>
<h3 data-id="heading-5">JSX语法的实现方式</h3>
<p>我们还是以上面的加数器为例，用 JSX 语法来实现，代码如下所示：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineComponent, ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
      count.<span class="hljs-property">value</span>++;
    };

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {count.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
});
</code></pre>
<p>或者使用 Composition API 和 JSX 结合的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
      count.<span class="hljs-property">value</span>++;
    };

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"counter"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {count.value}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
};
</code></pre>
<p>在 JSX 语法中，我们需要通过 Babel 插件来转换 JSX 语法，使其能够在浏览器中正常运行。</p>
<h3 data-id="heading-6">JSX 与模板语法的比较</h3>
<h4 data-id="heading-7">模板语法的优势：</h4>
<ol>
<li><strong>直观性</strong>：对于熟悉 HTML 的开发者来说，模板语法更加直观，因为它与标准的 HTML 非常相似。</li>
<li><strong>简洁性</strong>：在处理简单的 UI 逻辑时，模板语法通常比 JSX 更简洁。</li>
<li><strong>工具支持</strong>：大多数编辑器和 IDE 对 HTML 模板都有很好的支持，包括语法高亮、自动补全等。</li>
<li><strong>性能优化</strong>：Vue.js 可以在编译时对模板进行静态分析和优化，因为模板的结构是固定的。</li>
</ol>
<h4 data-id="heading-8">JSX 语法的优势：</h4>
<ol>
<li><strong>灵活性</strong>：JSX 提供了更强大的编程能力，你可以像写 JavaScript 一样写视图逻辑，能够更灵活地处理复杂的 UI 逻辑。</li>
<li><strong>逻辑表达</strong>：在处理复杂条件渲染或循环时，JSX 可能会更直观，因为你直接使用 JavaScript 的逻辑操作符。</li>
<li><strong>类型检查</strong>：如果你使用 TypeScript，JSX 可以提供更好的类型检查支持。</li>
<li><strong>社区生态</strong>：如果你的团队已经熟悉 React 或其他使用 JSX 的框架，那么在 Vue.js 中使用 JSX 可以降低学习成本。</li>
</ol>
<h2 data-id="heading-9">如何选择模板语法还是JSX？</h2>
<p>在实际开发中，选择哪种语法主要取决于以下几个因素：</p>
<h3 data-id="heading-10">项目类型和规模</h3>
<ul>
<li><strong>中小型项目</strong>：对于功能相对简单、页面数量不多的项目，模板语法通常是更好的选择，因为它更容易理解和维护。</li>
<li><strong>大型复杂项目</strong>：对于功能复杂、逻辑繁多的项目，JSX 的灵活性可能更有优势，尤其是在处理复杂的数据流和条件逻辑时。</li>
</ul>
<h3 data-id="heading-11">团队技能和偏好</h3>
<ul>
<li><strong>传统前端团队</strong>：如果团队成员更熟悉 HTML 和传统的 Web 开发模式，模板语法会更受欢迎。</li>
<li><strong>React 背景团队</strong>：如果团队成员有 React 开发经验，他们可能会更倾向于使用 JSX。</li>
</ul>
<h3 data-id="heading-12">生态系统和工具链</h3>
<ul>
<li><strong>Vue 生态</strong>：模板语法是 Vue 的原生语法，拥有更完善的生态系统和工具支持。</li>
<li><strong>跨框架项目</strong>：如果项目需要在多个框架之间共享组件逻辑，JSX 可能更容易迁移和复用。</li>
</ul>
<h3 data-id="heading-13">学习曲线</h3>
<ul>
<li><strong>初学者</strong>：对于刚接触 Vue.js 的开发者，模板语法的学习曲线可能更平缓，因为它更接近标准的 HTML。</li>
<li><strong>有经验的开发者</strong>：有 React 或其他 JSX 经验的开发者可能会更快适应 JSX 语法。</li>
</ul>
<h2 data-id="heading-14">实际应用场景举例</h2>
<h3 data-id="heading-15">场景一：简单的表单组件</h3>
<p>对于简单的表单组件，模板语法更加清晰直观：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;form @submit.prevent="handleSubmit"&gt;
    &lt;input 
      v-model="formData.name" 
      type="text" 
      placeholder="姓名" 
      class="form-input"
    /&gt;
    &lt;input 
      v-model="formData.email" 
      type="email" 
      placeholder="邮箱" 
      class="form-input"
    /&gt;
    &lt;button type="submit" class="submit-btn"&gt;提交&lt;/button&gt;
  &lt;/form&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-16">场景二：复杂的数据展示组件</h3>
<p>对于需要根据多种条件动态渲染元素的复杂数据展示组件，JSX 可能更灵活：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">renderData</span> = (<span class="hljs-params">data, level = <span class="hljs-number">0</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!data || !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data)) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">level-</span>${<span class="hljs-attr">level</span>}`}&gt;</span>
        {item.title &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{item.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>}
        {item.content &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{item.content}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
        {item.children &amp;&amp; renderData(item.children, level + 1)}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    ));
  };

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-container"</span>&gt;</span>
      {renderData(props.dataList)}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-17">总结</h2>
<p>Vue.js 3 同时支持模板语法和 JSX 语法，各有其优势和适用场景。模板语法更适合简单直观的 UI 逻辑，而 JSX 语法则提供了更大的灵活性，适合处理复杂的视图逻辑。</p>
<p>作为 Vue.js 开发者，了解这两种语法的特点和适用场景，可以帮助我们在不同的项目中做出合适的选择。无论选择哪种语法，核心都是实现高质量、可维护的用户界面。</p>
<p>在学习 Vue.js 3 的过程中，建议先掌握模板语法，因为它更接近 Vue 的设计理念，并且拥有更好的工具支持。当你需要更灵活的视图逻辑处理能力时，再考虑使用 JSX 语法。</p>
<p>最重要的是，选择最适合你的团队和项目的语法，而不是盲目追求某种特定的写法。无论使用哪种语法，最终的目标都是构建出高效、稳定、易于维护的应用程序。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备]]></title>    <link>https://juejin.cn/post/7595034434975498278</link>    <guid>https://juejin.cn/post/7595034434975498278</guid>    <pubDate>2026-01-14T09:30:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595034434975498278" data-draft-id="7595030559564087347" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T09:30:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱迪斯通"/> <meta itemprop="url" content="https://juejin.cn/user/2672256188156042"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MANUS：用于视觉、语言、行动模型创建的高保真第一人称数据采集设备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2672256188156042/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱迪斯通
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:30:16.000Z" title="Wed Jan 14 2026 09:30:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/957e16c237b840d5a5f22b73b708d8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=xB4B7VBCIriSwxcn9IFpYMf2%2B6c%3D" alt="图片1.png" loading="lazy"/></p>
<p>“RoboBrain-Dex：多源自我中心训练用于集成灵巧视觉-语言-行动模型”。</p>
<p>灵巧手遥操作目前为止仍然是机器人技术中最具挑战性的前沿领域之一。尽管视觉-语言-动作模型在通用机器人能力方面表现出很大潜力，但其面临一个关键瓶颈：灵巧手技能的大规模学习、动作注释数据稀缺。传统遥操作方法成本高且耗时，而现有的人类运动数据集则存在视角依赖、遮挡和捕获环境受限等问题，这限制了它们在机器人训练中的应用。</p>
<p>北京大学和北京人工智能学院的研究人员开发了RoboBrain-Dex，这是一个通过利用MANUS数据手套来克服这些数据收集挑战的灵巧手操作的突破性视觉-语言-动作模型。其工作展示了高保真手部追踪如何实现大规模、多源的自我中心数据集的创建，这些数据集将人类和机器人操作紧密联系在一起。</p>
<p><strong><strong>便携式、高保真大规模数据收集</strong></strong></p>
<p>RoboBrain-Dex 研究团队构建了Ego Atlas，一个综合的多源自我中心数据集，将人类和机器人操作数据统一在一个动作空间下。其数据收集基础设施的核心：MANUS Quantum Metagloves 可捕捉每只手的所有25个手关键点的精确3D位置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8776195a8b1a4c918c2314f55c448605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=YVnmkyPOJP74AyYQ%2BR%2FUGXGV8Hg%3D" alt="ScreenShot_2026-01-14_165059_420.png" loading="lazy"/></p>
<p>与受限于捕捉体积和遮挡问题的基于相机或VR追踪系统不同，MANUS手套追踪系统 实现了便携、随时随地的动作捕捉。结合VIVE追踪器进行6自由度手腕姿态追踪，该系统提供了手部定位，同时保持指尖级的精度。这种方法消除了视角依赖性，并能够在各种真实环境下收集数据，这对于构建用于稳定的VLA模型训练所需的规模和多样化的数据集至关重要。</p>
<p><strong><strong>从人类演示到机器人控制</strong></strong></p>
<p>由MANUS手套捕获的高保真运动数据在RoboBrain-Dex管道中起到了双重作用。对于人类演示，手套记录了自然的操纵行为，为学习机器人动作提供了丰富的先验知识。对于机器人远程操作，相同的手套追踪系统实现了精确控制：通过逆运动学将手腕姿势转换为机器人手臂配置，而指尖轨迹通过基于IK的重新目标映射到灵巧手关节空间。</p>
<p>​</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a8100d3115b41e2bc172673123d9327~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix6L-q5pav6YCa:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768987816&amp;x-signature=oiZREaV0JWYAzJAAZW5nL1hTGRc%3D" alt="ScreenShot_2026-01-14_165121_242.png" loading="lazy"/></p>
<p>这种无缝的人机翻译对于收集补充RoboBrain-Dex人类数据集的机器人演示数据至关重要。研究人员成功地将这种远程控制方法应用于配备Inspire 6-DoF灵巧手的Unitree G1人形机器人上，收集了高质量的多种操作任务演示数据。</p>
<p><strong><strong>推动该领域发展的成果</strong></strong></p>
<p>基于由MANUS手套支持的多源第一人称数据，RoboBrain-Dex在六个真实世界的灵巧操作任务中实现了超高的平均成功率。该模型在分布外场景中表现出色。</p>
<p>RoboBrain-Dex模型代表了一个重要的转变，通过数据采集设备MANUS的毫米级手部追踪精度和便携、可扩展的部署训练机器人灵巧手更加贴合真实人类操作。随着具身人工智能继续向人类水平的操纵能力发展，高保真第一人称数据采集设备仍然是弥合人类灵巧度与机器人智能之间差距的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Rspack核心解析：Rust重写Webpack的性能革命与本质]]></title>    <link>https://juejin.cn/post/7595021077665628211</link>    <guid>https://juejin.cn/post/7595021077665628211</guid>    <pubDate>2026-01-14T09:40:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021077665628211" data-draft-id="7594859060857978890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Rspack核心解析：Rust重写Webpack的性能革命与本质"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-14T09:40:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="eason_fan"/> <meta itemprop="url" content="https://juejin.cn/user/2995517308808877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Rspack核心解析：Rust重写Webpack的性能革命与本质
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2995517308808877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    eason_fan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:40:15.000Z" title="Wed Jan 14 2026 09:40:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Rspack核心解析：Rust重写Webpack的性能革命与本质</h2>
<p>前端构建工具赛道历经多年迭代，已形成 Webpack、Vite、Rspack 三足鼎立的格局。Webpack 作为老牌王者，以“兼容万物、生态完善”支撑了无数项目；Vite 凭借“原生ESM、按需编译”革新了开发体验；而字节跳动出品的 Rspack，则以“Rust 重构、兼容 Webpack”的特质，成为兼顾性能与生态的新选择。很多开发者会困惑：三者核心差异是什么？为什么 Rspack 能实现“性能碾压”又“零成本迁移”？本文将从三者对比切入，层层拆解 Rspack 的核心原理、性能本质，最终给出清晰的项目选型指南，帮你精准匹配最优构建工具。</p>
<h3 data-id="heading-1">一、先厘清核心差异：Webpack、Vite、Rspack 三足鼎立</h3>
<p>要理解 Rspack 的价值，首先要明确三者的核心定位与核心差异——它们看似都是“构建工具”，但设计理念、底层架构、适用场景天差地别，这也是性能与体验差异的根源。我们先通过“定位+核心逻辑”建立整体认知：</p>
<h4 data-id="heading-2">1. Webpack：全能型老牌王者，兼容为王</h4>
<p>Webpack 是“静态模块打包器”的代名词，核心定位是“兼容万物、稳定可靠”。它的核心逻辑是“全量打包”——无论开发还是生产环境，都会从入口文件开始，递归扫描所有模块（JS、CSS、图片等），通过 Loader 处理非JS资源，通过 Plugin 扩展功能，最终打包成浏览器可识别的静态文件。这种“全量扫描+编译”的模式，让它能兼容 CommonJS、ESM 等所有模块规范，适配 IE 到现代浏览器的全场景，但也带来了明显痛点：项目越大，冷启动、热更新速度越慢，大型项目冷启动耗时甚至可达 30s+。</p>
<h4 data-id="heading-3">2. Vite：新生代极速工具，赛道革新</h4>
<p>Vite 是为解决 Webpack 性能痛点而生的“现代构建工具”，核心定位是“极致开发体验”。它彻底抛弃了“全量打包”模式，核心逻辑是“开发无打包、生产靠 Rollup”：开发环境下，利用浏览器原生 ESM 能力，直接按需加载模块，只编译当前页面所需代码，实现毫秒级冷启动；生产环境则借助 Rollup 优秀的 Tree-shaking 能力，输出体积更小的产物。这种“换赛道”的革新，让 Vite 开发体验远超传统打包工具，但代价是兼容性受限——不支持 IE，对老旧第三方库、非 ESM 规范模块适配较差，更适合现代前端项目。</p>
<h4 data-id="heading-4">3. Rspack：性能与生态的平衡者，Rust 赋能</h4>
<p>Rspack 的核心定位是“Webpack 平替、极速无缝迁移”，它的核心逻辑是“Rust 重写 Webpack 核心链路，保留生态与配置”。简单说，它既继承了 Webpack“兼容万物、全场景适配”的优点，又通过 Rust 语言重构解决了性能痛点；同时避开了 Vite“兼容性受限”的短板，实现了“全场景快、零成本迁移、全生态兼容”的三重目标。这也是为什么 Rspack 能快速崛起——它精准命中了“既想提升性能，又不想放弃 Webpack 生态/重构项目”的行业痛点。</p>
<p>为了更清晰对比，我们整理了三者核心维度的差异表，一目了然：</p>





















































<table><thead><tr><th>对比维度</th><th>Webpack</th><th>Vite</th><th>Rspack</th></tr></thead><tbody><tr><td>核心定位</td><td>全能型静态模块打包器</td><td>现代开发服务器+Rollup 打包</td><td>Webpack 兼容的高性能打包器</td></tr><tr><td>底层语言</td><td>JavaScript/TypeScript</td><td>JavaScript/TypeScript</td><td>Rust（核心）+ TypeScript</td></tr><tr><td>核心逻辑</td><td>全量扫描、全量打包</td><td>开发无打包（原生ESM按需加载），生产 Rollup 打包</td><td>全量打包（Rust 重写核心链路）+ 增量优化</td></tr><tr><td>性能表现</td><td>慢（项目越大越明显）</td><td>开发极快，生产较快</td><td>全场景极快（冷启动、热更新、生产打包均优）</td></tr><tr><td>兼容性</td><td>极致兼容（IE11+、全框架）</td><td>有限兼容（现代浏览器，不支持 IE）</td><td>极致兼容（与 Webpack 一致）</td></tr><tr><td>生态适配</td><td>生态天花板，Loader/Plugin 极多</td><td>独立生态，与 Webpack 不兼容</td><td>100% 兼容 Webpack 生态</td></tr><tr><td>迁移成本</td><td>-</td><td>高（需重构配置、适配插件）</td><td>零成本（Webpack 项目改命令即可）</td></tr></tbody></table>
<p>通过对比可见：Webpack 胜在兼容与生态，输在性能；Vite 胜在开发体验，输在兼容性与生态依赖；而 Rspack 则实现了“性能+兼容+生态”的三重平衡——这也是它成为行业新焦点的核心原因。接下来，我们重点拆解 Rspack 如何实现这种平衡。</p>
<h3 data-id="heading-5">二、Rspack 核心定位：Webpack的灵魂 + Rust的躯壳</h3>
<p>从三者对比中能看出，Rspack 的核心竞争力在于“平衡”——既不像 Vite 那样放弃 Webpack 生态换性能，也不局限于 Webpack 的 JS 架构导致性能瓶颈。其本质可概括为：<strong>完整继承 Webpack 的生态与逻辑（灵魂不变），用 Rust 重写核心编译链路（躯壳革新），实现“零成本迁移”与“数量级性能提升”的双重目标</strong>。</p>
<h4 data-id="heading-6">1. 灵魂不变：100%复刻Webpack的核心逻辑，零迁移成本</h4>
<p>Rspack 最打动开发者的一点，就是“Webpack 项目改个命令就能用”，这源于它对 Webpack 核心逻辑的完整继承，没有任何妥协：</p>
<ul>
<li><strong>配置完全兼容</strong>：Webpack 的配置文件（webpack.config.js）可原封不动直接复用，从入口、出口到 Loader/Plugin 配置，一行代码不用改；</li>
<li><strong>生态无缝衔接</strong>：所有 Webpack 的 Loader（如 babel-loader、css-loader）、Plugin（如 html-webpack-plugin、mini-css-extract-plugin）都能直接使用，无需替换或适配；</li>
<li><strong>模块与产物一致</strong>：CommonJS、ESM、AMD 等模块规范的解析逻辑，与 Webpack 完全同步；打包后的产物结构、文件名、代码规范也完全一致，不会引入任何兼容性问题。</li>
</ul>
<p>对开发者而言，迁移 Rspack 只需两步：安装 Rspack 依赖，将启动命令中的“webpack”替换为“rspack”，开发体验、项目结构、产物质量均无变化，唯一的差异就是“更快”。</p>
<h4 data-id="heading-7">2. 躯壳革新：Rust重写核心编译链路，性能革命</h4>
<p>Rspack 的性能优势，核心在于用 Rust 语言重写了 Webpack 中最耗时的核心编译逻辑——包括模块扫描、AST 解析、代码转译、打包合并、产物压缩等关键环节。这不是“代码优化”层面的改进，而是“底层语言迭代”带来的不可逆性能红利，也是它能超越 Webpack、比肩甚至超越 Vite 的核心原因。</p>
<h3 data-id="heading-8">三、性能本质：为什么Rust重写就能实现数量级提速？</h3>
<p>从三者对比我们知道，Rspack 比 Webpack 快 10~100 倍，甚至能比肩 Vite。核心原因不是“算法更优”，而是“语言本身的底层差异”——JavaScript（Webpack/Vite 核心）与 Rust（Rspack 核心）在“编译执行”场景下，存在天生的、无法逾越的性能鸿沟。具体可从三个维度拆解：</p>
<h4 data-id="heading-9">1. 解释型vs编译型：执行效率的天生差距</h4>
<p>JavaScript 是<strong>动态解释型语言</strong>，Webpack 和 Vite 的核心编译逻辑都需要在 Node.js 中“实时解释执行”——代码运行时，JS 引擎需要逐行解析、校验、执行，没有任何预处理步骤，运行时开销极大；</p>
<p>而 Rust 是<strong>静态编译型语言</strong>，核心编译逻辑在项目构建前就会被编译为“CPU 可直接执行的机器码”，运行时无需任何解释过程，CPU 直接执行二进制指令。这种差异直接导致：执行同一段编译逻辑，Rust 的耗时是 JS 的 1/10~1/100。</p>
<p>更关键的是，<strong>这种差距会随项目规模放大</strong>：Webpack 在大型项目中（模块数超 1000+），冷启动可能需要 30s+；而 Rust 的性能与项目大小无关，哪怕是超大型项目，Rspack 冷启动也能做到 2~3s。</p>
<h4 data-id="heading-10">2. 内存管理：无GC开销的性能加成</h4>
<p>JavaScript 的内存管理依赖“垃圾回收（GC）”，Webpack 打包时会频繁创建临时变量（如模块依赖树、AST 节点），导致 GC 频繁触发——而 GC 运行时会阻塞主线程，进一步拖慢构建速度；Vite 虽在开发环境减少了编译量，但生产环境依赖 Rollup（JS 编写），仍存在 GC 开销；</p>
<p>Rust 采用“手动内存管理”，无需 GC，开发者可精准控制内存的分配与释放，既保证了内存安全（无泄漏），又避免了运行时的 GC 阻塞开销。这一特性让 Rspack 的编译过程“零额外内存损耗”，运行效率更稳定。</p>
<h4 data-id="heading-11">3. 多线程：原生并行vs模拟并行</h4>
<p>JavaScript 是单线程模型，Webpack 的“多线程构建”是通过 Node.js 的 child_process 模拟实现的，进程间的通信、数据拷贝存在大量开销，并行效率有限；Vite 开发环境因“按需加载”无需多线程，生产环境 Rollup 的多线程仍受限于 JS 单线程模型；</p>
<p>Rust 支持“原生多线程”，编译逻辑可真正并行执行——比如“模块扫描、代码转译、产物压缩”可同时进行，无需额外的进程通信开销，充分利用多核 CPU 资源，进一步放大性能优势。</p>
<p>总结来说：<strong>Rspack 的快，本质是“编译型语言对解释型语言的降维打击”，是语言底层优势带来的必然结果，而非单纯的工程优化</strong>。这也是它能同时超越 Webpack 性能、规避 Vite 兼容性短板的核心原因。</p>
<h3 data-id="heading-12">四、关键补充：Rspack 的性能提升，不止于 Rust</h3>
<p>除了 Rust 语言的核心优势，Rspack 还在编译策略上做了少量“锦上添花”的优化，进一步巩固性能优势（这些优化 Webpack 也可尝试，但受限于 JS 性能无法发挥效果；而 Vite 因“换赛道”逻辑，无需此类优化）：</p>
<ul>
<li><strong>增量编译</strong>：只编译修改过的模块，未修改模块直接复用缓存，热更新速度大幅提升（毫秒级）；</li>
<li><strong>依赖预编译</strong>：提前编译 node_modules 中的第三方库并缓存，冷启动时无需重复编译；</li>
<li><strong>分层模块解析</strong>：对大型项目的模块按优先级分层解析，减少不必要的递归扫描，降低无效开销。</li>
</ul>
<p>需要强调的是，这些策略是“加分项”，而非 Rspack 性能优势的核心——即便没有这些优化，Rust 语言本身也能让它实现对 Webpack 的性能碾压。</p>
<p>对开发者而言，迁移Rspack只需将启动命令中的“webpack”替换为“rspack”，开发体验、项目结构、产物质量均无变化，唯一的差异就是“更快”。</p>
<h3 data-id="heading-13">五、再深化：Rspack vs Vite，快的逻辑完全不同</h3>
<p>从三者对比中我们知道，Rspack 和 Vite 都比 Webpack 快，但二者“快”的逻辑是两条完全不同的路线——一个是“同赛道升级发动机”，一个是“换赛道规避开销”，这也是它们适用场景差异的根源。我们再做深度拆解，避免混淆：</p>
<h4 data-id="heading-14">1. Rspack 的快：换“更快的发动机”，同赛道升级</h4>
<p>Rspack 没有改变“全量打包”的核心模式（和 Webpack 同赛道），而是通过 Rust 重写，把 Webpack 的“摩托车引擎（JS）”换成了“跑车引擎（Rust）”。这种优化的核心优势是“全场景快”：冷启动快、热更新快、生产打包快，且不受项目规模、浏览器环境的限制——无论是需要兼容 IE 的老旧项目，还是多框架混合的大型项目，都能稳定发挥性能优势。</p>
<h4 data-id="heading-15">2. Vite 的快：换“更快的路线”，换赛道革新</h4>
<p>Vite 彻底放弃了“全量打包”模式（和 Webpack、Rspack 不同赛道），开发环境下不打包任何代码，直接通过浏览器原生 ESM 按需加载模块——本质是“通过减少编译量来提升速度”。这种优化的核心优势是“开发环境极致快”，但短板也很明显：生产环境仍需依赖 Rollup 打包（速度受限）；不支持 IE，对老旧第三方库适配差，仅适合现代前端中小型项目（尤其是 Vue3 项目）。</p>
<p>简单总结：<strong>Rspack 是“治标又治本”的全场景优化，适合所有项目类型；Vite 是“针对性赛道”的局部优化，适合现代小型项目</strong>。</p>
<p>Rspack的性能革命，核心在于用Rust语言重写了Webpack中最耗时的核心编译逻辑——包括模块扫描、AST解析、代码转译、打包合并、产物压缩等关键环节。这不是“代码优化”层面的改进，而是“底层语言迭代”带来的不可逆性能红利。</p>
<h3 data-id="heading-16">二、性能本质：为什么Rust重写就能实现数量级提速？</h3>
<p>Rspack比Webpack快10~100倍，核心原因不是“算法更优”，而是“语言本身的底层差异”——JavaScript（Webpack）与Rust（Rspack）在“编译执行”场景下，存在天生的、无法逾越的性能鸿沟，具体可从三个维度拆解：</p>
<h4 data-id="heading-17">1. 解释型vs编译型：执行效率的天生差距</h4>
<p>JavaScript是<strong>动态解释型语言</strong>，Webpack的所有编译逻辑都需要在Node.js中“实时解释执行”——代码运行时，JS引擎需要逐行解析、校验、执行，没有任何预处理步骤，运行时开销极大；</p>
<p>而Rust是<strong>静态编译型语言</strong>，核心编译逻辑在项目构建前就会被编译为“CPU可直接执行的机器码”，运行时无需任何解释过程，CPU直接执行二进制指令。这种差异直接导致：执行同一段编译逻辑，Rust的耗时是JS的1/10~1/100。</p>
<p>更关键的是，<strong>这种差距会随项目规模放大</strong>：Webpack在大型项目中（模块数超1000+），冷启动可能需要30s+；而Rust的性能与项目大小无关，哪怕是超大型项目，冷启动也能做到2~3s。</p>
<h4 data-id="heading-18">2. 内存管理：无GC开销的性能加成</h4>
<p>JavaScript的内存管理依赖“垃圾回收（GC）”，Webpack打包时会频繁创建临时变量（如模块依赖树、AST节点），导致GC频繁触发——而GC运行时会阻塞主线程，进一步拖慢构建速度；</p>
<p>Rust采用“手动内存管理”，无需GC，开发者可精准控制内存的分配与释放，既保证了内存安全（无泄漏），又避免了运行时的GC阻塞开销。这一特性让Rspack的编译过程“零额外内存损耗”，运行效率更稳定。</p>
<h4 data-id="heading-19">3. 多线程：原生并行vs模拟并行</h4>
<p>JavaScript是单线程模型，Webpack的“多线程构建”是通过Node.js的child_process模拟实现的，进程间的通信、数据拷贝存在大量开销，并行效率有限；</p>
<p>Rust支持“原生多线程”，编译逻辑可真正并行执行——比如“模块扫描、代码转译、产物压缩”可同时进行，无需额外的进程通信开销，充分利用多核CPU资源，进一步放大性能优势。</p>
<p>总结来说：<strong>Rspack的快，本质是“编译型语言对解释型语言的降维打击”，是语言底层优势带来的必然结果，而非单纯的工程优化</strong>。</p>
<h3 data-id="heading-20">六、行业趋势：Rspack 会取代 Webpack 吗？</h3>
<p>结合三者的核心差异与 Rspack 的优势，答案是：<strong>大概率会，这是技术迭代的必然趋势</strong>，核心原因有三点：</p>
<ol>
<li><strong>性能优势不可逆</strong>：Webpack 无论怎么优化，都无法突破 JS 语言的底层性能天花板；而 Rspack 基于 Rust 的性能优势是天生的、不可逆的，这是最核心的迭代动力；</li>
<li><strong>迁移成本为零</strong>：Rspack 完全兼容 Webpack 的生态与配置，开发者无需学习新语法、重构项目，改个命令就能提速，几乎没有迁移阻力——这是它能快速普及的关键；</li>
<li><strong>大厂背书+生态完善</strong>：字节跳动已在内部全面替换 Webpack 为 Rspack，支撑数万项目；开源后社区热度飙升，越来越多的大厂（阿里、腾讯等）开始跟进，生态持续完善，进一步降低了企业级项目的使用风险。</li>
</ol>
<p>目前 Rspack 的版本虽仍在快速迭代，但核心功能已稳定，生产环境完全可用，是前端构建工具的“未来之星”。</p>
<p>除了Rust语言的核心优势，Rspack还在编译策略上做了少量“锦上添花”的优化，进一步巩固性能优势（但这些优化并非核心，Webpack也可实现，只是受限于JS性能无法发挥效果）：</p>
<ul>
<li><strong>增量编译</strong>：只编译修改过的模块，未修改模块直接复用缓存，热更新速度大幅提升（毫秒级）；</li>
<li><strong>依赖预编译</strong>：提前编译node_modules中的第三方库并缓存，冷启动时无需重复编译；</li>
<li><strong>分层模块解析</strong>：对大型项目的模块按优先级分层解析，减少不必要的递归扫描，降低无效开销。</li>
</ul>
<h3 data-id="heading-21">四、易混淆点：Rspack vs Vite，快的逻辑完全不同</h3>
<p>同样是“比Webpack快”，Rspack与Vite的性能提升逻辑是两条完全不同的路线，很多开发者容易混淆，这里做清晰对比：</p>
<h4 data-id="heading-22">1. Rspack的快：换“更快的发动机”</h4>
<p>Rspack没有改变“全量打包”的核心模式，而是通过Rust重写，把Webpack的“摩托车引擎（JS）”换成了“跑车引擎（Rust）”——本质是“同路线下的性能升级”。</p>
<p>特点：<strong>全场景快</strong>（冷启动、热更新、生产打包均快）、兼容性拉满（支持IE、所有框架、所有生态），适合所有项目类型。</p>
<h4 data-id="heading-23">2. Vite的快：换“更快的路线”</h4>
<p>Vite彻底放弃了“全量打包”模式，开发环境下不打包任何代码，直接通过浏览器原生ESM按需加载模块——本质是“换赛道规避编译开销”。</p>
<p>特点：<strong>开发环境极致快</strong>，但生产环境仍依赖Rollup打包；兼容性有限（不支持IE，对老旧生态适配差），适合现代前端中小型项目（尤其是Vue3项目）。</p>
<p>简单总结：<strong>Rspack是“治标又治本”的全场景优化，Vite是“针对性赛道”的局部优化</strong>，二者没有绝对优劣，但Rspack的通用性和兼容性更强。</p>
<h3 data-id="heading-24">七、选型建议：不同场景如何选择？</h3>
<p>结合三者的核心差异、Rspack 的原理特性，以及项目实际需求，给出清晰的选型指南，直接对号入座即可：</p>
<ul>
<li><strong>现有 Webpack 项目</strong>：无脑迁移到 Rspack，零成本、零风险，直接获得 5~10 倍的性能提升；若项目需长期维护且对稳定性要求极高（如金融、政务项目），可先小范围试点，再全面迁移；</li>
<li><strong>新启动项目</strong>：</li>
<li>中大型项目、多框架混合项目（Vue+React）、需要兼容 IE 的项目：优先选 Rspack，兼顾性能、兼容与生态；</li>
<li>小型 Vue3+TS 项目、无需兼容老旧环境：可选 Vite，享受极简配置与极致开发体验；</li>
</ul>
<p><strong>特殊场景</strong>：</p>
<ul>
<li>纯组件库/SDK 开发（追求极小打包体积）：可选 Vite，借助 Rollup 优秀的 Tree-shaking 能力优化产物体积；</li>
<li>老旧项目维护（依赖大量非 ESM 库、需兼容 IE8+）：暂时保留 Webpack，或逐步迁移到 Rspack（避免一次性迁移风险）；</li>
<li>CI/CD 流水线打包速度敏感的项目：优先选 Rspack，生产打包速度最快，可大幅缩短部署周期。</li>
</ul>
<p>答案是：<strong>大概率会，这是技术迭代的必然趋势</strong>，核心原因有三点：</p>
<ol>
<li><strong>性能优势不可逆</strong>：Webpack无论怎么优化，都无法突破JS语言的底层性能天花板，而Rust的性能优势是天生的、不可逆的；</li>
<li><strong>迁移成本为零</strong>：Rspack完全兼容Webpack的生态与配置，开发者无需学习新语法、重构项目，改个命令就能提速，几乎没有迁移阻力；</li>
<li><strong>大厂背书+生态完善</strong>：字节跳动已在内部全面替换Webpack为Rspack，支撑数万项目；开源后社区热度飙升，越来越多的大厂（阿里、腾讯等）开始跟进，生态持续完善。</li>
</ol>
<p>目前Rspack的版本虽仍在快速迭代，但核心功能已稳定，生产环境完全可用，是前端构建工具的“未来之星”。</p>
<h3 data-id="heading-25">八、总结</h3>
<p>Webpack、Vite、Rspack 的三足鼎立，本质是前端构建工具“性能、兼容、生态”三大核心诉求的不同取舍：Webpack 取“兼容与生态”，舍“性能”；Vite 取“性能与体验”，舍“兼容”；而 Rspack 则通过“Rust 重构+兼容 Webpack”，实现了三者的平衡。</p>
<p>Rspack 的核心价值，在于用 Rust 语言的底层优势，彻底解决了 Webpack 的性能痛点，同时完美保留了 Webpack 的生态与兼容性。它不是对 Webpack 的颠覆，而是对 Webpack 的“升级重构”——让开发者在不改变任何开发习惯的前提下，享受数量级的性能提升。</p>
<p>对于前端开发者而言，理解三者的核心差异与 Rspack 的原理，不仅是掌握新工具，更要建立“工具适配场景”的认知：没有最好的构建工具，只有最适合项目的工具。但从行业趋势来看，Rspack 凭借“零成本迁移+全场景性能优势”，无疑会成为中大型项目的主流选择，也预示着“Rust 赋能前端工程工具”将成为未来的重要方向。</p>
<ul>
<li>
<p><strong>现有Webpack项目</strong>：无脑迁移到Rspack，零成本、零风险，直接获得5~10倍的性能提升；</p>
</li>
<li>
<p><strong>新启动项目</strong>：</p>
<ul>
<li>中大型项目、多框架混合项目（Vue+React）、需要兼容IE的项目：优先选Rspack；</li>
<li>小型Vue3+TS项目、无需兼容老旧环境：可选Vite（开发体验更极简）；</li>
</ul>
</li>
<li>
<p><strong>特殊场景</strong>：纯组件库/SDK开发（追求极小打包体积）：可选Vite；金融、政务等对稳定性要求极高的老旧项目：暂时保留Webpack（或逐步迁移到Rspack）。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Re：从零开始的“AI世界"生活]]></title>    <link>https://juejin.cn/post/7595030559564136499</link>    <guid>https://juejin.cn/post/7595030559564136499</guid>    <pubDate>2026-01-14T09:39:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595030559564136499" data-draft-id="7591878211087958051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Re：从零开始的“AI世界&quot;生活"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-14T09:39:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ak啊"/> <meta itemprop="url" content="https://juejin.cn/user/237916932030253"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Re：从零开始的“AI世界"生活
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/237916932030253/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ak啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:39:23.000Z" title="Wed Jan 14 2026 09:39:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Re：从零开始的“AI世界"生活</h2>
<h4 data-id="heading-1">——2025 年，我被 Vibe Coding 反复击杀的那些天</h4>
<blockquote>
<p>“AI 还是无法代替人类工作，<br/>
还是需要人为干预才行。”</p>
</blockquote>
<p>这是我在 2025 年以前，和朋友、同事、以及加班到凌晨两点的自己，经常反复确认的一句话。<br/>
那时我语气笃定，眼神清澈，仿佛站在现实世界的制高点，手里拿着一份写着“人类最终解释权”的说明书。</p>
<p>那时，我的工作与生活，只是<strong>轻度 AI 化</strong>。</p>
<p>它更像是一个听话但不太聪明的学徒：<br/>
我让它查资料，它查；<br/>
我让它写算法，它写；<br/>
我嫌某个轮子太脏太旧，它默默又给我搓了一个。<br/>
然后我再亲自上阵，把代码一行一行扶正，像老师傅拍着徒弟的肩膀说：“思路是对的，但你这活儿，还得练。”</p>
<p>那是一个<strong>人类仍然稳坐驾驶位</strong>的时代。</p>
<hr/>
<h4 data-id="heading-2">第一章：世界尚未崩坏的日常</h4>
<p>那时，ChatGPT 是绝对的主角。<br/>
豆包也很好用，尤其是在下班之后。</p>
<p>每天工作结束，我最大的放松方式不是刷短视频，而是一本正经地问豆包各种<strong>毫无建设性的问题</strong>：<br/>
“如果恐龙没灭绝，人类会不会改吃素？”<br/>
“给我画一只穿西装的哈士奇，气质要像基金经理。”</p>
<p>然后看着它一本正经地给我生成结果，我在屏幕前笑得像个不太正常的人。</p>
<p>我们还接入了 COZE，做了个叫 <strong>“Chat With Agent”</strong> 的东西。<br/>
那一刻，我真的觉得自己站在了时代的浪尖。</p>
<p>看着对话框里一句一句有来有回，我内心独白只有一句：</p>
<blockquote>
<p>“原来我也是能做这种东西的人了。”</p>
</blockquote>
<p>面对 SD、MJ、Flux 的生图，我反复感叹：<br/>
“哇，怎么和我想得一模一样啊。”<br/>
仿佛不是机器在生成图像，而是有人偷偷把我脑子里的画面截图了。</p>
<p>但即便如此——<br/>
<strong>我依旧保持着距离。</strong></p>
<hr/>
<h4 data-id="heading-3">第二章：我对自动补全的冷漠</h4>
<p>那时候，我几乎不用 AI 自动补全。</p>
<p>原因也很简单：<br/>
它太热情了。</p>
<p>我只打了一个函数名，它就迫不及待地往下倾倒一整段我并不需要、也暂时用不上的代码。<br/>
那感觉，就像你刚说一句“我有点渴”，对方直接给你端来一桌满汉全席。</p>
<p>于是我选择了克制。</p>
<p>我坚信：<br/>
<strong>真正的结构、真正的判断、真正的“关键一行”，只能由人类亲手敲下。</strong></p>
<p>我以为，这种状态会一直持续下去。<br/>
我以为，我已经理解了这个世界的运行规则。</p>
<p>——直到 2025 年。</p>
<hr/>
<h4 data-id="heading-4">第三章：死亡回档，从一次“试试看”开始</h4>
<p>事情的转折，往往毫不起眼。</p>
<p>那天我只是想试试一种新的工作方式。<br/>
没有仪式感，没有天雷滚滚，甚至连“卧槽”都来不及说。</p>
<p>我只是发现：<br/>
<strong>事情开始变快了。</strong></p>
<p>快得不讲道理。</p>
<p>我还在思考整体结构，它已经把骨架铺好；<br/>
我刚打算拆分模块，它已经顺手把边界条件处理完；<br/>
我本来想“先凑合跑起来”，结果它直接给了一个可维护、可扩展、甚至还有点优雅的版本。</p>
<p>我第一次产生了一种陌生的感觉——<br/>
不是被取代，而是<strong>被超前照顾</strong>。</p>
<p>就像你刚准备自己走夜路，结果发现对方已经把路灯、护栏、导航和应急预案全都装好了。</p>
<p>那一刻，我隐约意识到：<br/>
这不是工具升级，<br/>
这是<strong>世界线发生了偏移</strong>。</p>
<hr/>
<h4 data-id="heading-5">第四章：Vibe Coding，或者说“顺着感觉就全通了”</h4>
<p>后来，我听到了一个词。<br/>
再后来，我开始理解它。</p>
<p><strong>Vibe Coding。</strong></p>
<p>它并不是“写得更快”，<br/>
而是<strong>你不再需要把每一步都想清楚。</strong></p>
<p>你只需要一个模糊的方向，一个“差不多是这样”的感觉。<br/>
剩下的部分，会像流水一样，自己找到河道。</p>
<p>以前写代码，是“运筹帷幄，步步为营”；<br/>
现在更像是“御剑而行，顺势而下”。</p>
<p>你不是失去了控制权，<br/>
而是放弃了对每一个细节的执念。</p>
<p>这对我这种人来说，是一次近乎痛苦的转变。</p>
<p>因为我终于发现：<br/>
<strong>不是我不够努力，<br/>
是这个时代，已经不要求我事无巨细。</strong></p>
<hr/>
<h4 data-id="heading-6">第五章：我曾经说过的那句话</h4>
<p>“AI 还是无法代替人类工作，还是需要人为干预才行。”</p>
<p>现在回头看，这句话并没有错。<br/>
只是它站在了<strong>旧世界的坐标系里</strong>。</p>
<p>它假设人类的价值，在于“执行”；<br/>
而新世界告诉我，人类真正不可替代的，是<strong>判断、取舍与方向感</strong>。</p>
<p>机器可以一瞬千行，<br/>
但它不知道哪一行，<strong>值得被写下来</strong>。</p>
<p>于是我不再执着于“亲手完成一切”，<br/>
而是开始思考：<br/>
<strong>什么事情，非我不可。</strong></p>
<hr/>
<h4 data-id="heading-7">终章：从零开始，但不是回到原点</h4>
<p>如果非要给 2025 年一个总结，<br/>
那它不是“失业预告”，<br/>
也不是“乌托邦降临”。</p>
<p>它更像是一次被强制触发的成长事件。</p>
<p>我没有被取代，<br/>
只是被迫升级。</p>
<p>就像某个倒霉的主角，在一次次死亡回档后，终于学会了：<br/>
不是每一条路，都要自己撞过南墙。</p>
<p>有些世界线，<br/>
顺着走，反而能活得更久一点。</p>
<p>而我，也终于承认了那件事——<br/>
从零开始，并不意味着一无所有。<br/>
有时候，它只是意味着：<br/>
<strong>你站在了一个新的起点上。</strong></p>
<p>世界没有结束，<br/>
只是加载进度条，悄悄走到了下一章。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go语言云原生与微服务架构终极实践指南]]></title>    <link>https://juejin.cn/post/7594835618120400936</link>    <guid>https://juejin.cn/post/7594835618120400936</guid>    <pubDate>2026-01-14T09:36:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594835618120400936" data-draft-id="7594785614178009128" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言云原生与微服务架构终极实践指南"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2026-01-14T09:36:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户129615735855"/> <meta itemprop="url" content="https://juejin.cn/user/3669510360669564"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言云原生与微服务架构终极实践指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3669510360669564/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户129615735855
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:36:56.000Z" title="Wed Jan 14 2026 09:36:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Go语言云原生与微服务架构终极实践指南</h2>
<h3 data-id="heading-1">一、Go语言在云原生时代的核心优势与生态定位</h3>
<p>在当今云原生技术蓬勃发展的浪潮中，Go语言凭借其独特的设计哲学和工程实用性，已确立为构建云原生应用和微服务架构的主流语言。Go语言的诞生本身就带有解决大规模分布式系统问题的基因——它由Google开发，旨在应对实际生产环境中高并发、高性能需求的挑战。</p>
<p>Go语言的静态编译特性是其最显著的优势之一。通过将应用程序及其所有依赖打包为单个二进制文件，实现了真正的“一次编译，到处运行”。这种特性与容器化部署理念完美契合，大大简化了部署流程，减少了环境依赖带来的问题。</p>
<p>在并发处理方面，Go语言提供的goroutine和channel机制，以其轻量级和高效的特性，彻底改变了传统线程模型的复杂性。一个简单的并发服务器实现展示了其优雅性：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">handler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    time.Sleep(<span class="hljs-number">100</span> * time.Millisecond)
    fmt.Fprintf(w, <span class="hljs-string">"请求处理完成: %s"</span>, time.Now().Format(<span class="hljs-string">"15:04:05"</span>))
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    http.HandleFunc(<span class="hljs-string">"/"</span>, handler)
    fmt.Println(<span class="hljs-string">"服务器启动在 :8080 端口"</span>)
    http.ListenAndServe(<span class="hljs-string">":8080"</span>, <span class="hljs-literal">nil</span>)
}
</code></pre>
<h3 data-id="heading-2">二、微服务架构的核心模式与Go语言实现</h3>
<h4 data-id="heading-3">服务发现与注册</h4>
<p>在微服务架构中，服务发现机制是系统弹性和可扩展性的基础。Go语言社区提供了多种成熟的解决方案，如Consul、Etcd等。以下是一个基于Consul的服务注册示例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"github.com/hashicorp/consul/api"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">registerService</span><span class="hljs-params">(serviceName <span class="hljs-type">string</span>, port <span class="hljs-type">int</span>)</span></span> {
    config := api.DefaultConfig()
    config.Address = <span class="hljs-string">"localhost:8500"</span>
    
    client, err := api.NewClient(config)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(<span class="hljs-string">"连接Consul失败:"</span>, err)
    }
    
    registration := &amp;api.AgentServiceRegistration{
        ID:      serviceName + <span class="hljs-string">"-1"</span>,
        Name:    serviceName,
        Port:    port,
        Address: <span class="hljs-string">"localhost"</span>,
        Check: &amp;api.AgentServiceCheck{
            HTTP:     fmt.Sprintf(<span class="hljs-string">"http://localhost:%d/health"</span>, port),
            Interval: <span class="hljs-string">"10s"</span>,
            Timeout:  <span class="hljs-string">"5s"</span>,
        },
    }
    
    err = client.Agent().ServiceRegister(registration)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatal(<span class="hljs-string">"服务注册失败:"</span>, err)
    }
    
    log.Printf(<span class="hljs-string">"服务 %s 注册成功"</span>, serviceName)
}
</code></pre>
<h4 data-id="heading-4">通信协议与序列化</h4>
<p>微服务间的通信协议选择直接影响系统性能。Go语言对gRPC和Protocol Buffers的原生支持使其在性能敏感场景中表现出色：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// protobuf定义</span>
syntax = <span class="hljs-string">"proto3"</span>;

<span class="hljs-keyword">package</span> user;

service UserService {
    rpc GetUser(UserRequest) returns (UserResponse);
}

message UserRequest {
    <span class="hljs-type">string</span> user_id = <span class="hljs-number">1</span>;
}

message UserResponse {
    <span class="hljs-type">string</span> user_id = <span class="hljs-number">1</span>;
    <span class="hljs-type">string</span> name = <span class="hljs-number">2</span>;
    <span class="hljs-type">string</span> email = <span class="hljs-number">3</span>;
}
</code></pre>
<h4 data-id="heading-5">熔断与降级</h4>
<p>熔断器模式是保障系统稳定性的关键组件。Hystrix风格的实现可以保护服务免受级联故障影响：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> CircuitBreaker <span class="hljs-keyword">struct</span> {
    failures      <span class="hljs-type">int</span>
    threshold     <span class="hljs-type">int</span>
    resetTimeout  time.Duration
    lastFailure   time.Time
    state         <span class="hljs-type">string</span> <span class="hljs-comment">// "closed", "open", "half-open"</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cb *CircuitBreaker)</span></span> Execute(fn <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span>) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> cb.state == <span class="hljs-string">"open"</span> {
        <span class="hljs-keyword">if</span> time.Since(cb.lastFailure) &gt; cb.resetTimeout {
            cb.state = <span class="hljs-string">"half-open"</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> errors.New(<span class="hljs-string">"熔断器开启，请求被拒绝"</span>)
        }
    }
    
    err := fn()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        cb.failures++
        cb.lastFailure = time.Now()
        
        <span class="hljs-keyword">if</span> cb.failures &gt;= cb.threshold {
            cb.state = <span class="hljs-string">"open"</span>
        }
        <span class="hljs-keyword">return</span> err
    }
    
    <span class="hljs-keyword">if</span> cb.state == <span class="hljs-string">"half-open"</span> {
        cb.state = <span class="hljs-string">"closed"</span>
        cb.failures = <span class="hljs-number">0</span>
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-6">三、容器化部署与Kubernetes集成实践</h3>
<h4 data-id="heading-7">多阶段构建优化镜像</h4>
<p>Dockerfile的多阶段构建可以显著减小最终镜像体积：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 构建阶段
FROM golang:1.19-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

# 运行阶段
FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/main .
EXPOSE 8080
CMD ["./main"]
</code></pre>
<h4 data-id="heading-8">Kubernetes资源定义</h4>
<p>完整的Kubernetes部署描述文件展示了生产级配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">registry.example.com/user-service:v1.2.0</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">8080</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">DB_HOST</span>
          <span class="hljs-attr">valueFrom:</span>
            <span class="hljs-attr">configMapKeyRef:</span>
              <span class="hljs-attr">name:</span> <span class="hljs-string">app-config</span>
              <span class="hljs-attr">key:</span> <span class="hljs-string">database.host</span>
        <span class="hljs-attr">resources:</span>
          <span class="hljs-attr">requests:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"128Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"100m"</span>
          <span class="hljs-attr">limits:</span>
            <span class="hljs-attr">memory:</span> <span class="hljs-string">"256Mi"</span>
            <span class="hljs-attr">cpu:</span> <span class="hljs-string">"200m"</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/health</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">httpGet:</span>
            <span class="hljs-attr">path:</span> <span class="hljs-string">/ready</span>
            <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">user-service</span>
  <span class="hljs-attr">ports:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">port:</span> <span class="hljs-number">80</span>
    <span class="hljs-attr">targetPort:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<h3 data-id="heading-9">四、可观测性与监控体系建设</h3>
<h4 data-id="heading-10">结构化日志记录</h4>
<p>使用zap日志库实现高性能的结构化日志：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> logger

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"go.uber.org/zap"</span>
    <span class="hljs-string">"go.uber.org/zap/zapcore"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewLogger</span><span class="hljs-params">(env <span class="hljs-type">string</span>)</span></span> (*zap.Logger, <span class="hljs-type">error</span>) {
    config := zap.NewProductionConfig()
    
    <span class="hljs-keyword">if</span> env == <span class="hljs-string">"development"</span> {
        config = zap.NewDevelopmentConfig()
    }
    
    config.EncoderConfig.TimeKey = <span class="hljs-string">"timestamp"</span>
    config.EncoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder
    config.OutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stdout"</span>}
    config.ErrorOutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stderr"</span>}
    
    <span class="hljs-keyword">return</span> config.Build()
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processOrder</span><span class="hljs-params">(ctx context.Context, orderID <span class="hljs-type">string</span>)</span></span> {
    logger := ctx.Value(<span class="hljs-string">"logger"</span>).(*zap.Logger)
    
    logger.Info(<span class="hljs-string">"开始处理订单"</span>,
        zap.String(<span class="hljs-string">"order_id"</span>, orderID),
        zap.Time(<span class="hljs-string">"start_time"</span>, time.Now()),
        zap.String(<span class="hljs-string">"service"</span>, <span class="hljs-string">"order-service"</span>))
    
    <span class="hljs-comment">// 业务逻辑...</span>
    
    logger.Info(<span class="hljs-string">"订单处理完成"</span>,
        zap.String(<span class="hljs-string">"order_id"</span>, orderID),
        zap.Duration(<span class="hljs-string">"duration"</span>, time.Since(startTime)),
        zap.String(<span class="hljs-string">"status"</span>, <span class="hljs-string">"success"</span>))
}
</code></pre>
<h4 data-id="heading-11">分布式追踪集成</h4>
<p>OpenTelemetry的集成实现端到端的请求追踪：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> tracing

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/exporters/jaeger"</span>
    <span class="hljs-string">"go.opentelemetry.io/otel/sdk/resource"</span>
    sdktrace <span class="hljs-string">"go.opentelemetry.io/otel/sdk/trace"</span>
    semconv <span class="hljs-string">"go.opentelemetry.io/otel/semconv/v1.4.0"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitTracer</span><span class="hljs-params">(serviceName <span class="hljs-type">string</span>)</span></span> (*sdktrace.TracerProvider, <span class="hljs-type">error</span>) {
    exp, err := jaeger.New(jaeger.WithCollectorEndpoint(
        jaeger.WithEndpoint(<span class="hljs-string">"http://jaeger:14268/api/traces"</span>),
    ))
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    
    tp := sdktrace.NewTracerProvider(
        sdktrace.WithBatcher(exp),
        sdktrace.WithResource(resource.NewWithAttributes(
            semconv.SchemaURL,
            semconv.ServiceNameKey.String(serviceName),
            semconv.DeploymentEnvironmentKey.String(<span class="hljs-string">"production"</span>),
        )),
    )
    
    otel.SetTracerProvider(tp)
    <span class="hljs-keyword">return</span> tp, <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// 在HTTP处理器中使用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">instrumentedHandler</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
    tracer := otel.Tracer(<span class="hljs-string">"user-service"</span>)
    ctx, span := tracer.Start(r.Context(), <span class="hljs-string">"HandleRequest"</span>)
    <span class="hljs-keyword">defer</span> span.End()
    
    <span class="hljs-comment">// 传递追踪上下文到下游调用</span>
    req, _ := http.NewRequestWithContext(ctx, <span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://other-service/api"</span>, <span class="hljs-literal">nil</span>)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-12">五、安全最佳实践与生产就绪策略</h3>
<h4 data-id="heading-13">安全中间件栈</h4>
<p>构建多层次的安全防护：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> middleware

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"time"</span>
    <span class="hljs-string">"golang.org/x/time/rate"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SecurityMiddleware</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        <span class="hljs-comment">// 1. CORS配置</span>
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Origin"</span>, <span class="hljs-string">"trusted-domain.com"</span>)
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Methods"</span>, <span class="hljs-string">"GET, POST, PUT, DELETE"</span>)
        w.Header().Set(<span class="hljs-string">"Access-Control-Allow-Headers"</span>, <span class="hljs-string">"Content-Type, Authorization"</span>)
        
        <span class="hljs-comment">// 2. 安全头设置</span>
        w.Header().Set(<span class="hljs-string">"X-Content-Type-Options"</span>, <span class="hljs-string">"nosniff"</span>)
        w.Header().Set(<span class="hljs-string">"X-Frame-Options"</span>, <span class="hljs-string">"DENY"</span>)
        w.Header().Set(<span class="hljs-string">"X-XSS-Protection"</span>, <span class="hljs-string">"1; mode=block"</span>)
        w.Header().Set(<span class="hljs-string">"Strict-Transport-Security"</span>, <span class="hljs-string">"max-age=31536000; includeSubDomains"</span>)
        
        <span class="hljs-comment">// 3. 速率限制检查</span>
        limiter := getLimiter(r.RemoteAddr)
        <span class="hljs-keyword">if</span> !limiter.Allow() {
            http.Error(w, <span class="hljs-string">"请求过于频繁"</span>, http.StatusTooManyRequests)
            <span class="hljs-keyword">return</span>
        }
        
        next.ServeHTTP(w, r)
    })
}

<span class="hljs-comment">// JWT令牌验证中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">JWTAuthMiddleware</span><span class="hljs-params">(next http.Handler)</span></span> http.Handler {
    <span class="hljs-keyword">return</span> http.HandlerFunc(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        tokenString := extractToken(r)
        
        token, err := jwt.Parse(tokenString, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(token *jwt.Token)</span></span> (<span class="hljs-keyword">interface</span>{}, <span class="hljs-type">error</span>) {
            <span class="hljs-keyword">if</span> _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"非预期的签名方法: %v"</span>, token.Header[<span class="hljs-string">"alg"</span>])
            }
            <span class="hljs-keyword">return</span> []<span class="hljs-type">byte</span>(os.Getenv(<span class="hljs-string">"JWT_SECRET"</span>)), <span class="hljs-literal">nil</span>
        })
        
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> || !token.Valid {
            http.Error(w, <span class="hljs-string">"未授权的访问"</span>, http.StatusUnauthorized)
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// 将声明信息传递到上下文</span>
        ctx := context.WithValue(r.Context(), <span class="hljs-string">"userClaims"</span>, token.Claims)
        next.ServeHTTP(w, r.WithContext(ctx))
    })
}
</code></pre>
<h4 data-id="heading-14">配置管理与密钥存储</h4>
<p>安全地管理敏感配置：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> config

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"github.com/spf13/viper"</span>
    secretmanager <span class="hljs-string">"cloud.google.com/go/secretmanager/apiv1"</span>
)

<span class="hljs-keyword">type</span> Config <span class="hljs-keyword">struct</span> {
    DatabaseURL  <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"database_url"`</span>
    APIKey       <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"api_key"`</span>
    JWTSecret    <span class="hljs-type">string</span> <span class="hljs-string">`mapstructure:"jwt_secret"`</span>
    Port         <span class="hljs-type">int</span>    <span class="hljs-string">`mapstructure:"port"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoadConfig</span><span class="hljs-params">(env <span class="hljs-type">string</span>)</span></span> (*Config, <span class="hljs-type">error</span>) {
    viper.SetConfigName(<span class="hljs-string">"config."</span> + env)
    viper.SetConfigType(<span class="hljs-string">"yaml"</span>)
    viper.AddConfigPath(<span class="hljs-string">"./config"</span>)
    viper.AddConfigPath(<span class="hljs-string">"/etc/app/"</span>)
    
    <span class="hljs-comment">// 加载基础配置</span>
    <span class="hljs-keyword">if</span> err := viper.ReadInConfig(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"读取配置文件失败: %w"</span>, err)
    }
    
    <span class="hljs-keyword">var</span> config Config
    <span class="hljs-keyword">if</span> err := viper.Unmarshal(&amp;config); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"解析配置失败: %w"</span>, err)
    }
    
    <span class="hljs-comment">// 从密钥管理服务加载敏感信息</span>
    <span class="hljs-keyword">if</span> env == <span class="hljs-string">"production"</span> {
        secretClient, err := secretmanager.NewClient(context.Background())
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"创建密钥管理客户端失败: %w"</span>, err)
        }
        <span class="hljs-keyword">defer</span> secretClient.Close()
        
        <span class="hljs-comment">// 获取数据库连接字符串</span>
        dbSecret, err := accessSecretVersion(secretClient, <span class="hljs-string">"projects/project-id/secrets/db-url/versions/latest"</span>)
        <span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
            config.DatabaseURL = dbSecret
        }
    }
    
    <span class="hljs-keyword">return</span> &amp;config, <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-15">健康检查与优雅关闭</h4>
<p>确保服务可维护性和可靠性：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> server

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"context"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"os"</span>
    <span class="hljs-string">"os/signal"</span>
    <span class="hljs-string">"syscall"</span>
    <span class="hljs-string">"time"</span>
)

<span class="hljs-keyword">type</span> HealthStatus <span class="hljs-keyword">struct</span> {
    Status    <span class="hljs-type">string</span>    <span class="hljs-string">`json:"status"`</span>
    Timestamp time.Time <span class="hljs-string">`json:"timestamp"`</span>
    Uptime    <span class="hljs-type">string</span>    <span class="hljs-string">`json:"uptime"`</span>
    Version   <span class="hljs-type">string</span>    <span class="hljs-string">`json:"version"`</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">StartServerWithGracefulShutdown</span><span class="hljs-params">(addr <span class="hljs-type">string</span>, handler http.Handler)</span></span> {
    srv := &amp;http.Server{
        Addr:         addr,
        Handler:      handler,
        ReadTimeout:  <span class="hljs-number">15</span> * time.Second,
        WriteTimeout: <span class="hljs-number">30</span> * time.Second,
        IdleTimeout:  <span class="hljs-number">60</span> * time.Second,
    }
    
    <span class="hljs-comment">// 健康检查端点</span>
    http.HandleFunc(<span class="hljs-string">"/health"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        status := HealthStatus{
            Status:    <span class="hljs-string">"healthy"</span>,
            Timestamp: time.Now(),
            Uptime:    time.Since(startTime).String(),
            Version:   <span class="hljs-string">"1.0.0"</span>,
        }
        
        w.Header().Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
        json.NewEncoder(w).Encode(status)
    })
    
    <span class="hljs-comment">// 就绪检查端点</span>
    http.HandleFunc(<span class="hljs-string">"/ready"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span> {
        <span class="hljs-keyword">if</span> isDatabaseConnected() &amp;&amp; isCacheAvailable() {
            w.WriteHeader(http.StatusOK)
            w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"ready"</span>))
        } <span class="hljs-keyword">else</span> {
            w.WriteHeader(http.StatusServiceUnavailable)
            w.Write([]<span class="hljs-type">byte</span>(<span class="hljs-string">"not ready"</span>))
        }
    })
    
    <span class="hljs-comment">// 优雅关闭处理</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> err := srv.ListenAndServe(); err != <span class="hljs-literal">nil</span> &amp;&amp; err != http.ErrServerClosed {
            log.Fatalf(<span class="hljs-string">"服务器启动失败: %v"</span>, err)
        }
    }()
    
    quit := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
    signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)
    &lt;-quit
    
    log.Println(<span class="hljs-string">"正在关闭服务器..."</span>)
    
    ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">30</span>*time.Second)
    <span class="hljs-keyword">defer</span> cancel()
    
    <span class="hljs-keyword">if</span> err := srv.Shutdown(ctx); err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"服务器强制关闭: %v"</span>, err)
    }
    
    log.Println(<span class="hljs-string">"服务器已正常关闭"</span>)
}
</code></pre>
<h3 data-id="heading-16">总结：构建生产级Go微服务的完整路线图</h3>
<p>通过本文的全面探讨，我们构建了一个完整的Go语言云原生微服务开发框架。从语言特性优势到具体实现模式，从容器化部署到监控体系建设，再到安全与可靠性保障，每个环节都体现了Go语言在云原生领域的独特优势。</p>
<p>成功的微服务架构不仅需要技术实现，更需要良好的工程实践和组织协作。建议在实际项目中：</p>
<ol>
<li><strong>渐进式采用</strong>：从单体应用逐步拆分，避免过度微服务化</li>
<li><strong>标准化建设</strong>：建立统一的开发规范、部署流程和监控标准</li>
<li><strong>自动化优先</strong>：投资CI/CD流水线、基础设施即代码等自动化工具</li>
<li><strong>持续学习</strong>：跟踪Go语言和云原生生态的最新发展，适时引入新技术</li>
</ol>
<p>Go语言以其简洁性、高性能和强大的标准库，为构建现代化云原生应用提供了坚实的基础。结合本文介绍的最佳实践，开发团队可以构建出既满足当前需求，又具备良好扩展性和维护性的微服务系统。</p>
<p>记住，技术架构的最终目标是为业务价值服务。选择适合团队和业务场景的技术方案，保持架构的简单性和可演化性，才是构建成功系统的关键所在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[linux环境下，使用docker安装apache kafka (docker-compose)]]></title>    <link>https://juejin.cn/post/7594851429162352674</link>    <guid>https://juejin.cn/post/7594851429162352674</guid>    <pubDate>2026-01-14T09:43:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594851429162352674" data-draft-id="7594785614177992744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="linux环境下，使用docker安装apache kafka (docker-compose)"/> <meta itemprop="keywords" content="架构,Linux"/> <meta itemprop="datePublished" content="2026-01-14T09:43:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优雅的38度"/> <meta itemprop="url" content="https://juejin.cn/user/3030682435332360"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            linux环境下，使用docker安装apache kafka (docker-compose)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3030682435332360/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优雅的38度
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:43:58.000Z" title="Wed Jan 14 2026 09:43:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>使用docker 创建kafka,达到项目中连接linux服务器创建的kafka，进行开发使用。
1.在linux中，在指定位置路径，创建docker-compose.yml文件，然后进行添加内容，我用的docker版本是26.1.1：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">zookeeper:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">confluentinc/cp-zookeeper:7.6.0</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"2181:2181"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">ZOOKEEPER_CLIENT_PORT:</span> <span class="hljs-number">2181</span>
      <span class="hljs-attr">ZOOKEEPER_TICK_TIME:</span> <span class="hljs-number">2000</span>

  <span class="hljs-attr">kafka:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">confluentinc/cp-kafka:7.6.0</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">kafka</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">zookeeper</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9092:9092"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"29092:29092"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">KAFKA_BROKER_ID:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_ZOOKEEPER_CONNECT:</span> <span class="hljs-string">'zookeeper:2181'</span>
      <span class="hljs-attr">KAFKA_LISTENERS:</span> <span class="hljs-string">INTERNAL://0.0.0.0:29092,EXTERNAL://0.0.0.0:9092</span>
      <span class="hljs-attr">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP:</span> <span class="hljs-string">INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span>
      <span class="hljs-attr">KAFKA_ADVERTISED_LISTENERS:</span> <span class="hljs-string">INTERNAL://kafka:29092,EXTERNAL://{服务器IP}:9092</span>
      <span class="hljs-attr">KAFKA_INTER_BROKER_LISTENER_NAME:</span> <span class="hljs-string">INTERNAL</span>
      <span class="hljs-attr">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS:</span> <span class="hljs-number">0</span>
      <span class="hljs-attr">KAFKA_TRANSACTION_STATE_LOG_MIN_ISR:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR:</span> <span class="hljs-number">1</span>
</code></pre>
<p>2.保存好docker-compose.yml</p>
<p>3.在docker-compose.yml文件目录下执行:docker-compose up -d</p>
<p>4.观察启动成功后，使用命令在linux服务器进行测试，</p>
<h2 data-id="heading-0">创建 topic （topic名字=test-topic）</h2>
<p>docker exec kafka kafka-topics --create --topic test-topic --bootstrap-server localhost:9092 --partitions 1 --replication-factor 1</p>
<h2 data-id="heading-1">生产消息（交互式）</h2>
<p>docker exec -it kafka kafka-console-producer --topic test-topic --bootstrap-server localhost:9092</p>
<p>-交互模式下输入kafka value,然后回车</p>
<h2 data-id="heading-2">消费消息（另开终端）</h2>
<p>docker exec -it kafka kafka-console-consumer --topic test-topic --bootstrap-server localhost:9092 --from-beginning</p>
<p>-输入消费信息命令后，在控制台观察输出，在生产者回车value后，消费者控制台会同步出现value</p>
<p>5.springBoot项目中配置kafka,供参考：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">kafka:</span>
  <span class="hljs-attr">topic:</span> <span class="hljs-string">kafka_topic_outputMessage</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">kafka:</span>
    <span class="hljs-attr">bootstrap-servers:</span> {<span class="hljs-string">kafka所在linux机器IP</span>}<span class="hljs-string">:9092</span>
    <span class="hljs-attr">producer:</span>
      <span class="hljs-attr">key-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span>
      <span class="hljs-attr">value-serializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringSerializer</span>
    <span class="hljs-attr">consumer:</span>
      <span class="hljs-attr">properties:</span>
        <span class="hljs-attr">group:</span>
          <span class="hljs-attr">id:</span> {<span class="hljs-string">消费者消费的组ID</span>}
      <span class="hljs-attr">key-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span>
      <span class="hljs-attr">value-deserializer:</span> <span class="hljs-string">org.apache.kafka.common.serialization.StringDeserializer</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[柯里化函数]]></title>    <link>https://juejin.cn/post/7594785614178107432</link>    <guid>https://juejin.cn/post/7594785614178107432</guid>    <pubDate>2026-01-14T09:48:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594785614178107432" data-draft-id="7595043061728428066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="柯里化函数"/> <meta itemprop="keywords" content="后端,设计模式"/> <meta itemprop="datePublished" content="2026-01-14T09:48:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="魅影骑士0010"/> <meta itemprop="url" content="https://juejin.cn/user/2356966533903384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            柯里化函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2356966533903384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    魅影骑士0010
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:48:00.000Z" title="Wed Jan 14 2026 09:48:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71371c9a8a6140e0b3a487900f83038b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6a2F5b2x6aqR5aOrMDAxMA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768988880&amp;x-signature=uzXBjbM0KgorcSNNFTDypeuIzW8%3D" alt="curriedFunction.png" loading="lazy"/></p>
<h2 data-id="heading-0">什么是柯里化？</h2>
<p>柯里化（Currying）是一种把“接收多个参数的函数”，转换成 <strong>“一系列每次只接收一个参数的函数”</strong> 的技术。</p>
<ul>
<li>定义：将 f(a, b, c) 转化为 f(a)(b)(c)</li>
<li>本质：利用闭包保存参数。</li>
<li>作用：固定部分参数以复用代码、延迟计算、方便函数组合。</li>
</ul>
<h2 data-id="heading-1">为什么要柯里化？</h2>
<ul>
<li>
<p>柯里化的核心优势在于 <strong>参数复用</strong> (让代码更具声明式特点，可读性更高) 和 <strong>延迟执行</strong>。</p>
<ul>
<li><em>参数复用：</em></li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 假设有一个通用的正则验证函数 check(reg, txt)</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">check</span> = reg =&gt; <span class="hljs-function"><span class="hljs-params">txt</span> =&gt;</span> reg.<span class="hljs-title function_">test</span>(txt);

<span class="hljs-comment">// 我们可以生成具体的验证函数</span>
<span class="hljs-keyword">const</span> checkEmail = <span class="hljs-title function_">check</span>(<span class="hljs-regexp">/^\S+@\S+$/</span>);
<span class="hljs-keyword">const</span> checkPhone = <span class="hljs-title function_">check</span>(<span class="hljs-regexp">/^1\d{10}$/</span>);

<span class="hljs-comment">// 以后使用时，只需要传具体的内容，逻辑非常清晰</span>
<span class="hljs-title function_">checkEmail</span>(<span class="hljs-string">'test@gmail.com'</span>); 
<span class="hljs-title function_">checkPhone</span>(<span class="hljs-string">'13800138000'</span>);
</code></pre>
<ul>
<li><em>延迟执行：</em> 你不需要一次性集齐所有参数。你可以先传一部分参数，让程序“记住”这种状态，等到合适的时机（剩下的参数准备好时）再计算最终结果。</li>
<li><em>函数组合：</em> 在函数式编程中，我们经常需要把多个简单的函数组合成一个复杂的函数（比如 f(g(x))）。因为柯里化后的函数总是只接受一个参数，这使得它们非常容易像积木一样拼在一起。</li>
</ul>
</li>
<li>
<p>提高函数复用性</p>
</li>
<li>
<p>更符合函数式编程（无状态、可组合、易测试）</p>
</li>
<li>
<p>让代码语义更清晰</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">request</span>(<span class="hljs-string">"GET"</span>)(<span class="hljs-string">"/api/user"</span>)({ <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span> });
</code></pre>
</li>
</ul>
<blockquote>
<p>柯里化在 Haskell、Lisp 等纯函数式语言中是默认行为，Scala 也是语言层面原生支持，而在 JavaScript、Python 等语言中则是一种强大的编程技巧。</p>
</blockquote>
<p>Scala（原生）：参数列表天然支持多段、类型系统知道这是柯里化函数：</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span></span>(a: <span class="hljs-type">Int</span>)(b: <span class="hljs-type">Int</span>) = a + b
add(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)
</code></pre>
<p>Haskell（彻底原生）：所有函数默认柯里化、多参数只是语法糖：</p>
<pre><code class="hljs language-haskell" lang="haskell">add a b = a + b
add 1 2
(add 1) 2
</code></pre>
<h2 data-id="heading-2">Java 方法的柯里化</h2>
<blockquote>
<p>Java 不是原生支持柯里化的语言，依赖 Java 8 引入的 Lambda 表达式 和 函数式接口（Function）来模拟，间接实现。</p>
<p>由于 Java 可读性、类型冗长问题，柯里化不是 Java 的强项。由于语言层面的限制，Java 没有自动类型推导，像（Scala / Kotlin），没有函数是“一等公民”的完整体验，泛型 + Function 嵌套非常啰嗦，导致 Java 不“推崇”柯里化，Java 更推崇偏函数（准确说是偏应用），参考后续文章。Java 设计哲学偏：命令式、显式、可维护性 &gt; 抽象美感。</p>
<p>不推荐：业务代码、CRUD、大多数后端服务逻辑使用柯里化，推荐：构建 DSL、高阶函数库（传入函数作为参数或返回函数的函数）、Stream / Pipeline 中的函数组合、需要“延迟绑定参数”使用柯里化。</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.function.Function;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 定义一个柯里化的日志函数</span>
        <span class="hljs-comment">// 第一层：接收日志级别 (level)</span>
        <span class="hljs-comment">// 第二层：接收具体消息 (message)</span>
        Function&lt;String, Function&lt;String, String&gt;&gt; logFormatter = 
            level -&gt; message -&gt; <span class="hljs-string">"["</span> + level + <span class="hljs-string">"] "</span> + message;

        <span class="hljs-comment">// 场景：我们需要频繁打印 ERROR 级别的日志</span>
        <span class="hljs-comment">// 我们可以“固定”第一个参数，生成一个专门打印 Error 的函数</span>
        Function&lt;String, String&gt; errorLogger = logFormatter.apply(<span class="hljs-string">"ERROR"</span>);
        Function&lt;String, String&gt; infoLogger = logFormatter.apply(<span class="hljs-string">"INFO"</span>);

        <span class="hljs-comment">// 以后使用时，只需要传消息内容</span>
        System.out.println(errorLogger.apply(<span class="hljs-string">"数据库连接失败"</span>));
        System.out.println(errorLogger.apply(<span class="hljs-string">"空指针异常"</span>));
        System.out.println(infoLogger.apply(<span class="hljs-string">"系统启动成功"</span>));
    }
}
</code></pre>
<p>如果参数多，类型定义会变得非常长且难看：</p>
<pre><code class="hljs language-java" lang="java">Function&lt;Integer,
    Function&lt;Integer,
        Function&lt;Integer, Integer&gt;&gt;&gt; sum3 =
            a -&gt; b -&gt; c -&gt; a + b + c;

<span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> sum3.apply(<span class="hljs-number">1</span>).apply(<span class="hljs-number">2</span>).apply(<span class="hljs-number">3</span>);
</code></pre>
<p>缺点（相比 JS 或 Haskell）：</p>
<ul>
<li>啰嗦：类型签名非常长（<code>Function&lt;T, Function&lt;...&gt;&gt;</code>），可读性差。</li>
<li>调用繁琐：必须显式调用 <code>.apply()</code>，不能像 JS 那样直接括号 <code>func(a)(b)</code>，而是 <code>func.apply(a).apply(b)</code>。</li>
<li>性能：每次调用都会创建新的 Function 对象，在极端高性能敏感的场景下可能有微小的开销（通常可忽略）。</li>
</ul>
<p>接下来看看我最喜欢的两门语言 Go 和 Kotlin 的柯里化。</p>
<h2 data-id="heading-3">Go 函数的柯里化</h2>
<p>Go 语言没有原生的柯里化语法或机制，只能通过闭包和高阶函数来手动模拟。</p>
<p><strong>普通手写柯里化版本</strong>:</p>
<p>比如一个 logger：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Log</span><span class="hljs-params">(level, module, msg <span class="hljs-type">string</span>)</span></span> {
    fmt.Println(level, module, msg)
}
</code></pre>
<p>柯里化它：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CurryLog</span><span class="hljs-params">(level <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(module <span class="hljs-type">string</span>)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(<span class="hljs-type">string</span>)</span></span> {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(msg <span class="hljs-type">string</span>)</span></span> {
            fmt.Println(level, module, msg)
        }
    }
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-go" lang="go">info := CurryLog(<span class="hljs-string">"INFO"</span>)
err  := CurryLog(<span class="hljs-string">"ERROR"</span>)

dbInfo := info(<span class="hljs-string">"DB"</span>)
dbErr  := err(<span class="hljs-string">"DB"</span>)

dbInfo(<span class="hljs-string">"connected"</span>)
dbInfo(<span class="hljs-string">"query failed"</span>)
dbErr(<span class="hljs-string">"add failed"</span>)
dbErr(<span class="hljs-string">"update failed"</span>)
</code></pre>
<p><strong>半通用转换器版本</strong>：</p>
<p>写一个辅助函数，将任意符合特定签名的双参数函数转换为柯里化形式。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">"fmt"</span>

<span class="hljs-comment">// Curry 是一个通用转换器</span>
<span class="hljs-comment">// 它接收一个形式为 func(A, B) C 的函数</span>
<span class="hljs-comment">// 返回 func(A) func(B) C</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Curry</span>[<span class="hljs-title">A</span>, <span class="hljs-title">B</span>, <span class="hljs-title">C</span> <span class="hljs-title">any</span>]<span class="hljs-params">(f <span class="hljs-keyword">func</span>(A, B)</span></span> C) <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(A)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(B)</span></span> C {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(a A)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(B)</span></span> C {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(b B)</span></span> C {
            <span class="hljs-keyword">return</span> f(a, b)
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Multiply</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a * b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 将普通函数转换为柯里化函数</span>
    curriedMult := Curry(Multiply)

    <span class="hljs-comment">// 创建一个“双倍器”</span>
    doubler := curriedMult(<span class="hljs-number">2</span>)

    fmt.Println(doubler(<span class="hljs-number">5</span>))
    fmt.Println(doubler(<span class="hljs-number">10</span>))
}
</code></pre>
<p>遗憾的是，Go 没有像 JS 那样的可变参数，不能柯里化任意长度参数列表的函数。</p>
<p><strong>还有一个用泛型加反射实现的通用版本（不推荐）</strong>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> curry

<span class="hljs-keyword">import</span> <span class="hljs-string">"reflect"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Curry</span><span class="hljs-params">(fn any)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any {
    fnVal := reflect.ValueOf(fn)
    fnType := fnVal.Type()

    <span class="hljs-keyword">if</span> fnType.Kind() != reflect.Func {
        <span class="hljs-built_in">panic</span>(<span class="hljs-string">"Curry expects a function"</span>)
    }

    arity := fnType.NumIn()

    <span class="hljs-keyword">var</span> curry <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(args []reflect.Value)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any

    curry = <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(args []reflect.Value)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(arg any)</span></span> any {
            newArgs := <span class="hljs-built_in">append</span>(args, reflect.ValueOf(arg))

            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(newArgs) &lt; arity {
                <span class="hljs-keyword">return</span> curry(newArgs)
            }

            <span class="hljs-comment">// 参数齐了，调用函数</span>
            results := fnVal.Call(newArgs)

            <span class="hljs-comment">// 只支持 0 或 1 返回值</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(results) == <span class="hljs-number">0</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
            }
            <span class="hljs-keyword">return</span> results[<span class="hljs-number">0</span>].Interface()
        }
    }

    <span class="hljs-keyword">return</span> curry(<span class="hljs-literal">nil</span>)
}
</code></pre>
<p>使用示例：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span><span class="hljs-params">(a, b, c <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b + c
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    c := Curry(Add)

    f1 := c(<span class="hljs-number">1</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)
    f2 := f1(<span class="hljs-number">2</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)
    result := f2(<span class="hljs-number">3</span>).(<span class="hljs-type">int</span>)

    fmt.Println(result)
}
</code></pre>
<p>支持不同类型参数：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Mix</span><span class="hljs-params">(a <span class="hljs-type">int</span>, b <span class="hljs-type">string</span>, c <span class="hljs-type">float64</span>)</span></span> <span class="hljs-type">string</span> {
	<span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"%d-%s-%.2f"</span>, a, b, c)
}

c := Curry(Mix)
r := c(<span class="hljs-number">1</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)(<span class="hljs-string">"go"</span>).(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any)(<span class="hljs-number">3.14</span>).(<span class="hljs-type">string</span>)
</code></pre>
<p>⚠️ 注意：这个版本不优雅、不安全、不惯用，只能算“技术演示级别”，不适合生产。技术上可实现（反射 + any），工程上不值得，Go 风格不推荐。</p>
<ol>
<li>
<p>它完全丢失静态类型</p>
<p>你看到的类型链是：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(any)</span></span> any
</code></pre>
<p>Go 编译器：</p>
<ul>
<li>无法检查参数类型</li>
<li>无法检查返回类型</li>
<li>IDE 无法补全</li>
</ul>
</li>
<li>
<p>性能很差</p>
<ul>
<li>reflect.ValueOf</li>
<li>reflect.Call</li>
<li>interface{} 装箱/拆箱</li>
</ul>
<p>在热点路径上是灾难级别。</p>
</li>
<li>
<p>错误全在运行时爆炸</p>
<pre><code class="hljs language-go" lang="go">c(<span class="hljs-string">"hello"</span>) <span class="hljs-comment">// panic</span>
</code></pre>
<p>不是编译期错误，而是 runtime panic。</p>
</li>
</ol>
<p><strong>柯里化在 Go 中的缺点</strong>：</p>
<p>虽然能做，但在 Go 中滥用柯里化会被视为 非惯用做法，原因如下：</p>
<ol>
<li>
<p><strong>类型签名复杂</strong>：</p>
<ul>
<li>普通：func(int, int, int) int</li>
<li>柯里化：func(int) func(int) func(int) int</li>
<li>这对阅读代码的人来说是折磨，而且 Go 不支持类型推导省略函数签名。</li>
</ul>
</li>
<li>
<p><strong>性能损耗</strong>：</p>
<p>每次调用柯里化函数都会涉及到内存分配（闭包对象）和函数调用开销。在高性能要求的场景（如紧密循环）中，这比直接传参要慢。</p>
</li>
<li>
<p><strong>调试困难</strong>：</p>
<p>堆栈跟踪会因为层层嵌套的匿名函数变得很深且难以阅读。</p>
</li>
</ol>
<p><strong>为什么 Go 不原生支持柯里化？</strong></p>
<p>这是 Go 的设计取向决定的：</p>
<p>Go 追求的是：</p>
<ul>
<li>显式</li>
<li>简单</li>
<li>可读</li>
<li>易于静态分析和优化</li>
</ul>
<p>而柯里化依赖：</p>
<ul>
<li>隐式闭包</li>
<li>层层返回函数</li>
<li>动态函数组合</li>
</ul>
<p>这些在 Go 的设计哲学里被认为是<strong>可读性和可维护性成本过高</strong>。</p>
<p><strong>为什么泛型救不了 curry ？</strong></p>
<p>Go 泛型不能：</p>
<ul>
<li>解构函数参数列表</li>
<li>操作 variadic type list</li>
<li>根据函数签名生成新函数类型</li>
</ul>
<p>Go 没有 Type-Level Programming。</p>
<p><strong>Go 里真正“惯用”的写法</strong></p>
<p>Go 程序员更倾向写：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">WithDB</span><span class="hljs-params">(db *DB)</span></span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(Request)</span></span> Response {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(req Request)</span></span> Response {
        ...
    }
}
</code></pre>
<p>这是 Go 风格的依赖注入。</p>
<p>这本质就是：</p>
<blockquote>
<p>柯里化 + 偏应用</p>
</blockquote>
<p>只是 Go 不用这个词。</p>
<p><strong>什么时候用？</strong></p>
<ul>
<li>不要在简单的逻辑计算中使用（不要为了炫技而柯里化）。</li>
<li>推荐使用场景：中间件设计、依赖注入、参数预设（偏函数应用）、接口适配器。</li>
</ul>
<h2 data-id="heading-4">Kotlin 函数的柯里化</h2>
<p>Kotlin 不原生支持自动柯里化（不像 Haskell），但语言特性非常适合手动柯里化，而且写法相当自然。</p>
<h3 data-id="heading-5">手动柯里化</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 普通多参数函数</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sum</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>, y: <span class="hljs-type">Int</span>, z: <span class="hljs-type">Int</span>)</span></span> = x + y + z

<span class="hljs-comment">// 柯里化</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sumCurried</span><span class="hljs-params">(x: <span class="hljs-type">Int</span>)</span></span> = { y: <span class="hljs-built_in">Int</span> -&gt; { z: <span class="hljs-built_in">Int</span> -&gt; x + y + z } }
<span class="hljs-comment">// 带返回值写法</span>
<span class="hljs-comment">// fun sumCurried(x: Int): (Int) -&gt; (Int) -&gt; Int = { y -&gt; { z -&gt; x + y + z } }</span>
<span class="hljs-comment">// 或者函数表达式写法</span>
<span class="hljs-comment">// val sumCurried: (Int) -&gt; (Int) -&gt; Int = { x -&gt; { y -&gt; { z -&gt; x + y + z } } }</span>
<span class="hljs-comment">// val sumCurried = { x: Int -&gt; { y: Int -&gt; { z: Int -&gt; x + y + z } } }</span>

<span class="hljs-comment">// 调用</span>
<span class="hljs-keyword">val</span> sum1And = sumCurried(<span class="hljs-number">1</span>)
<span class="hljs-keyword">val</span> sum1And2And = sum1And(<span class="hljs-number">2</span>)
<span class="hljs-keyword">var</span> res = sum1And2And(<span class="hljs-number">3</span>)

<span class="hljs-comment">// 或者链式调用</span>
res = sumCurried(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)
println(res)
</code></pre>
<h3 data-id="heading-6">通用柯里化扩展函数</h3>
<p>泛型柯里化工具函数（非常实用）</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;X, Y, Z, R&gt;</span> <span class="hljs-params">((X, Y, Z)</span></span> -&gt; R).curry() = { x: X -&gt; { y: Y -&gt; { z: Z -&gt; <span class="hljs-keyword">this</span>(x, y, z) } } }

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">val</span> sum = { x: <span class="hljs-built_in">Int</span>, y: <span class="hljs-built_in">Int</span>, z: <span class="hljs-built_in">Int</span> -&gt; x + y + z }
<span class="hljs-keyword">val</span> curriedSum = sum.curry()

<span class="hljs-keyword">val</span> res = curriedSum(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)
println(res)
</code></pre>
<p>扩展：还有反柯里化函数：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;X, Y, Z, R&gt;</span> <span class="hljs-params">((X)</span></span> -&gt; (Y) -&gt; (Z) -&gt; R).uncurry() = { x: X, y: Y, z: Z -&gt; <span class="hljs-keyword">this</span>(x)(y)(z) }
</code></pre>
<h3 data-id="heading-7">使用 Arrow 库柯里化 (推荐)</h3>
<p>如果你在 Kotlin 中大量使用函数式编程，建议使用 Arrow 库（Kotlin 事实上的标准 FP 库）。它内置了强大的柯里化支持。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> arrow.core.curried

<span class="hljs-keyword">val</span> add = { a: <span class="hljs-built_in">Int</span>, b: <span class="hljs-built_in">Int</span> -&gt; a + b }
<span class="hljs-keyword">val</span> curriedAdd = add.curried()
</code></pre>
<p><strong>总结</strong></p>
<ol>
<li>柯里化将 (A, B) -&gt; C 转化为 (A) -&gt; (B) -&gt; C。</li>
<li>实现方式：利用 Kotlin 的高阶函数，返回 Lambda 嵌套。</li>
<li>核心价值：实现参数复用和延迟执行，通过固定部分参数来创建更具体的函数（偏函数）。</li>
</ol>
<h2 data-id="heading-8">JS 函数的柯里化</h2>
<blockquote>
<p>JavaScript 不是原生柯里化（Auto-curried）语言，在语言层面也没有像 Haskell 或 ML 那样“默认自动柯里化”的机制。
在 JavaScript 中，柯里化只是一种设计模式或编程技巧，而不是语言的默认行为。</p>
<p>虽然 JS 不是默认柯里化的，但现代 JavaScript (ES6+) 提供了很多语法糖，使得手动实现柯里化变得非常简便和优雅。只能说 JS 的动态类型和现代的简洁优雅的语法特性，使其特别容易实现柯里化。</p>
</blockquote>
<h3 data-id="heading-9">A. 箭头函数</h3>
<p>这是 JS 对柯里化最友好的语法支持。通过嵌套箭头函数，可以极其简洁地定义柯里化函数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 现在的写法（极其接近数学定义）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = x =&gt; <span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> <span class="hljs-function"><span class="hljs-params">z</span> =&gt;</span> x + y + z;

<span class="hljs-comment">// 使用</span>
<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
</code></pre>
<h3 data-id="heading-10">B. Function.prototype.bind (偏函数应用)</h3>
<p>虽然 bind 严格来说实现的是偏函数应用 (Partial Application)，但它常被用来达到类似柯里化的效果（固定部分参数）。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>) {
    <span class="hljs-keyword">return</span> x + y;
}

<span class="hljs-comment">// 锁死第一个参数 x 为 10</span>
<span class="hljs-keyword">const</span> addTen = add.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, <span class="hljs-number">10</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">addTen</span>(<span class="hljs-number">5</span>));
</code></pre>
<h3 data-id="heading-11">C. 通用柯里化转换函数实现自动柯里化</h3>
<p>如果你想让普通的 JS 函数变成“不够参数就返回函数，够了就执行”的状态，需要写一个包装器：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">curry</span> = (<span class="hljs-params">fn</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curried</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">if</span> (args.<span class="hljs-property">length</span> &gt;= fn.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fn</span>(...args);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...more</span>) =&gt;</span> <span class="hljs-title function_">curried</span>(...args, ...more);
  };
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a, b, c</span>) =&gt; a + b + c;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)(<span class="hljs-number">3</span>);
<span class="hljs-title function_">curriedAdd</span>(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p><strong>总结</strong>：</p>
<ol>
<li>JS 不是原生柯里化语言：默认调用 f(a) 时，如果 f 需要两个参数，JS 不会返回函数，而是报错或计算出错误结果（NaN）。</li>
<li>没有专门的关键字：没有类似 curry function 这样的关键字。</li>
<li>语法支持不错：箭头函数 (a =&gt; b =&gt; c) 让手动写柯里化函数变得很轻松，这是目前 JS 中柯里化的主流实现方式。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Three.js 环境搭建与开发初识]]></title>    <link>https://juejin.cn/post/7595021656427970587</link>    <guid>https://juejin.cn/post/7595021656427970587</guid>    <pubDate>2026-01-14T09:58:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427970587" data-draft-id="7595030559564234803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Three.js 环境搭建与开发初识"/> <meta itemprop="keywords" content="three.js"/> <meta itemprop="datePublished" content="2026-01-14T09:58:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Three.js 环境搭建与开发初识
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:58:11.000Z" title="Wed Jan 14 2026 09:58:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本文档将详细介绍如何搭建ThreeJS开发环境以及创建您的第一个ThreeJS应用程序。通过本文档，您将学会：</p>
<ul>
<li>如何安装和配置ThreeJS开发环境</li>
<li>如何创建一个简单的3D立方体并让它旋转</li>
<li>如何将ThreeJS与Vue和React框架集成</li>
</ul>
<h2 data-id="heading-1">第一部分：环境搭建与第一个应用</h2>
<h3 data-id="heading-2">1. 初始化项目</h3>
<p>要创建一个ThreeJS项目，首先需要初始化一个新的npm项目并安装必要的依赖：</p>
<pre><code class="hljs language-bash" lang="bash">npm create vite@latest my-threejs-app
<span class="hljs-built_in">cd</span> my-threejs-app
npm install
npm install three
</code></pre>
<p>这将创建一个基于Vite的新项目，并安装ThreeJS作为依赖项。</p>
<h3 data-id="heading-3">2. 项目结构</h3>
<p>典型的ThreeJS项目结构如下：</p>
<pre><code class="hljs language-arduino" lang="arduino">my-threejs-app/
├── <span class="hljs-keyword">public</span>/
│   └── css/
│       └── style.css
├── src/
│   └── main.js
├── index.html
├── package.json
└── vite.config.js
</code></pre>
<h3 data-id="heading-4">3. HTML文件配置</h3>
<p>在<code>index.html</code>中，我们需要设置基本的HTML结构：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vite App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style.css"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"src/main-mk.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>注意：我们引入了CSS样式表来确保Canvas元素正确显示。</p>
<h3 data-id="heading-5">4. CSS样式配置</h3>
<p>在<code>public/css/style.css</code>中设置基本样式：</p>
<pre><code class="hljs language-css" lang="css">*{
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-tag">canvas</span>{
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100vw</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
}
</code></pre>
<p>这些样式确保Canvas元素占据整个浏览器窗口且没有默认的边距。</p>
<h3 data-id="heading-6">5. 核心JavaScript代码</h3>
<p>这是ThreeJS应用的核心代码（在<code>src/main-mk.js</code>中）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'three'</span>;

<span class="hljs-comment">// 创建场景</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
<span class="hljs-comment">// 修改场景背景色</span>
scene.<span class="hljs-property">background</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Color</span>(<span class="hljs-number">0xeeeeee</span>);

<span class="hljs-comment">// 创建透视相机</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
  <span class="hljs-number">45</span>, <span class="hljs-comment">// 视角</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-comment">// 宽高比</span>
  <span class="hljs-number">0.1</span>, <span class="hljs-comment">// 近平面</span>
)

<span class="hljs-comment">// 创建WebGL渲染器</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-comment">// 创建几何体 - 盒子几何体</span>
<span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
<span class="hljs-comment">// 创建材质 - 基础网格材质</span>
<span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
<span class="hljs-comment">// 创建网格对象</span>
<span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);
scene.<span class="hljs-title function_">add</span>(cube);

<span class="hljs-comment">// 设置相机位置</span>
camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;

<span class="hljs-comment">// 动画循环函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  
  <span class="hljs-comment">// 让立方体持续旋转</span>
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
  cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
  
  <span class="hljs-comment">// 渲染场景</span>
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}

<span class="hljs-comment">// 启动动画循环</span>
<span class="hljs-title function_">animate</span>()
</code></pre>
<p>这段代码包含了ThreeJS应用的三个核心组件：</p>
<ol>
<li><strong>场景（Scene）</strong>：所有3D对象的容器</li>
<li><strong>相机（Camera）</strong>：定义观察者视角</li>
<li><strong>渲染器（Renderer）</strong>：负责将场景和相机组合起来渲染为图像</li>
</ol>
<h3 data-id="heading-7">6. 项目的package.json配置</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"01-startapp"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">第二部分：与Vue框架集成</h2>
<h3 data-id="heading-9">1. Vue项目配置</h3>
<p>当将ThreeJS与Vue集成时，需要在Vue项目中安装额外的依赖：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"threejsvue"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.2.47"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-10">2. 在Vue组件中使用ThreeJS</h3>
<p>在Vue的<code>App.vue</code>文件中可以直接集成ThreeJS代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 导入threejs
import * as THREE from "three";

// 创建场景
const scene = new THREE.Scene();

// 创建相机
const camera = new THREE.PerspectiveCamera(
  45, // 视角
  window.innerWidth / window.innerHeight, // 宽高比
  0.1, // 近平面
  1000 // 远平面
);

// 创建渲染器
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// 创建几何体
const geometry = new THREE.BoxGeometry(1, 1, 1);
// 创建材质
const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
// 创建网格
const cube = new THREE.Mesh(geometry, material);

// 将网格添加到场景中
scene.add(cube);

// 设置相机位置
camera.position.z = 5;
camera.lookAt(0, 0, 0);

// 渲染函数
function animate() {
  requestAnimationFrame(animate);
  // 旋转
  cube.rotation.x += 0.01;
  cube.rotation.y += 0.01;
  // 渲染
  renderer.render(scene, camera);
}
animate();
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;&lt;/div&gt;
&lt;/template&gt;

&lt;style&gt;
* {
  margin: 0;
  padding: 0;
}

canvas {
  display: block;
  position: fixed;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-11">第三部分：与React框架集成</h2>
<h3 data-id="heading-12">1. React项目配置</h3>
<p>当将ThreeJS与React集成时，需要在React项目中安装相应的依赖：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"react3d"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint src --ext js,jsx --report-unused-disable-directives --max-warnings 0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"three"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.153.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.37"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.0.11"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.38.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.32.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-hooks"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.6.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-react-refresh"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.3.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.9"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-13">2. 在React组件中使用ThreeJS</h3>
<p>在React的<code>App.jsx</code>文件中可以这样集成ThreeJS：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { useState,useEffect ,<span class="hljs-title class_">Component</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">import</span> reactLogo <span class="hljs-keyword">from</span> <span class="hljs-string">'./assets/react.svg'</span>
<span class="hljs-keyword">import</span> viteLogo <span class="hljs-keyword">from</span> <span class="hljs-string">'/vite.svg'</span>
<span class="hljs-comment">// 导入threejs</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span>{
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>){
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  }
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>){
    <span class="hljs-comment">// 创建场景</span>
    <span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();

    <span class="hljs-comment">// 创建相机</span>
    <span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(
      <span class="hljs-number">45</span>, <span class="hljs-comment">// 视角</span>
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-comment">// 宽高比</span>
      <span class="hljs-number">0.1</span>, <span class="hljs-comment">// 近平面</span>
      <span class="hljs-number">1000</span> <span class="hljs-comment">// 远平面</span>
    );

    <span class="hljs-comment">// 创建渲染器</span>
    <span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
    renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);

    <span class="hljs-comment">// 创建几何体</span>
    <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">BoxGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 创建材质</span>
    <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({ <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ff00</span> });
    <span class="hljs-comment">// 创建网格</span>
    <span class="hljs-keyword">const</span> cube = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material);

    <span class="hljs-comment">// 将网格添加到场景中</span>
    scene.<span class="hljs-title function_">add</span>(cube);

    <span class="hljs-comment">// 设置相机位置</span>
    camera.<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = <span class="hljs-number">5</span>;
    camera.<span class="hljs-title function_">lookAt</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// 渲染函数</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">requestAnimationFrame</span>(animate);
      <span class="hljs-comment">// 旋转</span>
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> += <span class="hljs-number">0.01</span>;
      cube.<span class="hljs-property">rotation</span>.<span class="hljs-property">y</span> += <span class="hljs-number">0.01</span>;
      <span class="hljs-comment">// 渲染</span>
      renderer.<span class="hljs-title function_">render</span>(scene, camera);
    }
    <span class="hljs-title function_">animate</span>();
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h2 data-id="heading-14">总结</h2>
<p>通过以上步骤，我们已经成功搭建了ThreeJS开发环境，并创建了独立运行的ThreeJS应用以及与Vue和React框架集成的应用。ThreeJS的三个核心概念——场景、相机和渲染器是构建任何3D应用的基础，理解它们的作用和关系对于后续学习非常重要。</p>
<p>无论是在纯JavaScript项目还是在现代前端框架（Vue、React）中，ThreeJS的基本使用方法都是一致的，只是集成方式略有不同。掌握了这些基础知识后，您可以进一步探索ThreeJS的更多功能，如光照、材质、纹理等高级特性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux 设备模型学习笔记（1）]]></title>    <link>https://juejin.cn/post/7595028805158469642</link>    <guid>https://juejin.cn/post/7595028805158469642</guid>    <pubDate>2026-01-14T09:55:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805158469642" data-draft-id="7595028805158420490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux 设备模型学习笔记（1）"/> <meta itemprop="keywords" content="面试,嵌入式"/> <meta itemprop="datePublished" content="2026-01-14T09:55:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux 设备模型学习笔记（1）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T09:55:44.000Z" title="Wed Jan 14 2026 09:55:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Linux 设备模型学习笔记（1）</h2>
<h2 data-id="heading-1">前言</h2>
<p>最近在学习 Linux 驱动开发，从简单的字符设备再到平台总线，深刻体会到了 Linux 内核的博大精深，期间阅读了不少前辈们写的文章，资料等等，再结合我自己的一些思考和理解，整理成这篇笔记。</p>
<h2 data-id="heading-2">1. 为什么需要设备模型？</h2>
<p>在 Linux 发展的早期，驱动开发可以算得上是非常简单粗暴，写驱动就是申请设备号，操作硬件等等。Linux 是支持所有不同功能的硬件设备的，这是它的优点，但这也导致 Linux 内核中有相当大一部分代码都是设备驱动相关的，并且随着后来嵌入式系统的爆发（特别是ARM SoC），这种情况愈发严重。早期那种简单粗暴的驱动开发方式已经不再适用了，因为它会带来下面几个问题：</p>
<p>第一，<strong>代码的低复用导致的代码规模爆发式增长</strong>。在早期的那种驱动开发方式中，硬件信息与驱动代码是强耦合的，也就是我们常说的硬编码，这种方式的特点是驱动代码里面不仅包含了<strong>控制硬件的方法</strong>，还包含了<strong>硬件设备的详细信息</strong>。比如，我们需要控制板子上的一个 LED ，在这个板子上 LED 在 GPIO 3 上面，而另一块板子上 LED 在 GPIO 4 上面，那么相同逻辑的 led 驱动代码由于硬件信息的不同，就要写两遍。<strong>硬件信息的硬编码导致驱动代码无法跨板子复用</strong>，这就是代码规模爆发式增长的原因，且其中大部分代码都是重复的。</p>
<p>第二，<strong>电源管理的问题</strong>。当系统要休眠时，Linux 就需要按顺序关闭设备。关闭设备的原则是<strong>先关闭子设备，在关闭父设备</strong>。那我们常见的鼠标来举例，系统必须先关闭挂载在 USB 控制器上的鼠标，然后才能断开 USB 控制器的电源。但是系统里面有那么多设备，如果没有一个<strong>树状结构</strong>来记录设备的父子关系，内核根本就不知道关闭电源的正确顺序，容易导致系统崩溃。</p>
<p>第三，<strong>用户空间无法知道设备的具体信息</strong>。如果用户想知道系统里面究竟挂了几个鼠标，一个 I2C 总线上究竟连接了几个芯片。没有统一的模型，内核就无法向用户空间展示完整的设备拓扑图。</p>
<p>这三个问题，是早期的驱动开发方式带来的问题，也正是设备模型出现后解决的问题。</p>
<p>Linux 设备模型的出现，就是为了将<strong>硬件的描述</strong>与<strong>硬件的驱动</strong>分离，并通过总线来管理他们，最终形成一棵有序的<strong>树</strong>。</p>
<h2 data-id="heading-3">2. Linux 设备模型的基本概念</h2>
<h3 data-id="heading-4">2.1 总线 Bus</h3>
<p>在物理概念中，总线是连接 CPU 和外设的导线，比如USB，I2C，SPI等。但在 Linux 软件模型中，Bus是一种<strong>管理机制</strong>。</p>
<p>我们来看看内核源码中对于总线的解释，相关内容可以在下面目录中找到：</p>
<pre><code class="hljs language-bash" lang="bash">include/linux/device.h
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eeea6f02be77401292cbadc59d4a8b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=wbqh3wY0l4YYNmb1uTGuiIREsRA%3D" alt="1. 总线注释.png" loading="lazy"/></p>
<p>这段注释是内核源码中对于总线的描述，大致意思如下：总线是<strong>处理器与一个或多个设备之间的通信通道</strong>。在设备模型的框架下，<strong>所有设备都通过总线连接，即使这是一个内部的、虚拟的“平台”总线</strong>。总线之间可以互相连接，例如，一个 USB 控制器通常就是一个 PCI 设备。设备模型反映了总线与其所控制设备之间的实际连接关系。总线由 <code>bus_type</code> 结构体表示。该结构体包含了总线的名称、默认属性、总线方法、电源管理操作以及驱动程序核心的私有数据。</p>
<p>对这段注释进行一个总结，其实可以分为两点：</p>
<p>第一，在 Linux 中，总线是 CPU 和一个或多个设备直接交流的通道。</p>
<p>第二，为了将设备模型抽象出来，所有的设备都要连接到总线上，这个总线可以是 CPU 内部总线，也可以是虚拟的平台总线。</p>
<p>在 CPU 内部的众多总线中，每个总线上都维护着两个链表，分别是 <strong>Devices 链表</strong>和 <strong>Drivers 链表</strong>。Devices 链表中存放着所有挂在这条总线上的<strong>设备</strong>。Drivers 链表中存放着所有这条总线上的<strong>驱动</strong>。</p>
<p>而总线最重要的功能就是将设备和驱动进行<strong>匹配</strong>。每当有一个新设备插入或者有一个新驱动被加载，总线就会开始执行匹配程序。</p>
<p>下面是内核源码中<code>bus_type</code>结构体的部分内容：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1534e1f622394a819ca9ca99e0e04fc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=lFsnhCOLKFhlEcSUoWlCbzfNTqY%3D" alt="2. bus_type结构体.png" loading="lazy"/></p>
<p>里面成员很多，我们挑几个重要的看看。</p>
<p>第 123 行是<strong>总线名称</strong>，比如 “Platform” ， “I2C” 等等。</p>
<p>第 130 行是<strong>匹配函数</strong>，当有新设备或新驱动加入总线时，内核就是通过自动调用这个函数，来判断两者是否配对的。</p>
<p>第 132 行是<strong>初始化函数</strong>，匹配成功后，内核会调用这个函数，进而调用<strong>驱动程序里</strong>的 <code>probe</code>初始化函数。</p>
<h3 data-id="heading-5">2.2 设备 Device</h3>
<p>Device 结构体描述的是硬件设备信息，在现代 ARM Linux 中，这些信息主要来源于<strong>设备树</strong>。</p>
<p>设备树里面包含的信息有下面几种：</p>
<p>第一种是<strong>资源信息</strong>，比如寄存器地址，中断号，DMA 通道等等。</p>
<p>第二种是<strong>拓扑信息</strong>，描述该设备在设备树中的位置，比如它是谁的父节点，又是谁的子节点。</p>
<p>第三种是<strong>状态信息</strong>，描述设备现在处于开启状态还是关闭状态。</p>
<p><code>struct device</code> 就像一个基类，实际开发中，我们通常使用它的派生类，如 <code>struct platform_device</code>。</p>
<p>核心思想是将硬件变动隔离起来，就是将所有变动的硬件信息封装在 Device 里面，通过 DTS 传给内核，从而实现硬件信息和驱动程序的解耦。</p>
<h3 data-id="heading-6">2.3 驱动 Driver</h3>
<p>Driver 结构体描述的是对应的硬件应该怎么使用。里面的信息主要是包含操作逻辑，比如怎么初始化，怎么读写，怎么处理中断等等。驱动代码里面不应该出现具体的物理地址，地址应该从传入的 Device 指针里面取出来。</p>
<p>在代码层面，驱动由 <code>struct device_driver</code> 表示，对于使用设备树的 ARM Linux，我们需要特别关注 <code>of_match_table</code> 成员：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a527daa731d94ed5baa953d4c8995df5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=apMOrYrMmos184r0ZC0VLHRp9%2BY%3D" alt="3. device_driver结构体.png" loading="lazy"/></p>
<p>这里同样只截取了一部分内容，我们看看最重要的几个成员。</p>
<p>第 299 行是驱动名称。</p>
<p>第 300 行指明该驱动属于哪条总线。</p>
<p>第 308 行，是驱动<strong>用来与设备匹配</strong>的关键成员。</p>
<h3 data-id="heading-7">2.4 类 Class</h3>
<p>到这里，我们大概已经知道 Bus 是按照物理连接对设备进行分类，比如一个设备到底是属于 USB 设备还是 I2C 设备。</p>
<p>而类 Class 是按照功能属性对设备进行分类的。</p>
<p>举个例子：</p>
<p>从总线角度来看：一个 USB 鼠标属于 USB 总线，蓝牙鼠标属于蓝牙总线。</p>
<p>而从类的角度来看：他们二者都是属于 input 类，也就是输入类的。</p>
<p>从这个例子中不难看出，Class 向用户空间提供了一个标准的接口，不管底层的物理总线是什么，只要属于同一个 Class ，应用程序就可以用相同的方式来操作设备，屏蔽了底层的差异。</p>
<p>我们可以在 <code>/sys/class/</code>目录下看到所有的类：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b39c1f15e1a4bfab74fc23d825f94dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768989344&amp;x-signature=7pSxqmu3pePQOK1mmZ79S0QI%2B5Y%3D" alt="4. 类.png" loading="lazy"/></p>
<h3 data-id="heading-8">2.5 它们是怎么协同工作的</h3>
<p>在理解了上面的概念之后，我们来梳理一下内核管理硬件的整个流程：</p>
<p>上面我们提到过，Bus 维护着两个链表。一个是 <code>klist_devices</code> 设备链表，里面是等待配对的硬件设备。另一个是 <code>klist_drivers</code>驱动链表，里面是等待干活的驱动。</p>
<p>当内核解析设备树时，会将节点转化为对应的 Device 结构体并注册到总线上，这时 Devices 链表中的设备加一。</p>
<p>当用户加载内核模块（使用<code>insmod</code>命令）时，Driver 结构体被注册到总线上，这时 Drivers 链表中的驱动加一。</p>
<p>每当 Devices 链表或者 Drivers 链表中增加新成员，总线都会调用<code>.match</code>函数，拿着新来的成员去和对方链表的每一个成员进行比对。常用的平台总线中通常是通过比对<code>compatible</code>属性字符串来决定配对是否成功。</p>
<p>一旦匹配成功，总线就会调用<code>.probe</code>函数进行初始化，这个总线的<code>.probe</code>函数最终会调用驱动的<code>.probe</code>函数，把具体的 Device 结构体传给 Driver。<strong>注意：总线先调用自己的 probe ， 进而调用驱动提供的 probe</strong>。</p>
<p>在 <code>.probe</code> 函数中，驱动通常会调用子系统的接口，将自己注册到对应的 <strong>Class</strong> 中，从而在 <code>/dev</code> 或 <code>/sys</code> 下生成文件，供用户层操作。</p>
<p>至此，驱动程序正式拿到了硬件的控制权，然后开始干活。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LazyMinting是如何实现的？]]></title>    <link>https://juejin.cn/post/7594817135128281122</link>    <guid>https://juejin.cn/post/7594817135128281122</guid>    <pubDate>2026-01-14T07:30:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128281122" data-draft-id="7594813727053381666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LazyMinting是如何实现的？"/> <meta itemprop="keywords" content="Solidity"/> <meta itemprop="datePublished" content="2026-01-14T07:30:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="gunner6"/> <meta itemprop="url" content="https://juejin.cn/user/360295547039437"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LazyMinting是如何实现的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295547039437/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    gunner6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:30:31.000Z" title="Wed Jan 14 2026 07:30:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">业务场景</h2>
<p>我们lazyMinting使用场景主要是针对nft的竞拍业务来做的。
creator可以在上架nft时，不需要真正的mint nft，而是等有合适的bidder来购买后，才去mint nft。
这样可以减少nft mint的成本，从而鼓励creator来创建更多的nft；</p>
<h2 data-id="heading-1">LazyMinting的实现思路：</h2>
<p>核心思路是通过EIP-712的TypeDataSign来验证签名：</p>
<p>用户在链下用privateKey进行签名，链上通过合约验证确认签名消息的合法性以及业务逻辑的合理性。 一但验证通过，立刻执行合约里的方法，mint nft，transfer给真正的买家。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20648506b71499dbe09960116a0d469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ3VubmVyNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980631&amp;x-signature=mYjBgQYxo0pQBD8cgJP0bobL7VI%3D" alt="ntf_lazy-minting" loading="lazy"/></p>
<h2 data-id="heading-2">我们项目里具体实现方案是什么？</h2>
<ol>
<li>定义了auction合约, 记录 竞拍信息<code>ActionData</code>、NFT 购买者凭证信息<code>Voucher</code>；</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">{
  // 竞拍信息
	struct AuctionDetails {
      address seller; // 卖家地址
      string uri; // nft信息
      uint256 startPrice;
      uint256 duration;
      // 最终竞拍人
      address bidder;
      uint256 bidPrice;
      bool isActive;
      bool isEnd;
      uint256 tokenId;
  }
  // 购买者的凭证
	struct NFTVoucher {
        string auctionId;
        uint256 bidPrice;
        bytes signature;
  }
  
  // 记录action信息
	 mapping(string =&gt; AuctionDetails))  public auctionIdToAuction;

  // 记录voucher
	mapping(string =&gt; NFTVoucher)) public auctionIdToVoucher;
}

</code></pre>
<ol start="2">
<li>
<p>当creator上架一个nft action的时候，传入auctionId，minPrice、duration这些信息，保存在map里；注意此时<code>bidder/tokenId</code>这些信息都是不存在的；</p>
</li>
<li>
<p>当用户出价购买时，组装数据，通过_signTypedData方法，调用钱包签名，生成一个Voucher，并且记录到链下；</p>
<pre><code class="hljs language-ts" lang="ts">  <span class="hljs-comment">/**
   * Creates a new NFTVoucher object and signs it using this LazyMinter's signing key.

   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">NFTVoucher</span>}
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">createVoucher</span>(<span class="hljs-params">auctionId, bidPrice</span>) {
    <span class="hljs-keyword">const</span> voucher = { auctionId, bidPrice };
    <span class="hljs-keyword">const</span> domain = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_signingDomain</span>();

    <span class="hljs-keyword">const</span> types = {
      <span class="hljs-title class_">NFTVoucher</span>: [
        { <span class="hljs-attr">name</span>: <span class="hljs-string">"auctionId"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span> },
        { <span class="hljs-attr">name</span>: <span class="hljs-string">"bidPrice"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"uint256"</span> },
      ],
    };
    <span class="hljs-keyword">const</span> signature = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">signer</span>.<span class="hljs-title function_">_signTypedData</span>(domain, types, voucher);

    <span class="hljs-comment">// const recoveredAddress = ethers.utils.verifyTypedData(domain, types, voucher, signature);</span>
    <span class="hljs-comment">// const expectedSignerAddress = this.signer.address;</span>
    <span class="hljs-comment">// assert(recoveredAddress === expectedSignerAddress); 单纯验证下代码逻辑</span>
    <span class="hljs-comment">// console.log("recoveredAddress = " + recoveredAddress);</span>

    <span class="hljs-keyword">return</span> {
      ...voucher,
      signature,
    };
  }
</code></pre>
</li>
<li>
<p>当竞拍结束，或者creator提前结束时，选择一个出价高的bidder作为获胜者。 构造一个Winner凭证: <code>WinnerVoucher</code></p>
<pre><code class="hljs language-ts" lang="ts">{
  <span class="hljs-attr">auctionId</span>: <span class="hljs-string">"auction123"</span>,
  <span class="hljs-attr">bidder</span>: <span class="hljs-string">"0x中标者地址"</span>,
  <span class="hljs-attr">bidPrice</span>: <span class="hljs-number">1000000000000000000</span>,
  <span class="hljs-attr">nftAddress</span>: <span class="hljs-string">"0xNFT合约地址"</span>,
  <span class="hljs-attr">signature</span>: <span class="hljs-string">"卖家的签名"</span>
}
</code></pre>
</li>
<li>
<p>中标的bidder去链上进行redeem，提交两个voucher: 自身出价的voucher，卖家选择的voucher。</p>
</li>
<li>
<p>合约会验证的两个voucher的合法性，检查数据一致等等</p>
<ol>
<li>address和Voucher里签名的用户是否是同一个，并且验证调用redeem的msg.value &gt; Voucher.bidderPrice</li>
</ol>
<pre><code class="hljs language-solidity" lang="solidity">// 新增结构体
struct WinnerVoucher {
    string auctionId;
    address bidder;
    uint256 bidPrice;
    bytes signature;
}

// 计算哈希
function _hashWinner(WinnerVoucher calldata voucher)
    internal
    view
    returns (bytes32)
{
    bytes32 WINNER_VOUCHER_TYPE_HASH = keccak256(
        "WinnerVoucher(string auctionId,address bidder,uint256 bidPrice)"
    );
    bytes32 structHash = keccak256(
        abi.encode(
            WINNER_VOUCHER_TYPE_HASH,
            keccak256(bytes(voucher.auctionId)),
            voucher.bidder,
            voucher.bidPrice
        )
    );
    return _hashTypedDataV4(structHash);
}

// 新增验证函数
function _verifyWinner(WinnerVoucher calldata voucher)
    internal
    view
    returns (address)
{
    bytes32 digest = _hashWinner(voucher);
    return ECDSA.recover(digest, voucher.signature);
}

// 修改后的 redeem 函数
function redeemWithWinnerVoucher(
    address _nftAddress,
    string memory _auctionId,
    NFTVoucher calldata nftVoucher,
    WinnerVoucher calldata winnerVoucher
) public payable returns (uint256) {
    // 1. 验证 NFT voucher 是中标者签的
    address nftSigner = _verify(nftVoucher);
    require(msg.sender == nftSigner, "Invalid NFT signature");
    
    // 2. 验证 winner voucher 是卖家签的
    AuctionDetails storage auction = auctionIdToAuction[_auctionId];
    address winnerSigner = _verifyWinner(winnerVoucher);
    require(winnerSigner == auction.seller, "Invalid seller signature");
    
    // 3. 验证 winner voucher 指定的 bidder 就是调用者
    require(msg.sender == winnerVoucher.bidder, "NOT the winner");
    
    // 4. 验证出价金额
    require(msg.value &gt;= winnerVoucher.bidPrice, "Insufficient funds");
    
    // 5. mint 并转移 NFT
    uint256 tokenId = nftContract.mint(_auctionId, auction.uri);
    nftContract.safeTransferFrom(address(this), msg.sender, tokenId);
    
    // 5. 将付款转账给卖家，这里假设是用 native token付款的
    (bool success, ) = auction.seller.call{value: winnerVoucher.bidPrice}("");
    require(success);
    
    // 7. 更新拍卖状态
    auction.bidder = winnerVoucher.bidder;
    auction.bidPrice = winnerVoucher.bidPrice;
    auction.isEnd = true;
    auction.tokenId = tokenId;
    
    return tokenId;
}
</code></pre>
</li>
</ol>
<p>repo: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F6gunner%2Fscaffold-eth-challenges%2Ftree%2Fchallenge-6-nft-marketplace" target="_blank" title="https://github.com/6gunner/scaffold-eth-challenges/tree/challenge-6-nft-marketplace" ref="nofollow noopener noreferrer">github.com/6gunner/sca…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[模仿 create-vite / create-vue 风格写一个现代脚手架]]></title>    <link>https://juejin.cn/post/7594813727053414434</link>    <guid>https://juejin.cn/post/7594813727053414434</guid>    <pubDate>2026-01-14T07:33:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594813727053414434" data-draft-id="7594785614177452072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="模仿 create-vite / create-vue 风格写一个现代脚手架"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-14T07:33:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            模仿 create-vite / create-vue 风格写一个现代脚手架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:33:54.000Z" title="Wed Jan 14 2026 07:33:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><pre><code class="hljs language-text" lang="text">你有没有发现，现在新建一个前端项目的方式跟三五年前已经完全不一样了？

现在（2025~2026主流做法）：
npm create vite@latest
npx create-next-app@latest
npm create vue@latest
npm create astro@latest
npm create solid@latest
npm create svelte@latest
bun create react
pnpm create vite
</code></pre>
<p>这背后其实是一个非常重要的演进方向：</p>
<p><strong>「npm create xxx」这个写法几乎成了 2024-2026 年新建前端/全栈项目的事实标准</strong></p>
<p>而绝大多数人真正用到的、体验最好的那一批「create-xxx」，几乎都长得差不多，它们基本上都遵循了同一套「现代轻量脚手架模板」：</p>
<h3 data-id="heading-0">现代 create-xxx 脚手架的典型特征（2025-2026版）</h3>























































<table><thead><tr><th>特性</th><th>说明</th><th>常见实现工具/库</th></tr></thead><tbody><tr><td>命令形式</td><td><code>npm create xxx@latest</code> / <code>pnpm create xxx</code> / <code>bun create xxx</code></td><td>—</td></tr><tr><td>几乎不用全局安装</td><td>直接用 npx / bunx / pnpm dlx 执行</td><td>npm 的 create- 协议</td></tr><tr><td>极简依赖</td><td>通常只有 4~8 个运行时依赖</td><td>cac / commander + prompts</td></tr><tr><td>彩色 + 现代终端感</td><td>必须有颜色、loading 动画、渐变 logo</td><td>picocolors / kolorist / chalk</td></tr><tr><td>交互式问题</td><td>非常克制的问题数量（通常 2~5 个）</td><td>prompts / enquirer</td></tr><tr><td>模板直接拷贝或 degit</td><td>不再用 ejs 复杂渲染，更多直接拷贝 + 少量文本替换</td><td>fs-extra / degit</td></tr><tr><td>可选依赖自动安装</td><td>创建完立刻问你要不要 install</td><td>execa / child_process</td></tr><tr><td>支持 --template / --yes 跳过</td><td>喜欢 CI/CD 和喜欢极简的人最爱</td><td>cac / yargs / commander</td></tr><tr><td>模板文件夹结构清晰</td><td>template/react-ts、template/vue-ts、template/minimal 等</td><td>—</td></tr></tbody></table>
<h3 data-id="heading-1">目前（2026年初）最主流的几种「技术路线图」</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[想做现代脚手架] --&gt; B{选几条路?}

    B --&gt; C1[最推荐 极简现代风]
    B --&gt; C2[企业级/复杂需求风]
    B --&gt; C3[老派但稳定风]

    C1 --&gt; D1[cac + prompts + picocolors&lt;br&gt;+ fs-extra + execa]
    C1 --&gt; D2["bunx degit" 路线&lt;br&gt;几乎零依赖]

    C2 --&gt; D3[oclif 全家桶]
    C2 --&gt; D4[oclif + plugins 架构]

    C3 --&gt; D5[commander + inquirer + chalk]
    C3 --&gt; D6[yargs + enquirer]
</code></pre>
<h3 data-id="heading-2">2026 年最被推荐的「极简现代风」技术栈组合</h3>
<p>（绝大多数新项目都在用或往这个方向迁移）</p>
<pre><code class="hljs language-bash" lang="bash">核心依赖（共5个）：
├── cac               <span class="hljs-comment"># 超级轻量的命令行参数解析（比 commander 轻很多）</span>
├── prompts           <span class="hljs-comment"># 目前体验最好的交互式问答库（异步友好）</span>
├── picocolors        <span class="hljs-comment"># 目前最快的终端颜色库（取代 chalk）</span>
├── fs-extra          <span class="hljs-comment"># 增强版 fs（copy、emptyDir、ensureDir 等超好用）</span>
└── execa             <span class="hljs-comment"># 现代版的 child_process.exec（更好用 Promise）</span>

极受欢迎的加分项（按使用频率排序）：
1. degit              <span class="hljs-comment"># 从 github 仓库快速下载模板（git clone 替代品）</span>
2. ora                <span class="hljs-comment"># loading 动画小 spinner</span>
3. gradient-string    <span class="hljs-comment"># 做个好看的彩虹 logo（锦上添花）</span>
4. minimatch          <span class="hljs-comment"># 做文件过滤时偶尔会用到</span>
</code></pre>
<h3 data-id="heading-3">极简现代脚手架典型代码结构（2026主流写法参考）</h3>
<pre><code class="hljs language-javascript" lang="javascript">my-create-tool/
├── bin/
│   └── index.<span class="hljs-property">mjs</span>           ← #!<span class="hljs-regexp">/usr/</span>bin/env node
├── src/
│   ├── index.<span class="hljs-property">mjs</span>
│   ├── prompts.<span class="hljs-property">mjs</span>         ← 所有问题逻辑放这里
│   ├── copyTemplate.<span class="hljs-property">mjs</span>
│   ├── installDeps.<span class="hljs-property">mjs</span>
│   └── templates/          ← 真正要拷贝的内容都在这里
│       ├── vue-ts/
│       ├── react-ts/
│       ├── minimal/
│       └── node-api/
└── package.<span class="hljs-property">json</span>
</code></pre>
<p>最核心的几行代码大概长这样（简化版）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { cac } <span class="hljs-keyword">from</span> <span class="hljs-string">'cac'</span>
<span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> pc <span class="hljs-keyword">from</span> <span class="hljs-string">'picocolors'</span>
<span class="hljs-keyword">import</span> { copy } <span class="hljs-keyword">from</span> <span class="hljs-string">'fs-extra'</span>
<span class="hljs-keyword">import</span> { execaCommand } <span class="hljs-keyword">from</span> <span class="hljs-string">'execa'</span>

<span class="hljs-keyword">const</span> cli = <span class="hljs-title function_">cac</span>(<span class="hljs-string">'create-my-tool'</span>)

cli.<span class="hljs-title function_">command</span>(<span class="hljs-string">'[dir]'</span>, <span class="hljs-string">'项目目录名'</span>)
   .<span class="hljs-title function_">option</span>(<span class="hljs-string">'--template &lt;name&gt;'</span>, <span class="hljs-string">'指定模板'</span>)
   .<span class="hljs-title function_">action</span>(<span class="hljs-keyword">async</span> (dir, options) =&gt; {
      <span class="hljs-keyword">const</span> targetDir = dir || (<span class="hljs-keyword">await</span> <span class="hljs-title function_">askProjectName</span>()).<span class="hljs-property">name</span>
      <span class="hljs-keyword">const</span> template = options.<span class="hljs-property">template</span> || (<span class="hljs-keyword">await</span> <span class="hljs-title function_">askTemplate</span>()).<span class="hljs-property">template</span>

      <span class="hljs-keyword">await</span> <span class="hljs-title function_">copyTemplate</span>(template, targetDir)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pc.<span class="hljs-title function_">green</span>(<span class="hljs-string">'项目创建完成～'</span>))

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> <span class="hljs-title function_">shouldInstall</span>()) {
         <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'正在安装依赖...'</span>)
         <span class="hljs-keyword">await</span> <span class="hljs-title function_">execaCommand</span>(<span class="hljs-string">'pnpm install'</span>, { <span class="hljs-attr">cwd</span>: targetDir })
      }
   })

cli.<span class="hljs-title function_">help</span>().<span class="hljs-title function_">parse</span>()
</code></pre>
<h3 data-id="heading-4">总结：2026 年你应该往哪个方向写脚手架？</h3>
<pre><code class="hljs language-text" lang="text">如果你是：
个人/小团队/个人品牌/内部工具         →   强烈推荐「极简现代风」 cac + prompts + picocolors
中大型团队/需要很多子命令/复杂插件系统   →   考虑 oclif（学习成本高但未来可扩展）
老项目维护/团队成员前端经验比较传统     →   commander + inquirer + chalk 仍然安全可接受

当前性价比最高、最多人正在用、最容易做出「高级感」的组合是：

cac + prompts + picocolors + fs-extra + execa (+ degit)

这就是 2025-2026 年绝大多数「让人用起来很爽」的 create-xxx 工具背后真正的主流技术路线。
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[必知 Express和 MVC]]></title>    <link>https://juejin.cn/post/7594919272687812634</link>    <guid>https://juejin.cn/post/7594919272687812634</guid>    <pubDate>2026-01-14T07:28:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594919272687812634" data-draft-id="7594759496369094666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="必知 Express和 MVC"/> <meta itemprop="keywords" content="前端,Node.js,全栈"/> <meta itemprop="datePublished" content="2026-01-14T07:28:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            必知 Express和 MVC
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:28:35.000Z" title="Wed Jan 14 2026 07:28:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">中间件</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/424ae3f5492646868d5d0bf8b7657f17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=EG1FkqYMOGy2nzxLwbQrbuJU6uQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90a84c55e7d54d3aa6c91d3d8c8b83c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=TG9q1iou6ElXbxQIOMGq9A4rvkY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dd0a5dc2fd3405fb6b8a51546f19bac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Lie1Na2PguMnoxCjjIzcKu%2FvXvI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">简单但重要的发送/响应</h2>
<pre><code class="hljs language-scss" lang="scss">
app<span class="hljs-selector-class">.use</span>(express.json())

 

app<span class="hljs-selector-class">.post</span>('/friends', (req, res) =&gt; {

<span class="hljs-built_in">if</span>(!req.body.name){

return res<span class="hljs-selector-class">.status</span>(<span class="hljs-number">400</span>)<span class="hljs-selector-class">.json</span>({

error:'Missing friend name'

})

}

 

const newFriend = {

name: req.body.name,

id: friends.length

}

 

friends<span class="hljs-selector-class">.push</span>(newFriend)

 

res<span class="hljs-selector-class">.json</span>(newFriend)

})

 

 

app<span class="hljs-selector-class">.get</span>('/friends', (req, res) =&gt; {

res<span class="hljs-selector-class">.json</span>(friends)

})
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29ea489904ab416ca8be496c559abe36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=IkFBkvpb3fkNk51rbGy3o62dMTs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be4f30e894f4037a89bf892172e432d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=bW9z02UzddjfQW0v4paW9q2odiQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be303ff8b8434c2bb5b12e799b1ccdb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=%2FRk%2BXEy8e3OiViuqp3MPCTVjTpA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">MVC(Model  View Controller)</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec49375adbbf49e384f9af9fb985e6eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=RnZ%2Fw8Kj2pOnwO4EDzerknUQzBs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cfee2f89f004c73a7dceee733277944~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=76JlpJFRbAGipHcSIqQBni751F4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0f6cafd26914aa2a17b67edb0052020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=6rwY2ZucEU6A57EjnPwNF0kxTl0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8dfa5f5c06495ba4fdda712fc10898~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=BJLGaSLOpN6cmZzB%2BgVRxuw9xYE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbe553e5b8864dfbb6d816412045e6ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=z7ulTjf1QA02UMa3PyVT%2BPNRa6Y%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">添加 router</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f03c82bde32f42168d02d87fcd7918f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Xp7rZM%2BUROytkldmZiyKz6%2B7nOQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5959ebc846442b8bc7deb39ccbcbd09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Usq1UJt63vEnWkxfnjI4u%2BDYYV0%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">Restful Api</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5202bd57750483eb9c5633b8fa3c6fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=Mc7dE8ufQPY7mSq5WTdYstrkrS4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ecd9072f29847cc8be8bd5fdb649bbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=ZNYR7TwhTImUN9KqMDvtudXO2Uo%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">CRUD</h2>
<p>CRUD 工程师其实很多业务都是以这些操作为主</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/922a7fbc94374a1291b45d7e741498c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=%2BSo%2Fh%2BYrgNyYd5u%2B32wP1jL3KPA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">Template engines</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20aa04e4774c43d0b9d00881f26d073c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768980514&amp;x-signature=5q9RCSIPZl1e%2BpFhoLMPIIlfs3A%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">仓库</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuanhunmao%2FComplete_NodeJS_Developer%2Ftree%2Fmaster%2Fnasa-project" target="_blank" title="https://github.com/huanhunmao/Complete_NodeJS_Developer/tree/master/nasa-project" ref="nofollow noopener noreferrer">github.com/huanhunmao/…</a></p>
<p>感谢点点 star ～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局]]></title>    <link>https://juejin.cn/post/7594854295758553131</link>    <guid>https://juejin.cn/post/7594854295758553131</guid>    <pubDate>2026-01-14T08:41:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594854295758553131" data-draft-id="7594801581003948068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局"/> <meta itemprop="keywords" content="前端,后端,面试"/> <meta itemprop="datePublished" content="2026-01-14T08:41:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Immerse"/> <meta itemprop="url" content="https://juejin.cn/user/2708812817761752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS终于能做瀑布流了！三行代码搞定,告别JavaScript布局
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2708812817761752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Immerse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:41:46.000Z" title="Wed Jan 14 2026 08:41:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是 Immerse，一名独立开发者、内容创作者、AGI 实践者。</p>
<p>关注公众号：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyaolifeng.com%2Fother%2Fwx_public_account.webp" target="_blank" title="https://yaolifeng.com/other/wx_public_account.webp" ref="nofollow noopener noreferrer">沉浸式趣谈</a>，获取最新文章（更多内容只在公众号更新）</p>
<p>个人网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyaolifeng.com" target="_blank" title="https://yaolifeng.com" ref="nofollow noopener noreferrer">yaolifeng.com</a> 也同步更新。</p>
<p>转载请在文章开头注明出处和版权信息。</p>
<p>我会在这里分享关于<code>编程</code>、<code>独立开发</code>、<code>AI干货</code>、<code>开源</code>、<code>个人思考</code>等内容。</p>
<p>如果本文对您有所帮助，欢迎动动小手指一键三连(<code>点赞</code>、<code>评论</code>、<code>转发</code>)，给我一些支持和鼓励，谢谢！</p>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64c14e37477d4f4b83cc9d639e93d6a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=DJWrcxDEbuGMZ3npqvsJUJHGx8U%3D" alt="" loading="lazy"/></p>
<p>之前做瀑布流布局，要么用 Masonry.js 这种库，要么自己写一堆 JavaScript 计算位置。</p>
<p>现在好了，CSS Grid Lanes 来了，三行代码就搞定。</p>
<p>Safari 技术预览版已经支持了，你现在就能试。</p>
<h2 data-id="heading-0">三行代码实现瀑布流</h2>
<p>看最简单的用法。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">250px</span>, <span class="hljs-number">1</span>fr));
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">16px</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9542cd5b39743e18c0b8cb9590ed3c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=K9EZR8s8hF1804%2FS%2Fcg33FWMW14%3D" alt="" loading="lazy"/></p>
<p>就这样。</p>
<p>第一行设置 <code>display: grid-lanes</code>，告诉浏览器用 Grid Lanes 布局。</p>
<p>第二行定义列，至少 250px 宽，自动填充所有可用空间。浏览器会根据屏幕宽度决定显示几列。</p>
<p>第三行设置间距，列与列之间、卡片与卡片之间都是 16px。</p>
<p>不用写 JavaScript，不用算高度，不用考虑响应式。浏览器全帮你搞定了。</p>
<h2 data-id="heading-1">原理是什么？</h2>
<p>把它想象成堵车的高速公路。</p>
<p>每辆车都想往前挤，哪条车道空就往哪条钻。每个新卡片也一样，浏览器会把它放在最靠上的位置。</p>
<p>这样布局出来的效果和 Masonry.js 一模一样，但性能好太多了。</p>
<p>如果你要做无限滚动加载更多内容，也不用 JavaScript 控制布局了。滚到底部加载新数据，浏览器自动把新卡片摆好。</p>
<h2 data-id="heading-2">列宽可以不一样</h2>
<p>因为底层用的是 CSS Grid，你可以做各种花样。</p>
<p>比如奇数列窄，偶数列宽，最后一列始终是窄的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">16rem</span>, <span class="hljs-number">2</span>fr)) <span class="hljs-built_in">minmax</span>(<span class="hljs-number">8rem</span>, <span class="hljs-number">1</span>fr);
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5a5e33fa44f428db81ccb5b4b7c1023~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=bUnrpp1DhIeCN%2FBKlokl7ixT6uk%3D" alt="" loading="lazy"/></p>
<p>这样布局出来就有节奏感了，不会显得太死板。</p>
<h2 data-id="heading-3">卡片可以跨列</h2>
<p>既然是 Grid，那肯定能跨列。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">article</span> {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">1</span>;
}

<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">1</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">4</span>;
}

<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">2</span>),
<span class="hljs-selector-tag">article</span><span class="hljs-selector-pseudo">:nth-child</span>(<span class="hljs-number">3</span>) {
    <span class="hljs-attribute">grid-column</span>: span <span class="hljs-number">2</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8470b6b67f4a608f3dde226073ccc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=wEu7AQed7md7kiyPptBa%2FVob7KQ%3D" alt="" loading="lazy"/></p>
<p>第一张卡片占 4 列做头图，第 2 到第 3 张占 2 列做次要内容，其他的占 1 列。</p>
<p>这种布局以前只能用 JavaScript 计算，现在纯 CSS 就行。</p>
<p>报纸那种复杂版式也能做出来了。</p>
<h2 data-id="heading-4">固定位置也可以</h2>
<p>你还能指定某个元素放在特定位置。</p>
<p>比如把 header 固定在最右边的两列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">main</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">24ch</span>, <span class="hljs-number">1</span>fr));
}

<span class="hljs-selector-tag">header</span> {
    <span class="hljs-attribute">grid-column</span>: -<span class="hljs-number">3</span> / -<span class="hljs-number">1</span>;
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5acbb0117c14c7fa455f435b1097fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=p%2FRyUfLtG1ExQjBhIQZ5WnK9ZhQ%3D" alt="" loading="lazy"/></p>
<p>不管屏幕多宽，header 都会出现在右边。其他内容该怎么排怎么排。</p>
<h2 data-id="heading-5">横向布局也能做</h2>
<p>瀑布流是竖着流，Grid Lanes 也能横着流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/722f59112ec04d458e2b9af3001c3d25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=0X1iEbx0CoZpU76iuFD%2FpegjP2M%3D" alt="" loading="lazy"/></p>
<p>竖着流用 <code>grid-template-columns</code> 定义列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>横着流就用 <code>grid-template-rows</code> 定义行：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
}
</code></pre>
<p>浏览器会根据你定义的是列还是行，自动判断流的方向。</p>
<p>不用额外设置什么属性，它自己就知道。</p>
<h2 data-id="heading-6">容错度控制</h2>
<p>有个新概念叫容错度。</p>
<p>假设第一列的卡片高度是 100px，第四列是 99px。下一张卡片应该放哪？</p>
<p>如果追求绝对精确，应该放第四列，因为它矮 1px。</p>
<p>但这 1px 根本看不出来，而且会导致卡片顺序很乱。用户 Tab 切换时会跳来跳去。</p>
<p>所以 Grid Lanes 有个默认容错度 <code>1em</code>。只有高度差超过 1em，浏览器才会认为它们不一样。</p>
<p>小于 1em 的差异会被忽略，卡片会更倾向于从左到右排列。</p>
<p>你可以调整这个值：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    item-tolerance: <span class="hljs-number">2em</span>;
}
</code></pre>
<p>设大一点，布局更规整，但可能浪费空间。设小一点，空间利用率高，但顺序会更乱。</p>
<p>根据你的内容大小和内容差异来调。</p>
<p>注意这个属性名字可能还会改，正式发布前留意一下。</p>
<h2 data-id="heading-7">现在就能试</h2>
<p>Safari 技术预览版 234 已经支持了。</p>
<p>你可以下载来试试，官方 Demo 网站也更新了新语法。</p>
<p>除了图片瀑布流，还有其他用法。</p>
<p>比如做 Mega Menu 的底部链接区域。每组链接高度不同，用 Grid Lanes 排起来非常整齐：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">display</span>: grid-lanes;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fill, <span class="hljs-built_in">minmax</span>(max-content, <span class="hljs-number">24ch</span>));
    <span class="hljs-attribute">column-gap</span>: <span class="hljs-number">4</span>lh;
}
</code></pre>
<p>各组链接紧密排列，不会浪费空间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de0584f9f30248c8b67b866fbe24993d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984906&amp;x-signature=XDuA8aJG9Juf4LWziWFbTdjmeVE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">接下来呢</h2>
<p>CSS 工作组还有几个细节在讨论，但整体语法已经确定了。</p>
<p>现在可以学起来，可以做 Demo 玩玩，可以给反馈。</p>
<p>WebKit 团队从 2022 年中开始做这个功能，现在终于能用了。</p>
<p>我估计其他浏览器也会很快跟进，毕竟这需求太常见了。</p>
<p>以后做瀑布流，再也不用引 JavaScript 库了。</p>
<h2 data-id="heading-9">参考资料：</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fblog%2F17660%2Fintroducing-css-grid-lanes%2F" target="_blank" title="https://webkit.org/blog/17660/introducing-css-grid-lanes/" ref="nofollow noopener noreferrer">Introducing Grid Lanes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebkit.org%2Fdemos%2Fgrid-lanes%2F" target="_blank" title="https://webkit.org/demos/grid-lanes/" ref="nofollow noopener noreferrer">Example Gallery</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue & React 实战）]]></title>    <link>https://juejin.cn/post/7594817135128412194</link>    <guid>https://juejin.cn/post/7594817135128412194</guid>    <pubDate>2026-01-14T07:49:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594817135128412194" data-draft-id="7594835618119860264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue &amp; React 实战）"/> <meta itemprop="keywords" content="前端,CSS,Vue.js"/> <meta itemprop="datePublished" content="2026-01-14T07:49:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="生椰丝绒拿铁"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 也能“私有化”？揭秘模块化 CSS 的防坑指南（附 Vue &amp; React 实战）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    生椰丝绒拿铁
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T07:49:37.000Z" title="Wed Jan 14 2026 07:49:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“你改你的样式，我改我的样式，咱俩井水不犯河水。”<br/>
—— 一个被全局 CSS 折磨到秃头的前端开发者</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">🌪️ 从前，有个叫“全局污染”的幽灵</h2>
<p>在前端开发的远古时代（其实也就几年前），我们写 CSS 是这样的：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: red;
}
</code></pre>
<p>然后某天，同学也写了 <code>.button</code>，但颜色是蓝色。结果——<strong>按钮变蓝了！</strong><br/>
你一脸懵：“我写的红呢？”<br/>
他更懵：“我也没动你的代码啊！”</p>
<p>这就是 <strong>CSS 全局作用域</strong> 的经典翻车现场。</p>
<p><strong>类名冲突、样式覆盖、调试到凌晨三点……</strong><br/>
于是，聪明的前端工程师们开始思考：<strong>能不能让 CSS 也像 JavaScript 一样“模块化”？</strong></p>
<p>答案是：<strong>能！而且还不止一种方式。</strong></p>
<hr/>
<h2 data-id="heading-1">🧩 模块化 CSS：给样式加上“私有锁”</h2>
<p>模块化 CSS 的核心思想很简单：<strong>每个组件的样式只对自己生效，不污染别人，也不被别人污染。</strong></p>
<p>听起来像“社恐”的理想生活状态？没错！它就是为组件化开发量身定制的“社交距离”。</p>
<p>目前主流框架提供了两种实现路径：</p>
<ul>
<li><strong>Vue：<code>scoped</code> 属性</strong></li>
<li><strong>React：CSS Modules（<code>.module.css</code>）</strong></li>
</ul>
<p>下面，咱们就来拆解这两种“防冲突神器”，顺便看看它们背后的小秘密。</p>
<hr/>
<h2 data-id="heading-2">🎭 Vue 的 <code>scoped</code>：优雅又高效</h2>
<p>在 Vue 单文件组件中，只需加个 <code>scoped</code>，就能自动隔离样式：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"txt"</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.txt</span> {
  <span class="hljs-attribute">color</span>: red;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">🔍 它是怎么做到的？</h3>
<p>Vue 并不会重命名你的类名（比如变成 <code>txt_abc123</code>），而是<strong>在编译时给每个元素加一个唯一的 <code>data-v-xxxxx</code> 属性</strong>，然后把 CSS 选择器也加上这个属性：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;h1 <span class="hljs-attr">class</span>=<span class="hljs-string">"txt"</span> data-v-f3f3eg9&gt;Hello World&lt;/h1&gt;
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.txt</span><span class="hljs-selector-attr">[data-v-f3f3eg9]</span> {
  <span class="hljs-attribute">color</span>: red;
}
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>类名不变，可读性强</li>
<li>编译一次，性能好</li>
<li>写法简洁，零配置</li>
</ul>
<p>❌ <strong>小缺点</strong>：</p>
<ul>
<li>深度选择器（如修改子组件样式）需要特殊语法（<code>::v-deep</code>）</li>
<li>动态生成的 HTML（如 <code>v-html</code>）无法自动带上属性</li>
</ul>
<blockquote>
<p>就像给每个组件发了一张“门禁卡”，只有本组件的人才能进。</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">🧪 React 的 CSS Modules：JS 化的样式对象</h2>
<p>React 本身不处理样式，但通过 <strong>CSS Modules</strong>，我们可以这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button.module.css'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.button}</span>&gt;</span>Click me<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>对应的 <code>Button.module.css</code>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">background</span>: blue;
  <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<h3 data-id="heading-5">🔍 背后发生了什么？</h3>
<p>Webpack（或其他打包工具）会把 <code>.module.css</code> 文件编译成一个 <strong>JS 对象</strong>：</p>
<pre><code class="hljs language-css" lang="css">// 编译后 styles 长这样
{
  <span class="hljs-selector-tag">button</span>: <span class="hljs-string">"Button_button__abc123"</span>
}
</code></pre>
<p>最终渲染的 HTML：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;button <span class="hljs-attr">class</span>=<span class="hljs-string">"Button_button__abc123"</span>&gt;Click me&lt;/button&gt;
</code></pre>
<p>✅ <strong>优点</strong>：</p>
<ul>
<li>类名绝对唯一，彻底隔离</li>
<li>支持动态拼接（<code>className={</code><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>b</mi><mi>t</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">{styles.btn} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span><span class="mord">.</span><span class="mord mathnormal">b</span><span class="mord mathnormal">t</span><span class="mord mathnormal">n</span></span></span></span></span></span>{isActive ? styles.active : ''}<code>}</code>）</li>
<li>适合大型项目、开源组件库</li>
</ul>
<p>❌ <strong>小缺点</strong>：</p>
<ul>
<li>类名被哈希化，调试时看着有点懵</li>
<li>需要手动导入，略显啰嗦</li>
</ul>
<blockquote>
<p>这就像给每个样式贴上了“身份证号”，全球唯一，永不重复。</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">🤔 scoped vs CSS Modules：谁更香？</h2>



































<table><thead><tr><th>特性</th><th>Vue <code>scoped</code></th><th>React CSS Modules</th></tr></thead><tbody><tr><td>配置难度</td><td>零配置</td><td>需要构建工具支持</td></tr><tr><td>类名可读性</td><td>高（原样保留）</td><td>低（哈希化）</td></tr><tr><td>性能</td><td>高（属性选择器）</td><td>中（字符串拼接）</td></tr><tr><td>深度控制</td><td>需 <code>::v-deep</code></td><td>可直接组合类名</td></tr><tr><td>适用场景</td><td>Vue 项目首选</td><td>React / 多人协作 / 开源库</td></tr></tbody></table>
<p><strong>总结一句话</strong>：</p>
<blockquote>
<p>Vue 用 <code>scoped</code> 图省事，React 用 CSS Modules 图安全。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">💡 真实世界的建议</h2>
<ol>
<li><strong>不要混用全局 CSS 和模块化 CSS</strong><br/>
如果你在用 <code>scoped</code> 或 <code>module.css</code>，就别再在全局写 <code>.button</code> 了，否则等于给自己挖坑。</li>
<li><strong>命名依然重要</strong><br/>
即使有模块化，也别写 <code>.a</code>, <code>.b</code> 这种名字。清晰的命名 = 清晰的逻辑。</li>
<li><strong>开源组件请务必模块化</strong><br/>
别人用你的组件，最怕“样式污染”。模块化是基本礼仪！</li>
<li><strong>考虑 CSS-in-JS？</strong><br/>
如 styled-components、Emotion，它们把样式直接写在 JS 里，更极致的模块化。但这是另一个故事了……</li>
</ol>
<hr/>
<h2 data-id="heading-8">🎉 结语：CSS 也可以很“私密”</h2>
<p>从前，CSS 是开放的广场，人人可踩；<br/>
如今，CSS 是带锁的房间，各归其位。</p>
<p>模块化 CSS 不是银弹，但它<strong>极大降低了协作成本，提升了代码可维护性</strong>。<br/>
尤其在团队作战、组件复用、开源共享的今天，它早已不是“可选项”，而是<strong>必备技能</strong>。</p>
<p>所以，下次写样式前，先问自己一句：</p>
<blockquote>
<p>“这行 CSS，真的只属于我吗？”</p>
</blockquote>
<p>如果不是——那就给它上把锁吧 🔒</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 知识总结]]></title>    <link>https://juejin.cn/post/7595021656427364379</link>    <guid>https://juejin.cn/post/7595021656427364379</guid>    <pubDate>2026-01-14T08:00:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427364379" data-draft-id="7594919272688173082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 知识总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:00:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="米诺zuo"/> <meta itemprop="url" content="https://juejin.cn/user/2436173497373399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 知识总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173497373399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    米诺zuo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:00:14.000Z" title="Wed Jan 14 2026 08:00:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">目录</h2>
<ol>
<li><a href="#1-typescript-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8" title="#1-typescript-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8">TypeScript 基础入门</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E8%A7%A3%E6%9E%90" title="#2-%E6%A0%B8%E5%BF%83%E5%86%85%E7%BD%AE%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B%E8%A7%A3%E6%9E%90">核心内置工具类型解析</a></li>
<li><a href="#3-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7" title="#3-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">高级特性</a></li>
<li><a href="#4-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-typescript-%E9%87%8D%E7%82%B9" title="#4-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95-typescript-%E9%87%8D%E7%82%B9">前端面试 TypeScript 重点</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">1. TypeScript 基础入门</h2>
<p>TypeScript 是 JavaScript 的超集，添加了静态类型系统。掌握它是现代前端开发（尤其是 Angular/Vue 3）的基石。</p>
<h3 data-id="heading-2">1.1 为什么要用 TypeScript？</h3>
<ul>
<li><strong>类型安全：</strong> 在编译阶段发现错误，而不是运行时。</li>
<li><strong>更好的代码提示：</strong> IDE 可以根据类型提供精准的自动补全。</li>
<li><strong>代码可维护性：</strong> 接口即文档，让大型项目结构更清晰。</li>
</ul>
<h3 data-id="heading-3">1.2 核心基础概念</h3>
<h4 data-id="heading-4">接口</h4>
<p>定义对象的结构，充当数据的“契约”。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  email?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 可选属性</span>
}
<span class="hljs-keyword">const</span> <span class="hljs-attr">u</span>: <span class="hljs-title class_">User</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span> };
</code></pre>
<h4 data-id="heading-5">类</h4>
<p>面向对象编程的基础，Angular 的组件本质上就是一个类。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> {
  <span class="hljs-attr">brand</span>: <span class="hljs-built_in">string</span>;
  
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">brand: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  }
  <span class="hljs-title function_">drive</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> is driving`</span>);
  }
}
</code></pre>
<h4 data-id="heading-6">装饰器</h4>
<p>一种特殊的语法，用 <code>@</code> 符号标记，用于修改类或属性的行为。Angular 大量使用装饰器（如 <code>@Component</code>, <code>@Injectable</code>）。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">template</span>: <span class="hljs-string">'Hello World'</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppComponent</span> {}
</code></pre>
<h4 data-id="heading-7">泛型</h4>
<p>将类型参数化，提高代码复用性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-keyword">return</span> arg;
}
<span class="hljs-comment">// 使用时指定类型</span>
identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"Hello"</span>);
</code></pre>
<h4 data-id="heading-8">访问修饰符</h4>
<p>控制类成员的访问权限：</p>
<ul>
<li><code>public</code>: 公开，默认值。</li>
<li><code>private</code>: 私有，仅类内部可见。</li>
<li><code>protected</code>: 受保护，仅类及其子类可见。</li>
</ul>
<hr/>
<h2 data-id="heading-9">2. 核心内置工具类型解析</h2>
<p>TypeScript 提供了一系列全局工具类型，用于操作和转换类型。理解它们的源码对于进阶至关重要。</p>
<h3 data-id="heading-10">2.1 Partial - 可选化</h3>
<p><strong>作用：</strong> 将类型 <code>T</code> 的所有属性变为可选。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Partial</span>&lt;T&gt; = {
  [P <span class="hljs-keyword">in</span> keyof T]?: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong> 遍历 <code>T</code> 的所有属性 <code>P</code>，加上 <code>?</code> 修饰符。</li>
</ul>
<h3 data-id="heading-11">2.2 Required - 必选化</h3>
<p><strong>作用：</strong> 将类型 <code>T</code> 的所有属性变为必选（与 <code>Partial</code> 相反）。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Required</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong> 这里的 <code>-?</code> 是核心，意为“移除可选修饰符”。</li>
</ul>
<h3 data-id="heading-12">2.3 Pick - 挑选属性</h3>
<p><strong>作用：</strong> 从 <code>T</code> 中挑选一组属性 <code>K</code>，构成新类型。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Pick</span>&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt; = {
    [P <span class="hljs-keyword">in</span> K]: T[P];
};
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>K extends keyof T</code>: 约束 <code>K</code> 必须是 <code>T</code> 的属性名。</li>
<li><code>[P in K]</code>: 遍历挑选出的属性。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">2.4 Record - 构建对象类型</h3>
<p><strong>作用：</strong> 构建一个对象类型，键名为 <code>K</code>，键值类型为 <code>T</code>。常用于定义字典。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Record</span>&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-built_in">any</span>, T&gt; = {
    [P <span class="hljs-keyword">in</span> K]: T;
};
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>keyof any</code>: 等价于 <code>string | number | symbol</code>，限制键名类型。</li>
<li>所有属性的值都被统一设为 <code>T</code>。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-14">2.5 Exclude - 排除联合类型成员</h3>
<p><strong>作用：</strong> 从联合类型 <code>T</code> 中排除 <code>U</code>。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Exclude</span>&lt;T, U&gt; = T <span class="hljs-keyword">extends</span> U ? <span class="hljs-built_in">never</span> : T;
</code></pre>
<ul>
<li><strong>解析：</strong> 利用<strong>分布式条件类型</strong>。
<ul>
<li>如果 <code>T</code> 中的成员属于 <code>U</code>，返回 <code>never</code>（在联合类型中会被丢弃）。</li>
<li>如果不属于，保留原类型。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">2.6 ReturnType - 获取函数返回值类型</h3>
<p><strong>作用：</strong> 获取函数 <code>T</code> 的返回值类型。
<strong>源码实现：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;
</code></pre>
<ul>
<li><strong>解析：</strong>
<ul>
<li><code>infer R</code>: 推断关键字，表示捕获函数返回位置的类型，并赋值给 <code>R</code>。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-16">3. 高级特性</h2>
<h3 data-id="heading-17">3.1 类型断言</h3>
<p>手动指定值的类型，绕过编译器的检查。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"input"</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLInputElement</span>;
</code></pre>
<h3 data-id="heading-18">3.2 类型守卫</h3>
<p>在运行时确保类型的安全。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"string"</span>) {
  <span class="hljs-comment">// 这里 TS 知道 value 是 string</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-title function_">toUpperCase</span>());
}
</code></pre>
<h3 data-id="heading-19">3.3 联合类型与交叉类型</h3>
<ul>
<li><code>A | B</code>: 表示 A 或 B（“或”逻辑）。</li>
<li><code>A &amp; B</code>: 表示同时具备 A 和 B 的属性（“且”逻辑）。</li>
</ul>
<hr/>
<h2 data-id="heading-20">4. 前端面试 TypeScript 重点</h2>
<p>在面试中，除了基础语法，建议重点准备以下内容：</p>
<h3 data-id="heading-21">4.1 <code>interface</code> vs <code>type</code></h3>
<ul>
<li><strong>Interface:</strong> 只能定义对象，支持继承 (<code>extends</code>) 和同名自动合并。</li>
<li><strong>Type:</strong> 更灵活，支持定义联合类型、元组等，不支持合并，但可以使用交叉类型。</li>
</ul>
<h3 data-id="heading-22">4.2 <code>any</code> vs <code>unknown</code></h3>
<ul>
<li><code>any</code>: 任意类型，关闭类型检查（不推荐滥用）。</li>
<li><code>unknown</code>: 类型安全的任意类型，使用前必须进行类型收窄。</li>
</ul>
<h3 data-id="heading-23">4.3 <code>readonly</code> vs <code>const</code></h3>
<ul>
<li><code>const</code>: 用于变量，防止变量重新赋值。</li>
<li><code>readonly</code>: 用于属性，防止属性被修改（可以配合接口使用）。</li>
</ul>
<h3 data-id="heading-24">4.4 泛型约束</h3>
<p>如何限制泛型的范围：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
  <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}
<span class="hljs-keyword">function</span> loggingIdentity&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>); <span class="hljs-comment">// 现在可以放心使用 .length 了</span>
  <span class="hljs-keyword">return</span> arg;
}
</code></pre>
<h3 data-id="heading-25">4.5 <code>keyof</code> 与 映射类型</h3>
<ul>
<li><code>keyof</code>: 获取类型的所有键，返回联合类型。</li>
<li>映射类型 (<code>[P in keyof T]</code>): 类似 JS 的 <code>for...in</code>，用于遍历和生成新类型。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue.js 3 项目构建神器：Webpack 全攻略]]></title>    <link>https://juejin.cn/post/7595021656427511835</link>    <guid>https://juejin.cn/post/7595021656427511835</guid>    <pubDate>2026-01-14T08:24:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595021656427511835" data-draft-id="7595028805157765130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue.js 3 项目构建神器：Webpack 全攻略"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:24:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全栈王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue.js 3 项目构建神器：Webpack 全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全栈王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:24:21.000Z" title="Wed Jan 14 2026 08:24:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是全栈王校长。</p>
<p>看到这个标题，很多朋友可能会纳闷：现在不是都用 Vite 吗，为什么还要学 Webpack？原因很简单：在大型企业级项目中，稳定性和成熟度才是最重要的考量因素。Webpack 自2013年问世以来，经过了多年的发展和实践检验，生态体系非常完善，几乎任何构建问题都能找到现成的解决方案。而 Vite 虽然轻快，但毕竟2020年才正式发布，生态积淀相对较少。</p>
<p>因此，今天我们就来聊聊如何用 Webpack 构建 Vue.js 3 应用。首先，我们得搞清楚 Webpack 和 Vite 的本质差异，这样才能选对工具。</p>
<h2 data-id="heading-0">Webpack vs Vite：本质差异在哪？</h2>
<p>我一直认为，评判技术的好坏必须结合它的设计初衷。Webpack 和 Vite 的根本区别在于它们的设计理念完全不同。</p>
<p>Vite 定位为现代 Web 开发工具链，它集成了多种构建功能，开发者可以开箱即用。它利用浏览器原生 ES 模块支持，在开发阶段实现快速热更新。</p>
<p>相比之下，Webpack 专注于构建打包本身，它更像是一个构建平台，需要开发者手动配置各种插件和加载器才能实现完整的构建流程。虽然配置复杂，但它提供了更大的灵活性和控制力。</p>
<p>那么，两者的技术能力或者功能有什么异同点呢？</p>
<p>这两种工具在功能上有不少相似之处，都是用来处理前端代码的打包工作。不过它们的实现方式不同：Vite 提供了更多开箱即用的功能，减少了配置工作；而 Webpack 则更灵活，但也需要更多的手动配置。</p>
<p>在实际的企业项目中，稳定可靠比便捷更重要。虽然 Webpack 需要多花些时间配置，但一旦设置好了，后续开发就很稳定。</p>
<p>下面，我们来一步步搭建一个基于 Webpack 的 Vue.js 3 项目。</p>
<h2 data-id="heading-1">Webpack + Vue.js 3 项目搭建全流程</h2>
<p>搭建项目的基本流程包括以下几个环节：</p>
<ol>
<li>准备项目结构和基础代码；</li>
<li>安装必要的依赖包；</li>
<li>设置 Webpack 对 Vue.js 3 的编译选项；</li>
<li>运行编译命令。</li>
</ol>
<p><strong>第一步：规划项目结构</strong>，标准布局如下：</p>
<pre><code class="hljs language-lua" lang="lua">.
├── dist/*
├── <span class="hljs-built_in">package</span>.json
├── src
│   ├── app.vue
│   └── index.js
└── webpack.<span class="hljs-built_in">config</span>.js
</code></pre>
<p>各文件夹及文件的作用说明：</p>
<ul>
<li>dist：存放编译后的成品文件，包括 JS、CSS、HTML 等浏览器可直接运行的静态资源；</li>
<li>package.json：项目配置文件，记录了项目依赖、版本号及脚本命令等信息；</li>
<li>src：源代码存放目录，所有开发工作都在此目录下进行；</li>
<li>webpack.config.js：Webpack 配置文件，定义了如何处理和打包我们的代码。</li>
</ul>
<p>接着我们在 src 目录下创建两个核心文件。首先是组件文件 src/app.vue，代码如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text"</span>&gt;</span>Count: {{state.count}}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onClick"</span>&gt;</span>Add<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
  });
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"/>) =&gt; {
    state.<span class="hljs-property">count</span> ++;
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.demo</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0px</span> <span class="hljs-number">0px</span> <span class="hljs-number">9px</span> <span class="hljs-number">#00000066</span>;
  <span class="hljs-attribute">text-align</span>: center;
}
<span class="hljs-selector-class">.demo</span> <span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
  <span class="hljs-attribute">font-weight</span>: bolder;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666666</span>;
}
<span class="hljs-selector-class">.demo</span> <span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">32px</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
} 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>然后是入口文件 src/index.js，内容如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.vue'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>完成第一步后，<strong>进入第二步：安装项目所需的各种依赖包</strong>。</p>
<p>依赖包分为两类：一类是项目运行时必需的（runtime dependencies），另一类是开发时使用的工具（dev dependencies）。安装时需要用不同的命令参数加以区分。</p>
<p>首先安装运行时依赖（即项目实际需要的库）：</p>
<pre><code class="hljs language-shell" lang="shell">npm i --save vue
</code></pre>
<p>这条命令会把 Vue.js 添加到 package.json 的 dependencies 部分，表示这是项目运行所必需的库。</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.2.37"</span>
  }
}
</code></pre>
<p>接下来安装开发时所需的工具包：</p>
<pre><code class="hljs language-shell" lang="shell">npm i --save-dev css-loader mini-css-extract-plugin vue-loader webpack webpack-cli
</code></pre>
<p>这些工具仅在开发和构建阶段使用，不会出现在最终产品中。它们会被添加到 package.json 的 devDependencies 部分。</p>
<pre><code class="hljs language-javascript" lang="javascript">{
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"css-loader"</span>: <span class="hljs-string">"^6.7.1"</span>,
    <span class="hljs-string">"mini-css-extract-plugin"</span>: <span class="hljs-string">"^2.6.1"</span>,
    <span class="hljs-string">"vue-loader"</span>: <span class="hljs-string">"^17.0.0"</span>,
    <span class="hljs-string">"webpack"</span>: <span class="hljs-string">"^5.74.0"</span>,
    <span class="hljs-string">"webpack-cli"</span>: <span class="hljs-string">"^4.10.0"</span>
  }
}
</code></pre>
<p><strong>第三步：编写 Webpack 配置文件</strong></p>
<p>下面是完整的 webpack.config.js 配置代码，请先看一遍整体结构：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">VueLoaderPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vue-loader'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.vue$/</span>,
        <span class="hljs-attr">loader</span>: <span class="hljs-string">'vue-loader'</span>
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,
          <span class="hljs-string">'css-loader'</span>
        ]
      }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">VueLoaderPlugin</span>(),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'style.css'</span>
    })
  ]
};
</code></pre>
<p>这份配置告诉 Webpack 如何处理我们的 Vue.js 3 代码，包括 JS、CSS 和 Vue 单文件组件，最终生成浏览器可以直接运行的文件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解]]></title>    <link>https://juejin.cn/post/7594801581004374052</link>    <guid>https://juejin.cn/post/7594801581004374052</guid>    <pubDate>2026-01-14T08:41:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7594801581004374052" data-draft-id="7594801581004324900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解"/> <meta itemprop="keywords" content="消息队列"/> <meta itemprop="datePublished" content="2026-01-14T08:41:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="理性的沸羊羊"/> <meta itemprop="url" content="https://juejin.cn/user/2922918847448590"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MQ消息幂等性实战：MQ 负责“不丢”，你负责“不重” —— 基于新增与修改场景的深度拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2922918847448590/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    理性的沸羊羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:41:42.000Z" title="Wed Jan 14 2026 08:41:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b90f78ff8e274bf4be3fd8ed68b53314~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=RlVMddGZIvqznbxqFQ2c%2FpyHVJA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">1. 引言：打破幻觉</h2>
<p>在分布式系统的世界里，我们首先要接受一个残酷的现实：<strong>任何主流的消息中间件（RabbitMQ, Kafka, RocketMQ），都无法保证“Exactly Once”（恰好一次）的投递语义。</strong></p>
<p>它们承诺的是 <strong>“At Least Once”（至少一次）</strong> 。为了保证消息绝不丢失（No Loss），MQ 会在网络抖动、Consumer 响应超时、甚至服务重启时，选择“宁可错杀一千（重复投递），不可放过一个（丢失消息）”。</p>
<p><strong>所以，重复消费不是 Bug，而是分布式系统为了高可靠性必须付出的代价。</strong></p>
<p>如果不处理幂等，后果是灾难性的：</p>
<ul>
<li>用户点了一次下单，系统生成了两笔订单。</li>
<li>用户支付了一次，账户余额被扣了两次。</li>
<li>库存明明只发了一次货，系统扣减了两次库存。</li>
</ul>
<p>今天，我们不谈那些虚无缥缈的理论，我将带你从 <strong>“数据操作类型”</strong> 这个独特的视角，将幂等性问题拆解为 <strong>Insert（新增）</strong> 和 <strong>Update（修改）</strong> 两个战场，逐个击破。</p>
<hr/>
<h2 data-id="heading-1">2. 核心战略：分而治之</h2>
<p>很多开发者的误区在于：试图用一个通用的 <code>Redis setnx</code> 或者是“去重表”解决所有问题。</p>
<p><strong>这是错误的。</strong></p>
<ul>
<li><strong>新增类业务（Insert）</strong> ：关注的是 <strong>“存在性”</strong> 。只要这个 ID 存在了，就坚决不能再生成第二条。</li>
<li><strong>修改类业务（Update）</strong> ：关注的是 <strong>“状态流转”</strong> 或 <strong>“版本控制”</strong> 。允许你执行 SQL，但前提是条件必须满足。</li>
</ul>
<p>针对这两类场景，我们的防御工事完全不同。</p>
<hr/>
<h2 data-id="heading-2">3. 场景一：新增类业务 (Insert) —— 守住底线</h2>
<p><strong>典型场景</strong>：用户注册（不能有两个同名用户）、创建订单（MQ 收到下单消息，不能插入两条订单记录）。 <strong>核心目标</strong>：数据库里绝对不能出现两条一样的记录。</p>
<h3 data-id="heading-3">方案 A（黄金标准）：数据库唯一索引 (Unique Index)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f04805cdca14ab393037c39bec11216~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=uGkGqDmpMLF4jd4gb6OhL%2BAox%2B0%3D" alt="image.png" loading="lazy"/></p>
<p>这是最底层、最硬核、也是最可靠的方案。不管你的代码写得多么花哨，Redis 挂没挂，数据库的唯一索引是最后的防线。</p>
<p><strong>1. 数据库层面 (MySQL DDL)</strong></p>
<p>你需要确保你的业务表中，有一个字段是“全局唯一”的（通常是业务主键，如 <code>order_no</code>，注意不是自增 <code>id</code>）。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_order` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `order_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'业务订单号，幂等核心'</span>,
  `user_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-comment">-- 关键点：建立唯一索引</span>
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_order_no` (`order_no`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'订单表'</span>;
</code></pre>
<p><strong>2. 代码层面 (Java + Spring Boot)</strong></p>
<p>在消费者（Consumer）代码中，我们利用 <code>try-catch</code> 捕获数据库抛出的唯一索引冲突异常。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.dao.DuplicateKeyException;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;
​
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderConsumerService</span> {
​
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
​
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(OrderMessageDTO message)</span> {
        <span class="hljs-type">Order</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        entity.setOrderNo(message.getOrderNo()); <span class="hljs-comment">// 这里的 OrderNo 来自上游，且唯一</span>
        entity.setUserId(message.getUserId());
        entity.setAmount(message.getAmount());
​
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 尝试插入</span>
            orderMapper.insert(entity);
            System.out.println(<span class="hljs-string">"订单创建成功: "</span> + message.getOrderNo());
        } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
            <span class="hljs-comment">// 捕获唯一索引冲突异常</span>
            <span class="hljs-comment">// 这说明是重复消息，直接吞掉异常，视为消费成功</span>
            System.out.println(<span class="hljs-string">"检测到重复订单消息，自动忽略: "</span> + message.getOrderNo());
        }
    }
}
</code></pre>
<h3 data-id="heading-4">方案 B（高性能）：Redis 防重 (SetNX)</h3>
<p>如果你的系统是秒杀级别，或者数据库压力已经很大，不想让每一次重复请求都去撞数据库（撞库会产生数据库行锁，影响性能），那么可以在 DB 之前加一层 Redis 过滤。</p>
<p><strong>核心代码 (StringRedisTemplate)</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.time.Duration;
​
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisIdempotentToken</span> {
​
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
​
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">lock</span><span class="hljs-params">(String bizId)</span> {
        <span class="hljs-comment">// key = 业务前缀 + 业务ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:order:"</span> + bizId;
        
        <span class="hljs-comment">// setIfAbsent 等同于 SETNX</span>
        <span class="hljs-comment">// 关键点：必须设置过期时间！防止服务挂掉后 Key 永久存在，导致该订单永远无法处理</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
                .setIfAbsent(key, <span class="hljs-string">"1"</span>, Duration.ofMinutes(<span class="hljs-number">10</span>));
        
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);
    }
}
​
<span class="hljs-comment">// 消费者伪代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(OrderMessageDTO msg)</span> {
    <span class="hljs-comment">// 1. 先过 Redis 这一关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redisIdempotentToken.lock(msg.getOrderNo());
    <span class="hljs-keyword">if</span> (!lock) {
        log.info(<span class="hljs-string">"重复消息被 Redis 拦截: {}"</span>, msg.getOrderNo());
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 直接 ACK</span>
    }
    
    <span class="hljs-comment">// 2. 再执行数据库操作（数据库最好依然保留唯一索引兜底）</span>
    <span class="hljs-keyword">try</span> {
        orderService.createOrder(msg);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// 如果业务失败，理论上应该删除 Redis key 允许重试</span>
        <span class="hljs-comment">// 但如果这里挂了，Key 会在 10 分钟后自动过期，实现最终一致性</span>
        <span class="hljs-keyword">throw</span> e;
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">4. 场景二：修改类业务 (Update) —— 巧妙利用数据状态</h2>
<p><strong>典型场景</strong>：订单支付成功后，将状态从 <code>UNPAID</code> 改为 <code>PAID</code>；或者扣减库存。 <strong>核心目标</strong>：防止 ABA 问题，或防止重复扣减。</p>
<h3 data-id="heading-6">方案 A（最推荐）：多版本控制/乐观锁 (Optimistic Locking)</h3>
<p>对于库存扣减、余额变更这类涉及“计算”的更新，<strong>乐观锁</strong>是最佳实践。我们给表加一个 <code>version</code> 字段。</p>
<p><strong>1. SQL 原理</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设当前库存是 100，版本号是 5</span>
<span class="hljs-comment">-- 只有当版本号还是 5 的时候，才执行扣减，同时版本号 +1</span>
<span class="hljs-keyword">UPDATE</span> t_product_stock 
<span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> <span class="hljs-number">1</span>, version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span> 
<span class="hljs-keyword">WHERE</span> product_id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
</code></pre>
<p><strong>2. Java DAO 层代码 (MyBatis)</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">StockMapper</span> {
​
    <span class="hljs-comment">/**
     * 乐观锁扣减库存
     * <span class="hljs-doctag">@return</span> 影响行数。1 表示成功，0 表示版本不匹配（已被别人修改或重复请求）
     */</span>
    <span class="hljs-meta">@Update("UPDATE t_product_stock SET stock = stock - #{count}, version = version + 1 " +
            "WHERE product_id = #{productId} AND version = #{oldVersion}")</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(<span class="hljs-meta">@Param("productId")</span> Long productId, 
                    <span class="hljs-meta">@Param("count")</span> Integer count, 
                    <span class="hljs-meta">@Param("oldVersion")</span> Integer oldVersion)</span>;
}
</code></pre>
<p><strong>消费者逻辑：</strong> 消费者先查出当前数据的 version，然后尝试更新。如果返回 <code>0</code>，说明数据变了，此时通常需要重新查询再重试（CAS 自旋），或者根据业务逻辑直接判断为“已处理”。</p>
<h3 data-id="heading-7">方案 B（业务逻辑锁）：状态机 (State Machine)</h3>
<p>对于订单状态流转，我们不需要额外的 <code>version</code> 字段，<strong>状态本身就是锁</strong>。</p>
<p><strong>1. SQL 原理</strong></p>
<p>业务规则：订单只能从 <code>UNPAID</code> (待支付) 变为 <code>PAID</code> (已支付)。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> t_order 
<span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'PAID'</span>, update_time <span class="hljs-operator">=</span> NOW()
<span class="hljs-keyword">WHERE</span> order_no <span class="hljs-operator">=</span> <span class="hljs-string">'ORDER_20240101'</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'UNPAID'</span>;
</code></pre>
<p><strong>2. Java 代码</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">payOrder</span><span class="hljs-params">(String orderNo)</span> {
    <span class="hljs-comment">// 利用 update 的原子性和 where 条件</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> orderMapper.updateStatus(orderNo, <span class="hljs-string">"PAID"</span>, <span class="hljs-string">"UNPAID"</span>);
    
    <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">1</span>) {
        System.out.println(<span class="hljs-string">"订单支付成功，状态更新完成"</span>);
        <span class="hljs-comment">// 后续发货逻辑...</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// rows == 0，意味着：</span>
        <span class="hljs-comment">// 1. 订单不存在（极少）</span>
        <span class="hljs-comment">// 2. 订单状态已经不是 UNPAID 了（可能是 PAID，也可能是 CLOSED）</span>
        <span class="hljs-comment">// 结论：消息是重复的，或者乱序的，直接忽略，视为幂等成功</span>
        System.out.println(<span class="hljs-string">"订单状态不符合或已处理，忽略消息: "</span> + orderNo);
    }
}
</code></pre>
<p>这种方案极其简洁，不需要引入复杂的分布式锁，利用数据库行锁天然解决并发和幂等。</p>
<hr/>
<h2 data-id="heading-8">5. 避坑指南与总结</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7125e9dd6eec415b8643efc20eb81219~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55CG5oCn55qE5rK4576K576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768984902&amp;x-signature=dmt5xteEAx2hYoEsxdMFPR2UpY8%3D" alt="image.png" loading="lazy"/>
在文章的最后，我要提醒大家一个在“Redis + 数据库”混合双打时最容易踩的坑。</p>
<h3 data-id="heading-9">⚠️ 致命坑：Redis 原子性陷阱</h3>
<p><strong>错误流程：</strong></p>
<ol start="0">
<li>消费者收到消息。</li>
<li><code>Redis.setnx</code> 成功。</li>
<li>开始执行 DB 事务。</li>
<li><strong>DB 事务报错/超时/回滚</strong>。</li>
<li>消费者结束，Redis 里的 Key 依然存在。</li>
</ol>
<p><strong>后果：</strong> MQ 会重试这条消息。但第二次进来时，Redis 判断 Key 已存在，认为是重复请求，直接拦截返回成功。 <strong>最终结果：</strong> 数据库里没数据，消息却被丢弃了！<strong>数据丢失！</strong></p>
<p><strong>解决方案：</strong></p>
<ol start="0">
<li><strong>数据库兜底</strong>：Redis 只是为了挡住 99% 的流量，数据库必须依然有唯一索引。</li>
<li><strong>异常删除</strong>：在 catch 代码块中，务必显式删除 Redis Key。</li>
<li><strong>短 TTL</strong>：给 Redis Key 设置合理的过期时间（如 10 分钟），作为最后的容错手段。</li>
</ol>
<h3 data-id="heading-10">📝 终极对比表</h3>








































<table><thead><tr><th>维度</th><th>新增场景 (Insert)</th><th>修改场景 (Update)</th></tr></thead><tbody><tr><td><strong>典型业务</strong></td><td>创建订单、注册用户、新增流水</td><td>扣减库存、更新订单状态、修改余额</td></tr><tr><td><strong>推荐方案</strong></td><td><strong>数据库唯一索引 (Unique Index)</strong></td><td><strong>状态机 (Where Status) / 乐观锁</strong></td></tr><tr><td><strong>备选方案</strong></td><td>Redis SetNX (用于超高并发前置拦截)</td><td>去重表 (适用于跨多表复杂逻辑)</td></tr><tr><td><strong>核心逻辑</strong></td><td>靠“键冲突”来保证</td><td>靠“条件不满足”来保证</td></tr><tr><td><strong>优点</strong></td><td>强一致性，代码简单，不易出错</td><td>性能好，无额外存储开销</td></tr><tr><td><strong>缺点</strong></td><td>数据库写压力大时需配合 Redis</td><td>需要业务有明确的状态流转或版本号</td></tr></tbody></table>
<p>希望这篇文章能帮你彻底厘清 MQ 幂等性的实现思路。记住：<strong>越复杂的代码越容易出 Bug，能利用数据库天然特性解决的，就不要引入外部依赖。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[cloudflare+hono使用worker实现api接口和r2文件存储和下载]]></title>    <link>https://juejin.cn/post/7595028805157912586</link>    <guid>https://juejin.cn/post/7595028805157912586</guid>    <pubDate>2026-01-14T08:37:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7595028805157912586" data-draft-id="7595041883144110126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="cloudflare+hono使用worker实现api接口和r2文件存储和下载"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-14T08:37:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024小神"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            cloudflare+hono使用worker实现api接口和r2文件存储和下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024小神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-14T08:37:12.000Z" title="Wed Jan 14 2026 08:37:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-14
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我的开源项目PakePlus可以将网页/Vue/React项目打包为桌面/手机应用并且小于5M只需几分钟，官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpakeplus.com" target="_blank" title="https://pakeplus.com" ref="nofollow noopener noreferrer">pakeplus.com</a></p><p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/addad47db1a14723b55e1a6e057295a2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2524" loading="lazy"/></p><p/>
<p>步骤也很简单，就是使用命令创建一个hono创建一个基础框架，然后绑定r2对象存储，然后写上传和下载的接口，然后测试发布即可。</p>
<p>使用命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm create cloudflare@latest upload-r2</code></pre>
<p>然后创建后打开，绑定r2:</p>
<p>bucket_name 这里添加你的存储桶名称即可，没有的话，在后台页面创建一个存储桶或者使用命令行创建一个。</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5f5b5cf58d748ac912a4af6a724a2b7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1800" loading="lazy"/></p>
<p>然后运行命令：</p>
<pre><code class="hljs language-bash" lang="bash">wrangler deploy --minify</code></pre>
<p>这个主要是将绑定的存储桶R2可以在代码中使用不提示报错。</p>
<p>然后在index.ts中写上传逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/upload'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> form = <span class="hljs-keyword">await</span> c.<span class="hljs-property">req</span>.<span class="hljs-title function_">parseBody</span>()
    <span class="hljs-keyword">const</span> file = form[<span class="hljs-string">'file'</span>] <span class="hljs-keyword">as</span> <span class="hljs-title class_">File</span>
    <span class="hljs-keyword">if</span> (!file || !file.<span class="hljs-property">name</span>) {
        <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'No file uploaded'</span> }, <span class="hljs-number">400</span>)
    }
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> file.<span class="hljs-title function_">arrayBuffer</span>()
    <span class="hljs-keyword">const</span> object = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">put</span>(file.<span class="hljs-property">name</span>, buffer)
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ object })
})</code></pre>
<p>这个代码主要就是拿到post请求中的file文件，然后使用R2存储到桶里面，写完之后会返回存储后的结果，可以本地运行测试，本地启动服务后，使用postman或者apifox都可以测试：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd9c60a4229c4e848df05ab6fb8d62fc~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1728" loading="lazy"/></p>
<p>说明没有问题，这里可以上传任意类型的文件，访问的时候也可以访问任意类型。为什么不用Express框架？因为Express框架和cf不是很兼容，在访问视频文件或者大文件的时候，和cf不兼容，访问不到。所以强烈推荐Hono这个框架，而且Hono用起来和Express差不多，甚至更方便。</p>
<p/>
<p>然后开始写访问文件逻辑和下载逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/download/:key'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> key = c.<span class="hljs-property">req</span>.<span class="hljs-title function_">param</span>(<span class="hljs-string">'key'</span>)
    <span class="hljs-keyword">const</span> object = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">get</span>(key)
    <span class="hljs-keyword">if</span> (!object) {
        <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'File not found'</span> }, <span class="hljs-number">404</span>)
    }
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">body</span>(object.<span class="hljs-property">body</span>)
})
</code></pre>
<p>这里主要就是发送get请求访问上传的文件，在apifox中访问刚才上传的文件：完美访问</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f953aa4b79444e00a950c142b3d934c2~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1526" loading="lazy"/></p>
<p/>
<p>还可以查询桶里面有哪些文件：</p>
<pre><code class="hljs language-javascript" lang="javascript">
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/files'</span>, <span class="hljs-keyword">async</span> (c) =&gt; {
    <span class="hljs-keyword">const</span> objects = <span class="hljs-keyword">await</span> c.<span class="hljs-property">env</span>.<span class="hljs-property">R2</span>.<span class="hljs-title function_">list</span>()
    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">files</span>: objects.<span class="hljs-property">objects</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">object</span>) =&gt;</span> object.<span class="hljs-property">key</span>) })
})</code></pre>
<p>就会返回文件列表：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b72365c36674d8c849793986c3f87fa~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1540" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>