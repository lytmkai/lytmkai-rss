<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[程序员必备的100道Java面试题（全网最全）]]></title>    <link>https://juejin.cn/post/7578198815729221632</link>    <guid>https://juejin.cn/post/7578198815729221632</guid>    <pubDate>2025-12-01T06:31:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578198815729221632" data-draft-id="7578405594119061538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="程序员必备的100道Java面试题（全网最全）"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2025-12-01T06:31:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            程序员必备的100道Java面试题（全网最全）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:31:03.000Z" title="Mon Dec 01 2025 06:31:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0"><strong>1、简述一下</strong> <strong>JVM</strong> <strong>的内存模型</strong></h4>
<p><strong>1.JVM内存模型简介</strong></p>
<p>JVM定义了不同运行时数据区，他们是用来执行应用程序的。某些区域随着JVM启动及销毁，另外一 些区域的数据是线程性独立的，随着线程创建和销毁。[jvm内存模型]总体架构图如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c772f9ea8b2a415da6550fc36228614c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=5HNkZOEitNPyDG2shGd4L4V1pmI%3D" alt="" loading="lazy"/></p>
<p>        JVM在执行Java程序时，会把它管理的内存划分为若干个的区域，每个区域都有自己的用途和创建销毁时间。如下图所示，可以分为两大部分，线程私有区和共享区。下图是根据自己理解画的一个 JVM内存模型[架构图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0742f29b4ed34a87aa96387ea35aca00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=As85NNgtjwLQGFB7IHWh%2BW8KSNQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>2</strong> <strong>、说说堆和栈的区别</strong></h4>
<p>        栈是运行时单位，代表着逻辑，内含基本数据类型和堆中对象引用，所在区域连续，没有碎片；堆是存储单位，代表着数据，可被多个栈共享（包括成员中基本数据类型、引用和引用对象），所在 区域不连续，会有碎片。</p>
<p><strong>1、功能不同</strong></p>
<p>栈内存用来存储局部变量和方法调用，而堆内存用来存储Java中的对象。无论是成员变量，局部变 量，还是类变量，它们指向的对象都存储在堆内存中。</p>
<p><strong>2、共享性不同</strong></p>
<p>栈内存是线程私有的。   堆内存是所有线程共有的。</p>
<p><strong>3、异常错误不同</strong></p>
<p>如果栈内存或者堆内存不足都会抛出异常。   栈空间不足：java.lang.StackOverFlowError。 堆空间 不足：java.lang.OutOfMemoryError。</p>
<p><strong>4、空间大小</strong></p>
<p>栈的空间大小远远小于堆的。</p>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>3</strong> <strong>、什么是</strong> <strong>Java</strong> <strong>虚拟机？为什么</strong> <strong>Java</strong> <strong>被称作是</strong> <strong>“</strong> <strong>平台无关的编程语</strong> <strong>言</strong> <strong>”</strong> ****<strong>？</strong></h4>
<p>        Java虚拟机是一个可以执行Java字节码的虚拟机进程。Java源文件被编译成能被Java虚拟机执行的字 节码文件   Java被设计成允许应用程序可以运行在任意的平台，而不需要程序员为每一个平台单独重写或者是重新编译。Java虚拟机让这个变为可能，因为它知道底层硬件平台的指令长度和其他特性。</p>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                     即可免费获取**</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1fd933e47c1496f8b03a2e2d346332d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=QMVEDeOxXqERSw8nmrtaMY3LGjs%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>4</strong> <strong>、如何判断对象可以被回收？</strong></h4>
<p>判断对象是否存活一般有两种方式：</p>
<p>****<strong>引用计数：</strong> 每个对象有一个引用计数属性，新增一个引用时计数加1，引用释放时计数减1，计 数为0时可以回收。此方法简单，无法解决对象相互循环引用的问题。</p>
<p>****<strong>可达性分析</strong>（Reachability Analysis）：从GC Roots开始向下搜索，搜索所走过的路径称为引 用链。当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的，不可达对   象。</p>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>5</strong> <strong>、说一下</strong> <strong>JVM</strong> <strong>有哪些垃圾回收器？</strong></h4>
<p>        如果说垃圾收集算法是内存回收的方法论，那么垃圾收集器就是内存回收的具体实现。下图展示了 7种作用于不同分代的收集器，其中用于回收新生代的收集器包括Serial、 PraNew、 Parallel、Scavenge，回收老年代的收集器包括Serial Old、 Parallel Old、CMS，还有用于回收整个Java堆的 G1收集器。不同收集器之间的连线表示它们可以搭配使用。</p>
<p>JVM 中有以下几种常见的垃圾回收器：</p>
<p><strong>Serial 收集器</strong><br/>
- 它是一个单线程的收集器，只使用一个线程去执行垃圾回收任务。在垃圾回收期间，所有用户线程都会被暂停（Stop - The - World，STW）。例如，在新生代回收过程中，它会逐个检查新生代中的对象，判断对象是否还存活。如果对象不再被任何引用链所连接，就将其标记为可回收对象，然后进行回收。<br/>
- 主要采用标记 - 复制算法。新生代被划分为 Eden 区和两个 Survivor 区（From 和 To）。在垃圾回收时，将 Eden 区和 From Survivor 区中存活的对象复制到 To Survivor 区，然后清理 Eden 区和 From Survivor 区。之后交换 From 和 To Survivor 区的角色。<br/>
</p>
<p><strong>ParNew 收集器</strong><br/>
- 它是 Serial 收集器的多线程版本。在新生代回收时，可以启动多个线程同时进行垃圾回收。它也是基于标记 - 复制算法。与 Serial 收集器类似，它会先标记新生代中的存活对象，然后将存活对象复制到 Survivor 区。不过，由于多线程的特性，在复制对象的过程中，多个线程可以并行地从 Eden 区和 From Survivor 区复制对象到 To Survivor 区，从而提高回收效率。<br/>
</p>
<p><strong>Parallel Scavenge 收集器</strong><br/>
- 和 ParNew 收集器一样，它也是多线程的新生代收集器。不过，它的目标是达到一个可控制的吞吐量。它采用标记 - 复制算法。在垃圾回收过程中，它会根据系统的配置（如 -XX:GCTimeRatio 参数设置垃圾回收时间占总运行时间的比例）来调整新生代的大小和垃圾回收的频率。例如，如果设置 -XX:GCTimeRatio=9，意味着垃圾回收时间占总运行时间的 1/10，它会通过调整新生代的大小来尽量满足这个比例要求。<br/>
</p>
<p><strong>Serial Old 收集器</strong></p>
<ol>
<li><strong>工作原理</strong><br/>
- 它是 Serial 收集器的老年代版本。它是单线程的，采用标记 - 整理算法。在垃圾回收时，先标记老年代中的存活对象，然后将存活对象向内存的一端进行整理，清理掉中间的空白区域。这种方式可以避免内存碎片化的问题，因为老年代的对象相对比较稳定，不会频繁地创建和销毁。</li>
<li><strong>适用场景</strong><br/>
- 通常和 Serial 收集器或者 ParNew 收集器配合使用。当新生代的对象晋升到老年代后，可以使用 Serial Old 收集器来回收老年代。它适用于对老年代垃圾回收要求不高的场景，比如一些小型应用或者单核处理器的系统，因为单线程的特性，它的资源消耗相对较小。</li>
</ol>
<p><strong>Parallel Old 收集器</strong><br/>
- 它是 Parallel Scavenge 收集器的老年代版本，采用多线程的标记 - 整理算法。多个线程可以并行地标记老年代中的存活对象，然后将存活对象整理到内存的一端。这种并行的方式可以提高老年代垃圾回收的效率，减少垃圾回收时的停顿时间。<br/>
</p>
<p><strong>G1（Garbage - First）收集器</strong><br/>
- 适合大内存、多核处理器的系统。例如，在一些大型的云计算平台或者大数据处理平台中，堆内存可能非常大，G1 收集器可以高效地管理内存，通过分区域回收的方式，减少垃圾回收的停顿时间，同时避免内存碎片化问题。<br/>
</p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6、什么情况下会内存溢出？</h4>
<p>堆内存溢出：（1）当对象一直创建而不被回收时（2）加载的类越来越多时（3)虚拟机栈的线程越来越多时</p>
<p>栈溢出：方法调用次数过多，一般是递归不当造成</p>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7、对象的创建过程</h4>
<p>（1）检查类是否已被加载，没有加载就先加载类</p>
<p>（2）为对象在堆中分配内存，使用CAS方式分配，防止在为A分配内存时，执行当前地址的指针还没有来得及修改，对象B就拿来分配内存。</p>
<p>（3）初始化，将对象中的属性都分配0值或null</p>
<p>（4）设置对象头</p>
<p>（5）为属性赋值和执行构造方法</p>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8、说说什么是垃圾回收GC？</h4>
<p>       <strong>GC 是 Garbage Collection 的缩写，即垃圾回收。</strong> 它是 Java 虚拟机（JVM）自动管理内存的一种机制。在 Java 程序运行过程中，会不断创建对象，当这些对象不再被使用时，如果不进行回收，就会占用内存空间，导致内存泄漏等问题。GC 的作用就是自动识别并回收这些不再使用的对象所占用的内存，使程序能够高效地运行，而无需程序员手动管理内存。</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9、GC如何判断对象可以被回收？</h4>
<p><strong>（1）引用计数法</strong>：已淘汰，为每个对象添加引用计数器，引用为0时判定可以回收，会有两个对象相互引用无法回收的问题</p>
<p><strong>（2）可达性分析法</strong>：从GCRoot开始往下搜索，搜索过的路径称为引用链，若一个对象GCRoot没有任何的引用链，则判定可以回收</p>
<p>  GCRoot有：虚拟机栈中引用的对象，方法区中静态变量引用的对象，本地方法栈中引用的对象</p>
<h3 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、Java多线程篇</h3>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1、说说什么是Java多线程</h4>
<p>        <strong>在 Java 中，线程是程序执行的最小单位。它可以执行一个任务或者一系列任务。线程是 CPU 调度的基本单位，多个线程可以并发执行，从而提高程序的执行效率。</strong> 例如，在一个文本编辑器程序中，可以有一个线程专门用于处理用户的输入，另一个线程用于自动保存文档，这样可以让用户在输入文字的同时，程序后台自动保存文档，提高用户体验。</p>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                     即可免费获取**</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1fd933e47c1496f8b03a2e2d346332d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=QMVEDeOxXqERSw8nmrtaMY3LGjs%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2、说说线程与进程的区别</h4>
<p><strong>进程：</strong></p>
<p>        <strong>进程是操作系统进行资源分配和调度的一个独立单位。</strong> 它包含了程序运行所需的所有资源，如内存空间、文件描述符等。一个 Java 应用程序运行时就是一个进程，比如启动一个 Java Web 服务，它就是一个独立的进程。</p>
<p><strong>线程：</strong></p>
<p>       <strong>线程是进程中的一个执行单元，一个进程可以包含多个线程。</strong> 线程共享所属进程的资源，如内存空间。在 Java 中，线程的创建和管理是由 Java 虚拟机（JVM）和操作系统共同完成的。例如，在一个 Java Web 服务进程中，可以有多个线程处理不同的 HTTP 请求，这些线程共享进程的内存空间，包括类加载器加载的类信息、静态变量等。</p>
<h4 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3、Java 中创建线程的方式</h4>
<p><strong>（一）继承 Thread 类</strong></p>
<p>        创建一个继承自 Thread 类的子类。重写 run() 方法，在 run() 方法中编写线程要执行的任务代码。创建 Thread 子类的实例对象。调用 start() 方法启动线程。</p>
<p><strong>（二）实现 Runnable 接口</strong></p>
<p>        创建一个实现了 Runnable 接口的类。实现 run() 方法，在 run() 方法中编写线程要执行的任务代码。创建 Runnable 实现类的实例对象。创建 Thread 类的实例对象，并将 Runnable 实现类的实例对象作为参数传递给 Thread 类的构造方法。调用 Thread 类实例对象的 start() 方法启动线程。</p>
<p><strong>（三）使用 Callable 和 Future</strong></p>
<p>        创建一个实现了 Callable 接口的类。实现 call() 方法，在 call() 方法中编写线程要执行的任务代码，并且可以返回一个结果。创建 Callable 实现类的实例对象。使用 Executors 工具类创建一个 ExecutorService 线程池。调用 ExecutorService 的 submit() 方法提交 Callable 任务，该方法会返回一个 Future 对象。通过 Future 对象的 get() 方法获取线程执行的结果。</p>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4、什么是线程上下文切换</h4>
<p>当一个线程被剥夺cpu使用权时，切换到另外一个线程执行</p>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5、什么是死锁</h4>
<p>死锁指多个线程在执行过程中，因争夺资源造成的一种相互等待的僵局</p>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6、什么是AQS锁?</h4>
<p>        AQS是一个抽象类，可以用来构造锁和同步类，如ReentrantLock，Semaphore，CountDownLatch，CyclicBarrier。</p>
<p>        AQS的原理是，AQS内部有三个核心组件，一个是state代表加锁状态初始值为0，一个是获取到锁的线程，还有一个阻塞队列。当有线程想获取锁时，会以CAS的形式将state变为1，CAS成功后便将加锁线程设为自己。当其他线程来竞争锁时会判断state是不是0，不是0再判断加锁线程是不是自己，不是的话就把自己放入阻塞队列。这个阻塞队列是用双向链表实现的</p>
<p>        可重入锁的原理就是每次加锁时判断一下加锁线程是不是自己，是的话state+1，释放锁的时候就将state-1。当state减到0的时候就去唤醒阻塞队列的第一个线程。</p>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7、有哪些常见的AQS锁</h4>
<p>        AQS（AbstractQueuedSynchronizer）是 Java 并发包 <code>java.util.concurrent.locks</code> 中的一个核心类，用于构建锁和其他同步组件。AQS 提供了一种基于 FIFO 等待队列的机制，用于管理线程的获取和释放资源的顺序，并提供了一些模板方法供子类实现具体的同步策略。以下是一些常见的基于 AQS 实现的锁：</p>
<p><strong>ReentrantLock（可重入锁）</strong><br/>
允许同一个线程多次获取锁，每次获取锁时计数器加一，每次释放锁时计数器减一，直到计数器为 0 时才完全释放锁。支持公平锁（按照请求顺序分配锁）和非公平锁（允许插队）。<br/>
使用场景：替代 <code>synchronized</code> 关键字，提供更灵活的锁定机制。 </p>
<p><strong>ReentrantReadWriteLock（可重入读写锁）</strong><br/>
将读操作与写操作分离，允许多个读操作并发执行，但写操作是排他的，即只有一个线程可以进行写操作，并且写操作会阻塞所有其他读写操作。<br/>
使用场景：适用于读多写少的情况，提高并发性能。 </p>
<p><strong>Semaphore（信号量）</strong><br/>
用于控制同时访问某个资源的线程数量。它可以用来限制同时执行的线程数，或者实现资源池的管理。<br/>
使用场景：限制资源的并发访问，例如数据库连接池、线程池等。 </p>
<p><strong>CountDownLatch</strong><br/>
允许一个或多个线程等待其他线程完成一组操作后再继续执行。初始化时设定一个计数值，每个事件完成后调用 <code>countDown()</code> 方法使计数递减，当计数达到零时，所有因调用 <code>await()</code> 方法而等待的线程被释放。<br/>
使用场景：确保某些操作在继续之前完成，比如等待所有子线程完成任务后主线程再继续。 </p>
<p><strong>CyclicBarrier（循环屏障）</strong><br/>
允许一组线程相互等待，直到所有线程都达到某个公共屏障点后再继续执行。它常用于分阶段的任务并行执行。<br/>
使用场景：分阶段的任务并行执行，例如多线程计算任务的每个阶段都需要所有线程完成后再进入下一个阶段。 </p>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>8</strong> <strong>、</strong> <strong>Thread</strong> <strong>类中的</strong> <strong>yield</strong> <strong>方法有什么作用？</strong></h4>
<p>        Yield方法可以暂停当前正在执行的线程对象，让其它有相同优先级的线程执行。它是一个静态方法 而且只保证当前线程放弃CPU占用而不能保证使其它线程一定能占用CPU，执行yield()的线程有可   能在进入到暂停状态后马上又被执行。</p>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>9</strong> <strong>、</strong> <strong>Java</strong> <strong>线程池中</strong> <strong>submit()</strong> <strong>和</strong> <strong>execute()</strong> <strong>方法有什么区别？</strong></h4>
<p>        两个方法都可以向线程池提交任务， execute()方法的返回类型是void，它定义在Executor接口中,    而submit()方法可以返回持有计算结果的Future对象，它定义在ExecutorService接口中，它扩展了 Executor接口，其它线程池类像ThreadPoolExecutor和ScheduledThreadPoolExecutor都有这些  方法。</p>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>10</strong> <strong>、说一说自己对于</strong> <strong>synchronized</strong> <strong>关键字的了解</strong></h4>
<p>        synchronized关键字解决的是多个线程之间访问资源的同步性，synchronized关键字可以保证被它修饰的方法或者代码块在任意时刻只能有一个线程执行。</p>
<p>        另外，在 Java 早期版本中，synchronized属于重量级锁，效率低下，因为监视器锁（monitor）是依赖于底层的操作系统的Mutex Lock 来实现的，Java 的线程是映射到操作系统的原生线程之上的。如果要挂起或者唤醒一 个线程，都需要操作系统帮忙完成，而操作系统实现线程之间的切换时需要从用户态转换到内核态，这个状态之间的转换需要相对比较长的时间，时间成本相对较高，这也是为什么早期的synchronized 效率低的原因。庆幸的是在 Java 6 之后 Java 官方对从 JVM 层面对synchronized 较大优化，所以现在的 synchronized 锁效率也优化得很不错了。JDK1.6对锁的实现引入了大量的优 化，如自旋锁、适应性自旋锁、锁消除、锁粗化、偏向锁、轻量级锁等技术来减少锁操作的开销。</p>
<h4 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>11、sleep()和wait()的区别</h4>
<p> (1)wait()是Object的方法，sleep()是Thread类的方法</p>
<p>(2)wait()会释放锁，sleep()不会释放锁</p>
<p>(3)wait()要在同步方法或者同步代码块中执行，sleep()没有限制</p>
<p>(4)wait()要调用notify()或notifyall()唤醒,sleep()自动唤醒</p>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>12</strong> <strong>、</strong> <strong>volatile</strong> <strong>关键字的作用？</strong></h4>
<p>        volatile 是 Java 中的一个关键字，用于修饰变量。它主要解决多线程环境下的可见性和禁止指令重排序的问题。</p>
<p>        volatile关键字保证变量的可见性和有序性，不保证原子性。使用了 volatile 修饰变量后，在变量修改后会立即同步到主存中，每次用这个变量前会从主存刷新。</p>
<h4 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>13、什么是CAS锁</h4>
<p>        CAS锁可以保证原子性，思想是更新内存时会判断内存值是否被别人修改过，如果没有就直接更新。如果被修改，就重新获取值，直到更新完成为止。这样的缺点是：</p>
<p>（1）只能支持一个变量的原子操作，不能保证整个代码块的原子操作 </p>
<p>（2）CAS频繁失败导致CPU开销大</p>
<p>（3）ABS问题:线程1和线程2同时去修改一个变量，将值从A改为B，但线程1突然阻塞，此时线程2将A改为B,然后线程3又将B改成A,此时线程1将A又改为B,这个过程线程2是不知道的，这就是ABA问题，可以通过版本号或时间戳解决</p>
<h4 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>14</strong> <strong>、说说</strong> <strong>ThreadLocal</strong> <strong>原理？</strong></h4>
<p><code>   ThreadLocal</code> 是 Java 中的一个类，用于创建线程局部变量。每个线程可以访问自己内部的变量副本，而不会与其他线程的变量副本发生冲突。这在多线程编程中非常有用，可以避免线程之间的数据共享和同步问题。</p>
<p><strong>使用场景</strong></p>
<ol>
<li><strong>避免共享资源的同步问题</strong>：在多线程环境中，共享资源的同步是一个常见的问题。使用 <code>ThreadLocal</code> 可以为每个线程提供独立的变量副本，从而避免了线程之间的竞争条件。</li>
<li><strong>管理线程上下文</strong>：在一些场景中，需要在多个方法调用之间传递线程上下文信息，例如事务管理、用户身份信息等。<code>ThreadLocal</code> 可以方便地实现这一点，而不需要在每个方法参数中传递这些信息。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dce23e11749b48859e493fe65159a6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=1XIOKjaM%2Fq0k2JQe0CEuYoRYOm0%3D" alt="" loading="lazy"/></p>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                     即可免费获取**</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1fd933e47c1496f8b03a2e2d346332d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179828&amp;x-signature=QMVEDeOxXqERSw8nmrtaMY3LGjs%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>15</strong> <strong>、多线程有什么用？</strong></h4>
<p>        一个可能在很多人看来很扯淡的一个问题：我会用多线程就好了，还管它有什么用？在我看来，这 个回答更扯淡。所谓"知其然知其所以然" ，"会用"只是"知其然" ，"为什么用"才是"知其所以然" ，只 有达到"知其然知其所以然"的程度才可以说是把一个知识点运用自如。  OK，下面说说我对这个问题 的看法：</p>
<p>（1）发挥多核CPU的优势</p>
<p>        随着工业的进步，现在的笔记本、台式机乃至商用的应用服务器至少也都是双核的，4核、 8核甚至 16核的也都不少见，如果是单线程的程序，那么在双核CPU上就浪费了50%，在4核CPU上就浪费   了75%。<strong>单核</strong> <strong>CPU</strong> <strong>上所谓的</strong> <strong>"</strong> <strong>多线程</strong> <strong>"</strong> <strong>那是假的多线程，同一时间处理器只会处理一段逻辑，只不过</strong> ****<strong>线程之间切换得比较快，看着像多个线程</strong> <strong>"</strong> <strong>同时</strong> <strong>"</strong> <strong>运行罢了</strong>。多核CPU上的多线程才是真正的多线程，它能让你的多段逻辑同时工作，多线程，可以真正发挥出多核CPU的优势来，达到充分利用 CPU的目的。</p>
<p>（2）防止阻塞</p>
<p>        从程序运行效率的角度来看，单核CPU不但不会发挥出多线程的优势，反而会因为在单核CPU上运 行多线程导致线程上下文的切换，而降低程序整体的效率。但是单核CPU我们还是要应用多线程， 就是为了防止阻塞。试想，如果单核CPU使用单线程，那么只要这个线程阻塞了，比方说远程读取 某个数据吧，对端迟迟未返回又没有设置超时时间，那么你的整个程序在数据返回回来之前就停止运行了。多线程可以防止这个问题，多条线程同时运行，哪怕一条线程的代码执行读取数据阻塞，也不会影响其它任务的执行。</p>
<p>（3）便于建模</p>
<p>        这是另外一个没有这么明显的优点了。假设有一个大的任务A ，单线程编程，那么就要考虑很多，建立整个程序模型比较麻烦。但是如果把这个大的任务A分解成几个小任务，任务B、任务C、任务 D ，分别建立程序模型，并通过多线程分别运行这几个任务，那就简单很多了。</p>
<h3 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>四、Mysql篇</h3>
<h4 data-id="heading-26"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>1</strong> <strong>、数据库的三范式是什么</strong></h4>
<p>        第一范式：列不可再分</p>
<p>        第二范式：行可以唯一区分，主键约束</p>
<p>        第三范式：表的非主属性不能依赖与 其他表的非主属性外键约束且三大范式是一级一级依赖的，第二范式建立在第一范式上，第三范式建立第一第二范式上。</p>
<h4 data-id="heading-27"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2、什么是事务？</h4>
<p><strong>事务是一系列操作，这些操作要么全部成功，要么全部失败。事务确保数据库的完整性。</strong></p>
<p>  原子性：组成一个事务的多个数据库操作是一个不可分割的原子单元，只有所有操作都成功， 整个事务才会提交。任何一个操作失败，已经执行的任何操作都必须撤销，让数据库返回初始 状态。</p>
<p>  一致性：事务操作成功后，数据库所处的状态和它的业务规则是一致的。即数据不会被破坏。 如A转账100元给B，不管操作是否成功，A和B的账户总额是不变的。</p>
<p>  隔离性：在并发数据操作时，不同的事务拥有各自的数据空间，它们的操作不会对彼此产生干 扰</p>
<p>  持久性：一旦事务提交成功，事务中的所有操作都必须持久化到数据库中。</p>
<h4 data-id="heading-28"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3、事务的隔离级别有哪些？</h4>
<p>事务的隔离级别有以下几种：</p>
<p><strong>READ UNCOMMITTED</strong>：<strong>读取未提交</strong>，允许读取未提交的事务数据，可能会出现脏读。</p>
<p><strong>READ COMMITTED</strong>：<strong>读取已提交</strong>，只能读取已提交的事务数据，避免了脏读，但可能会出现不可重复读。</p>
<p><strong>REPEATABLE READ</strong>：<strong>可重复读</strong>，确保在同一个事务中多次读取同一数据时，结果一致，避免了不可重复读，但可能会出现幻读。</p>
<p><strong>SERIALIZABLE：可串行化</strong>，最高的隔离级别，避免了脏读、不可重复读和幻读，但性能开销最大。</p>



































<table><thead><tr><th><strong>隔离级别</strong></th><th><strong>脏读</strong></th><th><strong>不可重复读</strong></th><th><strong>幻影读</strong></th></tr></thead><tbody><tr><td>读未提交  READ-UNCOMMITTED</td><td>√</td><td>√</td><td>√</td></tr><tr><td>读提交  READ-COMMITTED</td><td>×</td><td>√</td><td>√</td></tr><tr><td>可重复读  REPEATABLE-READ</td><td>×</td><td>×</td><td>√</td></tr><tr><td>串行化  SERIALIZABLE</td><td>×</td><td>×</td><td>×</td></tr></tbody></table>
<h4 data-id="heading-29"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4、如何优化 SQL 查询？</h4>
<p><strong>索引</strong>：为经常查询的列创建索引，可以加快查询速度。</p>
<p><strong>查询优化</strong>：避免使用 <code>SELECT *</code>，只查询需要的列；使用 <code>EXPLAIN</code> 分析查询计划，优化复杂的查询。</p>
<p><strong>分页查询</strong>：使用 <code>LIMIT</code> 和 <code>OFFSET</code> 进行分页查询，减少数据传输量。</p>
<p><strong>避免子查询</strong>：尽量使用 <code>JOIN</code> 替代子查询，提高查询效率。</p>
<h4 data-id="heading-30"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5、如何优化数据库表结构？</h4>
<p><strong>范式化</strong>：遵循数据库范式，减少数据冗余，提高数据一致性。</p>
<p><strong>反范式化</strong>：在某些情况下，适当的数据冗余可以提高查询性能，但需要权衡。</p>
<p><strong>分区</strong>：对大表进行分区，可以提高查询和维护效率。</p>
<h4 data-id="heading-31"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6、如何优化数据库连接？</h4>
<p><strong>连接池</strong>：使用连接池（如 HikariCP、DBCP、C3P0）管理数据库连接，减少连接的创建和销毁开销。</p>
<p><strong>连接复用</strong>：合理配置连接池参数，确保连接的复用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个人就是一支队伍：从 Next.js 到显示器，聊聊我的“全栈续航”方案]]></title>    <link>https://juejin.cn/post/7578198815729762304</link>    <guid>https://juejin.cn/post/7578198815729762304</guid>    <pubDate>2025-12-01T07:20:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578198815729762304" data-draft-id="7577718777481855014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个人就是一支队伍：从 Next.js 到显示器，聊聊我的“全栈续航”方案"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-01T07:20:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HashTang"/> <meta itemprop="url" content="https://juejin.cn/user/1117561754756488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个人就是一支队伍：从 Next.js 到显示器，聊聊我的“全栈续航”方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117561754756488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HashTang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:20:15.000Z" title="Mon Dec 01 2025 07:20:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>之前写完那篇 <a href="https://juejin.cn/post/7564921269491580943" target="_blank" title="https://juejin.cn/post/7564921269491580943">《Next.js 零成本全栈出海》</a> 的文章后，很多人问的不是技术细节，而是一个很现实的问题：“你一个人搞全栈，又要写码又要运维又要搞 AI，身体和眼睛怎么顶得住？”</p>
<p>说实话，顶不住是常态。</p>
<p>独立开发最难的不是技术栈，而是<strong>续航</strong>。大厂有轮岗，我们没有。如果说 Next.js 是武器，那每天面对的工作环境就是后勤。最近为了适应 AI 辅助编程的节奏，我把软硬件环境做了一次大调整。</p>
<p>今天不聊虚的，分享一下我是怎么把这套“不仅费脑子，还巨费眼睛”的工作流理顺的。</p>
<h2 data-id="heading-0">当我不“写”代码之后</h2>
<p>这一年，我从单纯的“敲代码”，被迫变成了一个“看代码”的人。这直接改变了我的软件选择，现在有一个新词挺贴切的：<strong>AI 善后工程师</strong>。</p>
<h3 data-id="heading-1">被 AI 倒逼的工作流</h3>
<p>我现在的主力环境是 <strong>Next.js + Claude Code / TRAE SOLO</strong>。</p>
<p>以前写一个带鉴权的 API，我得手搓 40 分钟。现在用 <strong>Claude Code</strong> 或者 <strong>TRAE</strong> 的 SOLO 模式，也就是两三句话的事：</p>
<blockquote>
<p>“基于 Prisma Schema 生成 API，带 Zod 校验和测试文件，写完之后生成 openAPI 格式的接口文档。”</p>
</blockquote>
<p>AI 几秒钟就能把代码甩到我脸上。效率确实是 10 倍提升。</p>
<h3 data-id="heading-2">“信息过载”的痛点</h3>
<p>以前写代码，屏幕上只有当前光标附近的几十行。</p>
<p>现在跟 AI 结对编程，屏幕上是爆发的信息流：</p>
<ol>
<li><strong>Prompt 很长</strong>：为了准确，上下文往往几百字。</li>
<li><strong>AI 废话多</strong>：它会解释一堆逻辑（虽然后来我都跳过不看）。</li>
<li><strong>代码量大</strong>：以前一行行写，现在是一屏屏出。</li>
</ol>
<p>相信用过的都懂，这种刷屏速度，与其说是写代码，不如说是在做“代码阅读理解”。我发现最累的不是思考逻辑，而是疯狂划触摸板。要在 Prompt、AI 的解释、生成的代码、以及 Git Diff 之间来回反复横跳。为了不被 AI 的信息流淹没，我总结了三条“AI 善后”的生存法则：</p>
<h4 data-id="heading-3">1.让编译器当第一道“防波堤”</h4>
<p>以前我写代码是“构思 -&gt; 编码 -&gt; 运行”。现在流程变了，变成了“Prompt -&gt; 生成 -&gt; <strong>看报错</strong>”。 由于 AI 生成速度极快，我养成了一个习惯：<strong>绝对不先看代码逻辑，而是先看</strong> <strong>TypeScript</strong> <strong>报错。</strong> 如果是 <code>Next.js</code> 项目，我会在 Prompt 里强制要求：“<strong>生成代码后，请确保通过</strong> <strong>ESLint</strong> <strong>和 TypeScript 严格模式检查，不要使用</strong> <strong><code>any</code></strong>。” 如果在 <code>TRAE</code> 或 <code>Claude Code</code> 里看到生成完有红线，直接甩回一句“Fix type errors”，看都不要看。让机器去对付机器，人的精力只留给用来审视业务逻辑，而不是帮 AI 查语法。</p>
<h4 data-id="heading-4">2.学会“静音”指令</h4>
<p>Claude 和 GPT 最大的毛病就是“好为人师”。明明只改了一行配置，它非要给你写一篇 500 字的小作文解释原理。 对于全栈开发者来说，屏幕空间寸土寸金。我现在常用的 Prompt 结尾都会带上一句：</p>
<blockquote>
<p><em>"No verbal explanation, just code blocks. If explanation is needed, use comments in code."</em> （<strong>不要废话，只给代码。如果有必要解释，写在注释里。</strong> ） 这样能把屏幕的有效信息密度提升 30%，大大减少滚轮滑动的距离。</p>
</blockquote>
<h4 data-id="heading-5">3.“增量式”的上下文投喂</h4>
<p>很多时候 AI 开始胡言乱语，是因为我们把整个文件都丢给了它。 <code>Claude Code</code> 和 <code>TRAE</code> 的优势在于它们能读取本地文件，但我发现**“少即是多”**。 在修改一个 API 时，我只把 <code>schema.prisma</code> 和当前的 <code>route.ts</code> 喂给它，坚决不让它读取无关的 <code>Components</code>。限制它的视野，不仅能减少 Token 消耗，更能防止它产生幻觉，改了不该改的地方——这在后期的 Code Review 简直是灾难。</p>
<p><strong>但即使做好了这些软件层面的优化，物理层面的瓶颈依然存在。</strong> 这就回到了我前面说的问题：当我对 AI 进行了层层“调教”后，它吐出的代码依然是爆发式的。 这时我发现，限制效率的不再是手速，而是屏幕的“显示行数”</p>
<h2 data-id="heading-6">新显示器的使用体验</h2>
<p>为了解决“划触摸板划到手酸”和“看 Diff 看到眼瞎”的问题，我准备换个显示器，于是我把问题抛给了 Gemini，习惯了 AI 不离手之后，日常有问题第一个想到的就是他。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf81ed5cb2884eedb3d58e6e0d35a77e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=2O5kjP2fMnGPcwYqzGeroAexeWc%3D" alt="" loading="lazy"/></p>
<p>看他吹得这么神，我决定试试水：<strong>明基 BenQ RD280U</strong>。</p>
<p>用了一段时间，还是有点不一样的感受的。先说结论：它不是什么“完美神屏”，它就是专门给写代码的人做的一个偏科生。</p>
<h3 data-id="heading-7">3:2 比例：为了多看那十几行</h3>
<p>拿到这块屏第一感觉是“方”。它不是常见的 16:9，而是 <strong>3:2</strong>。如果你拿它看电影，上下会有大黑边，体验一般。但如果你是写代码的，这个比例真的舒服。逻辑通常是纵向流动的。在自带的屏幕上，由于高度的问题，只能展示 256-290 区间的代码行数。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84050e1ba34b4206b7500f4439f462b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=2yonJSW8BwbWTERY9nwtVv00PxU%3D" alt="" loading="lazy"/></p>
<p>在 RD280U (3840x2560) 上，我能在同样的编辑器、同样的配置下，显示 256-307 区间的代码行数 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3482c78ba6be4f81b6cd98dca3aefc89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=G3EDAfb2%2FTq83jaquD5UkCJVBik%3D" alt="" loading="lazy"/></p>
<p>少滑动几次触摸板，对保持思路连贯性真的挺重要。多出来的这 18.5% 纵向空间，就是给“上下文”留的。看到这里，肯定有老哥会说：“想要纵向空间，我直接把副屏竖起来不就行了？”我以前也是这么干的，但在 AI 时代，这招不好使了。</p>
<p><strong>第一，竖屏是“颈椎杀手”。</strong> 27 寸的 16:9 竖起来像座塔。看头部代码要仰头，看底部终端要低头，这种高频的“点头运动”比看横屏累得多。3:2 是在不需要大幅度动脖子的情况下，人眼能覆盖的最佳纵向视野。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e652cbd6551c45cd8abfee8e322b5233~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=RNA1CTXi5Lwti672ynoedpjsYs8%3D" alt="" loading="lazy"/></p>
<p><strong>第二，也是更关键的：AI 需要“宽度”。</strong> 以前竖屏好用，是因为我们只写代码。现在用 TRAE SOLO，左边任务栏，中间偏左挂着一个 AI Chat ，中间偏右是代码区域，最右边是代码结构目录。现在是 Mac 自带显示器的展示效果， 如果是 16:9 的竖屏，这是人类能看的？阅读体验极差。</p>
<p><strong>3:2 的妙处就在于：它够高，能装下长逻辑；它也够宽，能在挂着 AI 侧边栏的同时，保证主代码区不折行。</strong></p>
<h3 data-id="heading-8">终于能看清 Dark Mode 了</h3>
<p>这是他的第二个优点。</p>
<p>程序员 90% 的时间都在用 Dark Mode。自带的显示器或者我之前在公司用的普通外置显示器，通病是黑得不纯，有点发灰。加上 IDE 里那些深蓝、深灰的语法高亮，混在一起非常累眼，尤其是在找 Bug 或者看 Diff 的时候。RD280U 有个 Coding Mode，专门调过对比度。简单说，就是把背景压得更黑，把变量名、关键字的亮度提上来。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9273b2b5ffae4e8581e411be3b769b24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=dkE7nLL3f5lfB%2FtUWyEQsmozfVI%3D" alt="" loading="lazy"/></p>
<p>一看对比还是挺明显的，Mac 显示器有点发白（在我的印象里，Mac 的显示器能秒杀市面上 98% 的显示器）。这不是什么玄学，调整了代码系列参数后，对比度和其他参数更适合呈现语法高亮，眼睛不用费劲去对焦。在快速 Review AI 生成的那一堆代码时，这种清晰度能帮我更快地扫一眼他生成的代码逻辑。</p>
<h3 data-id="heading-9">关于“护眼”：背光不是为了耍帅</h3>
<p>独立开发经常熬夜，我习惯关灯写代码（虽然医生不建议）。</p>
<p>在正常的情况下，关灯后屏幕太亮，开灯屏幕又有反光。</p>
<p>不过，这台显示器后面带个叫 <strong>MoonHalo</strong> 的背光灯。这东西真不是为了搞电竞 RGB 光效，它其实是做<strong>偏差照明</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/073b9171c0ab4befaaadbf8138684ff4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=4%2BPnnYuMerHjQ4nXLPSKYj1cVp4%3D" alt="" loading="lazy"/></p>
<p>你敢信这是没开房间灯的场景？原理很简单：在屏幕后面补点光，减少屏幕和周围环境的亮度反差，眼睛就不会那么容易酸。配合它的 <strong>雾面屏</strong>（抗反光做得确实不错，加了德国莱茵认证的抗反射图层，光源分散情况和普通屏幕对比非常明显），现在深夜写代码，至少不会感觉是在盯着一个手电筒看。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8019afa261a45a8a34bb1d7e6ee427c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=fZZKqRGJluDMoavGyQ0qRKruP1g%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">Display Pilot 2 的妙用</h3>
<p>作为一个被 Mac 惯坏的用户，我最烦的就是去摸显示器背后那几个“反人类”的实体按键——永远分不清哪个是确认，哪个是返回。</p>
<p>这款显示器最让我惊喜的是它的配套软件（Display Pilot 2）。安装后，它就像 Mac 的原生“控制中心”一样 。</p>
<p><strong>你完全可以在系统里直接调节屏幕亮度、对比度，甚至切换显示模式。</strong> 比如白天写代码用“Coding - 深色主题”模式，晚上看文档切换到“电子书”模式，只需要鼠标点一下，不用起身，也不用盲操作。</p>
<p>看截图就能感受到，这种把硬件参数“软件化”的操作，才符合程序员追求的高效直觉。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a877cd70ca2429d839a1706b9d1e94c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaFRhbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765178414&amp;x-signature=uOiOYf9FjCG4zRQC%2BfClC5a9dcE%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-11">总结</h3>
<p>这套“Next.js + Vibe Coding + 方屏显示器”的组合，就是我现在应对高强度开发的方案。</p>
<p><strong>Claude Code / TRAE SOLO 帮我省了手速，显示器帮我省了眼力。</strong></p>
<p>BenQ RD280U 这东西，优缺点很明显：</p>
<ul>
<li><strong>缺点</strong>：看电影有黑边，玩游戏视野不够广，价格也不算便宜。</li>
<li><strong>优点</strong>：写代码、看文档、看网页，只要是纵向阅读的内容，体验确实比宽屏好太多。</li>
</ul>
<p>如果你也是那种一天要在 IDE 里泡 8-10 个小时以上的开发者，我的建议是换个好点的显示器。</p>
<p>毕竟代码可以重构，视力不可逆。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpreadJS 电子表格权限管控设置指南]]></title>    <link>https://juejin.cn/post/7578198815729500160</link>    <guid>https://juejin.cn/post/7578198815729500160</guid>    <pubDate>2025-12-01T06:50:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578198815729500160" data-draft-id="7578198815729434624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpreadJS 电子表格权限管控设置指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T06:50:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="葡萄城技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868332765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpreadJS 电子表格权限管控设置指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868332765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    葡萄城技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:50:57.000Z" title="Mon Dec 01 2025 06:50:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">SpreadJS 电子表格权限管控设置指南</h2>
<blockquote>
<p>电子表格作为企业数据存储、分析与协作的核心工具，常包含财务数据、客户信息、业务机密等敏感内容。一旦权限管控不当，可能引发数据泄露、误修改、版本混乱等风险。本节课我们将以 SpreadJS 为核心，从访问权限控制、数据安全控制、协作权限控制等维度，提供一套完整的权限管控实操指南。</p>
</blockquote>
<h2 data-id="heading-1">一、访问权限控制</h2>
<blockquote>
<p>访问权限控制主要限制的是用户的操作权限，这里又细分为以下三种：</p>
</blockquote>
<h3 data-id="heading-2">1、文件级权限 - 控制 "谁能打开文件"</h3>
<p>SpreadJS支持在导入和导出xlsx文件时使用密码进行加密和解密。</p>
<h4 data-id="heading-3">API 设置</h4>
<p>导出示例：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> password = <span class="hljs-string">"spreadjs2023"</span>;
spread.<span class="hljs-title function_">export</span>(<span class="hljs-function"><span class="hljs-params">blob</span> =&gt;</span> <span class="hljs-title function_">saveAs</span>(blob, <span class="hljs-string">"encrypted-export.xlsx"</span>), <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>, {
   <span class="hljs-attr">fileType</span>: <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-property">FileType</span>.<span class="hljs-property">excel</span>,
   <span class="hljs-attr">password</span>: password
});
</code></pre>
<p>导入示例：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">spread.<span class="hljs-keyword">import</span>(file, successCallback, <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error.<span class="hljs-property">errorMessage</span>, <span class="hljs-string">`Error Code: <span class="hljs-subst">${error.errorCode}</span>`</span>);
}, {
   <span class="hljs-attr">fileType</span>: <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-property">FileType</span>.<span class="hljs-property">excel</span>,
   <span class="hljs-attr">password</span>: password
})
</code></pre>
<h4 data-id="heading-4">Designer UI操作</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd791e4f36994b95b2ba56611456d2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=5CiYI%2BfImiITzgcUya%2BJChaDAYw%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-5">2、内容级权限 - 控制 "能修改哪些内容"</h3>
<h4 data-id="heading-6">2.1 限制对工作表的编辑操作</h4>
<h5 data-id="heading-7">表单保护</h5>
<blockquote>
<p>针对单个工作表，可禁止修改单元格内容、格式、插入删除行 / 列等操作，仅保留必要权限（如仅允许填写指定单元格）。</p>
</blockquote>
<h6 data-id="heading-8">API设置</h6>
<pre><code class="hljs language-JavaScript" lang="JavaScript">sheet.<span class="hljs-property">options</span>.<span class="hljs-property">isProtected</span> = <span class="hljs-literal">true</span>;
</code></pre>
<p>密码保护：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">var</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">'&lt;user_input&gt;'</span>;
sheet.protect
(password);
<span class="hljs-comment">// ...</span>
<span class="hljs-keyword">if</span> (sheet.hasPassword()) {
      <span class="hljs-type">var</span> <span class="hljs-variable">passwordUnlock</span> <span class="hljs-operator">=</span> <span class="hljs-string">'&lt;user_input&gt;'</span>;
      <span class="hljs-type">var</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> sheet.unprotect(passwordUnlock);
      <span class="hljs-comment">// ...</span>
} <span class="hljs-keyword">else</span> {
      sheet.unprotect(); <span class="hljs-comment">// or sheet.options.isProtect = false;</span>
}
</code></pre>
<h6 data-id="heading-9">Designer UI操作</h6>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27310c03655c4b97bfe9557de98d35c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=Kw2QloT3aYyV9hAQ6sXAXngW%2BM4%3D" alt="img" loading="lazy"/></p>
<h5 data-id="heading-10">单元格锁定</h5>
<p>通过将 <strong>locked</strong> 方法设置为False，允许用户编辑受保护工作表中的特定单元格。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">sheet.<span class="hljs-title function_">getCell</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>, <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-property">SheetArea</span>.<span class="hljs-property">viewport</span>).<span class="hljs-title function_">locked</span>(<span class="hljs-literal">false</span>);
sheet.<span class="hljs-title function_">setValue</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-string">"unLocked"</span>);
sheet.<span class="hljs-title function_">getRange</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">3</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).<span class="hljs-title function_">locked</span>(<span class="hljs-literal">false</span>);
sheet.<span class="hljs-title function_">getRange</span>(<span class="hljs-number">5</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>).<span class="hljs-title function_">locked</span>(<span class="hljs-literal">false</span>);
sheet.<span class="hljs-property">options</span>.<span class="hljs-property">isProtected</span> = <span class="hljs-literal">true</span>;
</code></pre>
<h5 data-id="heading-11">单元格禁止编辑：</h5>
<p>使用 Style 类的 <code>allowEditInCell</code> 属性或 CellRange 类的<code>allowEditInCell</code> 属性禁用单元格编辑。默认情况下，该属性是启用的。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">var</span> sheet = spread.<span class="hljs-title function_">getActiveSheet</span>();
<span class="hljs-comment">// 使用 Style 类的 allowEditInCell 属性</span>
<span class="hljs-keyword">var</span> style = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-title class_">Style</span>();
style.<span class="hljs-property">allowEditInCell</span> = <span class="hljs-literal">false</span>;
sheet.<span class="hljs-title function_">setStyle</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, style);
</code></pre>
<h5 data-id="heading-12">公式隐藏：</h5>
<p>使用 Style 类的 hidden 属性或 CellRange 类的 hidden 方法来控制受保护工作表中公式单元格的可见性。默认情况下，hidden 属性设置为 false，表示公式不会被隐藏。</p>
<blockquote>
<p>hidden 属性在某些场景下非常有用，比如根据员工自评和主管评估生成 KPI 数据或年终奖金时，老板希望隐藏相关公式并保护评估系统。</p>
</blockquote>
<p>此代码示例使用 GC.Spread.Sheets.CellRange 类型中的隐藏方法：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">activeSheet.<span class="hljs-property">options</span>.<span class="hljs-property">isProtected</span> = <span class="hljs-literal">true</span>;
activeSheet.<span class="hljs-title function_">setFormula</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"=SUM(10,20)"</span>);
activeSheet.<span class="hljs-title function_">getRange</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-property">SheetArea</span>.<span class="hljs-property">viewport</span>).<span class="hljs-title function_">hidden</span>(<span class="hljs-literal">true</span>);
</code></pre>
<h4 data-id="heading-13">2.2 隐藏敏感内容：仅显示必要信息</h4>
<h5 data-id="heading-14">工作表选项卡：</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 通过设置 tabStripVisible 控制是否显示工作表标签。</span>
spread.<span class="hljs-property">options</span>.<span class="hljs-property">tabStripVisible</span> = <span class="hljs-literal">false</span>;
<span class="hljs-comment">// 将 tabNavigationVisible 设置为 false 可以隐藏导航箭头按钮（默认显示）</span>
spread.<span class="hljs-property">options</span>.<span class="hljs-property">tabNavigationVisible</span> = <span class="hljs-literal">false</span>;
<span class="hljs-comment">//设置 newTabVisible 选项，可以允许或禁止用户通过点击"+"按钮添加工作表（默认显示）。</span>
spread.<span class="hljs-property">options</span>.<span class="hljs-property">newTabVisible</span> = <span class="hljs-literal">false</span>;
<span class="hljs-comment">// 通过 allSheetsListVisible 选项控制"≡"按钮是否可见</span>
spread.<span class="hljs-property">options</span>.<span class="hljs-property">allSheetsListVisible</span> = <span class="hljs-variable constant_">GC</span>.<span class="hljs-property">Spread</span>.<span class="hljs-property">Sheets</span>.<span class="hljs-property">AllSheetsListVisibility</span>.<span class="hljs-property">auto</span>;
</code></pre>
<h5 data-id="heading-15">sheet可见性：</h5>
<ul>
<li>hidden：工作表标签被隐藏，等于false。</li>
<li>visible：工作表标签可见，等于true，为sheetTabVisible的默认值。</li>
<li>veryHidden：工作表选项卡深度隐藏。</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 隐藏sheet</span>
sheet.<span class="hljs-title function_">visible</span>(<span class="hljs-literal">false</span>);
<span class="hljs-comment">// 深度隐藏一个工作表（这意味着它不能通过 UI 取消隐藏）</span>
sheet.<span class="hljs-title function_">visible</span>(<span class="hljs-title class_">SheetTabVisible</span>.<span class="hljs-property">veryHidden</span>);
</code></pre>
<h5 data-id="heading-16">隐藏行列头：</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 是否显示行列头</span>
sheet.<span class="hljs-property">options</span>.<span class="hljs-property">rowHeaderVisible</span> = <span class="hljs-literal">false</span>;
sheet.<span class="hljs-property">options</span>.<span class="hljs-property">colHeaderVisible</span> = <span class="hljs-literal">false</span>;
</code></pre>
<h5 data-id="heading-17">隐藏右键菜单：</h5>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 设置是否展示上下文菜单。</span>
spread.<span class="hljs-property">options</span>.<span class="hljs-property">allowContextMenu</span> = <span class="hljs-literal">false</span>;
</code></pre>
<h3 data-id="heading-18">3、功能级权限 - 控制 "能操作哪些功能"</h3>
<blockquote>
<p>通过对在线表格编辑器（Designer）二次开发定制，可实现工具栏、上下文菜单、文件菜单等功能项的增删改操作。</p>
</blockquote>
<p>例如：</p>
<ul>
<li>开启表单保护后，工具栏部分button可用 （禁用状态）</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c21c249060a499aaab1547fffa0b11a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=NG4FVPgQpWrO%2Bfz67XsLGnm0Os8%3D" alt="img" loading="lazy"/></p>
<ul>
<li>删除/禁用菜单项</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b53f39b8c5a4feb8dad9803dc555761~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=qw4d%2FQQR6alh97makfFu6pe3Lws%3D" alt="img" loading="lazy"/></p>
<ul>
<li>删除文件菜单-导入文件的入口</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9fb0d09a3b9487299eac0a9f0ad57c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=Lob2o9Hfsx%2BZNeWf%2Fxl5BbI6juY%3D" alt="img" loading="lazy"/></p>
<h2 data-id="heading-19">二、数据安全控制</h2>
<blockquote>
<p><strong>数据验证</strong> 与<strong>条件格式</strong>的深度应用，能从 "数据输入合法性""风险可视化预警" 两个维度，为电子表格权限管理筑起更精细的安全防线。</p>
</blockquote>
<h3 data-id="heading-20">数据验证</h3>
<blockquote>
<p>数据验证是电子表格 "权限管理前置化" 的关键手段 ------ 它能限制用户 "能输入什么数据"，从源头避免非法操作和数据污染，本质是对 "数据编辑权限" 的精细化管控。</p>
</blockquote>
<h4 data-id="heading-21">1、下拉列表：锁定合法数据范围</h4>
<blockquote>
<p>通过设置下拉列表，可强制用户从预设选项中选择输入值，避免随意录入导致的数据混乱，同时也限定了 "谁能输入哪些内容" 的权限边界。</p>
</blockquote>
<ul>
<li><strong>场景</strong>：</li>
</ul>
<p>财务报销单的 "费用类型" 列，仅允许选择 "差旅费、办公费、招待费"；</p>
<p>HR 报表的 "员工状态" 列，仅开放 "在职、离职、试用期" 选项。</p>
<h4 data-id="heading-22">2、 输入值范围限制：杜绝越权或错误输入</h4>
<blockquote>
<p>通过限定数值、日期的输入范围，可避免用户录入超出权限或逻辑范围的数据。</p>
</blockquote>
<ul>
<li><strong>场景</strong>：</li>
</ul>
<p>如 "采购单价" 列，限定输入范围为<code>0-1000</code>（防止录入负数或天价采购单）；</p>
<p>"员工年龄" 列限定<code>18-65</code>（符合劳动法逻辑）。</p>
<h4 data-id="heading-23">3、 自定义公式验证：复杂场景的权限逻辑</h4>
<blockquote>
<p>对于更复杂的权限或数据逻辑，可通过自定义公式实现验证。</p>
</blockquote>
<ul>
<li><strong>场景</strong>：</li>
</ul>
<p>若 "发票金额" 列需小于 "合同金额" 列，可在发票金额单元格设置公式：<code>=B2&gt;A2</code>（B2 为发票金额，A2 为合同金额），仅当公式返回<code>TRUE</code>时允许输入。</p>
<h4 data-id="heading-24">4、输入提示与错误警告：权限的可视化指引</h4>
<blockquote>
<p>为数据验证添加 "输入信息" 和 "错误警告"，可明确告知用户权限边界和操作规范。</p>
</blockquote>
<h3 data-id="heading-25">条件格式</h3>
<blockquote>
<p>条件格式是 "权限风险的可视化雷达"------ 它能自动标记出越权、违规或高风险数据，让权限问题从 "隐藏" 变为 "直观可见"，便于管理员快速审计和干预。
通过颜色、图标标记出超出权限或逻辑的数据，实现 "风险可视化"。</p>
</blockquote>
<ul>
<li><strong>场景</strong>：</li>
</ul>
<p>若某列 "客户等级" 仅允许 "普通、VIP"，而出现 "SVIP" 时，用红色填充单元格并标记警告图标。</p>
<h3 data-id="heading-26">结合管理示例</h3>
<blockquote>
<p>将数据验证和条件格式结合，可形成 "预防 - 监控 - 审计" 的权限管理闭环。数据验证（预防非法输入）→ 条件格式（监控违规数据）</p>
</blockquote>
<ul>
<li><strong>场景：采购审批表</strong></li>
</ul>
<p>① 数据验证："采购金额" 列仅允许输入<code>0-5000</code>（普通员工权限），超出范围需经理审批；</p>
<p>② 条件格式：对 "采购金额&gt; 5000" 的单元格标记为红色，并添加 "需经理审批" 的批注；</p>
<p>③ 结果：普通员工无法录入超 5000 的金额（预防），若因特殊情况录入（或经理录入），则自动标红提醒（监控），便于后续审计。</p>
<h2 data-id="heading-27">三、协作权限控制</h2>
<blockquote>
<p>随着数字化转型加速，远程办公渗透率已超40%，跨地域、跨部门协作成为企业常态。传统电子表格管理面临版本混乱失控、协作效率低下、权限管控薄弱等问题。针对于此，SpreadJS 协同编辑插件提供全方位解决方案，让表格协作从混乱低效走向有序高效。</p>
</blockquote>
<h3 data-id="heading-28">多人实时协作</h3>
<blockquote>
<p>打破单人编辑限制，实现多人实时协作，大幅提升团队效率：</p>
</blockquote>
<ul>
<li>支持团队多人同时编辑，操作实时同步无延迟</li>
<li>显示协作者光标与编辑状态，避免操作冲突</li>
<li>智能冲突解决，自动处理交叉编辑场景</li>
<li>编辑即时生效，无需手动刷新或文件上传</li>
<li>较传统模式提升协作效率60%以上，团队首选</li>
</ul>
<h3 data-id="heading-29">全链路版本管理</h3>
<blockquote>
<p>告别"文件_v2_final"式的混乱命名，提供自动化版本管理：</p>
</blockquote>
<ul>
<li>生成版本快照，记录编辑人、时间与修改内容</li>
<li>可视化版本对比，清晰展示差异变化</li>
<li>一键回溯历史版本，杜绝数据丢失风险</li>
<li>支持版本命名与备注，重要节点一目了然</li>
</ul>
<h3 data-id="heading-30">精细化权限体系</h3>
<blockquote>
<p>从整体到单元格的多维权限控制，兼顾数据安全与协作自由</p>
</blockquote>
<ul>
<li>支持单元格/行/列/工作表多级权限设置</li>
<li>灵活角色定义：查看者 vs 编辑者</li>
<li>动态权限调整，随需变更访问权限</li>
<li>敏感数据智能隐藏，未授权用户不可见</li>
<li>完整操作日志记录，变更轨迹一目了然</li>
</ul>
<p>在线体验地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.grapecity.com.cn%2Fspreadjs%2Fdemos%2Fcollaboration%2Flogin" target="_blank" title="https://demo.grapecity.com.cn/spreadjs/demos/collaboration/login" ref="nofollow noopener noreferrer">demo.grapecity.com.cn/spreadjs/de…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3945fc8eb467482ebd1e1f7465a30344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGh6JCE5Z-O5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176657&amp;x-signature=6O%2BXLX%2FuyiI2nylrEBDGuSDegIk%3D" alt="img" loading="lazy"/></p>
<h2 data-id="heading-31"><strong>结语</strong></h2>
<p>在数据价值日益凸显的今天，电子表格作为企业数据流转的核心载体，其权限管控已成为数据安全体系的重要一环。希望本文的指南能为读者带来帮助，让电子表格在安全可控的前提下，充分发挥数据存储、分析与协作的核心价值，成为支撑业务高效运转的可靠工具。</p>
<h3 data-id="heading-32">扩展链接</h3>
<p>学习指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.grapecity.com.cn%2Fspreadjs%2FSpreadJSTutorial%2F" target="_blank" title="https://demo.grapecity.com.cn/spreadjs/SpreadJSTutorial/" ref="nofollow noopener noreferrer">demo.grapecity.com.cn/spreadjs/Sp…</a></p>
<p>产品文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.grapecity.com.cn%2Fspreadjs%2Fhelp%2Fdocs%2Foverview" target="_blank" title="https://demo.grapecity.com.cn/spreadjs/help/docs/overview" ref="nofollow noopener noreferrer">demo.grapecity.com.cn/spreadjs/he…</a></p>
<p>产品首页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.grapecity.com.cn%2Fdeveloper%2Fspreadjs" target="_blank" title="https://www.grapecity.com.cn/developer/spreadjs" ref="nofollow noopener noreferrer">www.grapecity.com.cn/developer/s…</a></p>
<p>在线Excel：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.grapecity.com.cn%2FSpreadJS%2FWebDesigner%2Findex.html" target="_blank" title="https://demo.grapecity.com.cn/SpreadJS/WebDesigner/index.html" ref="nofollow noopener noreferrer">demo.grapecity.com.cn/SpreadJS/We…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS 架构设计：5 分钟抓住 DDD 的命脉]]></title>    <link>https://juejin.cn/post/7578198815729696768</link>    <guid>https://juejin.cn/post/7578198815729696768</guid>    <pubDate>2025-12-01T07:15:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578198815729696768" data-draft-id="7578198815729074176" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS 架构设计：5 分钟抓住 DDD 的命脉"/> <meta itemprop="keywords" content="Node.js"/> <meta itemprop="datePublished" content="2025-12-01T07:15:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="黄永标hyb"/> <meta itemprop="url" content="https://juejin.cn/user/8451822197277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS 架构设计：5 分钟抓住 DDD 的命脉
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/8451822197277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    黄永标hyb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:15:18.000Z" title="Mon Dec 01 2025 07:15:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>NestJS 是目前最流行的 Node 企业级框架。如果你是一位前端开发，又想学习后端开发，我建议你去学习 NestJS，为什么这么说，虽然其他 Node 框架也能搭建后端服务，但是我感觉这些框架缺乏后端的灵魂，后端最重要的东西其实是架构和思想，而 NestJS 的 <strong>IOC</strong>、<strong>AOP</strong> 等架构能力开箱即用，其设计理念与 Java 中的 Spring 框架高度对标。如果你打算开发一个结构复杂、可维护性强的 Node 服务，同时想去接触前端很少接触到的概念，那就用 NestJS 吧。</p>
<p>本篇文章是 NestJS 架构设计系列的开篇文章，提到 <strong>DDD（Domain-Driven Design，领域驱动设计）</strong>，很多人都会觉得它难以理解，网上也有很多文章介绍，但往往充斥着<strong>通用语言</strong>、<strong>限界上下文</strong>、<strong>战略设计</strong>、<strong>战术设计</strong>等抽象术语，读完后仍一头雾水。</p>
<p>本篇文章不会讲这些抽象术语，而是聚焦实战。我们将以一个真实的 NestJS 中大型企业级项目为背景，用 5 分钟时间带你抓住 DDD 的核心命脉。</p>
<p>其实，DDD 的本质思想非常简单：<strong>让代码结构真实反映业务逻辑，而不是围绕数据库表结构来组织代码</strong>。</p>
<h2 data-id="heading-1">DDD 的核心：分层架构</h2>
<p>DDD 最核心的概念就是<strong>分层架构</strong>，理解它你就能完全抓取 DDD 的命脉。在 NestJS 企业级项目中，某个业务模块代码通常被划分为三层：</p>
<pre><code class="hljs language-js" lang="js">packages/app/src/modules/
├── domain/            # 领域层：业务的核心逻辑
│   ├── entity/        # 领域实体（<span class="hljs-title class_">Entity</span>）
│   ├── service/       # 领域服务（<span class="hljs-title class_">Domain</span> <span class="hljs-title class_">Service</span>）
│   └── repository/    # 仓储接口（<span class="hljs-title class_">Repository</span> <span class="hljs-title class_">Interface</span>）
├── app/               # 应用层：协调用例与外部交互
│   ├── usecase/       # 应用用例（<span class="hljs-title class_">Use</span> <span class="hljs-title class_">Case</span>）
│   └── adapter/       # 适配器（如 <span class="hljs-title class_">Controller</span>、外部服务代理等）
└── client/            # 客户端层：面向外部的数据契约
    ├── dto/           # 数据传输对象（<span class="hljs-variable constant_">DTO</span>）
    └── event/         # 领域事件（<span class="hljs-title class_">Domain</span> <span class="hljs-title class_">Event</span>）
</code></pre>
<p>我们逐一解释下以上每层的概念：</p>
<h3 data-id="heading-2">领域层：业务的核心逻辑</h3>
<p>领域层是业务逻辑的核心，它不依赖任何外部框架、数据库或外部服务，只关注业务本身。领域层包括<strong>领域实体（Entity）、领域服务（Domain Service）和仓储（Repository）</strong>。</p>
<h4 data-id="heading-3">领域实体（Entity）</h4>
<p>领域实体是业务的核心对象，是具有唯一标识的对象，它包含<strong>业务属性</strong>和<strong>业务方法</strong>，以 User 实体为例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 领域实体示例：User</span>
@<span class="hljs-title class_">Entity</span>({
  <span class="hljs-attr">tableName</span>: <span class="hljs-string">'users'</span>,
  <span class="hljs-attr">customRepository</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">UserRepository</span>,
})
@<span class="hljs-title class_">SoftDeletable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseEntity</span> {
  <span class="hljs-comment">// 业务属性 </span>
  @<span class="hljs-title class_">PrimaryKey</span>()
  <span class="hljs-attr">id</span>: number;
  
  @<span class="hljs-title class_">Property</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">StringType</span> })
  <span class="hljs-attr">name</span>: string;
  
  <span class="hljs-comment">// 业务方法</span>
  <span class="hljs-title function_">setPassword</span>(<span class="hljs-params">password: string</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_password</span> = <span class="hljs-title function_">bcryptHash</span>(password, <span class="hljs-number">10</span>);
  }

  <span class="hljs-title function_">getPassword</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_password</span>;
  }
}
</code></pre>
<p>实体不仅包含业务属性，更重要的是封装了业务方法。例如以上 User 实体中的 <code>setPassword</code> 方法体现了领域逻辑的内聚性，密码加密逻辑被封装在实体内部，而不是暴露给外部。</p>
<h4 data-id="heading-4">领域服务（Domain Service）</h4>
<p>当某个业务逻辑跨越多个实体，或不适合归属到单一实体时，就应将其提取为领域服务：</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateRpcModuleService</span> {
  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">rpcModuleRepository</span>: <span class="hljs-title class_">RpcModuleRepository</span>;
  
  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">domainEventPublisher</span>: <span class="hljs-title class_">DomainEventPublisher</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">projectId</span>: number, <span class="hljs-attr">userId</span>: number, <span class="hljs-attr">createRpcModuleDto</span>: <span class="hljs-title class_">CreateRpcModuleDto</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">RpcModule</span>&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">createData</span>: <span class="hljs-title class_">PartialEntityDto</span>&lt;<span class="hljs-title class_">RpcModule</span>&gt; = {
      ...createRpcModuleDto,
      projectId,
      <span class="hljs-attr">creatorId</span>: userId,
      <span class="hljs-attr">editorId</span>: userId,
    };
    
    <span class="hljs-comment">// 通过 Repository 操作数据</span>
    <span class="hljs-keyword">const</span> entity = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rpcModuleRepository</span>.<span class="hljs-title function_">create</span>(createData);

    <span class="hljs-comment">// 通过发布领域事件，通知其他业务模块</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RpcModuleCreateEvent</span>(entity);

    <span class="hljs-keyword">return</span> entity;
  }
}
</code></pre>
<p>领域服务通过<strong>依赖注入</strong>获取仓库 <code>rpcModuleRepository</code>、领域事件发布方法 <code>domainEventPublisher</code> 执行复杂的业务逻辑，确保业务规则的一致性。这里我们要注意如下关键点：</p>
<ul>
<li><strong>领域服务只关注业务逻辑</strong>，不关心数据如何存储；</li>
<li><strong>通过 <code>Repository</code> 操作数据</strong>，而不是直接调用 ORM 或数据库；</li>
<li><strong>通过发布领域事件</strong>，通知其他业务模块，解耦业务副作用，如通知、日志、缓存更新等。</li>
</ul>
<h4 data-id="heading-5">仓储（Repository）：数据访问的抽象</h4>
<p>仓储是<strong>领域层</strong>与<strong>数据访问层</strong>之间的桥梁，其核心价值在于：</p>
<ul>
<li><strong>封装数据访问逻辑</strong>：领域层无需关心底层存储细节（如 MySQL、MongoDB 等），实现解耦；</li>
<li><strong>提供具有业务语义的查询方法</strong>：方法命名体现业务意图（如 <code>findOneByIdAndProjectId</code>），而非暴露原始 SQL 或查询构造器；</li>
<li><strong>保护领域模型的完整性</strong>：确保对聚合根或实体的访问必须通过仓储，避免绕过业务规则直接操作数据。</li>
</ul>
<p>看一个例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcModuleRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EntityRepository</span>&lt;<span class="hljs-title class_">RpcModule</span>&gt; {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">findOneByIdAndProjectId</span>(<span class="hljs-attr">id</span>: number, <span class="hljs-attr">projectId</span>: number): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">RpcModule</span>&gt; {
    <span class="hljs-keyword">if</span> (!id) {
      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">ExceptionFactory</span>.<span class="hljs-title function_">bizException</span>(<span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">NOT_FOUND</span>);
    }

    <span class="hljs-keyword">const</span> entity = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">findOne</span>({
      id,
      projectId,
    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">FilterQuery</span>&lt;<span class="hljs-title class_">RpcModule</span>&gt;);
    <span class="hljs-keyword">if</span> (!entity) {
      <span class="hljs-keyword">throw</span> <span class="hljs-title class_">ExceptionFactory</span>.<span class="hljs-title function_">bizException</span>(<span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">NOT_FOUND</span>);
    }

    <span class="hljs-keyword">return</span> entity;
  }
}
</code></pre>
<p>在这个例子中，仓储不仅封装了数据查询，还内嵌了业务方法：</p>
<ul>
<li>自动校验 <code>projectId</code>，确保项目级的数据隔离；</li>
<li>在未找到实体时抛出业务异常，而非返回 <code>null</code>，避免上游调用者处理空值逻辑；</li>
<li>隐藏了底层 ORM 或数据库的具体实现。</li>
</ul>
<p>领域服务只需调用 <code>repository.findOneByIdAndProjectId(id, projectId)</code>，既无需了解底层是 MySQL 还是 MongoDB，也无需编写任何 SQL 或查询语句。</p>
<h3 data-id="heading-6">应用层：用例编排</h3>
<p>应用层负责编排领域服务，处理用例级别的逻辑，看个例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-attr">requestState</span>: <span class="hljs-title class_">RequestState</span>, <span class="hljs-attr">createRpcModuleDto</span>: <span class="hljs-title class_">CreateRpcModuleDto</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ResponseDtoType</span>&gt; {
  <span class="hljs-keyword">const</span> { projectId, userId } = requestState;

  <span class="hljs-comment">// 调用领域服务</span>
  <span class="hljs-keyword">const</span> entity = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">createRpcModuleService</span>.<span class="hljs-title function_">execute</span>(projectId, userId, createRpcModuleDto);
    
  <span class="hljs-comment">// 转换为 DTO</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataAssembler</span>.<span class="hljs-title function_">assemble</span>({
    <span class="hljs-attr">domainObject</span>: entity,
  });

  <span class="hljs-comment">// 统一响应格式</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">SingleResponse</span>.<span class="hljs-title function_">of</span>(result);
}
</code></pre>
<p>通过以上的代码示例，我们总结出应用层的核心职责：</p>
<ul>
<li><strong>接收用户请求</strong>，如 HTTP、消息队列等；</li>
<li><strong>调用领域服务</strong>完成业务逻辑；</li>
<li><strong>使用 DataAssembler 数据组装器</strong>将领域对象转换为 DTO，避免污染领域模型；</li>
<li><strong>统一响应格式</strong>，保障接口一致性。</li>
</ul>
<h3 data-id="heading-7">客户端层：对外接口的契约</h3>
<p>客户端层定义了模块与外部世界交互的数据契约，主要包括 <strong>DTO（数据传输对象）</strong> 和 <strong>领域事件（Domain Events）</strong>。</p>
<h4 data-id="heading-8">DTO：数据传输对象</h4>
<p>DTO 负责描述外部请求或响应的数据格式，并集成验证、转换与字段控制能力：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateRpcModuleDto</span> {
  @<span class="hljs-title class_">Expose</span>()
  @<span class="hljs-title class_">IsNotEmpty</span>()
  @<span class="hljs-title class_">MaxLength</span>(<span class="hljs-number">255</span>)
  readonly <span class="hljs-attr">name</span>: string;
  
  @<span class="hljs-title class_">Expose</span>()
  @<span class="hljs-title class_">IsNotEmpty</span>()
  @<span class="hljs-title class_">Transform</span>(<span class="hljs-function">(<span class="hljs-params">{ value }</span>) =&gt;</span> <span class="hljs-title function_">safeToInteger</span>(value))
  readonly <span class="hljs-attr">dataSourceId</span>: number;
  
  <span class="hljs-comment">// 其余字段</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>这个 DTO 做了几件事：</p>
<ul>
<li><strong>验证</strong>：通过 <code>class-validator</code>（如 <code>@IsNotEmpty()</code>、<code>@MaxLength()</code>）确保输入合法；</li>
<li><strong>转换</strong>：通过 <code>class-transformer</code> 的 <code>@Transform()</code> 将原始值（如字符串 <code>"123"</code>）转为目标类型（如 <code>number</code>）；</li>
<li><strong>暴露</strong>：<code>@Expose()</code> 控制哪些字段可以接收。</li>
</ul>
<h4 data-id="heading-9">领域事件（Domain Events）</h4>
<p>前面在介绍领域服务时有提到领域事件，它是在客户端层进行定义模块对外发布的领域事件，用于通知系统内其他部分<strong>某件业务已发生</strong>：</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">DomainEvent</span>({ <span class="hljs-attr">async</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RpcModuleCreateEvent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BaseDomainEvent</span> {
  <span class="hljs-keyword">static</span> eventName = <span class="hljs-title class_">Symbol</span>(<span class="hljs-title class_">RpcModuleCreateEvent</span>.<span class="hljs-property">name</span>);
  <span class="hljs-attr">eventName</span>: symbol = <span class="hljs-title class_">RpcModuleCreateEvent</span>.<span class="hljs-property">eventName</span>;

  public readonly <span class="hljs-attr">id</span>: number;
  public readonly <span class="hljs-attr">projectId</span>: number;
  public readonly <span class="hljs-attr">creatorId</span>: number;
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">entity: { id: number; projectId: number; creatorId: number }</span>) {
    <span class="hljs-variable language_">super</span>();

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = entity.<span class="hljs-property">id</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">projectId</span> = entity.<span class="hljs-property">projectId</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">creatorId</span> = entity.<span class="hljs-property">creatorId</span>;
  }
}
</code></pre>
<p>该领域事件接收了参数 <code>entity</code>，包含字段有 <code>id</code>、<code>projectId</code>、<code>creatorId</code>。在某个领域服务中，通过传递 <code>entity</code> 参数触发领域事件：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RpcModuleCreateEvent</span>(entity)
);
</code></pre>
<p>通过领域事件，我们可以得到以下优势：</p>
<ul>
<li><strong>解耦</strong>：发布者不需要知道订阅者；</li>
<li><strong>异步处理</strong>：支持同步和异步两种模式；</li>
<li><strong>可扩展</strong>：新增功能只需订阅事件，无需修改现有代码。</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>DDD 不是万能的，并非适合所有项目，但它能让你的代码更贴近业务、更好维护。通过分层架构、领域事件机制、数据转换等实践，你能把系统搭建得更清晰。最后给一些实用建议：</p>
<ul>
<li><strong>先想清业务，再写代码</strong>：从领域层开始设计，先把业务里的核心角色、行为理顺，再去考虑应用层怎么调用；</li>
<li><strong>用领域事件来解耦</strong>：模块之间别互相硬调用，用事件通知的方式，让各自更独立；</li>
<li><strong>让领域层保持干净</strong>：领域层只关心业务逻辑，不掺杂框架、数据库这些细节；</li>
<li><strong>用 <code>Assembler</code> 做数据转换</strong>：不要直接把领域对象返回给外层，用 <code>Assembler</code> 把它们转换成需要的结构。</li>
</ul>
<p>记住一句话：DDD 的核心就是让代码讲业务语言，而不是讲数据库语言。本篇文章由于篇幅所限，所以很多细节没有做深入探讨，如果你觉得有什么地方遗漏、疑惑，欢迎评论讨论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯 Viem 脚手架：最干净的链上交互方式]]></title>    <link>https://juejin.cn/post/7578405594119503906</link>    <guid>https://juejin.cn/post/7578405594119503906</guid>    <pubDate>2025-12-01T07:25:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578405594119503906" data-draft-id="7578693994367614976" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯 Viem 脚手架：最干净的链上交互方式"/> <meta itemprop="keywords" content="web3,TypeScript"/> <meta itemprop="datePublished" content="2025-12-01T07:25:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cipher"/> <meta itemprop="url" content="https://juejin.cn/user/2242659448524872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯 Viem 脚手架：最干净的链上交互方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2242659448524872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cipher
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:25:58.000Z" title="Mon Dec 01 2025 07:25:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在 Web3 开发领域，与以太坊等区块链网络进行交互是构建去中心化应用（DApp）的核心环节。传统的 Web3 开发框架如 wagmi 为开发者提供了便利的 React Hooks，但有时我们也需要更底层、更灵活的控制。</p>
<p>本文将介绍一个纯 Viem 脚手架项目，详细分析如何使用 Viem 库直接与 MetaMask 钱包和智能合约进行交互，不依赖 wagmi 等高级抽象库，让开发者更好地理解底层交互逻辑。Viem 作为下一代以太坊开发工具，相比传统的 ethers.js 和 web3.js，提供了更现代化的 TypeScript 接口和更轻量级的实现。</p>
<h2 data-id="heading-1">项目概述</h2>
<p>这是一个使用 Next.js 和 Viem 构建的简单 DApp 脚手架项目，主要功能包括连接钱包、获取账户信息、读写智能合约以及监听钱包状态变化。该项目采用纯 Viem 实现，没有使用 wagmi 等第三方状态管理库。</p>
<h3 data-id="heading-2">为什么选择纯 Viem？</h3>
<p>纯 Viem 方案在 Web3 开发中因其轻量级设计和底层控制能力，逐渐成为开发者调查中的新趋势，尤其适合追求灵活性和性能的场景。相较于 wagmi 等高级抽象库，纯 Viem 提供了以下显著优势：</p>
<ul>
<li>
<p><strong>更细粒度的控制</strong></p>
<p>开发者可以直接操作每个链上请求，深入理解底层通信逻辑，便于调试和优化，无需受抽象层限制。</p>
</li>
<li>
<p><strong>轻量级实现</strong></p>
<p>不依赖额外的状态管理库，项目体积大幅减少（仅 <code>viem</code> 比 wagmi 全家桶少 70%+），加载速度显著提升。</p>
</li>
<li>
<p><strong>灵活性更高</strong></p>
<p>根据项目需求自由定制交互逻辑，不被高级库的预设框架束缚，适合复杂或定制化场景。</p>
</li>
<li>
<p><strong>更好的 TypeScript 支持</strong></p>
<p>Viem 的原生类型推断确保合约交互类型安全，降低运行时错误风险，成为开发者信赖的核心。</p>
</li>
<li>
<p><strong>更直观的 API 设计</strong></p>
<p>API 贴近以太坊原生操作，易于掌握区块链交互本质，减少学习曲线。</p>
</li>
<li>
<p><strong>调试友好与未来趋势</strong></p>
<p>出错时直接面对 Viem 的原始错误信息，无需解构 hook 问题，调试效率翻倍。同时，wagmi v2 已全面转向 Viem，纯 Viem 方案是未来 Web3 开发的标杆。</p>
</li>
</ul>
<p>这种架构不仅适合初学者快速上手，也为高级开发者提供无限扩展空间，是链上开发的理想选择。</p>
<h2 data-id="heading-3">项目创建步骤</h2>
<h3 data-id="heading-4">项目初始化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建 Next.js 项目（App Router）</span>
npx create-next-app@latest simple-viem --typescript --tailwind --eslint --app --import-alias <span class="hljs-string">"@/*"</span>

<span class="hljs-built_in">cd</span> simple-viem

<span class="hljs-comment"># 2. 安装核心依赖</span>
pnpm install \
  viem@latest \
  antd \
  @ant-design/icons \
  @ant-design/nextjs-registry \
  dotenv

<span class="hljs-comment"># 3. 安装开发依赖</span>
pnpm install -D \
  prettier
</code></pre>
<h3 data-id="heading-5">智能合约部分初始化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在项目根目录初始化 Foundry（智能合约）</span>
forge init contracts
<span class="hljs-built_in">cd</span> contracts

<span class="hljs-comment"># 删除 foundry 的 git 仓库，统一使用上层的 git 仓库</span>
<span class="hljs-built_in">rm</span> -rf .git

<span class="hljs-comment"># 安装 OpenZeppelin，不能使用 git 安装，否则会使仓库管理混乱</span>
forge install --no-git OpenZeppelin/openzeppelin-contracts

<span class="hljs-comment"># 生成 ABI 文件</span>
<span class="hljs-built_in">mkdir</span> ../app/abis
forge inspect Counter abi --json &gt; ../app/abis/Counter.json
</code></pre>
<h3 data-id="heading-6">核心依赖分析</h3>
<p>该项目的核心依赖包括：</p>
<ul>
<li><strong>Next.js</strong>：React 框架，提供 SSR 和现代化的开发体验</li>
<li><strong>Viem</strong>：用于与以太坊区块链交互的 TypeScript 库，是项目的核心</li>
<li><strong>Ant Design</strong>：UI 组件库</li>
<li><strong>Foundry</strong>：以太坊开发工具链（智能合约部分）</li>
</ul>
<h3 data-id="heading-7">配置文件</h3>
<p>项目的 tsconfig.json、package.json 等配置文件均遵循 next.js 的最佳实践配置，同时 TypeScript 确保了代码的类型安全。</p>
<h3 data-id="heading-8">项目文件结构</h3>
<pre><code class="hljs language-python" lang="python">simple-viem/
├── app/
│   ├── abis/                    <span class="hljs-comment"># 智能合约ABI文件</span>
│   │   └── Counter.json        <span class="hljs-comment"># Counter合约的ABI</span>
│   ├── favicon.ico             <span class="hljs-comment"># 网站图标</span>
│   ├── <span class="hljs-built_in">globals</span>.css             <span class="hljs-comment"># 全局样式</span>
│   ├── layout.tsx              <span class="hljs-comment"># Next.js布局组件</span>
│   ├── page.tsx                <span class="hljs-comment"># 主页面，包含所有交互逻辑</span>
│   ├── providers.tsx           <span class="hljs-comment"># 提供者组件（空实现）</span>
│   └── types/
│       └── ethereum.d.ts       <span class="hljs-comment"># TypeScript类型定义</span>
├── contracts/                  <span class="hljs-comment"># 智能合约目录</span>
│   ├── .env                    <span class="hljs-comment"># 环境变量配置</span>
│   ├── foundry.toml            <span class="hljs-comment"># Foundry配置文件</span>
│   ├── lib/                    <span class="hljs-comment"># 依赖库（OpenZeppelin）</span>
│   ├── out/                    <span class="hljs-comment"># 编译输出目录</span>
│   ├── script/                 <span class="hljs-comment"># 部署脚本</span>
│   ├── src/                    <span class="hljs-comment"># 合约源码</span>
│   │   └── Counter.sol         <span class="hljs-comment"># Counter智能合约</span>
│   └── test/                   <span class="hljs-comment"># 测试文件</span>
├── .gitignore                  <span class="hljs-comment"># Git忽略文件</span>
├── .prettierrc.cjs             <span class="hljs-comment"># Prettier配置</span>
├── eslint.config.mjs           <span class="hljs-comment"># ESLint配置</span>
├── <span class="hljs-built_in">next</span>-env.d.ts               <span class="hljs-comment"># Next.js类型声明</span>
├── <span class="hljs-built_in">next</span>.config.ts              <span class="hljs-comment"># Next.js配置</span>
├── package.json                <span class="hljs-comment"># 项目依赖配置</span>
├── postcss.config.mjs          <span class="hljs-comment"># PostCSS配置</span>
├── public/                     <span class="hljs-comment"># 静态资源目录</span>
│   ├── favicon.ico             <span class="hljs-comment"># 网站图标</span>
│   └── vercel.svg              <span class="hljs-comment"># Vercel图标</span>
└── tsconfig.json               <span class="hljs-comment"># TypeScript配置</span>
</code></pre>
<h2 data-id="heading-9">核心代码实现</h2>
<h3 data-id="heading-10">Page.tsx 页面的 Viem 操作分析</h3>
<p>项目的核心交互逻辑集中在 app/page.tsx 文件中，下面详细分析其中的关键操作：</p>
<h4 data-id="heading-11">支持多链配置</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 支持的链</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SUPPORTED_CHAINS</span> = [foundry, sepolia] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COUNTER_ADDRESS_FOUNDRY</span> = <span class="hljs-string">'0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COUNTER_ADDRESS_SEPOLIA</span> = <span class="hljs-string">'0x7B6781B15b4f3eF8476af20Ed45Cf6d09e0Ef55F'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCounterAddress</span>(<span class="hljs-params">chainId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">return</span> chainId === foundry.<span class="hljs-property">id</span> ? <span class="hljs-variable constant_">COUNTER_ADDRESS_FOUNDRY</span> : <span class="hljs-variable constant_">COUNTER_ADDRESS_SEPOLIA</span>;
}
</code></pre>
<p>该项目支持多条链（Foundry 和 Sepolia 测试网），通过地址映射实现在不同网络上访问对应的合约实例。这种设计使得 DApp 能适应不同的开发和测试环境。</p>
<h4 data-id="heading-12">连接钱包</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">connectWallet</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> === <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请安装 MetaMask'</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">const</span> [address] = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({ <span class="hljs-attr">method</span>: <span class="hljs-string">'eth_requestAccounts'</span> });
    <span class="hljs-keyword">const</span> chainId = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({ <span class="hljs-attr">method</span>: <span class="hljs-string">'eth_chainId'</span> });
    <span class="hljs-title function_">setAddress</span>(address <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>);
    <span class="hljs-title function_">setChainId</span>(<span class="hljs-title class_">Number</span>(chainId));
    <span class="hljs-title function_">setIsConnected</span>(<span class="hljs-literal">true</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'连接钱包失败:'</span>, error);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
  }
};
</code></pre>
<p>连接钱包功能通过直接调用 <code>window.ethereum.request</code> 方法实现，请求 <code>eth_requestAccounts</code> 方法获取用户授权的账户地址，同时获取当前链 ID。这种方式绕过了 wagmi 等高级抽象，直接使用 EIP-1193 标准与钱包通信。</p>
<h4 data-id="heading-13">获取钱包信息</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 读取余额</span>
<span class="hljs-keyword">const</span> fetchBalance = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">if</span> (!address || !chainId) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">getPublicClient</span>(chainId);
    <span class="hljs-keyword">const</span> bal = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">getBalance</span>({ address });
    <span class="hljs-title function_">setBalance</span>(<span class="hljs-title function_">formatEther</span>(bal));
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'读取余额失败'</span>, err);
  }
}, [address, chainId]);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPublicClient</span>(<span class="hljs-params">chainId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> chain = <span class="hljs-variable constant_">SUPPORTED_CHAINS</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">id</span> === chainId) ?? foundry;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPublicClient</span>({
    chain,
    <span class="hljs-attr">transport</span>: <span class="hljs-title function_">http</span>(),
  }).<span class="hljs-title function_">extend</span>(publicActions);
}
</code></pre>
<p>获取钱包信息分为几个步骤：</p>
<ol>
<li>创建 publicClient，用于与区块链进行只读交互</li>
<li>使用 <code>client.getBalance</code> 方法获取指定地址的余额</li>
<li>使用 <code>formatEther</code> 将 bigint 格式的余额转换为易读的 ETH 格式</li>
</ol>
<h4 data-id="heading-14">读写智能合约</h4>
<h5 data-id="heading-15">读取合约数据</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> fetchCounterNumber = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">if</span> (!chainId) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">getPublicClient</span>(chainId);
    <span class="hljs-keyword">const</span> contract = <span class="hljs-title function_">getContract</span>({
      <span class="hljs-attr">address</span>: <span class="hljs-title function_">getCounterAddress</span>(chainId),
      <span class="hljs-attr">abi</span>: <span class="hljs-title class_">Counter</span>_ABI,
      client,
    });
    <span class="hljs-keyword">const</span> num = (<span class="hljs-keyword">await</span> contract.<span class="hljs-property">read</span>.<span class="hljs-title function_">number</span>()) <span class="hljs-keyword">as</span> <span class="hljs-built_in">bigint</span>;
    <span class="hljs-title function_">setCounterNumber</span>(num.<span class="hljs-title function_">toString</span>());
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'读取 Counter 失败'</span>, err);
  }
}, [chainId]);
</code></pre>
<p>读取合约数据的步骤：</p>
<ol>
<li>创建 publicClient</li>
<li>使用 <code>getContract</code> 创建合约实例</li>
<li>调用 <code>contract.read[functionName]</code> 方法读取合约状态</li>
</ol>
<h5 data-id="heading-16">写入合约数据</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleIncrement</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!address || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">const</span> walletClient = <span class="hljs-title function_">getWalletClient</span>();
  <span class="hljs-keyword">if</span> (!walletClient) <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'钱包未连接'</span>);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">const</span> hash = <span class="hljs-keyword">await</span> walletClient.<span class="hljs-title function_">writeContract</span>({
      <span class="hljs-attr">address</span>: <span class="hljs-title function_">getCounterAddress</span>(chainId),
      <span class="hljs-attr">abi</span>: <span class="hljs-title class_">Counter</span>_ABI,
      <span class="hljs-attr">functionName</span>: <span class="hljs-string">'increment'</span>,
      <span class="hljs-attr">account</span>: address,
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Transaction hash:'</span>, hash);

    <span class="hljs-keyword">const</span> receipt = <span class="hljs-keyword">await</span> walletClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: hash });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`交易状态: <span class="hljs-subst">${receipt.status === <span class="hljs-string">'success'</span> ? <span class="hljs-string">'成功'</span> : <span class="hljs-string">'失败'</span>}</span>`</span>);

    <span class="hljs-comment">// 更新数值显示</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchCounterNumber</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用 increment 失败:'</span>, error);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
  }
};

<span class="hljs-comment">// 创建 walletClient（只在需要签名时创建）</span>
<span class="hljs-keyword">const</span> getWalletClient = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId || !address) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> chain = <span class="hljs-variable constant_">SUPPORTED_CHAINS</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">id</span> === chainId) ?? foundry;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createWalletClient</span>({
    <span class="hljs-attr">account</span>: address,
    chain,
    <span class="hljs-attr">transport</span>: <span class="hljs-title function_">custom</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>),
  }).<span class="hljs-title function_">extend</span>(publicActions);
}, [address, chainId]);
</code></pre>
<p>写入合约数据的步骤：</p>
<ol>
<li>创建 walletClient，用于需要签名的交易</li>
<li>调用 <code>writeContract</code> 方法发送交易到合约</li>
<li>使用 <code>waitForTransactionReceipt</code> 等待交易确认</li>
<li>更新相关状态</li>
</ol>
<p>时序图：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户（浏览器）
    participant Page as React 页面 (page.tsx)
    participant WalletClient as Viem WalletClient
    participant MetaMask as MetaMask 钱包
    participant Node as 节点 (Infura/Alchemy/Anvil)
    participant Chain as 区块链

    User-&gt;&gt;Page: 点击 “+1” 按钮
    Page-&gt;&gt;Page: 调用 handleIncrement()
    Page-&gt;&gt;Page: getWalletClient() 创建 walletClient
    Page-&gt;&gt;WalletClient: writeContract({ ..., functionName: 'increment' })
    WalletClient-&gt;&gt;MetaMask: eth_sendTransaction (签名请求弹窗)
    MetaMask--&gt;&gt;User: 请确认交易…
    User-&gt;&gt;MetaMask: 点击【确认】
    MetaMask-&gt;&gt;WalletClient: 返回已签名的交易
    WalletClient-&gt;&gt;Node: 广播交易 (hash)
    Node--&gt;&gt;Chain: 提交交易
    WalletClient--&gt;&gt;Page: 返回 transaction hash
    Page-&gt;&gt;Page: console.log('Transaction hash:', hash)

    Note over Page,Chain: 等待上链确认
    Page-&gt;&gt;WalletClient: waitForTransactionReceipt({ hash })
    WalletClient-&gt;&gt;Node: 轮询 receipt
    Node--&gt;&gt;Chain: 区块已打包
    Node--&gt;&gt;WalletClient: 返回 receipt (status: success)
    WalletClient--&gt;&gt;Page: receipt
    Page-&gt;&gt;Page: console.log('交易成功')

    Page-&gt;&gt;Page: 调用 fetchCounterNumber()
    Page-&gt;&gt;publicClient: readContract({ functionName: 'number' })
    publicClient-&gt;&gt;Node: call (只读)
    Node--&gt;&gt;publicClient: 返回最新 number
    publicClient--&gt;&gt;Page: 返回新值
    Page-&gt;&gt;Page: setCount(新值) → 页面更新

    Note over User,Chain: 整个过程用户只点了一次确认&lt;br/&gt;所有状态自动同步
</code></pre>
<h4 data-id="heading-17">断开连接</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> disconnectWallet = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">if</span> (!address || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId) <span class="hljs-keyword">return</span>;
  <span class="hljs-title function_">setIsConnected</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-title function_">setAddress</span>(<span class="hljs-literal">undefined</span>);
  <span class="hljs-title function_">setChainId</span>(<span class="hljs-literal">undefined</span>);
  <span class="hljs-title function_">setBalance</span>(<span class="hljs-string">'0'</span>);
  <span class="hljs-title function_">setCounterNumber</span>(<span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 对于 MetaMask 10.28+</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({
      <span class="hljs-attr">method</span>: <span class="hljs-string">'wallet_revokePermissions'</span>,
      <span class="hljs-attr">params</span>: [{ <span class="hljs-attr">eth_accounts</span>: {} }],
    });
    <span class="hljs-comment">// 老版本 MM 会抛 4200 错误，捕获即可</span>
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">e</span>: <span class="hljs-built_in">unknown</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'object'</span> &amp;&amp; e !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-string">'code'</span> <span class="hljs-keyword">in</span> e &amp;&amp; (e <span class="hljs-keyword">as</span> { <span class="hljs-attr">code</span>: <span class="hljs-built_in">unknown</span> }).<span class="hljs-property">code</span> === <span class="hljs-number">4200</span>) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请手动在钱包里断开本次连接'</span>);
    }
  }
}, [address, chainId]);
</code></pre>
<p>断开连接功能不仅清空了本地状态，还通过 <code>wallet_revokePermissions</code> 方法撤销了对钱包的访问权限。</p>
<h4 data-id="heading-18">监听钱包操作</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAccountsChanged</span> = (<span class="hljs-params">accounts: <span class="hljs-built_in">string</span>[]</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'账户变化'</span>, accounts);
    <span class="hljs-keyword">if</span> (accounts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-title function_">disconnectWallet</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">setAddress</span>(accounts[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>);
    }
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChainChanged</span> = (<span class="hljs-params">chainIdHex: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'网络变化'</span>, chainIdHex);
    <span class="hljs-title function_">setChainId</span>(<span class="hljs-title class_">Number</span>(chainIdHex));
  };

  <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'accountsChanged'</span>, handleAccountsChanged);
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'chainChanged'</span>, handleChainChanged);

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>?.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">'accountsChanged'</span>, handleAccountsChanged);
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>?.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">'chainChanged'</span>, handleChainChanged);
  };
}, [address, disconnectWallet, fetchBalance, fetchCounterNumber]);
</code></pre>
<p>通过监听 <code>accountsChanged</code> 和 <code>chainChanged</code> 事件，DApp 能够实时响应用户的账户切换和网络切换操作，保持应用状态与钱包状态的一致性。</p>
<h3 data-id="heading-19">Counter 智能合约分析</h3>
<p>Counter 合约是一个简单的计数器合约，包含以下功能：</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

contract Counter {
    uint256 public number;

    function setNumber(uint256 newNumber) public {
        number = newNumber;
    }

    function increment() public {
        number++;
    }
}
</code></pre>
<p>该合约提供了两个主要功能：</p>
<ol>
<li><code>number()</code> - 读取当前计数值（getter function）</li>
<li><code>increment()</code> - 将计数值加 1</li>
<li><code>setNumber()</code> - 设置新的计数值</li>
</ol>
<h2 data-id="heading-20">纯 Viem 脚手架项目的架构优势</h2>
<h3 data-id="heading-21">更细粒度的控制</h3>
<p>使用纯 Viem 相比于 wagmi 等抽象库，开发者能够更精确地控制每个操作，了解底层通信逻辑，便于调试和优化。</p>
<h3 data-id="heading-22">轻量级实现</h3>
<p>不引入额外的状态管理库，减少了项目体积，提高了加载速度。</p>
<h3 data-id="heading-23">灵活性更高</h3>
<p>可以根据项目需求定制特定的交互逻辑，而不受高级抽象库的限制。</p>
<h3 data-id="heading-24">更好的 TypeScript 支持</h3>
<p>Viem 提供了优秀的 TypeScript 类型推断，确保合约交互的类型安全。</p>
<h3 data-id="heading-25">更直观的 API 设计</h3>
<p>Viem 的 API 设计更接近以太坊的原生操作，便于理解区块链交互的本质。</p>
<h2 data-id="heading-26">对比 wagmi 的核心差异</h2>








































<table><thead><tr><th>功能</th><th>wagmi 写法（抽象）</th><th>纯 Viem 写法</th></tr></thead><tbody><tr><td>连接钱包</td><td><code>useConnect()</code></td><td><code>window.ethereum.request('eth_requestAccounts')</code></td></tr><tr><td>切换链/账号自动更新</td><td>wagmi 自动</td><td>手动监听 <code>accountsChanged</code> / <code>chainChanged</code></td></tr><tr><td>读余额</td><td><code>useBalance()</code></td><td><code>publicClient.getBalance()</code></td></tr><tr><td>读合约</td><td><code>useReadContract()</code></td><td><code>publicClient.readContract()</code></td></tr><tr><td>发交易</td><td><code>useWriteContract()</code></td><td><code>walletClient.writeContract()</code></td></tr><tr><td>等待确认</td><td>自动</td><td><code>walletClient.waitForTransactionReceipt()</code></td></tr></tbody></table>
<h2 data-id="heading-27">完整代码示例</h2>
<p>下面是一个完整的示例，展示了如何使用纯 Viem 构建一个功能完整的 DApp：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span>;

<span class="hljs-keyword">import</span> { useState, useEffect, useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { createPublicClient, createWalletClient, http, formatEther, getContract, custom, publicActions } <span class="hljs-keyword">from</span> <span class="hljs-string">'viem'</span>;
<span class="hljs-keyword">import</span> { foundry, sepolia } <span class="hljs-keyword">from</span> <span class="hljs-string">'viem/chains'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Counter</span>_ABI <span class="hljs-keyword">from</span> <span class="hljs-string">'./abis/Counter.json'</span>;

<span class="hljs-comment">// 支持的链</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SUPPORTED_CHAINS</span> = [foundry, sepolia] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">// Counter 合约地址</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COUNTER_ADDRESS_FOUNDRY</span> = <span class="hljs-string">'0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">COUNTER_ADDRESS_SEPOLIA</span> = <span class="hljs-string">'0x7B6781B15b4f3eF8476af20Ed45Cf6d09e0Ef55F'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getCounterAddress</span>(<span class="hljs-params">chainId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">return</span> chainId === foundry.<span class="hljs-property">id</span> ? <span class="hljs-variable constant_">COUNTER_ADDRESS_FOUNDRY</span> : <span class="hljs-variable constant_">COUNTER_ADDRESS_SEPOLIA</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPublicClient</span>(<span class="hljs-params">chainId: <span class="hljs-built_in">number</span></span>) {
  <span class="hljs-keyword">const</span> chain = <span class="hljs-variable constant_">SUPPORTED_CHAINS</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">id</span> === chainId) ?? foundry;
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createPublicClient</span>({
    chain,
    <span class="hljs-attr">transport</span>: <span class="hljs-title function_">http</span>(),
  }).<span class="hljs-title function_">extend</span>(publicActions);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [balance, setBalance] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> [counterNumber, setCounterNumber] = useState&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> [address, setAddress] = useState&lt;<span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span> | <span class="hljs-literal">undefined</span>&gt;();
  <span class="hljs-keyword">const</span> [isConnected, setIsConnected] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [chainId, setChainId] = useState&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>&gt;();
  <span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">const</span> currentChain = <span class="hljs-variable constant_">SUPPORTED_CHAINS</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">id</span> === chainId);

  <span class="hljs-comment">// 创建 walletClient（只在需要签名时创建）</span>
  <span class="hljs-keyword">const</span> getWalletClient = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId || !address) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> chain = <span class="hljs-variable constant_">SUPPORTED_CHAINS</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-property">id</span> === chainId) ?? foundry;
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createWalletClient</span>({
      <span class="hljs-attr">account</span>: address,
      chain,
      <span class="hljs-attr">transport</span>: <span class="hljs-title function_">custom</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>),
    }).<span class="hljs-title function_">extend</span>(publicActions);
  }, [address, chainId]);

  <span class="hljs-comment">// 获取 Counter 合约的数值</span>
  <span class="hljs-keyword">const</span> fetchCounterNumber = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!chainId) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">getPublicClient</span>(chainId);
      <span class="hljs-keyword">const</span> contract = <span class="hljs-title function_">getContract</span>({
        <span class="hljs-attr">address</span>: <span class="hljs-title function_">getCounterAddress</span>(chainId),
        <span class="hljs-attr">abi</span>: <span class="hljs-title class_">Counter</span>_ABI,
        client,
      });
      <span class="hljs-keyword">const</span> num = (<span class="hljs-keyword">await</span> contract.<span class="hljs-property">read</span>.<span class="hljs-title function_">number</span>()) <span class="hljs-keyword">as</span> <span class="hljs-built_in">bigint</span>;
      <span class="hljs-title function_">setCounterNumber</span>(num.<span class="hljs-title function_">toString</span>());
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'读取 Counter 失败'</span>, err);
    }
  }, [chainId]);

  <span class="hljs-comment">// 读取余额</span>
  <span class="hljs-keyword">const</span> fetchBalance = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!address || !chainId) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">getPublicClient</span>(chainId);
      <span class="hljs-keyword">const</span> bal = <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">getBalance</span>({ address });
      <span class="hljs-title function_">setBalance</span>(<span class="hljs-title function_">formatEther</span>(bal));
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'读取余额失败'</span>, err);
    }
  }, [address, chainId]);

  <span class="hljs-comment">// 连接钱包</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">connectWallet</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> === <span class="hljs-string">'undefined'</span>) {
      <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请安装 MetaMask'</span>);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">const</span> [address] = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({ <span class="hljs-attr">method</span>: <span class="hljs-string">'eth_requestAccounts'</span> });
      <span class="hljs-keyword">const</span> chainId = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({ <span class="hljs-attr">method</span>: <span class="hljs-string">'eth_chainId'</span> });
      <span class="hljs-title function_">setAddress</span>(address <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>);
      <span class="hljs-title function_">setChainId</span>(<span class="hljs-title class_">Number</span>(chainId));
      <span class="hljs-title function_">setIsConnected</span>(<span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'连接钱包失败:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 断开连接</span>
  <span class="hljs-keyword">const</span> disconnectWallet = <span class="hljs-title function_">useCallback</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">if</span> (!address || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId) <span class="hljs-keyword">return</span>;
    <span class="hljs-title function_">setIsConnected</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-title function_">setAddress</span>(<span class="hljs-literal">undefined</span>);
    <span class="hljs-title function_">setChainId</span>(<span class="hljs-literal">undefined</span>);
    <span class="hljs-title function_">setBalance</span>(<span class="hljs-string">'0'</span>);
    <span class="hljs-title function_">setCounterNumber</span>(<span class="hljs-string">'0'</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 对于 MetaMask 10.28+</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">request</span>({
        <span class="hljs-attr">method</span>: <span class="hljs-string">'wallet_revokePermissions'</span>,
        <span class="hljs-attr">params</span>: [{ <span class="hljs-attr">eth_accounts</span>: {} }],
      });
      <span class="hljs-comment">// 老版本 MM 会抛 4200 错误，捕获即可</span>
    } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">e</span>: <span class="hljs-built_in">unknown</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> e === <span class="hljs-string">'object'</span> &amp;&amp; e !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-string">'code'</span> <span class="hljs-keyword">in</span> e &amp;&amp; (e <span class="hljs-keyword">as</span> { <span class="hljs-attr">code</span>: <span class="hljs-built_in">unknown</span> }).<span class="hljs-property">code</span> === <span class="hljs-number">4200</span>) {
        <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请手动在钱包里断开本次连接'</span>);
      }
    }
  }, [address, chainId]);

  <span class="hljs-comment">// 调用 increment 函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleIncrement</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!address || !<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span> || !chainId) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">const</span> walletClient = <span class="hljs-title function_">getWalletClient</span>();
    <span class="hljs-keyword">if</span> (!walletClient) <span class="hljs-keyword">return</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">'钱包未连接'</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">const</span> hash = <span class="hljs-keyword">await</span> walletClient.<span class="hljs-title function_">writeContract</span>({
        <span class="hljs-attr">address</span>: <span class="hljs-title function_">getCounterAddress</span>(chainId),
        <span class="hljs-attr">abi</span>: <span class="hljs-title class_">Counter</span>_ABI,
        <span class="hljs-attr">functionName</span>: <span class="hljs-string">'increment'</span>,
        <span class="hljs-attr">account</span>: address,
      });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Transaction hash:'</span>, hash);

      <span class="hljs-keyword">const</span> receipt = <span class="hljs-keyword">await</span> walletClient.<span class="hljs-title function_">waitForTransactionReceipt</span>({ <span class="hljs-attr">hash</span>: hash });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`交易状态: <span class="hljs-subst">${receipt.status === <span class="hljs-string">'success'</span> ? <span class="hljs-string">'成功'</span> : <span class="hljs-string">'失败'</span>}</span>`</span>);

      <span class="hljs-comment">// 更新数值显示</span>
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchCounterNumber</span>();
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用 increment 失败:'</span>, error);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setIsLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 全局监听（只添加一次）</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAccountsChanged</span> = (<span class="hljs-params">accounts: <span class="hljs-built_in">string</span>[]</span>) =&gt; {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'账户变化'</span>, accounts);
      <span class="hljs-keyword">if</span> (accounts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">disconnectWallet</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setAddress</span>(accounts[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-string">`0x<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>);
      }
    };

    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleChainChanged</span> = (<span class="hljs-params">chainIdHex: <span class="hljs-built_in">string</span></span>) =&gt; {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'网络变化'</span>, chainIdHex);
      <span class="hljs-title function_">setChainId</span>(<span class="hljs-title class_">Number</span>(chainIdHex));
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'accountsChanged'</span>, handleAccountsChanged);
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'chainChanged'</span>, handleChainChanged);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>?.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">'accountsChanged'</span>, handleAccountsChanged);
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">ethereum</span>?.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">'chainChanged'</span>, handleChainChanged);
    };
  }, [address, disconnectWallet, fetchBalance, fetchCounterNumber]);

  <span class="hljs-comment">// 连接后自动读取数据</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (address &amp;&amp; chainId) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'连接后自动读取数据:'</span>, address);
      <span class="hljs-title function_">fetchBalance</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
      <span class="hljs-title function_">fetchCounterNumber</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
    }
  }, [address, chainId, fetchBalance, fetchCounterNumber]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'min-h-screen flex flex-col items-center justify-center p-8'</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-3xl font-bold mb-8'</span>&gt;</span>Simple Viem Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl'</span>&gt;</span>
        {!isConnected ? (
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{connectWallet}</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isLoading}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">'w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600 transition-colors'</span>
          &gt;</span>
            {isLoading ? '连接中...' : '连接 MetaMask'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        ) : (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'space-y-4'</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-center'</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-600'</span>&gt;</span>钱包地址:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'font-mono break-all'</span>&gt;</span>{address}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-center'</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-600'</span>&gt;</span>当前网络:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'font-mono'</span>&gt;</span>
                {currentChain?.name || '未知网络'} (Chain ID: {chainId})
              <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-center'</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-600'</span>&gt;</span>余额:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'font-mono'</span>&gt;</span>{balance} ETH<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-center'</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'text-gray-600'</span>&gt;</span>Counter 数值:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">'font-mono'</span>&gt;</span>{counterNumber}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleIncrement}</span>
                <span class="hljs-attr">disabled</span>=<span class="hljs-string">{isLoading}</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">'mt-2 w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 transition-colors'</span>
              &gt;</span>
                {isLoading ? '交易进行中...' : '增加计数'}
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{disconnectWallet}</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">'w-full bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600 transition-colors'</span>
            &gt;</span>
              断开连接
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-28">总结</h2>
<p>本文详细分析了一个纯 Viem 脚手架项目，展示了如何使用 Viem 库直接与 MetaMask 钱包和智能合约进行交互，包括：</p>
<ol>
<li>项目创建步骤和核心依赖</li>
<li>如何使用 Viem 实现多链支持</li>
<li>如何连接和断开 MetaMask 钱包</li>
<li>如何获取钱包信息和余额</li>
<li>如何读写智能合约</li>
<li>如何监听钱包状态变化</li>
<li>纯 Viem 实现相对于 wagmi 等库的优势</li>
</ol>
<p>纯 Viem 方案为开发者提供了更底层的控制和更灵活的实现方式，适合需要深入了解区块链交互逻辑的开发者使用。这种架构不仅保持了代码的简洁性，还提供了更大的扩展空间。</p>
<h2 data-id="heading-29">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fviem.sh%2F" target="_blank" title="https://viem.sh/" ref="nofollow noopener noreferrer">Viem 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Feips.ethereum.org%2FEIPS%2Feip-1193" target="_blank" title="https://eips.ethereum.org/EIPS/eip-1193" ref="nofollow noopener noreferrer">MetaMask EIP-1193 标准</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbook.getfoundry.sh%2F" target="_blank" title="https://book.getfoundry.sh/" ref="nofollow noopener noreferrer">Foundry 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Fdocs%2Fapp" target="_blank" title="https://nextjs.org/docs/app" ref="nofollow noopener noreferrer">Next.js App Router</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue2中transition使用方法解析，包含底部弹窗示例、样式未生效踩坑记录]]></title>    <link>https://juejin.cn/post/7578469297629052970</link>    <guid>https://juejin.cn/post/7578469297629052970</guid>    <pubDate>2025-12-01T07:26:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578469297629052970" data-draft-id="7578495241637937193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue2中transition使用方法解析，包含底部弹窗示例、样式未生效踩坑记录"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-01T07:26:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="朕的剑还未配妥"/> <meta itemprop="url" content="https://juejin.cn/user/1638693940764312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue2中transition使用方法解析，包含底部弹窗示例、样式未生效踩坑记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638693940764312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    朕的剑还未配妥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:26:55.000Z" title="Mon Dec 01 2025 07:26:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue2中Transition组件的使用方法与实战解析</h2>
<p>在Vue2的前端开发中，过渡动画是提升用户体验的核心手段之一。Vue内置的<code>transition</code>组件为元素的插入、更新、移除等DOM操作提供了简洁且可扩展的过渡封装能力，无需手动操作CSS类名或监听DOM事件，即可快速实现流畅的动画效果。本文将从核心原理、使用规则、实战案例三个维度系统讲解<code>transition</code>组件，并结合实际开发中遇到的样式覆盖问题，给出完整的解决方案。</p>
<h3 data-id="heading-1">一、Transition组件核心原理与使用规则</h3>
<h4 data-id="heading-2">1.1 核心工作机制</h4>
<p>Vue的<code>transition</code>组件本质是一个“动画控制器”，其核心逻辑是：<strong>在包裹的元素触发显隐（或状态变化）时，自动在不同生命周期阶段为元素添加/移除预设的CSS类名</strong>，开发者只需通过这些类名定义不同阶段的样式，即可实现过渡动画。</p>
<p>当元素被<code>transition</code>包裹且触发显隐（如<code>v-if</code>/<code>v-show</code>、组件切换）时，Vue会按以下时序执行动画流程：</p>
<ol>
<li><strong>进入阶段（Enter）</strong>：元素插入DOM → 触发进入动画 → 动画完成后移除进入相关类名；</li>
<li><strong>离开阶段（Leave）</strong>：元素触发隐藏 → 触发离开动画 → 动画完成后移除DOM（若为<code>v-if</code>）并移除离开相关类名。</li>
</ol>
<h4 data-id="heading-3">1.2 核心CSS类名体系</h4>
<p><code>transition</code>组件的动画类名分为“默认前缀”和“自定义前缀”两类，核心类名及作用如下：</p>





























<table><thead><tr><th>类名类型</th><th>进入阶段</th><th>离开阶段</th><th>核心作用</th></tr></thead><tbody><tr><td>初始状态</td><td><code>v-enter</code>（Vue2.1.8+为<code>v-enter-from</code>）</td><td><code>v-leave</code>（Vue2.1.8+为<code>v-leave-from</code>）</td><td>动画开始前的初始样式，元素插入/移除前瞬间添加，下一帧移除</td></tr><tr><td>动画过程</td><td><code>v-enter-active</code></td><td><code>v-leave-active</code></td><td>动画执行过程中的样式，覆盖整个进入/离开阶段，可定义<code>transition</code>/<code>animation</code>属性</td></tr><tr><td>结束状态</td><td><code>v-enter-to</code>（Vue2.1.8+新增）</td><td><code>v-leave-to</code>（Vue2.1.8+新增）</td><td>动画结束时的目标样式，动画开始后立即添加，动画完成后移除</td></tr></tbody></table>
<blockquote>
<p>关键说明：</p>
<ol>
<li>Vue2.1.8版本对类名做了优化，新增<code>-from</code>后缀替代原<code>v-enter</code>/<code>v-leave</code>（原类名仍兼容），使语义更清晰；</li>
<li>若为<code>transition</code>设置<code>name</code>属性（如<code>name="slide-popup"</code>），类名前缀会从默认的<code>v-</code>替换为自定义前缀（如<code>slide-popup-</code>），可有效避免全局样式冲突；</li>
<li>所有动画类名仅在动画周期内生效，动画结束后会被自动移除，不会污染元素默认样式。</li>
</ol>
</blockquote>
<h4 data-id="heading-4">1.3 基础使用条件</h4>
<p>要让<code>transition</code>组件生效，需满足以下基础条件：</p>
<ol>
<li>组件仅包裹<strong>单个元素/组件</strong>（若需包裹多个元素，需使用<code>&lt;transition-group&gt;</code>）；</li>
<li>触发动画的方式需为Vue可检测的DOM变化：
<ul>
<li>条件渲染：<code>v-if</code>/<code>v-show</code>；</li>
<li>组件动态切换：<code>component :is="xxx"</code>；</li>
<li>根元素的显隐切换（如路由组件）；</li>
</ul>
</li>
<li>必须通过CSS类名定义动画样式（或结合JavaScript钩子实现JS动画）；</li>
<li>若使用<code>v-show</code>，需确保元素初始<code>display</code>属性不影响动画（如避免<code>display: none</code>直接覆盖过渡效果）。</li>
</ol>
<h4 data-id="heading-5">1.4 过渡类型与配置</h4>
<p><code>transition</code>组件支持两种动画实现方式：</p>
<ul>
<li><strong>CSS过渡（Transition）</strong>：通过<code>transition</code> CSS属性实现（如<code>transition: all 0.3s ease</code>），也是最常用的方式；</li>
<li><strong>CSS动画（Animation）</strong>：通过<code>animation</code> CSS属性实现（如<code>animation: fade 0.5s linear</code>）；</li>
</ul>
<p>可通过<code>transition</code>组件的属性对动画进行精细化配置：</p>





























<table><thead><tr><th>属性名</th><th>作用</th></tr></thead><tbody><tr><td><code>name</code></td><td>自定义动画类名前缀，避免样式冲突</td></tr><tr><td><code>duration</code></td><td>统一设置进入/离开动画时长（如<code>:duration="300"</code>），也可分开展开<code>:duration="{ enter: 300, leave: 500 }"</code></td></tr><tr><td><code>type</code></td><td>指定动画类型（<code>transition</code>/<code>animation</code>），Vue会自动检测动画结束时机</td></tr><tr><td><code>appear</code></td><td>开启初始渲染动画（页面加载时即触发进入动画）</td></tr><tr><td><code>mode</code></td><td>控制进入/离开动画的执行顺序（<code>in-out</code>：先入后出；<code>out-in</code>：先出后入）</td></tr></tbody></table>
<h3 data-id="heading-6">二、实战示例：底部弹出弹窗动画</h3>
<p>以下实现一个从页面底部平滑弹出/消失的弹窗，完整覆盖<code>transition</code>组件的核心使用场景，并标注关键注意事项。</p>
<h4 data-id="heading-7">2.1 完整代码实现</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"demo-container"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 触发按钮 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showPopup = !showPopup"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"open-btn"</span>&gt;</span>
      打开底部弹窗
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 遮罩层 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showPopup"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"popup-mask"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showPopup = false"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 过渡包裹弹窗：仅保留自定义name，移除appear属性 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"slide-popup"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"showPopup"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"popup-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"popup-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>底部弹窗示例<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>基于Vue2 Transition实现的底部弹出动画<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"showPopup = false"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"close-btn"</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">transition</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'SlidePopupDemo'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">showPopup</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 控制弹窗显示/隐藏</span>
    };
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 页面容器 */</span>
<span class="hljs-selector-class">.demo-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
}

<span class="hljs-comment">/* 触发按钮样式 */</span>
<span class="hljs-selector-class">.open-btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#409eff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#409eff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">transition</span>: background <span class="hljs-number">0.2s</span> ease;
}

<span class="hljs-selector-class">.open-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#66b1ff</span>;
}

<span class="hljs-comment">/* 遮罩层：半透明背景，点击关闭弹窗 */</span>
<span class="hljs-selector-class">.popup-mask</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">999</span>;
  <span class="hljs-attribute">transition</span>: opacity <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 弹窗容器 - 关键：避免与动画类冲突的样式书写顺序 */</span>
<span class="hljs-selector-class">.popup-container</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span> <span class="hljs-number">12px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> -<span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
  <span class="hljs-comment">/* 注意：此处若设置transform，需确保动画类在其后定义 */</span>
  <span class="hljs-comment">/* 错误示例：transform: translateY(0); 会覆盖动画类的transform */</span>
}

<span class="hljs-selector-class">.popup-content</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">text-align</span>: center;
}

<span class="hljs-selector-class">.popup-content</span> <span class="hljs-selector-tag">h3</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
}

<span class="hljs-selector-class">.popup-content</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.close-btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f7fa</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e4e7ed</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span> ease;
}

<span class="hljs-selector-class">.close-btn</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e4e7ed</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-comment">/* 过渡动画类 - 需写在容器样式之后（核心！） */</span>
<span class="hljs-comment">/* 进入初始状态：弹窗完全在视口外（底部），透明度0 */</span>
<span class="hljs-selector-class">.slide-popup-enter</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">100%</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-comment">/* 进入动画过程：定义过渡属性和时长 */</span>
<span class="hljs-selector-class">.slide-popup-enter-active</span> {
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.34</span>, <span class="hljs-number">1.56</span>, <span class="hljs-number">0.64</span>, <span class="hljs-number">1</span>), opacity <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 进入结束状态：弹窗归位，透明度1 */</span>
<span class="hljs-selector-class">.slide-popup-enter-to</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* 离开初始状态：弹窗在正常位置，透明度1 */</span>
<span class="hljs-selector-class">.slide-popup-leave</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
}

<span class="hljs-comment">/* 离开动画过程：与进入动画保持一致的过渡曲线 */</span>
<span class="hljs-selector-class">.slide-popup-leave-active</span> {
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.34</span>, <span class="hljs-number">1.56</span>, <span class="hljs-number">0.64</span>, <span class="hljs-number">1</span>), opacity <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-comment">/* 离开结束状态：弹窗回到视口外，透明度0 */</span>
<span class="hljs-selector-class">.slide-popup-leave-to</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">100%</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-8">2.2 代码解析</h4>
<h5 data-id="heading-9">（1）结构层设计</h5>
<ul>
<li><code>transition</code>组件通过<code>name="slide-popup"</code>自定义动画类名前缀，替代默认的<code>v-</code>前缀，避免全局样式冲突（核心实践）；</li>
<li>弹窗容器通过<code>v-if="showPopup"</code>控制显隐，触发<code>transition</code>的进入/离开动画（<code>v-if</code>会触发DOM的插入/移除，是<code>transition</code>生效的核心条件）；</li>
<li>遮罩层与弹窗联动显隐，点击遮罩层可关闭弹窗，补充交互完整性；</li>
<li>未额外配置<code>appear</code>（贴合实际开发习惯，仅聚焦核心的显隐动画场景）。</li>
</ul>
<h5 data-id="heading-10">（2）样式层设计</h5>
<ul>
<li>弹窗容器<code>popup-container</code>采用<code>fixed</code>定位固定在页面底部，作为动画载体，通过<code>border-radius</code>和<code>box-shadow</code>优化视觉表现；</li>
<li>动画核心基于<code>slide-popup-enter</code>/<code>slide-popup-leave-to</code>等类名实现：
<ul>
<li>进入阶段：从<code>transform: translateY(100%)</code>（底部完全出视口）过渡到<code>transform: translateY(0)</code>（归位），配合<code>opacity</code>实现淡入；</li>
<li>离开阶段：从<code>transform: translateY(0)</code>过渡到<code>transform: translateY(100%)</code>，配合<code>opacity</code>实现淡出；</li>
</ul>
</li>
<li>过渡曲线使用<code>cubic-bezier</code>自定义缓动函数，相比默认<code>ease</code>更贴合移动端弹窗的弹性交互体验；</li>
<li>所有动画类名<strong>必须写在容器样式之后</strong>，利用CSS“后定义优先”原则保证动画样式优先级。</li>
</ul>
<h5 data-id="heading-11">（3）逻辑层设计</h5>
<ul>
<li>仅通过<code>showPopup</code>一个布尔值控制弹窗和遮罩层的显隐，逻辑极简且易维护；</li>
<li>触发按钮、关闭按钮、遮罩层绑定同一状态切换逻辑，保证交互行为一致性。</li>
</ul>
<h3 data-id="heading-12">三、踩坑记录：动画类样式不生效问题</h3>
<h4 data-id="heading-13">3.1 问题现象</h4>
<p>按常规思路定义<code>slide-popup-enter</code>/<code>slide-popup-leave-to</code>等动画类后，弹窗显隐无位移动画：</p>
<ul>
<li>弹窗直接显示/隐藏，无平滑过渡效果；</li>
<li>浏览器开发者工具中，动画类的<code>transform</code>属性被划掉（样式被覆盖）；</li>
<li>仅<code>opacity</code>属性生效（无样式冲突），位移动画完全失效。</li>
</ul>
<h4 data-id="heading-14">3.2 根因定位</h4>
<h5 data-id="heading-15">（1）CSS 优先级核心规则</h5>
<p>类选择器权重均为<code>0,1,0</code>时，<strong>后定义的样式会覆盖先定义的样式</strong>，这是CSS的基础优先级规则。</p>
<h5 data-id="heading-16">（2）具体冲突场景</h5>
<p>实际开发中错误的样式书写顺序：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 错误：先写动画类，后写容器类 */</span>
<span class="hljs-selector-class">.slide-popup-enter</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">100%</span>); <span class="hljs-comment">/* 先定义，权重相同会被覆盖 */</span>
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}
<span class="hljs-selector-class">.slide-popup-leave-to</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">100%</span>);
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.popup-container</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">/* 后定义，直接覆盖动画类的transform */</span>
}
</code></pre>
<p>容器类popup-container中transform: translateY(0)后定义，完全覆盖了动画类的transform属性，导致位移动画失效；而opacity无冲突，因此仍能生效。</p>
<h4 data-id="heading-17">3.3 解决方案</h4>
<h5 data-id="heading-18">方案 1：调整样式书写顺序（推荐，符合开发习惯）</h5>
<p>将动画类样式书写在容器基础样式之后，利用CSS“后定义优先”的优先级规则，让动画类的样式覆盖容器类中冲突的属性，确保动画相关的样式能够生效，这也是实际开发中最常用、最符合编码习惯的解决方案。</p>
<h5 data-id="heading-19">方案 2：移除容器类中的冲突属性（极简方案）</h5>
<p>直接删除容器类里和动画类重复定义的属性（如transform），不再让容器样式中存在与动画效果相关的同类型属性，由动画类完全掌控元素的动画属性，从根源上避免样式覆盖的问题，这种方式也能让样式结构更简洁。</p>
<h5 data-id="heading-20">方案 3：提高动画类权重（应急方案，不推荐）</h5>
<p>通过组合选择器的方式提升动画类的样式权重，以此强制覆盖容器类的冲突属性。但该方式会增加样式的复杂度，不利于后续的维护和调试，仅建议在紧急场景下临时使用，不推荐作为常规解决方案。</p>
<h4 data-id="heading-21">3.4 避坑核心总结</h4>
<ol>
<li>实际开发中使用transition组件时，核心类名就是name-enter/name-enter-active/name-enter-to/name-leave/name-leave-active/name-leave-to，这是最通用、最贴合实际开发的写法；</li>
<li>动画类样式必须写在元素基础样式之后，这是解决样式覆盖问题的核心原则，也是保证动画生效的关键；</li>
<li>尽量避免在元素基础样式中定义与动画类重复的属性（如transform、opacity等），从根源上减少样式冲突的可能性；</li>
<li>调试动画不生效问题时，优先通过浏览器“元素→样式”面板检查动画属性是否被划掉，以此快速定位样式优先级冲突问题。</li>
</ol>
<h3 data-id="heading-22">四、总结</h3>
<p>Vue2 transition组件的核心价值是通过name自定义前缀 + 固定的enter/leave类名体系，实现低成本的过渡动画效果，实际开发中需重点关注以下几点：</p>
<ol>
<li>掌握核心类名体系：name-enter（进入初始状态）→ name-enter-active（进入动画过程）→ name-enter-to（进入结束状态）；name-leave（离开初始状态）→ name-leave-active（离开动画过程）→ name-leave-to（离开结束状态），这是最贴合实际开发的写法；</li>
<li>重视样式优先级：动画类务必书写在元素基础样式之后，利用CSS“后定义优先”的原则保证动画样式生效；</li>
<li>规避样式冲突：不重复定义动画相关属性，从根源上减少样式覆盖的风险；</li>
<li>优化交互体验：结合cubic-bezier自定义缓动函数，让动画效果更符合实际产品的交互质感。</li>
</ol>
<p>transition是Vue2中实现单元素过渡动画的最优方案，掌握上述规则可解决绝大多数动画不生效的问题，同时能保证代码的可维护性和交互体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[终于有人帮你整理好了，火爆的“系统级提示词”支持ChatGPT、Claude、Gemini、xAI的]]></title>    <link>https://juejin.cn/post/7578332586063249459</link>    <guid>https://juejin.cn/post/7578332586063249459</guid>    <pubDate>2025-12-01T05:56:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578332586063249459" data-draft-id="7578442185847423014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="终于有人帮你整理好了，火爆的“系统级提示词”支持ChatGPT、Claude、Gemini、xAI的"/> <meta itemprop="keywords" content="前端,后端,GitHub"/> <meta itemprop="datePublished" content="2025-12-01T05:56:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小华同学ai"/> <meta itemprop="url" content="https://juejin.cn/user/3389136900195088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            终于有人帮你整理好了，火爆的“系统级提示词”支持ChatGPT、Claude、Gemini、xAI的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3389136900195088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小华同学ai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:56:54.000Z" title="Mon Dec 01 2025 05:56:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嗨，我是小华同学，专注解锁高效工作与前沿AI工具！每日精选开源技术、实战技巧，助你省时50%、领先他人一步。👉免费订阅，与10万+技术人共享升级秘籍！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b09ec9c7f2b4a5d9a91a6126f04054f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Y2O5ZCM5a2mYWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173413&amp;x-signature=jeZAcPlaEi%2FpNeoIai7kIcWxpVU%3D" alt="" loading="lazy"/></p>
<blockquote>
<p><strong>System Prompts Leaks</strong> 是一个开源仓库，专门收集整理各大主流聊天机器人（如 <strong>ChatGPT、Claude、Gemini</strong> 等）的系统提示词（System Prompts / System Messages / Developer Messages）。仓库按照厂商分目录维护了大量已被提取出的系统提示内容，是学习大模型底层提示工程和安全问题时非常高价值的资料集。</p>
</blockquote>
<h2 data-id="heading-0">为什么系统提示词值得你花时间？</h2>
<p>对绝大多数人来说，和大模型的交互只停留在一行行用户指令（user prompt）： “帮我写段代码”、“解释这段 SQL”、“润色一下邮件”。</p>
<p>但在这些对话背后，还有一层<strong>不会展示给终端用户看的“底层设定”</strong> ——系统提示词（System Prompt）：</p>
<ul>
<li>它决定了模型<strong>说话的口吻和角色</strong>（严肃？幽默？像专家还是像老师？）</li>
<li>它规定了<strong>必须遵守的规则</strong>（哪些问题不能答、遇到敏感话题如何回避）</li>
<li>它告诉模型<strong>要如何使用工具</strong>（搜索、代码执行、文件读取等）</li>
<li>它定义了<strong>回答格式</strong>（是否要用 Markdown、是否强制加引用、是否输出代码块）</li>
</ul>
<p>对做 AI 产品、做 Prompt Engineering 或研究 AI 安全的人来说，这些系统提示词几乎就是 <strong>“模型产品说明书 + 行为规范”</strong> 。</p>
<p>学界甚至已经把“系统提示词泄露（Prompt Leakage）”当成一个重要的安全课题：攻击者通过精心构造的提示，诱导模型把自己的 system prompt 说出来，从而窃取内部策略与商业机密。</p>
<h2 data-id="heading-1">你正在遇到的这些痛点，这个仓库都对得上号</h2>
<p>站在一个日常玩大模型、做技术分享的视角，很容易有这些困惑：</p>
<ul>
<li><strong>“为什么 ChatGPT 这么爱加 disclaimer？这些话是哪来的？”</strong></li>
<li><strong>“Claude 老强调要加引用、要用 artifacts，它是被谁这样要求的？”</strong></li>
<li><strong>“我也想给自己内部的 Agent 写一套专业的 system prompt，但不知道从哪学起。”</strong></li>
<li><strong>“安全团队让我评估‘Prompt Leakage 风险’，可我连别人的 system prompt 长什么样都没见过。”</strong></li>
</ul>
<p>而 <code>asgeirtj/system_prompts_leaks</code> 做的事情，就是把这些原本藏在云端服务里的“隐身设定”，以<strong>文本文件的形式整理出来</strong>，变成你可以直接学习、对比、借鉴的素材。</p>
<h2 data-id="heading-2">核心内容和结构拆解</h2>
<p>打开仓库主页，你会看到非常简洁但信息量很大的结构：</p>
<ul>
<li>
<p>顶层目录包含：</p>
<ul>
<li><code>Anthropic/</code></li>
<li><code>Google/</code></li>
<li><code>OpenAI/</code></li>
<li><code>Perplexity/</code></li>
<li><code>Proton/</code></li>
<li><code>xAI/</code></li>
<li><code>Misc/</code></li>
<li>以及根目录下的 <code>claude.txt</code>、<code>WARP.md</code> 等文件</li>
</ul>
</li>
</ul>
<p>这已经暗示了项目的核心定位：<strong>按厂商拆分，按产品/模型整理，对应的都是已被提取出来的系统提示词</strong>。</p>
<h3 data-id="heading-3">1. 多厂商、多模型的系统提示词集中收录</h3>
<ul>
<li>README 的 About 写得很直接： “Collection of extracted System Prompts from popular chatbots like <strong>ChatGPT, Claude &amp; Gemini</strong>”。</li>
<li>对你来说，这意味着： 不用再到处搜 Reddit、X、博客文章，一个仓库就能看到多家厂商被公开的 system prompt 版本。</li>
</ul>
<h3 data-id="heading-4">2. 按厂商分类的目录结构</h3>
<p>顶层目录名直接对应厂商（Anthropic、OpenAI、Google、Perplexity、xAI 等），加上一个 <code>Misc/</code> 放杂项，结构非常直观。</p>
<p>这带来几个直接好处：</p>
<ul>
<li>想看某一家的设定，<strong>直接进对应目录</strong></li>
<li>方便你自己脚本批量处理，比如只分析 <code>OpenAI/</code> 目录下的文件</li>
<li>为后续的<strong>自动化对比、可视化</strong>打下基础（比如统计不同厂商在“安全条款”上的差异）</li>
</ul>
<h3 data-id="heading-5">3. 具有代表性的 Claude 系统提示词示例</h3>
<p>仓库根目录下的 <code>claude.txt</code> 是整个项目里非常典型的一个例子。这个文件被外部分析认为是 <strong>Anthropic Claude 模型的系统提示词</strong>，长度超过 1000 行，体积约 110KB，并且与实际 Claude Sonnet 3.7 的行为在文案级别高度一致。</p>
<p>文件开头的内容就已经体现出它的“产品级”严谨：</p>
<blockquote>
<p>如果回答依赖于 <code>web_search</code>、<code>drive_search</code> 等工具的结果，就必须加上正确格式的引用标记……（意译）</p>
</blockquote>
<p>在这类长系统提示里，你可以看到：</p>
<ul>
<li>如何设计<strong>工具调用策略</strong></li>
<li>如何规定<strong>引用、格式、代码块</strong>等细节</li>
<li>如何在<strong>安全合规</strong>与<strong>用户体验</strong>之间做权衡</li>
</ul>
<h3 data-id="heading-6">4. Git 仓库天然具备版本管理能力</h3>
<p>虽然 README 没有大篇幅介绍，但从仓库可以看到至少 200+ 次提交记录，这意味着它并非“一次性上传”后就不管了，而是一个<strong>持续更新、跟随模型演进的动态档案库</strong>。</p>
<p>对研究者和工程师来说，这给你带来一个额外 bonus：</p>
<ul>
<li>你可以对比<strong>不同时间点的系统提示变化</strong></li>
<li>用 <code>git diff</code> 查看某一段安全条款是如何被加强或放宽的</li>
<li>甚至可以据此猜测厂商在不同阶段对产品的策略调整</li>
</ul>
<h3 data-id="heading-7">5. Star History</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/451b1e853f5a4fc3a566dd8b66409649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Y2O5ZCM5a2mYWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173413&amp;x-signature=LdOhWWWFoV6zlhN%2BIpSGN%2FM07I0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">技术架构</h2>
<p>这个项目本身没有复杂的代码逻辑，本质上就是一个<strong>文本数据仓库</strong>。 但如果我们从“怎么用它”来倒推，可以把它看成下面这样的一个“小型架构”：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b95a24e6e1d047ab8211507208be8c90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5Y2O5ZCM5a2mYWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173413&amp;x-signature=hKV1Bg%2FmDrO1x1%2BJF5YH1EwnvLg%3D" alt="" loading="lazy"/></p>
<p>你可以把它理解成：</p>
<ol>
<li>
<p><strong>数据层</strong>：GitHub 仓库中的各个文本文件</p>
</li>
<li>
<p><strong>处理层</strong>：你自己的 Python / Notebook / 脚本</p>
</li>
<li>
<p><strong>应用层</strong>：</p>
<ul>
<li>设计自己产品的 System Prompt</li>
<li>做安全审计、Prompt Leakage 风险评估</li>
<li>教学/内部分享，给非技术同事解释“大模型背后的那份说明书”</li>
</ul>
</li>
</ol>
<h2 data-id="heading-9">如何快速上手这些系统提示词？</h2>
<p>下面给出三种非常实用、又容易上手的使用方式，你可以直接在自己的学习/工作流里照抄过去。</p>
<h3 data-id="heading-10">方式一：直接在线浏览，快速获取直觉</h3>
<p>最简单的方式就是<strong>在线点开文本文件</strong>，比如：</p>
<ul>
<li>仓库主页选择 <code>claude.txt</code></li>
<li>直接在浏览器里滚动阅读</li>
<li>用浏览器搜索（<code>Ctrl + F</code>）关键词，如 <code>tool</code>, <code>citation</code>, <code>safety</code> 等，观察它在系统提示里是如何被描述和约束的</li>
</ul>
<p>这一步可以帮你快速形成几个直觉：</p>
<ul>
<li>Claude 被要求如何使用工具与引用</li>
<li>系统提示会把哪些事情讲得特别细（比如输出格式）</li>
<li>哪些内容是在用户对话中永远看不到的“隐形规则”</li>
</ul>
<h3 data-id="heading-11">方式二：本地克隆 + Python 分析</h3>
<p>如果你更偏工程实践，推荐直接把仓库拉到本地，用 Python 做一点轻量分析。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆仓库</span>
git <span class="hljs-built_in">clone</span> https://github.com/asgeirtj/system_prompts_leaks.git
<span class="hljs-built_in">cd</span> system_prompts_leaks

<span class="hljs-comment"># 查看顶层结构（示例输出）</span>
<span class="hljs-built_in">ls</span>
<span class="hljs-comment"># Anthropic  Google  Misc  OpenAI  Perplexity  Proton  xAI  WARP.md  claude.txt  readme.md</span>
</code></pre>
<p>然后用 Python 打开 <code>claude.txt</code>：</p>
<pre><code class="hljs language-ini" lang="ini">from pathlib import Path

<span class="hljs-attr">root</span> = Path(<span class="hljs-string">"system_prompts_leaks"</span>)

<span class="hljs-comment"># 读取 Claude 的系统提示</span>
<span class="hljs-attr">claude_prompt</span> = (root / <span class="hljs-string">"claude.txt"</span>).read_text(encoding=<span class="hljs-string">"utf-8"</span>)

<span class="hljs-comment"># 粗略看看前 40 行</span>
for i, line in enumerate(claude_prompt.splitlines()<span class="hljs-section">[:40]</span>, <span class="hljs-attr">start</span>=<span class="hljs-number">1</span>):
    print(f"{i:02d}: {line}")
</code></pre>
<p>再做一点简单的“词频”统计，看看系统提示里最常提到什么：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">keywords</span> = [<span class="hljs-string">"tool"</span>, <span class="hljs-string">"citation"</span>, <span class="hljs-string">"safety"</span>, <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"system"</span>]
<span class="hljs-attr">lower_text</span> = claude_prompt.lower()

for kw in keywords:
    <span class="hljs-attr">count</span> = lower_text.count(kw)
    print(f"{kw:10s}: {count}")
</code></pre>
<p>你可以把这些统计结果做成表格或图表，用来：</p>
<ul>
<li>对比不同模型在<strong>安全相关词汇</strong>上的密度</li>
<li>找出系统提示里<strong>最高频出现的行为要求</strong></li>
<li>总结出一套可复用的“系统提示设计 checklist”</li>
</ul>
<h3 data-id="heading-12">方式三：对照自己产品的 System Prompt 做“体检”</h3>
<p>如果你所在团队已经有了自己的 AI 助手或 Agent，可以用一个非常简单的思路：</p>
<ol>
<li>把你们自己的 system prompt 复制到一个文本文件，比如 <code>my_product_prompt.txt</code>。</li>
<li>从 <code>system_prompts_leaks</code> 里选一份你最想参考的（例如某个 ChatGPT 或 Claude 的提示）。</li>
<li>用 diff 工具（<code>git diff</code>、<code>meld</code>、VSCode 的对比功能等）进行<strong>并排对比</strong>。</li>
</ol>
<p>你会很直观地看到：</p>
<ul>
<li>大厂会用大量篇幅描述 <strong>“不该做什么”</strong> ，你的提示里是否缺失？</li>
<li>大厂会仔细规定<strong>工具调用策略</strong>（什么时候检索、什么时候用代码执行），你是否只是简单一句“你可以用搜索”？</li>
<li>在<strong>格式、引用、错误处理</strong>等细节上，你的提示是否“写得太随意”？</li>
</ul>
<p>这种对比方式，非常适合拿来做团队内部分享或 code review 级别的“prompt review”。</p>
<h2 data-id="heading-13">应用场景</h2>
<p>结合仓库内容和结构，它特别适合以下几类人群：</p>
<ul>
<li><strong>Prompt 工程师 / AI 产品经理</strong> 想打造一个“像大厂一样专业”的 system prompt，而不是凭感觉堆几句话。</li>
<li><strong>AI 安全 / 红队</strong> 需要了解系统提示被泄露之后，攻击面长什么样，方便设计更有针对性的测试用例。</li>
<li><strong>大模型课程讲师 / 技术博主</strong> 需要有真实案例，给学员或读者展示“系统提示到底有多长、多细致”。</li>
<li><strong>正在自建 Agent 框架 / AI 平台的团队</strong> 需要一套“行业标杆”作为参考，避免完全从零发明轮子。</li>
<li><strong>好奇心强的 AI 爱好者</strong> 想知道 ChatGPT、Claude、Gemini 到底是被如何“养成”现在这个性格的。</li>
</ul>
<h2 data-id="heading-14">什么时候优先用 system_prompts_leaks？</h2>
<p>目前围绕“系统提示词收集”的开源项目已经形成了一个小生态。和其中几款对比一下，更有利于你选型。</p>
<h3 data-id="heading-15">代表性同类项目</h3>
<ol>
<li>
<p><strong>asgeirtj/system_prompts_leaks</strong>（本文主角）</p>
<ul>
<li>定位：收集 ChatGPT、Claude、Gemini 等<strong>主流聊天机器人</strong>的系统提示词。</li>
<li>规模：23.9k⭐ Star、3.7k Fork。</li>
</ul>
</li>
<li>
<p><strong>jujumilk3/leaked-system-prompts</strong></p>
<ul>
<li>定位：收集<strong>各类 LLM 服务</strong>的泄露系统提示词。</li>
<li>规模：约 13.6k⭐ Star、1.9k Fork。</li>
<li>仓库内有大量按服务命名的 Markdown 文件，例如 Claude 3.x/4 系列、Cursor IDE、GitHub Copilot Chat、DeepSeek 等等。</li>
</ul>
</li>
<li>
<p><strong>x1xhlol/system-prompts-and-models-of-ai-tools</strong></p>
<ul>
<li>定位：更大规模的“系统提示 + 内部工具配置 + 模型信息”合集，覆盖 Cursor、Devin、Manus、Same.dev、Lovable、Replit Agent、Windsurf Agent、VSCode Agent、v0 等大量 AI 工具。</li>
<li>规模：约 98.5k⭐ Star、26.5k Fork。</li>
<li>README 提到“Over 30,000+ lines of insights into their structure and functionality.”</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">对比表：三大系统提示词仓库怎么选？</h3>

































<table><thead><tr><th>仓库</th><th>Star 数（约）</th><th>主要内容范围</th><th>结构特点</th><th>适合人群</th></tr></thead><tbody><tr><td><code>asgeirtj/system_prompts_leaks</code></td><td><strong>23.9k⭐</strong></td><td>ChatGPT、Claude、Gemini 等主流聊天机器人系统提示词</td><td>按厂商分目录（Anthropic / OpenAI / Google / Perplexity / Proton / xAI / Misc），包含代表性示例如 <code>claude.txt</code></td><td>想专注研究<strong>对话式助手</strong>的整体行为与安全策略</td></tr><tr><td><code>jujumilk3/leaked-system-prompts</code></td><td><strong>13.6k⭐</strong></td><td>各类 LLM 服务的泄露系统提示词，如 Claude、Cursor、GitHub Copilot、DeepSeek 等</td><td>文件以服务+版本命名，粒度更细，方便针对具体产品做分析</td><td>需要分析<strong>单一产品/工具</strong>（例如某个 IDE 插件或某个在线服务）的行为</td></tr><tr><td><code>x1xhlol/system-prompts-and-models-of-ai-tools</code></td><td><strong>98.5k⭐</strong></td><td>大量 AI 工具的系统提示、内部工具配置和模型信息，行数超过 30,000 行</td><td>目录按工具划分（Cursor、Devin、Manus、Perplexity、v0 等），并附加了部分工程环境和模型信息</td><td>想系统性研究<strong>AI 工具生态</strong>、对 Agent 框架/Dev 工具有深入兴趣的开发者</td></tr></tbody></table>
<p>如果你：</p>
<ul>
<li>主要关注的是<strong>聊天机器人本身的行为和安全策略</strong> → 首选 <code>system_prompts_leaks</code></li>
<li>想研究<strong>特定产品</strong>（比如 Cursor、GitHub Copilot）的系统提示 → 可以配合 <code>leaked-system-prompts</code> 使用</li>
<li>想从整体上理解<strong>各种 AI 工具/Agent 的 Prompt 设计模式</strong> → 可再搭配 <code>system-prompts-and-models-of-ai-tools</code>，形成一个更大的“Prompt 知识图谱”</li>
</ul>
<h2 data-id="heading-17">总结</h2>
<p>回到我们最初的问题： “如何写出一份够专业的 system prompt，让自己的 AI 助手看起来不像玩具？”</p>
<p><code>asgeirtj/system_prompts_leaks</code> 这个仓库，给了你一个非常务实的答案：</p>
<ul>
<li>你可以亲眼看到<strong>大厂在真实产品中是怎么写 System Prompt 的</strong>；</li>
<li>你可以对比不同厂商在<strong>安全合规、工具调用、输出格式、用户体验</strong>上的取舍；</li>
<li>你可以用脚本把这些长文本拆成结构化信息，演化成自己团队的一套“System Prompt 设计规范”；</li>
<li>你甚至可以把它当成一个“教材”，在内部分享或公开课程中展示给更多人看。</li>
</ul>
<p>它不是那种“点一下就能跑”的工具项目，而是一份实实在在的<strong>知识型资产</strong>—— 把原本藏在黑盒里的“底层设定”，变成你可以阅读、研究、复用的文本。</p>
<h2 data-id="heading-18">项目地址</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fasgeirtj%2Fsystem_prompts_leaks" target="_blank" title="https://github.com/asgeirtj/system_prompts_leaks" ref="nofollow noopener noreferrer">github.com/asgeirtj/sy…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[美团 LongCat 团队发布 AMO-Bench：突破 AIME 评测饱和困境，重新定义 LLM 数学上限]]></title>    <link>https://juejin.cn/post/7578582010416005126</link>    <guid>https://juejin.cn/post/7578582010416005126</guid>    <pubDate>2025-12-01T07:36:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578582010416005126" data-draft-id="7578391787981783081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="美团 LongCat 团队发布 AMO-Bench：突破 AIME 评测饱和困境，重新定义 LLM 数学上限"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-01T07:36:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="美团技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/3509296845313741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            美团 LongCat 团队发布 AMO-Bench：突破 AIME 评测饱和困境，重新定义 LLM 数学上限
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47ccb42d726640a7889ba1e64ae203e6~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="美团技术团队" class="title" data-v-d326b38e="">美团技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-01T07:36:24.000Z" title="Mon Dec 01 2025 07:36:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-01
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读10分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              美团小编 @美团
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大模型的“推理能力”能让机器具备与人类相似的认知和行为能力，能像人一样理解、思考、学习并解决复杂问题。而在众多推理能力评测场景中，数学推理任务是当前衡量和追踪模型推理能力进展的 “黄金标尺”。与此同时，主流数学推理评测体系正面临关键瓶颈：部分顶尖模型在常用的数学推理评测任务中，如 AIME24/25 的正确率已突破 90%，评测区分度大幅下降，难以再有效牵引模型向更高阶推理能力进化；此外，现有基准大多源于公开竞赛题库，存在数据穿越风险。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4337448e807490495119091671ba537~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=fo24O7BEdoD9ILpS7cVrkpZEn50%3D" alt="" loading="lazy"/></p>
<p>在此背景下，<strong>美团 LongCat 团队发布数学推理评测基准—— AMO-Bench</strong> 。该评测集共包含 50 道竞赛专家原创试题， 所有题目均对标甚至超越 IMO 竞赛难度。目前，头部大模型在 AMO-Bench 上的最好表现也尚未及格，SOTA 性能仅为 52.4%，绝大多数模型正确率低于 40%。AMO-Bench 既揭示出当前大语言模型在处理复杂推理任务上的局限性，同时也为模型推理能力的进一步提升树立了新的的标杆。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12d1cbaaec3f46468a2587dabc48b23b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=%2Fkx8aykfDneI2UJ7r1UsW%2Bpq0IE%3D" alt="顶级推理模型在 AMO‑Bench 以及 AIME24/25、HMMT25、MATH500 数学基准测试上的性能" loading="lazy"/></p>
<p>AMO-Bench 的评测榜单将保持更新，欢迎持续关注：</p>
<ul>
<li><strong>项目主页</strong>：<a href="https://link.juejin.cn?target=http%3A%2F%2Famo-bench.github.io%2F" target="_blank" title="http://amo-bench.github.io/" ref="nofollow noopener noreferrer">amo-bench.github.io/</a></li>
<li><strong>Github 地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmeituan-longcat%2FAMO-Bench" target="_blank" title="https://github.com/meituan-longcat/AMO-Bench" ref="nofollow noopener noreferrer">github.com/meituan-lon…</a></li>
<li><strong>Hugging Face 地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fdatasets%2Fmeituan-longcat%2FAMO-Bench" target="_blank" title="https://huggingface.co/datasets/meituan-longcat/AMO-Bench" ref="nofollow noopener noreferrer">huggingface.co/datasets/me…</a></li>
</ul>
<h2 data-id="heading-0">一、评测现状：老题库 “失效”，行业亟需高难度原创基准</h2>
<p>现有数学评测 benchmark 因出现严重的性能饱和问题，已无法有效指引头部大语言模型推理能力的进一步提升。一方面，随着 AIME、HMMT 等竞赛题库的公开，模型有可能通过训练数据 “背诵答案”，成绩可信度存疑；另一方面，随着模型的快速迭代升级，现有评测榜单上头部模型的得分趋同，因此逐渐失去鉴别模型能力差异的价值。为进一步提升评测集的难度，已有工作考虑直接使用 IMO 等等有挑战性的竞赛原题对模型进行评测。然而，现有 IMO 题目仍以证明题为主，极度依赖人工批改模型的复杂证明过程，单题批改需 30 分钟以上，评测效率低下且易受主观因素影响。</p>
<p>当前行业迫切需要一套 “高难度 + 原创 + 可自动化” 的评测方案。在这一背景下，AMO-Bench 的推出直击行业痛点—— 50 道竞赛专家原创题目、对标甚至超越 IMO 的试题难度、配套高效高准确率的自动化打分算法，为大模型推理能力评测提供了可落地的新标杆。</p>
<h2 data-id="heading-1">二、AMO-Bench：高难度数学推理评测的 “行业新标杆”</h2>
<p>AMO-Bench 拥有一套系统化的数据构建逻辑、清晰的数据难度特征与针对性的模型打分算法，为行业提供了一套可信赖且置信的评测方案。</p>
<h3 data-id="heading-2">2.1 AMO-Bench 的构建</h3>
<p>为打造兼具高质量、强原创性与高挑战性的数据集，LongCat 团队构建了一套 “数据创建 - 质量审查 - 原创性审查 - 难度审查” 全链路流程。</p>
<p><strong>数据创建：专家原创，自带 “解题说明书”</strong></p>
<ul>
<li>题目由具备数学奥林匹克竞赛获奖经历或相关竞赛出题经验的顶尖专家独立设计，每道试题不仅提供最终答案，还详细撰写了 step-by-step 解题路径 —— 从关键定理应用到逻辑推导节点，每一步都清晰标注，既为后续审查提供依据，也为模型错误分析预留 “参考坐标”。</li>
</ul>
<p><strong>质量审查：三重盲审，杜绝 “题不对标”</strong></p>
<ul>
<li>每道题需经 3 位以上专家 “盲审”质检，重点核查两大核心：一是题目表述与解题逻辑是否无歧义，避免因题干模糊导致的模型误判；二是所需数学知识是否严格匹配数学奥赛考察的知识范围（如代数、几何、数论等核心领域），确保不超纲、不偏题，真正考验模型的推理能力。</li>
</ul>
<p><strong>原创性审查：题库匹配 + 人工核验，切断 “数据穿越”</strong></p>
<ul>
<li>采用 “技术核验 + 专家经验” 双重保障：通过 n-gram 文本匹配与互联网检索等方式，与 AIME24/25 等主流竞赛数据集和在线数据库进行比对，排除与现有数据资源中高度相似的题目；同时依靠专家经验进行人工核验，确保与过往竞赛题无高度重合，杜绝模型 “背答案” 的可能。</li>
</ul>
<p><strong>难度审查：双标筛选，确保 “够硬核”</strong></p>
<ul>
<li>采用双重难度筛选标准来保证每一道题目都具备足够挑战性：首先使用国内外最顶尖模型进行筛选，要求至少 2 款模型在 3 次独立测试中无法全部答对；其次候选题目需要经过第三方专家进行二次审核题目难度，确保题目难度不低于 IMO 标准。</li>
</ul>
<h3 data-id="heading-3">2.2 数据集：覆盖核心领域，推理复杂度显著升级</h3>
<p><strong>AMO-Bench 的 50 道题目覆盖数学奥赛核心领域，且从解题复杂度上实现对现有基准的全面超越。</strong></p>
<p><strong>题目分类：覆盖五大核心领域</strong></p>
<p>参照国际数学竞赛官方竞赛大纲，题目被划分为五大类：代数方程与不等式（11 题，占比 22%）、函数与数列（13 题，占比 26%）、几何（5 题，占比 10%）、数论（9 题，占比 18%）、组合数学（12 题，占比 24%），覆盖数学奥赛核心知识点，考察模型在不同领域是否存在能力短板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c795b089b9f4483a99a1eb72b5b09f04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=zW%2BIJi4Mr%2BijN672VUg0SqG137k%3D" alt="AMO‑Bench 问题类别分布" loading="lazy"/></p>
<p><strong>解题复杂度：答案长度远超传统基准</strong></p>
<p>通过对比大模型在 AMO-Bench 和现有数学评测集上的输出长度，可以看到，随着数据集难度的提升，模型表现在逐渐走低的同时，其输出 token 数量也会大幅增加。</p>
<p><strong>大模型在 AMO-Bench 上的解题步骤长度显著长于现有 AIME/HMMT 等评测集</strong>，这意味着 AMO-Bench 的题目需要模型构建更长、更复杂的逻辑链才能解答，本质上更具挑战性，能更精准地检验大模型的深度数学推理能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad465905e1f24fdcb8b22e948087c4d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=hD%2B3C%2BM0Ln9oSdANXjTdjGLcTGE%3D" alt="不同数学基准测试上模型准确率和平均输出长度的对比" loading="lazy"/></p>
<h3 data-id="heading-4">2.3 评分方法：兼顾 “自动化” 与 “准确性”</h3>
<p>AMO-Bench 的问题答案类型可以概括为四种类型，为兼顾打分准确率和打分效率，我们针对不同的答案类型匹配相应的评分方式：</p>
<ol>
<li>
<p>数值 / 集合 / 变量表达式类（39 题）：采用 “parser-based 自动评分”，要求模型将答案按指定格式（答案）输出，使用 Math-Verify 工具核验模型结果与标准答案的等价性；</p>
</li>
<li>
<p>描述性答案（11 题）：采用 “LLM 评分 + Majority Voting”，在实验中使用了 o4-mini（Low）为评分模型，对同一答案进行 5 次独立评分采样，取多数结果作为最终得分，以减小打分模型采样的波动性。</p>
</li>
</ol>
<p>为了验证打分方案的准确率，我们随机抽取了 10 款不同模型生成的 1000 组答案打分结果进行人工检查，结果显示 AMO-Bench 的评分方案准确率高达 99.2%，为大规模自动化评测提供了坚实保障。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0bfee0bd1d54b6caa0488c10d9193a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=fuhEwA0%2BG6c6x5g1kBSRYfJJiPk%3D" alt="示例一：数值答案" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02632253e58f480f9cf29d9e62f5cbd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=oCh5w4dUzT%2Fe9Sk8oGcqNBTqeU0%3D" alt="示例二：集合答案" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da5de518f6e94105951d029e8d133de1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=TU8Gi1CiZ%2FnKRLDXbIYZBUSxAWg%3D" alt="示例三：变量表达式答案" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d789a17bea7a4c7f8ccfa8b8aeecfb72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=gB73%2BPibU0qil6OHCZ%2B4e%2FpnzEo%3D" alt="示例四：描述性答案" loading="lazy"/></p>
<h2 data-id="heading-5">三、实验与分析：AMO-Bench 揭示大模型数学推理的能力边界</h2>
<p>为全面揭示当前大模型数学推理的能力边界，LongCat 团队分别从 “开源 / 闭源”和“推理 / 非推理” 两方面共筛选了 26 个头部大语言模型，真实的反应了当前主流模型在数学推理能力上的实际表现。</p>
<h3 data-id="heading-6">3.1 整体能力格局：顶尖模型仍 “不及格”，能力梯度差异显著</h3>
<p>从核心指标来看，当前大部分大模型在 AMO-Bench 上的表现远未达及格水平，且不同类型模型间呈现明显能力分层：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7a71f54f7254d79b0c193c9c42051a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=3w0srFKY9mV4rjy8hnGUApPEH4U%3D" alt="主流模型在 AMO‑Bench 上的表现（AVG@32）" loading="lazy"/></p>
<ul>
<li>闭源推理模型领跑，仍有巨大提升空间：表现最优的 GPT-5-Thinking（High）正确率仅 52.4%，且大部分模型表现低于 40%，即便头部闭源模型，也未突破 “及格线”，凸显 IMO 级难度的原创题对当前 AI 的挑战性；</li>
<li>开源模型仍有差距，但已在全力追赶：开源模型中 Qwen3-235B-A22B-Thinking-2507 正确率为 47.8%，DeepSeek-V3.1-Thinking 为 47.6%，距离最好表现的 GPT-5 仍有一定差距，但已明显超越 o4-mini 和 Gemini-2.5-Pro，展示出开源模型奋起直追的势头。</li>
</ul>
<h3 data-id="heading-7">3.2 推理效率关联：Test-Time Scaling 效果显著</h3>
<p>通过分析模型在 AMO-Bench 上输出长度与模型表现的关系，LongCat 团队指出，<strong>当前 test-time scaling 仍然是提升模型推理表现的有效手段</strong>。</p>
<ul>
<li><strong>高得分模型依赖更多 token 输出</strong>：AVG@32 超 40% 的模型（如 GPT-5-Thinking、DeepSeek-V3.1-Thinking），平均输出 token 量均超 35K，意味着当前的头部推理模型能通过构建显著更长的逻辑链来达到更好的解题表现。</li>
<li><strong>同系列模型迭代体现效率提升</strong>：以 o 系列模型为例，o4-mini（High）在相近 token 量下，正确率（40.2%）显著高于 o3-mini（High）（32.3%）；DeepSeek-V3.1-Thinking 较前代 DeepSeek-R1-0528，则进一步用更少 token（32K vs 38K）实现了更高正确率（47.6% vs 34.3%），证明新一代模型可以用更高的效率获取更强的推理性能。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa5c507962bf44faa0f7e6688e94d789~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=UR4z46p0s8Jcl8XCTlyLkOEGmWE%3D" alt="模型性能与平均输出长度的对比" loading="lazy"/></p>
<ul>
<li>推理投入与得分呈对数线性增长：同一模型正确率与输出长度对数呈近线性正相关，且这一趋势与现有工作在 MATH500、AIME24 等基准上的实验观察一致，证明增加推理计算投入仍是提升模型解决复杂任务能力的有效路径。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/012c8c5fc9b24b09a9f60fbbc33b1a09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=9Beg8jc1ov50GGMHGqw9qSQjKFg%3D" alt="不同推理 Effort 设置下的模型性能和输出长度的关系" loading="lazy"/></p>
<h3 data-id="heading-8">3.3 潜在能力挖掘：模型多次尝试下的探索潜力</h3>
<p>通过进一步分析模型的 “Pass@k” 表现（k 次尝试至少答对 1 次），LongCat 团队指出，前沿推理模型如 GPT-5-Thinking（High）、DeepSeek-V3.1-Thinking 等在 AMO-Bench 上能达到 Pass@32 超  70%，表明当前大模型暗含解决难题的潜力，其性能仍有巨大提升空间。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f33b1f7e4f004eaa8ac74a1048c1da48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=Hq4EQbZBOgStyPLEM7GYSyDDvFs%3D" alt="模型 Pass@K 指标变化趋势图" loading="lazy"/></p>
<h2 data-id="heading-9">四、总结与展望</h2>
<p>综上，AMO-Bench 相比 AIME24/25 等主流数学评测集具备了更好的区分度和模型提升空间，同时通过 IMO 级别的原创题解决了因数据泄露的潜在风险造成的评估失真问题，以及凭借 99.2% 的高打分准确率保证了自动化评测的准确性。未来，美团 LongCat 团队将持续更新 AMO-Bench 评测集，扩大题目覆盖类型与优化评测方案，同时会进一步探索包括通用和学科推理在内的高难度评测集建设，助力业界大模型在推理能力上的持续提升。</p>
<p><strong>阅读更多</strong></p>
<p>| 关注「美团技术团队」微信公众号，在公众号菜单栏对话框回复【2024年货】、【2023年货】、【2022年货】、【2021年货】、【2020年货】、【2019年货】、【2018年货】、【2017年货】等关键词，可查看美团技术团队历年技术文章合集。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04f39451ee4c42e7923d4266a3cdb924~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179384&amp;x-signature=UvHXlBv6Xkp6GWKnotJ2QiGaNQ0%3D" alt="" loading="lazy"/></p>
<p>| 本文系美团技术团队出品，著作权归属美团。欢迎出于分享和交流等非商业目的转载或使用本文内容，敬请注明“内容转载自美团技术团队”。本文未经许可，不得进行商业性转载或者使用。任何商用行为，请发送邮件至 <a href="https://link.juejin.cn?target=mailto%3Atech%40meituan.com" target="_blank" title="mailto:tech@meituan.com" ref="nofollow noopener noreferrer">tech@meituan.com</a> 申请授权。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何将 GitHub 仓库从个人账户转移到组织账户]]></title>    <link>https://juejin.cn/post/7578063389609885731</link>    <guid>https://juejin.cn/post/7578063389609885731</guid>    <pubDate>2025-12-01T05:30:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578063389609885731" data-draft-id="7578405594118783010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何将 GitHub 仓库从个人账户转移到组织账户"/> <meta itemprop="keywords" content="GitHub,Git,开源"/> <meta itemprop="datePublished" content="2025-12-01T05:30:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小Lu的日常"/> <meta itemprop="url" content="https://juejin.cn/user/2585689638569422"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何将 GitHub 仓库从个人账户转移到组织账户
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2585689638569422/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小Lu的日常
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:30:04.000Z" title="Mon Dec 01 2025 05:30:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在筹划将 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmathcheap.xyz%2F" target="_blank" title="https://mathcheap.xyz/" ref="nofollow noopener noreferrer">Mathcheap</a> 的开源出来，之前已经开源了<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmathcheap%2Fpandoc-wasm" target="_blank" title="https://github.com/mathcheap/pandoc-wasm" ref="nofollow noopener noreferrer">pandoc-wasm</a>（将pandoc 编译成wasm版本的docker镜像）。但一直放在我自己的GitHub 账号下面，今天打算转移到 Mathcheap 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmathcheap" target="_blank" title="https://github.com/mathcheap" ref="nofollow noopener noreferrer">GitHub</a> 账号下面，为后续产品的开源做准备，好了话不多说，开始实操。</p>
<ol>
<li>进入仓库设置</li>
</ol>
<p>在仓库的主页面，单击 Settings（设置）选项。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/272fc4d2c3bc43d7a024d39cc69f5d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPTHXnmoTml6XluLg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171846&amp;x-signature=ZIIAGJ%2BeLBLcDLq0NNg3uyKsrtc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">2. 找到转移选项</h3>
<p>滚动到页面底部，在名为Danger Zone（危险区域）的部分，单击Transfer（转让）按钮。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd83c80e74124b8591d9998bfa341793~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPTHXnmoTml6XluLg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171846&amp;x-signature=bTswCuso%2Br9O1dASCePExB2XYJ8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">3. 输入目标组织名称</h3>
<p>阅读转移说明后，在指定的文本框中输入要转移到新所有者的组织名称。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86b0676dd881423e984c1e80092267e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPTHXnmoTml6XluLg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171846&amp;x-signature=fULUcIKRQt6uihyCzCwiZCZ8Cz8%3D" alt="" loading="lazy"/></p>
<ol start="4">
<li>确认转移</li>
</ol>
<p>根据提示确认转移操作。请注意，根据新所有者的订阅计划，可能会失去某些功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0c9fbafae62430380a42cf6fe6af347~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPTHXnmoTml6XluLg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171846&amp;x-signature=U%2Bz0epR%2FIClnpzJD2NMWx3Ft%2BT0%3D" alt="" loading="lazy"/></p>
<p>好了，转移完成，项目地址如下：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmathcheap%2Fpandoc-wasm" target="_blank" title="https://github.com/mathcheap/pandoc-wasm" ref="nofollow noopener noreferrer">github.com/mathcheap/p…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python常用内置模块教程：os/sys/datetime/random/json全解析]]></title>    <link>https://juejin.cn/post/7578460753209753627</link>    <guid>https://juejin.cn/post/7578460753209753627</guid>    <pubDate>2025-12-01T06:55:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578460753209753627" data-draft-id="7578499754553147443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python常用内置模块教程：os/sys/datetime/random/json全解析"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-01T06:55:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="洗紫"/> <meta itemprop="url" content="https://juejin.cn/user/2534826370138953"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python常用内置模块教程：os/sys/datetime/random/json全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2534826370138953/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    洗紫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:55:10.000Z" title="Mon Dec 01 2025 06:55:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Python的内置模块是无需额外安装、开箱即用的核心工具库，覆盖文件操作、系统交互、时间处理、随机数生成、数据序列化等高频场景。本文聚焦<code>os</code>（文件/目录操作）、<code>sys</code>（系统参数交互）、<code>datetime</code>（时间日期处理）、<code>random</code>（随机数生成）、<code>json</code>（数据序列化）5个最常用的内置模块，从基础语法到实战场景，搭配可直接运行的代码示例，覆盖搜索引擎高频检索需求（如Python文件路径处理、时间格式转换、随机数生成、JSON解析），适合零基础快速掌握内置模块核心用法。</p>
<h2 data-id="heading-0">一、5大内置模块核心定位</h2>
<p>先明确每个模块的核心用途，避免“用错工具”：</p>



































<table><thead><tr><th>模块</th><th>核心功能</th><th>典型应用场景</th></tr></thead><tbody><tr><td><code>os</code></td><td>操作系统交互（文件/目录/路径）</td><td>创建文件夹、遍历文件、路径拼接</td></tr><tr><td><code>sys</code></td><td>Python解释器交互（参数/环境/退出）</td><td>命令行传参、获取系统信息、程序退出</td></tr><tr><td><code>datetime</code></td><td>时间日期处理（解析/转换/计算）</td><td>日志时间戳、时间差计算、格式标准化</td></tr><tr><td><code>random</code></td><td>随机数/随机选择（伪随机）</td><td>抽奖程序、数据采样、验证码生成</td></tr><tr><td><code>json</code></td><td>JSON数据序列化（读写/解析）</td><td>接口数据交互、配置文件读写、数据存储</td></tr></tbody></table>
<h2 data-id="heading-1">二、os模块：文件与目录操作的核心</h2>
<p><code>os</code>模块是Python操作文件系统的“万能工具”，无需第三方库即可实现文件创建、删除、目录遍历等操作，跨平台兼容性强。</p>
<h3 data-id="heading-2">1. 核心基础用法</h3>
<h4 data-id="heading-3">（1）获取当前工作目录</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 获取当前工作目录（绝对路径）</span>
current_dir = os.getcwd()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前工作目录："</span>, current_dir)  <span class="hljs-comment"># 输出示例：C:\Users\XXX\Desktop</span>
</code></pre>
<h4 data-id="heading-4">（2）创建/删除目录</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 1. 创建单个目录</span>
os.mkdir(<span class="hljs-string">"test_dir"</span>)  <span class="hljs-comment"># 在当前目录创建test_dir文件夹</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"单个目录创建完成"</span>)

<span class="hljs-comment"># 2. 创建多级目录（父目录不存在时自动创建）</span>
os.makedirs(<span class="hljs-string">"parent_dir/child_dir"</span>, exist_ok=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># exist_ok=True避免目录已存在报错</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"多级目录创建完成"</span>)

<span class="hljs-comment"># 3. 删除空目录</span>
os.rmdir(<span class="hljs-string">"test_dir"</span>)  <span class="hljs-comment"># 仅能删除空目录</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"空目录删除完成"</span>)

<span class="hljs-comment"># 4. 删除多级目录（需确保目录空，或用shutil模块）</span>
os.removedirs(<span class="hljs-string">"parent_dir/child_dir"</span>)  <span class="hljs-comment"># 递归删除空目录</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"多级空目录删除完成"</span>)
</code></pre>
<h4 data-id="heading-5">（3）文件操作（重命名/删除）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 1. 文件重命名</span>
os.rename(<span class="hljs-string">"old_file.txt"</span>, <span class="hljs-string">"new_file.txt"</span>)  <span class="hljs-comment"># 需确保old_file.txt存在</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"文件重命名完成"</span>)

<span class="hljs-comment"># 2. 删除文件</span>
os.remove(<span class="hljs-string">"new_file.txt"</span>)  <span class="hljs-comment"># 永久删除，无法恢复</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"文件删除完成"</span>)
</code></pre>
<h4 data-id="heading-6">（4）路径拼接（跨平台兼容）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 拼接路径（自动适配Windows的\和Linux的/）</span>
dir_path = <span class="hljs-string">"data"</span>
file_name = <span class="hljs-string">"user.csv"</span>
full_path = os.path.join(dir_path, file_name)  <span class="hljs-comment"># 结果：data/user.csv（Linux）或data\user.csv（Windows）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"拼接后的路径："</span>, full_path)

<span class="hljs-comment"># 获取文件扩展名</span>
ext = os.path.splitext(file_name)[<span class="hljs-number">1</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">"文件扩展名："</span>, ext)  <span class="hljs-comment"># 输出：.csv</span>

<span class="hljs-comment"># 获取文件所在目录</span>
file_dir = os.path.dirname(full_path)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"文件所在目录："</span>, file_dir)  <span class="hljs-comment"># 输出：data</span>
</code></pre>
<h3 data-id="heading-7">2. 进阶用法：遍历目录文件</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 示例1：遍历目录下所有文件（含子目录）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">traverse_dir</span>(<span class="hljs-params">dir_path</span>):
    <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(dir_path):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"当前目录：<span class="hljs-subst">{root}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"子目录：<span class="hljs-subst">{dirs}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文件：<span class="hljs-subst">{files}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)

<span class="hljs-comment"># 遍历当前目录</span>
traverse_dir(<span class="hljs-string">"."</span>)

<span class="hljs-comment"># 示例2：筛选指定类型文件（如.csv文件）</span>
csv_files = []
<span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(<span class="hljs-string">"."</span>):
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
        <span class="hljs-keyword">if</span> file.endswith(<span class="hljs-string">".csv"</span>):  <span class="hljs-comment"># 筛选.csv后缀</span>
            csv_files.append(os.path.join(root, file))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"所有CSV文件路径："</span>, csv_files)
</code></pre>
<h3 data-id="heading-8">3. 实用技巧：判断文件/目录是否存在</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

path = <span class="hljs-string">"data/user.csv"</span>

<span class="hljs-comment"># 判断路径是否存在</span>
<span class="hljs-keyword">if</span> os.path.exists(path):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{path}</span> 存在"</span>)
    <span class="hljs-comment"># 判断是否为文件</span>
    <span class="hljs-keyword">if</span> os.path.isfile(path):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{path}</span> 是文件"</span>)
    <span class="hljs-comment"># 判断是否为目录</span>
    <span class="hljs-keyword">elif</span> os.path.isdir(path):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{path}</span> 是目录"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{path}</span> 不存在"</span>)
</code></pre>
<h2 data-id="heading-9">三、sys模块：与Python解释器交互</h2>
<p><code>sys</code>模块主要用于获取Python解释器的系统信息、命令行参数传递、程序退出控制等，是脚本开发的常用工具。</p>
<h3 data-id="heading-10">1. 核心基础用法</h3>
<h4 data-id="heading-11">（1）命令行参数传递</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># sys.argv：获取命令行参数列表（第一个元素是脚本名）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"命令行参数列表："</span>, sys.argv)

<span class="hljs-comment"># 示例：运行脚本时传递参数 python script.py 张三 25</span>
<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt;= <span class="hljs-number">3</span>:
    name = sys.argv[<span class="hljs-number">1</span>]
    age = sys.argv[<span class="hljs-number">2</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"姓名：<span class="hljs-subst">{name}</span>，年龄：<span class="hljs-subst">{age}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"请传递姓名和年龄参数"</span>)
</code></pre>
<h4 data-id="heading-12">（2）获取系统信息</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># 获取Python版本</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Python版本："</span>, sys.version)

<span class="hljs-comment"># 获取操作系统类型（win32/linux等）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"操作系统类型："</span>, sys.platform)

<span class="hljs-comment"># 获取Python解释器路径</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"解释器路径："</span>, sys.executable)
</code></pre>
<h4 data-id="heading-13">（3）程序退出控制</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-built_in">print</span>(<span class="hljs-string">"程序开始执行"</span>)

<span class="hljs-comment"># 正常退出（状态码0表示成功）</span>
sys.exit(<span class="hljs-number">0</span>)

<span class="hljs-comment"># 以下代码不会执行</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"程序结束执行"</span>)

<span class="hljs-comment"># 异常退出（状态码非0表示失败）</span>
<span class="hljs-comment"># sys.exit(1)</span>
</code></pre>
<h3 data-id="heading-14">2. 进阶用法：设置递归深度/编码</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-comment"># 1. 设置递归最大深度（默认约1000）</span>
sys.setrecursionlimit(<span class="hljs-number">2000</span>)  <span class="hljs-comment"># 调整为2000</span>

<span class="hljs-comment"># 2. 获取默认编码</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"默认编码："</span>, sys.getdefaultencoding())

<span class="hljs-comment"># 3. 标准输入输出（替代print/input，更灵活）</span>
sys.stdout.write(<span class="hljs-string">"使用stdout输出\n"</span>)  <span class="hljs-comment"># 类似print</span>
user_input = sys.stdin.readline()  <span class="hljs-comment"># 类似input，读取一行输入</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"用户输入："</span>, user_input.strip())
</code></pre>
<h2 data-id="heading-15">四、datetime模块：时间日期的精准处理</h2>
<p><code>datetime</code>模块提供了比<code>time</code>模块更强大的时间处理功能，支持时间解析、格式转换、时间差计算，避免手动处理时间戳的繁琐。</p>
<h3 data-id="heading-16">1. 核心基础用法</h3>
<h4 data-id="heading-17">（1）获取当前时间/日期</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, date, time

<span class="hljs-comment"># 1. 获取当前日期时间（datetime对象）</span>
now = datetime.now()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前日期时间："</span>, now)  <span class="hljs-comment"># 输出示例：2024-05-20 14:30:25.123456</span>

<span class="hljs-comment"># 2. 获取当前日期（date对象）</span>
today = date.today()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前日期："</span>, today)  <span class="hljs-comment"># 输出示例：2024-05-20</span>

<span class="hljs-comment"># 3. 获取当前时间（time对象）</span>
current_time = datetime.now().time()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间："</span>, current_time)  <span class="hljs-comment"># 输出示例：14:30:25.123456</span>
</code></pre>
<h4 data-id="heading-18">（2）时间格式转换（str与datetime互转）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 1. datetime对象转字符串（格式化输出）</span>
now = datetime.now()
<span class="hljs-comment"># 常用格式：年-月-日 时:分:秒</span>
str_time = now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"格式化时间字符串："</span>, str_time)  <span class="hljs-comment"># 输出：2024-05-20 14:35:40</span>

<span class="hljs-comment"># 2. 字符串转datetime对象（解析时间）</span>
time_str = <span class="hljs-string">"2024-01-01 10:00:00"</span>
datetime_obj = datetime.strptime(time_str, <span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"解析后的datetime对象："</span>, datetime_obj)

<span class="hljs-comment"># 常用时间格式化符号：</span>
<span class="hljs-comment"># %Y：4位数年份（2024），%m：2位数月份（05），%d：2位数日期（20）</span>
<span class="hljs-comment"># %H：24小时制（14），%M：分钟（35），%S：秒（40）</span>
</code></pre>
<h4 data-id="heading-19">（3）时间差计算（timedelta）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta

now = datetime.now()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"当前时间："</span>, now)

<span class="hljs-comment"># 1. 计算3天后的时间</span>
future_time = now + timedelta(days=<span class="hljs-number">3</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"3天后的时间："</span>, future_time)

<span class="hljs-comment"># 2. 计算2小时前的时间</span>
past_time = now - timedelta(hours=<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"2小时前的时间："</span>, past_time)

<span class="hljs-comment"># 3. 计算两个时间的差值</span>
time1 = datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">5</span>, <span class="hljs-number">20</span>)
time2 = datetime(<span class="hljs-number">2024</span>, <span class="hljs-number">5</span>, <span class="hljs-number">15</span>)
diff = time1 - time2
<span class="hljs-built_in">print</span>(<span class="hljs-string">"时间差："</span>, diff.days, <span class="hljs-string">"天"</span>)  <span class="hljs-comment"># 输出：5 天</span>
</code></pre>
<h3 data-id="heading-20">2. 进阶用法：时区处理（UTC与本地时间）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timezone, timedelta

<span class="hljs-comment"># 1. 获取UTC时间</span>
utc_now = datetime.now(timezone.utc)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"UTC时间："</span>, utc_now)

<span class="hljs-comment"># 2. 转换为东8区时间（UTC+8）</span>
cst_now = utc_now.astimezone(timezone(timedelta(hours=<span class="hljs-number">8</span>)))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"东8区时间："</span>, cst_now.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>))
</code></pre>
<h2 data-id="heading-21">五、random模块：随机数与随机选择</h2>
<p><code>random</code>模块用于生成伪随机数（可通过seed固定序列），支持随机整数、浮点数、随机选择、打乱序列等操作，适用于抽奖、采样等场景。</p>
<h3 data-id="heading-22">1. 核心基础用法</h3>
<h4 data-id="heading-23">（1）生成随机数</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random

<span class="hljs-comment"># 1. 生成[0.0, 1.0)之间的随机浮点数</span>
random_float = random.random()
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机浮点数："</span>, random_float)

<span class="hljs-comment"># 2. 生成指定范围的随机整数（包含首尾）</span>
random_int = random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)  <span class="hljs-comment"># 1~100之间的整数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"1~100随机整数："</span>, random_int)

<span class="hljs-comment"># 3. 生成指定步长的随机整数</span>
random_step = random.randrange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)  <span class="hljs-comment"># 0、2、4、6、8中随机选</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"步长为2的随机整数："</span>, random_step)

<span class="hljs-comment"># 4. 生成指定范围的随机浮点数</span>
random_uniform = random.uniform(<span class="hljs-number">1.5</span>, <span class="hljs-number">3.5</span>)  <span class="hljs-comment"># 1.5~3.5之间的浮点数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"1.5~3.5随机浮点数："</span>, random_uniform)
</code></pre>
<h4 data-id="heading-24">（2）随机选择与序列打乱</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random

<span class="hljs-comment"># 1. 从列表中随机选择一个元素</span>
fruits = [<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>, <span class="hljs-string">"葡萄"</span>]
random_fruit = random.choice(fruits)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机选择的水果："</span>, random_fruit)

<span class="hljs-comment"># 2. 从列表中随机选择多个不重复元素（抽样）</span>
random_sample = random.sample(fruits, <span class="hljs-number">2</span>)  <span class="hljs-comment"># 选2个不重复元素</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"随机抽样2个水果："</span>, random_sample)

<span class="hljs-comment"># 3. 打乱列表顺序（原地修改）</span>
random.shuffle(fruits)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"打乱后的水果列表："</span>, fruits)
</code></pre>
<h3 data-id="heading-25">2. 实用技巧：固定随机序列（复现结果）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random

<span class="hljs-comment"># 设置随机种子（种子相同，生成的随机序列相同）</span>
random.seed(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"种子10生成的随机数1："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"种子10生成的随机数2："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))

<span class="hljs-comment"># 重新设置相同种子，复现随机序列</span>
random.seed(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"复现的随机数1："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))
<span class="hljs-built_in">print</span>(<span class="hljs-string">"复现的随机数2："</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>))
</code></pre>
<h2 data-id="heading-26">六、json模块：JSON数据的序列化与解析</h2>
<p><code>json</code>模块是Python处理JSON数据的标准库，支持Python对象（字典、列表）与JSON字符串的互转，是接口交互、配置文件读写的核心工具（详细JSON文件读写见前文，此处聚焦核心用法）。</p>
<h3 data-id="heading-27">1. 核心基础用法</h3>
<h4 data-id="heading-28">（1）Python对象转JSON字符串（dumps）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># Python字典（支持列表、字符串、数字、布尔值、None）</span>
data = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">25</span>,
    <span class="hljs-string">"city"</span>: <span class="hljs-string">"北京"</span>,
    <span class="hljs-string">"is_student"</span>: <span class="hljs-literal">False</span>,
    <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"篮球"</span>, <span class="hljs-string">"编程"</span>]
}

<span class="hljs-comment"># 转换为JSON字符串（ensure_ascii=False保留中文，indent格式化）</span>
json_str = json.dumps(data, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Python对象转JSON字符串：\n"</span>, json_str)
</code></pre>
<h4 data-id="heading-29">（2）JSON字符串转Python对象（loads）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># JSON字符串（注意键值对用双引号）</span>
json_str = <span class="hljs-string">'''
{
    "name": "李四",
    "age": 30,
    "city": "上海",
    "is_student": True,
    "hobbies": ["足球", "阅读"]
}
'''</span>

<span class="hljs-comment"># 解析为Python字典</span>
data = json.loads(json_str)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"JSON字符串转Python字典："</span>, data)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"姓名："</span>, data[<span class="hljs-string">"name"</span>], <span class="hljs-string">"，爱好："</span>, data[<span class="hljs-string">"hobbies"</span>][<span class="hljs-number">0</span>])
</code></pre>
<h4 data-id="heading-30">（3）JSON文件读写（dump/load）</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json

<span class="hljs-comment"># 1. 写入JSON文件</span>
data = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"王五"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">28</span>, <span class="hljs-string">"city"</span>: <span class="hljs-string">"广州"</span>}
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"user.json"</span>, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    json.dump(data, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"JSON文件写入完成"</span>)

<span class="hljs-comment"># 2. 读取JSON文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"user.json"</span>, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    read_data = json.load(f)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"读取的JSON数据："</span>, read_data)
</code></pre>
<h3 data-id="heading-31">2. 进阶用法：处理复杂Python对象（自定义序列化）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 自定义类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, create_time</span>):
        self.name = name
        self.age = age
        self.create_time = create_time

<span class="hljs-comment"># 自定义序列化函数（将User对象转为字典）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">user_serializer</span>(<span class="hljs-params">obj</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(obj, User):
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"name"</span>: obj.name,
            <span class="hljs-string">"age"</span>: obj.age,
            <span class="hljs-string">"create_time"</span>: obj.create_time.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
        }
    <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f"无法序列化类型：<span class="hljs-subst">{<span class="hljs-built_in">type</span>(obj)}</span>"</span>)

<span class="hljs-comment"># 创建User对象</span>
user = User(<span class="hljs-string">"赵六"</span>, <span class="hljs-number">26</span>, datetime.now())
<span class="hljs-comment"># 序列化（指定default参数）</span>
json_str = json.dumps(user, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>, default=user_serializer)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"自定义对象序列化：\n"</span>, json_str)
</code></pre>
<h2 data-id="heading-32">七、完整实战案例：多模块协同应用</h2>
<h3 data-id="heading-33">场景：生成随机用户数据，按时间戳命名保存为JSON文件</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-comment"># 1. 定义用户数据生成函数</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_random_user</span>():
    names = [<span class="hljs-string">"张三"</span>, <span class="hljs-string">"李四"</span>, <span class="hljs-string">"王五"</span>, <span class="hljs-string">"赵六"</span>, <span class="hljs-string">"孙七"</span>, <span class="hljs-string">"周八"</span>]
    cities = [<span class="hljs-string">"北京"</span>, <span class="hljs-string">"上海"</span>, <span class="hljs-string">"广州"</span>, <span class="hljs-string">"深圳"</span>, <span class="hljs-string">"杭州"</span>, <span class="hljs-string">"成都"</span>]
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"name"</span>: random.choice(names),
        <span class="hljs-string">"age"</span>: random.randint(<span class="hljs-number">20</span>, <span class="hljs-number">40</span>),
        <span class="hljs-string">"city"</span>: random.choice(cities),
        <span class="hljs-string">"register_time"</span>: datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>),
        <span class="hljs-string">"is_active"</span>: random.choice([<span class="hljs-literal">True</span>, <span class="hljs-literal">False</span>])
    }

<span class="hljs-comment"># 2. 生成10条随机用户数据</span>
user_list = [generate_random_user() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]

<span class="hljs-comment"># 3. 创建数据存储目录（不存在则创建）</span>
data_dir = <span class="hljs-string">"user_data"</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(data_dir):
    os.makedirs(data_dir)

<span class="hljs-comment"># 4. 按时间戳命名文件（避免重复）</span>
timestamp = datetime.now().strftime(<span class="hljs-string">"%Y%m%d%H%M%S"</span>)
file_path = os.path.join(data_dir, <span class="hljs-string">f"user_data_<span class="hljs-subst">{timestamp}</span>.json"</span>)

<span class="hljs-comment"># 5. 写入JSON文件</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
    json.dump(user_list, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">4</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"10条随机用户数据已保存至：<span class="hljs-subst">{file_path}</span>"</span>)
</code></pre>
<h2 data-id="heading-34">八、常见问题与避坑指南</h2>



































<table><thead><tr><th>常见错误</th><th>原因分析</th><th>解决方法</th></tr></thead><tbody><tr><td>os.mkdir创建多级目录报错</td><td>mkdir仅支持创建单个目录，父目录不存在时失败</td><td>改用os.makedirs并添加exist_ok=True</td></tr><tr><td>datetime格式化符号错误</td><td>混淆%Y（4位年）与%y（2位年）、%H（24小时）与%I（12小时）</td><td>对照格式化符号表，按需选择</td></tr><tr><td>JSON序列化中文乱码</td><td>未设置ensure_ascii=False，中文被转为\u编码</td><td>dumps/dump时添加ensure_ascii=False</td></tr><tr><td>random.seed无效</td><td>seed设置后仅对后续第一次随机操作生效，或多次设置不同种子</td><td>统一在程序开头设置一次种子</td></tr><tr><td>sys.argv参数获取失败</td><td>命令行传递参数数量不足，或索引错误（从1开始）</td><td>先判断len(sys.argv)，再获取参数</td></tr></tbody></table>
<h2 data-id="heading-35">九、进阶技巧</h2>
<h3 data-id="heading-36">1. os模块路径处理（Python3.4+推荐pathlib）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path  <span class="hljs-comment"># Python3.4+内置，替代os.path</span>

<span class="hljs-comment"># 创建路径对象</span>
path = Path(<span class="hljs-string">"data/user.csv"</span>)

<span class="hljs-comment"># 判断路径是否存在</span>
<span class="hljs-keyword">if</span> path.exists():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"路径存在"</span>)

<span class="hljs-comment"># 拼接路径</span>
new_path = Path(<span class="hljs-string">"data"</span>) / <span class="hljs-string">"new_user.csv"</span>  <span class="hljs-comment"># 更直观的拼接方式</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"拼接路径："</span>, new_path)

<span class="hljs-comment"># 创建目录</span>
Path(<span class="hljs-string">"new_dir"</span>).mkdir(exist_ok=<span class="hljs-literal">True</span>, parents=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># parents=True支持多级目录</span>
</code></pre>
<h3 data-id="heading-37">2. datetime模块计算指定日期是星期几</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

date_str = <span class="hljs-string">"2024-05-20"</span>
date_obj = datetime.strptime(date_str, <span class="hljs-string">"%Y-%m-%d"</span>)
<span class="hljs-comment"># weekday()：0=周一，6=周日；isoweekday()：1=周一，7=周日</span>
weekday = date_obj.weekday()
weekday_map = {<span class="hljs-number">0</span>: <span class="hljs-string">"周一"</span>, <span class="hljs-number">1</span>: <span class="hljs-string">"周二"</span>, <span class="hljs-number">2</span>: <span class="hljs-string">"周三"</span>, <span class="hljs-number">3</span>: <span class="hljs-string">"周四"</span>, <span class="hljs-number">4</span>: <span class="hljs-string">"周五"</span>, <span class="hljs-number">5</span>: <span class="hljs-string">"周六"</span>, <span class="hljs-number">6</span>: <span class="hljs-string">"周日"</span>}
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{date_str}</span> 是 <span class="hljs-subst">{weekday_map[weekday]}</span>"</span>)
</code></pre>
<h3 data-id="heading-38">3. 批量处理JSON文件（结合os.walk）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># 遍历目录下所有JSON文件，汇总数据</span>
all_data = []
<span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(<span class="hljs-string">"data_dir"</span>):
    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
        <span class="hljs-keyword">if</span> file.endswith(<span class="hljs-string">".json"</span>):
            file_path = os.path.join(root, file)
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
                data = json.load(f)
                all_data.extend(data)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"共汇总 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_data)}</span> 条数据"</span>)
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[R-HORIZON：探索长程推理边界，复旦 NLP&美团 LongCat 联合提出 LRMs 能力评测新框架]]></title>    <link>https://juejin.cn/post/7578469297629233194</link>    <guid>https://juejin.cn/post/7578469297629233194</guid>    <pubDate>2025-12-01T07:43:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578469297629233194" data-draft-id="7578495241638101033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="R-HORIZON：探索长程推理边界，复旦 NLP&amp;美团 LongCat 联合提出 LRMs 能力评测新框架"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-01T07:43:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="美团技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/3509296845313741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            R-HORIZON：探索长程推理边界，复旦 NLP&amp;美团 LongCat 联合提出 LRMs 能力评测新框架
            <!----> <!----></h1> <div class="container team-follow" data-v-d326b38e="" data-v-61fb5e44=""><div class="left" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47ccb42d726640a7889ba1e64ae203e6~tplv-k3u1fbpfcp-watermark.image" class="icon" data-v-d326b38e=""/></a> <div class="content" data-v-d326b38e=""><div style="display: flex" data-v-d326b38e=""><a href="/team/6930512966122995712/posts" data-v-d326b38e=""><p class="title-line" data-v-d326b38e=""><span title="美团技术团队" class="title" data-v-d326b38e="">美团技术团队</span> <img src="//lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/255e400027b783cbad76dc41527e7695.svg" alt="team icon" class="team-icon" data-v-d326b38e=""/></p></a></div> <div class="meta-box team" data-v-d326b38e="" data-v-61fb5e44=""><time datetime="2025-12-01T07:43:29.000Z" title="Mon Dec 01 2025 07:43:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-d326b38e="" data-v-61fb5e44="">
                2025-12-01
              </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-d326b38e="" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-d326b38e="" data-v-61fb5e44=""/></svg> <span class="views-count" style="display:none;" data-v-d326b38e="" data-v-61fb5e44="">
                0
              </span> <span class="read-time" data-v-d326b38e="" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-d326b38e="" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-d326b38e="" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-d326b38e="" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-d326b38e="" data-v-61fb5e44=""/></svg>
                阅读8分钟
              </span> <!----> <!----></div></div></div> <button class="jj-follow-button follow-btn" style="display:none;" data-v-b60b2868="" data-v-d326b38e=""><span data-v-b60b2868="" data-v-d326b38e=""><i class="byte-icon byte-icon--plus" data-v-d326b38e=""><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 48 48"><path fill="none" d="M0 0h48v48H0z"/><path d="M24.7 4c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8V22h16.7c.4 0 .6 0 .8.1.2.1.3.2.4.4.1.2.1.3.1.8v1.4c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1H26v16.7c0 .4 0 .6-.1.8-.1.2-.2.3-.4.4-.2.1-.3.1-.8.1h-1.4c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8V26H5.3c-.4 0-.6 0-.8-.1-.2-.1-.3-.2-.4-.4-.1-.2-.1-.3-.1-.8v-1.4c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1H22V5.3c0-.4 0-.6.1-.8.1-.2.2-.3.4-.4.2-.1.3-.1.8-.1h1.4z"/></svg></i>
        关注
      </span></button></div> <div class="team-user block-hidden" data-v-61fb5e44=""><div class="avatar jj-avatar avatar" data-v-03256cc6="" data-v-61fb5e44=""><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="avatar" class="lazy avatar-img" data-v-5244ef91="" data-v-03256cc6=""/> </div> <!----> <span class="position ellipsis" data-v-61fb5e44="">
              美团小编 @美团
            </span></div> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、推理模型 ⾯ 临的新挑战</h2>
<p>随着 OpenAI o1 、 DeepSeek-R1 等大型推理模型（LRMs）的问世， AI 推理能力迎来了「测试时扩展」的新阶段。这些模型通过长链思维（Long Chain-of-Thought, CoT）在数学推理、代码生成、智能体任务等领域展现出强大能力。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63719062fdbe4655985caad270e8067b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=38bkp3vn76qX510EURM%2B5BOScYE%3D" alt="" loading="lazy"/></p>
<p>然而，现有评测体系存在一个关键盲区：主流基准测试（如 MATH500 、AIME）主要关注独立的单一问题，每个问题相互隔离，模型只需「—问—答」即可。</p>
<p>但现实应用场景往往大相径庭：</p>
<ul>
<li>软件开发中需要连续处理多个关联代码模块</li>
<li>数学证明需要基于前序推导逐步构建后续结论</li>
<li>智能助手往往需要在多轮交互逐步完成复杂任务</li>
</ul>
<p>这些真实场景要求模型具备跨任务的长链推理能力——不仅要解决单个子问题，更要在多个关联任务间保持推理—致性、合理分配计算资源、实现跨步骤的反思与纠错。</p>
<p><strong>核心问题：当前大型推理模型的长链推理能力边界到底在哪里？</strong></p>
<p>由于现有评测无法回答这—问题，传统训练数据也难以培养这种能力（如图所示，模型在长程推理场景下表现明显退化）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9bceb3a37c24c4d9c5c58ce933ba6c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=fR9cfWxrX4uF4mU%2B9aZOYM15jlc%3D" alt="图 1：R1  系列模型在长程推理场景下的理论准确率与实际准确率对比" loading="lazy"/></p>
<p>复旦大学与美团 LongCat 联合推出 R-HORIZON——首个系统性评估与增强 LRMs 长链推理能力的评测框架与训练方法。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/877b2e2d51b64828b988bbbe764562d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=GMoY4V8E0EWMSIDdlTLbmLwCMuM%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>论文标题</strong>： R-HORIZON: How Far Can Your Large Reasoning Model Really Go in Breadth and Depth?</li>
<li><strong>论文地址</strong>： <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2510.08189" target="_blank" title="https://arxiv.org/abs/2510.08189" ref="nofollow noopener noreferrer">arxiv.org/abs/2510.08…</a></li>
<li><strong>项目主页</strong>： <a href="https://link.juejin.cn?target=https%3A%2F%2Freasoning-horizon.github.io" target="_blank" title="https://reasoning-horizon.github.io" ref="nofollow noopener noreferrer">reasoning-horizon.github.io</a></li>
<li><strong>代码地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmeituan-longcat%2FR-HORIZON" target="_blank" title="https://github.com/meituan-longcat/R-HORIZON" ref="nofollow noopener noreferrer">github.com/meituan-lon…</a> </li>
<li><strong>数据集</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fcollections%2Fmeituan-longcat%2Fr-horizon" target="_blank" title="https://huggingface.co/collections/meituan-longcat/r-horizon" ref="nofollow noopener noreferrer">huggingface.co/collections…</a></li>
</ul>
<h2 data-id="heading-1">二、方法论： Query Composition 范式</h2>
<p><strong>核心创新</strong></p>
<p>R-HORIZON 提出了问题组合（Query Composition）方法，通过构建问题间的依赖关系，将孤立任务转化为复杂的多步骤推理链。</p>
<p>以数学任务为例，该方法包含三个步骤：</p>
<p>1. <strong>信息提取</strong>：从独立问题中提取核心数值、变量等关键信息
2. <strong>依赖构建</strong>：将前序问题的答案嵌入到后续问题的条件中
3. <strong>链式推理</strong>：模型必须顺序解决所有子问题才能获得最终答案</p>
<p><strong>方法优势</strong></p>
<ul>
<li><strong>灵活扩展</strong>：可自由控制推理链长度（n = 2, 4, 8...）</li>
<li><strong>精确可控</strong>：可灵活设定问题间的依赖强度</li>
<li><strong>高效低成本</strong>：基于现有数据集构建，无需额外人工标注</li>
</ul>
<p>基于此方法，我们构建了 R-HORIZON Benchmark 用于系统性评估 LRMs 的多步推理能力，同时生成了长链推理训练数据，通过强化学习（RLVR）提升模型性能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6e494f043834cdfa966f2b5383b9603~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=g3EPwOaiGANFH06v1v891YToaHM%3D" alt="图 2：R-HORIZON 方法流程——从单 — 问题到复杂推理链的转化及应用场景" loading="lazy"/></p>
<h2 data-id="heading-2">三、评测基准： R-HORIZON Benchmark</h2>
<h3 data-id="heading-3">数据集构成</h3>
<p>基于 Query Composition 方法，我们构建了涵盖 6 个代表性数据集的 R-HORIZON Benchmark：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1e89021113e458b8ed8ecca155353c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=rZzLBKd%2Fk%2F608OPoj46BEu%2FAnhs%3D" alt="" loading="lazy"/></p>
<p><strong>评测发现：性能断崖现象</strong></p>
<p>我们评测了 20+ 个主流 LRMs（包括 o4-mini 、Claude-Sonnet-4 、 DeepSeek-R1 等顶级商业模型及开源模型），揭示了—个重要现象。</p>
<p>顶级推理模型在长链推理场景下均出现显著性能下降！</p>
<p>主要发现：</p>
<ul>
<li><strong>普遍性能退化</strong>：所有模型随问题数量增加均出现明显性能下降。DeepSeek-R1 在 AIME25 单问题场景准确率达 87.3%，但在 5 个组合问题场景下骤降至 24.6%。</li>
<li><strong>规模效应</strong>：更大规模的模型对多步推理挑战表现出更强的鲁棒性。</li>
<li><strong>任务差异</strong>：代码生成任务相比数学任务表现出更陡峭的性能衰退；多数推理模型在网页搜索场景中丧失工具调用能力。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/663d63ce04c84aacb0167bb8846bbc93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=bw5%2BsEIgbQyx6SBxHZr0nyi1ElM%3D" alt="图 3：R-HORIZON Benchmark  评测结果—— 所有模型均出现显著性能衰退" loading="lazy"/></p>
<h2 data-id="heading-4">四、机制分析：推理模型的三大瓶颈</h2>
<p>为深入理解性能断崖的成因，我们进行了系统的机制分析，识别出当前 LRMs 的三个关键瓶颈：</p>
<p><strong>瓶颈 1：有效推理长度受限</strong></p>
<p>随着相互依赖问题数量增加，LRMs 难以维持原有性能水平。实际准确率与理论准确率之间的差距显著扩大。</p>
<p>深入分析显示：</p>
<ul>
<li>模型错误集中在特定上下文范围内</li>
<li>7B 模型的主要错误范围在 (4-6K tokens)</li>
<li>32B 模型将范围扩展到 (8-10K tokens)</li>
<li>更大模型具有更长的有效推理边界</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b444ed36d6734011a0ac94d1c1e9af3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=SI9p%2BaiJgx4KvlC72B%2BG7KsDa2w%3D" alt="图 4：R1-Qwen-7B 和 R1-Qwen-32B  的准确率及错误位置分析" loading="lazy"/></p>
<p><strong>瓶颈 2： 反思机制高度局部化</strong></p>
<p>对模型「反思」行为的分析发现发现：</p>
<ul>
<li>模型反思频率随问题数量增加而上升并趋于收敛。</li>
<li><strong>超过半数复杂任务</strong> 完全缺乏 <strong>长程反思</strong> （跨越当前问题的反思）。</li>
<li>当前 LRMs 的反思机制 <strong>高度局部化</strong>，无法支撑长链场景需求。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91e7390ada574a568adb1c4e53dbc2d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=BXrn%2FuJJQTlFvu%2BxZqjxrWnUd8E%3D" alt="图 5：MATH500  数据集上的反思行为分析" loading="lazy"/></p>
<p><strong>瓶颈 3：思考预算分配失衡</strong></p>
<p>最令人意外的发现：<strong>包括 DeepSeek-R1 在内的主流 LRMs 无法有效分配思考预算</strong>！</p>
<ul>
<li>模型倾向于过度分配 tokens 给早期推理阶段</li>
<li>未能合理分配资源给后续关键问题</li>
<li>这种失衡严重影响整体推理链的完成质量</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cdefec8bdc14515882a1a71b004e4e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=k%2BQpI757c2TpebXlh9xBIbGfA9I%3D" alt="图 6：不同组合问题数量下各模型的思考预算分配" loading="lazy"/></p>
<h2 data-id="heading-5">五、 训练方案：突破能力边界</h2>
<p>发现瓶颈后，我们进—步探索：能否通过长链数据的强化学习训练突破这些限制？</p>
<p><strong>训练策略</strong></p>
<p>我们基于 R-HORIZON 构建的长链推理数据，采用 GRPO 算法进行训练：</p>
<ul>
<li><strong>算法</strong>：主流 RLVR 算法 GRPO</li>
<li><strong>数据</strong>： R-HORIZON 组合数据（n = 2, n = 4）</li>
<li><strong>实验</strong>：不同奖励函数的对比实验</li>
</ul>
<p><strong>训练效果：双重性能提升</strong></p>
<p>实验结果显示：R-HORIZON 训练不仅显著提升长链任务表现，单问题性能也大幅增强！</p>
<p><strong>核心数据</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b5a5126fe384c5f8863c33d61a749f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=9RhY2COuQqj4e9xeznfHdkzgr%2Fg%3D" alt="" loading="lazy"/></p>
<p>注：加粗数字表示该列最佳成绩</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5e3835916354595850b69a928d48127~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=%2F8Dz%2BVoaVFN9penE2SUOJgdEPZI%3D" alt="图七：不同训练配置下的性能对比" loading="lazy"/></p>
<p><strong>关键发现</strong></p>
<ol>
<li><strong>双重提升</strong>：使用 n = 2 组合问题训练，多步推理性能大幅提升（AIME24 n = 2 +17.4 分），单问题性能也显著增强（AIME24 单题 +7.5 分）。</li>
<li><strong>可扩展性</strong>：增加组合复杂度（n = 4）增强了模型处理更多推理步骤问题的能力，在 MATH500 (n = 8) 上达到 50.6%。</li>
</ol>
<p><strong>训练带来的质变</strong></p>
<p>R-HORIZON 训练带来了推理机制的深层改变：</p>
<ul>
<li><strong>更高效的推理长度</strong>：显著改善组合任务性能，更好地泛化到更长推理链，同时缓解「overthinking」现象</li>
<li><strong>更合理的预算分配</strong>：学会在多步问题中进行更合理的 token 预算分配</li>
<li><strong>更长程的反思能力</strong>：促进了长程反思频率增加，直接改善长链推理性能</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ba17437cf7547d2a832244b45406af7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=x1jyQL%2BXnjeD4dA2D9dIgXuCw2w%3D" alt="图 8：使用标准数据集和组合数据集进行强化学习的效果分析" loading="lazy"/></p>
<h2 data-id="heading-6">六、结论与展望</h2>
<p>R-HORIZON 标志着大型推理模型研究的范式转变——从「能解决什么问题」到「能走多远」。</p>
<p><strong>技术贡献</strong></p>
<ul>
<li><strong>首个长链推理评测基准</strong>：系统性揭示 LRMs 的能力边界及三大瓶颈。</li>
<li><strong>可扩展训练范式</strong>：提供低成本、高效率的能力提升路径。</li>
<li><strong>深度机制分析</strong>：为未来推理模型改进指明方向。</li>
</ul>
<p><strong>阅读更多</strong></p>
<p>| 关注「美团技术团队」微信公众号，在公众号菜单栏对话框回复【2024年货】、【2023年货】、【2022年货】、【2021年货】、【2020年货】、【2019年货】、【2018年货】、【2017年货】等关键词，可查看美团技术团队历年技术文章合集。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/699fdf878ae24c88a082f0f00b79ee13~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg576O5Zui5oqA5pyv5Zui6Zif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765179809&amp;x-signature=AAb8beJi54bVLQkHGLn0sWluOWo%3D" alt="" loading="lazy"/></p>
<p>| 本文系美团技术团队出品，著作权归属美团。欢迎出于分享和交流等非商业目的转载或使用本文内容，敬请注明“内容转载自美团技术团队”。本文未经许可，不得进行商业性转载或者使用。任何商用行为，请发送邮件至 <a href="https://link.juejin.cn?target=mailto%3Atech%40meituan.com" target="_blank" title="mailto:tech@meituan.com" ref="nofollow noopener noreferrer">tech@meituan.com</a> 申请授权。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【包管理器】pnpm、npm、cnpm、yarn 深度对比]]></title>    <link>https://juejin.cn/post/7578582010416037894</link>    <guid>https://juejin.cn/post/7578582010416037894</guid>    <pubDate>2025-12-01T07:43:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578582010416037894" data-draft-id="7578391787981815849" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【包管理器】pnpm、npm、cnpm、yarn 深度对比"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T07:43:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="珑墨"/> <meta itemprop="url" content="https://juejin.cn/user/3069492194710797"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【包管理器】pnpm、npm、cnpm、yarn 深度对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3069492194710797/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    珑墨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:43:21.000Z" title="Mon Dec 01 2025 07:43:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="github">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>JavaScript 生态以 npm Registry 为核心，围绕其衍生出多种包管理器。随着工程规模膨胀、CI/CD 普及以及国内网络环境的限制，团队对依赖解析、磁盘占用、锁文件一致性与镜像策略的要求日益严苛。本文聚焦 pnpm、npm、cnpm 与 yarn，结合工程实践对比其关键差异。</p>
<h3 data-id="heading-0">TL;DR 速览</h3>
<ul>
<li><strong>追求高速安装、极致磁盘效率与严格依赖隔离</strong>：首选 pnpm。</li>
<li><strong>强调生态兼容与“开箱即用”体验</strong>：延续 npm，类库作者与对外分发场景尤佳。</li>
<li><strong>希望尝试 Zero-Install、Constraints、Plug’n’Play 等高级特性</strong>：使用 yarn Berry，最好配合 Corepack 固定版本。</li>
<li><strong>主要痛点是国内下载慢或需自建镜像</strong>：选择 cnpm，或任何工具结合 npmmirror；cnpm 还能手动 sync 包。</li>
<li><strong>团队存在多种包管理器共存</strong>：引入 Corepack/Volta/NVM 锁定 CLI 版本，避免环境漂移。</li>
</ul>
<h3 data-id="heading-1">工具概览</h3>
<ul>
<li><strong>npm</strong>：Node.js 自带，生态覆盖面最广。v7+ 支持 Workspaces、自动安装 peerDependencies，适合追求稳定、兼容性的团队。</li>
<li><strong>pnpm</strong>：依靠内容寻址 Store 与硬链接去重实现高速安装与极低磁盘占用，原生支持 monorepo 与过滤器，强调严格依赖隔离。</li>
<li><strong>cnpm</strong>：阿里维护的 npm CLI 分支，默认指向 <code>registry.npmmirror.com</code>，用于解决国内网络瓶颈；命令几乎与 npm 完全一致。</li>
<li><strong>yarn</strong>：Classic 版本主打安装速度与锁文件稳态；Berry(2+) 引入 Plug’n’Play、Constraints、Zero-Install 等高级特性，但配置与心智成本更高。</li>
</ul>
<h3 data-id="heading-2">关键对比维度</h3>




































































<table><thead><tr><th>维度</th><th>npm</th><th>pnpm</th><th>yarn</th><th>cnpm</th></tr></thead><tbody><tr><td>安装/性能</td><td>v9+ 并行，整体偏稳健</td><td>内容寻址 store，高速且二次安装更快</td><td>Classic 并行 + Berry PnP，冷启动快</td><td>与 npm 类似，网络镜像更优</td></tr><tr><td>磁盘占用</td><td>每项目完整 node_modules</td><td>共享 store，硬链接去重</td><td>Berry 无 node_modules，Classic 与 npm 类似</td><td>与 npm 相同</td></tr><tr><td>依赖隔离</td><td>hoist 规则易出幽灵依赖</td><td>默认隔离，未声明依赖即报错</td><td>PnP 阻断幽灵依赖，Classic 需注意</td><td>与 npm 一致</td></tr><tr><td>锁文件</td><td><code>package-lock.json</code>，兼容佳</td><td><code>pnpm-lock.yaml</code>，支持离线 fetch</td><td><code>yarn.lock</code> + <code>.pnp.cjs</code>（Berry）</td><td><code>package-lock.json</code></td></tr><tr><td>中国区可用性</td><td>需手动配置镜像</td><td>可自定义 registry，常配 npmmirror</td><td><code>.yarnrc.yml</code> 指定 registry</td><td>默认 npmmirror，<code>cnpm sync</code></td></tr><tr><td>Monorepo 能力</td><td>基础 Workspaces</td><td>Workspaces + filter/并行发布</td><td>Berry Workspaces + Constraints</td><td>无扩展，依赖额外工具</td></tr><tr><td>CLI/生态</td><td><code>npm</code>, <code>npx</code>, <code>npm audit</code> 等工具完备</td><td>支持过滤、<code>pnpm env</code>、Corepack 管理</td><td>CLI 插件化，可扩展 doctor 等</td><td>命令与 npm 兼容，新增 sync</td></tr><tr><td>安全/审计</td><td><code>npm audit fix</code> 官方数据库</td><td>复用 npm 数据，可在 <code>pnpmfile</code> 打补丁</td><td><code>yarn audit</code>/<code>yarn npm audit</code> + Constraints</td><td>与 npm 数据同步，镜像或有延迟</td></tr></tbody></table>
<blockquote>
<p>下文将围绕表格中的核心维度展开，并补充关键实践注意事项。</p>
</blockquote>
<h4 data-id="heading-3">安装与性能</h4>
<ul>
<li><strong>npm</strong>：v9+ 已具备并行安装能力，但缺乏共享缓存，冷启动速度与磁盘占用表现一般。</li>
<li><strong>pnpm</strong>：依托内容寻址 store 和硬/软链接，同机项目共享依赖，首装快、二次装更快。</li>
<li><strong>yarn</strong>：Classic 通过并行安装与离线缓存兼顾速度与稳态；Berry 借助 PnP 跳过 node_modules，冷启动极快。</li>
<li><strong>cnpm</strong>：在安装链路上等同 npm，但得益于默认镜像在国内网络表现更友好。</li>
</ul>
<h4 data-id="heading-4">依赖解析与一致性</h4>
<ul>
<li><strong>npm</strong>：传统的层级 node_modules，hoist 规则偶尔导致幽灵依赖；lockfile v3 提升了一致性但仍需人工自查。</li>
<li><strong>pnpm</strong>：默认严格隔离，未声明的依赖无法被"间接"解析，问题能在安装或构建期暴露。</li>
<li><strong>yarn</strong>：Classic 与 npm 类似；Berry 的 Plug'n'Play 通过虚拟文件系统彻底阻断幽灵依赖。</li>
<li><strong>cnpm</strong>：继承 npm 的解析策略，无额外一致性增强。</li>
</ul>
<h4 data-id="heading-5">幽灵依赖详解</h4>
<p><strong>什么是幽灵依赖？</strong></p>
<p>幽灵依赖（Phantom Dependency）是指项目代码中使用了某个包，但该包并未在 <code>package.json</code> 的 <code>dependencies</code> 或 <code>devDependencies</code> 中显式声明，而是作为其他依赖的间接依赖（传递依赖）被安装到 <code>node_modules</code> 中。</p>
<p><strong>产生原因</strong></p>
<p>在 npm/yarn Classic 的 hoist 机制下，依赖会被提升到 <code>node_modules</code> 的顶层。当项目 A 依赖包 B，而包 B 又依赖包 C 时，包 C 可能会被提升到项目根目录的 <code>node_modules</code> 中，导致项目 A 可以直接 <code>require('C')</code> 或 <code>import C</code>，即使 <code>package.json</code> 中并未声明包 C。</p>
<p><strong>示例场景</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json</span>
{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"express"</span>: <span class="hljs-string">"^4.18.0"</span>  <span class="hljs-comment">// express 内部依赖了 cookie-parser</span>
  }
}

<span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">const</span> cookieParser = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-parser'</span>);  <span class="hljs-comment">// ❌ 幽灵依赖！</span>
<span class="hljs-comment">// 虽然能运行，但 cookie-parser 并未在 package.json 中声明</span>
</code></pre>
<p><strong>潜在问题</strong></p>
<ol>
<li><strong>版本不确定性</strong>：当 express 升级并移除对 <code>cookie-parser</code> 的依赖时，代码会突然报错。</li>
<li><strong>依赖关系不透明</strong>：团队成员无法从 <code>package.json</code> 看出项目实际使用了哪些包。</li>
<li><strong>CI/CD 风险</strong>：不同环境下的 hoist 结果可能不同，导致"本地能跑，CI 失败"。</li>
<li><strong>安全审计盲区</strong>：<code>npm audit</code> 可能无法检测到未声明的依赖中的漏洞。</li>
</ol>
<p><strong>不同工具的处理方式</strong></p>
<ul>
<li>
<p><strong>npm/yarn Classic/cnpm</strong>：允许幽灵依赖存在，依赖提升机制使得未声明的包也能被解析。这是历史遗留问题，需要开发者自觉避免。</p>
</li>
<li>
<p><strong>pnpm</strong>：默认严格隔离模式，每个包只能访问其 <code>package.json</code> 中声明的依赖。如果代码尝试使用未声明的依赖，会在运行时抛出 <code>MODULE_NOT_FOUND</code> 错误，强制开发者显式声明所有依赖。</p>
</li>
<li>
<p><strong>yarn Berry (PnP)</strong>：通过 Plug'n'Play 机制，完全阻断对未声明依赖的访问。<code>.pnp.cjs</code> 中只包含已声明的依赖映射，任何未声明的依赖都会在解析阶段被拦截。</p>
</li>
</ul>
<p><strong>最佳实践</strong></p>
<ol>
<li><strong>显式声明所有依赖</strong>：即使某个包是间接依赖，如果项目代码直接使用它，也应该在 <code>package.json</code> 中声明。</li>
<li><strong>使用 lint 工具</strong>：配置 <code>eslint-plugin-import</code> 或 <code>depcheck</code> 检测未声明的依赖。</li>
<li><strong>迁移到严格模式</strong>：考虑使用 pnpm 或 yarn Berry，让工具强制暴露依赖问题。</li>
<li><strong>定期审查</strong>：使用 <code>npm ls &lt;package&gt;</code> 或 <code>pnpm why &lt;package&gt;</code> 检查依赖来源，确保所有直接使用的包都已声明。</li>
</ol>
<h4 data-id="heading-6">底层原理与依赖目录结构</h4>
<p>不同工具在落盘结构与模块解析链路上差异明显，理解目录组织能帮助排错与迁移。</p>
<h5 data-id="heading-7">npm（也适用于 cnpm）</h5>
<p><strong>逻辑</strong>：自根目录向上查找 <code>node_modules</code>，通过 hoist 将依赖尽量提升至顶层，未能提升的依赖保留在子目录中。Node.js runtime 的 <code>MODULE_NOT_FOUND</code> 解析就是按 <code>./node_modules → ../node_modules → ...</code> 回溯。</p>
<p><strong>目录示例</strong>：</p>
<pre><code class="hljs language-text" lang="text">node_modules/
├─ react/
├─ react-dom/
├─ webpack/
└─ project-a/
   └─ node_modules/
      └─ lodash/   ← 未被 hoist 的重复依赖
</code></pre>
<p><strong>代价</strong>：空间占用大、幽灵依赖易出现，缓存只存 tarball（<code>~/.npm/_cacache</code>），不会减少 <code>node_modules</code> 占用。</p>
<h5 data-id="heading-8">pnpm</h5>
<p><strong>逻辑</strong>：先把所有包解压到全局内容寻址仓库 <code>~/.pnpm-store/v3/files/&lt;hash&gt;</code>，相同文件引用一次；项目 <code>node_modules</code> 里只放指向 <code>.pnpm/&lt;pkg&gt;@&lt;version&gt;/node_modules</code> 的符号/硬链接，并通过 <code>node_modules/.modules.yaml</code> 记录映射。运行时依赖解析顺序为：模块目录 → 该模块自己的 <code>node_modules</code> → 上层 <code>.pnpm</code> 入口，未声明的包无法被解析。</p>
<p><strong>目录示例</strong>：</p>
<pre><code class="hljs language-text" lang="text">node_modules/
├─ .pnpm/
│  ├─ react@18.2.0/
│  │  └─ node_modules/react/  ← 实际包内容
│  └─ project-a@1.0.0/
│     └─ node_modules/project-a/
├─ react → .pnpm/react@18.2.0/node_modules/react
└─ project-a → .pnpm/project-a@1.0.0/node_modules/project-a
</code></pre>
<p><strong>优势</strong>：多项目共享 store、严格依赖隔离；若启用 <code>pnpm fetch</code>，甚至可在无网络时把 store 拉取到 CI 机器。</p>
<h5 data-id="heading-9">yarn Classic</h5>
<p><strong>逻辑</strong>：解析锁文件后，按 npm 同样的 hoist 策略在本地生成 <code>node_modules</code>。差别在于 <code>yarn.lock</code> 确保依赖树稳定，同时可启用 <code>yarn install --check-files</code> 验证一致性。</p>
<p><strong>目录</strong>：与 npm 几乎无异，若开启 Plug'n'Play 插件（Classic 也支持），则会生成 <code>.pnp.js</code> 并跳过 <code>node_modules</code>。</p>
<h5 data-id="heading-10">yarn Berry (2+)</h5>
<p><strong>逻辑</strong>：默认 <code>nodeLinker: pnp</code>。安装时将包归档到 <code>.yarn/cache/&lt;pkg&gt;-&lt;hash&gt;.zip</code>，然后在 <code>.pnp.cjs</code> 中记录"依赖 → 包路径"映射。运行过程中，Yarn 的 PnP runtime hook 截获 <code>require</code>/<code>import</code> 调用，定位到缓存 zip，并以 zip 内虚拟文件形式提供模块。只有在设置 <code>nodeLinker: node-modules</code> 时才会生成真实 <code>node_modules</code>。</p>
<p><strong>目录示例（PnP 默认模式）</strong>：</p>
<pre><code class="hljs language-text" lang="text">.yarn/
├─ cache/
│  ├─ react-npm-18.2.0-8ad33.zip
│  └─ webpack-npm-5.95.0-bbd1e.zip
├─ releases/
└─ sdk/
.pnp.cjs            ← 依赖解析表
</code></pre>
<p><strong>特点</strong>：Zero-Install 可直接把 <code>.yarn/cache</code> 提交到仓库，无需安装步骤；但某些脚本若硬编码 <code>node_modules</code> 路径，则需切换 nodeLinker 或使用 <code>yarn unplug</code>。</p>
<h4 data-id="heading-11">模块解析流程</h4>
<h5 data-id="heading-12">解析流程示意</h5>
<pre><code class="hljs language-text" lang="text">[npm/cnpm/yarn Classic]
require('lodash')
    ↓ Node.js resolver
./node_modules/lodash →
../node_modules/lodash →
系统 PATH

[pnpm]
require('lodash')
    ↓ Node.js resolver
./node_modules/.pnpm/lodash@x/node_modules/lodash  (符号链接目标)
    ↓ 若未找到则报错（不会回溯到未声明依赖）

[yarn Berry PnP]
require('lodash')
    ↓ PnP hook (Module._resolveFilename 被 patch)
查 .pnp.cjs → `.yarn/cache/lodash-npm-4.17.21.zip`
    ↓ 从 zip 提供虚拟 fs 路径
</code></pre>
<h5 data-id="heading-13">运行时 Hook 细节</h5>
<ul>
<li>
<p><strong>npm / cnpm / yarn Classic / pnpm</strong>：完全依赖 Node.js 内置 <code>Module._resolveFilename</code> 与 <code>fs</code> 模块逻辑，pnpm 通过符号链接保证目录结构仍符合 Node 的查找路径，因此无需额外 runtime patch。</p>
</li>
<li>
<p><strong>yarn Berry PnP</strong>：</p>
<ol>
<li><code>node</code> 启动时加载 <code>.pnp.cjs</code>，该文件会使用 <code>require('module').Module._resolveFilename</code> 和 <code>_findPath</code> 的 monkey patch 拦截模块解析。</li>
<li>当应用执行 <code>require('pkg')</code> 时，PnP hook 根据调用方位置解析出该包对应的 locator（类似 <code>pkg@npm:1.0.0</code>），再在 <code>.pnp.data.json</code>（隐藏在 <code>.pnp.cjs</code> 内部）中寻找缓存 zip 的绝对路径。</li>
<li>hook 会注入自定义的 <code>fs.readFileSync</code>/<code>fs.readdirSync</code> 逻辑，使得 zip 内文件可透明访问；若调用方请求真实路径，PnP 会返回 <code>zip:/path/to/cache#package/index.js</code>。</li>
<li>对不兼容 PnP 的工具，可通过 <code>yarn unplug pkg</code> 将特定包解压到 <code>.yarn/unplugged</code>，或把 <code>nodeLinker</code> 设为 <code>node-modules</code> 退回传统模式。</li>
</ol>
</li>
<li>
<p><strong>Corepack 对运行时的影响</strong>：Corepack 本身不改变解析逻辑，但会在执行 <code>pnpm</code>/<code>yarn</code>/<code>npm</code> 时注入合适的 CLI 版本，确保 <code>.pnp.loader.mjs</code>、<code>.pnpm-store</code> 等 runtime 结构与 lockfile 匹配。</p>
</li>
</ul>
<h4 data-id="heading-14">安装流程</h4>
<h5 data-id="heading-15">安装流程图示</h5>
<pre><code class="hljs language-text" lang="text">npm / yarn Classic / cnpm
┌──────────┐    ┌────────────┐    ┌─────────────┐
│ package  │ -&gt; │ Arborist   │ -&gt; │ node_modules│
│ json+lock│    │ 构建依赖树 │    │ hoist 写入  │
└──────────┘    └────────────┘    └─────────────┘

pnpm
┌──────────┐    ┌─────────────┐    ┌──────────────────┐    ┌────────────────┐
│ package  │ -&gt; │ Resolver    │ -&gt; │ ~/.pnpm-store     │ -&gt; │ 项目 node_modules│
│ json+lock│    │ &amp; linker    │    │ (内容寻址)        │    │ 写符号/硬链接   │
└──────────┘    └─────────────┘    └──────────────────┘    └────────────────┘

yarn Berry (PnP)
┌──────────┐    ┌────────────┐    ┌────────────────────┐
│ package  │ -&gt; │ Plug'n'Play│ -&gt; │ .yarn/cache + .pnp │
│ json+lock│    │ 解析器      │    │ 生成映射/zip        │
└──────────┘    └────────────┘    └────────────────────┘
</code></pre>
<h5 data-id="heading-16">实现细节</h5>
<p><strong>npm / yarn Classic 安装链路</strong>：</p>
<ol>
<li>CLI 调用 Arborist（npm 内置解析器）读取 <code>package.json</code>、lockfile，产出依赖树（ideal tree）。</li>
<li>Arborist 根据 semver 冲突策略决定 hoist 位置，并生成实际安装计划（actual tree）。</li>
<li>安装阶段将包解压到 <code>node_modules/&lt;name&gt;</code>，必要时写入嵌套 <code>node_modules</code>。当运行 <code>npm dedupe</code> 时，会再次构建树并尝试把可兼容版本提升到上层。</li>
<li><code>npm ci</code> 会跳过依赖解析，直接按照 lockfile 指定的版本和树结构落盘，以减少差异。</li>
</ol>
<p><strong>pnpm store 与 <code>.modules.yaml</code></strong>：</p>
<ul>
<li>store 路径：<code>~/.pnpm-store/v3/files/ab/cdef...</code>，文件名为内容散列（SHA512 → base32），任一项目安装同一 tarball 时直接引用。</li>
<li>项目级 <code>node_modules/.modules.yaml</code> 示例：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">hoistPattern:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'*'</span>
<span class="hljs-attr">included:</span>
  <span class="hljs-attr">dependencies:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">hoistedDependencies:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">packages:</span>
  <span class="hljs-string">/react@18.2.0:</span>
    <span class="hljs-attr">resolution:</span> {<span class="hljs-attr">integrity:</span> <span class="hljs-string">sha512-...</span>}
    <span class="hljs-attr">path:</span> <span class="hljs-string">.pnpm/react@18.2.0/node_modules/react</span>
</code></pre>
<ul>
<li>安装流程：
<ol>
<li>下载 tarball → 解压到 store。</li>
<li>在 <code>.pnpm/&lt;pkg&gt;@&lt;version&gt;/node_modules</code> 生成真实目录。</li>
<li>在根 <code>node_modules</code> 写入指向 <code>.pnpm/...</code> 的符号链接；<code>.modules.yaml</code> 记录每个链接的来源与 hoist 情况，供后续 install/dedupe 对比。</li>
</ol>
</li>
<li><code>pnpm install --virtual-store-dir</code> 可自定义 <code>.pnpm</code> 的存放位置，以满足只读文件系统或沙箱要求。</li>
</ul>
<p><strong>yarn Berry PnP loader</strong>：</p>
<ul>
<li><code>.pnp.cjs</code> 同时导出 CommonJS 钩子及 <code>.pnp.loader.mjs</code>（供 <code>node --loader</code> 使用）来支持 ESM。</li>
<li>当运行 <code>node -r ./.pnp.cjs app.js</code>（Yarn 自动插入该参数）时，<code>Module</code> 原型被 patch：
<ul>
<li><code>_resolveReference</code> 通过调用 <code>PnpRuntime.resolveRequest</code>，后者查询 <code>.pnp.data.json</code> 中的 dependency map。</li>
<li><code>_load</code> 在定位到 <code>zip</code> 文件后，调用 <code>ZipFS</code>（来自 <code>@yarnpkg/fslib</code>）将压缩包映射为 in-memory FS；若 <code>PRESERVE_SYMLINKS</code> 设置为 true，PnP 也会模拟符号链接。</li>
</ul>
</li>
<li>对 ESM，<code>yarn</code> 会令 Node 通过 <code>--experimental-loader ./.pnp.loader.mjs</code> 引入同样的解析逻辑，从而支持 <code>import</code> 语法。</li>
<li><code>yarn unplug pkg</code> 实际是将 <code>.yarn/cache/pkg-*.zip</code> 解压到 <code>.yarn/unplugged/pkg-npm-&lt;version&gt;/node_modules/pkg</code>，再在 <code>.pnp.cjs</code> 中把该 locator 指向解压目录，以便原生工具访问真实路径。</li>
</ul>
<h4 data-id="heading-17">进阶配置示例</h4>
<h5 data-id="heading-18">pnpm 配置</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .npmrc</span>
<span class="hljs-attr">shared-workspace-lockfile</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">virtual-store-dir</span> = .pnpm-store
public-hoist-pattern<span class="hljs-section">[]</span> = "*eslint*"
<span class="hljs-attr">node-linker</span> = <span class="hljs-string">"isolated"</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pnpmfile.cjs</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">hooks</span>: {
    <span class="hljs-title function_">readPackage</span>(<span class="hljs-params">pkg</span>) {
      <span class="hljs-keyword">if</span> (pkg.<span class="hljs-property">name</span> === <span class="hljs-string">'legacy-tool'</span> &amp;&amp; !pkg.<span class="hljs-property">dependencies</span>.<span class="hljs-property">react</span>) {
        pkg.<span class="hljs-property">dependencies</span>.<span class="hljs-property">react</span> = <span class="hljs-string">'^18.2.0'</span>;
      }
      <span class="hljs-keyword">return</span> pkg;
    }
  }
};
</code></pre>
<p><strong>说明</strong>：</p>
<ul>
<li><code>virtual-store-dir</code> 可让 <code>.pnpm</code> 与源码分离（例如放到 <code>/tmp/pnpm</code> 以便容器层缓存）。</li>
<li><code>public-hoist-pattern</code> 控制哪些包需要 hoist 到传统 <code>node_modules</code>，以兼容硬编码路径的工具。</li>
<li><code>pnpmfile.cjs</code> 中的 hook 允许在安装阶段动态改写依赖、打补丁或增加 peerDependencies。</li>
</ul>
<h5 data-id="heading-19">yarn Berry 配置</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .yarnrc.yml</span>
<span class="hljs-attr">nodeLinker:</span> <span class="hljs-string">pnp</span>
<span class="hljs-attr">enableImmutableInstalls:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">yarnPath:</span> <span class="hljs-string">.yarn/releases/yarn-4.2.2.cjs</span>
</code></pre>
<pre><code class="hljs language-prolog" lang="prolog"># constraints.pro
gen_enforced_dependency("workspace:^", "react", "^18.2.0").
gen_enforced_field("workspace:^", "license", "MIT").
</code></pre>
<pre><code class="hljs language-bash" lang="bash">$ yarn constraints --fix
</code></pre>
<p><strong>说明</strong>：</p>
<ul>
<li>Constraints 基于 Prolog（<code>@yarnpkg/constraint</code> 提供求解器），可对所有 workspace 强制字段/依赖版本，避免团队成员擅自修改。</li>
<li>Zero-Install 流程：提交 <code>.yarn/cache/*.zip</code>、<code>.pnp.cjs</code> 与 <code>.yarnrc.yml</code> 到仓库，CI 直接 <code>yarn install --immutable</code> 即可跳过网络下载；若需排除大文件，可结合 Git LFS 或 <code>.yarn/cache/.gitignore</code> 精细控制。</li>
</ul>
<h3 data-id="heading-20">调试与排障技巧</h3>
<p>安装器差异导致排障命令也不同，合理利用 CLI 可以迅速定位依赖链、缓存或镜像问题。</p>













































<table><thead><tr><th>工具</th><th>诊断命令</th><th>作用</th></tr></thead><tbody><tr><td>npm/cnpm</td><td><code>npm ls &lt;pkg&gt;</code></td><td>查看指定依赖的解析路径与版本冲突。</td></tr><tr><td>npm/cnpm</td><td><code>npm doctor</code></td><td>检查 npm 配置、权限与缓存状态。</td></tr><tr><td>pnpm</td><td><code>pnpm why &lt;pkg&gt;</code></td><td>显示 <code>.modules.yaml</code> 与 store 中该依赖的引用链。</td></tr><tr><td>pnpm</td><td><code>pnpm store path</code> / <code>pnpm store prune</code></td><td>获取共享 store 位置或清理孤儿包，排查磁盘占用。</td></tr><tr><td>yarn Classic</td><td><code>yarn why &lt;pkg&gt;</code></td><td>输出依赖链与版本来源，辅助定位 hoist 问题。</td></tr><tr><td>yarn Berry</td><td><code>yarn explain peer-requirements &lt;hash&gt;</code></td><td>根据 peer hash 找到触发告警的 workspace 与依赖。</td></tr><tr><td>yarn Berry</td><td><code>YARN_ENABLE_LOG_FILTERS=0 yarn install -v</code></td><td>关闭日志过滤并输出 PnP 解析细节，便于定位 <code>.pnp.cjs</code> 问题。</td></tr></tbody></table>
<h4 data-id="heading-21">典型调试输出示例</h4>
<p><strong>pnpm</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ pnpm why react
Legend: production dependency, optional only, dev only
project-a
└───┬ react-dom 18.2.0
    └───┬ react 18.2.0
</code></pre>
<p><strong>yarn Berry</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ yarn explain peer-requirements 7b42d
pnp:7b42d - ✓ @storybook/react@8.1.0 provides react@&gt;=18
pnp:7b42d - ✗ @storybook/react@8.1.0 requires react-dom@&gt;=18 (missing)
</code></pre>
<p><strong>npm</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">$ npm doctor
Check npm version: ok
Check permissions: ok
Check package integrity: ok
</code></pre>
<h4 data-id="heading-22">PnP loader 与 ESM 交互</h4>
<ul>
<li><code>.pnp.loader.mjs</code> 基于 Node Loader API，导出 <code>resolve</code> 与 <code>load</code> 钩子。<code>resolve(specifier, context, next)</code> 会调用与 CommonJS 同源的 <code>pnpapi.resolveRequest</code>，返回形如 <code>zip:/…</code> 的 URL。<code>load(url, context, defaultLoad)</code> 则把 zip 条目读入内存并返回 <code>{format: 'module', source}</code>。</li>
<li>对 <code>import.meta.resolve</code>，yarn Berry 会在 <code>pnpapi</code> 中实现 <code>resolveToUnqualified</code>，使得 bundler 或 runtime 可以显式解析依赖；若工具只接受真实文件路径，可结合 <code>yarn unplug</code> 将特定包落地到 <code>.yarn/unplugged</code>。</li>
<li>若项目需要以 <code>node --loader ts-node/esm</code> 方式运行 TypeScript，需在 <code>.pnp.loader.mjs</code> 中加入自定义链路：<code>yarn dlx @yarnpkg/sdks vim</code> 会为 VS Code/TS Server 生成适配插件，确保 Loader 顺序正确。</li>
</ul>
<h4 data-id="heading-23">锁文件与可移植性</h4>
<ul>
<li><strong>npm</strong>：<code>package-lock.json</code>；跨平台兼容好，工具链广泛支持。</li>
<li><strong>pnpm</strong>：<code>pnpm-lock.yaml</code>；记录 store 引用，结合 <code>pnpm fetch</code> 可实现离线安装。</li>
<li><strong>yarn</strong>：Classic 使用 <code>yarn.lock</code>；Berry 引入 <code>yarn.lock</code> + <code>.pnp.cjs</code>，需要配套插件与编辑器支持。</li>
<li><strong>cnpm</strong>：依旧生成 <code>package-lock.json</code>。</li>
</ul>
<h4 data-id="heading-24">二进制与平台支持</h4>
<ul>
<li><strong>npm</strong>：通过 <code>npm config set python</code> 等方式自定义构建环境，Node-gyp 生态成熟。</li>
<li><strong>pnpm</strong>：安装二进制依赖时可沿用 npm 脚本；<code>pnpmfile.cjs</code> 可按平台调整依赖。</li>
<li><strong>yarn</strong>：Berry PnP 模式下运行 node-gyp 需启用 <code>nodeLinker: node-modules</code>；Classic 表现与 npm 相同。</li>
<li><strong>cnpm</strong>：依赖 npm 行为，但镜像同步二进制包时可能延迟，需关注 native 模块版本。</li>
</ul>
<h4 data-id="heading-25">磁盘占用</h4>
<ul>
<li><strong>npm/cnpm/yarn Classic</strong>：每个项目完整复制依赖，monorepo 下空间浪费明显。</li>
<li><strong>pnpm</strong>：单机共享 store，节省 60%~90% 空间；同时减少重复下载。</li>
<li><strong>yarn Berry</strong>：启用 PnP 后不再创建 node_modules，磁盘占用极低，但部分工具需额外适配。</li>
</ul>
<h4 data-id="heading-26">中国区可用性与镜像</h4>
<ul>
<li><strong>npm</strong>：需手动配置镜像或使用 <code>nrm</code> 切换。</li>
<li><strong>pnpm</strong>：可与任意 registry 配合，常与 <code>corepack</code> + 环境变量设定镜像。</li>
<li><strong>cnpm</strong>：默认指向阿里镜像，提供 <code>cnpm sync &lt;pkg&gt;</code> 主动同步能力。</li>
<li><strong>yarn</strong>：通过 <code>.yarnrc.yml</code> 指定 <code>npmRegistryServer</code>；Berry 还能对特定 scope 配置自定义 registry。</li>
</ul>
<h4 data-id="heading-27">Monorepo 与高级特性</h4>
<ul>
<li><strong>npm</strong>：Workspaces 支持基础 monorepo，但缺乏任务编排等能力。</li>
<li><strong>pnpm</strong>：内建过滤器（<code>pnpm -r --filter ...</code>）、<code>pnpm publish -r</code> 等命令，结合 <code>pnpmfile.cjs</code> 可重写依赖。</li>
<li><strong>yarn</strong>：Berry 提供 Constraints、Plugins、Zero-Install、<code>yarn workspaces focus</code> 等高级机制。</li>
<li><strong>cnpm</strong>：未扩展 monorepo 能力，通常与 Lerna/Nx 组合使用。</li>
</ul>
<h4 data-id="heading-28">CLI 体验与生态工具</h4>
<ul>
<li><strong>npm</strong>：命令语义直观，<code>npx</code> 集成度高；配套 <code>npm audit</code>、<code>npm dedupe</code> 等工具完善。</li>
<li><strong>pnpm</strong>：CLI 支持过滤、<code>pnpm env use</code> 等进阶命令；可通过 <code>corepack</code> 在多环境统一版本。</li>
<li><strong>yarn</strong>：Classic 命令接近 npm；Berry CLI 插件化，可按需引入 <code>@yarnpkg/doctor</code>、<code>@yarnpkg/plugin-npm-cli</code> 等。</li>
<li><strong>cnpm</strong>：保持 npm 命令兼容，额外提供 <code>cnpm sync</code> 便于镜像同步。</li>
</ul>
<h4 data-id="heading-29">学习曲线与团队协作</h4>
<ul>
<li><strong>npm</strong>：默认工具，文档与社区问答最丰富，新成员上手成本最低。</li>
<li><strong>pnpm</strong>：需理解 store 结构与 <code>pnpm-lock.yaml</code>，但 CLI 输出清晰、迁移指南完备。</li>
<li><strong>yarn</strong>：Classic 易用；Berry 引入 Plug'n'Play、Constraints 等概念，需额外培训与 IDE 配置。</li>
<li><strong>cnpm</strong>：操作与 npm 一致，重点在维护镜像同步策略。</li>
</ul>
<h4 data-id="heading-30">安全与审计</h4>
<ul>
<li><strong>npm</strong>：原生 <code>npm audit fix</code>；Registry 团队维护 advisories。</li>
<li><strong>pnpm</strong>：继承 npm audit 数据，同时可在 <code>pnpmfile.cjs</code> 中集中打补丁或替换依赖版本。</li>
<li><strong>yarn</strong>：<code>yarn npm audit</code>（Berry）或 <code>yarn audit</code>（Classic）；Berry 的 Constraints 可强制版本范围。</li>
<li><strong>cnpm</strong>：沿用 npm 安全数据库，但国内镜像同步可能存在延迟，关键包需关注更新时差。</li>
</ul>
<h4 data-id="heading-31">CI/CD 与缓存策略</h4>
<ul>
<li><strong>npm</strong>：依赖 <code>npm ci</code> 获得确定性安装，但大型 monorepo 下缓存命中率一般。</li>
<li><strong>pnpm</strong>：<code>pnpm fetch</code> + <code>pnpm install --offline</code> 结合远程 store 缓存，可显著降低 CI 时间。</li>
<li><strong>yarn</strong>：Classic 可缓存 <code>.yarn/cache</code>；Berry 默认生成压缩包，可和 Zero-Install 一起提交仓库。</li>
<li><strong>cnpm</strong>：在 CI 中价值有限，更多用于开发机加速；若 CI 运行在国内亦可直接使用 cnpm registry。</li>
</ul>
<h4 data-id="heading-32">日常开发、打包与运行体验</h4>
<ul>
<li><strong>npm</strong>：<code>npm run dev/build/test</code> 是绝大多数脚手架（Next.js、Vite、create-react-app 等）的默认命令，生态插件与 IDE 集成都围绕 npm script 实现；<code>npm run</code> 支持 <code>--workspaces</code> 批量触发，但功能较基础。</li>
<li><strong>pnpm</strong>：<code>pnpm dev</code>/<code>pnpm build</code> 与 npm 保持一致，额外提供 <code>pnpm run --parallel</code>、<code>pnpm -r --filter</code> 等能力，可在 monorepo 中只针对受影响包运行 Vite、Webpack、Rollup；<code>pnpm dlx</code> 可直接执行 bundler CLI 而无需全局安装。</li>
<li><strong>yarn</strong>：Classic 的 <code>yarn run</code>、<code>yarn workspace &lt;name&gt; dev</code> 体验成熟；Berry 则可用 <code>yarn workspaces foreach</code>、<code>yarn constraints</code> 抽象复杂脚本，并通过 Plug'n'Play 让 bundler 冷启动更快，必要时配置 <code>pnpMode: loose</code> 兼容不支持 PnP 的工具。</li>
<li><strong>cnpm</strong>：与 npm run 语义完全一致，常在国内开发机上用于安装依赖，脚本执行仍由 npm/yarn/pnpm 完成；若希望统一，则在安装阶段用 cnpm，运行阶段回到 npm scripts。</li>
</ul>
<h4 data-id="heading-33">迁移成本与社区活跃度</h4>
<ul>
<li><strong>npm</strong>：无需迁移；版本更新平滑。</li>
<li><strong>pnpm</strong>：迁移需关注脚本里显式依赖 <code>node_modules</code> 路径的场景；社区对 monorepo 与现代框架支持积极。</li>
<li><strong>yarn</strong>：Classic→Berry 需重写配置；部分第三方脚本不兼容 PnP，需要 <code>nodeLinker: node-modules</code> 兜底。</li>
<li><strong>cnpm</strong>：只要 npm 命令兼容即可切换；但社区讨论集中在网络加速层面，功能性演进较少。</li>
</ul>
<h3 data-id="heading-34">典型场景与推荐组合</h3>









































<table><thead><tr><th>场景</th><th>主要诉求</th><th>推荐工具</th><th>说明</th></tr></thead><tbody><tr><td>大型 monorepo + 频繁 CI</td><td>安装速度、磁盘占用、严格依赖</td><td>pnpm</td><td><code>pnpm fetch</code> + 远程 store，可与 Nx/Turbo/Turborepo 等配合。</td></tr><tr><td>面向外部的库或脚手架</td><td>生态兼容、默认体验</td><td>npm</td><td>避免用户额外安装工具，<code>npm publish</code> 流程也最成熟。</td></tr><tr><td>全栈团队追求高级特性</td><td>Zero-Install、Constraints、自定义 CLI</td><td>yarn Berry</td><td>结合 Corepack 固定版本，必要时退回 node_modules 模式。</td></tr><tr><td>国内内网/隔离网络</td><td>稳定镜像、可自建代理</td><td>cnpm 或 npm/pnpm + npmmirror</td><td>cnpm 自带同步命令，亦可配制 Verdaccio 等私服。</td></tr><tr><td>多技术栈混合仓库</td><td>同时管理 Node、Python、Rust 工具</td><td>npm/pnpm + Volta 或 asdf</td><td>通过版本管理器固定 CLI，保持 lockfile 一致。</td></tr></tbody></table>
<h3 data-id="heading-35">迁移与实施建议</h3>
<ol>
<li><strong>从 npm 迁移至 pnpm</strong>：提前排查脚本中硬编码的 <code>node_modules/.bin</code>，改用 <code>pnpm dlx</code> 或 <code>packageManager</code> 跨平台调用；在 CI 中新增 <code>pnpm fetch</code> 步骤，并确认缓存权限。</li>
<li><strong>引入 yarn Berry</strong>：先用 <code>yarn set version berry</code> + <code>yarn init</code> 生成配置，再根据实际情况决定使用 PnP 还是 <code>nodeLinker: node-modules</code>，并为 IDE 安装 Yarn SDK 与插件。</li>
<li><strong>混合工具链的版本治理</strong>：使用 Corepack、Volta、asdf 或 mise 固定 npm/pnpm/yarn 版本，必要时在 <code>package.json</code> 中声明 <code>packageManager</code> 字段，避免锁文件因环境差异而漂移。</li>
<li><strong>镜像与私服策略</strong>：对需要离线或加速的环境，将 registry、disturl、binary mirror 等配置写入 <code>.npmrc</code>/<code>.yarnrc.yml</code>，确保 CI 与本地一致；若使用 cnpm，可周期性执行 <code>cnpm sync</code> 防止版本滞后，也可结合 Verdaccio/Artifactory 做企业级缓存。</li>
</ol>
<h3 data-id="heading-36">综合考虑</h3>
<ol>
<li><strong>追求磁盘效率与严格依赖管理</strong>：首选 pnpm；在大型 monorepo、CI/CD 频繁场景中尤为高效。</li>
<li><strong>需要最广泛的兼容性</strong>：npm 仍是默认选项，尤其适用于对外分发的库或对工具链兼容性要求极高的项目。</li>
<li><strong>面向国内网络环境</strong>：若团队主要痛点是下载速度，可选 cnpm 或在 npm/pnpm/yarn 上配置 npmmirror。</li>
<li><strong>希望尝试先进特性</strong>：yarn Berry 适合需要 Zero-Install、Constraints、可插拔 CLI 的团队，但需投入额外学习成本。</li>
</ol>
<h3 data-id="heading-37">总结</h3>
<p>pnpm 代表“高效与严谨”，适合一切追求极致依赖管理的现代工程；npm 以稳健与兼容性取胜，是生态默认语言；yarn 借助 Berry 获得高度可配置的高级特性；cnpm 则在中国区网络环境下提供最佳可达性。根据团队的体量、CI 频率、网络环境与学习成本进行权衡，往往能自然地落在表格中的某一列：新项目优先考虑 pnpm 或 yarn Berry，存量项目可在保持 npm 的同时逐步评估迁移收益，而只需解决下载加速时选择 cnpm 或镜像即可。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信小程序页面栈：从一个 Bug 讲到彻底搞懂]]></title>    <link>https://juejin.cn/post/7578495241638150185</link>    <guid>https://juejin.cn/post/7578495241638150185</guid>    <pubDate>2025-12-01T07:47:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578495241638150185" data-draft-id="7578582010416070662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信小程序页面栈：从一个 Bug 讲到彻底搞懂"/> <meta itemprop="keywords" content="前端,微信小程序"/> <meta itemprop="datePublished" content="2025-12-01T07:47:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="吹水一流"/> <meta itemprop="url" content="https://juejin.cn/user/993614244613543"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信小程序页面栈：从一个 Bug 讲到彻底搞懂
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614244613543/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    吹水一流
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:47:03.000Z" title="Mon Dec 01 2025 07:47:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">微信小程序页面栈：从一个 Bug 讲到彻底搞懂</h2>
<p>上周上线前，测试同事丢过来一个非常诡异的 bug：</p>
<blockquote>
<p>从首页一路点下去，点到差不多第十层，再点“下一步”按钮就<strong>没反应了</strong>。<br/>
按钮动画有，点击态有，就是页面完全不跳。</p>
</blockquote>
<p>当时这条链路大概是：</p>
<blockquote>
<p>tab 首页 → 列表 → 详情 → 子详情 1 → 子详情 2 → … → 一路 <code>wx.navigateTo</code> 叠上去</p>
</blockquote>
<h4 data-id="heading-1">1. 第一步：怀疑是按钮/事件问题</h4>
<p>我们第一反应肯定是前端老三样：<br/>
<strong>事件没绑上 / 被遮挡 / 防抖拦截 / 状态锁死</strong>。</p>
<p>于是：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 按钮绑定的点击事件里</span>
<span class="hljs-title function_">handleNext</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[next] clicked'</span>)
  wx.<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">title</span>: <span class="hljs-string">'点击到了'</span>, <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span> })

  wx.<span class="hljs-title function_">navigateTo</span>({
    <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/step-next/index'</span>,
  })
}
</code></pre>
<p>回到现场重现：</p>
<ul>
<li>Toast 正常弹出 ✅</li>
<li>控制台 <code>clicked</code> 正常打印 ✅</li>
<li><code>wx.navigateTo</code> 确实被执行 ✅</li>
<li><strong>就是页面不跳</strong>❌</li>
</ul>
<p>事件层的问题基本排除。</p>
<h4 data-id="heading-2">2. 第二步：加 fail 回调，看 errMsg 到底说啥</h4>
<p>直觉告诉我：要么是路由层面限制，要么是宿主直接拒绝了这次跳转。</p>
<p>于是把 <code>navigateTo</code> 改成这样：</p>
<pre><code class="hljs language-javascript" lang="javascript">wx.<span class="hljs-title function_">navigateTo</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/step-next/index'</span>,
  <span class="hljs-title function_">success</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[next] navigateTo success'</span>)
  },
  <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[next] navigateTo fail'</span>, err)
    wx.<span class="hljs-title function_">showToast</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">'跳转失败'</span>,
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>
    })
  }
})
</code></pre>
<p>再重现一次，这次控制台终于给了关键线索：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[next]</span> navigateTo fail 
{errMsg: <span class="hljs-string">"navigateTo:fail webview count limit exceed"</span>}
</code></pre>
<p>大概意思就是：<strong>webview 数量超限了</strong>。</p>
<p>同时我顺手在点击前后打了一行：</p>
<pre><code class="hljs language-matlab" lang="matlab">console.<span class="hljs-built_in">log</span>(<span class="hljs-string">'[next] pages length'</span>, getCurrentPages().<span class="hljs-built_in">length</span>)
</code></pre>
<p>打印出来是：</p>
<pre><code class="hljs language-perl" lang="perl">[<span class="hljs-keyword">next</span>] pages <span class="hljs-keyword">length</span> <span class="hljs-number">10</span>
</code></pre>
<p>到这就非常清晰了：</p>
<ul>
<li>每 <code>navigateTo</code> 一次就多叠一层页面</li>
<li>叠到第 10 层之后，再 <code>navigateTo</code>，直接被框架拒绝</li>
<li>fail 里给了 <code>webview count limit exceed</code> 这样的错误</li>
<li>在页面上表现出来，就是**“按钮点击没报错，但页面就是不跳”**</li>
</ul>
<p>这个坑，很多小程序其实都踩过。<br/>
真正的核心，就是 <strong>“页面栈” 有上限</strong>。</p>
<p>接下来，我们就围绕这个真实问题，把“页面栈”这个概念彻底讲清楚。</p>
<hr/>
<h3 data-id="heading-3">一、页面栈到底是什么？</h3>
<p>在小程序里，可以把所有<strong>正在存在的页面实例</strong>，想象成一个有顺序的数组：</p>
<ul>
<li><strong>栈底</strong>：用户最早进入的页面（通常是首页）</li>
<li><strong>栈顶</strong>：当前正在展示的页面</li>
<li>这个数组就是：<strong>页面栈（page stack）</strong></li>
</ul>
<p>用伪代码抽象一下（方便你在脑子里跑）：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 抽象理解，并非真实源码</span>
<span class="hljs-keyword">let</span> pageStack = []

<span class="hljs-comment">// 1）小程序启动 → 进入首页</span>
pageStack.push(<span class="hljs-keyword">new</span> Page(<span class="hljs-string">'/pages/index/index'</span>))  <span class="hljs-comment">// [index]</span>

<span class="hljs-comment">// 2）首页 → 详情</span>
pageStack.push(<span class="hljs-keyword">new</span> Page(<span class="hljs-string">'/pages/detail/detail'</span>)) <span class="hljs-comment">// [index, detail]</span>

<span class="hljs-comment">// 3）详情 → 返回首页</span>
pageStack.pop()  <span class="hljs-comment">// [index]</span>
</code></pre>
<p>有两个<strong>硬规则</strong>：</p>
<ol>
<li>
<p>页面栈中的每一项都是一个“活着的页面实例”；<br/>
只要还在栈里，它的 <code>data</code>、方法、状态都在内存里。</p>
</li>
<li>
<p>页面栈<strong>最多只能有 10 个页面</strong>。<br/>
当 <code>getCurrentPages().length === 10</code> 时，再 <code>wx.navigateTo</code>：</p>
<ul>
<li>不会再创建新页面</li>
<li>本次跳转失败</li>
<li>控制台/<code>fail</code> 里会看到类似<br/>
<code>navigateTo:fail webview count limit exceed</code> 这样的错误</li>
</ul>
</li>
</ol>
<p>开头那个真实 bug，本质就是：<strong>一路 <code>navigateTo</code> 堆满了 10 层页面栈</strong>。</p>
<hr/>
<h3 data-id="heading-4">二、别把“页面栈”和 WebView 历史搞混了</h3>
<p>在讲 API 之前，有一个经常让人困惑的问题：</p>
<blockquote>
<p>“既然页面栈是栈结构，只能返回，那我在某些页面里还能右滑‘前进’，这又怎么解释？”</p>
</blockquote>
<p>这里其实有两套完全不同的“历史系统”：</p>
<h4 data-id="heading-5">1）小程序页面栈（本文主角）</h4>
<ul>
<li>管的是：小程序每一个 <code>Page</code> 页面实例</li>
<li>操作它的是：<code>navigateTo / navigateBack / redirectTo / reLaunch / switchTab</code></li>
<li>特点：只存在“后退”（<code>navigateBack</code>），<strong>没有“前进”这个概念</strong></li>
</ul>
<h4 data-id="heading-6">2）WebView / H5 浏览器历史</h4>
<ul>
<li>当你在小程序里用 <code>&lt;web-view&gt;</code> 嵌入 H5 时，里面其实是浏览器</li>
<li>浏览器有自己的 <code>history.back()</code> / <code>history.forward()</code></li>
<li>iOS/Android 的 WebView 还会给你左滑后退/右滑前进的手势</li>
</ul>
<p>也就是说：</p>
<ul>
<li>小程序页面栈管的是：<br/>
<code>A(Page) → B(Page) → navigateBack → A(Page)</code></li>
<li>H5 历史管的是：<br/>
WebView 里那几层 URL 的前进后退</li>
</ul>
<p>你在某些场景下面到的“右滑前进”，很有可能只是 WebView 那一层在前进，<strong>小程序的页面栈根本没变</strong>。</p>
<p>后面我们说的所有“压栈/出栈”，指的都是小程序这层的页面栈。</p>
<hr/>
<h3 data-id="heading-7">三、五个路由 API 和页面栈的关系：先看一张总表</h3>
<p>把小程序路由 API 都翻译成“对页面栈的操作”：</p>



































<table><thead><tr><th>API</th><th>对页面栈的抽象操作</th><th>常见用途</th></tr></thead><tbody><tr><td><code>navigateTo</code></td><td><strong>在栈顶 push 一个新页面</strong></td><td>A 打开 B，可以返回到 A</td></tr><tr><td><code>navigateBack</code></td><td><strong>从栈顶 pop 掉 N 个页面</strong></td><td>返回上一页 / 多级返回</td></tr><tr><td><code>redirectTo</code></td><td><strong>弹出当前页，再 push 一个新页面</strong></td><td>当前页不该再返回时，用来“换页”</td></tr><tr><td><code>reLaunch</code></td><td><strong>清空整个栈，再 push 一个新页面</strong></td><td>登录完成 / 退出登录 / 重置应用</td></tr><tr><td><code>switchTab</code></td><td><strong>关闭所有非 tabBar 页面，切到某个 tab</strong></td><td>回到 tabBar 主入口</td></tr></tbody></table>
<p>下面逐个拆开，但统一围绕一件事：<strong>页面栈怎么变 + 生命周期怎么走</strong>。</p>
<hr/>
<h3 data-id="heading-8">四、<code>wx.navigateTo</code>：最常用的“进下一页”（push）</h3>
<h4 data-id="heading-9">4.1 内部流程</h4>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.navigateTo</span>({
  url: <span class="hljs-string">'/pages/detail/detail?id=1&amp;from=list'</span>
})
</code></pre>
<p>发生的事：</p>
<ol>
<li>
<p>当前页（例如 <code>list</code>）触发：<code>onHide</code></p>
</li>
<li>
<p>创建新页面 <code>detail</code>：</p>
<ul>
<li><code>detail.onLoad({ id: '1', from: 'list' })</code></li>
<li><code>detail.onShow()</code></li>
</ul>
</li>
<li>
<p>页面栈：</p>
</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[list]</span> → <span class="hljs-selector-attr">[list, detail]</span>
</code></pre>
<h4 data-id="heading-10">4.2 两个关键限制</h4>
<ol>
<li>
<p><strong>不能跳转到 tabBar 页面</strong><br/>
想去 tab 页，必须用 <code>switchTab</code>。</p>
</li>
<li>
<p>当页面栈长度已经是 10：</p>
<pre><code class="hljs language-scss" lang="scss">const pages = <span class="hljs-built_in">getCurrentPages</span>()
console<span class="hljs-selector-class">.log</span>(pages.length) <span class="hljs-comment">// 10</span>
</code></pre>
<p>再 <code>wx.navigateTo</code>：</p>
<ul>
<li>不会再压入新页面</li>
<li>本次跳转 fail</li>
<li>errMsg 通常类似：<code>navigateTo:fail webview count limit exceed</code></li>
</ul>
<p>页面表现：<br/>
<strong>事件触发了，代码也走了，但页面完全没跳。</strong></p>
</li>
</ol>
<hr/>
<h3 data-id="heading-11">五、<code>wx.navigateBack</code>：往回退（pop）</h3>
<h4 data-id="heading-12">5.1 单级返回</h4>
<pre><code class="hljs language-scss" lang="scss">wx<span class="hljs-selector-class">.navigateBack</span>()
<span class="hljs-comment">// 等价于 wx.navigateBack({ delta: 1 })</span>
</code></pre>
<p>假设当前页面栈：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">index, list</span>]
</code></pre>
<p>执行后：</p>
<ol>
<li><code>list.onUnload()</code>（销毁，从栈中移除）</li>
<li><code>index.onShow()</code>（重新展示）</li>
<li>页面栈变成：</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">index</span>]
</code></pre>
<h4 data-id="heading-13">5.2 多级返回</h4>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.navigateBack</span>({ delta: <span class="hljs-number">2</span> })
</code></pre>
<p>假设当前：</p>
<pre><code class="hljs language-arduino" lang="arduino">[home, list, detail, edit]   <span class="hljs-comment">// 当前在 edit</span>
</code></pre>
<p>执行后：</p>
<ol>
<li><code>edit.onUnload()</code></li>
<li><code>detail.onUnload()</code></li>
<li><code>list.onShow()</code></li>
<li>页面栈变成：</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">[home, list]
</code></pre>
<p>注意：</p>
<ul>
<li><code>delta</code> 超过栈长只会退到栈底，不会炸</li>
<li>被退到的页面 <strong>只触发 <code>onShow</code>，不会再触发 <code>onLoad</code></strong></li>
</ul>
<p><strong>所以：</strong><br/>
所有“返回后要刷新”的逻辑，都应该放在 <code>onShow</code> 里，而不是 <code>onLoad</code>。</p>
<hr/>
<h3 data-id="heading-14">六、<code>wx.redirectTo</code>：替换当前页（当前页没用了）</h3>
<h4 data-id="heading-15">6.1 行为</h4>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.redirectTo</span>({
  url: <span class="hljs-string">'/pages/result/result'</span>
})
</code></pre>
<p>假设当前页面栈：</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">A, B</span>]   <span class="hljs-comment">// 当前在 B</span>
</code></pre>
<p>执行后：</p>
<ol>
<li>
<p><code>B.onUnload()</code> → 从页面栈移除</p>
</li>
<li>
<p>新建 <code>C</code>：</p>
<ul>
<li><code>C.onLoad()</code></li>
<li><code>C.onShow()</code></li>
</ul>
</li>
<li>
<p>页面栈：</p>
</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">A, C</span>]
</code></pre>
<h4 data-id="heading-16">6.2 使用场景</h4>
<p>可以直接记一句：</p>
<blockquote>
<p><strong>当前页面“走过去就不应该再回来了”，用 <code>redirectTo</code>。</strong></p>
</blockquote>
<p>典型例子：</p>
<ul>
<li>登录成功后跳首页：不希望用户再退回登录页</li>
<li>填写完表单跳“成功页”：不一定要再回到表单页</li>
<li>一些“中间引导页”“结果页”，只负责中转一次</li>
</ul>
<hr/>
<h3 data-id="heading-17">七、<code>wx.reLaunch</code>：清空整个栈，重新开始</h3>
<h4 data-id="heading-18">7.1 行为</h4>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.reLaunch</span>({
  url: <span class="hljs-string">'/pages/home/home'</span>
})
</code></pre>
<p>假设原来页面栈：</p>
<pre><code class="hljs language-arduino" lang="arduino">[guide, login, home, list]
</code></pre>
<p>执行后：</p>
<ol>
<li>
<p><code>guide、login、home、list</code> 依次 <code>onUnload</code>，全部被销毁</p>
</li>
<li>
<p>创建新的 <code>home</code> 页面：</p>
<ul>
<li><code>home.onLoad()</code></li>
<li><code>home.onShow()</code></li>
</ul>
</li>
<li>
<p>页面栈变成：</p>
</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">[home]
</code></pre>
<h4 data-id="heading-19">7.2 常见用途</h4>
<ul>
<li>登录成功 / 退出登录后，<strong>重置整个应用路由</strong></li>
<li>发生严重异常，回到首页或错误页，把历史一刀切掉</li>
</ul>
<p>例如登录流程常见写法：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 未登录 → 拉到登录页</span>
wx.<span class="hljs-title function_ invoke__">reLaunch</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/login/login'</span>
})

<span class="hljs-comment">// 登录成功 → 拉回首页</span>
wx.<span class="hljs-title function_ invoke__">reLaunch</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/home/home'</span>  // 或主 tab
})
</code></pre>
<hr/>
<h3 data-id="heading-20">八、<code>wx.switchTab</code>：切到 tabBar 页，顺手清掉非 tab 页</h3>
<h4 data-id="heading-21">8.1 行为</h4>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.switchTab</span>({
  url: <span class="hljs-string">'/pages/tab-home/index'</span>
})
</code></pre>
<p>假设当前页面栈：</p>
<pre><code class="hljs language-arduino" lang="arduino">[tab-home, list, detail]  <span class="hljs-comment">// 当前 detail，tab-home 是 tabBar 页面</span>
</code></pre>
<p>执行后：</p>
<ol>
<li>
<p>关闭所有<strong>非 tabBar</strong> 页面：<code>list、detail</code> → <code>onUnload</code></p>
</li>
<li>
<p>激活 <code>tab-home</code>：</p>
<ul>
<li>第一次：<code>onLoad()</code> → <code>onShow()</code></li>
<li>之后：只 <code>onShow()</code></li>
</ul>
</li>
<li>
<p>页面栈可以理解为：</p>
</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino">[tab-home]
</code></pre>
<p>可以直接记：</p>
<blockquote>
<p><strong>switchTab = 回到某个 tabBar 根页面，并清掉这次业务流中的非 tab 页面。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-22">九、动作 ⇄ 生命周期 ⇄ 页面栈，一张表记住</h3>
<p>把上面的内容汇总成一张“速查表”：</p>





















































<table><thead><tr><th>场景</th><th>页面栈变化（抽象）</th><th>被关闭页</th><th>最终停留页生命周期</th></tr></thead><tbody><tr><td>首次进入某页面</td><td><code>[] → [A]</code></td><td>—</td><td>A：<code>onLoad</code> → <code>onShow</code></td></tr><tr><td><code>navigateTo</code></td><td><code>[A] → [A, B]</code></td><td>A：<code>onHide</code></td><td>B：<code>onLoad</code> → <code>onShow</code></td></tr><tr><td><code>navigateBack</code></td><td><code>[A, B] → [A]</code></td><td>B：<code>onUnload</code></td><td>A：<code>onShow</code></td></tr><tr><td><code>redirectTo</code></td><td><code>[A, B] → [A, C]</code></td><td>B：<code>onUnload</code></td><td>C：<code>onLoad</code> → <code>onShow</code></td></tr><tr><td><code>reLaunch</code></td><td><code>[很多] → [X]</code></td><td>所有旧页：<code>onUnload</code></td><td>X：<code>onLoad</code> → <code>onShow</code></td></tr><tr><td><code>switchTab</code>（首次）</td><td><code>[...] → [..., T]</code></td><td>非 tab 页：<code>onUnload</code></td><td>T：<code>onLoad</code> → <code>onShow</code></td></tr><tr><td><code>switchTab</code>（再次）</td><td><code>[...] → [...]</code></td><td>上一个 tab：<code>onHide</code></td><td>当前 tab：<code>onShow</code></td></tr></tbody></table>
<p><strong>工程落地结论只有一句：</strong></p>
<ul>
<li><strong>只做一次的初始化逻辑 → 写在 <code>onLoad</code></strong></li>
<li><strong>只要页面“重新可见”就要跑的逻辑 → 写在 <code>onShow</code></strong></li>
</ul>
<hr/>
<h3 data-id="heading-23">十、10 层限制，对项目设计的实际影响</h3>
<p>再用页面栈视角推一次“跳不动”的过程：</p>
<ol>
<li>
<p>一路 <code>navigateTo</code> 叠上去：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[P1]</span>
<span class="hljs-section">[P1, P2]</span>
<span class="hljs-section">[P1, P2, P3]</span>
...
<span class="hljs-section">[P1, P2, ..., P10]</span>  // 此时 <span class="hljs-attr">length</span> = <span class="hljs-number">10</span>
</code></pre>
</li>
<li>
<p>再执行：</p>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.navigateTo</span>({ url: <span class="hljs-string">'/pages/P11/P11'</span> })
</code></pre>
</li>
<li>
<p>结果：</p>
<ul>
<li>当前栈长度 = 10，无法再创建新页面</li>
<li>本次跳转 <code>fail</code>，errMsg 类似：<code>navigateTo:fail webview count limit exceed</code></li>
<li>页面栈仍然是 <code>[P1, ..., P10]</code>，页面当然不会跳走</li>
</ul>
</li>
</ol>
<h4 data-id="heading-24">怎么避免被这个坑反复阴？</h4>
<ol>
<li>
<p>一条业务链路里，不要一路 <code>navigateTo</code> 到天荒地老</p>
<ul>
<li>中间不需要回去的页面，用 <code>redirectTo</code> 替换掉</li>
</ul>
</li>
<li>
<p>对关键业务链路封装一个 <code>safeNavigateTo</code>，统一打印 <code>getCurrentPages().length</code> 和 fail 日志</p>
</li>
<li>
<p>对于“走完流程就回首页/主 tab”的场景，优先考虑 <code>reLaunch</code> 或 <code>switchTab</code>，<strong>顺便清掉一整段页面栈</strong></p>
</li>
</ol>
<hr/>
<h3 data-id="heading-25">十一、结合业务场景看几条真实“页面栈时间线”</h3>
<h4 data-id="heading-26">11.1 tab + 列表 + 详情 + 编辑</h4>
<p>假设有以下页面：</p>
<ul>
<li>tab 首页：<code>/pages/tab-home/index</code></li>
<li>列表页：<code>/pages/list/list</code></li>
<li>详情页：<code>/pages/detail/detail</code></li>
<li>编辑页：<code>/pages/edit/edit</code></li>
</ul>
<h5 data-id="heading-27">1）tab 首页 → 列表</h5>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// tab-home.js</span>
wx.<span class="hljs-title function_ invoke__">navigateTo</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/list/list'</span>
})
</code></pre>
<p>页面栈：<code>[tab-home, list]</code></p>
<h5 data-id="heading-28">2）列表 → 详情</h5>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.navigateTo</span>({
  url: <span class="hljs-string">'/pages/detail/detail?id=1'</span>
})
</code></pre>
<p>页面栈：<code>[tab-home, list, detail]</code></p>
<h5 data-id="heading-29">3）详情 → 编辑</h5>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.navigateTo</span>({
  url: <span class="hljs-string">'/pages/edit/edit?id=1'</span>
})
</code></pre>
<p>页面栈：<code>[tab-home, list, detail, edit]</code></p>
<h5 data-id="heading-30">4）编辑保存成功 → 退回详情并刷新</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// edit.js</span>
<span class="hljs-built_in">save</span>() {
  <span class="hljs-comment">// 假设接口已成功</span>
  const pages = <span class="hljs-built_in">getCurrentPages</span>()
  const prevPage = pages<span class="hljs-selector-attr">[pages.length - 2]</span> <span class="hljs-comment">// 上一个页面 = detail</span>

  prevPage<span class="hljs-selector-class">.setData</span>({ needRefresh: true })
  wx<span class="hljs-selector-class">.navigateBack</span>() <span class="hljs-comment">// 页面栈：[tab-home, list, detail]</span>
}
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// detail.js</span>
Page({
  <span class="hljs-keyword">data</span>: {
    needRefresh: <span class="hljs-literal">false</span>
  },
  onShow() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span>.needRefresh) {
      <span class="hljs-keyword">this</span>.fetchDetail()
      <span class="hljs-keyword">this</span>.setData({ needRefresh: <span class="hljs-literal">false</span> })
    }
  }
})
</code></pre>
<h5 data-id="heading-31">5）详情 → 返回列表</h5>
<pre><code class="hljs language-scss" lang="scss">wx<span class="hljs-selector-class">.navigateBack</span>() <span class="hljs-comment">// 页面栈：[tab-home, list]</span>
</code></pre>
<h5 data-id="heading-32">6）列表 → 切到“我的” tab</h5>
<pre><code class="hljs language-css" lang="css">wx<span class="hljs-selector-class">.switchTab</span>({
  url: <span class="hljs-string">'/pages/tab-mine/index'</span>
})
</code></pre>
<p>非 tab 页面被清掉，页面栈变为：<code>[tab-mine]</code>。</p>
<p>整条链路，你其实可以用“页面栈时间线”一眼推出来每一步应该用哪个 API。</p>
<hr/>
<h4 data-id="heading-33">11.2 登录流程：从页面栈层面彻底断掉“返回登录页”</h4>
<p>需求非常常见：</p>
<ul>
<li>未登录强制进入登录页</li>
<li>登录成功后进入首页</li>
<li>再怎么点“返回”，都不应该回到登录页</li>
</ul>
<p>从页面栈角度来设计：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 未登录时</span>
wx.<span class="hljs-title function_ invoke__">reLaunch</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/login/login'</span>
})
<span class="hljs-comment">// 页面栈：[login]</span>

<span class="hljs-comment">// 登录成功后</span>
wx.<span class="hljs-title function_ invoke__">reLaunch</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/pages/home/home'</span>  // 或主 tab 页
})
<span class="hljs-comment">// 页面栈：[home] 或 [tab-home]</span>
</code></pre>
<p>因为登录页这一层直接被清掉了，所以“返回到登录页”这条路在栈里根本不存在。</p>
<hr/>
<h3 data-id="heading-34">十二、开发时如何“看到”页面栈？</h3>
<h4 data-id="heading-35">12.1 在关键点打印 <code>getCurrentPages()</code></h4>
<p>遇到复杂路由问题时，直接在页面/按钮里打：</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> pages = getCurrentPages()
console.<span class="hljs-built_in">log</span>(
  <span class="hljs-string">'当前页面栈：'</span>,
  pages.<span class="hljs-built_in">map</span>(p =&gt; p.route),
  <span class="hljs-string">'长度：'</span>,
  pages.length
)
</code></pre>
<p>你会在控制台看到类似：</p>
<pre><code class="hljs language-css" lang="css">当前页面栈： <span class="hljs-selector-attr">[<span class="hljs-string">"pages/tab-home/index"</span>, <span class="hljs-string">"pages/list/list"</span>, <span class="hljs-string">"pages/detail/detail"</span>]</span> 长度： <span class="hljs-number">3</span>
</code></pre>
<p>配合前面的“时间线思维”，你可以清楚知道当前到底叠了多少层页面、每层是谁。</p>
<h4 data-id="heading-36">12.2 用标题栏显示当前深度（调试专用小技巧）</h4>
<p>开发环境可以直接在所有页面里加：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Page</span>({
  <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> pages = <span class="hljs-title function_">getCurrentPages</span>()
    wx.<span class="hljs-title function_">setNavigationBarTitle</span>({
      <span class="hljs-attr">title</span>: <span class="hljs-string">`<span class="hljs-subst">${pages.length}</span> 层 · <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.route}</span>`</span>
    })
  }
})
</code></pre>
<p>一边点页面、一边留意标题栏，页面栈在怎么涨怎么减，<strong>肉眼可见</strong>。</p>
<hr/>
<h3 data-id="heading-37">最后，小结几条真正需要记住的规则</h3>
<ol>
<li>小程序内部维护着一个最多 10 层的页面栈，每一层是一个 <code>Page</code> 实例。</li>
<li><code>navigateTo</code> = 压栈、<code>navigateBack</code> = 出栈、<code>redirectTo</code> = 替换栈顶、<code>reLaunch</code> = 清空重建、<code>switchTab</code> = 回到 tabBar 并清掉非 tab 页。</li>
<li>页面栈长度到 10 时，再 <code>wx.navigateTo</code> 会失败，errMsg 通常类似 <code>navigateTo:fail webview count limit exceed</code>，页面表现就是“跳不动”。</li>
<li>返回只触发 <code>onShow</code> 不触发 <code>onLoad</code>，“返回后刷新”逻辑必须写在 <code>onShow</code>。</li>
<li>页面栈只负责小程序页面间的跳转，H5 的前进/后退是 WebView 自己那套历史系统，不要混在一起。</li>
</ol>
<p>习惯用“页面栈时间线”的视角去设计路由之后，小程序里大部分“返回乱跳、页面跳不动、刷新异常”的问题，你基本都能自己推出来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux的binfmt_misc机制]]></title>    <link>https://juejin.cn/post/7578495241637134377</link>    <guid>https://juejin.cn/post/7578495241637134377</guid>    <pubDate>2025-12-01T04:46:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578495241637134377" data-draft-id="7578348333250347014" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux的binfmt_misc机制 "/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2025-12-01T04:46:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户722786812344"/> <meta itemprop="url" content="https://juejin.cn/user/4100515739233513"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux的binfmt_misc机制 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4100515739233513/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户722786812344
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:46:11.000Z" title="Mon Dec 01 2025 04:46:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在类UNIX系统上，可执行文件和shell脚本一般都是不带后缀名的，操作系统内置的程序加载器会自动检测文件的权限和内容是否是一个可执行的程序。这么做的好处是可以在输入命令的时候少打很多字。坏处自然是不对文件做彻底的检查就无法确定其是否是可执行文件，这会带来一些安全问题。</p>
<p>Linux则更进一步，提供了一套叫<code>binfmt_misc</code>的机制让用户自定义哪些格式的文件是可执行文件，进一步提升了系统灵活性。</p>
<p>这篇文章就简单讲解一下Linux的<code>binfmt_misc</code>的工作原理和应用。阅读这篇文章需要一些知识储备：</p>
<ol>
<li>会简单的Linux操作</li>
<li>知道什么是shell脚本</li>
<li>简单了解过Python、c/c++、Go、Shell或者js等任何一门能进行Linux编程的语言</li>
</ol>
<p>当然上面这些都只需要简单了解即可，下面就进入正文吧。</p>
<h2 data-id="heading-0">什么是binfmt_misc</h2>
<p><code>binfmt_misc</code>全称是“Miscellaneous Binary Format”，它提供了一种用户接口，可以让用户注册自定义的可执行文件格式给内核。</p>
<p>内核在执行程序时会先检查用户和程序文件的权限，然后让程序加载器根据规则加载并执行程序，<code>binfmt_misc</code>所做的就是添加用户的自定义规则到加载器的规则集合中，使得除了传统意义上的可执行文件（ELF文件或者有Shebang的脚本）之外的其他文件也可以直接被执行。</p>
<p>举个例子，在Linux模拟Windows环境运行exe程序的模拟器wine，可以通过<code>binfmt_misc</code>机制把exe文件对应的执行规则注册进加载器的规则集合，之后用户就可以像使用普通的Linux程序一样直接执行exe文件，内核会检查到wine注册的规则，自动调用wine来模拟运行exe程序。</p>
<p>知道<code>binfmt_misc</code>是什么之后，下面我们来看看<code>binfmt_misc</code>提供的用户注册接口。</p>
<h2 data-id="heading-1">binfmt_misc的用户接口</h2>
<p>说是用户接口，但因为涉及到操作内核数据以及影响整个系统的行为，所以<code>binfmt_misc</code>提供的接口都需要root权限，接口的操作结果会对所有用户立即生效。</p>
<p><code>binfmt_misc</code>接口的操作结果只在系统运行中生效，关机重启之后之前人工注册的规则就消失了，所以有持久化需求的需要主动把注册命令写入启动脚本之类的东西里。</p>
<p><code>binfmt_misc</code>提供的接口不是系统调用，也不是特殊的命令，而是在<code>/proc/sys/fs/binfmt_misc</code>目录下的一系列文件，通过读取和写入这些文件，可以实现注册规则、删除规则、暂停规则、查看规则状态等操作。</p>
<p>接口文件主要有这几个：</p>
<ol>
<li><code>/proc/sys/fs/binfmt_misc/register</code>，一个不能读取只能写入的文件，写入固定格式的数据可以注册规则到内核</li>
<li><code>/proc/sys/fs/binfmt_misc/status</code>，可读可写的文件，读取时获取当前内核是否开启<code>binfmt_misc</code>机制，返回值是<code>enabled/disabled</code>；写入则可以关闭或重新开启<code>binfmt_misc</code>，允许写入的值只有<code>0</code>（关闭binfmt_misc）、<code>1</code>（重新打开）、<code>-1</code>（删除所有注册规则）。</li>
<li><code>/proc/sys/fs/binfmt_misc/&lt;rule-name&gt;</code>，所有注册的规则都会生成一个和规则名相同的文件，读取整个文件会获得规则的详细信息，写入则可以控制整个规则，允许写入的值有<code>0</code>（暂时让规则失效）、<code>1</code>（重新生效）、<code>-1</code>（删除这个规则，对应的文件也会在写入完成之后被删除）。</li>
</ol>
<p>这些接口都比较简单，你可以通过命令行或者任意一种可以读写系统文件的编程语言来操作它们。</p>
<p>接口中最核心的是<code>/proc/sys/fs/binfmt_misc/register</code>，向它写入数据才能完成我们自定义规则的注册。</p>
<p>注册规则的数据格式是<code>:name:type:offset:magic:mask:interpreter:flags</code>，每个部分都以冒号开头，字段可以省略但前导冒号需要保留，比如我们想省略mask和flags字段，就得写成<code>:name:type:offset:magic::interpreter:</code>。下面解释一下每个字段的意义：</p>
<ol>
<li>name，规则的名称，目录下生成的虚拟文件的名字也是它，所以name中不能包含<code>/</code>，也不能出现一些其他在文件名中不允许出现的字符。不同规则直接不能重名。</li>
<li>type，设置以哪种方式识别文件，支持两个选项<code>M</code>和<code>E</code>，其中<code>M</code>表示通过文件头来识别文件，<code>E</code>则表示通过扩展名来识别文件。</li>
<li>offset，只在type是<code>M</code>时才有效，表示读取文件头信息时需要从文件开头跳过多少个字节。</li>
<li>magic，文件头对应的二进制数据或者文件扩展名（扩展名不包含<code>.</code>），对于一些特殊数据比如<code>\0</code>，<code>\n</code>需要转换成<code>\x00</code>和<code>\x0a</code>。</li>
<li>mask，只在type是<code>M</code>时才生效。mask会和magic进行<code>&amp;</code>位运算，运算结果会作为识别文件所用的依据。这是因为一部分文件的文件头特征数据是不连续的，比如HEIC文件文件头的前八个字节和第13到16字节的内容是固定的，但第9-12个字节可以是<code>HEIF</code>或者<code>HEIC</code>，我们可以用mask把第12个字节过滤掉，这样就不要写两条大致内容重复的规则了。</li>
<li>interpreter，负责执行这种文件的程序的绝对路径，当前准备执行的文件的路径或者描述符会作为第一个参数传给这个程序。</li>
<li>flags，控制程序执行行为的选项，注意这不是传给interpreter的。选项可以传递多个。</li>
</ol>
<p>flags的常用选项有：</p>
<ol>
<li>P，如果给了这个参数，加载器会在<code>argv[0]</code>之后添加一个可执行文件的完整路径。</li>
<li>O，默认情况下可执行文件的完整路径会作为命令行参数被传递给interpreter，启用这个选项后会打开可执行文件并把文件描述符通过auxv数组传递给interpreter。</li>
<li>C，新的进程不会从interpreter继承权限，比如setuid，权限会从待执行的可执行文件本身获取。</li>
<li>F，加载器会立即打开interpreter然后用fexecve/execveat执行程序，这通常被用在需要和容器交互的程序上。</li>
</ol>
<p>只看文字描述可能有点抽象，我们看几个具体的例子：</p>
<p>第一个例子我们注册一条规则，使用python3执行扩展名为<code>.py3</code>的文件。</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">	$ </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">':py3:E::py3::/usr/bin/python3:'</span> &gt; /proc/sys/fs/binfmt_misc/register</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">ls</span> /proc/sys/fs/binfmt_misc</span>

	 

	py3  register  status

	
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">cat</span> /proc/sys/fs/binfmt_misc/py3</span>

	 

	enabled

	interpreter /usr/bin/python3

	flags:

	extension .py3

	
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'print("hello binfmt_misc!")'</span> &gt; /tmp/test.py3</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">chmod</span> +x /tmp/test.py3</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash">/tmp/test.py3</span>

	 

	hello binfmt_misc!
</code></pre>
<p>如果不注册规则就直接执行<code>.py3</code>文件，Linux会直接报错。</p>
<p>第二个例子是用文件头内容识别可执行文件，我们的可执行文件不会有文件扩展名，但会有<code>-- binfmt_lua\n</code>这样的文件头，文件内容是正常的lua脚本，但解释器我们会使用luajit：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">	$ </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">':luajit.exec:M:3:binfmt_lua\x0a::/usr/bin/luajit:'</span> &gt; /proc/sys/fs/binfmt_misc/register</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">ls</span> /proc/sys/fs/binfmt_misc</span>

	 

	luajit.exec  py3  register  status

	
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">'-- binfmt_lua\nprint([[hello from luajit with binfmt_misc]])'</span> &gt; /tmp/testlua</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">chmod</span> +x /tmp/testlua</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash">/tmp/testlua</span>

	 

	hello from luajit with binfmt_misc
</code></pre>
<p>在这个例子中对于非显示的ascii字符换行符，我们把它转换成了<code>\x0a</code>，并使用offset跳过了表示注释的三个字符<code>-- </code>。</p>
<p>看完两个例子我想大家应该掌握<code>binfmt_misc</code>的基本用法了。</p>
<p><code>binfmt_misc</code>有几个小限制还需要注意：</p>
<ol>
<li>proc的接口需要主动挂载才会出现，好在主流发行版都以及自动帮我们处理挂载了</li>
<li>规则字符串总长度不能超过1920字节</li>
<li>使用文件头探测文件时，offset+len(magic)不能超过128字节</li>
<li>interpreter长度不能超过127字节</li>
</ol>
<p>当然，正常使用的情况下其实很难遇到这些限制。</p>
<h2 data-id="heading-2">binfmt_misc的工作原理</h2>
<p>工作原理其实很简单，整个调用链路是这样的：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">	用户通过命令行或者GUI上点击准备允许文件A --&gt;
</span>
<span class="hljs-code">	程序加载器先判断文件是否是ELF或者是否有Shebang --&gt;
</span>
<span class="hljs-code">	都不符合则遍历binfmt_misc规则，根据每条规则检查文件内容 --&gt;
</span>
<span class="hljs-code">	找到第一条匹配的规则后，加载器修改命令行参数，把A传递给interpreter --&gt;
</span>
<span class="hljs-code">	加载器加载并运行interpreter
</span></code></pre>
<p>整个链路非常直观，而且你可以发现这个规则是允许递归的，也就是说interpreter也可以是用<code>binfmt_misc</code>注册的自定义可执行文件。不过实际生产中很少有人这么做，因为调用链越长越容易出问题，排查错误也会变得更困难。</p>
<p>对于传递给interpreter和实际可执行文件的参数会这么处理，我们可以写个小程序来看下：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">	import (
</span>
<span class="hljs-code">	    "fmt"
</span>
<span class="hljs-code">	    "os"
</span>
<span class="hljs-code">	)
</span>
<span class="hljs-code">	 
</span>
<span class="hljs-code">	func main() {
</span>
<span class="hljs-code">	    for i, arg := range os.Args {
</span>
<span class="hljs-code">	        fmt.Printf("idx: %d, arg: %s\n", i, arg)
</span>
<span class="hljs-code">	    }
</span>
<span class="hljs-code">	}
</span></code></pre>
<p>编译这个程序并起名叫myinterp，然后注册规则<code>echo ':myinterp:E::myi::/home/apocelipes/myinterp:' &gt; /proc/sys/fs/binfmt_misc/register</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.falvce.com%2F" target="_blank" title="https://www.falvce.com/" ref="nofollow noopener noreferrer">www.falvce.com/</a> 。</p>
<p>现在我们创建一个空的<code>test.myi</code>，然后运行：</p>
<pre><code class="hljs language-yaml" lang="yaml">	<span class="hljs-string">$</span> <span class="hljs-string">./test.myi</span>

	 

	<span class="hljs-attr">idx:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">/home/apocelipes/myinterp</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">./test.myi</span>

	

	<span class="hljs-string">$</span> <span class="hljs-string">./test.myi</span> <span class="hljs-string">--test1</span> <span class="hljs-string">--test2</span>

	 

	<span class="hljs-attr">idx:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">/home/apocelipes/myinterp</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">./test.myi</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">--test1</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">3</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">--test2</span>
</code></pre>
<p>可以看到我们的程序被调用了，被执行的可执行文件的路径会被作为<code>argv[1]</code>传入，其余的命令行选项会被依次传进来。</p>
<p>flags的<code>P</code>和<code>O</code>会对命令行选项产生影响，首先是<code>P</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml">	<span class="hljs-string">$</span> <span class="hljs-string">test.myi</span> <span class="hljs-string">--test1</span> <span class="hljs-string">--test2</span>

	 

	<span class="hljs-attr">idx:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">/home/apocelipes/myinterp</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">/home/apocelipes/go/bin/test.myi</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">2</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">test.myi</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">3</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">--test1</span>

	<span class="hljs-attr">idx:</span> <span class="hljs-number">4</span><span class="hljs-string">,</span> <span class="hljs-attr">arg:</span> <span class="hljs-string">--test2</span>
</code></pre>
<p>我们把<code>test.myi</code>移动到了<code>$PATH</code>中，这样就不需要指定完整路径了，现在在启用<code>P</code>标志时加载器会把被执行文件的完整路径添加在<code>argv[1]</code>的位置上。这是为了方便我们的解释器可以获取被执行文件的路径从而进行处理。</p>
<p><code>O</code>的演示比较复杂，因为它并不会影响命令行参数，而是通过auxv传递打开的描述符，所以我们用c++重写解释器：</p>
<pre><code class="hljs language-c" lang="c">	<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>

	<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span>

	<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/auxv.h&gt;</span></span>

	<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span>

	 

	<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>

	{

	    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"pid: "</span> &lt;&lt; getpid() &lt;&lt; <span class="hljs-string">"\n"</span>;

	    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> execfd = getauxval(AT_EXECFD);

	    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"fd: "</span> &lt;&lt; execfd &lt;&lt; <span class="hljs-string">"\n"</span>;

	 

	    <span class="hljs-keyword">auto</span> file = fdopen(execfd, <span class="hljs-string">"r"</span>);

	    <span class="hljs-keyword">if</span> (file == nullptr) {

	        <span class="hljs-built_in">std</span>::perror(<span class="hljs-string">"fdopen"</span>);

	        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

	    }

	    <span class="hljs-type">char</span> buf[<span class="hljs-number">1024</span>] = {<span class="hljs-number">0</span>};

	    <span class="hljs-built_in">std</span>::fgets(buf, <span class="hljs-number">1024</span>, file);

	    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"fd data: "</span> &lt;&lt; buf;

	    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">std</span>::fclose(file) != <span class="hljs-number">0</span>) {

	        <span class="hljs-built_in">std</span>::perror(<span class="hljs-string">"fclose"</span>);

	        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;

	    }

	}
</code></pre>
<p>我们用<code>fdopen</code>和<code>fclose</code>来检验收到的fd是否有效，并读取其内容：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">	$ </span><span class="bash"><span class="hljs-built_in">echo</span> -1 &gt; /proc/sys/fs/binfmt_misc/myinterp</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">':myinterp:E::myi::/home/apocelipes/myinterp:O'</span> &gt; /proc/sys/fs/binfm</span>

	t_misc/register
<span class="hljs-meta prompt_">
	$ </span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'test data'</span> &gt; /home/apocelipes/go/bin/test.myi</span>
<span class="hljs-meta prompt_">
	$ </span><span class="bash">test.myi --test1 --test2</span>

	 

	pid: 4821

	fd: 3

	fd data: test data
</code></pre>
<p>程序没有报错说明fd是有效的，读取到的内容也是我们之前写入的，值为3通常意味着这是进程中除了标准输入输出之外第一个打开的文件。</p>
<p>到此我想大家应该都了解<code>binfmt_misc</code>的工作原理了。不过在介绍应用之前，我还要先介绍一个和它很相似的东西——Shebang。</p>
<h2 data-id="heading-3">Shebang</h2>
<p>Shebang中文名又叫“释伴”，是写在脚本文件开头第一行的特殊指令，可以让操作系统调用特定的程序来执行这个脚本。它不光听着和binfmt_misc很像，其实Shebang的实现代码也在binfmt_misc里。不过两者终究只是有点像，具体行为上还是有区别的。</p>
<p>Shebang必须出现在脚本文件的开头，以<code>#!</code>开始，以换行符结束，具体格式是：<code>#![零个一个或多个空格]/path/to/interpreter 参数1 参数2 ...\n</code>。</p>
<p>程序加载器会找到路径指定的解释器，然后把脚本文件所在路径添加在其他参数之后传递给解释器。我们接着用前面golang写的小程序作为解释器，这回我们编写一个带有Shebang的脚本：</p>
<pre><code class="hljs language-bash" lang="bash">	<span class="hljs-comment">#! /home/apocelipes/myinterp --test1 --test2</span>

	<span class="hljs-built_in">echo</span> hello
</code></pre>
<p>运行效果如下：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">	$ chmod +x ./myscript
</span>
<span class="hljs-code">	$ ./myscript
</span>
<span class="hljs-code">	 
</span>
<span class="hljs-code">	idx: 0, arg: /home/apocelipes/myinterp
</span>
<span class="hljs-code">	idx: 1, arg: --test1 --test2
</span>
<span class="hljs-code">	idx: 2, arg: ./myscript
</span></code></pre>
<p>可以看到所有参数合并成了一个，并作为第一个参数传递给了解释器，脚本路径则是最后一个参数。解释器的参数选项是可以省略的，这时候解释器之后收到一个参数也就是脚本所在路径。因此编写解释器的时候要根据参数数量自己处理命令行选项。</p>
<p>shebang总体上比binfmt_misc简单很多，也是日常工作中使用最多的。</p>
<p>一个把Shebang利用到极致的例子是字节跳动编写的ffmpeg rust绑定库里的脚本：</p>
<pre><code class="hljs language-rust" lang="rust">	#!/bin/sh

	<span class="hljs-meta">#![allow(unused_attributes)]</span> <span class="hljs-comment">/*

	OUT=/tmp/tmp &amp;&amp; rustc "$0" -0 ${0UT} &amp;&amp; exec ${OUT} $@ || exit $? #*/</span>

	 

	<span class="hljs-keyword">use</span> std::process::Command;

	<span class="hljs-keyword">use</span> std::io::<span class="hljs-type">Result</span>;

	<span class="hljs-keyword">use</span> std::path::PathBuf;

	<span class="hljs-keyword">use</span> std::fs;

	 

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">mkdir</span>(dir_name: &amp;<span class="hljs-type">str</span>) →&gt; <span class="hljs-type">Result</span>&lt;()&gt; {

	    fs::<span class="hljs-title function_ invoke__">create_dir</span>(dir_name)

	}

	 

	<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span> (https:<span class="hljs-comment">//www.falvce.com/) {</span>

	    <span class="hljs-comment">// 省略</span>

	}
</code></pre>
<p>这是合法的rust代码，rust编译器会忽略Shebang，其余的代码都是合法的rust代码或者注释。同时这也是合法的shell脚本，因为shell是解释执行的，在执行到第三行后程序要么exit退出执行要么exec切换到编译好的程序上了，尽管后面的rust内容都不是合法的shell代码，但只要不执行到它们脚本就不会报错。这是一个非常巧妙的利用Shebang把rust当脚本使用的例子。</p>
<p>当然，通过<code>binfmt_misc</code>这个例子可以进一步被简化，但Shebang的可移植性更强。</p>
<h2 data-id="heading-4">binfmt_misc的应用</h2>
<p><code>binfmt_misc</code>的用处很多，比如前文提到的wine等模拟器会注册类似<code>:DOSWin:M::MZ::/usr/bin/wine:</code>的规则，让操作系统可以执行exe程序。Ubuntu也会注册<code>Python3.x</code>之类的规则，让python解释器去运行<code>.pyc</code>文件。</p>
<p>除此之外binfmt_misc还有一些妙用。比如可以让我们把<code>.go</code>代码文件当作脚本来运行。</p>
<p>首先我们写一个脚本编译通过命令行参数传入的代码生成可执行文件，然后再执行这个编译出来的程序：</p>
<pre><code class="hljs language-bash" lang="bash">	<span class="hljs-comment">#!/bin/bash</span>

	filename=<span class="hljs-string">"/tmp/go-<span class="hljs-variable">${RANDOM}</span>.bin"</span>

	<span class="hljs-comment"># $1 是传入的脚本所在路径，我们的注册规则需要使用P flag</span>

	go build -o <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>

	<span class="hljs-comment"># 跳过前两个参数，第一个参数的可执行文件路径，第二个参数是可执行文件在命令行里的名字，剩下的才是要传递给脚本的参数</span>

	<span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${@:3}</span>"</span>

	<span class="hljs-built_in">rm</span> <span class="hljs-string">"<span class="hljs-variable">$filename</span>"</span>
</code></pre>
<p>脚本起名叫<code>mygointerp</code>，然后我们给<code>.go</code>文件注册一条规则：<code>:golang-script:E::go::/home/apocelipes/mygointerp:P</code>。</p>
<p>最后写一个简单的go脚本：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">	import (
</span>
<span class="hljs-code">	    "fmt"
</span>
<span class="hljs-code">	    "os"
</span>
<span class="hljs-code">	)
</span>
<span class="hljs-code">	 
</span>
<span class="hljs-code">	func main() {
</span>
<span class="hljs-code">	    fmt.Println("script start")
</span>
<span class="hljs-code">	    for i, arg := range os.Args {
</span>
<span class="hljs-code">	        fmt.Printf("idx: %d, arg: %s\n", i, arg)
</span>
<span class="hljs-code">	    }
</span>
<span class="hljs-code">	    fmt.Println("script end")
</span>
<span class="hljs-code">	}
</span></code></pre>
<p>运行：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">	$ chmod +x goscript.go
</span>
<span class="hljs-code">	$ ./goscript.go --test1 --test2
</span>
<span class="hljs-code">	 
</span>
<span class="hljs-code">	script start
</span>
<span class="hljs-code">	idx: 0, arg: /tmp/go-21972.bin
</span>
<span class="hljs-code">	idx: 1, arg: --test1
</span>
<span class="hljs-code">	idx: 2, arg: --test2
</span>
<span class="hljs-code">	script end
</span></code></pre>
<p>运行良好</p>
<p>我知道，大多数时候使用<code>go run</code>会更简单，这个例子只是用来说明编译型语言的代码文件也可以通过<code>binfmt_misc</code>机制像脚本一样方便地使用。</p>
<p>相比上一节提到的rust+Shebang的例子，这个利用<code>binfmt_misc</code>的例子可以让开发者专注于go代码本身，不需要在同一份源代码文件中兼顾两种不同的语言，缺点是需要额外的配置且可移植性不如Shebang。</p>
<h2 data-id="heading-5">总结</h2>
<p><code>binfmt_misc</code>机制提供了用户自定义可执行文件的能力，善加利用可有效提升生产力。</p>
<p>但如果滥用则会带来安全问题，病毒和木马会获得更多感染系统的机会。</p>
<p>最后如果规则注册太多，不仅排查问题会变得困难，还会拖慢程序加载执行的速度，所以凡事都有度，切不可滥用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[写Tailwind CSS像在写屎山？这锅该不该它背]]></title>    <link>https://juejin.cn/post/7578683148209946676</link>    <guid>https://juejin.cn/post/7578683148209946676</guid>    <pubDate>2025-12-01T07:52:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578683148209946676" data-draft-id="7578683148209930292" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="写Tailwind CSS像在写屎山？这锅该不该它背"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-12-01T07:52:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大前端历险记"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            写Tailwind CSS像在写屎山？这锅该不该它背
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大前端历险记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:52:11.000Z" title="Mon Dec 01 2025 07:52:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我上次在群里吐槽Tailwind，被几个大佬围攻了：“现在还在写传统CSS的怕不是还在用jQuery？”、“都2025年了还用BEM？”，整得我都不敢说话了。</p>
<p>作为一个前端搬砖工，我从Nodejs到React再到Vue都踩过一遍坑，今天就跟大伙儿聊聊这个让我又爱又恨的Tailwind。</p>
<h2 data-id="heading-0">一、为什么我觉得Tailwind有时候真的很操蛋</h2>
<h3 data-id="heading-1">1. 这HTML还能看吗？</h3>
<p>这是我第一次看到Tailwind代码的反应：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex flex-col md:flex-row items-center justify-between p-4 md:p-6 lg:p-8 bg-white dark:bg-gray-900 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 还有一堆嵌套div，每个都带着几十个类名 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>同事问我：“这坨代码什么意思？”我看了半天说：“一个卡片，会动，能响应式，深色模式适配了……”但我心里想的是：这TM跟当年在HTML里写<code>style="color: red; font-size: 14px;"</code>有啥本质区别？</p>
<h3 data-id="heading-2">2. 接手别人的Tailwind项目有多痛苦</h3>
<p>上个月接了个离职同事的项目，打开一看差点没背过气去：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;div className={<span class="hljs-string">`px-<span class="hljs-subst">${size === <span class="hljs-string">'large'</span> ? <span class="hljs-number">6</span> : size === <span class="hljs-string">'small'</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">4</span>}</span> py-<span class="hljs-subst">${hasIcon ? <span class="hljs-number">3</span> : <span class="hljs-number">2</span>}</span> <span class="hljs-subst">${variant === <span class="hljs-string">'primary'</span> ? <span class="hljs-string">'bg-blue-500'</span> : <span class="hljs-string">'bg-gray-200'</span>}</span> <span class="hljs-subst">${isDisabled ? <span class="hljs-string">'opacity-50 cursor-not-allowed'</span> : <span class="hljs-string">'hover:opacity-90'</span>}</span>`</span>}&gt;
  {<span class="hljs-comment">/* 还有50行类似的代码 */</span>}
&lt;/div&gt;
</code></pre>
<p>这种动态拼接类名的操作，让我调试的时候想砸键盘。查了半天发现有个按钮在某种状态下padding不对，原来是<code>px-${size}</code>这种骚操作导致的。</p>
<h3 data-id="heading-3">3. 这玩意真的能提高开发效率吗？</h3>
<p>老板跟我说：“用Tailwind开发速度快啊！”但真实情况是：</p>
<ul>
<li>边写边查文档：<code>m-4</code>和<code>p-4</code>到底哪个是margin哪个是padding？<code>mt-4</code>和<code>mr-4</code>又是啥？</li>
<li>遇到复杂布局：用flex还是grid？Tailwind的grid类名又长又难记</li>
<li>调个细节样式：想微调一个阴影，得查半天文档才知道<code>shadow-lg</code>和<code>shadow-xl</code>的区别</li>
</ul>
<p>有这查文档的时间，我CSS早写完了。</p>
<h2 data-id="heading-4">二、但为什么大佬们都在吹爆Tailwind？</h2>
<h3 data-id="heading-5">1. 等我真的用起来之后……</h3>
<p>两个月后，当我对常用类名烂熟于心后，发现有些场景真香：</p>
<p><strong>快速原型开发</strong>：产品经理站我身后：“这里改个间距，那里调个颜色，这个按钮hover效果换一下……”</p>
<p>以前：切到CSS文件 -&gt; 找到对应的类 -&gt; 修改 -&gt; 切回来预览 -&gt; 重复
现在：直接在HTML里改几个类名 -&gt; 实时预览</p>
<p><strong>设计一致性</strong>：以前团队里每个开发者对“大间距”的理解都不一样，有人写<code>margin: 20px</code>，有人写<code>margin: 24px</code>，还有人写<code>margin: 1.5rem</code>。现在统一用<code>m-5</code>或<code>m-6</code>，UI终于统一了。</p>
<h3 data-id="heading-6">2. 性能确实牛逼</h3>
<p>我原来不信，直到对比了项目打包后的CSS文件大小：</p>
<ul>
<li>之前的项目（手写CSS）：<code>main.css</code> 87KB</li>
<li>现在的项目（Tailwind + JIT）：<code>main.css</code> 12KB</li>
</ul>
<p>因为Tailwind只生成你用到的样式，不会有未使用的CSS代码。</p>
<h3 data-id="heading-7">3. 再也不用想类名了</h3>
<p>还记得那些年被BEM命名支配的恐惧吗？</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {}
<span class="hljs-selector-class">.card__header</span> {}
<span class="hljs-selector-class">.card__header--active</span> {}
<span class="hljs-selector-class">.card__body</span> {}
<span class="hljs-selector-class">.card__footer</span> {}
<span class="hljs-selector-class">.card__footer__button</span> {}
<span class="hljs-selector-class">.card__footer__button--disabled</span> {}
</code></pre>
<p>现在？直接写样式就行了，不用再想<code>header-wrapper-inner-content</code>这种傻逼名字了。</p>
<h2 data-id="heading-8">三、我从抗拒到真香的转变</h2>
<p>转折点是我开始<strong>用正确的方式写Tailwind</strong>。</p>
<h3 data-id="heading-9">错误示范 ❌</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 直接把所有类名堆在组件里</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BadButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"</span>&gt;</span>
      提交
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-10">正确姿势 ✅</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 1. 先封装基础组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params">{ 
  children, 
  variant = <span class="hljs-string">'primary'</span>,
  size = <span class="hljs-string">'medium'</span>,
  fullWidth = <span class="hljs-literal">false</span> 
}</span>) {
  <span class="hljs-keyword">const</span> baseClasses = <span class="hljs-string">"font-bold rounded transition-colors"</span>;
  
  <span class="hljs-keyword">const</span> variants = {
    <span class="hljs-attr">primary</span>: <span class="hljs-string">"bg-blue-500 hover:bg-blue-700 text-white"</span>,
    <span class="hljs-attr">secondary</span>: <span class="hljs-string">"bg-gray-200 hover:bg-gray-300 text-gray-800"</span>,
    <span class="hljs-attr">danger</span>: <span class="hljs-string">"bg-red-500 hover:bg-red-700 text-white"</span>
  };
  
  <span class="hljs-keyword">const</span> sizes = {
    <span class="hljs-attr">small</span>: <span class="hljs-string">"py-1 px-3 text-sm"</span>,
    <span class="hljs-attr">medium</span>: <span class="hljs-string">"py-2 px-4"</span>,
    <span class="hljs-attr">large</span>: <span class="hljs-string">"py-3 px-6 text-lg"</span>
  };
  
  <span class="hljs-keyword">const</span> widthClass = fullWidth ? <span class="hljs-string">"w-full"</span> : <span class="hljs-string">""</span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">baseClasses</span>} ${<span class="hljs-attr">variants</span>[<span class="hljs-attr">variant</span>]} ${<span class="hljs-attr">sizes</span>[<span class="hljs-attr">size</span>]} ${<span class="hljs-attr">widthClass</span>}`}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 2. 使用 cva 库管理变体（更优雅）</span>
<span class="hljs-keyword">import</span> { cva } <span class="hljs-keyword">from</span> <span class="hljs-string">'class-variance-authority'</span>;

<span class="hljs-keyword">const</span> buttonVariants = <span class="hljs-title function_">cva</span>(
  <span class="hljs-string">"font-bold rounded transition-colors"</span>, <span class="hljs-comment">// 基础样式</span>
  {
    <span class="hljs-attr">variants</span>: {
      <span class="hljs-attr">variant</span>: {
        <span class="hljs-attr">primary</span>: <span class="hljs-string">"bg-blue-500 hover:bg-blue-700 text-white"</span>,
        <span class="hljs-attr">secondary</span>: <span class="hljs-string">"bg-gray-200 hover:bg-gray-300 text-gray-800"</span>,
      },
      <span class="hljs-attr">size</span>: {
        <span class="hljs-attr">small</span>: <span class="hljs-string">"py-1 px-3 text-sm"</span>,
        <span class="hljs-attr">medium</span>: <span class="hljs-string">"py-2 px-4"</span>,
      }
    },
    <span class="hljs-attr">defaultVariants</span>: {
      <span class="hljs-attr">variant</span>: <span class="hljs-string">"primary"</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">"medium"</span>
    }
  }
);

<span class="hljs-comment">// 3. 实际使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">GoodButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>&gt;</span>
      提交
    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-11">四、什么时候该用，什么时候不该用</h2>
<h3 data-id="heading-12">赶紧用起来吧 👍</h3>
<ol>
<li><strong>新项目，尤其是React/Vue/Svelte项目</strong>：组件化能很好解决Tailwind的可维护性问题</li>
<li><strong>需要统一设计规范</strong>：设计系统配好了，大家就按这个来，别TM再自己发挥了</li>
<li><strong>内部管理系统、后台项目</strong>：快速迭代，老板天天改需求，这种场景Tailwind无敌</li>
<li><strong>团队协作项目</strong>：不用再解释为什么这里用<code>margin-top: 8px</code>而不是<code>10px</code></li>
</ol>
<h3 data-id="heading-13">算了，别用了 ❌</h3>
<ol>
<li><strong>静态小网站</strong>：就几个页面，写点CSS完事了，别折腾</li>
<li><strong>老项目迁移</strong>：除非你想加班加到死</li>
<li><strong>完全不懂CSS的新手</strong>：Tailwind不是CSS的替代品，它是工具。连CSS盒模型都不懂就用Tailwind，等于不会开车就用自动驾驶</li>
<li><strong>设计师天马行空</strong>：如果你们设计师每个页面风格都不一样，用Tailwind配置会把你逼疯</li>
</ol>
<h2 data-id="heading-14">五、我总结的血泪经验</h2>
<ol>
<li><strong>不要直接在JSX里堆类名</strong>：这是所有屎山的源头！一定一定要封装成组件</li>
<li><strong>配置好自己的设计系统</strong>：别用默认配置，根据项目需求配一套自己的<code>tailwind.config.js</code></li>
<li><strong>善用 @apply</strong>：重复出现的样式组合，用<code>@apply</code>提取</li>
</ol>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 在CSS文件中 */</span>
<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-keyword">@apply</span> bg-blue-<span class="hljs-number">500</span> <span class="hljs-attribute">hover</span>:bg-blue-<span class="hljs-number">700</span> text-white font-bold py-<span class="hljs-number">2</span> px-<span class="hljs-number">4</span> rounded;
}
</code></pre>
<ol start="4">
<li><strong>结合现代工具链</strong>：<code>clsx</code>处理条件类名，<code>tailwind-merge</code>解决类名冲突</li>
<li><strong>定期重构</strong>：发现重复的样式组合就抽象，别懒！</li>
</ol>
<h2 data-id="heading-15">最后说句实话</h2>
<p>用不用Tailwind，其实跟你用什么技术关系不大，关键看你怎么用。</p>
<p>那些说Tailwind垃圾的，多半是看到了滥用它的项目；那些吹爆Tailwind的，多半是用对了方法。</p>
<p>就像当年大家吵jQuery和原生JS，吵React和Vue一样，最后你会发现：<strong>工具没有对错，只有适不适合。</strong> 牛逼的程序员用记事本都能写出好代码，菜鸡用再牛逼的框架也能写出屎山。</p>
<p>所以，别吵了，赶紧去写代码吧。老板又改需求了，今天还得加班呢。</p>
<hr/>
<p>关注公众号" <strong>大前端历险记</strong>"，掌握更多前端开发干货姿势！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战复盘：10W+ QPS 秒杀架构演进（Redis Lua + 分片 + RabbitMQ）]]></title>    <link>https://juejin.cn/post/7578402574652538932</link>    <guid>https://juejin.cn/post/7578402574652538932</guid>    <pubDate>2025-12-01T07:59:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578402574652538932" data-draft-id="7578693994367959040" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战复盘：10W+ QPS 秒杀架构演进（Redis Lua + 分片 + RabbitMQ）"/> <meta itemprop="keywords" content="架构,Java,设计"/> <meta itemprop="datePublished" content="2025-12-01T07:59:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户8491371754716"/> <meta itemprop="url" content="https://juejin.cn/user/2744800640504071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战复盘：10W+ QPS 秒杀架构演进（Redis Lua + 分片 + RabbitMQ）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2744800640504071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户8491371754716
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:59:27.000Z" title="Mon Dec 01 2025 07:59:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>前言</strong></p>
<p>面试中经常被问到：“你做过最高并发的系统是什么？当面对 <strong>10W+ QPS</strong> 的瞬时流量，普通的“查库 -&gt; 判断 -&gt; 扣减 -&gt; 更新”逻辑会让数据库瞬间熔断。“扛住高并发”从来不是某一项技术的单打独斗，而是一场蓄谋已久的分层防御战。</p>
<p>本文将基于 <strong>Redis Lua + 库存分片 + RabbitMQ</strong> 的核心架构，深度拆解其中的设计细节与那些差点踩翻的“坑”。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、 全局视角：流量漏斗架构</h2>
<p>如果你直接问我：“Redis 怎么扛 10W QPS？”，我会先制止你。因为在请求到达 Redis 之前，必须先经过层层削减。我们将架构设计为一个漏斗：</p>
<ol>
<li>
<p><strong>CDN/静态资源</strong>：拦截 <strong>90%</strong> 的页面流量（图片、CSS、JS）。</p>
</li>
<li>
<p><strong>本地缓存 (Caffeine)</strong> ：拦截 <strong>60%</strong> 的读请求（活动配置、规则）。</p>
<ul>
<li><em>架构思考</em>：如何保证一致性？我们利用 MQ 广播机制（类似 Spring Cloud Bus），当后台修改配置时，通知所有节点失效本地缓存。</li>
</ul>
</li>
<li>
<p><strong>Redis 集群</strong>：处理核心的“写”请求（扣库存、发令牌）。</p>
</li>
<li>
<p><strong>RabbitMQ</strong>：流量削峰，异步解耦。</p>
</li>
<li>
<p><strong>MySQL 数据库</strong>：最终落单，保证账目兜底。</p>
</li>
</ol>
<p><strong>本文核心聚焦于最凶险的环节：Redis 高并发扣减与数据一致性。</strong></p>
<hr/>
<h2 data-id="heading-1">二、 核心攻坚：Redis Lua 脚本与原子性</h2>
<p>在秒杀场景下，传统的 Java 代码（即使使用 Redisson 分布式锁）存在两个致命问题：</p>
<ol>
<li><strong>性能损耗</strong>：获取锁、判断、扣减、释放锁，至少 4 次网络 RTT。</li>
<li><strong>锁竞争</strong>：高并发下线程阻塞严重，CPU 上下文切换频繁。</li>
</ol>
<h3 data-id="heading-2">1. 战术核武器：Lua 脚本</h3>
<p>为了极致性能，我将“查询库存”与“扣减库存”的逻辑下沉到 Redis 服务端，封装为一个 Lua 脚本。</p>
<p><strong>收益</strong>：</p>
<ul>
<li><strong>原子性</strong>：Redis 单线程模型保证了脚本执行期间，不会有任何其他命令插入，天然防止超卖。</li>
<li><strong>零 RTT</strong>：将多次网络通信压缩为 <strong>1 次</strong>。</li>
</ul>
<p><strong>核心 Lua 逻辑演示：</strong></p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- keys[1]: 库存Key, keys[2]: 用户历史记录Key</span>
<span class="hljs-comment">-- argv[1]: 用户ID, argv[2]: 活动ID</span>
<span class="hljs-keyword">local</span> stock_key = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> user_history_key = KEYS[<span class="hljs-number">2</span>]
<span class="hljs-keyword">local</span> user_id = ARGV[<span class="hljs-number">1</span>]
​
<span class="hljs-comment">-- 1. 校验是否重复领取</span>
<span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"SISMEMBER"</span>, user_history_key, user_id) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span> <span class="hljs-comment">-- 重复领取</span>
<span class="hljs-keyword">end</span>
​
<span class="hljs-comment">-- 2. 校验库存</span>
<span class="hljs-keyword">local</span> stock = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">"GET"</span>, stock_key))
<span class="hljs-keyword">if</span> stock &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-2</span> <span class="hljs-comment">-- 库存不足</span>
<span class="hljs-keyword">end</span>
​
<span class="hljs-comment">-- 3. 核心扣减逻辑</span>
redis.call(<span class="hljs-string">"DECR"</span>, stock_key)
redis.call(<span class="hljs-string">"SADD"</span>, user_history_key, user_id)
<span class="hljs-keyword">return</span> <span class="hljs-number">1</span> <span class="hljs-comment">-- 抢购成功</span>
</code></pre>
<h3 data-id="heading-3">2. 致命陷阱：集群下的 CROSSSLOT</h3>
<p>当你自信满满地上线，可能会遇到一个报错：</p>
<p>CROSSSLOT Keys in request don't hash to the same slot</p>
<p><strong>原因</strong>：Redis Cluster 模式下，Key 根据 CRC16 算法分配槽位。若 Lua 脚本同时操作 <code>activity_stock</code>（A节点）和 <code>user_history</code>（B节点），Redis 为了保证事务安全性，会直接拒绝跨 Slot 执行。</p>
<p>解法：使用Hash Tag {}</p>
<p>我们在 Key 的设计上做了妥协，使用 Hash Tag 强制路由：</p>
<ul>
<li>库存 Key：<code>activity:{1001}:stock</code></li>
<li>用户 Key：<code>user:{1001}:8888</code></li>
</ul>
<p>Redis 只会计算 <code>{}</code> 内部的字符串（即 <code>1001</code>）的 Hash，确保它们必定落在同一个redis节点。</p>
<hr/>
<h2 data-id="heading-4">三、 极限挑战：热点 Key 分片 (Sharding)</h2>
<p>使用 Hash Tag 虽然解决了原子性，但引入了新问题：数据倾斜。</p>
<p>如果某个活动极其火爆，所有请求都打向同一个 Redis 节点，该节点网卡可能被打满（通常单节点极限在 8W-10W QPS），成为系统瓶颈。</p>
<h3 data-id="heading-5">架构升级：库存分片方案</h3>
<p>为了突破单节点性能极限，我们采用了 <strong>库存分片 (Stock Sharding)</strong> 策略。</p>
<p>设计思路：</p>
<p>将 10,000 个库存拆分为 10 份，分散到 stock:0 到 stock:9 这 10 个 Key 中，且去掉 Hash Tag，让它们自然散落在集群的不同节点上。</p>
<p><strong>Java 侧逻辑：</strong></p>
<ol>
<li><strong>随机路由</strong>：请求进来，随机生成 <code>index = Random(0-9)</code>。</li>
<li><strong>扣减</strong>：去操作对应的子 Key <code>stock:{index}</code>。</li>
<li><strong>兜底重试</strong>：如果该分片库存不足，脚本返回特定错误码。</li>
</ol>
<p>⚠️ 避坑提醒：</p>
<p>这里有一个巨大的风险点。如果采用无限轮询重试（尝试下一个分片），在库存快耗尽时，客户端会发起指数级增长的请求，引发“惊群效应”。</p>
<p>建议策略：</p>
<ul>
<li><strong>限制重试次数</strong>：最多重试 3 次，失败则直接返回“哎呀，太火爆了”。</li>
<li><strong>Fail Fast</strong>：在超高并发下，宁可误杀（告诉用户没货了），也不要为了卖完最后几个库存把系统搞挂。</li>
</ul>
<hr/>
<h2 data-id="heading-6">四、 稳定性保障：分布式锁的“红与黑”</h2>
<p>Lua 虽然好用，但复杂的业务逻辑（如涉及第三方调用）依然需要分布式锁（Redisson）。</p>
<h3 data-id="heading-7">1. Watchdog (看门狗) 的真相</h3>
<p>很多同学只知道它能续期，但不知道生效条件。</p>
<ul>
<li><strong>机制</strong>：Redisson 基于 Netty 的 HashedWheelTimer（时间轮），默认每 10s 检查一次，将 30s 的锁续期。</li>
<li><strong>避坑</strong>：如果你手动调用 <code>lock.lock(10, TimeUnit.SECONDS)</code> 指定了时间，<strong>看门狗会自动失效！</strong> 业务跑不完锁就会丢。</li>
</ul>
<h3 data-id="heading-8">2. 拒绝 RedLock</h3>
<p>关于“主从切换导致锁丢失”的问题，面试中常问 RedLock。</p>
<p>我的观点：在千万级流量下，不推荐使用 RedLock。</p>
<ul>
<li><strong>理由</strong>：性能开销太大，且依赖 NTP 时间同步，并不绝对安全（Martin Kleppmann 与 Redis 作者有过著名辩论）。</li>
<li><strong>替代方案</strong>：利用<strong>MySQL 唯一索引</strong>做最终兜底。Redis 偶尔丢锁，让请求穿透到 DB，DB 会利用 Unique Key 报错，保证数据绝不脏写。</li>
</ul>
<hr/>
<h2 data-id="heading-9">五、 数据一致性：RabbitMQ 的“三角维稳”策略</h2>
<p>扣减了 Redis 库存，怎么同步给 MySQL？</p>
<p>原则：Redis 是高并发的“令牌桶”，MySQL 是最终的“账本”。我们采用 RabbitMQ 做异步削峰。但是，RabbitMQ 并不是把消息丢进去就万事大吉了。</p>
<p>在 10W QPS 下，任何网络抖动都可能导致消息丢失。我们构建了 <strong>“发送端 - 路由层 - 消费端”</strong> 的三角维稳策略。</p>
<h3 data-id="heading-10">1. 发送端可靠性：Confirm 与 Return</h3>
<p>Spring Boot 中默认的 <code>rabbitTemplate</code> 是“发后即忘”的。为了知道消息到底有没有到达 Broker，我们需要开启两个开关：</p>
<ul>
<li><strong>Publisher-Confirm</strong>：Broker 收到消息后的回调（无论成功失败）。</li>
<li><strong>Publisher-Return</strong>：消息到达 Exchange 但<strong>未路由到 Queue</strong> 时的回调（常用于配置错误排查）。</li>
</ul>
<p><strong>配置开启 (application.yml)：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span> <span class="hljs-comment"># 开启发送确认</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span>            <span class="hljs-comment"># 开启路由失败回调</span>
    <span class="hljs-attr">template:</span>
      <span class="hljs-attr">mandatory:</span> <span class="hljs-literal">true</span>                  <span class="hljs-comment"># 消息路由失败时，返回给发送者而不是直接丢弃</span>
</code></pre>
<p>实战代码封装：</p>
<p>我们需要自定义 RabbitTemplate，注入回调逻辑。注意：这里必须利用 CorrelationData 来绑定业务 ID，否则报错了你都不知道是哪一个订单错了。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostConstruct</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initRabbitTemplate</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. 确认回调：消息是否到达 Exchange</span>
    rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt; {
        <span class="hljs-keyword">if</span> (ack) {
            <span class="hljs-comment">// log.info("消息发送成功: {}", correlationData.getId());</span>
        } <span class="hljs-keyword">else</span> {
            log.error(<span class="hljs-string">"消息发送失败: {}, 原因: {}"</span>, correlationData.getId(), cause);
            <span class="hljs-comment">// 🚨 核心补救：根据 correlationData.getId() (订单号) 进行 Redis 库存回滚或重试</span>
            rollbackStock(correlationData.getId());
        }
    });
​
    <span class="hljs-comment">// 2. 回退回调：消息是否到达 Queue (通常因路由键写错导致)</span>
    rabbitTemplate.setReturnsCallback(returned -&gt; {
        log.error(<span class="hljs-string">"消息丢失: exchange={}, route={}, replyText={}"</span>,
                returned.getExchange(), returned.getRoutingKey(), returned.getReplyText());
        <span class="hljs-comment">// 🚨 报警 + 人工介入，此类通常是代码配置错误</span>
    });
}
</code></pre>
<h3 data-id="heading-11">2. 消费端可靠性：ACK 与 QoS</h3>
<p>消费者端最大的坑在于<strong>默认的自动确认 (AutoACK)</strong> 。一旦消费者接收到消息（还没处理业务），RabbitMQ 就自动删除了。如果此时 JVM 宕机或数据库事务回滚，消息就永久丢失了（订单消失）。</p>
<p><strong>黄金法则：</strong></p>
<ol>
<li><strong>开启手动 ACK (<code>AcknowledgeMode.MANUAL</code>)</strong> 。</li>
<li><strong>设置 QoS (Prefetch Count)</strong> ：防止 RabbitMQ 一次性把几万条消息推给消费者，导致消费者内存溢出 (OOM)。</li>
</ol>
<p><strong>消费者实战代码：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RabbitListener(queues = "order.queue")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleOrder</span><span class="hljs-params">(Message message, Channel channel)</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">deliveryTag</span> <span class="hljs-operator">=</span> message.getMessageProperties().getDeliveryTag();
    <span class="hljs-type">String</span> <span class="hljs-variable">msgBody</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(message.getBody());
    <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> JSON.parseObject(msgBody, OrderDTO.class);
​
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. 幂等性校验 (防止网络抖动导致的重复消费)</span>
        <span class="hljs-keyword">if</span> (orderService.exists(order.getOrderId())) {
            <span class="hljs-comment">// 直接确认，不再处理</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">return</span>;
        }
​
        <span class="hljs-comment">// 2. 执行核心业务：落库、生成订单</span>
        orderService.createOrder(order);
​
        <span class="hljs-comment">// 3. 业务执行成功，手动 ACK</span>
        <span class="hljs-comment">// multiple=false: 仅确认当前这一条</span>
        channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
​
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"消费失败, orderId: {}"</span>, order.getOrderId(), e);
        
        <span class="hljs-comment">// 4. 异常处理策略</span>
        <span class="hljs-comment">// requeue=true: 重新放回队列尾部（慎用！如果一直报错会死循环）</span>
        <span class="hljs-comment">// requeue=false: 丢弃或进入死信队列 (DLQ)</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 建议：重试次数耗尽后，转发到死信队列，人工处理</span>
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>); 
        } <span class="hljs-keyword">catch</span> (IOException ex) {
            ex.printStackTrace();
        }
    }
}
</code></pre>
<h3 data-id="heading-12">3. 避坑指南：死信队列 (DLQ) 的必要性</h3>
<p>在 <code>catch</code> 代码块中，如果直接调用 <code>basicNack(requeue=true)</code>，一旦遇到代码逻辑 bug（比如空指针），这条消息会无限循环：<code>消费 -&gt; 报错 -&gt; 回队列 -&gt; 消费 -&gt; 报错...</code>，瞬间把 CPU 打满，且阻塞后续正常消息。</p>
<p>架构建议：</p>
<p>一定要配置 Dead Letter Exchange (DLQ)。当消息重试 N 次依然失败，或者显式拒绝 (requeue=false) 时，自动投递到死信队列。开发人员编写一个专门的 Consumer 监听死信队列，进行报警和人工修复。</p>
<hr/>
<h2 data-id="heading-13">六、 终极兜底：对账脚本</h2>
<p>即使做了上述所有工作，依然存在极端情况：Redis 扣了，JVM 瞬间宕机，MQ 没发出去。这就造成了“Redis 少了，DB 没单”的<strong>库存泄露</strong>。</p>
<p><strong>解法</strong>：T+N 分钟的对账脚本。</p>
<ul>
<li><strong>逻辑</strong>：定期比对 Redis 剩余库存 与 DB 订单数。</li>
<li><strong>修复</strong>：如果发现差额，自动将 Redis 库存加回去（或者回收到回收站），确保“肉烂在锅里”。</li>
</ul>
<hr/>
<h2 data-id="heading-14">七、 总结与思考</h2>
<p>扛住 10W+ QPS，本质上是在做 <strong>Trade-off (权衡)</strong> ：</p>
<ol>
<li>用 <strong>Lua + Redis</strong> 的原子性，换取了数据库的安全。</li>
<li>用 <strong>分片策略</strong> 的复杂度，换取了集群的水平扩展能力。</li>
<li>用 <strong>MQ 异步 + 对账</strong> 的延迟，换取了系统的整体吞吐量。</li>
</ol>
<p>架构没有银弹，只有针对业务场景的最优解。希望这篇复盘能给你在应对高并发设计时带来一些灵感。</p>
<p>最后的提问：</p>
<p>大家在生产环境中，处理 RabbitMQ 消息积压（Lag）通常用什么方案？临时扩容消费者还是丢弃非核心消息？欢迎在评论区留言讨论。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何用 vxe-table 实现粘贴数据自动进入新增行与新增列]]></title>    <link>https://juejin.cn/post/7578460753210212379</link>    <guid>https://juejin.cn/post/7578460753210212379</guid>    <pubDate>2025-12-01T08:00:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578460753210212379" data-draft-id="7578511778888974374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何用 vxe-table 实现粘贴数据自动进入新增行与新增列"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-01T08:00:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何用 vxe-table 实现粘贴数据自动进入新增行与新增列
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T08:00:20.000Z" title="Mon Dec 01 2025 08:00:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如何用 vxe-table 实现粘贴数据自动进入新增行与新增列，数据无限扩充，对于大部分业务操作场景，有时需要从 excel 复制数据并粘贴到表格中，由于粘贴的数据会列多于表格定义的行与列，多出的数据需要能支持自动新增与自行新增列，vxe-table提供非常简单的配置方式可以直接支持。</p>
<h2 data-id="heading-0">自动新增行</h2>
<p>当粘贴数据时，如果粘贴的行数超过表格的行数，可以通过 clip-config.isRowIncrement 自动新增临时行</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdc8eba0e04f49b39c14326f92b89e70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765180852&amp;x-signature=EgZOiWgLmeK5oqmBhnofMBAu0q8%3D" alt="table_clip_increment_rows" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
  <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">keepSource</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">columnConfig</span>: {
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">mouseConfig</span>: {
    <span class="hljs-attr">area</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否开启区域选取</span>
  },
  <span class="hljs-attr">areaConfig</span>: {
    <span class="hljs-attr">multiple</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否启用多区域选取功能</span>
  },
  <span class="hljs-attr">editConfig</span>: {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'cell'</span>, <span class="hljs-comment">// 单元格编辑模式</span>
    <span class="hljs-attr">trigger</span>: <span class="hljs-string">'dblclick'</span>, <span class="hljs-comment">// 双击单元格激活编辑状态</span>
    <span class="hljs-attr">showStatus</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 显示数据编辑状态</span>
  },
  <span class="hljs-attr">keyboardConfig</span>: {
    <span class="hljs-attr">isClip</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启复制粘贴</span>
    <span class="hljs-attr">isEdit</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启任意键进入编辑（功能键除外）</span>
    <span class="hljs-attr">isDel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启删除键功能</span>
    <span class="hljs-attr">isEsc</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否开启Esc键关闭编辑功能</span>
  },
  <span class="hljs-attr">clipConfig</span>: {
    <span class="hljs-attr">isRowIncrement</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 如果粘贴的行数超过表格的行数，自动新增临时行</span>
    <span class="hljs-comment">// createRowsMethod ({ insertRows, pasteCells }) {</span>
    <span class="hljs-comment">//   console.log(pasteCells)</span>
    <span class="hljs-comment">//   // 自定义返回新的行数据</span>
    <span class="hljs-comment">//   return insertRows</span>
    <span class="hljs-comment">// }</span>
  },
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">60</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'num'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Num'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'address'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Address'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } }
  ],
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">456</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">345</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2 data-id="heading-1">自动新增列</h2>
<p>当粘贴数据时，如果粘贴的列数超过表格的列数时，可以通过 clip-config.isColumnIncrement 自动新增临时列</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49eea2a7562741bd879bb014b37893b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765180852&amp;x-signature=%2FMXtt2KQGtvwH8Whm9uJ7173MBA%3D" alt="table_clip_increment_cols" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,
  <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">keepSource</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">columnConfig</span>: {
    <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">mouseConfig</span>: {
    <span class="hljs-attr">area</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否开启区域选取</span>
  },
  <span class="hljs-attr">areaConfig</span>: {
    <span class="hljs-attr">multiple</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否启用多区域选取功能</span>
  },
  <span class="hljs-attr">editConfig</span>: {
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'cell'</span>, <span class="hljs-comment">// 单元格编辑模式</span>
    <span class="hljs-attr">trigger</span>: <span class="hljs-string">'dblclick'</span>, <span class="hljs-comment">// 双击单元格激活编辑状态</span>
    <span class="hljs-attr">showStatus</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 显示数据编辑状态</span>
  },
  <span class="hljs-attr">keyboardConfig</span>: {
    <span class="hljs-attr">isClip</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启复制粘贴</span>
    <span class="hljs-attr">isEdit</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启任意键进入编辑（功能键除外）</span>
    <span class="hljs-attr">isDel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否开启删除键功能</span>
    <span class="hljs-attr">isEsc</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否开启Esc键关闭编辑功能</span>
  },
  <span class="hljs-attr">clipConfig</span>: {
    <span class="hljs-attr">isColumnIncrement</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 如果粘贴的列数超过表格的列数时，自动新增临时列</span>
    <span class="hljs-comment">// createColumnsMethod ({ insertColumns, pasteCells }) {</span>
    <span class="hljs-comment">//   console.log(pasteCells)</span>
    <span class="hljs-comment">//   // 自定义返回新的列配置</span>
    <span class="hljs-comment">//   return insertColumns</span>
    <span class="hljs-comment">// }</span>
  },
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">60</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'num'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Num'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'address'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Address'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">editRender</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'input'</span> } }
  ],
  <span class="hljs-attr">data</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10001</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test1'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Develop'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">28</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10002</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test2'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">22</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10003</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test3'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10004</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test4'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">456</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10005</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test5'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Guangzhou'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10006</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test6'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Designer'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">23</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">38</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10007</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test7'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'Test'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Women'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shengzhen'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">10008</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Test8'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'PM'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'Man'</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">345</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">34</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'Shanghai'</span> }
  ]
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn" target="_blank" title="https://vxetable.cn" ref="nofollow noopener noreferrer">vxetable.cn</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Angular中懒加载模块的加载顺序总结]]></title>    <link>https://juejin.cn/post/7578391787982028841</link>    <guid>https://juejin.cn/post/7578391787982028841</guid>    <pubDate>2025-12-01T07:58:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578391787982028841" data-draft-id="7578391787981979689" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Angular中懒加载模块的加载顺序总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T07:58:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ze_juejin"/> <meta itemprop="url" content="https://juejin.cn/user/283006465484074"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Angular中懒加载模块的加载顺序总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283006465484074/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ze_juejin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T07:58:37.000Z" title="Mon Dec 01 2025 07:58:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Angular 应用中，懒加载模块的加载顺序是基于路由导航的按需加载机制。以下是详细的加载顺序和过程：</p>
<h2 data-id="heading-0">1. <strong>初始加载阶段</strong></h2>
<p>当用户首次访问 Angular 应用时：</p>
<ul>
<li>主模块（AppModule）和所有急加载模块被打包到 <strong>main.js</strong> 中</li>
<li>懒加载模块被分离成独立的 <strong>chunk 文件</strong></li>
</ul>
<h2 data-id="heading-1">2. <strong>路由导航触发加载</strong></h2>
<p>当用户导航到懒加载路由时：</p>
<h3 data-id="heading-2"><strong>触发时机：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'lazy'</span>,
    <span class="hljs-attr">loadChildren</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./lazy/lazy.module'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">LazyModule</span>)
  }
];
</code></pre>
<h3 data-id="heading-3"><strong>加载流程：</strong></h3>
<pre><code class="hljs language-text" lang="text">用户点击链接/导航 → Angular 路由检测到懒加载配置 → 
开始下载对应的 chunk 文件 → 文件下载完成 → 
模块被实例化 → 组件渲染
</code></pre>
<h2 data-id="heading-4">3. <strong>实际加载顺序示例</strong></h2>
<h3 data-id="heading-5"><strong>项目结构：</strong></h3>
<pre><code class="hljs language-text" lang="text">src/
├── app/
│   ├── app.module.ts
│   ├── app-routing.module.ts
├── feature1/
│   ├── feature1.module.ts
│   └── feature1-routing.module.ts
├── feature2/
│   ├── feature2.module.ts
│   └── feature2-routing.module.ts
</code></pre>
<h3 data-id="heading-6"><strong>编译后的文件结构：</strong></h3>
<pre><code class="hljs language-text" lang="text">dist/
├── index.html
├── main.js                    # 主应用包
├── polyfills.js
├── runtime.js
├── styles.css
├── chunk-feature1.js         # 懒加载模块1
├── chunk-feature2.js         # 懒加载模块2
├── chunk-common.js           # 共享依赖
└── assets/
</code></pre>
<h2 data-id="heading-7">4. <strong>具体加载顺序</strong></h2>
<h3 data-id="heading-8"><strong>第一次访问应用：</strong></h3>
<ol>
<li>
<p><strong>加载主包文件</strong></p>
<pre><code class="hljs language-text" lang="text">runtime.js → polyfills.js → main.js → styles.css
</code></pre>
</li>
<li>
<p><strong>应用初始化</strong></p>
<ul>
<li>AppComponent 被初始化</li>
<li>急加载的组件和模块被注册</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9"><strong>导航到 /feature1：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 当路由匹配到 feature1 时</span>
<span class="hljs-attr">http</span>:<span class="hljs-comment">//localhost:4200/feature1</span>
</code></pre>
<p>加载顺序：</p>
<ol>
<li><strong>检查路由配置</strong> - 发现是懒加载路由</li>
<li><strong>下载 chunk 文件</strong> - 开始下载 <code>chunk-feature1.js</code></li>
<li><strong>模块实例化</strong> - Feature1Module 被 Angular 编译器实例化</li>
<li><strong>组件渲染</strong> - Feature1Component 被渲染</li>
</ol>
<h3 data-id="heading-10"><strong>预加载策略的影响</strong></h3>
<p>Angular 提供了不同的预加载策略：</p>
<h4 data-id="heading-11"><strong>默认策略（NoPreloading）</strong></h4>
<ul>
<li>只在需要时才加载懒加载模块</li>
<li>顺序：用户导航 → 下载 → 实例化</li>
</ul>
<h4 data-id="heading-12"><strong>预加载所有模块（PreloadAllModules）</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title class_">RouterModule</span>.<span class="hljs-title function_">forRoot</span>(routes, {
      <span class="hljs-attr">preloadingStrategy</span>: <span class="hljs-title class_">PreloadAllModules</span>
    })
  ]
})
</code></pre>
<p><strong>加载顺序：</strong></p>
<ol>
<li>主应用加载完成</li>
<li><strong>空闲时后台下载所有懒加载模块</strong></li>
<li>用户导航时立即实例化，无需等待下载</li>
</ol>
<h4 data-id="heading-13"><strong>自定义预加载策略</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomPreloading</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">PreloadingStrategy</span> {
  <span class="hljs-title function_">preload</span>(<span class="hljs-attr">route</span>: <span class="hljs-title class_">Route</span>, <span class="hljs-attr">load</span>: <span class="hljs-title class_">Function</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-keyword">return</span> route.<span class="hljs-property">data</span> &amp;&amp; route.<span class="hljs-property">data</span>.<span class="hljs-property">preload</span> ? <span class="hljs-title function_">load</span>() : <span class="hljs-title function_">of</span>(<span class="hljs-literal">null</span>);
  }
}
</code></pre>
<h2 data-id="heading-14">5. <strong>Chunk 文件的命名和依赖</strong></h2>
<h3 data-id="heading-15"><strong>默认命名：</strong></h3>
<ul>
<li><code>chunk-[contenthash].js</code>（基于内容哈希）</li>
</ul>
<h3 data-id="heading-16"><strong>自定义命名：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// angular.json</span>
{
  <span class="hljs-string">"projects"</span>: {
    <span class="hljs-string">"my-app"</span>: {
      <span class="hljs-string">"architect"</span>: {
        <span class="hljs-string">"build"</span>: {
          <span class="hljs-string">"options"</span>: {
            <span class="hljs-string">"outputHashing"</span>: <span class="hljs-string">"all"</span>,
            <span class="hljs-string">"namedChunks"</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// 启用命名chunks</span>
          }
        }
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-17"><strong>共享依赖：</strong></h3>
<p>如果多个懒加载模块使用相同的第三方库，Webpack 会：</p>
<ol>
<li>提取公共依赖到单独的 chunk（如 <code>chunk-vendors.js</code>）</li>
<li>确保依赖只加载一次</li>
</ol>
<h2 data-id="heading-18">6. <strong>网络瀑布流示例</strong></h2>
<p>浏览器开发者工具 Network 标签显示：</p>
<pre><code class="hljs language-text" lang="text">Initial Load:
├── runtime.js (立即)
├── polyfills.js (并行)
├── main.js (并行)
└── styles.css (并行)

Navigation to /feature1:
└── chunk-feature1.js (按需)

Navigation to /feature2:
└── chunk-feature2.js (按需)
</code></pre>
<h2 data-id="heading-19">7. <strong>优化建议</strong></h2>
<h3 data-id="heading-20"><strong>代码分割：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将大型组件单独懒加载</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'reports'</span>,
    <span class="hljs-attr">loadChildren</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./reports/reports.module'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">ReportsModule</span>)
  }
];
</code></pre>
<h3 data-id="heading-21"><strong>预加载关键模块：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'dashboard'</span>,
    <span class="hljs-attr">loadChildren</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./dashboard/dashboard.module'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">DashboardModule</span>),
    <span class="hljs-attr">data</span>: { <span class="hljs-attr">preload</span>: <span class="hljs-literal">true</span> }  <span class="hljs-comment">// 自定义预加载</span>
  }
];
</code></pre>
<h3 data-id="heading-22"><strong>使用路由守卫控制加载：</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">routes</span>: <span class="hljs-title class_">Routes</span> = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'admin'</span>,
    <span class="hljs-attr">loadChildren</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./admin/admin.module'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> m.<span class="hljs-property">AdminModule</span>),
    <span class="hljs-attr">canLoad</span>: [<span class="hljs-title class_">AuthGuard</span>]  <span class="hljs-comment">// 条件加载</span>
  }
];
</code></pre>
<h2 data-id="heading-23">总结</h2>
<p><strong>懒加载模块的加载顺序原则：</strong></p>
<ol>
<li><strong>按需加载</strong> - 只在路由导航时触发</li>
<li><strong>异步下载</strong> - 通过网络获取 chunk 文件</li>
<li><strong>按序实例化</strong> - 下载完成后 Angular 实例化模块</li>
<li><strong>缓存机制</strong> - 已加载的模块不会重复下载</li>
</ol>
<p>这种机制显著改善了：</p>
<ul>
<li>初始加载性能（减小主包体积）</li>
<li>用户体验（快速首屏显示）</li>
<li>资源利用率（只加载需要的代码）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[彻底搞懂Spring AOP：概念与实战]]></title>    <link>https://juejin.cn/post/7578384621459259444</link>    <guid>https://juejin.cn/post/7578384621459259444</guid>    <pubDate>2025-12-01T08:01:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578384621459259444" data-draft-id="7578693994367991808" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="彻底搞懂Spring AOP：概念与实战"/> <meta itemprop="keywords" content="后端,Java,架构"/> <meta itemprop="datePublished" content="2025-12-01T08:01:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码出财富"/> <meta itemprop="url" content="https://juejin.cn/user/1071388208937930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            彻底搞懂Spring AOP：概念与实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1071388208937930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码出财富
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T08:01:47.000Z" title="Mon Dec 01 2025 08:01:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近咨询的学员较多，其实这个也是老生常谈的问题，但是往往在面试求职环节，问的居多，尤其是工作1~3年的同学，很多人是会做，说不上来，今天与大家一起聊聊；</p>
<p>我来详细讲讲对Spring AOP的理解，包括概念、实现方式和具体例子。</p>
<h2 data-id="heading-0">一、什么是AOP？</h2>
<p>AOP（面向切面编程）是一种编程范式，用于<strong>将横切关注点（如日志、事务、安全等）与核心业务逻辑分离</strong>的技术。</p>
<h3 data-id="heading-1">核心思想：</h3>
<ul>
<li><strong>关注点分离</strong>：将系统的通用功能（横切关注点）从业务逻辑中抽离</li>
<li><strong>模块化</strong>：通过切面将这些通用功能模块化，便于复用和维护</li>
<li><strong>解耦</strong>：避免业务代码中混入大量重复的通用代码</li>
</ul>
<h2 data-id="heading-2">二、AOP的核心概念</h2>



































<table><thead><tr><th>概念</th><th>说明</th><th>类比</th></tr></thead><tbody><tr><td><strong>Aspect（切面）</strong></td><td>横切关注点的模块化，如日志切面、事务切面</td><td>一个专门的“功能模块”</td></tr><tr><td><strong>Join Point（连接点）</strong></td><td>程序执行过程中的某个点，如方法调用、异常抛出</td><td>可以被增强的“时机点”</td></tr><tr><td><strong>Pointcut（切点）</strong></td><td>匹配连接点的表达式，定义在哪些地方应用切面</td><td>“筛选器”，选择哪些连接点要增强</td></tr><tr><td><strong>Advice（通知）</strong></td><td>在特定连接点执行的动作</td><td>增强的具体“行为”</td></tr><tr><td><strong>Weaving（织入）</strong></td><td>将切面应用到目标对象创建代理对象的过程</td><td>“植入”增强逻辑的过程</td></tr></tbody></table>
<h2 data-id="heading-3">三、Advice的类型</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. Before：方法执行前</span>
<span class="hljs-meta">@Before("execution(* com.example.service.*.*(..))")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeAdvice</span><span class="hljs-params">()</span> {
    System.out.println(<span class="hljs-string">"方法执行前"</span>);
}

<span class="hljs-comment">// 2. AfterReturning：方法正常返回后</span>
<span class="hljs-meta">@AfterReturning(pointcut = "execution(* com.example.service.*.*(..))", 
                returning = "result")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterReturning</span><span class="hljs-params">(Object result)</span> {
    System.out.println(<span class="hljs-string">"方法返回: "</span> + result);
}

<span class="hljs-comment">// 3. AfterThrowing：方法抛出异常后</span>
<span class="hljs-meta">@AfterThrowing(pointcut = "execution(* com.example.service.*.*(..))", 
               throwing = "ex")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterThrowing</span><span class="hljs-params">(Exception ex)</span> {
    System.out.println(<span class="hljs-string">"方法异常: "</span> + ex.getMessage());
}

<span class="hljs-comment">// 4. After（Finally）：方法执行后（无论成功还是异常）</span>
<span class="hljs-meta">@After("execution(* com.example.service.*.*(..))")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterAdvice</span><span class="hljs-params">()</span> {
    System.out.println(<span class="hljs-string">"方法执行结束"</span>);
}

<span class="hljs-comment">// 5. Around：环绕通知（最强大）</span>
<span class="hljs-meta">@Around("execution(* com.example.service.*.*(..))")</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">aroundAdvice</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
    <span class="hljs-comment">// 方法执行前</span>
    System.out.println(<span class="hljs-string">"开始执行: "</span> + joinPoint.getSignature());
    
    <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
    <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();  <span class="hljs-comment">// 执行目标方法</span>
    
    <span class="hljs-comment">// 方法执行后</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
    System.out.println(<span class="hljs-string">"执行耗时: "</span> + (end - start) + <span class="hljs-string">"ms"</span>);
    
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h2 data-id="heading-4">四、具体例子：日志切面</h2>
<h3 data-id="heading-5">场景：为所有Service方法添加执行日志和耗时统计</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingAspect</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(LoggingAspect.class);
    
    <span class="hljs-comment">// 定义切点：匹配所有Service包下的方法</span>
    <span class="hljs-meta">@Pointcut("execution(* com.example.service..*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">serviceLayer</span><span class="hljs-params">()</span> {}
    
    <span class="hljs-comment">// 环绕通知：记录方法执行耗时</span>
    <span class="hljs-meta">@Around("serviceLayer()")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">logExecutionTime</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();
        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> signature.getDeclaringType().getSimpleName();
        <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> signature.getName();
        
        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        
        <span class="hljs-keyword">try</span> {
            logger.info(<span class="hljs-string">"[开始执行] {}.{}() 参数: {}"</span>, 
                       className, methodName, Arrays.toString(joinPoint.getArgs()));
            
            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
            
            <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            logger.info(<span class="hljs-string">"[执行成功] {}.{}() 耗时: {}ms 结果: {}"</span>, 
                       className, methodName, (end - start), result);
            
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
            logger.error(<span class="hljs-string">"[执行异常] {}.{}() 耗时: {}ms 异常: {}"</span>, 
                        className, methodName, (end - start), e.getMessage(), e);
            <span class="hljs-keyword">throw</span> e;
        }
    }
    
    <span class="hljs-comment">// 方法执行前的通知</span>
    <span class="hljs-meta">@Before("serviceLayer() &amp;&amp; @annotation(org.springframework.transaction.annotation.Transactional)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logBeforeTransactionalMethod</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        logger.debug(<span class="hljs-string">"准备执行事务方法: {}"</span>, joinPoint.getSignature());
    }
}
</code></pre>
<h2 data-id="heading-6">五、实际应用场景</h2>
<h3 data-id="heading-7">1. <strong>事务管理</strong>（Spring最经典的AOP应用）</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        orderDao.save(order);
        inventoryService.reduceStock(order);
        <span class="hljs-comment">// 如果出现异常，整个事务会回滚</span>
    }
}
</code></pre>
<h3 data-id="heading-8">2. <strong>权限控制</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurityAspect</span> {
    
    <span class="hljs-meta">@Before("@annotation(RequiresPermission)")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkPermission</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();
        <span class="hljs-type">RequiresPermission</span> <span class="hljs-variable">annotation</span> <span class="hljs-operator">=</span> signature.getMethod()
            .getAnnotation(RequiresPermission.class);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">permission</span> <span class="hljs-operator">=</span> annotation.value();
        <span class="hljs-keyword">if</span> (!SecurityContext.hasPermission(permission)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"缺少权限: "</span> + permission);
        }
    }
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-meta">@RequiresPermission("order:create")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Order order)</span> {
    <span class="hljs-comment">// 需要权限的业务逻辑</span>
}
</code></pre>
<h3 data-id="heading-9">3. <strong>缓存切面</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheAspect</span> {
    
    <span class="hljs-meta">@Around("@annotation(cacheable)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">cacheResult</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, Cacheable cacheable)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> generateCacheKey(joinPoint);
        <span class="hljs-type">Object</span> <span class="hljs-variable">cachedValue</span> <span class="hljs-operator">=</span> cache.get(key);
        
        <span class="hljs-keyword">if</span> (cachedValue != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> cachedValue;
        }
        
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> joinPoint.proceed();
        cache.put(key, result, cacheable.ttl());
        
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h2 data-id="heading-10">六、Spring AOP的实现原理</h2>
<h3 data-id="heading-11">底层技术：</h3>
<ol>
<li><strong>JDK动态代理</strong>（默认，针对接口）</li>
<li><strong>CGLIB动态代理</strong>（针对类，当目标对象没有实现接口时）</li>
</ol>
<h3 data-id="heading-12">织入时机：</h3>
<ol>
<li><strong>编译时织入</strong>（AspectJ）</li>
<li><strong>类加载时织入</strong>（AspectJ）</li>
<li><strong>运行时织入</strong>（Spring AOP采用的方式）</li>
</ol>
<h2 data-id="heading-13">七、使用建议</h2>
<h3 data-id="heading-14">优点：</h3>
<p>✅ <strong>减少重复代码</strong>：横切关注点只需编写一次
✅ <strong>提高可维护性</strong>：业务逻辑更清晰
✅ <strong>灵活配置</strong>：通过注解或XML配置切面
✅ <strong>易于测试</strong>：切面可以独立测试</p>
<h3 data-id="heading-15">注意事项：</h3>
<p>⚠️ <strong>性能开销</strong>：代理调用比直接调用稍慢
⚠️ <strong>仅方法拦截</strong>：Spring AOP只能拦截方法，不能拦截字段访问
⚠️ <strong>自调用问题</strong>：同一类内方法互相调用，AOP可能失效
⚠️ <strong>理解复杂度</strong>：需要理解代理机制和AOP概念</p>
<h2 data-id="heading-16">总结</h2>
<p>Spring AOP通过动态代理技术，在不修改原有代码的情况下，为程序添加额外的功能。它特别适合处理<strong>横切关注点</strong>，如日志、事务、安全、缓存等。理解AOP的核心概念（切面、切点、通知）和实际应用场景，能帮助我们编写更清晰、更易维护的代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Fiddler抓包与接口调试实用指南，HTTPS配置、代理设置、API测试与性能优化全解析]]></title>    <link>https://juejin.cn/post/7578519990283010074</link>    <guid>https://juejin.cn/post/7578519990283010074</guid>    <pubDate>2025-12-01T08:02:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578519990283010074" data-draft-id="7578442185848455206" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Fiddler抓包与接口调试实用指南，HTTPS配置、代理设置、API测试与性能优化全解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-01T08:02:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aiopencode"/> <meta itemprop="url" content="https://juejin.cn/user/1898230261493865"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Fiddler抓包与接口调试实用指南，HTTPS配置、代理设置、API测试与性能优化全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1898230261493865/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aiopencode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T08:02:17.000Z" title="Mon Dec 01 2025 08:02:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常开发中，无论你是前端、后端还是测试人员，“接口调试”和“网络问题分析”几乎每天都要遇到。
而在这些调试工作中，一款稳定、功能全面的抓包工具，往往能让你少走许多弯路。</p>
<p>在众多工具中，<strong>Fiddler抓包工具</strong> 一直被认为是开发者必备的“网络调试瑞士军刀”。
它不仅能实时捕获HTTP/HTTPS请求，还能修改参数、模拟接口、分析性能，几乎覆盖了所有调试和测试需求。</p>
<p>本文将从实践角度，系统介绍 <strong>Fiddler使用教程、代理配置、HTTPS抓包技巧、接口测试与调试方法</strong>，帮助你从入门到进阶全面掌握这款工具。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、什么是 Fiddler？为什么值得开发者使用？</strong></h2>
<p><strong>Fiddler</strong> 是 Telerik 推出的免费 HTTP/HTTPS 抓包与网络调试工具，它通过代理服务器方式拦截所有网络流量，让开发者能清晰地看到每个请求的细节。</p>
<p>相比其他工具（如 Charles、Postman、Wireshark），Fiddler 的优势在于：</p>
<ul>
<li><strong>HTTP/HTTPS 全协议支持</strong>；</li>
<li><strong>可修改请求与响应</strong>，灵活调试接口；</li>
<li><strong>强大的 Mock 功能（AutoResponder）</strong>；</li>
<li><strong>详细的性能分析报告</strong>；</li>
<li><strong>支持移动端与桌面端抓包</strong>；</li>
<li><strong>完全免费、可定制性强</strong>。</li>
</ul>
<hr/>
<h2 data-id="heading-1"><strong>二、Fiddler安装与初始配置</strong></h2>
<h3 data-id="heading-2"><strong>1. 安装与启动</strong></h3>
<p>Fiddler 安装过程非常简单，下载安装包后直接启动即可使用。
启动后，它会自动接管系统网络代理。</p>
<p><strong>状态提示：</strong></p>
<ul>
<li>左下角 “Capturing” 表示正在抓包；</li>
<li>如果显示 “Paused”，点击即可恢复。</li>
</ul>
<p>打开浏览器访问任意网站，你会立即在 Fiddler 中看到实时请求流。</p>
<hr/>
<h3 data-id="heading-3"><strong>2. 电脑与移动端代理设置</strong></h3>
<p>默认情况下，Fiddler 只会捕获本机的网络流量。
若你需要抓取手机 App 或微信小程序的请求，需要开启远程代理功能。</p>
<p><strong>配置步骤如下：</strong></p>
<ol>
<li>打开 <code>Tools → Options → Connections</code>；</li>
<li>勾选 <strong>Allow remote computers to connect</strong>；</li>
<li>查看当前电脑 IP 地址和端口（默认 8888）；</li>
<li>确保手机与电脑在同一 Wi-Fi 网络；</li>
<li>在手机 Wi-Fi 设置中添加代理：
<ul>
<li>主机名：电脑 IP</li>
<li>端口号：8888。</li>
</ul>
</li>
</ol>
<p>完成后，Fiddler 即可捕获来自移动端的 HTTP 请求。</p>
<hr/>
<h3 data-id="heading-4"><strong>3. HTTPS 抓包配置</strong></h3>
<p>大多数现代网站与接口都使用 HTTPS 协议。
Fiddler 可通过安装本地证书来解密加密流量。</p>
<p><strong>配置方法如下：</strong></p>
<ul>
<li>打开 <code>Tools → Options → HTTPS</code>；</li>
<li>勾选 <strong>Decrypt HTTPS traffic</strong>；</li>
<li>点击 “Actions → Trust Root Certificate”；</li>
<li>安装并信任根证书；</li>
<li>若需抓取手机 HTTPS 请求，导出证书后在手机中信任即可。</li>
</ul>
<p>这样，Fiddler 就能显示完整的 HTTPS 请求与响应内容，包括 Header 和 Body。</p>
<hr/>
<h2 data-id="heading-5"><strong>三、Fiddler核心功能与使用技巧</strong></h2>
<h3 data-id="heading-6"><strong>1. 请求与响应分析</strong></h3>
<p>在主界面中，每条请求都可展开查看：</p>
<ul>
<li>请求方法（GET、POST、PUT、DELETE）；</li>
<li>URL、参数、Header 与 Cookie；</li>
<li>响应状态码与返回体；</li>
<li>请求耗时、响应时间等性能指标。</li>
</ul>
<p>某次接口报错“500”，通过 Fiddler 分析发现请求参数字段拼写错误，仅需几分钟即可定位并解决问题。</p>
<hr/>
<h3 data-id="heading-7"><strong>2. 模拟接口与Mock数据（AutoResponder）</strong></h3>
<p>AutoResponder 模块可用于前端 Mock 数据、接口测试。</p>
<p><strong>使用步骤：</strong></p>
<ol>
<li>打开 AutoResponder 面板；</li>
<li>点击 “Add Rule” 添加规则；</li>
<li>选择匹配接口 URL；</li>
<li>指定返回内容或本地 JSON 文件；</li>
<li>勾选 “Enable Rules” 启用。</li>
</ol>
<p><strong>使用示例：</strong>
在接口未开发阶段，前端可设置</p>
<pre><code class="hljs language-css" lang="css">{ "<span class="hljs-selector-tag">code</span>":<span class="hljs-number">200</span>, <span class="hljs-string">"msg"</span>:<span class="hljs-string">"success"</span>, <span class="hljs-string">"data"</span>:{"user":<span class="hljs-string">"admin"</span>} }
</code></pre>
<p>用于页面联调与功能演示。</p>
<hr/>
<h3 data-id="heading-8"><strong>3. 请求拦截与断点调试（Breakpoints）</strong></h3>
<p>Fiddler 支持设置断点，可在请求或响应阶段暂停执行。</p>
<p><strong>典型应用：</strong></p>
<ul>
<li>模拟错误响应（如 404、500）；</li>
<li>修改请求参数以测试后端兼容性；</li>
<li>延迟响应测试前端加载逻辑。</li>
</ul>
<p>在命令栏输入 <code>bpu yourapi.com</code>，即可开启特定接口断点。</p>
<hr/>
<h3 data-id="heading-9"><strong>4. 构造与重放请求（Composer）</strong></h3>
<p>Composer 功能与 Postman 类似，可手动构造或重发请求。</p>
<p><strong>使用技巧：</strong></p>
<ul>
<li>调整参数测试接口稳定性；</li>
<li>验证 Token、签名是否正确；</li>
<li>重放线上 Bug 请求。</li>
</ul>
<p>右键历史请求 → “Replay → Reissue Request” 即可快速重发。</p>
<hr/>
<h3 data-id="heading-10"><strong>5. 性能分析（Timeline）</strong></h3>
<p>Timeline 模块可以可视化展示请求的各阶段耗时：
DNS 查询 → TCP 连接 → TLS 握手 → 服务器响应 → 内容下载。</p>
<p><strong>应用示例：</strong>
通过 Timeline 分析，开发者可判断延迟原因：
是网络问题？服务器慢？还是请求重复触发？</p>
<hr/>
<h2 data-id="heading-11"><strong>四、实战案例：定位一次登录接口延迟问题</strong></h2>
<p>在一次登录接口调试中，接口平均耗时超过 4 秒。
使用 Fiddler 抓包后发现：</p>
<ul>
<li>请求发起时间正常；</li>
<li>服务器响应阶段耗时 3 秒以上；</li>
<li>响应体返回时，数据大小超过 800KB。</li>
</ul>
<p>通过分析可知，接口返回了大量无用字段。
优化后，接口响应时间降至 1.1 秒。</p>
<p><strong>经验总结：</strong></p>
<blockquote>
<p>抓包不仅是排查错误，更是性能优化的第一步。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12"><strong>五、Fiddler功能模块汇总</strong></h2>



































<table><thead><tr><th>模块</th><th>功能说明</th><th>应用场景</th></tr></thead><tbody><tr><td><strong>Filters</strong></td><td>按条件筛选请求</td><td>聚焦特定接口</td></tr><tr><td><strong>AutoResponder</strong></td><td>模拟接口数据</td><td>前端独立开发</td></tr><tr><td><strong>Breakpoints</strong></td><td>拦截并修改请求</td><td>模拟异常调试</td></tr><tr><td><strong>Composer</strong></td><td>构造与重放请求</td><td>API 测试与Bug复现</td></tr><tr><td><strong>Timeline</strong></td><td>请求性能分析</td><td>网络优化与监控</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-13"><strong>六、Fiddler与其他工具对比</strong></h2>






























<table><thead><tr><th>工具</th><th>优势</th><th>适用人群</th></tr></thead><tbody><tr><td><strong>Fiddler</strong></td><td>免费、强大、支持修改请求</td><td>开发 / 测试人员</td></tr><tr><td><strong>Charles</strong></td><td>界面友好、上手快</td><td>新手用户</td></tr><tr><td><strong>Postman</strong></td><td>请求构造灵活</td><td>API 测试人员</td></tr><tr><td><strong>Wireshark</strong></td><td>网络底层分析能力强</td><td>网络安全工程师</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-14"><strong>学习与资源推荐</strong></h2>
<p>想更深入学习 Fiddler，掌握 <strong>Fiddler使用教程</strong>、<strong>代理设置</strong> 与 <strong>HTTPS 调试技巧</strong>？推荐访问**<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fiddler.hk%2F" target="_blank" title="https://www.fiddler.hk/" ref="nofollow noopener noreferrer">Fiddler 中文网</a>**</p>
<p>你将获得：</p>
<ul>
<li>安装与配置详细教程；</li>
<li>HTTPS 抓包与证书设置指南；</li>
<li>移动端代理调试技巧；</li>
<li>AutoResponder Mock 实战；</li>
<li>性能调试与问题排查方案。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Vite】离线打包@iconify/vue的图标]]></title>    <link>https://juejin.cn/post/7578161740468535347</link>    <guid>https://juejin.cn/post/7578161740468535347</guid>    <pubDate>2025-12-01T03:58:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578161740468535347" data-draft-id="7578161740468502579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Vite】离线打包@iconify/vue的图标"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-01T03:58:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七月十二"/> <meta itemprop="url" content="https://juejin.cn/user/145549432455998"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Vite】离线打包@iconify/vue的图标
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/145549432455998/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七月十二
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T03:58:32.000Z" title="Mon Dec 01 2025 03:58:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【Vite】离线打包@iconify/vue的图标</h2>
<p>所需库<code>@iconify/vue</code>、<code>@iconify/types</code>、<code>@iconify/json</code></p>
<p>需要创建或修改3个文件，</p>
<ol>
<li>图标检索脚本</li>
<li><code>@iconify/vue</code>引入</li>
<li><code>package.json</code>文件</li>
</ol>
<h4 data-id="heading-1">图标检索脚本</h4>
<p><code>scripts\extract-icons.cjs</code></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// scripts/extract-icons.cjs</span>
<span class="hljs-comment">/* eslint-disable @typescript-eslint/no-require-imports */</span>
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-comment">// ============ 配置区域 ============</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CONFIG</span> = {
  <span class="hljs-attr">srcDir</span>: <span class="hljs-string">'src'</span>,
  <span class="hljs-attr">outputPath</span>: <span class="hljs-string">'src/assets/icons-slim/icons.json'</span>,
  <span class="hljs-attr">iconifyJsonDir</span>: <span class="hljs-string">'node_modules/@iconify/json/json'</span>,
  <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.vue'</span>, <span class="hljs-string">'.ts'</span>, <span class="hljs-string">'.tsx'</span>, <span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>]
}

<span class="hljs-comment">// Tailwind CSS 响应式/状态前缀黑名单</span>
<span class="hljs-comment">/* prettier-ignore */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAILWIND_PREFIXES</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
  <span class="hljs-string">'sm'</span>, <span class="hljs-string">'md'</span>, <span class="hljs-string">'lg'</span>, <span class="hljs-string">'xl'</span>, <span class="hljs-string">'2xl'</span>, <span class="hljs-comment">// 响应式断点</span>
  <span class="hljs-string">'hover'</span>, <span class="hljs-string">'focus'</span>, <span class="hljs-string">'active'</span>, <span class="hljs-string">'disabled'</span>, <span class="hljs-string">'visited'</span>, <span class="hljs-string">'checked'</span>, <span class="hljs-string">'indeterminate'</span>,  <span class="hljs-comment">// 状态变体</span>
  <span class="hljs-string">'focus-within'</span>, <span class="hljs-string">'focus-visible'</span>, <span class="hljs-string">'group-hover'</span>, <span class="hljs-string">'group-focus'</span>, <span class="hljs-string">'peer-hover'</span>, <span class="hljs-string">'peer-focus'</span>,
  <span class="hljs-string">'before'</span>, <span class="hljs-string">'after'</span>, <span class="hljs-string">'first-letter'</span>, <span class="hljs-string">'first-line'</span>, <span class="hljs-string">'marker'</span>, <span class="hljs-string">'selection'</span>, <span class="hljs-string">'file'</span>, <span class="hljs-string">'placeholder'</span>, <span class="hljs-comment">// 伪元素</span>
  <span class="hljs-string">'first'</span>, <span class="hljs-string">'last'</span>, <span class="hljs-string">'only'</span>, <span class="hljs-string">'odd'</span>, <span class="hljs-string">'even'</span>, <span class="hljs-string">'first-of-type'</span>, <span class="hljs-string">'last-of-type'</span>, <span class="hljs-string">'only-of-type'</span>,  <span class="hljs-comment">// 伪类</span>
  <span class="hljs-string">'empty'</span>, <span class="hljs-string">'enabled'</span>, <span class="hljs-string">'default'</span>, <span class="hljs-string">'required'</span>, <span class="hljs-string">'valid'</span>, <span class="hljs-string">'invalid'</span>, <span class="hljs-string">'in-range'</span>, <span class="hljs-string">'out-of-range'</span>,
  <span class="hljs-string">'read-only'</span>, <span class="hljs-string">'read-write'</span>, <span class="hljs-string">'open'</span>,
  <span class="hljs-string">'dark'</span>, <span class="hljs-string">'light'</span>,  <span class="hljs-comment">// 深色模式</span>
  <span class="hljs-string">'ltr'</span>, <span class="hljs-string">'rtl'</span>,  <span class="hljs-comment">// 方向</span>
  <span class="hljs-string">'print'</span>,  <span class="hljs-comment">// 打印</span>
  <span class="hljs-string">'motion-safe'</span>, <span class="hljs-string">'motion-reduce'</span>,  <span class="hljs-comment">// 运动</span>
  <span class="hljs-string">'contrast-more'</span>, <span class="hljs-string">'contrast-less'</span>,  <span class="hljs-comment">// 对比度</span>
  <span class="hljs-string">'not'</span>, <span class="hljs-string">'has'</span>, <span class="hljs-string">'is'</span>, <span class="hljs-string">'where'</span>, <span class="hljs-string">'supports'</span>, <span class="hljs-string">'aria'</span>, <span class="hljs-string">'data'</span>  <span class="hljs-comment">// 其他常见</span>
])

<span class="hljs-comment">// 其他需要排除的前缀</span>
<span class="hljs-comment">/* prettier-ignore */</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EXCLUDED_PREFIXES</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([
  <span class="hljs-string">'http'</span>, <span class="hljs-string">'https'</span>, <span class="hljs-string">'ftp'</span>, <span class="hljs-string">'mailto'</span>, <span class="hljs-string">'tel'</span>, <span class="hljs-string">'data'</span>, <span class="hljs-string">'file'</span>, <span class="hljs-string">'ws'</span>, <span class="hljs-string">'wss'</span>, <span class="hljs-comment">// 协议</span>
  <span class="hljs-string">'v-bind'</span>, <span class="hljs-string">'v-on'</span>, <span class="hljs-string">'v-if'</span>, <span class="hljs-string">'v-else'</span>, <span class="hljs-string">'v-for'</span>, <span class="hljs-string">'v-show'</span>, <span class="hljs-string">'v-model'</span>, <span class="hljs-string">'v-slot'</span>, <span class="hljs-comment">// Vue 指令</span>
  <span class="hljs-string">'nth-child'</span>, <span class="hljs-string">'nth-of-type'</span>, <span class="hljs-string">'nth-last-child'</span>, <span class="hljs-string">'nth-last-of-type'</span>, <span class="hljs-comment">// CSS 相关</span>
  <span class="hljs-string">'type'</span>, <span class="hljs-string">'lang'</span>, <span class="hljs-string">'scoped'</span>, <span class="hljs-string">'module'</span>, <span class="hljs-string">'setup'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'key'</span>, <span class="hljs-string">'ref'</span>, <span class="hljs-string">'class'</span>, <span class="hljs-string">'style'</span> <span class="hljs-comment">// 常见误匹配</span>
])

<span class="hljs-comment">// ============ 工具函数 ============</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">scanFiles</span>(<span class="hljs-params">dir, fileList = []</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> fs.<span class="hljs-title function_">readdirSync</span>(dir)) {
    <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(dir, file)
    <span class="hljs-keyword">const</span> stat = fs.<span class="hljs-title function_">statSync</span>(filePath)

    <span class="hljs-keyword">if</span> (stat.<span class="hljs-title function_">isDirectory</span>()) {
      <span class="hljs-keyword">if</span> (![<span class="hljs-string">'node_modules'</span>, <span class="hljs-string">'.git'</span>, <span class="hljs-string">'dist'</span>, <span class="hljs-string">'.nuxt'</span>, <span class="hljs-string">'.output'</span>].<span class="hljs-title function_">includes</span>(file)) {
        <span class="hljs-title function_">scanFiles</span>(filePath, fileList)
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">extensions</span>.<span class="hljs-title function_">includes</span>(path.<span class="hljs-title function_">extname</span>(file))) {
      fileList.<span class="hljs-title function_">push</span>(filePath)
    }
  }
  <span class="hljs-keyword">return</span> fileList
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">preprocessContent</span>(<span class="hljs-params">content, filePath</span>) {
  <span class="hljs-keyword">if</span> (filePath.<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">'.vue'</span>)) {
    content = content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;style[^&gt;]*&gt;[\s\S]*?&lt;\/style&gt;/gi</span>, <span class="hljs-string">''</span>)
  }
  <span class="hljs-keyword">return</span> content
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/\/.*$/gm</span>, <span class="hljs-string">''</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\/\*[\s\S]*?\*\//g</span>, <span class="hljs-string">''</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;!--[\s\S]*?--&gt;/g</span>, <span class="hljs-string">''</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidIcon</span>(<span class="hljs-params">prefix, name</span>) {
  <span class="hljs-keyword">const</span> lowerPrefix = prefix.<span class="hljs-title function_">toLowerCase</span>()
  <span class="hljs-keyword">if</span> (<span class="hljs-variable constant_">TAILWIND_PREFIXES</span>.<span class="hljs-title function_">has</span>(lowerPrefix) || <span class="hljs-variable constant_">EXCLUDED_PREFIXES</span>.<span class="hljs-title function_">has</span>(lowerPrefix)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^\d/</span>.<span class="hljs-title function_">test</span>(prefix) || prefix.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'$'</span>) || name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'{'</span>) || name.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^\d+$/</span>.<span class="hljs-title function_">test</span>(name)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">const</span> cssValues = [<span class="hljs-string">'none'</span>, <span class="hljs-string">'auto'</span>, <span class="hljs-string">'inherit'</span>, <span class="hljs-string">'initial'</span>, <span class="hljs-string">'unset'</span>, <span class="hljs-string">'block'</span>, <span class="hljs-string">'inline'</span>, <span class="hljs-string">'flex'</span>, <span class="hljs-string">'grid'</span>, <span class="hljs-string">'hidden'</span>, <span class="hljs-string">'visible'</span>]
  <span class="hljs-keyword">return</span> !cssValues.<span class="hljs-title function_">includes</span>(name.<span class="hljs-title function_">toLowerCase</span>())
}

<span class="hljs-comment">// ============ 主逻辑 ============</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extractIcons</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🔍 开始扫描项目中使用的图标...\n'</span>)

  <span class="hljs-keyword">const</span> files = <span class="hljs-title function_">scanFiles</span>(path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">srcDir</span>))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📁 找到 <span class="hljs-subst">${files.length}</span> 个文件需要扫描`</span>)

  <span class="hljs-keyword">const</span> iconPatterns = [
    <span class="hljs-regexp">/\bicon\s*=\s*["'`]([a-z][a-z0-9-]*):([a-z][a-z0-9-]+)["'`]/gi</span>,
    <span class="hljs-regexp">/:icon\s*=\s*["'`]['"`]([a-z][a-z0-9-]*):([a-z][a-z0-9-]+)['"`]["'`]/gi</span>,
    <span class="hljs-regexp">/\bicon\s*:\s*["'`]([a-z][a-z0-9-]*):([a-z][a-z0-9-]+)["'`]/gi</span>,
    <span class="hljs-regexp">/(?:addIcon|getIcon|loadIcon)\s*\(\s*["'`]([a-z][a-z0-9-]*):([a-z][a-z0-9-]+)["'`]/gi</span>,
    <span class="hljs-regexp">/\bname\s*=\s*["'`]([a-z][a-z0-9-]*):([a-z][a-z0-9-]+)["'`]/gi</span>
  ]

  <span class="hljs-comment">// 扫描收集图标</span>
  <span class="hljs-keyword">const</span> iconsByPrefix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files) {
    <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">preprocessContent</span>(fs.<span class="hljs-title function_">readFileSync</span>(file, <span class="hljs-string">'utf-8'</span>), file)

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> pattern <span class="hljs-keyword">of</span> iconPatterns) {
      pattern.<span class="hljs-property">lastIndex</span> = <span class="hljs-number">0</span>
      <span class="hljs-keyword">let</span> match
      <span class="hljs-keyword">while</span> ((match = pattern.<span class="hljs-title function_">exec</span>(content)) !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">const</span> [, prefix, iconName] = match
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isValidIcon</span>(prefix, iconName)) {
          <span class="hljs-keyword">if</span> (!iconsByPrefix.<span class="hljs-title function_">has</span>(prefix.<span class="hljs-title function_">toLowerCase</span>())) {
            iconsByPrefix.<span class="hljs-title function_">set</span>(prefix.<span class="hljs-title function_">toLowerCase</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>())
          }
          iconsByPrefix.<span class="hljs-title function_">get</span>(prefix.<span class="hljs-title function_">toLowerCase</span>()).<span class="hljs-title function_">add</span>(iconName.<span class="hljs-title function_">toLowerCase</span>())
        }
      }
    }
  }

  <span class="hljs-comment">// 验证并提取图标</span>
  <span class="hljs-keyword">const</span> iconifyJsonDir = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">iconifyJsonDir</span>)
  <span class="hljs-keyword">const</span> outputCollections = []
  <span class="hljs-keyword">const</span> collectionStats = [] <span class="hljs-comment">// 记录每个图标集的统计信息</span>
  <span class="hljs-keyword">const</span> missingIcons = []
  <span class="hljs-keyword">let</span> totalFound = <span class="hljs-number">0</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [prefix, iconNames] <span class="hljs-keyword">of</span> iconsByPrefix) {
    <span class="hljs-keyword">const</span> jsonPath = path.<span class="hljs-title function_">join</span>(iconifyJsonDir, <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>.json`</span>)
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(jsonPath)) <span class="hljs-keyword">continue</span>

    <span class="hljs-keyword">const</span> fullCollection = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(jsonPath, <span class="hljs-string">'utf-8'</span>))
    <span class="hljs-keyword">const</span> slimCollection = {
      <span class="hljs-attr">prefix</span>: fullCollection.<span class="hljs-property">prefix</span>,
      <span class="hljs-attr">icons</span>: {},
      ...(fullCollection.<span class="hljs-property">width</span> &amp;&amp; { <span class="hljs-attr">width</span>: fullCollection.<span class="hljs-property">width</span> }),
      ...(fullCollection.<span class="hljs-property">height</span> &amp;&amp; { <span class="hljs-attr">height</span>: fullCollection.<span class="hljs-property">height</span> })
    }

    <span class="hljs-keyword">let</span> foundInCollection = <span class="hljs-number">0</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iconName <span class="hljs-keyword">of</span> iconNames) {
      <span class="hljs-keyword">if</span> (fullCollection.<span class="hljs-property">icons</span>[iconName]) {
        slimCollection.<span class="hljs-property">icons</span>[iconName] = fullCollection.<span class="hljs-property">icons</span>[iconName]
        totalFound++
        foundInCollection++
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fullCollection.<span class="hljs-property">aliases</span>?.[iconName]) {
        slimCollection.<span class="hljs-property">aliases</span> = slimCollection.<span class="hljs-property">aliases</span> || {}
        slimCollection.<span class="hljs-property">aliases</span>[iconName] = fullCollection.<span class="hljs-property">aliases</span>[iconName]
        <span class="hljs-keyword">const</span> parentName = fullCollection.<span class="hljs-property">aliases</span>[iconName].<span class="hljs-property">parent</span>
        <span class="hljs-keyword">if</span> (fullCollection.<span class="hljs-property">icons</span>[parentName]) {
          slimCollection.<span class="hljs-property">icons</span>[parentName] = fullCollection.<span class="hljs-property">icons</span>[parentName]
        }
        totalFound++
        foundInCollection++
      } <span class="hljs-keyword">else</span> {
        missingIcons.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${prefix}</span>:<span class="hljs-subst">${iconName}</span>`</span>)
      }
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(slimCollection.<span class="hljs-property">icons</span>).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      outputCollections.<span class="hljs-title function_">push</span>(slimCollection)
      collectionStats.<span class="hljs-title function_">push</span>({ prefix, <span class="hljs-attr">count</span>: foundInCollection })
    }
  }

  <span class="hljs-comment">// 写入文件</span>
  <span class="hljs-keyword">const</span> outputPath = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-variable constant_">CONFIG</span>.<span class="hljs-property">outputPath</span>)
  fs.<span class="hljs-title function_">mkdirSync</span>(path.<span class="hljs-title function_">dirname</span>(outputPath), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })
  fs.<span class="hljs-title function_">writeFileSync</span>(outputPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(outputCollections, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>))

  <span class="hljs-comment">// 输出报告</span>
  <span class="hljs-keyword">const</span> slimSize = fs.<span class="hljs-title function_">statSync</span>(outputPath).<span class="hljs-property">size</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">50</span>))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📊 提取报告'</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">50</span>))
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 成功提取: <span class="hljs-subst">${totalFound}</span> 个图标，来自 <span class="hljs-subst">${outputCollections.length}</span> 个图标集\n`</span>)

  <span class="hljs-comment">// 打印图标集详情</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'📦 图标集详情:'</span>)
  collectionStats
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">count</span> - a.<span class="hljs-property">count</span>)
    .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ prefix, count }</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   - <span class="hljs-subst">${prefix}</span>: <span class="hljs-subst">${count}</span> 个图标`</span>)
    })

  <span class="hljs-keyword">if</span> (missingIcons.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n⚠️  未找到的图标: <span class="hljs-subst">${missingIcons.length}</span> 个`</span>)
    missingIcons.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   - <span class="hljs-subst">${name}</span>`</span>))
    <span class="hljs-keyword">if</span> (missingIcons.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   ... 还有 <span class="hljs-subst">${missingIcons.length - <span class="hljs-number">10</span>}</span> 个`</span>)
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n📦 精简图标集大小: <span class="hljs-subst">${(slimSize / <span class="hljs-number">1024</span>).toFixed(<span class="hljs-number">2</span>)}</span> KB`</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 已生成: <span class="hljs-subst">${CONFIG.outputPath}</span>`</span>)
}

<span class="hljs-title function_">extractIcons</span>()
</code></pre>
<h4 data-id="heading-2"><code>@iconify/vue</code>引入离线的icon</h4>
<p><code>src\plugins\iconify.ts</code></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// plugins/iconify.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">App</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Icon</span>, addCollection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@iconify/vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">IconifyJSON</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@iconify/types'</span>
<span class="hljs-keyword">import</span> iconCollections <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/icons-slim/icons.json'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">install</span>(<span class="hljs-params">app: App</span>) {
    <span class="hljs-keyword">const</span> icons = iconCollections <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">IconifyJSON</span>[]
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> collection <span class="hljs-keyword">of</span> icons) {
      <span class="hljs-title function_">addCollection</span>(collection)
    }
    app.<span class="hljs-title function_">component</span>(<span class="hljs-string">'Icon'</span>, <span class="hljs-title class_">Icon</span>)
  }
}
</code></pre>
<p>注：在<code>main.ts</code>中这样用</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> installIconify <span class="hljs-keyword">from</span> <span class="hljs-string">'@/plugins/iconify'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 注册iconify图标组件</span>
app.<span class="hljs-title function_">use</span>(installIconify)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h4 data-id="heading-3">执行脚本</h4>
<p><code>package.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"smart-community-h5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"extract-icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/extract-icons.cjs"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"serve"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build:shegong"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build --mode shegong"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint --ext .ts,.vue src"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint:fix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint --ext .ts,.vue src --fix"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@antv/g6"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.0.49"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@iconify/vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@microsoft/fetch-event-source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.11.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dayjs"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.11.18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"echarts"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"js-cookie"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.0.5"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"mitt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"naive-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.42.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"nanoid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.1.6"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"nprogress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"pdfjs-dist"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.4.296"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"pinia"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.0.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tailwindcss-palette-generator"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.6.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-i18n"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"11.1.11"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.5.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue3-autocounter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.8"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ys-md-rendering"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.4"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@eslint/eslintrc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.3.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@eslint/js"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9.34.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@iconify/json"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.2.412"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@iconify/types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@tailwindcss/vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.12"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/js-cookie"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.0.6"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"24.3.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/nprogress"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@typescript-eslint/eslint-plugin"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.40.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@typescript-eslint/parser"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.40.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vue/tsconfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.7.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9.33.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-config-prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10.1.8"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.32.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.5.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10.4.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.6.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prettier-plugin-tailwindcss"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.6.14"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sass"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.90.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tailwindcss"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.1.12"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~5.8.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript-eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8.41.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unplugin-auto-import"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"20.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unplugin-icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22.3.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unplugin-vue-components"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"29.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.1.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite-svg-loader"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.1.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-eslint-parser"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-tsc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.0.5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>通过<code>pnpm run extract-icons</code>检索项目中的所有icon</p>
<p>当然也可以通过<code>"build": "npm run extract-icons &amp;&amp; vite build"</code>的方式，在每次build前都打包</p>
<h4 data-id="heading-4">生成的json示例效果如下</h4>
<p><code>src\assets\icons-slim\icons.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"material-symbols"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"check-rounded"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"m9.55 15.15l8.475-8.475q.3-.3.7-.3t.7.3t.3.713t-.3.712l-9.175 9.2q-.3.3-.7.3t-.7-.3L4.55 13q-.3-.3-.288-.712t.313-.713t.713-.3t.712.3z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"search"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"m19.6 21l-6.3-6.3q-.75.6-1.725.95T9.5 16q-2.725 0-4.612-1.888T3 9.5t1.888-4.612T9.5 3t4.613 1.888T16 9.5q0 1.1-.35 2.075T14.7 13.3l6.3 6.3zM9.5 14q1.875 0 3.188-1.312T14 9.5t-1.312-3.187T9.5 5T6.313 6.313T5 9.5t1.313 3.188T9.5 14\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"check"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"m9.55 18l-5.7-5.7l1.425-1.425L9.55 15.15l9.175-9.175L20.15 7.4z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"M8 18h8v-2H8zm0-4h8v-2H8zm-2 8q-.825 0-1.412-.587T4 20V4q0-.825.588-1.412T6 2h8l6 6v12q0 .825-.587 1.413T18 22zm7-13h5l-5-5z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"open-in-new"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h7v2H5v14h14v-7h2v7q0 .825-.587 1.413T19 21zm4.7-5.3l-1.4-1.4L17.6 5H14V3h7v7h-2V6.4z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"add-comment-outline"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"M11 14h2v-3h3V9h-3V6h-2v3H8v2h3zm-9 8V4q0-.825.588-1.412T4 2h16q.825 0 1.413.588T22 4v12q0 .825-.587 1.413T20 18H6zm3.15-6H20V4H4v13.125zM4 16V4z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"chevron-left"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"m14 18l-6-6l6-6l1.4 1.4l-4.6 4.6l4.6 4.6z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ep"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"right"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"M754.752 480H160a32 32 0 1 0 0 64h594.752L521.344 777.344a32 32 0 0 0 45.312 45.312l288-288a32 32 0 0 0 0-45.312l-288-288a32 32 0 1 0-45.312 45.312z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1024</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bxs"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"right-arrow"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" d=\"M5.536 21.886a1 1 0 0 0 1.033-.064l13-9a1 1 0 0 0 0-1.644l-13-9A1 1 0 0 0 5 3v18a1 1 0 0 0 .536.886\"/&gt;"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"icon-park-solid"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"down-one"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"currentColor\" stroke=\"currentColor\" stroke-linejoin=\"round\" stroke-width=\"4\" d=\"M36 19L24 31L12 19z\"/&gt;"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">48</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">48</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prefix"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"teenyicons"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"right-outline"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"body"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;path fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"square\" d=\"m5 14l7-6.5L5 1\"/&gt;"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TS2d渲染引擎]]></title>    <link>https://juejin.cn/post/7578138892127453230</link>    <guid>https://juejin.cn/post/7578138892127453230</guid>    <pubDate>2025-12-01T04:39:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578138892127453230" data-draft-id="7578442185847275558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TS2d渲染引擎"/> <meta itemprop="keywords" content="WebGL"/> <meta itemprop="datePublished" content="2025-12-01T04:39:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Robet"/> <meta itemprop="url" content="https://juejin.cn/user/193141028175320"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TS2d渲染引擎
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/193141028175320/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Robet
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:39:04.000Z" title="Mon Dec 01 2025 04:39:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>基于 TypeScript 的轻量级 2D渲染引擎</p>
<blockquote>
<p>✅ 所有代码为纯逻辑层封装，适用于 WebWorker 或与任意 UI 框架集成</p>
</blockquote>
<hr/>
<h3 data-id="heading-0">📦 安装依赖（提示）</h3>
<pre><code class="hljs language-bash" lang="bash">npm install gl-matrix
</code></pre>
<hr/>
<h2 data-id="heading-1">🔧 基础类型定义（common.ts）</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { mat4, vec2, vec3 } <span class="hljs-keyword">from</span> <span class="hljs-string">'gl-matrix'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Vec2</span> = vec2;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Vec3</span> = vec3;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Mat4</span> = mat4;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CanvasRect</span> {
  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-2">🎨 CanvasConfig.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CanvasRect</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanvasConfig</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-attr">canvasClientRect</span>: <span class="hljs-title class_">CanvasRect</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">rect: CanvasRect</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasClientRect</span> = rect;
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-3">🖼️ View.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { mat4, vec2, vec3 } <span class="hljs-keyword">from</span> <span class="hljs-string">'gl-matrix'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CanvasRect</span>, <span class="hljs-title class_">Vec2</span>, <span class="hljs-title class_">Mat4</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">View</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-attr">viewMatrix</span>: <span class="hljs-title class_">Mat4</span> = mat4.<span class="hljs-title function_">create</span>();
  <span class="hljs-keyword">public</span> <span class="hljs-attr">projectionMatrix</span>: <span class="hljs-title class_">Mat4</span> = mat4.<span class="hljs-title function_">create</span>();

  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasRect</span>: <span class="hljs-title class_">CanvasRect</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">canvasRect: CanvasRect</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRect</span> = canvasRect;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateProjectionMatrix</span>(); <span class="hljs-comment">// 默认正交投影</span>
  }

  <span class="hljs-title function_">updateViewMatrix</span>(<span class="hljs-attr">eye</span>: <span class="hljs-title class_">Vec2</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-attr">center</span>: <span class="hljs-title class_">Vec2</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>], <span class="hljs-attr">up</span>: <span class="hljs-title class_">Vec2</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">eye3</span>: <span class="hljs-title class_">Vec3</span> = [eye[<span class="hljs-number">0</span>], eye[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> <span class="hljs-attr">center3</span>: <span class="hljs-title class_">Vec3</span> = [center[<span class="hljs-number">0</span>], center[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> <span class="hljs-attr">up3</span>: <span class="hljs-title class_">Vec3</span> = [up[<span class="hljs-number">0</span>], up[<span class="hljs-number">1</span>], <span class="hljs-number">1</span>]; <span class="hljs-comment">// z 轴轻微上扬避免退化</span>
    mat4.<span class="hljs-title function_">lookAt</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">viewMatrix</span>, eye3, center3, up3);
  }

  <span class="hljs-title function_">updateProjectionMatrix</span>(<span class="hljs-attr">near</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>, <span class="hljs-attr">far</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> { width, height } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRect</span>;
    mat4.<span class="hljs-title function_">ortho</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">projectionMatrix</span>, <span class="hljs-number">0</span>, width, height, <span class="hljs-number">0</span>, near, far);
  }

  <span class="hljs-comment">// 屏幕坐标 → NDC (-1 ~ 1)</span>
  <span class="hljs-title function_">screenToNDC</span>(<span class="hljs-attr">screenPos</span>: <span class="hljs-title class_">Vec2</span>): <span class="hljs-title class_">Vec2</span> {
    <span class="hljs-keyword">const</span> { width, height } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasRect</span>;
    <span class="hljs-keyword">return</span> [
      (screenPos[<span class="hljs-number">0</span>] / width) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>,
      (screenPos[<span class="hljs-number">1</span>] / height) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span>
    ];
  }

  <span class="hljs-comment">// NDC → 世界坐标（假设 Z=0）</span>
  <span class="hljs-title function_">ndcToWorld</span>(<span class="hljs-attr">ndc</span>: <span class="hljs-title class_">Vec2</span>): <span class="hljs-title class_">Vec2</span> {
    <span class="hljs-keyword">const</span> invViewProj = mat4.<span class="hljs-title function_">create</span>();
    mat4.<span class="hljs-title function_">multiply</span>(invViewProj, <span class="hljs-variable language_">this</span>.<span class="hljs-property">projectionMatrix</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">viewMatrix</span>);
    mat4.<span class="hljs-title function_">invert</span>(invViewProj, invViewProj);

    <span class="hljs-keyword">const</span> pt4 = vec3.<span class="hljs-title function_">fromValues</span>(ndc[<span class="hljs-number">0</span>], ndc[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);
    vec3.<span class="hljs-title function_">transformMat4</span>(pt4, pt4, invViewProj);
    <span class="hljs-keyword">return</span> [pt4[<span class="hljs-number">0</span>], pt4[<span class="hljs-number">1</span>]];
  }

  <span class="hljs-comment">// 屏幕坐标 → 世界坐标</span>
  <span class="hljs-title function_">screenToWorld</span>(<span class="hljs-attr">screenPos</span>: <span class="hljs-title class_">Vec2</span>): <span class="hljs-title class_">Vec2</span> {
    <span class="hljs-keyword">const</span> ndc = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">screenToNDC</span>(screenPos);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">ndcToWorld</span>(ndc);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-4">⚙️ GLBuffer.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BufferType</span> {
  <span class="hljs-variable constant_">ARRAY_BUFFER</span> = <span class="hljs-number">0x8892</span>,        <span class="hljs-comment">// position, color, etc.</span>
  <span class="hljs-variable constant_">ELEMENT_ARRAY_BUFFER</span> = <span class="hljs-number">0x8893</span> <span class="hljs-comment">// indices</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UsageHint</span> {
  <span class="hljs-variable constant_">STATIC_DRAW</span> = <span class="hljs-number">0x88e4</span>,
  <span class="hljs-variable constant_">DYNAMIC_DRAW</span> = <span class="hljs-number">0x88e8</span>,
  <span class="hljs-variable constant_">STREAM_DRAW</span> = <span class="hljs-number">0x88e0</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GLBuffer</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">WebGLBuffer</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">gl</span>: <span class="hljs-title class_">WebGL2RenderingContext</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    gl: WebGL2RenderingContext,
    <span class="hljs-keyword">type</span>: BufferType,
    usage: UsageHint = UsageHint.STATIC_DRAW
  </span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = gl;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = gl.<span class="hljs-title function_">createBuffer</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-keyword">type</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unbind</span>(<span class="hljs-keyword">type</span>);
  }

  <span class="hljs-title function_">bind</span>(<span class="hljs-attr">type</span>: <span class="hljs-title class_">BufferType</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">bindBuffer</span>(<span class="hljs-keyword">type</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>);
  }

  <span class="hljs-title function_">unbind</span>(<span class="hljs-attr">type</span>: <span class="hljs-title class_">BufferType</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">bindBuffer</span>(<span class="hljs-keyword">type</span>, <span class="hljs-literal">null</span>);
  }

  <span class="hljs-title function_">data</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">Float32Array</span> | <span class="hljs-title class_">Uint16Array</span> | <span class="hljs-title class_">Uint32Array</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">BufferType</span>, <span class="hljs-attr">usage</span>: <span class="hljs-title class_">UsageHint</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-keyword">type</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">bufferData</span>(<span class="hljs-keyword">type</span>, data, usage);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unbind</span>(<span class="hljs-keyword">type</span>);
  }

  <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">deleteBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = <span class="hljs-literal">null</span>;
    }
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">🧱 VertexLayout.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AttributeInfo</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;     <span class="hljs-comment">// components per vertex (e.g., 2 for vec2)</span>
  <span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>;     <span class="hljs-comment">// gl.FLOAT, etc.</span>
  <span class="hljs-attr">normalized</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">stride</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">offset</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VertexLayout</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">attributes</span>: <span class="hljs-title class_">AttributeInfo</span>[] = [];

  <span class="hljs-title function_">addAttribute</span>(<span class="hljs-attr">info</span>: <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">AttributeInfo</span>, <span class="hljs-string">'stride'</span> | <span class="hljs-string">'offset'</span>&gt;): <span class="hljs-variable language_">this</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attributes</span>.<span class="hljs-title function_">push</span>({ ...info, <span class="hljs-attr">stride</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span> });
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">computeOffsetsAndStride</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">let</span> stride = <span class="hljs-number">0</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attributes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">attr</span> =&gt;</span> {
      attr.<span class="hljs-property">offset</span> = offset;
      <span class="hljs-keyword">const</span> typeSize = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTypeSize</span>(attr.<span class="hljs-property">type</span>);
      offset += attr.<span class="hljs-property">size</span> * typeSize;
    });

    stride = offset;

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">attributes</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">attr</span> =&gt;</span> {
      attr.<span class="hljs-property">stride</span> = stride;
    });

    <span class="hljs-keyword">return</span> stride;
  }

  <span class="hljs-title function_">getAttributes</span>(): <span class="hljs-keyword">readonly</span> <span class="hljs-title class_">AttributeInfo</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">attributes</span>;
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getTypeSize</span>(<span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">type</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1406</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>; <span class="hljs-comment">// FLOAT</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1404</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>; <span class="hljs-comment">// INT</span>
      <span class="hljs-keyword">case</span> <span class="hljs-number">0x1405</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>; <span class="hljs-comment">// UNSIGNED_INT</span>
      <span class="hljs-attr">default</span>: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Unsupported GL type: <span class="hljs-subst">${<span class="hljs-keyword">type</span>}</span>`</span>);
    }
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-6">🧩 VertexArray.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VertexArray</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vao</span>: <span class="hljs-title class_">WebGLVertexArrayObjectOES</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">vbo</span>: <span class="hljs-title class_">GLBuffer</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">ibo</span>: <span class="hljs-title class_">GLBuffer</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">layout</span>: <span class="hljs-title class_">VertexLayout</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">gl</span>: <span class="hljs-title class_">WebGL2RenderingContext</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    gl: WebGL2RenderingContext,
    vbo: GLBuffer,
    layout: VertexLayout,
    ibo?: GLBuffer
  </span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = gl;
    <span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">'OES_vertex_array_object'</span>);
    <span class="hljs-keyword">if</span> (!ext) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'OES_vertex_array_object not supported'</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vao</span> = ext.<span class="hljs-title function_">createVertexArray</span>()!;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vbo</span> = vbo;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layout</span> = layout;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ibo</span> = ibo || <span class="hljs-literal">null</span>;

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bind</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vbo</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ARRAY_BUFFER</span>);

    <span class="hljs-keyword">const</span> stride = layout.<span class="hljs-title function_">computeOffsetsAndStride</span>();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> attr <span class="hljs-keyword">of</span> layout.<span class="hljs-title function_">getAttributes</span>()) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">enableVertexAttribArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getAttribLocation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCurrentProgram</span>(), attr.<span class="hljs-property">name</span>));
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">vertexAttribPointer</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getAttribLocation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCurrentProgram</span>(), attr.<span class="hljs-property">name</span>),
        attr.<span class="hljs-property">size</span>,
        attr.<span class="hljs-property">type</span>,
        attr.<span class="hljs-property">normalized</span>,
        attr.<span class="hljs-property">stride</span>,
        attr.<span class="hljs-property">offset</span>
      );
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">ibo</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">ibo</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>);
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unbind</span>();
  }

  <span class="hljs-title function_">bind</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> ext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">'OES_vertex_array_object'</span>);
    ext!.<span class="hljs-title function_">bindVertexArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vao</span>);
  }

  <span class="hljs-title function_">unbind</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> ext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">'OES_vertex_array_object'</span>);
    ext!.<span class="hljs-title function_">bindVertexArray</span>(<span class="hljs-literal">null</span>);
  }

  <span class="hljs-title function_">drawElements</span>(<span class="hljs-attr">mode</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">offset</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bind</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">drawElements</span>(mode, count, <span class="hljs-keyword">type</span>, offset);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unbind</span>();
  }

  <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> ext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">'OES_vertex_array_object'</span>);
    ext!.<span class="hljs-title function_">deleteVertexArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vao</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vbo</span>.<span class="hljs-title function_">destroy</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">ibo</span>?.<span class="hljs-title function_">destroy</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getCurrentProgram</span>(): <span class="hljs-title class_">WebGLProgram</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getParameter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">CURRENT_PROGRAM</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">🎯 Shader.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ShaderType</span> {
  <span class="hljs-variable constant_">VERTEX</span> = <span class="hljs-number">0x8b31</span>,
  <span class="hljs-variable constant_">FRAGMENT</span> = <span class="hljs-number">0x8b30</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Shader</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">shader</span>: <span class="hljs-title class_">WebGLShader</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">gl</span>: <span class="hljs-title class_">WebGL2RenderingContext</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">gl: WebGL2RenderingContext, source: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: ShaderType</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = gl;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span> = gl.<span class="hljs-title function_">createShader</span>(<span class="hljs-keyword">type</span>)!;
    gl.<span class="hljs-title function_">shaderSource</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>, source);
    gl.<span class="hljs-title function_">compileShader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>);

    <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getShaderParameter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>, gl.<span class="hljs-property">COMPILE_STATUS</span>)) {
      <span class="hljs-keyword">const</span> log = gl.<span class="hljs-title function_">getShaderInfoLog</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Shader compilation failed:\n<span class="hljs-subst">${log}</span>`</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Shader compile error: <span class="hljs-subst">${log}</span>`</span>);
    }
  }

  <span class="hljs-title function_">getRaw</span>(): <span class="hljs-title class_">WebGLShader</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>;
  }

  <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">deleteShader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">shader</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-8">🧩 ShaderProgram.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShaderProgram</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">program</span>: <span class="hljs-title class_">WebGLProgram</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">gl</span>: <span class="hljs-title class_">WebGL2RenderingContext</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">gl: WebGL2RenderingContext, vertexShader: Shader, fragmentShader: Shader</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = gl;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span> = gl.<span class="hljs-title function_">createProgram</span>()!;
    gl.<span class="hljs-title function_">attachShader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>, vertexShader.<span class="hljs-title function_">getRaw</span>());
    gl.<span class="hljs-title function_">attachShader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>, fragmentShader.<span class="hljs-title function_">getRaw</span>());
    gl.<span class="hljs-title function_">linkProgram</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>);

    <span class="hljs-keyword">if</span> (!gl.<span class="hljs-title function_">getProgramParameter</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>, gl.<span class="hljs-property">LINK_STATUS</span>)) {
      <span class="hljs-keyword">const</span> log = gl.<span class="hljs-title function_">getProgramInfoLog</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Program link failed: <span class="hljs-subst">${log}</span>`</span>);
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Program link error: <span class="hljs-subst">${log}</span>`</span>);
    }
  }

  <span class="hljs-title function_">use</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">useProgram</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>);
  }

  <span class="hljs-title function_">getUniformLocation</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">WebGLUniformLocation</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">getUniformLocation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>, name);
  }

  <span class="hljs-title function_">setUniformMatrix4fv</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-title class_">Float32Array</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> loc = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUniformLocation</span>(name);
    <span class="hljs-keyword">if</span> (loc) <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">uniformMatrix4fv</span>(loc, <span class="hljs-literal">false</span>, value);
  }

  <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">deleteProgram</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-9">🧱 RenderGeometry.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RenderGeometry</span> {
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">positions</span>: <span class="hljs-title class_">Float32Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">protected</span> <span class="hljs-attr">indices</span>: <span class="hljs-title class_">Uint16Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>(<span class="hljs-number">0</span>);

  <span class="hljs-title function_">getPositions</span>(): <span class="hljs-title class_">Float32Array</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">positions</span>;
  }

  <span class="hljs-title function_">getIndices</span>(): <span class="hljs-title class_">Uint16Array</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">indices</span>;
  }

  <span class="hljs-title function_">getCount</span>(): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">indices</span>.<span class="hljs-property">length</span>;
  }
}

<span class="hljs-comment">// 示例：用两个三角形模拟一条线段（加宽）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RenderSegment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderGeometry</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">start: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>], end: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>], thickness: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span></span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-keyword">const</span> dx = end[<span class="hljs-number">0</span>] - start[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">const</span> dy = end[<span class="hljs-number">1</span>] - start[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> len = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">hypot</span>(dx, dy);
    <span class="hljs-keyword">if</span> (len === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> nx = dy / len * thickness * <span class="hljs-number">0.5</span>;
    <span class="hljs-keyword">const</span> ny = -dx / len * thickness * <span class="hljs-number">0.5</span>;

    <span class="hljs-keyword">const</span> p0 = [start[<span class="hljs-number">0</span>] - nx, start[<span class="hljs-number">1</span>] - ny];
    <span class="hljs-keyword">const</span> p1 = [start[<span class="hljs-number">0</span>] + nx, start[<span class="hljs-number">1</span>] + ny];
    <span class="hljs-keyword">const</span> p2 = [end[<span class="hljs-number">0</span>] + nx, end[<span class="hljs-number">1</span>] + ny];
    <span class="hljs-keyword">const</span> p3 = [end[<span class="hljs-number">0</span>] - nx, end[<span class="hljs-number">1</span>] - ny];

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">positions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
      p0[<span class="hljs-number">0</span>], p0[<span class="hljs-number">1</span>],
      p1[<span class="hljs-number">0</span>], p1[<span class="hljs-number">1</span>],
      p2[<span class="hljs-number">0</span>], p2[<span class="hljs-number">1</span>],
      p3[<span class="hljs-number">0</span>], p3[<span class="hljs-number">1</span>]
    ]);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">indices</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-10">🖌️ Renderer2D.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { mat4 } <span class="hljs-keyword">from</span> <span class="hljs-string">'gl-matrix'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Renderer2D</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">program</span>: <span class="hljs-title class_">ShaderProgram</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">uProjection</span>: <span class="hljs-title class_">WebGLUniformLocation</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">uView</span>: <span class="hljs-title class_">WebGLUniformLocation</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">program: ShaderProgram</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span> = program;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-title function_">use</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uProjection</span> = program.<span class="hljs-title function_">getUniformLocation</span>(<span class="hljs-string">'uProjection'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uView</span> = program.<span class="hljs-title function_">getUniformLocation</span>(<span class="hljs-string">'uView'</span>);
  }

  <span class="hljs-title function_">render</span>(<span class="hljs-attr">geometries</span>: <span class="hljs-title class_">RenderGeometry</span>[], <span class="hljs-attr">viewMatrix</span>: mat4, <span class="hljs-attr">projectionMatrix</span>: mat4): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-title function_">use</span>();

    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uProjection</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-title function_">setUniformMatrix4fv</span>(<span class="hljs-string">'uProjection'</span>, projectionMatrix);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">uView</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-title function_">setUniformMatrix4fv</span>(<span class="hljs-string">'uView'</span>, viewMatrix);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> geom <span class="hljs-keyword">of</span> geometries) {
      <span class="hljs-keyword">const</span> vbo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>, <span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ARRAY_BUFFER</span>);
      vbo.<span class="hljs-title function_">data</span>(geom.<span class="hljs-title function_">getPositions</span>(), <span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-title class_">UsageHint</span>.<span class="hljs-property">STATIC_DRAW</span>);

      <span class="hljs-keyword">const</span> ibo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>, <span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>);
      ibo.<span class="hljs-title function_">data</span>(geom.<span class="hljs-title function_">getIndices</span>(), <span class="hljs-title class_">BufferType</span>.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>, <span class="hljs-title class_">UsageHint</span>.<span class="hljs-property">STATIC_DRAW</span>);

      <span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexLayout</span>()
        .<span class="hljs-title function_">addAttribute</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">'aPosition'</span>,
          <span class="hljs-attr">size</span>: <span class="hljs-number">2</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">FLOAT</span>,
          <span class="hljs-attr">normalized</span>: <span class="hljs-literal">false</span>
        });

      <span class="hljs-keyword">const</span> vao = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VertexArray</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>, vbo, layout, ibo);
      vao.<span class="hljs-title function_">drawElements</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">TRIANGLES</span>, geom.<span class="hljs-title function_">getCount</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">program</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-number">0</span>);
      vao.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 简单示例中每帧重建，实际可用对象池优化</span>
    }
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-11">🧠 CanvasCore.ts</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanvasCore</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">gl</span>: <span class="hljs-title class_">WebGL2RenderingContext</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">renderer</span>: <span class="hljs-title class_">Renderer2D</span>;
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">config</span>: <span class="hljs-title class_">CanvasConfig</span>;

  <span class="hljs-keyword">private</span> <span class="hljs-attr">geometries</span>: <span class="hljs-title class_">RenderGeometry</span>[] = [];
  <span class="hljs-keyword">public</span> <span class="hljs-attr">isDrawing</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    gl: WebGL2RenderingContext,
    renderer: Renderer2D,
    config: CanvasConfig
  </span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span> = gl;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span> = renderer;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">config</span> = config;
  }

  <span class="hljs-title function_">renderFrame</span>(<span class="hljs-attr">viewMatrix</span>: <span class="hljs-title class_">Float32Array</span>, <span class="hljs-attr">projectionMatrix</span>: <span class="hljs-title class_">Float32Array</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-title function_">clear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">COLOR_BUFFER_BIT</span> | <span class="hljs-variable language_">this</span>.<span class="hljs-property">gl</span>.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">render</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">geometries</span>, viewMatrix, projectionMatrix);
  }

  <span class="hljs-title function_">addGeometry</span>(<span class="hljs-attr">geom</span>: <span class="hljs-title class_">RenderGeometry</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDrawing</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">geometries</span>.<span class="hljs-title function_">push</span>(geom);
    }
  }

  <span class="hljs-title function_">clearGeometries</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">geometries</span> = [];
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">🖱️ EventModule.ts（支持 zoom/pan）</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./View'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CanvasCore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./CanvasCore'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RenderSegment</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./RenderGeometry'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventModule</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">view</span>: <span class="hljs-title class_">View</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">core</span>: <span class="hljs-title class_">CanvasCore</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">lastPanPoint</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">view: View, core: CanvasCore</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span> = view;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">core</span> = core;
  }

  <span class="hljs-title function_">onPanStart</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span> = [x, y];
  }

  <span class="hljs-title function_">onPanMove</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> delta = [x - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>[<span class="hljs-number">0</span>], y - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>[<span class="hljs-number">1</span>]];
    <span class="hljs-keyword">const</span> startWorld = <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-title function_">screenToWorld</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>);
    <span class="hljs-keyword">const</span> currentWorld = <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-title function_">screenToWorld</span>([x, y]);

    <span class="hljs-keyword">const</span> panDelta = [startWorld[<span class="hljs-number">0</span>] - currentWorld[<span class="hljs-number">0</span>], startWorld[<span class="hljs-number">1</span>] - currentWorld[<span class="hljs-number">1</span>]];

    <span class="hljs-keyword">const</span> translation = [panDelta[<span class="hljs-number">0</span>], panDelta[<span class="hljs-number">1</span>]];
    <span class="hljs-keyword">const</span> translateMat = mat4.<span class="hljs-title function_">create</span>();
    mat4.<span class="hljs-title function_">translate</span>(translateMat, <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, translation);
    mat4.<span class="hljs-title function_">copy</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, translateMat);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span> = [x, y];
  }

  <span class="hljs-title function_">onZoom</span>(<span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">centerX</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">centerY</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> worldCenterBefore = <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-title function_">screenToWorld</span>([centerX, centerY]);

    <span class="hljs-comment">// 缩放 view matrix（可改为修改投影）</span>
    <span class="hljs-keyword">const</span> scaleMat = mat4.<span class="hljs-title function_">create</span>();
    mat4.<span class="hljs-title function_">scale</span>(scaleMat, <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, [scale, scale, <span class="hljs-number">1</span>]);
    mat4.<span class="hljs-title function_">copy</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, scaleMat);

    <span class="hljs-keyword">const</span> worldCenterAfter = <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-title function_">screenToWorld</span>([centerX, centerY]);

    <span class="hljs-keyword">const</span> fix = [
      worldCenterBefore[<span class="hljs-number">0</span>] - worldCenterAfter[<span class="hljs-number">0</span>],
      worldCenterBefore[<span class="hljs-number">1</span>] - worldCenterAfter[<span class="hljs-number">1</span>]
    ];

    mat4.<span class="hljs-title function_">translate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">view</span>.<span class="hljs-property">viewMatrix</span>, [fix[<span class="hljs-number">0</span>], fix[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>]);
  }

  <span class="hljs-title function_">onMouseDown</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">core</span>.<span class="hljs-property">isDrawing</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPanStart</span>(x, y);
  }

  <span class="hljs-title function_">onMouseMove</span>(<span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">core</span>.<span class="hljs-property">isDrawing</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>) {
      <span class="hljs-keyword">const</span> seg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderSegment</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span>, [x, y], <span class="hljs-number">2</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">core</span>.<span class="hljs-title function_">addGeometry</span>(seg);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span> = [x, y];
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPanMove</span>(x, y);
    }
  }

  <span class="hljs-title function_">onMouseUp</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">core</span>.<span class="hljs-property">isDrawing</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastPanPoint</span> = <span class="hljs-literal">null</span>;
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-13">✅ 使用示例（外部调用）</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 假设你已获取 gl 上下文</span>
<span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'render-canvas'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLCanvasElement</span>;
<span class="hljs-keyword">const</span> gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'webgl2'</span>)!;

<span class="hljs-comment">// 配置</span>
<span class="hljs-keyword">const</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasConfig</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">width</span>: canvas.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>: canvas.<span class="hljs-property">height</span> });
<span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>(config.<span class="hljs-property">canvasClientRect</span>);

<span class="hljs-comment">// 着色器</span>
<span class="hljs-keyword">const</span> vs = <span class="hljs-string">`
  attribute vec2 aPosition;
  uniform mat4 uView;
  uniform mat4 uProjection;
  void main() {
    gl_Position = uProjection * uView * vec4(aPosition, 0, 1);
  }
`</span>;

<span class="hljs-keyword">const</span> fs = <span class="hljs-string">`
  precision mediump float;
  void main() {
    gl_FragColor = vec4(1, 0, 0, 1);
  }
`</span>;

<span class="hljs-keyword">const</span> vertexShader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shader</span>(gl, vs, <span class="hljs-title class_">ShaderType</span>.<span class="hljs-property">VERTEX</span>);
<span class="hljs-keyword">const</span> fragmentShader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shader</span>(gl, fs, <span class="hljs-title class_">ShaderType</span>.<span class="hljs-property">FRAGMENT</span>);
<span class="hljs-keyword">const</span> program = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShaderProgram</span>(gl, vertexShader, fragmentShader);
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Renderer2D</span>(program);

<span class="hljs-keyword">const</span> core = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasCore</span>(gl, renderer, config);
<span class="hljs-keyword">const</span> eventModule = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventModule</span>(view, core);

<span class="hljs-comment">// 绑定事件（此处仅为示意）</span>
canvas.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> rect = canvas.<span class="hljs-title function_">getBoundingClientRect</span>();
  eventModule.<span class="hljs-title function_">onMouseDown</span>(e.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>, e.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>);
});

<span class="hljs-comment">// 动画循环</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
  core.<span class="hljs-title function_">renderFrame</span>(view.<span class="hljs-property">viewMatrix</span>, view.<span class="hljs-property">projectionMatrix</span>);
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<hr/>
<h2 data-id="heading-14">🌟 特点总结</h2>





































<table><thead><tr><th>模块</th><th>职责说明</th></tr></thead><tbody><tr><td><code>CanvasCore</code></td><td>核心协调器，持有状态</td></tr><tr><td><code>Renderer2D</code></td><td>渲染几何体列表</td></tr><tr><td><code>RenderGeometry</code></td><td>几何数据生成（如线段）</td></tr><tr><td><code>GLBuffer/VAO</code></td><td>GPU 数据管理</td></tr><tr><td><code>ShaderProgram</code></td><td>着色器编译与使用</td></tr><tr><td><code>View</code></td><td>相机控制，坐标转换</td></tr><tr><td><code>EventModule</code></td><td>支持交互（zoom/pan/draw）</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CG-01： 深入理解 2D 变换的数学原理]]></title>    <link>https://juejin.cn/post/7578332586063069235</link>    <guid>https://juejin.cn/post/7578332586063069235</guid>    <pubDate>2025-12-01T04:39:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578332586063069235" data-draft-id="7578442185847242790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CG-01： 深入理解 2D 变换的数学原理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T04:39:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拜晨"/> <meta itemprop="url" content="https://juejin.cn/user/4160207732090168"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CG-01： 深入理解 2D 变换的数学原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4160207732090168/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拜晨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:39:35.000Z" title="Mon Dec 01 2025 04:39:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>开个坑学习计算机图形学，希望能坚持下去</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaichen.vercel.app%2Fblog%2F2d-transform" target="_blank" title="https://baichen.vercel.app/blog/2d-transform" ref="nofollow noopener noreferrer">baichen.vercel.app/blog/2d-tra…</a> , 可以查看交互式文章</p>
<h2 data-id="heading-0">css中的transform</h2>
<p>css中的transform属性可以实现2D的变换，包括平移、旋转、缩放和倾斜。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(<span class="hljs-number">10px</span>, <span class="hljs-number">20px</span>) <span class="hljs-built_in">rotate</span>(<span class="hljs-number">30deg</span>) <span class="hljs-built_in">scale</span>(<span class="hljs-number">1.5</span>) <span class="hljs-built_in">skew</span>(<span class="hljs-number">10deg</span>, <span class="hljs-number">20deg</span>);
</code></pre>
<p>这背后其实是通过矩阵变换实现的，css中的transform属性就是将一个2D的点(x, y)通过一个3x3的矩阵变换为另一个2D的点(x', y')。</p>
<p>你可能会问，为什么跟矩阵有关系？</p>
<h2 data-id="heading-1">变换和矩阵是怎么关联上的？</h2>
<p>我们可以建立一个坐标系，所有的点都有一个坐标 <code>(x, y)</code>，这个坐标可以看作一个向量 <code>[x, y]</code>。</p>
<p>如果我们想对一个图形进行缩放，我们可以将<strong>每个点的坐标</strong>乘以一个缩放因子。用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">x'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">y'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 表示变换后的坐标，用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span></span></span></span></span> 表示缩放因子，则有：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>x</mi><mo>∗</mo><mi>s</mi><mspace linebreak="newline"/><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>y</mi><mo>∗</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">x' = x * s \\
y' = y * s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4653em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.9963em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span></span></span></span></span></div>
<p>这个有2步计算，其实这个算法可以写成乘法，即：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mi>s</mi><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
x' \\
y'
\end{bmatrix}
= s \begin{bmatrix}
x \\
y
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></div>
<p>假设缩放因子 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mo>=</mo><mn>1.5</mn></mrow><annotation encoding="application/x-tex">s = 1.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1.5</span></span></span></span></span>，我们可以用一个矩阵来表示：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.5</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
1.5 &amp; 0  \\
0 &amp; 1.5 
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.5</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></div>
<p>可以看到，矩形被放大了1.5倍，但位置保持不变（因为原点在中心）。蓝色虚线框是原始矩形，蓝色实线框是变换后的矩形。</p>
<p>那么对于旋转是怎样的呢？比如我们要实现顺时针旋转30度。对于点(x, y), 他旋转后的位置，可以用三角函数来计算：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>x</mi><mo>∗</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo><mo>−</mo><mi>y</mi><mo>∗</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo><mspace linebreak="newline"/><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>x</mi><mo>∗</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo><mo>+</mo><mi>y</mi><mo>∗</mo><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x' = x * cos(30deg) - y * sin(30deg) \\
y' = x * sin(30deg) + y * cos(30deg)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4653em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.9963em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.4653em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6597em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span></span></div>
<p>这个有2步计算，其实这个算法可以写成矩阵乘法，即：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
x' \\
y'
\end{bmatrix}
= \begin{bmatrix}
cos(30deg) &amp; -sin(30deg) \\
sin(30deg) &amp; cos(30deg) \\
\end{bmatrix} \begin{bmatrix}
x \\
y
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></div>
<p>这个旋转矩阵的几何意义是：旋转后的向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>v</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">v'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 是原向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span></span> 和垂直向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mo>⊥</mo></msub></mrow><annotation encoding="application/x-tex">v_\perp</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mrel mtight">⊥</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span> 的线性组合，即 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>v</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>v</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo>+</mo><msub><mi>v</mi><mo>⊥</mo></msub><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">v' = v \cos\theta + v_\perp \sin\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mrel mtight">⊥</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span>。</p>
<p><strong>通过上面的例子，我们知道，矩阵的作用就是简化计算，将多个计算步骤合并为一个步骤。</strong></p>
<h2 data-id="heading-2">齐次矩阵</h2>
<p>上面没有讨论平移，很容易想到，平移一个点就是将点(x, y)加上一个平移量(tx, ty)，即：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>x</mi><mo>+</mo><mi>t</mi><mi>x</mi><mspace linebreak="newline"/><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>y</mi><mo>+</mo><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">x' = x + tx \\
y' = y + ty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8019em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6151em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span><span class="mspace newline"/><span class="base"><span class="strut" style="height:0.9963em;vertical-align:-0.1944em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></div>
<p>但是发现没办法用矩阵乘法来表示， 我们不想让平移这么特殊， 所以为了实现通过矩阵乘法得到 <code>x ' = x + tx</code> 和 <code>y ' = y + ty</code>，我们给x和y增加一个维度，即：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi><mo>+</mo><mi>t</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>y</mi><mo>+</mo><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix}
= \begin{bmatrix}
1 &amp; 0 &amp; tx \\
0 &amp; 1 &amp; ty \\
0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
= \begin{bmatrix}
x + tx \\
y + ty \\
1
\end{bmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>坐标点(x, y)变成了(x, y, 1)，最后一个维度只用来保持矩阵的维度一致，实际没意义。
矩阵增加了1行1列，变成了3x3的矩阵。最后一行固定为0, 0, 1。
最后一列固定为tx, ty, 1。
tx 和 ty 是平移量。</p>
<h2 data-id="heading-3">统一变换矩阵</h2>
<p>通过引入齐次矩阵，我们可以将缩放、旋转、平移的的计算都写成矩阵的乘法，抽象一下，即：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>x</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>b</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>d</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix} = \begin{bmatrix}
a &amp; b &amp; tx \\
c &amp; d &amp; ty \\
0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
x \\
y \\
1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">b</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">d</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>其中a, b, c, d, 根据不同的变换，会有不同的值。tx和ty是平移量。</p>
<h3 data-id="heading-4">平移矩阵</h3>
<p>平移矩阵为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
1 &amp; 0 &amp; tx \\
0 &amp; 1 &amp; ty \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">x</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<h3 data-id="heading-5">缩放矩阵</h3>
<p>缩放矩阵为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>s</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>s</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
s &amp; 0 &amp; 0 \\
0 &amp; s &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">s</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">s</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>其中s是缩放因子。</p>
<h3 data-id="heading-6">旋转矩阵</h3>
<p>旋转矩阵为：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
cos(\theta) &amp; -sin(\theta) &amp; 0 \\
sin(\theta) &amp; cos(\theta) &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> 是旋转角度。</p>
<h3 data-id="heading-7">斜切(skew)</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2FReference%2FValues%2Ftransform-function%2Fskew" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/Reference/Values/transform-function/skew" ref="nofollow noopener noreferrer">斜切</a>是把图形沿着x轴或y轴倾斜一定的角度。</p>
<p>有点类似于把一个矩形拉伸成平行四边形。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>t</mi><mi>a</mi><mi>n</mi><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}
1 &amp; tan(\theta) &amp; 0 \\
0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span> 是斜切角度。</p>
<h2 data-id="heading-8">矩阵乘法的好处</h2>
<p>矩阵乘法有几个性质特别好：</p>
<ol>
<li>结合律：(AB)C = A(BC)</li>
<li>分配律：A(B+C) = AB + AC</li>
<li>单位矩阵：I * A = A * I = A</li>
</ol>
<p>所以我们可以将多个变换矩阵相乘，得到一个最终的变换矩阵。</p>
<p>比如我们要实现一个缩放和旋转的变换，我们可以将缩放矩阵和旋转矩阵相乘，得到一个最终的变换矩阵，这样我们只需要计算一次，就可以得到最终的变换结果。</p>
<p>比如要实现图形先缩放1.5倍，再旋转30度，我们可以将缩放矩阵和旋转矩阵相乘，得到一个最终的变换矩阵，这样我们只需要计算一次，就可以得到最终的变换结果。</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.5</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mo stretchy="false">(</mo><mn>30</mn><mi>d</mi><mi>e</mi><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.75</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.75</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M = 
\begin{bmatrix}
1.5 &amp; 0 &amp; 0 \\
0 &amp; 1.5 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix} \begin{bmatrix}
cos(30deg) &amp; -sin(30deg) &amp; 0 \\
sin(30deg) &amp; cos(30deg) &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
= 

\begin{bmatrix}
1.3 &amp; -0.75 &amp; 0 \\
0.75 &amp; 1.3 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.5</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.5</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord mathnormal">s</span><span class="mord mathnormal">in</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal">cos</span><span class="mopen">(</span><span class="mord">30</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.3</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0.75</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">0.75</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.3</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>而且可以计算矩阵的逆矩阵，这样我们就可以实现反向变换。</p>
<p>计算逆矩阵可以用库来实现，比如<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftoishy%2Fmatrix.js" target="_blank" title="https://github.com/toishy/matrix.js" ref="nofollow noopener noreferrer">matrix.js</a>。</p>
<p>我们把上面这个矩阵的逆矩阵计算出来，然后应用到已经变换过的矩形上，就可以还原到原来的矩形。</p>
<p>设组合变换矩阵为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span>，原始矩形为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>，则：</p>
<ul>
<li>经过 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span> 变换后：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>M</mi><mo>⋅</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A' = M \cdot A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>（变换后的矩形）</li>
<li>对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">A'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 应用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">M^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span> 变换：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><mi>M</mi><mo>⋅</mo><mi>A</mi><mo>=</mo><mi>I</mi><mo>⋅</mo><mi>A</mi><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">M^{-1} \cdot A' = M^{-1} \cdot M \cdot A = I \cdot A = A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>（还原到原始矩形）</li>
</ul>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><msup><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.75</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.75</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1.3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.577</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.333</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>0.333</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0.577</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">
M^{-1} = 
\begin{bmatrix}
1.3 &amp; -0.75 &amp; 0 \\
0.75 &amp; 1.3 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix} ^ {-1} 
=
\begin{bmatrix}
0.577 &amp; 0.333 &amp; 0 \\
-0.333 &amp; 0.577 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8641em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.804em;vertical-align:-1.55em;"/><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.3</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0.75</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">0.75</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1.3</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:2.254em;"><span style="top:-4.5029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0.577</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">0.333</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0.333</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0.577</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></div>
<p>上面的例子展示了：原始矩形 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>（虚线）→ 经过 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span></span> 变换得到 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>M</mi><mo>⋅</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A' = M \cdot A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>（实线，变换后的）→ 对 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><annotation encoding="application/x-tex">A'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 应用 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">M^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span> 得到 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">M^{-1} \cdot A' = A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span>（实线，应该与原始矩形完全重合）。实际上，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>M</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><mi>M</mi><mo>=</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">M^{-1} \cdot M = I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span>（单位矩阵），所以最后一个矩形应该和原始矩形完全重合。</p>
<h2 data-id="heading-9">实际应用：实现类似 fabric.js 的画布</h2>
<p>有了这些矩阵变换的知识，我们可以实现一个类似 <a href="https://link.juejin.cn?target=http%3A%2F%2Ffabricjs.com%2F" target="_blank" title="http://fabricjs.com/" ref="nofollow noopener noreferrer">fabric.js</a> 的画布。我们使用 canvas + 矩阵变换来实现。</p>
<p>我们将一步步实现这个功能，从基础画布开始，逐步添加选择、拖动、缩放和旋转功能。</p>
<h3 data-id="heading-10">渲染画布和对象</h3>
<p>首先，我们需要创建一个 Canvas 画布，并在上面显示一些静态的矩形对象。</p>
<p>每个对象都有一个变换矩阵，初始时使用单位矩阵（无变换）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">objects</span>: <span class="hljs-title class_">CanvasObject</span>[] = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-string">"rect1"</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">"rect"</span>,
    <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">120</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">80</span>,
    <span class="hljs-attr">fill</span>: <span class="hljs-string">"#3b82f6"</span>,
    <span class="hljs-attr">stroke</span>: <span class="hljs-string">"#1e40af"</span>,
    <span class="hljs-attr">matrix</span>: [[<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]], <span class="hljs-comment">// 单位矩阵</span>
  },
  <span class="hljs-comment">// ...</span>
];
</code></pre>
<p>在 Canvas 上绘制对象时，我们需要使用 <code>setTransform</code> 或 <code>transform</code> 方法应用变换矩阵：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">drawObject</span> = (<span class="hljs-params">ctx: CanvasRenderingContext2D, obj: CanvasObject</span>) =&gt; {
  ctx.<span class="hljs-title function_">save</span>();
  
  <span class="hljs-comment">// 应用变换矩阵</span>
  <span class="hljs-keyword">const</span> m = obj.<span class="hljs-property">matrix</span>;
  ctx.<span class="hljs-title function_">setTransform</span>(m[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);
  
  <span class="hljs-comment">// 绘制矩形</span>
  ctx.<span class="hljs-property">fillStyle</span> = obj.<span class="hljs-property">fill</span>;
  ctx.<span class="hljs-title function_">fillRect</span>(obj.<span class="hljs-property">x</span>, obj.<span class="hljs-property">y</span>, obj.<span class="hljs-property">width</span>, obj.<span class="hljs-property">height</span>);
  
  ctx.<span class="hljs-property">strokeStyle</span> = obj.<span class="hljs-property">stroke</span>;
  ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span>;
  ctx.<span class="hljs-title function_">strokeRect</span>(obj.<span class="hljs-property">x</span>, obj.<span class="hljs-property">y</span>, obj.<span class="hljs-property">width</span>, obj.<span class="hljs-property">height</span>);
  
  ctx.<span class="hljs-title function_">restore</span>();
};
</code></pre>
<p><code>setTransform</code> 方法接受6个参数，对应变换矩阵的前两行：<code>(a, b, c, d, e, f)</code>，其中 <code>(a, b, c, d)</code> 是旋转和缩放部分，<code>(e, f)</code> 是平移部分。</p>
<h3 data-id="heading-11">对象选择功能</h3>
<p>在 Canvas 中，我们需要手动进行点击检测。当用户点击画布时，我们需要：</p>
<ol>
<li>将屏幕坐标转换为 Canvas 坐标</li>
<li>遍历所有对象，检查点击位置是否在对象内部（需要考虑变换矩阵）</li>
<li>如果点击到对象，记录选中的对象id</li>
</ol>
<h4 data-id="heading-12">点击检测</h4>
<p>我们需要实现：</p>
<ol>
<li>
<p>当点击对象的时候，记录选中的对象id。然后渲染对象的时候，给选中的对象添加一个边框。</p>
</li>
<li>
<p>点击空白区域，取消选中。</p>
</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 检查点是否在矩形内（考虑变换矩阵）</span>
<span class="hljs-keyword">const</span> isPointInObject = (<span class="hljs-attr">point</span>: { <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span> }, <span class="hljs-attr">obj</span>: <span class="hljs-title class_">CanvasObject</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> {
  <span class="hljs-comment">// 将点转换到对象的局部坐标系</span>
  <span class="hljs-keyword">const</span> invMatrix = <span class="hljs-title function_">inverseMatrix</span>(obj.<span class="hljs-property">matrix</span>);
  <span class="hljs-keyword">const</span> localPoint = <span class="hljs-title function_">transformPoint</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>, invMatrix);
  
  <span class="hljs-comment">// 检查点是否在矩形内</span>
  <span class="hljs-keyword">return</span> (
    localPoint.<span class="hljs-property">x</span> &gt;= obj.<span class="hljs-property">x</span> &amp;&amp;
    localPoint.<span class="hljs-property">x</span> &lt;= obj.<span class="hljs-property">x</span> + obj.<span class="hljs-property">width</span> &amp;&amp;
    localPoint.<span class="hljs-property">y</span> &gt;= obj.<span class="hljs-property">y</span> &amp;&amp;
    localPoint.<span class="hljs-property">y</span> &lt;= obj.<span class="hljs-property">y</span> + obj.<span class="hljs-property">height</span>
  );
};

<span class="hljs-comment">// 处理画布点击</span>
<span class="hljs-keyword">const</span> handleCanvasClick = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">e: React.MouseEvent&lt;HTMLCanvasElement&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> canvas = canvasRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">if</span> (!canvas) <span class="hljs-keyword">return</span>;
  
  <span class="hljs-comment">// 获取 Canvas 坐标</span>
  <span class="hljs-keyword">const</span> rect = canvas.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> x = e.<span class="hljs-property">clientX</span> - rect.<span class="hljs-property">left</span>;
  <span class="hljs-keyword">const</span> y = e.<span class="hljs-property">clientY</span> - rect.<span class="hljs-property">top</span>;
  
  <span class="hljs-comment">// 从后往前遍历对象（后绘制的在上层）</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = objects.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPointInObject</span>({ x, y }, objects[i])) {
      <span class="hljs-title function_">setSelectedId</span>(objects[i].<span class="hljs-property">id</span>);
      <span class="hljs-keyword">return</span>;
    }
  }
  
  <span class="hljs-comment">// 没有点击到任何对象</span>
  <span class="hljs-title function_">setSelectedId</span>(<span class="hljs-literal">null</span>);
}, [objects]);
</code></pre>
<h3 data-id="heading-13">实现拖动平移功能</h3>
<p>拖动平移需要：</p>
<ol>
<li>在鼠标按下时记录起始位置</li>
<li>在鼠标移动时计算位移，创建平移矩阵</li>
<li>将平移矩阵与对象的现有矩阵相乘</li>
</ol>
<h4 data-id="heading-14">坐标转换：屏幕坐标 → Canvas 坐标</h4>
<p><strong>重要</strong>：在 Canvas 元素的事件处理程序中，<code>e.clientX</code> 和 <code>e.clientY</code> 是<strong>屏幕坐标</strong>（相对于浏览器视口的像素坐标），而不是 Canvas 的坐标。</p>
<p>Canvas 的坐标系统可能因为 CSS 缩放等因素与屏幕坐标不一致。因此，我们需要将屏幕坐标转换为 Canvas 坐标：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将屏幕坐标转换为 Canvas 坐标</span>
<span class="hljs-keyword">const</span> screenToCanvas = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">clientX: <span class="hljs-built_in">number</span>, clientY: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> canvas = canvasRef.<span class="hljs-property">current</span>;
  <span class="hljs-keyword">if</span> (!canvas) <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
  
  <span class="hljs-keyword">const</span> rect = canvas.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-comment">// 计算缩放比例（考虑 CSS 缩放）</span>
  <span class="hljs-keyword">const</span> scaleX = canvas.<span class="hljs-property">width</span> / rect.<span class="hljs-property">width</span>;
  <span class="hljs-keyword">const</span> scaleY = canvas.<span class="hljs-property">height</span> / rect.<span class="hljs-property">height</span>;
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">x</span>: (clientX - rect.<span class="hljs-property">left</span>) * scaleX,
    <span class="hljs-attr">y</span>: (clientY - rect.<span class="hljs-property">top</span>) * scaleY,
  };
}, []);
</code></pre>
<p>这样可以将屏幕坐标转换为 Canvas 的实际像素坐标。</p>
<h4 data-id="heading-15">平移矩阵工具函数</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 matrix-utils.ts 中</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createTranslateMatrix</span>(<span class="hljs-params">tx: <span class="hljs-built_in">number</span>, ty: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">Matrix3</span>x3 {
  <span class="hljs-keyword">return</span> [
    [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, tx],
    [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, ty],
    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],
  ];
}
</code></pre>
<h4 data-id="heading-16">拖动处理函数</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> handleMouseMove = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">e: React.MouseEvent&lt;HTMLCanvasElement&gt;</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!isDragging || !selectedId) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// 将屏幕坐标转换为 Canvas 坐标</span>
  <span class="hljs-keyword">const</span> canvasPoint = <span class="hljs-title function_">screenToCanvas</span>(e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>);
  <span class="hljs-comment">// 计算在 Canvas 坐标系中的位移</span>
  <span class="hljs-keyword">const</span> dx = canvasPoint.<span class="hljs-property">x</span> - dragStart.<span class="hljs-property">x</span>;
  <span class="hljs-keyword">const</span> dy = canvasPoint.<span class="hljs-property">y</span> - dragStart.<span class="hljs-property">y</span>;

  <span class="hljs-comment">// 创建平移矩阵并应用到对象的变换矩阵</span>
  <span class="hljs-keyword">const</span> translateMat = <span class="hljs-title function_">createTranslateMatrix</span>(dx, dy);
  <span class="hljs-title function_">setObjects</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span>
    prev.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">id</span> === selectedId) {
        <span class="hljs-comment">// 将平移矩阵与现有矩阵相乘</span>
        <span class="hljs-keyword">const</span> newMatrix = <span class="hljs-title function_">multiplyMatrix</span>(translateMat, obj.<span class="hljs-property">matrix</span>);
        <span class="hljs-keyword">return</span> { ...obj, <span class="hljs-attr">matrix</span>: newMatrix };
      }
      <span class="hljs-keyword">return</span> obj;
    })
  );

  <span class="hljs-title function_">setDragStart</span>(canvasPoint);
}, [isDragging, selectedId, dragStart, screenToCanvas]);
</code></pre>
<h3 data-id="heading-17">实现缩放控制点</h3>
<p>缩放功能需要：</p>
<ol>
<li>计算对象的边界框（考虑变换）</li>
<li>在边界框的四个角显示控制点</li>
<li>拖动控制点时，根据到中心点的距离计算缩放比例</li>
<li>相对于对象中心进行缩放</li>
</ol>
<h4 data-id="heading-18">边界框计算</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> getObjectBounds = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">obj: CanvasObject</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> corners = [
    { <span class="hljs-attr">x</span>: obj.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: obj.<span class="hljs-property">y</span> },
    { <span class="hljs-attr">x</span>: obj.<span class="hljs-property">x</span> + obj.<span class="hljs-property">width</span>, <span class="hljs-attr">y</span>: obj.<span class="hljs-property">y</span> },
    { <span class="hljs-attr">x</span>: obj.<span class="hljs-property">x</span> + obj.<span class="hljs-property">width</span>, <span class="hljs-attr">y</span>: obj.<span class="hljs-property">y</span> + obj.<span class="hljs-property">height</span> },
    { <span class="hljs-attr">x</span>: obj.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: obj.<span class="hljs-property">y</span> + obj.<span class="hljs-property">height</span> },
  ];

  <span class="hljs-comment">// 将角点应用变换矩阵</span>
  <span class="hljs-keyword">const</span> transformedCorners = corners.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">corner</span>) =&gt;</span>
    <span class="hljs-title function_">transformPoint</span>(corner.<span class="hljs-property">x</span>, corner.<span class="hljs-property">y</span>, obj.<span class="hljs-property">matrix</span>)
  );

  <span class="hljs-keyword">const</span> xs = transformedCorners.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> c.<span class="hljs-property">x</span>);
  <span class="hljs-keyword">const</span> ys = transformedCorners.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> c.<span class="hljs-property">y</span>);
  <span class="hljs-keyword">const</span> minX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...xs);
  <span class="hljs-keyword">const</span> maxX = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...xs);
  <span class="hljs-keyword">const</span> minY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(...ys);
  <span class="hljs-keyword">const</span> maxY = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...ys);

  <span class="hljs-keyword">return</span> { minX, minY, maxX, maxY, <span class="hljs-attr">width</span>: maxX - minX, <span class="hljs-attr">height</span>: maxY - minY };
}, []);
</code></pre>
<h4 data-id="heading-19">缩放处理</h4>
<p>缩放需要相对于对象中心进行，所以需要：</p>
<ol>
<li>平移到原点</li>
<li>缩放</li>
<li>平移回原位置</li>
</ol>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (controlPointType === <span class="hljs-string">"corner"</span>) {
  <span class="hljs-keyword">const</span> centerX = transformOrigin.<span class="hljs-property">x</span>;
  <span class="hljs-keyword">const</span> centerY = transformOrigin.<span class="hljs-property">y</span>;

  <span class="hljs-comment">// 计算缩放比例</span>
  <span class="hljs-keyword">const</span> oldDist = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
    (dragStart.<span class="hljs-property">x</span> - centerX) ** <span class="hljs-number">2</span> + (dragStart.<span class="hljs-property">y</span> - centerY) ** <span class="hljs-number">2</span>
  );
  <span class="hljs-keyword">const</span> newDist = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(
    (canvasPoint.<span class="hljs-property">x</span> - centerX) ** <span class="hljs-number">2</span> + (canvasPoint.<span class="hljs-property">y</span> - centerY) ** <span class="hljs-number">2</span>
  );
  <span class="hljs-keyword">const</span> scale = newDist / oldDist;

  <span class="hljs-comment">// 相对于中心点缩放</span>
  <span class="hljs-keyword">const</span> translateToOrigin = <span class="hljs-title function_">createTranslateMatrix</span>(-centerX, -centerY);
  <span class="hljs-keyword">const</span> scaleMat = <span class="hljs-title function_">createScaleMatrix</span>(scale, scale);
  <span class="hljs-keyword">const</span> translateBack = <span class="hljs-title function_">createTranslateMatrix</span>(centerX, centerY);
  <span class="hljs-keyword">const</span> newMatrix = <span class="hljs-title function_">multiplyMatrix</span>(
    translateBack,
    <span class="hljs-title function_">multiplyMatrix</span>(scaleMat, translateToOrigin)
  );
  <span class="hljs-keyword">const</span> finalMatrix = <span class="hljs-title function_">multiplyMatrix</span>(newMatrix, selectedObj.<span class="hljs-property">matrix</span>);

  <span class="hljs-title function_">setObjects</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span>
    prev.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span>
      obj.<span class="hljs-property">id</span> === selectedId ? { ...obj, <span class="hljs-attr">matrix</span>: finalMatrix } : obj
    )
  );
}
</code></pre>
<h3 data-id="heading-20">实现旋转控制点</h3>
<p>旋转功能需要：</p>
<ol>
<li>在对象顶部添加旋转控制点</li>
<li>拖动时计算角度差</li>
<li>相对于对象中心进行旋转</li>
</ol>
<h4 data-id="heading-21">旋转矩阵工具函数</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 matrix-utils.ts 中</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createRotateMatrix</span>(<span class="hljs-params">angle: <span class="hljs-built_in">number</span></span>): <span class="hljs-title class_">Matrix3</span>x3 {
  <span class="hljs-keyword">const</span> cos = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(angle);
  <span class="hljs-keyword">const</span> sin = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(angle);
  <span class="hljs-keyword">return</span> [
    [cos, -sin, <span class="hljs-number">0</span>],
    [sin, cos, <span class="hljs-number">0</span>],
    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],
  ];
}
</code></pre>
<h4 data-id="heading-22">旋转处理</h4>
<p>旋转操作的核心是计算角度差。通过 <code>Math.atan2</code> 函数，我们可以从两个点的坐标计算出角度，然后计算它们的差值：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span> (controlPointType === <span class="hljs-string">"rotate"</span>) {
  <span class="hljs-keyword">const</span> centerX = transformOrigin.<span class="hljs-property">x</span>;
  <span class="hljs-keyword">const</span> centerY = transformOrigin.<span class="hljs-property">y</span>;

  <span class="hljs-comment">// 计算角度差</span>
  <span class="hljs-keyword">const</span> oldAngle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(dragStart.<span class="hljs-property">y</span> - centerY, dragStart.<span class="hljs-property">x</span> - centerX);
  <span class="hljs-keyword">const</span> newAngle = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">atan2</span>(canvasPoint.<span class="hljs-property">y</span> - centerY, canvasPoint.<span class="hljs-property">x</span> - centerX);
  <span class="hljs-keyword">const</span> deltaAngle = newAngle - oldAngle;

  <span class="hljs-comment">// 相对于中心点旋转</span>
  <span class="hljs-keyword">const</span> translateToOrigin = <span class="hljs-title function_">createTranslateMatrix</span>(-centerX, -centerY);
  <span class="hljs-keyword">const</span> rotateMat = <span class="hljs-title function_">createRotateMatrix</span>(deltaAngle);
  <span class="hljs-keyword">const</span> translateBack = <span class="hljs-title function_">createTranslateMatrix</span>(centerX, centerY);
  <span class="hljs-keyword">const</span> newMatrix = <span class="hljs-title function_">multiplyMatrix</span>(
    translateBack,
    <span class="hljs-title function_">multiplyMatrix</span>(rotateMat, translateToOrigin)
  );
  <span class="hljs-keyword">const</span> finalMatrix = <span class="hljs-title function_">multiplyMatrix</span>(newMatrix, selectedObj.<span class="hljs-property">matrix</span>);

  <span class="hljs-title function_">setObjects</span>(<span class="hljs-function">(<span class="hljs-params">prev</span>) =&gt;</span>
    prev.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span>
      obj.<span class="hljs-property">id</span> === selectedId ? { ...obj, <span class="hljs-attr">matrix</span>: finalMatrix } : obj
    )
  );
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端转战后端：JavaScript 与 Java 对照学习指南 (第二篇 - 基本数据类型对比)]]></title>    <link>https://juejin.cn/post/7578442185847291942</link>    <guid>https://juejin.cn/post/7578442185847291942</guid>    <pubDate>2025-12-01T04:51:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578442185847291942" data-draft-id="7578416583212433458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端转战后端：JavaScript 与 Java 对照学习指南 (第二篇 - 基本数据类型对比) "/> <meta itemprop="keywords" content="JavaScript,Java,全栈"/> <meta itemprop="datePublished" content="2025-12-01T04:51:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="汤姆Tom"/> <meta itemprop="url" content="https://juejin.cn/user/4112607842680478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端转战后端：JavaScript 与 Java 对照学习指南 (第二篇 - 基本数据类型对比) 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4112607842680478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    汤姆Tom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:51:30.000Z" title="Mon Dec 01 2025 04:51:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>对于来自 JavaScript 的开发者，学习 Java 最大的认知变化就是：</p>
<blockquote>
<p><strong>Java 是强类型（Strong Typed）+ 静态类型（Static Typed）语言，而 JavaScript 是弱类型 + 动态类型语言。</strong></p>
</blockquote>
<p>在 JS 中，变量的类型由运行时决定；在 Java 中，变量类型必须在编译时就确定，否则无法通过编译。</p>
<p>本文将从 JS 开发者的视角出发，把 <strong>Java 的 8 种基本类型</strong> 用“前端友好的方式”讲清楚，并对比 JS 的相同概念，帮助建立强类型思维。</p>
<hr/>
<h2 data-id="heading-0">1. Java 的 8 种基本类型总览</h2>
<p>Java 的基本类型（primitive types）只有 8 种，是最底层的数据类型，不是对象，也不会有方法。</p>




































































<table><thead><tr><th>分类</th><th>Java 类型</th><th>位数</th><th>典型范围</th><th>对应的 JS 概念</th></tr></thead><tbody><tr><td>整数类型</td><td><code>byte</code></td><td>8 bit</td><td>-128 ~ 127</td><td>Number（整数）</td></tr><tr><td/><td><code>short</code></td><td>16 bit</td><td>-32768 ~ 32767</td><td>Number（整数）</td></tr><tr><td/><td><code>int</code></td><td>32 bit</td><td>-21亿 ~ 21亿</td><td>Number（整数）</td></tr><tr><td/><td><code>long</code></td><td>64 bit</td><td>非常大</td><td>BigInt（最接近，但不完全一致）</td></tr><tr><td>浮点类型</td><td><code>float</code></td><td>32 bit</td><td>约 7 位有效数字</td><td>Number（浮点）</td></tr><tr><td/><td><code>double</code></td><td>64 bit</td><td>约 15 位有效数字</td><td>Number（浮点）</td></tr><tr><td>字符类型</td><td><code>char</code></td><td>16 bit</td><td>单个 UTF-16 字符</td><td>JS 没有 char，字符串代替</td></tr><tr><td>布尔类型</td><td><code>boolean</code></td><td>1 bit（逻辑）</td><td>true/false</td><td>boolean</td></tr></tbody></table>
<blockquote>
<p><strong>重点：Java 的基本类型都是值类型（value type）且不是对象，不具备方法。</strong><br/>
JS 则是一切皆对象，Number/String/Boolean 都能调用方法。</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. Java 的数值类型详解（与 JS Number 的根本差异）</h2>
<p>在 JavaScript 中：</p>
<ul>
<li>所有数字（整数、小数、NaN、Infinity）都是 <code>Number</code>（IEEE 754 双精度浮点）</li>
<li>并且只有一个数值类型</li>
</ul>
<p>而 Java 将数值拆分为多个类型：<br/>
<strong>严格、固定大小、不能随意溢出、不能隐式跨类型转换。</strong></p>
<hr/>
<h3 data-id="heading-2">2.1 Java 整数类型：byte / short / int / long</h3>
<h4 data-id="heading-3">2.1.1 为什么 Java 要分这么细？</h4>
<p>为了：</p>
<ul>
<li>控制内存大小</li>
<li>提高性能</li>
<li>让类型更加明确，避免 JS 那种“数字太大不安全”的问题（如 2^53 的限制）</li>
</ul>
<h4 data-id="heading-4">2.1.2 四种整数类型对比</h4>



































<table><thead><tr><th>类型</th><th>例子</th><th>内存</th><th>范围</th></tr></thead><tbody><tr><td><code>byte</code></td><td><code>byte a = 10;</code></td><td>1 字节</td><td>-128 ~ 127</td></tr><tr><td><code>short</code></td><td><code>short s = 1000;</code></td><td>2 字节</td><td>-32768 ~ 32767</td></tr><tr><td><code>int</code></td><td><code>int x = 100000;</code></td><td>4 字节</td><td>-21亿 ~ 21亿</td></tr><tr><td><code>long</code></td><td><code>long l = 10000000000L;</code></td><td>8 字节</td><td>很大</td></tr></tbody></table>
<h4 data-id="heading-5">注意事项（前端非常容易踩坑）</h4>
<h5 data-id="heading-6">① long 字面量必须加后缀 <code>L</code></h5>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">10000000000L</span>;
</code></pre>
<p>不加 L 会当成 int 处理，从而编译报错（因为值超范围）。</p>
<h5 data-id="heading-7">② Java 整数不会自动从小类型提升到大类型？</h5>
<p>会提升，但不会自动下降（narrowing）。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;     <span class="hljs-comment">// OK，自动提升（int → long）</span>

<span class="hljs-type">long</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">10L</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> c;      <span class="hljs-comment">// ❌ 错误，必须强制转换（可能丢失数据）</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">2.2 Java 浮点类型：float / double</h3>
<p>JavaScript 中只有一个浮点类型（Number），默认是双精度。但 Java 有两个：</p>




















<table><thead><tr><th>类型</th><th>内存</th><th>说明</th></tr></thead><tbody><tr><td><code>float</code></td><td>4 字节</td><td>单精度，精度较低</td></tr><tr><td><code>double</code></td><td>8 字节</td><td>双精度，Java 默认浮点字面量类型</td></tr></tbody></table>
<h4 data-id="heading-9">字面量规则（与 JS 完全不同）</h4>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">float</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14f</span>;   <span class="hljs-comment">// 必须加 f</span>
<span class="hljs-type">double</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14</span>;   <span class="hljs-comment">// 默认 double</span>
</code></pre>
<blockquote>
<p>JS 不存在 float/double 的区别，永远是 Number。</p>
</blockquote>
<h4 data-id="heading-10">精度问题：Java 和 JS 一样，浮点运算仍会出现误差</h4>
<p>JS：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> <span class="hljs-comment">// 0.30000000000000004</span>
</code></pre>
<p>Java：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> <span class="hljs-comment">// 0.30000000000000004</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">3. boolean：Java 没有 JS 的 truthy/falsy</h2>
<p>JS 中：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">if</span> (<span class="hljs-string">"hello"</span>) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"true"</span>); <span class="hljs-comment">// true</span>
<span class="hljs-keyword">if</span> (<span class="hljs-number">1</span>) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"true"</span>);       <span class="hljs-comment">// true</span>
<span class="hljs-keyword">if</span> (<span class="hljs-number">0</span>) <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"false"</span>);      <span class="hljs-comment">// not printed</span>
</code></pre>
<p>Java 中只能写：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">boolean</span> <span class="hljs-variable">ok</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;

<span class="hljs-keyword">if</span> (ok) {
    System.out.println(<span class="hljs-string">"true"</span>);
}
</code></pre>
<p>以下写法一律报错：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">if</span> (<span class="hljs-number">1</span>) {}          <span class="hljs-comment">// ❌</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">"hello"</span>) {}    <span class="hljs-comment">// ❌</span>
<span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span>) {}       <span class="hljs-comment">// ❌</span>
</code></pre>
<blockquote>
<p>Java 的判断条件必须严格是 boolean 类型。</p>
</blockquote>
<hr/>
<h2 data-id="heading-12">4. char 类型：JS 没有这个概念</h2>
<p>JS 不存在 char，<code>'a'</code> 和 <code>"a"</code> 都是 string。</p>
<p>Java 有真正的字符类型：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
<span class="hljs-type">char</span> <span class="hljs-variable">emoji</span> <span class="hljs-operator">=</span> <span class="hljs-string">'😊'</span>; <span class="hljs-comment">// 支持 UTF-16 范围内的字符</span>
</code></pre>
<p>特点：</p>
<ul>
<li>必须使用单引号 <code>'a'</code></li>
<li>只能存一个字符</li>
<li>底层是 UTF-16 code unit（与 JS 类似）</li>
</ul>
<blockquote>
<p>注：超出 UTF-16 的字符需要使用代理对（surrogate pairs），高级内容可以再展开。</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">5. String 不是基本类型，但对前端很重要</h2>
<p>Java 的 String 是对象（引用类型），不是 primitive。</p>
<p>JS：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> s = <span class="hljs-string">"hello"</span>;
</code></pre>
<p>Java：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-string">"hello"</span>;
</code></pre>
<p>虽然看起来一样，但 Java 字符串：</p>
<ul>
<li>是不可变对象（immutable object）</li>
<li>在编译与运行时都会被字符串常量池优化</li>
</ul>
<hr/>
<h2 data-id="heading-14">6. Java 的类型转换规则（与 JS 完全不同）</h2>
<p>JS 的隐式转换非常激进：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-string">"1"</span> + <span class="hljs-number">2</span>    <span class="hljs-comment">// "12"</span>
<span class="hljs-string">"1"</span> * <span class="hljs-number">2</span>    <span class="hljs-comment">// 2</span>
</code></pre>
<p>Java 则非常严格：</p>
<h3 data-id="heading-15">6.1 不同基本类型之间不会“自动混淆”</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20L</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;        <span class="hljs-comment">// ❌ 不允许，结果是 long</span>
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>)(a + b); <span class="hljs-comment">// ✔</span>
</code></pre>
<h3 data-id="heading-16">6.2 字符和数字可以互转（因为 char 是 UTF-16 码位）</h3>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> c;      <span class="hljs-comment">// 65</span>
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">char</span> c = (<span class="hljs-type">char</span>) <span class="hljs-number">65</span>; <span class="hljs-comment">// 'A'</span>
</code></pre>
<hr/>
<h2 data-id="heading-17">7. 自动装箱 / 拆箱（Autoboxing / Unboxing）</h2>
<p>前端经常会问：</p>
<blockquote>
<p>Java 不是说基本类型没有方法吗？那为啥可以写像 <code>Integer</code> 这样的东西？</p>
</blockquote>
<h4 data-id="heading-18">Java 的基本类型都有对应的包装类（Wrapper Classes）</h4>









































<table><thead><tr><th>primitive</th><th>wrapper（对象）</th></tr></thead><tbody><tr><td>byte</td><td>Byte</td></tr><tr><td>short</td><td>Short</td></tr><tr><td>int</td><td>Integer</td></tr><tr><td>long</td><td>Long</td></tr><tr><td>float</td><td>Float</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>char</td><td>Character</td></tr><tr><td>boolean</td><td>Boolean</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
<span class="hljs-type">Integer</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;   <span class="hljs-comment">// 自动装箱（int → Integer）</span>
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> b;       <span class="hljs-comment">// 自动拆箱（Integer → int）</span>
</code></pre>
<p>类似 JS 的自动包装（如 <code>"abc".length</code>），但 Java 的规则更严格，有时会触发空指针：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Integer</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x;    <span class="hljs-comment">// ❌ 空指针异常</span>
</code></pre>
<p>Java 是强类型语言，所有转换必须安全或显式。</p>
<hr/>
<h2 data-id="heading-19">8. Java 的变量默认值（与 JS 完全不同）</h2>
<p>JS：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">let</span> x;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x); <span class="hljs-comment">// undefined</span>
</code></pre>
<p>Java（类字段有默认值，局部变量必须初始化，否则编译错误）</p>





























<table><thead><tr><th>类型</th><th>默认值</th></tr></thead><tbody><tr><td>整数（byte/short/int/long）</td><td>0</td></tr><tr><td>浮点（float/double）</td><td>0.0</td></tr><tr><td>char</td><td>'\u0000'（空字符）</td></tr><tr><td>boolean</td><td>false</td></tr><tr><td>引用类型（String 等）</td><td>null</td></tr></tbody></table>
<p>示例：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {
    <span class="hljs-type">int</span> x;      <span class="hljs-comment">// 默认 0</span>
    <span class="hljs-type">boolean</span> ok; <span class="hljs-comment">// 默认 false</span>
}
</code></pre>
<p>但局部变量：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> a;
System.out.println(a); <span class="hljs-comment">// ❌ 编译错误：未初始化</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">9. 基本类型在内存中的位置（与 JS 完全不一样）</h2>
<p>Java：</p>
<ul>
<li>基本类型（primitive）存储在 <strong>栈（stack）</strong> 或 JVM 局部变量区域</li>
<li>对象（String、Integer 等）存储在 <strong>堆（heap）</strong></li>
</ul>
<p>JS：</p>
<ul>
<li>没有显式栈/堆的区分概念（由引擎内部管理）</li>
<li>所有“对象”都在堆，原始类型存储优化由引擎隐藏</li>
</ul>
<hr/>
<h2 data-id="heading-21">10. Java 基本类型总结（给前端的快速记忆表）</h2>



























































<table><thead><tr><th>Java</th><th>用途</th><th>注意事项</th><th>JS 对比</th></tr></thead><tbody><tr><td>byte</td><td>小整数</td><td>不常用</td><td>Number</td></tr><tr><td>short</td><td>中等整数</td><td>不常用</td><td>Number</td></tr><tr><td>int</td><td>默认整数类型</td><td>最常用</td><td>Number</td></tr><tr><td>long</td><td>大整数</td><td>必须加 L</td><td>BigInt</td></tr><tr><td>float</td><td>单精度</td><td>必须加 f</td><td>Number</td></tr><tr><td>double</td><td>默认浮点</td><td>最常用浮点</td><td>Number</td></tr><tr><td>char</td><td>单字符</td><td>用单引号</td><td>JS 无 char</td></tr><tr><td>boolean</td><td>true/false</td><td>必须是 boolean</td><td>有 truthy/falsy</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决前端监控上报 Script Error实践]]></title>    <link>https://juejin.cn/post/7578384621458554932</link>    <guid>https://juejin.cn/post/7578384621458554932</guid>    <pubDate>2025-12-01T06:09:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578384621458554932" data-draft-id="7578469297627693098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决前端监控上报 Script Error实践"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-01T06:09:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="米花丶"/> <meta itemprop="url" content="https://juejin.cn/user/728326465681435"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决前端监控上报 Script Error实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/728326465681435/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    米花丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:09:35.000Z" title="Mon Dec 01 2025 06:09:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在微前端和多国业务的场景下，我们经常会遇到 HTML 页面域名和静态资源域名不统一的情况。这种架构虽然带来了部署和 CDN 优化的便利，但也引入了一个常见的问题：<strong>跨域 Script Error</strong>。本文将详细介绍这个问题的原因、影响，以及一套完整的解决方案。</p>
<h2 data-id="heading-1">问题背景</h2>
<h3 data-id="heading-2">业务场景</h3>
<p>我们的项目是一个多国业务的前端应用，采用了以下架构：</p>
<ul>
<li><strong>HTML 页面域名</strong>：每个地区/业务线使用不同主域名
<ul>
<li>例如：<code>countryA-web.example.com</code>, <code>countryB-web.example.com</code>, ...</li>
</ul>
</li>
<li>
<ul>
<li><strong>静态资源 CDN 域名</strong>：统一使用一个公共 CDN 地址</li>
<li>例如：<code>cdn.example.com</code></li>
</ul>
</li>
</ul>
<h3 data-id="heading-3">问题表现</h3>
<p>在这种架构下，我们遇到了以下问题：</p>
<ol>
<li>
<p><strong>监控上报的 JS 错误全部显示为 "Script Error"</strong></p>
<ul>
<li>无法获取详细的错误堆栈信息</li>
<li>无法定位具体的错误位置</li>
<li>SourceMap 无法正确映射</li>
</ul>
</li>
<li>
<p><strong>错误信息丢失</strong></p>
<ul>
<li>错误消息被浏览器隐藏</li>
<li>无法获取错误发生的文件、行号、列号</li>
<li>调试和问题排查变得困难</li>
</ul>
</li>
</ol>
<h2 data-id="heading-4">问题原因分析</h2>
<h3 data-id="heading-5">1. 浏览器的同源策略</h3>
<p>当脚本从不同源加载时，浏览器会应用**同源策略（Same-Origin Policy）**的安全机制：</p>
<ul>
<li>如果脚本发生错误，且脚本的源与页面不同，浏览器会隐藏错误的详细信息</li>
<li>只返回通用的 "Script Error" 消息</li>
<li>这是为了防止恶意网站通过错误信息获取敏感数据</li>
</ul>
<h3 data-id="heading-6">2. 缺少 CORS 配置</h3>
<p>要获取跨域脚本的详细错误信息，需要满足两个条件：</p>
<ol>
<li><strong>脚本标签添加 <code>crossorigin</code> 属性</strong></li>
<li><strong>服务器返回正确的 CORS 响应头</strong></li>
</ol>
<p>如果缺少其中任何一个，浏览器都会隐藏错误详情。</p>
<h3 data-id="heading-7">3. Webpack/Rspack 动态加载机制</h3>
<p>现代前端构建工具（Webpack、Rspack）在实现代码分割和懒加载时，会通过 <code>document.createElement('script')</code> 动态创建 script 标签来加载 chunk。如果这些动态创建的标签没有 <code>crossorigin</code> 属性，同样会导致 Script Error。</p>
<h2 data-id="heading-8">解决方案</h2>
<p>我们采用了一套<strong>三层防护</strong>的解决方案：</p>
<h3 data-id="heading-9">方案架构图</h3>
<p>┌─────────────────────────────────────────┐</p>
<p>│ 解决方案架构 │</p>
<p>├─────────────────────────────────────────┤</p>
<p>│ 1. HTML 模板层 │</p>
<p>│ └─ 手动添加 crossorigin 属性 │</p>
<p>│ │</p>
<p>│ 2. 构建时处理层 │</p>
<p>│ └─ Webpack 插件自动添加 │</p>
<p>│ │</p>
<p>│ 3. 运行时拦截层 │</p>
<p>│ └─ 拦截 createElement 全局处理 │</p>
<p>└─────────────────────────────────────────┘</p>
<h3 data-id="heading-10">HTML层：模板引用资源手动修改</h3>
<p>对于 HTML 模板中直接引用的静态资源，我们手动添加 <code>crossorigin="anonymous"</code> 属性：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 所有跨域的 script 标签 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.example.com/static/polyfill.min.js"</span>
  <span class="hljs-attr">defer</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 所有跨域的 link 标签（CSS） --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span>
  <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>
  <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.example.com/assets/iconfont.css"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
/&gt;</span>
</code></pre>
<h3 data-id="heading-11">打包工具层：Webpack/Rspack 插件自动处理（构建时）</h3>
<p>对于构建工具自动插入的脚本和样式，我们创建了一个自定义插件：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CrossOriginAssetsPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-keyword">const</span> pluginName = <span class="hljs-string">'CrossOriginAssetsPlugin'</span>;
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">compilation</span>.<span class="hljs-title function_">tap</span>(pluginName, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">HtmlWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'html-webpack-plugin'</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-title class_">HtmlWebpackPlugin</span> &amp;&amp; <span class="hljs-title class_">HtmlWebpackPlugin</span>.<span class="hljs-property">getHooks</span>) {
        <span class="hljs-title class_">HtmlWebpackPlugin</span>.<span class="hljs-title function_">getHooks</span>(compilation).<span class="hljs-property">alterAssetTags</span>.<span class="hljs-title function_">tap</span>(
          pluginName,
          <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
            <span class="hljs-comment">// 处理 script</span>
            data.<span class="hljs-property">assetTags</span>.<span class="hljs-property">scripts</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> {
              <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCrossOrigin</span>(tag.<span class="hljs-property">attributes</span>?.<span class="hljs-property">src</span>)) {
                tag.<span class="hljs-property">attributes</span>.<span class="hljs-property">crossorigin</span> = <span class="hljs-string">'anonymous'</span>;
              }
            });
            <span class="hljs-comment">// 处理 link</span>
            data.<span class="hljs-property">assetTags</span>.<span class="hljs-property">styles</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> {
              <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCrossOrigin</span>(tag.<span class="hljs-property">attributes</span>?.<span class="hljs-property">href</span>)) {
                tag.<span class="hljs-property">attributes</span>.<span class="hljs-property">crossorigin</span> = <span class="hljs-string">'anonymous'</span>;
              }
            });
            <span class="hljs-keyword">return</span> data;
          }
        );
      }
    });
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isCrossOrigin</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-comment">// 补充判断逻辑：绝对路径跨域、相对路径同源</span>
  <span class="hljs-keyword">return</span> url &amp;&amp; <span class="hljs-regexp">/^https?:/</span><span class="hljs-regexp">//</span>.<span class="hljs-title function_">test</span>(url);
}

</code></pre>
<h3 data-id="heading-12">方案三：运行时全局拦截（动态加载）</h3>
<p>在业务开发中我们会遇到许多异步动态加载的脚本文件，通过拦截 <code>document.createElement</code>，为所有动态 script/link 节点设置跨域属性，无死角覆盖 chunk、第三方库等异步加载场景。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isCrossOriginUrl</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">return</span> !!url &amp;&amp; <span class="hljs-regexp">/^https?:/</span><span class="hljs-regexp">//</span>.<span class="hljs-title function_">test</span>(url);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setScriptCrossOrigin</span>(<span class="hljs-params">script: HTMLScriptElement</span>) {
  <span class="hljs-keyword">const</span> src = script.<span class="hljs-property">src</span> || script.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'src'</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCrossOriginUrl</span>(src)) script.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">'anonymous'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setLinkCrossOrigin</span>(<span class="hljs-params">link: HTMLLinkElement</span>) {
  <span class="hljs-keyword">const</span> href = link.<span class="hljs-property">href</span> || link.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'href'</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isCrossOriginUrl</span>(href)) link.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">'anonymous'</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initCrossOriginScriptHandler</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> originCreateElement = <span class="hljs-variable language_">document</span>.<span class="hljs-property">createElement</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">document</span>);
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">createElement</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">tagName: <span class="hljs-built_in">string</span>, options?: ElementCreationOptions</span>) {
    <span class="hljs-keyword">const</span> el = <span class="hljs-title function_">originCreateElement</span>(tagName, options);
    <span class="hljs-keyword">if</span> (tagName.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">'script'</span>) {
      <span class="hljs-comment">// 当 src 插入时才设置</span>
      <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function"><span class="hljs-params">mutations</span> =&gt;</span> {
        mutations.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (m.<span class="hljs-property">type</span> === <span class="hljs-string">'attributes'</span> &amp;&amp; m.<span class="hljs-property">attributeName</span> === <span class="hljs-string">'src'</span>) {
            <span class="hljs-title function_">setScriptCrossOrigin</span>(el <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLScriptElement</span>);
            observer.<span class="hljs-title function_">disconnect</span>();
          }
        });
      });
      observer.<span class="hljs-title function_">observe</span>(el, { <span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">attributeFilter</span>: [<span class="hljs-string">'src'</span>] });
    }
    <span class="hljs-keyword">if</span> (tagName.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">'link'</span>) {
      <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(<span class="hljs-function"><span class="hljs-params">mutations</span> =&gt;</span> {
        mutations.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">m</span> =&gt;</span> {
          <span class="hljs-keyword">if</span> (m.<span class="hljs-property">type</span> === <span class="hljs-string">'attributes'</span> &amp;&amp; m.<span class="hljs-property">attributeName</span> === <span class="hljs-string">'href'</span>) {
            <span class="hljs-title function_">setLinkCrossOrigin</span>(el <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLLinkElement</span>);
            observer.<span class="hljs-title function_">disconnect</span>();
          }
        });
      });
      observer.<span class="hljs-title function_">observe</span>(el, { <span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">attributeFilter</span>: [<span class="hljs-string">'href'</span>] });
    }
    <span class="hljs-keyword">return</span> el;
  };
}
</code></pre>
<blockquote>
<p>在应用启动处调用初始化:</p>
</blockquote>
<p><strong>为什么这个方案可以覆盖所有场景？</strong></p>
<p>Webpack/Rspack 在运行时加载 chunk 时，会生成类似这样的代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Webpack 生成的 chunk 加载代码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadChunk</span>(<span class="hljs-params">chunkId</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);  <span class="hljs-comment">// ← 关键</span>
    script.<span class="hljs-property">src</span> = chunkUrl;
    script.<span class="hljs-property">onload</span> = resolve;
    script.<span class="hljs-property">onerror</span> = reject;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(script);
  });
}
</code></pre>
<p>通过拦截 <code>document.createElement</code>，我们可以捕获所有通过此方式创建的 script 标签，包括：</p>
<ul>
<li>React.lazy 懒加载的组件</li>
<li>动态 import() 加载的模块</li>
<li>Webpack chunk 动态加载</li>
<li>第三方库的动态加载</li>
<li>手动通过 <code>loadScript()</code> 加载的脚本</li>
</ul>
<h2 data-id="heading-13">总结</h2>
<p>通过这套<strong>三层防护</strong>的解决方案，我们成功解决了多域名架构下的跨域 Script Error 问题：</p>
<ol>
<li><strong>HTML 模板层</strong>：手动为静态资源添加 <code>crossorigin</code> 属性</li>
<li><strong>构建时处理层</strong>：Webpack 插件自动处理构建时插入的资源</li>
<li><strong>运行时拦截层</strong>：全局拦截 <code>document.createElement</code>，处理所有动态加载</li>
</ol>
<hr/>
<p><strong>如果这篇文章对你有帮助，欢迎点赞和收藏！</strong> 🎉</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用html和css实现放苹果的liquidGlass效果]]></title>    <link>https://juejin.cn/post/7578442185847570470</link>    <guid>https://juejin.cn/post/7578442185847570470</guid>    <pubDate>2025-12-01T06:12:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578442185847570470" data-draft-id="7578442185847554086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用html和css实现放苹果的liquidGlass效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T06:12:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024小神"/> <meta itemprop="url" content="https://juejin.cn/user/70007368988926"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用html和css实现放苹果的liquidGlass效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/70007368988926/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024小神
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:12:08.000Z" title="Mon Dec 01 2025 06:12:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我的开源项目PakePlus可以将网页/Vue/React项目打包为桌面/手机应用并且小于5M只需几分钟，官网地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpakeplus.com" target="_blank" title="https://pakeplus.com" ref="nofollow noopener noreferrer">pakeplus.com</a></p><p> <img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06e9696472b849ba818438a903d0d9bf~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1740" loading="lazy"/></p><p/>
<p>仔细看这个是有光影的拉伸效果，不是简单的毛玻璃，单纯的毛玻璃效果如下：</p>
<p>背景中的图片没有拉伸效果，就是简单的毛玻璃，类似模糊效果，但是我感觉这个毛玻璃更好看，内容也更清晰，当前上面的也并不完全能和苹果原生的liquidGlass效果比，苹果原生边角有光线折射效果，这个还是很难做到的</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62a07219b5114e8ab7457538fa83d95c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="1496" loading="lazy"/></p>
<p/>
<p>源代码我也是从网上找的，其中的原理就是使用来一个自定义的svg来实现：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7071d2c46724481b47aac27c0071576~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2356" loading="lazy"/></p>
<p>其中用到了svg：feTurbulence</p>
<p><a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.4/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=P9T8" data-link-title="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/feTurbulence" href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSVG%2FReference%2FElement%2FfeTurbulence" title="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/feTurbulence" target="_blank" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></p>
<p>还有svg的feSpecularLighting：<a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.4/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=P9T8" data-link-title="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/feSpecularLighting" href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FSVG%2FReference%2FElement%2FfeSpecularLighting" title="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Reference/Element/feSpecularLighting" target="_blank" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4263b5eab3dc423cb5bf93498ca3e8a7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2862" loading="lazy"/></p>
<p>index.html文件内容：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>macOS Liquid Glass Effect<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"styles.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- SVG Filter HERE --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: none"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">filter</span>
                <span class="hljs-attr">id</span>=<span class="hljs-string">"glass-distortion"</span>
                <span class="hljs-attr">x</span>=<span class="hljs-string">"0%"</span>
                <span class="hljs-attr">y</span>=<span class="hljs-string">"0%"</span>
                <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span>
                <span class="hljs-attr">height</span>=<span class="hljs-string">"100%"</span>
                <span class="hljs-attr">filterUnits</span>=<span class="hljs-string">"objectBoundingBox"</span>
            &gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">feTurbulence</span>
                    <span class="hljs-attr">type</span>=<span class="hljs-string">"fractalNoise"</span>
                    <span class="hljs-attr">baseFrequency</span>=<span class="hljs-string">"0.001 0.005"</span>
                    <span class="hljs-attr">numOctaves</span>=<span class="hljs-string">"1"</span>
                    <span class="hljs-attr">seed</span>=<span class="hljs-string">"17"</span>
                    <span class="hljs-attr">result</span>=<span class="hljs-string">"turbulence"</span>
                /&gt;</span>
                <span class="hljs-comment">&lt;!-- Liked Seeds: 5, 14, 17 --&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">feComponentTransfer</span> <span class="hljs-attr">in</span>=<span class="hljs-string">"turbulence"</span> <span class="hljs-attr">result</span>=<span class="hljs-string">"mapped"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">feFuncR</span>
                        <span class="hljs-attr">type</span>=<span class="hljs-string">"gamma"</span>
                        <span class="hljs-attr">amplitude</span>=<span class="hljs-string">"1"</span>
                        <span class="hljs-attr">exponent</span>=<span class="hljs-string">"10"</span>
                        <span class="hljs-attr">offset</span>=<span class="hljs-string">"0.5"</span>
                    /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">feFuncG</span>
                        <span class="hljs-attr">type</span>=<span class="hljs-string">"gamma"</span>
                        <span class="hljs-attr">amplitude</span>=<span class="hljs-string">"0"</span>
                        <span class="hljs-attr">exponent</span>=<span class="hljs-string">"1"</span>
                        <span class="hljs-attr">offset</span>=<span class="hljs-string">"0"</span>
                    /&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">feFuncB</span>
                        <span class="hljs-attr">type</span>=<span class="hljs-string">"gamma"</span>
                        <span class="hljs-attr">amplitude</span>=<span class="hljs-string">"0"</span>
                        <span class="hljs-attr">exponent</span>=<span class="hljs-string">"1"</span>
                        <span class="hljs-attr">offset</span>=<span class="hljs-string">"0.5"</span>
                    /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">feComponentTransfer</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">feGaussianBlur</span>
                    <span class="hljs-attr">in</span>=<span class="hljs-string">"turbulence"</span>
                    <span class="hljs-attr">stdDeviation</span>=<span class="hljs-string">"3"</span>
                    <span class="hljs-attr">result</span>=<span class="hljs-string">"softMap"</span>
                /&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">feSpecularLighting</span>
                    <span class="hljs-attr">in</span>=<span class="hljs-string">"softMap"</span>
                    <span class="hljs-attr">surfaceScale</span>=<span class="hljs-string">"5"</span>
                    <span class="hljs-attr">specularConstant</span>=<span class="hljs-string">"1"</span>
                    <span class="hljs-attr">specularExponent</span>=<span class="hljs-string">"100"</span>
                    <span class="hljs-attr">lighting-color</span>=<span class="hljs-string">"white"</span>
                    <span class="hljs-attr">result</span>=<span class="hljs-string">"specLight"</span>
                &gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">fePointLight</span> <span class="hljs-attr">x</span>=<span class="hljs-string">"-200"</span> <span class="hljs-attr">y</span>=<span class="hljs-string">"-200"</span> <span class="hljs-attr">z</span>=<span class="hljs-string">"300"</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">feSpecularLighting</span>&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">feComposite</span>
                    <span class="hljs-attr">in</span>=<span class="hljs-string">"specLight"</span>
                    <span class="hljs-attr">operator</span>=<span class="hljs-string">"arithmetic"</span>
                    <span class="hljs-attr">k1</span>=<span class="hljs-string">"0"</span>
                    <span class="hljs-attr">k2</span>=<span class="hljs-string">"1"</span>
                    <span class="hljs-attr">k3</span>=<span class="hljs-string">"1"</span>
                    <span class="hljs-attr">k4</span>=<span class="hljs-string">"0"</span>
                    <span class="hljs-attr">result</span>=<span class="hljs-string">"litImage"</span>
                /&gt;</span>

                <span class="hljs-tag">&lt;<span class="hljs-name">feDisplacementMap</span>
                    <span class="hljs-attr">in</span>=<span class="hljs-string">"SourceGraphic"</span>
                    <span class="hljs-attr">in2</span>=<span class="hljs-string">"softMap"</span>
                    <span class="hljs-attr">scale</span>=<span class="hljs-string">"200"</span>
                    <span class="hljs-attr">xChannelSelector</span>=<span class="hljs-string">"R"</span>
                    <span class="hljs-attr">yChannelSelector</span>=<span class="hljs-string">"G"</span>
                /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Other markup --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wrapper"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-wrapper menu"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-effect"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-tint"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-shine"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-text"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>New file<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Open file<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Settings<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Repository<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://x.com/lucasromerodb"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-wrapper dock"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-effect"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-tint"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-shine"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-text"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dock"</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/finder.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/map.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/messages.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/notes.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/safari.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
                                <span class="hljs-attr">src</span>=<span class="hljs-string">"https://raw.githubusercontent.com/lucasromerodb/liquid-glass-effect-macos/refs/heads/main/assets/books.png"</span>
                                <span class="hljs-attr">alt</span>=<span class="hljs-string">"Finder"</span>
                            /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://aerolab.co"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-wrapper button"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-effect"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-tint"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-shine"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"liquidGlass-text"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">svg</span>
                            <span class="hljs-attr">width</span>=<span class="hljs-string">"120"</span>
                            <span class="hljs-attr">viewBox</span>=<span class="hljs-string">"0 0 186 39"</span>
                            <span class="hljs-attr">fill</span>=<span class="hljs-string">"none"</span>
                            <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.w3.org/2000/svg"</span>
                        &gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">path</span>
                                <span class="hljs-attr">d</span>=<span class="hljs-string">"M30.6275 38.2073V33.6309C30.6275 33.4933 30.5583 33.4245 30.4197 33.4245H28.9304C27.7527 33.4245 27.1293 32.7707 27.1293 31.6352V20.1772C27.1293 13.3987 21.1719 10.4051 14.9374 10.4051C7.90633 10.4051 1.94895 12.4697 1.49868 19.3514C1.49868 19.489 1.56795 19.5578 1.7065 19.5578H7.14434C7.24825 19.5578 7.35216 19.489 7.38679 19.3514C7.69852 16.8395 10.4348 15.2912 14.4179 15.2912C18.7474 15.2912 21.2758 16.7019 21.2758 19.0073V19.7987C21.2758 21.2783 20.1675 22.5858 17.362 22.5858H14.5911C5.44718 22.5858 0.598145 25.3729 0.598145 30.8094C0.598145 36.1084 4.75446 38.8955 12.3397 38.8955C17.8122 38.8955 20.9295 36.7277 22.6959 35.0761C22.7998 34.9729 22.9037 35.0073 22.9383 35.1449C23.6657 37.2094 25.6746 38.4137 28.965 38.4137H30.4197C30.5583 38.4137 30.6275 38.3105 30.6275 38.2073ZM21.2758 27.1965V27.8847C21.2758 31.3944 17.8122 33.975 13.552 33.975C8.42587 33.975 6.48626 32.874 6.48626 30.4654C6.48626 28.332 9.04932 26.9901 14.5911 26.9901H21.068C21.2065 26.9901 21.2758 27.0589 21.2758 27.1965ZM31.3202 24.6503C31.3202 33.1492 37.2776 38.8955 45.6942 38.8955C52.5867 38.8955 57.8168 35.7987 59.2368 30.4998C59.2715 30.3621 59.2022 30.2589 59.0637 30.2589H53.3141C53.2102 30.2589 53.1063 30.2933 53.0716 30.3965C51.9286 32.5987 49.9198 34.0094 45.6942 34.0094C40.568 34.0094 37.6933 30.8439 37.5547 27.1965C37.5547 27.0589 37.624 26.9901 37.7625 26.9901H59.8256C59.9296 26.9901 60.0335 26.9213 60.0335 26.7836C60.6569 17.4589 54.8034 10.4051 45.6942 10.4051C37.3123 10.4051 31.3202 16.0481 31.3202 24.6503ZM37.5547 22.3793C37.4854 19.7987 39.9446 15.2912 45.6942 15.2912C51.4437 15.2912 53.7644 19.1449 53.7297 22.3793C53.7297 22.517 53.6258 22.5858 53.5219 22.5858H37.7625C37.6586 22.5858 37.5547 22.517 37.5547 22.3793ZM75.966 16.0481H79.4296C79.5681 16.0481 79.6374 15.9793 79.6374 15.8417V11.0933C79.6374 10.9557 79.5335 10.8869 79.4296 10.8869H76.9012C74.061 10.8869 71.1516 11.8847 69.1427 14.1901C69.0388 14.3277 68.9003 14.2933 68.8656 14.1213L68.1383 11.0589C68.1036 10.9557 68.0344 10.8869 67.9305 10.8869H63.3931C63.2546 10.8869 63.1853 10.9901 63.1853 11.0933V38.2073C63.1853 38.3449 63.2892 38.4137 63.3931 38.4137H68.5193C68.6578 38.4137 68.7271 38.3105 68.7271 38.2073V24.6159C68.7271 18.732 71.7404 16.0481 75.966 16.0481ZM108.697 24.6503C108.697 15.9449 102.463 10.4051 93.9767 10.4051C85.4909 10.4051 79.2911 15.9449 79.2911 24.6503C79.2911 33.3213 85.5255 38.8955 93.9767 38.8955C102.428 38.8955 108.697 33.3213 108.697 24.6503ZM102.74 24.6503C102.74 30.0869 98.8257 34.0094 93.9767 34.0094C89.1623 34.0094 85.2484 30.0525 85.2484 24.6503C85.2484 19.2481 89.1623 15.2912 93.9767 15.2912C98.8257 15.2912 102.74 19.2137 102.74 24.6503ZM121.963 38.2073V33.4589C121.963 33.3213 121.893 33.2525 121.755 33.2525H120.265C118.638 33.2525 117.46 32.5299 117.46 30.5686C117.46 27.0933 118.36 23.5492 119.053 19.6955C119.884 15.2567 120.716 10.2331 120.82 7.8933C121.062 2.73201 118.049 0.56427 114.343 0.56427H112.022C111.883 0.56427 111.814 0.633087 111.814 0.770722V5.34707C111.814 5.4847 111.918 5.55352 112.022 5.55352H113.234C114.447 5.55352 115.209 6.20728 115.278 7.82449C115.347 9.99223 114.62 13.4675 113.581 18.8697C112.784 23.1019 111.953 27.5406 111.953 31.6008C111.953 35.9707 114.966 38.4137 119.538 38.4137H121.755C121.893 38.4137 121.963 38.3105 121.963 38.2073ZM152.574 38.2073V11.0933C152.574 10.9557 152.505 10.8869 152.366 10.8869H147.794C147.69 10.8869 147.621 10.9557 147.586 11.0589L146.963 13.7428C146.928 13.8804 146.79 13.9148 146.686 13.8116C144.192 11.3686 140.867 10.4051 137.542 10.4051C129.264 10.4051 123.445 16.1858 123.445 24.6847C123.445 33.1492 129.298 38.8955 137.542 38.8955C140.798 38.8955 144.781 37.7256 146.686 35.489C146.824 35.3514 146.928 35.3858 146.963 35.5578L147.586 38.2417C147.621 38.3449 147.69 38.4137 147.794 38.4137H152.366C152.505 38.4137 152.574 38.3105 152.574 38.2073ZM129.402 24.6847C129.402 19.1449 133.282 15.2912 138.131 15.2912C143.153 15.2912 146.686 19.317 146.686 24.6847C146.686 30.018 143.153 34.0094 138.131 34.0094C133.316 34.0094 129.402 30.1557 129.402 24.6847ZM156.73 0.770722V38.2073C156.73 38.3449 156.799 38.4137 156.938 38.4137H161.51C161.614 38.4137 161.683 38.3449 161.718 38.2417L162.307 35.7299C162.341 35.5922 162.48 35.5234 162.584 35.6266C165.251 37.932 168.818 38.8955 171.762 38.8955C180.006 38.8955 185.859 33.1492 185.859 24.6847C185.859 16.1858 179.694 10.4051 171.416 10.4051C167.952 10.4051 165.354 11.2998 162.514 13.7084C162.376 13.846 162.272 13.7772 162.272 13.6051V0.770722C162.272 0.633087 162.168 0.56427 162.064 0.56427H156.938C156.799 0.56427 156.73 0.667496 156.73 0.770722ZM179.902 24.6847C179.902 30.0869 175.988 34.0094 171.173 34.0094C166.151 34.0094 162.618 29.9492 162.618 24.6847C162.618 19.4202 166.151 15.3256 171.173 15.3256C176.022 15.3256 179.902 19.2481 179.902 24.6847Z"</span>
                                <span class="hljs-attr">fill</span>=<span class="hljs-string">"white"</span>
                            /&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>style css文件：</p>
<pre><code class="hljs language-html" lang="html">/* LIQUID GLASS STYLES */
.liquidGlass-wrapper {
    position: relative;
    display: flex;
    font-weight: 600;
    overflow: hidden;
    color: black;
    cursor: pointer;
    box-shadow: 0 6px 6px rgba(0, 0, 0, 0.2), 0 0 20px rgba(0, 0, 0, 0.1);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 2.2);
}

.liquidGlass-effect {
    position: absolute;
    z-index: 0;
    inset: 0;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(6px);
    filter: url(#glass-distortion);
    overflow: hidden;
    isolation: isolate;
}

.liquidGlass-tint {
    z-index: 1;
    position: absolute;
    inset: 0;
    background: rgba(255, 255, 255, 0.25);
}

.liquidGlass-shine {
    position: absolute;
    inset: 0;
    z-index: 2;
    overflow: hidden;
    box-shadow: inset 2px 2px 1px 0 rgba(255, 255, 255, 0.5),
        inset -1px -1px 1px 1px rgba(255, 255, 255, 0.5);
}

.liquidGlass-text {
    z-index: 3;
    font-size: 2rem;
    color: black;
}

/* OTHER STYLES */

body {
    padding: 0;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: url('./retro-games.jpg') center center;
    background-size: 400px;
    font-family: sans-serif;
    font-weight: 300;
    /* animation: moveBackground 60s linear infinite; */
}

/* 
GREEN BACKGROUND
https://media.istockphoto.com/id/1430511443/vector/christmas-mistletoe-foliage-and-berries-vector-seamless-pattern.jpg?s=612x612&amp;w=0&amp;k=20&amp;c=oqxlH7ytgd5yjBQroACirJ1gH7Au1tq8gmsdeGd-Crk=

ORANGE BACKGROUND
https://images.fineartamerica.com/images/artworkimages/mediumlarge/3/beautiful-orange-and-pastel-flowers-seamless-pattern-julien.jpg

MARGARITAS BACKGROUND
https://static.vecteezy.com/system/resources/previews/056/652/082/non_2x/hand-drawn-white-flower-seamless-pattern-floral-repeating-wallpaper-for-textile-design-fabric-print-wrapping-paper-cute-daisy-flowers-on-blue-background-repeated-ditsy-texture-vector.jpg

SPRING FLOWERS BACKGROUND
https://img.freepik.com/free-vector/flat-floral-spring-pattern-design_23-2150117078.jpg

VECTOR WINDS BACKGROUND
https://i.ibb.co/MDbLn4N4/vectors.png

RED FLOWERS BACKGROUND
https://www.publicdomainpictures.net/pictures/610000/velka/seamless-floral-wallpaper-art-1715193626Gct.jpg
*/

a {
    text-decoration: none;
}

.wrapper {
    display: flex;
    gap: 25px;
    flex-direction: column;
    justify-content: center;
    align-items: flex-end;
}

.menu,
.menu &gt; div {
    display: flex;
    gap: 10px;
    padding: 0.4rem;
    border-radius: 1.8rem;
}

.menu:hover {
    padding: 0.6rem;
    border-radius: 1.8rem;
}

.menu &gt; div &gt; div {
    font-size: 20px;
    color: white;
    padding: 0.4rem 0.6rem;
    border-radius: 0.8rem;
    transition: all 0.1s ease-in;
}

.menu &gt; div &gt; div:hover {
    background-color: rgba(255, 255, 255, 0.5);
    box-shadow: inset -2px -2px 2px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(2px);
}

.dock {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    border-radius: 2rem;
    padding: 0.6rem;
}

.dock,
.dock &gt; div {
    border-radius: 2rem;
}

.dock:hover {
    padding: 0.8rem;
    border-radius: 2.5rem;
}

.dock:hover &gt; div {
    border-radius: 2.5rem;
}

.dock img {
    width: 75px;
    padding: 0;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 2.2);
}

.dock img:hover {
    transform-origin: center center;
}

.button {
    padding: 1.5rem 2.5rem;
    border-radius: 3rem;
}

.button,
.button &gt; div {
    border-radius: 3rem;
}

.button:hover {
    padding: 1.8rem 2.8rem;
}

.button:hover &gt; div {
    border-radius: 4rem;
}

.button svg {
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 2.2);
}

.button:hover svg {
    transform: scale(0.95);
}

@keyframes moveBackground {
    from {
        background-position: 0% 0%;
    }
    to {
        background-position: 0% -1000%;
    }
}
</code></pre>
<p>背景图可以替换：</p>
<p><img alt="" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee2d7cd4ab554babb976d95a7506f9f9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" width="2068" loading="lazy"/></p>
<p/>
<p>源代码下载链接：<a data-link-icon="https://csdnimg.cn/release/blog_editor_html/release2.4.4/ckeditor/plugins/CsdnLink/icons/icon-default.png?t=P9T8" data-link-title="https://wwayg.lanzouq.com/iK3Lq3cle5yf" href="https://link.juejin.cn?target=https%3A%2F%2Fwwayg.lanzouq.com%2FiK3Lq3cle5yf" title="https://wwayg.lanzouq.com/iK3Lq3cle5yf" target="_blank" ref="nofollow noopener noreferrer">wwayg.lanzouq.com/iK3Lq3cle5y…</a></p>
大家好，我是1024小神，技术群 / 私活群 / 股票群 或 交朋友 都可以私信我。
如果你觉得本文有用，一键三连 (点赞、评论、关注)，就是对我最大的支持~</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS深入理解事件传递及响应]]></title>    <link>https://juejin.cn/post/7578314349515014195</link>    <guid>https://juejin.cn/post/7578314349515014195</guid>    <pubDate>2025-12-01T05:59:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578314349515014195" data-draft-id="7578161740468289587" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS深入理解事件传递及响应"/> <meta itemprop="keywords" content="前端,APP,iOS"/> <meta itemprop="datePublished" content="2025-12-01T05:59:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Haha_bj"/> <meta itemprop="url" content="https://juejin.cn/user/2612027844214647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS深入理解事件传递及响应
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612027844214647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Haha_bj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:59:00.000Z" title="Mon Dec 01 2025 05:59:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、事件传递</h3>
<p><code>事件传递相关的两个方法</code></p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">// 哪个视图响应事件返回哪个  </span>
-(<span class="hljs-built_in">UIView</span> *)hitTest:(<span class="hljs-built_in">CGPoint</span>)point withEvent:(<span class="hljs-built_in">UIEvent</span> *)event;     
<span class="hljs-comment">// 点击位置是否在当前视图范围  </span>
-(<span class="hljs-type">BOOL</span>)pointInside(<span class="hljs-built_in">CGPoint</span>)point withEvent:(<span class="hljs-built_in">UIEvent</span> *)event; 

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26f3269b99a44756b73022adaaffa8b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173539&amp;x-signature=tQYFFraF8mqfs5L0K4e2igKyVlY%3D" alt="图片.png" loading="lazy"/>
如图，View A中包含View B1、View B2,View B2中包含View C1，View C2既包含View C1的一部分，又包含View B2的一部分，View C1中包含View D。当点击View C2的空白区域时，系统如何找到事件响应者为View C2？</p>
<h3 data-id="heading-1"><strong><code>（1）事件传递流程</code></strong></h3>
<p>当用户<code>点击屏幕</code>的某个位置，该事件会被传递给<code>UIApplication</code>，<code>UIApplication</code>又传递给当前的<code>UIWindow</code>,<code>UIWindow</code>会通过<code>hitTest:WithEvent:</code>方法返回响应的视图。<code>hitTest:WithEvent:</code>方法内部通过<code>pointInside:withEvent:</code>方法判断点击<code>point</code>是否在当前<code>UIWindow</code>范围内，如果在，则会遍历其中的所有子视图<code>SubViews</code>来查找最终响应此事件的视图，遍历方式为倒序遍历，即最后添加到<code>UIWindow</code>的视图最优先被遍历到，依次遍历，可以看作是递归调用。每个<code>UIView</code>中又都会调用其对应<code>hitTest:WithEvent:</code>方法，最终返回响应视图<code>hit</code>,如果<code>hit</code>有值，则<code>hit</code>视图就作为该事件的响应视图被返回，如果<code>hit</code>没有值，但在当前<code>UIWindow</code>范围内，则当前<code>UIWindow</code>作为事件的响应视图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9baaf3082ea74815870f2f571ae0cc33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173539&amp;x-signature=GqtzAlG02knX3JZAjeRCVrEjCvI%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-2"><strong><code>（2）hitTest:WithEvent:系统内部实现</code></strong></h3>
<p>首先在<code>hitTest:WithEvent:</code>方法内部先判断当前视图的hidden属性、是否可交互、透明度是否大于0.01。如果该视图不同时满足上述3个条件，则返回nil，当前视图不作为事件的响应视图，当前视图的父视图继续遍历其他的子视图；如果该视图没有隐藏、用户可交互、透明度大于0.01，则会通过<code>pointInside:WithEvent:</code>方法判断点击的点是否在当前视图范围内，如果不在，则同样返回nil,当前视图仍不作为事件的响应者；如果在，则会通过倒序遍历当前视图的子视图，调用其子视图对应的<code>hitTest:WithEvent:</code>方法，如果某个视图返回了事件响应视图，则该返回的视图被作为事件的响应者，反之则继续遍历判断。如果遍历完后没有任何视图响应此事件，因为此事件点击的范围在当前视图范围内，则将当前视图作为事件响应者返回。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da012c5c7c974aceb2d65ef14cc19aad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173539&amp;x-signature=Jmr2HgHfuvJqfIuGheTWSzRZ7%2BE%3D" alt="图片.png" loading="lazy"/></p>
<h3 data-id="heading-3">二、视图事件响应</h3>
<p>上述讲述了视图事件的传递流程，当视图事件传递后，<code>最终事件由谁来响应呢，这就涉及视图的响应链、响应链的机制和流程</code>。 如图，页面存在一个<code>UILabel</code>、<code>一个UITextField</code>、一个<code>UIButton</code>，实线箭头表示下一个响应者。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d25b88b810074d23a35d3a092e354d36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173539&amp;x-signature=F4Y84qcLQ84xcCAZOd6Lht5eh9E%3D" alt="图片.png" loading="lazy"/></p>
<p>视图事件响应链相关的方法</p>
<pre><code class="hljs language-objectivec" lang="objectivec">- (<span class="hljs-type">void</span>)touchesBegan:(<span class="hljs-built_in">NSSet</span>&lt;<span class="hljs-built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="hljs-built_in">UIEvent</span> *)event
- (<span class="hljs-type">void</span>)touchesMoved:(<span class="hljs-built_in">NSSet</span>&lt;<span class="hljs-built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="hljs-built_in">UIEvent</span> *)event
- (<span class="hljs-type">void</span>)touchesEnded:(<span class="hljs-built_in">NSSet</span>&lt;<span class="hljs-built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="hljs-built_in">UIEvent</span> *)event

</code></pre>
<p>例如，当点击<code>View C2</code>的空白处时，事件由谁来响应呢？首先由<code>View C2</code>接收事件，如果它不处理，就会把事件传递给<code>View B2</code>,如果<code>View B2</code>还不响应这个事件，<code>View B2</code>会通过响应链将事件传递给它的父视图<code>View A</code>,如果还不响应，则会沿着响应链一直向上传递，<code>直到传递到UIApplicationDelegate仍然不对事件进行处理，则会忽略此事件</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85a462d2c5be450e97097dd318cfc33a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFoYV9iag==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765173539&amp;x-signature=SGkKto2rGDOQk58AfK%2B78P6YFE0%3D" alt="图片.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PPO最强，DPO一般？一文带你了解常见三种强化学习方法，文末有大模型微调神器！]]></title>    <link>https://juejin.cn/post/7577957806211842063</link>    <guid>https://juejin.cn/post/7577957806211842063</guid>    <pubDate>2025-12-01T03:05:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7577957806211842063" data-draft-id="7578198815728271360" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PPO最强，DPO一般？一文带你了解常见三种强化学习方法，文末有大模型微调神器！"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-01T03:05:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型微调Online"/> <meta itemprop="url" content="https://juejin.cn/user/2376496773075211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PPO最强，DPO一般？一文带你了解常见三种强化学习方法，文末有大模型微调神器！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2376496773075211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型微调Online
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T03:05:42.000Z" title="Mon Dec 01 2025 03:05:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多人第一次接触各家大模型时，都会觉得它们的回答能带来意想不到的惊喜，但有时，AI回答又怪怪的、啰嗦、甚至有点危险。
 </p>
<p>这背后，其实就是一个核心问题：对齐（Alignment）。
 </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02e6296399dd4751a2d55cc77080cdc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=Wlj8I1lRXPXZYD9qhZryAQ0uyfw%3D" alt="" loading="lazy"/></p>
<p> 
预训练让模型会“说话”，但对齐训练，才让模型更符合人类偏好：更有用、更安全、更有温度。在当下的大模型时代，有三种常被提到的对齐方法：PPO、DPO和KTO。</p>
<p> 
本期，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamafactory.com.cn%2F%3Futm_source%3Djslt_xtjj0" target="_blank" title="https://www.llamafactory.com.cn/?utm_source=jslt_xtjj0" ref="nofollow noopener noreferrer">LLaMA-Factory Online</a>将用尽量通俗的方式，帮你搞懂它们的底层逻辑。</p>
<h3 data-id="heading-0"> </h3>
<h2 data-id="heading-1">一、PPO：造一个“裁判”，再用强化学习调教模型</h2>
<p>PPO（Proximal Policy Optimization，近端策略优化）最经典的应用就是：RLHF（Reinforcement Learning from Human Feedback，人类反馈强化学习）。</p>
<p> </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ed798fcb8424c63a1f3ab1e9b54a09e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=ORxv%2F8i7PDHuhCML1KuOlNS6uv8%3D" alt="" loading="lazy"/></p>
<p>它的思路是“三件套”：</p>
<p>● 先由“SFT老师”教模型基础礼仪</p>
<p>用高质量指令-回答数据，把预训练模型变成一个基本听话的聊天助手</p>
<p>● 再训练一个“阅卷老师RM”初步打分</p>
<p>让人类对一批回答打偏好，用这些偏好去训练一个专门“打分”的模型，以后看到一个回答，这个打分模型就会判断：“这个 0.9 分” 或 “这个只有 0.2 分”</p>
<p>● 最后用PPO算法，让模型按阅卷老师给的分数改进回答</p>
<p>先让模型生成回答，高分回答方向上的参数被奖励模型“鼓励”，低分回答方向被“惩罚”。每次更新，又会用 PPO 的“裁剪机制”限制更新幅度，防止模型突然学偏</p>
<p> </p>
<h3 data-id="heading-2">为什么大家爱用 PPO？又为什么很多团队逐渐“逃离”它？</h3>
<p>优点：</p>
<p>● 上限高，通用性强：有了奖励模型，你可以把任意“主观偏好”变成一个可学习的分数。模型的回答是否符合事实、是否礼貌、是否安全、是否有条理等要素，都可以揉进一个奖励里，PPO 按这个总分来优化，想象空间很大。</p>
<p>● 理论成熟，工业验证充分：ChatGPT、Claude 早期版本等，都用 PPO+RLHF 这套路线走起来的，对大厂来说，这是“保险方案”。</p>
<p> </p>
<p>缺点：</p>
<p>● 流程复杂、成本高：至少要维护两个大模型（基座 + RM），训练管线复杂、显存压力巨大，对中小团队来说，非常“肉疼”。</p>
<p>● 容易被“奖励黑客”：裁判是模型，它也会“犯蠢”：比如误把“长篇大论”当成高质量，结果你看到的就是：回答变得又长又啰嗦，但不一定更有用。</p>
<p>● 对长推理任务不友好：很多数学/代码题，只在“最终答案对不对”这里给奖励，中间推理过程没标注。价值函数不好学，PPO 更新就会非常不稳定。这也是后来 GRPO、GSPO 等新算法诞生的重要原因。</p>
<p>如果你手头只有几张 GPU，还想用 PPO+RM 跑一套完整 RLHF 流程，大概率会被现实猛猛教育一下。</p>
<p>但如果你有技术、有精力，可以在LLaMA-Factory Online中，以平民价用H卡训练市面上各种强大模型，享受优惠的同时，性能绝不缩水。
 </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa6e6911e3854ab6a9205c8bec35e54b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=7KTJtbhgLiQN%2FfEXIscfAt4v4Z0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">二、DPO：直接教学生分好坏</h2>
<p>DPO（Direct Preference Optimization，直接偏好优化）的出发点很简单：既然人类已经告诉我们 A 比 B 好，为什么还要多绕一步去训一个奖励模型？直接用这对偏好数据更新大模型本身不就行了？</p>
<p>所以，DPO 直接跳过奖励模型RM的训练流程，用一个特殊的损失函数，让模型满足这样的目标：在同样的输入下，提高“偏好回答”的生成概率，降低“非偏好回答”的生成概率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5461c77e1e2b42c2974551b449ea0247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=3nOEDS1u7RJ8zYoIfEm4kU6aSBk%3D" alt="" loading="lazy"/></p>
<p> </p>
<p>一条典型 DPO 样本是这样的结构：</p>
<pre><code class="hljs language-makefile" lang="makefile">{
<span class="hljs-section">输入:用户问题 x</span>
<span class="hljs-section">偏好回答: y_preferred</span>
<span class="hljs-section">非偏好回答: y_dispreferred</span>
}
</code></pre>
<p> 
我们可以发现，和PPO相比，DPO中间整整省掉了一整个模型和一套管线。</p>
<h3 data-id="heading-4">DPO 的优缺点：典型的“中量级选手”</h3>
<p>优点：</p>
<p>● 不用奖励模型，算力成本与工程复杂度骤降，比 PPO 至少少一大截，对中小团队、开源社区尤其友好。</p>
<p>● 训练稳定，没有价值函数、优势估计这些“强化学习坑点”，训练过程更像普通 SFT。</p>
<p>● 效果可观，在很多对话任务上，适当规模的成对偏好数据 + DPO就能把一个 SFT 模型拉到接近GPT-3.5的体验。</p>
<p>缺点：</p>
<p>● 非常依赖偏好数据质量。如果标注员的标准不统一、甚至本身理解有误，模型就会学错偏好，而且很难通过“奖励模型分析”把问题拆出来。</p>
<p>● 对复杂、多维度目标支持较弱。比如代码生成，你同时在意：正确性、效率、可读性，但单纯的偏好往往很难覆盖所有维度，不如 PPO+RM 那么灵活可控。</p>
<p>● 标注成本仍不低。成对偏好数据毕竟需要两个候选回答，再由人类比较、选择哪个更好。相比“单条打好/坏”，还是贵不少——这就给 KTO 留出了舞台。</p>
<p> </p>
<h2 data-id="heading-5">三、KTO：好与坏的极简判断</h2>
<p>KTO（Kahneman–Tversky Optimization）名字里的两位，就是诺奖得主卡尼曼和特沃斯基——他们提出了著名的前景理论：人类对“损失”的敏感度，远远大于对“收益”的敏感度，例如捡 100 块钱没有你丢 100 块钱那么“疼”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e345bb5b4974008acb2dac3844d007a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=APmXg80K6N0GRyyaaKI6SfY6FCQ%3D" alt="" loading="lazy"/></p>
<p>KTO 把这个想法搬到了模型训练里，核心有两点：</p>
<p>● 不再需要成对数据，只要给每个回答一个标签：</p>
<p>可取 / Desirable：+1</p>
<p>不可取 / Undesirable：-1</p>
<p>● 对“坏回答”惩罚更重，对“好回答”奖励更细腻</p>
<p>生成坏回答 → 惩罚力度大</p>
<p>没生成好回答 → 也会被“温柔地惩罚一下”</p>
<p>让模型学会：“少犯错，比偶尔超常发挥重要得多。”</p>
<p> </p>
<p>和 DPO 的成对数据比，KTO 的数据格式非常朴素：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
<span class="hljs-attr">"input_x"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"计算 2 + 3 × 4 的结果"</span><span class="hljs-punctuation">,</span> 
<span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2 + 3 = 5，5 × 4 = 20。"</span><span class="hljs-punctuation">,</span>  
<span class="hljs-attr">"desirability_label"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span>  <span class="hljs-comment">// 坏</span>
<span class="hljs-punctuation">}</span> 
</code></pre>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
<span class="hljs-attr">"input_x"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"计算 2 + 3 × 4 的结果"</span><span class="hljs-punctuation">,</span> 
<span class="hljs-attr">"response"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2 + 3 = 5，5 × 4 = 20。"</span><span class="hljs-punctuation">,</span>  
<span class="hljs-attr">"desirability_label"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span>  <span class="hljs-comment">// 坏</span>
<span class="hljs-punctuation">}</span> 
</code></pre>
<p> 
人类标注任务从“二选一”降维到“单条打分”：看到一个回答 → 点👍 / 👎即可。</p>
<p>在实际平台中，这和我们给机器人“好评 / 差评”的交互方式非常接近，可以利用大量弱标注数据，快速积累样本。</p>
<p> </p>
<h3 data-id="heading-6">KTO 的优缺点：极度节省，换来的是“粗粒度”</h3>
<p>优点：</p>
<p>● 标注成本极低，不需要成对比较，大部分人只要有“常识+审美”，就能给出好/坏评价，非常适合从线上用户反馈中直接挖掘训练数据。</p>
<p>● 训练流程简单、计算开销小，本质上是一个带特殊损失函数的“带标签微调”，没有价值函数、群体对比这种 RL 元素，工程实现很友好。</p>
<p>● 对“不平衡场景”特别有用。比如医疗场景中：错误回答的危害远超过正确回答带来的“惊喜”。使用 KTO，可以重点惩罚那些危险、错误、消极的回答，让模型优先减少灾难性输出。</p>
<p> </p>
<p>缺点：</p>
<p>● 只能学“好/坏”，难学“细微偏好”，比如两条回答都正确，一条详细带例子，一条简洁干脆，这时你想让模型倾向其中一种风格，单一好/坏标签表达力就不够了。</p>
<p>● 对标签质量敏感，若打标签的人并不专业，甚至情绪化，模型容易学到稀奇古怪的偏好。</p>
<p>● 缺少“事实性约束”，只要标注员没把事实错误当“坏”，模型就可能把“圆滑但不一定对”的回答学成“好风格”。</p>
<h2 data-id="heading-7">四、PPO、DPO、KTO，不同团队怎么选？</h2>
<p>最后，把这三位主角拉到一张决策表上：</p>









































<table><thead><tr><th>维度</th><th>PPO（RLHF）</th><th>DPO</th><th>KTO</th></tr></thead><tbody><tr><td>训练流程</td><td>最复杂：SFT + 奖励模型 + RLHF</td><td>类 SFT：直接用偏好对训练</td><td>类 SFT：用好/坏标签训练</td></tr><tr><td>数据要求</td><td>成对偏好 + 奖励模型训练数据</td><td>成对偏好数据</td><td>单条好/坏标签</td></tr><tr><td>算力 &amp; 工程</td><td>★★★★★</td><td>★★★</td><td>★★</td></tr><tr><td>对齐精细程度</td><td>★★★★★（可多维度综合）</td><td>★★★★（对话/任务效果很好）</td><td>★★（粗粒度好/坏）</td></tr><tr><td>典型适用场景</td><td>通用大模型、追求 SOTA 的大厂</td><td>垂直问答、领域助手、开源模型</td><td>安全防护、粗对齐、低预算项目</td></tr></tbody></table>
<p> </p>
<p>如果用一句话给不同类型团队提建议：</p>
<p>● 大厂 / 研究机构</p>
<p>有工程团队、有算力、有大量标注资源：优先采用 PPO+RM，在此基础上再探索 GRPO、GSPO 等更前沿算法。</p>
<p>● 中小型团队 / 垂直应用</p>
<p>有一定数据 &amp; 预算，希望在一个细分领域做出体验不错的模型，DPO就是非常务实的首选：成本可控、效果明显、社区实践多、工具链成熟（如 HuggingFace TRL）。</p>
<p>● 个人开发者 / 极度预算敏感项目</p>
<p>手里只有少量“好/坏”反馈，或者主要依赖线上用户点击、评分：从 KTO 起步，把最差的回答先“挡下去”，再视情况逐步升级到 DPO。</p>
<p> </p>
<p>但事实上，大量开源优质数据都可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamafactory.com.cn%2F%3Futm_source%3Djslt_xtjj0" target="_blank" title="https://www.llamafactory.com.cn/?utm_source=jslt_xtjj0" ref="nofollow noopener noreferrer">LLaMA-Factory Online</a>上轻松获得，你也可以在这个平台直接用高算力显卡落地你的想法，所以从DPO起步是完全可以的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ce94e87c19243eb9198b51b503c850d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5b6u6LCDT25saW5l:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765164451&amp;x-signature=b62EjCHDKhHkY7%2FDAQmTw1uH7W0%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.llamafactory.com.cn%2F%3Futm_source%3Djslt_xtjj0" target="_blank" title="https://www.llamafactory.com.cn/?utm_source=jslt_xtjj0" ref="nofollow noopener noreferrer">LLaMA-Factory Online</a>已经把过去需要专业工程团队才能搭起来的流水线，做成了一个开箱可用的在线一站式平台：</p>
<p>● 无配置负担——浏览器打开即可训练，无需写脚本、配环境、调依赖</p>
<p>● 支持全流程训练：SFT、DPO、KTO、PPO、LoRA、QLoRA 全套都能跑</p>
<p>● 高性价比算力——H20、A100、4090 等多种 GPU 即开即用</p>
<p>● 兼容 HuggingFace / OpenAI 接口，训练后的模型可直接部署上线</p>
<p>● 支持主流大模型：Llama、Qwen、Baichuan、Gemma、Mistral……想训就训</p>
<p> </p>
<p>你不再需要几十万的集群成本，也不用自己搭 RLHF 训练框架，一个浏览器 + 一点训练数据，你就能和大厂同款技术体系赛跑。对于想快速验证想法、打造垂直领域智能体、或在真实业务中使用大模型的团队来说，这就是实打实的生产力提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NeurIPS 2025 | 英伟达发布Nemotron-Flash：以GPU延迟为核心重塑小模型架构]]></title>    <link>https://juejin.cn/post/7578511778888400934</link>    <guid>https://juejin.cn/post/7578511778888400934</guid>    <pubDate>2025-12-01T06:23:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578511778888400934" data-draft-id="7578416583212728370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NeurIPS 2025 | 英伟达发布Nemotron-Flash：以GPU延迟为核心重塑小模型架构"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-01T06:23:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NeurIPS 2025 | 英伟达发布Nemotron-Flash：以GPU延迟为核心重塑小模型架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:23:41.000Z" title="Mon Dec 01 2025 06:23:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>导读  过去两年，小语言模型（SLM）在业界备受关注：参数更少、结构更轻，理应在真实部署中 “更快”。但只要真正把它们跑在 GPU 上，结论往往令人意外 —— 小模型其实没有想象中那么快。 </p>
<p>参数缩小了，延迟却常常没有同步下降；结构轻量化了，吞吐却未必提升。这并非个别模型的问题，而是小模型设计长期忽略了一个根本事实：“模型更小” 并不等于 “延迟更友好”。 </p>
<p>英伟达研究院就是从这一盲区重新出发：不是把大模型简单缩小，而是把 “真实 GPU 延迟” 作为结构设计的第一原则，全面重构小模型应该长成的样子。最终构建的 Nemotron-Flash 模型同时实现了 SOTA 准确率、低延迟、高吞吐，打败了众多业界小模型。Nemotron-Flash 已集成进 TensorRT-LLM，单 H100 GPU 吞吐可达 41K tokens/second。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f235ecad10cf4fd3bd6c8d4c507ea043~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=pBANRx1WNlGpauXTAJh%2BPb61giY%3D" alt="图片" loading="lazy"/></p>
<p>该论文已被 NeurIPS 2025 接收，相关海报将于 12 月 4 日在 San Diego 展示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c78e61dff384b6894dd660814f229e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=EnhW1WCfjfQzaSCv9lRoh2hc4cs%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>论文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2511.18890" target="_blank" title="https://arxiv.org/pdf/2511.18890" ref="nofollow noopener noreferrer">arxiv.org/pdf/2511.18…</a></li>
<li>Hugging Face: </li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fnvidia%2FNemotron-Flash-1B" target="_blank" title="https://huggingface.co/nvidia/Nemotron-Flash-1B" ref="nofollow noopener noreferrer">huggingface.co/nvidia/Nemo…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fnvidia%2FNemotron-Flash-3B" target="_blank" title="https://huggingface.co/nvidia/Nemotron-Flash-3B" ref="nofollow noopener noreferrer">huggingface.co/nvidia/Nemo…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fnvidia%2FNemotron-Flash-3B-Instruct" target="_blank" title="https://huggingface.co/nvidia/Nemotron-Flash-3B-Instruct" ref="nofollow noopener noreferrer">huggingface.co/nvidia/Nemo…</a></p>
<p>一、小模型为何不够快？</p>
<p>真正跑在 GPU 上之后，一切才暴露</p>
<p>英伟达的分析揭示：小模型之所以不快，是三个长期被忽视的因素造成的:</p>
<p>首先，是深宽比本身就是一个矛盾体。等参数比较时，模型越深往往越强；但在真实 GPU 上，延迟对 “层数” 极为敏感：层越多，kernel 调度越频繁，延迟就越高。结果是一个反直觉的事实：想强要变深，想快要变宽。而大多数小模型都深而窄，自然在延迟上吃亏。</p>
<p>其次，Attention 成本依然是实现高吞吐的最大瓶颈。然而业界对 Mamba2、DeltaNet 等高效算子的组合方式一直缺乏系统方法：哪些层该用 Attention，哪些层应该交给 Linear Attention？没有明确答案。</p>
<p>最后，小模型训练在后期往往会 “提前退场”。权重尺度逐渐偏移、有效梯度下降、模型停滞不前 —— 结构设计再好，容量也无法充分释放。许多小模型的最终性能其实被训练本身限制住了，而不是被参数量限制。</p>
<p>英伟达正是从这三点出发，重新回答了 “小模型应该长成什么样” 这一根本问题。</p>
<p>二、Nemotron-Flash 的核心方法</p>
<p>从延迟重新定义小模型结构</p>
<p>Nemotron-Flash 的方法论围绕三个关键突破展开，每一个都基于真实 GPU 延迟，而非理论 FLOPs。</p>
<ol>
<li>深宽比优化：深度负责能力，宽度负责速度，关键是找到黄金点</li>
</ol>
<p>Nemotron-Flash 的大量真实设备实验揭示了小模型容易被忽略的规律：等参数下，越深越强；等延迟下，越宽越快。这两者天然冲突，意味着：深宽比不是一个随手调的超参，而是决定小模型最终能力和延迟的核心结构维度。</p>
<p>通过绘制 “准确率–延迟” 曲线，以及拟合准确率和模型深度 / 宽度的 scaling law，英伟达最终找到一个稳定的结论：模型必须 “足够深” 才能保住表达能力；也必须 “足够宽” 才能降低实际延迟；最优结构正是深宽交汇的黄金点。Nemotron-Flash-1B/3B 就是根据这套规律得到的结构，因此既不 “深得拖速度”，也不 “宽得能力不足”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa9711ea3942445fbbae9561b4459dbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=0WST2Khtk6gLYBfG%2B0Oh1D2DnmI%3D" alt="图片" loading="lazy"/></p>
<ol start="2">
<li>混合算子结构：真正的速度来自 “谁和谁搭配”，而不是单一的替代</li>
</ol>
<p>Nemotron-Flash 的结构创新并不是简单 “换上新算子”，而是为不同算子明确角色分工，并系统探索它们的最佳协作方式。英伟达先研究了各类算子的准确率–延迟 trade-off，据此构建搜索空间，再使用遗传算法寻找算子在不同层之间的最优比例与位置。最终得到的架构由 Attention、Mamba2、DeltaNet 和 FFN 共同组成，各自承担不同职责：</p>
<ul>
<li>
<p>Attention 负责全局依赖，但必须谨慎控制数量与位置。</p>
</li>
<li>
<p>Mamba2、DeltaNet 等 Linear Attention 负责高吞吐的局部建模，是速度的主力层。</p>
</li>
<li>
<p>FFN 提供稳定的表达容量，是所有 block 的基础骨架。</p>
</li>
</ul>
<p>Nemotron-Flash 的结果显示，小模型的能力和速度不取决于某个 “更好的” 算子，而取决于算子之间的协作模式。这进一步证明：面对真实延迟优化时，混合架构往往比任何单一结构更具优势。</p>
<ol start="3">
<li>Weight Normalization：让小模型在训练后期不再 “掉链子”</li>
</ol>
<p>英伟达观察到，小模型训练后期权重矩阵内部会逐渐形成 structured outliers：随着训练推进，部分行或列会系统性地放大，出现远高于整体分布的大幅值结构，成为随着优化过程累积产生的 “结构化巨权重”。问题在于：这些巨权重会拖慢乃至冻结训练后期的进展。 当某些方向的权重范数过大时，反向传播的梯度在这些方向上被不断缩放，导致 effective learning rate 急剧下降。模型看似还在更新，但实际已经 “踩不动油门”，无法继续提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7ba29e84a74b30930a6ce8d3c614e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=eqnvI52n5OjEoRak19UpvNS3w7s%3D" alt="图片" loading="lazy"/></p>
<p>Nemotron-Flash 的解决方案非常直接有效：在训练过程中的每个 training iteration 后，对每个线性层施加显式 weight normalization，即将模型权重投影到单位范数球面上。这一归一化步骤去除了径向分量，使更新主要发生在角度方向。在相同梯度幅度下，这会带来更大的相对权重变化。</p>
<p>效果立竿见影：训练后期梯度不再被巨权重 “吃掉”，小模型可以持续学习，不会出现常见的 “后期停滞”。在各种模型上，最终收敛质量明显高于未使用 weight normalization 的基线模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e6e09a04c2749a88281e77f701c547e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=h3RwPTRM3fFengiTitmMg0yMKRk%3D" alt="图片" loading="lazy"/></p>
<p>三、Nemotron-Flash Model Family：又快又强</p>
<p>Nemotron-Flash 结合了上面所有技术，提供 1B 和 3B 两种模型大小。在 H100 上的实测结果显示：</p>
<ul>
<li>
<p>Nemotron-Flash-1B 相比 Qwen3-0.6B，准确率提升 5.5%，端侧推理延迟（batch size=1）快 1.9×，最大吞吐高出 45.6×；</p>
</li>
<li>
<p>Nemotron-Flash-3B 相比 Qwen2.5-3B 与 Qwen3-1.7B，准确率提升 2%<del>5.5%，端侧推理延迟（batch size=1）快 1.3×</del>1.7×，最大吞吐提升 6.4×~18.7×；Instruct 版本同样领先，准确率提升约 4.7%，吞吐最高可达 18.7×。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30fa5171e3a241b8967f7038cdc0880a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175021&amp;x-signature=YRdVpVs%2B8CC0NWcVPSQkQ7jJG%2B0%3D" alt="图片" loading="lazy"/></p>
<p>Nemotron-Flash 的速度与稳定性让小模型真正具备 “可规模部署” 的能力，能够在关键业务场景中提供持续、可靠且低延迟的体验 —— 例如在高并发在线服务 中（如搜索助手、智能客服），更快的响应与更高吞吐意味着同样的 GPU 可以服务更多用户且体验更顺滑；在端侧与边缘设备 上（如家用机器人、可穿戴 XR），Nemotron-Flash 的宽结构与高速算子让设备在有限算力下依然能保持实时反应；而在成本敏感的企业私有化部署 场景（如金融、医疗），Nemotron-Flash 是既省成本又能落地高质量 AI 功能的理想选择。</p>
<p>结语</p>
<p>小模型的未来不是 “更小”，而是 “更快、更稳、更强”。Nemotron-Flash 提供了小模型设计的新底层逻辑：深宽比必须围绕延迟设计；算子组合必须有角色分工；训练必须保持后期稳定性。通过这套方法，小模型摆脱了 “虽然小但不快” 的悖论，真正实现了：小而强，小而快，小而可用。</p>
<p>作者简介</p>
<p>文章第一作者为 Yonggan Fu (傅泳淦)，目前为英伟达研究院科学家。2025 年 5 月于 Georgia Institute of Technology 获博士学位，2019 年毕业于中国科学技术大学少年班学院，双修应用物理与计算机科学。博士期间获得 IBM PhD Fellowship 及 ML &amp; Systems Rising Stars 2023。目前研究方向为高效大模型架构与算法。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码高频实践场景系列之二——模具管理]]></title>    <link>https://juejin.cn/post/7578499754552934451</link>    <guid>https://juejin.cn/post/7578499754552934451</guid>    <pubDate>2025-12-01T06:24:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578499754552934451" data-draft-id="7578442185847652390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码高频实践场景系列之二——模具管理"/> <meta itemprop="keywords" content="低代码"/> <meta itemprop="datePublished" content="2025-12-01T06:24:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得帆云低代码"/> <meta itemprop="url" content="https://juejin.cn/user/2254449849150557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码高频实践场景系列之二——模具管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2254449849150557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得帆云低代码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:24:52.000Z" title="Mon Dec 01 2025 06:24:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文作者：得帆信息联合创始人兼CTO徐翔轩</p>
<h2 data-id="heading-0">模具管理的复杂性，常被低估</h2>
<p>在制造业的庞大体系中，模具或许不是最耀眼的资产，却是贯穿生产链条的核心要素。一套模具的质量、寿命、利用率，直接影响产品一致性、产能稳定性与生产成本。</p>
<p>然而，模具管理恰恰是多数企业的“隐性痛点”。模具数量庞大、分布广泛，且状态变化频繁——从启用、维修、借调直至封存，管理链条冗长，涉及部门众多，关键数据却分散在Excel表格、纸质记录甚至个人手中，难以形成统一有效的管理视图。</p>
<p>随着企业生产规模扩大、工厂多地布局，这种碎片化、分散化的管理模式带来的弊端日益凸显：信息壁垒导致透明度缺失，问题出现时责任追溯困难重重，维修计划难以精准及时，资产利用率状况模糊不清。</p>
<p>在此背景下，模具管理系统逐渐转变为制造企业数字化建设的“刚需模块”，成为提升管理效能、优化资源配置的关键突破口。</p>
<h2 data-id="heading-1">为什么传统模具管理系统“难落地”</h2>
<p>不少企业尝试过采购标准化的模具管理软件，但实际落地效果差强人意。究其核心，主要存在三大痛点：</p>
<p>01 业务差异太大</p>
<p>不同企业的模具类型千差万别，管理逻辑、审批机制更是各不相同。标准化软件往往难以完全契合实际流程，导致系统功能与实际需求脱节，员工使用意愿低下。</p>
<p>02 变更频繁、维护困难</p>
<p>新产品导入、工艺调整、设备更换，都会牵动模具台账和流程更新。传统模具管理系统改动依赖厂商开发，周期长、费用高，企业陷入“改不起、等不起”的困境。</p>
<p>03缺乏与其他系统的衔接</p>
<p>模具不仅仅属于设备管理体系，还贯穿生产、采购、库存、财务、质检等核心环节。模具管理系统一旦“孤立运行”，信息链条就断了，核心业务受到重大影响。</p>
<p>因此，企业在不断思考：有没有一种解决方案，既能深度契合现场管理逻辑，又能以低成本、高灵活的方式持续迭代？</p>
<h2 data-id="heading-2">低代码带来的结构性改变</h2>
<p>低代码并非取代传统软件，而是一种更灵活、更可持续的建设方式，能让模具管理系统的建设逻辑发生明显转变。</p>
<p>01 流程适配：让系统真正“长”在现场</p>
<p>模具台账、点检计划、维修记录、报废审批……这些模块均可通过低代码平台由企业自主快速搭建。业务部门能参与流程配置与字段调整，确保系统设计贴合实际生产场景，让系统真正“长在现场”。</p>
<p>02 持续优化：敏捷响应管理变化‌</p>
<p>模具管理具有变化频繁的特点，低代码平台支持“边用边调”：比如新增一类模具、调整审批路径、修改维保周期，企业均可当天完成系统调整，彻底摆脱对IT长周期开发的依赖。</p>
<p>03 数据闭环：实现全生命周期管理‌</p>
<p>通过低代码平台，模具系统可以与ERP、MES、PLM等核心系统无缝对接，从模具采购入库，到生产使用、维修、报废，实现全生命周期管理。所有状态、操作记录自动记录，资产利用率、维修周期、成本分摊等数据可实时可视化。</p>
<p>04 协同共建：业务与IT的双轨机制‌</p>
<p>模具管理系建设往往由设备管理部门主导，IT团队配合。低代码平台与无代码技术相结合的架构，让业务方能快速搭建与试运行，IT团队则专注于复杂逻辑实现与接口治理，形成灵活而稳健的双轨机制。</p>
<h2 data-id="heading-3">为什么模具管理是低代码落地的“最佳练兵场”</h2>
<p>在制造业的众多场景中，模具管理堪称“投入小、收益快、复制强”的黄金实践领域。其独特价值体现在三重特性：</p>
<ul>
<li>模具管理的逻辑足够复杂，能验证平台的可扩展性；</li>
<li>模具管理边界清晰，相对独立，适合快速上线与验证；</li>
<li>模具管理数据敏感度低，适合企业自主建设与推广。</li>
</ul>
<p>因此，很多企业选择从模具管理系统入手，验证低代码平台的可用性与团队的实操能力。</p>
<p>当系统运行顺畅后，其经验会自然扩展到相邻领域，如设备管理、工装夹具、备品备件、工单排程等。低代码的价值，也正是在“从点到面”的演进中充分显现。</p>
<h2 data-id="heading-4">结语</h2>
<p>模具管理的数字化，本质是企业运营透明度与治理能力的体现。</p>
<p>传统软件强调“功能覆盖”，而低代码更强调“能力延伸”——让企业能以更灵活的方式，构建属于自己的数字化体系。</p>
<p>对制造业CIO和数字化负责人而言，模具管理是观察低代码平台是落地实效的“窗口”：低代码能否快速响应变化？能否支撑多厂区协同？能否随业务需求持续演进？</p>
<p>在越来越多制造企业的实践中，答案已经逐渐清晰——低代码，不仅是将模具管理从隐性痛点转化为企业数字化能力的基石，它更是制造企业迈向透明化、敏捷化治理的重要起点。</p>
<p>大家还对哪些内容感兴趣，或者是希望一起探讨相关的方法，欢迎留言和私信联系。希望得帆低代码和我们的实践心得，能帮到越来越多的朋友、客户。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【水果识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法]]></title>    <link>https://juejin.cn/post/7578499754552950835</link>    <guid>https://juejin.cn/post/7578499754552950835</guid>    <pubDate>2025-12-01T06:26:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578499754552950835" data-draft-id="7578511778888417318" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【水果识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法"/> <meta itemprop="keywords" content="图像识别"/> <meta itemprop="datePublished" content="2025-12-01T06:26:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【水果识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:26:25.000Z" title="Mon Dec 01 2025 06:26:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、介绍</h2>
<p>水果识别系统，基于TensorFlow搭建Resnet50卷积神经网络算法，通过对5种常见的水果图片数据集（'圣女果', '梨', '芒果', '苹果', '香蕉'）进行训练，最后得到一个识别精度较高的模型，然后搭建Web可视化操作平台。</p>
<p><strong>技术栈</strong>：</p>
<ul>
<li>项目前端使用Html、CSS、BootStrap搭建界面。</li>
<li>后端基于Django处理逻辑请求</li>
<li>基于Ajax实现前后端数据通信</li>
</ul>
<p><strong>选题背景与意义</strong>：
在数字化与智能化浪潮推动下，计算机视觉技术在农业领域的应用愈发广泛，水果识别作为其中重要分支，对提升农产品分拣效率、优化供应链管理意义重大。然而传统人工识别方式效率低、成本高，难以满足大规模生产需求。在此背景下，我们基于TensorFlow搭建Resnet50卷积神经网络算法，利用5种常见水果（圣女果、梨、芒果、苹果、香蕉）的图片数据集训练出高精度识别模型，并进一步搭建Web可视化操作平台，前端采用Html、CSS、BootStrap，后端依托Django，借助Ajax实现高效数据通信，以实现便捷、智能的水果识别。</p>
<h2 data-id="heading-1">二、系统效果图片展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2736593ed8e476893595c87b1fe40ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175184&amp;x-signature=X2o5zIfVClktW9r8W9EPgZ8WiJ8%3D" alt="图片" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1acc3396d4f8422dbdea466c3488dd06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175184&amp;x-signature=%2FkWsSU8yJ%2FWWKc1xKVQlk7BtqbA%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">三、演示视频 and 完整代码 and 安装</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2FfdiDmw" target="_blank" title="https://ziwupy.cn/p/fdiDmw" ref="nofollow noopener noreferrer">ziwupy.cn/p/fdiDmw</a></p>
<h2 data-id="heading-3">四、卷积神经网络算法介绍</h2>
<p>卷积神经网络（Convolutional Neural Network，CNN）是一种专门为处理具有网格结构数据（如图像）而设计的深度学习模型。它通过卷积层自动提取图像的局部特征，利用池化层降低数据维度、减少计算量并增强模型的鲁棒性，最后通过全连接层对提取的特征进行分类或回归。CNN的关键优势在于其具有局部感知和参数共享的特性，能显著减少参数量，提高训练效率，在图像识别、目标检测等计算机视觉任务中表现卓越。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers, models

<span class="hljs-comment"># 构建简单的CNN模型</span>
model = models.Sequential([
    layers.Conv2D(<span class="hljs-number">32</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>, <span class="hljs-number">3</span>)),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Conv2D(<span class="hljs-number">64</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Flatten(),
    layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
    layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)
])

model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>,
              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre>
<p>上述代码构建了一个简单的CNN模型用于图像识别。它包含两个卷积层和两个池化层，用于特征提取和降维，接着通过全连接层进行分类。使用adam优化器和交叉熵损失函数，适用于多分类任务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NeurIPS 2025 | DePass：通过单次前向传播分解实现统一的特征归因]]></title>    <link>https://juejin.cn/post/7578332586063413299</link>    <guid>https://juejin.cn/post/7578332586063413299</guid>    <pubDate>2025-12-01T06:25:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578332586063413299" data-draft-id="7578442185847685158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NeurIPS 2025 | DePass：通过单次前向传播分解实现统一的特征归因"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-01T06:25:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NeurIPS 2025 | DePass：通过单次前向传播分解实现统一的特征归因
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:25:56.000Z" title="Mon Dec 01 2025 06:25:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>共同一作：洪翔宇，清华大学电子系大四本科生，曾获清华大学蒋南翔奖学金等，曾在NeurIPS，EMNLP，NAACL等顶级会议上发表论文。姜澈，清华大学电子系博士三年级在读，主要研究方向为LLM Interpretebility，LLM Agent，曾在NeurIPS，ICML，EMNLP，NAACL等顶级会议上发表论文。</p>
<p>随着大型语言模型在各类任务中展现出卓越的生成与推理能力，如何将模型输出精确地追溯到其内部计算过程，已成为 AI 可解释性研究的重要方向。然而，现有方法往往计算代价高昂、难以揭示中间层的信息流动；同时，不同层面的归因（如 token、模型组件或表示子空间）通常依赖各自独立的特定方法，缺乏统一且高效的分析框架。</p>
<p>针对这一问题，来自清华、上海 AI Lab 的研究团队提出了全新的统一特征归因框架——DePass（Decomposed Forward Pass）。</p>
<p>该方法通过将前向传播中的每个隐藏状态分解为多个可加子状态，并在固定注意力权重与 MLP 激活的情况下对其逐层传播，实现了对 Transformer 内部信息流的无损分解与精确归因。借助 DePass，研究者能够在输入 token、注意力头、神经元乃至残差流子空间等多个层面上进行归因分析，为机制可解释性研究提供了统一而细粒度的新视角。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a06145c131724ecdb32b2d93622b2e24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=X6wd3n0CIfTWLX2XdVYdjmO9BO4%3D" alt="图片" loading="lazy"/></p>
<ul>
<li>
<p>论文标题：DePass: Unified Feature Attributing by Simple Decomposed Forward Pass</p>
</li>
<li>
<p>论文链接： <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2510.18462" target="_blank" title="https://arxiv.org/pdf/2510.18462" ref="nofollow noopener noreferrer">arxiv.org/pdf/2510.18…</a></p>
</li>
<li>
<p>代码链接： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTsinghuaC3I%2FDecomposed-Forward-Pass" target="_blank" title="https://github.com/TsinghuaC3I/Decomposed-Forward-Pass" ref="nofollow noopener noreferrer">github.com/TsinghuaC3I…</a></p>
</li>
</ul>
<h4 data-id="heading-0">问题分析：</h4>
<h4 data-id="heading-1">现有归因方法的局限性</h4>
<p>现有的归因方法大致可以分为以下几类：</p>
<ul>
<li>
<p><strong>基于噪声消融和激活修补的方法：</strong>  这些方法通过直接对模型的所有模块施加噪声或修补激活值来分析模型行为，但计算成本高昂，且难以洞察中间信息流。</p>
</li>
<li>
<p><strong>基于梯度的归因方法：</strong>  这类方法在理论上面临挑战，难以提供细粒度的解释。</p>
</li>
<li>
<p><strong>基于模型近似或抽象的方法：</strong>  虽然部分方法能够与人类认知对齐，但通常无法达到细粒度的组件级别（如神经元或注意力头），且非保守的近似可能会损害归因的可信度。</p>
</li>
</ul>
<h4 data-id="heading-2">DePass：</h4>
<h4 data-id="heading-3">一种全新的归因框架</h4>
<p>DePass 通过将隐藏状态 X 分解为自定义的加性组件<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae5ddd53e2374c85a80ffad92d01424e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=%2FI0ciYsuXnigwZ8GYFxOHgYbp8w%3D" alt="图片" loading="lazy"/>，并在固定注意力分数与 MLP 激活值的条件下传播这些组件，实现了对模型行为的精确且细粒度的归因。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/651c32d82b2d4e4a8cfe96372dd0385d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=RrFdUc2PQMuy0uasJxNEeuP%2BH74%3D" alt="图片" loading="lazy"/></p>
<p>在具体实现上：</p>
<ul>
<li><strong>对于 Attention 模块：</strong>  DePass 冻结注意力分数后，将各组件的隐藏状态经过线性变换，再根据注意力权重加权累加至对应组件，实现对信息流的精确分配。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aac7b3d7e8ae4913bc97fe2ebb3ff049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=YPdJ%2Fp0ALe3j3W2zVhFCh3kvuTI%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e90901a4fe34345b3e5bf9306233a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=kylTu4OV8SXtAyS39XjSOHmQC4Q%3D" alt="图片" loading="lazy"/></p>
<ul>
<li><strong>对于 MLP 模块：</strong>  则将其视作以神经元为单位的键值存储库（key-value store），通过不同组件对 key 激活值的贡献程度，将对应的 value 有效地划分至同一 token 的不同组件中。下式中的<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b5cbbdc6e1945f193a021f713b26f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=8H38ASUdXI8Q0geu8aMcd7A1cC8%3D" alt="图片" loading="lazy"/>代表神经元 k 的输出分配到组件 m 上的权重。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/187c6581330f4063bc4461f239506bb8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=BZ85T6OldFe0K4LH20DZG%2B00eac%3D" alt="图片" loading="lazy"/></p>
<h4 data-id="heading-4">实验验证：</h4>
<h4 data-id="heading-5">DePass 的有效性</h4>
<p>DePass 提供了一个统一的归因框架，支持在输入 token、注意力头、神经元以及残差流子空间等多个层面进行一致归因，无需修改模型结构或依赖任务特定近似，并可自然衔接人类推理及稀疏字典学习（如 SAE）等方法。研究团队在 token 级、模型组件级和子空间级归因任务上验证了 DePass 的有效性：</p>
<p><strong>Token-Level DePass——输出归因到输入：精准识别驱动预测的核心证据</strong></p>
<p>我们首先在输出到输入 token 的归因任务上验证了 DePass 的表现，目标是评估每个输入 token 对模型最终输出的实际贡献。</p>
<p>在「Disrupt-top」实验中，移除 DePass 判定最关键的 tokens 会导致模型输出概率急剧下降，表明其捕捉到了真正驱动预测的核心证据；而在「Recover-top」实验中，DePass 保留的极少量 tokens 依然能高度恢复模型判断。这表明 DePass 能够更忠实地刻画模型内部的信息流动与输入贡献关系，实现高可信度的 token 级归因分析。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d4c506f213b4a239bfe5cd04d2272dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=SYQXmoV%2BrcIjlZQnLN1XhxPUNl0%3D" alt="图片" loading="lazy"/></p>
<p><strong>Token-Level DePass——子空间归因到输入：追踪子空间信号的 token 来源</strong></p>
<p>DePass 不仅能在 token 层面追踪预测依据，还能精准定位哪些输入 token 激活了模型中「特定方向/特定语义子空间」的信号（例如「truthfulness」方向），从而识别出影响模型判断的关键来源（如误导性信息），并显著提升模型的可控性与可解释性。</p>
<p>在事实性任务中，团队利用 DePass 将「虚假信息子空间」拆解后，进一步将其激活分配到每个输入 token。归因结果清晰揭示了哪些词触发了模型的错误方向。基于这些 token 进行定向遮罩后，模型在 CounterFact 上的事实性准确率从约 10% → 40%+ 大幅提升，显著优于现有 probe-based masking 方法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63f7c3cbbb8f4964aca34ae750dee19f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=E8iKHNIIB2y6NIX8TFICwJk%2Ba1I%3D" alt="图片" loading="lazy"/></p>
<p><strong>Model-Component-Level DePass——模型组件级归因：观察注意力头与 MLP 神经元的实际功能</strong></p>
<p>DePass 能直接量化每个注意力头与 MLP 神经元对预测的真实贡献，在遮罩实验中显著优于梯度、激活等传统重要性指标。</p>
<p>当遮罩 DePass 判定的「重要组件」（Top-k Masking）时，模型准确率下降更快；当仅保留「最不重要组件」（Bottom-k Masking）时，模型性能保持得更好。这说明 DePass 识别的组件重要性具备更高的敏感性、完备性、因果性，在 IOI 与 CounterFact 等任务上均显著超越 AtP、Norm 等主流归因指标。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1657199d47cd4fe580589d1d5f480788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=pnitHvorvDGdvlfR1%2BK4YI41YBE%3D" alt="图片" loading="lazy"/></p>
<p><strong>Subspace-Level DePass——子空间级归因</strong></p>
<p>DePass 还可以用于研究隐状态中不同子空间之间的相互作用，以及这些子空间对最终输出的影响。我们以语言子空间（language subspace）为例进行分析。</p>
<p>我们训练了一个语言分类器，并将其权重方向作为语言子空间的基向量。随后，将中间层的隐状态分别投影到语言子空间与其正交语义子空间中；两部分隐状态在网络中分别独立传播至最终层，并通过 LM Head 解码，以观察其对应输出。</p>
<ul>
<li>
<p><strong>语言子空间：</strong>  经 t-SNE 显示形成清晰的语言聚类（如英文/法文/德文），体现语言特征集中分布。</p>
</li>
<li>
<p><strong>语义子空间：</strong>  独立解码结果跨语言一致，例如无论输入语言为何，都会生成相同的事实答案（如「Dutch」）。</p>
</li>
</ul>
<p>这一结果说明 DePass 能忠实保留并传播子空间的功能属性，为跨语言解释和语义分解提供了全新视角。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bff13f065c8949128e459baa3cfdf8db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175155&amp;x-signature=LIEHrkt%2FkGSLKN8rA1UBD%2BviIrA%3D" alt="图片" loading="lazy"/></p>
<p>（左）对 token 在语言子空间上的投影进行 t-SNE 可视化。（右）针对不同多语言提示语，从语言子空间与语义子空间中解码得到的前五个 token</p>
<h4 data-id="heading-6">总结</h4>
<p>DePass 作为一种基于分解前向传播的 Transformer 解释框架，兼具简洁性与高效性。通过冻结并分配注意力得分和 MLP 激活，DePass 实现了无损的加性分解，可无缝适配各种 Transformer 架构。</p>
<p>实验结果表明，DePass 在多层次粒度的归因分析中具有更高的忠实性。我们期望 DePass 能成为机制可解释性研究中的通用工具，推动社区在更广泛的任务与模型上探索其潜力与应用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【动物识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法]]></title>    <link>https://juejin.cn/post/7578511778888482854</link>    <guid>https://juejin.cn/post/7578511778888482854</guid>    <pubDate>2025-12-01T06:32:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578511778888482854" data-draft-id="7578460753209655323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【动物识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法"/> <meta itemprop="keywords" content="后端,图像识别,深度学习"/> <meta itemprop="datePublished" content="2025-12-01T06:32:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【动物识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:32:42.000Z" title="Mon Dec 01 2025 06:32:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、介绍</h2>
<p>动物识别系统，基于TensorFlow搭建Resnet50卷积神经网络算法，通过对4种常见的动物图片数据集（猫、鸡、马、狗）进行训练，最后得到一个识别精度较高的模型，然后搭建Web可视化操作平台。</p>
<p><strong>技术栈</strong>：</p>
<ul>
<li>项目前端使用Html、CSS、BootStrap搭建界面。</li>
<li>后端基于Django处理逻辑请求</li>
<li>基于Ajax实现前后端数据通信</li>
</ul>
<p><strong>选题背景与意义</strong>：
在人工智能技术蓬勃发展的当下，动物识别作为计算机视觉领域的重要应用方向，有着广泛的实际需求，如动物保护监测、智能安防等场景均需精准高效的动物识别能力。在此背景下，我们开展了动物识别系统的研发项目。该系统基于TensorFlow搭建Resnet50卷积神经网络算法，利用猫、鸡、马、狗4种常见动物图片数据集训练，以获取高精度识别模型。同时，为方便用户操作，项目还采用Html、CSS等搭建前端界面，Django处理后端逻辑，Ajax实现数据通信，搭建起Web可视化操作平台。</p>
<h2 data-id="heading-1">二、系统效果图片展示</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da0eae00153d4e549874ac410da1579a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175562&amp;x-signature=ilGrb6ATNNuJLdooGEz5cLWDcqc%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">三、演示视频 and 完整代码 and 安装</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2FxtcmVA" target="_blank" title="https://ziwupy.cn/p/xtcmVA" ref="nofollow noopener noreferrer">ziwupy.cn/p/xtcmVA</a></p>
<h2 data-id="heading-3">四、卷积神经网络算法介绍</h2>
<p>卷积神经网络（Convolutional Neural Network，CNN）是一种专门为处理具有网格结构数据（如图像）而设计的深度学习模型。它通过卷积层自动提取图像的局部特征，利用池化层降低数据维度、减少计算量并增强特征鲁棒性，再通过全连接层对提取的特征进行分类或回归。CNN的核心优势在于能够自动学习图像的层次化特征，从边缘、纹理等低级特征逐步组合成高级语义特征，无需人工手动设计特征提取规则，大大提高了图像识别的准确率和效率。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers, models

<span class="hljs-comment"># 构建CNN模型</span>
model = models.Sequential([
    layers.Conv2D(<span class="hljs-number">32</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">64</span>, <span class="hljs-number">64</span>, <span class="hljs-number">3</span>)),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Conv2D(<span class="hljs-number">64</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Flatten(),
    layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
    layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)
])

<span class="hljs-comment"># 编译模型</span>
model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>,
              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])
</code></pre>
<p>上述代码构建了一个简单的CNN模型，包含两个卷积层和池化层用于特征提取，一个展平层将特征图转换为一维向量，最后通过两个全连接层进行分类。此模型适用于图像分类任务，通过调整网络结构和参数，可适配不同数据集和识别需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[免费 SSL 证书缩短至 90 天，你的运维成本还能hold住吗]]></title>    <link>https://juejin.cn/post/7578511778888433702</link>    <guid>https://juejin.cn/post/7578511778888433702</guid>    <pubDate>2025-12-01T06:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578511778888433702" data-draft-id="7578138892127748142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="免费 SSL 证书缩短至 90 天，你的运维成本还能hold住吗"/> <meta itemprop="keywords" content="前端,后端,HTTPS"/> <meta itemprop="datePublished" content="2025-12-01T06:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户已不存在"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            免费 SSL 证书缩短至 90 天，你的运维成本还能hold住吗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户已不存在
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:26:16.000Z" title="Mon Dec 01 2025 06:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着网络安全环境的变化，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fssl" target="_blank" title="https://www.servbay.com/features/ssl" ref="nofollow noopener noreferrer">SSL 证书</a>行业正在经历一次深刻的调整。以 Google 为首的国际标准制定者及主流云服务商，纷纷将免费 DV SSL 证书的有效期从 1 年缩减至 90 天，我怀疑是为了卖付费证书（bushi）。这一举措虽然在理论上缩短了密钥泄露的风险窗口，但在实际执行层面，却给企业的运维管理带来了显著的弊端。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aa1a6e5023945ef920e6b2ef0c11cbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175640&amp;x-signature=r7CKz1Euze9ldVWRdWo3WvKllkU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0"><strong>一、 管理成本的显著增加</strong></h3>
<p>对于拥有大量域名和服务器资产的企业而言，证书有效期的缩短并不只是多申请几次那么简单。</p>
<ul>
<li>
<p><strong>资源投入翻倍</strong>：更新频率的增加直接导致了管理成本的上升。企业需要投入更多的计算资源和人力资源来监控、管理和更新证书。</p>
</li>
<li>
<p><strong>人力负担加重</strong>：运维团队被迫从核心业务中分流，专门处理繁琐的证书续订和部署工作。对于服务器数量众多的架构，这甚至可能需要设立专门的流程或岗位来应对。</p>
</li>
</ul>
<h3 data-id="heading-1"><strong>二、 操作风险的被动提高</strong></h3>
<p>在运维领域，每一次变更都意味着风险。90 天的更新周期将这种风险频率提高了四倍。</p>
<ul>
<li>
<p><strong>更新过程中的潜在故障</strong>：无论是手动更新还是依赖脚本自动化，每次替换证书都存在配置错误、脚本执行失败或环境兼容性问题的风险。一次微小的失误就有可能导致服务中断，影响业务连续性。</p>
</li>
<li>
<p><strong>过期风险激增</strong>：高频率的更新要求极高的执行力。一旦监控疏漏或自动化任务卡死，遗漏更新的概率随之增加。网站弹出安全警告不仅会导致服务不可用，更会严重损害用户对品牌的信任。</p>
</li>
</ul>
<h3 data-id="heading-2"><strong>三、 中小企业与开发者的困境</strong></h3>
<p>相比于拥有完善 DevOps 体系的大型互联网公司，中小型企业和独立开发者面临的挑战更为严峻。</p>
<p>由于资源限制，这些群体往往缺乏自动化的运维平台或专门的安全团队。面对 90 天的强制更新，他们不得不在“投入大量精力手动维护”和“承担业务中断风险”之间做选择，这对在线业务的稳定性构成了实质性的不利影响。</p>
<p><strong>市场现状：付费证书的价格门槛</strong></p>
<p>为了规避上述风险，回归 1 年期的长效证书成为最优解。然而，目前市场上付费证书的定价策略普遍较高。主流云厂商的单域名证书价格通常在几百元，而支持无限子域名的通配符（Wildcard）证书价格更是高达千元以上。这种高昂的定价，在很大程度上阻碍了开发者获取稳定的安全服务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/880fd9bbe1e843c4b7c8f686e104fb61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175640&amp;x-signature=ybV99RGFI5TXoA3JmxOFuDjhWas%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3"><strong>ServBay Store：低成本的破局方案</strong></h4>
<p>针对这一行业痛点，ServBay 正式推出了 ServBay Store，价格直接击穿地花板，降低长效 SSL 证书的获取门槛，帮助开发者摆脱频繁续签的运维焦虑。</p>
<p>ServBay Store 提供的 1 年期 DV（域名验证）证书价格如下：</p>
<ul>
<li>
<p><strong>DV</strong> <strong>Single (单域名证书)：¥29.00 / 年</strong></p>
<ul>
<li>  以极低的成本锁定一整年的安全周期，无需再为每季度的续签分散精力。</li>
</ul>
</li>
<li>
<p><strong>DV</strong> <strong>Wildcard (通配符证书)：¥256.00 / 年</strong></p>
<ul>
<li>这是目前市场上极具性价比的方案。一张证书即可覆盖主域名及所有子域名，特别适合拥有复杂开发环境或多业务线的团队，相比传统渠道节省了大量预算。</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4fd68d43dde40b0b766e793794b6161~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175640&amp;x-signature=OiUMFeJfkY0Gsf01IwylP2DlyBw%3D" alt="" loading="lazy"/></p>
<p><strong>上线专项福利：1000 张年期证书免费赠送</strong></p>
<p>为了庆祝商店上线，并切实帮助用户解决燃眉之急，ServBay 自掏腰包采购了 1000 张有效期为 1 年的 DV SSL 证书，免费赠送给ServBay用户。</p>
<ul>
<li>
<p><strong>数量：</strong> 限量 1000 张</p>
</li>
<li>
<p><strong>规则：</strong> 每位 ServBay 用户仅限领取一张，领完即止。</p>
</li>
<li>
<p>领取地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Fstore" target="_blank" title="https://www.servbay.com/store" ref="nofollow noopener noreferrer">ServBay商店</a></p>
</li>
</ul>
<p>对于希望降低管理成本、规避操作风险的开发者，建议前往 ServBay Store 了解详情。这不仅是获取免费资源的良机，更是构建低维护成本、高稳定性开发环境的有效选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[怎么在 iOS 上架 App，从构建端到审核端的全流程协作解析]]></title>    <link>https://juejin.cn/post/7578416583212810290</link>    <guid>https://juejin.cn/post/7578416583212810290</guid>    <pubDate>2025-12-01T06:37:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578416583212810290" data-draft-id="7578499754553032755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="怎么在 iOS 上架 App，从构建端到审核端的全流程协作解析"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-01T06:37:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            怎么在 iOS 上架 App，从构建端到审核端的全流程协作解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:37:10.000Z" title="Mon Dec 01 2025 06:37:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在多数团队的理解里，“iOS 上架”听起来像一个固定流程：把 IPA 准备好、上传、提交审核。
但真实情况往往并不是这样。真正的上架过程更接近一次跨部门协作：构建、证书、素材、隐私、审核说明、接口稳定性……任何一个环节出现偏差，最终都可能导致审核失败。</p>
<p>因此，与其把它当成流程，不如把它当成“交付链路”，每一环都决定最终是否能顺利上线。</p>
<p>这篇文章总结的是更贴近真实工作的那种上架方式，适合原生团队、Hybrid 团队、跨端团队一起协作执行。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、上架的起点不是 IPA，而是“确认应用是否具备提交条件”</strong></h2>
<p>团队最容易忽略的一点是：<strong>上架并不是从构建开始，而是从应用结构检查开始。</strong></p>
<p>一般我们会在内部启动一次“提交前自检”，通常包括：</p>
<h3 data-id="heading-1"><strong>1. 隐私与权限是否符合苹果要求</strong></h3>
<ul>
<li>权限弹窗是否解释清楚</li>
<li>是否采集了未声明的数据</li>
<li>第三方 SDK 行为与隐私标签一致</li>
<li>Info.plist 权限说明是否规范</li>
</ul>
<p>隐私（5.1.1）是最常见拒审原因之一。</p>
<hr/>
<h3 data-id="heading-2"><strong>2. 关键功能是否可在弱网、首次运行环境下复现</strong></h3>
<p>审核网络并不稳定，因此：</p>
<ul>
<li>首屏必须优雅</li>
<li>登录必须可用</li>
<li>页面不能依赖未经授权的权限</li>
<li>弱网下不能直接卡死</li>
</ul>
<p>这是避免 2.1 的关键。</p>
<hr/>
<h3 data-id="heading-3"><strong>3. 是否准备好审核账号（如有登录）</strong></h3>
<p>这在实际流程中非常关键：</p>
<ul>
<li>专用账号</li>
<li>简化权限</li>
<li>可直接进入核心功能</li>
</ul>
<p>否则审核员会直接拒审。</p>
<hr/>
<h2 data-id="heading-4"><strong>二、构建 IPA：技术栈不同，上架路径完全不同</strong></h2>
<p>上架流程在这里开始出现分歧，因为不同团队的技术栈有不同构建方式。</p>
<hr/>
<h3 data-id="heading-5"><strong>1. 原生团队</strong></h3>
<p>流程最传统：</p>
<ul>
<li>Xcode Archive</li>
<li>导出 IPA</li>
<li>验证签名</li>
<li>固定构建机</li>
</ul>
<p>适合纯 Swift / Objective-C 项目。</p>
<hr/>
<h3 data-id="heading-6"><strong>2. Hybrid / H5 / uni-app 团队</strong></h3>
<p>这种团队构建方式更轻：</p>
<ul>
<li>HBuilderX 云打包</li>
<li>或导出 Xcode 工程交给构建机</li>
<li>或 CI/CD 调用云构建服务</li>
</ul>
<p>构建本身几乎不依赖开发者本地环境。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9b214c82f9d424faf073fd708487e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175830&amp;x-signature=Wispx%2BcM1gllIYva2X1HdFgz1Ss%3D" alt="hb打包" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7"><strong>3. 跨端框架（Flutter / React Native）</strong></h3>
<p>通常采用云端统一构建：</p>
<ul>
<li>GitHub Actions</li>
<li>Codemagic</li>
<li>Appcircle</li>
</ul>
<p>这类团队更依赖 CI/CD，构建完成后下载 IPA 即可。</p>
<hr/>
<h3 data-id="heading-8"><strong>4. 游戏团队（Unity / Cocos）</strong></h3>
<p>流程通常分两段：</p>
<ul>
<li>Windows 生成 Xcode 工程</li>
<li>上传到云端构建成 IPA</li>
</ul>
<p>整个过程更偏研发管线化。</p>
<hr/>
<h2 data-id="heading-9"><strong>三、证书与描述文件：团队级协作的“隐形基础设施”</strong></h2>
<p>iOS 上架对证书体系有严格要求：</p>
<ul>
<li>发布证书（Distribution Certificate）</li>
<li>App Store 描述文件</li>
<li>Bundle ID 必须完全匹配</li>
</ul>
<p>过去证书管理常依赖 Mac 钥匙串，但现代团队通常使用开心上架（Appuploader）来跨平台方式生成证书，让 Windows、Linux、Mac 都能共享 p12 和描述文件。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eefc44e144c4c76a8aebb8b40089b7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175830&amp;x-signature=pnEW%2Fi8ibf8gAxRrDOKr8Di2Dlg%3D" alt="证书生成" loading="lazy"/></p>
<p>这样：</p>
<ul>
<li>新成员加入不会被卡死</li>
<li>CI/CD 能自动注入证书</li>
<li>构建机不会出现证书冲突</li>
</ul>
<p>证书的规范化管理，对团队非常重要。</p>
<hr/>
<h2 data-id="heading-10"><strong>四、IPA 上传：iOS 发布流程真正的关键节点</strong></h2>
<p>上传是上架过程中最容易遇到系统差异的部分。</p>
<p>常见的上传方式包括：</p>
<hr/>
<h3 data-id="heading-11"><strong>1. Xcode Organizer</strong></h3>
<p>优点：</p>
<ul>
<li>官方</li>
<li>错误信息直观</li>
</ul>
<p>缺点：</p>
<ul>
<li>必须 Mac</li>
<li>不适合多人协作</li>
</ul>
<hr/>
<h3 data-id="heading-12"><strong>2. Transporter</strong></h3>
<p>优点：</p>
<ul>
<li>操作简单</li>
<li>运营人员也能用</li>
<li>适合独立提交</li>
</ul>
<p>缺点：</p>
<ul>
<li>依然局限于 Mac</li>
</ul>
<hr/>
<h3 data-id="heading-13"><strong>3. 开心上架（Appuploader）跨平台命令行上传工具</strong></h3>
<p>适用于：</p>
<ul>
<li>Windows 构建团队</li>
<li>Linux CI</li>
<li>自动化发布管线</li>
<li>高频 TF 上传</li>
</ul>
<p>使用方式类似：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli \
  -u dev@team.com \
  -p xxx-xxx-xxx-xxx \
  -c 2 \
  -f ./build/app.ipa
</code></pre>
<p>优势：</p>
<ul>
<li>Windows / Linux / macOS 均可</li>
<li>上传新通道与旧通道</li>
<li>易于集成到自动化流程</li>
<li>不依赖 Mac 环境</li>
</ul>
<p>对于跨端团队来说，这类工具可以把“平台差异”彻底消除。</p>
<p>图形化界面：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/718eff28f539457492527c9069e37d9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765175830&amp;x-signature=cwER8TuDRn%2Bgbzt3NU6ObcyAQ%2BI%3D" alt="IPA上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-14"><strong>五、App Store Connect 配置：审核成功率由细节决定</strong></h2>
<p>IPA 上传后，需要完成：</p>
<h3 data-id="heading-15"><strong>1. 应用截图（必须真实）</strong></h3>
<p>不能展示不存在的界面，也不能过度渲染。</p>
<h3 data-id="heading-16"><strong>2. 描述与关键词</strong></h3>
<p>内容必须与应用实际行为一致。</p>
<h3 data-id="heading-17"><strong>3. 隐私标签</strong></h3>
<p>必须如实填写 H5、SDK、客户端采集的数据。</p>
<h3 data-id="heading-18"><strong>4. 审核说明</strong></h3>
<p>告诉审核员如何进入核心功能（尤其有登录时）。</p>
<p>这些内容往往由产品、运营、测试共同完成。</p>
<hr/>
<h2 data-id="heading-19"><strong>六、审核阶段：理解苹果审核的逻辑，而不是“猜测”</strong></h2>
<p>常见拒审类型包括：</p>
<h3 data-id="heading-20"><strong>2.1 功能不可用</strong></h3>
<p>解决：服务器白名单、弱网优化、精简流程。</p>
<h3 data-id="heading-21"><strong>4.2 最低功能要求不满足</strong></h3>
<p>解决：加入原生结构、增强交互。</p>
<h3 data-id="heading-22"><strong>5.1.1 权限说明不规范</strong></h3>
<p>解决：补充 Info.plist 权限描述、补全隐私标签。</p>
<h3 data-id="heading-23"><strong>4.3 重复 App</strong></h3>
<p>解决：确保功能、内容与其他版本明显区别。</p>
<p>团队要做的不是反复尝试，而是根据拒审说明快速定位原因。</p>
<hr/>
<h2 data-id="heading-24"><strong>上架是一套流程工程</strong></h2>
<p>成熟团队会把上架变成一个可复现的流程：</p>
<ul>
<li>证书管理标准化</li>
<li>构建环境固定</li>
<li>IPA 上传工具可连续运行</li>
<li>App Store Connect 配置有模板</li>
<li>审核说明有标准格式</li>
<li>拒审处理有 SOP</li>
</ul>
<p>只有把上架工程化，才能真正降低风险和时间成本。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F83%2F83.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/83/83.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码高频实践场景系列之三——LIMS实验室管理]]></title>    <link>https://juejin.cn/post/7578332586063478835</link>    <guid>https://juejin.cn/post/7578332586063478835</guid>    <pubDate>2025-12-01T06:37:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578332586063478835" data-draft-id="7578416583212761138" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码高频实践场景系列之三——LIMS实验室管理"/> <meta itemprop="keywords" content="低代码"/> <meta itemprop="datePublished" content="2025-12-01T06:37:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得帆云低代码"/> <meta itemprop="url" content="https://juejin.cn/user/2254449849150557"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码高频实践场景系列之三——LIMS实验室管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2254449849150557/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得帆云低代码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:37:57.000Z" title="Mon Dec 01 2025 06:37:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文作者：得帆信息联合创始人兼CTO徐翔轩</p>
<h2 data-id="heading-0">LIMS的重要性，正被重新认识</h2>
<p>在研发、生产和质检链条中，实验室始终扮演着至关重要的角色：它是新产品导入的前哨，是质量把控的关卡，也是法规合规的支撑点。LIMS（实验室信息管理系统）的价值，正通过数字化手段得以充分释放——它全面覆盖样品管理、检测流程、结果归档与追溯等核心环节，让实验室的运转变得透明、高效且全程可追溯。
LIMS（实验室信息管理系统）是专为实验室设计的数字化管理工具，用于优化样品检测、数据管理和质量控制流程。核心功能包括样品追踪、任务自动化分配、仪器数据采集及报告生成，显著提升效率并减少人为误差。广泛应用于医药、环境监测、食品安全等领域，帮助实验室符合ISO、GMP等合规要求。
长期以来，LIMS被认为是“高度专业化”的系统，似乎只有专业厂商能提供完整的解决方案。近两年，越来越多企业开始选择用低代码来建设或改造LIMS系统，这一趋势背后，蕴藏着深刻的行业逻辑与技术变革的必然性。</p>
<h2 data-id="heading-1">为什么传统LIMS常常“不合身”</h2>
<p>不少企业部署传统LIMS，但实际落地时，效果往往差强人意，主要原因包括：</p>
<p>01 行业差异大，难以标准化</p>
<p>制药、生物医药行业关注法规合规与数据追溯；食品、农产品行业关注批次管理与检测标准；新能源、材料行业则更重视设备联动与性能分析。显著的行业差异使得传统系统难以精准适配各类实验室的独特业务流程。</p>
<p>02  需求变化快，维护成本高</p>
<p>新产品导入、新检测项目、法规标准更新，都会引发实验流程和数据结构的调整。传统系统改造周期长、费用高，许多企业因无法承受持续的维护投入而放弃使用。</p>
<p>03 容易成为信息孤岛</p>
<p>实验室的数据需要与ERP、MES、PLM、QMS等企业级系统深度协同。一旦LIMS无法融入企业整体数字化架构，就会形成数据孤岛，影响跨部门协作，价值大打折扣。</p>
<h2 data-id="heading-2">低代码带来的新可能</h2>
<p>低代码的价值（如得帆低代码aPaaS平台），在于提供了“灵活可配、可持续演进”的建设方式。它并不是要替代传统LIMS，而是为实验室信息化提供更务实的解决方案，尤其在以下场景中展现出显著优势：</p>
<p>01 流程和数据更贴近现场</p>
<p>通过低代码平台，业务人员与IT团队可协同构建样品台账、检测流程、结果汇总等模块，既保留实验室自身的管理逻辑，又能实现标准化管控。</p>
<p>02 需求变化可快速响应</p>
<p>当检测标准调整、样本类型增加时，业务人员可直接在平台调整字段和流程规则，不再依赖长周期开发，而是"随需而变"。</p>
<p>03 打通上下游，实现数据闭环</p>
<p>低代码天然具备接口能力，可无缝连接ERP、MES、PLM、QMS等系统，统一从实验室到生产、质检、采购的数据链路，提升协同效率。</p>
<p>04 投入产出比更优</p>
<p>企业可以从关键模块起步，优先部署样品管理、检测流程、报告输出等模块，再逐步扩展功能。这种分阶段投入模式大幅降低初期成本，形成良性循环。</p>
<h2 data-id="heading-3">哪些行业适合用低代码建设LIMS？</h2>
<p>结合实践观察，以下几类行业与场景，低代码适配性尤为突出：</p>
<ul>
<li>
<p>新能源与制造：实验室类型多，检测项目繁杂，必须与MES、PLM深度联动，低代码可支撑全流程数据贯通。</p>
</li>
<li>
<p>制药与生物医药：低代码可作为传统LIMS的补充，支撑稳定性试验、OOS（超标结果）流程等环节的数字化，满足合规需求。</p>
</li>
<li>
<p>科研与高校：实验项目迭代快、方法论创新频繁，低代码能1-2个月上线，让系统快速迭代，匹配科研节奏。</p>
</li>
<li>
<p>第三方检测机构：客户定制需求高频变化，检测模板更新频繁，低代码支持快速复用与个性化配置，显著提升服务响应效率。</p>
</li>
</ul>
<h2 data-id="heading-4">为什么说LIMS是低代码的“典型验证场景”</h2>
<p>实验室管理系统具备三重典型特征，使其成为验证低代码平台能力的理想场景：</p>
<ul>
<li>逻辑复杂但边界清晰：从样品接收到报告生成的流程链虽长，但各环节规则明确，低代码的流程引擎可精准映射业务逻辑。</li>
<li>数据重要但非财务级别敏感：数据直接关联产品品质，但非财务级敏感，允许通过低代码快速试错迭代。</li>
<li>投入可控，但见效明显：低代码部署降低初期成本，而由此带来的效率提升可量化呈现。</li>
</ul>
<p>如果低代码平台能在LIMS这样兼具复杂性、规范性的场景里跑顺，便证明其具备支撑企业研发、质检、生产等领域的数字化能力。</p>
<h2 data-id="heading-5">结语</h2>
<p>LIMS建设，不只是一个信息化项目，它关系到产品质量、法规合规，以及企业研发创新的效率。</p>
<p>低代码平台的价值（如得帆低代码aPaaS平台），并不是要“重新发明一个LIMS”，而是帮助企业用更灵活、更可演进的方式，构建属于企业自己的实验室管理体系。</p>
<p>对CIO来说，实验室管理数字化，正是检验低代码平台是否真正“可用、可扩展、可治理”的关键场景之一。</p>
<p>未来，随着研发与制造一体化的趋势加速，低代码 + LIMS的组合，或许会成为更多企业探索数字化转型的必经之路。</p>
<p>大家还对哪些内容感兴趣，或者是希望一起探讨相关的方法，欢迎留言和私信联系。希望得帆低代码和我们的实践心得，能帮到越来越多的朋友、客户。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[windows 系统安装 python 的最好方式也许就是不安装]]></title>    <link>https://juejin.cn/post/7578348333250904070</link>    <guid>https://juejin.cn/post/7578348333250904070</guid>    <pubDate>2025-12-01T06:49:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578348333250904070" data-draft-id="7578348333250871302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="windows 系统安装 python 的最好方式也许就是不安装"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-01T06:49:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自然吸气发动机"/> <meta itemprop="url" content="https://juejin.cn/user/3892706247712647"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            windows 系统安装 python 的最好方式也许就是不安装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3892706247712647/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自然吸气发动机
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:49:19.000Z" title="Mon Dec 01 2025 06:49:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近更换了一台windows电脑，拿到电脑之后第一步自然就是要搞开发环境，本来打算体验一下 ServBay（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Fzh-CN%25EF%25BC%2589" target="_blank" title="https://www.servbay.com/zh-CN%EF%BC%89" ref="nofollow noopener noreferrer">www.servbay.com/zh-CN）</a> 这个产品，但是我用到的功能比较简单，直接上这个东西感觉有点太重量级了。于是到官网去下载python准备安装，结果还真遇到了不少问题，考虑到网上介绍python安装的教程都比较老了，这里直接把过程中遇到的问题记录一下，做下分享。</p>
<h2 data-id="heading-0">一、 核心问题</h2>
<p>目前在windows机器上面安装python，去python官网下载下来的安装文件不是具体的某一个版本的python，而是一个叫做“python-manager-25.0.msix”东西
这个东西被称作为“python install manager” 并且后面这种方式安装python将成为windows系统安装python的主流方式，官网原文如下：</p>
<blockquote>
<p>The Python install manager for Windows is our tool for installing and managing runtimes. The traditional executable installer will stop being released with Python 3.16
As well as the files below, the Python install manager can be installed using the Microsoft Store app. For most users, this is the recommended approach.</p>
</blockquote>
<p>从上面这段描述来看 通过python install manager将成为日后的主流方案，但是当你通过这种方式来安装完python之后，你大概率会遇到两个问题：</p>
<ul>
<li>
<p>pip 命令无法使用：虽然 python -V 正常，但输入 pip 报错。
原因：Python 安装目录下的 Scripts 文件夹没有添加到系统环境变量 Path 中。</p>
</li>
<li>
<p>多版本切换困难
当你使用python -V 命令检查系统当前在用的python版本时默认会是当前最新的版本，怎么才能动态切换系统的python版本，变成一个需要亟待解决的问题。</p>
</li>
<li>
<p>py命令与python命令
当你在命令行中执行 python -V 和 py -V 时你会发现两个命令竟然输出的东西一模一样，那么这个py命令和python命令的关系又是怎样的呢？</p>
</li>
</ul>
<p>本文将主要介绍这些问题的解决方案，并对关键问题进行说明。</p>
<h2 data-id="heading-1">二、 基础概念解析</h2>
<h3 data-id="heading-2">1. python vs py 命令</h3>
<ul>
<li>python (工人)：直接调用 python.exe。它依赖环境变量 PATH，谁排在前面就启动谁，不灵活，容易版本冲突。</li>
<li>py (工头)：Windows 独有的 Python 启动器。它不依赖 PATH，而是扫描注册表。</li>
<li>py：自动启动最新版。</li>
<li>py -3.8：强制启动 3.8 版本。
结论：在 Windows 命令行里，可以用 py 全面替代 python。但是也仅限是windows环境</li>
</ul>
<p>下面几个py命令需要做重点关注</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">列举当前安装了哪些版本的python，标记 * 符号的是当前正在使用的版本</span>
py --list
<span class="hljs-meta prompt_">
# </span><span class="bash">使用3.12版本的python运行指定脚本</span>
py -V:3.13 xxx.py
<span class="hljs-meta prompt_">
# </span><span class="bash">上面的这个命令可以简写为</span>
py -3.13 xxx.py
</code></pre>
<p>可以发现py命令是严格区分版本的 ，并且截止目前py 还没有那种可以动态切换当前正在使用的python版本的命令，官方的想法应该是想让我们时刻都知道命令和版本之间的对应关系。</p>
<p>此外 当你使用 python install manager 安装python时 默认会把python安装到<code>C:\Users\你的用户名\AppData\Local\Python</code>下面，还会把下图中的 bin 文件夹自动添加到系统环境变量（当前用户的Path环境变量下面）中：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/178cbd2f38884f4db72b887b25ef1b64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq54S25ZC45rCU5Y-R5Yqo5py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176558&amp;x-signature=z7U2edKEq%2F5Egj9Vt%2BhVTSsMfq0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">2. 怎么运行pip来安装依赖呢？</h3>
<p>假定我现在需要使用 pip 来安装 uv ，现在则需要使用下面的命令：</p>
<pre><code class="hljs language-shell" lang="shell"> py -m pip install uv
</code></pre>
<p>这比我们之前直接安装指定版本的python的时候需要额外增加一个前缀 <code>py -m </code> 这个 <code>-m</code> 参数的含义是告诉 Python 不要运行文件，而是去已安装的库里找叫 pip 的模块并运行它。</p>
<p>通过上面的命令安装uv之后你会发现两个问题：</p>
<ul>
<li>直接在终端使用uv 直接报错，提示找不到可运行文件</li>
</ul>
<p>其实这个很好理解，使用上面的文件会直接把uv放到当前正在运行的python安装目录的Script目录下,这个目录还不在系统Path环境变量下，自然提示找不到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00a1da8ed9a8415aa1a1b742d77d76ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Ieq54S25ZC45rCU5Y-R5Yqo5py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176558&amp;x-signature=8AFluvmj%2FdRqu8R%2FPkyhfkQs0f4%3D" alt="image.png" loading="lazy"/></p>
<p>这里额外说明下如果你使用下面的命令安装，则会把uv安装到指定版本的python安装目录的Script目录下</p>
<pre><code class="hljs language-shell" lang="shell"> py -3.13 -m  pip install uv
</code></pre>
<p>回到开始的问题 这时候运行uv提示找不到路径怎么办？</p>
<p>第一种方式自然是把这个路径给添加到环境变量里面，这种方案可行，但是并不推荐，下面介绍最适合windows系统安装uv命令的方案</p>
<h3 data-id="heading-4">3.安装uv的最佳方案</h3>
<p>安装uv的最佳方案是通过下面的命令安装，而<strong>不要去使用pip来安装</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows</span>
powershell -ExecutionPolicy ByPass -c <span class="hljs-string">"irm https://astral.sh/uv/install.ps1 | iex"</span>
</code></pre>
<p>通过这种方式安装uv之后，会自动添加环境变量，一行命令即可畅快使用uv来做依赖管理，以及虚拟环境创建。</p>
<h3 data-id="heading-5">总结：其实你可能不需要在windows电脑手动安装python</h3>
<p>其实对于windows电脑，你可能只需要安装uv即可。只安装uv会有下面的几个好处</p>
<ul>
<li>系统零污染：
你的 控制面板 -&gt; 卸载程序 列表里干干净净，没有那一堆 "Python 3.x", "Python Launcher" 之类的东西。</li>
<li>版本自由：
你想用 Python 3.8？<code>uv run --python 3.8</code>。
想用 Python 3.13？<code>uv run --python 3.13</code>。
uv 会把这些版本都管理得井井有条，用完甚至可以一键清理。</li>
</ul>
<p>唯一的改变就是你在powershell上面无法使用python命令 需要学会把 <code>python main.py</code> 改为 <code>uv run main.py</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dart 速通攻略（面向 Android 工程师）]]></title>    <link>https://juejin.cn/post/7578511778888597542</link>    <guid>https://juejin.cn/post/7578511778888597542</guid>    <pubDate>2025-12-01T06:50:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578511778888597542" data-draft-id="7578416583212875826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dart 速通攻略（面向 Android 工程师）"/> <meta itemprop="keywords" content="Android,Flutter,Dart"/> <meta itemprop="datePublished" content="2025-12-01T06:50:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="renxhui"/> <meta itemprop="url" content="https://juejin.cn/user/1292681403181944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dart 速通攻略（面向 Android 工程师）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1292681403181944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    renxhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:50:56.000Z" title="Mon Dec 01 2025 06:50:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Dart 速通攻略（面向 Android 工程师）</h2>
<blockquote>
<p>背景：你已熟悉 Java/Kotlin/Android。本文用“对照 + 最小可用示例”的方式，快速上手 Dart（以 Dart 3 为基线）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">0. Dart 与 Kotlin/Java 思维对照</h3>
<ul>
<li><strong>空安全</strong>：与 Kotlin 类似，<code>T</code> 非空、<code>T?</code> 可空；需要 <code>!</code> 断言或 <code>?.</code> 安全访问。</li>
<li><strong>命名参数</strong>：函数/构造器的“命名可选参数”很常用，常配合 <code>required</code>。</li>
<li><strong>顶层函数/变量</strong>：无须写在类里（类似 Kotlin 顶层声明）。</li>
<li><strong>继承/实现</strong>：<code>extends</code> 继承，<code>implements</code> 实现接口（任意类都可当作接口），<code>mixin</code> 复用实现。</li>
<li><strong>并发模型</strong>：主线程 async/await 基于 <code>Future</code>；多线程用 <code>Isolate</code>（与 Android Handler/Thread 不同）。</li>
<li><strong>集合语法</strong>：<code>[...]</code>、<code>{...}</code>、集合展开 <code>...</code>、条件/循环内嵌（collection if/for）。</li>
<li><strong>Dart 3 新特性</strong>：<code>sealed</code>、<code>pattern matching</code>、<code>records</code>、<code>class modifiers</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-2">1. 基本语法速览</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 顶层函数与变量</span>
<span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> appName = <span class="hljs-string">'Demo'</span>;

<span class="hljs-built_in">int</span> add(<span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b) =&gt; a + b;

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'Hello <span class="hljs-subst">$appName</span>: <span class="hljs-subst">${add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)}</span>'</span>);
}
</code></pre>
<ul>
<li><code>var</code> 自动推断，<code>final</code> 只赋值一次，<code>const</code> 编译期常量。</li>
<li>字符串插值：<code>'Hello $name, len=${name.length}'</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. 空安全与类型系统</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">String?</span> maybe;                    <span class="hljs-comment">// 可空</span>
<span class="hljs-built_in">int?</span> parseInt(<span class="hljs-built_in">String</span> s) =&gt; <span class="hljs-built_in">int</span>.tryParse(s);

<span class="hljs-comment">// 安全访问/默认值</span>
<span class="hljs-keyword">final</span> len = maybe?.length ?? <span class="hljs-number">0</span>;

<span class="hljs-comment">// 非空断言（不建议滥用）</span>
<span class="hljs-keyword">final</span> must = maybe!;
</code></pre>
<ul>
<li>泛型默认非空：<code>List&lt;String&gt;</code>；可空为 <code>List&lt;String&gt;?</code> 或元素可空 <code>List&lt;String?&gt;</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-4">3. 函数与参数（命名参数是关键）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">int</span> sum(<span class="hljs-built_in">int</span> a, {<span class="hljs-keyword">required</span> <span class="hljs-built_in">int</span> b, <span class="hljs-built_in">int</span> c = <span class="hljs-number">0</span>}) =&gt; a + b + c;

<span class="hljs-comment">// 调用：命名参数必须写名</span>
<span class="hljs-keyword">final</span> s = sum(<span class="hljs-number">1</span>, b: <span class="hljs-number">2</span>, c: <span class="hljs-number">3</span>);

<span class="hljs-comment">// 高阶函数 &amp; tear-off</span>
<span class="hljs-keyword">final</span> list = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">final</span> doubled = list.map((e) =&gt; e * <span class="hljs-number">2</span>).toList();
<span class="hljs-keyword">final</span> prints = list.forEach(<span class="hljs-built_in">print</span>); <span class="hljs-comment">// 函数 tear-off</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">4. 类 / 构造 / 工厂 / Getter / 扩展</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-built_in">String</span> name;

  <span class="hljs-comment">// 命名参数构造</span>
  User({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name});

  <span class="hljs-comment">// 命名构造函数</span>
  User.empty() : id = <span class="hljs-string">'0'</span>, name = <span class="hljs-string">''</span>;

  <span class="hljs-comment">// 工厂：可返回缓存或子类</span>
  <span class="hljs-keyword">factory</span> User.fromMap(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; m) =&gt;
      User(id: m[<span class="hljs-string">'id'</span>], name: m[<span class="hljs-string">'name'</span>] ?? <span class="hljs-string">''</span>);

  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> display =&gt; <span class="hljs-string">'<span class="hljs-subst">$id</span>@<span class="hljs-subst">$name</span>'</span>;
  <span class="hljs-keyword">set</span> display(<span class="hljs-built_in">String</span> value) =&gt; name = value.split(<span class="hljs-string">'@'</span>).last;
}

<span class="hljs-comment">// 扩展方法</span>
<span class="hljs-keyword">extension</span> StringX <span class="hljs-keyword">on</span> <span class="hljs-built_in">String</span> {
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isUUID =&gt; <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">r'^[0-9a-fA-F-]{36}$'</span>).hasMatch(<span class="hljs-keyword">this</span>);
}
</code></pre>
<ul>
<li><code>late</code> 延迟初始化，<code>abstract</code> 抽象类，<code>sealed</code> 密封层级，<code>mixin</code> 复用实现。</li>
</ul>
<hr/>
<h3 data-id="heading-6">5. 集合与语法糖（collection if/for、展开）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> items = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">final</span> plus = [<span class="hljs-number">0</span>, ...items, <span class="hljs-keyword">if</span> (items.isNotEmpty) <span class="hljs-number">4</span>, <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> e <span class="hljs-keyword">in</span> items) e * <span class="hljs-number">2</span>];
<span class="hljs-keyword">final</span> map = {<span class="hljs-string">'a'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>: <span class="hljs-number">2</span>, <span class="hljs-keyword">if</span> (plus.length &gt; <span class="hljs-number">3</span>) <span class="hljs-string">'c'</span>: <span class="hljs-number">3</span>};
</code></pre>
<hr/>
<h3 data-id="heading-7">6. 模式匹配（patterns）与记录（records）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// records（匿名元组）</span>
(<span class="hljs-built_in">int</span> x, <span class="hljs-built_in">String</span> y) pair() =&gt; (<span class="hljs-number">1</span>, <span class="hljs-string">'a'</span>);

<span class="hljs-keyword">final</span> (a, b) = pair(); <span class="hljs-comment">// 解构</span>

<span class="hljs-comment">// 模式匹配</span>
<span class="hljs-built_in">String</span> describe(<span class="hljs-built_in">Object</span> o) =&gt; <span class="hljs-keyword">switch</span> (o) {
  <span class="hljs-built_in">int</span> n when n &gt; <span class="hljs-number">0</span> =&gt; <span class="hljs-string">'positive <span class="hljs-subst">$n</span>'</span>,
  <span class="hljs-built_in">int</span> n =&gt; <span class="hljs-string">'int <span class="hljs-subst">$n</span>'</span>,
  <span class="hljs-built_in">String</span> s =&gt; <span class="hljs-string">'str <span class="hljs-subst">$s</span>'</span>,
  _ =&gt; <span class="hljs-string">'other'</span>,
};
</code></pre>
<hr/>
<h3 data-id="heading-8">7. 枚举、密封类（替代 Kotlin sealed class）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">enum</span> Flavor { vanilla, chocolate }

sealed <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span> </span>{}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Success</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Result</span> </span>{ <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> data; Success(<span class="hljs-keyword">this</span>.data); }
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Failure</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Result</span> </span>{ <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> msg; Failure(<span class="hljs-keyword">this</span>.msg); }

<span class="hljs-built_in">String</span> handle(Result r) =&gt; <span class="hljs-keyword">switch</span> (r) {
  Success(data: <span class="hljs-keyword">final</span> d) =&gt; <span class="hljs-string">'ok <span class="hljs-subst">$d</span>'</span>,
  Failure(msg: <span class="hljs-keyword">final</span> m) =&gt; <span class="hljs-string">'err <span class="hljs-subst">$m</span>'</span>,
};
</code></pre>
<hr/>
<h3 data-id="heading-9">8. 异步：Future / async-await / Stream</h3>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">int</span>&gt; fetch() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-keyword">const</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">100</span>));
  <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
}

<span class="hljs-comment">// try/catch 同步写法</span>
<span class="hljs-keyword">void</span> demo() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">final</span> v = <span class="hljs-keyword">await</span> fetch();
    <span class="hljs-built_in">print</span>(v);
  } <span class="hljs-keyword">catch</span> (e, s) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'error <span class="hljs-subst">$e</span>\n<span class="hljs-subst">$s</span>'</span>);
  }
}

<span class="hljs-comment">// Stream</span>
Stream&lt;<span class="hljs-built_in">int</span>&gt; counter() <span class="hljs-keyword">async</span>* {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-keyword">yield</span> i;
  }
}
</code></pre>
<ul>
<li>并行：<code>Future.wait([...])</code>。</li>
<li>多线程：使用 <code>Isolate</code> 或 Flutter 的 <code>compute</code>（与 Android 线程模型不同）。</li>
</ul>
<hr/>
<h3 data-id="heading-10">9. 网络 &amp; JSON（dio + json_serializable）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// pubspec.yaml 添加依赖：dio、json_annotation、build_runner、json_serializable</span>
<span class="hljs-comment">// 模型</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:json_annotation/json_annotation.dart'</span>;
<span class="hljs-keyword">part</span> <span class="hljs-string">'user.g.dart'</span>;

<span class="hljs-meta">@JsonSerializable</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  User({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name});
  <span class="hljs-keyword">factory</span> User.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt; _$UserFromJson(json);
  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() =&gt; _$UserToJson(<span class="hljs-keyword">this</span>);
}
</code></pre>
<ul>
<li>生成命令：<code>flutter pub run build_runner build --delete-conflicting-outputs</code>。</li>
<li>Dio 使用与 Android 拦截器类似，<code>LogInterceptor</code> 可直接打印请求/响应。</li>
</ul>
<hr/>
<h3 data-id="heading-11">10. 包管理与工具链</h3>
<ul>
<li>包管理：<code>pubspec.yaml</code>，仓库为 pub.dev。</li>
<li>常用命令：
<ul>
<li><code>dart format .</code> 代码格式化</li>
<li><code>dart analyze</code> 静态检查</li>
<li><code>dart test</code> 单元测试（Flutter 用 <code>flutter test</code>）</li>
<li><code>flutter pub get / run</code> 拉包/执行生成器</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-12">11. 测试（简述）</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:test/test.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  test(<span class="hljs-string">'sum'</span>, () {
    expect(<span class="hljs-number">1</span> + <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
  });
}
</code></pre>
<p>Flutter 小部件测试使用 <code>flutter_test</code> 与 <code>WidgetTester</code>。</p>
<hr/>
<h3 data-id="heading-13">12. 常见对照（Kotlin → Dart）</h3>
<ul>
<li><code>val</code>/<code>var</code> → <code>final</code>/<code>var</code></li>
<li><code>data class</code> → 手写 <code>== hashCode toString</code> 或用 <code>freezed</code>（代码生成）</li>
<li><code>sealed class</code> → <code>sealed class</code>（Dart 3 原生支持）</li>
<li><code>when</code> → <code>switch</code> + patterns</li>
<li><code>?. ?: !!</code> → <code>?. ?? !</code></li>
<li>扩展函数 → <code>extension</code>；伴生对象 → 顶层函数/静态方法</li>
<li>协程 → <code>Future/async</code>（单线程事件循环），多线程请用 <code>Isolate</code></li>
</ul>
<hr/>
<h3 data-id="heading-14">13. 性能与实践建议</h3>
<ul>
<li>避免滥用 <code>!</code> 非空断言；优先 <code>?.</code> 和 <code>??</code>。</li>
<li>大 JSON 建议代码生成（<code>json_serializable</code> / <code>freezed</code>）。</li>
<li>频繁小对象场景可用 <code>const</code> 构造与不可变数据结构（Flutter 重建友好）。</li>
<li>复杂计算搬到 <code>Isolate/compute</code>，避免阻塞 UI 事件循环。</li>
</ul>
<hr/>
<h3 data-id="heading-15">14. 进阶：模式匹配与解构的实战片段</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 解构 record</span>
<span class="hljs-keyword">final</span> (x, y, z) = (<span class="hljs-number">1</span>, <span class="hljs-string">'k'</span>, <span class="hljs-keyword">true</span>);

<span class="hljs-comment">// 对 Map/类做匹配</span>
<span class="hljs-built_in">String</span> stringify(<span class="hljs-built_in">Object</span> obj) =&gt; <span class="hljs-keyword">switch</span> (obj) {
  {<span class="hljs-string">'id'</span>: <span class="hljs-built_in">int</span> id, <span class="hljs-string">'name'</span>: <span class="hljs-built_in">String</span> n} =&gt; <span class="hljs-string">'user#<span class="hljs-subst">$id</span> <span class="hljs-subst">$n</span>'</span>,
  User(id: <span class="hljs-keyword">final</span> id, name: <span class="hljs-keyword">final</span> n) =&gt; <span class="hljs-string">'User(<span class="hljs-subst">$id</span>, <span class="hljs-subst">$n</span>)'</span>,
  _ =&gt; <span class="hljs-string">'unknown'</span>
};
</code></pre>
<hr/>
<h3 data-id="heading-16">15. 学习路径（建议 7 天）</h3>
<ul>
<li>Day 1：语法速览、空安全、函数与参数、集合语法</li>
<li>Day 2：类/构造/工厂/扩展、枚举/密封、运算符与 getter/setter</li>
<li>Day 3：异步（Future/Stream/错误处理/并行）、Isolate/compute</li>
<li>Day 4：Dio + JSON（生成器）、本地持久化（shared_preferences）</li>
<li>Day 5：Dart 3 新特性（records、patterns、sealed）、lint 规则</li>
<li>Day 6：测试（unit/widget）、性能与最佳实践</li>
<li>Day 7：把现有 Kotlin/Java 业务迁移一小段到 Dart 演练</li>
</ul>
<hr/>
<h3 data-id="heading-17">参考</h3>
<ul>
<li>Dart 语言导引：<code>https://dart.dev/language</code></li>
<li>异步编程（Future/Stream）：<code>https://dart.dev/codelabs/async-await</code></li>
<li>包与发布：<code>https://dart.dev/tools/pub</code></li>
<li>Flutter/Dart 最佳实践（社区文章与官方文档）</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这一年，收获很多，办了婚礼，还出了一门前端AI课]]></title>    <link>https://juejin.cn/post/7578054192808787994</link>    <guid>https://juejin.cn/post/7578054192808787994</guid>    <pubDate>2025-12-01T00:24:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578054192808787994" data-draft-id="7578054192808755226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这一年，收获很多，办了婚礼，还出了一门前端AI课"/> <meta itemprop="keywords" content="前端,程序员,AI编程"/> <meta itemprop="datePublished" content="2025-12-01T00:24:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LV技术派"/> <meta itemprop="url" content="https://juejin.cn/user/2013961035453927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这一年，收获很多，办了婚礼，还出了一门前端AI课
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961035453927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LV技术派
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T00:24:18.000Z" title="Mon Dec 01 2025 00:24:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>大家好，我是 lv，好久不见～</p>
<p>有很长一段时间没有更新文章了，这差不多一年的时间，做了 2 件大事，值得记录和分享一下：</p>
<ul>
<li>
<p>自己策划、布置、主持了自己的婚礼</p>
</li>
<li>
<p>和卡颂老师合作出了一门前端 AI 的课程 （我会分享一下从 0 ～ 1 的过程）</p>
</li>
</ul>
<p>先来分享一波婚礼，关注我的粉们也沾沾喜气～ 婚礼主打的就是一个技术范，自己造轮子，全程 DIY。</p>
<h2 data-id="heading-0">聊聊婚礼</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8922f8e205d49a9848a4e0e49af967b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=7hr3FGyx9Wv%2FHcg9%2BpdbX7LvS%2F4%3D" alt="" loading="lazy"/></p>
<p>婚礼很简单，我们找了个民宿，婚礼全程都在这里搞定，没有接亲、没有婚车、没有婚庆，一切从简。</p>
<p>亲友们前一天就邀请过来，一起住在民宿、一起吃个晚饭，唠唠嗑，睡个好觉，不慌不忙，第二天见证仪式。</p>
<p>虽然简单，但特别，在我老家算是比较新颖的了，最终要的是，仪式感拉满～</p>
<p>从婚礼的前期筹备、自己策划流程，到婚礼的场景布置、主持仪式、亲友欢聚，每个环节，都很喜欢。</p>
<p>作为技术人的婚礼，主打的就是一个 DIY， 备婚的朋友可以参考下。</p>
<h2 data-id="heading-1">婚礼值得记录的事情</h2>
<p>在某一天的和对象在户外草坪露营的时候，突然感觉有点无聊，想着共同一起做点事情，于是就很“草率”决定了要在 6 个月之后举办婚礼。</p>
<p>目的很简单，一场充满回忆的仪式，简单搞就行。</p>
<p>现在回想起来，从下了决定到婚礼结束，有太多值得记录的事情。</p>
<h3 data-id="heading-2">场地</h3>
<p>婚礼是在老家的一个民宿举办的，当时看中的是民宿整体的氛围和环境，很适合我们自己来布置。</p>
<p>不需要特别华丽的装饰，就可以营造出很好的氛围。</p>
<p>这是当天婚礼主仪式区的户外草坪布置 👇</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43c7f2832eb84d1c8f0940e254acb577~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=Q8FI4oqDmsjjEMlNqcjvYud077o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">四大金刚</h3>
<p>四大金刚（化妆、摄像、摄影、主持）是婚礼离不开的话题。</p>
<p>我们没有找统一的婚庆公司来安排四大金刚。</p>
<p>化妆师、摄像、摄影、这三个角色，我们都是在小红薯上单独找的。</p>
<p>化妆师需要提前沟通好妆容和造型，新娘的晨袍、婚纱、敬酒服等等等一堆衣服定好了之后，记得需要试妆，一般都会有送试妆服务。</p>
<p>至于新郎，婚礼当天，给抓了下头发，抹了下脸，就差不多了，一套西装穿满全程。</p>
<p>我们请的摄像摄影师是一对夫妻，看的出他们对于我们找的这个场地，还有布置，挺满意的，当天起了个大早，就开始各种拍摄，还“夹带私货”，给自己也拍了一些照片。</p>
<p>至于主持人，是我俩自己主持的，待会好好分享下～</p>
<h3 data-id="heading-4">布置</h3>
<p>现在还记得，摄像、摄影师前一晚看到我们的布置，就说这个场景会很出片。</p>
<p>其实婚前在跟摄像摄影沟通需求聊到：“我们没有请婚庆，是自己来布置婚礼场地”。</p>
<p>摄影师说：“不请婚庆的话，自己要有很高的审美才行，不然婚礼现场的布置可能会比较难出片”。</p>
<p>其实我们当时心里也在犯嘀咕，中间也找了一些婚庆公司了解布置的事情，但是都不是很满意，所耗费的精力和成本不如自己来布置，毕竟一开始我们想的主要是有一场仪式，简单搞就行。</p>
<p>现在回想起来，其实也并不简单。</p>
<p>印象最深刻的就是这两样 👇</p>
<p><strong>1000 片贝母</strong></p>
<p>两米高的贝母片圆柱放在长条桌的后方，作为背景。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a0f7713e0004721ae919c680c6f87eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=St62gTAPnOPjBHeGVRLl1o0y3qA%3D" alt="" loading="lazy"/></p>
<p>当天天气正好，贝母片闪闪的，加上有些微微风，碰在一起发出叮铃铃的声音。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b927082a22a4a92b8a1d244fe829f65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=6E%2Fyp%2BSpVfyDQuo%2BW02LUuS%2FevM%3D" alt="" loading="lazy"/></p>
<p>忘记了多少次下班后，吃完饭，我和对象躺在沙发上，边看着剧、边一个个地把每一片贝母片都串起来。</p>
<p>后面找到一些技巧了，速度起来了，我俩的技巧不一样，于是就在比赛，谁串的快。</p>
<p>每次串完之后，我都会把那一条被母片串抬起手举起来，垂下来的末端差不多到我膝盖，一条就差不多了。</p>
<p>婚礼的前一天，我们把一箱箱的被母片串搬下来，亲友们是有点感慨的，年轻人，真会造轮子～</p>
<p><strong>2000 朵花</strong></p>
<p>在主仪式区，有一个花瀑布，从仪式区上方的民宿二楼阳台垂下来到主仪式区草坪。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140d9d14b6564a69a1dd7ca7ebc833b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=iF6n%2F%2BNRVXeQ8wc4ayZkzdAGt%2BM%3D" alt="" loading="lazy"/></p>
<p>花瀑布上的每一朵花，都是我们手工一朵一朵粘上去的。</p>
<p>跟串贝母片不一样，粘花更难一点，不能边看剧边粘花，有好几次，我们都被粘花的胶棒抢烫到手。</p>
<p>婚礼前几天，我们在老家粘花瀑布，邻居小朋友们都喜欢过来看我两干活，顺便白嫖一些花。</p>
<h3 data-id="heading-5">自己主持</h3>
<p>策划主仪式流程，自己主持这一块，应该是花精力最多的了，也是最难忘的回忆。</p>
<p>一开始，本想请专业司仪，反过来一想，还得沟通流程，还得沟通音乐，还得沟通各种细节，不如自己造轮子。</p>
<p>后来呢，又想着请朋友来帮忙主持，转念一想，朋友也不是专业的主持人，而且彩排时间也有限。</p>
<p>干脆自己上，现在想想，自己主持唯一的缺点就是：<strong>累点</strong>，但是跟好处比起来，这点累，不算啥。</p>
<p>我们可以完全按照自己喜欢的流程来、自己掌控节奏、掌握音乐、掌握时间，当天我们都沉浸在对仪式氛围的感受中。</p>
<p>其实一开始决定自己主持的时候，其实心里还是有点犯嘀咕的，毕竟是第一次当司仪，还是主持自己的婚礼。</p>
<p>但真正到了婚礼当天，我们发现，紧张啥的都不存在，我们所有的注意力都放在感受当下、感受自己的情绪、感受彼此的情感、感受亲友的祝福上。</p>
<p>当然，彩排还是很有必要的，准备好主持稿之后，彩排了蛮多次，到婚礼当天，就全程脱稿了。</p>
<p>在整个仪式的过程中，有两样东西帮了大忙。</p>
<p><strong>带话筒的音响</strong></p>
<p>音乐蛮重要的，现场的氛围，音乐的功劳占了一半。</p>
<p>买了个自带带双话筒的音响，新郎新娘可以同时主持扩音、同时连手机蓝牙播放音乐。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3c8499a21744dcb15a7853e5acb76b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=gxLTZeQKS%2FGFG2ZLJjEJormrHB8%3D" alt="" loading="lazy"/></p>
<p>音乐提前准备好，下载到手机本地，仪式开场前，手机连上音响，打开飞行模式，防止电话干扰。</p>
<p>从新郎开场音乐、到新娘入场音乐、共同主持音乐、表白环节音乐、问誓环节音乐、感恩环节音乐，全场大合照环节音乐，全靠这音响。</p>
<p>婚礼用完结束后，现在音响放在老家搞了个家庭 ktv，晚饭后，我家的音响一开，街坊邻居就过来了。</p>
<p>跟音响搭配干活的，还有一个司仪宝。</p>
<p><strong>司仪宝</strong></p>
<p>想着都自己主持了，干脆更加专业点，模仿人家专业司仪左手抓个司仪宝，右手抓个话筒，边主持边切换音乐。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc882ebef157443f911566509021d039~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=h5GkXnbytN7nDfeh4tC7tEuhKHQ%3D" alt="" loading="lazy"/></p>
<p>司仪宝用起来很方便，插上手机，就能远程控制手机来切换音乐。</p>
<p>现场看婚礼的朋友后来开玩笑说，”搞个婚礼策划，婚礼主持的副业“。</p>
<p>人生大事分享了，下面来聊下另外一件大事～</p>
<h2 data-id="heading-6">聊聊课程</h2>
<p>关于课程其实有太多可以聊的，课程的主题是：<strong>前端 AI 转型探索</strong>。</p>
<p>我从 23 年初开始探索 AI，那会的方向不是很明确，看过我前期文章的老粉应该都知道。</p>
<p>AI 社群、AI 绘画、组队开发 AI 产品等等，基本上火的 AI 方向，都尝试过。</p>
<p>在业余时间尝试各种 AI 方向的同时，在主业上也没拖后腿，其实这是一个相辅相成的过程。</p>
<p>3 年前那会，我在做前端架构相关的事情，其中有一部分的工作就是探索工程效能相关的。</p>
<p>由于业余时间关注的 AI 信息比较多，在 AI 和前端的结合方向上，也产出了一些内容，在公司内部也有一定的影响力。</p>
<p>也在公司内部当前端 AI 内训师，分享前端和 AI 结合相关的一些实践，比如<strong>如何基于公司私有组件库来生成代码</strong>，<strong>AI 友好的整洁组件架构</strong>等等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79788a424d5e456f9c9071c19cb09c31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=LwxHUcN52Dkq3%2Bq1IOSiM3%2B73Bs%3D" alt="" loading="lazy"/></p>
<p>蛮感谢公司提供这样的平台和氛围，能够成为最早期一批探索 AI 和前端结合的人。</p>
<p>当然，更感谢自己把握机会。</p>
<p>逐渐的，我开始全力聚焦在前端 AI 的探索上，在社区也输出一些相关的文章，也把文章体系化整理了一下，输出了第一本电子小册：<a href="https://link.juejin.cn?target=https%3A%2F%2Fai.iamlv.cn%2F" target="_blank" title="https://ai.iamlv.cn/" ref="nofollow noopener noreferrer"><strong>《AI 赋能前端研发从 0 ～ 1》</strong></a>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3aa29fe5d8aa4fbeaa457e82c8616780~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=Rxx%2FduIoRnpy%2BAxZlku%2B%2Fu8PPLk%3D" alt="" loading="lazy"/></p>
<p>也开始建立小册的交流群：「最懂 AI 的前端伙伴们～」，跟感兴趣的小伙伴们一起交流，互相学习，成长，抹平信息差。</p>
<p>慢慢的，发现小册的受众越来越多，有人开始付费向我咨询相关的问题。</p>
<p>与此同时，我和卡颂老师（@魔术师卡颂）一直保持着联系。</p>
<p>在某一天的某个时刻，我们决定一起合作出了一门课程：<strong>《前端 + AI 转型探索营》</strong></p>
<p>到现在，我还在迭代课程，因为 AI 领域的进化很快，尤其是在 AI Coding 方面，新的工具、新的能力、新的玩法层出不穷。</p>
<p>最近，基于市面上最新的 AI Coding 现状，加餐迭代了一个新的章节：适合<strong>很多公司</strong>的 AI Coding 落地范，基于 <strong>AI Coding 基建</strong> 搭建符合公司内部研发流程的工程化 Cli 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e66f91e82526473ba18086a5ec0edb24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=d2hH74%2FaEz8YJXI4dtp4Y7qhekw%3D" alt="" loading="lazy"/></p>
<p>当然，课程内容并不是只追热点的产物，首先我把自己在前端 AI 实践的经验沉淀成了核心的理论：<strong>AI 赋能金字塔模型</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46445f4ff794454896276ca8167e1f8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=A%2FMPIhR8PwEvQiYnywzmHUNRVJI%3D" alt="" loading="lazy"/></p>
<p>其次基于核心理论 （<strong>AI 赋能金字塔模型</strong>），再结合已经在公司内很多项目实施的 <strong>AI 友好的前端研发工作流</strong>，迭代了这套课程。</p>
<p>随着 AI 的快速发展，我们的核心理论依旧适用，AI 友好的前端研发工作流也依旧适用，从实战一到实战三，都是基于这个理论，迭代了不同的 AI Coding 解决方案，学员可以参考课程中的实践思路，结合自己项目的实际情况，落地适合自己公司的 AI Coding 解决方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db2f1dd4de654921ae8fded185023b23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=grDFMomBipMOkTnw6CRFwg5w0Mc%3D" alt="" loading="lazy"/></p>
<p>现在回过头看，从我 23 年初开始探索 AI，探索 AI 时代下前端的转型之路，到现在输出课程，总结起来就是一个 <strong>PDCA 循环</strong>。</p>
<p>计划（Plan）、执行（Do）、检查（Check）、处理（Action）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/388f0ea3be4c4b6c982280e9a8ee57d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=jCH6ngCzG47oP8C%2FkPfN3jt%2F8R8%3D" alt="" loading="lazy"/></p>
<p>总结起来，形成具有里程碑价值的 PDCA 循环有以下 3 个特征：</p>
<p><strong>特征 1：环环相扣</strong></p>
<p>大的 PDCA 循环是由很多个小的 PDCA 循环组成的。</p>
<p>比如说针对我的大 PDCA 循环中的 Plan 阶段，并不是一蹴而就，本身也是很多个小的 PDCA 循环组成的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e4830794b0b4ffabf6008dbf2cfc4a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765176707&amp;x-signature=cVnz3DE9uJeYjiJOh8bQClaEgYo%3D" alt="" loading="lazy"/></p>
<p>从最开始探索 AI 的各个方向（AI 社群、AI 绘画、AI 产品开发等等），每个方向都是小的 PDCA 循环。</p>
<p>经过这一个个小的 PDCA 循环的探索，到后来才明确最适合自己，投入性价比最高的是将 AI 融入到本职工作中来，于是开始决定深度聚焦探索前端领域的 AI 转型之路。</p>
<p><strong>特征 2：价值积累</strong></p>
<p>你积累的每一个小的 PDCA 环都有价值，不要怕浪费时间，因为每经历过一次小的 PDCA 循环，都是在调整自己往正确方向前进的一步。</p>
<p>每一个小的 PDCA 环，都会在某天的某个场景派上用场，它可能就是你未来某个大里程碑式 PDCA 循环中的某一环节。</p>
<p><strong>特征 3：借力前行</strong></p>
<p>在实现大里程碑式 PDCA 循环的过程中，你也会遇到很多的贵人，比如拿我和卡颂老师合作出课程来说，卡老师给了我很多帮助和建议，像课程录制、运营推广等等，这些都属于<strong>借力前行</strong>。</p>
<p>当然，借力前行是建立在自身价值积累、合作共赢的基础之上的。</p>
<p>相当于：合作双方把各自已有的 PDCA 小循环拿出来，合并成了一个大里程碑式的 PDCA 循环。</p>
<p>以我和卡老师来说，我贡献的 PDCA 小循环是：<strong>一线的 前端 AI 实践探索经验</strong>，卡老师贡献的 PDCA 小循环是：<strong>课程录制、运营推广经验</strong>，我们两方的 PDCA 小循环合并成了一个大里程碑式的 PDCA 循环：<strong>《前端 + AI 转型探索营》课程</strong>。</p>
<p>再举个例子，如果你也想探索前端 AI 转型之路，如何借力加速形成自己的大里程碑式 PDCA 循环呢？</p>
<ul>
<li>
<p>借力别人已成型的 PDCA 小循环：比如加入到 《前端 + AI 转型探索营》课程，借力课程中已有的前端 AI 实践探索经验。</p>
</li>
<li>
<p>贡献自己的 PDCA 小循环：投入精力学习课程、实践课程内容，遇到问题时，链接老师，获得符合你现状帮助和建议。</p>
</li>
</ul>
<p>基于借力到的 PDCA 小循环（课程），以及自己贡献的 PDCA 小循环（时间投入、课程学习实践），最终形成属于你自己大的里程碑式 PDCA 循环（<strong>属于你的前端 AI 知识体系、职场晋升等成果</strong>）。</p>
<hr/>
<p>本次分享就先到这～</p>
<p>近期积累了很多想分享的内容，比如：</p>
<ul>
<li>
<p>适合很多公司/团队的 AI Coding 落地范式</p>
</li>
<li>
<p>AI 时代下，适合部分前端（程序员）的出路</p>
</li>
<li>
<p>怎么设计 AI 友好的研发工作流</p>
</li>
<li>
<p>资深程序员是怎么使用 AI Coding 的？</p>
</li>
</ul>
<p>...</p>
<p>欢迎在评论区留言，留下你想了解的主题。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘 React Native 布局：Yoga 引擎与那些“反直觉”的 Flexbox]]></title>    <link>https://juejin.cn/post/7578405594119307298</link>    <guid>https://juejin.cn/post/7578405594119307298</guid>    <pubDate>2025-12-01T06:56:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578405594119307298" data-draft-id="7578384621458620468" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘 React Native 布局：Yoga 引擎与那些“反直觉”的 Flexbox"/> <meta itemprop="keywords" content="React Native"/> <meta itemprop="datePublished" content="2025-12-01T06:56:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘 React Native 布局：Yoga 引擎与那些“反直觉”的 Flexbox
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T06:56:29.000Z" title="Mon Dec 01 2025 06:56:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你是从 Web 前端转战 React Native (RN) 的开发者，第一次写布局时通常会产生三个灵魂拷问：</p>
<ol>
<li><em>“为什么我没写 <code>display: flex</code>，布局就已经生效了？”</em></li>
<li><em>“为什么元素默认是垂直排列的？我的 <code>row</code> 去哪了？”</em></li>
<li><em>“官网文档里提到的 Yoga 到底是个什么东西？”</em></li>
</ol>
<p>这篇文章将带你深入 React Native 的布局底层，揭开 <strong>Yoga 引擎</strong> 的面纱，并解析 RN 与 Web CSS 在布局上的核心差异。</p>
<hr/>
<h2 data-id="heading-0">一、幕后大脑：什么是 Yoga？</h2>
<p>在 React Native 的官方文档中，你很难找到关于 <strong>Yoga</strong> 的详细篇幅，但它却是整个 RN 能够跨平台渲染 UI 的基石。</p>
<p><strong>Yoga 是一个由 Facebook (Meta) 开发的跨平台布局引擎，使用 C++ 编写。</strong></p>
<h3 data-id="heading-1">1. 为什么要造一个 Yoga？</h3>
<p>React Native 的愿景是“Learn Once, Write Anywhere”，但现实很骨感：</p>
<ul>
<li><strong>iOS</strong> 原生使用的是 AutoLayout 或 Frame 计算。</li>
<li><strong>Android</strong> 原生使用的是 Measure/Layout 过程 (LinearLayout, RelativeLayout 等)。</li>
<li><strong>Web</strong> 使用的是 CSS Box Model。</li>
</ul>
<p>如果 RN 想要跨平台，开发者不可能去写三套布局逻辑。于是 Facebook 决定统一使用 <strong>Flexbox</strong> 规范。但原生系统看不懂 Flexbox，这就需要一个“翻译官”。</p>
<h3 data-id="heading-2">2. Yoga 的工作流</h3>
<p>Yoga 就是这个<strong>翻译官</strong>，也是 RN 的<strong>排版大脑</strong>：</p>
<ol>
<li><strong>输入：</strong> 你在 JS 代码里写的 <code>flex: 1</code>, <code>width: 100</code> 等样式。</li>
<li><strong>计算：</strong> RN 将这些指令传给 C++ 层的 Yoga，Yoga 根据 Flexbox 算法算出每个元素精确的 <code>(x, y, width, height)</code>。</li>
<li><strong>输出：</strong> Yoga 将算好的坐标告诉 iOS 的 <code>UIView</code> 或 Android 的 <code>ViewGroup</code>，原生系统负责把它们画在屏幕上。</li>
</ol>
<hr/>
<h2 data-id="heading-3">二、Web 开发者必读：RN 布局的“反直觉”差异</h2>
<p>虽然 Yoga 实现了 Flexbox 规范，但为了适应移动端的特性和性能要求，它对标准 CSS 做了一些**“魔改”**。这也是新手最容易踩坑的地方。</p>
<h3 data-id="heading-4">1. 默认就是 <code>display: flex</code></h3>
<p>在 Web 中，<code>div</code> 默认是 <code>display: block</code>。但在 RN 中， <strong>“万物皆 Flex”</strong> 。</p>
<ul>
<li>所有的组件（<code>View</code>, <code>Text</code>, <code>Image</code>）默认都已经开启了 Flex 布局。</li>
<li><strong>你不需要，也不能写</strong> <code>display: 'block'</code> 或 <code>display: 'grid'</code>（RN 不支持 Grid，只能用 Flex 模拟）。</li>
</ul>
<h3 data-id="heading-5">2. 主轴默认是纵向 (<code>column</code>)</h3>
<p>这是最大的误解来源。</p>
<ul>
<li><strong>Web CSS:</strong> 默认 <code>flex-direction: row</code>（从左到右）。</li>
<li><strong>React Native:</strong> 默认 <code>flex-direction: column</code>（从上到下）。</li>
</ul>
<p><strong>设计哲学：</strong> 手机屏幕是狭长的，用户习惯上下滑动浏览内容，因此将默认流设为从上到下更符合移动端直觉。如果你想横向排列按钮，必须显式声明：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">flexDirection</span>: <span class="hljs-string">'row'</span> }}&gt;...&lt;/<span class="hljs-title class_">View</span>&gt;
</code></pre>
<h3 data-id="heading-6">3. 没有“样式继承” (Cascading)</h3>
<p>CSS 全称是 <em>Cascading Style Sheets</em>（层叠样式表），但在 RN 中，<strong>样式不会继承</strong>。</p>
<ul>
<li><strong>Web:</strong> 给父级设 <code>color: red</code>，子元素文字都会变红。</li>
<li><strong>RN:</strong> 给父 <code>View</code> 设颜色，子 <code>Text</code> 毫无反应。你必须给每个 <code>Text</code> 单独设置样式。</li>
</ul>
<h3 data-id="heading-7">4. 强制的 <code>border-box</code></h3>
<p>Web 开发中常需重置 <code>box-sizing: border-box</code>。在 RN 中，<strong>只有 <code>border-box</code> 这一种模式</strong>。Padding 和 Border 永远包含在宽高内，这大大简化了尺寸计算。</p>
<hr/>
<h2 data-id="heading-8">三、实战：彻底搞懂 <code>flex: number</code></h2>
<p>在 RN 中，我们经常看到 <code>flex: 1</code> 或 <code>flex: 2</code>，这比 Web CSS 中的 <code>flex-grow/shrink/basis</code> 组合要直观得多。</p>
<p>在 Yoga 引擎中，<code>flex</code> 接收一个数字，代表<strong>瓜分剩余空间的权重（比例）</strong>。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript">&lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">300</span> }}&gt;
  {<span class="hljs-comment">/* 红色：占 1 份 */</span>}
  &lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'red'</span> }} /&gt;
  {<span class="hljs-comment">/* 绿色：占 2 份 */</span>}
  &lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'green'</span> }} /&gt;
  {<span class="hljs-comment">/* 蓝色：占 3 份 */</span>}
  &lt;<span class="hljs-title class_">View</span> style={{ <span class="hljs-attr">flex</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'blue'</span> }} /&gt;
&lt;/<span class="hljs-title class_">View</span>&gt;
</code></pre>
<p><strong>计算逻辑：</strong></p>
<ol>
<li>总份数 = 1 + 2 + 3 = <strong>6 份</strong>。</li>
<li>红色高度 = 父容器高度 × (1/6)。</li>
<li>绿色高度 = 父容器高度 × (2/6)。</li>
<li>蓝色高度 = 父容器高度 × (3/6)。</li>
</ol>
<p><strong>注意：</strong> 只有当父容器有明确尺寸（固定高度 或 也是 <code>flex: 1</code> 撑开）时，子元素的 <code>flex</code> 比例瓜分才会生效。</p>
<hr/>
<h2 data-id="heading-9">四、总结与工具推荐</h2>
<p>React Native 的布局系统可以总结为：<strong>一个用 C++ 编写的、默认纵向排列的、强制 border-box 的严格 Flexbox 子集。</strong></p>
<h3 data-id="heading-10">调试利器：Yoga Playground</h3>
<p>如果你在写复杂布局时被“挤”得乱七八糟，或者想单纯测试 Flexbox 逻辑，推荐使用官方的在线游乐场：</p>
<p>🔗 <a href="https://link.juejin.cn?target=yogalayout.com%2Fplayground" target="_blank" title="yogalayout.com/playground" ref="nofollow noopener noreferrer">Yoga Layout Playground</a></p>
<p>在这里，你可以脱离 RN 环境，直接调整 Flex 属性，实时观察布局引擎的计算结果。</p>
<h3 data-id="heading-11">核心对照表</h3>



































<table><thead><tr><th><strong>特性</strong></th><th><strong>Web CSS</strong></th><th><strong>React Native (Yoga)</strong></th></tr></thead><tbody><tr><td><strong>默认 Display</strong></td><td><code>block</code></td><td><code>flex</code></td></tr><tr><td><strong>默认主轴方向</strong></td><td><code>row</code> (横向)</td><td><code>column</code> (纵向)</td></tr><tr><td><strong>盒模型</strong></td><td><code>content-box</code> (默认)</td><td><code>border-box</code> (强制)</td></tr><tr><td><strong>样式继承</strong></td><td>支持</td><td>不支持</td></tr><tr><td><strong>单位</strong></td><td><code>px</code>, <code>rem</code>, <code>%</code>, <code>vw</code></td><td><code>dp</code> (逻辑点), <code>%</code></td></tr></tbody></table>
<p>掌握了这些，你就掌握了 RN 布局的 90%。剩下的，就是把 Flexbox 的属性排列组合而已。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[1024层网络让强化学习性能飙升50倍，NeurIPS 2025最佳论文揭示深度scaling的力量]]></title>    <link>https://juejin.cn/post/7578442185847308326</link>    <guid>https://juejin.cn/post/7578442185847308326</guid>    <pubDate>2025-12-01T05:12:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578442185847308326" data-draft-id="7578054192809967642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="1024层网络让强化学习性能飙升50倍，NeurIPS 2025最佳论文揭示深度scaling的力量"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-12-01T05:12:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            1024层网络让强化学习性能飙升50倍，NeurIPS 2025最佳论文揭示深度scaling的力量
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:12:05.000Z" title="Mon Dec 01 2025 05:12:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在自然语言处理和计算机视觉领域，模型规模的扩大已经催生了无数突破，但强化学习（RL）领域的类似进展却一直难以实现。大多数RL研究仍在使用2-5层的浅层网络架构，而如今的LLaMA和Stable Diffusion等模型早已拥有数百层。</p>
<p>NeurIPS 2025最佳论文奖由普林斯顿大学与OpenAI的合作研究，他们成功将RL网络深度扩展至1024层，在自监督强化学习任务上实现了性能2-50倍的提升。这项研究不仅证明了深度scaling对RL的有效性，还观察到了与模型规模相关的“突现现象”——当网络达到特定深度阈值时，智能体会突然学会全新的技能和行为模式。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b43fe09a68de4d09b456cf0453f3bcd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=InpzkYzAj0L22UI20XhqQFatbeo%3D" alt="图片1.png" loading="lazy"/></p>
<blockquote>
<p><strong>项目代码：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwang-kevin3290.github.io%2Fscaling-crl%2F" target="_blank" title="https://wang-kevin3290.github.io/scaling-crl/" ref="nofollow noopener noreferrer">wang-kevin3290.github.io/scaling-crl…</a></p>
<p><strong>论文链接：</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2503.14858" target="_blank" title="https://arxiv.org/pdf/2503.14858" ref="nofollow noopener noreferrer">arxiv.org/pdf/2503.14…</a></strong></p>
</blockquote>
<p>这项工作的主要贡献是展示了一种将这些构建模块集成到单个RL方法中的方法，表现出强大的可扩展性：</p>
<ul>
<li>经验可扩展性：我们观察到显著的性能提升，在一半的环境中超过20倍，并且优于其他标准的目标条件基线方法。这些性能增益对应于随着规模扩大而出现的定性上不同的策略。</li>
<li>网络架构中的深度扩展：虽然许多先前的RL工作主要关注增加网络宽度，但他们通常在扩展深度时报告有限甚至负回报。相比之下，我们的方法解锁了沿深度轴扩展的能力，产生的性能改进超过了仅扩展宽度所带来的改进。</li>
<li>经验分析：我们对扩展方法中的关键组件进行了广泛分析，揭示了关键因素并提供了新的见解。</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08ae5bbd5f5e4ae7be72c035f279a505~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=mHUOXDzUTnHLOGciWdChHLgD7l4%3D" alt="图片2.png" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>实验</strong></h2>
<ul>
<li><strong>实验设置</strong></li>
</ul>
<p>所有RL实验都使用JaxGCRL代码库，它基于Brax和MJX促进快速在线GCRL实验。使用的具体环境是一系列运动、导航和机器人操作任务，详情见附录B。我们使用稀疏奖励设置，仅当智能体在目标附近时r=1。对于评估，我们测量智能体接近目标的时间步数（共1000步）。当将算法的性能报告为单个数字时，我们计算训练最后五个周期的平均得分。</p>
<p>我们采用了ResNet架构中的残差连接，每个残差块由四个重复单元组成，每个单元包括一个全连接层、一个层归一化层和Swish激活函数。我们在残差块的最终激活之后立即应用残差连接，如图2所示。在本文中，我们将网络的深度定义为架构中所有残差块的全连接层总数。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba353c914ee14ae5ac440f564bcc451d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=AZsXMSk0QBYHThUR2WQOUzZMDhg%3D" alt="图片3.png" loading="lazy"/></p>
<ul>
<li><strong>对比RL中的深度扩展</strong></li>
</ul>
<p>我们首先研究增加网络深度如何提高性能。JaxGCRL基准测试和相关先前工作都使用深度为4的MLP，因此我们将其作为基线。相比之下，我们将研究深度为8、16、32和64的网络。图1中的结果表明，更深的网络在多种运动、导航和操作任务中实现了显著的性能改进。与先前工作中典型的4层模型相比，更深的网络在机器人操作任务中实现了2-5倍的增益，在长视野迷宫任务（如Ant U4-Maze和Ant U5-Maze）中实现了超过20倍的增益，在类人机器人任务中实现了超过50倍的增益。深度达到64的完整性能提升表格在表1中提供。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d722b3e85354ac395a026bd9ad77e17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=%2BMo3fydc7pXxAmHCcS1vOe1SlNQ%3D" alt="图片4.png" loading="lazy"/></p>
<p>在图12中，我们展示了相同10个环境的结果，但与SAC、SAC+HER、TD3+HER、GCBC和GCSL进行了比较。扩展CRL带来了实质性的性能改进，在10个任务中的8个任务中优于所有其他基线方法。唯一的例外是SAC在Humanoid Maze环境中，早期表现出更高的样本效率；然而，扩展后的CRL最终达到了可比的性能。这些结果强调了扩展CRL算法的深度能够在目标条件强化学习中实现最先进的性能。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a95811234dd84ed79b3939e8bfcb5d9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=UWj3uBqrrNGgmWYnkY5RH6w3UOg%3D" alt="图片5.png" loading="lazy"/></p>
<ul>
<li><strong>对CRL扩展重要的因素</strong></li>
</ul>
<p>宽度vs深度。过去的文献表明，扩展网络宽度可能是有效的。在图4中，我们发现扩展宽度在我们的实验中也有帮助：更宽的网络（深度保持为4） consistently 优于更窄的网络。然而，深度似乎是一个更有效的扩展轴：仅仅将深度加倍到8（宽度保持为256）在所有三个环境中都优于最宽的网络。深度扩展的优势在Humanoid环境（观察维度268）中最为明显，其次是Ant Big Maze（维度29）和Arm Push Easy（维度17），这表明比较收益可能随着观察维度的增加而增加。另外请注意，参数数量随宽度线性增长，但随深度二次增长。作为比较，一个具有4个MLP层和2048个隐藏单元的网络大约有3500万个参数，而一个深度为32、隐藏单元为256的网络只有大约200万个参数。因此，在固定的FLOP计算预算或特定内存约束下运行时，深度扩展可能是提高网络性能的更计算高效的方法。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc4ce8f2602645c3a39cd04b98c84842~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=um1w5n6Nbul1yiJ4AxMHeQVB6bU%3D" alt="图片6.png" loading="lazy"/></p>
<p>扩展行动者vs评论家网络。为了研究行动者和评论家网络中扩展的作用，图6展示了三个环境中不同行动者和评论家深度组合的最终性能。先前的工作侧重于扩展评论家网络，发现扩展行动者会降低性能。相比之下，虽然我们确实发现在三个环境中的两个（Humanoid, Arm Push Easy）中扩展评论家影响更大，但我们的方法受益于联合扩展行动者网络，其中一个环境（Ant Big Maze）显示行动者扩展的影响更大。因此，我们的方法表明，扩展行动者和评论家网络可以在提高性能方面发挥互补作用。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6e492af82349b0af23093177389677~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=TuZtEUKhfvc%2BzeAKxP4o7uu6BNQ%3D" alt="图片7.png" loading="lazy"/></p>
<p>深度网络解锁批大小扩展。放大批大小在机器学习的其他领域已经得到很好的确立。然而，这种方法在强化学习（RL）中并未有效转化，先前的工作甚至报告了对基于值的RL的负面影响。确实，在我们的实验中，仅仅为原始CRL网络增加批大小仅产生边际性能差异（图7，左上角）。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/297ee1dbd038476b8ef4a02615bd0cbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=LUJU5pVjU2JxfcfOdctPc6db4Cs%3D" alt="图片8.png" loading="lazy"/></p>
<ul>
<li><strong>部分经验“缝合”能力</strong></li>
</ul>
<p>在泛化实验中，训练只使用最多3个单位距离的起始-目标对，但测试要求解决6个单位距离的任务。结果显示，深度4网络泛化能力有限，深度16网络取得中等成功，而深度64网络表现出色，表明更深网络能够将短距离经验“缝合”起来解决长距离任务。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49962dab85e14d8bbc384d1c24b1aead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765170724&amp;x-signature=tDy3fYwNOLxiorDDtGkaTp22qTU%3D" alt="图片9.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>对具身智能的启示</strong></h2>
<p>这项NeurIPS最佳论文的研究对正在兴起的具身智能领域具有重要启示：</p>
<ul>
<li><strong>自主技能获取</strong></li>
</ul>
<p>在具身智能应用中，为每个任务设计奖励函数是不现实的。自监督RL使智能体能够通过自主探索获得通用技能，而不需要针对每个任务的精细奖励设计。</p>
<ul>
<li><strong>复杂行为涌现</strong></li>
</ul>
<p>深层网络催生的emergent behaviors表明，通过scaling可能自然产生解决复杂物理任务所需的基本技能，如平衡、导航和操作等。</p>
<ul>
<li><strong>适应高维空间</strong></li>
</ul>
<p>具身智能通常涉及高维观察空间（如视觉、本体感觉），而研究表明深度scaling在高维环境中益处更加明显。</p>
<ul>
<li><strong>从交互中学习</strong></li>
</ul>
<p>与主要依赖现有数据集的监督学习不同，RL方法通过联合优化模型和数据收集过程，解决了“数据从哪里来”的根本问题。</p>
<h2 data-id="heading-2"><strong>结语</strong></h2>
<p>这项NeurIPS 2025最佳论文的研究打破了“强化学习难以从模型规模中受益”的传统观念，证明了深度scaling是自监督RL的强大催化剂。当大多数研究仍在小心翼翼地增加网络宽度时，这项工作勇敢地向深度维度探索，最终获得了丰厚的回报。</p>
<p>获奖意义：该研究荣获NeurIPS最佳论文奖，标志着强化学习scaling研究正式进入主流AI研究视野，为未来大模型时代的RL研究奠定了坚实基础。</p>
<p>对于具身智能领域，这项工作指出了一个有前景的方向：通过自监督RL与深度scaling的结合，可能催生能够通过自主探索获得通用物理理解能力的具身智能体。虽然前路依然漫长，但这无疑是向着能够自行训练大型模型的RL系统迈出的坚实一步。</p>
<p>这项研究不仅提供了具体的技术方案，更重要的是为整个领域的scaling探索打开了新的思路——有时候，突破就隐藏在我们尚未充分探索的维度中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NeurIPS 2025时间检验奖：10年之后再谈Faster R-CNN]]></title>    <link>https://juejin.cn/post/7578332586063134771</link>    <guid>https://juejin.cn/post/7578332586063134771</guid>    <pubDate>2025-12-01T05:25:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578332586063134771" data-draft-id="7578332586063102003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NeurIPS 2025时间检验奖：10年之后再谈Faster R-CNN"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2025-12-01T05:25:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NeurIPS 2025时间检验奖：10年之后再谈Faster R-CNN
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:25:24.000Z" title="Mon Dec 01 2025 05:25:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近日，深度学习目标检测领域《Faster R-CNN:Towards Real-Time Object Detection with Region Proposal Networks》荣获NeurIPS 2025时间检验奖。这一奖项不仅是对其历史贡献的肯定，更是对其持续影响力和技术生命力的最佳证明。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96a9576eca8342e6b96d2144b723d022~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171523&amp;x-signature=zUQEtMmLvvrchnpEjteqG4%2FKcQk%3D" alt="图片1.png" loading="lazy"/></p>
<p>在Faster R-CNN之前，目标检测流程冗长而低效。诸如Selective Search之类的区域提议方法计算缓慢，成为整个系统的性能瓶颈。Faster R-CNN的核心创新在于区域提议网络（RPN）的提出，它通过与检测网络（Fast R-CNN）共享全图像卷积特征，将区域提议这一原本独立、耗时的步骤，完美地融入了端到端的深度学习框架中。</p>
<p><strong>这一设计使得区域提议的计算成本从秒级降至10毫秒级别，让实时高精度目标检测首次成为可能。</strong></p>
<h2 data-id="heading-0"><strong>核心引擎RPN：优雅而高效的解决方案</strong></h2>
<ul>
<li><strong>锚点机制：多尺度检测的智慧</strong></li>
</ul>
<p>RPN的核心创新在于其"锚点"机制的设计。在特征图的每个滑动窗口中心，预先定义3种尺度（128×128,256×256,512×512）和3种长宽比（1:1,1:2,2:1），共9个参考锚点框。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68608f4ae2404a7bacd26ee8d2e2944e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171523&amp;x-signature=c2nz6aE3llgMH4KgJYG7Wnnfa9E%3D" alt="图片2.png" loading="lazy"/></p>
<p>这种设计的精妙之处在于：</p>
<ul>
<li><strong>尺度不变性：</strong> 无需构建计算密集的图像金字塔，就能有效处理不同尺度的目标</li>
<li><strong>参数效率：</strong> 共享卷积特征使得参数量远小于同期方法，显著降低过拟合风险</li>
<li><strong>平移不变性：</strong> 保证模型对目标位置变化的鲁棒性</li>
</ul>

<ul>
<li><strong>双重输出设计</strong></li>
</ul>
<p>在每个锚点位置，RPN同时执行两个任务：</p>
<ul>
<li><strong>边界框回归：</strong> 精修锚点位置，使其更贴合真实目标</li>
<li><strong>目标性评分：</strong> 评估每个锚点包含目标的可能性</li>
</ul>
<p>这种并行处理的设计极大地提升了效率，使得RPN能够在单次前向传播中生成高质量的候选区域。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d20492a5abf495da62af960266c0919~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171523&amp;x-signature=9N%2BsNXW1vWVq9CshdCfsjZYSBvg%3D" alt="图片3.png" loading="lazy"/></p>
<h2 data-id="heading-1"><strong>端到端训练：四步交替训练策略</strong></h2>
<p>论文提出的四步交替训练策略展现了卓越的工程智慧：</p>
<ul>
<li><strong>训练RPN网络，初始化权重</strong></li>
<li><strong>使用第一步生成的提议训练Fast R-CNN网络</strong></li>
<li><strong>固定共享卷积层，微调RPN</strong></li>
<li><strong>固定共享卷积层，微调Fast R-CNN</strong></li>
</ul>
<p>这种训练策略巧妙地解决了两个网络共享特征时的训练难题，确保了整个系统的稳定收敛。</p>
<h2 data-id="heading-2"><strong>卓越性能：数据说话的硬实力</strong></h2>
<p>实验结果表明，Faster R-CNN在多个维度都展现出了卓越性能：</p>
<p>精度方面：</p>
<ul>
<li>在PASCAL VOC 2007数据集上达到<strong>73.2%的mAP</strong></li>
<li>在PASCAL VOC 2012数据集上达到<strong>70.4%的mAP</strong></li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/148061b5f7b74716b5ce1b498e1b63f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171523&amp;x-signature=Ekx8SScfmIst3FFpHtmhlaWC3BM%3D" alt="图片4.png" loading="lazy"/></p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba4b56b9439d42fdbf0865cde74afb1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765171523&amp;x-signature=Oloa8%2FlGpqZoJhMkTI9nEcFJbEE%3D" alt="图片5.png" loading="lazy"/></p>
<p>仅使用300个提议区域就超越了Selective Search（2000个提议）的性能</p>
<p>效率方面：</p>
<ul>
<li>使用VGG-16模型在<strong>GPU上达到5fps的推理速度</strong></li>
<li>区域提议计算仅需10ms</li>
<li>端到端检测时间约200ms</li>
</ul>
<p>关于详细模型的内容可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkzOTg3NTAyNA%3D%3D%26mid%3D2247486387%26idx%3D1%26sn%3Dc2c9dc0ccabcdafcfbb9e30dca01fbf6%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkzOTg3NTAyNA==&amp;mid=2247486387&amp;idx=1&amp;sn=c2c9dc0ccabcdafcfbb9e30dca01fbf6&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">MMDetection学习系列（1）——Faster RCNN深度探索与实战指南</a>文章</p>
<h2 data-id="heading-3"><strong>深远影响</strong></h2>
<p>Faster R-CNN的影响远远超出了其本身的性能表现：</p>
<ul>
<li><strong>奠定两阶段检测范式</strong></li>
</ul>
<p>其"区域提议+目标检测"的两阶段架构成为后续高精度检测器的标准设计，催生了Mask R-CNN、Cascade R-CNN等一系列重要工作。</p>
<ul>
<li><strong>推动相关领域发展</strong></li>
</ul>
<p>实例分割：Mask R-CNN在Faster R-CNN基础上增加分割分支</p>
<p>3D目标检测：RPN思想被成功应用于点云数据处理</p>
<p>视频分析：成为视频目标检测的基础架构</p>
<ul>
<li><strong>启发单阶段检测器</strong></li>
</ul>
<p>Faster R-CNN的成功也激励研究者探索更简洁的解决方案，间接推动了YOLO、SSD等单阶段检测器的发展。</p>
<p>时至今日，Faster R-CNN的学习和应用已经变得异常便捷。在Coovally模型训练与部署平台上，该模型已作为预置开源算法集成，开发者无需下载代码和配置复杂环境，即可直接调用进行模型训练与部署，大大降低了使用门槛。</p>
<h2 data-id="heading-4"><strong>结语</strong></h2>
<p>在深度学习技术日新月异的今天，Faster R-CNN依然闪耀着智慧的光芒。它不仅仅解决了一个具体的技术问题，更重要的是展示了一种优雅的算法设计思路：通过深度的网络结构设计和巧妙的训练策略，在保持精度的同时突破效率瓶颈。</p>
<p>理解Faster R-CNN，不仅是向经典致敬，更是为我们把握计算机视觉技术发展脉络、创新下一代视觉模型提供了宝贵的思想源泉。这正是时间检验奖的真正意义所在——那些能够经受住时间考验的技术，终将成为推动行业持续前进的永恒动力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Power BI按列排序问题]]></title>    <link>https://juejin.cn/post/7578063389610000419</link>    <guid>https://juejin.cn/post/7578063389610000419</guid>    <pubDate>2025-12-01T05:43:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578063389610000419" data-draft-id="7578029371007221800" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Power BI按列排序问题"/> <meta itemprop="keywords" content="数据可视化"/> <meta itemprop="datePublished" content="2025-12-01T05:43:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Emma歌小白"/> <meta itemprop="url" content="https://juejin.cn/user/668922459726520"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Power BI按列排序问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/668922459726520/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Emma歌小白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T05:43:46.000Z" title="Mon Dec 01 2025 05:43:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>问题情况：[前台日期]不能按[前台排序]列排序，如果我新建列A=[前台日期]，这个新列A可以按[前台排序]列排序</p>
<h2 data-id="heading-0">🎯 <strong>Power BI 对“前台日期”这个字段本身加了隐含依赖/排序关系</strong></h2>
<p>（比如之前我把它 “Sort by Column” 过 → 现在这个关系残留在模型里。）</p>
<p>所以：</p>
<p>✔ 同样的数据<br/>
✔ 同样的排序列<br/>
✔ “新建列 A = [前台日期]” 可以正常排序<br/>
✔ 原字段 “前台日期” 不行</p>
<p>这说明 <strong>Power BI 在模型里对 [前台日期] 保存了一条旧的排序规则</strong>，造成冲突。</p>
<hr/>
<h2 data-id="heading-1">✅ 解决方案：删除字段的旧排序依赖（核心 fix）</h2>
<p>Power BI 会把 “Sort by Column” 的映射持久保存，<br/>
如果旧的排序列已经不存在或不再唯一，就会阻止我们继续使用它。</p>
<p>我们需要手动清除旧的排序。</p>
<hr/>
<h2 data-id="heading-2">🔧 方法 1（最简单）：把“前台日期”的排序规则清除 → 再重新指定</h2>
<p>步骤：</p>
<ol>
<li>选中字段：<strong>前台日期</strong></li>
<li>菜单栏 → Column tools</li>
<li>找到 <strong>Sort by column</strong></li>
<li>选择：<br/>
<strong>Do not sort by column / 不按列排序</strong></li>
<li>然后再重新设置为：<br/>
<strong>Sort by column → 前台排序</strong></li>
</ol>
<p>很多人不知道：<br/>
如果之前指定过排序列，Power BI <strong>会缓存排序关系</strong>，即使 M 语言重新生成了列，也会报冲突。</p>
<hr/>
<h2 data-id="heading-3">🔧 方法 2：在模型里删除“前台日期”再还原（必成功）</h2>
<ol>
<li>在模型中删除字段：<strong>前台日期</strong></li>
<li>保存</li>
<li>重新从 Power Query 加载它</li>
<li>再设置排序列</li>
</ol>
<p>因为删掉重建字段后，所有旧依赖都会被清除。</p>
<p>⚠ 删除列前确认它是否已经被用于可视化或 DAX。</p>
<hr/>
<h2 data-id="heading-4">🔧 方法 3：重命名也能清除旧依赖（无需删除）</h2>
<p>把字段改名成新的字段，也能清除旧的排序关联：</p>
<p>例：</p>
<pre><code class="hljs">前台日期 → 前台日期_旧
</code></pre>
<p>然后再新增一个：</p>
<pre><code class="hljs language-css" lang="css">前台日期 = <span class="hljs-selector-attr">[前台日期_旧]</span>
</code></pre>
<p>新列可以正常排序 → 你已经验证过。</p>
<p>这是刚才测试成功的方式，所以是<strong>最稳最快</strong>的方案。</p>
<hr/>
<h2 data-id="heading-5">🧪 为什么“新建列 A = [前台日期]” 可以排序，而旧字段不行？</h2>
<p>因为新列 A：</p>
<ul>
<li>没有旧的 Sort By Column 关系</li>
<li>没有模型依赖项</li>
<li>没有和其它表建立过排序键链接</li>
</ul>
<p>旧字段“前台日期”：</p>
<ul>
<li>之前已经被设置过 Sort By</li>
<li>存储了排序依赖关系</li>
<li>一旦 M 侧重新生成列，“关系不一致”导致冲突</li>
<li>Power BI 不会自动清理这种依赖关系</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JDK1.8+ 中 ConcurrentHashMap#computeIfAbsent 源码解析与使用建议]]></title>    <link>https://juejin.cn/post/7578215424678412351</link>    <guid>https://juejin.cn/post/7578215424678412351</guid>    <pubDate>2025-12-01T04:11:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578215424678412351" data-draft-id="7577968429590741018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JDK1.8+ 中 ConcurrentHashMap#computeIfAbsent 源码解析与使用建议"/> <meta itemprop="keywords" content="Java,性能优化,后端"/> <meta itemprop="datePublished" content="2025-12-01T04:11:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JDK1.8+ 中 ConcurrentHashMap#computeIfAbsent 源码解析与使用建议
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:11:18.000Z" title="Mon Dec 01 2025 04:11:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近发现网上讲解 ConcurrentHashMap 源码的文章对于computeIfAbsent方法的讲解比较少，这里来分析一下，读者也可以自行分析compute方法，原理类似。本文不考虑JDK1.7，分析的源码版本为JDK25。</p>
<h2 data-id="heading-0">前置知识</h2>
<ol>
<li>适用于延迟初始化和缓存场景。</li>
<li>ConcurrentHashMap 中锁粒度很细，为数组节点（链表头结点 | 红黑树根节点 | 特殊用法节点）。</li>
<li>computeIfAbsent为原子操作，必须加锁。</li>
<li>这个操作不支持递归，会抛异常。意味着缓存查询不能嵌套。</li>
<li>传入的函数不能修改 ConcurrentHashMap 本身。</li>
<li>不支持 null，可以用来表示没存。</li>
</ol>
<h3 data-id="heading-1">底层实现的前置知识</h3>
<ol>
<li>
<p>拉链法（数组+链表），hash 冲突多时退化成红黑树。链表采用尾插法，保证桶位局部有序，提升空间局部性。</p>
</li>
<li>
<p>扰动处理hash，减少冲突，简单的位操作，对性能影响小。</p>
</li>
<li>
<p>底层数组延迟初始化，在putAll、put时初始化，避免可能的扩容开销。</p>
</li>
<li>
<p>tabAt 使用unsafe实现数组中元素 volatile 语义。</p>
</li>
<li>
<p>转发节点 ForwardingNode 通过 f.hash == MOVED 计算，避免使用instanceof</p>
</li>
<li>
<p>检测到其他线程正在扩容时，当前线程辅助扩容</p>
</li>
<li>
<p>哈希均匀分布时，某个节点链表长度为2的概率为1/8。</p>
</li>
<li>
<p>除非受到攻击或者错误编写hashcode方法，几乎不可能出现红黑树，出现红黑树会影响性能。</p>
</li>
</ol>
<h2 data-id="heading-2">代码</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * 如果指定的key还没有对应的value或者value为null，则使用给定的函数计算value并存储
 * 这是一个原子操作，适用于需要延迟初始化或缓存的场景
 */</span>
<span class="hljs-keyword">public</span> V <span class="hljs-title function_">computeIfAbsent</span><span class="hljs-params">(K key, Function&lt;? <span class="hljs-built_in">super</span> K, ? extends V&gt; mappingFunction)</span> {
    <span class="hljs-comment">// 参数校验：key和mappingFunction都不能为null</span>
    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || mappingFunction == <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
    
    <span class="hljs-comment">// 对key的hashcode进行扰动处理，使hash分布更均匀</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> spread(key.hashCode());
    <span class="hljs-type">V</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 无限循环，直到成功完成操作</span>
    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) {
        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> n, i, fh; K fk; V fv;
        
        <span class="hljs-comment">// 1. 如果table未初始化，则初始化table</span>
        <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)
            tab = initTable();
        
        <span class="hljs-comment">// 2. 如果目标桶为空，则尝试插入新节点</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; h)) == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 创建一个ReservationNode作为占位符，防止其他线程同时操作同一个桶</span>
            Node&lt;K,V&gt; r = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReservationNode</span>&lt;K,V&gt;();
            <span class="hljs-keyword">synchronized</span> (r) {  <span class="hljs-comment">// 对占位符加锁，这里加锁是防御性的</span>
                <span class="hljs-comment">// 使用CAS操作将占位符放入桶中</span>
                <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>, r)) {
                    binCount = <span class="hljs-number">1</span>;
                    Node&lt;K,V&gt; node = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">// 调用映射函数计算value</span>
                        <span class="hljs-keyword">if</span> ((val = mappingFunction.apply(key)) != <span class="hljs-literal">null</span>)
                            <span class="hljs-comment">// 如果计算结果不为null，则创建新节点</span>
                            node = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(h, key, val);
                    } <span class="hljs-keyword">finally</span> {
                        <span class="hljs-comment">// 无论计算是否成功，都用计算结果替换占位符</span>
                        setTabAt(tab, i, node);
                    }
                }
            }
            <span class="hljs-comment">// 如果成功插入了节点，则跳出循环</span>
            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>)
                <span class="hljs-keyword">break</span>;
        }
        
        <span class="hljs-comment">// 3. 如果遇到转发节点（表示正在扩容），则帮助完成扩容</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)
            tab = helpTransfer(tab, f);
        
        <span class="hljs-comment">// 4. 如果第一个节点就是目标节点（无需加锁快速检查）</span>
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fh == h    <span class="hljs-comment">// hash值相同</span>
                 &amp;&amp; ((fk = f.key) == key || (fk != <span class="hljs-literal">null</span> &amp;&amp; key.equals(fk)))  <span class="hljs-comment">// key相同</span>
                 &amp;&amp; (fv = f.val) != <span class="hljs-literal">null</span>)  <span class="hljs-comment">// value不为null</span>
            <span class="hljs-keyword">return</span> fv;  <span class="hljs-comment">// 直接返回已存在的value</span>
        
        <span class="hljs-comment">// 5. 其他情况：需要加锁进行详细检查</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">added</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// 对桶的第一个节点加锁，保证线程安全</span>
            <span class="hljs-keyword">synchronized</span> (f) {
                <span class="hljs-comment">// 再次检查桶中的节点是否还是原来的节点（防止在获取锁期间被其他线程修改）</span>
                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) {
                    
                    <span class="hljs-comment">// 5.1 如果是链表节点</span>
                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) {
                        binCount = <span class="hljs-number">1</span>;
                        <span class="hljs-comment">// 遍历链表查找目标key</span>
                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) {
                            K ek;
                            <span class="hljs-comment">// 如果找到相同的key，直接返回对应的value</span>
                            <span class="hljs-keyword">if</span> (e.hash == h &amp;&amp;
                                ((ek = e.key) == key ||
                                 (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))) {
                                val = e.val;
                                <span class="hljs-keyword">break</span>;
                            }
                            
                            Node&lt;K,V&gt; pred = e;
                            <span class="hljs-comment">// 如果遍历到链表末尾仍未找到，则添加新节点</span>
                            <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-literal">null</span>) {
                                <span class="hljs-comment">// 调用映射函数计算value</span>
                                <span class="hljs-keyword">if</span> ((val = mappingFunction.apply(key)) != <span class="hljs-literal">null</span>) {
                                    <span class="hljs-comment">// 检查是否有递归更新的情况</span>
                                    <span class="hljs-keyword">if</span> (pred.next != <span class="hljs-literal">null</span>)
                                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Recursive update"</span>);
                                    added = <span class="hljs-literal">true</span>;
                                    <span class="hljs-comment">// 将新节点添加到链表末尾</span>
                                    pred.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(h, key, val);
                                }
                                <span class="hljs-keyword">break</span>;
                            }
                        }
                    }
                    
                    <span class="hljs-comment">// 5.2 如果是树节点</span>
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) {
                        binCount = <span class="hljs-number">2</span>;  <span class="hljs-comment">// 标记为树结构</span>
                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;
                        TreeNode&lt;K,V&gt; r, p;
                        <span class="hljs-comment">// 在树中查找目标key</span>
                        <span class="hljs-keyword">if</span> ((r = t.root) != <span class="hljs-literal">null</span> &amp;&amp;
                            (p = r.findTreeNode(h, key, <span class="hljs-literal">null</span>)) != <span class="hljs-literal">null</span>)
                            val = p.val;  <span class="hljs-comment">// 找到则返回value</span>
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((val = mappingFunction.apply(key)) != <span class="hljs-literal">null</span>) {
                            <span class="hljs-comment">// 未找到且计算结果不为null，则添加到树中</span>
                            added = <span class="hljs-literal">true</span>;
                            t.putTreeVal(h, key, val);
                        }
                    }
                    
                    <span class="hljs-comment">// 5.3 如果是ReservationNode（不应该出现的情况）</span>
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> ReservationNode)
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Recursive update"</span>);
                }
            }
            
            <span class="hljs-comment">// 检查节点数</span>
            <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 如果链表长度达到阈值，则转换为红黑树</span>
                <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)
                    treeifyBin(tab, i);
                
                <span class="hljs-comment">// 如果没有添加新节点（说明key已存在），则返回已存在的value</span>
                <span class="hljs-keyword">if</span> (!added)
                    <span class="hljs-keyword">return</span> val;
                <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// 操作完成，跳出循环</span>
            }
        }
    }
    
    <span class="hljs-comment">// 如果添加了新节点，则更新计数器</span>
    <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>)
        addCount(<span class="hljs-number">1L</span>, binCount);
    
    <span class="hljs-keyword">return</span> val;  <span class="hljs-comment">// 返回计算得到的value或已存在的value</span>
}
</code></pre>
<p>这里需要特别注意的是：目标桶为空，则尝试插入新节点时，这里的锁是防御性的，是为了防止重入修改。</p>
<p>且看如下代码：</p>
<pre><code class="hljs language-java" lang="java">Map&lt;String, Integer&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="hljs-number">16</span>);
map.computeIfAbsent(
    <span class="hljs-string">"AaAa"</span>,
    key -&gt; {
        <span class="hljs-keyword">return</span> map.computeIfAbsent(
            <span class="hljs-string">"BBBB"</span>,
            key2 -&gt; <span class="hljs-number">42</span>);
    }
);
</code></pre>
<p>笔者本地运行结果如下：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Exception</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">thread</span> "<span class="hljs-selector-tag">main</span>" <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalStateException</span>: <span class="hljs-selector-tag">Recursive</span> <span class="hljs-selector-tag">update</span>
	<span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.base</span>/<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ConcurrentHashMap</span><span class="hljs-selector-class">.computeIfAbsent</span>(ConcurrentHashMap.<span class="hljs-attribute">java</span>:<span class="hljs-number">1763</span>)
	<span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.parfun</span><span class="hljs-selector-class">.Main</span><span class="hljs-selector-class">.lambda</span>$<span class="hljs-selector-tag">main</span>$<span class="hljs-number">1</span>(Main.<span class="hljs-attribute">java</span>:<span class="hljs-number">28</span>)
	<span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.base</span>/<span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.concurrent</span><span class="hljs-selector-class">.ConcurrentHashMap</span><span class="hljs-selector-class">.computeIfAbsent</span>(ConcurrentHashMap.<span class="hljs-attribute">java</span>:<span class="hljs-number">1708</span>)
	<span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.parfun</span><span class="hljs-selector-class">.Main</span><span class="hljs-selector-class">.main</span>(Main.<span class="hljs-attribute">java</span>:<span class="hljs-number">25</span>)
</code></pre>
<p>执行外部computeIfAbsent时锁住的是特殊用法节点 ReservationNode，这个节点表示正在修改，内部调用computeIfAbsent时，代码锁住的是刚刚创建的头结点，执行到5.3抛出异常。</p>
<p>这个技巧在很多源码中都有使用。</p>
<h3 data-id="heading-3">一些问题分析</h3>
<ol>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbugs.openjdk.org%2Fbrowse%2FJDK-8062841" target="_blank" title="https://bugs.openjdk.org/browse/JDK-8062841" ref="nofollow noopener noreferrer">bugs.openjdk.org/browse/JDK-…</a> 中提到computeIfAbsent可能导致死循环，此外老bug，已修复。</p>
</li>
<li>
<p><a href="https://juejin.cn/post/7094561581631012878?searchId=20251130203400F6E2C1946E86E81D191F" target="_blank" title="https://juejin.cn/post/7094561581631012878?searchId=20251130203400F6E2C1946E86E81D191F">性能有坑 | 慎用 Java 8 ConcurrentHashMap 的 computeIfAbsent</a> 中提到此操作会有性能问题，原因在于如果使用JDK1.8低版本，访问头结点时，需要加锁访问。使用新版本JDK（如本文源码）不会有这个问题。一般情况下使用影响不大，一方面，哈希表通常只有头结点（链表长度为1），另一方面，初始化加锁很少成为性能瓶颈。</p>
</li>
<li>
<p><a href="https://juejin.cn/post/7212603037666902077?searchId=202511302153596497997685DC511D2F98" target="_blank" title="https://juejin.cn/post/7212603037666902077?searchId=202511302153596497997685DC511D2F98">工作十几年,第一次在线上遇到死锁问题</a> 中提到嵌套使用computeIfAbsent操作会造成死锁，如：map1.computeIfAbsent(key, k -&gt; map2.computeIfAbsent(key2, k2 -&gt; v2))。进一步说，只要参数map函数可能获取锁，都有可能造成死锁。所以，map函数应该尽量使用纯函数，有时甚至可以选择放弃原子操作的要求。</p>
</li>
<li>
<p>使用 Caffeine 中 AsyncCache，可以实现缓存 Map 的递归实现</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java">AsyncCache&lt;Integer, Integer&gt; cache = Caffeine.newBuilder().buildAsync();

<span class="hljs-type">int</span> <span class="hljs-title function_">factorial</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> {
  <span class="hljs-type">var</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;Integer&gt;();
  <span class="hljs-type">var</span> <span class="hljs-variable">prior</span> <span class="hljs-operator">=</span> cache.asMap().putIfAbsent(x, future);
  <span class="hljs-keyword">if</span> (prior != <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">return</span> prior.join();
  }
  <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (x == <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : (x * factorial(x - <span class="hljs-number">1</span>));
  future.complete(result);
  <span class="hljs-keyword">return</span> result;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python 3.12新特性实战：10个让你效率翻倍的代码优化技巧]]></title>    <link>https://juejin.cn/post/7578384621458145332</link>    <guid>https://juejin.cn/post/7578384621458145332</guid>    <pubDate>2025-12-01T04:16:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578384621458145332" data-draft-id="7578198815728762880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python 3.12新特性实战：10个让你效率翻倍的代码优化技巧"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-01T04:16:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python 3.12新特性实战：10个让你效率翻倍的代码优化技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:16:53.000Z" title="Mon Dec 01 2025 04:16:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Python 3.12新特性实战：10个让你效率翻倍的代码优化技巧</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Python 3.12作为Python语言的最新稳定版本，带来了许多令人兴奋的新特性和改进。这些特性不仅提升了语言的表达能力，还显著优化了性能，让开发者能够以更高效的方式编写代码。本文将深入探讨Python 3.12中的10个关键新特性，并通过实际代码示例展示如何将这些特性应用于日常开发中，从而大幅提升你的编码效率。</p>
<p>无论你是数据科学家、Web开发者还是自动化脚本编写者，这些技巧都能帮助你写出更简洁、更高效的Python代码。让我们从最实用的新特性开始！</p>
<hr/>
<h2 data-id="heading-2">1. 更强大的错误消息改进</h2>
<h3 data-id="heading-3">问题背景</h3>
<p>Python一直以其友好的错误消息著称，但在某些复杂场景下（如嵌套函数调用或长链式操作），错误追踪仍然不够直观。</p>
<h3 data-id="heading-4">Python 3.12的改进</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.11及以前</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>(<span class="hljs-params">data</span>):
    <span class="hljs-keyword">return</span> data[<span class="hljs-string">'key'</span>][<span class="hljs-string">'subkey'</span>][<span class="hljs-string">'value'</span>]

<span class="hljs-comment"># 当data结构不完整时可能报错：</span>
<span class="hljs-comment"># KeyError: 'subkey'</span>

<span class="hljs-comment"># Python 3.12的错误消息会显示完整的访问路径：</span>
<span class="hljs-comment"># KeyError: 'subkey' while accessing 'key' of {'key': {}}</span>
</code></pre>
<h3 data-id="heading-5">实战应用</h3>
<p>这一改进特别适合处理复杂的JSON数据结构或深度嵌套的字典操作。在调试API响应或配置文件解析时能节省大量时间。</p>
<hr/>
<h2 data-id="heading-6">2. PEP 701：f-字符串的语法放宽</h2>
<h3 data-id="heading-7">释放f-字符串的全部潜力</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python 3.11的限制</span>
colors = [<span class="hljs-string">"red"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"blue"</span>]
<span class="hljs-comment"># f"Colors: {", ".join(colors)}" # SyntaxError</span>

<span class="hljs-comment"># Python 3.12允许任意表达式包含相同的引号类型</span>
<span class="hljs-string">f"Colors: <span class="hljs-subst">{<span class="hljs-string">", "</span>.join(colors)}</span>"</span> <span class="hljs-comment"># Works perfectly!</span>
</code></pre>
<h3 data-id="heading-8">JSON嵌入示例</h3>
<pre><code class="hljs language-python" lang="python">user = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">30</span>}
query = <span class="hljs-string">f"""INSERT INTO users VALUES ('<span class="hljs-subst">{user[<span class="hljs-string">"name"</span>]}</span>', <span class="hljs-subst">{user[<span class="hljs-string">"age"</span>]}</span>)"""</span>
</code></pre>
<hr/>
<h2 data-id="heading-9">3. PEP 684：解释器级GIL优化</h2>
<h3 data-id="heading-10">GIL不再是纯性能瓶颈</h3>
<p>虽然Python仍然有全局解释器锁(GIL)，但3.12引入了每个解释器的GIL：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sysconfig
<span class="hljs-built_in">print</span>(sysconfig.get_config_var(<span class="hljs-string">'Py_GIL_DISABLED'</span>)) <span class="hljs-comment"># Check if disabled</span>
</code></pre>
<h3 data-id="heading-11">I/O密集型应用收益明显：</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># File processing with ThreadPoolExecutor now scales better</span>
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_file</span>(<span class="hljs-params">file</span>):
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(f.read())

<span class="hljs-keyword">with</span> ThreadPoolExecutor() <span class="hljs-keyword">as</span> executor:
    results = <span class="hljs-built_in">list</span>(executor.<span class="hljs-built_in">map</span>(process_file, large_file_list))
</code></pre>
<hr/>
<h2 data-id="heading-12">4. PEP 709：推导式内联缓存</h2>
<h3 data-id="heading-13">List/dict/set推导式的性能飞跃</h3>
<pre><code class="hljs language-python" lang="python">%%timeit -n1000 
<span class="hljs-comment"># Python &lt;3.12每次重新创建临时函数对象 </span>
[x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">if</span> x % filter_value ==<span class="hljs-number">0</span>]

<span class="hljs-comment"># Python ≥3.12缓存推导式逻辑框架 </span>
</code></pre>
<p>实测大型数据集处理速度提升可达20%-30%。</p>
<hr/>
<h2 data-id="heading-14">5. typing模块的重大增强</h2>
<h3 data-id="heading-15">PEP692：精确kwargs类型注解</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Unpack

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionParams</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    host: <span class="hljs-built_in">str</span> 
    port: <span class="hljs-built_in">int</span> 
    timeout: <span class="hljs-built_in">float</span> | <span class="hljs-literal">None</span>
    
<span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">**kwargs: Unpack[ConnectionParams]</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Connecting to <span class="hljs-subst">{kwargs[<span class="hljs-string">'host'</span>]}</span>:<span class="hljs-subst">{kwargs[<span class="hljs-string">'port'</span>]}</span>"</span>)
</code></pre>
<hr/>
<p>##6.buffer协议的重大改进(PEP688)</p>
<p>###零拷贝数据处理范例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np 

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_buffer</span>(<span class="hljs-params">view: <span class="hljs-built_in">memoryview</span></span>) -&gt; np.ndarray:
    <span class="hljs-keyword">return</span> np.frombuffer(view, dtype=<span class="hljs-string">'float32'</span>) 

arr = np.random.rand(<span class="hljs-number">1024</span>).astype(<span class="hljs-string">'float32'</span>)
view = <span class="hljs-built_in">memoryview</span>(arr) <span class="hljs-comment"># Zero-copy sharing  </span>
result = process_buffer(view)
</code></pre>
<p>内存敏感型应用（如图像处理）性能可提升50%以上。</p>
<hr/>
<p>##7.subinterpreters正式API(PEP734)</p>
<p>###真正的并行计算方案：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> _xxsubinterpreters <span class="hljs-keyword">as</span> interpreters 

<span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>():
    interp = interpreters.create()
    interpreters.run_string(interp, <span class="hljs-string">"print('Hello from subinterpreter')"</span>)
    
worker() <span class="hljs-comment"># Runs in isolated environment  </span>
</code></pre>
<p>适用于科学计算等需要绕过GIL的场景。</p>
<hr/>
<p>##8.PEP712：调试器API标准化</p>
<p>###构建自定义调试工具：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys 

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDebugger</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        sys.monitoring.use_tool_id(<span class="hljs-number">42</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_line</span>(<span class="hljs-params">self, code, line_no</span>): 
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Executing line <span class="hljs-subst">{line_no}</span>"</span>)
        
debugger = MyDebugger()  
</code></pre>
<hr/>
<p>##9.Python启动加速技术</p>
<p>###测量启动时间差异：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># python3 -X perf -c "print('Hello')"</span>
</code></pre>
<p>CLI工具和微服务冷启动速度提升约15%。</p>
<hr/>
<p>##10.type参数语法糖(PEP695)</p>
<p>###更优雅的泛型编程：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">type</span> Matrix[T] = <span class="hljs-built_in">list</span>[<span class="hljs-built_in">list</span>[T]] 

<span class="hljs-keyword">def</span> <span class="hljs-title function_">transpose</span>(<span class="hljs-params">matrix: Matrix[<span class="hljs-built_in">float</span>]</span>) -&gt; Matrix[<span class="hljs-built_in">float</span>]:
    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">list</span>(row) <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(*matrix)]
</code></pre>
<p>比传统的TypeVar声明简洁40%。</p>
<hr/>
<p>##总结与升级建议</p>
<p>本文介绍的10个Python3.12新特性覆盖了从语法糖到底层优化的多个层面：</p>
<p>1.<strong>调试友好性</strong>：增强的错误消息和标准调试API让问题定位更快<br/>
2.<strong>性能关键</strong>：GIL优化、推导式缓存和buffer协议提升执行效率<br/>
3.<strong>现代化类型系统</strong>：简化复杂类型的表达方式<br/>
4.<strong>并发模型革新</strong>：subinterpreters为真正并行铺路</p>
<p>升级策略建议：</p>
<p>•I/O密集型应用优先采用GIL优化+subinterpreters组合<br/>
•科学计算项目重点关注buffer协议和类型系统改进<br/>
•所有项目都能受益于更好的错误消息和新语法糖</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[新一代SageMaker+Databricks统一目录：机器学习与数据分析工作流打通方案]]></title>    <link>https://juejin.cn/post/7578314349514752051</link>    <guid>https://juejin.cn/post/7578314349514752051</guid>    <pubDate>2025-12-01T04:24:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578314349514752051" data-draft-id="7577284968922824704" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="新一代SageMaker+Databricks统一目录：机器学习与数据分析工作流打通方案"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-01T04:24:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亚马逊云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            新一代SageMaker+Databricks统一目录：机器学习与数据分析工作流打通方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亚马逊云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:24:44.000Z" title="Mon Dec 01 2025 04:24:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fs3.cn-north-1.amazonaws.com.cn%2Fawschinablog%2Fblogbanner-newnew.png" target="_blank" title="https://s3.cn-north-1.amazonaws.com.cn/awschinablog/blogbanner-newnew.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b38e9d4d2214d9ba055ba2a2cd412e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=yMEfX747pouzT9opeAOTjkSrhEM%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-0">前言</h2>
<p>在数据驱动决策的时代，企业正面临着两大核心挑战：如何打破数据孤岛实现跨平台协作，以及如何在复杂技术栈中保持治理一致性。这些挑战直接影响着企业从数据中获取价值的能力和速度。</p>
<p>Databricks作为领先的数据分析和机器学习平台，已经帮助众多企业实现了大规模数据处理和分析。与此同时，许多企业在亚马逊云科技云上构建了完整的业务系统和机器学习工作流。如何让这两个强大的生态系统无缝协作，成为了释放数据价值的关键所在。</p>
<p>本文提出的解决方案：通过SageMaker Unified Studio与Databricks Unity Catalog的深度集成，企业既能充分利用Databricks强大的数据分析能力，又能与亚马逊云科技上现有的业务系统深度融合，真正实现数据价值的最大化。这不是简单的技术对接，而是一种全新的数据协作范式。</p>
<p>本文将以真实业务场景为锚点，深度解析两大平台的协同价值：</p>
<p>1.技术融合性 – 零摩擦的数据访问</p>
<p>通过SageMaker Unified Studio中的托管JupyterLab环境，借助EMR Serverless的强大计算能力，直接访问Databricks Unity Catalog中的受治理数据。这种架构彻底消除了传统ETL的冗余，让数据科学家能够实时访问最新的业务数据，显著提升模型开发效率。</p>
<p>2.治理穿透力 – 企业级安全合规保障</p>
<p>在新一代SageMaker工作流中无缝继承Databricks预设的数据血缘追踪、细粒度访问控制和完整审计策略。这意味着企业无需重复构建治理体系，即可确保跨平台的数据安全性和合规性，大幅降低治理成本和风险。</p>
<p>实战导向的技术指南</p>
<p>我们不仅会深入剖析架构设计的核心要点，更重要的是分享在实际项目落地中积累的宝贵经验和避坑指南：</p>
<p>关键技术挑战与解决方案：</p>
<ul>
<li>跨平台安全访问：如何在保证数据安全的前提下实现平台间的身份认证和授权</li>
<li>混合云网络配置：企业混合云环境下的网络连通性最佳实践</li>
<li>性能优化策略：大规模数据查询的性能调优技巧</li>
<li>生产级部署考量：从POC到生产环境的平滑过渡路径</li>
</ul>
<p>通过本文，您将获得一份经过实践验证的完整集成方案，帮助您的团队快速构建一个安全、高效、可扩展的跨平台数据科学工作流。</p>
<h2 data-id="heading-1">架构解析</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-1.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-1.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6df8bde6588b46989ffda179f76db7bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=hAVopSs45XRd0cph4NXv9j8jFHk%3D" alt="" loading="lazy"/></a></p>
<p>此架构旨在整合 Amazon SageMaker Notebook和Databricks Unity Catalog 的功能，以实现高效的数据处理、机器学习模型开发以及跨平台的数据共享和协作。</p>
<p><strong>亚马逊云科技 Side</strong></p>
<p>SageMaker Unified Studio: 作为亚马逊云科技的核心组件之一，Sagemaker Unified Studio为数据科学家和开发者提供了一个集成的开发环境，用于构建、训练和部署机器学习模型。它支持多种编程语言和框架，并且可以无缝地与亚马逊云科技其他服务进行集成。</p>
<p>EMR Studio Notebook: EMR Studio Notebook是Amazon EMR的一部分，它允许用户在云端运行交互式数据分析任务。通过EMR Studio Notebook，用户可以利用Apache Spark等大数据处理框架来处理大规模数据集。</p>
<p><strong>Databricks Side</strong></p>
<p>Open API: Databricks提供了丰富的API接口，使得外部系统能够与其进行通信和数据交换。这些API包括但不限于REST API，它们允许用户执行各种操作，如创建和管理集群、运行作业、查询数据等。</p>
<p>Unity Catalog: Databricks的 Unity Catalog是一个元数据管理解决方案，它帮助组织管理和治理其数据资产。通过 Unity Catalog，用户可以定义和应用细粒度的数据访问控制策略，确保数据的安全性和合规性。</p>
<p>Delta Lake: Delta Lake是Databricks推出的一个开源存储层，它提供了ACID事务、统一的数据治理和高性能的数据处理能力。Delta Lake可以存储结构化和半结构化的数据，并支持实时分析和批处理等多种工作负载。</p>
<h3 data-id="heading-2">Databricks 数据共享方式</h3>
<p>Databricks提供了多种数据共享的方式,下面是一个列表,我们可以根据自己的需求来进行选择.</p>





















































<table><thead><tr><th/><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th></tr></thead><tbody><tr><td>1</td><td><strong>Option</strong></td><td><strong>Cost</strong></td><td><strong>Limitations</strong></td><td><strong>Simplicity</strong></td><td><strong>When to use?</strong></td></tr><tr><td>2</td><td>Delta Sharing</td><td>$</td><td>🔴</td><td>🟠</td><td>只读模式：适用于小数据且由工作区管理员进行设置</td></tr><tr><td>3</td><td>Databricks Connect</td><td>$$</td><td>🟢</td><td>🟢</td><td>任何需要使用 Databricks 计算能力的情况</td></tr><tr><td>4</td><td>Databricks SQL client</td><td>$$</td><td>🟢</td><td>🟢</td><td>类似于 Databricks Connect，但仅适用于 SQL 用户。</td></tr><tr><td>5</td><td>Unity Catalog Open APIs</td><td>$</td><td>🟠</td><td>🟢</td><td>目前适用于只读用例，具有简单的设置，并且可以使用您选择的引擎。</td></tr></tbody></table>
<p>本案例中我们使用 Unity Catalog Open APIs 来实现 Databricks 和 SageMaker Unified Studio的数据共享, 下面我们将逐步带大家完成所有的配置.</p>
<h3 data-id="heading-3">Databricks 侧配置</h3>
<ol>
<li>首先我们需要开启Databricks的Catalog External Access, 配置步骤如下.</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-2.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-2.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a352fb6c44c1474d9cb4d1cc1fa25990~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=xlGlfU7lDXo6Tcwe9lbuYmG%2BUzI%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-3.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-3.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb98de5f479d4dd3b5f62ed0e5690669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=zCqqqwiT6KUnYwnvU3%2F0gXkJvxc%3D" alt="" loading="lazy"/></a></p>
<p>Enable <strong>External data access</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-4.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-4.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85c25b9592684c7a953f8bc8c963ee2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=02lUXPUZjYFL2Co6Dv8WlyyF%2FJo%3D" alt="" loading="lazy"/></a></p>
<ol start="2">
<li>配置Databricks用户可以在外部访问Catalog的权限,使用以下示例语句.</li>
</ol>
<p><code>GRANT EXTERNAL USE SCHEMA ON SCHEMA &lt;catalog_name&gt;.&lt;schema_name&gt; TO `xxxxx@xx.com`</code></p>
<ol start="3">
<li>配置对用Databricks 用户Personal Access Token,点击用户<strong>Settings</strong> 选项</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-5.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-5.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/562c618a916b4a6d85d0450e59fa2866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=QmHRjyPJlmhQwffk1qeOo4eWk2w%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-6.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-6.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/175cd8f6f6a14e46b5757e66eacb2f7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=TNUXAuFLyD8C7n0AuO99O3NaiQQ%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-7.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-7.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/afeb28305471463ca80bf72dfc44efdb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=xuK%2BG0PE9LyJAbuoZxmWsKu0OQk%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-8.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-8.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d31e792dc1aa46b9a06a6f6749833f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=%2B8DBWVkFnrkDXIeZLZjhgL7uYSM%3D" alt="" loading="lazy"/></a></p>
<p>一定要记录下来生成好的access token,它只能被记录一次,至此我们在 Databricks上配置就可以了.</p>
<h2 data-id="heading-4">Sagemaker Unified Studio 配置</h2>
<p>在 Amazon SageMaker Unified Studio 中，域是用于连接您的资产、用户及其项目的组织实体。域代表组织内业务线 (LOB) 或业务领域的独特边界，这些业务领域可以管理自己的数据，包括自己的数据资产、自己的数据或业务术语定义，并可能有自己的治理标准。管理员创建域并与用户或组共享 URL。首次开始使用 Amazon SageMaker Unified Studio 时，首先要创建域以及域中存在的所有核心组件。</p>
<h3 data-id="heading-5">设置 Amazon SageMaker 统一工作室域</h3>
<ol>
<li>要开始创建域，请在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fus-west-2.console.aws.amazon.com%2Fdatazone%2Fhome%3Fregion%3Dus-west-2%23%2F" target="_blank" title="https://us-west-2.console.aws.amazon.com/datazone/home?region=us-west-2#/" ref="nofollow noopener noreferrer">Amazon SageMaker </a>控制台上点击 创建统一工作室域按钮。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-9.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-9.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1638d698d9374c3aadd1f43510f738f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=tUt5GQQTzB8u123Kdp2CKpxHbPs%3D" alt="" loading="lazy"/></a></p>
<ol start="2">
<li>选择快速设置功能，在 快速设置功能的设置页面上，修改域名。在虚拟私有云(<strong>VPC</strong>) 中请选择有私有子网存在的VPC，选择三个不同AZ的私有子网，私有子网必须配置 Nat Gateway，否则会影响后续功能使用。其他保持默认值。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-10.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-10.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/969d8e5492914ae6b254068a7877ddfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=VrEEbXzlI7BCA1xcsnfmgsvRzXU%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-11.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-11.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55de39c2b74f484aa2f5e429f6bad6a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=f%2FMgUeeYHGwotsOsLuU7Cu1KhCM%3D" alt="" loading="lazy"/></a></p>
<ol start="3">
<li>Amazon SageMaker Unified Studio 域默认支持 IAM 用户身份验证。在此输入IAM Identity Center中用户电子邮箱地址。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-12.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-12.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc58965830c7400aa19f80e1fc55b980~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=6CGDCZDolcJ8apVH4lDTAJI5N%2BQ%3D" alt="" loading="lazy"/></a></p>
<ol start="4">
<li>创建成功后通过url或者“打开统一工作室”按钮登陆Amazon SageMaker Unified Studio。点击后选择 SSO 方式登陆。输入在IAM 身份中心设置的用户名和密码。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-13.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-13.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1530e57b97544c879ccfb4bb6ac15204~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=HPWrBTG4wQM9OgBgV1oLaS2GR3c%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-14.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-14.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff54ee38343f4151955c9111994e1ce3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=TZCKhdM2UnFmsZ6x0TvQzimH3Xg%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-6">创建项目</h3>
<ol>
<li>登陆后点击创建项目，在 Amazon SageMaker Unified Studio 中，通过项目汇集人员、数据和工具，使数据用户群体能够协作解决特定的业务用例。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-15.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-15.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d40fdac8d1d9419fb6d407bc0b2ae6b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=gvz8Z7bWYZ%2B974pj%2BczSTLHn%2FWg%3D" alt="" loading="lazy"/></a></p>
<ol start="2">
<li>修改项目名称，选择合适的项目配置文件。项目配置文件是用于创建项目的配置蓝图的集合。蓝图定义了项目成员在处理 Amazon SageMaker 目录中的数据时可以使用哪些亚马逊云科技工具和服务。这里选择的是所有功能，选择后点击继续。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-16.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-16.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f869a767005b44019341cb8d97be2c65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=yqFmdMaLtn0HEnNf6Clt9GQTdDw%3D" alt="" loading="lazy"/></a></p>
<ol start="3">
<li>可以按需更改日志保留期等配置，由于在此场景下已经禁用了glue catalog，可以忽略lakehouse database中的glue database name更改，这里保持默认设置。点击继续。跳转到下一页后再选择 创建项目。创建成功后，您将被重定向到项目主页。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-17.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-17.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feb52e6d8be2440cb1c2c48e8c3fe10a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=hrBlPW21GGPGUKA2w2NbZAv1t4E%3D" alt="" loading="lazy"/></a></p>
<ol start="4">
<li>下一步我们来添加EMR Serverless 计算资源。进入项目后，在左侧概览下选择<strong>compute</strong>，点击<strong>Data processing</strong>，点击 <strong>add compute</strong>。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-18.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-18.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/668caf7a99ea4870baa8673e4c4e7823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=AvXpsS7uY1onqR9YEyy5nQ2ap8A%3D" alt="" loading="lazy"/></a></p>
<ol start="5">
<li>您可以选择连接到现有计算资源。如果您为创建资源，可以选择<strong>Create new compute resources</strong>，点击 <strong>next</strong></li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-19.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-19.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05e6b12c1c744359bafe824d901d9c91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=vSuY%2BldClddQ5xuhzmxvx73eFdk%3D" alt="" loading="lazy"/></a></p>
<ol start="6">
<li>关于计算资源种类，我们选择<strong>EMR Serverless</strong> , 点击 <strong>next，</strong> 修改<strong>compute name</strong>，其他保持默认值，点击 <strong>add compute</strong></li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-20.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-20.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cd7d975b8274f219ad1363bbd2f7cd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=oKdHfPY69HUpinHwwpz3mYeG05A%3D" alt="" loading="lazy"/></a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-21.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-21.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c495c4a71ce40b189cc5ba41f78a01f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=Lf2KKAnNG7lwjnmv60MZj%2BanuA8%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-7">项目角色权限配置</h3>
<p>最后我们还需要为项目角色添加权限，使其可以访问Databricks存储在S3的数据。</p>
<ol>
<li>我们先在左侧概览下选择<strong>Project overview</strong>，在<strong>Project details</strong>找到<strong>Porject role arn</strong>，从 datazone_user字段开始复制</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-22.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-22.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/615ca1a66c184e008a4bd4eeccfb57c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=Qr0gm2xHFgrJMd1q9zcOWr5oi%2Bo%3D" alt="" loading="lazy"/></a></p>
<ol start="2">
<li>进入<strong>IAM</strong>服务控台页面，点击左侧角色，搜索复制的project role，点击查询结果查看角色详情。</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-23.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-23.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fffc6720c68d4e0b9f22fb8fa5f12321~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=YjNB10%2BwurLSv4NPKmlwmIFtlaM%3D" alt="" loading="lazy"/></a></p>
<ol start="3">
<li>为项目角色创建内联策略。输入以下策略，将<em>amzn-s3-demo-bucket</em>替换成您的存储桶名称</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-24.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-24.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f566e6bd4fd84b79bc54706d8de1cb40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=yObeSy39OrXcJrZ3aoynbcvdqAE%3D" alt="" loading="lazy"/></a></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2012-10-17"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"Sid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"S3AdditionalObjectPermissions"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-string">"s3:ListBucket"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-string">"s3:GetBucketLocation"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-string">"s3:GetObject*"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-string">"s3:PutObject"</span>
            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-string">"arn:aws:s3:::&lt;amzn-s3-demo-bucket&gt;"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-string">"arn:aws:s3:::&lt;amzn-s3-demo-bucket&gt;/*"</span>
            <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>至此我们在Sagemaker Unified Studio上的开发环境已经Ready了.</p>
<h2 data-id="heading-8">EMR Serverless 配置</h2>
<p>下面我们需要修改 EMR Serverless Application 的配置, 为了保证后面我们在 Sagemaker Unified Studio 中的配置一致,我们需要修改Application的  <strong>Application configuration</strong> 和 <strong>Additional configurations.</strong> 修改的内容如下</p>
<ol>
<li><strong>Application configuration</strong></li>
</ol>

<pre><code class="hljs language-bash" lang="bash">{
    <span class="hljs-string">"runtimeConfiguration"</span>: [
        {
            <span class="hljs-string">"classification"</span>: <span class="hljs-string">"spark-defaults"</span>,
            <span class="hljs-string">"properties"</span>: {
                <span class="hljs-string">"spark.jars"</span>: <span class="hljs-string">"/usr/share/aws/delta/lib/delta-spark.jar,/usr/share/aws/delta/lib/delta-storage.jar"</span>,
                <span class="hljs-string">"spark.jars.packages"</span>: <span class="hljs-string">"io.unitycatalog:unitycatalog-spark_2.12:0.2.0"</span>,
                <span class="hljs-string">"spark.sql.extensions"</span>: <span class="hljs-string">"io.delta.sql.DeltaSparkSessionExtension"</span>,
                <span class="hljs-string">"spark.sql.defaultCatalog"</span>: <span class="hljs-string">"&lt;databricks uc&gt;"</span>, <span class="hljs-comment"># 此处修改为上面databricks中grant的UC</span>
                <span class="hljs-string">"spark.sql.catalog.spark_catalog"</span>: <span class="hljs-string">"io.unitycatalog.spark.UCSingleCatalog"</span>,
                <span class="hljs-string">"spark.sql.catalog.&lt;databricks uc&gt;"</span>: <span class="hljs-string">"io.unitycatalog.spark.UCSingleCatalog"</span>,
                <span class="hljs-string">"spark.sql.catalog.&lt;databricks uc&gt;.uri"</span>: <span class="hljs-string">"https://&lt;databricks workspace url&gt;/api/2.1/unity-catalog"</span>
            }
        }
    ]
}
</code></pre>
<p>2.  Disable Glue Catalog</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-25.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-25.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac923850b2cf4004b24d99c226265b6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=eWj4ODYkekeMFg4sZwqowqk7pfg%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-9">Sagemaker Unified Studio JupyterLab配置</h2>
<p>下面我们开始配置Sagemaker Unified Studio → JupyterLab, 如下图所示</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-26.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-26.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/067be762f45c4ec2b43355afca47490b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=8zehsOtIk3kHQrOvs28OaMbrPqs%3D" alt="" loading="lazy"/></a></p>
<p>在我们创建Sagemaker Unified Studio的时候,会默认选上Glue Catalog作为Catalog的默认选项,如何我们想在Notebook内使用Databricks Unified Catalog, 我们需要覆盖原有Glue Catalog配置信息,注意下面的catalog信息.</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-comment">%%configure -n &lt;EMR serverless application&gt; -f </span>
{ 
    <span class="hljs-string">"conf"</span>: { 
        <span class="hljs-string">"spark.jars"</span>: <span class="hljs-string">"/usr/share/aws/delta/lib/delta-spark.jar,/usr/share/aws/delta/lib/delta-storage.jar"</span>,
        <span class="hljs-string">"spark.jars.packages"</span>: <span class="hljs-string">"io.unitycatalog:unitycatalog-spark_2.12:0.2.0"</span>,
        <span class="hljs-string">"spark.sql.extensions"</span>: <span class="hljs-string">"io.delta.sql.DeltaSparkSessionExtension"</span>,
        <span class="hljs-string">"spark.sql.defaultCatalog"</span>: <span class="hljs-string">"&lt;databricks uc&gt;"</span>,
        <span class="hljs-string">"spark.sql.catalog.spark_catalog"</span>: <span class="hljs-string">"io.unitycatalog.spark.UCSingleCatalog"</span>,
        <span class="hljs-string">"spark.sql.catalog.&lt;databricks uc&gt;"</span>: <span class="hljs-string">"io.unitycatalog.spark.UCSingleCatalog"</span>,
        <span class="hljs-string">"spark.sql.catalog.&lt;databricks uc&gt;.uri"</span>: <span class="hljs-string">"https://&lt;databricks workspace url&gt;/api/2.1/unity-catalog"</span>,
        <span class="hljs-string">"spark.sql.catalog.&lt;databricks uc&gt;.token"</span>: <span class="hljs-string">"&lt;databricks uc token&gt;"</span>
     }
}
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-27.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-27.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a26934fe051f4178be88b18c4ea45d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=OwAOTZOO0g2iOp9cbzXsEekpFmQ%3D" alt="" loading="lazy"/></a></p>
<p>创建Spark session, 下面步骤中一定要注意<strong>Compute</strong>的信息</p>
<pre><code class="hljs language-java" lang="java">from pyspark.sql <span class="hljs-keyword">import</span> <span class="hljs-type">SparkSession</span>

<span class="hljs-variable">spark</span> <span class="hljs-operator">=</span> SparkSession.builder \
    .appName(<span class="hljs-string">"EMR Serverless and Databricks Unity Catalog Demo"</span>) \
    .getOrCreate()
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-28.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-28.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c5ac467f34a44c6b1504c220f6d771f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=XOdC1ZVuyrvCNVtwRGsgJ%2FsnBbI%3D" alt="" loading="lazy"/></a></p>
<p>验证当前的 Spark Context Configuration</p>
<pre><code class="hljs language-scss" lang="scss"># Verify the configuration
essential_configs = <span class="hljs-selector-attr">[    <span class="hljs-string">'spark.jars.packages'</span>, <span class="hljs-string">'spark.executor.instances'</span>, <span class="hljs-string">'spark.cores'</span>,    <span class="hljs-string">'spark.driver.cores'</span>, <span class="hljs-string">'spark.executor.cores'</span>, <span class="hljs-string">'spark.memory'</span>,    <span class="hljs-string">'spark.driver.memory'</span>, <span class="hljs-string">'spark.executor.memory'</span>, <span class="hljs-string">'spark.sql.catalog'</span>,    <span class="hljs-string">'spark.sql.defaultCatalog'</span>, <span class="hljs-string">'spark.master'</span>, <span class="hljs-string">'spark.sql.extensions'</span>]</span>
for item in spark<span class="hljs-selector-class">.sparkContext</span><span class="hljs-selector-class">.getConf</span>()<span class="hljs-selector-class">.getAll</span>():
    if <span class="hljs-built_in">any</span>(config in item[<span class="hljs-number">0</span>] for config in essential_configs):
        <span class="hljs-built_in">print</span>(item)
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-29.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-29.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56215b08687c436fa2ad53c79fb674a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=JtE3kUF06vaKkGpOL%2Fop7Jyo5PA%3D" alt="" loading="lazy"/></a></p>
<p>如果想使用emr serverless计算资源，请在每个单元格上方进行选择，左侧选择pyspark，右侧选择创建好的emr serverless资源</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-30.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-30.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f88d1f28844f90af6130f5c89178b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=Rj%2B9wSYAWeCNA60SZIiacMd1bRo%3D" alt="" loading="lazy"/></a></p>
<p>查询当前Spark中的catalog List</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Try to use Unity Catalog</span>
spark.sql(<span class="hljs-string">"SHOW CATALOGS"</span>).show()
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-31.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-31.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f426418efa844c18b99b9b1cd104332f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=SrwXkzzIo9oTgOIuwZuyxChQyDA%3D" alt="" loading="lazy"/></a></p>
<p>可以看到此时已经有 sean2 的catalog.</p>
<p>下面我们查询该catalog下的schema数据.</p>
<p><code>spark.sql("select * from sean2.myorder.sample_orders limit 1").show()</code></p>
<p>此时可以看到我们已经可以查询到数据了.</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F10%2F16%2Fmachine-learning-and-data-analytics-workflow-32.jpg" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/10/16/machine-learning-and-data-analytics-workflow-32.jpg" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/432db570501846a1ab74bd5ae93371e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=QP5%2Bf%2B7pYVFjQdbXiWMfL3JuCsQ%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-10">总结与展望</h2>
<h3 data-id="heading-11">方案价值回顾</h3>
<p>通过本文介绍的集成方案，我们成功打通了亚马逊云科技新一代SageMaker与Databricks两大平台的数据通道，实现了真正意义上的统一数据湖仓架构。这不仅是技术层面的集成，更是企业数据战略的重要布局。</p>
<h4 data-id="heading-12">关键收益总结</h4>
<ol>
<li>直接收益：</li>
</ol>
<ul>
<li>开发效率提升：消除重复的ETL开发工作</li>
<li>数据延迟降低：从批处理ETL到实时查询的转变</li>
<li>治理成本降低：统一的权限管理和审计体系</li>
<li>资源利用率提升：EMR Serverless的弹性计算能力</li>
</ul>
<ol start="2">
<li>战略价值：</li>
</ol>
<ul>
<li>打破组织壁垒：让数据工程师和数据科学家在各自熟悉的平台上协同工作</li>
<li>加速<strong>AI</strong>落地：从数据洞察到模型部署的端到端流程优化</li>
<li>降低合规风险：统一的数据治理框架确保合规性</li>
<li>提升创新能力：释放团队精力专注于业务价值创造</li>
</ul>
<ol start="3">
<li>适用场景</li>
</ol>
<p>本方案特别适合以下场景：</p>
<ul>
<li>已有Databricks数据平台，需要扩展ML能力的企业</li>
<li>需要在亚马逊云科技生态系统中利用Databricks数据资产的团队</li>
<li>对数据治理有严格要求的游戏、金融、医疗等行业</li>
<li>追求成本优化的中大型数据团队</li>
</ul>
<h3 data-id="heading-13">未来展望</h3>
<p>随着Unity Catalog生态的不断完善和亚马逊云科技对开放标准的持续支持，我们预见：</p>
<ol>
<li>更深度的集成：期待看到新一代SageMaker与Databricks的直接集成，互为数据的生产者与消费者。在数据发现，可读可写和数据治理方面更加无缝</li>
<li>性能优化：通过缓存、预计算等技术进一步提升查询性能</li>
<li>智能化治理：基于ML的自动化数据分类和权限推荐</li>
<li>多云扩展：将这种集成模式扩展到其他云平台</li>
</ol>
<p><strong>参考文档</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcommunity.databricks.com%2Ft5%2Ftechnical-blog%2Fhow-to-access-data-in-databricks-from-amazon-sagemaker-notebooks%2Fba-p%2F83638" target="_blank" title="https://community.databricks.com/t5/technical-blog/how-to-access-data-in-databricks-from-amazon-sagemaker-notebooks/ba-p/83638" ref="nofollow noopener noreferrer">community.databricks.com/t5/technica…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2Fbig-data%2Frun-interactive-workloads-on-amazon-emr-serverless-from-amazon-emr-studio%2F" target="_blank" title="https://aws.amazon.com/blogs/big-data/run-interactive-workloads-on-amazon-emr-serverless-from-amazon-emr-studio/" ref="nofollow noopener noreferrer">aws.amazon.com/blogs/big-d…</a></p>
<p>*<em>前述特定亚马逊云科技生成式人工智能相关的服务目前在亚马逊云科技海外区域可用。亚马逊云科技中国区域相关云服务由西云数据和光环新网运营，具体信息以中国区域官网为准。</em></p>
<p><strong>本篇作者</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09d37d2eb0fc46f8bf479071170271d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765167884&amp;x-signature=vrCjnHczu9NL3ZrVti%2FLZQqA2OI%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大模型开发实战篇3：函数调用FunctionCall]]></title>    <link>https://juejin.cn/post/7578198815728812032</link>    <guid>https://juejin.cn/post/7578198815728812032</guid>    <pubDate>2025-12-01T04:37:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578198815728812032" data-draft-id="7577991167200591882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大模型开发实战篇3：函数调用FunctionCall"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-01T04:37:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大模型开发实战篇3：函数调用FunctionCall
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:37:11.000Z" title="Mon Dec 01 2025 04:37:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>函数调用功能可以增强模型推理效果或进行其他外部操作，包括信息检索、数据库操作、知识图谱搜索与推理、操作系统、触发外部操作等工具调用场景。</p>
<p>经过测试发现以下情况：</p>
<p>1、市面上的大模型几乎都支持函数调用，但其稳定性不是很好，有时候无法命中函数。</p>
<p>2、OpenAI的函数调用在使用中会发现对中文的理解不够精准，DeepSeek对函数的支持也不够稳定。</p>
<p>3、各大模型对英文的支持度都比较好，比中文的理解更精准。</p>
<p>4、函数调用功能，测试下来发现智谱大模型最优秀，不管是中文还是英文都能命中函数。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d06f5b4b833b4c9db9942b704272c0d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765168631&amp;x-signature=ukEcwUTM%2FFLK71PKHOZdXYAhLmo%3D" alt="" loading="lazy"/></p>
<p>上图为OpenAI的函数调用的时序图，其中get_weather函数为本地定义的一个函数，需要与大模型至少进行2轮对话，才可以真正调用函数回答问题。</p>
<p>本教程将介绍如何使用 智谱的ChatGLM 的函数调用功能，实现对模型与外部函数库的连接。</p>
<p>tools 是内容生成 API 中的可选参数，用于向模型提供函数定义。通过此参数，模型能够生成符合用户所提供规范的函数参数。请注意，API 实际上不会执行任何函数调用，仅返回调用函数所需要的参数。开发者可以利用模型输出的参数在应用中执行函数调用。</p>
<p>本教程包括以下3个部分:</p>
<ol start="0">
<li>如何使用 Chat Completion 接口向模型描述外部函数。</li>
<li>如何与模型交互，触发模型对函数的调用。</li>
<li>如何使用模型生成的结果调用外部函数。</li>
</ol>
<p>如何描述外部函数</p>
<p>假设我们要创建一个具备查询航班功能的聊天机器人。我们定义如下两个外部函数供模型选择调用：</p>
<ol start="0">
<li>查询两地之间某日航班号函数：get_flight_number(departure: str, destination: str, date: str)</li>
<li>查询某航班某日票价函数：get_ticket_price(flight_number: str, date: str)</li>
</ol>
<p>描述函数功能</p>
<p>为了向模型描述外部函数库，需要向 tools 字段传入可以调用的函数列表。参数如下表： </p>









































<table><thead><tr><th>参数名称</th><th>类型</th><th>是否必填</th><th>参数说明</th></tr></thead><tbody><tr><td>type</td><td>String</td><td>是</td><td>设置为function</td></tr><tr><td>function</td><td>Object</td><td>是</td><td/></tr><tr><td>name</td><td>String</td><td>是</td><td>函数名称</td></tr><tr><td>description</td><td>String</td><td>是</td><td>用于描述函数功能。模型会根据这段描述决定函数调用方式。</td></tr><tr><td>parameters</td><td>Object</td><td>是</td><td>parameters字段需要传入一个 Json Schema 对象，以准确地定义函数所接受的参数。</td></tr></tbody></table>
<p>示例：（注 代码都是使用Python编写）</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tools</span> = [
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_flight_number"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"根据始发地、目的地和日期，查询对应日期的航班号"</span>,
<span class="hljs-string">"parameters"</span>: {
......
},
}
},
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_ticket_price"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"查询某航班在某日的票价"</span>,
<span class="hljs-string">"parameters"</span>: {
......
},
}
},
]
</code></pre>
<p>此处先省略parameters参数，我们将在下一节介绍如何描述函数所需参数。</p>
<p>编写函数参数列表的 JSON 描述</p>
<p>为了准确定义函数的参数列表，在编写参数列表的 JSON Schema 时建议最少包含以下字段：</p>
<ul>
<li>description ：说明函数方法的用途。</li>
<li>type ：定义 JSON 数据的数据类型约束。</li>
<li>properties：一个Object，其中的每个属性代表要定义的 JSON 数据中的一个键。</li>
<li>required：指定哪些属性在数据中必须被包含。</li>
<li>enum：如果一个属性是枚举类型，则此字段应当设置为枚举值的数组。</li>
</ul>
<p>则完整的tools字段设置为：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tools</span> = [
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_flight_number"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"根据始发地、目的地和日期，查询对应日期的航班号"</span>,
<span class="hljs-string">"parameters"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
<span class="hljs-string">"properties"</span>: {
<span class="hljs-string">"departure"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"出发地"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"destination"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"目的地"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"date"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"日期"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
}
},
<span class="hljs-string">"required"</span>: [ <span class="hljs-string">"departure"</span>, <span class="hljs-string">"destination"</span>, <span class="hljs-string">"date"</span> ]
},
}
},
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_ticket_price"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"查询某航班在某日的票价"</span>,
<span class="hljs-string">"parameters"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
<span class="hljs-string">"properties"</span>: {
<span class="hljs-string">"flight_number"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"航班号"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"date"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"日期"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
}
},
<span class="hljs-string">"required"</span>: [ <span class="hljs-string">"flight_number"</span>, <span class="hljs-string">"date"</span>]
},
}
},
]
</code></pre>
<p>函数调用选择</p>
<p>在 tools 参数中，如果填写了 functions 参数，则默认情况下模型将决定何时适合使用其中一个函数。 如果要控制模型如何选择函数调用，需要设置 tool_choice 参数。参数默认值为auto，此时模型根据上下文信息自行选择是否返回函数调用。还可以通过将 tool_choice 参数设置为 “none” 来强制 API 不返回任何函数的调用。目前函数调用仅支持 auto 模式。</p>
<p>Function Call 流程实践</p>
<p>本节将以上文定义的具备查询航班功能的聊天机器人为例，介绍如何与模型对话完成函数调用。</p>
<p>初始化函数定义和client：</p>
<pre><code class="hljs language-ini" lang="ini">from zhipuai import ZhipuAI
<span class="hljs-attr">client</span> = ZhipuAI(api_key=<span class="hljs-string">""</span>)
<span class="hljs-attr">messages</span> = []
<span class="hljs-attr">tools</span> = [
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_flight_number"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"根据始发地、目的地和日期，查询对应日期的航班号"</span>,
<span class="hljs-string">"parameters"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
<span class="hljs-string">"properties"</span>: {
<span class="hljs-string">"departure"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"出发地"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"destination"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"目的地"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"date"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"日期"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
}
},
<span class="hljs-string">"required"</span>: [ <span class="hljs-string">"departure"</span>, <span class="hljs-string">"destination"</span>, <span class="hljs-string">"date"</span> ]
},
}
},
{
<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>,
<span class="hljs-string">"function"</span>: {
<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_ticket_price"</span>,
<span class="hljs-string">"description"</span>: <span class="hljs-string">"查询某航班在某日的票价"</span>,
<span class="hljs-string">"parameters"</span>: {
<span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,
<span class="hljs-string">"properties"</span>: {
<span class="hljs-string">"flight_number"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"航班号"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>
},
<span class="hljs-string">"date"</span>: {
<span class="hljs-string">"description"</span>: <span class="hljs-string">"日期"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,
}
},
<span class="hljs-string">"required"</span>: [ <span class="hljs-string">"flight_number"</span>, <span class="hljs-string">"date"</span>]
},
}
},
]
<span class="hljs-attr">messages</span> = []
</code></pre>
<p>我们想查询2024年1月20日从北京前往上海的航班。我们向模型提供这个信息：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">messages</span> = []
messages.append({"role": "user", "content": "帮我查询从2024年1月20日，从北京出发前往上海的航班"})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
</code></pre>
<p>此时模型成功触发对get_flight_number函数的调用，参数为：date=“2024-01-20”,departure=“北京”,destination=“上海”</p>
<pre><code class="hljs language-rust" lang="rust">content=<span class="hljs-literal">None</span> role=<span class="hljs-symbol">'assistant</span>' tool_calls=[<span class="hljs-title function_ invoke__">CompletionMessageToolCall</span>(id=<span class="hljs-symbol">'call_8252663420321749719</span>', function=<span class="hljs-title function_ invoke__">Function</span>(arguments='{<span class="hljs-string">"date"</span>:<span class="hljs-string">"2024-01-20"</span>,<span class="hljs-string">"departure"</span>:<span class="hljs-string">"北京"</span>,<span class="hljs-string">"destination"</span>:<span class="hljs-string">"上海"</span>}', name=<span class="hljs-symbol">'get_flight_number</span>'), <span class="hljs-keyword">type</span>=<span class="hljs-symbol">'function</span>')]
</code></pre>
<p>现在，清空消息历史。我们尝试提供信息，触发模型对get_ticket_price函数的调用。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">messages</span> = []
messages.append({"role": "system", "content": "不要假设或猜测传入函数的参数值。如果用户的描述不明确，请要求用户提供必要信息"})
messages.append({"role": "user", "content": "帮我查询2024年1月20日1234航班的票价"})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
</code></pre>
<p>此时模型成功触发对get_ticket_price函数的调用，参数为：date=“2024-01-20”,flight_number=“1234”</p>
<pre><code class="hljs language-rust" lang="rust">content=<span class="hljs-literal">None</span> role=<span class="hljs-symbol">'assistant</span>' tool_calls=[<span class="hljs-title function_ invoke__">CompletionMessageToolCall</span>(id=<span class="hljs-symbol">'call_8252648611274312180</span>', function=<span class="hljs-title function_ invoke__">Function</span>(arguments='{<span class="hljs-string">"date"</span>:<span class="hljs-string">"2024-01-20"</span>,<span class="hljs-string">"flight_number"</span>:<span class="hljs-string">"1234"</span>}', name=<span class="hljs-symbol">'get_ticket_price</span>'), <span class="hljs-keyword">type</span>=<span class="hljs-symbol">'function</span>')]
</code></pre>
<p>我们也可以强制模型使用特定函数，比如，我们通过设置tool_choice为{“type”: “function”, “function”: {“name”: “get_ticket_price”}}以强制模型生成调用get_ticket_price的参数。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">messages</span> = []
messages.append({"role": "system", "content": "不要假设或猜测传入函数的参数值。如果用户的描述不明确，请要求用户提供必要信息"})
messages.append({"role": "user", "content": "帮我查询1234航班的票价"})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
<span class="hljs-attr">tool_choice</span>={<span class="hljs-string">"type"</span>: <span class="hljs-string">"function"</span>, <span class="hljs-string">"function"</span>: {<span class="hljs-string">"name"</span>: <span class="hljs-string">"get_ticket_price"</span>}},
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
</code></pre>
<p>此时模型被强制触发对get_ticket_price函数的调用，参数为：date=“2022-01-01”,flight_number=“1234”。注意到此时模型假设了一个date。</p>
<pre><code class="hljs language-rust" lang="rust">content=<span class="hljs-literal">None</span> role=<span class="hljs-symbol">'assistant</span>' tool_calls=[<span class="hljs-title function_ invoke__">CompletionMessageToolCall</span>(id=<span class="hljs-symbol">'call_8252663214163297577</span>', function=<span class="hljs-title function_ invoke__">Function</span>(arguments='{<span class="hljs-string">"date"</span>:<span class="hljs-string">"2022-01-01"</span>,<span class="hljs-string">"flight_number"</span>:<span class="hljs-string">"1234"</span>}', name=<span class="hljs-symbol">'get_ticket_price</span>'), <span class="hljs-keyword">type</span>=<span class="hljs-symbol">'function</span>')]
</code></pre>
<p>我们也可以强制模型不调用函数。需要设置tool_choice为none。</p>
<p>使用模型生成的参数调用函数</p>
<p>将所需的函数实现</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flight_number</span>(<span class="hljs-params">date:<span class="hljs-built_in">str</span> , departure:<span class="hljs-built_in">str</span> , destination:<span class="hljs-built_in">str</span></span>):
flight_number = {
<span class="hljs-string">"北京"</span>:{
<span class="hljs-string">"上海"</span> : <span class="hljs-string">"1234"</span>,
<span class="hljs-string">"广州"</span> : <span class="hljs-string">"8321"</span>,
},
<span class="hljs-string">"上海"</span>:{
<span class="hljs-string">"北京"</span> : <span class="hljs-string">"1233"</span>,
<span class="hljs-string">"广州"</span> : <span class="hljs-string">"8123"</span>,
}
}
<span class="hljs-keyword">return</span> { <span class="hljs-string">"flight_number"</span>:flight_number[departure][destination] }
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ticket_price</span>(<span class="hljs-params">date:<span class="hljs-built_in">str</span> , flight_number:<span class="hljs-built_in">str</span></span>):
<span class="hljs-keyword">return</span> {<span class="hljs-string">"ticket_price"</span>: <span class="hljs-string">"1000"</span>}
</code></pre>
<p>定义处理 Function call 的函数：</p>
<pre><code class="hljs language-ini" lang="ini">def parse_function_call(model_response,messages):
<span class="hljs-comment"># 处理函数调用结果，根据模型返回参数，调用对应的函数。</span>
<span class="hljs-comment"># 调用函数返回结果后构造tool message，再次调用模型，将函数结果输入模型</span>
<span class="hljs-comment"># 模型会将函数调用结果以自然语言格式返回给用户。</span>
if model_response.choices<span class="hljs-section">[0]</span>.message.tool_calls:
<span class="hljs-attr">tool_call</span> = model_response.choices[<span class="hljs-number">0</span>].message.tool_calls[<span class="hljs-number">0</span>]
<span class="hljs-attr">args</span> = tool_call.function.arguments
<span class="hljs-attr">function_result</span> = {}
if <span class="hljs-attr">tool_call.function.name</span> == <span class="hljs-string">"get_flight_number"</span>:
<span class="hljs-attr">function_result</span> = get_flight_number(**json.loads(args))
if <span class="hljs-attr">tool_call.function.name</span> == <span class="hljs-string">"get_ticket_price"</span>:
<span class="hljs-attr">function_result</span> = get_ticket_price(**json.loads(args))
messages.append({
"role": "tool",
"content": f"{json.dumps(function_result)}",
"tool_call_id":tool_call.id
})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
</code></pre>
<p>查询北京到广州的航班：</p>
<pre><code class="hljs language-ini" lang="ini">import json
<span class="hljs-comment"># 清空对话</span>
<span class="hljs-attr">messages</span> = []
messages.append({"role": "system", "content": "不要假设或猜测传入函数的参数值。如果用户的描述不明确，请要求用户提供必要信息"})
messages.append({"role": "user", "content": "帮我查询1月23日，北京到广州的航班"})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
parse_function_call(response,messages)
</code></pre>
<p>返回</p>
<pre><code class="hljs language-rust" lang="rust">content=<span class="hljs-literal">None</span> role=<span class="hljs-symbol">'assistant</span>' tool_calls=[<span class="hljs-title function_ invoke__">CompletionMessageToolCall</span>(id=<span class="hljs-symbol">'call_8282666790542042140</span>', function=<span class="hljs-title function_ invoke__">Function</span>(arguments='{<span class="hljs-string">"date"</span>:<span class="hljs-string">"2023-01-23"</span>,<span class="hljs-string">"departure"</span>:<span class="hljs-string">"北京"</span>,<span class="hljs-string">"destination"</span>:<span class="hljs-string">"广州"</span>}', name=<span class="hljs-symbol">'get_flight_number</span>'), <span class="hljs-keyword">type</span>=<span class="hljs-symbol">'function</span>')]
</code></pre>
<p>content='根据您的要求，我已经查询到了1月23日从北京到广州的航班号，航班号为8321。' role='assistant' tool_calls=None</p>
<p>查询1234航班票价：</p>
<pre><code class="hljs language-ini" lang="ini">messages.append({"role": "user", "content": "这趟航班的价格是多少？"})
<span class="hljs-attr">response</span> = client.chat.completions.create(
<span class="hljs-attr">model</span>=<span class="hljs-string">"glm-4"</span>,  <span class="hljs-comment"># 填写需要调用的模型名称</span>
<span class="hljs-attr">messages</span>=messages,
<span class="hljs-attr">tools</span>=tools,
)
print(response.choices<span class="hljs-section">[0]</span>.message)
messages.append(response.choices<span class="hljs-section">[0]</span>.message.model_dump())
parse_function_call(response,messages)
</code></pre>
<p>返回</p>
<pre><code class="hljs language-rust" lang="rust">content=<span class="hljs-literal">None</span> role=<span class="hljs-symbol">'assistant</span>' tool_calls=[<span class="hljs-title function_ invoke__">CompletionMessageToolCall</span>(id=<span class="hljs-symbol">'call_8282666893621289712</span>', function=<span class="hljs-title function_ invoke__">Function</span>(arguments='{<span class="hljs-string">"date"</span>:<span class="hljs-string">"2023-01-23"</span>,<span class="hljs-string">"flight_number"</span>:<span class="hljs-string">"8321"</span>}', name=<span class="hljs-symbol">'get_ticket_price</span>'), <span class="hljs-keyword">type</span>=<span class="hljs-symbol">'function</span>')]
content='这趟航班的票价为<span class="hljs-number">1000</span>元。' role=<span class="hljs-symbol">'assistant</span>' tool_calls=<span class="hljs-literal">None</span>
</code></pre>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 从业者需要铭记的时刻：2023年6月30日]]></title>    <link>https://juejin.cn/post/7578384621458210868</link>    <guid>https://juejin.cn/post/7578384621458210868</guid>    <pubDate>2025-12-01T04:51:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578384621458210868" data-draft-id="7577625663256231936" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 从业者需要铭记的时刻：2023年6月30日"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-01T04:51:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="张拭心"/> <meta itemprop="url" content="https://juejin.cn/user/571401775094312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 从业者需要铭记的时刻：2023年6月30日
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/571401775094312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    张拭心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T04:51:22.000Z" title="Mon Dec 01 2025 04:51:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2023年6月30日，一个叫Shawn Wang的人，网名Swyx，在 Hacker News 上发表了一篇文章。</p>
<p>标题是<a href="https://link.juejin.cn?target=https%3A%2F%2Fnews.ycombinator.com%2Fitem%3Fid%3D36538423" target="_blank" title="https://news.ycombinator.com/item?id=36538423" ref="nofollow noopener noreferrer">《The Rise of the AI Engineer》</a>。</p>
<p>文章不长，大概5000字。但它做了一件很重要的事情：<strong>它给一群正在做某件事、但不知道自己在做什么的人，起了一个名字。</strong></p>
<p><strong>AI工程师。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/373cc08978724db4b68d86e3420a38a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5out5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765169482&amp;x-signature=JMu4oyX4zzoKjO7lJofJGE2O%2F2g%3D" alt="image.png" loading="lazy"/></p>
<p>在这之前，这些人没有统一的称呼。有人叫自己全栈工程师，有人说自己是产品工程师，还有人干脆就说自己是软件工程师。</p>
<p>他们在业余时间用GPT-3的API做一些有趣的东西，在Discord和Reddit上分享自己的实验，在周末的时候搭建一些小项目。</p>
<p>但他们不知道，自己在做的事情，是一个新的职业。</p>
<p>Swyx在文章里提出了一个概念，叫「shift right」，向右移动。</p>
<p>他说：「<strong>我们正在观察到一代人一次的应用AI『右移』。这是由基础模型的涌现能力和开源/API可用性推动的。2013年需要5年时间和一个研究团队才能完成的大量AI任务，在2023年只需要API文档和一个空闲的下午。</strong>」</p>
<p>一个空闲的下午。</p>
<p>我第一次看到这句话的时候，停住了。</p>
<p>这不是一个比喻，这是一个事实。那些曾经需要PhD、需要GPU集群、需要几百万美元研究经费的事情，现在一个普通的工程师，在周六的下午，坐在咖啡馆里，用笔记本电脑，就可以做出来。</p>
<p>这是一个什么样的时刻？</p>
<p>文章发表后，迅速在技术社区引发了讨论。</p>
<p>有人在Hacker News上评论说：「终于有人说出来了。我过去一年一直在做这个，但我不知道怎么称呼自己。」</p>
<p>有人在Twitter上转发说：「这就是我。我不是ML工程师，我也不是数据科学家，但我每天都在用AI做产品。」</p>
<p>还有人说：「我们公司的Slack里有一个#discuss-ai频道，里面有20个人，大家都在业余时间做实验。现在我知道了，我们是AI工程师。」</p>
<p>OpenAI的联合创始人、前特斯拉AI总监Andrej Karpathy在推文中回应：「从数量上看，AI工程师的数量可能会远远超过ML工程师/LLM工程师。一个人可以在这个角色中非常成功，而无需训练任何东西。」</p>
<p>无需训练任何东西。</p>
<p>这句话，某种程度上，定义了AI工程师和ML工程师的根本区别。</p>
<p>ML工程师在训练模型。他们调优超参数，改进算法，发表论文。他们的工作是让模型更聪明。</p>
<p>AI工程师在使用模型。他们选择模型，设计接口，优化体验。他们的工作是让模型在现实世界中有用。</p>
<p>这是两种完全不同的技能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a746b0306d046fa810471f0b4ed8be6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5out5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765169482&amp;x-signature=ZIk9F2PxgQS8gRXsuGhoifY7B%2Fo%3D" alt="image.png" loading="lazy"/></p>
<p>但为什么这篇文章会在2023年6月发表？为什么不是2022年，也不是2024年？</p>
<p>我想了很久，我觉得，这和一个时间点有关。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f69a6e7f6b1e4f508ab7ce94a9ef4e81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byg5out5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765169482&amp;x-signature=zIcFpRn5ouGyAwJaWvWgwdsuaJE%3D" alt="image.png" loading="lazy"/></p>
<p>2022年11月30日，ChatGPT发布。</p>
<p>在此之前，用GPT-3做东西，还是一件相对小众的事情。你需要申请API key，你需要理解temperature、top_p这些参数，你需要花时间调试prompt。只有那些真正对AI感兴趣、愿意花时间研究的工程师，才会去做这些事。</p>
<p>但ChatGPT出现之后，所有人都知道了，原来AI可以这样用。</p>
<p>于是，一切都变了。</p>
<p>那些在业余时间做实验的工程师，突然发现，他们做的事情，不再是小众的爱好，而是一个巨大的机会。那些在Slack频道里讨论AI的团队，突然发现，他们需要把这个非正式的讨论组，变成一个正式的团队。那些在周末搭建小项目的人，突然发现，有公司愿意为他们的技能付钱。</p>
<p>Swyx的文章，就是在这个时刻出现的。</p>
<p>它不是创造了这个职业，而是给这个正在形成的职业，起了一个名字。它不是告诉人们应该做什么，而是告诉人们，你们正在做的事情，有一个名字，有一个身份，有一个未来。</p>
<p>这就是为什么，这篇文章会在2023年6月30日发表。</p>
<p>因为在这之前，这个职业还没有准备好被命名。在这之后，这个职业已经不需要被命名了。</p>
<p>2023年6月30日，是那个恰好的时刻。</p>
<p>我有时候会想，如果没有这篇文章，会怎么样？</p>
<p>也许这个职业还是会出现，也许人们还是会找到彼此，也许市场还是会认可这个技能。但可能不会这么快，不会这么清晰，不会这么有力量。</p>
<p>因为名字很重要。</p>
<p><strong>当你有了一个名字，你就有了一个身份。当你有了一个身份，你就知道自己是谁，你在做什么，你要去哪里</strong>。</p>
<p>在2023年6月30日之前，那些在业余时间用GPT-3做实验的工程师，他们是孤独的。他们不知道有多少人在做同样的事情，不知道这件事是否有价值，不知道这条路能走多远。</p>
<p>但在2023年6月30日之后，他们有了一个名字。</p>
<p>AI工程师。</p>
<p>他们不再孤独。</p>
<p>如果你正在使用 AI，正在用它做一些独立产品，或者在公司内部优化一些流程，那么，你就是 AI 工程师。</p>
<blockquote>
<p>这是「转型 AI 工程师：重塑你的能力栈与思维模型」专栏的先导文章。接下来，我们会深入探讨 AI 应用工程师的技能栈、工具链、实战案例，以及如何从零开始转型。</p>
</blockquote>
<hr/>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486729%26idx%3D1%26sn%3D3077dcce2f0fbcd3d982b78d105a7a0a%26scene%3D21%23wechat_redirect" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486729%26idx%3D1%26sn%3D3077dcce2f0fbcd3d982b78d105a7a0a%26scene%3D21%23wechat_redirect" target="_blank">这就是流量的力量吗？用豆包 AI 编程做的小红书小组件帖子爆了</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486667%26idx%3D1%26sn%3D80751790795b1fd45e8173b3ac48ea6e%26scene%3D21%23wechat_redirect" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486667%26idx%3D1%26sn%3D80751790795b1fd45e8173b3ac48ea6e%26scene%3D21%23wechat_redirect" target="_blank">2025 上半年头部 AI 产品都有哪些？还有哪些新起之秀？</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486632%26idx%3D1%26sn%3D38809000a3496c168c9000464f306eb2%26scene%3D21%23wechat_redirect" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486632%26idx%3D1%26sn%3D38809000a3496c168c9000464f306eb2%26scene%3D21%23wechat_redirect" target="_blank">拭心 7 月日复盘｜个体在 AI 时代的挑战</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486616%26idx%3D1%26sn%3D255b678e36229b09ef2fe13b85ba48b2%26scene%3D21%23wechat_redirect" title="https://link.juejin.cn/?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI1ODQ3NDA2Mg%3D%3D%26mid%3D2247486616%26idx%3D1%26sn%3D255b678e36229b09ef2fe13b85ba48b2%26scene%3D21%23wechat_redirect" target="_blank">2025 年 AI 的落地程度远比我们想象的广</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[网络请求库通用封装（GET/POST + 超时 + 传参）+fetch]]></title>    <link>https://juejin.cn/post/7578054192809771034</link>    <guid>https://juejin.cn/post/7578054192809771034</guid>    <pubDate>2025-12-01T03:06:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578054192809771034" data-draft-id="7578029829998116914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="网络请求库通用封装（GET/POST + 超时 + 传参）+fetch"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-01T03:06:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="五号厂房"/> <meta itemprop="url" content="https://juejin.cn/user/1731066903142492"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            网络请求库通用封装（GET/POST + 超时 + 传参）+fetch
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1731066903142492/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    五号厂房
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T03:06:31.000Z" title="Mon Dec 01 2025 03:06:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端使用 <code>fetch</code> 进行 GET/POST 请求时，<strong>传参方式</strong>和<strong>超时设置</strong>是高频需求，以下是系统化的实现方案，包含完整示例和避坑点：</p>
<h3 data-id="heading-0">一、GET 请求传参</h3>
<p>GET 请求的参数需拼接在 URL 末尾（查询字符串），核心注意：</p>
<ol>
<li>参数需用 <code>encodeURIComponent</code> 编码（避免特殊字符 / 中文乱码）；</li>
<li>多个参数用 <code>&amp;</code> 分隔，空值 /undefined 建议过滤（避免无效参数）。</li>
</ol>
<h4 data-id="heading-1">实现方式：</h4>
<h5 data-id="heading-2">1. 手动拼接（简单场景）</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 基础示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchGetSimple</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">'/api/user/list'</span>;
  <span class="hljs-comment">// 待传参数</span>
  <span class="hljs-keyword">const</span> params = {
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">keyword</span>: <span class="hljs-string">'张三'</span> <span class="hljs-comment">// 含中文，需编码</span>
  };

  <span class="hljs-comment">// 拼接查询字符串（手动编码）</span>
  <span class="hljs-keyword">const</span> queryStr = <span class="hljs-string">`page=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(params.page)}</span>&amp;size=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(params.size)}</span>&amp;keyword=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(params.keyword)}</span>`</span>;
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${baseUrl}</span>?<span class="hljs-subst">${queryStr}</span>`</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'GET请求结果：'</span>, data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败：'</span>, error);
  }
}
</code></pre>
<h5 data-id="heading-3">2. 通用工具函数（推荐，适配多参数）</h5>
<p>封装参数拼接逻辑，避免重复代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 拼接GET请求的URL和参数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} url 基础URL
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} params 参数对象
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} 拼接后的URL
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">buildGetUrl</span>(<span class="hljs-params">url, params = {}</span>) {
  <span class="hljs-keyword">const</span> validParams = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(params)
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">[_, value]</span>) =&gt;</span> value !== <span class="hljs-literal">undefined</span> &amp;&amp; value !== <span class="hljs-literal">null</span> &amp;&amp; value !== <span class="hljs-string">''</span>) <span class="hljs-comment">// 过滤空值</span>
    .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(key)}</span>=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(value)}</span>`</span>);

  <span class="hljs-keyword">return</span> validParams.<span class="hljs-property">length</span> ? <span class="hljs-string">`<span class="hljs-subst">${url}</span>?<span class="hljs-subst">${validParams.join(<span class="hljs-string">'&amp;'</span>)}</span>`</span> : url;
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchGetWithTool</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-title function_">buildGetUrl</span>(<span class="hljs-string">'/api/user/list'</span>, {
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">keyword</span>: <span class="hljs-string">'张三'</span>,
    <span class="hljs-attr">emptyKey</span>: <span class="hljs-string">''</span> <span class="hljs-comment">// 会被过滤</span>
  });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'GET请求结果：'</span>, data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败：'</span>, error);
  }
}
</code></pre>
<h3 data-id="heading-4">二、POST 请求传参</h3>
<p>POST 请求参数需放在 <code>fetch</code> 的 <code>body</code> 中，核心区分 <strong>Content-Type</strong>（决定参数格式），常见 3 种场景：</p>
<h4 data-id="heading-5">1. JSON 格式（最常用，后端接收 <code>application/json</code>）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPostJson</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">'/api/user/add'</span>;
  <span class="hljs-comment">// POST参数（JSON格式）</span>
  <span class="hljs-keyword">const</span> postData = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>,
    <span class="hljs-attr">tags</span>: [<span class="hljs-string">'前端'</span>, <span class="hljs-string">'JavaScript'</span>]
  };

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>, <span class="hljs-comment">// 必须指定方法</span>
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> <span class="hljs-comment">// 声明JSON格式</span>
        <span class="hljs-comment">// 可选：添加token等自定义头</span>
        <span class="hljs-comment">// 'Authorization': 'Bearer ' + token</span>
      },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(postData) <span class="hljs-comment">// 转为JSON字符串</span>
    });

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'POST(JSON)请求结果：'</span>, data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败：'</span>, error);
  }
}
</code></pre>
<h4 data-id="heading-6">2. 表单格式（<code>application/x-www-form-urlencoded</code>，模拟表单提交）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPostForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">'/api/user/login'</span>;
  <span class="hljs-comment">// 表单参数</span>
  <span class="hljs-keyword">const</span> formData = {
    <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span>
  };

  <span class="hljs-comment">// 转为表单字符串（key1=value1&amp;key2=value2）</span>
  <span class="hljs-keyword">const</span> formStr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(formData).<span class="hljs-title function_">toString</span>();
  <span class="hljs-comment">// 等价于：Object.entries(formData).map(([k, v]) =&gt; `${encodeURIComponent(k)}=${encodeURIComponent(v)}`).join('&amp;')</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span> <span class="hljs-comment">// 声明表单格式</span>
      },
      <span class="hljs-attr">body</span>: formStr
    });

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'POST(表单)请求结果：'</span>, data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败：'</span>, error);
  }
}
</code></pre>
<h4 data-id="heading-7">3. FormData 格式（上传文件 / 多表单数据）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchPostFormData</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">'/api/file/upload'</span>;
  <span class="hljs-comment">// 创建FormData对象</span>
  <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#fileInput'</span>).<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 文件</span>
  formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'上传文件'</span>); <span class="hljs-comment">// 普通参数</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: formData <span class="hljs-comment">// 无需设置Content-Type，浏览器自动添加multipart/form-data</span>
    });

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'文件上传结果：'</span>, data);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'上传失败：'</span>, error);
  }
}
</code></pre>
<h3 data-id="heading-8">三、fetch 超时设置</h3>
<p><code>fetch</code> 原生<strong>无直接的 timeout 参数</strong>，需通过 <code>Promise.race</code> 实现超时控制：</p>
<ul>
<li>原理：同时执行 <code>fetch 请求</code> 和 <code>延时reject的Promise</code>，谁先完成就执行谁；</li>
<li>超时后需<strong>终止请求</strong>（避免无效请求占用资源），通过 <code>AbortController</code> 实现。</li>
</ul>
<h4 data-id="heading-9">完整超时实现（含请求终止）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 带超时的fetch请求
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} url 请求URL
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} options fetch配置（method/headers/body等）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} timeout 超时时间（毫秒，默认5000）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} 请求结果
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchWithTimeout</span>(<span class="hljs-params">url, options = {}, timeout = <span class="hljs-number">5000</span></span>) {
  <span class="hljs-comment">// 创建AbortController（用于终止请求）</span>
  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();
  <span class="hljs-keyword">const</span> signal = controller.<span class="hljs-property">signal</span>;

  <span class="hljs-comment">// 超时Promise：timeout毫秒后reject，并终止请求</span>
  <span class="hljs-keyword">const</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// 终止fetch请求</span>
      <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`请求超时（<span class="hljs-subst">${timeout}</span>ms）`</span>));
    }, timeout);
  });

  <span class="hljs-comment">// 用Promise.race包裹fetch和超时Promise</span>
  <span class="hljs-keyword">const</span> fetchPromise = <span class="hljs-title function_">fetch</span>(url, {
    ...options,
    signal <span class="hljs-comment">// 关联AbortController</span>
  });

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([fetchPromise, timeoutPromise]);
    <span class="hljs-comment">// 检查请求是否成功（status 200-299）</span>
    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`请求失败：<span class="hljs-subst">${response.status}</span> <span class="hljs-subst">${response.statusText}</span>`</span>);
    }
    <span class="hljs-comment">// 根据返回类型解析（可扩展为自动识别JSON/Blob/Text）</span>
    <span class="hljs-keyword">const</span> contentType = response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'Content-Type'</span>);
    <span class="hljs-keyword">if</span> (contentType?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'application/json'</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 区分超时错误和终止错误</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">'AbortError'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'请求被终止（超时/手动取消）'</span>);
    }
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// 调用示例1：GET请求 + 超时（3秒）</span>
<span class="hljs-title function_">fetchWithTimeout</span>(
  <span class="hljs-title function_">buildGetUrl</span>(<span class="hljs-string">'/api/user/list'</span>, { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">size</span>: <span class="hljs-number">10</span> }),
  { <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span> },
  <span class="hljs-number">3000</span>
)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'GET请求结果：'</span>, data))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'GET请求失败：'</span>, error));

<span class="hljs-comment">// 调用示例2：POST请求 + 超时（5秒）</span>
<span class="hljs-title function_">fetchWithTimeout</span>(
  <span class="hljs-string">'/api/user/add'</span>,
  {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> })
  },
  <span class="hljs-number">5000</span>
)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'POST请求结果：'</span>, data))
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'POST请求失败：'</span>, error));
</code></pre>
<h3 data-id="heading-10">四、关键注意事项</h3>
<ol>
<li>
<p><strong>参数编码</strong>：</p>
<ul>
<li>GET 参数和表单格式的 POST 参数必须编码（<code>encodeURIComponent</code>），避免中文 / 特殊字符（如 <code>&amp;</code>、<code>=</code>、空格）导致参数解析错误；</li>
<li>JSON 格式的 POST 参数无需手动编码，<code>JSON.stringify</code> 会自动处理。</li>
</ul>
</li>
<li>
<p><strong>AbortController 兼容性</strong>：</p>
<ul>
<li>支持 Chrome 66+、Firefox 57+、Edge 79+、Safari 12.1+，老旧浏览器（如 IE）需 polyfill；</li>
<li>超时后必须调用 <code>controller.abort()</code>，否则 fetch 仍会继续请求，浪费资源。</li>
</ul>
</li>
<li>
<p><strong>超时错误区分</strong>：</p>
<ul>
<li>超时触发的 <code>AbortError</code> 和手动取消请求的错误类型一致，可通过自定义 Error 信息区分（如示例中的 <code>请求超时</code> 提示）。</li>
</ul>
</li>
<li>
<p><strong>POST 请求 Content-Type 注意</strong>：</p>
<ul>
<li>JSON 格式：必须设置 <code>Content-Type: application/json</code>，否则后端无法解析；</li>
<li>FormData 格式：<strong>禁止手动设置 Content-Type</strong>，浏览器会自动添加边界符（<code>boundary</code>），手动设置会导致后端解析失败。</li>
</ul>
</li>
<li>
<p><strong>空参数处理</strong>：</p>
<ul>
<li>GET 请求建议过滤 <code>undefined/null/空字符串</code> 参数，避免 URL 出现 <code>?key=&amp;key2=</code> 这类无效拼接；</li>
<li>POST 请求根据后端要求处理空值（部分后端允许接收空字符串，部分需过滤）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">五、通用封装（GET/POST + 超时 + 传参）</h3>
<p>整合以上逻辑，封装通用 fetch 函数，适配大部分场景：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 通用fetch请求函数
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} url 请求URL
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} options 配置项
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.method 请求方法（GET/POST，默认GET）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} options.params URL参数（GET专用）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} options.data 请求体参数（POST专用）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.contentType 请求体格式（json/form，默认json）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} options.timeout 超时时间（毫秒，默认5000）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise</span>} 请求结果
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">{
  url,
  method = <span class="hljs-string">'GET'</span>,
  params = {},
  data = {},
  contentType = <span class="hljs-string">'json'</span>,
  timeout = <span class="hljs-number">5000</span>
}</span>) {
  <span class="hljs-comment">// 处理GET参数</span>
  <span class="hljs-keyword">const</span> finalUrl = method.<span class="hljs-title function_">toUpperCase</span>() === <span class="hljs-string">'GET'</span> ? <span class="hljs-title function_">buildGetUrl</span>(url, params) : url;

  <span class="hljs-comment">// 处理POST请求体</span>
  <span class="hljs-keyword">let</span> body = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">const</span> headers = {};
  <span class="hljs-keyword">if</span> (method.<span class="hljs-title function_">toUpperCase</span>() === <span class="hljs-string">'POST'</span>) {
    <span class="hljs-keyword">if</span> (contentType === <span class="hljs-string">'json'</span>) {
      headers[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/json'</span>;
      body = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contentType === <span class="hljs-string">'form'</span>) {
      headers[<span class="hljs-string">'Content-Type'</span>] = <span class="hljs-string">'application/x-www-form-urlencoded'</span>;
      body = <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(data).<span class="hljs-title function_">toString</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contentType === <span class="hljs-string">'formData'</span>) {
      body = data; <span class="hljs-comment">// 直接传入FormData对象，无需设置headers</span>
    }
  }

  <span class="hljs-comment">// 调用带超时的fetch</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchWithTimeout</span>(finalUrl, {
    method,
    headers,
    body
  }, timeout);
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-comment">// 1. GET请求</span>
<span class="hljs-title function_">request</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/list'</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
  <span class="hljs-attr">params</span>: { <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">size</span>: <span class="hljs-number">10</span> },
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));

<span class="hljs-comment">// 2. POST JSON请求</span>
<span class="hljs-title function_">request</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/add'</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
  <span class="hljs-attr">contentType</span>: <span class="hljs-string">'json'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));

<span class="hljs-comment">// 3. POST 表单请求</span>
<span class="hljs-title function_">request</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user/login'</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
  <span class="hljs-attr">data</span>: { <span class="hljs-attr">username</span>: <span class="hljs-string">'admin'</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span> },
  <span class="hljs-attr">contentType</span>: <span class="hljs-string">'form'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">4000</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<h3 data-id="heading-12">总结</h3>

























<table><thead><tr><th>场景</th><th>实现要点</th></tr></thead><tbody><tr><td>GET 传参</td><td>参数编码 + URL 拼接 + 过滤空值</td></tr><tr><td>POST 传参</td><td>JSON（常用）/ 表单 / FormData，匹配对应 Content-Type</td></tr><tr><td>超时设置</td><td>Promise.race + AbortController（必须终止请求）</td></tr><tr><td>通用封装</td><td>整合参数处理、超时、Content-Type，降低重复代码</td></tr></tbody></table>
<p>核心原则：<strong>传参需匹配后端解析格式，超时需终止无效请求，封装需兼顾通用性和可维护性</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>